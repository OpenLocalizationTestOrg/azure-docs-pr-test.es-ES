# <a name="common-errors-during-classic-to-azure-resource-manager-migration"></a><span data-ttu-id="cf784-101">Errores comunes durante la migración del modelo clásico a Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="cf784-101">Common errors during Classic to Azure Resource Manager migration</span></span>
<span data-ttu-id="cf784-102">En este artículo se catalogan los errores y las soluciones más comunes durante la migración de recursos de IaaS del modelo de implementación clásica a la pila de Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="cf784-102">This article catalogs the most common errors and mitigations during the migration of IaaS resources from Azure classic deployment model to the Azure Resource Manager stack.</span></span>

## <a name="list-of-errors"></a><span data-ttu-id="cf784-103">Lista de errores</span><span class="sxs-lookup"><span data-stu-id="cf784-103">List of errors</span></span>
| <span data-ttu-id="cf784-104">Cadena de error</span><span class="sxs-lookup"><span data-stu-id="cf784-104">Error string</span></span> | <span data-ttu-id="cf784-105">Mitigación</span><span class="sxs-lookup"><span data-stu-id="cf784-105">Mitigation</span></span> |
| --- | --- |
| <span data-ttu-id="cf784-106">Error interno del servidor</span><span class="sxs-lookup"><span data-stu-id="cf784-106">Internal server error</span></span> |<span data-ttu-id="cf784-107">En algunos casos, se trata de un error transitorio que desaparece con un reintento.</span><span class="sxs-lookup"><span data-stu-id="cf784-107">In some cases, this is a transient error that goes away with a retry.</span></span> <span data-ttu-id="cf784-108">Si continúa, [póngase en contacto con el soporte técnico de Azure](../articles/azure-supportability/how-to-create-azure-support-request.md) ya que será necesario investigar los registros de la plataforma.</span><span class="sxs-lookup"><span data-stu-id="cf784-108">If it continues to persist, [contact Azure support](../articles/azure-supportability/how-to-create-azure-support-request.md) as it needs investigation of platform logs.</span></span> <br><br> <span data-ttu-id="cf784-109">**NOTA:** Cuando la incidencia ya esté en manos del equipo de soporte técnico, no intente ninguna migración por su cuenta ya que podría tener consecuencias imprevistas sobre su entorno.</span><span class="sxs-lookup"><span data-stu-id="cf784-109">**NOTE:** Once the incident is tracked by the support team, please do not attempt any self-mitigation as this might have unintended consequences on your environment.</span></span> |
| <span data-ttu-id="cf784-110">No se admite la migración para la implementación {nombre de implementación} en HostedService {nombre del servicio hospedado} porque es una implementación PaaS (web/trabajo).</span><span class="sxs-lookup"><span data-stu-id="cf784-110">Migration is not supported for Deployment {deployment-name}  in HostedService {hosted-service-name} because it is a PaaS deployment (Web/Worker).</span></span> |<span data-ttu-id="cf784-111">Esto sucede cuando una implementación contiene un rol web o de trabajo.</span><span class="sxs-lookup"><span data-stu-id="cf784-111">This happens when a deployment contains a web/worker role.</span></span> <span data-ttu-id="cf784-112">Dado que solo se admite la migración de máquinas virtuales, quite el rol web o de trabajo de la implementación y vuelva a intentar la migración.</span><span class="sxs-lookup"><span data-stu-id="cf784-112">Since migration is only supported for Virtual Machines, please remove the web/worker role from the deployment and try migration again.</span></span> |
| <span data-ttu-id="cf784-113">Error de implementación de plantilla {nombre de plantilla}.</span><span class="sxs-lookup"><span data-stu-id="cf784-113">Template {template-name} deployment failed.</span></span> <span data-ttu-id="cf784-114">CorrelationId={guid}</span><span class="sxs-lookup"><span data-stu-id="cf784-114">CorrelationId={guid}</span></span> |<span data-ttu-id="cf784-115">En el back-end del servicio de migración, usamos plantillas de Azure Resource Manager para crear recursos en la pila de Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="cf784-115">In the backend of migration service, we use Azure Resource Manager templates to create resources in the Azure Resource Manager stack.</span></span> <span data-ttu-id="cf784-116">Puesto que las plantillas son idempotentes, lo normal es que pueda reintentar la operación de migración para solucionar este error.</span><span class="sxs-lookup"><span data-stu-id="cf784-116">Since templates are idempotent, usually you can safely retry the migration operation to get past this error.</span></span> <span data-ttu-id="cf784-117">Si este error continúa, [póngase en contacto con el soporte técnico de Azure](../articles/azure-supportability/how-to-create-azure-support-request.md) y proporcióneles el CorrelationId.</span><span class="sxs-lookup"><span data-stu-id="cf784-117">If this error continues to persist, please [contact Azure support](../articles/azure-supportability/how-to-create-azure-support-request.md) and give them the CorrelationId.</span></span> <br><br> <span data-ttu-id="cf784-118">**NOTA:** Cuando la incidencia ya esté en manos del equipo de soporte técnico, no intente ninguna migración por su cuenta ya que podría tener consecuencias imprevistas sobre su entorno.</span><span class="sxs-lookup"><span data-stu-id="cf784-118">**NOTE:** Once the incident is tracked by the support team, please do not attempt any self-mitigation as this might have unintended consequences on your environment.</span></span> |
| <span data-ttu-id="cf784-119">La red virtual {nombre de la red virtual} no existe.</span><span class="sxs-lookup"><span data-stu-id="cf784-119">The virtual network {virtual-network-name} does not exist.</span></span> |<span data-ttu-id="cf784-120">Esto puede ocurrir si ha creado la red virtual en el nuevo Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="cf784-120">This can happen if you created the Virtual Network in the new Azure portal.</span></span> <span data-ttu-id="cf784-121">El nombre de la red virtual real sigue el patrón "Grupo * <VNET name>".</span><span class="sxs-lookup"><span data-stu-id="cf784-121">The actual Virtual Network name follows the pattern "Group * <VNET name>"</span></span> |
| <span data-ttu-id="cf784-122">La máquina virtual {nombre de la máquina virtual} de HostedService {nombre del servicio hospedado} contiene la extensión {nombre de la extensión} que no se admite en Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="cf784-122">VM {vm-name} in HostedService {hosted-service-name} contains Extension {extension-name} which is not supported in Azure Resource Manager.</span></span> <span data-ttu-id="cf784-123">Se recomienda desinstalarla de la máquina virtual antes de continuar con la migración.</span><span class="sxs-lookup"><span data-stu-id="cf784-123">It is recommended to uninstall it from the VM before continuing with migration.</span></span> |<span data-ttu-id="cf784-124">Las extensiones XML como BGInfo 1.* no se admiten en Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="cf784-124">XML extensions such as BGInfo 1.* are not supported in Azure Resource Manager.</span></span> <span data-ttu-id="cf784-125">Por lo tanto, no se pueden migrar estas extensiones.</span><span class="sxs-lookup"><span data-stu-id="cf784-125">Therefore, these extensions cannot be migrated.</span></span> <span data-ttu-id="cf784-126">Si estas extensiones se dejan instaladas en la máquina virtual, se desinstalan automáticamente antes de completar la migración.</span><span class="sxs-lookup"><span data-stu-id="cf784-126">If these extensions are left installed on the virtual machine, they are automatically uninstalled before completing the migration.</span></span> |
| <span data-ttu-id="cf784-127">La máquina virtual {nombre de la máquina virtual} de HostedService {nombre del servicio hospedado} contiene la extensión VMSnapshot/VMSnapshotLinux que actualmente no se admite para migración.</span><span class="sxs-lookup"><span data-stu-id="cf784-127">VM {vm-name} in HostedService {hosted-service-name} contains Extension VMSnapshot/VMSnapshotLinux, which is currently not supported for Migration.</span></span> <span data-ttu-id="cf784-128">Desinstálela de la máquina virtual y vuelva a agregarla mediante Azure Resource Manager después de completar la migración</span><span class="sxs-lookup"><span data-stu-id="cf784-128">Uninstall it from the VM and add it back using Azure Resource Manager after the Migration is Complete</span></span> |<span data-ttu-id="cf784-129">Este es el escenario donde la máquina virtual está configurada para Azure Backup.</span><span class="sxs-lookup"><span data-stu-id="cf784-129">This is the scenario where the virtual machine is configured for Azure Backup.</span></span> <span data-ttu-id="cf784-130">Puesto que este no es actualmente un escenario admitido, siga la solución alternativa en https://aka.ms/vmbackupmigration.</span><span class="sxs-lookup"><span data-stu-id="cf784-130">Since this is currently an unsupported scenario, please follow the workaround at https://aka.ms/vmbackupmigration</span></span> |
| <span data-ttu-id="cf784-131">La máquina virtual {nombre de la máquina virtual} en HostedService {nombre del servicio hospedado} contiene la extensión {nombre de la extensión} cuyo estado no está notificando la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="cf784-131">VM {vm-name} in HostedService {hosted-service-name} contains Extension {extension-name} whose Status is not being reported from the VM.</span></span> <span data-ttu-id="cf784-132">Por lo tanto, esta máquina virtual no se puede migrar.</span><span class="sxs-lookup"><span data-stu-id="cf784-132">Hence, this VM cannot be migrated.</span></span> <span data-ttu-id="cf784-133">Asegúrese de que se notifica el estado de la extensión o desinstale la extensión de la máquina virtual y vuelva a intentar la migración.</span><span class="sxs-lookup"><span data-stu-id="cf784-133">Ensure that the Extension status is being reported or uninstall the extension from the VM and retry migration.</span></span> <br><br> <span data-ttu-id="cf784-134">La máquina virtual {nombre de la máquina virtual} en HostedService {nombre del servicio hospedado} contiene la extensión {nombre de la extensión} que notifica el estado del controlador: {estado del controlador}.</span><span class="sxs-lookup"><span data-stu-id="cf784-134">VM {vm-name} in HostedService {hosted-service-name} contains Extension {extension-name} reporting Handler Status: {handler-status}.</span></span> <span data-ttu-id="cf784-135">Por lo tanto, la VM no se puede migra.</span><span class="sxs-lookup"><span data-stu-id="cf784-135">Hence, the VM cannot be migrated.</span></span> <span data-ttu-id="cf784-136">Asegúrese de que el estado del controlador de la extensión que se notifica sea {estado del controlador} o desinstálelo de la máquina virtual y vuelva a intentar la migración.</span><span class="sxs-lookup"><span data-stu-id="cf784-136">Ensure that the Extension handler status being reported is {handler-status} or uninstall it from the VM and retry migration.</span></span> <br><br> <span data-ttu-id="cf784-137">El agente de máquina virtual de la máquina virtual {nombre de la máquina virtual} en HostedService {nombre del servicio hospedado} está notificando el estado general del agente como no preparado.</span><span class="sxs-lookup"><span data-stu-id="cf784-137">VM Agent for VM {vm-name} in HostedService {hosted-service-name} is reporting the overall agent status as Not Ready.</span></span> <span data-ttu-id="cf784-138">Por lo tanto si tiene una extensión que es migrable, la máquina virtual no se puede migrar.</span><span class="sxs-lookup"><span data-stu-id="cf784-138">Hence, the VM may not be migrated, if it has a migratable extension.</span></span> <span data-ttu-id="cf784-139">Asegúrese de que el agente de máquina virtual está notificando el estado general del agente como listo.</span><span class="sxs-lookup"><span data-stu-id="cf784-139">Ensure that the VM Agent is reporting overall agent status as Ready.</span></span> <span data-ttu-id="cf784-140">Consulte https://aka.ms/classiciaasmigrationfaqs.</span><span class="sxs-lookup"><span data-stu-id="cf784-140">Refer to https://aka.ms/classiciaasmigrationfaqs.</span></span> |<span data-ttu-id="cf784-141">Las extensiones del agente invitado de Azure y de la máquina virtual necesitan acceso de salida a Internet a la cuenta de almacenamiento de la máquina virtual para rellenar su estado.</span><span class="sxs-lookup"><span data-stu-id="cf784-141">Azure guest agent & VM Extensions need outbound internet access to the VM storage account to populate their status.</span></span> <span data-ttu-id="cf784-142">Entre las causas comunes del error de estado se incluyen:</span><span class="sxs-lookup"><span data-stu-id="cf784-142">Common causes of status failure include</span></span> <li> <span data-ttu-id="cf784-143">Un grupo de seguridad de red que bloquea el acceso de salida a Internet.</span><span class="sxs-lookup"><span data-stu-id="cf784-143">a Network Security Group that blocks outbound access to the internet</span></span> <li> <span data-ttu-id="cf784-144">Si la red virtual tiene servidores DNS locales y se pierde la conectividad con DNS.</span><span class="sxs-lookup"><span data-stu-id="cf784-144">If the VNET has on-prem DNS servers and DNS connectivity is lost</span></span> <br><br> <span data-ttu-id="cf784-145">Si continúa viendo un estado no admitido, puede desinstalar las extensiones para omitir esta comprobación y seguir adelante con la migración.</span><span class="sxs-lookup"><span data-stu-id="cf784-145">If you continue to see an unsupported status, you can uninstall the extensions to skip this check and move forward with migration.</span></span> |
| <span data-ttu-id="cf784-146">No se admite la migración para la implementación {nombre de implementación} en HostedService {nombre del servicio hospedado} porque tiene varios conjuntos de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="cf784-146">Migration is not supported for Deployment {deployment-name} in HostedService {hosted-service-name} because it has multiple Availability Sets.</span></span> |<span data-ttu-id="cf784-147">Actualmente, solo se pueden migrar los servicios hospedados que tengan como mucho un conjunto de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="cf784-147">Currently, only hosted services that have 1 or less Availability sets can be migrated.</span></span> <span data-ttu-id="cf784-148">Para solucionar este problema, mueva los conjuntos de disponibilidad adicionales y las máquinas virtuales de esos conjuntos de disponibilidad a otro servicio hospedado.</span><span class="sxs-lookup"><span data-stu-id="cf784-148">To work around this problem, please move the additional Availability sets and Virtual machines in those Availability sets to a different hosted service.</span></span> |
| <span data-ttu-id="cf784-149">No se admite la migración para la implementación {nombre de implementación} en HostedService {nombre del servicio hospedado} porque tiene máquinas virtuales que no forman parte del conjunto de disponibilidad aunque HostedService contiene uno.</span><span class="sxs-lookup"><span data-stu-id="cf784-149">Migration is not supported for Deployment {deployment-name} in HostedService {hosted-service-name because it has VMs that are not part of the Availability Set even though the HostedService contains one.</span></span> |<span data-ttu-id="cf784-150">En este escenario la solución consiste en mover todas las máquinas virtuales a un único conjunto de disponibilidad o quitar todas las máquinas virtuales del conjunto de disponibilidad en el servicio hospedado.</span><span class="sxs-lookup"><span data-stu-id="cf784-150">The workaround for this scenario is to either move all the virtual machines into a single Availability set or remove all Virtual machines from the Availability set in the hosted service.</span></span> |
| <span data-ttu-id="cf784-151">La cuenta de almacenamiento/HostedService/red virtual {nombre de la red virtual} está en proceso de ser migrada y por tanto no se puede cambiar.</span><span class="sxs-lookup"><span data-stu-id="cf784-151">Storage account/HostedService/Virtual Network {virtual-network-name} is in the process of being migrated and hence cannot be changed</span></span> |<span data-ttu-id="cf784-152">Este error se produce cuando la operación para preparar la migración se ha completado en el recurso y se desencadena una operación que haría un cambio en él.</span><span class="sxs-lookup"><span data-stu-id="cf784-152">This error happens when the "Prepare" migration operation has been completed on the resource and an operation that would make a change to the resource is triggered.</span></span> <span data-ttu-id="cf784-153">Debido al bloqueo en el plano de administración después de la operación de preparación, todos los cambios en el recurso se bloquean.</span><span class="sxs-lookup"><span data-stu-id="cf784-153">Because of the lock on the management plane after "Prepare" operation, any changes to the resource are blocked.</span></span> <span data-ttu-id="cf784-154">Para desbloquear el plano de administración, puede ejecutar la operación de confirmación de la migración para completar la migración o la operación de anulación de la migración para revertir a la operación de preparación.</span><span class="sxs-lookup"><span data-stu-id="cf784-154">To unlock the management plane, you can run the "Commit" migration operation to complete migration or the "Abort" migration operation to roll back the "Prepare" operation.</span></span> |
| <span data-ttu-id="cf784-155">No se permite la migración para HostedService {nombre del servicio hospedado} porque tiene una máquina virtual {nombre de la máquina virtual} en estado: RoleStateUnknown.</span><span class="sxs-lookup"><span data-stu-id="cf784-155">Migration is not allowed for HostedService {hosted-service-name} because it has VM {vm-name} in State: RoleStateUnknown.</span></span> <span data-ttu-id="cf784-156">La migración solo se permite cuando la máquina virtual tiene uno de los siguientes estados: En ejecución, Detenido, Detenido (desasignado).</span><span class="sxs-lookup"><span data-stu-id="cf784-156">Migration is allowed only when the VM is in one of the following states - Running, Stopped, Stopped Deallocated.</span></span> |<span data-ttu-id="cf784-157">La máquina virtual podría estar experimentando una transición de estado que normalmente sucede durante una operación de actualización en HostedService, como un reinicio, la instalación de una extensión, etc. Se recomienda completar la operación de actualización en HostedService antes de intentar la migración.</span><span class="sxs-lookup"><span data-stu-id="cf784-157">The VM might be undergoing through a state transition, which usually happens when during an update operation on the HostedService such as a reboot, extension installation etc. It is recommended for the update operation to complete on the HostedService before trying migration.</span></span> |
| <span data-ttu-id="cf784-158">La implementación {nombre-implementación} en HostedService {nombre-servicio-hospedado} contiene una máquina virtual {nombre-máquina-virtual} con el disco de datos {nombre-disco-datos} cuyos bytes de tamaño de blob físico {tamaño-blob-vhd-que-realiza-copia-seguridad-disco-datos} no coinciden con los del tamaño lógico del disco de datos de la máquina virtual {tamaño-disco-datos-especificado-en-api-máquina-virtual}.</span><span class="sxs-lookup"><span data-stu-id="cf784-158">Deployment {deployment-name} in HostedService {hosted-service-name} contains a VM {vm-name} with Data Disk {data-disk-name} whose physical blob size {size-of-the-vhd-blob-backing-the-data-disk} bytes does not match the VM Data Disk logical size {size-of-the-data-disk-specified-in-the-vm-api} bytes.</span></span> <span data-ttu-id="cf784-159">La migración continuará sin especificar un tamaño para el disco de datos de la máquina virtual de Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="cf784-159">Migration will proceed without specifying a size for the data disk for the Azure Resource Manager VM.</span></span> | <span data-ttu-id="cf784-160">Este error se produce si ha cambiado el tamaño del blob de disco duro virtual sin actualizar el tamaño en el modelo de la API de la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="cf784-160">This error happens if you've resized the VHD blob without updating the size in the VM API model.</span></span> <span data-ttu-id="cf784-161">[A continuación](#vm-with-data-disk-whose-physical-blob-size-bytes-does-not-match-the-vm-data-disk-logical-size-bytes), se describen los pasos de mitigación detallados.</span><span class="sxs-lookup"><span data-stu-id="cf784-161">Detailed mitigation steps are outlined [below](#vm-with-data-disk-whose-physical-blob-size-bytes-does-not-match-the-vm-data-disk-logical-size-bytes).</span></span>|
| <span data-ttu-id="cf784-162">Se produjo una excepción de almacenamiento durante la validación de datos de un disco {nombre de disco de datos} con el vínculo multimedia {URI de disco de datos} para la máquina virtual {nombre de máquina virtual} en el servicio en la nube {nombre del servicio en la nube}.</span><span class="sxs-lookup"><span data-stu-id="cf784-162">A storage exception occurred while validating data disk {data disk name} with media link {data disk Uri} for VM {VM name} in Cloud Service {Cloud Service name}.</span></span> <span data-ttu-id="cf784-163">Asegúrese de que esta máquina virtual puede acceder al vínculo de medios del VHD</span><span class="sxs-lookup"><span data-stu-id="cf784-163">Please ensure that the VHD media link is accessible for this virtual machine</span></span> | <span data-ttu-id="cf784-164">Este error puede ocurrir si los discos de la máquina virtual se han eliminado o ya no son accesibles.</span><span class="sxs-lookup"><span data-stu-id="cf784-164">This error can happen if the disks of the VM have been deleted or are not accessible anymore.</span></span> <span data-ttu-id="cf784-165">Asegúrese de que existan los discos de la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="cf784-165">Please make sure the disks for the VM exist.</span></span>|
| <span data-ttu-id="cf784-166">La máquina virtual {vm-name} de HostedService {cloud-service-name} contiene un disco con MediaLink {vhd-uri} que tiene un nombre de blob {vhd-blob-name} que no se admite en Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="cf784-166">VM {vm-name} in HostedService {cloud-service-name} contains Disk with MediaLink {vhd-uri} which has blob name {vhd-blob-name}  that is not supported in Azure Resource Manager.</span></span> | <span data-ttu-id="cf784-167">Este error se produce cuando el nombre del blob tiene un "/" que no admite actualmente el proveedor de recursos del proceso.</span><span class="sxs-lookup"><span data-stu-id="cf784-167">This error occurs when the name of the blob has a "/" in it which is not supported in Compute Resource Provider currently.</span></span> |
| <span data-ttu-id="cf784-168">No se permite la migración de la implementación {deployment-name} en HostedService {cloud-service-name} porque no se encuentra en el ámbito regional.</span><span class="sxs-lookup"><span data-stu-id="cf784-168">Migration is not allowed for Deployment {deployment-name} in HostedService {cloud-service-name} as it is not in the regional scope.</span></span> <span data-ttu-id="cf784-169">Vea http://aka.ms/regionalscope para mover esta implementación a un ámbito regional.</span><span class="sxs-lookup"><span data-stu-id="cf784-169">Please refer to http://aka.ms/regionalscope for moving this deployment to regional scope.</span></span> | <span data-ttu-id="cf784-170">En 2014, Azure anunció que los recursos de red se moverían de un ámbito de nivel de clúster a un ámbito regional.</span><span class="sxs-lookup"><span data-stu-id="cf784-170">In 2014, Azure announced that networking resources will move from a cluster level scope to regional scope.</span></span> <span data-ttu-id="cf784-171">Vea [http://aka.ms/regionalscope] para obtener más detalles (http://aka.ms/regionalscope).</span><span class="sxs-lookup"><span data-stu-id="cf784-171">See [http://aka.ms/regionalscope] for more details (http://aka.ms/regionalscope).</span></span> <span data-ttu-id="cf784-172">Este error se produce cuando en la implementación que se va a migrar no se ha realizado ninguna operación de actualización que la mueva automáticamente a un ámbito regional.</span><span class="sxs-lookup"><span data-stu-id="cf784-172">This error happens when the deployment being migrated has not had an update operation, which automatically moves it to a regional scope.</span></span> <span data-ttu-id="cf784-173">La mejor solución alternativa consiste en agregar un punto de conexión a una máquina virtual o un disco de datos a la máquina virtual y, después, volver a intentar la migración.</span><span class="sxs-lookup"><span data-stu-id="cf784-173">Best workaround is to either add an endpoint to a VM or a data disk to the VM and then retry migration.</span></span> <br> <span data-ttu-id="cf784-174">Vea [Configuración de puntos de conexión en una máquina virtual de Windows clásica en Azure](../articles/virtual-machines/windows/classic/setup-endpoints.md#create-an-endpoint) o [Conecte un disco de datos a una máquina virtual de Windows creada con el modelo de implementación clásica](../articles/virtual-machines/windows/classic/attach-disk.md).</span><span class="sxs-lookup"><span data-stu-id="cf784-174">See [How to set up endpoints on a classic Windows virtual machine in Azure](../articles/virtual-machines/windows/classic/setup-endpoints.md#create-an-endpoint) or [Attach a data disk to a Windows virtual machine created with the classic deployment model](../articles/virtual-machines/windows/classic/attach-disk.md)</span></span>|


## <a name="detailed-mitigations"></a><span data-ttu-id="cf784-175">Mitigaciones detalladas</span><span class="sxs-lookup"><span data-stu-id="cf784-175">Detailed mitigations</span></span>

### <a name="vm-with-data-disk-whose-physical-blob-size-bytes-does-not-match-the-vm-data-disk-logical-size-bytes"></a><span data-ttu-id="cf784-176">Máquina virtual con disco de datos cuyos bytes de tamaño de blob físico no coinciden con los del tamaño lógico del disco de datos de la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="cf784-176">VM with Data Disk whose physical blob size bytes does not match the VM Data Disk logical size bytes.</span></span>

<span data-ttu-id="cf784-177">Esto se produce cuando el tamaño lógico del disco de datos pueda desincronizarse con el tamaño real del blob de disco duro virtual.</span><span class="sxs-lookup"><span data-stu-id="cf784-177">This happens when the Data disk logical size can get out of sync with the actual VHD blob size.</span></span> <span data-ttu-id="cf784-178">Esto se puede comprobar fácilmente utilizando los comandos siguientes:</span><span class="sxs-lookup"><span data-stu-id="cf784-178">This can be easily verified using the following commands:</span></span>

#### <a name="verifying-the-issue"></a><span data-ttu-id="cf784-179">Comprobación del problema</span><span class="sxs-lookup"><span data-stu-id="cf784-179">Verifying the issue</span></span>

```PowerShell
# Store the VM details in the VM object
$vm = Get-AzureVM -ServiceName $servicename -Name $vmname

# Display the data disk properties
# NOTE the data disk LogicalDiskSizeInGB below which is 11GB. Also note the MediaLink Uri of the VHD blob as we'll use this in the next step
$vm.VM.DataVirtualHardDisks


HostCaching         : None
DiskLabel           : 
DiskName            : coreosvm-coreosvm-0-201611230636240687
Lun                 : 0
LogicalDiskSizeInGB : 11
MediaLink           : https://contosostorage.blob.core.windows.net/vhds/coreosvm-dd1.vhd
SourceMediaLink     : 
IOType              : Standard
ExtensionData       : 

# Now get the properties of the blob backing the data disk above
# NOTE the size of the blob is about 15 GB which is different from LogicalDiskSizeInGB above
$blob = Get-AzureStorageblob -Blob "coreosvm-dd1.vhd" -Container vhds 

$blob

ICloudBlob        : Microsoft.WindowsAzure.Storage.Blob.CloudPageBlob
BlobType          : PageBlob
Length            : 16106127872
ContentType       : application/octet-stream
LastModified      : 11/23/2016 7:16:22 AM +00:00
SnapshotTime      : 
ContinuationToken : 
Context           : Microsoft.WindowsAzure.Commands.Common.Storage.AzureStorageContext
Name              : coreosvm-dd1.vhd
```

#### <a name="mitigating-the-issue"></a><span data-ttu-id="cf784-180">Mitigación del problema</span><span class="sxs-lookup"><span data-stu-id="cf784-180">Mitigating the issue</span></span>

```PowerShell
# Convert the blob size in bytes to GB into a variable which we'll use later
$newSize = [int]($blob.Length / 1GB)

# See the calculated size in GB
$newSize

15

# Store the disk name of the data disk as we'll use this to identify the disk to be updated
$diskName = $vm.VM.DataVirtualHardDisks[0].DiskName

# Identify the LUN of the data disk to remove
$lunToRemove = $vm.VM.DataVirtualHardDisks[0].Lun

# Now remove the data disk from the VM so that the disk isn't leased by the VM and it's size can be updated
Remove-AzureDataDisk -LUN $lunToRemove -VM $vm | Update-AzureVm -Name $vmname -ServiceName $servicename

OperationDescription OperationId                          OperationStatus
-------------------- -----------                          ---------------
Update-AzureVM       213xx1-b44b-1v6n-23gg-591f2a13cd16   Succeeded  

# Verify we have the right disk that's going to be updated
Get-AzureDisk -DiskName $diskName

AffinityGroup        : 
AttachedTo           : 
IsCorrupted          : False
Label                : 
Location             : East US
DiskSizeInGB         : 11
MediaLink            : https://contosostorage.blob.core.windows.net/vhds/coreosvm-dd1.vhd
DiskName             : coreosvm-coreosvm-0-201611230636240687
SourceImageName      : 
OS                   : 
IOType               : Standard
OperationDescription : Get-AzureDisk
OperationId          : 0c56a2b7-a325-123b-7043-74c27d5a61fd
OperationStatus      : Succeeded

# Now update the disk to the new size
Update-AzureDisk -DiskName $diskName -ResizedSizeInGB $newSize -Label $diskName

OperationDescription OperationId                          OperationStatus
-------------------- -----------                          ---------------
Update-AzureDisk     cv134b65-1b6n-8908-abuo-ce9e395ac3e7 Succeeded 

# Now verify that the "DiskSizeInGB" property of the disk matches the size of the blob 
Get-AzureDisk -DiskName $diskName


AffinityGroup        : 
AttachedTo           : 
IsCorrupted          : False
Label                : coreosvm-coreosvm-0-201611230636240687
Location             : East US
DiskSizeInGB         : 15
MediaLink            : https://contosostorage.blob.core.windows.net/vhds/coreosvm-dd1.vhd
DiskName             : coreosvm-coreosvm-0-201611230636240687
SourceImageName      : 
OS                   : 
IOType               : Standard
OperationDescription : Get-AzureDisk
OperationId          : 1v53bde5-cv56-5621-9078-16b9c8a0bad2
OperationStatus      : Succeeded

# Now we'll add the disk back to the VM as a data disk. First we need to get an updated VM object
$vm = Get-AzureVM -ServiceName $servicename -Name $vmname

Add-AzureDataDisk -Import -DiskName $diskName -LUN 0 -VM $vm -HostCaching ReadWrite | Update-AzureVm -Name $vmname -ServiceName $servicename

OperationDescription OperationId                          OperationStatus
-------------------- -----------                          ---------------
Update-AzureVM       b0ad3d4c-4v68-45vb-xxc1-134fd010d0f8 Succeeded      
```

### <a name="moving-a-vm-to-a-different-subscription-after-completing-migration"></a><span data-ttu-id="cf784-181">Movimiento de una máquina virtual a una suscripción diferente tras completar una migración</span><span class="sxs-lookup"><span data-stu-id="cf784-181">Moving a VM to a different subscription after completing migration</span></span>

<span data-ttu-id="cf784-182">Después de completar el proceso de migración, puede que desee mover la máquina virtual a otra suscripción.</span><span class="sxs-lookup"><span data-stu-id="cf784-182">After you complete the migration process, you may want to move the VM to another subscription.</span></span> <span data-ttu-id="cf784-183">Sin embargo, si tiene un certificado de clave en la máquina virtual que hace referencia a un recurso de Key Vault, el movimiento actualmente no se admite.</span><span class="sxs-lookup"><span data-stu-id="cf784-183">However, if you have a secret/certificate on the VM that references a Key Vault resource, the move is currently not supported.</span></span> <span data-ttu-id="cf784-184">Estas instrucciones le permiten solucionar el problema.</span><span class="sxs-lookup"><span data-stu-id="cf784-184">The below instructions will allow you to workaround the issue.</span></span> 

#### <a name="powershell"></a><span data-ttu-id="cf784-185">PowerShell</span><span class="sxs-lookup"><span data-stu-id="cf784-185">PowerShell</span></span>
```powershell
$vm = Get-AzureRmVM -ResourceGroupName "MyRG" -Name "MyVM"
Remove-AzureRmVMSecret -VM $vm
Update-AzureRmVM -ResourceGroupName "MyRG" -VM $vm
```
#### <a name="azure-cli-20"></a><span data-ttu-id="cf784-186">CLI de Azure 2.0</span><span class="sxs-lookup"><span data-stu-id="cf784-186">Azure CLI 2.0</span></span>

```bash
az vm update -g "myrg" -n "myvm" --set osProfile.Secrets=[]
```

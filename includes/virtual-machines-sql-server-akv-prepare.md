## <a name="prepare-for-akv-integration"></a><span data-ttu-id="484fa-101">Preparación para la integración de AKV</span><span class="sxs-lookup"><span data-stu-id="484fa-101">Prepare for AKV Integration</span></span>
<span data-ttu-id="484fa-102">toouse tooconfigure de integración del almacén de claves de Azure la VM de SQL Server, hay varios requisitos previos:</span><span class="sxs-lookup"><span data-stu-id="484fa-102">toouse Azure Key Vault Integration tooconfigure your SQL Server VM, there are several prerequisites:</span></span> 

1. [<span data-ttu-id="484fa-103">Instalar Azure Powershell</span><span class="sxs-lookup"><span data-stu-id="484fa-103">Install Azure Powershell</span></span>](#install-azure-powershell)
2. [<span data-ttu-id="484fa-104">Crear un directorio de Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="484fa-104">Create an Azure Active Directory</span></span>](#create-an-azure-active-directory)
3. [<span data-ttu-id="484fa-105">Creación de un Almacén de claves</span><span class="sxs-lookup"><span data-stu-id="484fa-105">Create a key vault</span></span>](#create-a-key-vault)

<span data-ttu-id="484fa-106">Hello las secciones siguientes describen estos requisitos previos y la información de hello necesaria cmdlets de PowerShell de toocollect toolater ejecutar Hola.</span><span class="sxs-lookup"><span data-stu-id="484fa-106">hello following sections describe these prerequisites and hello information you need toocollect toolater run hello PowerShell cmdlets.</span></span>

### <a name="install-azure-powershell"></a><span data-ttu-id="484fa-107">Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="484fa-107">Install Azure PowerShell</span></span>
<span data-ttu-id="484fa-108">Asegúrese de que ha instalado Hola SDK más reciente de PowerShell de Azure.</span><span class="sxs-lookup"><span data-stu-id="484fa-108">Make sure you have installed hello latest Azure PowerShell SDK.</span></span> <span data-ttu-id="484fa-109">Para obtener más información, consulte [cómo tooinstall y configurar Azure PowerShell](/powershell/azureps-cmdlets-docs).</span><span class="sxs-lookup"><span data-stu-id="484fa-109">For more information, see [How tooinstall and configure Azure PowerShell](/powershell/azureps-cmdlets-docs).</span></span>

### <a name="create-an-azure-active-directory"></a><span data-ttu-id="484fa-110">Crear un directorio de Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="484fa-110">Create an Azure Active Directory</span></span>
<span data-ttu-id="484fa-111">En primer lugar, debe toohave una [Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) en su suscripción.</span><span class="sxs-lookup"><span data-stu-id="484fa-111">First, you need toohave an [Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) in your subscription.</span></span> <span data-ttu-id="484fa-112">Entre muchas ventajas, esto le permite almacén de claves de tooyour de permiso y toogrant para determinados usuarios y aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="484fa-112">Among many benefits, this allows you toogrant permission tooyour key vault for certain users and applications.</span></span>

<span data-ttu-id="484fa-113">A continuación, registre una aplicación con AAD.</span><span class="sxs-lookup"><span data-stu-id="484fa-113">Next, register an application with AAD.</span></span> <span data-ttu-id="484fa-114">Esto le dará una cuenta de entidad de servicio que tenga acceso tooyour almacén de claves que se necesita la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="484fa-114">This will give you a Service Principal account that has access tooyour key vault which your VM will need.</span></span> <span data-ttu-id="484fa-115">En el artículo de almacén de claves de Azure de hello, puede encontrar estos pasos en hello [registrar una aplicación con Azure Active Directory](../articles/key-vault/key-vault-get-started.md#register) sección, también puede ver pasos Hola con capturas de pantalla de hello **obtener una identidad de aplicación hello sección** de [esta entrada de blog](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span><span class="sxs-lookup"><span data-stu-id="484fa-115">In hello Azure Key Vault article, you can find these steps in hello [Register an application with Azure Active Directory](../articles/key-vault/key-vault-get-started.md#register) section, or you can see hello steps with screen shots in hello **Get an identity for hello application section** of [this blog post](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span></span> <span data-ttu-id="484fa-116">Antes de completar estos pasos, tenga en cuenta que debe hello toocollect siguiente información durante este registro que se necesita más adelante cuando se habilita la integración de almacén de claves de Azure en la VM de SQL.</span><span class="sxs-lookup"><span data-stu-id="484fa-116">Before completing these steps, note that you need toocollect hello following information during this registration that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

* <span data-ttu-id="484fa-117">Después de agrega la aplicación hello, encontrar Hola **Id. de cliente** en hello **configurar** ficha.   ![Identificador de cliente de Azure Active Directory](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span><span class="sxs-lookup"><span data-stu-id="484fa-117">After hello application is added, find hello **CLIENT ID**  on hello **CONFIGURE** tab.   ![Azure Active Directory Client ID](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span></span>
  
    <span data-ttu-id="484fa-118">se asigna el identificador de cliente de Hello toohello posterior **$spName** parámetro (nombre Principal de servicio) en tooenable de secuencia de comandos de PowerShell de hello integración del almacén de claves de Azure.</span><span class="sxs-lookup"><span data-stu-id="484fa-118">hello client ID is assigned later toohello **$spName** (Service Principal name) parameter in hello PowerShell script tooenable Azure Key Vault Integration.</span></span> 
* <span data-ttu-id="484fa-119">Además, durante estos pasos cuando se crea la clave, copiar Hola el secreto para su clave tal y como se muestra en la siguiente captura de pantalla de Hola.</span><span class="sxs-lookup"><span data-stu-id="484fa-119">Also, during these steps when you create your key, copy hello secret for your key as is shown in hello following screenshot.</span></span> <span data-ttu-id="484fa-120">Esta clave secreta se asigna una versión posterior toohello **$spSecret** parámetro (secreto Principal de servicio) en la secuencia de comandos de PowerShell de Hola.</span><span class="sxs-lookup"><span data-stu-id="484fa-120">This key secret is assigned later toohello **$spSecret** (Service Principal secret) parameter in hello PowerShell script.</span></span>  
    <span data-ttu-id="484fa-121">![Secreto de Azure Active Directory](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span><span class="sxs-lookup"><span data-stu-id="484fa-121">![Azure Active Directory Secret](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span></span>
* <span data-ttu-id="484fa-122">Debe autorizar este nuevo Hola de toohave de Id. de cliente los siguientes permisos de acceso: **cifrar**, **descifrar**, **wrapKey**, **unwrapKey**, **inicio de sesión**, y **comprobar**.</span><span class="sxs-lookup"><span data-stu-id="484fa-122">You must authorize this new client ID toohave hello following access permissions: **encrypt**, **decrypt**, **wrapKey**, **unwrapKey**, **sign**, and **verify**.</span></span> <span data-ttu-id="484fa-123">Esto se hace con hello [Set-AzureRmKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) cmdlet.</span><span class="sxs-lookup"><span data-stu-id="484fa-123">This is done with hello [Set-AzureRmKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) cmdlet.</span></span> <span data-ttu-id="484fa-124">Para obtener más información, consulte [Authorize Hola aplicación toouse Hola clave o el secreto](../articles/key-vault/key-vault-get-started.md#authorize).</span><span class="sxs-lookup"><span data-stu-id="484fa-124">For more information see [Authorize hello application toouse hello key or secret](../articles/key-vault/key-vault-get-started.md#authorize).</span></span>

### <a name="create-a-key-vault"></a><span data-ttu-id="484fa-125">Creación de un Almacén de claves</span><span class="sxs-lookup"><span data-stu-id="484fa-125">Create a key vault</span></span>
<span data-ttu-id="484fa-126">En toouse el almacén de claves de Azure toostore hello las claves de ordenación que va a utilizar para el cifrado en la máquina virtual, es necesario el almacén de claves de acceso tooa.</span><span class="sxs-lookup"><span data-stu-id="484fa-126">In order toouse Azure Key Vault toostore hello keys you will use for encryption in your VM, you need access tooa key vault.</span></span> <span data-ttu-id="484fa-127">Si aún no ha establecido su almacén de claves, cree una siguiendo los pasos de Hola Hola [Introducción al almacén de claves de Azure](../articles/key-vault/key-vault-get-started.md) tema.</span><span class="sxs-lookup"><span data-stu-id="484fa-127">If you have not already set up your key vault, create one by following hello steps in hello [Getting Started with Azure Key Vault](../articles/key-vault/key-vault-get-started.md) topic.</span></span> <span data-ttu-id="484fa-128">Antes de completar estos pasos, tenga en cuenta que hay alguna información que necesita toocollect durante esta configuración que se necesita más adelante cuando se habilita la integración de almacén de claves de Azure en la VM de SQL.</span><span class="sxs-lookup"><span data-stu-id="484fa-128">Before completing these steps, note that there is some information you need toocollect during this set up that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

<span data-ttu-id="484fa-129">Al obtener toohello crear un paso de almacén de claves, Hola Nota devuelve **vaultUri** propiedad, que es la dirección URL del almacén de claves de Hola.</span><span class="sxs-lookup"><span data-stu-id="484fa-129">When you get toohello Create a key vault step, note hello returned **vaultUri** property, which is hello key vault URL.</span></span> <span data-ttu-id="484fa-130">En el ejemplo de Hola incluido en este paso, que se muestra a continuación, nombre de almacén de claves de hello es ContosoKeyVault, por lo tanto, dirección URL de almacén de claves de hello sería https://contosokeyvault.vault.azure.net/.</span><span class="sxs-lookup"><span data-stu-id="484fa-130">In hello example provided in that step, shown below, hello key vault name is ContosoKeyVault, therefore hello key vault URL would be https://contosokeyvault.vault.azure.net/.</span></span>

    New-AzureRmKeyVault -VaultName 'ContosoKeyVault' -ResourceGroupName 'ContosoResourceGroup' -Location 'East Asia'

<span data-ttu-id="484fa-131">dirección URL del almacén de claves de Hola se asigna posterior toohello **$akvURL** parámetro en tooenable de secuencia de comandos de PowerShell de hello integración del almacén de claves de Azure.</span><span class="sxs-lookup"><span data-stu-id="484fa-131">hello key vault URL is assigned later toohello **$akvURL** parameter in hello PowerShell script tooenable Azure Key Vault Integration.</span></span>


<span data-ttu-id="30649-101">Si la máquina virtual de Azure se encuentra un error de disco o de arranque, deberá realizar los pasos para solucionar problemas en el propio disco duro virtual.</span><span class="sxs-lookup"><span data-stu-id="30649-101">If your virtual machine (VM) in Azure encounters a boot or disk error, you may need to perform troubleshooting steps on the virtual hard disk itself.</span></span> <span data-ttu-id="30649-102">Un ejemplo habitual sería una actualización de aplicación con error que impide que la máquina virtual pueda arrancar correctamente.</span><span class="sxs-lookup"><span data-stu-id="30649-102">A common example would be a failed application update that prevents the VM from booting successfully.</span></span> <span data-ttu-id="30649-103">En este artículo se describe cómo utilizar Azure Portal para conectar el disco duro virtual a otra máquina virtual para solucionar errores y, posteriormente, volver a crear la máquina virtual original.</span><span class="sxs-lookup"><span data-stu-id="30649-103">This article describes how to use Azure portal to connect your virtual hard disk to another VM to fix any errors and then re-create your original VM.</span></span>

## <a name="recovery-process-overview"></a><span data-ttu-id="30649-104">Introducción al proceso de recuperación</span><span class="sxs-lookup"><span data-stu-id="30649-104">Recovery process overview</span></span>
<span data-ttu-id="30649-105">El proceso de solución de problemas es el siguiente:</span><span class="sxs-lookup"><span data-stu-id="30649-105">The troubleshooting process is as follows:</span></span>

1. <span data-ttu-id="30649-106">Elimine la máquina virtual que tiene problemas pero conserve los discos duros virtuales.</span><span class="sxs-lookup"><span data-stu-id="30649-106">Delete the VM that's encountering issues, but retain the virtual hard disks.</span></span>
2. <span data-ttu-id="30649-107">Asocie y monte el disco duro virtual en otra máquina virtual con el fin de solucionar problemas.</span><span class="sxs-lookup"><span data-stu-id="30649-107">Attach and mount the virtual hard disk to another VM for troubleshooting.</span></span>
3. <span data-ttu-id="30649-108">Conéctese a la máquina virtual de solución de problemas.</span><span class="sxs-lookup"><span data-stu-id="30649-108">Connect to the troubleshooting VM.</span></span> <span data-ttu-id="30649-109">Edite los archivos o ejecute las herramientas necesarias para solucionar los problemas del disco duro virtual original.</span><span class="sxs-lookup"><span data-stu-id="30649-109">Edit files or run tools to fix errors on the original virtual hard disk.</span></span>
4. <span data-ttu-id="30649-110">Desmonte y desconecte el disco duro virtual de la máquina virtual de solución de problemas.</span><span class="sxs-lookup"><span data-stu-id="30649-110">Unmount and detach the virtual hard disk from the troubleshooting VM.</span></span>
5. <span data-ttu-id="30649-111">Cree una máquina virtual mediante el disco duro virtual original.</span><span class="sxs-lookup"><span data-stu-id="30649-111">Create a VM by using the original virtual hard disk.</span></span>

## <a name="delete-the-original-vm"></a><span data-ttu-id="30649-112">Eliminación de la máquina virtual original</span><span class="sxs-lookup"><span data-stu-id="30649-112">Delete the original VM</span></span>
<span data-ttu-id="30649-113">Los discos duros virtuales y las máquinas virtuales son dos recursos diferentes de Azure.</span><span class="sxs-lookup"><span data-stu-id="30649-113">Virtual hard disks and VMs are two distinct resources in Azure.</span></span> <span data-ttu-id="30649-114">Un disco duro virtual es el recurso donde se almacenan el sistema operativo, las aplicaciones y las configuraciones.</span><span class="sxs-lookup"><span data-stu-id="30649-114">A virtual hard disk is where the operating system, applications, and configurations are stored.</span></span> <span data-ttu-id="30649-115">La máquina virtual consiste solo en metadatos que definen el tamaño o la ubicación y que hacen referencia a recursos tales como un disco duro virtual o una tarjeta de interfaz de red virtual (NIC).</span><span class="sxs-lookup"><span data-stu-id="30649-115">The VM is just metadata that defines the size or location and that references resources such as a virtual hard disk or virtual network interface card (NIC).</span></span> <span data-ttu-id="30649-116">Cada disco duro virtual obtiene una concesión que se le asigna cuando se asocia a una máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="30649-116">Each virtual hard disk gets a lease assigned when that disk is attached to a VM.</span></span> <span data-ttu-id="30649-117">Aunque los discos de datos se pueden conectar y desconectar incluso mientras se está ejecutando la máquina virtual, no se puede desasociar el disco del sistema operativo, a menos que se elimine el recurso de máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="30649-117">Although data disks can be attached and detached even while the VM is running, the OS disk cannot be detached unless the VM resource is deleted.</span></span> <span data-ttu-id="30649-118">La concesión continúa para asociar el disco del sistema operativo a una máquina virtual incluso cuando esa máquina virtual está en un estado detenido o desasignado.</span><span class="sxs-lookup"><span data-stu-id="30649-118">The lease continues to associate the OS disk to a VM even when that VM is in a stopped and deallocated state.</span></span>

<span data-ttu-id="30649-119">El primer paso para recuperar la máquina virtual es eliminar el propio recurso de máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="30649-119">The first step to recovering your VM is to delete the VM resource itself.</span></span> <span data-ttu-id="30649-120">Al eliminar la máquina virtual, los discos duros virtuales se dejan en su cuenta de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="30649-120">Deleting the VM leaves the virtual hard disks in your storage account.</span></span> <span data-ttu-id="30649-121">Después de eliminar la máquina virtual, puede asociar el disco duro virtual a otra máquina virtual para localizar y solucionar los errores.</span><span class="sxs-lookup"><span data-stu-id="30649-121">After the VM is deleted, you can attach the virtual hard disk to another VM to troubleshoot and resolve the errors.</span></span> 

1. <span data-ttu-id="30649-122">Inicie sesión en el [Portal de Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="30649-122">Sign in to the [Azure portal](https://portal.azure.com).</span></span> 
2. <span data-ttu-id="30649-123">En el menú de la izquierda, haga clic en **Virtual Machines**.</span><span class="sxs-lookup"><span data-stu-id="30649-123">On the menu on the left side, click **Virtual Machines (classic)**.</span></span>
3. <span data-ttu-id="30649-124">Seleccione la máquina virtual que tiene el problema, haga clic en **Discos** y, a continuación, identifique el nombre del disco duro virtual.</span><span class="sxs-lookup"><span data-stu-id="30649-124">Select the VM that has the problem, click **Disks**, and then identify the name of the virtual hard disk.</span></span> 
4. <span data-ttu-id="30649-125">Seleccione el disco duro virtual del sistema operativo y compruebe la **Ubicación** para identificar la cuenta de almacenamiento que contiene este disco duro virtual.</span><span class="sxs-lookup"><span data-stu-id="30649-125">Select the OS virtual hard disk and check the **Location** to identify the storage account that contains that virtual hard disk.</span></span> <span data-ttu-id="30649-126">En el ejemplo siguiente, la cadena inmediatamente antes de ".blob.core.windows.net" es el nombre de la cuenta de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="30649-126">In the following example, the string immediately before ".blob.core.windows.net" is the storage account name.</span></span>

    ```
    https://portalvhds73fmhrw5xkp43.blob.core.windows.net/vhds/SCCM2012-2015-08-28.vhd
    ```

    ![Imagen sobre la ubicación de la máquina virtual](./media/virtual-machines-classic-recovery-disks-portal/vm-location.png)

5. <span data-ttu-id="30649-128">Haga clic con el botón derecho en la máquina virtual y, a continuación, seleccione **Eliminar**.</span><span class="sxs-lookup"><span data-stu-id="30649-128">Right-click the VM and then select **Delete**.</span></span> <span data-ttu-id="30649-129">Asegúrese de que los discos no estén seleccionados cuando elimine la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="30649-129">Make sure that the disks are not selected when you delete the VM.</span></span>
6. <span data-ttu-id="30649-130">Cree una nueva máquina virtual de recuperación.</span><span class="sxs-lookup"><span data-stu-id="30649-130">Create a new recovery VM.</span></span> <span data-ttu-id="30649-131">Esta máquina virtual debe estar en la misma región y grupo de recursos (servicio en la nube) que la máquina virtual que tiene problemas.</span><span class="sxs-lookup"><span data-stu-id="30649-131">This VM must be in the same region and resource group (Cloud Service) as the problem VM.</span></span>
7. <span data-ttu-id="30649-132">Seleccione la máquina virtual de recuperación y, a continuación, seleccione **Discos** > **Asociar existente**.</span><span class="sxs-lookup"><span data-stu-id="30649-132">Select the recovery VM, and then select **Disks** > **Attach Existing**.</span></span>
8. <span data-ttu-id="30649-133">Para seleccionar el disco duro virtual existente, haga clic en **Archivo VHD**:</span><span class="sxs-lookup"><span data-stu-id="30649-133">To select your existing virtual hard disk, click **VHD File**:</span></span>

    ![Busque el disco duro virtual existente.](./media/virtual-machines-classic-recovery-disks-portal/select-vhd-location.png)

9. <span data-ttu-id="30649-135">Seleccione la cuenta de almacenamiento, el contenedor de discos duros virtuales y el disco duro virtual, y haga clic en el botón **Seleccionar** para confirmar su elección.</span><span class="sxs-lookup"><span data-stu-id="30649-135">Select the storage account > VHD container > the virtual hard disk, click the **Select** button to confirm your choice.</span></span>

    ![Seleccione el disco duro virtual existente](./media/virtual-machines-classic-recovery-disks-portal/select-vhd.png)

10. <span data-ttu-id="30649-137">Con el disco duro virtual ya seleccionado, haga clic en **Aceptar** para asociar el disco duro virtual existente.</span><span class="sxs-lookup"><span data-stu-id="30649-137">With your VHD now selected, select **OK** to attach the existing virtual hard disk.</span></span>
11. <span data-ttu-id="30649-138">Después de unos segundos, el panel **Discos** de la máquina virtual mostrará el disco duro virtual existente conectado como un disco de datos:</span><span class="sxs-lookup"><span data-stu-id="30649-138">After a few seconds, the **Disks** pane for your VM will display your existing virtual hard disk connected as a data disk:</span></span>

    ![Disco duro virtual existente conectado como disco de datos](./media/virtual-machines-classic-recovery-disks-portal/attached-disk.png)

## <a name="fix-issues-on-the-original-virtual-hard-disk"></a><span data-ttu-id="30649-140">Solución de problemas en el disco duro virtual original</span><span class="sxs-lookup"><span data-stu-id="30649-140">Fix issues on the original virtual hard disk</span></span>
<span data-ttu-id="30649-141">Con el disco duro virtual existente montado, ahora puede realizar todos los pasos de mantenimiento y solución de problemas según sea necesario.</span><span class="sxs-lookup"><span data-stu-id="30649-141">When the existing virtual hard disk is mounted, you can now perform any maintenance and troubleshooting steps as needed.</span></span> <span data-ttu-id="30649-142">Una vez que se han resuelto los problemas, continúe con los pasos siguientes.</span><span class="sxs-lookup"><span data-stu-id="30649-142">Once you have addressed the issues, continue with the following steps.</span></span>

## <a name="unmount-and-detach-the-original-virtual-hard-disk"></a><span data-ttu-id="30649-143">Desmontaje y desasociación del disco duro virtual original</span><span class="sxs-lookup"><span data-stu-id="30649-143">Unmount and detach the original virtual hard disk</span></span>
<span data-ttu-id="30649-144">Una vez resueltos los errores, desmonte y desasocie el disco duro virtual existente de la máquina virtual de solución de problemas.</span><span class="sxs-lookup"><span data-stu-id="30649-144">Once any errors are resolved, unmount and detach the existing virtual hard disk from your troubleshooting VM.</span></span> <span data-ttu-id="30649-145">No se podrá usar el disco duro virtual con ninguna otra máquina virtual hasta que se libere la concesión que asocia el disco duro virtual a la máquina virtual de solución de problemas.</span><span class="sxs-lookup"><span data-stu-id="30649-145">You cannot use your virtual hard disk together with any other VM until the lease that attaches the virtual hard disk to the troubleshooting VM is released.</span></span>  

1. <span data-ttu-id="30649-146">Inicie sesión en el [Portal de Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="30649-146">Sign in to the [Azure portal](https://portal.azure.com).</span></span> 
2. <span data-ttu-id="30649-147">En el menú de la izquierda, haga clic en **Virtual Machines (clásico)**.</span><span class="sxs-lookup"><span data-stu-id="30649-147">On the menu on the left side, select **Virtual Machines (classic)**.</span></span>
3. <span data-ttu-id="30649-148">Busque la máquina virtual de recuperación.</span><span class="sxs-lookup"><span data-stu-id="30649-148">Locate the recovery VM.</span></span> <span data-ttu-id="30649-149">Seleccione Discos, haga clic con el botón derecho en el disco y, a continuación, seleccione **Desasociar**.</span><span class="sxs-lookup"><span data-stu-id="30649-149">Select Disks, right-click the disk, and then select **Detach**.</span></span>

## <a name="create-a-vm-from-the-original-hard-disk"></a><span data-ttu-id="30649-150">Creación de una máquina virtual a partir del disco duro original</span><span class="sxs-lookup"><span data-stu-id="30649-150">Create a VM from the original hard disk</span></span>

<span data-ttu-id="30649-151">Para crear una máquina virtual a partir del disco duro virtual original, utilice el [Portal de Azure clásico](https://manage.windowsazure.com).</span><span class="sxs-lookup"><span data-stu-id="30649-151">To create a VM from your original virtual hard disk, use [Azure classic portal](https://manage.windowsazure.com).</span></span>

1. <span data-ttu-id="30649-152">Inicie sesión en el [Portal de Azure clásico](https://manage.windowsazure.com).</span><span class="sxs-lookup"><span data-stu-id="30649-152">Sign into [Azure classic portal](https://manage.windowsazure.com).</span></span>
2. <span data-ttu-id="30649-153">En la parte inferior del portal, seleccione **Nuevo** > **Proceso** > **Máquina virtual** > **De la galería**.</span><span class="sxs-lookup"><span data-stu-id="30649-153">At the bottom of the portal, select **New** > **Compute** > **Virtual Machine** > **From Gallery**.</span></span>
3. <span data-ttu-id="30649-154">En la sección **Elija una imagen**, seleccione **Mis discos** y seleccione el disco duro virtual original.</span><span class="sxs-lookup"><span data-stu-id="30649-154">In the **Choose an Image** section, select **My disks**, and then select the original virtual hard disk.</span></span> <span data-ttu-id="30649-155">Compruebe la información de ubicación.</span><span class="sxs-lookup"><span data-stu-id="30649-155">Check the location information.</span></span> <span data-ttu-id="30649-156">Esta es la región donde se debe implementar la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="30649-156">This is the region where the VM must be deployed.</span></span> <span data-ttu-id="30649-157">Seleccione el botón Siguiente.</span><span class="sxs-lookup"><span data-stu-id="30649-157">Select the next button.</span></span>
4. <span data-ttu-id="30649-158">En la sección **Configuración de la máquina virtual**, escriba el nombre de la máquina virtual y seleccione un tamaño.</span><span class="sxs-lookup"><span data-stu-id="30649-158">In the **Virtual machine configuration** section, type the VM name and select a size for the VM.</span></span>
# <a name="securing-docker-containers-in-azure-container-service"></a><span data-ttu-id="682a3-101">Protección de contenedores de Docker en Azure Container Service</span><span class="sxs-lookup"><span data-stu-id="682a3-101">Securing Docker containers in Azure Container Service</span></span>

<span data-ttu-id="682a3-102">Este artículo presenta consideraciones y recomendaciones para proteger los contenedores de Docker implementados en Azure Container Service.</span><span class="sxs-lookup"><span data-stu-id="682a3-102">This article introduces considerations and recommendations for securing Docker containers deployed in Azure Container Service.</span></span> <span data-ttu-id="682a3-103">Muchas de estas consideraciones se aplican generalmente a los contenedores de Docker implementados en Azure o en otros entornos.</span><span class="sxs-lookup"><span data-stu-id="682a3-103">Many of these considerations apply generally to Docker containers deployed in Azure or other environments.</span></span> 

## <a name="image-security"></a><span data-ttu-id="682a3-104">Seguridad de imágenes</span><span class="sxs-lookup"><span data-stu-id="682a3-104">Image security</span></span>

<span data-ttu-id="682a3-105">Los contenedores se crean a partir de imágenes que están almacenadas en uno o varios repositorios.</span><span class="sxs-lookup"><span data-stu-id="682a3-105">Containers are built from images that are stored in one or more repositories.</span></span> <span data-ttu-id="682a3-106">Estos repositorios pueden pertenecer a registros de contenedores públicos o privados.</span><span class="sxs-lookup"><span data-stu-id="682a3-106">These repositories can belong to public or private container registries.</span></span> <span data-ttu-id="682a3-107">Un ejemplo de un registro público es [Docker Hub](https://hub.docker.com/).</span><span class="sxs-lookup"><span data-stu-id="682a3-107">An example of a public registry is [Docker Hub](https://hub.docker.com/).</span></span> <span data-ttu-id="682a3-108">Un ejemplo de un registro privado es el [Registro de confianza de Docker](https://docs.docker.com/datacenter/dtr/2.0/), que puede instalarse de forma local o en una nube privada virtual.</span><span class="sxs-lookup"><span data-stu-id="682a3-108">An example of a private registry is the [Docker Trusted Registry](https://docs.docker.com/datacenter/dtr/2.0/), which can be installed on-premises or in a virtual private cloud.</span></span> <span data-ttu-id="682a3-109">También hay servicios de registro privado de contenedores basados en la nube, incluido [Azure Container Registry](../articles/container-registry/container-registry-intro.md).</span><span class="sxs-lookup"><span data-stu-id="682a3-109">There are also cloud-based private container registry services including [Azure Container Registry](../articles/container-registry/container-registry-intro.md).</span></span>

### <a name="public-and-private-images"></a><span data-ttu-id="682a3-110">Imágenes públicas y privadas</span><span class="sxs-lookup"><span data-stu-id="682a3-110">Public and private images</span></span>
<span data-ttu-id="682a3-111">En general, al igual que con cualquier paquete de software publicado de forma pública, una imagen de contenedor disponible públicamente no garantiza la seguridad.</span><span class="sxs-lookup"><span data-stu-id="682a3-111">In general, as with any publicly published software package, a publicly available container image does not guarantee security.</span></span> <span data-ttu-id="682a3-112">Las imágenes de contenedor constan de varias capas de software, y cada capa de software podría tener vulnerabilidades.</span><span class="sxs-lookup"><span data-stu-id="682a3-112">Container images consist of multiple software layers, and each software layer could have vulnerabilities.</span></span> <span data-ttu-id="682a3-113">Es esencial entender el origen de la imagen de contenedor, incluido el propietario de la imagen (para determinar si se trata de una fuente de confianza o no), las capas de software de las que consta y las versiones del software.</span><span class="sxs-lookup"><span data-stu-id="682a3-113">It is key to understand the origin of the container image, including the owner of the image (to determine if it is a reliable source or not), the software layers it consists of, and the software versions.</span></span> 

<span data-ttu-id="682a3-114">Por ejemplo, si va al [repositorio nginx](https://hub.docker.com/_/nginx/) oficial en el Centro de Docker y navega hasta la pestaña **Etiquetas**, verá las vulnerabilidades codificadas por colores en cada imagen.</span><span class="sxs-lookup"><span data-stu-id="682a3-114">For example, if you go to the official [nginx repository](https://hub.docker.com/_/nginx/) in Docker Hub and navigate to the **Tags** tab, you see color-coded vulnerabilities in each image.</span></span> <span data-ttu-id="682a3-115">Cada color representa la vulnerabilidad de una capa de software de la imagen.</span><span class="sxs-lookup"><span data-stu-id="682a3-115">Each color depicts the vulnerability of a software layer of the image.</span></span> <span data-ttu-id="682a3-116">Para más información sobre el examen de vulnerabilidades en el Centro de Docker, consulte [Descripción de los repositorios oficiales en el Centro de Docker](https://blog.docker.com/2015/06/understanding-official-repos-docker-hub/).</span><span class="sxs-lookup"><span data-stu-id="682a3-116">For more about vulnerability scanning in Docker Hub, see [Understanding official repos on Docker Hub](https://blog.docker.com/2015/06/understanding-official-repos-docker-hub/).</span></span>

![Imágenes nginx en el Centro de Docker](./media/container-service-security/docker-hub-nginx.png)

<span data-ttu-id="682a3-118">Las empresas ponen especial cuidado a la seguridad y para protegerse contra los ataques de seguridad deben almacenar y recuperar las imágenes de un registro privado, como Azure Container Registry o el Registro de confianza de Docker.</span><span class="sxs-lookup"><span data-stu-id="682a3-118">Enterprises care deeply about security, and to protect themselves from security attack should store and retrieve images from a private registry, such as Azure Container Registry or Docker Trusted Registry.</span></span> <span data-ttu-id="682a3-119">Además de proporcionar un registro privado administrado, Azure Container Registry admite [autenticación basada en la entidad de servicio](../articles/container-registry/container-registry-authentication.md) a través de Azure Active Directory para los flujos de autenticación básica, incluido el acceso basado en roles para permisos de solo lectura, escritura y propietario.</span><span class="sxs-lookup"><span data-stu-id="682a3-119">In addition to providing a managed private registry, Azure Container Registry supports [service principal-based authentication](../articles/container-registry/container-registry-authentication.md) through Azure Active Directory for basic authentication flows, including role-based access for read-only, write, and owner permissions.</span></span>

### <a name="image-security-scanning"></a><span data-ttu-id="682a3-120">Examen de seguridad de imágenes</span><span class="sxs-lookup"><span data-stu-id="682a3-120">Image security scanning</span></span>

<span data-ttu-id="682a3-121">Incluso cuando se usa un registro privado, es una buena idea usar soluciones de examen de imágenes para la validación de seguridad adicional.</span><span class="sxs-lookup"><span data-stu-id="682a3-121">Even when using a private registry, it is a good idea to use image scanning solutions for additional security validation.</span></span> <span data-ttu-id="682a3-122">Cada capa de software en una imagen de contenedor es potencialmente susceptible a vulnerabilidades independiente del resto de niveles en la imagen de contenedor.</span><span class="sxs-lookup"><span data-stu-id="682a3-122">Each software layer in a container image is potentially prone to vulnerabilities independent of other layers in the container image.</span></span> <span data-ttu-id="682a3-123">A medida que cada vez más empresas empiezan a implementar sus cargas de trabajo de producción que se basan en tecnologías de contenedor, el examen de las imágenes adquiere importancia para asegurarse de prevenir amenazas a la seguridad en sus organizaciones.</span><span class="sxs-lookup"><span data-stu-id="682a3-123">As increasingly companies start deploying their production workloads based on container technologies, image scanning becomes important to ensure prevention of security threats against their organizations.</span></span> 

<span data-ttu-id="682a3-124">Las soluciones de supervisión y análisis de seguridad, como [Twistlock](https://www.twistlock.com/2016/11/07/twistlock-supports-azure-container-registry) y [Aqua Security](http://blog.aquasec.com/image-vulnerability-scanning-in-azure-container-registry), entre otros, se pueden utilizar para examinar imágenes de contenedor en un registro privado e identificar posibles vulnerabilidades.</span><span class="sxs-lookup"><span data-stu-id="682a3-124">Security monitoring and scanning solutions such as [Twistlock](https://www.twistlock.com/2016/11/07/twistlock-supports-azure-container-registry) and [Aqua Security](http://blog.aquasec.com/image-vulnerability-scanning-in-azure-container-registry), among others, can be used to scan container images in a private registry and identify potential vulnerabilities.</span></span> <span data-ttu-id="682a3-125">Es importante comprender la profundidad del análisis que proporcionan las distintas soluciones.</span><span class="sxs-lookup"><span data-stu-id="682a3-125">It is important to understand the depth of scanning that the different solutions provide.</span></span> <span data-ttu-id="682a3-126">Por ejemplo, algunas soluciones podrían verificar las capas de imagen en comparación con vulnerabilidades conocidas.</span><span class="sxs-lookup"><span data-stu-id="682a3-126">For example, some solutions might only cross-verify image layers against known vulnerabilities.</span></span> <span data-ttu-id="682a3-127">Es posible que estas soluciones no logren verificar software con capas de imágenes creado mediante cierto software de administración de paquetes.</span><span class="sxs-lookup"><span data-stu-id="682a3-127">These solutions might not be able to verify image-layer software built through certain package manager software.</span></span> <span data-ttu-id="682a3-128">Otras soluciones tienen una integración del análisis más profunda y pueden encontrar vulnerabilidades en cualquier software empaquetado.</span><span class="sxs-lookup"><span data-stu-id="682a3-128">Other solutions have deeper scanning integration and can find vulnerabilities in any packaged software.</span></span>

### <a name="production-deployment-rules-and-audit"></a><span data-ttu-id="682a3-129">Auditoría y reglas de implementación de producción</span><span class="sxs-lookup"><span data-stu-id="682a3-129">Production deployment rules and audit</span></span>
<span data-ttu-id="682a3-130">Una vez que una aplicación se implementa en producción, es esencial establecer algunas reglas para asegurarse de que las imágenes que se utilizan en entornos de producción sean seguras y no contengan ninguna vulnerabilidad.</span><span class="sxs-lookup"><span data-stu-id="682a3-130">Once an application is deployed in production, it is essential to set a few rules to ensure that images used in production environments are secure and contain no vulnerabilities.</span></span>

* <span data-ttu-id="682a3-131">Como regla, las imágenes con vulnerabilidades, incluso menores, no debe permitirse que se ejecuten en un entorno de producción.</span><span class="sxs-lookup"><span data-stu-id="682a3-131">As a rule, images with vulnerabilities, even minor, should not be allowed to run in a production environment.</span></span> <span data-ttu-id="682a3-132">Además, lo ideal es que todas las imágenes implementadas en producción se guarden en un registro privado donde solo algunas personas específicas tengan acceso.</span><span class="sxs-lookup"><span data-stu-id="682a3-132">In addition, all images deployed in production should ideally be saved in a private registry accessible to a select few.</span></span> <span data-ttu-id="682a3-133">También es importante mantener un número pequeño de imágenes de producción para asegurarse de que se puedan administrar eficazmente.</span><span class="sxs-lookup"><span data-stu-id="682a3-133">It is also important to keep the number of production images small to ensure that they can be managed effectively.</span></span>

* <span data-ttu-id="682a3-134">Puesto que es difícil identificar el origen del software desde una imagen de contenedor disponible públicamente, es una buena práctica crear imágenes desde la fuente para garantizar el conocimiento del origen de la capa.</span><span class="sxs-lookup"><span data-stu-id="682a3-134">Since it is hard to pinpoint the origin of software from a publicly available container image, it is a good practice to build images from source to ensure knowledge of the origin of the layer.</span></span> <span data-ttu-id="682a3-135">Cuando surge una vulnerabilidad en una imagen de contenedor generada automáticamente, los clientes pueden encontrar una ruta más rápida a una resolución.</span><span class="sxs-lookup"><span data-stu-id="682a3-135">When a vulnerability surfaces in a self-built container image, customers can find a quicker path to a resolution.</span></span> <span data-ttu-id="682a3-136">Con una imagen pública, los clientes tendrían que encontrar la raíz de una imagen pública para corregirla u obtener otra imagen segura del publicador.</span><span class="sxs-lookup"><span data-stu-id="682a3-136">With a public image, customers would need to find the root of a public image to fix it or obtain another secure image from the publisher.</span></span>

* <span data-ttu-id="682a3-137">No se garantiza que una imagen digitalizada exhaustivamente implementada en producción esté actualizada para la duración de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="682a3-137">A thoroughly scanned image deployed in production is not guaranteed to be up to date for the lifetime of the application.</span></span> <span data-ttu-id="682a3-138">Se puede informar de las vulnerabilidades de seguridad para las capas de la imagen que no se conocían anteriormente o que se introdujeron después de la implementación de producción.</span><span class="sxs-lookup"><span data-stu-id="682a3-138">Security vulnerabilities might be reported for layers of the image that were not previously known or were introduced after the production deployment.</span></span> <span data-ttu-id="682a3-139">Son necesarias auditorías periódicas de imágenes implementadas en producción para identificar las imágenes que no están al día o que no se han actualizado en un tiempo.</span><span class="sxs-lookup"><span data-stu-id="682a3-139">Periodic auditing of images deployed in production is necessary to identify images that are out of date or have not been updated in a while.</span></span> <span data-ttu-id="682a3-140">Se podrían usar metodologías de implementación de verde azulado y activar mecanismos de actualización para actualizar las imágenes de contenedor sin tiempo de inactividad.</span><span class="sxs-lookup"><span data-stu-id="682a3-140">One might use blue-green deployment methodologies and rolling upgrade mechanisms to update container images without downtime.</span></span> <span data-ttu-id="682a3-141">El examen de imágenes puede realizarse con herramientas que se describen en la sección anterior.</span><span class="sxs-lookup"><span data-stu-id="682a3-141">Image scanning can be done with tools described in the preceding section.</span></span> 

* <span data-ttu-id="682a3-142">Una canalización de integración continua (CI) para crear imágenes y el examen de seguridad integrada puede ayudar a mantener seguros los registros privados con imágenes de contenedor seguras.</span><span class="sxs-lookup"><span data-stu-id="682a3-142">A continuous integration (CI) pipeline to build images and integrated security scanning can help maintain secure private registries with secure container images.</span></span> <span data-ttu-id="682a3-143">El análisis de vulnerabilidad creado en la solución de CI garantiza que las imágenes que pasan todas las pruebas se incluyan en el registro privado desde el que se implementan las cargas de trabajo de producción.</span><span class="sxs-lookup"><span data-stu-id="682a3-143">The vulnerability scanning built into the CI solution ensures that images that pass all the tests are pushed to the private registry from which production workloads are deployed.</span></span> <span data-ttu-id="682a3-144">Un error de canalización de CI garantiza que las imágenes vulnerables no se incluyan en el registro privado usado para las implementaciones de carga de trabajo de producción.</span><span class="sxs-lookup"><span data-stu-id="682a3-144">A CI pipeline failure ensures that vulnerable images are not pushed into the private registry used for production workload deployments.</span></span> <span data-ttu-id="682a3-145">También automatiza el examen de seguridad de imágenes si hay un número significativo de imágenes.</span><span class="sxs-lookup"><span data-stu-id="682a3-145">It also automates image security scanning if there are a significant number of images.</span></span> <span data-ttu-id="682a3-146">De lo contrario, auditar las imágenes manualmente para buscar vulnerabilidades de seguridad puede ser bastante lento y estar propenso a errores.</span><span class="sxs-lookup"><span data-stu-id="682a3-146">Otherwise, manually auditing images for security vulnerabilities can be painstakingly lengthy and error prone.</span></span>

## <a name="host-level-container-isolation"></a><span data-ttu-id="682a3-147">Aislamiento de contenedor a nivel de host</span><span class="sxs-lookup"><span data-stu-id="682a3-147">Host-level container isolation</span></span>
<span data-ttu-id="682a3-148">Cuando un cliente implementa aplicaciones de contenedor en recursos de Azure, se implementan en un nivel de suscripción en grupos de recursos y no son tienen varios inquilinos.</span><span class="sxs-lookup"><span data-stu-id="682a3-148">When a customer deploys container applications on Azure resources, they are deployed at a subscription level in resource groups and are not multi-tenant.</span></span> <span data-ttu-id="682a3-149">Esto significa que si un cliente comparte una suscripción con otros usuarios, no hay ningún límite que se pueda crear entre dos implementaciones en la misma suscripción.</span><span class="sxs-lookup"><span data-stu-id="682a3-149">This means that if a customer shares a subscription with others, there are no boundaries that can be built between two deployments in the same subscription.</span></span> <span data-ttu-id="682a3-150">Por lo tanto, no se garantiza la seguridad a nivel de contenedor.</span><span class="sxs-lookup"><span data-stu-id="682a3-150">Therefore, container-level security is not guaranteed.</span></span> 

<span data-ttu-id="682a3-151">También es muy importante comprender que los contenedores comparten el kernel y los recursos del host (que en Azure Container Service es una VM de Azure en un clúster).</span><span class="sxs-lookup"><span data-stu-id="682a3-151">It is also critical to understand that containers share the kernel and the resources of the host (which in Azure Container Service is an Azure VM in a cluster).</span></span> <span data-ttu-id="682a3-152">Por lo tanto, los contenedores que se ejecutan en producción se deben ejecutar en modo de usuario sin privilegios.</span><span class="sxs-lookup"><span data-stu-id="682a3-152">Therefore, containers running in production must be run in non-privileged user mode.</span></span> <span data-ttu-id="682a3-153">Ejecutar un contenedor con privilegios de raíz puede poner en peligro a todo el entorno.</span><span class="sxs-lookup"><span data-stu-id="682a3-153">Running a container with root privileges can compromise the entire environment.</span></span> <span data-ttu-id="682a3-154">Con acceso de nivel de raíz en un contenedor, un hacker puede tener acceso a todos los privilegios de raíz en el host.</span><span class="sxs-lookup"><span data-stu-id="682a3-154">With root-level access in a container, a hacker can gain access to the full root privileges on the host.</span></span> <span data-ttu-id="682a3-155">Además, es importante que ejecute contenedores con sistemas de archivos de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="682a3-155">In addition, it is important to run containers with read-only file systems.</span></span> <span data-ttu-id="682a3-156">Esto evita que alguien que tenga acceso al contenedor en peligro escriba scripts malintencionados en el sistema de archivos y obtenga acceso a otros archivos.</span><span class="sxs-lookup"><span data-stu-id="682a3-156">This prevents someone who has access to the compromised container to write malicious scripts to the file system and gain access to other files.</span></span> <span data-ttu-id="682a3-157">De igual forma, es importante limitar los recursos (por ejemplo, memoria, CPU y ancho de banda de red) asignados a un contenedor.</span><span class="sxs-lookup"><span data-stu-id="682a3-157">Similarly, it is important to limit the resources (such as memory, CPU, and network bandwidth) allocated to a container.</span></span> <span data-ttu-id="682a3-158">Esto ayuda a impedir que los hackers acaparen recursos y realicen actividades ilegales, como fraudes con tarjetas de crédito o minería bitcoin, que podría impedir que otros contenedores se ejecuten en el host o clúster.</span><span class="sxs-lookup"><span data-stu-id="682a3-158">This helps prevent hackers from hogging resources and pursuing illegal activities such as credit card fraud or bitcoin mining, which could prevent other containers from running on the host or cluster.</span></span>

## <a name="orchestrator-considerations"></a><span data-ttu-id="682a3-159">Consideraciones sobre el orquestador</span><span class="sxs-lookup"><span data-stu-id="682a3-159">Orchestrator considerations</span></span>

<span data-ttu-id="682a3-160">Cada orquestador disponible en Azure Container Service tiene sus propias consideraciones de seguridad.</span><span class="sxs-lookup"><span data-stu-id="682a3-160">Each orchestrator available in Azure Container Service has its own security considerations.</span></span> <span data-ttu-id="682a3-161">Por ejemplo, debe limitar el acceso directo de SSH a nodos del orquestador en Container Service.</span><span class="sxs-lookup"><span data-stu-id="682a3-161">For example, you should limit direct SSH access to orchestrator nodes in Container Service.</span></span> <span data-ttu-id="682a3-162">En su lugar, debe usar la IU o las herramientas de línea de comandos de cada orquestador (como `kubectl` para Kubernetes) para administrar el entorno del contenedor sin acceso a los hosts.</span><span class="sxs-lookup"><span data-stu-id="682a3-162">Instead, you should use each orchestrator's UI or command-line tools (such as `kubectl` for Kubernetes) to manage the container environment without accessing the hosts.</span></span> <span data-ttu-id="682a3-163">Para más información, consulte [Establecimiento de una conexión remota a un clúster de Kubernetes, DC/OS o Docker Swarm](../articles/container-service/kubernetes/container-service-connect.md).</span><span class="sxs-lookup"><span data-stu-id="682a3-163">For more information, see [Make a remote connection to a Kubernetes, DC/OS, or Docker Swarm cluster](../articles/container-service/kubernetes/container-service-connect.md).</span></span>

<span data-ttu-id="682a3-164">Para información adicional sobre la seguridad específica del orquestador, consulte estos los siguientes recursos:</span><span class="sxs-lookup"><span data-stu-id="682a3-164">For additional orchestrator-specific security information, see the following resources:</span></span>

* <span data-ttu-id="682a3-165">**Kubernetes**: [prácticas recomendadas de seguridad para la implementación de Kubernetes](http://blog.kubernetes.io/2016/08/security-best-practices-kubernetes-deployment.html)</span><span class="sxs-lookup"><span data-stu-id="682a3-165">**Kubernetes**: [Security Best Practices for Kubernetes Deployment](http://blog.kubernetes.io/2016/08/security-best-practices-kubernetes-deployment.html)</span></span>

* <span data-ttu-id="682a3-166">**DC/OS**: [cómo asegurar su clúster](https://dcos.io/docs/1.8/administration/securing-your-cluster/)</span><span class="sxs-lookup"><span data-stu-id="682a3-166">**DC/OS**: [Securing Your Cluster](https://dcos.io/docs/1.8/administration/securing-your-cluster/)</span></span>

* <span data-ttu-id="682a3-167">**Docker Swarm**: [seguridad de Docker](https://www.docker.com/docker-security)</span><span class="sxs-lookup"><span data-stu-id="682a3-167">**Docker Swarm**: [Docker Security](https://www.docker.com/docker-security)</span></span>

## <a name="next-steps"></a><span data-ttu-id="682a3-168">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="682a3-168">Next steps</span></span>

* <span data-ttu-id="682a3-169">Para más información acerca de la seguridad de la arquitectura y el contenedor de Docker, consulte [Introducción a la seguridad del contenedor](https://www.docker.com/sites/default/files/WP_IntrotoContainerSecurity_08.19.2016.pdf).</span><span class="sxs-lookup"><span data-stu-id="682a3-169">For more about Docker architecture and container security, see [Introduction to Container Security](https://www.docker.com/sites/default/files/WP_IntrotoContainerSecurity_08.19.2016.pdf).</span></span>

* <span data-ttu-id="682a3-170">Para más información sobre la seguridad de la plataforma de Azure, vaya al [Azure Security Center](https://www.microsoft.com/en-us/trustcenter/cloudservices/azure).</span><span class="sxs-lookup"><span data-stu-id="682a3-170">For information about Azure platform security, see the [Azure Security Center](https://www.microsoft.com/en-us/trustcenter/cloudservices/azure).</span></span>
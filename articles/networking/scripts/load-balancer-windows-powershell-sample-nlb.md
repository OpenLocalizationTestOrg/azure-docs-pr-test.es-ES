---
title: "Ejemplo de script de Azure PowerShell: equilibrio de carga del tráfico a las máquinas virtuales para lograr una alta disponibilidad | Microsoft Docs"
description: "Ejemplo de script de Azure PowerShell: equilibrio de carga del tráfico a las máquinas virtuales para lograr una alta disponibilidad"
services: load-balancer
documentationcenter: load-balancer
author: georgewallace
manager: timlt
editor: tysonn
tags: 
ms.assetid: 
ms.service: load-balancer
ms.devlang: powershell
ms.topic: article
ms.tgt_pltfrm: 
ms.workload: infrastructure
ms.date: 05/16/2017
ms.author: gwallace
ms.openlocfilehash: c77def8906b151f2cc6e4bbc4188be8ecbeac732
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="load-balance-traffic-to-vms-for-high-availability"></a><span data-ttu-id="e16e7-103">Equilibrio de carga del tráfico a las máquinas virtuales para lograr una alta disponibilidad</span><span class="sxs-lookup"><span data-stu-id="e16e7-103">Load balance traffic to VMs for high availability</span></span>

<span data-ttu-id="e16e7-104">Este ejemplo de script crea todo lo necesario para ejecutar varias máquinas virtuales Windows configuradas con valores de alta disponibilidad y equilibrio de carga.</span><span class="sxs-lookup"><span data-stu-id="e16e7-104">This script sample creates everything needed to run several Windows virtual machines configured in a highly available and load balanced configuration.</span></span> <span data-ttu-id="e16e7-105">Después de ejecutar el script, tendrá tres máquinas virtuales unidas en un conjunto de disponibilidad de Azure y accesibles mediante Azure Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="e16e7-105">After running the script, you will have three virtual machines, joined to an Azure Availability Set, and accessible through an Azure Load Balancer.</span></span>

<span data-ttu-id="e16e7-106">Si es necesario, instale Azure PowerShell con la instrucción que se encuentra en la [Guía de Azure PowerShell](https://docs.microsoft.com/powershell/azureps-cmdlets-docs/) y, luego, ejecute `Login-AzureRmAccount` para crear una conexión con Azure.</span><span class="sxs-lookup"><span data-stu-id="e16e7-106">If needed, install the Azure PowerShell using the instruction found in the [Azure PowerShell guide](https://docs.microsoft.com/powershell/azureps-cmdlets-docs/), and then run `Login-AzureRmAccount` to create a connection with Azure.</span></span>

[!INCLUDE [quickstarts-free-trial-note](../../../includes/quickstarts-free-trial-note.md)]

## <a name="sample-script"></a><span data-ttu-id="e16e7-107">Script de ejemplo</span><span class="sxs-lookup"><span data-stu-id="e16e7-107">Sample script</span></span>

<span data-ttu-id="e16e7-108">[!code-powershell[main](../../../powershell_scripts/virtual-machine/create-vm-nlb/create-vm-nlb.ps1 "Creación rápida de una máquina virtual")]</span><span class="sxs-lookup"><span data-stu-id="e16e7-108">[!code-powershell[main](../../../powershell_scripts/virtual-machine/create-vm-nlb/create-vm-nlb.ps1 "Quick Create VM")]</span></span>

## <a name="clean-up-deployment"></a><span data-ttu-id="e16e7-109">Limpieza de la implementación</span><span class="sxs-lookup"><span data-stu-id="e16e7-109">Clean up deployment</span></span> 

<span data-ttu-id="e16e7-110">Ejecute el siguiente comando para quitar el grupo de recursos, la máquina virtual y todos los recursos relacionados.</span><span class="sxs-lookup"><span data-stu-id="e16e7-110">Run the following command to remove the resource group, VM, and all related resources.</span></span>

```powershell
Remove-AzureRmResourceGroup -Name myResourceGroup
```

## <a name="script-explanation"></a><span data-ttu-id="e16e7-111">Explicación del script</span><span class="sxs-lookup"><span data-stu-id="e16e7-111">Script explanation</span></span>

<span data-ttu-id="e16e7-112">Este script usa los siguientes comandos para crear un grupo de recursos, una máquina virtual, un conjunto de disponibilidad, un equilibrador de carga y todos los recursos relacionados.</span><span class="sxs-lookup"><span data-stu-id="e16e7-112">This script uses the following commands to create a resource group, virtual machine, availability set, load balancer, and all related resources.</span></span> <span data-ttu-id="e16e7-113">Cada comando de la tabla crea un vínculo a documentación específica del comando.</span><span class="sxs-lookup"><span data-stu-id="e16e7-113">Each command in the table links to command specific documentation.</span></span>

| <span data-ttu-id="e16e7-114">Comando</span><span class="sxs-lookup"><span data-stu-id="e16e7-114">Command</span></span> | <span data-ttu-id="e16e7-115">Notas</span><span class="sxs-lookup"><span data-stu-id="e16e7-115">Notes</span></span> |
|---|---|
| [<span data-ttu-id="e16e7-116">New-AzureRmResourceGroup</span><span class="sxs-lookup"><span data-stu-id="e16e7-116">New-AzureRmResourceGroup</span></span>](/powershell/module/azurerm.resources/new-azurermresourcegroup) | <span data-ttu-id="e16e7-117">Crea un grupo de recursos en el que se almacenan todos los recursos.</span><span class="sxs-lookup"><span data-stu-id="e16e7-117">Creates a resource group in which all resources are stored.</span></span> |
| [<span data-ttu-id="e16e7-118">New-AzureRmVirtualNetworkSubnetConfig</span><span class="sxs-lookup"><span data-stu-id="e16e7-118">New-AzureRmVirtualNetworkSubnetConfig</span></span>](/powershell/module/azurerm.network/new-azurermvirtualnetworksubnetconfig) | <span data-ttu-id="e16e7-119">Crea una configuración de subred.</span><span class="sxs-lookup"><span data-stu-id="e16e7-119">Creates a subnet configuration.</span></span> <span data-ttu-id="e16e7-120">Esta configuración se utiliza con el proceso de creación de la red virtual.</span><span class="sxs-lookup"><span data-stu-id="e16e7-120">This configuration is used with the virtual network creation process.</span></span> |
| [<span data-ttu-id="e16e7-121">New-AzureRmVirtualNetwork</span><span class="sxs-lookup"><span data-stu-id="e16e7-121">New-AzureRmVirtualNetwork</span></span>](/powershell/module/azurerm.network/new-azurermvirtualnetwork) | <span data-ttu-id="e16e7-122">Crea una red virtual y una subred de Azure.</span><span class="sxs-lookup"><span data-stu-id="e16e7-122">Creates an Azure virtual network and subnet.</span></span> |
| [<span data-ttu-id="e16e7-123">New-AzureRmPublicIpAddress</span><span class="sxs-lookup"><span data-stu-id="e16e7-123">New-AzureRmPublicIpAddress</span></span>](/powershell/module/azurerm.network/new-azurermpublicipaddress)  | <span data-ttu-id="e16e7-124">Crea una dirección IP pública con una dirección IP estática y un nombre DNS asociado.</span><span class="sxs-lookup"><span data-stu-id="e16e7-124">Creates a public IP address with a static IP address and an associated DNS name.</span></span> |
| [<span data-ttu-id="e16e7-125">New-AzureRmLoadBalancer</span><span class="sxs-lookup"><span data-stu-id="e16e7-125">New-AzureRmLoadBalancer</span></span>](/powershell/module/azurerm.network/new-azurermloadbalancer)  | <span data-ttu-id="e16e7-126">Crea una instancia de Azure Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="e16e7-126">Creates an Azure load balancer.</span></span> |
| [<span data-ttu-id="e16e7-127">New-AzureRmLoadBalancerProbeConfig</span><span class="sxs-lookup"><span data-stu-id="e16e7-127">New-AzureRmLoadBalancerProbeConfig</span></span>](/powershell/module/azurerm.network/new-azurermloadbalancerprobeconfig) | <span data-ttu-id="e16e7-128">Crea un sondeo de Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="e16e7-128">Creates a load balancer probe.</span></span> <span data-ttu-id="e16e7-129">Un sondeo de equilibrador de carga se usa para supervisar cada máquina virtual del conjunto de equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="e16e7-129">A load balancer probe is used to monitor each VM in the load balancer set.</span></span> <span data-ttu-id="e16e7-130">Si alguna máquina virtual deja de estar accesible, el tráfico no se enruta a la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="e16e7-130">If any VM becomes inaccessible, traffic is not routed to the VM.</span></span> |
| [<span data-ttu-id="e16e7-131">New-AzureRmLoadBalancerRuleConfig</span><span class="sxs-lookup"><span data-stu-id="e16e7-131">New-AzureRmLoadBalancerRuleConfig</span></span>](/powershell/module/azurerm.network/new-azurermloadbalancerruleconfig) | <span data-ttu-id="e16e7-132">Crea una regla de Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="e16e7-132">Creates an load balancer rule.</span></span> <span data-ttu-id="e16e7-133">En este ejemplo, se crea una regla para el puerto 80.</span><span class="sxs-lookup"><span data-stu-id="e16e7-133">In this sample, a rule is created for port 80.</span></span> <span data-ttu-id="e16e7-134">Según va llegando el tráfico HTTP a Load Balancer, se enruta al puerto 80 de una de las máquinas virtuales del conjunto de Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="e16e7-134">As HTTP traffic arrives at the load balancer, it is routed to port 80 one of the VMs in the load balancer set.</span></span> |
| [<span data-ttu-id="e16e7-135">New-AzureRmLoadBalancerInboundNatRuleConfig</span><span class="sxs-lookup"><span data-stu-id="e16e7-135">New-AzureRmLoadBalancerInboundNatRuleConfig</span></span>](/powershell/module/azurerm.network/new-azurermloadbalancerinboundnatruleconfig) | <span data-ttu-id="e16e7-136">Crea una regla de traducción de direcciones de red (NAT) de Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="e16e7-136">Creates a load balancer Network Address Translation (NAT) rule.</span></span>  <span data-ttu-id="e16e7-137">Las reglas de NAT asignan un puerto de Load Balancer a un puerto en una máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="e16e7-137">NAT rules map a port of the load balancer to a port on a VM.</span></span> <span data-ttu-id="e16e7-138">En este ejemplo, se crea una regla NAT para el tráfico SSH para cada máquina virtual del conjunto de Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="e16e7-138">In this sample, a NAT rule is created for SSH traffic to each VM in the load balancer set.</span></span>  |
| [<span data-ttu-id="e16e7-139">New-AzureRmNetworkSecurityGroup</span><span class="sxs-lookup"><span data-stu-id="e16e7-139">New-AzureRmNetworkSecurityGroup</span></span>](/powershell/module/azurerm.network/new-azurermnetworksecuritygroup) | <span data-ttu-id="e16e7-140">Crea un grupo de seguridad de red (NSG), que es un límite de seguridad entre Internet y la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="e16e7-140">Creates a network security group (NSG), which is a security boundary between the internet and the virtual machine.</span></span> |
| [<span data-ttu-id="e16e7-141">New-AzureRmNetworkSecurityRuleConfig</span><span class="sxs-lookup"><span data-stu-id="e16e7-141">New-AzureRmNetworkSecurityRuleConfig</span></span>](/powershell/module/azurerm.network/new-azurermnetworksecurityruleconfig) | <span data-ttu-id="e16e7-142">Crea una regla de NSG para permitir el tráfico entrante.</span><span class="sxs-lookup"><span data-stu-id="e16e7-142">Creates an NSG rule to allow inbound traffic.</span></span> <span data-ttu-id="e16e7-143">En este ejemplo, el puerto 22 está abierto al tráfico SSH.</span><span class="sxs-lookup"><span data-stu-id="e16e7-143">In this sample, port 22 is opened for SSH traffic.</span></span> |
| [<span data-ttu-id="e16e7-144">New-AzureRmNetworkInterface</span><span class="sxs-lookup"><span data-stu-id="e16e7-144">New-AzureRmNetworkInterface</span></span>](/powershell/module/azurerm.network/new-azurermnetworkinterface) | <span data-ttu-id="e16e7-145">Crea una tarjeta de máquina virtual y la conecta con la red virtual, la subred y el NSG.</span><span class="sxs-lookup"><span data-stu-id="e16e7-145">Creates a virtual network card and attaches it to the virtual network, subnet, and NSG.</span></span> |
| [<span data-ttu-id="e16e7-146">New-AzureRmAvailabilitySet</span><span class="sxs-lookup"><span data-stu-id="e16e7-146">New-AzureRmAvailabilitySet</span></span>](/powershell/module/azurerm.compute/new-azurermavailabilityset) | <span data-ttu-id="e16e7-147">Crea un conjunto de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="e16e7-147">Creates an availability set.</span></span> <span data-ttu-id="e16e7-148">Los conjuntos de disponibilidad garantizan la disponibilidad de las aplicaciones al repartir las máquinas virtuales entre los recursos físicos, de forma que si se produce un error, el conjunto no se verá afectado en su totalidad.</span><span class="sxs-lookup"><span data-stu-id="e16e7-148">Availability sets ensure application uptime by spreading the virtual machines across physical resources such that if failure occurs, the entire set is not effected.</span></span> |
| [<span data-ttu-id="e16e7-149">New-AzureRmVMConfig</span><span class="sxs-lookup"><span data-stu-id="e16e7-149">New-AzureRmVMConfig</span></span>](/powershell/module/azurerm.compute/new-azurermvmconfig) | <span data-ttu-id="e16e7-150">Crea una configuración de máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="e16e7-150">Creates a VM configuration.</span></span> <span data-ttu-id="e16e7-151">Esta configuración incluye diversa información, como el nombre de la máquina virtual, sistema el operativo y las credenciales administrativas.</span><span class="sxs-lookup"><span data-stu-id="e16e7-151">This configuration includes information such as VM name, operating system, and administrative credentials.</span></span> <span data-ttu-id="e16e7-152">La configuración se utiliza durante la creación de las máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="e16e7-152">The configuration is used during VM creation.</span></span> |
| [<span data-ttu-id="e16e7-153">New-AzureRmVM</span><span class="sxs-lookup"><span data-stu-id="e16e7-153">New-AzureRmVM</span></span>](/powershell/module/azurerm.compute/new-azurermvm)  | <span data-ttu-id="e16e7-154">Crea la máquina virtual y la conecta con la tarjeta de red, la red virtual, la subred y el NSG.</span><span class="sxs-lookup"><span data-stu-id="e16e7-154">Creates the virtual machine and connects it to the network card, virtual network, subnet, and NSG.</span></span> <span data-ttu-id="e16e7-155">Este comando también especifica la imagen de máquina virtual que se usará, y las credenciales administrativas.</span><span class="sxs-lookup"><span data-stu-id="e16e7-155">This command also specifies the virtual machine image to be used and administrative credentials.</span></span>  |
| [<span data-ttu-id="e16e7-156">Remove-AzureRmResourceGroup</span><span class="sxs-lookup"><span data-stu-id="e16e7-156">Remove-AzureRmResourceGroup</span></span>](/powershell/module/azurerm.resources/remove-azurermresourcegroup) | <span data-ttu-id="e16e7-157">Elimina un grupo de recursos, incluidos todos los recursos anidados.</span><span class="sxs-lookup"><span data-stu-id="e16e7-157">Deletes a resource group including all nested resources.</span></span> |

## <a name="next-steps"></a><span data-ttu-id="e16e7-158">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="e16e7-158">Next steps</span></span>

<span data-ttu-id="e16e7-159">Para más información sobre Azure PowerShell, consulte la [documentación de Azure PowerShell](https://docs.microsoft.com/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="e16e7-159">For more information on the Azure PowerShell, see [Azure PowerShell documentation](https://docs.microsoft.com/powershell/azure/overview).</span></span>

<span data-ttu-id="e16e7-160">En la [documentación de la información general de redes de Azure](../powershell-samples.md?toc=%2fazure%2fnetworking%2ftoc.json) puede encontrar ejemplos adicionales de script de PowerShell de redes.</span><span class="sxs-lookup"><span data-stu-id="e16e7-160">Additional networking PowerShell script samples can be found in the [Azure Networking Overview documentation](../powershell-samples.md?toc=%2fazure%2fnetworking%2ftoc.json).</span></span>

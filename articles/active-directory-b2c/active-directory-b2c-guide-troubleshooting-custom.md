---
title: "Azure Active Directory B2C: solución de problemas de directivas personalizadas | Microsoft Docs"
description: "Obtenga información sobre los métodos para resolver errores cuando se trabaja con directivas personalizadas en Azure Active Directory."
services: active-directory-b2c
documentationcenter: 
author: rojasja
manager: krassk
editor: rojasja
ms.assetid: 
ms.service: active-directory-b2c
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/07/2017
ms.author: joroja
ms.openlocfilehash: 023390ba36a74217503ff8b3076ad17978fe3fb8
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="troubleshoot-azure-ad-b2c-custom-policies-and-identity-experience-framework"></a><span data-ttu-id="44b75-103">Solución de problemas de directivas personalizadas de Azure AD B2C y el marco de experiencia de identidad</span><span class="sxs-lookup"><span data-stu-id="44b75-103">Troubleshoot Azure AD B2C custom policies and Identity Experience Framework</span></span>

<span data-ttu-id="44b75-104">Si usa directivas personalizadas de Azure Active Directory B2C (Azure AD B2C), es posible que experimente problemas al configurar el marco de experiencia de identidad en el formato XML de su lenguaje de directiva.</span><span class="sxs-lookup"><span data-stu-id="44b75-104">If you use Azure Active Directory B2C (Azure AD B2C) custom policies, you might experience challenges setting up the Identity Experience Framework in its policy language XML format.</span></span>  <span data-ttu-id="44b75-105">Aprender a escribir directivas personalizadas es casi como aprender un idioma nuevo.</span><span class="sxs-lookup"><span data-stu-id="44b75-105">Learning to write custom policies can be like learning a new language.</span></span> <span data-ttu-id="44b75-106">En este artículo se describen las herramientas y las sugerencias que pueden ayudarle a detectar y solucionar problemas rápidamente.</span><span class="sxs-lookup"><span data-stu-id="44b75-106">In this article, we describe tools and tips that can help you quickly discover and resolve issues.</span></span> 

> [!NOTE]
> <span data-ttu-id="44b75-107">Este artículo se centra en la solución de problemas de configuración de directivas personalizadas de Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="44b75-107">This article focuses on troubleshooting your Azure AD B2C custom policy configuration.</span></span> <span data-ttu-id="44b75-108">No trata sobre las aplicaciones de usuarios de confianza ni sobre su biblioteca de identidades.</span><span class="sxs-lookup"><span data-stu-id="44b75-108">It doesn't address the relying party application or its identity library.</span></span>

## <a name="xml-editing"></a><span data-ttu-id="44b75-109">Edición de XML</span><span class="sxs-lookup"><span data-stu-id="44b75-109">XML editing</span></span>

<span data-ttu-id="44b75-110">El error más común al configurar directivas personalizadas es el formato incorrecto del código XML.</span><span class="sxs-lookup"><span data-stu-id="44b75-110">The most common error in setting up custom policies is improperly formatted XML.</span></span> <span data-ttu-id="44b75-111">Es fundamental contar con un buen editor XML.</span><span class="sxs-lookup"><span data-stu-id="44b75-111">A good XML editor is nearly essential.</span></span> <span data-ttu-id="44b75-112">Un buen editor XML muestra XML nativo y contenido codificado por colores, rellena previamente términos comunes, mantiene los elementos XML indexados y puede validar con esquemas.</span><span class="sxs-lookup"><span data-stu-id="44b75-112">A good XML editor displays XML natively, color-codes content, prefills common terms, keeps XML elements indexed, and can validate with schema.</span></span> <span data-ttu-id="44b75-113">Dos de nuestros editores XML favoritos son:</span><span class="sxs-lookup"><span data-stu-id="44b75-113">Here are two of our favorite XML editors:</span></span>

* [<span data-ttu-id="44b75-114">código de Visual Studio</span><span class="sxs-lookup"><span data-stu-id="44b75-114">Visual Studio Code</span></span>](https://code.visualstudio.com/)
* [<span data-ttu-id="44b75-115">Notepad++</span><span class="sxs-lookup"><span data-stu-id="44b75-115">Notepad++</span></span>](https://notepad-plus-plus.org/)

<span data-ttu-id="44b75-116">La validación del esquema XML identifica los errores antes de cargar el archivo XML.</span><span class="sxs-lookup"><span data-stu-id="44b75-116">XML schema validation identifies errors before you upload your XML file.</span></span> <span data-ttu-id="44b75-117">En la carpeta raíz del paquete de inicio, obtenga la definición de esquema XML TrustFrameworkPolicy_0.3.0.0.xsd.</span><span class="sxs-lookup"><span data-stu-id="44b75-117">In the root folder of the starter pack, get the XML schema definition TrustFrameworkPolicy_0.3.0.0.xsd.</span></span> <span data-ttu-id="44b75-118">Para obtener más información, en la documentación de su editor XML, busque *herramientas de XML* y *validación de XML*.</span><span class="sxs-lookup"><span data-stu-id="44b75-118">For more information, in the documentation of your XML editor, look for *XML tools* and *XML validation*.</span></span>

<span data-ttu-id="44b75-119">Podría resultarle útil revisar las reglas del código XML.</span><span class="sxs-lookup"><span data-stu-id="44b75-119">You might find a review of XML rules helpful.</span></span> <span data-ttu-id="44b75-120">Azure AD B2C rechaza todos los errores de formato XML que detecta.</span><span class="sxs-lookup"><span data-stu-id="44b75-120">Azure AD B2C rejects any XML formatting errors that it detects.</span></span> <span data-ttu-id="44b75-121">En ocasiones, un formato XML incorrecto puede dar lugar a mensajes de error que resultan engañosos.</span><span class="sxs-lookup"><span data-stu-id="44b75-121">Occasionally, incorrectly formatted XML might cause error messages that are misleading.</span></span>

## <a name="upload-policies-and-policy-validation"></a><span data-ttu-id="44b75-122">Validación de directivas y directivas de carga</span><span class="sxs-lookup"><span data-stu-id="44b75-122">Upload policies and policy validation</span></span>

 <span data-ttu-id="44b75-123">La validación de la carga de archivos XML es automática.</span><span class="sxs-lookup"><span data-stu-id="44b75-123">XML file upload validation is automatic.</span></span> <span data-ttu-id="44b75-124">La mayoría de los errores hacen que se produzca un error en la carga.</span><span class="sxs-lookup"><span data-stu-id="44b75-124">Most errors cause the upload to fail.</span></span> <span data-ttu-id="44b75-125">En la validación se incluye el archivo de directiva que se está cargando.</span><span class="sxs-lookup"><span data-stu-id="44b75-125">Validation includes the policy file that you are uploading.</span></span> <span data-ttu-id="44b75-126">Además, se incluye la cadena de archivos a la que hace referencia el archivo de carga (el archivo de directiva de usuario de confianza, el archivo de extensiones y el archivo base).</span><span class="sxs-lookup"><span data-stu-id="44b75-126">It also includes the chain of files the upload file refers to (the relying party policy file, the extensions file, and the base file).</span></span> 
 
 <span data-ttu-id="44b75-127">Entre los errores de validación comunes se incluyen los que se indican a continuación.</span><span class="sxs-lookup"><span data-stu-id="44b75-127">Common validation errors include the following.</span></span>

<span data-ttu-id="44b75-128">Fragmento de código de error: `... makes a reference to ClaimType with id "displaName" but neither the policy nor any of its base policies contain such an element`</span><span class="sxs-lookup"><span data-stu-id="44b75-128">Error snippet: `... makes a reference to ClaimType with id "displaName" but neither the policy nor any of its base policies contain such an element`</span></span>
* <span data-ttu-id="44b75-129">El valor de ClaimType podría estar mal escrito o no existir en el esquema.</span><span class="sxs-lookup"><span data-stu-id="44b75-129">The ClaimType value might be misspelled, or does not exist in the schema.</span></span>
* <span data-ttu-id="44b75-130">Se deben definir valores de ClaimType en al menos uno de los archivos de la directiva.</span><span class="sxs-lookup"><span data-stu-id="44b75-130">ClaimType values must be defined in at least one of the files in the policy.</span></span> 
    <span data-ttu-id="44b75-131">Por ejemplo: ` <ClaimType Id="socialIdpUserId">`</span><span class="sxs-lookup"><span data-stu-id="44b75-131">For example: ` <ClaimType Id="socialIdpUserId">`</span></span>
* <span data-ttu-id="44b75-132">Si ClaimType se define en el archivo de extensiones, pero también se usa en el valor de TechnichalProfile en el archivo base, al cargar dicho archivo se producirá un error.</span><span class="sxs-lookup"><span data-stu-id="44b75-132">If ClaimType is defined in the extensions file, but it's also used in a TechnicalProfile value in the base file, uploading the base file results in an error.</span></span>

<span data-ttu-id="44b75-133">Fragmento de código de error: `...makes a reference to a ClaimsTransformation with id...`</span><span class="sxs-lookup"><span data-stu-id="44b75-133">Error snippet: `...makes a reference to a ClaimsTransformation with id...`</span></span>
* <span data-ttu-id="44b75-134">Las causas del error podrían ser las mismas que las del error de ClaimType.</span><span class="sxs-lookup"><span data-stu-id="44b75-134">The causes for the error might be the same as for the ClaimType error.</span></span>

<span data-ttu-id="44b75-135">Fragmento de código de error: `Reason: User is currently logged as a user of 'yourtenant.onmicrosoft.com' tenant. In order to manage 'yourtenant.onmicrosoft.com', please login as a user of 'yourtenant.onmicrosoft.com' tenant`</span><span class="sxs-lookup"><span data-stu-id="44b75-135">Error snippet: `Reason: User is currently logged as a user of 'yourtenant.onmicrosoft.com' tenant. In order to manage 'yourtenant.onmicrosoft.com', please login as a user of 'yourtenant.onmicrosoft.com' tenant`</span></span>
* <span data-ttu-id="44b75-136">Compruebe que el valor de TenantId de los elementos **\<TrustFrameworkPolicy\>** y **\<BasePolicy\>** coincide con el inquilino de Azure AD B2C de destino.</span><span class="sxs-lookup"><span data-stu-id="44b75-136">Check that the TenantId value in the **\<TrustFrameworkPolicy\>** and **\<BasePolicy\>** elements match your target Azure AD B2C tenant.</span></span>  

## <a name="troubleshoot-the-runtime"></a><span data-ttu-id="44b75-137">Solución de problemas del tiempo de ejecución</span><span class="sxs-lookup"><span data-stu-id="44b75-137">Troubleshoot the runtime</span></span>

* <span data-ttu-id="44b75-138">Use `Run Now` y `https://jwt.io` para probar sus directivas con independencia de su aplicación web o móvil.</span><span class="sxs-lookup"><span data-stu-id="44b75-138">Use `Run Now` and `https://jwt.io` to test your policies independently of your web or mobile application.</span></span> <span data-ttu-id="44b75-139">Este sitio web actúa como una aplicación de usuario de confianza.</span><span class="sxs-lookup"><span data-stu-id="44b75-139">This website acts like a relying party application.</span></span> <span data-ttu-id="44b75-140">Muestra el contenido del JSON Web Token (JWT) que genera la directiva de Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="44b75-140">It displays the contents of the JSON Web Token (JWT) that is generated by your Azure AD B2C policy.</span></span> <span data-ttu-id="44b75-141">Para crear una aplicación de prueba en el marco de experiencia de identidad, use los valores siguientes:</span><span class="sxs-lookup"><span data-stu-id="44b75-141">To create a test application in Identity Experience Framework, use the following values:</span></span>
    * <span data-ttu-id="44b75-142">Nombre: TestApp</span><span class="sxs-lookup"><span data-stu-id="44b75-142">Name: TestApp</span></span>
    * <span data-ttu-id="44b75-143">Aplicación web/API web: No</span><span class="sxs-lookup"><span data-stu-id="44b75-143">Web App/Web API: No</span></span>
    * <span data-ttu-id="44b75-144">Cliente nativo: No</span><span class="sxs-lookup"><span data-stu-id="44b75-144">Native client: No</span></span>

* <span data-ttu-id="44b75-145">Use [Fiddler](http://www.telerik.com/fiddler) para realizar un seguimiento del intercambio de mensajes entre su explorador cliente y Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="44b75-145">To trace the exchange of messages between your client browser and Azure AD B2C, use [Fiddler](http://www.telerik.com/fiddler).</span></span> <span data-ttu-id="44b75-146">Puede ayudarle a detectar un error en el recorrido del usuario en los pasos de la orquestación.</span><span class="sxs-lookup"><span data-stu-id="44b75-146">It can help you get an indication of where your user journey is failing in your orchestration steps.</span></span>

* <span data-ttu-id="44b75-147">Use **Application Insights** en **modo de desarrollo** para realizar un seguimiento de la actividad de su recorrido del usuario en el marco de experiencia de identidad.</span><span class="sxs-lookup"><span data-stu-id="44b75-147">In **Development mode**, use **Application Insights** to trace the activity of your Identity Experience Framework user journey.</span></span> <span data-ttu-id="44b75-148">En el **modo de desarrollo**, es posible observar el intercambio de notificaciones entre el maco de experiencia de identidad y los diversos proveedores de notificaciones definidos por perfiles técnicos, como proveedores de identidades, servicios de basados en API, el directorio de usuario de Azure AD B2C y otros servicios como Azure Multi-Factor-Authentication.</span><span class="sxs-lookup"><span data-stu-id="44b75-148">In **Development mode**, you can observe the exchange of claims between the Identity Experience Framework and the various claims providers that are defined by technical profiles, such as identity providers, API-based services, the Azure AD B2C user directory, and other services, like Azure Multi-Factor-Authentication.</span></span>  

## <a name="recommended-practices"></a><span data-ttu-id="44b75-149">Procedimientos recomendados</span><span class="sxs-lookup"><span data-stu-id="44b75-149">Recommended practices</span></span>

<span data-ttu-id="44b75-150">**Mantenga varias versiones de los escenarios. Agrúpelas en un proyecto con la aplicación.**</span><span class="sxs-lookup"><span data-stu-id="44b75-150">**Keep multiple versions of your scenarios. Group them in a project with your application.**</span></span> <span data-ttu-id="44b75-151">Los archivos base, de extensiones y de usuario de confianza dependen directamente los unos de los otros.</span><span class="sxs-lookup"><span data-stu-id="44b75-151">The base, extensions, and relying party files are directly dependent on each other.</span></span> <span data-ttu-id="44b75-152">Guárdelos como un grupo.</span><span class="sxs-lookup"><span data-stu-id="44b75-152">Save them as a group.</span></span> <span data-ttu-id="44b75-153">A medida que se agreguen nuevas características a las directivas, mantenga versiones operativas distintas.</span><span class="sxs-lookup"><span data-stu-id="44b75-153">As new features are added to your policies, keep separate working versions.</span></span> <span data-ttu-id="44b75-154">Organice las versiones operativas en su propio sistema de archivos con el código de aplicación con el que interactúan.</span><span class="sxs-lookup"><span data-stu-id="44b75-154">Stage working versions in your own file system with the application code they interact with.</span></span>  <span data-ttu-id="44b75-155">Las aplicaciones pueden invocar muchas directivas de usuario de confianza diferentes en un inquilino.</span><span class="sxs-lookup"><span data-stu-id="44b75-155">Your applications might invoke many different relying party policies in a tenant.</span></span> <span data-ttu-id="44b75-156">Pueden convertirse en dependientes de las notificaciones que esperan de sus directivas de Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="44b75-156">They might become dependent on the claims that they expect from your Azure AD B2C policies.</span></span>

<span data-ttu-id="44b75-157">**Desarrolle y pruebe perfiles técnicos con recorridos de usuario conocidos.**</span><span class="sxs-lookup"><span data-stu-id="44b75-157">**Develop and test technical profiles with known user journeys.**</span></span> <span data-ttu-id="44b75-158">Use directivas probadas del paquete de inicio para configurar los perfiles técnicos.</span><span class="sxs-lookup"><span data-stu-id="44b75-158">Use tested starter pack policies to set up your technical profiles.</span></span> <span data-ttu-id="44b75-159">Pruébelas por separado antes de incorporarlas a sus propios recorridos de usuario.</span><span class="sxs-lookup"><span data-stu-id="44b75-159">Test them separately before you incorporate them into your own user journeys.</span></span>

<span data-ttu-id="44b75-160">**Desarrolle y pruebe recorridos de usuario con perfiles técnicos conocidos.**</span><span class="sxs-lookup"><span data-stu-id="44b75-160">**Develop and test user journeys with tested technical profiles.**</span></span> <span data-ttu-id="44b75-161">Cambie los pasos de orquestación de un recorrido del usuario de forma incremental.</span><span class="sxs-lookup"><span data-stu-id="44b75-161">Change the orchestration steps of a user journey incrementally.</span></span> <span data-ttu-id="44b75-162">Compile progresivamente los escenarios previstos.</span><span class="sxs-lookup"><span data-stu-id="44b75-162">Progressively build your intended scenarios.</span></span>

## <a name="next-steps"></a><span data-ttu-id="44b75-163">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="44b75-163">Next steps</span></span>

* <span data-ttu-id="44b75-164">En GitHub, descargue el archivo ZIP [active-directory-b2c-custom-policy-starterpack] (https://github.com/Azure-Samples/active-directory-b2c-custom-policy-starterpack/archive/master.zip).</span><span class="sxs-lookup"><span data-stu-id="44b75-164">In GitHub, download the [active-directory-b2c-custom-policy-starterpack] (https://github.com/Azure-Samples/active-directory-b2c-custom-policy-starterpack/archive/master.zip) .zip file.</span></span>

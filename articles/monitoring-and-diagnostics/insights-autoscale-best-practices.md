---
title: "Procedimientos recomendados de escalado automático | Microsoft Docs"
description: "Patrones de escalado automático en Azure para Web Apps, conjunto de escalado de máquinas virtuales y Cloud Services"
author: anirudhcavale
manager: orenr
editor: 
services: monitoring-and-diagnostics
documentationcenter: monitoring-and-diagnostics
ms.assetid: 9fa2b94b-dfa5-4106-96ff-74fd1fba4657
ms.service: monitoring-and-diagnostics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/07/2017
ms.author: ancav
ms.openlocfilehash: 54dad831287376db7fb2dc46e4591be1499dc072
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/03/2017
---
# <a name="best-practices-for-autoscale"></a><span data-ttu-id="5bef3-103">Procedimientos recomendados de escalado automático</span><span class="sxs-lookup"><span data-stu-id="5bef3-103">Best practices for Autoscale</span></span>
<span data-ttu-id="5bef3-104">En este artículo se explican los procedimientos recomendadas para el escalado automático de Azure.</span><span class="sxs-lookup"><span data-stu-id="5bef3-104">This article teaches best practices to autoscale in Azure.</span></span> <span data-ttu-id="5bef3-105">El escalado automático de Azure Monitor solo se aplica a los [conjuntos de escalado de máquinas virtuales](https://azure.microsoft.com/services/virtual-machine-scale-sets/), [Cloud Services](https://azure.microsoft.com/services/cloud-services/) y [App Service - Web Apps](https://azure.microsoft.com/services/app-service/web/).</span><span class="sxs-lookup"><span data-stu-id="5bef3-105">Azure Monitor autoscale applies only to [Virtual Machine Scale Sets](https://azure.microsoft.com/services/virtual-machine-scale-sets/), [Cloud Services](https://azure.microsoft.com/services/cloud-services/), and [App Service - Web Apps](https://azure.microsoft.com/services/app-service/web/).</span></span> <span data-ttu-id="5bef3-106">Otros servicios de Azure usan distintos métodos de escalado.</span><span class="sxs-lookup"><span data-stu-id="5bef3-106">Other Azure services use different scaling methods.</span></span>

## <a name="autoscale-concepts"></a><span data-ttu-id="5bef3-107">Conceptos de escalado automático</span><span class="sxs-lookup"><span data-stu-id="5bef3-107">Autoscale concepts</span></span>
* <span data-ttu-id="5bef3-108">Un recurso solo puede tener *una* configuración de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="5bef3-108">A resource can have only *one* autoscale setting</span></span>
* <span data-ttu-id="5bef3-109">Una configuración de escalado automático puede tener uno o varios perfiles y cada perfil, a su vez, puede tener una o varias reglas de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="5bef3-109">An autoscale setting can have one or more profiles and each profile can have one or more autoscale rules.</span></span>
* <span data-ttu-id="5bef3-110">Una configuración de escalado automático escala instancias *horizontalmente* aumentando las instancias y las *reduce horizontalmente* disminuyendo el número de instancias.</span><span class="sxs-lookup"><span data-stu-id="5bef3-110">An autoscale setting scales instances horizontally, which is *out* by increasing the instances and *in* by decreasing the number of instances.</span></span>
  <span data-ttu-id="5bef3-111">Una configuración de escalado automático presenta unos valores máximo, mínimo y predeterminado de instancias.</span><span class="sxs-lookup"><span data-stu-id="5bef3-111">An autoscale setting has a maximum, minimum, and default value of instances.</span></span>
* <span data-ttu-id="5bef3-112">Un trabajo de escalado automático siempre lee la métrica asociada por la que realizar la escala y comprueba si se rebasó el umbral establecido para el escalado horizontal o la reducción horizontal.</span><span class="sxs-lookup"><span data-stu-id="5bef3-112">An autoscale job always reads the associated metric to scale by, checking if it has crossed the configured threshold for scale-out or scale-in.</span></span> <span data-ttu-id="5bef3-113">En [Métricas comunes de escalado automático de Azure Monitor](insights-autoscale-common-metrics.md) encontrará una lista de métricas por las que el escalado automático puede escalar.</span><span class="sxs-lookup"><span data-stu-id="5bef3-113">You can view a list of metrics that autoscale can scale by at [Azure Monitor autoscaling common metrics](insights-autoscale-common-metrics.md).</span></span>
* <span data-ttu-id="5bef3-114">Todos los umbrales se calculan en el nivel de instancia.</span><span class="sxs-lookup"><span data-stu-id="5bef3-114">All thresholds are calculated at an instance level.</span></span> <span data-ttu-id="5bef3-115">Por ejemplo, "escalar horizontalmente por 1 instancia cuando el uso medio de CPU > 80 % cuando el número de instancias es 2" significa escalar horizontalmente cuando el uso medio de CPU en todas las instancias sea superior al 80 %.</span><span class="sxs-lookup"><span data-stu-id="5bef3-115">For example, "scale out by 1 instance when average CPU > 80% when instance count is 2", means scale-out when the average CPU across all instances is greater than 80%.</span></span>
* <span data-ttu-id="5bef3-116">Las notificaciones de error siempre se reciben por correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="5bef3-116">You always receive failure notifications via email.</span></span> <span data-ttu-id="5bef3-117">Las reciben, concretamente, el propietario, el colaborador y los lectores del recurso de destino.</span><span class="sxs-lookup"><span data-stu-id="5bef3-117">Specifically, the owner, contributor, and readers of the target resource receive email.</span></span> <span data-ttu-id="5bef3-118">Además, siempre se recibe un correo electrónico de *recuperación* cuando el escalado automático se recupere de un error y comience a funcionar con normalidad.</span><span class="sxs-lookup"><span data-stu-id="5bef3-118">You also always receive a *recovery* email when autoscale recovers from a failure and starts functioning normally.</span></span>
* <span data-ttu-id="5bef3-119">Puede optar por recibir una notificación de acción de escalado correcta por correo electrónico y por webhooks.</span><span class="sxs-lookup"><span data-stu-id="5bef3-119">You can opt-in to receive a successful scale action notification via email and webhooks.</span></span>

## <a name="autoscale-best-practices"></a><span data-ttu-id="5bef3-120">Procedimientos recomendados de escalado automático</span><span class="sxs-lookup"><span data-stu-id="5bef3-120">Autoscale best practices</span></span>
<span data-ttu-id="5bef3-121">Use los procedimientos recomendados al usar el escalado automático.</span><span class="sxs-lookup"><span data-stu-id="5bef3-121">Use the following best practices as you use autoscale.</span></span>

### <a name="ensure-the-maximum-and-minimum-values-are-different-and-have-an-adequate-margin-between-them"></a><span data-ttu-id="5bef3-122">Asegúrese de que los valores máximo y mínimo son diferentes y de que hay margen suficiente entre ellos</span><span class="sxs-lookup"><span data-stu-id="5bef3-122">Ensure the maximum and minimum values are different and have an adequate margin between them</span></span>
<span data-ttu-id="5bef3-123">Si tiene una configuración en la que el valor mínimo es 2, el valor máximo es 2 y el número de instancias es 2, no se puede ejecutar ninguna acción de escalado.</span><span class="sxs-lookup"><span data-stu-id="5bef3-123">If you have a setting that has minimum=2, maximum=2 and the current instance count is 2, no scale action can occur.</span></span> <span data-ttu-id="5bef3-124">Mantenga un margen suficiente entre los números de instancias máximo y mínimo, que son inclusivos.</span><span class="sxs-lookup"><span data-stu-id="5bef3-124">Keep an adequate margin between the maximum and minimum instance counts, which are inclusive.</span></span> <span data-ttu-id="5bef3-125">El escalado automático siempre escala entre estos límites.</span><span class="sxs-lookup"><span data-stu-id="5bef3-125">Autoscale always scales between these limits.</span></span>

### <a name="manual-scaling-is-reset-by-autoscale-min-and-max"></a><span data-ttu-id="5bef3-126">El escalado manual se restablece al valor máximo y mínimo de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="5bef3-126">Manual scaling is reset by autoscale min and max</span></span>
<span data-ttu-id="5bef3-127">Si actualiza manualmente el recuento de instancias a un valor superior o inferior al máximo, el motor de escalado automático se ajusta automáticamente al valor mínimo (si está por debajo) o al máximo (si está por encima).</span><span class="sxs-lookup"><span data-stu-id="5bef3-127">If you manually update the instance count to a value above or below the maximum, the autoscale engine automatically scales back to the minimum (if below) or the maximum (if above).</span></span> <span data-ttu-id="5bef3-128">Por ejemplo, establezca el intervalo entre 3 y 6.</span><span class="sxs-lookup"><span data-stu-id="5bef3-128">For example, you set the range between 3 and 6.</span></span> <span data-ttu-id="5bef3-129">Si tiene una instancia en ejecución, el motor de escalado automático escala a 3 instancias cuando vuelva a ejecutarse.</span><span class="sxs-lookup"><span data-stu-id="5bef3-129">If you have one running instance, the autoscale engine scales to 3 instances on its next run.</span></span> <span data-ttu-id="5bef3-130">Del mismo modo, podría reducir horizontalmente de 8 instancias a 6 en su siguiente ejecución.</span><span class="sxs-lookup"><span data-stu-id="5bef3-130">Likewise, it would scale-in 8 instances back to 6 on its next run.</span></span>  <span data-ttu-id="5bef3-131">El escalado manual es muy temporal a menos que restablezca también las reglas de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="5bef3-131">Manual scaling is very temporary unless you reset the autoscale rules as well.</span></span>

### <a name="always-use-a-scale-out-and-scale-in-rule-combination-that-performs-an-increase-and-decrease"></a><span data-ttu-id="5bef3-132">Use siempre una combinación de reglas de escalado horizontal y reducción horizontal que realice un aumento y una disminución.</span><span class="sxs-lookup"><span data-stu-id="5bef3-132">Always use a scale-out and scale-in rule combination that performs an increase and decrease</span></span>
<span data-ttu-id="5bef3-133">Si usa solo una parte de la combinación, el escalado automático escala o reduce horizontalmente (y a la inversa) hasta alcanzar el valor máximo o mínimo.</span><span class="sxs-lookup"><span data-stu-id="5bef3-133">If you use only one part of the combination, autoscale scale-in that single out, or in, until the maximum, or minimum, is reached.</span></span>

### <a name="do-not-switch-between-the-azure-portal-and-the-azure-classic-portal-when-managing-autoscale"></a><span data-ttu-id="5bef3-134">No alterne entre Azure Portal y el Portal de Azure clásico al administrar el escalado automático</span><span class="sxs-lookup"><span data-stu-id="5bef3-134">Do not switch between the Azure portal and the Azure classic portal when managing Autoscale</span></span>
<span data-ttu-id="5bef3-135">Para Cloud Services y App Services (Web Apps), use Azure Portal (portal.azure.com) para crear y administrar la configuración de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="5bef3-135">For Cloud Services and App Services (Web Apps), use the Azure portal (portal.azure.com) to create and manage autoscale settings.</span></span> <span data-ttu-id="5bef3-136">Para los conjuntos de escalado de máquinas virtuales, use PowerShell, CLI o la API de REST para crear y administrar la configuración de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="5bef3-136">For Virtual Machine Scale Sets use PowerShell, CLI or REST API to create and manage autoscale setting.</span></span> <span data-ttu-id="5bef3-137">No alterne entre el Portal de Azure clásico (manage.windowsazure.com) y Azure Portal (portal.azure.com) al administrar configuraciones de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="5bef3-137">Do not switch between the Azure classic portal (manage.windowsazure.com) and the Azure portal (portal.azure.com) when managing autoscale configurations.</span></span> <span data-ttu-id="5bef3-138">El Portal de Azure clásico y su back-end subyacente presentan una serie de limitaciones.</span><span class="sxs-lookup"><span data-stu-id="5bef3-138">The Azure classic portal and its underlying backend has limitations.</span></span> <span data-ttu-id="5bef3-139">Vaya al Azure Portal para administrar el escalado automático mediante una interfaz gráfica de usuario.</span><span class="sxs-lookup"><span data-stu-id="5bef3-139">Move to the Azure portal to manage autoscale using a graphical user interface.</span></span> <span data-ttu-id="5bef3-140">Las opciones son usar PowerShell de escalado automático, CLI o la API de REST (a través del Explorador de recursos de Azure).</span><span class="sxs-lookup"><span data-stu-id="5bef3-140">The options are to use the autoscale PowerShell, CLI or REST API (via Azure Resource Explorer).</span></span>

### <a name="choose-the-appropriate-statistic-for-your-diagnostics-metric"></a><span data-ttu-id="5bef3-141">Elija la estadística adecuada para la métrica de diagnósticos</span><span class="sxs-lookup"><span data-stu-id="5bef3-141">Choose the appropriate statistic for your diagnostics metric</span></span>
<span data-ttu-id="5bef3-142">Para las métricas de diagnóstico, puede elegir entre *Promedio*, *Mínimo*, *Máximo* y *Total* como métrica a partir de la que escalar.</span><span class="sxs-lookup"><span data-stu-id="5bef3-142">For diagnostics metrics, you can choose among *Average*, *Minimum*, *Maximum* and *Total* as a metric to scale by.</span></span> <span data-ttu-id="5bef3-143">La estadística más común es *Promedio*.</span><span class="sxs-lookup"><span data-stu-id="5bef3-143">The most common statistic is *Average*.</span></span>

### <a name="choose-the-thresholds-carefully-for-all-metric-types"></a><span data-ttu-id="5bef3-144">Elija los umbrales cuidadosamente para todos los tipos de métrica</span><span class="sxs-lookup"><span data-stu-id="5bef3-144">Choose the thresholds carefully for all metric types</span></span>
<span data-ttu-id="5bef3-145">Es recomendable tener cuidado a la hora de elegir los diferentes umbrales de escalado y reducción horizontal en función de las situaciones prácticas.</span><span class="sxs-lookup"><span data-stu-id="5bef3-145">We recommend carefully choosing different thresholds for scale-out and scale-in based on practical situations.</span></span>

<span data-ttu-id="5bef3-146">*No se recomiendan* opciones de escalado automático como las de los siguientes ejemplos, con valores de umbral iguales o muy similares en condiciones de escalado o reducción horizontal:</span><span class="sxs-lookup"><span data-stu-id="5bef3-146">We *do not recommend* autoscale settings like the examples below with the same or very similar threshold values for out and in conditions:</span></span>

* <span data-ttu-id="5bef3-147">Aumentar las instancias en 1 cuando el número de subprocesos < = 600</span><span class="sxs-lookup"><span data-stu-id="5bef3-147">Increase instances by 1 count when Thread Count <= 600</span></span>
* <span data-ttu-id="5bef3-148">Disminuir las instancias en 1 cuando el número de subprocesos > = 600</span><span class="sxs-lookup"><span data-stu-id="5bef3-148">Decrease instances by 1 count when Thread Count >= 600</span></span>

<span data-ttu-id="5bef3-149">Veamos un ejemplo de lo que puede llevar a producir un comportamiento confuso.</span><span class="sxs-lookup"><span data-stu-id="5bef3-149">Let's look at an example of what can lead to a behavior that may seem confusing.</span></span> <span data-ttu-id="5bef3-150">Considere la siguiente secuencia.</span><span class="sxs-lookup"><span data-stu-id="5bef3-150">Consider the following sequence.</span></span>

1. <span data-ttu-id="5bef3-151">Imaginemos que hay 2 instancias inicialmente y después aumenta el número promedio de subprocesos por instancia a 625.</span><span class="sxs-lookup"><span data-stu-id="5bef3-151">Assume there are 2 instances to begin with and then the average number of threads per instance grows to 625.</span></span>
2. <span data-ttu-id="5bef3-152">El escalado automático escala horizontalmente agregando una tercera instancia.</span><span class="sxs-lookup"><span data-stu-id="5bef3-152">Autoscale scales out adding a 3rd instance.</span></span>
3. <span data-ttu-id="5bef3-153">Imaginemos ahora que el número promedio de subprocesos en la instancia se reduce a 575.</span><span class="sxs-lookup"><span data-stu-id="5bef3-153">Next, assume that the average thread count across instance falls to 575.</span></span>
4. <span data-ttu-id="5bef3-154">Antes de reducir verticalmente, el escalado automático intenta evaluar cuál será el estado final si reduce horizontalmente.</span><span class="sxs-lookup"><span data-stu-id="5bef3-154">Before scaling down, autoscale tries to estimate what the final state will be if it scaled in.</span></span> <span data-ttu-id="5bef3-155">Por ejemplo, 575 x 3 (número de instancias actual) = 1725/2 (número final de instancias al reducir verticalmente) = 862,5 subprocesos.</span><span class="sxs-lookup"><span data-stu-id="5bef3-155">For example, 575 x  3 (current instance count) = 1,725 / 2 (final number of instances when scaled down) = 862.5 threads.</span></span> <span data-ttu-id="5bef3-156">Esto significa que el escalado automático tiene que volver a escalar horizontalmente de inmediato (incluso después de haber reducido horizontalmente) si el número promedio de subprocesos sigue siendo el mismo o incluso si se reduce solo una pequeña cantidad.</span><span class="sxs-lookup"><span data-stu-id="5bef3-156">This means autoscale would have to immediately scale-out again even after it scaled in, if the average thread count remains the same or even falls only a small amount.</span></span> <span data-ttu-id="5bef3-157">Sin embargo, si se volviera a escalar verticalmente, todo el proceso se repetiría, dando lugar a un bucle infinito.</span><span class="sxs-lookup"><span data-stu-id="5bef3-157">However, if it scaled up again, the whole process would repeat, leading to an infinite loop.</span></span>
5. <span data-ttu-id="5bef3-158">Para evitar esta situación (conocida como "inestable"), el escalado automático nunca reduce verticalmente.</span><span class="sxs-lookup"><span data-stu-id="5bef3-158">To avoid this situation (termed "flapping"), autoscale does not scale down at all.</span></span> <span data-ttu-id="5bef3-159">En su lugar, pasa esto por alto y vuelve a evaluar la situación la siguiente vez que el trabajo del servicio se ejecuta.</span><span class="sxs-lookup"><span data-stu-id="5bef3-159">Instead, it skips and reevaluates the condition again the next time the service's job executes.</span></span> <span data-ttu-id="5bef3-160">Esto podría ser confuso para muchos usuarios, ya que puede dar la impresión de que el escalado automático no funciona cuando el número promedio de subprocesos es 575.</span><span class="sxs-lookup"><span data-stu-id="5bef3-160">This could confuse many people because autoscale wouldn't appear to work when the average thread count was 575.</span></span>

<span data-ttu-id="5bef3-161">La estimación durante una reducción horizontal está diseñada para evitar situaciones "oscilantes", donde las acciones de reducción horizontal y escalado horizontal avanzan y retroceden continuamente.</span><span class="sxs-lookup"><span data-stu-id="5bef3-161">Estimation during a scale-in is intended to avoid "flapping" situations, where scale-in and scale-out actions continually go back and forth.</span></span> <span data-ttu-id="5bef3-162">Recuerde este comportamiento cuando elija los mismos umbrales de escalado horizontal y reducción horizontal.</span><span class="sxs-lookup"><span data-stu-id="5bef3-162">Keep this behavior in mind when you choose the same thresholds for scale-out and in.</span></span>

<span data-ttu-id="5bef3-163">Nuestra recomendación es establecer un margen suficiente entre el escalado horizontal y en los umbrales.</span><span class="sxs-lookup"><span data-stu-id="5bef3-163">We recommend choosing an adequate margin between the scale-out and in thresholds.</span></span> <span data-ttu-id="5bef3-164">Por ejemplo, echemos un vistazo a esta siguiente combinación de reglas, que es mejor.</span><span class="sxs-lookup"><span data-stu-id="5bef3-164">As an example, consider the following better rule combination.</span></span>

* <span data-ttu-id="5bef3-165">Aumentar las instancias en 1 cuando el porcentaje de CPU > = 80</span><span class="sxs-lookup"><span data-stu-id="5bef3-165">Increase instances by 1 count when CPU%  >= 80</span></span>
* <span data-ttu-id="5bef3-166">Disminuir las instancias en 1 cuando el porcentaje de CPU > = 60</span><span class="sxs-lookup"><span data-stu-id="5bef3-166">Decrease instances by 1 count when CPU% <= 60</span></span>

<span data-ttu-id="5bef3-167">En este caso</span><span class="sxs-lookup"><span data-stu-id="5bef3-167">In this case</span></span>  

1. <span data-ttu-id="5bef3-168">Imaginemos que hay 2 instancias para empezar.</span><span class="sxs-lookup"><span data-stu-id="5bef3-168">Assume there are 2 instances to start with.</span></span>
2. <span data-ttu-id="5bef3-169">Si el promedio de porcentaje de CPU entre instancias llega a 80, el escalado automático escala horizontalmente agregando una tercera instancia.</span><span class="sxs-lookup"><span data-stu-id="5bef3-169">If the average CPU% across instances goes to 80, autoscale scales out adding a third instance.</span></span>
3. <span data-ttu-id="5bef3-170">Imaginemos ahora que, con el tiempo, el porcentaje de CPU cae a 60.</span><span class="sxs-lookup"><span data-stu-id="5bef3-170">Now assume that over time the CPU% falls to 60.</span></span>
4. <span data-ttu-id="5bef3-171">La regla de reducción horizontal del escalado automático calcula el estado final como si fuese a reducirse horizontalmente.</span><span class="sxs-lookup"><span data-stu-id="5bef3-171">Autoscale's scale-in rule estimates the final state if it were to scale-in.</span></span> <span data-ttu-id="5bef3-172">Por ejemplo, 60 x 3 (número de instancias actual) = 180/2 (número final de instancias al reducir verticalmente) = 90.</span><span class="sxs-lookup"><span data-stu-id="5bef3-172">For example, 60 x 3 (current instance count) = 180 / 2 (final number of instances when scaled down) = 90.</span></span> <span data-ttu-id="5bef3-173">Por tanto, el escalado automático no reduce horizontalmente porque tendría que volver a escalar horizontalmente de inmediato.</span><span class="sxs-lookup"><span data-stu-id="5bef3-173">So autoscale does not scale-in because it would have to scale-out again immediately.</span></span> <span data-ttu-id="5bef3-174">En su lugar, omite la reducción vertical.</span><span class="sxs-lookup"><span data-stu-id="5bef3-174">Instead, it skips scaling down.</span></span>
5. <span data-ttu-id="5bef3-175">La próxima vez que comprueba el escalado automático, la CPU ha seguido cayendo a 50.</span><span class="sxs-lookup"><span data-stu-id="5bef3-175">The next time autoscale checks, the CPU continues to fall to 50.</span></span> <span data-ttu-id="5bef3-176">Vuelve a calcular: 50 x 3 instancias = 150/2 instancias = 75, lo que está por debajo del umbral de escalado horizontal de 80. Por tanto, reduce horizontalmente a 2 instancias.</span><span class="sxs-lookup"><span data-stu-id="5bef3-176">It estimates again -  50 x 3 instance = 150 / 2 instances = 75, which is below the scale-out threshold of 80, so it scales in successfully to 2 instances.</span></span>

### <a name="considerations-for-scaling-threshold-values-for-special-metrics"></a><span data-ttu-id="5bef3-177">Consideraciones para establecer valores de umbral de escalado en métricas especiales</span><span class="sxs-lookup"><span data-stu-id="5bef3-177">Considerations for scaling threshold values for special metrics</span></span>
 <span data-ttu-id="5bef3-178">En el caso de las métricas especiales, como la métrica longitud de cola de Service Bus o de almacenamiento, el umbral es el promedio de mensajes disponibles por número actual de instancias.</span><span class="sxs-lookup"><span data-stu-id="5bef3-178">For special metrics such as Storage or Service Bus Queue length metric, the threshold is the average number of messages available per current number of instances.</span></span> <span data-ttu-id="5bef3-179">Elija cuidadosamente el valor de umbral para esta métrica.</span><span class="sxs-lookup"><span data-stu-id="5bef3-179">Carefully choose the choose the threshold value for this metric.</span></span>

<span data-ttu-id="5bef3-180">Veamos esto con un ejemplo para procurar que entienda el comportamiento de mejor forma.</span><span class="sxs-lookup"><span data-stu-id="5bef3-180">Let's illustrate it with an example to ensure you understand the behavior better.</span></span>

* <span data-ttu-id="5bef3-181">Aumentar las instancias en 1 cuando el número de mensajes de la cola de almacenamiento > = 50</span><span class="sxs-lookup"><span data-stu-id="5bef3-181">Increase instances by 1 count when Storage Queue message count >= 50</span></span>
* <span data-ttu-id="5bef3-182">Disminuir las instancias en 1 cuando el número de mensajes de la cola de almacenamiento < = 10</span><span class="sxs-lookup"><span data-stu-id="5bef3-182">Decrease instances by 1 count when Storage Queue message count <= 10</span></span>

<span data-ttu-id="5bef3-183">Considere la siguiente secuencia:</span><span class="sxs-lookup"><span data-stu-id="5bef3-183">Consider the following sequence:</span></span>

1. <span data-ttu-id="5bef3-184">Hay dos instancias de la cola de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="5bef3-184">There are 2 storage queue instances.</span></span>
2. <span data-ttu-id="5bef3-185">Siguen llegando mensajes y, al revisar la cola de almacenamiento, el recuento total es 50.</span><span class="sxs-lookup"><span data-stu-id="5bef3-185">Messages keep coming and when you review the storage queue, the total count reads 50.</span></span> <span data-ttu-id="5bef3-186">Se supone que el escalado automático tendría que iniciar una acción de escalado horizontal.</span><span class="sxs-lookup"><span data-stu-id="5bef3-186">You might assume that autoscale should start a scale-out action.</span></span> <span data-ttu-id="5bef3-187">Sin embargo, vemos que sigue siendo de 50/2 = 25 mensajes por instancia.</span><span class="sxs-lookup"><span data-stu-id="5bef3-187">However, note that it is still 50/2 = 25 messages per instance.</span></span> <span data-ttu-id="5bef3-188">Por lo tanto, el escalado horizontal no se ha producido.</span><span class="sxs-lookup"><span data-stu-id="5bef3-188">So, scale-out does not occur.</span></span> <span data-ttu-id="5bef3-189">Para que el primer escalado horizontal se produzca, el número total de mensajes en la cola de almacenamiento debe ser 100.</span><span class="sxs-lookup"><span data-stu-id="5bef3-189">For the first scale-out to happen, the total message count in the storage queue should be 100.</span></span>
3. <span data-ttu-id="5bef3-190">Tras esto, imaginemos que el número total de mensajes llega a 100.</span><span class="sxs-lookup"><span data-stu-id="5bef3-190">Next, assume that the total message count reaches 100.</span></span>
4. <span data-ttu-id="5bef3-191">Se agrega una tercera instancia de la cola de almacenamiento debido a una acción de escalado horizontal.</span><span class="sxs-lookup"><span data-stu-id="5bef3-191">A 3rd storage queue instance is added due to a scale-out action.</span></span>  <span data-ttu-id="5bef3-192">La siguiente acción de escalado horizontal no tendrá lugar hasta que el número total de mensajes en la cola llegue a 150 porque 150/3 = 50.</span><span class="sxs-lookup"><span data-stu-id="5bef3-192">The next scale-out action will not happen until the total message count in the queue reaches 150 because 150/3 = 50.</span></span>
5. <span data-ttu-id="5bef3-193">Ahora, disminuye el número de mensajes en la cola.</span><span class="sxs-lookup"><span data-stu-id="5bef3-193">Now the number of messages in the queue gets smaller.</span></span> <span data-ttu-id="5bef3-194">Con tres instancias, la primera acción de reducción horizontal ocurre cuando el número total de mensajes en la cola llega a 30 porque 30/3 = 10 mensajes por instancia, que es el umbral de reducción horizontal.</span><span class="sxs-lookup"><span data-stu-id="5bef3-194">With 3 instances, the first scale-in action happens when the total messages in all queues add up to 30 because 30/3 = 10 messages per instance, which is the scale-in threshold.</span></span>

### <a name="considerations-for-scaling-when-multiple-profiles-are-configured-in-an-autoscale-setting"></a><span data-ttu-id="5bef3-195">Consideraciones de escalado cuando hay varios perfiles configurados en una configuración de escalado automático</span><span class="sxs-lookup"><span data-stu-id="5bef3-195">Considerations for scaling when multiple profiles are configured in an autoscale setting</span></span>
<span data-ttu-id="5bef3-196">En una configuración de escalado automático, puede elegir un perfil predeterminado, que se aplica siempre (independientemente de programaciones o períodos de tiempo), o bien optar por perfil periódico o por un perfil para un período fijo con una fecha y un intervalo de tiempo.</span><span class="sxs-lookup"><span data-stu-id="5bef3-196">In an autoscale setting, you can choose a default profile, which is always applied without any dependency on schedule or time, or you can choose a recurring profile or a profile for a fixed period with a date and time range.</span></span>

<span data-ttu-id="5bef3-197">Cuando el servicio de escalado automático procesa estos perfiles, siempre los comprueba en el siguiente orden:</span><span class="sxs-lookup"><span data-stu-id="5bef3-197">When autoscale service processes them, it always checks in the following order:</span></span>

1. <span data-ttu-id="5bef3-198">Perfil de fecha fija</span><span class="sxs-lookup"><span data-stu-id="5bef3-198">Fixed Date profile</span></span>
2. <span data-ttu-id="5bef3-199">Perfil periódico</span><span class="sxs-lookup"><span data-stu-id="5bef3-199">Recurring profile</span></span>
3. <span data-ttu-id="5bef3-200">Perfil predeterminado ("Siempre")</span><span class="sxs-lookup"><span data-stu-id="5bef3-200">Default ("Always") profile</span></span>

<span data-ttu-id="5bef3-201">Si se cumple una condición de perfil, el escalado automático no comprobará la siguiente condición de perfil por debajo de este.</span><span class="sxs-lookup"><span data-stu-id="5bef3-201">If a profile condition is met, autoscale does not check the next profile condition below it.</span></span> <span data-ttu-id="5bef3-202">El escalado automático solo procesa un perfil cada vez.</span><span class="sxs-lookup"><span data-stu-id="5bef3-202">Autoscale only processes one profile at a time.</span></span> <span data-ttu-id="5bef3-203">Esto significa que, si queremos incluir una condición de procesamiento de un perfil de nivel inferior, tendremos que incluir también las reglas del perfil actual.</span><span class="sxs-lookup"><span data-stu-id="5bef3-203">This means if you want to also include a processing condition from a lower-tier profile, you must include those rules as well in the current profile.</span></span>

<span data-ttu-id="5bef3-204">Analicemos esto con un ejemplo:</span><span class="sxs-lookup"><span data-stu-id="5bef3-204">Let's review this using an example:</span></span>

<span data-ttu-id="5bef3-205">La siguiente imagen muestra una configuración de escalado automático con un perfil predeterminado con un número de instancias mínimo = 2 y un número de instancias máximo = 10.</span><span class="sxs-lookup"><span data-stu-id="5bef3-205">The image below shows an autoscale setting with a default profile of minimum instances = 2 and maximum instances = 10.</span></span> <span data-ttu-id="5bef3-206">En este ejemplo, las reglas están configuradas para escalar horizontalmente cuando el número de mensajes en la cola sea mayor que 10 y, asimismo, reducir horizontalmente cuando el número de mensajes en la cola sea inferior a 3.</span><span class="sxs-lookup"><span data-stu-id="5bef3-206">In this example, rules are configured to scale-out when the message count in the queue is greater than 10 and scale-in when the message count in the queue is less than 3.</span></span> <span data-ttu-id="5bef3-207">Ahora el recurso puede escalar entre 2 y 10 instancias.</span><span class="sxs-lookup"><span data-stu-id="5bef3-207">So now the resource can scale between 2 and 10 instances.</span></span>

<span data-ttu-id="5bef3-208">Además, hay un perfil periódico establecido para el lunes.</span><span class="sxs-lookup"><span data-stu-id="5bef3-208">In addition, there is a recurring profile set for Monday.</span></span> <span data-ttu-id="5bef3-209">Está configurado para un número de instancias mínimo = 2 y un número de instancias máximo = 12.</span><span class="sxs-lookup"><span data-stu-id="5bef3-209">It is set for minimum instances = 2 and maximum instances = 12.</span></span> <span data-ttu-id="5bef3-210">Esto significa que, la primera vez que el escalado automático compruebe esta condición el lunes, si el recuento de instancias es 2, lo escala al nuevo mínimo de 3.</span><span class="sxs-lookup"><span data-stu-id="5bef3-210">This means on Monday, the first time autoscale checks for this condition, if the instance count is 2, it scales to the new minimum of 3.</span></span> <span data-ttu-id="5bef3-211">Mientras el escalado automático siga encontrando una coincidencia con esta condición de perfil (lunes), solo procesa las reglas de escalado/reducción horizontal basadas en CPU configuradas en este perfil.</span><span class="sxs-lookup"><span data-stu-id="5bef3-211">As long as autoscale continues to find this profile condition matched (Monday), it only processes the CPU-based scale-out/in rules configured for this profile.</span></span> <span data-ttu-id="5bef3-212">En este momento, no comprueba la longitud de la cola.</span><span class="sxs-lookup"><span data-stu-id="5bef3-212">At this time, it does not check for the queue length.</span></span> <span data-ttu-id="5bef3-213">Sin embargo, si queremos que compruebe la condición de longitud de cola, tendremos que incluir esas reglas del perfil predeterminado también en el perfil del lunes.</span><span class="sxs-lookup"><span data-stu-id="5bef3-213">However, if you also want the queue length condition to be checked, you should include those rules from the default profile as well in your Monday profile.</span></span>

<span data-ttu-id="5bef3-214">De forma similar, cuando el escalado automático regresa al perfil predeterminado, primero comprueba si se cumplen las condiciones mínima y máxima.</span><span class="sxs-lookup"><span data-stu-id="5bef3-214">Similarly, when autoscale switches back to the default profile, it first checks if the minimum and maximum conditions are met.</span></span> <span data-ttu-id="5bef3-215">Si el número de instancias en ese momento es 12, reducirá horizontalmente a 10, que es el máximo permitido en el perfil predeterminado.</span><span class="sxs-lookup"><span data-stu-id="5bef3-215">If the number of instances at the time is 12, it scales in to 10, the maximum allowed for the default profile.</span></span>

![configuración de escalado automático](./media/insights-autoscale-best-practices/insights-autoscale-best-practices-2.png)

### <a name="considerations-for-scaling-when-multiple-rules-are-configured-in-a-profile"></a><span data-ttu-id="5bef3-217">Consideraciones de escalado cuando hay varias reglas configuradas en un perfil</span><span class="sxs-lookup"><span data-stu-id="5bef3-217">Considerations for scaling when multiple rules are configured in a profile</span></span>
<span data-ttu-id="5bef3-218">Hay casos en los que puede que sea necesario establecer varias reglas en un perfil.</span><span class="sxs-lookup"><span data-stu-id="5bef3-218">There are cases where you may have to set multiple rules in a profile.</span></span> <span data-ttu-id="5bef3-219">Cuando se establecen varias reglas, los servicios usan el siguiente conjunto de reglas de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="5bef3-219">The following set of autoscale rules are used by services use when multiple rules are set.</span></span>

<span data-ttu-id="5bef3-220">Al *escalar horizontalmente*, el escalado automático se ejecuta si se cumple cualquier regla.</span><span class="sxs-lookup"><span data-stu-id="5bef3-220">On *scale out*, autoscale runs if any rule is met.</span></span>
<span data-ttu-id="5bef3-221">Al *reducir horizontalmente*, el escalado automático necesita que todas las reglas se cumplan.</span><span class="sxs-lookup"><span data-stu-id="5bef3-221">On *scale-in*, autoscale require all rules to be met.</span></span>

<span data-ttu-id="5bef3-222">Para ilustrar esto, imaginemos que tiene las siguientes 4 reglas de escalado automático:</span><span class="sxs-lookup"><span data-stu-id="5bef3-222">To illustrate, assume that you have the following 4 autoscale rules:</span></span>

* <span data-ttu-id="5bef3-223">Con una CPU < 30 %, se reduce horizontalmente en 1</span><span class="sxs-lookup"><span data-stu-id="5bef3-223">If CPU < 30 %, scale-in by 1</span></span>
* <span data-ttu-id="5bef3-224">Con una memoria < 50 %, se reduce horizontalmente en 1</span><span class="sxs-lookup"><span data-stu-id="5bef3-224">If Memory < 50%, scale-in by 1</span></span>
* <span data-ttu-id="5bef3-225">Con una CPU> 75 %, se escala horizontalmente en 1</span><span class="sxs-lookup"><span data-stu-id="5bef3-225">If CPU > 75%, scale-out by 1</span></span>
* <span data-ttu-id="5bef3-226">Con una memoria > 75 %, se escala horizontalmente en 1</span><span class="sxs-lookup"><span data-stu-id="5bef3-226">If Memory > 75%, scale-out by 1</span></span>

<span data-ttu-id="5bef3-227">Por tanto, sucederá lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="5bef3-227">Then the follow occurs:</span></span>

* <span data-ttu-id="5bef3-228">Con una CPU del 76 % y una memoria del 50 %, se escala horizontalmente.</span><span class="sxs-lookup"><span data-stu-id="5bef3-228">If CPU is 76% and Memory is 50%, we scale-out.</span></span>
* <span data-ttu-id="5bef3-229">Con una CPU del 50 % y una memoria del 76 %, se escala horizontalmente.</span><span class="sxs-lookup"><span data-stu-id="5bef3-229">If CPU is 50% and Memory is 76% we scale-out.</span></span>

<span data-ttu-id="5bef3-230">Por otro lado, con una CPU del 25 % y una memoria del 51 %, el escalado automático **no** reduce horizontalmente.</span><span class="sxs-lookup"><span data-stu-id="5bef3-230">On the other hand, if CPU is 25% and memory is 51% autoscale does **not** scale-in.</span></span> <span data-ttu-id="5bef3-231">Para ello, la CPU debe ser 29 % y la memoria, 49 %.</span><span class="sxs-lookup"><span data-stu-id="5bef3-231">In order to scale-in, CPU must be 29% and Memory 49%.</span></span>

### <a name="always-select-a-safe-default-instance-count"></a><span data-ttu-id="5bef3-232">Seleccione siempre un número predeterminado de instancias seguro</span><span class="sxs-lookup"><span data-stu-id="5bef3-232">Always select a safe default instance count</span></span>
<span data-ttu-id="5bef3-233">El número predeterminado de instancias es importante, porque el escalado automático escala el servicio a dicho número cuando no haya métricas disponibles.</span><span class="sxs-lookup"><span data-stu-id="5bef3-233">The default instance count is important autoscale scales your service to that count when metrics are not available.</span></span> <span data-ttu-id="5bef3-234">Por tanto, seleccione un número predeterminado de instancias que sea seguro para sus cargas de trabajo.</span><span class="sxs-lookup"><span data-stu-id="5bef3-234">Therefore, select a default instance count that's safe for your workloads.</span></span>

### <a name="configure-autoscale-notifications"></a><span data-ttu-id="5bef3-235">Configure notificaciones de escalado automático</span><span class="sxs-lookup"><span data-stu-id="5bef3-235">Configure autoscale notifications</span></span>
<span data-ttu-id="5bef3-236">El escalado automático notifica a los administradores y a los colaboradores del recurso por correo electrónico cuando se produce alguna de las siguientes condiciones:</span><span class="sxs-lookup"><span data-stu-id="5bef3-236">Autoscale notifies the administrators and contributors of the resource by email if any of the following conditions occur:</span></span>

* <span data-ttu-id="5bef3-237">El servicio de escalado automático no puede realizar una acción.</span><span class="sxs-lookup"><span data-stu-id="5bef3-237">autoscale service fails to take an action.</span></span>
* <span data-ttu-id="5bef3-238">No hay métricas disponibles para que el servicio de escalado automático tome una decisión de escalado.</span><span class="sxs-lookup"><span data-stu-id="5bef3-238">Metrics are not available for autoscale service to make a scale decision.</span></span>
* <span data-ttu-id="5bef3-239">Vuelve a haber métricas disponibles (recuperación) para poder tomar una decisión de escalado.</span><span class="sxs-lookup"><span data-stu-id="5bef3-239">Metrics are available (recovery) again to make a scale decision.</span></span>
  <span data-ttu-id="5bef3-240">Aparte de las condiciones anteriores, puede configurar notificaciones de correo electrónico o webhook para recibir una notificación cada vez que se lleve a cabo una acción de escalado correcta.</span><span class="sxs-lookup"><span data-stu-id="5bef3-240">In addition to the conditions above, you can configure email or webhook notifications to get notified for successful scale actions.</span></span>
  
<span data-ttu-id="5bef3-241">También puede usar una alerta de registro de actividades para supervisar el mantenimiento del motor de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="5bef3-241">You can also use an Activity Log alert to monitor the health of the autoscale engine.</span></span> <span data-ttu-id="5bef3-242">Aquí puede ver ejemplos para [crear una alerta de registro de actividades para supervisar todas las operaciones del motor de escalado automático en su suscripción](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert) o para [crear una alerta de registro de actividades para supervisar todas las operaciones con errores de escalado automático y reducción horizontal en su suscripción](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert).</span><span class="sxs-lookup"><span data-stu-id="5bef3-242">Here are examples to [create an Activity Log Alert to monitor all autoscale engine operations on your subscription](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert) or to [create an Activity Log Alert to monitor all failed autoscale scale in/scale out operations on your subscription](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert).</span></span>

## <a name="next-steps"></a><span data-ttu-id="5bef3-243">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="5bef3-243">Next Steps</span></span>
- [<span data-ttu-id="5bef3-244">Creación de una alerta de registro de actividades para supervisar todas las operaciones del motor de escalado automático en su suscripción</span><span class="sxs-lookup"><span data-stu-id="5bef3-244">Create an Activity Log Alert to monitor all autoscale engine operations on your subscription.</span></span>](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert)
- [<span data-ttu-id="5bef3-245">Cree una alerta de registro de actividades para supervisar todas las operaciones con errores de escalado automático y reducción horizontal en su suscripción.</span><span class="sxs-lookup"><span data-stu-id="5bef3-245">Create an Activity Log Alert to monitor all failed autoscale scale in/scale out operations on your subscription</span></span>](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert)

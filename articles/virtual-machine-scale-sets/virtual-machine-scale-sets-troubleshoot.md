---
title: "escalado automático aaaTroubleshoot con conjuntos de escalas de máquina Virtual | Documentos de Microsoft"
description: "Solución de problemas de escalado automático de conjuntos de escalado de máquinas virtuales. Comprender los problemas típicos que se producen y cómo tooresolve ellos."
services: virtual-machine-scale-sets
documentationcenter: 
author: gbowerman
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: c7d87b72-ee24-4e52-9377-a42f337f76fa
ms.service: virtual-machine-scale-sets
ms.workload: na
ms.tgt_pltfrm: windows
ms.devlang: na
ms.topic: article
ms.date: 10/28/2016
ms.author: guybo
ms.openlocfilehash: 4c9a70992348d87fb43646421a90a027bf400a17
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="troubleshooting-autoscale-with-virtual-machine-scale-sets"></a><span data-ttu-id="8137d-104">Solución de problemas de escalado automático de conjuntos de escalado de máquinas virtuales</span><span class="sxs-lookup"><span data-stu-id="8137d-104">Troubleshooting autoscale with Virtual Machine Scale Sets</span></span>
<span data-ttu-id="8137d-105">**Problema** : se ha creado una infraestructura de escalado automático en Azure Resource Manager mediante conjuntos de escalas de VM: por ejemplo mediante la implementación de una plantilla similar al siguiente: https://github.com/Azure/azure-quickstart-templates/tree/master/201- vmss-bottle-escalado automático: dispone de las reglas de escala definidas y funciona bien, salvo que independientemente de cuánta carga, se coloca en hello las máquinas virtuales, no lo hará de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="8137d-105">**Problem** – you’ve created an autoscaling infrastructure in Azure Resource Manager using VM Scale Sets –  for example by deploying a template like this: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale  – you have your scale rules defined and it works great, except that no matter how much load you put on hello VMs, it won’t autoscale.</span></span>

## <a name="troubleshooting-steps"></a><span data-ttu-id="8137d-106">Pasos para solucionar problemas</span><span class="sxs-lookup"><span data-stu-id="8137d-106">Troubleshooting steps</span></span>
<span data-ttu-id="8137d-107">Algunas cosas tooconsider incluyen:</span><span class="sxs-lookup"><span data-stu-id="8137d-107">Some things tooconsider include:</span></span>

* <span data-ttu-id="8137d-108">¿El número de núcleos tiene cada máquina virtual y se carga cada núcleo? plantilla de inicio rápido de Azure de ejemplo de Hola anterior tiene una secuencia de comandos do_work.php, que carga un único núcleo.</span><span class="sxs-lookup"><span data-stu-id="8137d-108">How many cores does each VM have, and are you loading each core? hello example Azure Quickstart template above has a do_work.php script, which loads a single core.</span></span> <span data-ttu-id="8137d-109">Si está usando una máquina virtual supera el tamaño de máquina virtual a un único núcleo como Standard_A1 o D1, a continuación, se necesitaría toorun esta carga varias veces.</span><span class="sxs-lookup"><span data-stu-id="8137d-109">If you’re using a VM bigger than a single core VM size like Standard_A1 or D1 then you’d need toorun this load multiple times.</span></span> <span data-ttu-id="8137d-110">Compruebe el número de núcleos de las máquinas virtuales después de consultar [Tamaños de las máquinas virtuales Windows en Azure](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="8137d-110">Check how many cores your VMs by reviewing [Sizes for Windows virtual machines in Azure](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="8137d-111">¿Cuántas máquinas virtuales en hello conjunto de escalado de máquinas virtuales, está realizando trabajo en cada uno de ellos?</span><span class="sxs-lookup"><span data-stu-id="8137d-111">How many VMs in hello VM Scale Set, are you doing work on each one?</span></span>
  
    <span data-ttu-id="8137d-112">Un evento de ampliación sólo llevará a cabo cuando Hola promedio de CPU a través de **todos los** hello las máquinas virtuales en un conjunto de escala supera Hola valor de umbral con el tiempo de hello interno definido en las reglas de escalado automático de Hola.</span><span class="sxs-lookup"><span data-stu-id="8137d-112">A scale out event will only take place when hello average CPU across **all** hello VMs in a scale set exceeds hello threshold value, over hello time internal defined in hello autoscale rules.</span></span>
* <span data-ttu-id="8137d-113">¿Falta cualquier evento de escalado?</span><span class="sxs-lookup"><span data-stu-id="8137d-113">Did you miss any scale events?</span></span>
  
    <span data-ttu-id="8137d-114">Compruebe los registros de auditoría de Hola Hola portal de Azure para eventos de escala.</span><span class="sxs-lookup"><span data-stu-id="8137d-114">Check hello audit logs in hello Azure portal for scale events.</span></span> <span data-ttu-id="8137d-115">Tal vez se haya producido un escalado o una reducción vertical que se ha perdido.</span><span class="sxs-lookup"><span data-stu-id="8137d-115">Maybe there was a scale up and a scale down which was missed.</span></span> <span data-ttu-id="8137d-116">Puede filtrar por “Escala”...</span><span class="sxs-lookup"><span data-stu-id="8137d-116">You can filter by “Scale”..</span></span>
  
    ![Registros de auditoría][audit]
* <span data-ttu-id="8137d-118">¿Son los umbrales de reducción y escalado horizontal suficientemente diferentes?</span><span class="sxs-lookup"><span data-stu-id="8137d-118">Are your scale-in and scale-out thresholds sufficiently different?</span></span>
  
    <span data-ttu-id="8137d-119">Imagine que establece una regla tooscale cuando la CPU promedio es mayor que 50% más de 5 minutos y tooscale en cuando la CPU promedio es inferior al 50%.</span><span class="sxs-lookup"><span data-stu-id="8137d-119">Suppose you set a rule tooscale out when average CPU is greater than 50% over 5 minutes, and tooscale in when average CPU is less than 50%.</span></span> <span data-ttu-id="8137d-120">Esto provocaría que un problema "aleteo" cuando el uso de CPU es umbral toothis cerrar, con acciones de escalado Hola constantemente aumentar y disminuir el tamaño del conjunto de Hola.</span><span class="sxs-lookup"><span data-stu-id="8137d-120">This would cause a “flapping” problem when CPU usage is close toothis threshold, with scale actions constantly increasing and decreasing hello size of hello set.</span></span> <span data-ttu-id="8137d-121">Por este motivo, servicio de escalado automático de hello intenta tooprevent "oscilante", que puede presentarse como no escalar.</span><span class="sxs-lookup"><span data-stu-id="8137d-121">Because of this, hello autoscale service tries tooprevent “flapping”, which can manifest as not scaling.</span></span> <span data-ttu-id="8137d-122">Por lo tanto, asegúrese de que la escalabilidad y umbrales de escala son lo suficientemente diferente tooallow libere espacio entre el ajuste de escala.</span><span class="sxs-lookup"><span data-stu-id="8137d-122">Therefore make sure your scale-out and scale-in thresholds are sufficiently different tooallow some space in between scaling.</span></span>
* <span data-ttu-id="8137d-123">¿Escribió su propia plantilla JSON?</span><span class="sxs-lookup"><span data-stu-id="8137d-123">Did you write your own JSON template?</span></span>
  
    <span data-ttu-id="8137d-124">Es fácil toomake errores, por lo que empezar con una plantilla como Hola uno por encima del cual se pueda demostrar toowork y realizar pequeños cambios incrementales.</span><span class="sxs-lookup"><span data-stu-id="8137d-124">It is easy toomake mistakes, so start with a template like hello one above which is proven toowork, and make small incremental changes.</span></span> 
* <span data-ttu-id="8137d-125">¿Puede escalar o reducir horizontalmente de forma manual?</span><span class="sxs-lookup"><span data-stu-id="8137d-125">Can you manually scale in or out?</span></span>
  
    <span data-ttu-id="8137d-126">Intente volver a implementar Hola recurso de conjunto de escala de máquinas virtuales con un número de "capacidad" diferente configuración toochange Hola de máquinas virtuales manualmente.</span><span class="sxs-lookup"><span data-stu-id="8137d-126">Try redeploying hello VM Scale Set resource with a different “capacity” setting toochange hello number of VMs manually.</span></span> <span data-ttu-id="8137d-127">Un toodo de plantilla de ejemplo se trata aquí: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing: puede que necesite tooedit Hola plantilla toomake seguro tiene Hola mismo tamaño de la máquina como el conjunto de escala está usando.</span><span class="sxs-lookup"><span data-stu-id="8137d-127">An example template toodo this is here: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing – you may need tooedit hello template toomake sure it has hello same machine size as your Scale Set is using.</span></span> <span data-ttu-id="8137d-128">Si correctamente puede cambiar manualmente número Hola de máquinas virtuales, a continuación, se sabe que el problema de hello está aislado tooautoscale.</span><span class="sxs-lookup"><span data-stu-id="8137d-128">If you can successfully change hello number of VMs manually, then you know hello problem is isolated tooautoscale.</span></span>
* <span data-ttu-id="8137d-129">Compruebe su Microsoft.Compute/virtualMachineScaleSet y los recursos de Microsoft.Insights Hola [Explorador de recursos de Azure](https://resources.azure.com/)</span><span class="sxs-lookup"><span data-stu-id="8137d-129">Check your Microsoft.Compute/virtualMachineScaleSet, and Microsoft.Insights resources in hello [Azure Resource Explorer](https://resources.azure.com/)</span></span>
  
    <span data-ttu-id="8137d-130">Se trata de un indispensables Hola a solucionar problemas de herramienta que se muestra el estado de los recursos de Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="8137d-130">This is an indispensable troubleshooting tool which shows you hello state of your Azure Resource Manager resources.</span></span> <span data-ttu-id="8137d-131">Haga clic en la suscripción y examine Hola está solucionando el grupo de recursos.</span><span class="sxs-lookup"><span data-stu-id="8137d-131">Click on your subscription and look at hello Resource Group you are troubleshooting.</span></span> <span data-ttu-id="8137d-132">En el proveedor de recursos de proceso de hello, examine Hola conjunto de escalado de máquina virtual que creó y compruebe Hola vista de instancia, que se muestra hello estado de una implementación.</span><span class="sxs-lookup"><span data-stu-id="8137d-132">Under hello Compute resource provider look at hello VM Scale Set you created and check hello Instance View, which shows you hello state of a deployment.</span></span> <span data-ttu-id="8137d-133">Compruebe también la vista de instancia de Hola Hola conjunto de escalado de máquinas virtuales de máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="8137d-133">Also check hello instance view of VMs in hello VM Scale Set.</span></span> <span data-ttu-id="8137d-134">A continuación, pasa a proveedor de recursos de hello Microsoft.Insights y comprobar las reglas de escalado automático de hello muestren correctamente.</span><span class="sxs-lookup"><span data-stu-id="8137d-134">Then go into hello Microsoft.Insights resource provider and check hello autoscale rules look good.</span></span>
* <span data-ttu-id="8137d-135">¿Hola extensión diagnóstico trabajando y emitir los datos de rendimiento?</span><span class="sxs-lookup"><span data-stu-id="8137d-135">Is hello Diagnostic extension working and emitting performance data?</span></span>
  
    <span data-ttu-id="8137d-136">**Update:** escalado automático de Azure ha sido mejorada toouse canalización métricas que ya no requiere un toobe de extensión de diagnósticos instalado basado en un host.</span><span class="sxs-lookup"><span data-stu-id="8137d-136">**Update:** Azure autoscale has been enhanced toouse a host based metrics pipeline which no longer requires a diagnostics extension toobe installed.</span></span> <span data-ttu-id="8137d-137">Esto significa Hola de los próximos párrafos dejará de aplicarse si crea una aplicación de escalado automático mediante Hola nueva canalización.</span><span class="sxs-lookup"><span data-stu-id="8137d-137">This means hello next few paragraphs no longer apply if you create an autoscaling application using hello new pipeline.</span></span> <span data-ttu-id="8137d-138">Un ejemplo de plantillas de Azure que hayan sido canalización de host de hello toouse convertido es: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale.</span><span class="sxs-lookup"><span data-stu-id="8137d-138">An example of Azure templates which have been converted toouse hello host pipeline is: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale.</span></span> 
  
    <span data-ttu-id="8137d-139">Usar las métricas de basada en host para el escalado automático es mejor para hello siguientes motivos:</span><span class="sxs-lookup"><span data-stu-id="8137d-139">Using host based metrics for autoscale is better for hello following reasons:</span></span>
  
  * <span data-ttu-id="8137d-140">Menos partes móviles como ninguna extensión de diagnóstico deben toobe instalado.</span><span class="sxs-lookup"><span data-stu-id="8137d-140">Fewer moving parts as no diagnostics extensions need toobe installed.</span></span>
  * <span data-ttu-id="8137d-141">Plantillas más sencillas.</span><span class="sxs-lookup"><span data-stu-id="8137d-141">Simpler templates.</span></span> <span data-ttu-id="8137d-142">Basta con Agregar conjunto de escalado de existente de tooan de reglas de escalado automático de visión de plantilla.</span><span class="sxs-lookup"><span data-stu-id="8137d-142">Just add insights autoscale rules tooan existing scale set template.</span></span>
  * <span data-ttu-id="8137d-143">Informes más confiable e inicio rápido de nuevas máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="8137d-143">More reliable reporting and faster launching of new VMs.</span></span>
    
    <span data-ttu-id="8137d-144">Hello solo razones por las que debería tookeep mediante una extensión de diagnóstico sería si necesita memoria diagnóstico reporting/ajuste de escala.</span><span class="sxs-lookup"><span data-stu-id="8137d-144">hello only reasons you might want tookeep using a diagnostic extension would be if you need memory diagnostics reporting/scaling.</span></span> <span data-ttu-id="8137d-145">Las métricas basadas en host no informan sobre memoria.</span><span class="sxs-lookup"><span data-stu-id="8137d-145">Host based metrics doesn't report memory.</span></span>
    
    <span data-ttu-id="8137d-146">Con esto en mente, siga sólo rest Hola de este artículo si todavía está usando extensiones de diagnóstico para el escalado automático.</span><span class="sxs-lookup"><span data-stu-id="8137d-146">With that in mind, only follow hello rest of this article if you are still using diagnostic extensions for your autoscaling.</span></span>
    
    <span data-ttu-id="8137d-147">Escalado automático en el Administrador de recursos de Azure puede funcionar (pero ya no tiene que) por medio de una extensión de máquina virtual denominada Hola extensión de diagnósticos.</span><span class="sxs-lookup"><span data-stu-id="8137d-147">Autoscale in Azure Resource Manager can work (but no longer has to) by means of a VM extension called hello Diagnostics Extension.</span></span> <span data-ttu-id="8137d-148">Emite la cuenta de almacenamiento de rendimiento datos tooa que se define en la plantilla de Hola.</span><span class="sxs-lookup"><span data-stu-id="8137d-148">It emits performance data tooa storage account you define in hello template.</span></span> <span data-ttu-id="8137d-149">Servicio de Monitor de Azure de hello, a continuación, agrega estos datos.</span><span class="sxs-lookup"><span data-stu-id="8137d-149">This data is then aggregated by hello Azure Monitor service.</span></span>
    
    <span data-ttu-id="8137d-150">Si Hola servicio visión no puede leer datos de hello las máquinas virtuales, se supone que toosend un correo electrónico: por ejemplo, si las máquinas virtuales de hello estuvieran inactivos, de ser así, comprobar el correo electrónico (Hola especificada al crear la cuenta de Azure hello).</span><span class="sxs-lookup"><span data-stu-id="8137d-150">If hello Insights service can’t read data from hello VMs, it is supposed toosend you an email – for example if hello VMs were down, so check your email (hello one you specified when creating hello Azure account).</span></span>
    
    <span data-ttu-id="8137d-151">También puede ir y buscar datos Hola.</span><span class="sxs-lookup"><span data-stu-id="8137d-151">You can also go and look at hello data yourself.</span></span> <span data-ttu-id="8137d-152">Mire Hola cuenta de almacenamiento de Azure mediante un explorador en la nube.</span><span class="sxs-lookup"><span data-stu-id="8137d-152">Look at hello Azure storage account using a cloud explorer.</span></span> <span data-ttu-id="8137d-153">Por ejemplo si se usa hello [Explorador de Visual Studio en la nube](https://visualstudiogallery.msdn.microsoft.com/aaef6e67-4d99-40bc-aacf-662237db85a2), inicie sesión y seleccionar Hola suscripción de Azure que está usando y Hola cuenta de almacenamiento de diagnóstico hacer referencia al nombre en hello definición de extensión de diagnósticos en la implementación plantilla...</span><span class="sxs-lookup"><span data-stu-id="8137d-153">For example using hello [Visual Studio Cloud Explorer](https://visualstudiogallery.msdn.microsoft.com/aaef6e67-4d99-40bc-aacf-662237db85a2), log in and pick hello Azure subscription you’re using, and hello Diagnostics storage account name referenced in hello Diagnostics extension definition in your deployment template..</span></span>
    
    ![Cloud Explorer][explorer]
    
    <span data-ttu-id="8137d-155">Aquí verá una serie de tablas donde se está almacenando datos Hola de cada máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="8137d-155">Here you will see a bunch of tables where hello data from each VM is being stored.</span></span> <span data-ttu-id="8137d-156">Llevar a cabo Linux y métrica de CPU como un ejemplo de Hola, mire filas más recientes de Hola.</span><span class="sxs-lookup"><span data-stu-id="8137d-156">Taking Linux and hello CPU metric as an example, look at hello most recent rows.</span></span> <span data-ttu-id="8137d-157">Explorador de Hello Visual Studio en la nube es compatible con un lenguaje de consulta para que pueda ejecutar una consulta como "marca de tiempo gt datetime'2016-02-02T21:20:00Z'" toomake seguro de obtener eventos más recientes de hello (se supone tiempo está en hora UTC).</span><span class="sxs-lookup"><span data-stu-id="8137d-157">hello Visual Studio cloud explorer supports a query language so you can run a query like “Timestamp gt datetime’2016-02-02T21:20:00Z’” toomake sure you get hello most recent events (assume time is in UTC).</span></span> <span data-ttu-id="8137d-158">¿Datos de Hola que se ven en se corresponden toohello escalar reglas que configurar?</span><span class="sxs-lookup"><span data-stu-id="8137d-158">Does hello data you see in there correspond toohello scale rules you set up?</span></span> <span data-ttu-id="8137d-159">En el ejemplo de Hola siguiente, Hola CPU para la máquina 20 inicia ininterrumpidamente too100% durante el saludo últimos 5 minutos...</span><span class="sxs-lookup"><span data-stu-id="8137d-159">In hello example below, hello CPU for machine 20 started increasing too100% over hello last 5 minutes..</span></span>
    
    ![Tablas de almacenamiento][tables]
    
    <span data-ttu-id="8137d-161">Si los datos de hello no la encuentra, a continuación, implica problema hello es con la extensión de diagnóstico de hello ejecuta en máquinas virtuales de Hola.</span><span class="sxs-lookup"><span data-stu-id="8137d-161">If hello data is not there, then it implies hello problem is with hello diagnostic extension running in hello VMs.</span></span> <span data-ttu-id="8137d-162">Si hay datos de hello, implica que hay un problema con las reglas de escala o con el servicio de visión Hola.</span><span class="sxs-lookup"><span data-stu-id="8137d-162">If hello data is there, it implies there is either a problem with your scale rules, or with hello Insights service.</span></span> <span data-ttu-id="8137d-163">Compruebe el [estado de Azure](https://azure.microsoft.com/status/).</span><span class="sxs-lookup"><span data-stu-id="8137d-163">Check [Azure Status](https://azure.microsoft.com/status/).</span></span>
    
    <span data-ttu-id="8137d-164">Una vez que ha estado a través de estos pasos, si sigue teniendo problemas de escalado automático puede intentar foros de hello [MSDN](https://social.msdn.microsoft.com/forums/azure/home?category=windowsazureplatform%2Cazuremarketplace%2Cwindowsazureplatformctp), o [desbordamiento de pila](http://stackoverflow.com/questions/tagged/azure), o iniciar una llamada de soporte técnico.</span><span class="sxs-lookup"><span data-stu-id="8137d-164">Once you’ve been through these steps, if you are still having autoscale problems you could try hello forums on [MSDN](https://social.msdn.microsoft.com/forums/azure/home?category=windowsazureplatform%2Cazuremarketplace%2Cwindowsazureplatformctp), or [Stack overflow](http://stackoverflow.com/questions/tagged/azure), or log a support call.</span></span> <span data-ttu-id="8137d-165">Ser plantilla de hello tooshare preparada y una vista de datos de rendimiento de saludo.</span><span class="sxs-lookup"><span data-stu-id="8137d-165">Be prepared tooshare hello template and a view of hello performance data.</span></span>

[audit]: ./media/virtual-machine-scale-sets-troubleshoot/image3.png
[explorer]: ./media/virtual-machine-scale-sets-troubleshoot/image1.png
[tables]: ./media/virtual-machine-scale-sets-troubleshoot/image4.png

---
title: "Solución de problemas de escalado automático de conjuntos de escalado de máquinas virtuales | Microsoft Docs"
description: "Solución de problemas de escalado automático de conjuntos de escalado de máquinas virtuales. Descripción de los problemas habituales y cómo resolverlos."
services: virtual-machine-scale-sets
documentationcenter: 
author: gbowerman
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: c7d87b72-ee24-4e52-9377-a42f337f76fa
ms.service: virtual-machine-scale-sets
ms.workload: na
ms.tgt_pltfrm: windows
ms.devlang: na
ms.topic: article
ms.date: 10/28/2016
ms.author: guybo
ms.openlocfilehash: bd45a0fb99a77851aa7b91d23bd4b830b6f5cc7b
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="troubleshooting-autoscale-with-virtual-machine-scale-sets"></a><span data-ttu-id="07458-104">Solución de problemas de escalado automático de conjuntos de escalado de máquinas virtuales</span><span class="sxs-lookup"><span data-stu-id="07458-104">Troubleshooting autoscale with Virtual Machine Scale Sets</span></span>
<span data-ttu-id="07458-105">**Problema**: ha creado una infraestructura de escalado automático en Azure Resource Manager mediante conjuntos de escalado de máquinas virtuales; por ejemplo, al implementar una plantilla como esta: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale, tiene sus reglas de escalado definidas y funcionan bien, excepto que sin importar cuánta carga se coloque en las máquinas virtuales, no se escalará automáticamente.</span><span class="sxs-lookup"><span data-stu-id="07458-105">**Problem** – you’ve created an autoscaling infrastructure in Azure Resource Manager using VM Scale Sets –  for example by deploying a template like this: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale  – you have your scale rules defined and it works great, except that no matter how much load you put on the VMs, it won’t autoscale.</span></span>

## <a name="troubleshooting-steps"></a><span data-ttu-id="07458-106">Pasos para solucionar problemas</span><span class="sxs-lookup"><span data-stu-id="07458-106">Troubleshooting steps</span></span>
<span data-ttu-id="07458-107">Entre los aspectos que debe considerar se incluyen:</span><span class="sxs-lookup"><span data-stu-id="07458-107">Some things to consider include:</span></span>

* <span data-ttu-id="07458-108">¿Cuántos núcleos tiene cada máquina virtual? ¿Está cargando cada núcleo?</span><span class="sxs-lookup"><span data-stu-id="07458-108">How many cores does each VM have, and are you loading each core?</span></span>
  <span data-ttu-id="07458-109">La plantilla de inicio rápido de Azure del ejemplo anterior incluye un script do_work.php, que carga un único núcleo.</span><span class="sxs-lookup"><span data-stu-id="07458-109">The example Azure Quickstart template above has a do_work.php script, which loads a single core.</span></span> <span data-ttu-id="07458-110">Si está usando una máquina virtual con un tamaño superior a un único núcleo, como Standard_A1 o D1, debe ejecutar entonces esta carga varias veces.</span><span class="sxs-lookup"><span data-stu-id="07458-110">If you’re using a VM bigger than a single core VM size like Standard_A1 or D1 then you’d need to run this load multiple times.</span></span> <span data-ttu-id="07458-111">Compruebe el número de núcleos de las máquinas virtuales después de consultar [Tamaños de las máquinas virtuales Windows en Azure](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="07458-111">Check how many cores your VMs by reviewing [Sizes for Windows virtual machines in Azure](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="07458-112">¿Cuántas máquinas virtuales hay en el conjunto de escalado? ¿está realizando trabajos en cada una de ellas?</span><span class="sxs-lookup"><span data-stu-id="07458-112">How many VMs in the VM Scale Set, are you doing work on each one?</span></span>
  
    <span data-ttu-id="07458-113">Solo se producirá un evento de escalado horizontal si el promedio de uso de CPU en **todas** las máquinas virtuales de un conjunto de escalado supera el valor de umbral durante el tiempo interno definido en las reglas de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="07458-113">A scale out event will only take place when the average CPU across **all** the VMs in a scale set exceeds the threshold value, over the time internal defined in the autoscale rules.</span></span>
* <span data-ttu-id="07458-114">¿Falta cualquier evento de escalado?</span><span class="sxs-lookup"><span data-stu-id="07458-114">Did you miss any scale events?</span></span>
  
    <span data-ttu-id="07458-115">Compruebe los registros de auditoría en el Portal de Azure para ver los eventos de escalado.</span><span class="sxs-lookup"><span data-stu-id="07458-115">Check the audit logs in the Azure portal for scale events.</span></span> <span data-ttu-id="07458-116">Tal vez se haya producido un escalado o una reducción vertical que se ha perdido.</span><span class="sxs-lookup"><span data-stu-id="07458-116">Maybe there was a scale up and a scale down which was missed.</span></span> <span data-ttu-id="07458-117">Puede filtrar por “Escala”...</span><span class="sxs-lookup"><span data-stu-id="07458-117">You can filter by “Scale”..</span></span>
  
    ![Registros de auditoría][audit]
* <span data-ttu-id="07458-119">¿Son los umbrales de reducción y escalado horizontal suficientemente diferentes?</span><span class="sxs-lookup"><span data-stu-id="07458-119">Are your scale-in and scale-out thresholds sufficiently different?</span></span>
  
    <span data-ttu-id="07458-120">Imagine que establece una regla de escalado horizontal cuando el promedio de uso de la CPU es mayor del 50% durante más de 5 minutos y de reducción horizontal cuando el promedio de uso de la CPU es inferior al 50%.</span><span class="sxs-lookup"><span data-stu-id="07458-120">Suppose you set a rule to scale out when average CPU is greater than 50% over 5 minutes, and to scale in when average CPU is less than 50%.</span></span> <span data-ttu-id="07458-121">Esto puede provocar un problema "oscilación" cuando el uso de la CPU está cerca de este umbral, con acciones de escalado que constantemente aumentan y disminuyen el tamaño del conjunto.</span><span class="sxs-lookup"><span data-stu-id="07458-121">This would cause a “flapping” problem when CPU usage is close to this threshold, with scale actions constantly increasing and decreasing the size of the set.</span></span> <span data-ttu-id="07458-122">Por este motivo, el servicio de escalado automático intenta evitar una "oscilación", que puede resultar en la no realización del escalado.</span><span class="sxs-lookup"><span data-stu-id="07458-122">Because of this, the autoscale service tries to prevent “flapping”, which can manifest as not scaling.</span></span> <span data-ttu-id="07458-123">Por lo tanto, asegúrese de que los umbrales de escalado y reducción horizontal son lo suficiente diferentes como para permitir un cierto espacio entre el escalado.</span><span class="sxs-lookup"><span data-stu-id="07458-123">Therefore make sure your scale-out and scale-in thresholds are sufficiently different to allow some space in between scaling.</span></span>
* <span data-ttu-id="07458-124">¿Escribió su propia plantilla JSON?</span><span class="sxs-lookup"><span data-stu-id="07458-124">Did you write your own JSON template?</span></span>
  
    <span data-ttu-id="07458-125">Es fácil cometer errores, así que comience con una plantilla como la anterior que ya sabemos que funciona y haga pequeños cambios incrementales.</span><span class="sxs-lookup"><span data-stu-id="07458-125">It is easy to make mistakes, so start with a template like the one above which is proven to work, and make small incremental changes.</span></span> 
* <span data-ttu-id="07458-126">¿Puede escalar o reducir horizontalmente de forma manual?</span><span class="sxs-lookup"><span data-stu-id="07458-126">Can you manually scale in or out?</span></span>
  
    <span data-ttu-id="07458-127">Intente volver a implementar el recurso del conjunto de escalado en la máquina virtual con una configuración diferente de "capacidad" para cambiar el número de máquinas virtuales manualmente.</span><span class="sxs-lookup"><span data-stu-id="07458-127">Try redeploying the VM Scale Set resource with a different “capacity” setting to change the number of VMs manually.</span></span> <span data-ttu-id="07458-128">Una plantilla de ejemplo para hacer esto es: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing. Puede que deba editar la plantilla para asegurarse de que tiene el mismo tamaño de máquina que el conjunto de escalado que está usando.</span><span class="sxs-lookup"><span data-stu-id="07458-128">An example template to do this is here: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing – you may need to edit the template to make sure it has the same machine size as your Scale Set is using.</span></span> <span data-ttu-id="07458-129">Si puede cambiar correctamente el número de máquinas virtuales de forma manual, sabrá que ha aislado el problema para el escalado automático.</span><span class="sxs-lookup"><span data-stu-id="07458-129">If you can successfully change the number of VMs manually, then you know the problem is isolated to autoscale.</span></span>
* <span data-ttu-id="07458-130">Compruebe los recursos Microsoft.Compute/virtualMachineScaleSet y Microsoft.Insights en el [Explorador de recursos de Azure](https://resources.azure.com/)</span><span class="sxs-lookup"><span data-stu-id="07458-130">Check your Microsoft.Compute/virtualMachineScaleSet, and Microsoft.Insights resources in the [Azure Resource Explorer](https://resources.azure.com/)</span></span>
  
    <span data-ttu-id="07458-131">Se trata de una herramienta indispensable de solución de problemas que muestra el estado de los recursos de Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="07458-131">This is an indispensable troubleshooting tool which shows you the state of your Azure Resource Manager resources.</span></span> <span data-ttu-id="07458-132">Haga clic en la suscripción y examine el grupo de recursos que se están diagnosticando.</span><span class="sxs-lookup"><span data-stu-id="07458-132">Click on your subscription and look at the Resource Group you are troubleshooting.</span></span> <span data-ttu-id="07458-133">En el proveedor de recursos de proceso mire el conjunto de escalado de máquinas virtuales que ha creado y compruebe la vista de instancia que muestra el estado de una implementación.</span><span class="sxs-lookup"><span data-stu-id="07458-133">Under the Compute resource provider look at the VM Scale Set you created and check the Instance View, which shows you the state of a deployment.</span></span> <span data-ttu-id="07458-134">Compruebe también la vista de instancia de las máquinas virtuales del conjunto de escalado correspondiente.</span><span class="sxs-lookup"><span data-stu-id="07458-134">Also check the instance view of VMs in the VM Scale Set.</span></span> <span data-ttu-id="07458-135">A continuación, entre en el proveedor de recursos de Microsoft.Insights y compruebe que las reglas de escalado automático se ven bien.</span><span class="sxs-lookup"><span data-stu-id="07458-135">Then go into the Microsoft.Insights resource provider and check the autoscale rules look good.</span></span>
* <span data-ttu-id="07458-136">¿Funciona la extensión Diagnóstico y emite los datos de rendimiento?</span><span class="sxs-lookup"><span data-stu-id="07458-136">Is the Diagnostic extension working and emitting performance data?</span></span>
  
    <span data-ttu-id="07458-137">**Actualización:** el escalado automático de Azure se ha mejorado para usar una canalización de métricas basada en host que ya no requiere la instalación de una extensión de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="07458-137">**Update:** Azure autoscale has been enhanced to use a host based metrics pipeline which no longer requires a diagnostics extension to be installed.</span></span> <span data-ttu-id="07458-138">Esto significa que los siguientes párrafos ya no se aplican si crea una aplicación de escalado automático con la nueva canalización.</span><span class="sxs-lookup"><span data-stu-id="07458-138">This means the next few paragraphs no longer apply if you create an autoscaling application using the new pipeline.</span></span> <span data-ttu-id="07458-139">En https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale encontrará un ejemplo de plantillas de Azure que se han convertido para usar la canalización de host.</span><span class="sxs-lookup"><span data-stu-id="07458-139">An example of Azure templates which have been converted to use the host pipeline is: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale.</span></span> 
  
    <span data-ttu-id="07458-140">El uso de métricas basadas en host para el escalado automático es mejor por las razones siguientes:</span><span class="sxs-lookup"><span data-stu-id="07458-140">Using host based metrics for autoscale is better for the following reasons:</span></span>
  
  * <span data-ttu-id="07458-141">Menos partes móviles ya que no es necesario instalar ninguna extensión de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="07458-141">Fewer moving parts as no diagnostics extensions need to be installed.</span></span>
  * <span data-ttu-id="07458-142">Plantillas más sencillas.</span><span class="sxs-lookup"><span data-stu-id="07458-142">Simpler templates.</span></span> <span data-ttu-id="07458-143">Basta con que agregue reglas de escalado automático de Insights a una plantilla de conjunto de escalado existente.</span><span class="sxs-lookup"><span data-stu-id="07458-143">Just add insights autoscale rules to an existing scale set template.</span></span>
  * <span data-ttu-id="07458-144">Informes más confiable e inicio rápido de nuevas máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="07458-144">More reliable reporting and faster launching of new VMs.</span></span>
    
    <span data-ttu-id="07458-145">Los únicos motivos por los que querría seguir usando una extensión de diagnóstico serían si necesitara informes o escalado de diagnósticos de memoria.</span><span class="sxs-lookup"><span data-stu-id="07458-145">The only reasons you might want to keep using a diagnostic extension would be if you need memory diagnostics reporting/scaling.</span></span> <span data-ttu-id="07458-146">Las métricas basadas en host no informan sobre memoria.</span><span class="sxs-lookup"><span data-stu-id="07458-146">Host based metrics doesn't report memory.</span></span>
    
    <span data-ttu-id="07458-147">Teniendo este en cuenta, siga el resto de este artículo si aún usa extensiones de diagnóstico para el escalado automático.</span><span class="sxs-lookup"><span data-stu-id="07458-147">With that in mind, only follow the rest of this article if you are still using diagnostic extensions for your autoscaling.</span></span>
    
    <span data-ttu-id="07458-148">El escalado automático en Azure Resource Manager puede funcionar (aunque ya no es necesario) por medio de una extensión de máquina virtual llamada extensión de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="07458-148">Autoscale in Azure Resource Manager can work (but no longer has to) by means of a VM extension called the Diagnostics Extension.</span></span> <span data-ttu-id="07458-149">Emite datos de rendimiento para una cuenta de almacenamiento que se define en la plantilla.</span><span class="sxs-lookup"><span data-stu-id="07458-149">It emits performance data to a storage account you define in the template.</span></span> <span data-ttu-id="07458-150">A continuación, el servicio Azure Monitor agrega estos datos.</span><span class="sxs-lookup"><span data-stu-id="07458-150">This data is then aggregated by the Azure Monitor service.</span></span>
    
    <span data-ttu-id="07458-151">Si el servicio Insights no puede leer los datos de las máquinas virtuales, por ejemplo si estas no funcionan, el servicio debería enviarle un correo electrónico, por lo que debe comprobar el correo (el mismo que especificó al crear la cuenta de Azure).</span><span class="sxs-lookup"><span data-stu-id="07458-151">If the Insights service can’t read data from the VMs, it is supposed to send you an email – for example if the VMs were down, so check your email (the one you specified when creating the Azure account).</span></span>
    
    <span data-ttu-id="07458-152">También puede comprobar los datos usted mismo.</span><span class="sxs-lookup"><span data-stu-id="07458-152">You can also go and look at the data yourself.</span></span> <span data-ttu-id="07458-153">Observe la cuenta de almacenamiento de Azure mediante Cloud Explorer.</span><span class="sxs-lookup"><span data-stu-id="07458-153">Look at the Azure storage account using a cloud explorer.</span></span> <span data-ttu-id="07458-154">Por ejemplo, mediante [Visual Studio Cloud Explorer](https://visualstudiogallery.msdn.microsoft.com/aaef6e67-4d99-40bc-aacf-662237db85a2), inicie sesión y seleccione la suscripción de Azure que está usando y el nombre de la cuenta de almacenamiento de información de Diagnósticos al que se hace referencia en la definición de la extensión Diagnósticos en la plantilla de implementación...</span><span class="sxs-lookup"><span data-stu-id="07458-154">For example using the [Visual Studio Cloud Explorer](https://visualstudiogallery.msdn.microsoft.com/aaef6e67-4d99-40bc-aacf-662237db85a2), log in and pick the Azure subscription you’re using, and the Diagnostics storage account name referenced in the Diagnostics extension definition in your deployment template..</span></span>
    
    ![Cloud Explorer][explorer]
    
    <span data-ttu-id="07458-156">Aquí verá una serie de tablas donde se almacenan los datos de cada máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="07458-156">Here you will see a bunch of tables where the data from each VM is being stored.</span></span> <span data-ttu-id="07458-157">Tomando como ejemplo Linux y las métricas de CPU, observe las filas más recientes.</span><span class="sxs-lookup"><span data-stu-id="07458-157">Taking Linux and the CPU metric as an example, look at the most recent rows.</span></span> <span data-ttu-id="07458-158">Visual Studio Cloud Explorer admite un lenguaje de consulta para que pueda ejecutar una consulta como "Timestamp gt datetime’2016-02-02T21:20:00Z’" para asegurarse de que obtiene los eventos más recientes (se supone que la hora es UTC).</span><span class="sxs-lookup"><span data-stu-id="07458-158">The Visual Studio cloud explorer supports a query language so you can run a query like “Timestamp gt datetime’2016-02-02T21:20:00Z’” to make sure you get the most recent events (assume time is in UTC).</span></span> <span data-ttu-id="07458-159">¿Se corresponden los datos que puede ver allí con las reglas de escalado que ha configurado?</span><span class="sxs-lookup"><span data-stu-id="07458-159">Does the data you see in there correspond to the scale rules you set up?</span></span> <span data-ttu-id="07458-160">En el ejemplo siguiente, el uso de la CPU para la máquina 20 empezó a aumentar al 100% durante los últimos 5 minutos...</span><span class="sxs-lookup"><span data-stu-id="07458-160">In the example below, the CPU for machine 20 started increasing to 100% over the last 5 minutes..</span></span>
    
    ![Tablas de almacenamiento][tables]
    
    <span data-ttu-id="07458-162">Si los datos no están allí, eso significa que el problema está relacionado con la extensión de diagnóstico que se ejecuta en las máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="07458-162">If the data is not there, then it implies the problem is with the diagnostic extension running in the VMs.</span></span> <span data-ttu-id="07458-163">Si los datos están allí, significa que hay un problema con las reglas de escalado o con el servicio Insights.</span><span class="sxs-lookup"><span data-stu-id="07458-163">If the data is there, it implies there is either a problem with your scale rules, or with the Insights service.</span></span> <span data-ttu-id="07458-164">Compruebe el [estado de Azure](https://azure.microsoft.com/status/).</span><span class="sxs-lookup"><span data-stu-id="07458-164">Check [Azure Status](https://azure.microsoft.com/status/).</span></span>
    
    <span data-ttu-id="07458-165">Después de haber seguido este pasos, si sigue teniendo problemas con el escalado automático, podría probar con los foros de [MSDN](https://social.msdn.microsoft.com/forums/azure/home?category=windowsazureplatform%2Cazuremarketplace%2Cwindowsazureplatformctp) o [Stack Overflow](http://stackoverflow.com/questions/tagged/azure), o realizar una llamada al soporte técnico.</span><span class="sxs-lookup"><span data-stu-id="07458-165">Once you’ve been through these steps, if you are still having autoscale problems you could try the forums on [MSDN](https://social.msdn.microsoft.com/forums/azure/home?category=windowsazureplatform%2Cazuremarketplace%2Cwindowsazureplatformctp), or [Stack overflow](http://stackoverflow.com/questions/tagged/azure), or log a support call.</span></span> <span data-ttu-id="07458-166">Esté preparado para compartir la plantilla y una vista de los datos de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="07458-166">Be prepared to share the template and a view of the performance data.</span></span>

[audit]: ./media/virtual-machine-scale-sets-troubleshoot/image3.png
[explorer]: ./media/virtual-machine-scale-sets-troubleshoot/image1.png
[tables]: ./media/virtual-machine-scale-sets-troubleshoot/image4.png

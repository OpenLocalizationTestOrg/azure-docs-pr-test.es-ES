---
title: "Uso de grandes conjuntos de escalado de máquinas virtuales de Azure | Microsoft Docs"
description: "Qué necesita saber para usar grandes conjuntos de escalado de máquinas virtuales de Azure"
services: virtual-machine-scale-sets
documentationcenter: 
author: gbowerman
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 76ac7fd7-2e05-4762-88ca-3b499e87906e
ms.service: virtual-machine-scale-sets
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 2/7/2017
ms.author: guybo
ms.openlocfilehash: 9e9eae1623e55c1c05e97aa0b836819ce5dc16f9
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/03/2017
---
# <a name="working-with-large-virtual-machine-scale-sets"></a><span data-ttu-id="1413c-103">Uso de grandes conjuntos de escalado de máquinas virtuales</span><span class="sxs-lookup"><span data-stu-id="1413c-103">Working with large virtual machine scale sets</span></span>
<span data-ttu-id="1413c-104">Ahora puede crear [conjuntos de escalado de máquinas virtuales](/azure/virtual-machine-scale-sets/) de Azure con una capacidad de hasta 1000 máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="1413c-104">You can now create Azure [virtual machine scale sets](/azure/virtual-machine-scale-sets/) with a capacity of up to 1,000 VMs.</span></span> <span data-ttu-id="1413c-105">En este documento, un _conjunto de escalado de máquinas virtuales grande_ se define como un conjunto de escalado capaz de escalar a más de 100 máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="1413c-105">In this document, a _large virtual machine scale set_ is defined as a scale set capable of scaling to greater than 100 VMs.</span></span> <span data-ttu-id="1413c-106">Esta funcionalidad se establece con una propiedad de conjunto de escalado (_singlePlacementGroup=False_).</span><span class="sxs-lookup"><span data-stu-id="1413c-106">This capability is set by a scale set property (_singlePlacementGroup=False_).</span></span> 

<span data-ttu-id="1413c-107">Algunos aspectos de los grandes conjuntos de escalado, como los dominios de error y el equilibrio de carga, se comportan de manera diferente a los de un conjunto de escalado estándar.</span><span class="sxs-lookup"><span data-stu-id="1413c-107">Certain aspects of large scale sets, such as load balancing and fault domains behave differently to a standard scale set.</span></span> <span data-ttu-id="1413c-108">En este documento se explican las características de los grandes conjuntos de escalado y se describe lo que se necesita saber para usarlos correctamente en las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="1413c-108">This document explains the characteristics of large scale sets, and describes what you need to know to successfully use them in your applications.</span></span> 

<span data-ttu-id="1413c-109">Un enfoque habitual para implementar una infraestructura de nube a gran escala consiste en crear un conjunto de _unidades de escalado_, por ejemplo, crear varios conjuntos de escalado de máquinas virtuales en varias redes virtuales y cuentas de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="1413c-109">A common approach for deploying cloud infrastructure at large scale is to create a set of _scale units_, for example by creating multiple VMs scale sets across multiple VNETs and storage accounts.</span></span> <span data-ttu-id="1413c-110">Este enfoque facilita la administración en comparación con la de una sola máquina virtual, y varias unidades de escalado son útiles para muchas aplicaciones, especialmente para aquellas que requieren otros componentes apilables, como varias redes virtuales y puntos de conexión.</span><span class="sxs-lookup"><span data-stu-id="1413c-110">This approach provides easier management compared to single VMs, and multiple scale units are useful for many applications, particularly those that require other stackable components like multiple virtual networks and endpoints.</span></span> <span data-ttu-id="1413c-111">Sin embargo, si su aplicación requiere un único clúster de gran tamaño, quizás sea más sencillo implementar un único conjunto de escalado con hasta 1000 máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="1413c-111">If your application requires a single large cluster however, it can be more straightforward to deploy a single scale set of up to 1,000 VMs.</span></span> <span data-ttu-id="1413c-112">Algunos escenarios de ejemplo son las implementaciones de macrodatos centralizadas y las mallas de computación que requieren una administración sencilla de un grupo grande de nodos de trabajo.</span><span class="sxs-lookup"><span data-stu-id="1413c-112">Example scenarios include centralized big data deployments, or compute grids requiring simple management of a large pool of worker nodes.</span></span> <span data-ttu-id="1413c-113">Combinados con los [discos de datos conectados](virtual-machine-scale-sets-attached-disks.md) de un conjunto de escalado de máquinas virtuales, los grandes conjuntos de escalado permiten implementar una infraestructura escalable compuesta por miles de núcleos y petabytes de almacenamiento, en una única operación.</span><span class="sxs-lookup"><span data-stu-id="1413c-113">Combined with VM scale set [attached data disks](virtual-machine-scale-sets-attached-disks.md), large scale sets enable you to deploy a scalable infrastructure consisting of thousands of cores and petabytes of storage, as a single operation.</span></span>

## <a name="placement-groups"></a><span data-ttu-id="1413c-114">Grupos de selección de ubicación</span><span class="sxs-lookup"><span data-stu-id="1413c-114">Placement groups</span></span> 
<span data-ttu-id="1413c-115">Lo que hace que un conjunto de escalado _grande_ sea especial no es el número de máquinas virtuales, sino el número de _grupos de selección de ubicación_ que contiene.</span><span class="sxs-lookup"><span data-stu-id="1413c-115">What makes a _large_ scale set special is not the number of VMs, but the number of _placement groups_ it contains.</span></span> <span data-ttu-id="1413c-116">Un grupo de selección de ubicación es una construcción similar a un conjunto de disponibilidad de Azure, con sus propios dominios de error y dominios de actualización.</span><span class="sxs-lookup"><span data-stu-id="1413c-116">A placement group is a construct similar to an Azure availability set, with its own fault domains and upgrade domains.</span></span> <span data-ttu-id="1413c-117">De forma predeterminada, un conjunto de escalado consta de un único grupo de selección de ubicación con un tamaño máximo de 100 máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="1413c-117">By default, a scale set consists of a single placement group with a maximum size of 100 VMs.</span></span> <span data-ttu-id="1413c-118">Si la propiedad _singlePlacementGroup_ de un conjunto de escalado se establece en _false_, el conjunto de escalado puede estar compuesto por varios grupos de selección de ubicación y tiene un intervalo de 0 a 1000 máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="1413c-118">If a scale set property called _singlePlacementGroup_ is set to _false_, the scale set can be composed of multiple placement groups and has a range of 0-1,000 VMs.</span></span> <span data-ttu-id="1413c-119">Cuando se establece en el valor predeterminado _true_, el conjunto de escalado se compone de un solo grupo de selección de ubicación y tiene un intervalo de 0 a 100 máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="1413c-119">When set to the default value of _true_, a scale set is composed of a single placement group, and has a range of 0-100 VMs.</span></span>

## <a name="checklist-for-using-large-scale-sets"></a><span data-ttu-id="1413c-120">Lista de comprobación para usar grandes conjuntos de escalado</span><span class="sxs-lookup"><span data-stu-id="1413c-120">Checklist for using large scale sets</span></span>
<span data-ttu-id="1413c-121">Para decidir si la aplicación puede hacer un uso eficaz de los conjuntos de escalado grandes, tenga en cuenta los siguientes requisitos:</span><span class="sxs-lookup"><span data-stu-id="1413c-121">To decide whether your application can make effective use of large scale sets, consider the following requirements:</span></span>

- <span data-ttu-id="1413c-122">Los conjuntos de escalado grandes necesitan Azure Managed Disks.</span><span class="sxs-lookup"><span data-stu-id="1413c-122">Large scale sets require Azure Managed Disks.</span></span> <span data-ttu-id="1413c-123">Los conjuntos de escalado grandes que no se crean con Managed Disks requieren varias cuentas de almacenamiento (una por cada 20 máquinas virtuales).</span><span class="sxs-lookup"><span data-stu-id="1413c-123">Scale sets that are not created with Managed Disks require multiple storage accounts (one for every 20 VMs).</span></span> <span data-ttu-id="1413c-124">Los conjuntos de escalado grandes están diseñados para trabajar exclusivamente con Managed Disks para reducir la sobrecarga de administración del almacenamiento y para evitar el riesgo de alcanzar los límites de suscripción de las cuentas de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="1413c-124">Large scale sets are designed to work exclusively with Managed Disks to reduce your storage management overhead, and to avoid the risk of running into subscription limits for storage accounts.</span></span> <span data-ttu-id="1413c-125">Si no usa Managed Disks, el conjunto de escalado está limitado a 100 máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="1413c-125">If you do not use Managed Disks, your scale set is limited to 100 VMs.</span></span>
- <span data-ttu-id="1413c-126">Los conjuntos de escalado creados a partir de imágenes de Azure Marketplace pueden escalar a un máximo de 1000 máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="1413c-126">Scale sets created from Azure Marketplace images can scale up to 1,000 VMs.</span></span>
- <span data-ttu-id="1413c-127">Los conjuntos de escalado creados a partir de imágenes personalizadas (imágenes de máquina virtual creadas y cargadas por el usuario) actualmente pueden escalar a un máximo de 100 máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="1413c-127">Scale sets created from custom images (VM images you create and upload yourself) can currently scale up to 100 VMs.</span></span>
- <span data-ttu-id="1413c-128">Aún no se admite el equilibrio de carga de nivel 4 con Azure Load Balancer para conjuntos de escalado compuestos por varios grupos de selección de ubicación.</span><span class="sxs-lookup"><span data-stu-id="1413c-128">Layer-4 load balancing with the Azure Load Balancer is not yet supported for scale sets composed of multiple placement groups.</span></span> <span data-ttu-id="1413c-129">Si necesita usar Azure Load Balancer, asegúrese de que el conjunto de escalado esté configurado para usar un único grupo de selección de ubicación, que es la configuración predeterminada.</span><span class="sxs-lookup"><span data-stu-id="1413c-129">If you need to use the Azure Load Balancer make sure the scale set is configured to use a single placement group, which is the default setting.</span></span>
- <span data-ttu-id="1413c-130">Se admite el equilibrio de carga de nivel 7 con Azure Application Gateway para todos los conjuntos de escalado.</span><span class="sxs-lookup"><span data-stu-id="1413c-130">Layer-7 load balancing with the Azure Application Gateway is supported for all scale sets.</span></span>
- <span data-ttu-id="1413c-131">Un conjunto de escalado se define con una sola subred; asegúrese de que la subred tenga suficiente espacio de direcciones para todas las máquinas virtuales que necesita.</span><span class="sxs-lookup"><span data-stu-id="1413c-131">A scale set is defined with a single subnet - make sure your subnet has an address space large enough for all the VMs you need.</span></span> <span data-ttu-id="1413c-132">De forma predeterminada, un conjunto de escalado se aprovisiona en exceso (crea máquinas virtuales adicionales durante la implementación o durante el escalado horizontal, que no se le cobran) para mejorar el rendimiento y la confiabilidad de la implementación.</span><span class="sxs-lookup"><span data-stu-id="1413c-132">By default a scale set overprovisions (creates extra VMs at deployment time or when scaling out, which you are not charged for) to improve deployment reliability and performance.</span></span> <span data-ttu-id="1413c-133">Deje un 20 % más de espacio que el número de máquinas virtuales al que tiene pensado escalar.</span><span class="sxs-lookup"><span data-stu-id="1413c-133">Allow for an address space 20% greater than the number of VMs you plan to scale to.</span></span>
- <span data-ttu-id="1413c-134">Si planea implementar muchas máquinas virtuales, quizás tenga que aumentar los límites de cuota de los núcleos de proceso.</span><span class="sxs-lookup"><span data-stu-id="1413c-134">If you are planning to deploy many VMs, your Compute core quota limits may need to be increased.</span></span>
- <span data-ttu-id="1413c-135">Los dominios de error y los dominios de actualización solo son coherentes dentro de un grupo de selección de ubicación.</span><span class="sxs-lookup"><span data-stu-id="1413c-135">Fault domains and upgrade domains are only consistent within a placement group.</span></span> <span data-ttu-id="1413c-136">Esta arquitectura no cambia la disponibilidad global de un conjunto de escalado, porque las máquinas virtuales se distribuyen uniformemente entre los distintos componentes de hardware físico, lo que significa que, si tiene que garantizar que dos máquinas virtuales están en un hardware diferente, debe asegurarse de que están en distintos dominios de error en el mismo grupo de selección de ubicación.</span><span class="sxs-lookup"><span data-stu-id="1413c-136">This architecture does not change the overall availability of a scale set, as VMs are evenly distributed across distinct physical hardware, but it does means that if you need to guarantee two VMs are on different hardware, make sure they are in different fault domains in the same placement group.</span></span> <span data-ttu-id="1413c-137">El dominio de error y el identificador del grupo de selección de ubicación se muestran en la _vista de instancia_ de una máquina virtual del conjunto de escalado.</span><span class="sxs-lookup"><span data-stu-id="1413c-137">Fault domain and placement group ID are shown in the _instance view_ of a scale set VM.</span></span> <span data-ttu-id="1413c-138">Puede ver la vista de instancia de una máquina virtual del conjunto de escalado el [Explorador de recursos de Azure](https://resources.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="1413c-138">You can view the instance view of a scale set VM in the [Azure Resource Explorer](https://resources.azure.com/).</span></span>


## <a name="creating-a-large-scale-set"></a><span data-ttu-id="1413c-139">Creación de un conjunto de escalado grande</span><span class="sxs-lookup"><span data-stu-id="1413c-139">Creating a large scale set</span></span>
<span data-ttu-id="1413c-140">Cuando se crea un conjunto de escalado en Azure Portal, puede permitir que escale a diversos grupos de selección de ubicación; para ello, establezca la opción _Limit to a single placement group_ (Limitar a un solo grupo de selección de ubicación) en _False_, en la hoja _Datos básicos_.</span><span class="sxs-lookup"><span data-stu-id="1413c-140">When you create a scale set in the Azure portal, you can allow it to scale to multiple placement groups by setting the _Limit to a single placement group_ option to _False_ in the _Basics_ blade.</span></span> <span data-ttu-id="1413c-141">Con esta opción establecida en _False_, puede especificar un valor de _Número de instancias_ de hasta 1000.</span><span class="sxs-lookup"><span data-stu-id="1413c-141">With this option set to _False_, you can specify an _Instance count_ value of up to 1,000.</span></span>

![](./media/virtual-machine-scale-sets-placement-groups/portal-large-scale.png)

<span data-ttu-id="1413c-142">Puede crear un conjunto de escalado de máquinas virtuales grande con el comando _az vmss create_ de la [CLI de Azure](https://github.com/Azure/azure-cli).</span><span class="sxs-lookup"><span data-stu-id="1413c-142">You can create a large VM scale set using the [Azure CLI](https://github.com/Azure/azure-cli) _az vmss create_ command.</span></span> <span data-ttu-id="1413c-143">Este comando establece valores predeterminados inteligentes, como el tamaño de la subred, en función del argumento _instance-count_:</span><span class="sxs-lookup"><span data-stu-id="1413c-143">This command sets intelligent defaults such as subnet size based on the _instance-count_ argument:</span></span>

```bash
az group create -l southcentralus -n biginfra
az vmss create -g biginfra -n bigvmss --image ubuntults --instance-count 1000
```
<span data-ttu-id="1413c-144">Tenga en cuenta que el valor predeterminado del comando _vmss create_ son determinados valores de configuración si no los especifica.</span><span class="sxs-lookup"><span data-stu-id="1413c-144">Note that the _vmss create_ command defaults certain configuration values if you do not specify them.</span></span> <span data-ttu-id="1413c-145">Para ver las opciones disponibles que puede invalidar, pruebe lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="1413c-145">To see the available options that you can override, try:</span></span>
```bash
az vmss create --help
```

<span data-ttu-id="1413c-146">Si para crear un conjunto de escalado grande va a utilizar una plantilla de Azure Resource Manager, asegúrese de que la plantilla crea un conjunto de escalado basado en Azure Managed Disks.</span><span class="sxs-lookup"><span data-stu-id="1413c-146">If you are creating a large scale set by composing an Azure Resource Manager template, make sure the template creates a scale set based on Azure Managed Disks.</span></span> <span data-ttu-id="1413c-147">Puede establecer la propiedad _singlePlacementGroup_ en _false_ en la sección _properties_ del recurso _Microsoft.Compute/virtualMAchineScaleSets_.</span><span class="sxs-lookup"><span data-stu-id="1413c-147">You can set the _singlePlacementGroup_ property to _false_ in the _properties_ section of the _Microsoft.Compute/virtualMAchineScaleSets_ resource.</span></span> <span data-ttu-id="1413c-148">El siguiente fragmento JSON muestra el principio de una plantilla de conjunto de escalado, incluida la capacidad de 1000 máquinas virtuales y la configuración _"singlePlacementGroup" : false_:</span><span class="sxs-lookup"><span data-stu-id="1413c-148">The following JSON fragment shows the beginning of a scale set template, including the 1,000 VM capacity and the _"singlePlacementGroup" : false_ setting:</span></span>
```json
{
  "type": "Microsoft.Compute/virtualMachineScaleSets",
  "location": "australiaeast",
  "name": "bigvmss",
  "sku": {
    "name": "Standard_DS1_v2",
    "tier": "Standard",
    "capacity": 1000
  },
  "properties": {
    "singlePlacementGroup": false,
    "upgradePolicy": {
      "mode": "Automatic"
    }
```
<span data-ttu-id="1413c-149">Para ver un ejemplo completo de una plantilla de conjunto de escalado grande, consulte [https://github.com/gbowerman/azure-myriad/blob/master/bigtest/bigbottle.json](https://github.com/gbowerman/azure-myriad/blob/master/bigtest/bigbottle.json).</span><span class="sxs-lookup"><span data-stu-id="1413c-149">For a complete example of a large scale set template, refer to [https://github.com/gbowerman/azure-myriad/blob/master/bigtest/bigbottle.json](https://github.com/gbowerman/azure-myriad/blob/master/bigtest/bigbottle.json).</span></span>

## <a name="converting-an-existing-scale-set-to-span-multiple-placement-groups"></a><span data-ttu-id="1413c-150">Conversión de un conjunto de escalado existente para incluir varios grupos de selección de ubicación</span><span class="sxs-lookup"><span data-stu-id="1413c-150">Converting an existing scale set to span multiple placement groups</span></span>
<span data-ttu-id="1413c-151">Para que un conjunto de escalado de máquinas virtuales existente pueda escalar a más de 100 máquinas virtuales, debe cambiar la propiedad _singplePlacementGroup_ a _false_ en el modelo del conjunto de escalado.</span><span class="sxs-lookup"><span data-stu-id="1413c-151">To make an existing VM scale set capable of scaling to more than 100 VMs, you need to change the _singplePlacementGroup_ property to _false_ in the scale set model.</span></span> <span data-ttu-id="1413c-152">Puede probar a cambiar esta propiedad con el [Explorador de recursos de Azure](https://resources.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="1413c-152">You can test changing this property with the [Azure Resource Explorer](https://resources.azure.com/).</span></span> <span data-ttu-id="1413c-153">Buscar un conjunto de escalado existente, seleccione _Editar_ y cambie la propiedad _singlePlacementGroup_.</span><span class="sxs-lookup"><span data-stu-id="1413c-153">Find an existing scale set, select _Edit_ and change the _singlePlacementGroup_ property.</span></span> <span data-ttu-id="1413c-154">Si no ve esta propiedad, quizás esté viendo el conjunto de escalado con una versión anterior de la API Microsoft.Compute.</span><span class="sxs-lookup"><span data-stu-id="1413c-154">If you do not see this property, you may be viewing the scale set with an older version of the Microsoft.Compute API.</span></span>

>[!NOTE] 
<span data-ttu-id="1413c-155">Puede cambiar un conjunto de escalado para que admita más de un grupo de selección de ubicación, pero no al revés.</span><span class="sxs-lookup"><span data-stu-id="1413c-155">You can change a scale set from supporting a single placement group only (the default behavior) to a supporting multiple placement groups, but you cannot convert the other way around.</span></span> <span data-ttu-id="1413c-156">Por lo tanto, asegúrese de que comprende las propiedades de los conjuntos de escalado grandes antes de convertirlos.</span><span class="sxs-lookup"><span data-stu-id="1413c-156">Therefore make sure you understand the properties of large scale sets before converting.</span></span> <span data-ttu-id="1413c-157">En concreto, asegúrese de que no necesita el equilibrio de carga de nivel 4 con Azure Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="1413c-157">In particular, make sure you do not need layer-4 load balancing with the Azure Load Balancer.</span></span>



---
title: "Lección complementaria del tutorial de Azure Analysis Services: seguridad dinámica | Microsoft Docs"
description: "En este artículo se describe cómo usar la seguridad dinámica mediante los filtros de fila del tutorial de Azure Analysis Services."
services: analysis-services
documentationcenter: 
author: minewiskan
manager: erikre
editor: 
tags: 
ms.assetid: 
ms.service: analysis-services
ms.devlang: NA
ms.topic: get-started-article
ms.tgt_pltfrm: NA
ms.workload: na
ms.date: 05/26/2017
ms.author: owend
ms.openlocfilehash: 4e97a558ae1a2601b5275a73164b483351f03857
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/03/2017
---
# <a name="supplemental-lesson---dynamic-security"></a><span data-ttu-id="0fb97-103">Lección complementaria: Seguridad dinámica</span><span class="sxs-lookup"><span data-stu-id="0fb97-103">Supplemental lesson - Dynamic security</span></span>

[!INCLUDE[analysis-services-appliesto-aas-sql2017-later](../../../includes/analysis-services-appliesto-aas-sql2017-later.md)]

<span data-ttu-id="0fb97-104">En esta lección complementaria, creará un rol función que implementa la seguridad dinámica.</span><span class="sxs-lookup"><span data-stu-id="0fb97-104">In this supplemental lesson, you create an additional role that implements dynamic security.</span></span> <span data-ttu-id="0fb97-105">La seguridad dinámica proporciona seguridad de nivel de fila en función del identificador de inicio de sesión o del nombre de usuario de la persona que tenga la sesión iniciada.</span><span class="sxs-lookup"><span data-stu-id="0fb97-105">Dynamic security provides row-level security based on the user name or login id of the user currently logged on.</span></span> 
  
<span data-ttu-id="0fb97-106">Para implementar seguridad dinámica, agregue una tabla al modelo que contiene los nombres de usuario de las personas que pueden conectarse al modelo y examinar los datos y objetos de dicho modelo.</span><span class="sxs-lookup"><span data-stu-id="0fb97-106">To implement dynamic security, you add a table to your model containing the user names of those users that can connect to the model and browse model objects and data.</span></span> <span data-ttu-id="0fb97-107">El modelo que crea con este tutorial se encuentra en el contexto de Adventure Works; sin embargo, para completar esta lección, debe agregar una tabla que contenga los usuarios de su propio dominio.</span><span class="sxs-lookup"><span data-stu-id="0fb97-107">The model you create using this tutorial is in the context of Adventure Works; however, to complete this lesson, you must add a table containing users from your own domain.</span></span> <span data-ttu-id="0fb97-108">No se necesitan las contraseñas de los nombres de usuario que se agregan.</span><span class="sxs-lookup"><span data-stu-id="0fb97-108">You do not need the passwords for the user names that are added.</span></span> <span data-ttu-id="0fb97-109">Para crear una tabla EmployeeSecurity con una pequeña muestra de los usuarios de su propio dominio, pegue los datos de empleados desde una hoja de cálculo de Excel con la característica de pegado.</span><span class="sxs-lookup"><span data-stu-id="0fb97-109">To create an EmployeeSecurity table, with a small sample of users from your own domain, you use the Paste feature, pasting employee data from an Excel spreadsheet.</span></span> <span data-ttu-id="0fb97-110">En un escenario real, la tabla que contiene los nombres de usuario normalmente sería una, como origen de datos, de una base de datos real. Por ejemplo, una tabla DimEmployee real.</span><span class="sxs-lookup"><span data-stu-id="0fb97-110">In a real-world scenario, the table containing user names would typically be a table from an actual database as a data source; for example, a real DimEmployee table.</span></span>  
  
<span data-ttu-id="0fb97-111">Para implementar la seguridad dinámica, debe utilizar dos funciones DAX: [USERNAME (DAX)](http://msdn.microsoft.com/22dddc4b-1648-4c89-8c93-f1151162b93f) y [LOOKUPVALUE (DAX)](http://msdn.microsoft.com/73a51c4d-131c-4c33-a139-b1342d10caab).</span><span class="sxs-lookup"><span data-stu-id="0fb97-111">To implement dynamic security, you use two DAX functions: [USERNAME Function (DAX)](http://msdn.microsoft.com/22dddc4b-1648-4c89-8c93-f1151162b93f) and [LOOKUPVALUE Function (DAX)](http://msdn.microsoft.com/73a51c4d-131c-4c33-a139-b1342d10caab).</span></span> <span data-ttu-id="0fb97-112">Estas funciones, aplicadas en una fórmula de filtro de fila, se definen en un nuevo rol.</span><span class="sxs-lookup"><span data-stu-id="0fb97-112">These functions, applied in a row filter formula, are defined in a new role.</span></span> <span data-ttu-id="0fb97-113">Mediante el uso de la función LOOKUPVALUE, la fórmula especifica un valor de la tabla EmployeeSecurity.</span><span class="sxs-lookup"><span data-stu-id="0fb97-113">By using the LOOKUPVALUE function, the formula specifies a value from the EmployeeSecurity table.</span></span> <span data-ttu-id="0fb97-114">Después, la fórmula pasa el valor a la función USERNAME, que especifica que el nombre del usuario que ha iniciado la sesión pertenece a este rol.</span><span class="sxs-lookup"><span data-stu-id="0fb97-114">The formula then passes that value to the USERNAME function, which specifies the user name of the user logged on belongs to this role.</span></span> <span data-ttu-id="0fb97-115">Después, el usuario puede examinar los datos especificados mediante los filtros de fila del rol.</span><span class="sxs-lookup"><span data-stu-id="0fb97-115">The user can then browse only data specified by the role’s row filters.</span></span> <span data-ttu-id="0fb97-116">En este escenario, puede especificar que los empleados de ventas solo puedan examinar los datos de ventas de Internet de los territorios de ventas en los que son miembros.</span><span class="sxs-lookup"><span data-stu-id="0fb97-116">In this scenario, you specify that sales employees can only browse Internet sales data for the sales territories in which they are a member.</span></span>  
  
<span data-ttu-id="0fb97-117">Las tareas que solo se realizan en este escenario de modelo tabular de Adventure Works, pero no que se aplicarían necesariamente a un escenario real, se identifican como tales.</span><span class="sxs-lookup"><span data-stu-id="0fb97-117">Those tasks that are unique to this Adventure Works tabular model scenario, but would not necessarily apply to a real-world scenario are identified as such.</span></span> <span data-ttu-id="0fb97-118">Cada tarea incluye información adicional que describe el propósito de la tarea.</span><span class="sxs-lookup"><span data-stu-id="0fb97-118">Each task includes additional information describing the purpose of the task.</span></span>  
  
<span data-ttu-id="0fb97-119">Tiempo estimado para completar esta lección: **30 minutos**</span><span class="sxs-lookup"><span data-stu-id="0fb97-119">Estimated time to complete this lesson: **30 minutes**</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="0fb97-120">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="0fb97-120">Prerequisites</span></span>  
<span data-ttu-id="0fb97-121">Este tema de la lección complementaria forma parte de un tutorial de modelado tabular, que debe completar en orden.</span><span class="sxs-lookup"><span data-stu-id="0fb97-121">This supplemental lesson topic is part of a tabular modeling tutorial, which should be completed in order.</span></span> <span data-ttu-id="0fb97-122">Antes de realizar las tareas de esta lección complementaria, debe haber completado todas las lecciones anteriores.</span><span class="sxs-lookup"><span data-stu-id="0fb97-122">Before performing the tasks in this supplemental lesson, you should have completed all previous lessons.</span></span>  
  
## <a name="add-the-dimsalesterritory-table-to-the-aw-internet-sales-tabular-model-project"></a><span data-ttu-id="0fb97-123">Incorporación de la tabla DimSalesTerritory al proyecto de modelo tabular de AW Internet Sales</span><span class="sxs-lookup"><span data-stu-id="0fb97-123">Add the DimSalesTerritory table to the AW Internet Sales Tabular Model Project</span></span>  
<span data-ttu-id="0fb97-124">Para implementar seguridad dinámica en este escenario de Adventure Works, debe agregar dos tablas adicionales al modelo.</span><span class="sxs-lookup"><span data-stu-id="0fb97-124">To implement dynamic security for this Adventure Works scenario, you must add two additional tables to your model.</span></span> <span data-ttu-id="0fb97-125">La primera tabla que agregará es DimSalesTerritory (como SalesTerritory), de la misma base de datos AdventureWorksDW.</span><span class="sxs-lookup"><span data-stu-id="0fb97-125">The first table you add is DimSalesTerritory (as Sales Territory) from the same AdventureWorksDW database.</span></span> <span data-ttu-id="0fb97-126">Posteriormente, se aplica un filtro de fila a la tabla SalesTerritory que define los datos concretos que puede examinar el usuario con la sesión iniciada.</span><span class="sxs-lookup"><span data-stu-id="0fb97-126">You later apply a row filter to the SalesTerritory table that defines the particular data the logged on user can browse.</span></span>  
  
#### <a name="to-add-the-dimsalesterritory-table"></a><span data-ttu-id="0fb97-127">Procedimiento para agregar la tabla DimSalesTerritory</span><span class="sxs-lookup"><span data-stu-id="0fb97-127">To add the DimSalesTerritory table</span></span>  
  
1.  <span data-ttu-id="0fb97-128">En el Explorador de modelos tabulares, expanda **Orígenes de datos**, haga clic con el botón derecho en la conexión y, luego, haga clic en **Importar nuevas tablas**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-128">In Tabular Model Explorer > **Data Sources**, right-click your connection, and then click **Import New Tables**.</span></span>  

    <span data-ttu-id="0fb97-129">Si aparece el cuadro de diálogo Credenciales de suplantación, escriba las credenciales de suplantación que usó en la lección 2 sobre incorporación de datos.</span><span class="sxs-lookup"><span data-stu-id="0fb97-129">If the Impersonation Credentials dialog box appears, type the impersonation credentials you used in Lesson 2: Add Data.</span></span>
  
2.  <span data-ttu-id="0fb97-130">En el navegador, seleccione la tabla **DimSalesTerritory** y, luego, haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-130">In Navigator, select the **DimSalesTerritory** table, and then click **OK**.</span></span>    
  
3.  <span data-ttu-id="0fb97-131">En el Editor de consultas, haga clic en la consulta **DimSalesTerritory** y, luego, quite la columna **SalesTerritoryAlternateKey**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-131">In Query Editor, click the **DimSalesTerritory** query, and then remove **SalesTerritoryAlternateKey** column.</span></span>  
  
7.  <span data-ttu-id="0fb97-132">Haga clic en **Import**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-132">Click **Import**.</span></span>  
  
    <span data-ttu-id="0fb97-133">La nueva tabla se agrega al área de trabajo del modelo.</span><span class="sxs-lookup"><span data-stu-id="0fb97-133">The new table is added to the model workspace.</span></span> <span data-ttu-id="0fb97-134">Los objetos y datos de la tabla de origen DimSalesTerritory se importan luego en el modelo tabular de ventas de AW Internet Sales.</span><span class="sxs-lookup"><span data-stu-id="0fb97-134">Objects and data from the source DimSalesTerritory table are then imported into your AW Internet Sales Tabular Model.</span></span>  
  
9. <span data-ttu-id="0fb97-135">Cuando la tabla se haya importado correctamente, haga clic en **Cerrar**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-135">After the table has been imported successfully, click **Close**.</span></span>  

## <a name="add-a-table-with-user-name-data"></a><span data-ttu-id="0fb97-136">Incorporación de una tabla con datos de nombres de usuario</span><span class="sxs-lookup"><span data-stu-id="0fb97-136">Add a table with user name data</span></span>  
<span data-ttu-id="0fb97-137">La tabla DimEmployee de la base de datos de ejemplo AdventureWorksDW contiene usuarios del dominio AdventureWorks.</span><span class="sxs-lookup"><span data-stu-id="0fb97-137">The DimEmployee table in the AdventureWorksDW sample database contains users from the AdventureWorks domain.</span></span> <span data-ttu-id="0fb97-138">Los nombres de usuario no existen en su propio entorno.</span><span class="sxs-lookup"><span data-stu-id="0fb97-138">Those user names do not exist in your own environment.</span></span> <span data-ttu-id="0fb97-139">Debe crear una tabla en el modelo que contenga una pequeña muestra de usuarios reales de su organización (al menos tres).</span><span class="sxs-lookup"><span data-stu-id="0fb97-139">You must create a table in your model that contains a small sample (at least three) of actual users from your organization.</span></span> <span data-ttu-id="0fb97-140">Después, agregue estos usuarios como miembros al nuevo rol.</span><span class="sxs-lookup"><span data-stu-id="0fb97-140">You then add these users as members to the new role.</span></span> <span data-ttu-id="0fb97-141">No necesita las contraseñas de los nombres de usuario de ejemplo, pero sí los nombres de usuario de Windows reales de su propio dominio.</span><span class="sxs-lookup"><span data-stu-id="0fb97-141">You do not need the passwords for the sample user names, but you do need actual Windows user names from your own domain.</span></span>  
  
#### <a name="to-add-an-employeesecurity-table"></a><span data-ttu-id="0fb97-142">Procedimiento para agregar una tabla EmployeeSecurity</span><span class="sxs-lookup"><span data-stu-id="0fb97-142">To add an EmployeeSecurity table</span></span>  
  
1.  <span data-ttu-id="0fb97-143">Abra Microsoft Excel para crear una hoja de cálculo.</span><span class="sxs-lookup"><span data-stu-id="0fb97-143">Open Microsoft Excel, creating a worksheet.</span></span>  
  
2.  <span data-ttu-id="0fb97-144">Copie la siguiente tabla, incluida la fila de encabezado y, luego, péguela en la hoja de cálculo.</span><span class="sxs-lookup"><span data-stu-id="0fb97-144">Copy the following table, including the header row, and then paste it into the worksheet.</span></span>  

    ```
      |EmployeeId|SalesTerritoryId|FirstName|LastName|LoginId|  
      |---------------|----------------------|--------------|-------------|------------|  
      |1|2|<user first name>|<user last name>|\<domain\username>|  
      |1|3|<user first name>|<user last name>|\<domain\username>|  
      |2|4|<user first name>|<user last name>|\<domain\username>|  
      |3|5|<user first name>|<user last name>|\<domain\username>|  
    ```

3.  <span data-ttu-id="0fb97-145">Reemplace el nombre, los apellidos y dominio\nombre de usuario por los nombres e identificadores de inicio de sesión de tres usuarios de su organización.</span><span class="sxs-lookup"><span data-stu-id="0fb97-145">Replace the first name, last name, and domain\username with the names and login ids of three users in your organization.</span></span> <span data-ttu-id="0fb97-146">Coloque el mismo usuario en las dos primeras filas de EmployeeId 1, lo que indica que este usuario pertenece a más de un territorio de ventas.</span><span class="sxs-lookup"><span data-stu-id="0fb97-146">Put the same user on the first two rows, for EmployeeId 1, showing this user belongs to more than one sales territory.</span></span> <span data-ttu-id="0fb97-147">Deje los campos EmployeeId y SalesTerritoryId tal y como están.</span><span class="sxs-lookup"><span data-stu-id="0fb97-147">Leave the EmployeeId and SalesTerritoryId fields as they are.</span></span>  
  
4.  <span data-ttu-id="0fb97-148">Guarde la hoja de cálculo como **SampleEmployee**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-148">Save the worksheet as **SampleEmployee**.</span></span>  
  
5.  <span data-ttu-id="0fb97-149">En la hoja de cálculo, seleccione todas las celdas con datos de empleados, incluidos los encabezados. Luego, haga clic con el botón derecho en los datos seleccionados en **Copiar**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-149">In the worksheet, select all the cells with employee data, including the headers, then right-click the selected data, and then click **Copy**.</span></span>  
  
6.  <span data-ttu-id="0fb97-150">En SSDT, haga clic en el menú **Editar** y, luego, en **Pegar**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-150">In SSDT, click the **Edit** menu, and then click **Paste**.</span></span>  
  
    <span data-ttu-id="0fb97-151">Si la opción Pegar está atenuada, haga clic en una columna de cualquier tabla en la ventana del Diseñador de modelos e inténtelo de nuevo.</span><span class="sxs-lookup"><span data-stu-id="0fb97-151">If Paste is grayed out, click any column in any table in the model designer window, and try again.</span></span>  
  
7.  <span data-ttu-id="0fb97-152">En el cuadro de diálogo **Vista previa de pegado**, en **Nombre de la tabla**, escriba **EmployeeSecurity**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-152">In the **Paste Preview** dialog box, in **Table Name**, type **EmployeeSecurity**.</span></span>  
  
8.  <span data-ttu-id="0fb97-153">En **Datos que se van a pegar**, compruebe que los datos incluyen todos los encabezados e información de los usuarios de la hoja de cálculo SampleEmployee.</span><span class="sxs-lookup"><span data-stu-id="0fb97-153">In **Data to be pasted**, verify the data includes all the user data and headers from the SampleEmployee worksheet.</span></span>  
  
9. <span data-ttu-id="0fb97-154">Compruebe que la casilla **Usar primera fila como encabezados de columna** está activada y, luego, haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-154">Verify **Use first row as column headers** is checked, and then click **Ok**.</span></span>  
  
    <span data-ttu-id="0fb97-155">Se creará una nueva tabla denominada "EmployeeSecurity" con datos de empleados copiados de la hoja de cálculo SampleEmployee.</span><span class="sxs-lookup"><span data-stu-id="0fb97-155">A new table named EmployeeSecurity with employee data copied from the SampleEmployee worksheet is created.</span></span>  
  
## <a name="create-relationships-between-factinternetsales-dimgeography-and-dimsalesterritory-table"></a><span data-ttu-id="0fb97-156">Creación de relaciones entre las tablas FactInternetSales, DimGeography y DimSalesTerritory</span><span class="sxs-lookup"><span data-stu-id="0fb97-156">Create relationships between FactInternetSales, DimGeography, and DimSalesTerritory table</span></span>  
<span data-ttu-id="0fb97-157">Las tablas FactInternetSales, DimGeography y DimSalesTerritory contienen una columna común SalesTerritoryId.</span><span class="sxs-lookup"><span data-stu-id="0fb97-157">The FactInternetSales, DimGeography, and DimSalesTerritory table all contain a common column, SalesTerritoryId.</span></span> <span data-ttu-id="0fb97-158">La columna SalesTerritoryId de la tabla DimSalesTerritory contiene valores con un identificador distinto para cada territorio de ventas.</span><span class="sxs-lookup"><span data-stu-id="0fb97-158">The SalesTerritoryId column in the DimSalesTerritory table contains values with a different Id for each sales territory.</span></span>  
  
#### <a name="to-create-relationships-between-the-factinternetsales-dimgeography-and-the-dimsalesterritory-table"></a><span data-ttu-id="0fb97-159">Procedimiento para crear relaciones entre las tablas FactInternetSales, DimGeography y DimSalesTerritory</span><span class="sxs-lookup"><span data-stu-id="0fb97-159">To create relationships between the FactInternetSales, DimGeography, and the DimSalesTerritory table</span></span>  
  
1.  <span data-ttu-id="0fb97-160">En la Vista de diagrama, en la tabla **DimGeography**, haga clic en la columna **SalesTerritoryId** y mantenga presionado el botón izquierdo del ratón; luego, arrastre el cursor hasta la columna **SalesTerritoryId** de la tabla **DimSalesTerritory**. Finalmente, suelte el botón.</span><span class="sxs-lookup"><span data-stu-id="0fb97-160">In Diagram View, in the **DimGeography** table, click, and hold on the **SalesTerritoryId** column, then drag the cursor to the **SalesTerritoryId** column in the **DimSalesTerritory** table, and then release.</span></span>  
  
2.  <span data-ttu-id="0fb97-161">En la tabla **FactInternetSales**, haga clic en la columna **SalesTerritoryId** y mantenga presionado el botón izquierdo del ratón; luego, arrastre el cursor hasta la columna **SalesTerritoryId** de la tabla **DimSalesTerritory**. Finalmente, suelte el botón.</span><span class="sxs-lookup"><span data-stu-id="0fb97-161">In the **FactInternetSales** table, click, and hold on the **SalesTerritoryId** column, then drag the cursor to the **SalesTerritoryId** column in the **DimSalesTerritory** table, and then release.</span></span>  
  
    <span data-ttu-id="0fb97-162">Observe que la propiedad Active de esta relación es False, lo que significa que está inactiva.</span><span class="sxs-lookup"><span data-stu-id="0fb97-162">Notice the Active property for this relationship is False, meaning it's inactive.</span></span> <span data-ttu-id="0fb97-163">La tabla FactInternetSales ya tiene otra relación activa.</span><span class="sxs-lookup"><span data-stu-id="0fb97-163">The FactInternetSales table already has another active relationship.</span></span>  
  
## <a name="hide-the-employeesecurity-table-from-client-applications"></a><span data-ttu-id="0fb97-164">Ocultación de la tabla EmployeeSecurity de las aplicaciones cliente</span><span class="sxs-lookup"><span data-stu-id="0fb97-164">Hide the EmployeeSecurity Table from client applications</span></span>  
<span data-ttu-id="0fb97-165">En esta tarea, ocultará la tabla EmployeeSecurity, de modo que evitará que aparezca en la lista de campos de la aplicación cliente.</span><span class="sxs-lookup"><span data-stu-id="0fb97-165">In this task, you hide the EmployeeSecurity table, keeping it from appearing in a client application’s field list.</span></span> <span data-ttu-id="0fb97-166">Tenga en cuenta que ocultar una tabla no significa protegerla.</span><span class="sxs-lookup"><span data-stu-id="0fb97-166">Keep in mind that hiding a table does not secure it.</span></span> <span data-ttu-id="0fb97-167">Los usuarios todavía pueden consultar datos de la tabla EmployeeSecurity, si saben cómo.</span><span class="sxs-lookup"><span data-stu-id="0fb97-167">Users can still query EmployeeSecurity table data if they know how.</span></span> <span data-ttu-id="0fb97-168">Para proteger los datos de la tabla EmployeeSecurity evitando que los usuarios puedan consultar sus datos, aplique un filtro en una tarea posterior.</span><span class="sxs-lookup"><span data-stu-id="0fb97-168">To secure the EmployeeSecurity table data, preventing users from being able to query any of its data, you apply a filter in a later task.</span></span>  
  
#### <a name="to-hide-the-employeesecurity-table-from-client-applications"></a><span data-ttu-id="0fb97-169">Procedimiento para ocultar la tabla EmployeeSecurity de las aplicaciones cliente</span><span class="sxs-lookup"><span data-stu-id="0fb97-169">To hide the EmployeeSecurity table from client applications</span></span>  
  
-   <span data-ttu-id="0fb97-170">En el Diseñador de modelos, en la vista de diagrama, haga clic con el botón derecho en el encabezado de tabla **Empleado** y, luego, haga clic en **Ocultar en herramientas cliente**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-170">In the model designer, in Diagram View, right-click the **Employee** table heading, and then click **Hide from Client Tools**.</span></span>  
  
## <a name="create-a-sales-employees-by-territory-user-role"></a><span data-ttu-id="0fb97-171">Creación de un rol de usuario Empleados de ventas por territorio</span><span class="sxs-lookup"><span data-stu-id="0fb97-171">Create a Sales Employees by Territory user role</span></span>  
<span data-ttu-id="0fb97-172">En esta tarea, creará un rol de usuario.</span><span class="sxs-lookup"><span data-stu-id="0fb97-172">In this task, you create a user role.</span></span> <span data-ttu-id="0fb97-173">Este rol incluye un filtro de fila que define qué filas de la tabla DimSalesTerritory serán visibles para los usuarios.</span><span class="sxs-lookup"><span data-stu-id="0fb97-173">This role includes a row filter defining which rows of the DimSalesTerritory table are visible to users.</span></span> <span data-ttu-id="0fb97-174">Después, se aplica el filtro en la dirección de la relación de uno a muchos a todas las demás tablas relacionadas con DimSalesTerritory.</span><span class="sxs-lookup"><span data-stu-id="0fb97-174">The filter is then applied in the one-to-many relationship direction to all other tables related to DimSalesTerritory.</span></span> <span data-ttu-id="0fb97-175">También aplicará un filtro que protege toda la tabla EmployeeSecurity de las consultas que realice cualquier usuario que sea miembro del rol.</span><span class="sxs-lookup"><span data-stu-id="0fb97-175">You also apply a filter that secures the entire EmployeeSecurity table from being queryable by any user that is a member of the role.</span></span>  
  
> [!NOTE]  
> <span data-ttu-id="0fb97-176">El rol Empleados de ventas por territorio que creará en esta lección permitirá a los miembros examinar (o consultar) solo los datos de ventas del territorio de ventas al que pertenecen.</span><span class="sxs-lookup"><span data-stu-id="0fb97-176">The Sales Employees by Territory role you create in this lesson restricts members to browse (or query) only sales data for the sales territory to which they belong.</span></span> <span data-ttu-id="0fb97-177">Si agrega un usuario como miembro al rol Empleados de ventas por territorio que también existe como un miembro de un rol creado en la [lección 11 sobre cómo creación de roles](../tutorials/aas-lesson-11-create-roles.md), obtendrá una combinación de permisos.</span><span class="sxs-lookup"><span data-stu-id="0fb97-177">If you add a user as a member to the Sales Employees by Territory role that also exists as a member in a role created in [Lesson 11: Create Roles](../tutorials/aas-lesson-11-create-roles.md), you get a combination of permissions.</span></span> <span data-ttu-id="0fb97-178">Cuando un usuario es miembro de varios roles, los permisos y filtros de fila definidos para cada rol son acumulativos.</span><span class="sxs-lookup"><span data-stu-id="0fb97-178">When a user is a member of multiple roles, the permissions, and row filters defined for each role are cumulative.</span></span> <span data-ttu-id="0fb97-179">Es decir, la combinación de roles determina los permisos más elevados que tendrá el usuario.</span><span class="sxs-lookup"><span data-stu-id="0fb97-179">That is, the user has the greater permissions determined by the combination of roles.</span></span>  
  
#### <a name="to-create-a-sales-employees-by-territory-user-role"></a><span data-ttu-id="0fb97-180">Procedimiento para crear un rol de usuario Empleados de ventas por territorio</span><span class="sxs-lookup"><span data-stu-id="0fb97-180">To create a Sales Employees by Territory user role</span></span>  
  
1.  <span data-ttu-id="0fb97-181">En SSDT, haga clic en el menú **Modelo** y en **Roles**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-181">In SSDT, click the **Model** menu, and then click **Roles**.</span></span>  
  
2.  <span data-ttu-id="0fb97-182">En **Administrador de roles**, haga clic en **Nuevo**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-182">In **Role Manager**, click **New**.</span></span>  
  
    <span data-ttu-id="0fb97-183">Se agrega a la lista un nuevo rol con el permiso Ninguno.</span><span class="sxs-lookup"><span data-stu-id="0fb97-183">A new role with the None permission is added to the list.</span></span>  
  
3.  <span data-ttu-id="0fb97-184">Haga clic en el nuevo rol y, luego, en la columna **Nombre**, cambie el nombre del rol a **Empleados de ventas por territorio**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-184">Click the new role, and then in the **Name** column, rename the role to **Sales Employees by Territory**.</span></span>  
  
4.  <span data-ttu-id="0fb97-185">En la columna **Permisos**, haga clic en la lista desplegable y, luego, seleccione el permiso **Lectura**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-185">In the **Permissions** column, click the dropdown list, and then select the **Read** permission.</span></span>  
  
5.  <span data-ttu-id="0fb97-186">Haga clic en la pestaña **Miembros** y, luego, haga clic en **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-186">Click the **Members** tab, and then click **Add**.</span></span>  
  
6.  <span data-ttu-id="0fb97-187">En el cuadro de diálogo **Seleccionar usuario o grupo** de la opción para **escribir el nombre del objeto que se seleccionará**, escriba el primer nombre de usuario de ejemplo que utilizó al crear la tabla EmployeeSecurity.</span><span class="sxs-lookup"><span data-stu-id="0fb97-187">In the **Select User or Group** dialog box, in **Enter the object named to select**, type the first sample user name you used when creating the EmployeeSecurity table.</span></span> <span data-ttu-id="0fb97-188">Haga clic en **Comprobar nombres** para comprobar que el nombre de usuario es válido y, luego, haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-188">Click **Check Names** to verify the user name is valid, and then click **Ok**.</span></span>  
  
    <span data-ttu-id="0fb97-189">Repita este paso agregando los demás nombres de usuario de ejemplo que utilizó al crear la tabla EmployeeSecurity.</span><span class="sxs-lookup"><span data-stu-id="0fb97-189">Repeat this step, adding the other sample user names you used when creating the EmployeeSecurity table.</span></span>  
  
7.  <span data-ttu-id="0fb97-190">Haga clic en la pestaña **Filtros de fila**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-190">Click the **Row Filters** tab.</span></span>  
  
8.  <span data-ttu-id="0fb97-191">Para la tabla **EmployeeSecurity**, en la columna **Filtro DAX**, escriba la siguiente fórmula:</span><span class="sxs-lookup"><span data-stu-id="0fb97-191">For the **EmployeeSecurity** table, in the **DAX Filter** column, type the following formula:</span></span>  
  
    ```
      =FALSE()  
    ```
  
    <span data-ttu-id="0fb97-192">Esta fórmula especifica que todas las columnas se resuelven en la condición booleana falso.</span><span class="sxs-lookup"><span data-stu-id="0fb97-192">This formula specifies that all columns resolve to the false Boolean condition.</span></span> <span data-ttu-id="0fb97-193">Los empleados de ventas no pueden consultar ninguna columna de la tabla EmployeeSecurity por el rol de usuario Territorio.</span><span class="sxs-lookup"><span data-stu-id="0fb97-193">No columns for the EmployeeSecurity table can be queried by a member of the Sales Employees by Territory user role.</span></span>  
  
9. <span data-ttu-id="0fb97-194">Para la tabla **DimSalesTerritory**, escriba la siguiente fórmula:</span><span class="sxs-lookup"><span data-stu-id="0fb97-194">For the **DimSalesTerritory** table, type the following formula:</span></span>  

    ```  
    ='Sales Territory'[Sales Territory Id]=LOOKUPVALUE('Employee Security'[Sales Territory Id], 
      'Employee Security'[Login Id], USERNAME(), 
      'Employee Security'[Sales Territory Id], 
      'Sales Territory'[Sales Territory Id]) 
    ```
  
    <span data-ttu-id="0fb97-195">En esta fórmula, la función LOOKUPVALUE devuelve todos los valores de la columna DimEmployeeSecurity[SalesTerritoryId], donde el valor de EmployeeSecurity[LoginId] es el mismo que el nombre de usuario de Windows que tiene la sesión iniciada, y el de EmployeeSecurity[SalesTerritoryId] es el mismo que el de DimSalesTerritory[SalesTerritoryId].</span><span class="sxs-lookup"><span data-stu-id="0fb97-195">In this formula, the LOOKUPVALUE function returns all values for the DimEmployeeSecurity[SalesTerritoryId] column, where the EmployeeSecurity[LoginId] is the same as the current logged on Windows user name, and EmployeeSecurity[SalesTerritoryId] is the same as the DimSalesTerritory[SalesTerritoryId].</span></span>  
  
    <span data-ttu-id="0fb97-196">El conjunto de identificadores del territorio de ventas que se devuelven mediante LOOKUPVALUE se usa para restringir las filas que se muestran en la tabla DimSalesTerritory.</span><span class="sxs-lookup"><span data-stu-id="0fb97-196">The set of sales territory IDs returned by LOOKUPVALUE is then used to restrict the rows shown in the DimSalesTerritory table.</span></span> <span data-ttu-id="0fb97-197">Solo se muestran las filas donde se encuentra el valor de SalesTerritoryID para la fila del conjunto de identificadores devueltos mediante la función LOOKUPVALUE.</span><span class="sxs-lookup"><span data-stu-id="0fb97-197">Only rows where the SalesTerritoryID for the row is in the set of IDs returned by the LOOKUPVALUE function are displayed.</span></span>  
  
10. <span data-ttu-id="0fb97-198">En el Administrador de roles, haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-198">In Role Manager, click **Ok**.</span></span>  
  
## <a name="test-the-sales-employees-by-territory-user-role"></a><span data-ttu-id="0fb97-199">Prueba del rol de usuario Empleados de ventas por territorio</span><span class="sxs-lookup"><span data-stu-id="0fb97-199">Test the Sales Employees by Territory User Role</span></span>  
<span data-ttu-id="0fb97-200">En esta tarea, usará la característica Analizar en Excel de SSDT para probar la eficacia del rol de usuario Empleados de ventas por territorio.</span><span class="sxs-lookup"><span data-stu-id="0fb97-200">In this task, you use the Analyze in Excel feature in SSDT to test the efficacy of the Sales Employees by Territory user role.</span></span> <span data-ttu-id="0fb97-201">Especifique uno de los nombres de usuario que agregó a la tabla EmployeeSecurity y como miembro del rol.</span><span class="sxs-lookup"><span data-stu-id="0fb97-201">You specify one of the user names you added to the EmployeeSecurity table and as a member of the role.</span></span> <span data-ttu-id="0fb97-202">Este nombre de usuario se utiliza como el nombre de usuario efectivo en la conexión creada entre Excel y el modelo.</span><span class="sxs-lookup"><span data-stu-id="0fb97-202">This user name is then used as the effective user name in the connection created between Excel and the model.</span></span>  
  
#### <a name="to-test-the-sales-employees-by-territory-user-role"></a><span data-ttu-id="0fb97-203">Procedimiento para probar el rol de usuario Empleados de ventas por territorio</span><span class="sxs-lookup"><span data-stu-id="0fb97-203">To test the Sales Employees by Territory user role</span></span>  
  
1.  <span data-ttu-id="0fb97-204">En SSDT, haga clic en el menú **Modelo** y en **Analizar en Excel**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-204">In SSDT, click the **Model** menu, and then click **Analyze in Excel**.</span></span>  
  
2.  <span data-ttu-id="0fb97-205">En el cuadro de diálogo **Analizar en Excel**, en **Especifique el nombre de usuario o rol que se va a usar al conectarse al modelo**, seleccione **Otro usuario de Windows**. Después, haga clic en **Examinar**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-205">In the **Analyze in Excel** dialog box, in **Specify the user name or role to use to connect to the model**, select **Other Windows User**, and then click **Browse**.</span></span>  
  
3.  <span data-ttu-id="0fb97-206">En el cuadro de diálogo **Seleccionar usuario o grupo**, en **Enter the object name to select** (Escribir el nombre de objeto para seleccionar), escriba uno de los nombres de usuario que incluyó en la tabla EmployeeSecurity. Después, haga clic en **Comprobar nombres**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-206">In the **Select User or Group** dialog box, in **Enter the object name to select**, type a user name you included in the EmployeeSecurity table, and then click **Check Names**.</span></span>  
  
4.  <span data-ttu-id="0fb97-207">Haga clic en **Aceptar** para cerrar el **Seleccionar usuario o grupo** cuadro de diálogo y, a continuación, haga clic en **Aceptar** para cerrar el **analizar en Excel** cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="0fb97-207">Click **Ok** to close the **Select User or Group** dialog box, and then click **Ok** to close the **Analyze in Excel** dialog box.</span></span>  
  
    <span data-ttu-id="0fb97-208">Excel se abre con un nuevo libro.</span><span class="sxs-lookup"><span data-stu-id="0fb97-208">Excel opens with a new workbook.</span></span> <span data-ttu-id="0fb97-209">Automáticamente se crea una tabla dinámica.</span><span class="sxs-lookup"><span data-stu-id="0fb97-209">A PivotTable is automatically created.</span></span> <span data-ttu-id="0fb97-210">La lista PivotTable Fields incluye la mayoría de los campos de datos disponibles en el nuevo modelo.</span><span class="sxs-lookup"><span data-stu-id="0fb97-210">The PivotTable Fields list includes most of the data fields available in your new model.</span></span>  
  
    <span data-ttu-id="0fb97-211">Observe que la tabla EmployeeSecurity no está visible en la lista de campos de la tabla dinámica.</span><span class="sxs-lookup"><span data-stu-id="0fb97-211">Notice the EmployeeSecurity table is not visible in the PivotTable Fields list.</span></span> <span data-ttu-id="0fb97-212">Ocultó esta tabla de las herramientas de cliente en una tarea anterior.</span><span class="sxs-lookup"><span data-stu-id="0fb97-212">You hid this table from client tools in a previous task.</span></span>  
  
5.  <span data-ttu-id="0fb97-213">En la lista **Campos** de **Ventas por Internet de ∑** (medidas), seleccione la medida **InternetTotalSales**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-213">In the **Fields** list, in **∑ Internet Sales** (measures), select the **InternetTotalSales** measure.</span></span> <span data-ttu-id="0fb97-214">La medida se escribe en los campos de **Valores**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-214">The measure is entered into the **Values** fields.</span></span>  
  
6.  <span data-ttu-id="0fb97-215">Seleccione la columna **SalesTerritoryId** desde la tabla **DimSalesTerritory**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-215">Select the **SalesTerritoryId** column from the **DimSalesTerritory** table.</span></span> <span data-ttu-id="0fb97-216">La columna se escribe en los campos **Etiquetas de fila**.</span><span class="sxs-lookup"><span data-stu-id="0fb97-216">The column is entered into the **Row Labels** fields.</span></span>  
  
    <span data-ttu-id="0fb97-217">Tenga en cuenta que las cifras de ventas por Internet solo aparecen para la región a la que pertenece el nombre de usuario efectivo que usó.</span><span class="sxs-lookup"><span data-stu-id="0fb97-217">Notice Internet sales figures appear only for the one region to which the effective user name you used belongs.</span></span> <span data-ttu-id="0fb97-218">Si selecciona otra columna, como City, de la tabla DimGeography como campo de etiqueta de fila, solo se mostrarán las ciudades del territorio de ventas al que pertenece el usuario efectivo.</span><span class="sxs-lookup"><span data-stu-id="0fb97-218">If you select another column, like City from the DimGeography table as Row Label field, only cities in the sales territory to which the effective user belongs are displayed.</span></span>  
  
    <span data-ttu-id="0fb97-219">Este usuario no puede examinar ni consultar los datos de ventas por Internet de territorios distintos al que pertenece.</span><span class="sxs-lookup"><span data-stu-id="0fb97-219">This user cannot browse or query any Internet sales data for territories other than the one they belong to.</span></span> <span data-ttu-id="0fb97-220">Esta restricción se debe a que el filtro de fila definido para la tabla DimSalesTerritory, del rol de usuario Empleados de ventas por territorio, protege los datos de toda la información relacionada con otros territorios de ventas.</span><span class="sxs-lookup"><span data-stu-id="0fb97-220">This restriction is because the row filter defined for the DimSalesTerritory table, in the Sales Employees by Territory user role, secures data for all data related to other sales territories.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="0fb97-221">Otras referencias</span><span class="sxs-lookup"><span data-stu-id="0fb97-221">See Also</span></span>  
[<span data-ttu-id="0fb97-222">Función USERNAME (DAX)</span><span class="sxs-lookup"><span data-stu-id="0fb97-222">USERNAME Function (DAX)</span></span>](https://msdn.microsoft.com/library/hh230954.aspx)  
[<span data-ttu-id="0fb97-223">Función LOOKUPVALUE (DAX)</span><span class="sxs-lookup"><span data-stu-id="0fb97-223">LOOKUPVALUE Function (DAX)</span></span>](https://msdn.microsoft.com/library/gg492170.aspx)  
[<span data-ttu-id="0fb97-224">Función CUSTOMDATA (DAX)</span><span class="sxs-lookup"><span data-stu-id="0fb97-224">CUSTOMDATA Function (DAX)</span></span>](https://msdn.microsoft.com/library/hh213140.aspx)  
---
title: uso de aaaAdvanced de servicios de confianza | Documentos de Microsoft
description: "Obtenga información sobre el uso avanzado de Reliable Services de Service Fabric para obtener una mayor flexibilidad en los servicios."
services: Service-Fabric
documentationcenter: .net
author: vturecek
manager: timlt
editor: masnider
ms.assetid: f2942871-863d-47c3-b14a-7cdad9a742c7
ms.service: Service-Fabric
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/29/2017
ms.author: vturecek
ms.openlocfilehash: e6d6310a4deae9edcfcd76551e1337f0e39e9e5d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="advanced-usage-of-hello-reliable-services-programming-model"></a><span data-ttu-id="29485-103">Uso del modelo de programación de servicios confiables Hola avanzado</span><span class="sxs-lookup"><span data-stu-id="29485-103">Advanced usage of hello Reliable Services programming model</span></span>
<span data-ttu-id="29485-104">Azure Service Fabric simplifica la escritura y administración de los servicios con y sin estado confiables.</span><span class="sxs-lookup"><span data-stu-id="29485-104">Azure Service Fabric simplifies writing and managing reliable stateless and stateful services.</span></span> <span data-ttu-id="29485-105">Esta guía habla de usos avanzados de servicios de confianza toogain mayor control y flexibilidad sobre los servicios.</span><span class="sxs-lookup"><span data-stu-id="29485-105">This guide talks about advanced usages of Reliable Services toogain more control and flexibility over your services.</span></span> <span data-ttu-id="29485-106">Tooreading anterior esta guía, familiarícese con [modelo de programación de servicios de confianza de hello](service-fabric-reliable-services-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="29485-106">Prior tooreading this guide, familiarize yourself with [hello Reliable Services programming model](service-fabric-reliable-services-introduction.md).</span></span>

<span data-ttu-id="29485-107">Los servicios con y sin estado tienen dos puntos de entrada principal para el código de usuario:</span><span class="sxs-lookup"><span data-stu-id="29485-107">Both stateful and stateless services have two primary entry points for user code:</span></span>

* <span data-ttu-id="29485-108">`RunAsync(C#) / runAsync(Java)` es un punto de entrada de propósito general para el código del servicio.</span><span class="sxs-lookup"><span data-stu-id="29485-108">`RunAsync(C#) / runAsync(Java)` is a general-purpose entry point for your service code.</span></span>
* <span data-ttu-id="29485-109">`CreateServiceReplicaListeners(C#)` y `CreateServiceInstanceListeners(C#) / createServiceInstanceListeners(Java)` se usan con el fin de abrir agentes de escucha de comunicación para las solicitudes de cliente.</span><span class="sxs-lookup"><span data-stu-id="29485-109">`CreateServiceReplicaListeners(C#)` and `CreateServiceInstanceListeners(C#) / createServiceInstanceListeners(Java)` is for opening communication listeners for client requests.</span></span>

<span data-ttu-id="29485-110">En la mayoría de los servicios, estos puntos de dos entradas son suficientes.</span><span class="sxs-lookup"><span data-stu-id="29485-110">For most services, these two entry points are sufficient.</span></span> <span data-ttu-id="29485-111">En raras ocasiones, cuando se precisa más control sobre el ciclo de vida de un servicio, se encuentran disponibles eventos de ciclo de vida adicionales.</span><span class="sxs-lookup"><span data-stu-id="29485-111">In rare cases when more control over a service's lifecycle is required, additional lifecycle events are available.</span></span>

## <a name="stateless-service-instance-lifecycle"></a><span data-ttu-id="29485-112">Ciclo de vida de instancias de servicios sin estado</span><span class="sxs-lookup"><span data-stu-id="29485-112">Stateless service instance lifecycle</span></span>
<span data-ttu-id="29485-113">El ciclo de vida de un servicio sin estado es muy sencillo.</span><span class="sxs-lookup"><span data-stu-id="29485-113">A stateless service's lifecycle is very simple.</span></span> <span data-ttu-id="29485-114">Los servicios sin estado solo se pueden abrir, cerrar o anular.</span><span class="sxs-lookup"><span data-stu-id="29485-114">A stateless service can only be opened, closed, or aborted.</span></span> <span data-ttu-id="29485-115">El elemento `RunAsync` incluido en un servicio sin estado se ejecuta cuando se abre una instancia de este y se cancela cuando se cierra o anula una instancia de dicho servicio.</span><span class="sxs-lookup"><span data-stu-id="29485-115">`RunAsync` in a stateless service is executed when a service instance is opened, and canceled when a service instance is closed or aborted.</span></span>

<span data-ttu-id="29485-116">Aunque `RunAsync` debería ser suficiente en casi todos los casos, Hola abrir, cerrar y eventos de anulación en un servicio sin estado también están disponibles:</span><span class="sxs-lookup"><span data-stu-id="29485-116">Although `RunAsync` should be sufficient in almost all cases, hello open, close, and abort events in a stateless service are also available:</span></span>

* <span data-ttu-id="29485-117">`Task OnOpenAsync(IStatelessServicePartition, CancellationToken) - C# / CompletableFuture<String> onOpenAsync(CancellationToken) - Java`OnOpenAsync se llama una vez instancia de servicio sin estado Hola sobre toobe usa.</span><span class="sxs-lookup"><span data-stu-id="29485-117">`Task OnOpenAsync(IStatelessServicePartition, CancellationToken) - C# / CompletableFuture<String> onOpenAsync(CancellationToken) - Java` OnOpenAsync is called when hello stateless service instance is about toobe used.</span></span> <span data-ttu-id="29485-118">En este momento, se pueden iniciar las tareas de inicialización del servicio ampliado.</span><span class="sxs-lookup"><span data-stu-id="29485-118">Extended service initialization tasks can be started at this time.</span></span>
* <span data-ttu-id="29485-119">`Task OnCloseAsync(CancellationToken) - C# / CompletableFuture onCloseAsync(CancellationToken) - Java`OnCloseAsync se llama cuando la instancia de servicio sin estado Hola va toobe cerrado correctamente.</span><span class="sxs-lookup"><span data-stu-id="29485-119">`Task OnCloseAsync(CancellationToken) - C# / CompletableFuture onCloseAsync(CancellationToken) - Java` OnCloseAsync is called when hello stateless service instance is going toobe gracefully shut down.</span></span> <span data-ttu-id="29485-120">Esto puede ocurrir cuando se está actualizando el código de servicio de hello, instancia de servicio de Hola se traslada debido tooload equilibrio o se detecta un error transitorio.</span><span class="sxs-lookup"><span data-stu-id="29485-120">This can occur when hello service's code is being upgraded, hello service instance is being moved due tooload balancing, or a transient fault is detected.</span></span> <span data-ttu-id="29485-121">OnCloseAsync puede ser usado toosafely cerrar todos los recursos, detener cualquier procesamiento en segundo plano, terminar de guardar estado externo o cerrar conexiones existentes.</span><span class="sxs-lookup"><span data-stu-id="29485-121">OnCloseAsync can be used toosafely close any resources, stop any background processing, finish saving external state, or close down existing connections.</span></span>
* <span data-ttu-id="29485-122">`void OnAbort() - C# / void onAbort() - Java`OnAbort se llama cuando la instancia de servicio sin estado de saludo se está cerrando forzosamente.</span><span class="sxs-lookup"><span data-stu-id="29485-122">`void OnAbort() - C# / void onAbort() - Java` OnAbort is called when hello stateless service instance is being forcefully shut down.</span></span> <span data-ttu-id="29485-123">Por lo general, esto se denomina cuando se detecta un error permanente en el nodo de hello, o cuando Service Fabric no se puede administrar de manera fiable del ciclo de vida de la instancia de servicio de hello debido a errores de toointernal.</span><span class="sxs-lookup"><span data-stu-id="29485-123">This is generally called when a permanent fault is detected on hello node, or when Service Fabric cannot reliably manage hello service instance's lifecycle due toointernal failures.</span></span>

## <a name="stateful-service-replica-lifecycle"></a><span data-ttu-id="29485-124">Ciclo de vida de réplicas de servicio con estado</span><span class="sxs-lookup"><span data-stu-id="29485-124">Stateful service replica lifecycle</span></span>

> [!NOTE]
> <span data-ttu-id="29485-125">Las instancias con estado de Reliable Services aún no se admiten en Java.</span><span class="sxs-lookup"><span data-stu-id="29485-125">Stateful reliable services are not supported in Java yet.</span></span>
>
>

<span data-ttu-id="29485-126">El ciclo de vida de una réplica de servicio con estado es mucho más complejo que una instancia de servicio sin estado.</span><span class="sxs-lookup"><span data-stu-id="29485-126">A stateful service replica's lifecycle is much more complex than a stateless service instance.</span></span> <span data-ttu-id="29485-127">Además tooopen, cierre y anular los eventos, cambios de rol se somete a una réplica de servicio con estado durante su duración.</span><span class="sxs-lookup"><span data-stu-id="29485-127">In addition tooopen, close, and abort events, a stateful service replica undergoes role changes during its lifetime.</span></span> <span data-ttu-id="29485-128">Cuando una réplica de servicio con estado cambia de rol, Hola `OnChangeRoleAsync` se desencadena el evento:</span><span class="sxs-lookup"><span data-stu-id="29485-128">When a stateful service replica changes role, hello `OnChangeRoleAsync` event is triggered:</span></span>

* <span data-ttu-id="29485-129">`Task OnChangeRoleAsync(ReplicaRole, CancellationToken)`OnChangeRoleAsync se llama cuando la réplica de servicio con estado de hello es cambiar el rol, por ejemplo tooprimary o base de datos secundaria.</span><span class="sxs-lookup"><span data-stu-id="29485-129">`Task OnChangeRoleAsync(ReplicaRole, CancellationToken)` OnChangeRoleAsync is called when hello stateful service replica is changing role, for example tooprimary or secondary.</span></span> <span data-ttu-id="29485-130">Las réplicas principales tienen estado de escritura (se permiten toocreate y escribir tooReliable colecciones).</span><span class="sxs-lookup"><span data-stu-id="29485-130">Primary replicas are given write status (are allowed toocreate and write tooReliable Collections).</span></span> <span data-ttu-id="29485-131">Las réplicas secundarias reciben el estado de lectura (solo pueden leer desde Reliable Collections existentes).</span><span class="sxs-lookup"><span data-stu-id="29485-131">Secondary replicas are given read status (can only read from existing Reliable Collections).</span></span> <span data-ttu-id="29485-132">Se realiza la mayor parte del trabajo en un servicio con estado en la réplica principal de Hola.</span><span class="sxs-lookup"><span data-stu-id="29485-132">Most work in a stateful service is performed at hello primary replica.</span></span> <span data-ttu-id="29485-133">Las réplicas secundarias pueden realizar validación de solo lectura, generación de informes, minería de datos u otros trabajos de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="29485-133">Secondary replicas can perform read-only validation, report generation, data mining, or other read-only jobs.</span></span>

<span data-ttu-id="29485-134">En un servicio con estado, sólo réplica principal de hello tiene toostate de acceso de escritura y, por tanto, generalmente es cuando el servicio de hello está realizando trabajo real.</span><span class="sxs-lookup"><span data-stu-id="29485-134">In a stateful service, only hello primary replica has write access toostate and thus is generally when hello service is performing actual work.</span></span> <span data-ttu-id="29485-135">Hola `RunAsync` método en un servicio con estado se ejecuta solo cuando la réplica de servicio con estado de hello es principal.</span><span class="sxs-lookup"><span data-stu-id="29485-135">hello `RunAsync` method in a stateful service is executed only when hello stateful service replica is primary.</span></span> <span data-ttu-id="29485-136">Hola `RunAsync` método se cancela cuando los cambios de rol de la réplica principal fuera principal, así como durante Hola cierre y anulación los eventos.</span><span class="sxs-lookup"><span data-stu-id="29485-136">hello `RunAsync` method is canceled when a primary replica's role changes away from primary, as well as during hello close and abort events.</span></span>

<span data-ttu-id="29485-137">Con hello `OnChangeRoleAsync` evento le permite tooperform trabajo según el rol de réplica, así como en el cambio de toorole de respuesta.</span><span class="sxs-lookup"><span data-stu-id="29485-137">Using hello `OnChangeRoleAsync` event allows you tooperform work depending on replica role as well as in response toorole change.</span></span>

<span data-ttu-id="29485-138">Un servicio con estado también proporciona eventos de ciclo de vida de hello cuatro misma como un servicio sin estado, con Hola la misma semántica y casos de uso:</span><span class="sxs-lookup"><span data-stu-id="29485-138">A stateful service also provides hello same four lifecycle events as a stateless service, with hello same semantics and use cases:</span></span>

```csharp
* Task OnOpenAsync(IStatefulServicePartition, CancellationToken)
* Task OnCloseAsync(CancellationToken)
* void OnAbort()
```

## <a name="next-steps"></a><span data-ttu-id="29485-139">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="29485-139">Next steps</span></span>
<span data-ttu-id="29485-140">Para más avanzados temas de tejido de tooService relacionados, vea Hola siguientes artículos:</span><span class="sxs-lookup"><span data-stu-id="29485-140">For more advanced topics related tooService Fabric, see hello following articles:</span></span>

* [<span data-ttu-id="29485-141">Configuración de Reliable Services con estado</span><span class="sxs-lookup"><span data-stu-id="29485-141">Configuring stateful Reliable Services</span></span>](service-fabric-reliable-services-configuration.md)
* [<span data-ttu-id="29485-142">Introducción al estado de Service Fabric</span><span class="sxs-lookup"><span data-stu-id="29485-142">Service Fabric health introduction</span></span>](service-fabric-health-introduction.md)
* [<span data-ttu-id="29485-143">Uso de informes de mantenimiento del sistema para solucionar problemas</span><span class="sxs-lookup"><span data-stu-id="29485-143">Using system health reports for troubleshooting</span></span>](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)
* [<span data-ttu-id="29485-144">Configuración de servicios con hello servicio Administrador de recursos del clúster de tejido</span><span class="sxs-lookup"><span data-stu-id="29485-144">Configuring Services with hello Service Fabric Cluster Resource Manager</span></span>](service-fabric-cluster-resource-manager-configure-services.md)

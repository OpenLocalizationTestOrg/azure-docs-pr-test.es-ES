---
title: "comunicación aaaService con hello ASP.NET Core | Documentos de Microsoft"
description: "Obtenga información acerca de cómo toouse ASP.NET principales en servicios de confianza y sin estado."
services: service-fabric
documentationcenter: .net
author: vturecek
manager: timlt
editor: 
ms.assetid: 8aa4668d-cbb6-4225-bd2d-ab5925a868f2
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: required
ms.date: 05/02/2017
ms.author: vturecek
ms.openlocfilehash: 6e6a83ab04390150292f63de5d9b51d290284e50
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="aspnet-core-in-service-fabric-reliable-services"></a><span data-ttu-id="360d0-103">ASP.NET Core en Reliable Services de Service Fabric</span><span class="sxs-lookup"><span data-stu-id="360d0-103">ASP.NET Core in Service Fabric Reliable Services</span></span>

<span data-ttu-id="360d0-104">ASP.NET Core es un nuevo marco de código abierto multiplataforma para crear aplicaciones conectadas a Internet modernas y basadas en la nube, como aplicaciones web, aplicaciones de IoT y back-ends móviles.</span><span class="sxs-lookup"><span data-stu-id="360d0-104">ASP.NET Core is a new open-source and cross-platform framework for building modern cloud-based Internet-connected applications, such as web apps, IoT apps, and mobile backends.</span></span> 

<span data-ttu-id="360d0-105">Este artículo es una toohosting guía detallada de los servicios básicos de ASP.NET en los servicios de confianza de tejido de servicio por hello **Microsoft.ServiceFabric.AspNetCore.** * el conjunto de paquetes de NuGet.</span><span class="sxs-lookup"><span data-stu-id="360d0-105">This article is an in-depth guide toohosting ASP.NET Core services in Service Fabric Reliable Services using hello **Microsoft.ServiceFabric.AspNetCore.*** set of NuGet packages.</span></span>

<span data-ttu-id="360d0-106">Para ver un tutorial introductorio sobre ASP.NET Core en Service Fabric e instrucciones para configurar el entorno de desarrollo, consulte [Creación de un front-end de servicio web para una aplicación mediante ASP.NET Core](service-fabric-add-a-web-frontend.md).</span><span class="sxs-lookup"><span data-stu-id="360d0-106">For an introductory tutorial on ASP.NET Core in Service Fabric and instructions on getting your development environment set up, see [Building a web front-end for your application using ASP.NET Core](service-fabric-add-a-web-frontend.md).</span></span>

<span data-ttu-id="360d0-107">resto de Hola de este artículo se da por supuesto que ya está familiarizados con ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="360d0-107">hello rest of this article assumes you are already familiar with ASP.NET Core.</span></span> <span data-ttu-id="360d0-108">Si no es así, se recomienda leer hello [Fundamentos de ASP.NET Core](https://docs.microsoft.com/aspnet/core/fundamentals/index).</span><span class="sxs-lookup"><span data-stu-id="360d0-108">If not, we recommend reading through hello [ASP.NET Core fundamentals](https://docs.microsoft.com/aspnet/core/fundamentals/index).</span></span>

## <a name="aspnet-core-in-hello-service-fabric-environment"></a><span data-ttu-id="360d0-109">ASP.NET Core en entorno de Service Fabric Hola</span><span class="sxs-lookup"><span data-stu-id="360d0-109">ASP.NET Core in hello Service Fabric environment</span></span>

<span data-ttu-id="360d0-110">Si bien pueden ejecutar aplicaciones de ASP.NET Core en .NET Core o en hello en que completa de .NET Framework, servicios de Service Fabric actualmente solo puede ejecutarse Hola completa de .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="360d0-110">While ASP.NET Core apps can run on .NET Core or on hello full .NET Framework, Service Fabric services currently can only run on hello full .NET Framework.</span></span> <span data-ttu-id="360d0-111">Esto significa que cuando se crea un servicio ASP.NET Core Service Fabric, todavía debe dirigir Hola completa de .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="360d0-111">This means when you build an ASP.NET  Core Service Fabric service, you must still target hello full .NET Framework.</span></span>

<span data-ttu-id="360d0-112">ASP.NET Core se puede utilizar de dos maneras diferentes en Service Fabric:</span><span class="sxs-lookup"><span data-stu-id="360d0-112">ASP.NET Core can be used in two different ways in Service Fabric:</span></span>
 - <span data-ttu-id="360d0-113">**Implementado como archivo ejecutable invitado**.</span><span class="sxs-lookup"><span data-stu-id="360d0-113">**Hosted as a guest executable**.</span></span> <span data-ttu-id="360d0-114">Esto es principalmente toorun usa ASP.NET Core aplicaciones existentes en el tejido de servicio sin realizar ningún cambio en el código.</span><span class="sxs-lookup"><span data-stu-id="360d0-114">This is primarily used toorun existing ASP.NET Core applications on Service Fabric with no code changes.</span></span>
 - <span data-ttu-id="360d0-115">**Ejecutado dentro de una instancia de Reliable Services**.</span><span class="sxs-lookup"><span data-stu-id="360d0-115">**Run inside a Reliable Service**.</span></span> <span data-ttu-id="360d0-116">Esto permite una mejor integración con el tiempo de ejecución de hello Service Fabric y permite a los servicios con estado ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="360d0-116">This allows better integration with hello Service Fabric runtime and allows stateful ASP.NET Core services.</span></span>

<span data-ttu-id="360d0-117">resto de Hola de este artículo explica cómo Hola toouse ASP.NET Core dentro de un servicio confiable mediante los componentes de integración de ASP.NET Core que se incluyen con hello SDK del servicio de Fabric.</span><span class="sxs-lookup"><span data-stu-id="360d0-117">hello rest of this article explains how toouse ASP.NET Core inside a Reliable Service using hello ASP.NET Core integration components that ship with hello Service Fabric SDK.</span></span> 

## <a name="service-fabric-service-hosting"></a><span data-ttu-id="360d0-118">Hospedaje de servicios de Service Fabric</span><span class="sxs-lookup"><span data-stu-id="360d0-118">Service Fabric service hosting</span></span>

<span data-ttu-id="360d0-119">En Service Fabric, una o varias instancias o réplicas del servicio se ejecutan en un *proceso de host de servicio* (un archivo ejecutable que ejecuta el código del servicio).</span><span class="sxs-lookup"><span data-stu-id="360d0-119">In Service Fabric, one or more instances and/or replicas of your service run in a *service host process*, an executable file that runs your service code.</span></span> <span data-ttu-id="360d0-120">Es, como autor del servicio, el propietario el proceso de host del servicio de Hola y Service Fabric activa y supervisa automáticamente.</span><span class="sxs-lookup"><span data-stu-id="360d0-120">You, as a service author, own hello service host process and Service Fabric activates and monitors it for you.</span></span>

<span data-ttu-id="360d0-121">ASP.NET tradicional (arriba tooMVC 5) es tooIIS estrechamente acopladas a través de System.Web.dll.</span><span class="sxs-lookup"><span data-stu-id="360d0-121">Traditional ASP.NET (up tooMVC 5) is tightly coupled tooIIS through System.Web.dll.</span></span> <span data-ttu-id="360d0-122">ASP.NET Core proporciona una separación entre el servidor web de Hola y de la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="360d0-122">ASP.NET Core provides a separation between hello web server and your web application.</span></span> <span data-ttu-id="360d0-123">Esto permite toobe de aplicaciones web portables entre diferentes servidores web y también permite toobe de servidores web *hospeda a sí mismo*, lo cual significa que puede iniciar un servidor web en su propio proceso, como proceso tooa lugar que pertenece a web dedicado software de servidor como IIS.</span><span class="sxs-lookup"><span data-stu-id="360d0-123">This allows web applications toobe portable between different web servers and also allows web servers toobe *self-hosted*, which means you can start a web server in your own process, as opposed tooa process that is owned by dedicated web server software such as IIS.</span></span> 

<span data-ttu-id="360d0-124">En orden toocombine un servicio de Service Fabric y ASP.NET, ya sea como un ejecutable de invitado o en un servicio confiable, debe ser capaz de toostart ASP.NET dentro de su proceso de host de servicio.</span><span class="sxs-lookup"><span data-stu-id="360d0-124">In order toocombine a Service Fabric service and ASP.NET, either as a guest executable or in a Reliable Service, you must be able toostart ASP.NET inside your service host process.</span></span> <span data-ttu-id="360d0-125">Núcleo de ASP.NET que se hospeda a sí mismo permite toodo esto.</span><span class="sxs-lookup"><span data-stu-id="360d0-125">ASP.NET Core self-hosting allows you toodo this.</span></span>

## <a name="hosting-aspnet-core-in-a-reliable-service"></a><span data-ttu-id="360d0-126">Hospedaje de ASP.NET Core en una instancia de Reliable Services</span><span class="sxs-lookup"><span data-stu-id="360d0-126">Hosting ASP.NET Core in a Reliable Service</span></span>
<span data-ttu-id="360d0-127">Normalmente, las aplicaciones de ASP.NET Core hospedadas por sí mismo crean un WebHost en el punto de entrada de una aplicación, como Hola `static void Main()` método `Program.cs`.</span><span class="sxs-lookup"><span data-stu-id="360d0-127">Typically, self-hosted ASP.NET Core applications create a WebHost in an application's entry point, such as hello `static void Main()` method in `Program.cs`.</span></span> <span data-ttu-id="360d0-128">En este caso, el ciclo de vida de Hola de hello WebHost es enlazado toohello ciclo de vida del proceso de Hola.</span><span class="sxs-lookup"><span data-stu-id="360d0-128">In this case, hello lifecycle of hello WebHost is bound toohello lifecycle of hello process.</span></span>

![Hospedaje de ASP.NET Core en un proceso][0]

<span data-ttu-id="360d0-130">Sin embargo, punto de entrada de aplicación Hola no es Hola lugar correcto toocreate un WebHost en un servicio confiable, porque sólo se utiliza el punto de entrada de aplicación Hola tooregister un servicio escriba con tiempo de ejecución de Service Fabric hello, de modo que pueden crear instancias de ese servicio tipo.</span><span class="sxs-lookup"><span data-stu-id="360d0-130">However, hello application entry point is not hello right place toocreate a WebHost in a Reliable Service, because hello application entry point is only used tooregister a service type with hello Service Fabric runtime, so that it may create instances of that service type.</span></span> <span data-ttu-id="360d0-131">Hola WebHost debe crearse en un servicio confiable propio.</span><span class="sxs-lookup"><span data-stu-id="360d0-131">hello WebHost should be created in a Reliable Service itself.</span></span> <span data-ttu-id="360d0-132">En el proceso de host de servicio de hello, instancias de servicio o réplicas pueden atravesar varios ciclos de vida.</span><span class="sxs-lookup"><span data-stu-id="360d0-132">Within hello service host process, service instances and/or replicas can go through multiple lifecycles.</span></span> 

<span data-ttu-id="360d0-133">Una instancia de Reliable Services se representa mediante la clase de servicio derivada de `StatelessService` o `StatefulService`.</span><span class="sxs-lookup"><span data-stu-id="360d0-133">A Reliable Service instance is represented by your service class deriving from `StatelessService` or `StatefulService`.</span></span> <span data-ttu-id="360d0-134">pila de comunicación de Hola para un servicio se encuentra en un `ICommunicationListener` implementación en la clase de servicio.</span><span class="sxs-lookup"><span data-stu-id="360d0-134">hello communication stack for a service is contained in an `ICommunicationListener` implementation in your service class.</span></span> <span data-ttu-id="360d0-135">Hola `Microsoft.ServiceFabric.Services.AspNetCore.*` paquetes de NuGet contengan implementaciones de `ICommunicationListener` que iniciar y administrar Hola ASP.NET Core WebHost para Kestrel o WebListener en un servicio confiable.</span><span class="sxs-lookup"><span data-stu-id="360d0-135">hello `Microsoft.ServiceFabric.Services.AspNetCore.*` NuGet packages contain implementations of `ICommunicationListener` that start and manage hello ASP.NET Core WebHost for either Kestrel or WebListener in a Reliable Service.</span></span>

![Hospedaje de ASP.NET Core en una instancia de Reliable Services][1]

## <a name="aspnet-core-icommunicationlisteners"></a><span data-ttu-id="360d0-137">ICommunicationListeners en ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="360d0-137">ASP.NET Core ICommunicationListeners</span></span>
<span data-ttu-id="360d0-138">Hola `ICommunicationListener` implementaciones de Kestrel y WebListener en hello `Microsoft.ServiceFabric.Services.AspNetCore.*` paquetes de NuGet tienen patrones de uso similar pero realizar el servidor web de tooeach específico de acciones ligeramente diferente.</span><span class="sxs-lookup"><span data-stu-id="360d0-138">hello `ICommunicationListener` implementations for Kestrel and WebListener in hello  `Microsoft.ServiceFabric.Services.AspNetCore.*` NuGet packages have similar use patterns but perform slightly different actions specific tooeach web server.</span></span> 

<span data-ttu-id="360d0-139">Ambos agentes de escucha de comunicación proporcionan un constructor que toma Hola argumentos siguientes:</span><span class="sxs-lookup"><span data-stu-id="360d0-139">Both communication listeners provide a constructor that takes hello following arguments:</span></span>
 - <span data-ttu-id="360d0-140">**`ServiceContext serviceContext`**: Hola `ServiceContext` objeto que contiene información acerca de hello ejecutando el servicio.</span><span class="sxs-lookup"><span data-stu-id="360d0-140">**`ServiceContext serviceContext`**: hello `ServiceContext` object that contains information about hello running service.</span></span>
 - <span data-ttu-id="360d0-141">**`string endpointName`**: nombre de Hola de un `Endpoint` configuración en ServiceManifest.xml.</span><span class="sxs-lookup"><span data-stu-id="360d0-141">**`string endpointName`**: hello name of an `Endpoint` configuration in ServiceManifest.xml.</span></span> <span data-ttu-id="360d0-142">Esto es principalmente en qué se diferencian los agentes de escucha de comunicación de hello dos: WebListener **requiere** un `Endpoint` configuración, mientras que Kestrel no.</span><span class="sxs-lookup"><span data-stu-id="360d0-142">This is primarily where hello two communication listeners differ: WebListener **requires** an `Endpoint` configuration, while Kestrel does not.</span></span>
 - <span data-ttu-id="360d0-143">**`Func<string, AspNetCoreCommunicationListener, IWebHost> build`**: expresión lambda que se implementa para crear y devolver `IWebHost`.</span><span class="sxs-lookup"><span data-stu-id="360d0-143">**`Func<string, AspNetCoreCommunicationListener, IWebHost> build`**: a lambda that you implement in which you create and return an `IWebHost`.</span></span> <span data-ttu-id="360d0-144">Esto le permite tooconfigure `IWebHost` Hola modo habitual en una aplicación de ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="360d0-144">This allows you tooconfigure `IWebHost` hello way you normally would in an ASP.NET Core application.</span></span> <span data-ttu-id="360d0-145">lambda Hello proporciona una dirección URL que se genera para dependiendo de la integración de Service Fabric Hola opciones hello y use `Endpoint` configuración que proporcione.</span><span class="sxs-lookup"><span data-stu-id="360d0-145">hello lambda provides a URL which is generated for you depending on hello Service Fabric integration options you use and hello `Endpoint` configuration you provide.</span></span> <span data-ttu-id="360d0-146">Que dirección URL, a continuación, se pueden modificar o utilizar como-es el servidor web de toostart Hola.</span><span class="sxs-lookup"><span data-stu-id="360d0-146">That URL can then be modified or used as-is toostart hello web server.</span></span>

## <a name="service-fabric-integration-middleware"></a><span data-ttu-id="360d0-147">Middleware de integración de Service Fabric</span><span class="sxs-lookup"><span data-stu-id="360d0-147">Service Fabric integration middleware</span></span>
<span data-ttu-id="360d0-148">Hola `Microsoft.ServiceFabric.Services.AspNetCore` paquete de NuGet incluye hello `UseServiceFabricIntegration` método de extensión `IWebHostBuilder` que agrega middleware para Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="360d0-148">hello `Microsoft.ServiceFabric.Services.AspNetCore` NuGet package includes hello `UseServiceFabricIntegration` extension method on `IWebHostBuilder` that adds Service Fabric-aware middleware.</span></span> <span data-ttu-id="360d0-149">Este middleware configura Hola Kestrel o WebListener `ICommunicationListener` tooregister una dirección URL de servicio exclusiva con Hola servicio de nomenclatura de tejido de servicio y, a continuación, valida los clientes tooensure de solicitudes de cliente conectan toohello de servicio adecuado.</span><span class="sxs-lookup"><span data-stu-id="360d0-149">This middleware configures hello Kestrel or WebListener `ICommunicationListener` tooregister a unique service URL with hello Service Fabric Naming Service and then validates client requests tooensure clients are connecting toohello right service.</span></span> <span data-ttu-id="360d0-150">Esto es necesario en un entorno de host compartido como Service Fabric, donde varias aplicaciones web pueden ejecutar en hello misma físico o máquina virtual pero no utilizan nombres de host único, tooprevent clientes conecten erróneamente toohello de servicio incorrecta.</span><span class="sxs-lookup"><span data-stu-id="360d0-150">This is necessary in a shared-host environment such as Service Fabric, where multiple web applications can run on hello same physical or virtual machine but do not use unique host names, tooprevent clients from mistakenly connecting toohello wrong service.</span></span> <span data-ttu-id="360d0-151">Este escenario se describe con más detalle en la sección siguiente Hola.</span><span class="sxs-lookup"><span data-stu-id="360d0-151">This scenario is described in more detail in hello next section.</span></span>

### <a name="a-case-of-mistaken-identity"></a><span data-ttu-id="360d0-152">Un caso de identidad equivocada</span><span class="sxs-lookup"><span data-stu-id="360d0-152">A case of mistaken identity</span></span>
<span data-ttu-id="360d0-153">Las réplicas de servicio, con independencia del protocolo, escuchan en una combinación IP:puerto única.</span><span class="sxs-lookup"><span data-stu-id="360d0-153">Service replicas, regardless of protocol, listen on a unique IP:port combination.</span></span> <span data-ttu-id="360d0-154">Una vez que una réplica de servicio ha comenzado a escuchar en un punto de conexión de IP: Port, informa de que toohello de dirección de extremo tejido nomenclatura servicio donde se pueden detectar los clientes u otros servicios.</span><span class="sxs-lookup"><span data-stu-id="360d0-154">Once a service replica has started listening on an IP:port endpoint, it reports that endpoint address toohello Service Fabric Naming Service where it can be discovered by clients or other services.</span></span> <span data-ttu-id="360d0-155">Si los servicios utilizan puertos de la aplicación asigna dinámicamente, una réplica de servicio pueden utilizar casualmente Hola mismo punto de conexión de IP: Port de otro servicio que se encontraban previamente en Hola misma físico o máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="360d0-155">If services use dynamically-assigned application ports, a service replica may coincidentally use hello same IP:port endpoint of another service that was previously on hello same physical or virtual machine.</span></span> <span data-ttu-id="360d0-156">Esto puede hacer que un cliente toomistakely conectar toohello de servicio incorrecta.</span><span class="sxs-lookup"><span data-stu-id="360d0-156">This can cause a client toomistakely connect toohello wrong service.</span></span> <span data-ttu-id="360d0-157">Esto puede ocurrir si se produce Hola sigue la secuencia de eventos:</span><span class="sxs-lookup"><span data-stu-id="360d0-157">This can happen if hello following sequence of events occur:</span></span>

 1. <span data-ttu-id="360d0-158">Un servicio A escucha en 10.0.0.1:30000 a través de HTTP.</span><span class="sxs-lookup"><span data-stu-id="360d0-158">Service A listens on 10.0.0.1:30000 over HTTP.</span></span> 
 2. <span data-ttu-id="360d0-159">El cliente resuelve el servicio A y obtiene la dirección 10.0.0.1:30000.</span><span class="sxs-lookup"><span data-stu-id="360d0-159">Client resolves Service A and gets address 10.0.0.1:30000</span></span>
 3. <span data-ttu-id="360d0-160">Se desplaza tooa otro nodo del servicio.</span><span class="sxs-lookup"><span data-stu-id="360d0-160">Service A moves tooa different node.</span></span>
 4. <span data-ttu-id="360d0-161">Servicio B se coloca en 10.0.0.1 y casualmente usa Hola mismo puerto 30000.</span><span class="sxs-lookup"><span data-stu-id="360d0-161">Service B is placed on 10.0.0.1 and coincidentally uses hello same port 30000.</span></span>
 5. <span data-ttu-id="360d0-162">Cliente intentará establecer tooconnect tooservice A con 10.0.0.1:30000 de direcciones almacenadas en caché.</span><span class="sxs-lookup"><span data-stu-id="360d0-162">Client attempts tooconnect tooservice A with cached address 10.0.0.1:30000.</span></span>
 6. <span data-ttu-id="360d0-163">Cliente es ahora está conectado correctamente conectado tooservice B no que se dé cuenta toohello de servicio incorrecta.</span><span class="sxs-lookup"><span data-stu-id="360d0-163">Client is now successfully connected tooservice B not realizing it is connected toohello wrong service.</span></span>

<span data-ttu-id="360d0-164">Esto puede provocar errores en los momentos aleatorios que pueden ser difícil toodiagnose.</span><span class="sxs-lookup"><span data-stu-id="360d0-164">This can cause bugs at random times that can be difficult toodiagnose.</span></span> 

### <a name="using-unique-service-urls"></a><span data-ttu-id="360d0-165">Uso de direcciones URL de servicio únicas</span><span class="sxs-lookup"><span data-stu-id="360d0-165">Using unique service URLs</span></span>
<span data-ttu-id="360d0-166">Servicios de tooprevent, puede publicar un servicio de nombres con un identificador único de punto de conexión toohello y, a continuación, validar ese identificador único durante las solicitudes de cliente.</span><span class="sxs-lookup"><span data-stu-id="360d0-166">tooprevent this, services can post an endpoint toohello Naming Service with a unique identifier, and then validate that unique identifier during client requests.</span></span> <span data-ttu-id="360d0-167">Se trata de una acción cooperativa entre servicios en un entorno de confianza sin inquilinos hostiles.</span><span class="sxs-lookup"><span data-stu-id="360d0-167">This is a cooperative action between services in a non-hostile-tenant trusted environment.</span></span> <span data-ttu-id="360d0-168">No proporciona autenticación de servicio segura en un entorno con inquilinos hostiles.</span><span class="sxs-lookup"><span data-stu-id="360d0-168">This does not provide secure service authentication in a hostile-tenant environment.</span></span>

<span data-ttu-id="360d0-169">En un entorno de confianza, Hola middleware que se agrega de forma hello `UseServiceFabricIntegration` método anexa automáticamente una dirección de toohello de identificador único que se registra toohello servicio de nomenclatura y valida ese identificador en cada solicitud.</span><span class="sxs-lookup"><span data-stu-id="360d0-169">In a trusted environment, hello middleware that's added by hello `UseServiceFabricIntegration` method automatically appends a unique identifier toohello address that is posted toohello Naming Service and validates that identifier on each request.</span></span> <span data-ttu-id="360d0-170">Si no coincide con el identificador de hello, Hola middleware devuelve inmediatamente una respuesta HTTP 410 ya no existe.</span><span class="sxs-lookup"><span data-stu-id="360d0-170">If hello identifier does not match, hello middleware immediately returns an HTTP 410 Gone response.</span></span>

<span data-ttu-id="360d0-171">Los servicios que utilizan un puerto asignado de forma dinámica deberían usar este middleware.</span><span class="sxs-lookup"><span data-stu-id="360d0-171">Services that use a dynamically-assigned port should make use of this middleware.</span></span>

<span data-ttu-id="360d0-172">Los servicios que utilizan un puerto fijo único no tienen este problema en un entorno cooperativo.</span><span class="sxs-lookup"><span data-stu-id="360d0-172">Services that use a fixed unique port do not have this problem in a cooperative environment.</span></span> <span data-ttu-id="360d0-173">Un único puerto fijo se utiliza normalmente para servicios externo que necesitan un puerto bien conocido para tooconnect de las aplicaciones de cliente para.</span><span class="sxs-lookup"><span data-stu-id="360d0-173">A fixed unique port is typically used for externally-facing services that need a well-known port for client applications tooconnect to.</span></span> <span data-ttu-id="360d0-174">Por ejemplo, la mayoría de las aplicaciones web accesibles desde Internet usarán el puerto 80 o 443 para las conexiones del explorador web.</span><span class="sxs-lookup"><span data-stu-id="360d0-174">For example, most Internet-facing web applications will use port 80 or 443 for web browser connections.</span></span> <span data-ttu-id="360d0-175">En este caso, identificador único de hello no debe estar habilitada.</span><span class="sxs-lookup"><span data-stu-id="360d0-175">In this case, hello unique identifier should not be enabled.</span></span>

<span data-ttu-id="360d0-176">Hello siguiente diagrama muestra flujo de solicitud de hello con middleware de hello habilitado:</span><span class="sxs-lookup"><span data-stu-id="360d0-176">hello following diagram shows hello request flow with hello middleware enabled:</span></span>

![Integración de ASP.NET Core de Service Fabric][2]

<span data-ttu-id="360d0-178">Kestrel y WebListener `ICommunicationListener` implementaciones utilizan este mecanismo Hola exactamente igual.</span><span class="sxs-lookup"><span data-stu-id="360d0-178">Both Kestrel and WebListener `ICommunicationListener` implementations use this mechanism in exactly hello same way.</span></span> <span data-ttu-id="360d0-179">Aunque WebListener internamente puede diferenciar las solicitudes basadas en rutas de acceso de dirección URL únicas subyacente hello *http.sys* característica, que es la funcionalidad de uso compartido de puerto *no* utilizado por hello WebListener `ICommunicationListener` implementación ya que se produciría en códigos de estado de error HTTP 503 y 404 de HTTP en el escenario de Hola se ha descrito anteriormente.</span><span class="sxs-lookup"><span data-stu-id="360d0-179">Although WebListener can internally differentiate requests based on unique URL paths using hello underlying *http.sys* port sharing feature, that functionality is *not* used by hello WebListener `ICommunicationListener` implementation because that will result in HTTP 503 and HTTP 404 error status codes in hello scenario described earlier.</span></span> <span data-ttu-id="360d0-180">A su vez hace muy difícil intención de hello toodetermine de los clientes de error de hello, como HTTP 503 y 404 de HTTP ya están tooindicate utilizada otros errores.</span><span class="sxs-lookup"><span data-stu-id="360d0-180">That in turn makes it very difficult for clients toodetermine hello intent of hello error, as HTTP 503 and HTTP 404 are already commonly used tooindicate other errors.</span></span> <span data-ttu-id="360d0-181">Por lo tanto, Kestrel y WebListener `ICommunicationListener` implementaciones estandaricen middleware Hola proporcionada por hello `UseServiceFabricIntegration` método de extensión para que los clientes sólo necesitan tooperform un extremo de servicio vuelve a resolver acción en las respuestas HTTP 410.</span><span class="sxs-lookup"><span data-stu-id="360d0-181">Thus, both Kestrel and WebListener `ICommunicationListener` implementations standardize on hello middleware provided by hello `UseServiceFabricIntegration` extension method so that clients only need tooperform a service endpoint re-resolve action on HTTP 410 responses.</span></span>

## <a name="weblistener-in-reliable-services"></a><span data-ttu-id="360d0-182">WebListener en Reliable Services</span><span class="sxs-lookup"><span data-stu-id="360d0-182">WebListener in Reliable Services</span></span>
<span data-ttu-id="360d0-183">WebListener puede utilizarse en un servicio confiable mediante la importación de hello **Microsoft.ServiceFabric.AspNetCore.WebListener** paquete NuGet.</span><span class="sxs-lookup"><span data-stu-id="360d0-183">WebListener can be used in a Reliable Service by importing hello **Microsoft.ServiceFabric.AspNetCore.WebListener** NuGet package.</span></span> <span data-ttu-id="360d0-184">Este paquete contiene `WebListenerCommunicationListener`, una implementación de `ICommunicationListener`, que le permita toocreate un WebHost de núcleo de ASP.NET dentro de un servicio confiable con WebListener como servidor web de Hola.</span><span class="sxs-lookup"><span data-stu-id="360d0-184">This package contains `WebListenerCommunicationListener`, an implementation of `ICommunicationListener`, that allows you toocreate an ASP.NET Core WebHost inside a Reliable Service using WebListener as hello web server.</span></span>

<span data-ttu-id="360d0-185">WebListener se basa en hello [Windows HTTP Server API](https://msdn.microsoft.com/library/windows/desktop/aa364510(v=vs.85).aspx).</span><span class="sxs-lookup"><span data-stu-id="360d0-185">WebListener is built on hello [Windows HTTP Server API](https://msdn.microsoft.com/library/windows/desktop/aa364510(v=vs.85).aspx).</span></span> <span data-ttu-id="360d0-186">Esto utiliza hello *http.sys* controlador de kernel usado por IIS tooprocess HTTP solicita y enrutar tooprocesses ellas las aplicaciones web en ejecución.</span><span class="sxs-lookup"><span data-stu-id="360d0-186">This uses hello *http.sys* kernel driver used by IIS tooprocess HTTP requests and route them tooprocesses running web applications.</span></span> <span data-ttu-id="360d0-187">Esto permite que varios procesos en hello misma máquina física o virtual toohost las aplicaciones web de hello mismo puerto, eliminar la ambigüedad por una ruta de acceso de dirección URL única o un nombre de host.</span><span class="sxs-lookup"><span data-stu-id="360d0-187">This allows multiple processes on hello same physical or virtual machine toohost web applications on hello same port, disambiguated by either a unique URL path or hostname.</span></span> <span data-ttu-id="360d0-188">Estas características son útiles en Service Fabric para hospedar varios sitios Web en hello mismo clúster.</span><span class="sxs-lookup"><span data-stu-id="360d0-188">These features are useful in Service Fabric for hosting multiple websites in hello same cluster.</span></span>

<span data-ttu-id="360d0-189">Hello siguiente diagrama ilustra cómo WebListener usa hello *http.sys* controladores de kernel de Windows para uso compartido de puertos:</span><span class="sxs-lookup"><span data-stu-id="360d0-189">hello following diagram illustrates how WebListener uses hello *http.sys* kernel driver on Windows for port sharing:</span></span>

![http.sys][3]

### <a name="weblistener-in-a-stateless-service"></a><span data-ttu-id="360d0-191">WebListener en un servicio sin estado</span><span class="sxs-lookup"><span data-stu-id="360d0-191">WebListener in a stateless service</span></span>
<span data-ttu-id="360d0-192">toouse `WebListener` en un servicio sin estado, reemplace el método hello `CreateServiceInstanceListeners` método y devuelven un `WebListenerCommunicationListener` instancia:</span><span class="sxs-lookup"><span data-stu-id="360d0-192">toouse `WebListener` in a stateless service, override hello `CreateServiceInstanceListeners` method and return a `WebListenerCommunicationListener` instance:</span></span>

```csharp
protected override IEnumerable<ServiceInstanceListener> CreateServiceInstanceListeners()
{
    return new ServiceInstanceListener[]
    {
        new ServiceInstanceListener(serviceContext =>
            new WebListenerCommunicationListener(serviceContext, "ServiceEndpoint", (url, listener) =>
                new WebHostBuilder()
                    .UseWebListener()
                    .ConfigureServices(
                        services => services
                            .AddSingleton<StatelessServiceContext>(serviceContext))
                    .UseContentRoot(Directory.GetCurrentDirectory())
                    .UseServiceFabricIntegration(listener, ServiceFabricIntegrationOptions.None)
                    .UseStartup<Startup>()
                    .UseUrls(url)
                    .Build()))
    };
}
```

### <a name="weblistener-in-a-stateful-service"></a><span data-ttu-id="360d0-193">WebListener en un servicio con estado</span><span class="sxs-lookup"><span data-stu-id="360d0-193">WebListener in a stateful service</span></span>

<span data-ttu-id="360d0-194">`WebListenerCommunicationListener`actualmente no está diseñado para su uso en servicios con estado vencimiento toocomplications con hello subyacente *http.sys* característica de uso compartido de puerto.</span><span class="sxs-lookup"><span data-stu-id="360d0-194">`WebListenerCommunicationListener` is currently not designed for use in stateful services due toocomplications with hello underlying *http.sys* port sharing feature.</span></span> <span data-ttu-id="360d0-195">Para obtener más información, vea Hola pasos de la sección de asignación de puerto dinámico con WebListener.</span><span class="sxs-lookup"><span data-stu-id="360d0-195">For more information, see hello following section on dynamic port allocation with WebListener.</span></span> <span data-ttu-id="360d0-196">Para los servicios con estado, Kestrel es hello recomendada servidor web.</span><span class="sxs-lookup"><span data-stu-id="360d0-196">For stateful services, Kestrel is hello recommended web server.</span></span>

### <a name="endpoint-configuration"></a><span data-ttu-id="360d0-197">Configuración del punto de conexión</span><span class="sxs-lookup"><span data-stu-id="360d0-197">Endpoint configuration</span></span>

<span data-ttu-id="360d0-198">Un `Endpoint` configuración es necesaria para los servidores web que utilizan la API de servidor HTTP de Windows, incluidos los WebListener Hola.</span><span class="sxs-lookup"><span data-stu-id="360d0-198">An `Endpoint` configuration is required for web servers that use hello Windows HTTP Server API, including WebListener.</span></span> <span data-ttu-id="360d0-199">Servidores Web que utilizan la API de servidor HTTP de Windows hello en primer lugar deben reservar su dirección URL con *http.sys* (Esto se consigue normalmente con hello [netsh](https://msdn.microsoft.com/library/windows/desktop/cc307236(v=vs.85).aspx) herramienta).</span><span class="sxs-lookup"><span data-stu-id="360d0-199">Web servers that use hello Windows HTTP Server API must first reserve their URL with *http.sys* (this is normally accomplished with hello [netsh](https://msdn.microsoft.com/library/windows/desktop/cc307236(v=vs.85).aspx) tool).</span></span> <span data-ttu-id="360d0-200">Esta acción requiere privilegios elevados de los que sus servicios carecen de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="360d0-200">This action requires elevated privileges that your services by default do not have.</span></span> <span data-ttu-id="360d0-201">Hola "http" o "https" opciones de hello `Protocol` propiedad de hello `Endpoint` configuración de *ServiceManifest.xml* se utilizan específicamente tooinstruct Hola Service Fabric en tiempo de ejecución tooregister una dirección URL con *http.sys* en su nombre mediante hello [ *carácter comodín fuerte* ](https://msdn.microsoft.com/library/windows/desktop/aa364698(v=vs.85).aspx) prefijo de dirección URL.</span><span class="sxs-lookup"><span data-stu-id="360d0-201">hello "http" or "https" options for hello `Protocol` property of hello `Endpoint` configuration in *ServiceManifest.xml* are used specifically tooinstruct hello Service Fabric runtime tooregister a URL with *http.sys* on your behalf using hello [*strong wildcard*](https://msdn.microsoft.com/library/windows/desktop/aa364698(v=vs.85).aspx) URL prefix.</span></span>

<span data-ttu-id="360d0-202">Por ejemplo, tooreserve `http://+:80` para un servicio, hello configuración siguiente debe usarse en ServiceManifest.xml:</span><span class="sxs-lookup"><span data-stu-id="360d0-202">For example, tooreserve `http://+:80` for a service, hello following configuration should be used in ServiceManifest.xml:</span></span>

```xml
<ServiceManifest ... >
    ...
    <Resources>
        <Endpoints>
            <Endpoint Name="ServiceEndpoint" Protocol="http" Port="80" />
        </Endpoints>
    </Resources>

</ServiceManifest>
```

<span data-ttu-id="360d0-203">Y se debe pasar el nombre del extremo de hello toohello `WebListenerCommunicationListener` constructor:</span><span class="sxs-lookup"><span data-stu-id="360d0-203">And hello endpoint name must be passed toohello `WebListenerCommunicationListener` constructor:</span></span>

```csharp
 new WebListenerCommunicationListener(serviceContext, "ServiceEndpoint", (url, listener) =>
 {
     return new WebHostBuilder()
         .UseWebListener()
         .UseServiceFabricIntegration(listener, ServiceFabricIntegrationOptions.None)
         .UseUrls(url)
         .Build();
 })
```

#### <a name="use-weblistener-with-a-static-port"></a><span data-ttu-id="360d0-204">Uso de WebListener con un puerto estático</span><span class="sxs-lookup"><span data-stu-id="360d0-204">Use WebListener with a static port</span></span>
<span data-ttu-id="360d0-205">toouse un puerto estático con WebListener, especifique el número de puerto de Hola Hola `Endpoint` configuración:</span><span class="sxs-lookup"><span data-stu-id="360d0-205">toouse a static port with WebListener, provide hello port number in hello `Endpoint` configuration:</span></span>

```xml
  <Resources>
    <Endpoints>
      <Endpoint Protocol="http" Name="ServiceEndpoint" Port="80" />
    </Endpoints>
  </Resources>
```

#### <a name="use-weblistener-with-a-dynamic-port"></a><span data-ttu-id="360d0-206">Uso de WebListener con un puerto dinámico</span><span class="sxs-lookup"><span data-stu-id="360d0-206">Use WebListener with a dynamic port</span></span>
<span data-ttu-id="360d0-207">toouse un puerto asignado dinámicamente con WebListener, omitir hello `Port` propiedad Hola `Endpoint` configuración:</span><span class="sxs-lookup"><span data-stu-id="360d0-207">toouse a dynamically assigned port with WebListener, omit hello `Port` property in hello `Endpoint` configuration:</span></span>

```xml
  <Resources>
    <Endpoints>
      <Endpoint Protocol="http" Name="ServiceEndpoint" />
    </Endpoints>
  </Resources>
```

<span data-ttu-id="360d0-208">Tenga en cuenta que un puerto dinámico asignado por una configuración `Endpoint` proporciona solo un puerto *por cada proceso de host*.</span><span class="sxs-lookup"><span data-stu-id="360d0-208">Note that a dynamic port allocated by an `Endpoint` configuration only provides one port *per host process*.</span></span> <span data-ttu-id="360d0-209">Hello actual Service Fabric modelo de hospedaje permite varios toobe de instancias o réplicas de servicio hospedado en hello mismo proceso, lo que significa que cada uno de ellos compartirán Hola mismo número de puerto cuando se asignan a través de hello `Endpoint` configuración.</span><span class="sxs-lookup"><span data-stu-id="360d0-209">hello current Service Fabric hosting model allows multiple service instances and/or replicas toobe hosted in hello same process, meaning that each one will share hello same port when allocated through hello `Endpoint` configuration.</span></span> <span data-ttu-id="360d0-210">Varias instancias de WebListener pueden compartir un puerto mediante subyacente hello *http.sys* puertos de característica, pero que no es compatible con `WebListenerCommunicationListener` debido a las complicaciones de toohello incluye las solicitudes de cliente.</span><span class="sxs-lookup"><span data-stu-id="360d0-210">Multiple WebListener instances can share a port using hello underlying *http.sys* port sharing feature, but that is not supported by `WebListenerCommunicationListener` due toohello complications it introduces for client requests.</span></span> <span data-ttu-id="360d0-211">Para el uso de puertos dinámicos, Kestrel es hello recomendada servidor web.</span><span class="sxs-lookup"><span data-stu-id="360d0-211">For dynamic port usage, Kestrel is hello recommended web server.</span></span>

## <a name="kestrel-in-reliable-services"></a><span data-ttu-id="360d0-212">Kestrel en Reliable Services</span><span class="sxs-lookup"><span data-stu-id="360d0-212">Kestrel in Reliable Services</span></span>
<span data-ttu-id="360d0-213">Kestrel puede utilizarse en un servicio confiable mediante la importación de hello **Microsoft.ServiceFabric.AspNetCore.Kestrel** paquete NuGet.</span><span class="sxs-lookup"><span data-stu-id="360d0-213">Kestrel can be used in a Reliable Service by importing hello **Microsoft.ServiceFabric.AspNetCore.Kestrel** NuGet package.</span></span> <span data-ttu-id="360d0-214">Este paquete contiene `KestrelCommunicationListener`, una implementación de `ICommunicationListener`, que le permita toocreate un WebHost de núcleo de ASP.NET dentro de un servicio confiable con Kestrel como servidor web de Hola.</span><span class="sxs-lookup"><span data-stu-id="360d0-214">This package contains `KestrelCommunicationListener`, an implementation of `ICommunicationListener`, that allows you toocreate an ASP.NET Core WebHost inside a Reliable Service using Kestrel as hello web server.</span></span>

<span data-ttu-id="360d0-215">Kestrel es un servidor web multiplataforma para ASP.NET Core basado en libuv, una biblioteca de E/S asincrónica multiplataforma.</span><span class="sxs-lookup"><span data-stu-id="360d0-215">Kestrel is a cross-platform web server for ASP.NET Core based on libuv, a cross-platform asynchronous I/O library.</span></span> <span data-ttu-id="360d0-216">A diferencia de WebListener, Kestrel no utiliza un administrador centralizado de puntos de conexión como *http.sys*.</span><span class="sxs-lookup"><span data-stu-id="360d0-216">Unlike WebListener, Kestrel does not use a centralized endpoint manager such as *http.sys*.</span></span> <span data-ttu-id="360d0-217">Y, a diferencia de WebListener, Kestrel no es compatible con el uso compartido de puertos entre varios procesos.</span><span class="sxs-lookup"><span data-stu-id="360d0-217">And unlike WebListener, Kestrel does not support port sharing between multiple processes.</span></span> <span data-ttu-id="360d0-218">Cada instancia de Kestrel debe usar un puerto único.</span><span class="sxs-lookup"><span data-stu-id="360d0-218">Each instance of Kestrel must use a unique port.</span></span>

![kestrel][4]

### <a name="kestrel-in-a-stateless-service"></a><span data-ttu-id="360d0-220">Kestrel en un servicio sin estado</span><span class="sxs-lookup"><span data-stu-id="360d0-220">Kestrel in a stateless service</span></span>
<span data-ttu-id="360d0-221">toouse `Kestrel` en un servicio sin estado, reemplace el método hello `CreateServiceInstanceListeners` método y devuelven un `KestrelCommunicationListener` instancia:</span><span class="sxs-lookup"><span data-stu-id="360d0-221">toouse `Kestrel` in a stateless service, override hello `CreateServiceInstanceListeners` method and return a `KestrelCommunicationListener` instance:</span></span>

```csharp
protected override IEnumerable<ServiceInstanceListener> CreateServiceInstanceListeners()
{
    return new ServiceInstanceListener[]
    {
        new ServiceInstanceListener(serviceContext =>
            new KestrelCommunicationListener(serviceContext, "ServiceEndpoint", (url, listener) =>
                new WebHostBuilder()
                    .UseKestrel()
                    .ConfigureServices(
                        services => services
                            .AddSingleton<StatelessServiceContext>(serviceContext))
                    .UseContentRoot(Directory.GetCurrentDirectory())
                    .UseServiceFabricIntegration(listener, ServiceFabricIntegrationOptions.UseUniqueServiceUrl)
                    .UseStartup<Startup>()
                    .UseUrls(url)
                    .Build();
            ))
    };
}
```

### <a name="kestrel-in-a-stateful-service"></a><span data-ttu-id="360d0-222">Kestrel en un servicio con estado</span><span class="sxs-lookup"><span data-stu-id="360d0-222">Kestrel in a stateful service</span></span>
<span data-ttu-id="360d0-223">toouse `Kestrel` en un servicio con estado, reemplace el método hello `CreateServiceReplicaListeners` método y devuelven un `KestrelCommunicationListener` instancia:</span><span class="sxs-lookup"><span data-stu-id="360d0-223">toouse `Kestrel` in a stateful service, override hello `CreateServiceReplicaListeners` method and return a `KestrelCommunicationListener` instance:</span></span>

```csharp
protected override IEnumerable<ServiceReplicaListener> CreateServiceReplicaListeners()
{
    return new ServiceReplicaListener[]
    {
        new ServiceReplicaListener(serviceContext =>
            new KestrelCommunicationListener(serviceContext, (url, listener) =>
                new WebHostBuilder()
                    .UseKestrel()
                    .ConfigureServices(
                         services => services
                             .AddSingleton<StatefulServiceContext>(serviceContext)
                             .AddSingleton<IReliableStateManager>(this.StateManager))
                    .UseContentRoot(Directory.GetCurrentDirectory())
                    .UseServiceFabricIntegration(listener, ServiceFabricIntegrationOptions.UseUniqueServiceUrl)
                    .UseStartup<Startup>()
                    .UseUrls(url)
                    .Build();
            ))
    };
}
```

<span data-ttu-id="360d0-224">En este ejemplo, una instancia de singleton de `IReliableStateManager` se proporciona el contenedor de inyección de dependencia de toohello WebHost.</span><span class="sxs-lookup"><span data-stu-id="360d0-224">In this example, a singleton instance of `IReliableStateManager` is provided toohello WebHost dependency injection container.</span></span> <span data-ttu-id="360d0-225">Esto no es estrictamente necesaria, pero le permite toouse `IReliableStateManager` y colecciones confiable en los métodos de acción de controlador MVC.</span><span class="sxs-lookup"><span data-stu-id="360d0-225">This is not strictly necessary, but it allows you toouse `IReliableStateManager` and Reliable Collections in your MVC controller action methods.</span></span>

<span data-ttu-id="360d0-226">Tenga en cuenta que un `Endpoint` nombre de configuración es **no** proporciona demasiado`KestrelCommunicationListener` en un servicio con estado.</span><span class="sxs-lookup"><span data-stu-id="360d0-226">Note that an `Endpoint` configuration name is **not** provided too`KestrelCommunicationListener` in a stateful service.</span></span> <span data-ttu-id="360d0-227">Esto se explica con más detalle en los pasos de la sección de Hola.</span><span class="sxs-lookup"><span data-stu-id="360d0-227">This is explained in more detail in hello following section.</span></span>

### <a name="endpoint-configuration"></a><span data-ttu-id="360d0-228">Configuración del punto de conexión</span><span class="sxs-lookup"><span data-stu-id="360d0-228">Endpoint configuration</span></span>
<span data-ttu-id="360d0-229">Un `Endpoint` configuración no es necesario toouse Kestrel.</span><span class="sxs-lookup"><span data-stu-id="360d0-229">An `Endpoint` configuration is not required toouse Kestrel.</span></span> 

<span data-ttu-id="360d0-230">Kestrel es un servidor web independiente simple; a diferencia de WebListener (o HttpListener), no es necesario un `Endpoint` configuración de *ServiceManifest.xml* ya no requiere toostarting anterior del registro de dirección URL.</span><span class="sxs-lookup"><span data-stu-id="360d0-230">Kestrel is a simple stand-alone web server; unlike WebListener (or HttpListener), it does not need an `Endpoint` configuration in *ServiceManifest.xml* because it does not require URL registration prior toostarting.</span></span> 

#### <a name="use-kestrel-with-a-static-port"></a><span data-ttu-id="360d0-231">Uso de Kestrel con un puerto estático</span><span class="sxs-lookup"><span data-stu-id="360d0-231">Use Kestrel with a static port</span></span>
<span data-ttu-id="360d0-232">Se puede configurar un puerto estático en hello `Endpoint` configuración de ServiceManifest.xml para su uso con Kestrel.</span><span class="sxs-lookup"><span data-stu-id="360d0-232">A static port can be configured in hello `Endpoint` configuration of ServiceManifest.xml for use with Kestrel.</span></span> <span data-ttu-id="360d0-233">Aunque esto no es estrictamente necesario, ofrece dos ventajas potenciales:</span><span class="sxs-lookup"><span data-stu-id="360d0-233">Although this is not strictly necessary, it provides two potential benefits:</span></span>
 1. <span data-ttu-id="360d0-234">Si el puerto de hello no se encuentra en el intervalo de puertos de aplicación Hola, se abre a través de firewall de sistema operativo de Hola por Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="360d0-234">If hello port does not fall in hello application port range, it is opened through hello OS firewall by Service Fabric.</span></span>
 2. <span data-ttu-id="360d0-235">Hola tooyou dirección URL proporcionada a través de `KestrelCommunicationListener` usará este puerto.</span><span class="sxs-lookup"><span data-stu-id="360d0-235">hello URL provided tooyou through `KestrelCommunicationListener` will use this port.</span></span>

```xml
  <Resources>
    <Endpoints>
      <Endpoint Protocol="http" Name="ServiceEndpoint" Port="80" />
    </Endpoints>
  </Resources>
```

<span data-ttu-id="360d0-236">Si un `Endpoint` está configurado, se debe pasar su nombre a hello `KestrelCommunicationListener` constructor:</span><span class="sxs-lookup"><span data-stu-id="360d0-236">If an `Endpoint` is configured, its name must be passed into hello `KestrelCommunicationListener` constructor:</span></span> 

```csharp
new KestrelCommunicationListener(serviceContext, "ServiceEndpoint", (url, listener) => ...
```

<span data-ttu-id="360d0-237">Si un `Endpoint` no se utiliza la configuración, se omite el nombre de Hola Hola `KestrelCommunicationListener` constructor.</span><span class="sxs-lookup"><span data-stu-id="360d0-237">If an `Endpoint` configuration is not used, omit hello name in hello `KestrelCommunicationListener` constructor.</span></span> <span data-ttu-id="360d0-238">En este caso, se utilizará un puerto dinámico.</span><span class="sxs-lookup"><span data-stu-id="360d0-238">In this case, a dynamic port will be used.</span></span> <span data-ttu-id="360d0-239">Vea la siguiente sección de Hola para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="360d0-239">See hello next section for more information.</span></span>

#### <a name="use-kestrel-with-a-dynamic-port"></a><span data-ttu-id="360d0-240">Uso de Kestrel con un puerto dinámico</span><span class="sxs-lookup"><span data-stu-id="360d0-240">Use Kestrel with a dynamic port</span></span>
<span data-ttu-id="360d0-241">Kestrel no se puede usar la asignación de puerto automática de Hola de hello `Endpoint` configuración en ServiceManifest.xml, porque la asignación automática de puerto de un `Endpoint` configuración asigna un puerto único por *el proceso de host* , y un proceso de host solo puede contener varias instancias de Kestrel.</span><span class="sxs-lookup"><span data-stu-id="360d0-241">Kestrel cannot use hello automatic port assignment from hello `Endpoint` configuration in ServiceManifest.xml, because automatic port assignment from an `Endpoint` configuration assigns a unique port per *host process*, and a single host process can contain multiple Kestrel instances.</span></span> <span data-ttu-id="360d0-242">Puesto que Kestrel no admite el uso compartido de puertos, esto no funciona porque cada instancia de Kestrel debe abrirse en un puerto único.</span><span class="sxs-lookup"><span data-stu-id="360d0-242">Since Kestrel does not support port sharing, this does not work as each Kestrel instance must be opened on a unique port.</span></span>

<span data-ttu-id="360d0-243">asignación de puertos dinámicos de toouse con Kestrel, simplemente omite hello `Endpoint` configuración en ServiceManifest.xml por completo y no pasan un toohello de nombre de punto de conexión `KestrelCommunicationListener` constructor:</span><span class="sxs-lookup"><span data-stu-id="360d0-243">toouse dynamic port assignment with Kestrel, simply omit hello `Endpoint` configuration in ServiceManifest.xml entirely, and do not pass an endpoint name toohello `KestrelCommunicationListener` constructor:</span></span>

```csharp
new KestrelCommunicationListener(serviceContext, (url, listener) => ...
```

<span data-ttu-id="360d0-244">En esta configuración, `KestrelCommunicationListener` seleccionará automáticamente un puerto no utilizado de intervalo de puertos de aplicación Hola.</span><span class="sxs-lookup"><span data-stu-id="360d0-244">In this configuration, `KestrelCommunicationListener` will automatically select an unused port from hello application port range.</span></span>

## <a name="scenarios-and-configurations"></a><span data-ttu-id="360d0-245">Escenarios y configuraciones</span><span class="sxs-lookup"><span data-stu-id="360d0-245">Scenarios and configurations</span></span>
<span data-ttu-id="360d0-246">En esta sección Hola los escenarios siguientes se describe y proporciona Hola recomienda combinación de servidor web, configuración de puerto, opciones de integración de Service Fabric y diversas configuraciones tooachieve un servicio que funciona correctamente:</span><span class="sxs-lookup"><span data-stu-id="360d0-246">This section describes hello following scenarios and provides hello recommended combination of web server, port configuration, Service Fabric integration options, and miscellaneous settings tooachieve a properly functioning service:</span></span>
 - <span data-ttu-id="360d0-247">Servicio sin estado de ASP.NET Core expuesto al exterior</span><span class="sxs-lookup"><span data-stu-id="360d0-247">Externally exposed ASP.NET Core stateless service</span></span>
 - <span data-ttu-id="360d0-248">Servicio sin estado de ASP.NET Core solo interno</span><span class="sxs-lookup"><span data-stu-id="360d0-248">Internal-only ASP.NET Core stateless service</span></span>
 - <span data-ttu-id="360d0-249">Servicio con estado de ASP.NET Core solo interno</span><span class="sxs-lookup"><span data-stu-id="360d0-249">Internal-only ASP.NET Core stateful service</span></span>

<span data-ttu-id="360d0-250">Un **expone externamente** servicio es aquel que expone un extremo accesible desde fuera de clúster de hello, normalmente a través de un equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="360d0-250">An **externally exposed** service is one that exposes an endpoint reachable from outside hello cluster, usually through a load balancer.</span></span>

<span data-ttu-id="360d0-251">Un **solo para uso interno** servicio es aquella cuyo extremo solo es accesible desde dentro de clúster de Hola.</span><span class="sxs-lookup"><span data-stu-id="360d0-251">An **internal-only** service is one whose endpoint is only reachable from within hello cluster.</span></span>

> [!NOTE]
> <span data-ttu-id="360d0-252">Servicio con estado extremos por lo general no se debe expone toohello Internet.</span><span class="sxs-lookup"><span data-stu-id="360d0-252">Stateful service endpoints generally should not be exposed toohello Internet.</span></span> <span data-ttu-id="360d0-253">Clústeres que se encuentran detrás de los equilibradores de carga que no son conscientes de la resolución del servicio de Service Fabric, como Hola equilibrador de carga de Azure, se pueden servicios con estado no se puede tooexpose porque equilibrador de carga de hello no ser capaz de toolocate y enrutar el tráfico toohello réplica de servicio con estado adecuado.</span><span class="sxs-lookup"><span data-stu-id="360d0-253">Clusters that are behind load balancers that are unaware of Service Fabric service resolution, such as hello Azure Load Balancer, will be unable tooexpose stateful services because hello load balancer will not be able toolocate and route traffic toohello appropriate stateful service replica.</span></span> 

### <a name="externally-exposed-aspnet-core-stateless-services"></a><span data-ttu-id="360d0-254">Servicios sin estado de ASP.NET Core expuestos al exterior</span><span class="sxs-lookup"><span data-stu-id="360d0-254">Externally exposed ASP.NET Core stateless services</span></span>
<span data-ttu-id="360d0-255">WebListener es hello recomendada servidor web para los servicios front-end que exponen los extremos HTTP externos, orientado a Internet en Windows.</span><span class="sxs-lookup"><span data-stu-id="360d0-255">WebListener is hello recommended web server for front-end services that expose external, Internet-facing HTTP endpoints on Windows.</span></span> <span data-ttu-id="360d0-256">Proporciona mejor protección frente a ataques y admite características incompatibles con Kestrel, como la autenticación de Windows y el uso compartido de puertos.</span><span class="sxs-lookup"><span data-stu-id="360d0-256">It provides better protection against attacks and supports features that Kestrel does not, such as Windows Authentication and port sharing.</span></span> 

<span data-ttu-id="360d0-257">Kestrel no se admite como servidor perimetral (orientado a Internet) en este momento.</span><span class="sxs-lookup"><span data-stu-id="360d0-257">Kestrel is not supported as an edge (Internet-facing) server at this time.</span></span> <span data-ttu-id="360d0-258">Se debe usar un servidor proxy inverso, como IIS o Nginx Hola a toohandle el tráfico de red pública de Internet.</span><span class="sxs-lookup"><span data-stu-id="360d0-258">A reverse proxy server such as IIS or Nginx must be used toohandle traffic from hello public Internet.</span></span>
 
<span data-ttu-id="360d0-259">Cuando toohello expuesto Internet, un servicio sin estado debe usar un punto de conexión conocido y estable que sea accesible a través de un equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="360d0-259">When exposed toohello Internet, a stateless service should use a well-known and stable endpoint that is reachable through a load balancer.</span></span> <span data-ttu-id="360d0-260">Se trata de dirección URL de hello proporcionará toousers de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="360d0-260">This is hello URL you will provide toousers of your application.</span></span> <span data-ttu-id="360d0-261">se recomienda Hola siguiente configuración:</span><span class="sxs-lookup"><span data-stu-id="360d0-261">hello following configuration is recommended:</span></span>

|  |  | <span data-ttu-id="360d0-262">**Notas**</span><span class="sxs-lookup"><span data-stu-id="360d0-262">**Notes**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="360d0-263">Servidor web</span><span class="sxs-lookup"><span data-stu-id="360d0-263">Web server</span></span> | <span data-ttu-id="360d0-264">WebListener</span><span class="sxs-lookup"><span data-stu-id="360d0-264">WebListener</span></span> | <span data-ttu-id="360d0-265">Si el servicio de hello es sólo tooa expuesto red de confianza, este tipo de una intranet, se puede usar Kestrel.</span><span class="sxs-lookup"><span data-stu-id="360d0-265">If hello service is only exposed tooa trusted network, such an intranet, Kestrel may be used.</span></span> <span data-ttu-id="360d0-266">En caso contrario, WebListener es opción Hola preferido.</span><span class="sxs-lookup"><span data-stu-id="360d0-266">Otherwise, WebListener is hello preferred option.</span></span> |
| <span data-ttu-id="360d0-267">Configuración de puerto</span><span class="sxs-lookup"><span data-stu-id="360d0-267">Port configuration</span></span> | <span data-ttu-id="360d0-268">estática</span><span class="sxs-lookup"><span data-stu-id="360d0-268">static</span></span> | <span data-ttu-id="360d0-269">Un puerto estático conocido debe configurarse en hello `Endpoints` configuración de ServiceManifest.xml, como 80 para HTTP o 443 para HTTPS.</span><span class="sxs-lookup"><span data-stu-id="360d0-269">A well-known static port should be configured in hello `Endpoints` configuration of ServiceManifest.xml, such as 80 for HTTP or 443 for HTTPS.</span></span> |
| <span data-ttu-id="360d0-270">ServiceFabricIntegrationOptions</span><span class="sxs-lookup"><span data-stu-id="360d0-270">ServiceFabricIntegrationOptions</span></span> | <span data-ttu-id="360d0-271">None</span><span class="sxs-lookup"><span data-stu-id="360d0-271">None</span></span> | <span data-ttu-id="360d0-272">Hola `ServiceFabricIntegrationOptions.None` opción se debe usar al configurar el middleware de integración de Service Fabric para que el servicio de hello no intenta toovalidate las solicitudes entrantes de un identificador único.</span><span class="sxs-lookup"><span data-stu-id="360d0-272">hello `ServiceFabricIntegrationOptions.None` option should be used when configuring Service Fabric integration middleware so that hello service does not attempt toovalidate incoming requests for a unique identifier.</span></span> <span data-ttu-id="360d0-273">Los usuarios externos de la aplicación no podrá saber información de identificación única hello usa Hola middleware.</span><span class="sxs-lookup"><span data-stu-id="360d0-273">External users of your application will not know hello unique identifying information used by hello middleware.</span></span> |
| <span data-ttu-id="360d0-274">Recuento de instancias</span><span class="sxs-lookup"><span data-stu-id="360d0-274">Instance Count</span></span> | <span data-ttu-id="360d0-275">-1</span><span class="sxs-lookup"><span data-stu-id="360d0-275">-1</span></span> | <span data-ttu-id="360d0-276">En casos de uso habitual, recuento de instancias de hello configuración debe establecerse demasiado "-1" para que una instancia está disponible en todos los nodos que reciben tráfico de un equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="360d0-276">In typical use cases, hello instance count setting should be set too"-1" so that an instance is available on all nodes that receive traffic from a load balancer.</span></span> |

<span data-ttu-id="360d0-277">Si varios servicios externamente expuestos compartan Hola al mismo conjunto de nodos, se debe usar una ruta de acceso de dirección URL único pero estable.</span><span class="sxs-lookup"><span data-stu-id="360d0-277">If multiple externally exposed services share hello same set of nodes, a unique but stable URL path should be used.</span></span> <span data-ttu-id="360d0-278">Esto puede realizarse mediante la modificación de la dirección URL de hello proporcionada al configurar IWebHost.</span><span class="sxs-lookup"><span data-stu-id="360d0-278">This can be accomplished by modifying hello URL provided when configuring IWebHost.</span></span> <span data-ttu-id="360d0-279">Tenga en cuenta que esto se aplica solo tooWebListener.</span><span class="sxs-lookup"><span data-stu-id="360d0-279">Note this applies tooWebListener only.</span></span>

 ```csharp
 new WebListenerCommunicationListener(serviceContext, "ServiceEndpoint", (url, listener) =>
 {
     url += "/MyUniqueServicePath";
 
     return new WebHostBuilder()
         .UseWebListener()
         ...
         .UseUrls(url)
         .Build();
 })
 ```

### <a name="internal-only-stateless-aspnet-core-service"></a><span data-ttu-id="360d0-280">Servicio sin estado de ASP.NET Core solo interno</span><span class="sxs-lookup"><span data-stu-id="360d0-280">Internal-only stateless ASP.NET Core service</span></span>
<span data-ttu-id="360d0-281">Los servicios sin estado que solo se llaman desde dentro de clúster de hello deberían utilizar direcciones URL únicas y asignan dinámicamente puertos tooensure cooperación entre varios servicios.</span><span class="sxs-lookup"><span data-stu-id="360d0-281">Stateless services that are only called from within hello cluster should use unique URLs and dynamically assigned ports tooensure cooperation between multiple services.</span></span> <span data-ttu-id="360d0-282">se recomienda Hola siguiente configuración:</span><span class="sxs-lookup"><span data-stu-id="360d0-282">hello following configuration is recommended:</span></span>

|  |  | <span data-ttu-id="360d0-283">**Notas**</span><span class="sxs-lookup"><span data-stu-id="360d0-283">**Notes**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="360d0-284">Servidor web</span><span class="sxs-lookup"><span data-stu-id="360d0-284">Web server</span></span> | <span data-ttu-id="360d0-285">Kestrel</span><span class="sxs-lookup"><span data-stu-id="360d0-285">Kestrel</span></span> | <span data-ttu-id="360d0-286">Aunque WebListener puede utilizarse para los servicios sin estado internos, Kestrel es Hola recomienda server tooallow varios tooshare de instancias de servicio un host.</span><span class="sxs-lookup"><span data-stu-id="360d0-286">Although WebListener may be used for internal stateless services, Kestrel is hello recommended server tooallow multiple service instances tooshare a host.</span></span>  |
| <span data-ttu-id="360d0-287">Configuración de puerto</span><span class="sxs-lookup"><span data-stu-id="360d0-287">Port configuration</span></span> | <span data-ttu-id="360d0-288">asignado de forma dinámica</span><span class="sxs-lookup"><span data-stu-id="360d0-288">dynamically assigned</span></span> | <span data-ttu-id="360d0-289">Varias réplicas de un servicio con estado pueden compartir un proceso de host o un sistema operativo host y, por tanto, necesitarán puertos únicos.</span><span class="sxs-lookup"><span data-stu-id="360d0-289">Multiple replicas of a stateful service may share a host process or host operating system and thus will need unique ports.</span></span> |
| <span data-ttu-id="360d0-290">ServiceFabricIntegrationOptions</span><span class="sxs-lookup"><span data-stu-id="360d0-290">ServiceFabricIntegrationOptions</span></span> | <span data-ttu-id="360d0-291">UseUniqueServiceUrl</span><span class="sxs-lookup"><span data-stu-id="360d0-291">UseUniqueServiceUrl</span></span> | <span data-ttu-id="360d0-292">Con la asignación de puertos dinámicos, esta configuración impide problema Hola equivocado de la identidad que se ha descrito anteriormente.</span><span class="sxs-lookup"><span data-stu-id="360d0-292">With dynamic port assignment, this setting prevents hello mistaken identity issue described earlier.</span></span> |
| <span data-ttu-id="360d0-293">InstanceCount</span><span class="sxs-lookup"><span data-stu-id="360d0-293">InstanceCount</span></span> | <span data-ttu-id="360d0-294">cualquiera</span><span class="sxs-lookup"><span data-stu-id="360d0-294">any</span></span> | <span data-ttu-id="360d0-295">configuración del número de instancia Hola puede establecerse servicio Hola de tooany valor toooperate necesarios.</span><span class="sxs-lookup"><span data-stu-id="360d0-295">hello instance count setting can be set tooany value necessary toooperate hello service.</span></span> |

### <a name="internal-only-stateful-aspnet-core-service"></a><span data-ttu-id="360d0-296">Servicio con estado de ASP.NET Core solo interno</span><span class="sxs-lookup"><span data-stu-id="360d0-296">Internal-only stateful ASP.NET Core service</span></span>
<span data-ttu-id="360d0-297">Los servicios con estado que se llaman solo desde dentro de clúster de hello deben usar puertos asignados dinámicamente tooensure cooperación entre varios servicios.</span><span class="sxs-lookup"><span data-stu-id="360d0-297">Stateful services that are only called from within hello cluster should use dynamically assigned ports tooensure cooperation between multiple services.</span></span> <span data-ttu-id="360d0-298">se recomienda Hola siguiente configuración:</span><span class="sxs-lookup"><span data-stu-id="360d0-298">hello following configuration is recommended:</span></span>

|  |  | <span data-ttu-id="360d0-299">**Notas**</span><span class="sxs-lookup"><span data-stu-id="360d0-299">**Notes**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="360d0-300">Servidor web</span><span class="sxs-lookup"><span data-stu-id="360d0-300">Web server</span></span> | <span data-ttu-id="360d0-301">Kestrel</span><span class="sxs-lookup"><span data-stu-id="360d0-301">Kestrel</span></span> | <span data-ttu-id="360d0-302">Hola `WebListenerCommunicationListener` no está diseñado para su uso por los servicios con estado en el que las réplicas comparten un proceso de host.</span><span class="sxs-lookup"><span data-stu-id="360d0-302">hello `WebListenerCommunicationListener` is not designed for use by stateful services in which replicas share a host process.</span></span> |
| <span data-ttu-id="360d0-303">Configuración de puerto</span><span class="sxs-lookup"><span data-stu-id="360d0-303">Port configuration</span></span> | <span data-ttu-id="360d0-304">asignado de forma dinámica</span><span class="sxs-lookup"><span data-stu-id="360d0-304">dynamically assigned</span></span> | <span data-ttu-id="360d0-305">Varias réplicas de un servicio con estado pueden compartir un proceso de host o un sistema operativo host y, por tanto, necesitarán puertos únicos.</span><span class="sxs-lookup"><span data-stu-id="360d0-305">Multiple replicas of a stateful service may share a host process or host operating system and thus will need unique ports.</span></span> |
| <span data-ttu-id="360d0-306">ServiceFabricIntegrationOptions</span><span class="sxs-lookup"><span data-stu-id="360d0-306">ServiceFabricIntegrationOptions</span></span> | <span data-ttu-id="360d0-307">UseUniqueServiceUrl</span><span class="sxs-lookup"><span data-stu-id="360d0-307">UseUniqueServiceUrl</span></span> | <span data-ttu-id="360d0-308">Con la asignación de puertos dinámicos, esta configuración impide problema Hola equivocado de la identidad que se ha descrito anteriormente.</span><span class="sxs-lookup"><span data-stu-id="360d0-308">With dynamic port assignment, this setting prevents hello mistaken identity issue described earlier.</span></span> |

## <a name="next-steps"></a><span data-ttu-id="360d0-309">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="360d0-309">Next steps</span></span>
[<span data-ttu-id="360d0-310">Depurar la aplicación de Service Fabric con Visual Studio</span><span class="sxs-lookup"><span data-stu-id="360d0-310">Debug your Service Fabric application by using Visual Studio</span></span>](service-fabric-debugging-your-application.md)

<!--Image references-->
[0]:./media/service-fabric-reliable-services-communication-aspnetcore/webhost-standalone.png
[1]:./media/service-fabric-reliable-services-communication-aspnetcore/webhost-servicefabric.png
[2]:./media/service-fabric-reliable-services-communication-aspnetcore/integration.png
[3]:./media/service-fabric-reliable-services-communication-aspnetcore/httpsys.png
[4]:./media/service-fabric-reliable-services-communication-aspnetcore/kestrel.png

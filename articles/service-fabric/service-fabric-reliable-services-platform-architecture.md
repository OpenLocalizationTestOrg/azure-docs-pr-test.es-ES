---
title: Arquitectura de Reliable Services | Microsoft Docs
description: "Información general de la arquitectura de Reliable Services para servicios con y sin estado"
services: service-fabric
documentationcenter: .net
author: AlanWarwick
manager: timlt
editor: vturecek
ms.assetid: af002ae6-7f6d-4769-b049-82aa1ba0891b
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 03/30/2016
ms.author: alanwar
redirect_url: /azure/service-fabric/service-fabric-reliable-services-introduction
ms.openlocfilehash: a00a16945356b9731485554e06df46528b5c7bb2
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="architecture-for-stateful-and-stateless-reliable-services"></a><span data-ttu-id="159f7-103">Arquitectura para servicios de Reliable Services con y sin estado</span><span class="sxs-lookup"><span data-stu-id="159f7-103">Architecture for stateful and stateless Reliable Services</span></span>
<span data-ttu-id="159f7-104">Los servicios de Reliable Services de Azure Service Fabric pueden ser con estado o sin estado.</span><span class="sxs-lookup"><span data-stu-id="159f7-104">An Azure Service Fabric Reliable Service may be stateful or stateless.</span></span> <span data-ttu-id="159f7-105">Cada tipo de servicio se ejecuta dentro de una arquitectura específica.</span><span class="sxs-lookup"><span data-stu-id="159f7-105">Each type of service runs within a specific architecture.</span></span> <span data-ttu-id="159f7-106">Estas arquitecturas se describen en este artículo.</span><span class="sxs-lookup"><span data-stu-id="159f7-106">These architectures are described in this article.</span></span>
<span data-ttu-id="159f7-107">Consulte [Información general de Reliable Services](service-fabric-reliable-services-introduction.md) para obtener más información sobre las diferencias entre los servicios con y sin estado.</span><span class="sxs-lookup"><span data-stu-id="159f7-107">See the [Reliable Service overview](service-fabric-reliable-services-introduction.md) for more information about the differences between stateful and stateless services.</span></span>

## <a name="stateful-reliable-services"></a><span data-ttu-id="159f7-108">Servicios fiables con estado</span><span class="sxs-lookup"><span data-stu-id="159f7-108">Stateful Reliable Services</span></span>
### <a name="architecture-of-a-stateful-service"></a><span data-ttu-id="159f7-109">Arquitectura de un servicio con estado</span><span class="sxs-lookup"><span data-stu-id="159f7-109">Architecture of a stateful service</span></span>
![Diagrama de arquitectura de un servicio con estado](./media/service-fabric-reliable-services-platform-architecture/reliable-stateful-service-architecture.png)

### <a name="stateful-reliable-service"></a><span data-ttu-id="159f7-111">Servicio fiable con estado</span><span class="sxs-lookup"><span data-stu-id="159f7-111">Stateful Reliable Service</span></span>
<span data-ttu-id="159f7-112">Los servicios de Reliable Services con estado pueden derivar de la clase StatefulService o StatefulServiceBase.</span><span class="sxs-lookup"><span data-stu-id="159f7-112">A stateful Reliable Service can derive from either the StatefulService or StatefulServiceBase class.</span></span> <span data-ttu-id="159f7-113">Ambas clases base las proporciona Service Fabric</span><span class="sxs-lookup"><span data-stu-id="159f7-113">Both of these base classes are provided by Service Fabric.</span></span> <span data-ttu-id="159f7-114">y ofrecen diversos niveles de asistencia y abstracción para el servicio con estado para interactuar con Service Fabric y participar como un servicio en el clúster de Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="159f7-114">They offer various levels of support and abstraction for the stateful service to interface with Service Fabric--and to participate as a service within the Service Fabric cluster.</span></span>

<span data-ttu-id="159f7-115">StatefulService se deriva de StatefulServiceBase.</span><span class="sxs-lookup"><span data-stu-id="159f7-115">StatefulService derives from StatefulServiceBase.</span></span> <span data-ttu-id="159f7-116">StatefulServiceBase ofrece a los servicios una mayor flexibilidad, pero requiere más conocimiento de las interioridades de Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="159f7-116">StatefulServiceBase offers services more flexibility, but requires more understanding of the internals of Service Fabric.</span></span>
<span data-ttu-id="159f7-117">Consulte [Información general de Reliable Services](service-fabric-reliable-services-introduction.md) y [Uso avanzado de Reliable Services](service-fabric-reliable-services-advanced-usage.md) para obtener más información sobre las características específicas de escribir servicios mediante las clases StatefulService y StatefulServiceBase.</span><span class="sxs-lookup"><span data-stu-id="159f7-117">See the [Reliable Service overview](service-fabric-reliable-services-introduction.md) and [Reliable Service advanced usage](service-fabric-reliable-services-advanced-usage.md) for more information on the specifics of writing services by using the StatefulService and StatefulServiceBase classes.</span></span>

<span data-ttu-id="159f7-118">Ambas clases base administran la duración y la función de la implementación del servicio.</span><span class="sxs-lookup"><span data-stu-id="159f7-118">Both base classes manage the lifetime and role of the service implementation.</span></span> <span data-ttu-id="159f7-119">La implementación del servicio puede invalidar los métodos virtuales de cualquier clase base si la implementación del servicio tiene trabajo que hacer en esos puntos del ciclo de vida de implementación del servicio o si desea crear un objeto de agente de escucha de comunicación.</span><span class="sxs-lookup"><span data-stu-id="159f7-119">The service implementation may override virtual methods of either base class if the service implementation has work to do at those points in the service implementation lifecycle--or if it wants to create a communication listener object.</span></span> <span data-ttu-id="159f7-120">Tenga en cuenta que aunque una implementación de servicio puede implementar su propio objeto de agente de escucha de comunicación exponiendo ICommunicationListener, en el diagrama anterior, el agente de escucha de comunicación es implementado por Service Fabric mientras la implementación del servicio utiliza un agente de escucha de comunicación implementado por Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="159f7-120">Note that although a service implementation may implement its own communication listener object exposing ICommunicationListener, in the diagram above, the communication listener is implemented by Service Fabric--as the service implementation uses a communication listener that is implemented by Service Fabric.</span></span>

<span data-ttu-id="159f7-121">Los servicios de Reliable Services con estado usan Reliable State Manager para aprovechar las colecciones confiables.</span><span class="sxs-lookup"><span data-stu-id="159f7-121">A stateful Reliable Service uses the reliable state manager to take advantage of reliable collections.</span></span> <span data-ttu-id="159f7-122">Las colecciones confiables son estructuras de datos locales que tienen una alta disponibilidad para su servicio, es decir, están siempre disponibles sin tener en cuenta las conmutaciones por error del servicio.</span><span class="sxs-lookup"><span data-stu-id="159f7-122">Reliable collections are local data structures that are highly available to the service--that is, they are always available, regardless of service failovers.</span></span> <span data-ttu-id="159f7-123">Cada tipo de colección fiable es implementada mediante un proveedor de estado fiable.</span><span class="sxs-lookup"><span data-stu-id="159f7-123">Each type of reliable collection is implemented by a reliable state provider.</span></span>
<span data-ttu-id="159f7-124">Para obtener más información sobre colecciones confiables, consulte [la introducción a las colecciones confiables](service-fabric-reliable-services-reliable-collections.md)</span><span class="sxs-lookup"><span data-stu-id="159f7-124">For more information on reliable collections, see the [reliable collections overview](service-fabric-reliable-services-reliable-collections.md).</span></span>

### <a name="reliable-state-manager-and-state-providers"></a><span data-ttu-id="159f7-125">Proveedores de estado y administrador de estado fiable</span><span class="sxs-lookup"><span data-stu-id="159f7-125">Reliable state manager and state providers</span></span>
<span data-ttu-id="159f7-126">El administrador de estado confiable es el objeto que administra los proveedores de estado confiables.</span><span class="sxs-lookup"><span data-stu-id="159f7-126">The reliable state manager is the object that manages reliable state providers.</span></span> <span data-ttu-id="159f7-127">Tiene la funcionalidad para crear, eliminar, enumerar y asegurarse de que los proveedores de estado confiables sean persistentes y de alta disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="159f7-127">It has the functionality to create, delete, enumerate, and ensure that the reliable state providers are persisted and highly available.</span></span> <span data-ttu-id="159f7-128">Una instancia de proveedor de estado confiable representa una instancia de una estructura de datos persistente y de alta disponibilidad, como un diccionario o una cola.</span><span class="sxs-lookup"><span data-stu-id="159f7-128">A reliable state provider instance represents an instance of a persisted and highly available data structure, such as a dictionary or a queue.</span></span>

<span data-ttu-id="159f7-129">Cada proveedor de estado confiable expone una interfaz que es utilizada por el servicio con estado para interactuar con el proveedor de estado confiable.</span><span class="sxs-lookup"><span data-stu-id="159f7-129">Each reliable state provider exposes an interface that is used by a stateful service to interact with the reliable state provider.</span></span> <span data-ttu-id="159f7-130">Por ejemplo IReliableDictionary se utiliza para interactuar con el diccionario confiable mientras que IReliableQueue se utiliza para interactuar con la cola confiable.</span><span class="sxs-lookup"><span data-stu-id="159f7-130">For example, IReliableDictionary is used to interface with the reliable dictionary, while IReliableQueue is used to interface with the reliable queue.</span></span> <span data-ttu-id="159f7-131">Todos los proveedores de estado fiables implementan la interfaz IReliableState.</span><span class="sxs-lookup"><span data-stu-id="159f7-131">All reliable state providers implement the IReliableState interface.</span></span>

<span data-ttu-id="159f7-132">El administrador de estado confiable tiene una interfaz denominada IReliableStateManager, que permite acceder a ella mediante la implementación del servicio con estado.</span><span class="sxs-lookup"><span data-stu-id="159f7-132">The reliable state manager has an interface named IReliableStateManager, which allows access to it from a stateful service.</span></span> <span data-ttu-id="159f7-133">Mediante IReliableStateManager se devuelven interfaces a proveedores de estado fiables.</span><span class="sxs-lookup"><span data-stu-id="159f7-133">Interfaces to reliable state providers are returned through IReliableStateManager.</span></span>

<span data-ttu-id="159f7-134">El administrador de estado fiable está diseñado con una arquitectura de complemento dinámica para que se puedan conectar dinámicamente nuevos tipos de colecciones fiables.</span><span class="sxs-lookup"><span data-stu-id="159f7-134">The reliable state manager uses a plug-in architecture so that new types of reliable collections can be plugged in dynamically.</span></span>

<span data-ttu-id="159f7-135">El diccionario y la cola confiables se basan en la implementación de un almacén diferencial con versiones de alto rendimiento.</span><span class="sxs-lookup"><span data-stu-id="159f7-135">The reliable dictionary and reliable queue are built upon the implementation of a high-performance, versioned differential store.</span></span>

### <a name="transactional-replicator"></a><span data-ttu-id="159f7-136">Replicador de transacciones</span><span class="sxs-lookup"><span data-stu-id="159f7-136">Transactional replicator</span></span>
<span data-ttu-id="159f7-137">El componente replicador de transacciones es responsable de garantizar que el estado de su servicio (que es el estado del administrador de estado confiable y las colecciones confiables) es coherente en todas las réplicas que se ejecutan en su servicio.</span><span class="sxs-lookup"><span data-stu-id="159f7-137">The transactional replicator component is responsible for ensuring that the state of a service (that is, the state within the reliable state manager and the reliable collections) is consistent across all replicas running the service.</span></span> <span data-ttu-id="159f7-138">También garantiza que ese estado también persiste en el registro.</span><span class="sxs-lookup"><span data-stu-id="159f7-138">It also ensures that the state is persisted in the log.</span></span> <span data-ttu-id="159f7-139">El administrador de estado fiable interactúa con el replicador de transacciones a través de un mecanismo privado.</span><span class="sxs-lookup"><span data-stu-id="159f7-139">The reliable state manager interfaces with the transactional replicator via a private mechanism.</span></span>

<span data-ttu-id="159f7-140">El replicador de transacciones usa un protocolo de red para comunicar el estado con otras réplicas de la instancia de servicio para que todas las réplicas dispongan de información de estado actualizada.</span><span class="sxs-lookup"><span data-stu-id="159f7-140">The transactional replicator uses a network protocol to communicate state with other replicas of the service instance so that all replicas have up-to-date state information.</span></span>

<span data-ttu-id="159f7-141">El replicador de transacciones usa un registro para conservar información de estado para que la información de estado sobreviva a bloqueos del proceso o el nodo.</span><span class="sxs-lookup"><span data-stu-id="159f7-141">The transactional replicator uses a log to persist state information so that the state information survives process or node crashes.</span></span> <span data-ttu-id="159f7-142">La interacción con el registro se efectúa a través de un mecanismo privado.</span><span class="sxs-lookup"><span data-stu-id="159f7-142">The interface to the log is via a private mechanism.</span></span>

### <a name="log"></a><span data-ttu-id="159f7-143">Registro</span><span class="sxs-lookup"><span data-stu-id="159f7-143">Log</span></span>
<span data-ttu-id="159f7-144">El componente de registro proporciona un almacén persistente de alto rendimiento que se puede optimizar para escribir en discos de estado giratorio o sólidos.</span><span class="sxs-lookup"><span data-stu-id="159f7-144">The log component provides a high-performance persistent store that can be optimized for writing to spinning or solid-state disks.</span></span>  <span data-ttu-id="159f7-145">El diseño del registro es para que el almacenamiento persistente (es decir, discos duros) sea local en los nodos que ejecutan el servicio con estado.</span><span class="sxs-lookup"><span data-stu-id="159f7-145">The design of the log is for the persistent storage (i.e., hard disks) to be local to the nodes that are running the stateful service.</span></span> <span data-ttu-id="159f7-146">Esto permite bajas latencias y un alto rendimiento en comparación con el almacenamiento persistente remoto, que no es local en el nodo.</span><span class="sxs-lookup"><span data-stu-id="159f7-146">This allows for low latencies and high throughput, as compared to remote persistent storage, which is not local to the node.</span></span>

<span data-ttu-id="159f7-147">El componente de registro usa varios tipos de archivos de registro.</span><span class="sxs-lookup"><span data-stu-id="159f7-147">The log component uses multiple log files.</span></span> <span data-ttu-id="159f7-148">Hay un archivo de registro compartido de todo el nodo que usan todas las réplicas porque puede proporcionar la menor latencia y el rendimiento máximo para almacenar los datos de estado.</span><span class="sxs-lookup"><span data-stu-id="159f7-148">There is a node-wide shared log file that all replicas use as it can provide the lowest latency and highest throughput for storing state data.</span></span> <span data-ttu-id="159f7-149">De forma predeterminada, el registro compartido se coloca en el directorio de trabajo del nodo de Service Fabric, pero también puede configurarse para que se ponga en otra ubicación (lo ideal sería que se pusiese en un disco reservado solo para el registro compartido).</span><span class="sxs-lookup"><span data-stu-id="159f7-149">By default the shared log is placed in the Service Fabric node work directory but it may also be configured to be placed at another location, ideally on a disk reserved for only the shared log.</span></span> <span data-ttu-id="159f7-150">Cada réplica del servicio también tiene un archivo de registro dedicado, y el registro dedicado se coloca en el directorio de trabajo del servicio.</span><span class="sxs-lookup"><span data-stu-id="159f7-150">Each replica for the service also has a dedicated log file and the dedicated log is placed within the service's work directory.</span></span> <span data-ttu-id="159f7-151">No hay ningún mecanismo para configurar el registro dedicado de modo que se coloque en una ubicación diferente.</span><span class="sxs-lookup"><span data-stu-id="159f7-151">There is no mechanism to configure the dedicated log to be placed at a different location.</span></span>

<span data-ttu-id="159f7-152">El registro compartido es un área de transición para la información de estado de la réplica y el archivo de registro dedicado es el destino final, donde se almacena.</span><span class="sxs-lookup"><span data-stu-id="159f7-152">The shared log is a transitional area for the replica's state information, while the dedicated log file is the final destination where it is persisted.</span></span> <span data-ttu-id="159f7-153">En este diseño la información de estado se escribe, en primer lugar, en el archivo de registro compartido y después se mueve de forma diferida al archivo de registro dedicado en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="159f7-153">In this design, the state information is first written to the shared log file and then lazily moved to the dedicated log file in the background.</span></span> <span data-ttu-id="159f7-154">De esta manera, la escritura en el registro compartido tendría la latencia más baja y el máximo rendimiento, lo que permite que el servicio progrese con mayor rapidez.</span><span class="sxs-lookup"><span data-stu-id="159f7-154">In this way, the write to the shared log would have the lowest latency and highest throughput which allows the service to make progress faster.</span></span>

<span data-ttu-id="159f7-155">Las lecturas y escrituras en el registro compartido se realizan a través de E/S directas en el espacio preasignado en el disco para el archivo de registro compartido.</span><span class="sxs-lookup"><span data-stu-id="159f7-155">Reads and writes to the shared log are done via direct IO to preallocated space on the disk for the shared log file.</span></span> <span data-ttu-id="159f7-156">Para permitir un uso óptimo del espacio en disco en la unidad con registros dedicados, se crea el archivo de registro dedicado como un archivo disperso de NTFS.</span><span class="sxs-lookup"><span data-stu-id="159f7-156">To allow optimal use of disk space on the drive with dedicated logs, the dedicated log file is created as a NTFS sparse file.</span></span> <span data-ttu-id="159f7-157">Tenga en cuenta que esto permitirá un aprovisionamiento en exceso del espacio en disco y el sistema operativo mostrará los archivos de registro dedicados con mucho más espacio en disco del que se usa realmente.</span><span class="sxs-lookup"><span data-stu-id="159f7-157">Note that this will allow overprovisioning of disk space and the OS will show the dedicated log files using much more disk space than is actually used.</span></span>

<span data-ttu-id="159f7-158">Además de una interfaz de modo de usuario mínima en el registro, el registro se escribe como un controlador en modo kernel.</span><span class="sxs-lookup"><span data-stu-id="159f7-158">Aside from a minimal user-mode interface to the log, the log is written as a kernel-mode driver.</span></span> <span data-ttu-id="159f7-159">Mediante la ejecución como un controlador de modo kernel, el registro puede proporcionar el máximo rendimiento a todos los servicios que lo utilizan.</span><span class="sxs-lookup"><span data-stu-id="159f7-159">By running as a kernel-mode driver, the log can provide the highest performance to all services that use it.</span></span>

<span data-ttu-id="159f7-160">Para obtener más información sobre cómo configurar el registro, consulte [Configuración de Reliable Services con estado](service-fabric-reliable-services-configuration.md).</span><span class="sxs-lookup"><span data-stu-id="159f7-160">For more information about configuring the log, see [Configuring stateful Reliable Services](service-fabric-reliable-services-configuration.md).</span></span>

## <a name="stateless-reliable-service"></a><span data-ttu-id="159f7-161">Servicio fiable sin estado</span><span class="sxs-lookup"><span data-stu-id="159f7-161">Stateless Reliable Service</span></span>
### <a name="architecture-of-a-stateless-service"></a><span data-ttu-id="159f7-162">Arquitectura de un servicio sin estado</span><span class="sxs-lookup"><span data-stu-id="159f7-162">Architecture of a stateless service</span></span>
![Diagrama de arquitectura de un servicio sin estado](./media/service-fabric-reliable-services-platform-architecture/reliable-stateless-service-architecture.png)

### <a name="stateless-reliable-service"></a><span data-ttu-id="159f7-164">Servicio fiable sin estado</span><span class="sxs-lookup"><span data-stu-id="159f7-164">Stateless Reliable Service</span></span>
<span data-ttu-id="159f7-165">Las implementaciones de servicios sin estado se derivan de la clase StatelessService o StatelessServiceBase.</span><span class="sxs-lookup"><span data-stu-id="159f7-165">Stateless service implementations derive from the StatelessService or StatelessServiceBase class.</span></span> <span data-ttu-id="159f7-166">La clase StatelessServiceBase permite más flexibilidad que la clase StatelessService.</span><span class="sxs-lookup"><span data-stu-id="159f7-166">The StatelessServiceBase class allows more flexibility than the StatelessService class.</span></span>
<span data-ttu-id="159f7-167">Ambas clases base administran la duración y el rol del servicio.</span><span class="sxs-lookup"><span data-stu-id="159f7-167">Both base classes manage the lifetime and role of a service.</span></span>

<span data-ttu-id="159f7-168">La implementación del servicio puede invalidar los métodos virtuales de cualquier clase base si el servicio tiene trabajo que hacer en esos puntos del ciclo de vida de servicio o si desea crear un objeto de agente de escucha de comunicación.</span><span class="sxs-lookup"><span data-stu-id="159f7-168">The service implementation may override virtual methods of either base class if the service has work to do at those points in the service lifecycle--or if it wants to create a communication listener object.</span></span> <span data-ttu-id="159f7-169">Tenga en cuenta que aunque es posible que el servicio puede implementar su propio objeto de agente de escucha de comunicación exponiendo ICommunicationListener, en el diagrama anterior, el agente de escucha de comunicación es implementado por Service Fabric mientras la implementación del servicio utiliza un agente de escucha de comunicación implementado por Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="159f7-169">Note that although the service may implement its own communication listener object exposing ICommunicationListener, in the diagram above, the communication listener is implemented by Service Fabric, as that service implementation uses a communication listener that is implemented by Service Fabric.</span></span>

<span data-ttu-id="159f7-170">Consulte [Información general de Reliable Services](service-fabric-reliable-services-introduction.md) y [Uso avanzado de Reliable Services](service-fabric-reliable-services-advanced-usage.md) para obtener más información sobre las características específicas de escribir servicios mediante las clases StatelessService y StatelessServiceBase.</span><span class="sxs-lookup"><span data-stu-id="159f7-170">See the [Reliable Service overview](service-fabric-reliable-services-introduction.md) and [Reliable Service advanced usage](service-fabric-reliable-services-advanced-usage.md) for more information on the specifics of writing services using the StatelessService and StatelessServiceBase classes.</span></span>

<!--Every topic should have next steps and links to the next logical set of content to keep the customer engaged-->
## <a name="next-steps"></a><span data-ttu-id="159f7-171">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="159f7-171">Next steps</span></span>
<span data-ttu-id="159f7-172">Para obtener más información acerca de Service Fabric, consulte:</span><span class="sxs-lookup"><span data-stu-id="159f7-172">For more information about Service Fabric, see:</span></span>

[<span data-ttu-id="159f7-173">Información general del servicio confiable</span><span class="sxs-lookup"><span data-stu-id="159f7-173">Reliable service overview</span></span>](service-fabric-reliable-services-introduction.md)

[<span data-ttu-id="159f7-174">Inicio rápido</span><span class="sxs-lookup"><span data-stu-id="159f7-174">Quick start</span></span>](service-fabric-reliable-services-quick-start.md)

[<span data-ttu-id="159f7-175">Información general sobre colecciones confiables</span><span class="sxs-lookup"><span data-stu-id="159f7-175">Reliable collections overview</span></span>](service-fabric-reliable-services-reliable-collections.md)

[<span data-ttu-id="159f7-176">Uso avanzado de un servicio confiable</span><span class="sxs-lookup"><span data-stu-id="159f7-176">Reliable service advanced usage</span></span>](service-fabric-reliable-services-advanced-usage.md)

[<span data-ttu-id="159f7-177">Configuración de un servicio confiable</span><span class="sxs-lookup"><span data-stu-id="159f7-177">Reliable service configuration</span></span>](service-fabric-reliable-services-configuration.md)  


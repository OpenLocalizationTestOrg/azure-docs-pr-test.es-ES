---
title: Directrices y recomendaciones de Reliable Collections en Azure Service Fabric | Microsoft Docs
description: Directrices y recomendaciones para el uso de Reliable Collections de Service Fabric
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: masnider,rajak
ms.assetid: 62857523-604b-434e-bd1c-2141ea4b00d1
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: required
ms.date: 5/3/2017
ms.author: mcoskun
ms.openlocfilehash: 053a7bca76362035e428fc11806b3e4f83d00946
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="guidelines-and-recommendations-for-reliable-collections-in-azure-service-fabric"></a><span data-ttu-id="4456d-103">Directrices y recomendaciones de Reliable Collections en Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="4456d-103">Guidelines and recommendations for Reliable Collections in Azure Service Fabric</span></span>
<span data-ttu-id="4456d-104">Esta sección proporciona directrices para el uso de Reliable State Manager y Reliable Collections.</span><span class="sxs-lookup"><span data-stu-id="4456d-104">This section provides guidelines for using Reliable State Manager and Reliable Collections.</span></span> <span data-ttu-id="4456d-105">El objetivo es ayudar a los usuarios a evitar problemas comunes.</span><span class="sxs-lookup"><span data-stu-id="4456d-105">The goal is to help users avoid common pitfalls.</span></span>

<span data-ttu-id="4456d-106">Las instrucciones se organizan como recomendaciones sencillas precedidas por los términos *Haga*, *Considere*, *Evite* y *No haga*.</span><span class="sxs-lookup"><span data-stu-id="4456d-106">The guidelines are organized as simple recommendations prefixed with the terms *Do*, *Consider*, *Avoid* and *Do not*.</span></span>

* <span data-ttu-id="4456d-107">No modifique un objeto de tipo personalizado que hayan devuelto las operaciones de lectura (por ejemplo, `TryPeekAsync` o `TryGetValueAsync`).</span><span class="sxs-lookup"><span data-stu-id="4456d-107">Do not modify an object of custom type returned by read operations (for example, `TryPeekAsync` or `TryGetValueAsync`).</span></span> <span data-ttu-id="4456d-108">Las colecciones fiables, igual que las colecciones simultáneas, devuelven una referencia a los objetos y no una copia.</span><span class="sxs-lookup"><span data-stu-id="4456d-108">Reliable Collections, just like Concurrent Collections, return a reference to the objects and not a copy.</span></span>
* <span data-ttu-id="4456d-109">No haga una copia en profundidad del objeto devuelto de tipo personalizado antes de modificarlo.</span><span class="sxs-lookup"><span data-stu-id="4456d-109">Do deep copy the returned object of a custom type before modifying it.</span></span> <span data-ttu-id="4456d-110">Por ello, los struct y los tipos integrados son una transmisión por valor, no es necesario hacer una copia en profundidad en ellos.</span><span class="sxs-lookup"><span data-stu-id="4456d-110">Since structs and built-in types are pass-by-value, you do not need to do a deep copy on them.</span></span>
* <span data-ttu-id="4456d-111">No use `TimeSpan.MaxValue` para tiempos de espera.</span><span class="sxs-lookup"><span data-stu-id="4456d-111">Do not use `TimeSpan.MaxValue` for time-outs.</span></span> <span data-ttu-id="4456d-112">Los tiempos de espera se deben utilizar para detectar interbloqueos.</span><span class="sxs-lookup"><span data-stu-id="4456d-112">Time-outs should be used to detect deadlocks.</span></span>
* <span data-ttu-id="4456d-113">No utilice una transacción una vez que se haya confirmado, anulado o eliminado.</span><span class="sxs-lookup"><span data-stu-id="4456d-113">Do not use a transaction after it has been committed, aborted, or disposed.</span></span>
* <span data-ttu-id="4456d-114">No utilice una enumeración fuera del ámbito de transacción en que se creó.</span><span class="sxs-lookup"><span data-stu-id="4456d-114">Do not use an enumeration outside of the transaction scope it was created in.</span></span>
* <span data-ttu-id="4456d-115">No cree una transacción dentro de la instrucción `using` de otra transacción, ya que puede provocar interbloqueos.</span><span class="sxs-lookup"><span data-stu-id="4456d-115">Do not create a transaction within another transaction’s `using` statement because it can cause deadlocks.</span></span>
* <span data-ttu-id="4456d-116">Asegúrese de que la implementación de `IComparable<TKey>` es correcta.</span><span class="sxs-lookup"><span data-stu-id="4456d-116">Do ensure that your `IComparable<TKey>` implementation is correct.</span></span> <span data-ttu-id="4456d-117">El sistema asume la dependencia de `IComparable<TKey>` para combinar los puntos de control y las filas.</span><span class="sxs-lookup"><span data-stu-id="4456d-117">The system takes dependency on `IComparable<TKey>` for merging checkpoints and rows.</span></span>
* <span data-ttu-id="4456d-118">Utilice el bloqueo de actualización al leer un elemento con la intención de actualizarlo para evitar que se produzca una clase determinada de interbloqueos.</span><span class="sxs-lookup"><span data-stu-id="4456d-118">Do use Update lock when reading an item with an intention to update it to prevent a certain class of deadlocks.</span></span>
* <span data-ttu-id="4456d-119">Plantéese la posibilidad de mantener sus elementos (por ejemplo, TKey y TValue para el diccionario confiable) por debajo de los 80 kB: cuanto más pequeños, mejor.</span><span class="sxs-lookup"><span data-stu-id="4456d-119">Consider keeping your items (for example, TKey + TValue for Reliable Dictionary) below 80 KBytes: smaller the better.</span></span> <span data-ttu-id="4456d-120">De este modo, reducirá el grado de uso del montón de objetos grandes, así como los requisitos de E/S de red y de disco.</span><span class="sxs-lookup"><span data-stu-id="4456d-120">This reduces the amount of Large Object Heap usage as well as disk and network IO requirements.</span></span> <span data-ttu-id="4456d-121">A menudo, disminuye la replicación de datos duplicados cuando solo se actualiza una pequeña parte del valor.</span><span class="sxs-lookup"><span data-stu-id="4456d-121">Often, it reduces replicating duplicate data when only one small part of the value is being updated.</span></span> <span data-ttu-id="4456d-122">La forma habitual de conseguir esto en el diccionario confiable pasa por dividir las filas en varias de ellas.</span><span class="sxs-lookup"><span data-stu-id="4456d-122">Common way to achieve this in Reliable Dictionary, is to break your rows in to multiple rows.</span></span>
* <span data-ttu-id="4456d-123">Considere la posibilidad de utilizar la funcionalidad de copia de seguridad y restauración para la recuperación ante desastres.</span><span class="sxs-lookup"><span data-stu-id="4456d-123">Consider using backup and restore functionality to have disaster recovery.</span></span>
* <span data-ttu-id="4456d-124">Evite mezclar operaciones de entidad única y de varias entidades (por ejemplo, `GetCountAsync` y `CreateEnumerableAsync`) en la misma transacción debido a los diferentes niveles de aislamiento.</span><span class="sxs-lookup"><span data-stu-id="4456d-124">Avoid mixing single entity operations and multi-entity operations (e.g `GetCountAsync`, `CreateEnumerableAsync`) in the same transaction due to the different isolation levels.</span></span>
* <span data-ttu-id="4456d-125">Controle la excepción InvalidOperationException.</span><span class="sxs-lookup"><span data-stu-id="4456d-125">Do handle InvalidOperationException.</span></span> <span data-ttu-id="4456d-126">El sistema puede anular las transacciones de usuario pueden por diversos motivos.</span><span class="sxs-lookup"><span data-stu-id="4456d-126">User transactions can be aborted by the system for variety of reasons.</span></span> <span data-ttu-id="4456d-127">Por ejemplo, cuando Reliable State Manager cambia su rol de Principal o cuando una transacción de larga ejecución está bloqueando el truncamiento del registro transaccional.</span><span class="sxs-lookup"><span data-stu-id="4456d-127">For example, when the Reliable State Manager is changing its role out of Primary or when a long-running transaction is blocking truncation of the transactional log.</span></span> <span data-ttu-id="4456d-128">En tales casos, el usuario puede recibir la excepción InvalidOperationException, que indica que ya ha finalizado su transacción.</span><span class="sxs-lookup"><span data-stu-id="4456d-128">In such cases, user may receive InvalidOperationException indicating that their transaction has already been terminated.</span></span> <span data-ttu-id="4456d-129">Suponiendo que la finalización de la transacción no la ha solicitado el usuario, la mejor manera de controlar esta excepción es eliminando la transacción, comprobar si se ha señalado el token de cancelación (o si se ha cambiado el rol de la réplica) y, si no, crear una nueva transacción y volver a intentarlo.</span><span class="sxs-lookup"><span data-stu-id="4456d-129">Assuming, the termination of the transaction was not requested by the user, best way to handle this exception is to dispose the transaction, check if the cancellation token has been signaled (or the role of the replica has been changed), and if not create a new transaction and retry.</span></span>  

<span data-ttu-id="4456d-130">Algunos aspectos que debe tener en cuenta:</span><span class="sxs-lookup"><span data-stu-id="4456d-130">Here are some things to keep in mind:</span></span>

* <span data-ttu-id="4456d-131">El tiempo de espera predeterminado es de 4 segundos para todas las API de Reliable Collection.</span><span class="sxs-lookup"><span data-stu-id="4456d-131">The default time-out is four seconds for all the Reliable Collection APIs.</span></span> <span data-ttu-id="4456d-132">La mayoría de los usuarios debe utilizar el tiempo de espera predeterminado.</span><span class="sxs-lookup"><span data-stu-id="4456d-132">Most users should use the default time-out.</span></span>
* <span data-ttu-id="4456d-133">El token de cancelación predeterminado es `CancellationToken.None` en todas las API de colecciones confiables.</span><span class="sxs-lookup"><span data-stu-id="4456d-133">The default cancellation token is `CancellationToken.None` in all Reliable Collections APIs.</span></span>
* <span data-ttu-id="4456d-134">El parámetro de tipo de clave (*TKey`Equals()`) de un diccionario confiable debe implementar correctamente* y `GetHashCode()`.</span><span class="sxs-lookup"><span data-stu-id="4456d-134">The key type parameter (*TKey*) for a Reliable Dictionary must correctly implement `GetHashCode()` and `Equals()`.</span></span> <span data-ttu-id="4456d-135">Las claves deben ser inmutables.</span><span class="sxs-lookup"><span data-stu-id="4456d-135">Keys must be immutable.</span></span>
* <span data-ttu-id="4456d-136">Para lograr una alta disponibilidad para las colecciones confiables, cada servicio debe tener al menos un destino y un tamaño de conjunto de réplicas mínimo de 3.</span><span class="sxs-lookup"><span data-stu-id="4456d-136">To achieve high availability for the Reliable Collections, each service should have at least a target and minimum replica set size of 3.</span></span>
* <span data-ttu-id="4456d-137">Las operaciones de lectura de la base de datos secundaria pueden leer versiones que no están confirmadas en el cuórum.</span><span class="sxs-lookup"><span data-stu-id="4456d-137">Read operations on the secondary may read versions that are not quorum committed.</span></span>
  <span data-ttu-id="4456d-138">Esto significa que una versión de datos leída desde una única base de datos secundaria podría progresar como false.</span><span class="sxs-lookup"><span data-stu-id="4456d-138">This means that a version of data that is read from a single secondary might be false progressed.</span></span>
  <span data-ttu-id="4456d-139">Las lecturas de la base de datos principal siempre son estables, es decir, que nunca pueden progresar como false.</span><span class="sxs-lookup"><span data-stu-id="4456d-139">Reads from Primary are always stable: can never be false progressed.</span></span>

### <a name="next-steps"></a><span data-ttu-id="4456d-140">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="4456d-140">Next steps</span></span>
* [<span data-ttu-id="4456d-141">Trabajo con Reliable Collections</span><span class="sxs-lookup"><span data-stu-id="4456d-141">Working with Reliable Collections</span></span>](service-fabric-work-with-reliable-collections.md)
* [<span data-ttu-id="4456d-142">Transacciones y bloqueos</span><span class="sxs-lookup"><span data-stu-id="4456d-142">Transactions and Locks</span></span>](service-fabric-reliable-services-reliable-collections-transactions-locks.md)
* [<span data-ttu-id="4456d-143">Reliable State Manager y Reliable Collections internos</span><span class="sxs-lookup"><span data-stu-id="4456d-143">Reliable State Manager and Collection Internals</span></span>](service-fabric-reliable-services-reliable-collections-internals.md)
* <span data-ttu-id="4456d-144">Administración de datos</span><span class="sxs-lookup"><span data-stu-id="4456d-144">Managing Data</span></span>
  * [<span data-ttu-id="4456d-145">Copia de seguridad y restauración</span><span class="sxs-lookup"><span data-stu-id="4456d-145">Backup and Restore</span></span>](service-fabric-reliable-services-backup-restore.md)
  * [<span data-ttu-id="4456d-146">Notifications</span><span class="sxs-lookup"><span data-stu-id="4456d-146">Notifications</span></span>](service-fabric-reliable-services-notifications.md)
  * [<span data-ttu-id="4456d-147">Serialización y actualización</span><span class="sxs-lookup"><span data-stu-id="4456d-147">Serialization and Upgrade</span></span>](service-fabric-application-upgrade-data-serialization.md)
  * [<span data-ttu-id="4456d-148">Configuración del administrador de estado confiable</span><span class="sxs-lookup"><span data-stu-id="4456d-148">Reliable State Manager configuration</span></span>](service-fabric-reliable-services-configuration.md)
* <span data-ttu-id="4456d-149">Otros</span><span class="sxs-lookup"><span data-stu-id="4456d-149">Others</span></span>
  * [<span data-ttu-id="4456d-150">Introducción a Reliable Services de Service Fabric de Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="4456d-150">Reliable Services quick start</span></span>](service-fabric-reliable-services-quick-start.md)
  * [<span data-ttu-id="4456d-151">Referencia para desarrolladores de colecciones confiables</span><span class="sxs-lookup"><span data-stu-id="4456d-151">Developer reference for Reliable Collections</span></span>](https://msdn.microsoft.com/library/azure/microsoft.servicefabric.data.collections.aspx)

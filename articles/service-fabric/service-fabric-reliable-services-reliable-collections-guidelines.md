---
title: aaaGuidelines & recomendaciones para las colecciones confiable en Azure Service Fabric | Documentos de Microsoft
description: Directrices y recomendaciones para el uso de Reliable Collections de Service Fabric
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: masnider,rajak
ms.assetid: 62857523-604b-434e-bd1c-2141ea4b00d1
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: required
ms.date: 5/3/2017
ms.author: mcoskun
ms.openlocfilehash: bcdbc9d013bc044e06c43761e7f515c7e4bf340c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="guidelines-and-recommendations-for-reliable-collections-in-azure-service-fabric"></a><span data-ttu-id="845d5-103">Directrices y recomendaciones de Reliable Collections en Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="845d5-103">Guidelines and recommendations for Reliable Collections in Azure Service Fabric</span></span>
<span data-ttu-id="845d5-104">Esta sección proporciona directrices para el uso de Reliable State Manager y Reliable Collections.</span><span class="sxs-lookup"><span data-stu-id="845d5-104">This section provides guidelines for using Reliable State Manager and Reliable Collections.</span></span> <span data-ttu-id="845d5-105">objetivo de Hello es toohelp a los usuarios evitar los errores comunes.</span><span class="sxs-lookup"><span data-stu-id="845d5-105">hello goal is toohelp users avoid common pitfalls.</span></span>

<span data-ttu-id="845d5-106">directrices de Hola se organizan como recomendaciones sencillas precedidas con términos de hello *hacer*, *considere la posibilidad de*, *evitar* y *no*.</span><span class="sxs-lookup"><span data-stu-id="845d5-106">hello guidelines are organized as simple recommendations prefixed with hello terms *Do*, *Consider*, *Avoid* and *Do not*.</span></span>

* <span data-ttu-id="845d5-107">No modifique un objeto de tipo personalizado que hayan devuelto las operaciones de lectura (por ejemplo, `TryPeekAsync` o `TryGetValueAsync`).</span><span class="sxs-lookup"><span data-stu-id="845d5-107">Do not modify an object of custom type returned by read operations (for example, `TryPeekAsync` or `TryGetValueAsync`).</span></span> <span data-ttu-id="845d5-108">Las colecciones de confianza, al igual que las recolecciones simultáneas, devolución un objeto de toohello de referencia y no una copia.</span><span class="sxs-lookup"><span data-stu-id="845d5-108">Reliable Collections, just like Concurrent Collections, return a reference toohello objects and not a copy.</span></span>
* <span data-ttu-id="845d5-109">Hacer Hola de copia en profundidad devuelve el objeto de un tipo personalizado antes de modificarla.</span><span class="sxs-lookup"><span data-stu-id="845d5-109">Do deep copy hello returned object of a custom type before modifying it.</span></span> <span data-ttu-id="845d5-110">Puesto que las estructuras y los tipos integrados son pasada por valor, no es necesario toodo una copia en profundidad en ellos.</span><span class="sxs-lookup"><span data-stu-id="845d5-110">Since structs and built-in types are pass-by-value, you do not need toodo a deep copy on them.</span></span>
* <span data-ttu-id="845d5-111">No use `TimeSpan.MaxValue` para tiempos de espera.</span><span class="sxs-lookup"><span data-stu-id="845d5-111">Do not use `TimeSpan.MaxValue` for time-outs.</span></span> <span data-ttu-id="845d5-112">Los tiempos de espera deben ser usado toodetect interbloqueos.</span><span class="sxs-lookup"><span data-stu-id="845d5-112">Time-outs should be used toodetect deadlocks.</span></span>
* <span data-ttu-id="845d5-113">No utilice una transacción una vez que se haya confirmado, anulado o eliminado.</span><span class="sxs-lookup"><span data-stu-id="845d5-113">Do not use a transaction after it has been committed, aborted, or disposed.</span></span>
* <span data-ttu-id="845d5-114">No utilice una enumeración fuera del ámbito de transacción de Hola que se creó.</span><span class="sxs-lookup"><span data-stu-id="845d5-114">Do not use an enumeration outside of hello transaction scope it was created in.</span></span>
* <span data-ttu-id="845d5-115">No cree una transacción dentro de la instrucción `using` de otra transacción, ya que puede provocar interbloqueos.</span><span class="sxs-lookup"><span data-stu-id="845d5-115">Do not create a transaction within another transaction’s `using` statement because it can cause deadlocks.</span></span>
* <span data-ttu-id="845d5-116">Asegúrese de que la implementación de `IComparable<TKey>` es correcta.</span><span class="sxs-lookup"><span data-stu-id="845d5-116">Do ensure that your `IComparable<TKey>` implementation is correct.</span></span> <span data-ttu-id="845d5-117">sistema de Hello tiene dependencia en `IComparable<TKey>` para combinar los puntos de control y de filas.</span><span class="sxs-lookup"><span data-stu-id="845d5-117">hello system takes dependency on `IComparable<TKey>` for merging checkpoints and rows.</span></span>
* <span data-ttu-id="845d5-118">Utilice el bloqueo de actualización al leer un elemento con un tooupdate intención se tooprevent una clase determinada de interbloqueos.</span><span class="sxs-lookup"><span data-stu-id="845d5-118">Do use Update lock when reading an item with an intention tooupdate it tooprevent a certain class of deadlocks.</span></span>
* <span data-ttu-id="845d5-119">Considere la posibilidad de mantener los elementos (por ejemplo, TKey + TValue para diccionario confiable) por debajo de 80 KBytes: Hola menor mejor.</span><span class="sxs-lookup"><span data-stu-id="845d5-119">Consider keeping your items (for example, TKey + TValue for Reliable Dictionary) below 80 KBytes: smaller hello better.</span></span> <span data-ttu-id="845d5-120">Esto reduce la cantidad de Hola de los requisitos de E/S de red, así como disco y uso de montón de objetos grandes.</span><span class="sxs-lookup"><span data-stu-id="845d5-120">This reduces hello amount of Large Object Heap usage as well as disk and network IO requirements.</span></span> <span data-ttu-id="845d5-121">A menudo, reduce replicar datos duplicados cuando se actualiza solo una pequeña parte del valor de Hola.</span><span class="sxs-lookup"><span data-stu-id="845d5-121">Often, it reduces replicating duplicate data when only one small part of hello value is being updated.</span></span> <span data-ttu-id="845d5-122">Tooachieve comunes de manera confiable diccionario, se trata de toobreak sus filas en toomultiple filas.</span><span class="sxs-lookup"><span data-stu-id="845d5-122">Common way tooachieve this in Reliable Dictionary, is toobreak your rows in toomultiple rows.</span></span>
* <span data-ttu-id="845d5-123">Considere el uso de copia de seguridad y restauración de recuperación ante desastres de funcionalidad toohave.</span><span class="sxs-lookup"><span data-stu-id="845d5-123">Consider using backup and restore functionality toohave disaster recovery.</span></span>
* <span data-ttu-id="845d5-124">Evite mezclar operaciones de varias entidades y operaciones de entidad única (por ejemplo `GetCountAsync`, `CreateEnumerableAsync`) en hello vencimiento toohello distintos niveles de aislamiento de la transacción misma.</span><span class="sxs-lookup"><span data-stu-id="845d5-124">Avoid mixing single entity operations and multi-entity operations (e.g `GetCountAsync`, `CreateEnumerableAsync`) in hello same transaction due toohello different isolation levels.</span></span>
* <span data-ttu-id="845d5-125">Controle la excepción InvalidOperationException.</span><span class="sxs-lookup"><span data-stu-id="845d5-125">Do handle InvalidOperationException.</span></span> <span data-ttu-id="845d5-126">Las transacciones de usuario pueden anularse por sistema de Hola para diversos motivos.</span><span class="sxs-lookup"><span data-stu-id="845d5-126">User transactions can be aborted by hello system for variety of reasons.</span></span> <span data-ttu-id="845d5-127">Por ejemplo, cuando cambia su rol de principal Hola el Administrador de estado confiable o cuando una transacción de larga duración está bloqueando el truncamiento del registro transaccional de Hola de.</span><span class="sxs-lookup"><span data-stu-id="845d5-127">For example, when hello Reliable State Manager is changing its role out of Primary or when a long-running transaction is blocking truncation of hello transactional log.</span></span> <span data-ttu-id="845d5-128">En tales casos, el usuario puede recibir la excepción InvalidOperationException, que indica que ya ha finalizado su transacción.</span><span class="sxs-lookup"><span data-stu-id="845d5-128">In such cases, user may receive InvalidOperationException indicating that their transaction has already been terminated.</span></span> <span data-ttu-id="845d5-129">Suponiendo que, terminación Hola de transacción de Hola no se ha solicitado por el usuario de Hola, mejor toohandle de manera esta excepción es la transacción de hello toodispose, compruebe si se ha señalado el token de cancelación de hello (o se ha cambiado el rol de Hola de réplica de hello) y si no crear una nueva transacción y vuelva a intentarlo.</span><span class="sxs-lookup"><span data-stu-id="845d5-129">Assuming, hello termination of hello transaction was not requested by hello user, best way toohandle this exception is toodispose hello transaction, check if hello cancellation token has been signaled (or hello role of hello replica has been changed), and if not create a new transaction and retry.</span></span>  

<span data-ttu-id="845d5-130">Estas son algunas cosas tookeep en cuenta:</span><span class="sxs-lookup"><span data-stu-id="845d5-130">Here are some things tookeep in mind:</span></span>

* <span data-ttu-id="845d5-131">tiempo de espera de Hello predeterminado es cuatro segundos para hello todas las API de colección confiable.</span><span class="sxs-lookup"><span data-stu-id="845d5-131">hello default time-out is four seconds for all hello Reliable Collection APIs.</span></span> <span data-ttu-id="845d5-132">La mayoría de los usuarios deben utilizar el tiempo de espera de hello predeterminado.</span><span class="sxs-lookup"><span data-stu-id="845d5-132">Most users should use hello default time-out.</span></span>
* <span data-ttu-id="845d5-133">Hola token de cancelación predeterminado es `CancellationToken.None` en todas las API de colecciones confiable.</span><span class="sxs-lookup"><span data-stu-id="845d5-133">hello default cancellation token is `CancellationToken.None` in all Reliable Collections APIs.</span></span>
* <span data-ttu-id="845d5-134">Hola de parámetro de tipo de clave (*TKey*) para un diccionario confiable correctamente debe implementar `GetHashCode()` y `Equals()`.</span><span class="sxs-lookup"><span data-stu-id="845d5-134">hello key type parameter (*TKey*) for a Reliable Dictionary must correctly implement `GetHashCode()` and `Equals()`.</span></span> <span data-ttu-id="845d5-135">Las claves deben ser inmutables.</span><span class="sxs-lookup"><span data-stu-id="845d5-135">Keys must be immutable.</span></span>
* <span data-ttu-id="845d5-136">tooachieve alta disponibilidad para hello colecciones confiable, cada servicio debe tener al menos un destino y la réplica mínimo establecer tamaño de 3.</span><span class="sxs-lookup"><span data-stu-id="845d5-136">tooachieve high availability for hello Reliable Collections, each service should have at least a target and minimum replica set size of 3.</span></span>
* <span data-ttu-id="845d5-137">Las operaciones de lectura en hello secundaria pueden leer las versiones que no están confirmada de quórum.</span><span class="sxs-lookup"><span data-stu-id="845d5-137">Read operations on hello secondary may read versions that are not quorum committed.</span></span>
  <span data-ttu-id="845d5-138">Esto significa que una versión de datos leída desde una única base de datos secundaria podría progresar como false.</span><span class="sxs-lookup"><span data-stu-id="845d5-138">This means that a version of data that is read from a single secondary might be false progressed.</span></span>
  <span data-ttu-id="845d5-139">Las lecturas de la base de datos principal siempre son estables, es decir, que nunca pueden progresar como false.</span><span class="sxs-lookup"><span data-stu-id="845d5-139">Reads from Primary are always stable: can never be false progressed.</span></span>

### <a name="next-steps"></a><span data-ttu-id="845d5-140">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="845d5-140">Next steps</span></span>
* [<span data-ttu-id="845d5-141">Trabajo con Reliable Collections</span><span class="sxs-lookup"><span data-stu-id="845d5-141">Working with Reliable Collections</span></span>](service-fabric-work-with-reliable-collections.md)
* [<span data-ttu-id="845d5-142">Transacciones y bloqueos</span><span class="sxs-lookup"><span data-stu-id="845d5-142">Transactions and Locks</span></span>](service-fabric-reliable-services-reliable-collections-transactions-locks.md)
* [<span data-ttu-id="845d5-143">Reliable State Manager y Reliable Collections internos</span><span class="sxs-lookup"><span data-stu-id="845d5-143">Reliable State Manager and Collection Internals</span></span>](service-fabric-reliable-services-reliable-collections-internals.md)
* <span data-ttu-id="845d5-144">Administración de datos</span><span class="sxs-lookup"><span data-stu-id="845d5-144">Managing Data</span></span>
  * [<span data-ttu-id="845d5-145">Copia de seguridad y restauración</span><span class="sxs-lookup"><span data-stu-id="845d5-145">Backup and Restore</span></span>](service-fabric-reliable-services-backup-restore.md)
  * [<span data-ttu-id="845d5-146">Notifications</span><span class="sxs-lookup"><span data-stu-id="845d5-146">Notifications</span></span>](service-fabric-reliable-services-notifications.md)
  * [<span data-ttu-id="845d5-147">Serialización y actualización</span><span class="sxs-lookup"><span data-stu-id="845d5-147">Serialization and Upgrade</span></span>](service-fabric-application-upgrade-data-serialization.md)
  * [<span data-ttu-id="845d5-148">Configuración del administrador de estado confiable</span><span class="sxs-lookup"><span data-stu-id="845d5-148">Reliable State Manager configuration</span></span>](service-fabric-reliable-services-configuration.md)
* <span data-ttu-id="845d5-149">Otros</span><span class="sxs-lookup"><span data-stu-id="845d5-149">Others</span></span>
  * [<span data-ttu-id="845d5-150">Introducción a Reliable Services de Service Fabric de Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="845d5-150">Reliable Services quick start</span></span>](service-fabric-reliable-services-quick-start.md)
  * [<span data-ttu-id="845d5-151">Referencia para desarrolladores de colecciones confiables</span><span class="sxs-lookup"><span data-stu-id="845d5-151">Developer reference for Reliable Collections</span></span>](https://msdn.microsoft.com/library/azure/microsoft.servicefabric.data.collections.aspx)

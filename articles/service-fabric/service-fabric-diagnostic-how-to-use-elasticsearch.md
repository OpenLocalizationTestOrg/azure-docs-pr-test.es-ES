---
title: "aaaUsing Elasticsearch como un almacén de seguimiento de aplicaciones de Service Fabric | Documentos de Microsoft"
description: "Describe cómo pueden utilizar las aplicaciones de Service Fabric toostore Elasticsearch y Kibana, índice y buscar a través de seguimientos de aplicaciones (registros)"
services: service-fabric
documentationcenter: .net
author: karolz-ms
manager: adegeo
editor: 
ms.assetid: e59b0c39-e468-4d9e-b453-d5f2a8ad20d8
ms.service: service-fabric
ms.devlang: dotNet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/07/2017
ms.author: karolz@microsoft.com
redirect_url: /azure/service-fabric/service-fabric-diagnostics-event-aggregation-eventflow
ms.openlocfilehash: b5977c54e69319e3caa376e44a02f971b66a3254
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="use-elasticsearch-as-a-service-fabric-application-trace-store"></a><span data-ttu-id="867b1-103">Uso de ElasticSearch como almacén de seguimientos de aplicaciones de Service Fabric</span><span class="sxs-lookup"><span data-stu-id="867b1-103">Use Elasticsearch as a Service Fabric application trace store</span></span>
## <a name="introduction"></a><span data-ttu-id="867b1-104">Introducción</span><span class="sxs-lookup"><span data-stu-id="867b1-104">Introduction</span></span>
<span data-ttu-id="867b1-105">En este artículo se describe cómo las aplicaciones de [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) pueden usar **ElasticSearch** y **Kibana** para el almacenamiento, la indexación y la búsqueda de seguimientos de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="867b1-105">This article describes how [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) applications can use **Elasticsearch** and **Kibana** for application trace storage, indexing, and search.</span></span> <span data-ttu-id="867b1-106">[ElasticSearch](https://www.elastic.co/guide/index.html) es un motor de búsqueda y análisis de código abierto, distribuido, escalable y en tiempo real que resulta adecuado para esta tarea.</span><span class="sxs-lookup"><span data-stu-id="867b1-106">[Elasticsearch](https://www.elastic.co/guide/index.html) is an open-source, distributed, and scalable real-time search and analytics engine that is well-suited for this task.</span></span> <span data-ttu-id="867b1-107">Se puede instalar en máquinas virtuales de Windows o Linux que se ejecutan en Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="867b1-107">It can be installed on Windows and Linux virtual machines running in Microsoft Azure.</span></span> <span data-ttu-id="867b1-108">Elasticsearch puede procesar de forma eficiente seguimientos *estructurados* producidos con tecnologías como **Seguimiento de eventos para Windows (ETW)**.</span><span class="sxs-lookup"><span data-stu-id="867b1-108">Elasticsearch can efficiently process *structured* traces produced using technologies such as **Event Tracing for Windows (ETW)**.</span></span>

<span data-ttu-id="867b1-109">ETW es utilizado por Service Fabric en tiempo de ejecución toosource información de diagnóstico (seguimientos).</span><span class="sxs-lookup"><span data-stu-id="867b1-109">ETW is used by Service Fabric runtime toosource diagnostic information (traces).</span></span> <span data-ttu-id="867b1-110">Es Hola método recomendado para toosource de las aplicaciones de Service Fabric su información de diagnóstico, demasiado.</span><span class="sxs-lookup"><span data-stu-id="867b1-110">It is hello recommended method for Service Fabric applications toosource their diagnostic information, too.</span></span> <span data-ttu-id="867b1-111">Uso de hello permite el mismo mecanismo para la correlación entre los seguimientos proporcionado por el tiempo de ejecución y proporcionada por la aplicación y hace más fácil solucionar.</span><span class="sxs-lookup"><span data-stu-id="867b1-111">Using hello same mechanism allows for correlation between runtime-supplied and application-supplied traces and makes troubleshooting easier.</span></span> <span data-ttu-id="867b1-112">Plantillas de proyecto de Service Fabric en Visual Studio incluyen una API de registro (en función de hello .NET **EventSource** clase) que emite seguimientos de ETW de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="867b1-112">Service Fabric project templates in Visual Studio include a logging API (based on hello .NET **EventSource** class) that emits ETW traces by default.</span></span> <span data-ttu-id="867b1-113">Para una descripción general del seguimiento de aplicaciones de Service Fabric mediante ETW, consulte [Supervisión y diagnóstico de servicios en una configuración de desarrollo de máquina local](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).</span><span class="sxs-lookup"><span data-stu-id="867b1-113">For a general overview of Service Fabric application tracing using ETW, see [Monitoring and diagnosing services in a local machine development setup](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).</span></span>

<span data-ttu-id="867b1-114">Para seguimientos de hello tooshow seguridad en Elasticsearch, necesitan toobe capturados en los nodos del clúster de Service Fabric hello en tiempo real (mientras se ejecuta la aplicación hello) y envía el punto de conexión de tooan Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="867b1-114">For hello traces tooshow up in Elasticsearch, they need toobe captured at hello Service Fabric cluster nodes in real time (while hello application is running) and sent tooan Elasticsearch endpoint.</span></span> <span data-ttu-id="867b1-115">Hay dos opciones principales para la captura de seguimientos:</span><span class="sxs-lookup"><span data-stu-id="867b1-115">There are two major options for trace capturing:</span></span>

* <span data-ttu-id="867b1-116">**Captura de seguimientos en proceso**</span><span class="sxs-lookup"><span data-stu-id="867b1-116">**In-process trace capturing**</span></span>  
  <span data-ttu-id="867b1-117">aplicación Hello, o más concretamente, el proceso de servicio, es responsable de envío de almacén de seguimiento de toohello de datos de diagnóstico de hello (Elasticsearch).</span><span class="sxs-lookup"><span data-stu-id="867b1-117">hello application, or more precisely, service process, is responsible for sending out hello diagnostic data toohello trace store (Elasticsearch).</span></span>
* <span data-ttu-id="867b1-118">**Captura de seguimientos fuera de proceso**</span><span class="sxs-lookup"><span data-stu-id="867b1-118">**Out-of-process trace capturing**</span></span>  
  <span data-ttu-id="867b1-119">Un agente independiente es capturar seguimientos de los procesos de servicio de Hola y enviarlas después a almacén de seguimiento toohello.</span><span class="sxs-lookup"><span data-stu-id="867b1-119">A separate agent is capturing traces from hello service process or processes and sending them toohello trace store.</span></span>

<span data-ttu-id="867b1-120">A continuación, se describe cómo tratan de tooset seguridad Elasticsearch en Azure, los profesionales de TI de Hola e inconvenientes para las opciones de captura y explican cómo tooconfigure un tejido de servicio service toosend datos tooElasticsearch.</span><span class="sxs-lookup"><span data-stu-id="867b1-120">Below, we describe how tooset up Elasticsearch on Azure, discuss hello pros and cons for both capture options, and explain how tooconfigure a Service Fabric service toosend data tooElasticsearch.</span></span>

## <a name="set-up-elasticsearch-on-azure"></a><span data-ttu-id="867b1-121">Configuración de ElasticSearch en Azure</span><span class="sxs-lookup"><span data-stu-id="867b1-121">Set up Elasticsearch on Azure</span></span>
<span data-ttu-id="867b1-122">Hola tooset de manera más sencillo servicio de Elasticsearch de hello en Azure es a través de [ **plantillas de Azure Resource Manager**](../azure-resource-manager/resource-group-overview.md).</span><span class="sxs-lookup"><span data-stu-id="867b1-122">hello most straightforward way tooset up hello Elasticsearch service on Azure is through [**Azure Resource Manager templates**](../azure-resource-manager/resource-group-overview.md).</span></span> <span data-ttu-id="867b1-123">Hay disponible una [plantilla del Administrador de recursos de Azure de inicio rápido para ElasticSearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) en el repositorio de plantillas de inicio rápido de Azure.</span><span class="sxs-lookup"><span data-stu-id="867b1-123">A comprehensive [Quickstart Azure Resource Manager template for Elasticsearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) is available from Azure Quickstart templates repository.</span></span> <span data-ttu-id="867b1-124">Esta plantilla usa cuentas de almacenamiento independiente para unidades de escalado (grupos de nodos).</span><span class="sxs-lookup"><span data-stu-id="867b1-124">This template uses separate storage accounts for scale units (groups of nodes).</span></span> <span data-ttu-id="867b1-125">También puede aprovisionar nodos de cliente y de servidor independientes con distintas configuraciones y varios números de discos de datos adjuntos.</span><span class="sxs-lookup"><span data-stu-id="867b1-125">It can also provision separate client and server nodes with different configurations and various numbers of data disks attached.</span></span>

<span data-ttu-id="867b1-126">En este caso, usamos otra plantilla, llama a **ES multinodo** de hello [repositorio de herramientas de diagnóstico de Azure](https://github.com/Azure/azure-diagnostics-tools).</span><span class="sxs-lookup"><span data-stu-id="867b1-126">Here, we use another template, called **ES-MultiNode** from hello [Azure diagnostic tools repository](https://github.com/Azure/azure-diagnostics-tools).</span></span> <span data-ttu-id="867b1-127">Esta plantilla es más fácil toouse y crea un clúster de Elasticsearch protegido por la autenticación básica HTTP.</span><span class="sxs-lookup"><span data-stu-id="867b1-127">This template is easier toouse, and it creates an Elasticsearch cluster protected by HTTP basic authentication.</span></span> <span data-ttu-id="867b1-128">Antes de continuar, debe descargar repositorio Hola desde el equipo de tooyour de GitHub (de clonación de repositorio de Hola o descargar un archivo zip).</span><span class="sxs-lookup"><span data-stu-id="867b1-128">Before you proceed, download hello repository from GitHub tooyour machine (by either cloning hello repository or downloading a zip file).</span></span> <span data-ttu-id="867b1-129">plantilla de Hello ES multinodo se encuentra en la carpeta Hola con hello mismo nombre.</span><span class="sxs-lookup"><span data-stu-id="867b1-129">hello ES-MultiNode template is located in hello folder with hello same name.</span></span>

### <a name="prepare-a-machine-toorun-elasticsearch-installation-scripts"></a><span data-ttu-id="867b1-130">Preparar una máquina toorun Elasticsearch secuencias de comandos de instalación</span><span class="sxs-lookup"><span data-stu-id="867b1-130">Prepare a machine toorun Elasticsearch installation scripts</span></span>
<span data-ttu-id="867b1-131">Hello más fácil manera toouse hello ES multinodo plantilla es a través de un script de PowerShell de Azure proporcionado denominado `CreateElasticSearchCluster`.</span><span class="sxs-lookup"><span data-stu-id="867b1-131">hello easiest way toouse hello ES-MultiNode template is through a provided Azure PowerShell script called `CreateElasticSearchCluster`.</span></span> <span data-ttu-id="867b1-132">toouse este script, necesita tooinstall módulos de PowerShell y una herramienta denominada **openssl**.</span><span class="sxs-lookup"><span data-stu-id="867b1-132">toouse this script, you need tooinstall PowerShell modules and a tool called **openssl**.</span></span> <span data-ttu-id="867b1-133">Hola este último se necesita para crear una clave SSH que puede ser utilizado tooadminister su clúster Elasticsearch remotamente.</span><span class="sxs-lookup"><span data-stu-id="867b1-133">hello latter is needed for creating an SSH key that can be used tooadminister your Elasticsearch cluster remotely.</span></span>

<span data-ttu-id="867b1-134">`CreateElasticSearchCluster`secuencia de comandos está diseñado para facilitar su uso con plantilla hello ES multinodo desde un equipo Windows.</span><span class="sxs-lookup"><span data-stu-id="867b1-134">`CreateElasticSearchCluster` script is designed for ease of use with hello ES-MultiNode template from a Windows machine.</span></span> <span data-ttu-id="867b1-135">Es posible toouse Hola plantilla en una máquina distinta de Windows, pero esa situación es más allá del ámbito de Hola de este artículo.</span><span class="sxs-lookup"><span data-stu-id="867b1-135">It is possible toouse hello template on a non-Windows machine, but that scenario is beyond hello scope of this article.</span></span>

1. <span data-ttu-id="867b1-136">Si aún no lo hizo, instale los [**módulos de Azure PowerShell**](http://aka.ms/webpi-azps).</span><span class="sxs-lookup"><span data-stu-id="867b1-136">If you haven't installed them already, install [**Azure PowerShell modules**](http://aka.ms/webpi-azps).</span></span> <span data-ttu-id="867b1-137">Cuando se le pida, haga clic en **Ejecutar** y, después, en **Instalar**.</span><span class="sxs-lookup"><span data-stu-id="867b1-137">When prompted, click **Run**, then **Install**.</span></span> <span data-ttu-id="867b1-138">Se requiere Azure PowerShell 1.3 o posterior.</span><span class="sxs-lookup"><span data-stu-id="867b1-138">Azure PowerShell 1.3 or newer is required.</span></span>
2. <span data-ttu-id="867b1-139">Hola **openssl** herramienta se incluye en la distribución de Hola de [ **Git para Windows**](http://www.git-scm.com/downloads).</span><span class="sxs-lookup"><span data-stu-id="867b1-139">hello **openssl** tool is included in hello distribution of [**Git for Windows**](http://www.git-scm.com/downloads).</span></span> <span data-ttu-id="867b1-140">Si aún no lo hizo, instale [Git para Windows](http://www.git-scm.com/downloads) ahora.</span><span class="sxs-lookup"><span data-stu-id="867b1-140">If you have not done so already, install [Git for Windows](http://www.git-scm.com/downloads) now.</span></span> <span data-ttu-id="867b1-141">(opciones de instalación predeterminadas de hello son correctos.)</span><span class="sxs-lookup"><span data-stu-id="867b1-141">(hello default installation options are OK.)</span></span>
3. <span data-ttu-id="867b1-142">Suponiendo que se ha instalado pero no se incluye en la ruta de acceso de sistema de hello Git, abra una ventana de Microsoft Azure PowerShell y ejecute hello siguientes comandos:</span><span class="sxs-lookup"><span data-stu-id="867b1-142">Assuming that Git has been installed but not included in hello system path, open a Microsoft Azure PowerShell window and run hello following commands:</span></span>
   
    ```powershell
    $ENV:PATH += ";<Git installation folder>\usr\bin"
    $ENV:OPENSSL_CONF = "<Git installation folder>\usr\ssl\openssl.cnf"
    ```
   
    <span data-ttu-id="867b1-143">Reemplace hello `<Git installation folder>` con la ubicación de Git de hello en el equipo; valor predeterminado de hello es **"C:\Program Files\Git"**.</span><span class="sxs-lookup"><span data-stu-id="867b1-143">Replace hello `<Git installation folder>` with hello Git location on your machine; hello default is **"C:\Program Files\Git"**.</span></span> <span data-ttu-id="867b1-144">Tenga en cuenta carácter de punto y coma de hello en a partir de la primera ruta de acceso de Hola Hola.</span><span class="sxs-lookup"><span data-stu-id="867b1-144">Note hello semicolon character at hello beginning of hello first path.</span></span>
4. <span data-ttu-id="867b1-145">Asegúrese de que ha iniciado sesión tooAzure (a través de [ `Add-AzureRmAccount` ](https://msdn.microsoft.com/library/mt619267.aspx) cmdlet) y que ha seleccionado la suscripción de Hola que se debe usa toocreate el clúster de búsqueda elástico.</span><span class="sxs-lookup"><span data-stu-id="867b1-145">Ensure that you are logged on tooAzure (via [`Add-AzureRmAccount`](https://msdn.microsoft.com/library/mt619267.aspx) cmdlet) and that you have selected hello subscription that should be used toocreate your Elastic Search cluster.</span></span> <span data-ttu-id="867b1-146">Puede comprobar que se ha seleccionado la suscripción correcta utilizando los cmdlets `Get-AzureRmContext` y `Get-AzureRmSubscription`.</span><span class="sxs-lookup"><span data-stu-id="867b1-146">You can verify that correct subscription is selected using `Get-AzureRmContext` and `Get-AzureRmSubscription` cmdlets.</span></span>
5. <span data-ttu-id="867b1-147">Si aún no lo ha hecho lo ha hecho, cambie la carpeta de toohello multinodo ES de directorio actual de Hola.</span><span class="sxs-lookup"><span data-stu-id="867b1-147">If you haven't done so already, change hello current directory toohello ES-MultiNode folder.</span></span>

### <a name="run-hello-createelasticsearchcluster-script"></a><span data-ttu-id="867b1-148">Ejecutar script de Hola CreateElasticSearchCluster</span><span class="sxs-lookup"><span data-stu-id="867b1-148">Run hello CreateElasticSearchCluster script</span></span>
<span data-ttu-id="867b1-149">Antes de ejecutar script de Hola, abra hello `azuredeploy-parameters.json` de archivos y comprobar o proporcionar valores para parámetros de script de Hola.</span><span class="sxs-lookup"><span data-stu-id="867b1-149">Before you run hello script, open hello `azuredeploy-parameters.json` file and verify or provide values for hello script parameters.</span></span> <span data-ttu-id="867b1-150">se proporciona Hola parámetros siguientes:</span><span class="sxs-lookup"><span data-stu-id="867b1-150">hello following parameters are provided:</span></span>

| <span data-ttu-id="867b1-151">Nombre de parámetro</span><span class="sxs-lookup"><span data-stu-id="867b1-151">Parameter Name</span></span> | <span data-ttu-id="867b1-152">Description</span><span class="sxs-lookup"><span data-stu-id="867b1-152">Description</span></span> |
| --- | --- |
| <span data-ttu-id="867b1-153">dnsNameForLoadBalancerIP</span><span class="sxs-lookup"><span data-stu-id="867b1-153">dnsNameForLoadBalancerIP</span></span> |<span data-ttu-id="867b1-154">Hola nombre toocreate usado Hola sean visibles públicamente DNS para clúster de búsqueda elástico hello (anexando el nombre de toohello proporcionado de dominio de región de Azure de hello).</span><span class="sxs-lookup"><span data-stu-id="867b1-154">hello name that is used toocreate hello publicly visible DNS name for hello Elastic Search cluster (by appending hello Azure region domain toohello provided name).</span></span> <span data-ttu-id="867b1-155">Por ejemplo, si este valor de parámetro es "myBigCluster" y región de Azure Hola elegido es oeste de Estados Unidos, nombre DNS resultante de hello para el clúster de hello es myBigCluster.westus.cloudapp.azure.com.</span><span class="sxs-lookup"><span data-stu-id="867b1-155">For example, if this parameter value is "myBigCluster" and hello chosen Azure region is West US, hello resulting DNS name for hello cluster is myBigCluster.westus.cloudapp.azure.com.</span></span> <br /><br /><span data-ttu-id="867b1-156">Este nombre también actúa como un nombre de raíz para muchos artefactos asociados a clúster de búsqueda flexible de hello, como nombres de nodo de datos.</span><span class="sxs-lookup"><span data-stu-id="867b1-156">This name also serves as a root name for many artifacts associated with hello Elastic Search cluster, such as data node names.</span></span> |
| <span data-ttu-id="867b1-157">adminUsername</span><span class="sxs-lookup"><span data-stu-id="867b1-157">adminUsername</span></span> |<span data-ttu-id="867b1-158">nombre de Hola de cuenta de administrador de hello para la administración de clúster de búsqueda elástico hello (claves SSH correspondientes se generan automáticamente).</span><span class="sxs-lookup"><span data-stu-id="867b1-158">hello name of hello administrator account for managing hello Elastic Search cluster (corresponding SSH keys are generated automatically).</span></span> |
| <span data-ttu-id="867b1-159">dataNodeCount</span><span class="sxs-lookup"><span data-stu-id="867b1-159">dataNodeCount</span></span> |<span data-ttu-id="867b1-160">número de Hola de nodos de clúster de búsqueda elástico Hola.</span><span class="sxs-lookup"><span data-stu-id="867b1-160">hello number of nodes in hello Elastic Search cluster.</span></span> <span data-ttu-id="867b1-161">versión actual de Hola de script de Hola no distingue entre los nodos de datos y la consulta; todos los nodos desempeñan ambos roles.</span><span class="sxs-lookup"><span data-stu-id="867b1-161">hello current version of hello script does not distinguish between data and query nodes; all nodes play both roles.</span></span> <span data-ttu-id="867b1-162">Nodos de too3 los valores predeterminados.</span><span class="sxs-lookup"><span data-stu-id="867b1-162">Defaults too3 nodes.</span></span> |
| <span data-ttu-id="867b1-163">dataDiskSize</span><span class="sxs-lookup"><span data-stu-id="867b1-163">dataDiskSize</span></span> |<span data-ttu-id="867b1-164">tamaño de Hola de los discos de datos (en GB) que se asigna a cada nodo de datos.</span><span class="sxs-lookup"><span data-stu-id="867b1-164">hello size of data disks (in GB) that is allocated for each data node.</span></span> <span data-ttu-id="867b1-165">Cada nodo recibe 4 discos de datos, exclusivamente dedicado tooElastic de servicio de búsqueda.</span><span class="sxs-lookup"><span data-stu-id="867b1-165">Each node receives 4 data disks, exclusively dedicated tooElastic Search service.</span></span> |
| <span data-ttu-id="867b1-166">region</span><span class="sxs-lookup"><span data-stu-id="867b1-166">region</span></span> |<span data-ttu-id="867b1-167">nombre de Hola de región de Azure donde debe estar ubicado del clúster de búsqueda elástico Hola.</span><span class="sxs-lookup"><span data-stu-id="867b1-167">hello name of Azure region where hello Elastic Search cluster should be located.</span></span> |
| <span data-ttu-id="867b1-168">esUserName</span><span class="sxs-lookup"><span data-stu-id="867b1-168">esUserName</span></span> |<span data-ttu-id="867b1-169">Hello nombre de usuario del usuario de Hola que esté había configurado toohave acceso tooES clúster (asunto tooHTTP la autenticación básica).</span><span class="sxs-lookup"><span data-stu-id="867b1-169">hello user name of hello user that is configured toohave access tooES cluster (subject tooHTTP basic authentication).</span></span> <span data-ttu-id="867b1-170">Hello contraseña no forma parte del archivo de parámetros y debe proporcionarse al `CreateElasticSearchCluster` script es invocado.</span><span class="sxs-lookup"><span data-stu-id="867b1-170">hello password is not part of parameters file and must be provided when `CreateElasticSearchCluster` script is invoked.</span></span> |
| <span data-ttu-id="867b1-171">vmSizeDataNodes</span><span class="sxs-lookup"><span data-stu-id="867b1-171">vmSizeDataNodes</span></span> |<span data-ttu-id="867b1-172">Hola tamaño de máquina virtual de Azure para nodos de clúster de búsqueda elástico.</span><span class="sxs-lookup"><span data-stu-id="867b1-172">hello Azure virtual machine size for Elastic Search cluster nodes.</span></span> <span data-ttu-id="867b1-173">TooStandard_D2 de valores predeterminados.</span><span class="sxs-lookup"><span data-stu-id="867b1-173">Defaults tooStandard_D2.</span></span> |

<span data-ttu-id="867b1-174">Ahora está listo toorun script de Hola.</span><span class="sxs-lookup"><span data-stu-id="867b1-174">Now you are ready toorun hello script.</span></span> <span data-ttu-id="867b1-175">Emita el siguiente comando de hello:</span><span class="sxs-lookup"><span data-stu-id="867b1-175">Issue hello following command:</span></span>

```powershell
CreateElasticSearchCluster -ResourceGroupName <es-group-name> -Region <azure-region> -EsPassword <es-password>
```

<span data-ttu-id="867b1-176">donde</span><span class="sxs-lookup"><span data-stu-id="867b1-176">where</span></span> 

| <span data-ttu-id="867b1-177">Nombre del parámetro de script</span><span class="sxs-lookup"><span data-stu-id="867b1-177">Script Parameter Name</span></span> | <span data-ttu-id="867b1-178">Descripción</span><span class="sxs-lookup"><span data-stu-id="867b1-178">Description</span></span> |
| --- | --- |
| `<es-group-name>` |<span data-ttu-id="867b1-179">nombre de Hola Hola Azure del grupo de recursos que contendrá todos los recursos de clúster de búsqueda elástico.</span><span class="sxs-lookup"><span data-stu-id="867b1-179">hello name of hello Azure resource group that will contain all Elastic Search cluster resources.</span></span> |
| `<azure-region>` |<span data-ttu-id="867b1-180">nombre de Hola de hello región de Azure donde se debe crear el clúster de búsqueda elástico Hola.</span><span class="sxs-lookup"><span data-stu-id="867b1-180">hello name of hello Azure region where hello Elastic Search cluster should be created.</span></span> |
| `<es-password>` |<span data-ttu-id="867b1-181">contraseña de Hello para el usuario de búsqueda elástico Hola.</span><span class="sxs-lookup"><span data-stu-id="867b1-181">hello password for hello Elastic Search user.</span></span> |

> [!NOTE]
> <span data-ttu-id="867b1-182">Si recibe una excepción NullReferenceException del cmdlet de hello AzureResourceGroup de prueba, ha olvidado toolog en tooAzure (`Add-AzureRmAccount`).</span><span class="sxs-lookup"><span data-stu-id="867b1-182">If you get a NullReferenceException from hello Test-AzureResourceGroup cmdlet, you have forgotten toolog on tooAzure (`Add-AzureRmAccount`).</span></span>
> 
> 

<span data-ttu-id="867b1-183">Si se produce un error de ejecución de script de Hola y determina que el error de hello fue causado por un valor de parámetro de plantilla incorrecta, corrija el archivo de parámetros de Hola y vuelva a ejecutar el script de Hola con un nombre de grupo de recursos distinto.</span><span class="sxs-lookup"><span data-stu-id="867b1-183">If you get an error from running hello script and you determine that hello error was caused by a wrong template parameter value, correct hello parameter file and run hello script again with a different resource group name.</span></span> <span data-ttu-id="867b1-184">También puede volver a usar Hola el mismo nombre de grupo de recursos y tiene un script de Hola Hola antiguo de limpieza mediante la adición de hello `-RemoveExistingResourceGroup` invocación del parámetro toohello secuencia de comandos.</span><span class="sxs-lookup"><span data-stu-id="867b1-184">You can also reuse hello same resource group name and have hello script clean up hello old one by adding hello `-RemoveExistingResourceGroup` parameter toohello script invocation.</span></span>

### <a name="result-of-running-hello-createelasticsearchcluster-script"></a><span data-ttu-id="867b1-185">Resultado de la ejecución de secuencias de comandos de hello CreateElasticSearchCluster</span><span class="sxs-lookup"><span data-stu-id="867b1-185">Result of running hello CreateElasticSearchCluster script</span></span>
<span data-ttu-id="867b1-186">Después de ejecutar hello `CreateElasticSearchCluster` secuencia de comandos, se creará Hola siguientes artefactos principales.</span><span class="sxs-lookup"><span data-stu-id="867b1-186">After you run hello `CreateElasticSearchCluster` script, hello following main artifacts will be created.</span></span> <span data-ttu-id="867b1-187">En este ejemplo se supone que ha usado "myBigCluster" como valor de Hola de hello `dnsNameForLoadBalancerIP` parámetro y esa región Hola donde se ha creado el clúster de hello es oeste de Estados Unidos.</span><span class="sxs-lookup"><span data-stu-id="867b1-187">For this example we assume that you have used "myBigCluster" as hello value of hello `dnsNameForLoadBalancerIP` parameter and that hello region where you created hello cluster is West US.</span></span>

| <span data-ttu-id="867b1-188">Artefacto</span><span class="sxs-lookup"><span data-stu-id="867b1-188">Artifact</span></span> | <span data-ttu-id="867b1-189">Nombre, ubicación y comentarios</span><span class="sxs-lookup"><span data-stu-id="867b1-189">Name, location, and remarks</span></span> |
| --- | --- |
| <span data-ttu-id="867b1-190">Clave SSH para administración remota</span><span class="sxs-lookup"><span data-stu-id="867b1-190">SSH key for remote administration</span></span> |<span data-ttu-id="867b1-191">archivo de myBigCluster.key (en el directorio de Hola desde qué Hola se ejecutó CreateElasticSearchCluster).</span><span class="sxs-lookup"><span data-stu-id="867b1-191">myBigCluster.key file (in hello directory from which hello CreateElasticSearchCluster was run).</span></span> <br /><br /><span data-ttu-id="867b1-192">Este archivo de clave puede ser el nodo de administración de toohello tooconnect usado y (a través del nodo de administración de hello) toodata nodos de clúster de Hola.</span><span class="sxs-lookup"><span data-stu-id="867b1-192">This key file can be used tooconnect toohello admin node and (through hello admin node) toodata nodes in hello cluster.</span></span> |
| <span data-ttu-id="867b1-193">Nodo de administración</span><span class="sxs-lookup"><span data-stu-id="867b1-193">Admin node</span></span> |<span data-ttu-id="867b1-194">myBigCluster-admin.westus.cloudapp.azure.com </span><span class="sxs-lookup"><span data-stu-id="867b1-194">myBigCluster-admin.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="867b1-195">Una máquina virtual dedicada para la administración remota de clúster Elasticsearch: Hola solo una que permite conexiones externas de SSH.</span><span class="sxs-lookup"><span data-stu-id="867b1-195">A dedicated VM for remote Elasticsearch cluster administration--hello only one that allows external SSH connections.</span></span> <span data-ttu-id="867b1-196">Se ejecuta en hello mismo redes virtuales como todos los nodos del clúster hello Elasticsearch, pero no ejecutar ningún servicio de Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="867b1-196">It runs on hello same virtual network as all hello Elasticsearch cluster nodes, but it does not run any Elasticsearch services.</span></span> |
| <span data-ttu-id="867b1-197">Nodos de datos</span><span class="sxs-lookup"><span data-stu-id="867b1-197">Data nodes</span></span> |<span data-ttu-id="867b1-198">myBigCluster1 …</span><span class="sxs-lookup"><span data-stu-id="867b1-198">myBigCluster1 …</span></span> <span data-ttu-id="867b1-199">myBigCluster*N*</span><span class="sxs-lookup"><span data-stu-id="867b1-199">myBigCluster*N*</span></span> <br /><br /><span data-ttu-id="867b1-200">Nodos de datos que ejecutan servicios Elasticsearch y Kibana.</span><span class="sxs-lookup"><span data-stu-id="867b1-200">Data nodes that are running Elasticsearch and Kibana services.</span></span> <span data-ttu-id="867b1-201">Puede conectarse a través de SSH tooeach nodo, pero solo a través del nodo de administración de Hola.</span><span class="sxs-lookup"><span data-stu-id="867b1-201">You can connect via SSH tooeach node, but only via hello admin node.</span></span> |
| <span data-ttu-id="867b1-202">Clúster Elasticsearch</span><span class="sxs-lookup"><span data-stu-id="867b1-202">Elasticsearch cluster</span></span> |<span data-ttu-id="867b1-203">http://myBigCluster.westus.cloudapp.azure.com/es/</span><span class="sxs-lookup"><span data-stu-id="867b1-203">http://myBigCluster.westus.cloudapp.azure.com/es/</span></span> <br /><br /><span data-ttu-id="867b1-204">Hola extremo principal de clúster de hello Elasticsearch (sufijo de nota Hola/es).</span><span class="sxs-lookup"><span data-stu-id="867b1-204">hello primary endpoint for hello Elasticsearch cluster (note hello /es suffix).</span></span> <span data-ttu-id="867b1-205">Está protegido por la autenticación básica HTTP (credenciales de hello eran Hola especificado esUserName/esPassword parámetros de plantilla de hello ES multinodo).</span><span class="sxs-lookup"><span data-stu-id="867b1-205">It is protected by basic HTTP authentication (hello credentials were hello specified esUserName/esPassword parameters of hello ES-MultiNode template).</span></span> <span data-ttu-id="867b1-206">clúster de Hello también tiene Hola head complemento instalado (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) para la administración de clúster básico.</span><span class="sxs-lookup"><span data-stu-id="867b1-206">hello cluster has also hello head plug-in installed (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) for basic cluster administration.</span></span> |
| <span data-ttu-id="867b1-207">Servicio Kibana</span><span class="sxs-lookup"><span data-stu-id="867b1-207">Kibana service</span></span> |<span data-ttu-id="867b1-208">http://myBigCluster.westus.cloudapp.azure.com</span><span class="sxs-lookup"><span data-stu-id="867b1-208">http://myBigCluster.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="867b1-209">Hola Kibana servicio se configura tooshow datos de hello creado clúster Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="867b1-209">hello Kibana service is set up tooshow data from hello created Elasticsearch cluster.</span></span> <span data-ttu-id="867b1-210">Está protegida por hello mismas credenciales de autenticación Hola propio clúster.</span><span class="sxs-lookup"><span data-stu-id="867b1-210">It is protected by hello same authentication credentials as hello cluster itself.</span></span> |

## <a name="in-process-versus-out-of-process-trace-capturing"></a><span data-ttu-id="867b1-211">Captura de seguimientos en proceso frente a fuera de proceso</span><span class="sxs-lookup"><span data-stu-id="867b1-211">In-process versus out-of-process trace capturing</span></span>
<span data-ttu-id="867b1-212">En la introducción de hello, mencionamos que dos aspectos fundamentales de recopilar datos de diagnóstico: en proceso y fuera de proceso.</span><span class="sxs-lookup"><span data-stu-id="867b1-212">In hello introduction, we mentioned two fundamental ways of collecting diagnostic data: in-process and out-of-process.</span></span> <span data-ttu-id="867b1-213">Cada una tiene sus ventajas y desventajas.</span><span class="sxs-lookup"><span data-stu-id="867b1-213">Each has strengths and weaknesses.</span></span>

<span data-ttu-id="867b1-214">Ventajas del programa Hola a **capturar el seguimiento en proceso** incluyen:</span><span class="sxs-lookup"><span data-stu-id="867b1-214">Advantages of hello **in-process trace capturing** include:</span></span>

1. <span data-ttu-id="867b1-215">*Fácil configuración e implementación*</span><span class="sxs-lookup"><span data-stu-id="867b1-215">*Easy configuration and deployment*</span></span>
   
   * <span data-ttu-id="867b1-216">configuración de Hola de recopilación de datos de diagnóstico es parte de la configuración de la aplicación hello.</span><span class="sxs-lookup"><span data-stu-id="867b1-216">hello configuration of diagnostic data collection is just part of hello application configuration.</span></span> <span data-ttu-id="867b1-217">Es mantener tooalways fácil que "sincronizados" con hello resto de la aplicación hello.</span><span class="sxs-lookup"><span data-stu-id="867b1-217">It is easy tooalways keep it "in sync" with hello rest of hello application.</span></span>
   * <span data-ttu-id="867b1-218">Se puede realizar fácilmente la configuración por aplicación o por servicio.</span><span class="sxs-lookup"><span data-stu-id="867b1-218">Per-application or per-service configuration is easily achievable.</span></span>
   * <span data-ttu-id="867b1-219">Capturar el seguimiento de fuera de proceso, normalmente requiere una implementación independiente y la configuración del agente de diagnóstico de hello, que es una tarea administrativa adicional y un origen potencial de errores.</span><span class="sxs-lookup"><span data-stu-id="867b1-219">Out-of-process trace capturing usually requires a separate deployment and configuration of hello diagnostic agent, which is an extra administrative task and a potential source of errors.</span></span> <span data-ttu-id="867b1-220">tecnología de agente en particular de Hola a menudo permite solo una instancia de agente de Hola por máquina virtual (nodo).</span><span class="sxs-lookup"><span data-stu-id="867b1-220">hello particular agent technology often allows only one instance of hello agent per virtual machine (node).</span></span> <span data-ttu-id="867b1-221">Esto significa que la configuración de colección de hello de la configuración de diagnóstico Hola se comparte entre todas las aplicaciones y servicios que se ejecutan en ese nodo.</span><span class="sxs-lookup"><span data-stu-id="867b1-221">This means that configuration for hello collection of hello diagnostic configuration is shared among all applications and services running on that node.</span></span>
2. <span data-ttu-id="867b1-222">*Flexibilidad*</span><span class="sxs-lookup"><span data-stu-id="867b1-222">*Flexibility*</span></span>
   
   * <span data-ttu-id="867b1-223">aplicación Hello puede enviar datos de hello dondequiera que necesita toogo, siempre que hay una biblioteca de cliente que admite el sistema de almacenamiento de datos de Hola de destino.</span><span class="sxs-lookup"><span data-stu-id="867b1-223">hello application can send hello data wherever it needs toogo, as long as there is a client library that supports hello targeted data storage system.</span></span> <span data-ttu-id="867b1-224">Se pueden agregar tantos receptores nuevos como se desee.</span><span class="sxs-lookup"><span data-stu-id="867b1-224">New sinks can be added as desired.</span></span>
   * <span data-ttu-id="867b1-225">Se pueden implementar reglas complejas de captura, filtrado y agregación de datos.</span><span class="sxs-lookup"><span data-stu-id="867b1-225">Complex capture, filtering, and data-aggregation rules can be implemented.</span></span>
   * <span data-ttu-id="867b1-226">Un seguimiento de fuera de proceso de captura a menudo está limitado por los receptores de datos de Hola que admite el agente de Hola.</span><span class="sxs-lookup"><span data-stu-id="867b1-226">An out-of-process trace capturing is often limited by hello data sinks that hello agent supports.</span></span> <span data-ttu-id="867b1-227">Algunos agentes se pueden ampliar.</span><span class="sxs-lookup"><span data-stu-id="867b1-227">Some agents are extensible.</span></span>
3. <span data-ttu-id="867b1-228">*Contexto y obtener acceso a datos de aplicación de toointernal*</span><span class="sxs-lookup"><span data-stu-id="867b1-228">*Access toointernal application data and context*</span></span>
   
   * <span data-ttu-id="867b1-229">subsistema de diagnóstico de Hello ejecuta en proceso de aplicación o un servicio de hello puede ampliar fácilmente la seguimientos de hello junto con información contextual.</span><span class="sxs-lookup"><span data-stu-id="867b1-229">hello diagnostic subsystem running inside hello application/service process can easily augment hello traces with contextual information.</span></span>
   * <span data-ttu-id="867b1-230">En el enfoque de fuera de proceso de hello, Hola se deben enviar datos tooan agente a través de algún mecanismo de comunicación entre procesos, como el seguimiento de eventos para Windows.</span><span class="sxs-lookup"><span data-stu-id="867b1-230">In hello out-of-process approach, hello data must be sent tooan agent via some inter-process communication mechanism, such as Event Tracing for Windows.</span></span> <span data-ttu-id="867b1-231">Este mecanismo podría imponer limitaciones adicionales.</span><span class="sxs-lookup"><span data-stu-id="867b1-231">This mechanism could impose additional limitations.</span></span>

<span data-ttu-id="867b1-232">Ventajas del programa Hola a **seguimiento fuera de proceso de captura** incluyen:</span><span class="sxs-lookup"><span data-stu-id="867b1-232">Advantages of hello **out-of-process trace capturing** include:</span></span>

1. <span data-ttu-id="867b1-233">*Hola capacidad toomonitor Hola aplicación y recopilar volcados de memoria*</span><span class="sxs-lookup"><span data-stu-id="867b1-233">*hello ability toomonitor hello application and collect crash dumps*</span></span>
   
   * <span data-ttu-id="867b1-234">Captura de seguimiento en curso pueden fallar si se produce un error toostart de aplicación hello o se bloquea.</span><span class="sxs-lookup"><span data-stu-id="867b1-234">In-process trace capturing may be unsuccessful if hello application fails toostart or crashes.</span></span> <span data-ttu-id="867b1-235">Un agente independiente tiene muchas más probabilidades de capturar información crucial de solución de problemas.</span><span class="sxs-lookup"><span data-stu-id="867b1-235">An independent agent has a much better chance of capturing crucial troubleshooting information.</span></span><br /><br />
2. <span data-ttu-id="867b1-236">*Madurez, solidez y rendimiento probado*</span><span class="sxs-lookup"><span data-stu-id="867b1-236">*Maturity, robustness, and proven performance*</span></span>
   
   * <span data-ttu-id="867b1-237">Un agente desarrollado por un proveedor de la plataforma (por ejemplo, un agente de Microsoft Azure Diagnostics) ha estado sujeto toorigorous pruebas y la protección de batalla.</span><span class="sxs-lookup"><span data-stu-id="867b1-237">An agent developed by a platform vendor (such as a Microsoft Azure Diagnostics agent) has been subject toorigorous testing and battle-hardening.</span></span>
   * <span data-ttu-id="867b1-238">Con seguimiento de en proceso de captura, se debe tener cuidado tooensure que actividad hello de enviar los datos de diagnóstico desde un proceso de aplicación no interferir con las tareas principales de la aplicación hello ni presentar problemas de rendimiento o de tiempo.</span><span class="sxs-lookup"><span data-stu-id="867b1-238">With in-process trace capturing, care must be taken tooensure that hello activity of sending diagnostic data from an application process does not interfere with hello application's main tasks or introduce timing or performance problems.</span></span> <span data-ttu-id="867b1-239">Un agente de ejecución de forma independiente es menos propensas a problemas de toothese y está específicamente diseñado toolimit su impacto en el sistema de Hola.</span><span class="sxs-lookup"><span data-stu-id="867b1-239">An independently running agent is less prone toothese issues and is specifically designed toolimit its impact on hello system.</span></span>

<span data-ttu-id="867b1-240">Es posible toocombine y se benefician de ambos enfoques.</span><span class="sxs-lookup"><span data-stu-id="867b1-240">It is possible toocombine and benefit from both approaches.</span></span> <span data-ttu-id="867b1-241">De hecho, podría ser mejor solución Hola para muchas aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="867b1-241">Indeed, it might be hello best solution for many applications.</span></span>

<span data-ttu-id="867b1-242">Aquí usamos hello **Microsoft.Diagnostic.Listeners biblioteca** y seguimiento de hello en curso la captura de datos de toosend desde un clúster de Service Fabric aplicación tooan Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="867b1-242">Here, we use hello **Microsoft.Diagnostic.Listeners library** and hello in-process trace capturing toosend data from a Service Fabric application tooan Elasticsearch cluster.</span></span>

## <a name="use-hello-listeners-library-toosend-diagnostic-data-tooelasticsearch"></a><span data-ttu-id="867b1-243">Usar Hola agentes de escucha biblioteca toosend datos de diagnóstico tooElasticsearch</span><span class="sxs-lookup"><span data-stu-id="867b1-243">Use hello Listeners library toosend diagnostic data tooElasticsearch</span></span>
<span data-ttu-id="867b1-244">biblioteca de Microsoft.Diagnostic.Listeners Hello es parte de la aplicación de Service Fabric de ejemplo PartyCluster.</span><span class="sxs-lookup"><span data-stu-id="867b1-244">hello Microsoft.Diagnostic.Listeners library is part of PartyCluster sample Service Fabric application.</span></span> <span data-ttu-id="867b1-245">toouse:</span><span class="sxs-lookup"><span data-stu-id="867b1-245">toouse it:</span></span>

1. <span data-ttu-id="867b1-246">Descargar [muestra de Hola a PartyCluster](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) desde GitHub.</span><span class="sxs-lookup"><span data-stu-id="867b1-246">Download [hello PartyCluster sample](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) from GitHub.</span></span>
2. <span data-ttu-id="867b1-247">Copiar hello Microsoft.Diagnostics.Listeners y Microsoft.Diagnostics.Listeners.Fabric proyectos (carpetas enteras) desde carpeta hello PartyCluster ejemplo directory toohello solución de aplicación Hola que se supone toosend Hola datos tooElasticsearch .</span><span class="sxs-lookup"><span data-stu-id="867b1-247">Copy hello Microsoft.Diagnostics.Listeners and Microsoft.Diagnostics.Listeners.Fabric projects (whole folders) from hello PartyCluster sample directory toohello solution folder of hello application that is supposed toosend hello data tooElasticsearch.</span></span>
3. <span data-ttu-id="867b1-248">Abra la solución de destino de Hola, haga clic en el nodo de la solución de Hola Hola el Explorador de soluciones y elija **Agregar proyecto existente**.</span><span class="sxs-lookup"><span data-stu-id="867b1-248">Open hello target solution, right-click hello solution node in hello Solution Explorer, and choose **Add Existing Project**.</span></span> <span data-ttu-id="867b1-249">Agregar hello Microsoft.Diagnostics.Listeners proyecto toohello solución.</span><span class="sxs-lookup"><span data-stu-id="867b1-249">Add hello Microsoft.Diagnostics.Listeners project toohello solution.</span></span> <span data-ttu-id="867b1-250">Repita Hola igual para proyectos de Microsoft.Diagnostics.Listeners.Fabric Hola.</span><span class="sxs-lookup"><span data-stu-id="867b1-250">Repeat hello same for hello Microsoft.Diagnostics.Listeners.Fabric project.</span></span>
4. <span data-ttu-id="867b1-251">Agregar una referencia de proyecto de sus proyectos toohello dos agregado proyectos de servicio.</span><span class="sxs-lookup"><span data-stu-id="867b1-251">Add a project reference from your service project(s) toohello two added projects.</span></span> <span data-ttu-id="867b1-252">(Cada servicio que se supone toosend datos tooElasticsearch debe hacer referencia a Microsoft.Diagnostics.EventListeners y Microsoft.Diagnostics.EventListeners.Fabric).</span><span class="sxs-lookup"><span data-stu-id="867b1-252">(Each service that is supposed toosend data tooElasticsearch should reference Microsoft.Diagnostics.EventListeners and Microsoft.Diagnostics.EventListeners.Fabric).</span></span>
   
    ![Proyecto hace referencia a bibliotecas de Microsoft.Diagnostics.EventListeners.Fabric y tooMicrosoft.Diagnostics.EventListeners][1]

### <a name="service-fabric-general-availability-release-and-microsoftdiagnosticstracing-nuget-package"></a><span data-ttu-id="867b1-254">Versión de disponibilidad general de Service Fabric y paquete NuGet Microsoft.Diagnostics.Tracing</span><span class="sxs-lookup"><span data-stu-id="867b1-254">Service Fabric General Availability release and Microsoft.Diagnostics.Tracing Nuget package</span></span>
<span data-ttu-id="867b1-255">Las aplicaciones creadas con la versión de disponibilidad general de Service Fabric (2.0.135, publicada el 31 de marzo de 2016) están destinadas a **.NET Framework 4.5.2**.</span><span class="sxs-lookup"><span data-stu-id="867b1-255">Applications built with Service Fabric General Availability release (2.0.135, released March 31, 2016) target **.NET Framework 4.5.2**.</span></span> <span data-ttu-id="867b1-256">Esta versión es hello más alto de .NET Framework compatible con Azure en tiempo de Hola de versión de GA Hola Hola.</span><span class="sxs-lookup"><span data-stu-id="867b1-256">This version is hello highest version of hello .NET Framework supported by Azure at hello time of hello GA release.</span></span> <span data-ttu-id="867b1-257">Por desgracia, esta versión de framework Hola carece de ciertas APIs EventListener ese hello Microsoft.Diagnostics.Listeners biblioteca necesita.</span><span class="sxs-lookup"><span data-stu-id="867b1-257">Unfortunately, this version of hello framework lacks certain EventListener APIs that hello Microsoft.Diagnostics.Listeners library needs.</span></span> <span data-ttu-id="867b1-258">Porque se acoplan estrechamente EventSource (componente de Hola que constituye Hola base del registro de las API en aplicaciones de tejido de) y EventListener, cada proyecto que utilice la biblioteca de hello Microsoft.Diagnostics.Listeners debe usar una implementación alternativa de EventSource.</span><span class="sxs-lookup"><span data-stu-id="867b1-258">Because EventSource (hello component that forms hello basis of logging APIs in Fabric applications) and EventListener are tightly coupled, every project that uses hello Microsoft.Diagnostics.Listeners library must use an alternative implementation of EventSource.</span></span> <span data-ttu-id="867b1-259">Esta implementación se proporciona por hello **paquete Microsoft.Diagnostics.Tracing Nuget**, creado por Microsoft.</span><span class="sxs-lookup"><span data-stu-id="867b1-259">This implementation is provided by hello **Microsoft.Diagnostics.Tracing Nuget package**, authored by Microsoft.</span></span> <span data-ttu-id="867b1-260">paquete de Hello es totalmente compatible con versiones anteriores con EventSource incluida en framework de hello, por lo que no hay cambios en el código deberían ser necesarios que no sea de cambios de espacio de nombres que se hace referencia.</span><span class="sxs-lookup"><span data-stu-id="867b1-260">hello package is fully backward-compatible with EventSource included in hello framework, so no code changes should be necessary other than referenced namespace changes.</span></span>

<span data-ttu-id="867b1-261">toostart con hello Microsoft.Diagnostics.Tracing implementación de hello EventSource (clase), siga estos pasos para cada proyecto de servicio que necesita toosend datos tooElasticsearch:</span><span class="sxs-lookup"><span data-stu-id="867b1-261">toostart using hello Microsoft.Diagnostics.Tracing implementation of hello EventSource class, follow these steps for each service project that needs toosend data tooElasticsearch:</span></span>

1. <span data-ttu-id="867b1-262">Haga doble clic en el proyecto de servicio de Hola y elija **administrar paquetes de Nuget**.</span><span class="sxs-lookup"><span data-stu-id="867b1-262">Right-click on hello service project and choose **Manage Nuget Packages**.</span></span>
2. <span data-ttu-id="867b1-263">Cambiar el origen del paquete toohello nuget.org (si no está ya seleccionada) y busque "**Microsoft.Diagnostics.Tracing**".</span><span class="sxs-lookup"><span data-stu-id="867b1-263">Switch toohello nuget.org package source (if it is not already selected) and search for "**Microsoft.Diagnostics.Tracing**".</span></span>
3. <span data-ttu-id="867b1-264">Instalar hello `Microsoft.Diagnostics.Tracing.EventSource` paquete (y sus dependencias).</span><span class="sxs-lookup"><span data-stu-id="867b1-264">Install hello `Microsoft.Diagnostics.Tracing.EventSource` package (and its dependencies).</span></span>
4. <span data-ttu-id="867b1-265">Abra hello **ServiceEventSource.cs** o **ActorEventSource.cs** un archivo en el proyecto de servicio y reemplace hello `using System.Diagnostics.Tracing` directiva sobre archivo hello con hello `using Microsoft.Diagnostics.Tracing` directiva.</span><span class="sxs-lookup"><span data-stu-id="867b1-265">Open hello **ServiceEventSource.cs** or **ActorEventSource.cs** file in your service project and replace hello `using System.Diagnostics.Tracing` directive on top of hello file with hello `using Microsoft.Diagnostics.Tracing` directive.</span></span>

<span data-ttu-id="867b1-266">No será necesario realizar estos pasos una vez Hola **.NET Framework 4.6** es compatible con Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="867b1-266">These steps will not be necessary once hello **.NET Framework 4.6** is supported by Microsoft Azure.</span></span>

### <a name="elasticsearch-listener-instantiation-and-configuration"></a><span data-ttu-id="867b1-267">Configuración y creación de instancias del agente de escucha de ElasticSearch</span><span class="sxs-lookup"><span data-stu-id="867b1-267">Elasticsearch listener instantiation and configuration</span></span>
<span data-ttu-id="867b1-268">Hello paso final para el envío de datos de diagnóstico tooElasticsearch es toocreate una instancia de `ElasticSearchListener` y configúrelo con datos de la conexión de Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="867b1-268">hello final step for sending diagnostic data tooElasticsearch is toocreate an instance of `ElasticSearchListener` and configure it with Elasticsearch connection data.</span></span> <span data-ttu-id="867b1-269">agente de escucha de Hello captura automáticamente todos los eventos provocados a través de las clases de EventSource definidas en el proyecto de servicio de Hola.</span><span class="sxs-lookup"><span data-stu-id="867b1-269">hello listener automatically captures all events raised via EventSource classes defined in hello service project.</span></span> <span data-ttu-id="867b1-270">Debe toobe activo durante la duración de hello del servicio de hello, para hello mejor colocar toocreate se encuentra en el código de inicialización del servicio de Hola.</span><span class="sxs-lookup"><span data-stu-id="867b1-270">It needs toobe alive during hello lifetime of hello service, so hello best place toocreate it is in hello service initialization code.</span></span> <span data-ttu-id="867b1-271">Aquí es el aspecto que podría código de inicialización de Hola para un servicio sin estado después de los cambios necesarios de hello (adiciones que se indican en los comentarios a partir de `****`):</span><span class="sxs-lookup"><span data-stu-id="867b1-271">Here is how hello initialization code for a stateless service could look after hello necessary changes (additions pointed out in comments starting with `****`):</span></span>

```csharp
using System;
using System.Diagnostics;
using System.Fabric;
using System.Threading;
using System.Threading.Tasks;
using Microsoft.ServiceFabric.Services.Runtime;

// **** Add hello following directives
using Microsoft.Diagnostics.EventListeners;
using Microsoft.Diagnostics.EventListeners.Fabric;

namespace Stateless1
{
    internal static class Program
    {
        /// <summary>
        /// This is hello entry point of hello service host process.
        /// </summary>        
        private static void Main()
        {
            try
            {
                // **** Instantiate ElasticSearchListener
                var configProvider = new FabricConfigurationProvider("ElasticSearchEventListener");
                ElasticSearchListener esListener = null;
                if (configProvider.HasConfiguration)
                {
                    esListener = new ElasticSearchListener(configProvider, new FabricHealthReporter("ElasticSearchEventListener"));
                }

                // hello ServiceManifest.XML file defines one or more service type names.
                // Registering a service maps a service type name tooa .NET type.
                // When Service Fabric creates an instance of this service type,
                // an instance of hello class is created in this host process.

                ServiceRuntime.RegisterServiceAsync("Stateless1Type", 
                    context => new Stateless1(context)).GetAwaiter().GetResult();

                ServiceEventSource.Current.ServiceTypeRegistered(Process.GetCurrentProcess().Id, typeof(Stateless1).Name);

                // Prevents this host process from terminating so services keep running.
                Thread.Sleep(Timeout.Infinite);

                // **** Ensure that hello ElasticSearchListner instance is not garbage-collected prematurely
                GC.KeepAlive(esListener);
            }
            catch (Exception e)
            {
                ServiceEventSource.Current.ServiceHostInitializationFailed(e);
                throw;
            }
        }
    }
}
```

<span data-ttu-id="867b1-272">Datos de conexión de Elasticsearch deberían colocarse en una sección independiente en el archivo de configuración de servicio de hello (**PackageRoot\Config\Settings.xml**).</span><span class="sxs-lookup"><span data-stu-id="867b1-272">Elasticsearch connection data should be put in a separate section in hello service configuration file (**PackageRoot\Config\Settings.xml**).</span></span> <span data-ttu-id="867b1-273">nombre de Hola de sección Hola debe corresponder valor toohello pasado toohello `FabricConfigurationProvider` constructor, por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="867b1-273">hello name of hello section must correspond toohello value passed toohello `FabricConfigurationProvider` constructor, for example:</span></span>

```xml
<Section Name="ElasticSearchEventListener">
  <Parameter Name="serviceUri" Value="http://myBigCluster.westus.cloudapp.azure.com/es/" />
  <Parameter Name="userName" Value="(ES user name)" />
  <Parameter Name="password" Value="(ES user password)" />
  <Parameter Name="indexNamePrefix" Value="myapp" />
</Section>
```
<span data-ttu-id="867b1-274">Hola valores de `serviceUri`, `userName` y `password` parámetros corresponden a dirección de punto de conexión del clúster de toohello Elasticsearch, Elasticsearch nombre de usuario y contraseña, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="867b1-274">hello values of `serviceUri`, `userName` and `password` parameters correspond toohello Elasticsearch cluster endpoint address, Elasticsearch user name, and password, respectively.</span></span> <span data-ttu-id="867b1-275">`indexNamePrefix`es el prefijo de Hola para los índices de Elasticsearch; biblioteca de Hello Microsoft.Diagnostics.Listeners crea un nuevo índice para sus datos diariamente.</span><span class="sxs-lookup"><span data-stu-id="867b1-275">`indexNamePrefix` is hello prefix for Elasticsearch indexes; hello Microsoft.Diagnostics.Listeners library creates a new index for its data daily.</span></span>

### <a name="verification"></a><span data-ttu-id="867b1-276">Comprobación</span><span class="sxs-lookup"><span data-stu-id="867b1-276">Verification</span></span>
<span data-ttu-id="867b1-277">Eso es todo.</span><span class="sxs-lookup"><span data-stu-id="867b1-277">That's it!</span></span> <span data-ttu-id="867b1-278">Ahora, cada vez que se ejecuta el servicio de hello, iniciar el envío de servicio de seguimientos toohello Elasticsearch especificado en la configuración de Hola.</span><span class="sxs-lookup"><span data-stu-id="867b1-278">Now, whenever hello service is run, it starts sending traces toohello Elasticsearch service specified in hello configuration.</span></span> <span data-ttu-id="867b1-279">Para comprobarlo, Hola de apertura que kibana UI asociado a la instancia de hello destino Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="867b1-279">You can verify this by opening hello Kibana UI associated with hello target Elasticsearch instance.</span></span> <span data-ttu-id="867b1-280">En nuestro ejemplo, la dirección de la página de hello es http://myBigCluster.westus.cloudapp.azure.com/.</span><span class="sxs-lookup"><span data-stu-id="867b1-280">In our example, hello page address is http://myBigCluster.westus.cloudapp.azure.com/.</span></span> <span data-ttu-id="867b1-281">Compruebe que los índices con prefijo de nombre de hello elegido para hello `ElasticSearchListener` instancia realmente se han creado y rellenado con datos.</span><span class="sxs-lookup"><span data-stu-id="867b1-281">Check that indexes with hello name prefix chosen for hello `ElasticSearchListener` instance have indeed been created and populated with data.</span></span>

![Kibana muestra eventos de aplicación de PartyCluster][2]

## <a name="next-steps"></a><span data-ttu-id="867b1-283">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="867b1-283">Next steps</span></span>
* [<span data-ttu-id="867b1-284">Más información sobre cómo diagnosticar y supervisar un servicio Service Fabric</span><span class="sxs-lookup"><span data-stu-id="867b1-284">Learn more about diagnosing and monitoring a Service Fabric service</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

<!--Image references-->
[1]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/listener-lib-references.png
[2]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/kibana.png

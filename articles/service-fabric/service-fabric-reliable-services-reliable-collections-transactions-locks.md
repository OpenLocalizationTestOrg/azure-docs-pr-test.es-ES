---
title: aaaTransactions y modos de bloqueo en Azure Service Fabric confiable colecciones | Documentos de Microsoft
description: Transacciones y registros de Reliable State Manager y Reliable Collections de Azure Service Fabric.
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: masnider,rajak
ms.assetid: 62857523-604b-434e-bd1c-2141ea4b00d1
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: required
ms.date: 5/1/2017
ms.author: mcoskun
ms.openlocfilehash: 340e029aa98f43ad6e46b48f687dad01f9d96f69
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="transactions-and-lock-modes-in-azure-service-fabric-reliable-collections"></a><span data-ttu-id="1ceca-103">Transacciones y modos de bloqueo en Reliable Collections de Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="1ceca-103">Transactions and lock modes in Azure Service Fabric Reliable Collections</span></span>

## <a name="transaction"></a><span data-ttu-id="1ceca-104">Transacción</span><span class="sxs-lookup"><span data-stu-id="1ceca-104">Transaction</span></span>
<span data-ttu-id="1ceca-105">Una transacción es una secuencia de operaciones realizadas como una única unidad lógica de trabajo.</span><span class="sxs-lookup"><span data-stu-id="1ceca-105">A transaction is a sequence of operations performed as a single logical unit of work.</span></span>
<span data-ttu-id="1ceca-106">Una transacción debe exhibir Hola siguiendo las propiedades ACID.</span><span class="sxs-lookup"><span data-stu-id="1ceca-106">A transaction must exhibit hello following ACID properties.</span></span> <span data-ttu-id="1ceca-107">(consulte: https://technet.microsoft.com/en-us/library/ms190612)</span><span class="sxs-lookup"><span data-stu-id="1ceca-107">(see: https://technet.microsoft.com/en-us/library/ms190612)</span></span>
* <span data-ttu-id="1ceca-108">**Atomicidad**: una transacción debe ser una unidad atómica de trabajo.</span><span class="sxs-lookup"><span data-stu-id="1ceca-108">**Atomicity**: A transaction must be an atomic unit of work.</span></span> <span data-ttu-id="1ceca-109">Es decir, o se modifican todos sus datos o ninguno de ellos.</span><span class="sxs-lookup"><span data-stu-id="1ceca-109">In other words, either all its data modifications are performed, or none of them is performed.</span></span>
* <span data-ttu-id="1ceca-110">**Coherencia**: cuando ha finalizado, una transacción debe dejar todos los datos en un estado coherente.</span><span class="sxs-lookup"><span data-stu-id="1ceca-110">**Consistency**: When completed, a transaction must leave all data in a consistent state.</span></span> <span data-ttu-id="1ceca-111">Todas las estructuras de datos internos deben estar correctas al final de Hola de transacción de Hola.</span><span class="sxs-lookup"><span data-stu-id="1ceca-111">All internal data structures must be correct at hello end of hello transaction.</span></span>
* <span data-ttu-id="1ceca-112">**Aislamiento**: las modificaciones realizadas por transacciones simultáneas se deben aisladas de las modificaciones de hello realizadas por otras transacciones simultáneas.</span><span class="sxs-lookup"><span data-stu-id="1ceca-112">**Isolation**: Modifications made by concurrent transactions must be isolated from hello modifications made by any other concurrent transactions.</span></span> <span data-ttu-id="1ceca-113">nivel de aislamiento de Hello usado para una operación dentro de un ITransaction se determina por hello IReliableState realizar operación de Hola.</span><span class="sxs-lookup"><span data-stu-id="1ceca-113">hello isolation level used for an operation within an ITransaction is determined by hello IReliableState performing hello operation.</span></span>
* <span data-ttu-id="1ceca-114">**Durabilidad**: una vez concluida una transacción, sus efectos son permanentes en su lugar en el sistema de Hola.</span><span class="sxs-lookup"><span data-stu-id="1ceca-114">**Durability**: After a transaction has completed, its effects are permanently in place in hello system.</span></span> <span data-ttu-id="1ceca-115">modificaciones de Hello persisten incluso en caso de hello de un error del sistema.</span><span class="sxs-lookup"><span data-stu-id="1ceca-115">hello modifications persist even in hello event of a system failure.</span></span>

### <a name="isolation-levels"></a><span data-ttu-id="1ceca-116">Niveles de aislamiento</span><span class="sxs-lookup"><span data-stu-id="1ceca-116">Isolation levels</span></span>
<span data-ttu-id="1ceca-117">Nivel de aislamiento define el grado de hello transacciones de hello toowhich deben estar aislado de las modificaciones realizadas por otras transacciones.</span><span class="sxs-lookup"><span data-stu-id="1ceca-117">Isolation level defines hello degree toowhich hello transaction must be isolated from modifications made by other transactions.</span></span>
<span data-ttu-id="1ceca-118">Hay dos niveles de aislamiento que se admiten en Colecciones confiables:</span><span class="sxs-lookup"><span data-stu-id="1ceca-118">There are two isolation levels that are supported in Reliable Collections:</span></span>

* <span data-ttu-id="1ceca-119">**Lectura repetible**: Especifica que las instrucciones no pueden leer datos que hayan sido modificados, pero aún no confirmados por otras transacciones y que ninguna otra transacción puede modificar los datos que ha sido leídos por la transacción actual de hello hasta Hola actual finaliza la transacción.</span><span class="sxs-lookup"><span data-stu-id="1ceca-119">**Repeatable Read**: Specifies that statements cannot read data that has been modified but not yet committed by other transactions and that no other transactions can modify data that has been read by hello current transaction until hello current transaction finishes.</span></span> <span data-ttu-id="1ceca-120">Para obtener más información, consulte [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span><span class="sxs-lookup"><span data-stu-id="1ceca-120">For more details, see [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span></span>
* <span data-ttu-id="1ceca-121">**Instantánea**: Especifica que los datos leídos por cualquier instrucción de una transacción están la versión transaccionalmente coherente de Hola de datos de Hola existentes al comienzo de Hola de transacción de Hola.</span><span class="sxs-lookup"><span data-stu-id="1ceca-121">**Snapshot**: Specifies that data read by any statement in a transaction is hello transactionally consistent version of hello data that existed at hello start of hello transaction.</span></span>
  <span data-ttu-id="1ceca-122">transacción de Hello puede reconocer sólo las modificaciones de datos que se confirmaron antes del inicio de Hola de transacción de Hola.</span><span class="sxs-lookup"><span data-stu-id="1ceca-122">hello transaction can recognize only data modifications that were committed before hello start of hello transaction.</span></span>
  <span data-ttu-id="1ceca-123">Modificaciones de datos realizadas por otras transacciones después de hello principio de la transacción actual de hello no son toostatements visible ejecutando en Hola de transacción actual.</span><span class="sxs-lookup"><span data-stu-id="1ceca-123">Data modifications made by other transactions after hello start of hello current transaction are not visible toostatements executing in hello current transaction.</span></span>
  <span data-ttu-id="1ceca-124">efecto de Hello es como si instrucciones de hello en una transacción obtuviesen una instantánea de datos de hello confirmada tal y como se encontraban al inicio de Hola de transacción de Hola.</span><span class="sxs-lookup"><span data-stu-id="1ceca-124">hello effect is as if hello statements in a transaction get a snapshot of hello committed data as it existed at hello start of hello transaction.</span></span>
  <span data-ttu-id="1ceca-125">Las instantáneas son coherentes entre colecciones confiables.</span><span class="sxs-lookup"><span data-stu-id="1ceca-125">Snapshots are consistent across Reliable Collections.</span></span>
  <span data-ttu-id="1ceca-126">Para obtener más información, consulte [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span><span class="sxs-lookup"><span data-stu-id="1ceca-126">For more details, see [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span></span>

<span data-ttu-id="1ceca-127">Colecciones confiables automáticamente elija toouse de nivel de aislamiento de Hola para una operación de lectura determinada según operación hello y la función de Hola de réplica de hello en tiempo de presentación de la creación de la transacción.</span><span class="sxs-lookup"><span data-stu-id="1ceca-127">Reliable Collections automatically choose hello isolation level toouse for a given read operation depending on hello operation and hello role of hello replica at hello time of transaction's creation.</span></span>
<span data-ttu-id="1ceca-128">Aquí te mostramos tabla Hola que describe los valores predeterminados de nivel de aislamiento para las operaciones de diccionario confiable y cola.</span><span class="sxs-lookup"><span data-stu-id="1ceca-128">Following is hello table that depicts isolation level defaults for Reliable Dictionary and Queue operations.</span></span>

| <span data-ttu-id="1ceca-129">Operación\rol</span><span class="sxs-lookup"><span data-stu-id="1ceca-129">Operation \ Role</span></span> | <span data-ttu-id="1ceca-130">Principal</span><span class="sxs-lookup"><span data-stu-id="1ceca-130">Primary</span></span> | <span data-ttu-id="1ceca-131">Secundario</span><span class="sxs-lookup"><span data-stu-id="1ceca-131">Secondary</span></span> |
| --- |:--- |:--- |
| <span data-ttu-id="1ceca-132">Lectura de una sola entidad</span><span class="sxs-lookup"><span data-stu-id="1ceca-132">Single Entity Read</span></span> |<span data-ttu-id="1ceca-133">Repeatable Read</span><span class="sxs-lookup"><span data-stu-id="1ceca-133">Repeatable Read</span></span> |<span data-ttu-id="1ceca-134">Instantánea</span><span class="sxs-lookup"><span data-stu-id="1ceca-134">Snapshot</span></span> |
| <span data-ttu-id="1ceca-135">Enumeración, recuento</span><span class="sxs-lookup"><span data-stu-id="1ceca-135">Enumeration, Count</span></span> |<span data-ttu-id="1ceca-136">Instantánea</span><span class="sxs-lookup"><span data-stu-id="1ceca-136">Snapshot</span></span> |<span data-ttu-id="1ceca-137">Instantánea</span><span class="sxs-lookup"><span data-stu-id="1ceca-137">Snapshot</span></span> |

> [!NOTE]
> <span data-ttu-id="1ceca-138">Algunos ejemplos comunes de las operaciones de entidad única son `IReliableDictionary.TryGetValueAsync` y `IReliableQueue.TryPeekAsync`.</span><span class="sxs-lookup"><span data-stu-id="1ceca-138">Common examples for Single Entity Operations are `IReliableDictionary.TryGetValueAsync`, `IReliableQueue.TryPeekAsync`.</span></span>
> 

<span data-ttu-id="1ceca-139">Hola diccionario confiable y Hola cola confiable admiten lectura la escribe.</span><span class="sxs-lookup"><span data-stu-id="1ceca-139">Both hello Reliable Dictionary and hello Reliable Queue support Read Your Writes.</span></span>
<span data-ttu-id="1ceca-140">En otras palabras, cualquier escritura dentro de una transacción tooa visible siguiente leerá que pertenece toohello misma transacción.</span><span class="sxs-lookup"><span data-stu-id="1ceca-140">In other words, any write within a transaction will be visible tooa following read that belongs toohello same transaction.</span></span>

## <a name="locks"></a><span data-ttu-id="1ceca-141">Bloqueos</span><span class="sxs-lookup"><span data-stu-id="1ceca-141">Locks</span></span>
<span data-ttu-id="1ceca-142">En colecciones de confianza, implemente de todas las transacciones rigurosas de dos fase bloqueo: una transacción no liberar los bloqueos de hello ha adquirido hasta que la transacción de hello finaliza con una anulación o una confirmación.</span><span class="sxs-lookup"><span data-stu-id="1ceca-142">In Reliable Collections, all transactions implement rigorous two phase locking: a transaction does not release hello locks it has acquired until hello transaction terminates with either an abort or a commit.</span></span>

<span data-ttu-id="1ceca-143">Diccionario confiable utiliza el bloqueo de nivel de fila en todas las operaciones de entidad única.</span><span class="sxs-lookup"><span data-stu-id="1ceca-143">Reliable Dictionary uses row level locking for all single entity operations.</span></span>
<span data-ttu-id="1ceca-144">Cola confiable equilibra la simultaneidad para la propiedad FIFO transaccional estricta.</span><span class="sxs-lookup"><span data-stu-id="1ceca-144">Reliable Queue trades off concurrency for strict transactional FIFO property.</span></span>
<span data-ttu-id="1ceca-145">Cola confiable utiliza bloqueos de nivel de operación que permite una transacción con `TryPeekAsync` o `TryDequeueAsync` y una transacción con `EnqueueAsync` a la vez.</span><span class="sxs-lookup"><span data-stu-id="1ceca-145">Reliable Queue uses operation level locks allowing one transaction with `TryPeekAsync` and/or `TryDequeueAsync` and one transaction with `EnqueueAsync` at a time.</span></span>
<span data-ttu-id="1ceca-146">Tenga en cuenta que toopreserve FIFO, si un `TryPeekAsync` o `TryDequeueAsync` alguna vez observa que Hola cola confiable está vacía, también bloqueará `EnqueueAsync`.</span><span class="sxs-lookup"><span data-stu-id="1ceca-146">Note that toopreserve FIFO, if a `TryPeekAsync` or `TryDequeueAsync` ever observes that hello Reliable Queue is empty, they will also lock `EnqueueAsync`.</span></span>

<span data-ttu-id="1ceca-147">Las operaciones de escritura siempre tiene bloqueos exclusivos.</span><span class="sxs-lookup"><span data-stu-id="1ceca-147">Write operations always take Exclusive locks.</span></span>
<span data-ttu-id="1ceca-148">Para las operaciones de lectura, bloqueo de hello depende de un par de factores.</span><span class="sxs-lookup"><span data-stu-id="1ceca-148">For read operations, hello locking depends on a couple of factors.</span></span>
<span data-ttu-id="1ceca-149">Cualquier operación de lectura realizada mediante aislamiento Snapshot no presenta bloqueo.</span><span class="sxs-lookup"><span data-stu-id="1ceca-149">Any read operation done using Snapshot isolation is lock free.</span></span>
<span data-ttu-id="1ceca-150">Cualquier operación Repeatable Read usa bloqueos compartidos de manera predeterminada.</span><span class="sxs-lookup"><span data-stu-id="1ceca-150">Any Repeatable Read operation by default takes Shared locks.</span></span>
<span data-ttu-id="1ceca-151">Sin embargo, para cualquier operación de lectura que admite lectura repetible, usuario Hola puede solicitar un bloqueo de actualización en lugar de hello bloqueo compartido.</span><span class="sxs-lookup"><span data-stu-id="1ceca-151">However, for any read operation that supports Repeatable Read, hello user can ask for an Update lock instead of hello Shared lock.</span></span>
<span data-ttu-id="1ceca-152">Un bloqueo de actualización es que un bloqueo asimétrico usa tooprevent una forma común de interbloqueo que se produce cuando varias transacciones bloquean recursos para las posibles actualizaciones en un momento posterior.</span><span class="sxs-lookup"><span data-stu-id="1ceca-152">An Update lock is an asymmetric lock used tooprevent a common form of deadlock that occurs when multiple transactions lock resources for potential updates at a later time.</span></span>

<span data-ttu-id="1ceca-153">matriz de compatibilidad de bloqueos de Hello puede encontrarse en hello en la tabla siguiente:</span><span class="sxs-lookup"><span data-stu-id="1ceca-153">hello lock compatibility matrix can be found in hello following table:</span></span>

| <span data-ttu-id="1ceca-154">Solicitar \ concedido</span><span class="sxs-lookup"><span data-stu-id="1ceca-154">Request \ Granted</span></span> | <span data-ttu-id="1ceca-155">None</span><span class="sxs-lookup"><span data-stu-id="1ceca-155">None</span></span> | <span data-ttu-id="1ceca-156">Compartido</span><span class="sxs-lookup"><span data-stu-id="1ceca-156">Shared</span></span> | <span data-ttu-id="1ceca-157">Actualizar</span><span class="sxs-lookup"><span data-stu-id="1ceca-157">Update</span></span> | <span data-ttu-id="1ceca-158">Exclusivo</span><span class="sxs-lookup"><span data-stu-id="1ceca-158">Exclusive</span></span> |
| --- |:--- |:--- |:--- |:--- |
| <span data-ttu-id="1ceca-159">Compartido</span><span class="sxs-lookup"><span data-stu-id="1ceca-159">Shared</span></span> |<span data-ttu-id="1ceca-160">Ningún conflicto</span><span class="sxs-lookup"><span data-stu-id="1ceca-160">No conflict</span></span> |<span data-ttu-id="1ceca-161">Ningún conflicto</span><span class="sxs-lookup"><span data-stu-id="1ceca-161">No conflict</span></span> |<span data-ttu-id="1ceca-162">Conflicto</span><span class="sxs-lookup"><span data-stu-id="1ceca-162">Conflict</span></span> |<span data-ttu-id="1ceca-163">Conflicto</span><span class="sxs-lookup"><span data-stu-id="1ceca-163">Conflict</span></span> |
| <span data-ttu-id="1ceca-164">Actualizar</span><span class="sxs-lookup"><span data-stu-id="1ceca-164">Update</span></span> |<span data-ttu-id="1ceca-165">Ningún conflicto</span><span class="sxs-lookup"><span data-stu-id="1ceca-165">No conflict</span></span> |<span data-ttu-id="1ceca-166">Ningún conflicto</span><span class="sxs-lookup"><span data-stu-id="1ceca-166">No conflict</span></span> |<span data-ttu-id="1ceca-167">Conflicto</span><span class="sxs-lookup"><span data-stu-id="1ceca-167">Conflict</span></span> |<span data-ttu-id="1ceca-168">Conflicto</span><span class="sxs-lookup"><span data-stu-id="1ceca-168">Conflict</span></span> |
| <span data-ttu-id="1ceca-169">Exclusivo</span><span class="sxs-lookup"><span data-stu-id="1ceca-169">Exclusive</span></span> |<span data-ttu-id="1ceca-170">Ningún conflicto</span><span class="sxs-lookup"><span data-stu-id="1ceca-170">No conflict</span></span> |<span data-ttu-id="1ceca-171">Conflicto</span><span class="sxs-lookup"><span data-stu-id="1ceca-171">Conflict</span></span> |<span data-ttu-id="1ceca-172">Conflicto</span><span class="sxs-lookup"><span data-stu-id="1ceca-172">Conflict</span></span> |<span data-ttu-id="1ceca-173">Conflicto</span><span class="sxs-lookup"><span data-stu-id="1ceca-173">Conflict</span></span> |

<span data-ttu-id="1ceca-174">Argumento de tiempo de espera de hello confiable de las API de colecciones se utiliza la detección de interbloqueos.</span><span class="sxs-lookup"><span data-stu-id="1ceca-174">Time-out argument in hello Reliable Collections APIs is used for deadlock detection.</span></span>
<span data-ttu-id="1ceca-175">Por ejemplo, dos transacciones (T1 y T2) están tratando de tooread y actualización K1.</span><span class="sxs-lookup"><span data-stu-id="1ceca-175">For example, two transactions (T1 and T2) are trying tooread and update K1.</span></span>
<span data-ttu-id="1ceca-176">Es posible que ellos toodeadlock, porque ambos acaban por tener Hola compartido bloqueo.</span><span class="sxs-lookup"><span data-stu-id="1ceca-176">It is possible for them toodeadlock, because they both end up having hello Shared lock.</span></span>
<span data-ttu-id="1ceca-177">En este caso, una o ambas de las operaciones de hello agotará el tiempo.</span><span class="sxs-lookup"><span data-stu-id="1ceca-177">In this case, one or both of hello operations will time out.</span></span>

<span data-ttu-id="1ceca-178">Esta situación de interbloqueo es un buen ejemplo de cómo puede el bloqueo de actualización impedir interbloqueos.</span><span class="sxs-lookup"><span data-stu-id="1ceca-178">This deadlock scenario is a great example of how an Update lock can prevent deadlocks.</span></span>

## <a name="next-steps"></a><span data-ttu-id="1ceca-179">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="1ceca-179">Next steps</span></span>
* [<span data-ttu-id="1ceca-180">Trabajo con Reliable Collections</span><span class="sxs-lookup"><span data-stu-id="1ceca-180">Working with Reliable Collections</span></span>](service-fabric-work-with-reliable-collections.md)
* [<span data-ttu-id="1ceca-181">Notificaciones de Reliable Services</span><span class="sxs-lookup"><span data-stu-id="1ceca-181">Reliable Services notifications</span></span>](service-fabric-reliable-services-notifications.md)
* [<span data-ttu-id="1ceca-182">Copia de seguridad y restauración de Reliable Services (recuperación ante desastres)</span><span class="sxs-lookup"><span data-stu-id="1ceca-182">Reliable Services backup and restore (disaster recovery)</span></span>](service-fabric-reliable-services-backup-restore.md)
* [<span data-ttu-id="1ceca-183">Configuración del administrador de estado confiable</span><span class="sxs-lookup"><span data-stu-id="1ceca-183">Reliable State Manager configuration</span></span>](service-fabric-reliable-services-configuration.md)
* [<span data-ttu-id="1ceca-184">Referencia para desarrolladores de colecciones confiables</span><span class="sxs-lookup"><span data-stu-id="1ceca-184">Developer reference for Reliable Collections</span></span>](https://msdn.microsoft.com/library/azure/microsoft.servicefabric.data.collections.aspx)


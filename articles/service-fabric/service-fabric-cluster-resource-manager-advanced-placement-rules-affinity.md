---
title: "aaaService Administrador de recursos de clúster de tejido - afinidad | Documentos de Microsoft"
description: "Información general sobre la configuración de afinidad para servicios de Service Fabric"
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 678073e1-d08d-46c4-a811-826e70aba6c4
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 7dc9b6d9c18d9d615d39cff7de9d7cba1c040474
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="configuring-and-using-service-affinity-in-service-fabric"></a><span data-ttu-id="cb297-103">Configuración y uso de la afinidad de servicio en Service Fabric</span><span class="sxs-lookup"><span data-stu-id="cb297-103">Configuring and using service affinity in Service Fabric</span></span>
<span data-ttu-id="cb297-104">Afinidad es un control que se proporciona principalmente toohelp facilidad Hola transición de aplicaciones monolíticas grandes en Hola a todos en la nube y microservicios.</span><span class="sxs-lookup"><span data-stu-id="cb297-104">Affinity is a control that is provided mainly toohelp ease hello transition of larger monolithic applications into hello cloud and microservices world.</span></span> <span data-ttu-id="cb297-105">También se utiliza como una optimización para mejorar el rendimiento de hello de servicios, aunque esto puede tener efectos secundarios.</span><span class="sxs-lookup"><span data-stu-id="cb297-105">It is also used as an optimization for improving hello performance of services, although doing so can have side effects.</span></span>

<span data-ttu-id="cb297-106">Supongamos que utiliza una aplicación de mayor tamaño, o que simplemente no se diseñó con microservicios en mente, tooService tejido (o cualquier entorno distribuido).</span><span class="sxs-lookup"><span data-stu-id="cb297-106">Let’s say you’re bringing a larger app, or one that just wasn’t designed with microservices in mind, tooService Fabric (or any distributed environment).</span></span> <span data-ttu-id="cb297-107">Este tipo de transición es habitual.</span><span class="sxs-lookup"><span data-stu-id="cb297-107">This type of transition is common.</span></span> <span data-ttu-id="cb297-108">Empiece por elevación Hola toda aplicación en el entorno de hello, empaquetado y asegurándose de que se está ejecutando sin problemas.</span><span class="sxs-lookup"><span data-stu-id="cb297-108">You start by lifting hello entire app into hello environment, packaging it, and making sure it is running smoothly.</span></span> <span data-ttu-id="cb297-109">Iniciar, a continuación, divídala en diferentes servicios más pequeños que todos hablar tooeach otros.</span><span class="sxs-lookup"><span data-stu-id="cb297-109">Then you start breaking it down into different smaller services that all talk tooeach other.</span></span>

<span data-ttu-id="cb297-110">Finalmente es posible que la aplicación hello tiene algunos problemas.</span><span class="sxs-lookup"><span data-stu-id="cb297-110">Eventually you may find that hello application is experiencing some issues.</span></span> <span data-ttu-id="cb297-111">problemas de Hello normalmente pertenecen a una de estas categorías:</span><span class="sxs-lookup"><span data-stu-id="cb297-111">hello issues usually fall into one of these categories:</span></span>

1. <span data-ttu-id="cb297-112">Algún componente X en hello monolítico aplicación tenía una dependencia no documentada en el componente Y y solo se activan esos componentes en distintos servicios.</span><span class="sxs-lookup"><span data-stu-id="cb297-112">Some component X in hello monolithic app had an undocumented dependency on component Y, and you just turned those components into separate services.</span></span> <span data-ttu-id="cb297-113">Puesto que estos servicios se ejecutan ahora en diferentes nodos de clúster de hello, son rotas.</span><span class="sxs-lookup"><span data-stu-id="cb297-113">Since these services are now running on different nodes in hello cluster, they're broken.</span></span>
2. <span data-ttu-id="cb297-114">Estos componentes se comunican a través de (canalizaciones con nombre locales | memoria compartida | archivos en disco) y realmente necesita recursos locales de toobe toowrite pueda tooa compartido por motivos de rendimiento ahora mismo.</span><span class="sxs-lookup"><span data-stu-id="cb297-114">These components communicate via (local named pipes | shared memory | files on disk) and they really need toobe able toowrite tooa shared local resource for performance reasons right now.</span></span> <span data-ttu-id="cb297-115">Quizás, esa dependencia física se quite más adelante.</span><span class="sxs-lookup"><span data-stu-id="cb297-115">That hard dependency gets removed later, maybe.</span></span>
3. <span data-ttu-id="cb297-116">Todo es correcto, pero resulta que estos dos componentes están realmente fragmentados o son sensibles al rendimiento.</span><span class="sxs-lookup"><span data-stu-id="cb297-116">Everything is fine, but it turns out that these two components are actually chatty/performance sensitive.</span></span> <span data-ttu-id="cb297-117">Cuando se mueven a servicios independientes, el rendimiento general de la aplicación se reduce y aumenta la latencia.</span><span class="sxs-lookup"><span data-stu-id="cb297-117">When they moved them into separate services overall application performance tanked or latency increased.</span></span> <span data-ttu-id="cb297-118">Como resultado, hello general de la aplicación no cumple las expectativas.</span><span class="sxs-lookup"><span data-stu-id="cb297-118">As a result, hello overall application is not meeting expectations.</span></span>

<span data-ttu-id="cb297-119">En estos casos, no desea toolose nuestro trabajo refactorización y no desea toogo toohello atrás monolito.</span><span class="sxs-lookup"><span data-stu-id="cb297-119">In these cases, we don’t want toolose our refactoring work, and don’t want toogo back toohello monolith.</span></span> <span data-ttu-id="cb297-120">última condición de Hello incluso puede ser deseable como un método de optimización sin formato.</span><span class="sxs-lookup"><span data-stu-id="cb297-120">hello last condition may even be desirable as a plain optimization.</span></span> <span data-ttu-id="cb297-121">Sin embargo, hasta que se podemos rediseñar Hola componentes toowork de forma natural como servicios (o hasta que podemos resolver las expectativas de rendimiento de hello alguna otra manera) vamos tooneed cierto sentido de localidad.</span><span class="sxs-lookup"><span data-stu-id="cb297-121">However, until we can redesign hello components toowork naturally as services (or until we can solve hello performance expectations some other way) we're going tooneed some sense of locality.</span></span>

<span data-ttu-id="cb297-122">¿Qué toodo?</span><span class="sxs-lookup"><span data-stu-id="cb297-122">What toodo?</span></span> <span data-ttu-id="cb297-123">Podemos intentar activar la afinidad.</span><span class="sxs-lookup"><span data-stu-id="cb297-123">Well, you could try turning on affinity.</span></span>

## <a name="how-tooconfigure-affinity"></a><span data-ttu-id="cb297-124">La afinidad de tooconfigure</span><span class="sxs-lookup"><span data-stu-id="cb297-124">How tooconfigure affinity</span></span>
<span data-ttu-id="cb297-125">tooset la afinidad, se define una relación de afinidad entre dos servicios diferentes.</span><span class="sxs-lookup"><span data-stu-id="cb297-125">tooset up affinity, you define an affinity relationship between two different services.</span></span> <span data-ttu-id="cb297-126">Es como si hiciera que un servicio "apuntara" a otro y dijera "Este servicio solo se puede ejecutar donde se esté ejecutando ese otro".</span><span class="sxs-lookup"><span data-stu-id="cb297-126">You can think of affinity as “pointing” one service at another and saying “This service can only run where that service is running.”</span></span> <span data-ttu-id="cb297-127">En ocasiones nos referimos tooaffinity como una relación de elementos primarios/secundarios (donde eliges secundarios hello en el elemento primario de hello).</span><span class="sxs-lookup"><span data-stu-id="cb297-127">Sometimes we refer tooaffinity as a parent/child relationship (where you point hello child at hello parent).</span></span> <span data-ttu-id="cb297-128">Afinidad garantiza que las réplicas de Hola o instancias de un servicio están ubicadas en hello mismo nodos como los de otro servicio.</span><span class="sxs-lookup"><span data-stu-id="cb297-128">Affinity ensures that hello replicas or instances of one service are placed on hello same nodes as those of another service.</span></span>

```csharp
ServiceCorrelationDescription affinityDescription = new ServiceCorrelationDescription();
affinityDescription.Scheme = ServiceCorrelationScheme.Affinity;
affinityDescription.ServiceName = new Uri("fabric:/otherApplication/parentService");
serviceDescription.Correlations.Add(affinityDescription);
await fabricClient.ServiceManager.CreateServiceAsync(serviceDescription);
```

> [!NOTE]
> <span data-ttu-id="cb297-129">Un servicio secundario solo puede participar en una relación de afinidad sencilla.</span><span class="sxs-lookup"><span data-stu-id="cb297-129">A child service can only participate in a single affinity relationship.</span></span> <span data-ttu-id="cb297-130">Si deseara Hola secundarios toobe afinidad tootwo primario servicios al mismo tiempo tendrá un par de opciones:</span><span class="sxs-lookup"><span data-stu-id="cb297-130">If you wanted hello child toobe affinitized tootwo parent services at once you have a couple options:</span></span>
> - <span data-ttu-id="cb297-131">Invertir las relaciones de hello (tiene parentService1 y parentService2 apuntar al servicio secundario actual de hello), o</span><span class="sxs-lookup"><span data-stu-id="cb297-131">Reverse hello relationships (have parentService1 and parentService2 point at hello current child service), or</span></span>
> - <span data-ttu-id="cb297-132">Designar uno de los padres Hola como un concentrador, convención y tienen todos los servicios apuntan a ese servicio.</span><span class="sxs-lookup"><span data-stu-id="cb297-132">Designate one of hello parents as a hub by convention and have all services point at that service.</span></span> 
>
> <span data-ttu-id="cb297-133">Hola resultante el comportamiento de selección de ubicación en el clúster de hello debe ser Hola mismo.</span><span class="sxs-lookup"><span data-stu-id="cb297-133">hello resulting placement behavior in hello cluster should be hello same.</span></span>
>

## <a name="different-affinity-options"></a><span data-ttu-id="cb297-134">Diferentes opciones de afinidad</span><span class="sxs-lookup"><span data-stu-id="cb297-134">Different affinity options</span></span>
<span data-ttu-id="cb297-135">La afinidad se representa mediante uno de varios esquemas de correlación y tiene dos modos diferentes.</span><span class="sxs-lookup"><span data-stu-id="cb297-135">Affinity is represented via one of several correlation schemes, and has two different modes.</span></span> <span data-ttu-id="cb297-136">Hola el modo más común de afinidad es lo que llamamos NonAlignedAffinity.</span><span class="sxs-lookup"><span data-stu-id="cb297-136">hello most common mode of affinity is what we call NonAlignedAffinity.</span></span> <span data-ttu-id="cb297-137">En NonAlignedAffinity, Hola réplicas o instancias de servicios diferentes de Hola se colocan en hello mismos nodos.</span><span class="sxs-lookup"><span data-stu-id="cb297-137">In NonAlignedAffinity, hello replicas or instances of hello different services are placed on hello same nodes.</span></span> <span data-ttu-id="cb297-138">Hola otro modo es AlignedAffinity.</span><span class="sxs-lookup"><span data-stu-id="cb297-138">hello other mode is AlignedAffinity.</span></span> <span data-ttu-id="cb297-139">AlignedAffinity resulta de utilidad con servicios con estado.</span><span class="sxs-lookup"><span data-stu-id="cb297-139">Aligned Affinity is useful only with stateful services.</span></span> <span data-ttu-id="cb297-140">Configuración con estado dos servicios toohave alineado afinidad garantiza que primarios Hola de dichos servicios están ubicados en Hola mismos nodos como unos de otros.</span><span class="sxs-lookup"><span data-stu-id="cb297-140">Configuring two stateful services toohave aligned affinity ensures that hello primaries of those services are placed on hello same nodes as each other.</span></span> <span data-ttu-id="cb297-141">También hace que cada par de elementos secundarios para esos servicios toobe coloca en hello mismo nodos.</span><span class="sxs-lookup"><span data-stu-id="cb297-141">It also causes each pair of secondaries for those services toobe placed on hello same nodes.</span></span> <span data-ttu-id="cb297-142">También es posible (aunque menos común) tooconfigure NonAlignedAffinity para los servicios con estado.</span><span class="sxs-lookup"><span data-stu-id="cb297-142">It is also possible (though less common) tooconfigure NonAlignedAffinity for stateful services.</span></span> <span data-ttu-id="cb297-143">Para NonAlignedAffinity, distintas réplicas de Hola de hello llevarían a cabo en dos servicios con estado Hola mismos nodos, pero sus primarios podrían acabar en nodos diferentes.</span><span class="sxs-lookup"><span data-stu-id="cb297-143">For NonAlignedAffinity, hello different replicas of hello two stateful services would run on hello same nodes, but their primaries could end up on different nodes.</span></span>

<span data-ttu-id="cb297-144"><center>
![Modos de afinidad y consecuencias][Image1]
</center></span><span class="sxs-lookup"><span data-stu-id="cb297-144"><center>
![Affinity Modes and Their Effects][Image1]
</center></span></span>

### <a name="best-effort-desired-state"></a><span data-ttu-id="cb297-145">Estado de mejor esfuerzo deseado</span><span class="sxs-lookup"><span data-stu-id="cb297-145">Best effort desired state</span></span>
<span data-ttu-id="cb297-146">Una relación de afinidad es la mejor opción.</span><span class="sxs-lookup"><span data-stu-id="cb297-146">An affinity relationship is best effort.</span></span> <span data-ttu-id="cb297-147">No proporciona Hola mismas garantías de confiabilidad encargada de ejecutar Hola mismo proceso ejecutable o de la colocación.</span><span class="sxs-lookup"><span data-stu-id="cb297-147">It does not provide hello same guarantees of collocation or reliability that running in hello same executable process does.</span></span> <span data-ttu-id="cb297-148">Servicios de Hello en una relación de afinidad son fundamentalmente distintas entidades que pueden producir un error y mover de forma independiente.</span><span class="sxs-lookup"><span data-stu-id="cb297-148">hello services in an affinity relationship are fundamentally different entities that can fail and be moved independently.</span></span> <span data-ttu-id="cb297-149">También se puede interrumpir una relación de afinidad, aunque estas interrupciones son temporales.</span><span class="sxs-lookup"><span data-stu-id="cb297-149">An affinity relationship could also break, though these breaks are temporary.</span></span> <span data-ttu-id="cb297-150">Por ejemplo, las limitaciones de capacidad pueden significar que sólo algunos Hola objetos de servicio en la relación de afinidad de hello caben en un nodo determinado.</span><span class="sxs-lookup"><span data-stu-id="cb297-150">For example, capacity limitations may mean that only some of hello service objects in hello affinity relationship can fit on a given node.</span></span> <span data-ttu-id="cb297-151">En estos casos, aunque hay una relación de afinidad en su lugar, no se puede aplicar a pagar toohello otras restricciones.</span><span class="sxs-lookup"><span data-stu-id="cb297-151">In these cases even though there's an affinity relationship in place, it can't be enforced due toohello other constraints.</span></span> <span data-ttu-id="cb297-152">Si es posible toodo por lo tanto, infracción de Hola se corrige automáticamente más tarde.</span><span class="sxs-lookup"><span data-stu-id="cb297-152">If it is possible toodo so, hello violation is automatically corrected later.</span></span>

### <a name="chains-vs-stars"></a><span data-ttu-id="cb297-153">Cadenas frente a estrellas</span><span class="sxs-lookup"><span data-stu-id="cb297-153">Chains vs. stars</span></span>
<span data-ttu-id="cb297-154">Hoy en día Hola, Administrador de recursos del clúster no es capaz de toomodel cadenas de relaciones de afinidad.</span><span class="sxs-lookup"><span data-stu-id="cb297-154">Today hello Cluster Resource Manager isn't able toomodel chains of affinity relationships.</span></span> <span data-ttu-id="cb297-155">Esto significa que un servicio que es un elemento secundario de una relación de afinidad no puede ser un elemento primario de otra relación de afinidad.</span><span class="sxs-lookup"><span data-stu-id="cb297-155">What this means is that a service that is a child in one affinity relationship can’t be a parent in another affinity relationship.</span></span> <span data-ttu-id="cb297-156">Si desea toomodel este tipo de relación, tienen efectivamente toomodel como una estrella, en lugar de una cadena.</span><span class="sxs-lookup"><span data-stu-id="cb297-156">If you want toomodel this type of relationship, you effectively have toomodel it as a star, rather than a chain.</span></span> <span data-ttu-id="cb297-157">toomove desde una estrella de tooa de cadena, secundario más bajo de hello sería toohello primario primera primario del elemento secundario en su lugar.</span><span class="sxs-lookup"><span data-stu-id="cb297-157">toomove from a chain tooa star, hello bottommost child would be parented toohello first child’s parent instead.</span></span> <span data-ttu-id="cb297-158">Dependiendo de la organización de Hola de sus servicios, puede que tenga toodo varias veces.</span><span class="sxs-lookup"><span data-stu-id="cb297-158">Depending on hello arrangement of your services, you may have toodo this multiple times.</span></span> <span data-ttu-id="cb297-159">Si no hay ningún servicio de elemento primario natural, puede tener toocreate uno que actúa como un marcador de posición.</span><span class="sxs-lookup"><span data-stu-id="cb297-159">If there's no natural parent service, you may have toocreate one that serves as a placeholder.</span></span> <span data-ttu-id="cb297-160">Dependiendo de los requisitos, puede que también desee toolook en [grupos de aplicaciones](service-fabric-cluster-resource-manager-application-groups.md).</span><span class="sxs-lookup"><span data-stu-id="cb297-160">Depending on your requirements, you may also want toolook into [Application Groups](service-fabric-cluster-resource-manager-application-groups.md).</span></span>

<span data-ttu-id="cb297-161"><center>
![Cadenas frente a Estrellas de hello contexto de las relaciones de afinidad][Image2]
</center></span><span class="sxs-lookup"><span data-stu-id="cb297-161"><center>
![Chains vs. Stars in hello Context of Affinity Relationships][Image2]
</center></span></span>

<span data-ttu-id="cb297-162">Otro toonote algo acerca de las relaciones de afinidad hoy en día es que son direccionales.</span><span class="sxs-lookup"><span data-stu-id="cb297-162">Another thing toonote about affinity relationships today is that they are directional.</span></span> <span data-ttu-id="cb297-163">Esto significa que esa regla de afinidad de hello solo exige que secundarios Hola colocado con primario Hola.</span><span class="sxs-lookup"><span data-stu-id="cb297-163">This means that hello affinity rule only enforces that hello child placed with hello parent.</span></span> <span data-ttu-id="cb297-164">No garantiza que ese elemento primario Hola se encuentra con secundarios Hola.</span><span class="sxs-lookup"><span data-stu-id="cb297-164">It does not ensure that hello parent is located with hello child.</span></span> <span data-ttu-id="cb297-165">También es importante toonote que Hola relación de afinidad no se puede perfecta o al instante aplicar desde diferentes servicios tiene los ciclos de vida diferente y pueden producirá un error y mover de forma independiente.</span><span class="sxs-lookup"><span data-stu-id="cb297-165">It is also important toonote that hello affinity relationship can't be perfect or instantly enforced since different services have with different lifecycles and can fail and move independently.</span></span> <span data-ttu-id="cb297-166">Por ejemplo, supongamos que primario Hola repentinamente conmuta por error nodo tooanother porque bloqueó.</span><span class="sxs-lookup"><span data-stu-id="cb297-166">For example, let's say hello parent suddenly fails over tooanother node because it crashed.</span></span> <span data-ttu-id="cb297-167">Hola, Administrador de recursos del clúster y el controlador del Administrador de conmutación por error de Hola conmutación por error en primer lugar, ya que mantener los servicios de hello, coherente y de disponibilidad es la prioridad de Hola.</span><span class="sxs-lookup"><span data-stu-id="cb297-167">hello Cluster Resource Manager and Failover Manager handle hello failover first, since keeping hello services up, consistent, and available is hello priority.</span></span> <span data-ttu-id="cb297-168">Una vez completada la conmutación por error de hello, se interrumpe la relación de afinidad de hello, pero no se encuentra con primario Hola Hola, Administrador de recursos del clúster se considera que todo va bien hasta que observa a que los secundarios de Hola.</span><span class="sxs-lookup"><span data-stu-id="cb297-168">Once hello failover completes, hello affinity relationship is broken, but hello Cluster Resource Manager thinks everything is fine until it notices that hello child is not located with hello parent.</span></span> <span data-ttu-id="cb297-169">Estos tipos de comprobaciones se realizan periódicamente.</span><span class="sxs-lookup"><span data-stu-id="cb297-169">These sorts of checks are performed periodically.</span></span> <span data-ttu-id="cb297-170">Obtener más información sobre cómo Hola, Administrador de recursos del clúster se evalúa como restricciones está disponible en [este artículo](service-fabric-cluster-resource-manager-management-integration.md#constraint-types), y [este](service-fabric-cluster-resource-manager-balancing.md) habla más información acerca de cómo tooconfigure Hola cadencia en que estas restricciones son evalúa.</span><span class="sxs-lookup"><span data-stu-id="cb297-170">More information on how hello Cluster Resource Manager evaluates constraints is available in [this article](service-fabric-cluster-resource-manager-management-integration.md#constraint-types), and [this one](service-fabric-cluster-resource-manager-balancing.md) talks more about how tooconfigure hello cadence on which these constraints are evaluated.</span></span>   


### <a name="partitioning-support"></a><span data-ttu-id="cb297-171">Compatibilidad con particiones</span><span class="sxs-lookup"><span data-stu-id="cb297-171">Partitioning support</span></span>
<span data-ttu-id="cb297-172">Hola final lo toonotice acerca de la afinidad es que no se admiten relaciones de afinidad donde se crean las particiones primaria de Hola.</span><span class="sxs-lookup"><span data-stu-id="cb297-172">hello final thing toonotice about affinity is that affinity relationships aren’t supported where hello parent is partitioned.</span></span> <span data-ttu-id="cb297-173">A la larga los servicios principales particionados se admitirán, pero por ahora no se permiten.</span><span class="sxs-lookup"><span data-stu-id="cb297-173">Partitioned parent services may be supported eventually, but today it is not allowed.</span></span>

## <a name="next-steps"></a><span data-ttu-id="cb297-174">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="cb297-174">Next steps</span></span>
- <span data-ttu-id="cb297-175">Para más información sobre la configuración de servicios, vaya a [este vínculo](service-fabric-cluster-resource-manager-configure-services.md).</span><span class="sxs-lookup"><span data-stu-id="cb297-175">For more information on configuring services, [Learn about configuring Services](service-fabric-cluster-resource-manager-configure-services.md)</span></span>
- <span data-ttu-id="cb297-176">los servicios de toolimit tooa pequeño conjunto de máquinas o agregar carga de hello de servicios, use [grupos de aplicaciones](service-fabric-cluster-resource-manager-application-groups.md)</span><span class="sxs-lookup"><span data-stu-id="cb297-176">toolimit services tooa small set of machines or aggregating hello load of services, use [Application Groups](service-fabric-cluster-resource-manager-application-groups.md)</span></span>

[Image1]:./media/service-fabric-cluster-resource-manager-advanced-placement-rules-affinity/cluster-resrouce-manager-affinity-modes.png
[Image2]:./media/service-fabric-cluster-resource-manager-advanced-placement-rules-affinity/cluster-resource-manager-chains-vs-stars.png
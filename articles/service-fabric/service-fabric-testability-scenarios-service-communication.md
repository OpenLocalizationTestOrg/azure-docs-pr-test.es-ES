---
title: "Capacidad de prueba: comunicación del servicio | Microsoft Docs"
description: "La comunicación entre servicios es un punto crítico de integración de una aplicación de Service Fabric. En este artículo se describen las consideraciones de diseño y las técnicas de prueba."
services: service-fabric
documentationcenter: .net
author: vturecek
manager: timlt
editor: 
ms.assetid: 017557df-fb59-4e4a-a65d-2732f29255b8
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/29/2017
ms.author: vturecek
ms.openlocfilehash: 4a8f941c1e8e641384a9ee3a1149dabaaf9983cc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="service-fabric-testability-scenarios-service-communication"></a><span data-ttu-id="79a26-104">Escenarios de capacidad de prueba de Service Fabric: comunicación del servicio</span><span class="sxs-lookup"><span data-stu-id="79a26-104">Service Fabric testability scenarios: Service communication</span></span>
<span data-ttu-id="79a26-105">Los microservicios y los estilos de arquitectura orientados a servicios emergen naturalmente en Service Fabric de Azure.</span><span class="sxs-lookup"><span data-stu-id="79a26-105">Microservices and service-oriented architectural styles surface naturally in Azure Service Fabric.</span></span> <span data-ttu-id="79a26-106">En estos tipos de arquitecturas distribuidas, dividida en componentes microservicio aplicaciones suelen constar de varios servicios que necesitan tootalk tooeach otros.</span><span class="sxs-lookup"><span data-stu-id="79a26-106">In these types of distributed architectures, componentized microservice applications are typically composed of multiple services that need tootalk tooeach other.</span></span> <span data-ttu-id="79a26-107">En los casos de hello incluso más sencillos, generalmente tiene al menos un servicio web sin estado y un servicio de almacenamiento de datos con estado que necesita toocommunicate.</span><span class="sxs-lookup"><span data-stu-id="79a26-107">In even hello simplest cases, you generally have at least a stateless web service and a stateful data storage service that need toocommunicate.</span></span>

<span data-ttu-id="79a26-108">Comunicación del servicio a servicio es un punto de integración críticos de una aplicación, porque cada servicio expone un servicios tooother de API remoto.</span><span class="sxs-lookup"><span data-stu-id="79a26-108">Service-to-service communication is a critical integration point of an application, because each service exposes a remote API tooother services.</span></span> <span data-ttu-id="79a26-109">El trabajo con un conjunto de límites de API que implican E/S requiere generalmente tomar algunas precauciones y realizar una buena cantidad de pruebas y validaciones.</span><span class="sxs-lookup"><span data-stu-id="79a26-109">Working with a set of API boundaries that involves I/O generally requires some care, with a good amount of testing and validation.</span></span>

<span data-ttu-id="79a26-110">Hay numerosas toomake consideraciones cuando estos límites de servicio se conectan entre sí en un sistema distribuido:</span><span class="sxs-lookup"><span data-stu-id="79a26-110">There are numerous considerations toomake when these service boundaries are wired together in a distributed system:</span></span>

* <span data-ttu-id="79a26-111">*Protocolo de transporte*.</span><span class="sxs-lookup"><span data-stu-id="79a26-111">*Transport protocol*.</span></span> <span data-ttu-id="79a26-112">¿Se utilizará HTTP para una mayor interoperabilidad, o bien un protocolo binario personalizado para el máximo rendimiento?</span><span class="sxs-lookup"><span data-stu-id="79a26-112">Will you use HTTP for increased interoperability, or a custom binary protocol for maximum throughput?</span></span>
* <span data-ttu-id="79a26-113">*Control de errores*.</span><span class="sxs-lookup"><span data-stu-id="79a26-113">*Error handling*.</span></span> <span data-ttu-id="79a26-114">¿Cómo se controlarán los errores transitorios y permanentes?</span><span class="sxs-lookup"><span data-stu-id="79a26-114">How will permanent and transient errors be handled?</span></span> <span data-ttu-id="79a26-115">¿Qué ocurrirá cuando mueve de un servicio tooa otro nodo?</span><span class="sxs-lookup"><span data-stu-id="79a26-115">What will happen when a service moves tooa different node?</span></span>
* <span data-ttu-id="79a26-116">*Tiempos de espera y latencia*.</span><span class="sxs-lookup"><span data-stu-id="79a26-116">*Timeouts and latency*.</span></span> <span data-ttu-id="79a26-117">¿En las aplicaciones de varios niveles, cómo cada nivel de servicio controlará latencia a través de usuario de pila y toohello Hola?</span><span class="sxs-lookup"><span data-stu-id="79a26-117">In multitiered applications, how will each service layer handle latency through hello stack and toohello user?</span></span>

<span data-ttu-id="79a26-118">Si usa uno de los componentes de comunicación del servicio integrado Hola proporcionados por Service Fabric o crear la suya propia, probar las interacciones de hello entre los servicios es la resistencia de tooensuring crítico en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="79a26-118">Whether you use one of hello built-in service communication components provided by Service Fabric or you build your own, testing hello interactions between your services is critical tooensuring resiliency in your application.</span></span>

## <a name="prepare-for-services-toomove"></a><span data-ttu-id="79a26-119">Preparar para toomove de servicios</span><span class="sxs-lookup"><span data-stu-id="79a26-119">Prepare for services toomove</span></span>
<span data-ttu-id="79a26-120">Las instancias de los servicios pueden desplazarse con el tiempo.</span><span class="sxs-lookup"><span data-stu-id="79a26-120">Service instances may move around over time.</span></span> <span data-ttu-id="79a26-121">Esto ocurre especialmente cuando se configuran con métricas de carga para el equilibrio óptimo personalizado de los recursos.</span><span class="sxs-lookup"><span data-stu-id="79a26-121">This is especially true when they are configured with load metrics for custom-tailored optimal resource balancing.</span></span> <span data-ttu-id="79a26-122">Service Fabric se mueve el toomaximize de instancias de servicio su disponibilidad incluso durante las actualizaciones, las conmutaciones por error, escalado horizontal y otras situaciones que ocurren durante la duración de Hola de un sistema distribuido.</span><span class="sxs-lookup"><span data-stu-id="79a26-122">Service Fabric moves your service instances toomaximize their availability even during upgrades, failovers, scale-out, and other situations that occur over hello lifetime of a distributed system.</span></span>

<span data-ttu-id="79a26-123">Como servicios moverse en clúster de hello, los clientes y otros servicios deben ser toohandle preparada dos escenarios cuando hablan tooa servicio:</span><span class="sxs-lookup"><span data-stu-id="79a26-123">As services move around in hello cluster, your clients and other services should be prepared toohandle two scenarios when they talk tooa service:</span></span>

* <span data-ttu-id="79a26-124">réplica de partición o instancia de servicio de Hola se ha movido desde Hola había hablado tooit de última hora.</span><span class="sxs-lookup"><span data-stu-id="79a26-124">hello service instance or partition replica has moved since hello last time you talked tooit.</span></span> <span data-ttu-id="79a26-125">Se trata de una parte normal de un ciclo de vida de servicio y debe ser toohappen esperado durante la vigencia de saludo de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="79a26-125">This is a normal part of a service lifecycle, and it should be expected toohappen during hello lifetime of your application.</span></span>
* <span data-ttu-id="79a26-126">réplica de partición o instancia de servicio de Hello está en proceso de Hola de mover.</span><span class="sxs-lookup"><span data-stu-id="79a26-126">hello service instance or partition replica is in hello process of moving.</span></span> <span data-ttu-id="79a26-127">Aunque conmutación por error de un servicio desde una tooanother de nodo se produce muy rápidamente en el tejido de servicio, puede haber un retraso en la disponibilidad si Hola comunicación del componente del servicio es toostart lenta.</span><span class="sxs-lookup"><span data-stu-id="79a26-127">Although failover of a service from one node tooanother occurs very quickly in Service Fabric, there may be a delay in availability if hello communication component of your service is slow toostart.</span></span>

<span data-ttu-id="79a26-128">El control correcto de estas situaciones es importante para lograr que un sistema funcione sin problemas.</span><span class="sxs-lookup"><span data-stu-id="79a26-128">Handling these scenarios gracefully is important for a smooth-running system.</span></span> <span data-ttu-id="79a26-129">toodo por lo tanto, tenga en cuenta que:</span><span class="sxs-lookup"><span data-stu-id="79a26-129">toodo so, keep in mind that:</span></span>

* <span data-ttu-id="79a26-130">Todos los servicios que pueden estar conectados toohas una *dirección* que realiza escuchas en (por ejemplo, HTTP o WebSockets).</span><span class="sxs-lookup"><span data-stu-id="79a26-130">Every service that can be connected toohas an *address* that it listens on (for example, HTTP or WebSockets).</span></span> <span data-ttu-id="79a26-131">Cuando una instancia del servicio o una partición se desplaza, cambia el punto de conexión de su dirección.</span><span class="sxs-lookup"><span data-stu-id="79a26-131">When a service instance or partition moves, its address endpoint changes.</span></span> <span data-ttu-id="79a26-132">(Mueve tooa otro nodo con una dirección IP diferente). Si usa componentes de comunicación integradas de hello, controlará volver a resolver direcciones de servicio para usted.</span><span class="sxs-lookup"><span data-stu-id="79a26-132">(It moves tooa different node with a different IP address.) If you're using hello built-in communication components, they will handle re-resolving service addresses for you.</span></span>
* <span data-ttu-id="79a26-133">Puede haber un aumento de latencia de servicio como Hola servicio instancia comienza su agente de escucha temporal nuevo.</span><span class="sxs-lookup"><span data-stu-id="79a26-133">There may be a temporary increase in service latency as hello service instance starts up its listener again.</span></span> <span data-ttu-id="79a26-134">Esto depende en rapidez servicio Hola abre el agente de escucha de hello después de mover la instancia de servicio de Hola.</span><span class="sxs-lookup"><span data-stu-id="79a26-134">This depends on how quickly hello service opens hello listener after hello service instance is moved.</span></span>
* <span data-ttu-id="79a26-135">Las conexiones existentes necesitan toobe cierra y vuelve a abrir después de abre el servicio de hello en un nuevo nodo.</span><span class="sxs-lookup"><span data-stu-id="79a26-135">Any existing connections need toobe closed and reopened after hello service opens on a new node.</span></span> <span data-ttu-id="79a26-136">Reinicio o apagado de nodo estable da tiempo para toobe de las conexiones existentes cerrar correctamente.</span><span class="sxs-lookup"><span data-stu-id="79a26-136">A graceful node shutdown or restart allows time for existing connections toobe shut down gracefully.</span></span>

### <a name="test-it-move-service-instances"></a><span data-ttu-id="79a26-137">Pruébelo: mover instancias de servicio</span><span class="sxs-lookup"><span data-stu-id="79a26-137">Test it: Move service instances</span></span>
<span data-ttu-id="79a26-138">Mediante el uso de herramientas de capacidad de prueba del tejido de servicio, puede crear un tootest del escenario de prueba estas situaciones de maneras diferentes:</span><span class="sxs-lookup"><span data-stu-id="79a26-138">By using Service Fabric's testability tools, you can author a test scenario tootest these situations in different ways:</span></span>

1. <span data-ttu-id="79a26-139">Mover la réplica principal de un servicio con estado.</span><span class="sxs-lookup"><span data-stu-id="79a26-139">Move a stateful service's primary replica.</span></span>
   
    <span data-ttu-id="79a26-140">Hello réplica principal de una partición de servicio con estado puede aplicarse para una serie de motivos.</span><span class="sxs-lookup"><span data-stu-id="79a26-140">hello primary replica of a stateful service partition can be moved for any number of reasons.</span></span> <span data-ttu-id="79a26-141">Use este tootarget Hola una réplica principal de un toosee de partición específica cómo mover la toohello de reaccionar de servicios de una manera muy controlada.</span><span class="sxs-lookup"><span data-stu-id="79a26-141">Use this tootarget hello primary replica of a specific partition toosee how your services react toohello move in a very controlled manner.</span></span>
   
    ```powershell
   
    PS > Move-ServiceFabricPrimaryReplica -PartitionId 6faa4ffa-521a-44e9-8351-dfca0f7e0466 -ServiceName fabric:/MyApplication/MyService
   
    ```
2. <span data-ttu-id="79a26-142">Detener un nodo.</span><span class="sxs-lookup"><span data-stu-id="79a26-142">Stop a node.</span></span>
   
    <span data-ttu-id="79a26-143">Cuando se detiene un nodo, se desplaza de Service Fabric todas las de hello service instancias o particiones que había en ese tooone de nodo de Hola otros nodos disponibles en el clúster de Hola.</span><span class="sxs-lookup"><span data-stu-id="79a26-143">When a node is stopped, Service Fabric moves all of hello service instances or partitions that were on that node tooone of hello other available nodes in hello cluster.</span></span> <span data-ttu-id="79a26-144">Utilice este tootest una situación donde un nodo se pierde desde el clúster y todas las instancias de servicio hello y réplicas en ese nodo tienen toomove.</span><span class="sxs-lookup"><span data-stu-id="79a26-144">Use this tootest a situation where a node is lost from your cluster and all of hello service instances and replicas on that node have toomove.</span></span>
   
    <span data-ttu-id="79a26-145">Puede detener un nodo mediante Hola PowerShell **ServiceFabricNode Stop** cmdlet:</span><span class="sxs-lookup"><span data-stu-id="79a26-145">You can stop a node by using hello PowerShell **Stop-ServiceFabricNode** cmdlet:</span></span>
   
    ```powershell
   
    PS > Restart-ServiceFabricNode -NodeName Node_1
   
    ```

## <a name="maintain-service-availability"></a><span data-ttu-id="79a26-146">Mantener la disponibilidad del servicio</span><span class="sxs-lookup"><span data-stu-id="79a26-146">Maintain service availability</span></span>
<span data-ttu-id="79a26-147">Como una plataforma Service Fabric es tooprovide diseñada alta disponibilidad de los servicios.</span><span class="sxs-lookup"><span data-stu-id="79a26-147">As a platform, Service Fabric is designed tooprovide high availability of your services.</span></span> <span data-ttu-id="79a26-148">Sin embargo, los problemas de infraestructura subyacentes pueden provocar que no exista disponibilidad en casos extremos.</span><span class="sxs-lookup"><span data-stu-id="79a26-148">But in extreme cases, underlying infrastructure problems can still cause unavailability.</span></span> <span data-ttu-id="79a26-149">Es importante tootest para estos escenarios, demasiado.</span><span class="sxs-lookup"><span data-stu-id="79a26-149">It is important tootest for these scenarios, too.</span></span>

<span data-ttu-id="79a26-150">Los servicios con estado utilizan un estado de tooreplicate sistema basado en quórum para lograr alta disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="79a26-150">Stateful services use a quorum-based system tooreplicate state for high availability.</span></span> <span data-ttu-id="79a26-151">Esto significa que un quórum de réplicas debe toobe tooperform disponibles las operaciones de escritura.</span><span class="sxs-lookup"><span data-stu-id="79a26-151">This means that a quorum of replicas needs toobe available tooperform write operations.</span></span> <span data-ttu-id="79a26-152">En casos excepcionales, como en un error generalizado de hardware, puede que no esté disponible el cuórum de réplicas.</span><span class="sxs-lookup"><span data-stu-id="79a26-152">In rare cases, such as a widespread hardware failure, a quorum of replicas may not be available.</span></span> <span data-ttu-id="79a26-153">En estos casos, no será capaz de tooperform las operaciones de escritura, pero se seguirá tooperform capaz de las operaciones de lectura.</span><span class="sxs-lookup"><span data-stu-id="79a26-153">In these cases, you will not be able tooperform write operations, but you will still be able tooperform read operations.</span></span>

### <a name="test-it-write-operation-unavailability"></a><span data-ttu-id="79a26-154">Pruébelo: falta de disponibilidad de la operación de escritura</span><span class="sxs-lookup"><span data-stu-id="79a26-154">Test it: Write operation unavailability</span></span>
<span data-ttu-id="79a26-155">Mediante herramientas de la capacidad de prueba de hello en Service Fabric, también puede insertar un error que provoca la pérdida del quórum como una prueba.</span><span class="sxs-lookup"><span data-stu-id="79a26-155">By using hello testability tools in Service Fabric, you can inject a fault that induces quorum loss as a test.</span></span> <span data-ttu-id="79a26-156">Aunque este escenario es poco frecuente, es importante que los clientes y servicios que dependen de un servicio con estado están preparados situaciones toohandle donde no pueden tomar tooit las solicitudes de escritura.</span><span class="sxs-lookup"><span data-stu-id="79a26-156">Although such a scenario is rare, it is important that clients and services that depend on a stateful service are prepared toohandle situations where they cannot make write requests tooit.</span></span> <span data-ttu-id="79a26-157">También es importante que el propio servicio con estado de hello es consciente de esta posibilidad y correctamente puede comunicarla toocallers.</span><span class="sxs-lookup"><span data-stu-id="79a26-157">It is also important that hello stateful service itself is aware of this possibility and can gracefully communicate it toocallers.</span></span>

<span data-ttu-id="79a26-158">Puede inducir la pérdida del quórum Hola PowerShell **ServiceFabricPartitionQuorumLoss Invoke** cmdlet:</span><span class="sxs-lookup"><span data-stu-id="79a26-158">You can induce quorum loss by using hello PowerShell **Invoke-ServiceFabricPartitionQuorumLoss** cmdlet:</span></span>

```powershell

PS > Invoke-ServiceFabricPartitionQuorumLoss -ServiceName fabric:/Myapplication/MyService -QuorumLossMode QuorumReplicas -QuorumLossDurationInSeconds 20

```

<span data-ttu-id="79a26-159">En este ejemplo, establecemos `QuorumLossMode` demasiado`QuorumReplicas` tooindicate que queremos pérdida del quórum tooinduce sin apagar todas las réplicas.</span><span class="sxs-lookup"><span data-stu-id="79a26-159">In this example, we set `QuorumLossMode` too`QuorumReplicas` tooindicate that we want tooinduce quorum loss without taking down all replicas.</span></span> <span data-ttu-id="79a26-160">De este modo, las operaciones de lectura sigan siendo posibles.</span><span class="sxs-lookup"><span data-stu-id="79a26-160">This way, read operations are still possible.</span></span> <span data-ttu-id="79a26-161">tootest un escenario donde una partición completa no está disponible, puede establecer este modificador demasiado`AllReplicas`.</span><span class="sxs-lookup"><span data-stu-id="79a26-161">tootest a scenario where an entire partition is unavailable, you can set this switch too`AllReplicas`.</span></span>

## <a name="next-steps"></a><span data-ttu-id="79a26-162">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="79a26-162">Next steps</span></span>
[<span data-ttu-id="79a26-163">Más información sobre las acciones de capacidad de prueba</span><span class="sxs-lookup"><span data-stu-id="79a26-163">Learn more about testability actions</span></span>](service-fabric-testability-actions.md)

[<span data-ttu-id="79a26-164">Más información sobre los escenarios de capacidad de prueba</span><span class="sxs-lookup"><span data-stu-id="79a26-164">Learn more about testability scenarios</span></span>](service-fabric-testability-scenarios.md)


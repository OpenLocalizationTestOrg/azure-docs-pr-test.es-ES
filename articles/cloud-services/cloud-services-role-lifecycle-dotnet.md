---
title: eventos de ciclo de vida de servicio de nube aaaHandle | Documentos de Microsoft
description: "Obtenga información acerca de cómo pueden usarse los métodos del ciclo de vida de Hola de un rol de servicio de nube en .NET"
services: cloud-services
documentationcenter: .net
author: Thraka
manager: timlt
editor: 
ms.assetid: 39b30acd-57b9-48b7-a7c4-40ea3430e451
ms.service: cloud-services
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/18/2017
ms.author: adegeo
ms.openlocfilehash: cc0ccc5f055b965202b6e081a6ab72ad5d39b034
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="customize-hello-lifecycle-of-a-web-or-worker-role-in-net"></a><span data-ttu-id="1cda4-103">Personalizar Hola del ciclo de vida de un rol Web o de trabajo en .NET</span><span class="sxs-lookup"><span data-stu-id="1cda4-103">Customize hello Lifecycle of a Web or Worker role in .NET</span></span>
<span data-ttu-id="1cda4-104">Cuando se crea un rol de trabajo, ampliar hello [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) clase que proporciona métodos de toooverride que le permite responder a eventos de toolifecycle.</span><span class="sxs-lookup"><span data-stu-id="1cda4-104">When you create a worker role, you extend hello [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) class which provides methods for you toooverride that let you respond toolifecycle events.</span></span> <span data-ttu-id="1cda4-105">Para los roles web esta clase es opcional, por lo que debe usar toorespond toolifecycle eventos.</span><span class="sxs-lookup"><span data-stu-id="1cda4-105">For web roles this class is optional, so you must use it toorespond toolifecycle events.</span></span>

## <a name="extend-hello-roleentrypoint-class"></a><span data-ttu-id="1cda4-106">Extender la clase de hello RoleEntryPoint</span><span class="sxs-lookup"><span data-stu-id="1cda4-106">Extend hello RoleEntryPoint class</span></span>
<span data-ttu-id="1cda4-107">Hola [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) clase incluye métodos que se llaman Azure cuando lo **inicia**, **ejecuta**, o **detiene** un rol web o de trabajo.</span><span class="sxs-lookup"><span data-stu-id="1cda4-107">hello [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) class includes methods that are called by Azure when it **starts**, **runs**, or **stops** a web or worker role.</span></span> <span data-ttu-id="1cda4-108">Opcionalmente, puede invalidar estos métodos toomanage rol inicialización, secuencias de apagado de rol o subproceso de ejecución de Hola de rol de Hola.</span><span class="sxs-lookup"><span data-stu-id="1cda4-108">You can optionally override these methods toomanage role initialization, role shutdown sequences, or hello execution thread of hello role.</span></span> 

<span data-ttu-id="1cda4-109">Al extender **RoleEntryPoint**, debe ser consciente de hello siguientes comportamientos de hello métodos:</span><span class="sxs-lookup"><span data-stu-id="1cda4-109">When extending **RoleEntryPoint**, you should be aware of hello following behaviors of hello methods:</span></span>

* <span data-ttu-id="1cda4-110">Hola [OnStart](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx) y [OnStop](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) métodos devuelven un valor booleano, por lo que es posible tooreturn **false** de estos métodos.</span><span class="sxs-lookup"><span data-stu-id="1cda4-110">hello [OnStart](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx) and [OnStop](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) methods return a boolean value, so it is possible tooreturn **false** from these methods.</span></span>
  
   <span data-ttu-id="1cda4-111">Si el código devuelve **false**, Hola rol proceso finaliza precipitadamente, sin ejecutar ninguna secuencia de cierre que pueda tener en su lugar.</span><span class="sxs-lookup"><span data-stu-id="1cda4-111">If your code returns **false**, hello role process is abruptly terminated, without running any shutdown sequence you may have in place.</span></span> <span data-ttu-id="1cda4-112">En general, se recomienda evitar devolver **false** de hello **OnStart** método.</span><span class="sxs-lookup"><span data-stu-id="1cda4-112">In general, you should avoid returning **false** from hello **OnStart** method.</span></span>
* <span data-ttu-id="1cda4-113">Cualquier excepción no detectada en una sobrecarga de un método **RoleEntryPoint** se trata como una excepción no controlada.</span><span class="sxs-lookup"><span data-stu-id="1cda4-113">Any uncaught exception within an overload of a **RoleEntryPoint** method is treated as an unhandled exception.</span></span>
  
   <span data-ttu-id="1cda4-114">Si se produce una excepción dentro de uno de los métodos del ciclo de vida de hello, Azure desencadenará hello [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) eventos, y, a continuación, se termina el proceso de Hola.</span><span class="sxs-lookup"><span data-stu-id="1cda4-114">If an exception occurs within one of hello lifecycle methods, Azure will raise hello [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) event, and then hello process is terminated.</span></span> <span data-ttu-id="1cda4-115">Tras la desconexión del rol, se reiniciará Azure.</span><span class="sxs-lookup"><span data-stu-id="1cda4-115">After your role has been taken offline, it will be restarted by Azure.</span></span> <span data-ttu-id="1cda4-116">Cuando una excepción no controlada se produce, hello [detener](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx) no se produce el evento y Hola **OnStop** no se llama el método.</span><span class="sxs-lookup"><span data-stu-id="1cda4-116">When an unhandled exception occurs, hello [Stopping](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx) event is not raised, and hello **OnStop** method is not called.</span></span>

<span data-ttu-id="1cda4-117">Si el rol no se inicia o se recicla entre Hola inicializando, ocupados y deteniendo Estados, el código puede producir una excepción no controlada dentro de uno de los eventos de ciclo de vida de Hola que se reinicia cada rol de Hola de tiempo.</span><span class="sxs-lookup"><span data-stu-id="1cda4-117">If your role does not start, or is recycling between hello initializing, busy, and stopping states, your code may be throwing an unhandled exception within one of hello lifecycle events each time hello role restarts.</span></span> <span data-ttu-id="1cda4-118">En este caso, utilice hello [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) eventos toodetermine Hola a causa de la excepción de Hola y administrarla correctamente.</span><span class="sxs-lookup"><span data-stu-id="1cda4-118">In this case, use hello [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) event toodetermine hello cause of hello exception and handle it appropriately.</span></span> <span data-ttu-id="1cda4-119">Puede que su rol también se puede devolver desde hello [ejecutar](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx) método, que hace que Hola rol toorestart.</span><span class="sxs-lookup"><span data-stu-id="1cda4-119">Your role may also be returning from hello [Run](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx) method, which causes hello role toorestart.</span></span> <span data-ttu-id="1cda4-120">Para obtener más información acerca de los Estados de implementación, consulte [tooRecycle problemas que causa Roles comunes](cloud-services-troubleshoot-common-issues-which-cause-roles-recycle.md).</span><span class="sxs-lookup"><span data-stu-id="1cda4-120">For more information about deployment states, see [Common Issues Which Cause Roles tooRecycle](cloud-services-troubleshoot-common-issues-which-cause-roles-recycle.md).</span></span>

> [!NOTE]
> <span data-ttu-id="1cda4-121">Si usas hello **Azure Tools para Microsoft Visual Studio** toodevelop su aplicación, plantillas de proyecto de rol de hello extienden automáticamente hello **RoleEntryPoint** clase Hola *WebRole.cs* y *WorkerRole.cs* archivos.</span><span class="sxs-lookup"><span data-stu-id="1cda4-121">If you are using hello **Azure Tools for Microsoft Visual Studio** toodevelop your application, hello role project templates automatically extend hello **RoleEntryPoint** class for you, in hello *WebRole.cs* and *WorkerRole.cs* files.</span></span>
> 
> 

## <a name="onstart-method"></a><span data-ttu-id="1cda4-122">Método OnStart</span><span class="sxs-lookup"><span data-stu-id="1cda4-122">OnStart method</span></span>
<span data-ttu-id="1cda4-123">Hola **OnStart** método se llama cuando la instancia de rol se pone en línea a Azure.</span><span class="sxs-lookup"><span data-stu-id="1cda4-123">hello **OnStart** method is called when your role instance is brought online by Azure.</span></span> <span data-ttu-id="1cda4-124">Mientras se está ejecutando código de OnStart hello, instancia de rol de Hola se marca como **ocupado** y ningún tráfico externo será dirigido tooit equilibrador de carga de Hola.</span><span class="sxs-lookup"><span data-stu-id="1cda4-124">While hello OnStart code is executing, hello role instance is marked as **Busy** and no external traffic will be directed tooit by hello load balancer.</span></span> <span data-ttu-id="1cda4-125">Puede invalidar este trabajo de inicialización tooperform de método, como implementar controladores de eventos e iniciar [diagnósticos de Azure](cloud-services-how-to-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="1cda4-125">You can override this method tooperform initialization work, such as implementing event handlers and starting [Azure Diagnostics](cloud-services-how-to-monitor.md).</span></span>

<span data-ttu-id="1cda4-126">Si **OnStart** devuelve **true**, Hola instancia se inicializó correctamente y Azure llama hello **RoleEntryPoint.Run** método.</span><span class="sxs-lookup"><span data-stu-id="1cda4-126">If **OnStart** returns **true**, hello instance is successfully initialized and Azure calls hello **RoleEntryPoint.Run** method.</span></span> <span data-ttu-id="1cda4-127">Si **OnStart** devuelve **false**, rol de hello termina inmediatamente, sin ejecutar las secuencias de apagado planeado.</span><span class="sxs-lookup"><span data-stu-id="1cda4-127">If **OnStart** returns **false**, hello role terminates immediately, without executing any planned shutdown sequences.</span></span>

<span data-ttu-id="1cda4-128">Hola siguiendo el ejemplo de código muestra cómo hello toooverride **OnStart** método.</span><span class="sxs-lookup"><span data-stu-id="1cda4-128">hello following code example shows how toooverride hello **OnStart** method.</span></span> <span data-ttu-id="1cda4-129">Este método configura e inicia el monitor de diagnóstico cuando la instancia de rol de Hola se inicia y se configura una transferencia del inicio de sesión de cuenta de almacenamiento de datos tooa:</span><span class="sxs-lookup"><span data-stu-id="1cda4-129">This method configures and starts a diagnostic monitor when hello role instance starts and sets up a transfer of logging data tooa storage account:</span></span>

```csharp
public override bool OnStart()
{
    var config = DiagnosticMonitor.GetDefaultInitialConfiguration();

    config.DiagnosticInfrastructureLogs.ScheduledTransferLogLevelFilter = LogLevel.Error;
    config.DiagnosticInfrastructureLogs.ScheduledTransferPeriod = TimeSpan.FromMinutes(5);

    DiagnosticMonitor.Start("DiagnosticsConnectionString", config);

    return true;
}
```

## <a name="onstop-method"></a><span data-ttu-id="1cda4-130">Método OnStop</span><span class="sxs-lookup"><span data-stu-id="1cda4-130">OnStop method</span></span>
<span data-ttu-id="1cda4-131">Hola **OnStop** método se llama después de una instancia de rol se ha desconectado por Azure y antes de que salga del proceso de Hola.</span><span class="sxs-lookup"><span data-stu-id="1cda4-131">hello **OnStop** method is called after a role instance has been taken offline by Azure and before hello process exits.</span></span> <span data-ttu-id="1cda4-132">Puede reemplazar este código de toocall método necesario para su toocleanly de instancia de rol apagar.</span><span class="sxs-lookup"><span data-stu-id="1cda4-132">You can override this method toocall code required for your role instance toocleanly shut down.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="1cda4-133">Código que se ejecuta en hello **OnStop** método tiene un período de tiempo limitado toofinish cuando se llama por motivos distintos a un cierre iniciado por el usuario.</span><span class="sxs-lookup"><span data-stu-id="1cda4-133">Code running in hello **OnStop** method has a limited time toofinish when it is called for reasons other than a user-initiated shutdown.</span></span> <span data-ttu-id="1cda4-134">Después de transcurrido este tiempo, Hola proceso finaliza, debe asegurarse de que el código de hello **OnStop** método puede ejecutarse rápidamente o que tolera toocompletion no se está ejecutando.</span><span class="sxs-lookup"><span data-stu-id="1cda4-134">After this time elapses, hello process is terminated, so you must make sure that code in hello **OnStop** method can run quickly or tolerates not running toocompletion.</span></span> <span data-ttu-id="1cda4-135">Hola **OnStop** método se llama después de hello **detener** evento se desencadena.</span><span class="sxs-lookup"><span data-stu-id="1cda4-135">hello **OnStop** method is called after hello **Stopping** event is raised.</span></span>
> 
> 

## <a name="run-method"></a><span data-ttu-id="1cda4-136">Método Run</span><span class="sxs-lookup"><span data-stu-id="1cda4-136">Run method</span></span>
<span data-ttu-id="1cda4-137">Puede invalidar hello **ejecutar** método tooimplement un subproceso de ejecución prolongada para la instancia de rol.</span><span class="sxs-lookup"><span data-stu-id="1cda4-137">You can override hello **Run** method tooimplement a long-running thread for your role instance.</span></span>

<span data-ttu-id="1cda4-138">Reemplazar hello **ejecutar** método no es necesario; la implementación predeterminada de hello inicia un subproceso que se mantiene en espera indefinidamente.</span><span class="sxs-lookup"><span data-stu-id="1cda4-138">Overriding hello **Run** method is not required; hello default implementation starts a thread that sleeps forever.</span></span> <span data-ttu-id="1cda4-139">Si invalida hello **ejecutar** método, el código debe bloquearse indefinidamente.</span><span class="sxs-lookup"><span data-stu-id="1cda4-139">If you do override hello **Run** method, your code should block indefinitely.</span></span> <span data-ttu-id="1cda4-140">Si hello **ejecutar** método devuelve, rol Hola se recicla automáticamente sin problemas; es decir, Azure desencadena hello **detener** Hola eventos y llamadas **OnStop** método para que se puedan ejecutar las secuencias de cierre antes Hola rol se quede sin conexión.</span><span class="sxs-lookup"><span data-stu-id="1cda4-140">If hello **Run** method returns, hello role is automatically gracefully recycled; in other words, Azure raises hello **Stopping** event and calls hello **OnStop** method so that your shutdown sequences may be executed before hello role is taken offline.</span></span>

### <a name="implementing-hello-aspnet-lifecycle-methods-for-a-web-role"></a><span data-ttu-id="1cda4-141">Implementar métodos de ciclo de vida ASP.NET de Hola para un rol web</span><span class="sxs-lookup"><span data-stu-id="1cda4-141">Implementing hello ASP.NET lifecycle methods for a web role</span></span>
<span data-ttu-id="1cda4-142">Puede utilizar métodos de ciclo de vida ASP.NET de hello, además proporciona hello toothose **RoleEntryPoint** de la clase, las secuencias de inicialización y cierre de toomanage para un rol web.</span><span class="sxs-lookup"><span data-stu-id="1cda4-142">You can use hello ASP.NET lifecycle methods, in addition toothose provided by hello **RoleEntryPoint** class, toomanage initialization and shutdown sequences for a web role.</span></span> <span data-ttu-id="1cda4-143">Esto puede ser útil con fines de compatibilidad si va a trasladar una tooAzure de aplicación de ASP.NET existente.</span><span class="sxs-lookup"><span data-stu-id="1cda4-143">This may be useful for compatibility purposes if you are porting an existing ASP.NET application tooAzure.</span></span> <span data-ttu-id="1cda4-144">métodos de ciclo de vida ASP.NET de Hola se llaman desde dentro de hello **RoleEntryPoint** métodos.</span><span class="sxs-lookup"><span data-stu-id="1cda4-144">hello ASP.NET lifecycle methods are called from within hello **RoleEntryPoint** methods.</span></span> <span data-ttu-id="1cda4-145">Hola **aplicación\_iniciar** método se llama después de hello **RoleEntryPoint.OnStart** método finaliza.</span><span class="sxs-lookup"><span data-stu-id="1cda4-145">hello **Application\_Start** method is called after hello **RoleEntryPoint.OnStart** method finishes.</span></span> <span data-ttu-id="1cda4-146">Hola **aplicación\_final** método se llama antes de hello **RoleEntryPoint.OnStop** se llama al método.</span><span class="sxs-lookup"><span data-stu-id="1cda4-146">hello **Application\_End** method is called before hello **RoleEntryPoint.OnStop** method is called.</span></span>

## <a name="next-steps"></a><span data-ttu-id="1cda4-147">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="1cda4-147">Next steps</span></span>
<span data-ttu-id="1cda4-148">Obtenga información acerca de cómo demasiado[crear un paquete de servicios de nube](cloud-services-model-and-package.md).</span><span class="sxs-lookup"><span data-stu-id="1cda4-148">Learn how too[create a cloud service package](cloud-services-model-and-package.md).</span></span>


---
title: Causas comunes del reciclado de roles del servicio en la nube | Microsoft Docs
description: "Un rol del servicio en la nube que se recicla repentinamente puede causar un considerable tiempo de inactividad. A continuación encontrará algunos de los problemas comunes que provocan el reciclaje de los roles, lo que le ayudará a reducir el tiempo de inactividad."
services: cloud-services
documentationcenter: 
author: simonxjx
manager: felixwu
editor: 
tags: top-support-issue
ms.assetid: 533930d1-8035-4402-b16a-cf887b2c4f85
ms.service: cloud-services
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: tbd
ms.date: 7/26/2017
ms.author: v-six
ms.openlocfilehash: e55009c72b977ee4a30f6c71043bde483849f78f
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/29/2017
---
# <a name="common-issues-that-cause-roles-to-recycle"></a><span data-ttu-id="f5d56-104">Problemas comunes que causan el reciclaje de los roles</span><span class="sxs-lookup"><span data-stu-id="f5d56-104">Common issues that cause roles to recycle</span></span>
<span data-ttu-id="f5d56-105">En este artículo se describen algunas de las causas comunes de problemas relacionados con la implementación y se proporcionan sugerencias para la resolución de dichos problemas.</span><span class="sxs-lookup"><span data-stu-id="f5d56-105">This article discusses some of the common causes of deployment problems and provides troubleshooting tips to help you resolve these problems.</span></span> <span data-ttu-id="f5d56-106">Aparece una indicación de que existe un problema con una aplicación cuando la instancia de rol no se inicia o cuando alterna entre los estados inicializando, ocupado y deteniendo.</span><span class="sxs-lookup"><span data-stu-id="f5d56-106">An indication that a problem exists with an application is when the role instance fails to start, or it cycles between the initializing, busy, and stopping states.</span></span>

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

## <a name="missing-runtime-dependencies"></a><span data-ttu-id="f5d56-107">Dependencias en tiempo de ejecución que faltan</span><span class="sxs-lookup"><span data-stu-id="f5d56-107">Missing runtime dependencies</span></span>
<span data-ttu-id="f5d56-108">Si un rol de la aplicación se basa en algún ensamblado que no forma parte de .NET Framework o de la biblioteca administrada de Azure, debe incluir explícitamente ese ensamblado en el paquete de aplicación.</span><span class="sxs-lookup"><span data-stu-id="f5d56-108">If a role in your application relies on any assembly that is not part of the .NET Framework or the Azure managed library, you must explicitly include that assembly in the application package.</span></span> <span data-ttu-id="f5d56-109">Tenga presente que otros marcos de trabajo de Microsoft no están disponibles en Azure de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="f5d56-109">Keep in mind that other Microsoft frameworks are not available on Azure by default.</span></span> <span data-ttu-id="f5d56-110">Si el rol se basa en uno de esos marcos de trabajo, debe agregar esos ensamblados al paquete de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f5d56-110">If your role relies on such a framework, you must add those assemblies to the application package.</span></span>

<span data-ttu-id="f5d56-111">Antes de compilar y empaquetar la aplicación, compruebe lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="f5d56-111">Before you build and package your application, verify the following:</span></span>

* <span data-ttu-id="f5d56-112">Si usa Visual Studio, asegúrese de que la propiedad **Copy Local** se establece en **True** para cada ensamblado del proyecto que no forme parte de Azure SDK o de .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="f5d56-112">If using Visual studio, make sure the **Copy Local** property is set to **True** for each referenced assembly in your project that is not part of the Azure SDK or the .NET Framework.</span></span>
* <span data-ttu-id="f5d56-113">Asegúrese de que el archivo web.config no hace referencia a ningún ensamblado sin usar en el elemento de compilación.</span><span class="sxs-lookup"><span data-stu-id="f5d56-113">Make sure the web.config file does not reference any unused assemblies in the compilation element.</span></span>
* <span data-ttu-id="f5d56-114">El elemento **Build Action** de cada archivo .cshtml se establece en **Content**.</span><span class="sxs-lookup"><span data-stu-id="f5d56-114">The **Build Action** of every .cshtml file is set to **Content**.</span></span> <span data-ttu-id="f5d56-115">Esto garantiza que los archivos aparecerán correctamente en el paquete y permite que otros archivos referenciados aparezcan en el paquete.</span><span class="sxs-lookup"><span data-stu-id="f5d56-115">This ensures that the files will appear correctly in the package and enables other referenced files to appear in the package.</span></span>

## <a name="assembly-targets-wrong-platform"></a><span data-ttu-id="f5d56-116">El ensamblado tiene como destino la plataforma equivocada</span><span class="sxs-lookup"><span data-stu-id="f5d56-116">Assembly targets wrong platform</span></span>
<span data-ttu-id="f5d56-117">Azure es un entorno de 64 bits.</span><span class="sxs-lookup"><span data-stu-id="f5d56-117">Azure is a 64-bit environment.</span></span> <span data-ttu-id="f5d56-118">Por lo tanto, los ensamblados de .NET compilados para un destino de 32 bits no funcionarán en Azure.</span><span class="sxs-lookup"><span data-stu-id="f5d56-118">Therefore, .NET assemblies compiled for a 32-bit target won't work on Azure.</span></span>

## <a name="role-throws-unhandled-exceptions-while-initializing-or-stopping"></a><span data-ttu-id="f5d56-119">El rol genera excepciones no controladas cuando se inicializa o se detiene</span><span class="sxs-lookup"><span data-stu-id="f5d56-119">Role throws unhandled exceptions while initializing or stopping</span></span>
<span data-ttu-id="f5d56-120">Todas las excepciones iniciadas por los métodos de la clase [RoleEntryPoint], que incluye los métodos [OnStart], [OnStop] y [Run], son excepciones no controladas.</span><span class="sxs-lookup"><span data-stu-id="f5d56-120">Any exceptions that are thrown by the methods of the [RoleEntryPoint] class, which includes the [OnStart], [OnStop], and [Run] methods, are unhandled exceptions.</span></span> <span data-ttu-id="f5d56-121">Si se produce una excepción no controlada en uno de estos métodos, el rol se reciclará.</span><span class="sxs-lookup"><span data-stu-id="f5d56-121">If an unhandled exception occurs in one of these methods, the role will recycle.</span></span> <span data-ttu-id="f5d56-122">Si el rol se recicla de forma repetida, es posible que inicie una excepción no controlada cada vez que intente iniciarse.</span><span class="sxs-lookup"><span data-stu-id="f5d56-122">If the role is recycling repeatedly, it may be throwing an unhandled exception each time it tries to start.</span></span>

## <a name="role-returns-from-run-method"></a><span data-ttu-id="f5d56-123">El rol se devuelve del método Run</span><span class="sxs-lookup"><span data-stu-id="f5d56-123">Role returns from Run method</span></span>
<span data-ttu-id="f5d56-124">El método [Run] está pensado para que se ejecute indefinidamente.</span><span class="sxs-lookup"><span data-stu-id="f5d56-124">The [Run] method is intended to run indefinitely.</span></span> <span data-ttu-id="f5d56-125">Si el código invalida el método [Run] , podría quedar inactivo indefinidamente.</span><span class="sxs-lookup"><span data-stu-id="f5d56-125">If your code overrides the [Run] method, it should sleep indefinitely.</span></span> <span data-ttu-id="f5d56-126">Si se devuelve el método [Run] , el rol se recicla.</span><span class="sxs-lookup"><span data-stu-id="f5d56-126">If the [Run] method returns, the role recycles.</span></span>

## <a name="incorrect-diagnosticsconnectionstring-setting"></a><span data-ttu-id="f5d56-127">Configuración incorrecta de DiagnosticsConnectionString</span><span class="sxs-lookup"><span data-stu-id="f5d56-127">Incorrect DiagnosticsConnectionString setting</span></span>
<span data-ttu-id="f5d56-128">Si la aplicación usa Diagnósticos de Azure, el archivo de configuración de servicio debe especificar el valor de configuración de `DiagnosticsConnectionString` .</span><span class="sxs-lookup"><span data-stu-id="f5d56-128">If application uses Azure Diagnostics, your service configuration file must specify the `DiagnosticsConnectionString` configuration setting.</span></span> <span data-ttu-id="f5d56-129">Este valor debe especificar una conexión HTTPS a la cuenta de almacenamiento de Azure.</span><span class="sxs-lookup"><span data-stu-id="f5d56-129">This setting should specify an HTTPS connection to your storage account in Azure.</span></span>

<span data-ttu-id="f5d56-130">Para asegurarse de que el valor de `DiagnosticsConnectionString` sea correcto antes de implementar el paquete de aplicación en Azure, compruebe lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="f5d56-130">To ensure that your `DiagnosticsConnectionString` setting is correct before you deploy your application package to Azure, verify the following:</span></span>  

* <span data-ttu-id="f5d56-131">El valor de `DiagnosticsConnectionString` apunta a una cuenta de almacenamiento válida de Azure.</span><span class="sxs-lookup"><span data-stu-id="f5d56-131">The `DiagnosticsConnectionString` setting points to a valid storage account in Azure.</span></span>  
  <span data-ttu-id="f5d56-132">De forma predeterminada, este valor apunta a la cuenta de almacenamiento emulado, por lo que debe cambiar explícitamente esta configuración antes de implementar el paquete de aplicación.</span><span class="sxs-lookup"><span data-stu-id="f5d56-132">By default, this setting points to the emulated storage account, so you must explicitly change this setting before you deploy your application package.</span></span> <span data-ttu-id="f5d56-133">Si no cambia este valor, se produce una excepción cuando la instancia de rol intenta iniciar al monitor de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="f5d56-133">If you do not change this setting, an exception is thrown when the role instance attempts to start the diagnostic monitor.</span></span> <span data-ttu-id="f5d56-134">Esto puede hacer que la instancia de rol se recicle indefinidamente.</span><span class="sxs-lookup"><span data-stu-id="f5d56-134">This may cause the role instance to recycle indefinitely.</span></span>
* <span data-ttu-id="f5d56-135">La cadena de conexión se especifica en el siguiente [formato](../storage/common/storage-configure-connection-string.md).</span><span class="sxs-lookup"><span data-stu-id="f5d56-135">The connection string is specified in the following [format](../storage/common/storage-configure-connection-string.md).</span></span> <span data-ttu-id="f5d56-136">(El protocolo debe especificarse como HTTPS). Reemplace *MyAccountName* por el nombre de su cuenta de almacenamiento y *MyAccountKey* por la clave de acceso de su cuenta:</span><span class="sxs-lookup"><span data-stu-id="f5d56-136">(The protocol must be specified as HTTPS.) Replace *MyAccountName* with the name of your storage account, and *MyAccountKey* with your access key:</span></span>    

        DefaultEndpointsProtocol=https;AccountName=MyAccountName;AccountKey=MyAccountKey

  <span data-ttu-id="f5d56-137">Si está desarrollando una aplicación con Azure Tools para Microsoft Visual Studio, puede usar las páginas de propiedades para establecer este valor.</span><span class="sxs-lookup"><span data-stu-id="f5d56-137">If you are developing your application by using Azure Tools for Microsoft Visual Studio, you can use the property pages to set this value.</span></span>

## <a name="exported-certificate-does-not-include-private-key"></a><span data-ttu-id="f5d56-138">El certificado exportado no incluye una clave privada</span><span class="sxs-lookup"><span data-stu-id="f5d56-138">Exported certificate does not include private key</span></span>
<span data-ttu-id="f5d56-139">Para ejecutar un rol web con SSL, debe asegurarse de que el certificado de administración exportado incluye la clave privada.</span><span class="sxs-lookup"><span data-stu-id="f5d56-139">To run a web role under SSL, you must ensure that your exported management certificate includes the private key.</span></span> <span data-ttu-id="f5d56-140">Si usa el *administrador de certificados de Windows* para exportar el certificado, asegúrese de seleccionar **Sí** en la opción **Exportar la clave privada**.</span><span class="sxs-lookup"><span data-stu-id="f5d56-140">If you use the *Windows Certificate Manager* to export the certificate, be sure to select **Yes** for the **Export the private key** option.</span></span> <span data-ttu-id="f5d56-141">El certificado se debe exportar al formato PFX, que es el único formato que se admite actualmente.</span><span class="sxs-lookup"><span data-stu-id="f5d56-141">The certificate must be exported in the PFX format, which is the only format currently supported.</span></span>

## <a name="next-steps"></a><span data-ttu-id="f5d56-142">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="f5d56-142">Next steps</span></span>
<span data-ttu-id="f5d56-143">Vea más [artículos de solución de problemas](https://azure.microsoft.com/documentation/articles/?tag=top-support-issue&product=cloud-services) para servicios en la nube.</span><span class="sxs-lookup"><span data-stu-id="f5d56-143">View more [troubleshooting articles](https://azure.microsoft.com/documentation/articles/?tag=top-support-issue&product=cloud-services) for cloud services.</span></span>

<span data-ttu-id="f5d56-144">En la [series de blogs de Kevin Williamson](http://blogs.msdn.com/b/kwill/archive/2013/08/09/windows-azure-paas-compute-diagnostics-data.aspx)puede ver más escenarios de reciclaje de roles.</span><span class="sxs-lookup"><span data-stu-id="f5d56-144">View more role recycling scenarios at [Kevin Williamson's blog series](http://blogs.msdn.com/b/kwill/archive/2013/08/09/windows-azure-paas-compute-diagnostics-data.aspx).</span></span>

[RoleEntryPoint]: https://msdn.microsoft.com/library/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx
[OnStart]: https://msdn.microsoft.com/library/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx
[OnStop]: https://msdn.microsoft.com/library/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx
[Run]: https://msdn.microsoft.com/library/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx

---
title: Solucionar problemas de Cloud Services con Application Insights | Microsoft Docs
description: "Aprenda a solucionar problemas del servicio en la nube mediante el uso de Application Insights para procesar datos de Diagnósticos de Azure."
services: cloud-services
documentationcenter: .net
author: sbtron
manager: timlt
editor: tysonn
ms.assetid: e93f387b-ef29-4731-ae41-0676722accb6
ms.service: cloud-services
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/23/2017
ms.author: saurabh
ms.openlocfilehash: 4001ca908ff00b1a40829d687589080e9b07b18a
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="troubleshoot-cloud-services-using-application-insights"></a><span data-ttu-id="e8d6f-103">Solucionar problemas de Servicios en la nube con Application Insights</span><span class="sxs-lookup"><span data-stu-id="e8d6f-103">Troubleshoot Cloud Services using Application Insights</span></span>
<span data-ttu-id="e8d6f-104">Con [Azure SDK 2.8](https://azure.microsoft.com/downloads/) y la extensión 1.5 de Diagnósticos de Azure puede enviar los datos de Diagnósticos de Azure para su servicio en la nube directamente a Application Insights.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-104">With [Azure SDK 2.8](https://azure.microsoft.com/downloads/) and Azure diagnostics extension 1.5, you can send Azure Diagnostics data for your Cloud Service directly to Application Insights.</span></span> <span data-ttu-id="e8d6f-105">Los registros recopilados por Azure Diagnostics, incluidos los registros de aplicaciones, los registros de eventos de Windows, los registros de ETW y los contadores de rendimiento, pueden enviarse a Application Insights.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-105">The logs collected by Azure Diagnostics&mdash;including application logs, Windows Event Logs, ETW Logs, and performance counters&mdash;can be sent to Application Insights.</span></span> <span data-ttu-id="e8d6f-106">Después podrá visualizar esta información en la interfaz de usuario del portal de Application Insights.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-106">You can then visualize this information in the Application Insights portal UI.</span></span> <span data-ttu-id="e8d6f-107">Podrá usar el SDK de Application Insights para obtener información sobre las métricas y los registros de la aplicación, y sobre los datos del sistema y de la infraestructura procedentes de Diagnósticos de Azure.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-107">You can then use the Application Insights SDK to get insights into metrics and logs that come from your application, as well as the system and infrastructure-level data that comes from Azure Diagnostics.</span></span>

## <a name="configure-azure-diagnostics-to-send-data-to-application-insights"></a><span data-ttu-id="e8d6f-108">Configuración de Diagnósticos de Azure para enviar datos a Application Insights</span><span class="sxs-lookup"><span data-stu-id="e8d6f-108">Configure Azure Diagnostics to send data to Application Insights</span></span>
<span data-ttu-id="e8d6f-109">Siga estos pasos para configurar el proyecto del servicio en la nube para enviar datos de Diagnósticos de Azure a Application Insights.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-109">Follow these steps to set up your cloud service project to send Azure Diagnostics data to Application Insights.</span></span>

1. <span data-ttu-id="e8d6f-110">En el Explorador de soluciones de Visual Studio, haga clic con el botón derecho en un rol y seleccione **Propiedades** para abrir el diseñador de roles.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-110">In Visual Studio Solution Explorer, right-click a role and select **Properties** to open the Role designer.</span></span>

    ![Propiedades de rol del Explorador de soluciones][1]

2. <span data-ttu-id="e8d6f-112">En la sección **Diagnósticos** del diseñador de roles, seleccione la opción **Enviar datos de diagnóstico a Application Insights**.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-112">In the **Diagnostics** section of the Role designer, select the **Send diagnostics data to Application Insights** option.</span></span>

    ![Diseñador de roles Enviar datos de diagnóstico a application insights][2]

3. <span data-ttu-id="e8d6f-114">En el cuadro de diálogo que aparece, seleccione el recurso de Application Insights al que le gustaría enviar los datos de Diagnósticos de Azure.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-114">In the dialog box that pops up, select the Application Insights resource that you want to send the Azure diagnostics data to.</span></span> <span data-ttu-id="e8d6f-115">El cuadro de diálogo le permite seleccionar un recurso de Application Insights existente en la suscripción o especificar manualmente una clave de instrumentación para un recurso de Application Insights.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-115">The dialog box allows you to select an existing Application Insights resource from your subscription or to manually specify an instrumentation key for an Application Insights resource.</span></span> <span data-ttu-id="e8d6f-116">Para más información sobre la creación de un recurso de Application Insights, consulte [Creación de recursos en Application Insights](../application-insights/app-insights-create-new-resource.md).</span><span class="sxs-lookup"><span data-stu-id="e8d6f-116">For more information on creating an Application Insights resource, see [Create a new Application Insights resource](../application-insights/app-insights-create-new-resource.md).</span></span>

    ![seleccionar recurso de application insights][3]

    <span data-ttu-id="e8d6f-118">Cuando haya agregado el recurso de Application Insights, la clave de instrumentación para ese recurso se almacenará como un valor de configuración de servicio con el nombre **APPINSIGHTS_INSTRUMENTATIONKEY**.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-118">Once you have added the Application Insights resource, the instrumentation key for that resource is stored as a service configuration setting with the name **APPINSIGHTS_INSTRUMENTATIONKEY**.</span></span> <span data-ttu-id="e8d6f-119">Puede cambiar esta opción para cada configuración de servicio o de entorno.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-119">You can change this configuration setting for each service configuration or environment.</span></span> <span data-ttu-id="e8d6f-120">Para ello, seleccione una configuración diferente de la lista **Configuración del servicio** y especifique una nueva clave de instrumentación para esa configuración.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-120">To do so, select a different configuration from the **Service Configuration** list and specify a new instrumentation key for that configuration.</span></span>

    ![seleccionar configuración de servicio][4]

    <span data-ttu-id="e8d6f-122">Visual Studio usa el valor de configuración **APPINSIGHTS_INSTRUMENTATIONKEY** para configurar la extensión de diagnósticos con la información de recursos apropiada de Application Insights durante la publicación.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-122">The **APPINSIGHTS_INSTRUMENTATIONKEY** configuration setting is used by Visual Studio to configure the diagnostics extension with the appropriate Application Insights resource information during publishing.</span></span> <span data-ttu-id="e8d6f-123">El valor de configuración es una manera cómoda de definir claves de instrumentación diferentes para distintas configuraciones del servicio.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-123">The configuration setting is a convenient way of defining different instrumentation keys for different service configurations.</span></span> <span data-ttu-id="e8d6f-124">Visual Studio traducirá ese valor y lo insertará en la configuración pública de la extensión de diagnósticos en durante la publicación.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-124">Visual Studio will translate that setting and insert it into the diagnostics extension public configuration during the publish process.</span></span> <span data-ttu-id="e8d6f-125">Para simplificar el proceso de configuración de la extensión de diagnósticos con PowerShell, la salida del paquete de Visual Studio también contiene el XML de configuración público con la clave de instrumentación de Application Insights correspondiente.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-125">To simplify the process of configuring the diagnostics extension with PowerShell, the package output from Visual Studio also contains the public configuration XML with the appropriate Application Insights instrumentation key.</span></span> <span data-ttu-id="e8d6f-126">Los archivos de configuración públicos se crean en la carpeta Extensiones y siguen el patrón *PaaSDiagnostics.&lt;NombreDelRol&gt;.PubConfig.xml*.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-126">The public config files are created in the Extensions folder and follow the pattern *PaaSDiagnostics.&lt;RoleName&gt;.PubConfig.xml*.</span></span> <span data-ttu-id="e8d6f-127">Cualquier implementación basada en PowerShell puede usar este patrón para asignar cada configuración a un rol.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-127">Any PowerShell-based deployments can use this pattern to map each configuration to a role.</span></span>

4) <span data-ttu-id="e8d6f-128">Al habilitar **Enviar datos de diagnóstico a Application Insights** configurará automáticamente Diagnósticos de Azure para enviar todos los contadores de rendimiento y registros de nivel de error que recopila el agente de Diagnósticos de Azure a Application Insights.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-128">To configure Azure diagnostics to send all performance counters and error-level logs collected by the Azure diagnostics agent to Application Insights, enable the **Send diagnostics data to Application Insights** option.</span></span> 

    <span data-ttu-id="e8d6f-129">Si desea configurar qué datos se envían a Application Insights, debe editar manualmente el archivo *diagnostics.wadcfgx* para cada rol.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-129">If you want to further configure what data is sent to Application Insights, you must manually edit the *diagnostics.wadcfgx* file for each role.</span></span> <span data-ttu-id="e8d6f-130">Consulte [Configuración de Diagnósticos de Azure para enviar datos a Application Insights](#configure-azure-diagnostics-to-send-data-to-application-insights) para obtener más información sobre cómo actualizar manualmente la configuración.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-130">See [Configure Azure Diagnostics to send data to Application Insights](#configure-azure-diagnostics-to-send-data-to-application-insights) to learn more about manually updating the configuration.</span></span>

<span data-ttu-id="e8d6f-131">Una vez configurado el servicio en la nube para enviar datos de Diagnósticos de Azure a Application Insights, puede implementarlo en Azure como lo haría normalmente, asegurándose de que la extensión de Diagnósticos de Azure está habilitada.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-131">When the cloud service is configured to send Azure diagnostics data to application insights, you can deploy it to Azure normally, making sure the Azure diagnostics extension is enabled.</span></span> <span data-ttu-id="e8d6f-132">Para más información, consulte el artículo de [Publicación de un servicio en la nube con Visual Studio](../vs-azure-tools-publishing-a-cloud-service.md).</span><span class="sxs-lookup"><span data-stu-id="e8d6f-132">For more information, see  [Publishing a Cloud Service using Visual Studio](../vs-azure-tools-publishing-a-cloud-service.md).</span></span>  

## <a name="viewing-azure-diagnostics-data-in-application-insights"></a><span data-ttu-id="e8d6f-133">Visualización de datos de Diagnósticos de Azure en Application Insights</span><span class="sxs-lookup"><span data-stu-id="e8d6f-133">Viewing Azure diagnostics data in Application Insights</span></span>
<span data-ttu-id="e8d6f-134">La telemetría de Diagnósticos de Azure aparecerá en el recurso de Application Insights configurado para el servicio en la nube.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-134">The Azure diagnostic telemetry shows up in the Application Insights resource configured for your cloud service.</span></span>

<span data-ttu-id="e8d6f-135">Los distintos tipos de registro de Diagnósticos de Azure se asignan a los conceptos de Application Insights de las maneras siguientes:</span><span class="sxs-lookup"><span data-stu-id="e8d6f-135">Azure diagnostics log types map to Application Insights concepts in these ways:</span></span>

* <span data-ttu-id="e8d6f-136">Los contadores de rendimiento se muestran como métricas personalizadas en Application Insights.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-136">Performance counters are displayed as Custom Metrics in Application Insights.</span></span>
* <span data-ttu-id="e8d6f-137">Los registros de eventos de Windows se muestran como seguimientos y eventos personalizados en Application Insights.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-137">Windows Event Logs are shown as Traces and Custom Events in Application Insights.</span></span>
* <span data-ttu-id="e8d6f-138">Los registros de aplicación, los registros de ETW y los registros de infraestructura de diagnóstico se muestran como seguimientos en Application Insights.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-138">Application logs, ETW logs, and any Diagnostics Infrastructure logs are shown as Traces in Application Insights.</span></span>

<span data-ttu-id="e8d6f-139">Para ver de datos de Diagnósticos de Azure en Application Insights, tiene las siguientes opciones:</span><span class="sxs-lookup"><span data-stu-id="e8d6f-139">To view Azure diagnostics data in Application Insights, do one of the following:</span></span>

* <span data-ttu-id="e8d6f-140">Use el [Explorador de métricas](../application-insights/app-insights-metrics-explorer.md) para visualizar los contadores de rendimiento personalizados o los recuentos de diferentes tipos de eventos del registro de eventos de Windows.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-140">Use [Metrics explorer](../application-insights/app-insights-metrics-explorer.md) to visualize any custom performance counters or counts of different types of Windows Event Log events.</span></span>

    ![Métricas personalizadas en el Explorador de métricas][5]

* <span data-ttu-id="e8d6f-142">Use [Búsqueda](../application-insights/app-insights-diagnostic-search.md) para buscar en los registros de seguimiento enviados por Diagnósticos de Azure.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-142">Use [Search](../application-insights/app-insights-diagnostic-search.md) to search across the  trace logs sent by Azure Diagnostics.</span></span> <span data-ttu-id="e8d6f-143">Por ejemplo, si una excepción no controlada ha provocado el bloqueo de un rol y el reciclado, la información sobre la excepción aparece en el canal *Aplicación* del *registro de eventos de Windows*.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-143">For example, if an unhandled exception has caused the role to crash and recycle, information about the exception shows up in the *Application* channel of *Windows Event Log*.</span></span> <span data-ttu-id="e8d6f-144">Puede utilizar la funcionalidad de búsqueda para ver el error del registro de eventos de Windows y obtener el seguimiento de la pila completo de la excepción para encontrar la causa del problema.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-144">You can use search to look at the Windows Event Log error and get the full stack trace for the exception to help find the cause of the issue.</span></span>

    ![Buscar seguimientos][6]

## <a name="next-steps"></a><span data-ttu-id="e8d6f-146">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="e8d6f-146">Next Steps</span></span>
* <span data-ttu-id="e8d6f-147">[Agregar el SDK de Application Insights a su servicio en la nube](../application-insights/app-insights-cloudservices.md) para enviar datos acerca de solicitudes, excepciones, dependencias y cualquier telemetría personalizada desde la aplicación.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-147">[Add the Application Insights SDK to your cloud service](../application-insights/app-insights-cloudservices.md) to send data about requests, exceptions, dependencies, and any custom telemetry from your application.</span></span> <span data-ttu-id="e8d6f-148">Junto con los datos de Diagnósticos de Azure puede obtener una vista completa de la aplicación y el sistema en el mismo recurso de Application Insights.</span><span class="sxs-lookup"><span data-stu-id="e8d6f-148">When combined with the Azure Diagnostics data, this information you can get a complete view of your application and system, all in the same Application Insight resource.</span></span>  

<!--Image references-->
[1]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/solution-explorer-properties.png
[2]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/role-designer-sendtoappinsights.png
[3]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/select-appinsights-resource.png
[4]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/role-designer-appinsights-serviceconfig.png
[5]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/metrics-explorer-custom-metrics.png
[6]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/search-windowseventlog-error.png

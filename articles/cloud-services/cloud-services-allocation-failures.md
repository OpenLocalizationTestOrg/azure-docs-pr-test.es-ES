---
title: "Solución de errores de asignación de servicio en la nube | Microsoft Docs"
description: "Solución de errores de asignación al implementar Servicios en la nube de Azure"
services: azure-service-management, cloud-services
documentationcenter: 
author: simonxjx
manager: felixwu
editor: 
tags: top-support-issue
ms.assetid: 529157eb-e4a1-4388-aa2b-09e8b923af74
ms.service: cloud-services
ms.workload: na
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: article
ms.date: 7/26/2017
ms.author: v-six
ms.openlocfilehash: 3379b6d9bea874abecae7e56d30cfb15e6b0c2fc
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/03/2017
---
# <a name="troubleshooting-allocation-failure-when-you-deploy-cloud-services-in-azure"></a><span data-ttu-id="1c1f9-103">Solución de errores de asignación al implementar Servicios en la nube de Azure</span><span class="sxs-lookup"><span data-stu-id="1c1f9-103">Troubleshooting allocation failure when you deploy Cloud Services in Azure</span></span>
## <a name="summary"></a><span data-ttu-id="1c1f9-104">Resumen</span><span class="sxs-lookup"><span data-stu-id="1c1f9-104">Summary</span></span>
<span data-ttu-id="1c1f9-105">Al implementar instancias en un servicio en la nube o agregar nuevas instancias de rol de trabajo o web, Microsoft Azure asigna recursos de proceso.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-105">When you deploy instances to a Cloud Service or add new web or worker role instances, Microsoft Azure allocates compute resources.</span></span> <span data-ttu-id="1c1f9-106">En ocasiones, es posible que reciba errores a realizar estas operaciones incluso antes de llegar a los límites de la suscripción de Azure.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-106">You may occasionally receive errors when performing these operations even before you reach the Azure subscription limits.</span></span> <span data-ttu-id="1c1f9-107">En este artículo se explican las causas de algunos de los errores de asignación más comunes y se sugieren posibles soluciones.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-107">This article explains the causes of some of the common allocation failures and suggests possible remediation.</span></span> <span data-ttu-id="1c1f9-108">La información también puede ser útil si tiene pensado realizar la implementación de sus servicios.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-108">The information may also be useful when you plan the deployment of your services.</span></span>

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

### <a name="background--how-allocation-works"></a><span data-ttu-id="1c1f9-109">Información de contexto: cómo funciona la asignación</span><span class="sxs-lookup"><span data-stu-id="1c1f9-109">Background – How allocation works</span></span>
<span data-ttu-id="1c1f9-110">Los servidores de los centros de datos de Azure están particionados en clústeres.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-110">The servers in Azure datacenters are partitioned into clusters.</span></span> <span data-ttu-id="1c1f9-111">Se intenta una nueva solicitud de asignación de servicio en la nube en varios clústeres.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-111">A new cloud service allocation request is attempted in multiple clusters.</span></span> <span data-ttu-id="1c1f9-112">Cuando se implementa la primera instancia a un servicio en la nube (ya sea en ensayo o producción), ese servicio en la nube se ancla a un clúster.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-112">When the first instance is deployed to a cloud service(in either staging or production), that cloud service gets pinned to a cluster.</span></span> <span data-ttu-id="1c1f9-113">Todas las implementaciones posteriores para el servicio en la nube tendrán lugar en el mismo clúster.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-113">Any further deployments for the cloud service will happen in the same cluster.</span></span> <span data-ttu-id="1c1f9-114">En este artículo, haremos referencia a esto como que la solicitud está "anclada a un clúster".</span><span class="sxs-lookup"><span data-stu-id="1c1f9-114">In this article, we'll refer to this as "pinned to a cluster".</span></span> <span data-ttu-id="1c1f9-115">En el diagrama 1 siguiente se ilustra el caso de una asignación normal que se intenta en varios clústeres; en el diagrama 2 se ilustra el caso de una asignación que está anclada al clúster 2 porque es ahí donde se hospeda el servicio en la nube CS_1.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-115">Diagram 1 below illustrates the case of a normal allocation which is attempted in multiple clusters; Diagram 2 illustrates the case of an allocation that's pinned to Cluster 2 because that's where the existing Cloud Service CS_1 is hosted.</span></span>

![Diagrama de asignación](./media/cloud-services-allocation-failure/Allocation1.png)

### <a name="why-allocation-failure-happens"></a><span data-ttu-id="1c1f9-117">¿Por qué se producen errores de asignación?</span><span class="sxs-lookup"><span data-stu-id="1c1f9-117">Why allocation failure happens</span></span>
<span data-ttu-id="1c1f9-118">Cuando una solicitud de asignación está anclada a un clúster, existe una posibilidad menor de encontrar recursos libres dado que el grupo de recursos disponible se limita a un clúster.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-118">When an allocation request is pinned to a cluster, there's a higher chance of failing to find free resources since the available resource pool is limited to a cluster.</span></span> <span data-ttu-id="1c1f9-119">Además, si la solicitud de asignación está anclada a un clúster pero el tipo de recurso que solicita no se admite en ese clúster, la solicitud dará error aunque el clúster tenga recursos libres.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-119">Furthermore, if your allocation request is pinned to a cluster but the type of resource you requested is not supported by that cluster, your request will fail even if the cluster has free resource.</span></span> <span data-ttu-id="1c1f9-120">En el diagrama 3 a continuación se ilustra el caso en el que una asignación anclada da error porque el único clúster candidato no tiene recursos libres.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-120">Diagram 3 below illustrates the case where a pinned allocation fails because the only candidate cluster does not have free resources.</span></span> <span data-ttu-id="1c1f9-121">En el diagrama 4 se ilustra el caso en el que una asignación anclada da error porque el único clúster candidato no admite el tamaño de VM solicitado, a pesar de que el clúster tiene recursos libres.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-121">Diagram 4 illustrates the case where a pinned allocation fails because the only candidate cluster does not support the requested VM size, even though the cluster has free resources.</span></span>

![Error de asignaciones ancladas](./media/cloud-services-allocation-failure/Allocation2.png)

## <a name="troubleshooting-allocation-failure-for-cloud-services"></a><span data-ttu-id="1c1f9-123">Solución de errores de asignación para servicios en la nube</span><span class="sxs-lookup"><span data-stu-id="1c1f9-123">Troubleshooting allocation failure for cloud services</span></span>
### <a name="error-message"></a><span data-ttu-id="1c1f9-124">Mensaje de error</span><span class="sxs-lookup"><span data-stu-id="1c1f9-124">Error Message</span></span>
<span data-ttu-id="1c1f9-125">Puede ver el siguiente mensaje de error:</span><span class="sxs-lookup"><span data-stu-id="1c1f9-125">You may see the following error message:</span></span>

    "Azure operation '{operation id}' failed with code Compute.ConstrainedAllocationFailed. Details: Allocation failed; unable to satisfy constraints in request. The requested new service deployment is bound to an Affinity Group, or it targets a Virtual Network, or there is an existing deployment under this hosted service. Any of these conditions constrains the new deployment to specific Azure resources. Please retry later or try reducing the VM size or number of role instances. Alternatively, if possible, remove the aforementioned constraints or try deploying to a different region."

### <a name="common-issues"></a><span data-ttu-id="1c1f9-126">Problemas comunes</span><span class="sxs-lookup"><span data-stu-id="1c1f9-126">Common Issues</span></span>
<span data-ttu-id="1c1f9-127">A continuación se presentan los escenarios de asignación comunes que ocasionan que una solicitud de asignación quede anclada a un solo clúster.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-127">Here are the common allocation scenarios that cause an allocation request to be pinned to a single cluster.</span></span>

* <span data-ttu-id="1c1f9-128">Implementación en la ranura de ensayo - Si un servicio en la nube tiene una implementación en cualquier ranura, entonces todo el servicio en la nube se ancla a un clúster concreto.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-128">Deploying to Staging Slot - If a cloud service has a deployment in either slot, then the entire cloud service is pinned to a specific cluster.</span></span>  <span data-ttu-id="1c1f9-129">Esto significa que si una implementación ya existe en la ranura de producción, una nueva implementación de ensayo solo se puede asignar en el mismo clúster que la ranura de producción.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-129">This means that if a deployment already exists in the production slot, then a new staging deployment can only be allocated in the same cluster as the production slot.</span></span> <span data-ttu-id="1c1f9-130">Si la capacidad del clúster se está agotando, se puede producir un error en la solicitud.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-130">If the cluster is nearing capacity, the request may fail.</span></span>
* <span data-ttu-id="1c1f9-131">Escalado - La incorporación de nuevas instancias a un servicio en la nube existente se debe asignar en el mismo clúster.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-131">Scaling - Adding new instances to an existing cloud service must allocate in the same cluster.</span></span>  <span data-ttu-id="1c1f9-132">Normalmente, las solicitudes de escalado pequeño se pueden asignar, pero no siempre.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-132">Small scaling requests can usually be allocated, but not always.</span></span> <span data-ttu-id="1c1f9-133">Si la capacidad del clúster se está agotando, se puede producir un error en la solicitud.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-133">If the cluster is nearing capacity, the request may fail.</span></span>
* <span data-ttu-id="1c1f9-134">Grupo de afinidad - Una nueva implementación en un servicio en la nube vacío se puede asignar mediante el tejido en cualquier clúster de esa región, a menos que el servicio en la nube esté anclado a un grupo de afinidad.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-134">Affinity Group - A new deployment to an empty cloud service can be allocated by the fabric in any cluster in that region, unless the cloud service is pinned to an affinity group.</span></span> <span data-ttu-id="1c1f9-135">Las implementaciones en el mismo grupo de afinidad se intentarán en el mismo clúster.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-135">Deployments to the same affinity group will be attempted on the same cluster.</span></span> <span data-ttu-id="1c1f9-136">Si la capacidad del clúster se está agotando, se puede producir un error en la solicitud.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-136">If the cluster is nearing capacity, the request may fail.</span></span>
* <span data-ttu-id="1c1f9-137">Red virtual del grupo de afinidad - Las redes virtuales más antiguas estaban asociadas a grupos de afinidad en lugar de a regiones y los servicios en la nube de estas redes virtuales se anclarían al clúster del grupo de afinidad.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-137">Affinity Group vNet - Older Virtual Networks were tied to affinity groups instead of regions, and cloud services in these Virtual Networks would be pinned to the affinity group cluster.</span></span> <span data-ttu-id="1c1f9-138">Las implementaciones en este tipo de red virtual se intentarán en el clúster anclado.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-138">Deployments to this type of virtual network will be attempted on the pinned cluster.</span></span> <span data-ttu-id="1c1f9-139">Si la capacidad del clúster se está agotando, se puede producir un error en la solicitud.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-139">If the cluster is nearing capacity, the request may fail.</span></span>

## <a name="solutions"></a><span data-ttu-id="1c1f9-140">Soluciones</span><span class="sxs-lookup"><span data-stu-id="1c1f9-140">Solutions</span></span>
1. <span data-ttu-id="1c1f9-141">Volver a implementar un nuevo servicio en la nube - Esta solución es probable que sea más exitosa, ya que permite a la plataforma elegir entre todos los clústeres de esa región.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-141">Redeploy to a new cloud service - This solution is likely to be most successful as it allows the platform to choose from all clusters in that region.</span></span>

   * <span data-ttu-id="1c1f9-142">Implementar la carga de trabajo en un nuevo servicio en la nube.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-142">Deploy the workload to a new cloud service</span></span>  
   * <span data-ttu-id="1c1f9-143">Actualizar el registro CNAME o A para que apunte el tráfico al nuevo servicio en la nube.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-143">Update the CNAME or A record to point traffic to the new cloud service</span></span>
   * <span data-ttu-id="1c1f9-144">Una vez que ya no se dirige tráfico al sitio antiguo, puede eliminar el servicio en la nube antiguo.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-144">Once zero traffic is going to the old site, you can delete the old cloud service.</span></span> <span data-ttu-id="1c1f9-145">Esta solución debe incurrir en tiempo de inactividad cero.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-145">This solution should incur zero downtime.</span></span>
2. <span data-ttu-id="1c1f9-146">Eliminar las ranuras de producción y ensayo - Esta solución conservará el nombre de DNS existente, pero provocará tiempo de inactividad en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-146">Delete both production and staging slots - This solution will preserve your existing DNS name, but will cause downtime to your application.</span></span>

   * <span data-ttu-id="1c1f9-147">Eliminar las ranuras de producción y ensayo de un servicio en la nube existente para que dicho esté vacío y después</span><span class="sxs-lookup"><span data-stu-id="1c1f9-147">Delete the production and staging slots of an existing cloud service so that the cloud service is empty, and then</span></span>
   * <span data-ttu-id="1c1f9-148">Crear una nueva implementación en el servicio en la nube existente.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-148">Create a new deployment in the existing cloud service.</span></span> <span data-ttu-id="1c1f9-149">Esto volverá a intentar la asignación en todos los clústeres de la región.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-149">This will re-attempt to allocation on all clusters in the region.</span></span> <span data-ttu-id="1c1f9-150">Asegúrese de que el servicio en la nube no está asociado a un grupo de afinidad.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-150">Ensure the cloud service is not tied to an affinity group.</span></span>
3. <span data-ttu-id="1c1f9-151">Dirección IP reservada: esta solución conservará su dirección IP existente, pero provocará tiempo de inactividad en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-151">Reserved IP -  This solution will preserve your existing IP address, but will cause downtime to your application.</span></span>  

   * <span data-ttu-id="1c1f9-152">Crear una dirección IP reservada para la implementación mediante Powershell.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-152">Create a ReservedIP for your existing deployment using Powershell</span></span>

     ```
     New-AzureReservedIP -ReservedIPName {new reserved IP name} -Location {location} -ServiceName {existing service name}
     ```
   * <span data-ttu-id="1c1f9-153">Siga el punto 2 anterior y asegúrese de especificar la nueva dirección IP reservada en el CSCFG del servicio.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-153">Follow #2 from above, making sure to specify the new ReservedIP in the service's CSCFG.</span></span>
4. <span data-ttu-id="1c1f9-154">Quitar el grupo de afinidad para nuevas implementaciones - Ya no se recomienda utilizar grupos de afinidad.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-154">Remove affinity group for new deployments - Affinity Groups are no longer recommended.</span></span> <span data-ttu-id="1c1f9-155">Siga los pasos del punto 1 anterior para implementar un nuevo servicio en la nube.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-155">Follow steps for #1 above to deploy a new cloud service.</span></span> <span data-ttu-id="1c1f9-156">Asegúrese de que el servicio en la nube no se encuentra en un grupo de afinidad.</span><span class="sxs-lookup"><span data-stu-id="1c1f9-156">Ensure cloud service is not in an affinity group.</span></span>
5. <span data-ttu-id="1c1f9-157">Convertir a una red virtual regional - Consulte [Migración de grupos de afinidad a una red virtual regional](../virtual-network/virtual-networks-migrate-to-regional-vnet.md).</span><span class="sxs-lookup"><span data-stu-id="1c1f9-157">Convert to a Regional Virtual Network - See [How to migrate from Affinity Groups to a Regional Virtual Network (VNet)](../virtual-network/virtual-networks-migrate-to-regional-vnet.md).</span></span>

---
title: Consideraciones de red con una instancia de Azure App Service Environment
description: "Explica el tráfico de red de ASE y cómo establecer los NSG y las UDR con el ASE"
services: app-service
documentationcenter: na
author: ccompy
manager: stefsch
ms.assetid: 955a4d84-94ca-418d-aa79-b57a5eb8cb85
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/08/2017
ms.author: ccompy
ms.openlocfilehash: 3be0d7a202ff53f5532fd7169a50a04cfaf88832
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/29/2017
---
# <a name="networking-considerations-for-an-app-service-environment"></a><span data-ttu-id="f934c-103">Consideraciones de red para una instancia de App Service Environment</span><span class="sxs-lookup"><span data-stu-id="f934c-103">Networking considerations for an App Service environment</span></span> #

## <a name="overview"></a><span data-ttu-id="f934c-104">Información general</span><span class="sxs-lookup"><span data-stu-id="f934c-104">Overview</span></span> ##

 <span data-ttu-id="f934c-105">[Azure App Service Environment][Intro] es una implementación de Azure App Service en una subred de Azure Virtual Network (VNet).</span><span class="sxs-lookup"><span data-stu-id="f934c-105">Azure [App Service Environment][Intro] is a deployment of Azure App Service into a subnet in your Azure virtual network (VNet).</span></span> <span data-ttu-id="f934c-106">Hay dos tipos de implementación de una instancia de App Service Environment (ASE):</span><span class="sxs-lookup"><span data-stu-id="f934c-106">There are two deployment types for an App Service environment (ASE):</span></span>

- <span data-ttu-id="f934c-107">**ASE externo**: expone las aplicaciones hospedadas en ASE en una dirección IP accesible a través de Internet.</span><span class="sxs-lookup"><span data-stu-id="f934c-107">**External ASE**: Exposes the ASE-hosted apps on an internet-accessible IP address.</span></span> <span data-ttu-id="f934c-108">Para más información, consulte [Creación de una instancia externa de App Service Environment][MakeExternalASE].</span><span class="sxs-lookup"><span data-stu-id="f934c-108">For more information, see [Create an External ASE][MakeExternalASE].</span></span>
- <span data-ttu-id="f934c-109">**ASE de ILB**: expone las aplicaciones hospedadas en ASE en una dirección IP dentro de su instancia de VNet.</span><span class="sxs-lookup"><span data-stu-id="f934c-109">**ILB ASE**: Exposes the ASE-hosted apps on an IP address inside your VNet.</span></span> <span data-ttu-id="f934c-110">El punto de conexión interno es un equilibrador de carga interno (ILB), y esta es la razón por la que se denomina ASE de ILB.</span><span class="sxs-lookup"><span data-stu-id="f934c-110">The internal endpoint is an internal load balancer (ILB), which is why it's called an ILB ASE.</span></span> <span data-ttu-id="f934c-111">Para más información, consulte [Creación y uso de un ASE de ILB][MakeILBASE].</span><span class="sxs-lookup"><span data-stu-id="f934c-111">For more information, see [Create and use an ILB ASE][MakeILBASE].</span></span>

<span data-ttu-id="f934c-112">Ahora hay dos versiones de App Service Environment: ASEv1 y ASEv2.</span><span class="sxs-lookup"><span data-stu-id="f934c-112">There are now two versions of App Service Environment: ASEv1 and ASEv2.</span></span> <span data-ttu-id="f934c-113">Para información sobre ASEv1, consulte [Introducción a App Service Environment v1][ASEv1Intro].</span><span class="sxs-lookup"><span data-stu-id="f934c-113">For information on ASEv1, see [Introduction to App Service Environment v1][ASEv1Intro].</span></span> <span data-ttu-id="f934c-114">Una instancia de ASEv1 se puede implementar en una red virtual clásica o en una de Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="f934c-114">ASEv1 can be deployed in a classic or Resource Manager VNet.</span></span> <span data-ttu-id="f934c-115">En el caso de ASEv2, la implementación solo se puede realizar en una red virtual de Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="f934c-115">ASEv2 can only be deployed into a Resource Manager VNet.</span></span>

<span data-ttu-id="f934c-116">Todas las llamadas que vayan a Internet desde una instancia de ASE salen de la red virtual a través de una IP virtual asignada para el ASE.</span><span class="sxs-lookup"><span data-stu-id="f934c-116">All calls from an ASE that go to the internet leave the VNet through a VIP assigned for the ASE.</span></span> <span data-ttu-id="f934c-117">La dirección IP pública de esta IP virtual es la dirección IP de origen para todas las llamadas desde el ASE que vayan a Internet.</span><span class="sxs-lookup"><span data-stu-id="f934c-117">The public IP of this VIP is then the source IP for all calls from the ASE that go to the internet.</span></span> <span data-ttu-id="f934c-118">Si las aplicaciones en la instancia de ASE realizan llamadas a los recursos de la red virtual o a través de una VPN, la IP de origen es una de las de la subred usada por su ASE.</span><span class="sxs-lookup"><span data-stu-id="f934c-118">If the apps in your ASE make calls to resources in your VNet or across a VPN, the source IP is one of the IPs in the subnet used by your ASE.</span></span> <span data-ttu-id="f934c-119">Dado que el ASE está dentro de la red virtual, también puede tener acceso a los recursos dentro de la red virtual sin ninguna configuración adicional.</span><span class="sxs-lookup"><span data-stu-id="f934c-119">Because the ASE is within the VNet, it can also access resources within the VNet without any additional configuration.</span></span> <span data-ttu-id="f934c-120">Si la red virtual está conectada a la red local, las aplicaciones en su ASE también tienen acceso a los recursos allí.</span><span class="sxs-lookup"><span data-stu-id="f934c-120">If the VNet is connected to your on-premises network, apps in your ASE also have access to resources there.</span></span> <span data-ttu-id="f934c-121">No es necesario seguir configurando el ASE ni la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f934c-121">You don't need to configure the ASE or your app any further.</span></span>

![ASE externo][1] 

<span data-ttu-id="f934c-123">Si tiene un ASE externo, la VIP pública es también el punto de conexión que las aplicaciones ASE usan para:</span><span class="sxs-lookup"><span data-stu-id="f934c-123">If you have an External ASE, the public VIP is also the endpoint that your ASE apps resolve to for:</span></span>

* <span data-ttu-id="f934c-124">HTTP/S.</span><span class="sxs-lookup"><span data-stu-id="f934c-124">HTTP/S.</span></span> 
* <span data-ttu-id="f934c-125">FTP/S.</span><span class="sxs-lookup"><span data-stu-id="f934c-125">FTP/S.</span></span> 
* <span data-ttu-id="f934c-126">Implementación web.</span><span class="sxs-lookup"><span data-stu-id="f934c-126">Web deployment.</span></span>
* <span data-ttu-id="f934c-127">Depuración remota.</span><span class="sxs-lookup"><span data-stu-id="f934c-127">Remote debugging.</span></span>

![ASE de ILB][2]

<span data-ttu-id="f934c-129">Si tiene un ASE de ILB, la dirección IP del ILB es el punto de conexión para HTTP/S, FTP/S, implementación web y depuración remota.</span><span class="sxs-lookup"><span data-stu-id="f934c-129">If you have an ILB ASE, the IP address of the ILB is the endpoint for HTTP/S, FTP/S, web deployment, and remote debugging.</span></span>

<span data-ttu-id="f934c-130">Los puertos de acceso de aplicación normales son:</span><span class="sxs-lookup"><span data-stu-id="f934c-130">The normal app access ports are:</span></span>

| <span data-ttu-id="f934c-131">Uso</span><span class="sxs-lookup"><span data-stu-id="f934c-131">Use</span></span> | <span data-ttu-id="f934c-132">De</span><span class="sxs-lookup"><span data-stu-id="f934c-132">From</span></span> | <span data-ttu-id="f934c-133">Para</span><span class="sxs-lookup"><span data-stu-id="f934c-133">To</span></span> |
|----------|---------|-------------|
|  <span data-ttu-id="f934c-134">HTTP/HTTPS</span><span class="sxs-lookup"><span data-stu-id="f934c-134">HTTP/HTTPS</span></span>  | <span data-ttu-id="f934c-135">Configurable por el usuario</span><span class="sxs-lookup"><span data-stu-id="f934c-135">User configurable</span></span> |  <span data-ttu-id="f934c-136">80, 443</span><span class="sxs-lookup"><span data-stu-id="f934c-136">80, 443</span></span> |
|  <span data-ttu-id="f934c-137">FTP/FTPS</span><span class="sxs-lookup"><span data-stu-id="f934c-137">FTP/FTPS</span></span>    | <span data-ttu-id="f934c-138">Configurable por el usuario</span><span class="sxs-lookup"><span data-stu-id="f934c-138">User configurable</span></span> |  <span data-ttu-id="f934c-139">21, 990, 10001-10020</span><span class="sxs-lookup"><span data-stu-id="f934c-139">21, 990, 10001-10020</span></span> |
|  <span data-ttu-id="f934c-140">Depuración remota en Visual Studio</span><span class="sxs-lookup"><span data-stu-id="f934c-140">Visual Studio remote debugging</span></span>  |  <span data-ttu-id="f934c-141">Configurable por el usuario</span><span class="sxs-lookup"><span data-stu-id="f934c-141">User configurable</span></span> |  <span data-ttu-id="f934c-142">4016, 4018, 4020, 4022</span><span class="sxs-lookup"><span data-stu-id="f934c-142">4016, 4018, 4020, 4022</span></span> |

<span data-ttu-id="f934c-143">Es así tanto si está en un ASE externo como en un ASE de ILB.</span><span class="sxs-lookup"><span data-stu-id="f934c-143">This is true if you're on an External ASE or on an ILB ASE.</span></span> <span data-ttu-id="f934c-144">Si se encuentra en un ASE externo, llega a esos puertos en la VIP pública.</span><span class="sxs-lookup"><span data-stu-id="f934c-144">If you're on an External ASE, you hit those ports on the public VIP.</span></span> <span data-ttu-id="f934c-145">Si se encuentra en un ASE de ILB, llega a esos puertos en el ILB.</span><span class="sxs-lookup"><span data-stu-id="f934c-145">If you're on an ILB ASE, you hit those ports on the ILB.</span></span> <span data-ttu-id="f934c-146">Si bloquea el puerto 443, puede afectar a algunas características que se exponen en el portal.</span><span class="sxs-lookup"><span data-stu-id="f934c-146">If you lock down port 443, there can be an effect on some features exposed in the portal.</span></span> <span data-ttu-id="f934c-147">Para más información, consulte [Dependencias del portal](#portaldep).</span><span class="sxs-lookup"><span data-stu-id="f934c-147">For more information, see [Portal dependencies](#portaldep).</span></span>

## <a name="ase-dependencies"></a><span data-ttu-id="f934c-148">Dependencias de ASE</span><span class="sxs-lookup"><span data-stu-id="f934c-148">ASE dependencies</span></span> ##

<span data-ttu-id="f934c-149">Un dependencia de acceso de entrada de ASE es:</span><span class="sxs-lookup"><span data-stu-id="f934c-149">An ASE inbound access dependency is:</span></span>

| <span data-ttu-id="f934c-150">Uso</span><span class="sxs-lookup"><span data-stu-id="f934c-150">Use</span></span> | <span data-ttu-id="f934c-151">De</span><span class="sxs-lookup"><span data-stu-id="f934c-151">From</span></span> | <span data-ttu-id="f934c-152">Para</span><span class="sxs-lookup"><span data-stu-id="f934c-152">To</span></span> |
|-----|------|----|
| <span data-ttu-id="f934c-153">Administración</span><span class="sxs-lookup"><span data-stu-id="f934c-153">Management</span></span> | <span data-ttu-id="f934c-154">Direcciones de administración de App Service</span><span class="sxs-lookup"><span data-stu-id="f934c-154">App Service management addresses</span></span> | <span data-ttu-id="f934c-155">Subred de ASE: 454, 455</span><span class="sxs-lookup"><span data-stu-id="f934c-155">ASE subnet: 454, 455</span></span> |
|  <span data-ttu-id="f934c-156">Comunicación interna ASE</span><span class="sxs-lookup"><span data-stu-id="f934c-156">ASE internal communication</span></span> | <span data-ttu-id="f934c-157">Subred de ASE: todos los puertos</span><span class="sxs-lookup"><span data-stu-id="f934c-157">ASE subnet: All ports</span></span> | <span data-ttu-id="f934c-158">Subred de ASE: todos los puertos</span><span class="sxs-lookup"><span data-stu-id="f934c-158">ASE subnet: All ports</span></span>
|  <span data-ttu-id="f934c-159">Permitir entrada de Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="f934c-159">Allow Azure load balancer inbound</span></span> | <span data-ttu-id="f934c-160">Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="f934c-160">Azure load balancer</span></span> | <span data-ttu-id="f934c-161">Subred de ASE: todos los puertos</span><span class="sxs-lookup"><span data-stu-id="f934c-161">ASE subnet: All ports</span></span>
|  <span data-ttu-id="f934c-162">Direcciones IP asignadas a las aplicaciones</span><span class="sxs-lookup"><span data-stu-id="f934c-162">App assigned IP addresses</span></span> | <span data-ttu-id="f934c-163">Direcciones asignadas a las aplicaciones</span><span class="sxs-lookup"><span data-stu-id="f934c-163">App assigned addresses</span></span> | <span data-ttu-id="f934c-164">Subred de ASE: todos los puertos</span><span class="sxs-lookup"><span data-stu-id="f934c-164">ASE subnet: All ports</span></span>

<span data-ttu-id="f934c-165">El tráfico entrante proporciona el comando y control del ASE además de supervisión del sistema.</span><span class="sxs-lookup"><span data-stu-id="f934c-165">The inbound traffic provides command and control of the ASE in addition to system monitoring.</span></span> <span data-ttu-id="f934c-166">Las direcciones IP de origen para este tráfico se incluyen en el documento [Direcciones de administración de App Service Environment][ASEManagement].</span><span class="sxs-lookup"><span data-stu-id="f934c-166">The source IPs for this traffic are listed in the [ASE Management addresses][ASEManagement] document.</span></span> <span data-ttu-id="f934c-167">La configuración de seguridad de red tiene que permitir el acceso desde todas las direcciones IP en los puertos 454 y 455.</span><span class="sxs-lookup"><span data-stu-id="f934c-167">The network security configuration needs to allow access from all IPs on ports 454 and 455.</span></span>

<span data-ttu-id="f934c-168">Dentro de la subred de ASE hay muchos puertos usados para la comunicación de componentes interna y pueden cambiar.</span><span class="sxs-lookup"><span data-stu-id="f934c-168">Within the ASE subnet there are many ports used for internal component communication and they can change.</span></span>  <span data-ttu-id="f934c-169">Esto requiere que todos los puertos de la subred de ASE sean accesibles desde la subred de ASE.</span><span class="sxs-lookup"><span data-stu-id="f934c-169">This requires all of the ports in the ASE subnet to be accessible from the ASE subnet.</span></span> 

<span data-ttu-id="f934c-170">Para la comunicación entre el equilibrador de carga de Azure y la subred de ASE, los puertos mínimos que deben abrirse son 454, 455 y 16001.</span><span class="sxs-lookup"><span data-stu-id="f934c-170">For the communication between the Azure load balancer and the ASE subnet the minimum ports that need to be open are 454, 455 and 16001.</span></span> <span data-ttu-id="f934c-171">El puerto 16001 se usa para mantener activo el tráfico entre el equilibrador de carga y el ASE.</span><span class="sxs-lookup"><span data-stu-id="f934c-171">The 16001 port is used for keep alive traffic between the load balancer and the ASE.</span></span> <span data-ttu-id="f934c-172">Si usa un ASE de ILB, puede bloquear el tráfico solo en los puertos 454, 455 y 16001.</span><span class="sxs-lookup"><span data-stu-id="f934c-172">If you are using an ILB ASE then you can lock traffic down to just the 454, 455, 16001 ports.</span></span>  <span data-ttu-id="f934c-173">Si usa un ASE externo, debe tener en cuenta los puertos de acceso a las aplicaciones normales.</span><span class="sxs-lookup"><span data-stu-id="f934c-173">If you are using an External ASE then you need to take into account the normal app access ports.</span></span>  <span data-ttu-id="f934c-174">Si usa direcciones asignadas a las aplicaciones, debe abrirlo en todos los puertos.</span><span class="sxs-lookup"><span data-stu-id="f934c-174">If you are using app assigned addresses you need to open it to all ports.</span></span>  <span data-ttu-id="f934c-175">Cuando se asigna una dirección a una aplicación específica, el equilibrador de carga usará puertos no conocidos de antemano para enviar tráfico HTTP y HTTPS al ASE.</span><span class="sxs-lookup"><span data-stu-id="f934c-175">When an address is assigned to a specific app, then the load balancer will use ports that are not known of in advance to send HTTP and HTTPS traffic to the ASE.</span></span>

<span data-ttu-id="f934c-176">Si usa direcciones IP asignadas a las aplicaciones, debe permitir el tráfico de las direcciones IP asignadas a sus aplicaciones en la subred de ASE.</span><span class="sxs-lookup"><span data-stu-id="f934c-176">If you are using app assigned IP addresses you need to allow traffic from the IPs assigned to your apps to the ASE subnet.</span></span>

<span data-ttu-id="f934c-177">Para el acceso de salida, un ASE depende de varios sistemas externos.</span><span class="sxs-lookup"><span data-stu-id="f934c-177">For outbound access, an ASE depends on multiple external systems.</span></span> <span data-ttu-id="f934c-178">Esas dependencias del sistema se definen con nombres DNS y no se asignan a un conjunto fijo de direcciones IP.</span><span class="sxs-lookup"><span data-stu-id="f934c-178">Those system dependencies are defined with DNS names and don't map to a fixed set of IP addresses.</span></span> <span data-ttu-id="f934c-179">Por tanto, el ASE requiere acceso de salida desde la subred de ASE a todas las direcciones IP externas en diversos puertos.</span><span class="sxs-lookup"><span data-stu-id="f934c-179">Thus, the ASE requires outbound access from the ASE subnet to all external IPs across a variety of ports.</span></span> <span data-ttu-id="f934c-180">Un ASE presenta las siguientes dependencias de salida:</span><span class="sxs-lookup"><span data-stu-id="f934c-180">An ASE has the following outbound dependencies:</span></span>

| <span data-ttu-id="f934c-181">Uso</span><span class="sxs-lookup"><span data-stu-id="f934c-181">Use</span></span> | <span data-ttu-id="f934c-182">De</span><span class="sxs-lookup"><span data-stu-id="f934c-182">From</span></span> | <span data-ttu-id="f934c-183">Para</span><span class="sxs-lookup"><span data-stu-id="f934c-183">To</span></span> |
|-----|------|----|
| <span data-ttu-id="f934c-184">Azure Storage</span><span class="sxs-lookup"><span data-stu-id="f934c-184">Azure Storage</span></span> | <span data-ttu-id="f934c-185">Subred de ASE</span><span class="sxs-lookup"><span data-stu-id="f934c-185">ASE subnet</span></span> | <span data-ttu-id="f934c-186">table.core.windows.net, blob.core.windows.net, queue.core.windows.net, file.core.windows.net: 80, 443, 445 (445 se necesita solo para ASEv1).</span><span class="sxs-lookup"><span data-stu-id="f934c-186">table.core.windows.net, blob.core.windows.net, queue.core.windows.net, file.core.windows.net: 80, 443, 445 (445 is only needed for ASEv1.)</span></span> |
| <span data-ttu-id="f934c-187">Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="f934c-187">Azure SQL Database</span></span> | <span data-ttu-id="f934c-188">Subred de ASE</span><span class="sxs-lookup"><span data-stu-id="f934c-188">ASE subnet</span></span> | <span data-ttu-id="f934c-189">database.windows.net: 1433, 11000-11999, 14000-14999 (Para más información, consulte [Uso de los puertos de SQL Database V12](../../sql-database/sql-database-develop-direct-route-ports-adonet-v12.md)).</span><span class="sxs-lookup"><span data-stu-id="f934c-189">database.windows.net: 1433, 11000-11999, 14000-14999 (For more information, see [SQL Database V12 port usage](../../sql-database/sql-database-develop-direct-route-ports-adonet-v12.md).)</span></span>|
| <span data-ttu-id="f934c-190">Administración de Azure</span><span class="sxs-lookup"><span data-stu-id="f934c-190">Azure management</span></span> | <span data-ttu-id="f934c-191">Subred de ASE</span><span class="sxs-lookup"><span data-stu-id="f934c-191">ASE subnet</span></span> | <span data-ttu-id="f934c-192">management.core.windows.net, management.azure.com: 443</span><span class="sxs-lookup"><span data-stu-id="f934c-192">management.core.windows.net, management.azure.com: 443</span></span> 
| <span data-ttu-id="f934c-193">Comprobación de certificado SSL</span><span class="sxs-lookup"><span data-stu-id="f934c-193">SSL certificate verification</span></span> |  <span data-ttu-id="f934c-194">Subred de ASE</span><span class="sxs-lookup"><span data-stu-id="f934c-194">ASE subnet</span></span>            |  <span data-ttu-id="f934c-195">ocsp.msocsp.com, mscrl.microsoft.com, crl.microsoft.com: 443</span><span class="sxs-lookup"><span data-stu-id="f934c-195">ocsp.msocsp.com, mscrl.microsoft.com, crl.microsoft.com: 443</span></span>
| <span data-ttu-id="f934c-196">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="f934c-196">Azure Active Directory</span></span>        | <span data-ttu-id="f934c-197">Subred de ASE</span><span class="sxs-lookup"><span data-stu-id="f934c-197">ASE subnet</span></span>            |  <span data-ttu-id="f934c-198">Internet: 443</span><span class="sxs-lookup"><span data-stu-id="f934c-198">Internet: 443</span></span>
| <span data-ttu-id="f934c-199">Administración de App Service</span><span class="sxs-lookup"><span data-stu-id="f934c-199">App Service management</span></span>        | <span data-ttu-id="f934c-200">Subred de ASE</span><span class="sxs-lookup"><span data-stu-id="f934c-200">ASE subnet</span></span>            |  <span data-ttu-id="f934c-201">Internet: 443</span><span class="sxs-lookup"><span data-stu-id="f934c-201">Internet: 443</span></span>
| <span data-ttu-id="f934c-202">DNS de Azure</span><span class="sxs-lookup"><span data-stu-id="f934c-202">Azure DNS</span></span>                     | <span data-ttu-id="f934c-203">Subred de ASE</span><span class="sxs-lookup"><span data-stu-id="f934c-203">ASE subnet</span></span>            |  <span data-ttu-id="f934c-204">Internet: 53</span><span class="sxs-lookup"><span data-stu-id="f934c-204">Internet: 53</span></span>
| <span data-ttu-id="f934c-205">Comunicación interna ASE</span><span class="sxs-lookup"><span data-stu-id="f934c-205">ASE internal communication</span></span>    | <span data-ttu-id="f934c-206">Subred de ASE: todos los puertos</span><span class="sxs-lookup"><span data-stu-id="f934c-206">ASE subnet: All ports</span></span> |  <span data-ttu-id="f934c-207">Subred de ASE: todos los puertos</span><span class="sxs-lookup"><span data-stu-id="f934c-207">ASE subnet: All ports</span></span>

<span data-ttu-id="f934c-208">Si el ASE pierde el acceso a estas dependencias, deja de funcionar.</span><span class="sxs-lookup"><span data-stu-id="f934c-208">If the ASE loses access to these dependencies, it stops working.</span></span> <span data-ttu-id="f934c-209">Cuando esto ocurre durante un tiempo suficientemente prolongado, el ASE se suspende.</span><span class="sxs-lookup"><span data-stu-id="f934c-209">When that happens long enough, the ASE is suspended.</span></span>

### <a name="customer-dns"></a><span data-ttu-id="f934c-210">DNS del cliente</span><span class="sxs-lookup"><span data-stu-id="f934c-210">Customer DNS</span></span> ###

<span data-ttu-id="f934c-211">Si la red virtual se configura con un servidor DNS definido por el cliente, las cargas de trabajo del inquilino lo utilizan.</span><span class="sxs-lookup"><span data-stu-id="f934c-211">If the VNet is configured with a customer-defined DNS server, the tenant workloads use it.</span></span> <span data-ttu-id="f934c-212">El ASE todavía tiene que comunicarse con Azure DNS para fines de administración.</span><span class="sxs-lookup"><span data-stu-id="f934c-212">The ASE still needs to communicate with Azure DNS for management purposes.</span></span> 

<span data-ttu-id="f934c-213">Si la red virtual se configura con un cliente DNS en el otro lado de una VPN, el servidor DNS tiene que ser accesible desde la subred que contiene el ASE.</span><span class="sxs-lookup"><span data-stu-id="f934c-213">If the VNet is configured with a customer DNS on the other side of a VPN, the DNS server must be reachable from the subnet that contains the ASE.</span></span>

<a name="portaldep"></a>

## <a name="portal-dependencies"></a><span data-ttu-id="f934c-214">Dependencias del portal</span><span class="sxs-lookup"><span data-stu-id="f934c-214">Portal dependencies</span></span> ##

<span data-ttu-id="f934c-215">Además de las dependencias funcionales de un ASE, hay algunos elementos adicionales relacionados con la experiencia del portal.</span><span class="sxs-lookup"><span data-stu-id="f934c-215">In addition to the ASE functional dependencies, there are a few extra items related to the portal experience.</span></span> <span data-ttu-id="f934c-216">Algunas de las funcionalidades en Azure Portal dependen de un acceso directo al _sitio SCM_.</span><span class="sxs-lookup"><span data-stu-id="f934c-216">Some of the capabilities in the Azure portal depend on direct access to _SCM site_.</span></span> <span data-ttu-id="f934c-217">Para cada aplicación en Azure App Service, hay dos direcciones URL.</span><span class="sxs-lookup"><span data-stu-id="f934c-217">For every app in Azure App Service, there are two URLs.</span></span> <span data-ttu-id="f934c-218">La primera dirección URL es para acceder a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f934c-218">The first URL is to access your app.</span></span> <span data-ttu-id="f934c-219">La segunda dirección URL es para el acceso al sitio SCM, que también se denomina el _consola Kudu_.</span><span class="sxs-lookup"><span data-stu-id="f934c-219">The second URL is to access the SCM site, which is also called the _Kudu console_.</span></span> <span data-ttu-id="f934c-220">Algunas de las características que usan el sitio SCM incluyen:</span><span class="sxs-lookup"><span data-stu-id="f934c-220">Features that use the SCM site include:</span></span>

-   <span data-ttu-id="f934c-221">Trabajos web</span><span class="sxs-lookup"><span data-stu-id="f934c-221">Web jobs</span></span>
-   <span data-ttu-id="f934c-222">Functions</span><span class="sxs-lookup"><span data-stu-id="f934c-222">Functions</span></span>
-   <span data-ttu-id="f934c-223">Secuencias de registro</span><span class="sxs-lookup"><span data-stu-id="f934c-223">Log streaming</span></span>
-   <span data-ttu-id="f934c-224">Kudu</span><span class="sxs-lookup"><span data-stu-id="f934c-224">Kudu</span></span>
-   <span data-ttu-id="f934c-225">Extensiones</span><span class="sxs-lookup"><span data-stu-id="f934c-225">Extensions</span></span>
-   <span data-ttu-id="f934c-226">Explorador de procesos</span><span class="sxs-lookup"><span data-stu-id="f934c-226">Process Explorer</span></span>
-   <span data-ttu-id="f934c-227">Consola</span><span class="sxs-lookup"><span data-stu-id="f934c-227">Console</span></span>

<span data-ttu-id="f934c-228">Cuando se usa una ASE de ILB, el sitio SCM no está accesible en Internet desde fuera de la red virtual.</span><span class="sxs-lookup"><span data-stu-id="f934c-228">When you use an ILB ASE, the SCM site isn't internet accessible from outside the VNet.</span></span> <span data-ttu-id="f934c-229">Cuando la aplicación se hospeda en un ASE de ILB, algunas funcionalidades no se podrán usar desde el portal.</span><span class="sxs-lookup"><span data-stu-id="f934c-229">When your app is hosted on an ILB ASE, some capabilities will not work from the portal.</span></span>  

<span data-ttu-id="f934c-230">Muchas de estas funcionalidades que dependen del sitio SCM también están disponibles directamente en la consola Kudu.</span><span class="sxs-lookup"><span data-stu-id="f934c-230">Many of those capabilities that depend upon the SCM site are also available directly in the Kudu console.</span></span> <span data-ttu-id="f934c-231">Puede conectarse directamente, en lugar de utilizar el portal.</span><span class="sxs-lookup"><span data-stu-id="f934c-231">You can connect to it directly rather than by using the portal.</span></span> <span data-ttu-id="f934c-232">Si la aplicación se hospeda en un ASE de ILB, use las credenciales de publicación para iniciar sesión.</span><span class="sxs-lookup"><span data-stu-id="f934c-232">If your app is hosted in an ILB ASE, use your publishing credentials to sign in.</span></span> <span data-ttu-id="f934c-233">La dirección URL para acceder al sitio SCM de una aplicación hospedada en un ASE de ILB tiene el formato siguiente:</span><span class="sxs-lookup"><span data-stu-id="f934c-233">The URL to access the SCM site of an app hosted in an ILB ASE has the following format:</span></span> 

```
<appname>.scm.<domain name the ILB ASE was created with> 
```

<span data-ttu-id="f934c-234">Si su ASE ILB es el nombre de dominio *contoso.net* y el nombre de la aplicación es *aplicacionprueba*, la aplicación está accesible en *aplicacionprueba.contoso.net*.</span><span class="sxs-lookup"><span data-stu-id="f934c-234">If your ILB ASE is the domain name *contoso.net* and your app name is *testapp*, the app is reached at *testapp.contoso.net*.</span></span> <span data-ttu-id="f934c-235">El sitio SCM que lo acompaña está accesible en *aplicacionprueba.scm.contoso.net*.</span><span class="sxs-lookup"><span data-stu-id="f934c-235">The SCM site that goes with it is reached at *testapp.scm.contoso.net*.</span></span>

### <a name="functions-and-web-jobs"></a><span data-ttu-id="f934c-236">Trabajos web y de funciones</span><span class="sxs-lookup"><span data-stu-id="f934c-236">Functions and Web jobs</span></span> ###

<span data-ttu-id="f934c-237">Tanto los trabajos de funciones como los trabajos web dependen del sitio de SCM, pero se pueden usar en el portal, incluso si las aplicaciones se encuentran en un ASE de ILB, siempre y cuando el explorador pueda llegar al sitio de SCM.</span><span class="sxs-lookup"><span data-stu-id="f934c-237">Both Functions and Web jobs depend on the SCM site but are supported for use in the portal, even if your apps are in an ILB ASE, so long as your browser can reach the SCM site.</span></span>  <span data-ttu-id="f934c-238">Si usa un certificado autofirmado con su ASE de ILB, debe habilitar el explorador para que confíe en ese certificado.</span><span class="sxs-lookup"><span data-stu-id="f934c-238">If you are using a self-signed certificate with your ILB ASE, you will need to enable your browser to trust that certificate.</span></span>  <span data-ttu-id="f934c-239">En el caso de IE y Edge, esto significa que el certificado debe estar en el almacén de confianza del equipo.</span><span class="sxs-lookup"><span data-stu-id="f934c-239">For IE and Edge that means the certificate has to be in the computer trust store.</span></span>  <span data-ttu-id="f934c-240">Si usa Chrome, esto significa que aceptó el certificado en el explorador anteriormente al pulsar directamente en el sitio de SCM.</span><span class="sxs-lookup"><span data-stu-id="f934c-240">If you are using Chrome then that means you accepted the certificate in the browser earlier by presumably hitting the scm site directly.</span></span>  <span data-ttu-id="f934c-241">La mejor solución es usar un certificado comercial que se encuentre en la cadena de confianza del explorador.</span><span class="sxs-lookup"><span data-stu-id="f934c-241">The best solution is to use a commercial certificate that is in the browser chain of trust.</span></span>  

## <a name="ase-ip-addresses"></a><span data-ttu-id="f934c-242">Direcciones IP de ASE</span><span class="sxs-lookup"><span data-stu-id="f934c-242">ASE IP addresses</span></span> ##

<span data-ttu-id="f934c-243">Un ASE tiene algunas direcciones IP que es necesario tener en cuenta.</span><span class="sxs-lookup"><span data-stu-id="f934c-243">An ASE has a few IP addresses to be aware of.</span></span> <span data-ttu-id="f934c-244">Son las siguientes:</span><span class="sxs-lookup"><span data-stu-id="f934c-244">They are:</span></span>

- <span data-ttu-id="f934c-245">**Dirección IP pública de entrada**: se usa para el tráfico de la aplicación en un ASE externo y para el tráfico de administración tanto en un ASE externo como en un ASE de ILB.</span><span class="sxs-lookup"><span data-stu-id="f934c-245">**Public inbound IP address**: Used for app traffic in an External ASE, and management traffic in both an External ASE and an ILB ASE.</span></span>
- <span data-ttu-id="f934c-246">**Dirección IP pública de salida**: se usa como dirección IP "desde" para las conexiones de salida desde el ASE que dejan la red virtual y que no se enrutan hacia una VPN.</span><span class="sxs-lookup"><span data-stu-id="f934c-246">**Outbound public IP**: Used as the "from" IP for outbound connections from the ASE that leave the VNet, which aren't routed down a VPN.</span></span>
- <span data-ttu-id="f934c-247">**Dirección IP del ILB:**: si usa una ASE de ILB.</span><span class="sxs-lookup"><span data-stu-id="f934c-247">**ILB IP address**: If you use an ILB ASE.</span></span>
- <span data-ttu-id="f934c-248">**Direcciones SSL basadas en IP asignadas a la aplicación**: solo son posibles con un ASE externo y cuando hay configurada una SSL basada en IP.</span><span class="sxs-lookup"><span data-stu-id="f934c-248">**App-assigned IP-based SSL addresses**: Only possible with an External ASE and when IP-based SSL is configured.</span></span>

<span data-ttu-id="f934c-249">Todas estas direcciones IP son fácilmente visibles en un ASEv2 en Azure Portal desde la interfaz de usuario de ASE.</span><span class="sxs-lookup"><span data-stu-id="f934c-249">All these IP addresses are easily visible in an ASEv2 in the Azure portal from the ASE UI.</span></span> <span data-ttu-id="f934c-250">Si tiene un ASE de ILB, aparece la dirección IP para el ILB.</span><span class="sxs-lookup"><span data-stu-id="f934c-250">If you have an ILB ASE, the IP for the ILB is listed.</span></span>

![Direcciones IP][3]

### <a name="app-assigned-ip-addresses"></a><span data-ttu-id="f934c-252">Direcciones IP asignadas a la aplicación</span><span class="sxs-lookup"><span data-stu-id="f934c-252">App-assigned IP addresses</span></span> ###

<span data-ttu-id="f934c-253">Con un ASE externo, puede asignar direcciones IP a las aplicaciones individuales.</span><span class="sxs-lookup"><span data-stu-id="f934c-253">With an External ASE, you can assign IP addresses to individual apps.</span></span> <span data-ttu-id="f934c-254">No puede hacer eso con un ASE de ILB.</span><span class="sxs-lookup"><span data-stu-id="f934c-254">You can't do that with an ILB ASE.</span></span> <span data-ttu-id="f934c-255">Para más información acerca de cómo configurar la aplicación para que tenga su propia dirección IP, consulte [Enlace de un certificado SSL personalizado a Azure Web Apps](../../app-service-web/app-service-web-tutorial-custom-ssl.md).</span><span class="sxs-lookup"><span data-stu-id="f934c-255">For more information on how to configure your app to have its own IP address, see [Bind an existing custom SSL certificate to Azure web apps](../../app-service-web/app-service-web-tutorial-custom-ssl.md).</span></span>

<span data-ttu-id="f934c-256">Cuando una aplicación tiene su propia dirección SSL basada en IP, el ASE reserva dos puertos para asignar a esa dirección IP.</span><span class="sxs-lookup"><span data-stu-id="f934c-256">When an app has its own IP-based SSL address, the ASE reserves two ports to map to that IP address.</span></span> <span data-ttu-id="f934c-257">Un puerto es para el tráfico HTTP y el otro es para HTTPS.</span><span class="sxs-lookup"><span data-stu-id="f934c-257">One port is for HTTP traffic, and the other port is for HTTPS.</span></span> <span data-ttu-id="f934c-258">Estos puertos se muestran en la interfaz de usuario de ASE en la sección de direcciones IP.</span><span class="sxs-lookup"><span data-stu-id="f934c-258">Those ports are listed in the ASE UI in the IP addresses section.</span></span> <span data-ttu-id="f934c-259">El tráfico tiene que poder conectar con esos puertos desde la dirección IP virtual o las aplicaciones no serán accesibles.</span><span class="sxs-lookup"><span data-stu-id="f934c-259">Traffic must be able to reach those ports from the VIP or the apps are inaccessible.</span></span> <span data-ttu-id="f934c-260">Es importante recordar este requisito al configurar grupos de seguridad de red (NSG).</span><span class="sxs-lookup"><span data-stu-id="f934c-260">This requirement is important to remember when you configure Network Security Groups (NSGs).</span></span>

## <a name="network-security-groups"></a><span data-ttu-id="f934c-261">Grupos de seguridad de red</span><span class="sxs-lookup"><span data-stu-id="f934c-261">Network Security Groups</span></span> ##

<span data-ttu-id="f934c-262">Los [grupos de seguridad de red][NSGs] permiten controlar el acceso a la red dentro de una red virtual.</span><span class="sxs-lookup"><span data-stu-id="f934c-262">[Network Security Groups][NSGs] provide the ability to control network access within a VNet.</span></span> <span data-ttu-id="f934c-263">Cuando usa el portal, hay una regla de denegación implícita con la prioridad más baja que deniega todo.</span><span class="sxs-lookup"><span data-stu-id="f934c-263">When you use the portal, there's an implicit deny rule at the lowest priority to deny everything.</span></span> <span data-ttu-id="f934c-264">Lo que crea son las reglas de permiso.</span><span class="sxs-lookup"><span data-stu-id="f934c-264">What you build are your allow rules.</span></span>

<span data-ttu-id="f934c-265">En un ASE, no tiene acceso a las máquinas virtuales que se utilizan para hospedar el propio ASE.</span><span class="sxs-lookup"><span data-stu-id="f934c-265">In an ASE, you don't have access to the VMs used to host the ASE itself.</span></span> <span data-ttu-id="f934c-266">Están en una suscripción administrada por Microsoft.</span><span class="sxs-lookup"><span data-stu-id="f934c-266">They're in a Microsoft-managed subscription.</span></span> <span data-ttu-id="f934c-267">Si desea limitar el acceso a las aplicaciones en el ASE, tiene que establecer los NSG en la subred de ASE.</span><span class="sxs-lookup"><span data-stu-id="f934c-267">If you want to restrict access to the apps on the ASE, set NSGs on the ASE subnet.</span></span> <span data-ttu-id="f934c-268">Al hacerlo, tiene que prestar mucha atención a las dependencias de ASE.</span><span class="sxs-lookup"><span data-stu-id="f934c-268">In doing so, pay careful attention to the ASE dependencies.</span></span> <span data-ttu-id="f934c-269">Si se bloquea alguna de las dependencias, el ASE deja de funcionar.</span><span class="sxs-lookup"><span data-stu-id="f934c-269">If you block any dependencies, the ASE stops working.</span></span>

<span data-ttu-id="f934c-270">Los NSG pueden configurarse mediante Azure Portal o a través de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="f934c-270">NSGs can be configured through the Azure portal or via PowerShell.</span></span> <span data-ttu-id="f934c-271">Esta información muestra Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="f934c-271">The information here shows the Azure portal.</span></span> <span data-ttu-id="f934c-272">Puede crear y administrar los NSG en el portal como un recurso de nivel superior en **Redes**.</span><span class="sxs-lookup"><span data-stu-id="f934c-272">You create and manage NSGs in the portal as a top-level resource under **Networking**.</span></span>

<span data-ttu-id="f934c-273">Cuando los requisitos de entrada y salida se tienen en cuenta, los NSG deben ser similares a lo que se muestra en este ejemplo.</span><span class="sxs-lookup"><span data-stu-id="f934c-273">When the inbound and outbound requirements are taken into account, the NSGs should look similar to the NSGs shown in this example.</span></span> <span data-ttu-id="f934c-274">El intervalo de direcciones de red virtual es _192.168.250.0/16_ y la subred a la que pertenece el ASE es _192.168.251.128/25_.</span><span class="sxs-lookup"><span data-stu-id="f934c-274">The VNet address range is _192.168.250.0/16_, and the subnet that the ASE is in is _192.168.251.128/25_.</span></span>

<span data-ttu-id="f934c-275">Los dos primeros requisitos de entrada para que el ASE funcione están en la parte superior de la lista en este ejemplo.</span><span class="sxs-lookup"><span data-stu-id="f934c-275">The first two inbound requirements for the ASE to function are shown at the top of the list in this example.</span></span> <span data-ttu-id="f934c-276">Estos habilitan la administración del ASE y permiten que el ASE se comunique consigo mismo.</span><span class="sxs-lookup"><span data-stu-id="f934c-276">They enable ASE management and allow the ASE to communicate with itself.</span></span> <span data-ttu-id="f934c-277">Las demás entradas son todas configurables por inquilino y pueden controlar el acceso por red a las aplicaciones hospedadas en el ASE.</span><span class="sxs-lookup"><span data-stu-id="f934c-277">The other entries are all tenant configurable and can govern network access to the ASE-hosted applications.</span></span> 

![Reglas de seguridad de entrada][4]

<span data-ttu-id="f934c-279">Una regla predeterminada permite que las direcciones IP en la red virtual se comuniquen con la subred de ASE.</span><span class="sxs-lookup"><span data-stu-id="f934c-279">A default rule enables the IPs in the VNet to talk to the ASE subnet.</span></span> <span data-ttu-id="f934c-280">Otra regla predeterminada permite que el equilibrador de carga, también conocido como VIP pública, se comunique con el ASE.</span><span class="sxs-lookup"><span data-stu-id="f934c-280">Another default rule enables the load balancer, also known as the public VIP, to communicate with the ASE.</span></span> <span data-ttu-id="f934c-281">Para ver las reglas predeterminadas, seleccione **Reglas predeterminadas** junto al icono **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="f934c-281">To see the default rules, select **Default rules** next to the **Add** icon.</span></span> <span data-ttu-id="f934c-282">Si coloca una regla para denegar todo lo demás después de las reglas de NSG que se muestran, evita el tráfico entre la IP virtual y el ASE.</span><span class="sxs-lookup"><span data-stu-id="f934c-282">If you put a deny everything else rule after the NSG rules shown, you prevent traffic between the VIP and the ASE.</span></span> <span data-ttu-id="f934c-283">Para impedir el tráfico procedente de dentro de la red virtual, agregue su propia regla para permitir la entrada.</span><span class="sxs-lookup"><span data-stu-id="f934c-283">To prevent traffic coming from inside the VNet, add your own rule to allow inbound.</span></span> <span data-ttu-id="f934c-284">Use un origen igual que AzureLoadBalancer con **cualquier** destino y un intervalo de puertos  **\*** .</span><span class="sxs-lookup"><span data-stu-id="f934c-284">Use a source equal to AzureLoadBalancer with a destination of **Any** and a port range of **\***.</span></span> <span data-ttu-id="f934c-285">Puesto que la regla NSG se aplica a la subred de ASE, no es necesario que sea específico en el destino.</span><span class="sxs-lookup"><span data-stu-id="f934c-285">Because the NSG rule is applied to the ASE subnet, you don't need to be specific in the destination.</span></span>

<span data-ttu-id="f934c-286">Si ha asignado una dirección IP a la aplicación, asegúrese de mantener los puertos abiertos.</span><span class="sxs-lookup"><span data-stu-id="f934c-286">If you assigned an IP address to your app, make sure you keep the ports open.</span></span> <span data-ttu-id="f934c-287">Para ver los puertos, seleccione **App Service Environment** > **Direcciones IP**.</span><span class="sxs-lookup"><span data-stu-id="f934c-287">To see the ports, select **App Service Environment** > **IP addresses**.</span></span>  

<span data-ttu-id="f934c-288">Se necesitan todos los elementos que se muestran en las siguientes reglas de salida, excepto el último.</span><span class="sxs-lookup"><span data-stu-id="f934c-288">All the items shown in the following outbound rules are needed, except for the last item.</span></span> <span data-ttu-id="f934c-289">Estos elementos habilitan el acceso de red a las dependencias de ASE que se han indicado anteriormente en este artículo.</span><span class="sxs-lookup"><span data-stu-id="f934c-289">They enable network access to the ASE dependencies that were noted earlier in this article.</span></span> <span data-ttu-id="f934c-290">Si bloquea alguna de ellas, el ASE deja de funcionar.</span><span class="sxs-lookup"><span data-stu-id="f934c-290">If you block any of them, your ASE stops working.</span></span> <span data-ttu-id="f934c-291">El último elemento de la lista habilita al ASE para que se comunique con otros recursos de la red virtual.</span><span class="sxs-lookup"><span data-stu-id="f934c-291">The last item in the list enables your ASE to communicate with other resources in your VNet.</span></span>

![Reglas de seguridad de entrada][5]

<span data-ttu-id="f934c-293">Una vez que haya definido los NSG, asígnelos a la subred en la que se encuentra el ASE.</span><span class="sxs-lookup"><span data-stu-id="f934c-293">After your NSGs are defined, assign them to the subnet that your ASE is on.</span></span> <span data-ttu-id="f934c-294">Si no recuerda la red virtual o la subred de ASE, puede verlo desde el portal de administración de ASE.</span><span class="sxs-lookup"><span data-stu-id="f934c-294">If you don’t remember the ASE VNet or subnet, you can see it from the ASE management portal.</span></span> <span data-ttu-id="f934c-295">Para asignar el NSG a la subred, vaya a la interfaz de usuario de la subred y seleccione el NSG.</span><span class="sxs-lookup"><span data-stu-id="f934c-295">To assign the NSG to your subnet, go to the subnet UI and select the NSG.</span></span>

## <a name="routes"></a><span data-ttu-id="f934c-296">Rutas</span><span class="sxs-lookup"><span data-stu-id="f934c-296">Routes</span></span> ##

<span data-ttu-id="f934c-297">Las rutas presentan problemas sobre todo cuando la red virtual se configura con Azure ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="f934c-297">Routes become problematic most commonly when you configure your VNet with Azure ExpressRoute.</span></span> <span data-ttu-id="f934c-298">Hay tres tipos de rutas en una red virtual:</span><span class="sxs-lookup"><span data-stu-id="f934c-298">There are three types of routes in a VNet:</span></span>

-   <span data-ttu-id="f934c-299">Rutas del sistema</span><span class="sxs-lookup"><span data-stu-id="f934c-299">System routes</span></span>
-   <span data-ttu-id="f934c-300">Rutas BGP</span><span class="sxs-lookup"><span data-stu-id="f934c-300">BGP routes</span></span>
-   <span data-ttu-id="f934c-301">Rutas definidas por el usuario (UDR)</span><span class="sxs-lookup"><span data-stu-id="f934c-301">User-defined routes (UDRs)</span></span>

<span data-ttu-id="f934c-302">Las rutas BGP reemplazan a las rutas del sistema.</span><span class="sxs-lookup"><span data-stu-id="f934c-302">BGP routes override system routes.</span></span> <span data-ttu-id="f934c-303">Las UDR reemplazan a las rutas BGP.</span><span class="sxs-lookup"><span data-stu-id="f934c-303">UDRs override BGP routes.</span></span> <span data-ttu-id="f934c-304">Para más información acerca de las rutas en las redes virtuales de Azure, consulte la [Introducción a las rutas definidas por el usuario][UDRs].</span><span class="sxs-lookup"><span data-stu-id="f934c-304">For more information about routes in Azure virtual networks, see [User-defined routes overview][UDRs].</span></span>

<span data-ttu-id="f934c-305">La base de datos SQL de Azure que ASE utiliza para administrar el sistema tiene un firewall.</span><span class="sxs-lookup"><span data-stu-id="f934c-305">The Azure SQL database that the ASE uses to manage the system has a firewall.</span></span> <span data-ttu-id="f934c-306">Necesita una comunicación que se origine desde la VIP pública del ASE.</span><span class="sxs-lookup"><span data-stu-id="f934c-306">It requires communication to originate from the ASE public VIP.</span></span> <span data-ttu-id="f934c-307">Las conexiones con la base de datos SQL desde el ASE se denegarán si se envían a través de la conexión ExpressRoute y fuera de otra dirección IP.</span><span class="sxs-lookup"><span data-stu-id="f934c-307">Connections to the SQL database from the ASE will be denied if they are sent down the ExpressRoute connection and out another IP address.</span></span>

<span data-ttu-id="f934c-308">Si las respuestas a solicitudes entrantes de administración se envían a través de ExpressRoute, la dirección de respuesta es distinta del destino original.</span><span class="sxs-lookup"><span data-stu-id="f934c-308">If replies to incoming management requests are sent down the ExpressRoute, the reply address is different than the original destination.</span></span> <span data-ttu-id="f934c-309">Esta falta de coincidencia interrumpe la comunicación TCP.</span><span class="sxs-lookup"><span data-stu-id="f934c-309">This mismatch breaks the TCP communication.</span></span>

<span data-ttu-id="f934c-310">Para que el ASE funcione cuando la red virtual se configure con ExpressRoute, lo más fácil es:</span><span class="sxs-lookup"><span data-stu-id="f934c-310">For your ASE to work while your VNet is configured with an ExpressRoute, the easiest thing to do is:</span></span>

-   <span data-ttu-id="f934c-311">Configurar ExpressRoute para anunciar _0.0.0.0/0_.</span><span class="sxs-lookup"><span data-stu-id="f934c-311">Configure ExpressRoute to advertise _0.0.0.0/0_.</span></span> <span data-ttu-id="f934c-312">De forma predeterminada, obliga a dirigir todo el tráfico saliente tráfico local.</span><span class="sxs-lookup"><span data-stu-id="f934c-312">By default, it force tunnels all outbound traffic on-premises.</span></span>
-   <span data-ttu-id="f934c-313">Crear un UDR.</span><span class="sxs-lookup"><span data-stu-id="f934c-313">Create a UDR.</span></span> <span data-ttu-id="f934c-314">Aplicarlo a la subred que contiene el ASE, con un prefijo de dirección de _0.0.0.0/0_ y un tipo de próximo salto de _Internet_.</span><span class="sxs-lookup"><span data-stu-id="f934c-314">Apply it to the subnet that contains the ASE with an address prefix of _0.0.0.0/0_ and a next hop type of _Internet_.</span></span>

<span data-ttu-id="f934c-315">Si realiza estos dos cambios, el tráfico destinado a Internet, que se origina en la subred ASE, no se forzará hacia ExpressRoute y el ASE funciona.</span><span class="sxs-lookup"><span data-stu-id="f934c-315">If you make these two changes, internet-destined traffic that originates from the ASE subnet isn't forced down the ExpressRoute and the ASE works.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="f934c-316">Las rutas definidas en una UDR tienen que ser lo suficientemente específicas para que tengan prioridad sobre cualquier otra ruta anunciada por la configuración de ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="f934c-316">The routes defined in a UDR must be specific enough to take precedence over any routes advertised by the ExpressRoute configuration.</span></span> <span data-ttu-id="f934c-317">En el ejemplo anterior se utiliza el intervalo de direcciones amplio 0.0.0.0/0.</span><span class="sxs-lookup"><span data-stu-id="f934c-317">The preceding example uses the broad 0.0.0.0/0 address range.</span></span> <span data-ttu-id="f934c-318">Puede reemplazarse accidentalmente por los anuncios de ruta con intervalos de direcciones más específicos.</span><span class="sxs-lookup"><span data-stu-id="f934c-318">It can potentially be accidentally overridden by route advertisements that use more specific address ranges.</span></span>
>
> <span data-ttu-id="f934c-319">Las instancias de ASE no son compatibles con las configuraciones de ExpressRoute que anuncian rutas entre la ruta de acceso de emparejamiento público y la ruta de acceso de emparejamiento privado.</span><span class="sxs-lookup"><span data-stu-id="f934c-319">ASEs aren't supported with ExpressRoute configurations that cross-advertise routes from the public-peering path to the private-peering path.</span></span> <span data-ttu-id="f934c-320">Las configuraciones de ExpressRoute con el emparejamiento público configurado reciben anuncios de ruta de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="f934c-320">ExpressRoute configurations with public peering configured receive route advertisements from Microsoft.</span></span> <span data-ttu-id="f934c-321">Los anuncios contienen un gran conjunto de intervalos de direcciones IP de Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="f934c-321">The advertisements contain a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="f934c-322">Si estos intervalos de direcciones se anuncian en la ruta de acceso de emparejamiento privado, la tunelización de todos los paquetes de red salientes se debe realizar desde la subred de ASE a la infraestructura de red local de un cliente.</span><span class="sxs-lookup"><span data-stu-id="f934c-322">If the address ranges are cross-advertised on the private-peering path, all outbound network packets from the ASE's subnet are force tunneled to a customer's on-premises network infrastructure.</span></span> <span data-ttu-id="f934c-323">Actualmente, este flujo de red no es compatible con las instancias de ASE.</span><span class="sxs-lookup"><span data-stu-id="f934c-323">This network flow is currently not supported with ASEs.</span></span> <span data-ttu-id="f934c-324">Una solución a este problema es dejar de anunciar las rutas entre la ruta de acceso de emparejamiento público y la de emparejamiento privado.</span><span class="sxs-lookup"><span data-stu-id="f934c-324">One solution to this problem is to stop cross-advertising routes from the public-peering path to the private-peering path.</span></span>

<span data-ttu-id="f934c-325">Para crear un UDR, siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="f934c-325">To create a UDR, follow these steps:</span></span>

1. <span data-ttu-id="f934c-326">Vaya a Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="f934c-326">Go to the Azure portal.</span></span> <span data-ttu-id="f934c-327">Seleccione **Redes** > **Tablas de rutas**.</span><span class="sxs-lookup"><span data-stu-id="f934c-327">Select **Networking** > **Route Tables**.</span></span>

2. <span data-ttu-id="f934c-328">Cree una nueva tabla de rutas en la misma región que la red virtual.</span><span class="sxs-lookup"><span data-stu-id="f934c-328">Create a new route table in the same region as your VNet.</span></span>

3. <span data-ttu-id="f934c-329">En la interfaz de usuario de la tabla de rutas, seleccione **Rutas** > **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="f934c-329">From within your route table UI, select **Routes** > **Add**.</span></span>

4. <span data-ttu-id="f934c-330">Establezca **Tipo del próximo salto** en **Internet** y **Prefijo de dirección** en **0.0.0.0/0**.</span><span class="sxs-lookup"><span data-stu-id="f934c-330">Set the **Next hop type** to **Internet** and the **Address prefix** to **0.0.0.0/0**.</span></span> <span data-ttu-id="f934c-331">Seleccione **Guardar**.</span><span class="sxs-lookup"><span data-stu-id="f934c-331">Select **Save**.</span></span>

    <span data-ttu-id="f934c-332">Verá algo parecido a lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="f934c-332">You then see something like the following:</span></span>

    ![Rutas funcionales][6]

5. <span data-ttu-id="f934c-334">Después de crear la nueva tabla de rutas, vaya a la subred que contiene el ASE.</span><span class="sxs-lookup"><span data-stu-id="f934c-334">After you create the new route table, go to the subnet that contains your ASE.</span></span> <span data-ttu-id="f934c-335">Seleccione la tabla de rutas de la lista en el portal.</span><span class="sxs-lookup"><span data-stu-id="f934c-335">Select your route table from the list in the portal.</span></span> <span data-ttu-id="f934c-336">Después de guardar el cambio, debería ver los NSG y las rutas anotadas con la subred.</span><span class="sxs-lookup"><span data-stu-id="f934c-336">After you save the change, you should then see the NSGs and routes noted with your subnet.</span></span>

    ![NSG y rutas][7]

### <a name="deploy-into-existing-azure-virtual-networks-that-are-integrated-with-expressroute"></a><span data-ttu-id="f934c-338">Implementación en redes virtuales de Azure existentes que están integradas con ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="f934c-338">Deploy into existing Azure virtual networks that are integrated with ExpressRoute</span></span> ###

<span data-ttu-id="f934c-339">Para implementar su ASE en una red virtual que se integra con ExpressRoute, preconfigure la subred en la que desea que el ASE se implemente.</span><span class="sxs-lookup"><span data-stu-id="f934c-339">To deploy your ASE into a VNet that's integrated with ExpressRoute, preconfigure the subnet where you want the ASE deployed.</span></span> <span data-ttu-id="f934c-340">Después, use una plantilla de Resource Manager para implementarlo.</span><span class="sxs-lookup"><span data-stu-id="f934c-340">Then use a Resource Manager template to deploy it.</span></span> <span data-ttu-id="f934c-341">Para crear un ASE en una red virtual que ya tiene configurado ExpressRoute:</span><span class="sxs-lookup"><span data-stu-id="f934c-341">To create an ASE in a VNet that already has ExpressRoute configured:</span></span>

- <span data-ttu-id="f934c-342">Cree una subred para hospedar el ASE.</span><span class="sxs-lookup"><span data-stu-id="f934c-342">Create a subnet to host the ASE.</span></span>

    > [!NOTE]
    > <span data-ttu-id="f934c-343">Puede no haber nada más en la subred excepto el ASE.</span><span class="sxs-lookup"><span data-stu-id="f934c-343">Nothing else can be in the subnet but the ASE.</span></span> <span data-ttu-id="f934c-344">Asegúrese de elegir un espacio de direcciones que pueda crecer en el futuro.</span><span class="sxs-lookup"><span data-stu-id="f934c-344">Be sure to choose an address space that allows for future growth.</span></span> <span data-ttu-id="f934c-345">No puede cambiar esta configuración posteriormente.</span><span class="sxs-lookup"><span data-stu-id="f934c-345">You can't change this setting later.</span></span> <span data-ttu-id="f934c-346">Se recomienda un tamaño de `/25` con 128 direcciones.</span><span class="sxs-lookup"><span data-stu-id="f934c-346">We recommend a size of `/25` with 128 addresses.</span></span>

- <span data-ttu-id="f934c-347">Cree las UDR (por ejemplo, las tablas de rutas) tal y como se ha descrito anteriormente y establezca eso en la subred.</span><span class="sxs-lookup"><span data-stu-id="f934c-347">Create UDRs (for example, route tables) as described earlier, and set that on the subnet.</span></span>
- <span data-ttu-id="f934c-348">Cree el ASE mediante una plantilla de Resource Manager como se describe en el artículo [Creación de un ASE mediante una plantilla de Azure Resource Manager][MakeASEfromTemplate].</span><span class="sxs-lookup"><span data-stu-id="f934c-348">Create the ASE by using a Resource Manager template as described in [Create an ASE by using a Resource Manager template][MakeASEfromTemplate].</span></span>

<!--Image references-->
[1]: ./media/network_considerations_with_an_app_service_environment/networkase-overflow.png
[2]: ./media/network_considerations_with_an_app_service_environment/networkase-overflow2.png
[3]: ./media/network_considerations_with_an_app_service_environment/networkase-ipaddresses.png
[4]: ./media/network_considerations_with_an_app_service_environment/networkase-inboundnsg.png
[5]: ./media/network_considerations_with_an_app_service_environment/networkase-outboundnsg.png
[6]: ./media/network_considerations_with_an_app_service_environment/networkase-udr.png
[7]: ./media/network_considerations_with_an_app_service_environment/networkase-subnet.png

<!--Links-->
[Intro]: ./intro.md
[MakeExternalASE]: ./create-external-ase.md
[MakeASEfromTemplate]: ./create-from-template.md
[MakeILBASE]: ./create-ilb-ase.md
[ASENetwork]: ./network-info.md
[ASEReadme]: ./readme.md
[UsingASE]: ./using-an-ase.md
[UDRs]: ../../virtual-network/virtual-networks-udr-overview.md
[NSGs]: ../../virtual-network/virtual-networks-nsg.md
[ConfigureASEv1]: ../../app-service-web/app-service-web-configure-an-app-service-environment.md
[ASEv1Intro]: ../../app-service-web/app-service-app-service-environment-intro.md
[webapps]: ../../app-service-web/app-service-web-overview.md
[mobileapps]: ../../app-service-mobile/app-service-mobile-value-prop.md
[APIapps]: ../../app-service-api/app-service-api-apps-why-best-platform.md
[Functions]: ../../azure-functions/index.yml
[Pricing]: http://azure.microsoft.com/pricing/details/app-service/
[ARMOverview]: ../../azure-resource-manager/resource-group-overview.md
[ConfigureSSL]: ../../app-service-web/web-sites-purchase-ssl-web-site.md
[Kudu]: http://azure.microsoft.com/resources/videos/super-secret-kudu-debug-console-for-azure-web-sites/
[AppDeploy]: ../../app-service-web/web-sites-deploy.md
[ASEWAF]: ../../app-service-web/app-service-app-service-environment-web-application-firewall.md
[AppGW]: ../../application-gateway/application-gateway-web-application-firewall-overview.md
[ASEManagement]: ./management-addresses.md

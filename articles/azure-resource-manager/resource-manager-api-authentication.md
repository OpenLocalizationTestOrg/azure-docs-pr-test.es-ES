---
title: "aaaAzure Active Directory autenticación y el Administrador de recursos | Documentos de Microsoft"
description: "Tooauthentication de guía del desarrollador con hello API del Administrador de recursos de Azure y Azure Active Directory para integrar una aplicación con otras suscripciones de Azure."
services: azure-resource-manager,active-directory
documentationcenter: na
author: dushyantgill
manager: timlt
editor: tysonn
ms.assetid: 17b2b40d-bf42-4c7d-9a88-9938409c5088
ms.service: azure-resource-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 12/27/2016
ms.author: dugill;tomfitz
ms.openlocfilehash: 757e45fdb28488b45de70647746461888bf35a56
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="use-resource-manager-authentication-api-tooaccess-subscriptions"></a><span data-ttu-id="f3a86-103">Utilizar suscripciones de tooaccess de API de autenticación de administrador de recursos</span><span class="sxs-lookup"><span data-stu-id="f3a86-103">Use Resource Manager authentication API tooaccess subscriptions</span></span>
## <a name="introduction"></a><span data-ttu-id="f3a86-104">Introducción</span><span class="sxs-lookup"><span data-stu-id="f3a86-104">Introduction</span></span>
<span data-ttu-id="f3a86-105">Si es un desarrollador de software que necesita toocreate una aplicación que administra los recursos de Azure del cliente, este tema muestra cómo tooauthenticate con hello las API del Administrador de recursos de Azure y obtener acceso tooresources en otras suscripciones.</span><span class="sxs-lookup"><span data-stu-id="f3a86-105">If you are a software developer who needs toocreate an app that manages customer's Azure resources, this topic shows you how tooauthenticate with hello Azure Resource Manager APIs and gain access tooresources in other subscriptions.</span></span>

<span data-ttu-id="f3a86-106">La aplicación puede tener acceso a Hola API del Administrador de recursos de dos maneras:</span><span class="sxs-lookup"><span data-stu-id="f3a86-106">Your app can access hello Resource Manager APIs in couple of ways:</span></span>

1. <span data-ttu-id="f3a86-107">**Acceso de usuario + aplicación**: para aplicaciones que acceden a los recursos en nombre de un usuario con una sesión iniciada.</span><span class="sxs-lookup"><span data-stu-id="f3a86-107">**User + app access**: for apps that access resources on behalf of a signed-in user.</span></span> <span data-ttu-id="f3a86-108">Este enfoque funciona con aplicaciones, como aplicaciones web y herramientas de línea de comandos, que se encargan solo de la "administración interactiva" de los recursos de Azure.</span><span class="sxs-lookup"><span data-stu-id="f3a86-108">This approach works for apps, such as web apps and command-line tools, that deal with only "interactive management" of Azure resources.</span></span>
2. <span data-ttu-id="f3a86-109">**Acceso de solo aplicación**: para las aplicaciones que ejecutan servicios de demonio y trabajos programados.</span><span class="sxs-lookup"><span data-stu-id="f3a86-109">**App-only access**: for apps that run daemon services and scheduled jobs.</span></span> <span data-ttu-id="f3a86-110">identidad de la aplicación Hello se concede recursos toohello de acceso directo.</span><span class="sxs-lookup"><span data-stu-id="f3a86-110">hello app's identity is granted direct access toohello resources.</span></span> <span data-ttu-id="f3a86-111">Este enfoque funciona para las aplicaciones que necesiten tooAzure de acceso (desatendido) sin periféricos a largo plazo.</span><span class="sxs-lookup"><span data-stu-id="f3a86-111">This approach works for apps that need long-term headless (unattended) access tooAzure.</span></span>

<span data-ttu-id="f3a86-112">Este tema proporciona instrucciones paso a paso toocreate una aplicación que utiliza estos métodos de autorización.</span><span class="sxs-lookup"><span data-stu-id="f3a86-112">This topic provides step-by-step instructions toocreate an app that employs both these authorization methods.</span></span> <span data-ttu-id="f3a86-113">Muestra cómo tooperform cada paso con API de REST o C#.</span><span class="sxs-lookup"><span data-stu-id="f3a86-113">It shows how tooperform each step with REST API or C#.</span></span> <span data-ttu-id="f3a86-114">está disponible en la aplicación de ASP.NET MVC completa Hello [https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense](https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense).</span><span class="sxs-lookup"><span data-stu-id="f3a86-114">hello complete ASP.NET MVC application is available at [https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense](https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense).</span></span>

## <a name="what-hello-web-app-does"></a><span data-ttu-id="f3a86-115">¿Qué aplicación web de hello</span><span class="sxs-lookup"><span data-stu-id="f3a86-115">What hello web app does</span></span>
<span data-ttu-id="f3a86-116">Hola a la aplicación web:</span><span class="sxs-lookup"><span data-stu-id="f3a86-116">hello web app:</span></span>

1. <span data-ttu-id="f3a86-117">Inicia sesión de un usuario de Azure.</span><span class="sxs-lookup"><span data-stu-id="f3a86-117">Signs-in an Azure user.</span></span>
2. <span data-ttu-id="f3a86-118">Solicita acceso usuario toogrant hello web app tooResource Manager.</span><span class="sxs-lookup"><span data-stu-id="f3a86-118">Asks user toogrant hello web app access tooResource Manager.</span></span>
3. <span data-ttu-id="f3a86-119">Obtiene un token de acceso de usuario + aplicación para acceder a Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="f3a86-119">Gets user + app access token for accessing Resource Manager.</span></span>
4. <span data-ttu-id="f3a86-120">Utiliza toocall token (del paso 3) el Administrador de recursos y el rol de tooa principal de servicio de la aplicación de asignar Hola de suscripción de hello, que ofrece la suscripción de toohello de acceso a largo plazo de hello aplicación.</span><span class="sxs-lookup"><span data-stu-id="f3a86-120">Uses token (from step 3) toocall Resource Manager and assign hello app's service principal tooa role in hello subscription, which gives hello app long-term access toohello subscription.</span></span>
5. <span data-ttu-id="f3a86-121">Obtiene un token de acceso de solo aplicación.</span><span class="sxs-lookup"><span data-stu-id="f3a86-121">Gets app-only access token.</span></span>
6. <span data-ttu-id="f3a86-122">Utiliza recursos de toomanage token (del paso 5) en la suscripción de Hola a través del Administrador de recursos.</span><span class="sxs-lookup"><span data-stu-id="f3a86-122">Uses token (from step 5) toomanage resources in hello subscription through Resource Manager.</span></span>

<span data-ttu-id="f3a86-123">Aquí es flujo de hello-to-end de aplicación web de Hola.</span><span class="sxs-lookup"><span data-stu-id="f3a86-123">Here's hello end-to-end flow of hello web application.</span></span>

![Flujo de autenticación de Resource Manage](./media/resource-manager-api-authentication/Auth-Swim-Lane.png)

<span data-ttu-id="f3a86-125">Como un usuario, puede proporcionar el Id. de suscripción de hello para la suscripción de hello desea toouse:</span><span class="sxs-lookup"><span data-stu-id="f3a86-125">As a user, you provide hello subscription id for hello subscription you want toouse:</span></span>

![proporcionar id. de suscripción](./media/resource-manager-api-authentication/sample-ux-1.png)

<span data-ttu-id="f3a86-127">Seleccione hello toouse de cuenta de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="f3a86-127">Select hello account toouse for logging in.</span></span>

![seleccionar cuenta](./media/resource-manager-api-authentication/sample-ux-2.png)

<span data-ttu-id="f3a86-129">Proporcione sus credenciales.</span><span class="sxs-lookup"><span data-stu-id="f3a86-129">Provide your credentials.</span></span>

![proporcionar credenciales](./media/resource-manager-api-authentication/sample-ux-3.png)

<span data-ttu-id="f3a86-131">Conceder tooyour de acceso de aplicación hello las suscripciones de Azure:</span><span class="sxs-lookup"><span data-stu-id="f3a86-131">Grant hello app access tooyour Azure subscriptions:</span></span>

![Conceder acceso](./media/resource-manager-api-authentication/sample-ux-4.png)

<span data-ttu-id="f3a86-133">Administre las suscripciones conectadas:</span><span class="sxs-lookup"><span data-stu-id="f3a86-133">Manage your connected subscriptions:</span></span>

![Conectar suscripción](./media/resource-manager-api-authentication/sample-ux-7.png)

## <a name="register-application"></a><span data-ttu-id="f3a86-135">Registre la aplicación</span><span class="sxs-lookup"><span data-stu-id="f3a86-135">Register application</span></span>
<span data-ttu-id="f3a86-136">Antes de comenzar a codificar, registre la aplicación web con Azure Active Directory (AD).</span><span class="sxs-lookup"><span data-stu-id="f3a86-136">Before you start coding, register your web app with Azure Active Directory (AD).</span></span> <span data-ttu-id="f3a86-137">registro de una aplicación Hola crea una identidad central para la aplicación en Azure AD.</span><span class="sxs-lookup"><span data-stu-id="f3a86-137">hello app registration creates a central identity for your app in Azure AD.</span></span> <span data-ttu-id="f3a86-138">Contiene información básica acerca de la aplicación como identificador de cliente OAuth, direcciones URL de respuesta y las credenciales que su aplicación usa tooauthenticate y acceso a las API del Administrador de recursos de Azure.</span><span class="sxs-lookup"><span data-stu-id="f3a86-138">It holds basic information about your application like OAuth Client ID, Reply URLs, and credentials that your application uses tooauthenticate and access Azure Resource Manager APIs.</span></span> <span data-ttu-id="f3a86-139">registro de una aplicación Hola también registra Hola distintos permisos que necesita la aplicación al tener acceso a Microsoft APIs en nombre de usuario de Hola de delegados.</span><span class="sxs-lookup"><span data-stu-id="f3a86-139">hello app registration also records hello various delegated permissions that your application needs when accessing Microsoft APIs on behalf of hello user.</span></span>

<span data-ttu-id="f3a86-140">Dado que la aplicación tiene acceso a otra suscripción, debe configurarla como una aplicación multiinquilino.</span><span class="sxs-lookup"><span data-stu-id="f3a86-140">Because your app accesses other subscription, you must configure it as a multi-tenant application.</span></span> <span data-ttu-id="f3a86-141">validación de toopass, proporcionar un dominio asociado con su Active Directory de Azure.</span><span class="sxs-lookup"><span data-stu-id="f3a86-141">toopass validation, provide a domain associated with your Azure Active Directory.</span></span> <span data-ttu-id="f3a86-142">dominios de hello toosee asociados con Azure Active Directory, inicio de sesión toohello [portal clásico](https://manage.windowsazure.com).</span><span class="sxs-lookup"><span data-stu-id="f3a86-142">toosee hello domains associated with your Azure Active Directory, log in toohello [classic portal](https://manage.windowsazure.com).</span></span> <span data-ttu-id="f3a86-143">Seleccione Azure Active Directory y luego **Dominios**.</span><span class="sxs-lookup"><span data-stu-id="f3a86-143">Select your Azure Active Directory and then select **Domains**.</span></span>

<span data-ttu-id="f3a86-144">Hola de ejemplo siguiente muestra cómo tooregister Hola aplicación mediante Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="f3a86-144">hello following example shows how tooregister hello app by using Azure PowerShell.</span></span> <span data-ttu-id="f3a86-145">Debe tener Hola versión más reciente (agosto de 2016) de PowerShell de Azure para este comando toowork.</span><span class="sxs-lookup"><span data-stu-id="f3a86-145">You must have hello latest version (August 2016) of Azure PowerShell for this command toowork.</span></span>

    $app = New-AzureRmADApplication -DisplayName "{app name}" -HomePage "https://{your domain}/{app name}" -IdentifierUris "https://{your domain}/{app name}" -Password "{your password}" -AvailableToOtherTenants $true

<span data-ttu-id="f3a86-146">toolog en como Hola aplicación de AD, necesita contraseña e Id. de aplicación de Hola.</span><span class="sxs-lookup"><span data-stu-id="f3a86-146">toolog in as hello AD application, you need hello application id and password.</span></span> <span data-ttu-id="f3a86-147">identificador de la aplicación de hello toosee que se devuelve desde el comando anterior hello, use:</span><span class="sxs-lookup"><span data-stu-id="f3a86-147">toosee hello application id that is returned from hello previous command, use:</span></span>

    $app.ApplicationId

<span data-ttu-id="f3a86-148">Hola de ejemplo siguiente muestra cómo tooregister Hola aplicación mediante Azure CLI.</span><span class="sxs-lookup"><span data-stu-id="f3a86-148">hello following example shows how tooregister hello app by using Azure CLI.</span></span>

    azure ad app create --name {app name} --home-page https://{your domain}/{app name} --identifier-uris https://{your domain}/{app name} --password {your password} --available true

<span data-ttu-id="f3a86-149">los resultados de Hello incluyen hello AppId, que necesita autenticarse como aplicación hello.</span><span class="sxs-lookup"><span data-stu-id="f3a86-149">hello results include hello AppId, which you need when authenticating as hello application.</span></span>

### <a name="optional-configuration---certificate-credential"></a><span data-ttu-id="f3a86-150">Configuración opcional: credencial de certificado</span><span class="sxs-lookup"><span data-stu-id="f3a86-150">Optional configuration - certificate credential</span></span>
<span data-ttu-id="f3a86-151">Azure AD también admite credenciales de certificado para las aplicaciones: crear un certificado autofirmado, mantenga la clave privada de Hola y agregar el registro de la aplicación hello tooyour clave pública Azure AD.</span><span class="sxs-lookup"><span data-stu-id="f3a86-151">Azure AD also supports certificate credentials for applications: you create a self-signed cert, keep hello private key, and add hello public key tooyour Azure AD application registration.</span></span> <span data-ttu-id="f3a86-152">Para la autenticación, la aplicación envía una tooAzure carga pequeña AD firmada con la clave privada y Azure AD valida la firma de hello mediante clave pública de Hola que haya registrado.</span><span class="sxs-lookup"><span data-stu-id="f3a86-152">For authentication, your application sends a small payload tooAzure AD signed using your private key, and Azure AD validates hello signature using hello public key that you registered.</span></span>

<span data-ttu-id="f3a86-153">Para obtener información acerca de cómo crear una aplicación de AD con un certificado, consulte [toocreate de PowerShell de Azure Use una entidad de servicio recursos tooaccess](resource-group-authenticate-service-principal.md#create-service-principal-with-certificate-from-certificate-authority) o [toocreate de CLI de Azure Use una entidad de servicio tooaccess recursos](resource-group-authenticate-service-principal-cli.md#create-service-principal-with-certificate).</span><span class="sxs-lookup"><span data-stu-id="f3a86-153">For information about creating an AD app with a certificate, see [Use Azure PowerShell toocreate a service principal tooaccess resources](resource-group-authenticate-service-principal.md#create-service-principal-with-certificate-from-certificate-authority) or [Use Azure CLI toocreate a service principal tooaccess resources](resource-group-authenticate-service-principal-cli.md#create-service-principal-with-certificate).</span></span>

## <a name="get-tenant-id-from-subscription-id"></a><span data-ttu-id="f3a86-154">Obtención de un identificador de inquilino a partir del identificador de suscripción</span><span class="sxs-lookup"><span data-stu-id="f3a86-154">Get tenant id from subscription id</span></span>
<span data-ttu-id="f3a86-155">toorequest un símbolo (token) que puede ser toocall usa el Administrador de recursos, la aplicación necesita tooknow el identificador del inquilino de Hola de hello Azure AD que hospeda Hola suscripción de Azure.</span><span class="sxs-lookup"><span data-stu-id="f3a86-155">toorequest a token that can be used toocall Resource Manager, your application needs tooknow hello tenant ID of hello Azure AD tenant that hosts hello Azure subscription.</span></span> <span data-ttu-id="f3a86-156">Es muy probable que los usuarios conozcan sus identificadores de suscripción, pero quizá no sus identificadores de inquilino para Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="f3a86-156">Most likely, your users know their subscription ids, but they might not know their tenant ids for Azure Active Directory.</span></span> <span data-ttu-id="f3a86-157">tooget Hola Id. de inquilino del usuario, solicitar el usuario de Hola Hola Id. de suscripción. Al enviar una solicitud acerca de la suscripción de Hola, proporcionar ese identificador de suscripción:</span><span class="sxs-lookup"><span data-stu-id="f3a86-157">tooget hello user's tenant id, ask hello user for hello subscription id. Provide that subscription id when sending a request about hello subscription:</span></span>

    https://management.azure.com/subscriptions/{subscription-id}?api-version=2015-01-01

<span data-ttu-id="f3a86-158">solicitud de Hello produce un error porque el usuario hello no ha registrado aún en, pero se puede recuperar el Id. de inquilino de Hola de respuesta de Hola.</span><span class="sxs-lookup"><span data-stu-id="f3a86-158">hello request fails because hello user has not logged in yet, but you can retrieve hello tenant id from hello response.</span></span> <span data-ttu-id="f3a86-159">En esa excepción, recuperar el Id. de inquilino de hello del valor del encabezado de respuesta de Hola para **WWW-Authenticate**.</span><span class="sxs-lookup"><span data-stu-id="f3a86-159">In that exception, retrieve hello tenant id from hello response header value for **WWW-Authenticate**.</span></span> <span data-ttu-id="f3a86-160">Vea esta implementación en hello [GetDirectoryForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L20) método.</span><span class="sxs-lookup"><span data-stu-id="f3a86-160">You see this implementation in hello [GetDirectoryForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L20) method.</span></span>

## <a name="get-user--app-access-token"></a><span data-ttu-id="f3a86-161">Obtención de un token de acceso de usuario + aplicación</span><span class="sxs-lookup"><span data-stu-id="f3a86-161">Get user + app access token</span></span>
<span data-ttu-id="f3a86-162">La aplicación redirige Hola usuario tooAzure AD con un OAuth 2.0 autorizar solicitudes - las credenciales de usuario de tooauthenticate hello y devolver un código de autorización.</span><span class="sxs-lookup"><span data-stu-id="f3a86-162">Your application redirects hello user tooAzure AD with an OAuth 2.0 Authorize Request - tooauthenticate hello user's credentials and get back an authorization code.</span></span> <span data-ttu-id="f3a86-163">La aplicación usa tooget de código de autorización de hello un token de acceso para el Administrador de recursos.</span><span class="sxs-lookup"><span data-stu-id="f3a86-163">Your application uses hello authorization code tooget an access token for Resource Manager.</span></span> <span data-ttu-id="f3a86-164">Hola [ConnectSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/Controllers/HomeController.cs#L42) método crea la solicitud de autorización de Hola.</span><span class="sxs-lookup"><span data-stu-id="f3a86-164">hello [ConnectSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/Controllers/HomeController.cs#L42) method creates hello authorization request.</span></span>

<span data-ttu-id="f3a86-165">En este tema muestra las solicitudes de API de REST de hello tooauthenticate usuario de Hola.</span><span class="sxs-lookup"><span data-stu-id="f3a86-165">This topic shows hello REST API requests tooauthenticate hello user.</span></span> <span data-ttu-id="f3a86-166">También puede utilizar autenticación de tooperform de bibliotecas de ayuda en el código.</span><span class="sxs-lookup"><span data-stu-id="f3a86-166">You can also use helper libraries tooperform authentication in your code.</span></span> <span data-ttu-id="f3a86-167">Para obtener más información sobre estas bibliotecas, consulte [Bibliotecas de autenticación de Azure Active Directory](../active-directory/active-directory-authentication-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="f3a86-167">For more information about these libraries, see [Azure Active Directory Authentication Libraries](../active-directory/active-directory-authentication-libraries.md).</span></span> <span data-ttu-id="f3a86-168">Para obtener instrucciones sobre la integración de la administración de identidades en una aplicación, consulte la [Guía del desarrollador de Azure Active Directory](../active-directory/active-directory-developers-guide.md).</span><span class="sxs-lookup"><span data-stu-id="f3a86-168">For guidance on integrating identity management in an application, see [Azure Active Directory developer's guide](../active-directory/active-directory-developers-guide.md).</span></span>

### <a name="auth-request-oauth-20"></a><span data-ttu-id="f3a86-169">Solicitud de autenticación (OAuth 2.0)</span><span class="sxs-lookup"><span data-stu-id="f3a86-169">Auth request (OAuth 2.0)</span></span>
<span data-ttu-id="f3a86-170">Emitir un punto de conexión abierto conectar/OAuth2.0 autorizar solicitudes de identificador de autorizar toohello Azure AD:</span><span class="sxs-lookup"><span data-stu-id="f3a86-170">Issue an Open ID Connect/OAuth2.0 Authorize Request toohello Azure AD Authorize endpoint:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Authorize

<span data-ttu-id="f3a86-171">parámetros de cadena de consulta de Hola que están disponibles para esta solicitud se describen en hello [solicitar un código de autorización](../active-directory/develop/active-directory-protocols-oauth-code.md#request-an-authorization-code) tema.</span><span class="sxs-lookup"><span data-stu-id="f3a86-171">hello query string parameters that are available for this request are described in hello [request an authorization code](../active-directory/develop/active-directory-protocols-oauth-code.md#request-an-authorization-code) topic.</span></span>

<span data-ttu-id="f3a86-172">Hola siguiente ejemplo se muestra cómo toorequest autorización de OAuth2.0:</span><span class="sxs-lookup"><span data-stu-id="f3a86-172">hello following example shows how toorequest OAuth2.0 authorization:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Authorize?client_id=a0448380-c346-4f9f-b897-c18733de9394&response_mode=query&response_type=code&redirect_uri=http%3a%2f%2fwww.vipswapper.com%2fcloudsense%2fAccount%2fSignIn&resource=https%3a%2f%2fgraph.windows.net%2f&domain_hint=live.com

<span data-ttu-id="f3a86-173">Azure AD autentica el usuario de hello y, si es necesario, le pide permiso toohello aplicación de hello usuario toogrant.</span><span class="sxs-lookup"><span data-stu-id="f3a86-173">Azure AD authenticates hello user, and, if necessary, asks hello user toogrant permission toohello app.</span></span> <span data-ttu-id="f3a86-174">Devuelve toohello de código de autorización de hello dirección URL de respuesta de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f3a86-174">It returns hello authorization code toohello Reply URL of your application.</span></span> <span data-ttu-id="f3a86-175">Función hello solicitado response_mode, Azure AD cualquiera le responde Hola datos de cadena de consulta o como datos de entrada.</span><span class="sxs-lookup"><span data-stu-id="f3a86-175">Depending on hello requested response_mode, Azure AD either sends back hello data in query string or as post data.</span></span>

    code=AAABAAAAiL****FDMZBUwZ8eCAA&session_state=2d16bbce-d5d1-443f-acdf-75f6b0ce8850

### <a name="auth-request-open-id-connect"></a><span data-ttu-id="f3a86-176">Solicitud de autenticación (Open ID Connect)</span><span class="sxs-lookup"><span data-stu-id="f3a86-176">Auth request (Open ID Connect)</span></span>
<span data-ttu-id="f3a86-177">Si lo desea tooaccess Azure Resource Manager en nombre de usuario de Hola y también permite Hola usuario toosign en aplicación tooyour con su cuenta de Azure AD, emitir una abra conectarse autorizar solicitudes de identificador.</span><span class="sxs-lookup"><span data-stu-id="f3a86-177">If you not only wish tooaccess Azure Resource Manager on behalf of hello user, but also allow hello user toosign in tooyour application using their Azure AD account, issue an Open ID Connect Authorize Request.</span></span> <span data-ttu-id="f3a86-178">Con Connect de identificador abierto, la aplicación también recibe un id_token de Azure AD que puede usar su aplicación toosign en usuario Hola.</span><span class="sxs-lookup"><span data-stu-id="f3a86-178">With Open ID Connect, your application also receives an id_token from Azure AD that your app can use toosign in hello user.</span></span>

<span data-ttu-id="f3a86-179">parámetros de cadena de consulta de Hola que están disponibles para esta solicitud se describen en hello [Hola inicio de sesión de solicitud de envío](../active-directory/develop/active-directory-protocols-openid-connect-code.md#send-the-sign-in-request) tema.</span><span class="sxs-lookup"><span data-stu-id="f3a86-179">hello query string parameters that are available for this request are described in hello [Send hello sign-in request](../active-directory/develop/active-directory-protocols-openid-connect-code.md#send-the-sign-in-request) topic.</span></span>

<span data-ttu-id="f3a86-180">Este es un ejemplo de solicitud de Open ID Connect:</span><span class="sxs-lookup"><span data-stu-id="f3a86-180">An example Open ID Connect request is:</span></span>

     https://login.microsoftonline.com/{tenant-id}/OAuth2/Authorize?client_id=a0448380-c346-4f9f-b897-c18733de9394&response_mode=form_post&response_type=code+id_token&redirect_uri=http%3a%2f%2fwww.vipswapper.com%2fcloudsense%2fAccount%2fSignIn&resource=https%3a%2f%2fgraph.windows.net%2f&scope=openid+profile&nonce=63567Dc4MDAw&domain_hint=live.com&state=M_12tMyKaM8

<span data-ttu-id="f3a86-181">Azure AD autentica el usuario de hello y, si es necesario, le pide permiso toohello aplicación de hello usuario toogrant.</span><span class="sxs-lookup"><span data-stu-id="f3a86-181">Azure AD authenticates hello user, and, if necessary, asks hello user toogrant permission toohello app.</span></span> <span data-ttu-id="f3a86-182">Devuelve toohello de código de autorización de hello dirección URL de respuesta de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f3a86-182">It returns hello authorization code toohello Reply URL of your application.</span></span> <span data-ttu-id="f3a86-183">Función hello solicitado response_mode, Azure AD cualquiera le responde Hola datos de cadena de consulta o como datos de entrada.</span><span class="sxs-lookup"><span data-stu-id="f3a86-183">Depending on hello requested response_mode, Azure AD either sends back hello data in query string or as post data.</span></span>

<span data-ttu-id="f3a86-184">Este es un ejemplo de respuesta de Open ID Connect:</span><span class="sxs-lookup"><span data-stu-id="f3a86-184">An example Open ID Connect response is:</span></span>

    code=AAABAAAAiL*****I4rDWd7zXsH6WUjlkIEQxIAA&id_token=eyJ0eXAiOiJKV1Q*****T3GrzzSFxg&state=M_12tMyKaM8&session_state=2d16bbce-d5d1-443f-acdf-75f6b0ce8850

### <a name="token-request-oauth20-code-grant-flow"></a><span data-ttu-id="f3a86-185">Solicitud de token (flujo de concesión de códigos de OAuth2.0)</span><span class="sxs-lookup"><span data-stu-id="f3a86-185">Token request (OAuth2.0 Code Grant Flow)</span></span>
<span data-ttu-id="f3a86-186">Ahora que la aplicación ha recibido el código de autorización de Hola de Azure AD, es el token de acceso de tiempo tooget hello para el Administrador de recursos de Azure.</span><span class="sxs-lookup"><span data-stu-id="f3a86-186">Now that your application has received hello authorization code from Azure AD, it is time tooget hello access token for Azure Resource Manager.</span></span>  <span data-ttu-id="f3a86-187">Exponga un extremo de Token de Azure AD toohello OAuth2.0 código Grant símbolo (token) de solicitud:</span><span class="sxs-lookup"><span data-stu-id="f3a86-187">Post an OAuth2.0 Code Grant Token Request toohello Azure AD Token endpoint:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Token

<span data-ttu-id="f3a86-188">parámetros de cadena de consulta de Hola que están disponibles para esta solicitud se describen en hello [usar código de autorización de hello](../active-directory/develop/active-directory-protocols-oauth-code.md#use-the-authorization-code-to-request-an-access-token) tema.</span><span class="sxs-lookup"><span data-stu-id="f3a86-188">hello query string parameters that are available for this request are described in hello [use hello authorization code](../active-directory/develop/active-directory-protocols-oauth-code.md#use-the-authorization-code-to-request-an-access-token) topic.</span></span>

<span data-ttu-id="f3a86-189">Hola de ejemplo siguiente muestra una solicitud de token de concesión de código con la credencial de contraseña:</span><span class="sxs-lookup"><span data-stu-id="f3a86-189">hello following example shows a request for code grant token with password credential:</span></span>

    POST https://login.microsoftonline.com/7fe877e6-a150-4992-bbfe-f517e304dfa0/oauth2/token HTTP/1.1

    Content-Type: application/x-www-form-urlencoded
    Content-Length: 1012

    grant_type=authorization_code&code=AAABAAAAiL9Kn2Z*****L1nVMH3Z5ESiAA&redirect_uri=http%3A%2F%2Flocalhost%3A62080%2FAccount%2FSignIn&client_id=a0448380-c346-4f9f-b897-c18733de9394&client_secret=olna84E8*****goScOg%3D

<span data-ttu-id="f3a86-190">Cuando se trabaja con las credenciales de certificado, cree un JSON Web Token (JWT) y el inicio de sesión (RSA SHA256) con clave privada de Hola de credencial de certificado de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f3a86-190">When working with certificate credentials, create a JSON Web Token (JWT) and sign (RSA SHA256) using hello private key of your application's certificate credential.</span></span> <span data-ttu-id="f3a86-191">tipos de notificación de token de Hola Hola se muestran una en [notificaciones de tokens de JWT](../active-directory/develop/active-directory-protocols-oauth-code.md#jwt-token-claims).</span><span class="sxs-lookup"><span data-stu-id="f3a86-191">hello claim types for hello token are shown in [JWT token claims](../active-directory/develop/active-directory-protocols-oauth-code.md#jwt-token-claims).</span></span> <span data-ttu-id="f3a86-192">Como referencia, vea hello [código biblioteca de autenticación de Active Directory (.NET)](https://github.com/AzureAD/azure-activedirectory-library-for-dotnet/blob/dev/src/ADAL.PCL.Desktop/CryptographyHelper.cs) toosign tokens de JWT de aserción de cliente.</span><span class="sxs-lookup"><span data-stu-id="f3a86-192">For reference, see hello [Active Directory Auth Library (.NET) code](https://github.com/AzureAD/azure-activedirectory-library-for-dotnet/blob/dev/src/ADAL.PCL.Desktop/CryptographyHelper.cs) toosign Client Assertion JWT tokens.</span></span>

<span data-ttu-id="f3a86-193">Vea hello [conectarse de identificador abierto especificación](http://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication) para obtener más información acerca de la autenticación de cliente.</span><span class="sxs-lookup"><span data-stu-id="f3a86-193">See hello [Open ID Connect spec](http://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication) for details on client authentication.</span></span>

<span data-ttu-id="f3a86-194">Hola de ejemplo siguiente muestra una solicitud de token de concesión de código con credenciales de certificado:</span><span class="sxs-lookup"><span data-stu-id="f3a86-194">hello following example shows a request for code grant token with certificate credential:</span></span>

    POST https://login.microsoftonline.com/7fe877e6-a150-4992-bbfe-f517e304dfa0/oauth2/token HTTP/1.1

    Content-Type: application/x-www-form-urlencoded
    Content-Length: 1012

    grant_type=authorization_code&code=AAABAAAAiL9Kn2Z*****L1nVMH3Z5ESiAA&redirect_uri=http%3A%2F%2Flocalhost%3A62080%2FAccount%2FSignIn&client_id=a0448380-c346-4f9f-b897-c18733de9394&client_assertion_type=urn%3Aietf%3Aparams%3Aoauth%3Aclient-assertion-type%3Ajwt-bearer&client_assertion=eyJhbG*****Y9cYo8nEjMyA

<span data-ttu-id="f3a86-195">Un ejemplo de respuesta de token de concesión de códigos:</span><span class="sxs-lookup"><span data-stu-id="f3a86-195">An example response for code grant token:</span></span>

    HTTP/1.1 200 OK

    {"token_type":"Bearer","expires_in":"3599","expires_on":"1432039858","not_before":"1432035958","resource":"https://management.core.windows.net/","access_token":"eyJ0eXAiOiJKV1Q****M7Cw6JWtfY2lGc5A","refresh_token":"AAABAAAAiL9Kn2Z****55j-sjnyYgAA","scope":"user_impersonation","id_token":"eyJ0eXAiOiJKV*****-drP1J3P-HnHi9Rr46kGZnukEBH4dsg"}

#### <a name="handle-code-grant-token-response"></a><span data-ttu-id="f3a86-196">Control de la respuesta de token de concesión de códigos</span><span class="sxs-lookup"><span data-stu-id="f3a86-196">Handle code grant token response</span></span>
<span data-ttu-id="f3a86-197">Una respuesta correcta del token contiene el token de acceso de hello (usuario + aplicación) para el Administrador de recursos de Azure.</span><span class="sxs-lookup"><span data-stu-id="f3a86-197">A successful token response contains hello (user + app) access token for Azure Resource Manager.</span></span> <span data-ttu-id="f3a86-198">La aplicación usa este tooaccess de token de acceso el Administrador de recursos en nombre de usuario de Hola.</span><span class="sxs-lookup"><span data-stu-id="f3a86-198">Your application uses this access token tooaccess Resource Manager on behalf of hello user.</span></span> <span data-ttu-id="f3a86-199">duración de Hola de tokens de acceso emitido por Azure AD es una hora.</span><span class="sxs-lookup"><span data-stu-id="f3a86-199">hello lifetime of access tokens issued by Azure AD is one hour.</span></span> <span data-ttu-id="f3a86-200">No es probable que la aplicación web necesita el token de acceso de toorenew Hola (usuario + aplicación).</span><span class="sxs-lookup"><span data-stu-id="f3a86-200">It is unlikely that your web application needs toorenew hello (user + app) access token.</span></span> <span data-ttu-id="f3a86-201">Si es necesario el token de acceso de toorenew hello, usar el token de actualización de Hola que recibe la aplicación en respuesta de token de Hola.</span><span class="sxs-lookup"><span data-stu-id="f3a86-201">If it needs toorenew hello access token, use hello refresh token that your application receives in hello token response.</span></span> <span data-ttu-id="f3a86-202">Exponga un extremo de Token de Azure AD toohello OAuth2.0 de solicitud de Token:</span><span class="sxs-lookup"><span data-stu-id="f3a86-202">Post an OAuth2.0 Token Request toohello Azure AD Token endpoint:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Token

<span data-ttu-id="f3a86-203">Hello toouse de parámetros con la solicitud de actualización de Hola se describen en [actualizar token de acceso de hello](../active-directory/develop/active-directory-protocols-oauth-code.md#refreshing-the-access-tokens).</span><span class="sxs-lookup"><span data-stu-id="f3a86-203">hello parameters toouse with hello refresh request are described in [refreshing hello access token](../active-directory/develop/active-directory-protocols-oauth-code.md#refreshing-the-access-tokens).</span></span>

<span data-ttu-id="f3a86-204">Hello en el ejemplo siguiente se muestra cómo toouse Hola el token de actualización:</span><span class="sxs-lookup"><span data-stu-id="f3a86-204">hello following example shows how toouse hello refresh token:</span></span>

    POST https://login.microsoftonline.com/7fe877e6-a150-4992-bbfe-f517e304dfa0/oauth2/token HTTP/1.1

    Content-Type: application/x-www-form-urlencoded
    Content-Length: 1012

    grant_type=refresh_token&refresh_token=AAABAAAAiL9Kn2Z****55j-sjnyYgAA&client_id=a0448380-c346-4f9f-b897-c18733de9394&client_secret=olna84E8*****goScOg%3D

<span data-ttu-id="f3a86-205">Aunque los tokens de actualización pueden ser utilizados tooget nuevos tokens de acceso para el Administrador de recursos de Azure, no son adecuados para el acceso sin conexión a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f3a86-205">Although refresh tokens can be used tooget new access tokens for Azure Resource Manager, they are not suitable for offline access by your application.</span></span> <span data-ttu-id="f3a86-206">se limita la duración de tokens de actualización de Hola y tokens de actualización son usuario toohello enlazado.</span><span class="sxs-lookup"><span data-stu-id="f3a86-206">hello refresh tokens lifetime is limited, and refresh tokens are bound toohello user.</span></span> <span data-ttu-id="f3a86-207">Si el usuario de hello abandona la organización de hello, aplicación hello mediante el token de actualización de hello pierda el acceso.</span><span class="sxs-lookup"><span data-stu-id="f3a86-207">If hello user leaves hello organization, hello application using hello refresh token loses access.</span></span> <span data-ttu-id="f3a86-208">Este enfoque no es apta para las aplicaciones que son utilizados por los equipos toomanage sus recursos de Azure.</span><span class="sxs-lookup"><span data-stu-id="f3a86-208">This approach isn't suitable for applications that are used by teams toomanage their Azure resources.</span></span>

## <a name="check-if-user-can-assign-access-toosubscription"></a><span data-ttu-id="f3a86-209">Compruebe si el usuario puede asignar acceso toosubscription</span><span class="sxs-lookup"><span data-stu-id="f3a86-209">Check if user can assign access toosubscription</span></span>
<span data-ttu-id="f3a86-210">La aplicación ahora tiene un token tooaccess Azure Resource Manager en nombre de usuario de Hola.</span><span class="sxs-lookup"><span data-stu-id="f3a86-210">Your application now has a token tooaccess Azure Resource Manager on behalf of hello user.</span></span> <span data-ttu-id="f3a86-211">paso siguiente Hello es tooconnect su suscripción de toohello de aplicación.</span><span class="sxs-lookup"><span data-stu-id="f3a86-211">hello next step is tooconnect your app toohello subscription.</span></span> <span data-ttu-id="f3a86-212">Después de conectarse, la aplicación puede administrar las suscripciones incluso cuando el usuario de hello no está presente (acceso sin conexión a largo plazo).</span><span class="sxs-lookup"><span data-stu-id="f3a86-212">After connecting, your app can manage those subscriptions even when hello user isn't present (long-term offline access).</span></span>

<span data-ttu-id="f3a86-213">Para cada tooconnect de suscripción, llame a hello [permisos de lista del Administrador de recursos](https://docs.microsoft.com/rest/api/authorization/permissions) toodetermine API si el usuario de hello tiene derechos de administración de acceso para la suscripción de Hola.</span><span class="sxs-lookup"><span data-stu-id="f3a86-213">For each subscription tooconnect, call hello [Resource Manager list permissions](https://docs.microsoft.com/rest/api/authorization/permissions) API toodetermine whether hello user has access management rights for hello subscription.</span></span>

<span data-ttu-id="f3a86-214">Hola [UserCanManagerAccessForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L44) método de hello aplicación de ejemplo de ASP.NET MVC implementa esta llamada.</span><span class="sxs-lookup"><span data-stu-id="f3a86-214">hello [UserCanManagerAccessForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L44) method of hello ASP.NET MVC sample app implements this call.</span></span>

<span data-ttu-id="f3a86-215">Hola siguiente ejemplo se muestra cómo toorequest permisos de un usuario en una suscripción.</span><span class="sxs-lookup"><span data-stu-id="f3a86-215">hello following example shows how toorequest a user's permissions on a subscription.</span></span> <span data-ttu-id="f3a86-216">83cfe939-2402-4581-b761-4f59b0a041e4 es el Id. de Hola de suscripción de Hola.</span><span class="sxs-lookup"><span data-stu-id="f3a86-216">83cfe939-2402-4581-b761-4f59b0a041e4 is hello id of hello subscription.</span></span>

    GET https://management.azure.com/subscriptions/83cfe939-2402-4581-b761-4f59b0a041e4/providers/microsoft.authorization/permissions?api-version=2015-07-01 HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJKV1QiLC***lwO1mM7Cw6JWtfY2lGc5A

<span data-ttu-id="f3a86-217">Es un ejemplo de permisos del usuario de hello respuesta tooget suscripción:</span><span class="sxs-lookup"><span data-stu-id="f3a86-217">An example of hello response tooget user's permissions on subscription is:</span></span>

    HTTP/1.1 200 OK

    {"value":[{"actions":["*"],"notActions":["Microsoft.Authorization/*/Write","Microsoft.Authorization/*/Delete"]},{"actions":["*/read"],"notActions":[]}]}

<span data-ttu-id="f3a86-218">permisos de Hello API devuelve varios permisos.</span><span class="sxs-lookup"><span data-stu-id="f3a86-218">hello permissions API returns multiple permissions.</span></span> <span data-ttu-id="f3a86-219">Cada permiso consta de acciones permitidas (actions) y acciones no permitidas (notactions).</span><span class="sxs-lookup"><span data-stu-id="f3a86-219">Each permission consists of allowed actions (actions) and disallowed actions (notactions).</span></span> <span data-ttu-id="f3a86-220">Si una acción está presente en hello lista de acciones de cualquier permiso de elementos permitido y no está presente en lista de notactions Hola de ese permiso, hello es permitido tooperform esa acción.</span><span class="sxs-lookup"><span data-stu-id="f3a86-220">If an action is present in hello allowed actions list of any permission and not present in hello notactions list of that permission, hello user is allowed tooperform that action.</span></span> <span data-ttu-id="f3a86-221">**Microsoft.Authorization/RoleAssignments/Write** es la acción de Hola que conceda acceso de rights management.</span><span class="sxs-lookup"><span data-stu-id="f3a86-221">**microsoft.authorization/roleassignments/write** is hello action that that grants access management rights.</span></span> <span data-ttu-id="f3a86-222">La aplicación debe analizar toolook de resultado de hello permisos para una coincidencia de expresión regular con esta cadena de acción en las acciones de Hola y notactions de cada permiso.</span><span class="sxs-lookup"><span data-stu-id="f3a86-222">Your application must parse hello permissions result toolook for a regex match on this action string in hello actions and notactions of each permission.</span></span>

## <a name="get-app-only-access-token"></a><span data-ttu-id="f3a86-223">Obtención de un token de acceso de solo aplicación</span><span class="sxs-lookup"><span data-stu-id="f3a86-223">Get app-only access token</span></span>
<span data-ttu-id="f3a86-224">Ahora, sabrá si el usuario Hola puede asignar acceso toohello suscripción de Azure.</span><span class="sxs-lookup"><span data-stu-id="f3a86-224">Now, you know if hello user can assign access toohello Azure subscription.</span></span> <span data-ttu-id="f3a86-225">pasos siguientes Hola son:</span><span class="sxs-lookup"><span data-stu-id="f3a86-225">hello next steps are:</span></span>

1. <span data-ttu-id="f3a86-226">Asignar Hola adecuado RBAC rol tooyour identidad de la aplicación en la suscripción de Hola.</span><span class="sxs-lookup"><span data-stu-id="f3a86-226">Assign hello appropriate RBAC role tooyour application's identity on hello subscription.</span></span>
2. <span data-ttu-id="f3a86-227">Validar la asignación de acceso de hello mediante una consulta para el permiso de la aplicación hello en suscripción de Hola o mediante el acceso a Administrador de recursos usando solo de aplicación de símbolo (token).</span><span class="sxs-lookup"><span data-stu-id="f3a86-227">Validate hello access assignment by querying for hello Application's permission on hello subscription or by accessing Resource Manager using app-only token.</span></span>
3. <span data-ttu-id="f3a86-228">Conexión de hello registros en la estructura de datos de aplicaciones "conectado suscripciones" - conservar el identificador de Hola de suscripción de Hola.</span><span class="sxs-lookup"><span data-stu-id="f3a86-228">Record hello connection in your applications "connected subscriptions" data structure - persisting hello id of hello subscription.</span></span>

<span data-ttu-id="f3a86-229">Echemos un vistazo más de cerca en el primer paso de Hola.</span><span class="sxs-lookup"><span data-stu-id="f3a86-229">Let's look closer at hello first step.</span></span> <span data-ttu-id="f3a86-230">tooassign Hola adecuado RBAC rol toohello identidad de la aplicación, debe determinar:</span><span class="sxs-lookup"><span data-stu-id="f3a86-230">tooassign hello appropriate RBAC role toohello application's identity, you must determine:</span></span>

* <span data-ttu-id="f3a86-231">Id. de objeto de Hola de identidad de la aplicación en Azure Active Directory del usuario de hello</span><span class="sxs-lookup"><span data-stu-id="f3a86-231">hello object id of your application's identity in hello user's Azure Active Directory</span></span>
* <span data-ttu-id="f3a86-232">Hola identificador del rol RBAC Hola que requiera la aplicación de suscripción de Hola</span><span class="sxs-lookup"><span data-stu-id="f3a86-232">hello identifier of hello RBAC role that your application requires on hello subscription</span></span>

<span data-ttu-id="f3a86-233">Cuando la aplicación autentica a un usuario desde un directorio de Azure AD, crea un objeto de entidad de servicio para la aplicación en dicho directorio de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="f3a86-233">When your application authenticates a user from an Azure AD, it creates a service principal object for your application in that Azure AD.</span></span> <span data-ttu-id="f3a86-234">Azure permite RBAC roles toobe asignado a las entidades de seguridad tooservice toocorresponding aplicaciones de acceso directo de toogrant en recursos de Azure.</span><span class="sxs-lookup"><span data-stu-id="f3a86-234">Azure allows RBAC roles toobe assigned tooservice principals toogrant direct access toocorresponding applications on Azure resources.</span></span> <span data-ttu-id="f3a86-235">Esta acción es exactamente lo que deseamos toodo.</span><span class="sxs-lookup"><span data-stu-id="f3a86-235">This action is exactly what we wish toodo.</span></span> <span data-ttu-id="f3a86-236">Consulta hello Azure AD Graph API toodetermine Hola identificador de entidad de servicio de saludo de la aplicación de usuario que inició sesión hello's Azure AD.</span><span class="sxs-lookup"><span data-stu-id="f3a86-236">Query hello Azure AD Graph API toodetermine hello identifier of hello service principal of your application in hello signed-in user's Azure AD.</span></span>

<span data-ttu-id="f3a86-237">Solo tiene un token de acceso para el Administrador de recursos de Azure, necesita un hello toocall símbolo (token) de acceso nueva API de Azure AD Graph.</span><span class="sxs-lookup"><span data-stu-id="f3a86-237">You only have an access token for Azure Resource Manager - you need a new access token toocall hello Azure AD Graph API.</span></span> <span data-ttu-id="f3a86-238">Todas las aplicaciones de Azure AD tiene permiso tooquery su propio objeto de entidad de servicio, por lo que un token de acceso de solo de aplicación es suficiente.</span><span class="sxs-lookup"><span data-stu-id="f3a86-238">Every application in Azure AD has permission tooquery its own service principal object, so an app-only access token is sufficient.</span></span>

<a id="app-azure-ad-graph" />

### <a name="get-app-only-access-token-for-azure-ad-graph-api"></a><span data-ttu-id="f3a86-239">Obtención de token de acceso de solo aplicación para la API de Azure AD Graph</span><span class="sxs-lookup"><span data-stu-id="f3a86-239">Get app-only access token for Azure AD Graph API</span></span>
<span data-ttu-id="f3a86-240">tooauthenticate tu aplicación y un token tooAzure AD Graph API, emitir un extremo de token de tooAzure AD de OAuth2.0 de concesión de credenciales de cliente flujo solicitud de token (**https://login.microsoftonline.com/ {directory_domain_name} / OAuth2/Token**).</span><span class="sxs-lookup"><span data-stu-id="f3a86-240">tooauthenticate your app and get a token tooAzure AD Graph API, issue a Client Credential Grant OAuth2.0 flow token request tooAzure AD token endpoint (**https://login.microsoftonline.com/{directory_domain_name}/OAuth2/Token**).</span></span>

<span data-ttu-id="f3a86-241">Hola [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs) método de aplicación de ejemplo de ASP.net MVC obtiene acceso solo de aplicación token para el uso de API Graph de hello Hola biblioteca de autenticación de Active Directory para. NET.</span><span class="sxs-lookup"><span data-stu-id="f3a86-241">hello [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs) method of hello ASP.net MVC sample application gets an app-only access token for Graph API using hello Active Directory Authentication Library for .NET.</span></span>

<span data-ttu-id="f3a86-242">parámetros de cadena de consulta de Hola que están disponibles para esta solicitud se describen en hello [solicitar un Token de acceso](../active-directory/develop/active-directory-protocols-oauth-service-to-service.md#request-an-access-token) tema.</span><span class="sxs-lookup"><span data-stu-id="f3a86-242">hello query string parameters that are available for this request are described in hello [Request an Access Token](../active-directory/develop/active-directory-protocols-oauth-service-to-service.md#request-an-access-token) topic.</span></span>

<span data-ttu-id="f3a86-243">Una solicitud de ejemplo de token de concesión de credenciales de cliente:</span><span class="sxs-lookup"><span data-stu-id="f3a86-243">An example request for client credential grant token:</span></span>

    POST https://login.microsoftonline.com/62e173e9-301e-423e-bcd4-29121ec1aa24/oauth2/token HTTP/1.1
    Content-Type: application/x-www-form-urlencoded
    Content-Length: 187</pre>
    <pre>grant_type=client_credentials&client_id=a0448380-c346-4f9f-b897-c18733de9394&resource=https%3A%2F%2Fgraph.windows.net%2F &client_secret=olna8C*****Og%3D

<span data-ttu-id="f3a86-244">Una respuesta de ejemplo de token de concesión de credenciales de cliente:</span><span class="sxs-lookup"><span data-stu-id="f3a86-244">An example response for client credential grant token:</span></span>

    HTTP/1.1 200 OK

    {"token_type":"Bearer","expires_in":"3599","expires_on":"1432039862","not_before":"1432035962","resource":"https://graph.windows.net/","access_token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1uQ19WWmNBVGZNNXBPWWlKSE1iYTlnb0VLWSIsImtpZCI6Ik1uQ19WWmNBVGZNNXBPWWlKSE1iYTlnb0VLWSJ9.eyJhdWQiOiJodHRwczovL2dyYXBoLndpbmRv****G5gUTV-kKorR-pg"}

### <a name="get-objectid-of-application-service-principal-in-user-azure-ad"></a><span data-ttu-id="f3a86-245">Obtención del id. de objeto de entidad de servicio de aplicación en la instancia de Azure AD de usuario</span><span class="sxs-lookup"><span data-stu-id="f3a86-245">Get ObjectId of application service principal in user Azure AD</span></span>
<span data-ttu-id="f3a86-246">Ahora, utilice Hola de tooquery token de acceso de solo aplicación Hola [entidades de servicio de Azure AD Graph](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity) Hola de toodetermine API Id. de objeto de entidad de servicio de la aplicación hello en el directorio de Hola.</span><span class="sxs-lookup"><span data-stu-id="f3a86-246">Now, use hello app-only access token tooquery hello [Azure AD Graph Service Principals](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity) API toodetermine hello Object Id of hello application's service principal in hello directory.</span></span>

<span data-ttu-id="f3a86-247">Hola [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs#) método de hello aplicación de ejemplo de ASP.net MVC implementa esta llamada.</span><span class="sxs-lookup"><span data-stu-id="f3a86-247">hello [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs#) method of hello ASP.net MVC sample application implements this call.</span></span>

<span data-ttu-id="f3a86-248">Hola siguiente ejemplo se muestra cómo toorequest entidad de servicio de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f3a86-248">hello following example shows how toorequest an application's service principal.</span></span> <span data-ttu-id="f3a86-249">a0448380-c346-4f9f-b897-c18733de9394 es el identificador de cliente de Hola de aplicación hello.</span><span class="sxs-lookup"><span data-stu-id="f3a86-249">a0448380-c346-4f9f-b897-c18733de9394 is hello client id of hello application.</span></span>

    GET https://graph.windows.net/62e173e9-301e-423e-bcd4-29121ec1aa24/servicePrincipals?api-version=1.5&$filter=appId%20eq%20'a0448380-c346-4f9f-b897-c18733de9394' HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJK*****-kKorR-pg

<span data-ttu-id="f3a86-250">Hello en el ejemplo siguiente se muestra una respuesta toohello solicitud de servicio de la aplicación principal</span><span class="sxs-lookup"><span data-stu-id="f3a86-250">hello following example shows a response toohello request for an application's service principal</span></span>

    HTTP/1.1 200 OK

    {"odata.metadata":"https://graph.windows.net/62e173e9-301e-423e-bcd4-29121ec1aa24/$metadata#directoryObjects/Microsoft.DirectoryServices.ServicePrincipal","value":[{"odata.type":"Microsoft.DirectoryServices.ServicePrincipal","objectType":"ServicePrincipal","objectId":"9b5018d4-6951-42ed-8a92-f11ec283ccec","deletionTimestamp":null,"accountEnabled":true,"appDisplayName":"CloudSense","appId":"a0448380-c346-4f9f-b897-c18733de9394","appOwnerTenantId":"62e173e9-301e-423e-bcd4-29121ec1aa24","appRoleAssignmentRequired":false,"appRoles":[],"displayName":"CloudSense","errorUrl":null,"homepage":"http://www.vipswapper.com/cloudsense","keyCredentials":[],"logoutUrl":null,"oauth2Permissions":[{"adminConsentDescription":"Allow hello application tooaccess CloudSense on behalf of hello signed-in user.","adminConsentDisplayName":"Access CloudSense","id":"b7b7338e-683a-4796-b95e-60c10380de1c","isEnabled":true,"type":"User","userConsentDescription":"Allow hello application tooaccess CloudSense on your behalf.","userConsentDisplayName":"Access CloudSense","value":"user_impersonation"}],"passwordCredentials":[],"preferredTokenSigningKeyThumbprint":null,"publisherName":"vipswapper"quot;,"replyUrls":["http://www.vipswapper.com/cloudsense","http://www.vipswapper.com","http://vipswapper.com","http://vipswapper.azurewebsites.net","http://localhost:62080"],"samlMetadataUrl":null,"servicePrincipalNames":["http://www.vipswapper.com/cloudsense","a0448380-c346-4f9f-b897-c18733de9394"],"tags":["WindowsAzureActiveDirectoryIntegratedApp"]}]}

### <a name="get-azure-rbac-role-identifier"></a><span data-ttu-id="f3a86-251">Obtención del identificador del rol RBAC de Azure</span><span class="sxs-lookup"><span data-stu-id="f3a86-251">Get Azure RBAC role identifier</span></span>
<span data-ttu-id="f3a86-252">tooassign Hola adecuado RBAC tooyour servicio de rol entidad de seguridad, debe determinar identificador hello del rol de hello RBAC de Azure.</span><span class="sxs-lookup"><span data-stu-id="f3a86-252">tooassign hello appropriate RBAC role tooyour service principal, you must determine hello identifier of hello Azure RBAC role.</span></span>

<span data-ttu-id="f3a86-253">rol RBAC correcto de Hello para la aplicación:</span><span class="sxs-lookup"><span data-stu-id="f3a86-253">hello right RBAC role for your application:</span></span>

* <span data-ttu-id="f3a86-254">Si la aplicación solo supervisa la suscripción de hello, sin realizar ningún cambio, requiere solo permisos de lector de suscripción de Hola.</span><span class="sxs-lookup"><span data-stu-id="f3a86-254">If your application only monitors hello subscription, without making any changes, it requires only reader permissions on hello subscription.</span></span> <span data-ttu-id="f3a86-255">Asignar Hola **lector** rol.</span><span class="sxs-lookup"><span data-stu-id="f3a86-255">Assign hello **Reader** role.</span></span>
* <span data-ttu-id="f3a86-256">Si la aplicación administra la suscripción de Azure hello, crear, modificar o eliminar entidades, requiere uno de los permisos de colaborador de Hola.</span><span class="sxs-lookup"><span data-stu-id="f3a86-256">If your application manages Azure hello subscription, creating/modifying/deleting entities, it requires one of hello contributor permissions.</span></span>
  * <span data-ttu-id="f3a86-257">toomanage un determinado tipo de recurso, asignar roles de colaborador específico del recurso de hello (colaborador de la máquina Virtual, colaborador de red Virtual, colaborador de la cuenta de almacenamiento, etcetera.)</span><span class="sxs-lookup"><span data-stu-id="f3a86-257">toomanage a particular type of resource, assign hello resource-specific contributor roles (Virtual Machine Contributor, Virtual Network Contributor, Storage Account Contributor, etc.)</span></span>
  * <span data-ttu-id="f3a86-258">toomanage cualquier tipo de recurso, asignar Hola **colaborador** rol.</span><span class="sxs-lookup"><span data-stu-id="f3a86-258">toomanage any resource type, assign hello **Contributor** role.</span></span>

<span data-ttu-id="f3a86-259">asignación de roles de Hello para la aplicación es toousers visible, por lo que seleccione Hola requiere menos privilegios.</span><span class="sxs-lookup"><span data-stu-id="f3a86-259">hello role assignment for your application is visible toousers, so select hello least-required privilege.</span></span>

<span data-ttu-id="f3a86-260">Llamar a hello [definición de roles de administrador de recursos API](https://docs.microsoft.com/rest/api/authorization/roledefinitions) toolist todas las funciones de RBAC de Azure y búsqueda, a continuación, recorrer en iteración Hola Hola de toofind resultado deseado de definición de función por su nombre.</span><span class="sxs-lookup"><span data-stu-id="f3a86-260">Call hello [Resource Manager role definition API](https://docs.microsoft.com/rest/api/authorization/roledefinitions) toolist all Azure RBAC roles and search then iterate over hello result toofind hello desired role definition by name.</span></span>

<span data-ttu-id="f3a86-261">Hola [GetRoleId](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L246) método de hello aplicación de ejemplo de ASP.net MVC implementa esta llamada.</span><span class="sxs-lookup"><span data-stu-id="f3a86-261">hello [GetRoleId](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L246) method of hello ASP.net MVC sample app implements this call.</span></span>

<span data-ttu-id="f3a86-262">solicitud de siguiente de Hello en el ejemplo se muestra cómo tooget identificador de rol de RBAC de Azure.</span><span class="sxs-lookup"><span data-stu-id="f3a86-262">hello following request example shows how tooget Azure RBAC role identifier.</span></span> <span data-ttu-id="f3a86-263">09cbd307-aa71-4aca-b346-5f253e6e3ebb es el Id. de Hola de suscripción de Hola.</span><span class="sxs-lookup"><span data-stu-id="f3a86-263">09cbd307-aa71-4aca-b346-5f253e6e3ebb is hello id of hello subscription.</span></span>

    GET https://management.azure.com/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions?api-version=2015-07-01 HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJKV*****fY2lGc5

<span data-ttu-id="f3a86-264">respuesta de Hello es Hola siguiendo el formato:</span><span class="sxs-lookup"><span data-stu-id="f3a86-264">hello response is in hello following format:</span></span>

    HTTP/1.1 200 OK

    {"value":[{"properties":{"roleName":"API Management Service Contributor","type":"BuiltInRole","description":"Lets you manage API Management services, but not access toothem.","scope":"/","permissions":[{"actions":["Microsoft.ApiManagement/Services/*","Microsoft.Authorization/*/read","Microsoft.Resources/subscriptions/resources/read","Microsoft.Resources/subscriptions/resourceGroups/read","Microsoft.Resources/subscriptions/resourceGroups/resources/read","Microsoft.Resources/subscriptions/resourceGroups/deployments/*","Microsoft.Insights/alertRules/*","Microsoft.Support/*"],"notActions":[]}]},"id":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/312a565d-c81f-4fd8-895a-4e21e48d571c","type":"Microsoft.Authorization/roleDefinitions","name":"312a565d-c81f-4fd8-895a-4e21e48d571c"},{"properties":{"roleName":"Application Insights Component Contributor","type":"BuiltInRole","description":"Lets you manage Application Insights components, but not access toothem.","scope":"/","permissions":[{"actions":["Microsoft.Insights/components/*","Microsoft.Insights/webtests/*","Microsoft.Authorization/*/read","Microsoft.Resources/subscriptions/resources/read","Microsoft.Resources/subscriptions/resourceGroups/read","Microsoft.Resources/subscriptions/resourceGroups/resources/read","Microsoft.Resources/subscriptions/resourceGroups/deployments/*","Microsoft.Insights/alertRules/*","Microsoft.Support/*"],"notActions":[]}]},"id":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/ae349356-3a1b-4a5e-921d-050484c6347e","type":"Microsoft.Authorization/roleDefinitions","name":"ae349356-3a1b-4a5e-921d-050484c6347e"}]}

<span data-ttu-id="f3a86-265">No es necesario toocall esta API de forma continuada.</span><span class="sxs-lookup"><span data-stu-id="f3a86-265">You do not need toocall this API on an ongoing basis.</span></span> <span data-ttu-id="f3a86-266">Una vez que haya determinado Hola GUID conocido de definición de roles de hello, puede construir Id. de definición de rol de hello como:</span><span class="sxs-lookup"><span data-stu-id="f3a86-266">Once you've determined hello well-known GUID of hello role definition, you can construct hello role definition id as:</span></span>

    /subscriptions/{subscription_id}/providers/Microsoft.Authorization/roleDefinitions/{well-known-role-guid}

<span data-ttu-id="f3a86-267">Estos son Hola GUID conocido de uso frecuente funciones integradas:</span><span class="sxs-lookup"><span data-stu-id="f3a86-267">Here are hello well-known guids of commonly used built-in roles:</span></span>

| <span data-ttu-id="f3a86-268">Rol</span><span class="sxs-lookup"><span data-stu-id="f3a86-268">Role</span></span> | <span data-ttu-id="f3a86-269">Guid</span><span class="sxs-lookup"><span data-stu-id="f3a86-269">Guid</span></span> |
| --- | --- |
| <span data-ttu-id="f3a86-270">Lector</span><span class="sxs-lookup"><span data-stu-id="f3a86-270">Reader</span></span> |<span data-ttu-id="f3a86-271">acdd72a7-3385-48ef-bd42-f606fba81ae7</span><span class="sxs-lookup"><span data-stu-id="f3a86-271">acdd72a7-3385-48ef-bd42-f606fba81ae7</span></span> |
| <span data-ttu-id="f3a86-272">Colaborador</span><span class="sxs-lookup"><span data-stu-id="f3a86-272">Contributor</span></span> |<span data-ttu-id="f3a86-273">b24988ac-6180-42a0-ab88-20f7382dd24c</span><span class="sxs-lookup"><span data-stu-id="f3a86-273">b24988ac-6180-42a0-ab88-20f7382dd24c</span></span> |
| <span data-ttu-id="f3a86-274">Colaborador de la máquina virtual</span><span class="sxs-lookup"><span data-stu-id="f3a86-274">Virtual Machine Contributor</span></span> |<span data-ttu-id="f3a86-275">d73bb868-a0df-4d4d-bd69-98a00b01fccb</span><span class="sxs-lookup"><span data-stu-id="f3a86-275">d73bb868-a0df-4d4d-bd69-98a00b01fccb</span></span> |
| <span data-ttu-id="f3a86-276">Colaborador de la red virtual</span><span class="sxs-lookup"><span data-stu-id="f3a86-276">Virtual Network Contributor</span></span> |<span data-ttu-id="f3a86-277">b34d265f-36f7-4a0d-a4d4-e158ca92e90f</span><span class="sxs-lookup"><span data-stu-id="f3a86-277">b34d265f-36f7-4a0d-a4d4-e158ca92e90f</span></span> |
| <span data-ttu-id="f3a86-278">Colaborador de la cuenta de almacenamiento</span><span class="sxs-lookup"><span data-stu-id="f3a86-278">Storage Account Contributor</span></span> |<span data-ttu-id="f3a86-279">86e8f5dc-a6e9-4c67-9d15-de283e8eac25</span><span class="sxs-lookup"><span data-stu-id="f3a86-279">86e8f5dc-a6e9-4c67-9d15-de283e8eac25</span></span> |
| <span data-ttu-id="f3a86-280">Colaborador de sitio web</span><span class="sxs-lookup"><span data-stu-id="f3a86-280">Website Contributor</span></span> |<span data-ttu-id="f3a86-281">de139f84-1756-47ae-9be6-808fbbe84772</span><span class="sxs-lookup"><span data-stu-id="f3a86-281">de139f84-1756-47ae-9be6-808fbbe84772</span></span> |
| <span data-ttu-id="f3a86-282">Colaborador de plan web</span><span class="sxs-lookup"><span data-stu-id="f3a86-282">Web Plan Contributor</span></span> |<span data-ttu-id="f3a86-283">2cc479cb-7b4d-49a8-b449-8c00fd0f0a4b</span><span class="sxs-lookup"><span data-stu-id="f3a86-283">2cc479cb-7b4d-49a8-b449-8c00fd0f0a4b</span></span> |
| <span data-ttu-id="f3a86-284">Colaborador de SQL Server</span><span class="sxs-lookup"><span data-stu-id="f3a86-284">SQL Server Contributor</span></span> |<span data-ttu-id="f3a86-285">6d8ee4ec-f05a-4a1d-8b00-a9b17e38b437</span><span class="sxs-lookup"><span data-stu-id="f3a86-285">6d8ee4ec-f05a-4a1d-8b00-a9b17e38b437</span></span> |
| <span data-ttu-id="f3a86-286">Colaborador de SQL DB</span><span class="sxs-lookup"><span data-stu-id="f3a86-286">SQL DB Contributor</span></span> |<span data-ttu-id="f3a86-287">9b7fa17d-e63e-47b0-bb0a-15c516ac86ec</span><span class="sxs-lookup"><span data-stu-id="f3a86-287">9b7fa17d-e63e-47b0-bb0a-15c516ac86ec</span></span> |

### <a name="assign-rbac-role-tooapplication"></a><span data-ttu-id="f3a86-288">Asignar RBAC rol tooapplication</span><span class="sxs-lookup"><span data-stu-id="f3a86-288">Assign RBAC role tooapplication</span></span>
<span data-ttu-id="f3a86-289">Todo lo que necesita tooassign Hola adecuado RBAC rol tooyour entidad de servicio mediante el uso de hello tiene [Administrador de recursos de crear la asignación de roles](https://docs.microsoft.com/rest/api/authorization/roleassignments) API.</span><span class="sxs-lookup"><span data-stu-id="f3a86-289">You have everything you need tooassign hello appropriate RBAC role tooyour service principal by using hello [Resource Manager create role assignment](https://docs.microsoft.com/rest/api/authorization/roleassignments) API.</span></span>

<span data-ttu-id="f3a86-290">Hola [GrantRoleToServicePrincipalOnSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L170) método de hello aplicación de ejemplo de ASP.net MVC implementa esta llamada.</span><span class="sxs-lookup"><span data-stu-id="f3a86-290">hello [GrantRoleToServicePrincipalOnSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L170) method of hello ASP.net MVC sample app implements this call.</span></span>

<span data-ttu-id="f3a86-291">Un ejemplo solicitud tooassign RBAC rol tooapplication:</span><span class="sxs-lookup"><span data-stu-id="f3a86-291">An example request tooassign RBAC role tooapplication:</span></span>

    PUT https://management.azure.com/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/microsoft.authorization/roleassignments/4f87261d-2816-465d-8311-70a27558df4c?api-version=2015-07-01 HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJKV1QiL*****FlwO1mM7Cw6JWtfY2lGc5
    Content-Type: application/json
    Content-Length: 230

    {"properties": {"roleDefinitionId":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7","principalId":"c3097b31-7309-4c59-b4e3-770f8406bad2"}}

<span data-ttu-id="f3a86-292">En la solicitud de hello, se utiliza Hola siguientes valores:</span><span class="sxs-lookup"><span data-stu-id="f3a86-292">In hello request, hello following values are used:</span></span>

| <span data-ttu-id="f3a86-293">Guid</span><span class="sxs-lookup"><span data-stu-id="f3a86-293">Guid</span></span> | <span data-ttu-id="f3a86-294">Description</span><span class="sxs-lookup"><span data-stu-id="f3a86-294">Description</span></span> |
| --- | --- |
| <span data-ttu-id="f3a86-295">09cbd307-aa71-4aca-b346-5f253e6e3ebb</span><span class="sxs-lookup"><span data-stu-id="f3a86-295">09cbd307-aa71-4aca-b346-5f253e6e3ebb</span></span> |<span data-ttu-id="f3a86-296">Id. de Hola de suscripción de Hola</span><span class="sxs-lookup"><span data-stu-id="f3a86-296">hello id of hello subscription</span></span> |
| <span data-ttu-id="f3a86-297">c3097b31-7309-4c59-b4e3-770f8406bad2</span><span class="sxs-lookup"><span data-stu-id="f3a86-297">c3097b31-7309-4c59-b4e3-770f8406bad2</span></span> |<span data-ttu-id="f3a86-298">Id. de objeto de Hola de entidad de servicio de Hola de aplicación hello</span><span class="sxs-lookup"><span data-stu-id="f3a86-298">hello object id of hello service principal of hello application</span></span> |
| <span data-ttu-id="f3a86-299">acdd72a7-3385-48ef-bd42-f606fba81ae7</span><span class="sxs-lookup"><span data-stu-id="f3a86-299">acdd72a7-3385-48ef-bd42-f606fba81ae7</span></span> |<span data-ttu-id="f3a86-300">Id. de Hello del rol de lector de Hola</span><span class="sxs-lookup"><span data-stu-id="f3a86-300">hello id of hello reader role</span></span> |
| <span data-ttu-id="f3a86-301">4f87261d-2816-465d-8311-70a27558df4c</span><span class="sxs-lookup"><span data-stu-id="f3a86-301">4f87261d-2816-465d-8311-70a27558df4c</span></span> |<span data-ttu-id="f3a86-302">un nuevo guid creado para la nueva asignación de roles Hola</span><span class="sxs-lookup"><span data-stu-id="f3a86-302">a new guid created for hello new role assignment</span></span> |

<span data-ttu-id="f3a86-303">respuesta de Hello es Hola siguiendo el formato:</span><span class="sxs-lookup"><span data-stu-id="f3a86-303">hello response is in hello following format:</span></span>

    HTTP/1.1 201 Created

    {"properties":{"roleDefinitionId":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7","principalId":"c3097b31-7309-4c59-b4e3-770f8406bad2","scope":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb"},"id":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleAssignments/4f87261d-2816-465d-8311-70a27558df4c","type":"Microsoft.Authorization/roleAssignments","name":"4f87261d-2816-465d-8311-70a27558df4c"}

### <a name="get-app-only-access-token-for-azure-resource-manager"></a><span data-ttu-id="f3a86-304">Obtención de token de acceso de solo aplicación para Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="f3a86-304">Get app-only access token for Azure Resource Manager</span></span>
<span data-ttu-id="f3a86-305">toovalidate que la aplicación tiene acceso de hello deseado en la suscripción de hello, lleve a cabo una tarea de prueba en suscripción de hello mediante un símbolo (token) solo de aplicación.</span><span class="sxs-lookup"><span data-stu-id="f3a86-305">toovalidate that app has hello desired access on hello subscription, perform a test task on hello subscription using an app-only token.</span></span>

<span data-ttu-id="f3a86-306">tooget un token de acceso de solo de aplicación, siga las instrucciones de la sección [obtener acceso de solo aplicación token para Azure AD Graph API](#app-azure-ad-graph), con un valor diferente para el parámetro de recurso de hello:</span><span class="sxs-lookup"><span data-stu-id="f3a86-306">tooget an app-only access token, follow instructions from section [Get app-only access token for Azure AD Graph API](#app-azure-ad-graph), with a different value for hello resource parameter:</span></span>

    https://management.core.windows.net/

<span data-ttu-id="f3a86-307">Hola [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) método de aplicación de ejemplo de ASP.NET MVC obtiene acceso solo de aplicación símbolo (token) para usar el Administrador de recursos de Azure de hello Hola biblioteca de autenticación de Active Directory para. NET.</span><span class="sxs-lookup"><span data-stu-id="f3a86-307">hello [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) method of hello ASP.NET MVC sample application gets an app-only access token for Azure Resource Manager using hello Active Directory Authentication Library for .net.</span></span>

#### <a name="get-applications-permissions-on-subscription"></a><span data-ttu-id="f3a86-308">Obtención de permisos de la aplicación en la suscripción</span><span class="sxs-lookup"><span data-stu-id="f3a86-308">Get Application's Permissions on Subscription</span></span>
<span data-ttu-id="f3a86-309">toocheck que la aplicación ha Hola deseado de acceso en una suscripción de Azure, también puede llamar a hello [permisos de administrador de recursos](https://docs.microsoft.com/rest/api/authorization/permissions) API.</span><span class="sxs-lookup"><span data-stu-id="f3a86-309">toocheck that your application has hello desired access on an Azure subscription, you may also call hello [Resource Manager Permissions](https://docs.microsoft.com/rest/api/authorization/permissions) API.</span></span> <span data-ttu-id="f3a86-310">Este enfoque es similar toohow determina si el usuario de hello tiene derechos de administración de acceso para la suscripción de Hola.</span><span class="sxs-lookup"><span data-stu-id="f3a86-310">This approach is similar toohow you determined whether hello user has Access Management rights for hello subscription.</span></span> <span data-ttu-id="f3a86-311">Sin embargo, en este momento, llamar a API de permisos de hello con token de acceso de solo de aplicación de Hola que recibió en el paso anterior de Hola.</span><span class="sxs-lookup"><span data-stu-id="f3a86-311">However, this time, call hello permissions API with hello app-only access token that you received in hello previous step.</span></span>

<span data-ttu-id="f3a86-312">Hola [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) método de hello aplicación de ejemplo de ASP.NET MVC implementa esta llamada.</span><span class="sxs-lookup"><span data-stu-id="f3a86-312">hello [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) method of hello ASP.NET MVC sample app implements this call.</span></span>

## <a name="manage-connected-subscriptions"></a><span data-ttu-id="f3a86-313">Administración de suscripciones conectadas</span><span class="sxs-lookup"><span data-stu-id="f3a86-313">Manage connected subscriptions</span></span>
<span data-ttu-id="f3a86-314">Cuando rol RBAC adecuado de Hola se asigna entidad de servicio de la aplicación tooyour de suscripción de hello, la aplicación puede mantener supervisión/administrando con tokens de acceso de solo de aplicación para el Administrador de recursos de Azure.</span><span class="sxs-lookup"><span data-stu-id="f3a86-314">When hello appropriate RBAC role is assigned tooyour application's service principal on hello subscription, your application can keep monitoring/managing it using app-only access tokens for Azure Resource Manager.</span></span>

<span data-ttu-id="f3a86-315">Si el propietario de la suscripción Quita la asignación de roles de la aplicación mediante el portal clásico de Hola o herramientas de línea de comandos, la aplicación es tooaccess ya no es capaz de esa suscripción.</span><span class="sxs-lookup"><span data-stu-id="f3a86-315">If a subscription owner removes your application's role assignment using hello classic portal or command-line tools, your application is no longer able tooaccess that subscription.</span></span> <span data-ttu-id="f3a86-316">En ese caso, debe notificar al usuario de Hola que se ha roto la conexión de hello con suscripción de Hola desde la aplicación hello exterior y asígneles una opción demasiado "reparar" conexión de Hola.</span><span class="sxs-lookup"><span data-stu-id="f3a86-316">In that case, you should notify hello user that hello connection with hello subscription was severed from outside hello application and give them an option too"repair" hello connection.</span></span> <span data-ttu-id="f3a86-317">"Reparar" simplemente crearía volver a asignación de roles de Hola que se eliminó sin conexión.</span><span class="sxs-lookup"><span data-stu-id="f3a86-317">"Repair" would simply re-create hello role assignment that was deleted offline.</span></span>

<span data-ttu-id="f3a86-318">Tal y como había habilitado aplicación tooyour de hello usuario tooconnect suscripciones, se deben permitir suscripciones de hello usuario toodisconnect.</span><span class="sxs-lookup"><span data-stu-id="f3a86-318">Just as you enabled hello user tooconnect subscriptions tooyour application, you must allow hello user toodisconnect subscriptions too.</span></span> <span data-ttu-id="f3a86-319">Desde un punto de vista de la administración de acceso, desconecte significa quitar asignación de roles de Hola que disponga de entidad de servicio de la aplicación hello en suscripción Hola.</span><span class="sxs-lookup"><span data-stu-id="f3a86-319">From an access management point of view, disconnect means removing hello role assignment that hello application's service principal has on hello subscription.</span></span> <span data-ttu-id="f3a86-320">Opcionalmente, cualquier estado de aplicación hello para la suscripción de hello podría quitarse demasiado.</span><span class="sxs-lookup"><span data-stu-id="f3a86-320">Optionally, any state in hello application for hello subscription might be removed too.</span></span>
<span data-ttu-id="f3a86-321">Solo los usuarios con permiso de administración de acceso de suscripción de hello son toodisconnect capaz de suscripción de Hola.</span><span class="sxs-lookup"><span data-stu-id="f3a86-321">Only users with access management permission on hello subscription are able toodisconnect hello subscription.</span></span>

<span data-ttu-id="f3a86-322">Hola [RevokeRoleFromServicePrincipalOnSubscription método](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L200) de hello MVC de ASP.net, aplicación de ejemplo implementa esta llamada.</span><span class="sxs-lookup"><span data-stu-id="f3a86-322">hello [RevokeRoleFromServicePrincipalOnSubscription method](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L200) of hello ASP.net MVC sample app implements this call.</span></span>

<span data-ttu-id="f3a86-323">Eso es todo: los usuarios ya pueden conectarse y administrar fácilmente sus suscripciones de Azure con su aplicación.</span><span class="sxs-lookup"><span data-stu-id="f3a86-323">That's it - users can now easily connect and manage their Azure subscriptions with your application.</span></span>

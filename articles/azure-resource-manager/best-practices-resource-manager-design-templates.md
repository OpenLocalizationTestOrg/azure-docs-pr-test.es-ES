---
title: "Diseño de plantillas de Azure para soluciones complejas | Microsoft Docs"
description: "Muestra los procedimientos recomendados para diseñar plantillas de Azure Resource Manager para escenarios complejos"
services: azure-resource-manager
documentationcenter: 
author: tfitzmac
manager: timlt
editor: tysonn
ms.assetid: ce1141d6-ece7-4976-acea-1db1f775409e
ms.service: azure-resource-manager
ms.workload: multiple
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/19/2016
ms.author: tomfitz
ms.openlocfilehash: dcc31f7a8c85a8f7fbd554371a66fb1e348bca17
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/03/2017
---
# <a name="design-patterns-for-azure-resource-manager-templates-when-deploying-complex-solutions"></a><span data-ttu-id="35536-103">Diseño de patrones para plantillas de Azure Resource Manager cuando implementa soluciones complejas</span><span class="sxs-lookup"><span data-stu-id="35536-103">Design patterns for Azure Resource Manager templates when deploying complex solutions</span></span>
<span data-ttu-id="35536-104">Con un enfoque flexible basado en plantillas de Azure Resource Manager, puede implementar topologías complejas de forma rápida y coherente.</span><span class="sxs-lookup"><span data-stu-id="35536-104">Using a flexible approach based on Azure Resource Manager templates, you can deploy complex topologies quickly and consistently.</span></span> <span data-ttu-id="35536-105">Puede adaptar estas implementaciones fácilmente a medida que evolucionan las ofertas centrales o para dar cabida a variantes para escenarios o clientes atípicos.</span><span class="sxs-lookup"><span data-stu-id="35536-105">You can adapt these deployments easily as core offerings evolve or to accommodate variants for outlier scenarios or customers.</span></span>

<span data-ttu-id="35536-106">Este tema forma parte de un artículo más extenso.</span><span class="sxs-lookup"><span data-stu-id="35536-106">This topic is part of a larger whitepaper.</span></span> <span data-ttu-id="35536-107">Para leer el documento completo, descargue [World Class Azure Resource Manager Templates Considerations and Proven Practices](http://download.microsoft.com/download/8/E/1/8E1DBEFA-CECE-4DC9-A813-93520A5D7CFE/World Class ARM Templates - Considerations and Proven Practices.pdf) (Consideraciones sobre las plantillas de Resource Manager de talla mundial y prácticas comprobadas).</span><span class="sxs-lookup"><span data-stu-id="35536-107">To read the full paper, download [World Class Azure Resource Manager Templates Considerations and Proven Practices](http://download.microsoft.com/download/8/E/1/8E1DBEFA-CECE-4DC9-A813-93520A5D7CFE/World Class ARM Templates - Considerations and Proven Practices.pdf).</span></span>

<span data-ttu-id="35536-108">Las plantillas combinan las ventajas del Administrador de recursos de Azure subyacente con la capacidad de adaptación y legibilidad de la Notación de objetos JavaScript (JSON).</span><span class="sxs-lookup"><span data-stu-id="35536-108">Templates combine the benefits of the underlying Azure Resource Manager with the adaptability and readability of JavaScript Object Notation (JSON).</span></span> <span data-ttu-id="35536-109">El uso de plantillas le permite:</span><span class="sxs-lookup"><span data-stu-id="35536-109">Using templates, you can:</span></span>

* <span data-ttu-id="35536-110">Implementar topologías y sus cargas de trabajo de forma coherente.</span><span class="sxs-lookup"><span data-stu-id="35536-110">Deploy topologies and their workloads consistently.</span></span>
* <span data-ttu-id="35536-111">Administrar juntos todos los recursos de una aplicación mediante grupos de recursos.</span><span class="sxs-lookup"><span data-stu-id="35536-111">Manage all your resources in an application together using resource groups.</span></span>
* <span data-ttu-id="35536-112">Aplicar control de acceso basado en rol (RBAC) para conceder el acceso adecuado a usuarios, grupos y servicios.</span><span class="sxs-lookup"><span data-stu-id="35536-112">Apply role-based access control (RBAC) to grant appropriate access to users, groups, and services.</span></span>
* <span data-ttu-id="35536-113">Usar asociaciones de etiquetas para simplificar tareas como resúmenes de facturación.</span><span class="sxs-lookup"><span data-stu-id="35536-113">Use tagging associations to streamline tasks such as billing rollups.</span></span>

<span data-ttu-id="35536-114">Este artículo proporciona información detallada sobre escenarios de consumo, arquitectura y patrones de implementación identificados durante nuestras sesiones de diseño e implementaciones de plantillas reales con los clientes del equipo de asesoría de clientes de Azure (AzureCAT).</span><span class="sxs-lookup"><span data-stu-id="35536-114">This article provides details on consumption scenarios, architecture, and implementation patterns identified during our design sessions and real-world template implementations with Azure Customer Advisory Team (AzureCAT) customers.</span></span> <span data-ttu-id="35536-115">Lejos de ser académicos, estos enfoques son prácticas probadas obtenidas mediante el desarrollo de plantillas para 12 de las principales tecnologías de software de código abierto basadas en Linux, como por ejemplo: Apache Kafka, Apache Spark, Cloudera, Couchbase, Hortonworks HDP, DataStax Enterprise powered by Apache Cassandra, Elasticsearch, Jenkins, MongoDB, PostgreSQL, Redis y Nagios.</span><span class="sxs-lookup"><span data-stu-id="35536-115">Far from academic, these approaches are proven practices informed by the development of templates for 12 of the top Linux-based OSS technologies, including: Apache Kafka, Apache Spark, Cloudera, Couchbase, Hortonworks HDP, DataStax Enterprise powered by Apache Cassandra, Elasticsearch, Jenkins, MongoDB, PostgreSQL, Redis, and Nagios.</span></span> 

<span data-ttu-id="35536-116">Este artículo comparte estas prácticas de demostrada eficacia con el fin de ayudarle a diseñar plantillas del Administrador de recursos de Azure de talla mundial.</span><span class="sxs-lookup"><span data-stu-id="35536-116">This article shares these proven practices to help you architect world class Azure Resource Manager templates.</span></span>  

<span data-ttu-id="35536-117">En nuestro trabajo con los clientes, hemos identificado varias experiencias de consumo de plantillas de Resource Manager en empresas, integradores de sistemas y proveedores de soluciones en la nube.</span><span class="sxs-lookup"><span data-stu-id="35536-117">In our work with customers, we have identified several Resource Manager template consumption experiences across enterprises, System Integrators (SI)s, and CSVs.</span></span> <span data-ttu-id="35536-118">Las siguientes secciones proporcionan información general de alto nivel de escenarios y patrones comunes para distintos tipos de clientes.</span><span class="sxs-lookup"><span data-stu-id="35536-118">The following sections provide a high-level overview of common scenarios and patterns for different customer types.</span></span>

## <a name="enterprises-and-system-integrators"></a><span data-ttu-id="35536-119">Empresas e integradores de sistemas</span><span class="sxs-lookup"><span data-stu-id="35536-119">Enterprises and system integrators</span></span>
<span data-ttu-id="35536-120">En las grandes organizaciones, observamos normalmente dos consumidores de plantillas de Resource Manager: los equipos de desarrollo de software internos y los grupos de TI corporativos.</span><span class="sxs-lookup"><span data-stu-id="35536-120">Within large organizations, we commonly see two consumers of Resource Manager templates: internal software development teams and corporate IT.</span></span> <span data-ttu-id="35536-121">Hemos visto que los escenarios para los integradores de sistemas se corresponden con los escenarios para empresas, por lo que se aplican las mismas consideraciones.</span><span class="sxs-lookup"><span data-stu-id="35536-121">We've found that the scenarios for the SIs map to the scenarios for Enterprises, so the same considerations apply.</span></span>

### <a name="internal-software-development-teams"></a><span data-ttu-id="35536-122">Equipos de desarrollo de software internos</span><span class="sxs-lookup"><span data-stu-id="35536-122">Internal software development teams</span></span>
<span data-ttu-id="35536-123">Si su equipo desarrolla software para respaldar su negocio, las plantillas proporcionan una manera fácil de implementar rápidamente tecnologías para su uso en soluciones específicas de la empresa.</span><span class="sxs-lookup"><span data-stu-id="35536-123">If your team develops software to support your business, templates provide an easy way to quickly deploy technologies for use in business-specific solutions.</span></span> <span data-ttu-id="35536-124">También puede usar plantillas para crear rápidamente entornos de aprendizaje que permitan a los miembros del equipo obtener los conocimientos necesarios.</span><span class="sxs-lookup"><span data-stu-id="35536-124">You can also use templates to rapidly create training environments that enable team members to gain necessary skills.</span></span>

<span data-ttu-id="35536-125">Puede usar las plantillas tal y como están o ampliarlas o componerlas para adaptarlas a sus necesidades.</span><span class="sxs-lookup"><span data-stu-id="35536-125">You can use templates as-is or extend or compose them to accommodate your needs.</span></span> <span data-ttu-id="35536-126">El uso de etiquetado dentro de las plantillas permite proporcionar un resumen de facturación con diversas vistas como equipo, proyecto, individuo y educación.</span><span class="sxs-lookup"><span data-stu-id="35536-126">Using tagging within templates, you can provide a billing summary with various views such as team, project, individual, and education.</span></span>

<span data-ttu-id="35536-127">Las empresas a menudo quieren que los equipos de desarrollo de software creen una plantilla para la implementación coherente de una solución.</span><span class="sxs-lookup"><span data-stu-id="35536-127">Businesses often want software development teams to create a template for consistent deployment of a solution.</span></span> <span data-ttu-id="35536-128">La plantilla facilita las restricciones para que determinados elementos dentro de ese entorno permanezcan fijos y no se puedan invalidar.</span><span class="sxs-lookup"><span data-stu-id="35536-128">The template facilitates constraints so certain items within that environment remain fixed and can't be overridden.</span></span> <span data-ttu-id="35536-129">Por ejemplo, un banco puede requerir que una plantilla incluya RBAC, de modo que un programador no pueda revisar una solución bancaria para enviar datos a una cuenta de almacenamiento personal.</span><span class="sxs-lookup"><span data-stu-id="35536-129">For example, a bank might require a template to include RBAC so a programmer can’t revise a banking solution to send data to a personal storage account.</span></span>

### <a name="corporate-it"></a><span data-ttu-id="35536-130">Grupos de TI corporativos</span><span class="sxs-lookup"><span data-stu-id="35536-130">Corporate IT</span></span>
<span data-ttu-id="35536-131">Las organizaciones de TI corporativa suelen usar plantillas para ofrecer capacidad en la nube y funcionalidades hospedadas en la nube.</span><span class="sxs-lookup"><span data-stu-id="35536-131">Corporate IT organizations typically use templates for delivering cloud capacity and cloud-hosted capabilities.</span></span>

#### <a name="cloud-capacity"></a><span data-ttu-id="35536-132">Capacidad en la nube</span><span class="sxs-lookup"><span data-stu-id="35536-132">Cloud capacity</span></span>
<span data-ttu-id="35536-133">Un método común que emplean los grupos de TI corporativos para proporcionar capacidad en la nube a los equipos es con "tamaños de camiseta", que son tamaños de oferta estándar, por ejemplo, pequeña, mediana y grande.</span><span class="sxs-lookup"><span data-stu-id="35536-133">A common way for corporate IT groups to provide cloud capacity for teams is with "t-shirt sizes", which are standard offering sizes such as small, medium, and large.</span></span> <span data-ttu-id="35536-134">Las ofertas basadas en el tamaño de camiseta pueden combinar diferentes tipos de recursos y cantidades y proporcionar al mismo tiempo un nivel de estandarización que hace posible el uso de plantillas.</span><span class="sxs-lookup"><span data-stu-id="35536-134">The t-shirt sized offerings can mix different resource types and quantities while providing a level of standardization that makes it possible to use templates.</span></span> <span data-ttu-id="35536-135">Las plantillas entregan capacidad de una manera coherente gracias a la aplicación de directivas corporativas y al uso de etiquetas para proporcionar contracargo o asignación de costos a las organizaciones que las consumen.</span><span class="sxs-lookup"><span data-stu-id="35536-135">The templates deliver capacity in a consistent way that enforces corporate policies and uses tagging to provide chargeback to consuming organizations.</span></span>

<span data-ttu-id="35536-136">Por ejemplo, puede que necesite proporcionar entornos de desarrollo, prueba o producción en los que los equipos de desarrollo de software puedan implementar sus soluciones.</span><span class="sxs-lookup"><span data-stu-id="35536-136">For example, you may need to provide development, test, or production environments within which the software development teams can deploy their solutions.</span></span> <span data-ttu-id="35536-137">El entorno tiene una topología de red predefinida y elementos que los equipos de desarrollo de software no pueden cambiar, como las reglas que controlan el acceso a la inspección de paquetes e Internet pública.</span><span class="sxs-lookup"><span data-stu-id="35536-137">The environment has a predefined network topology and elements that the software development teams cannot change, such as rules governing access to the public internet and packet inspection.</span></span> <span data-ttu-id="35536-138">Puede que también haya roles específicos de la organización en estos entornos con derechos de acceso distintos en cada uno.</span><span class="sxs-lookup"><span data-stu-id="35536-138">You may also have organization-specific roles for these environments with distinct access rights for the environment.</span></span>

#### <a name="cloud-hosted-capabilities"></a><span data-ttu-id="35536-139">Funcionalidades hospedadas en la nube</span><span class="sxs-lookup"><span data-stu-id="35536-139">Cloud-hosted capabilities</span></span>
<span data-ttu-id="35536-140">Puede usar plantillas para respaldar las funcionalidades hospedadas en la nube, como paquetes de software individuales u ofertas compuestas que se ofrecen a las líneas de negocio internas.</span><span class="sxs-lookup"><span data-stu-id="35536-140">You can use templates to support cloud-hosted capabilities, including individual software packages or composite offerings that are offered to internal lines of business.</span></span> <span data-ttu-id="35536-141">Un ejemplo de una oferta compuesta sería el análisis como servicio: análisis, visualización y otras tecnologías, proporcionado en una configuración optimizada y conectada en una topología de red predefinida.</span><span class="sxs-lookup"><span data-stu-id="35536-141">An example of a composite offering would be analytics-as-a-service—analytics, visualization, and other technologies—delivered in an optimized, connected configuration on a predefined network topology.</span></span>

<span data-ttu-id="35536-142">Las funcionalidades hospedadas en la nube se ven afectadas por las consideraciones sobre seguridad y roles establecidas por la oferta de capacidad en la nube en la que se basan.</span><span class="sxs-lookup"><span data-stu-id="35536-142">Cloud-hosted capabilities are affected by the security and role considerations established by the cloud capacity offering on which they’re built.</span></span> <span data-ttu-id="35536-143">Estas funcionalidades se ofrecen tal y como están o como un servicio administrado.</span><span class="sxs-lookup"><span data-stu-id="35536-143">These capabilities are offered as is or as a managed service.</span></span> <span data-ttu-id="35536-144">En este último caso, se requieren roles con acceso limitado para permitir el acceso en el entorno con fines de administración.</span><span class="sxs-lookup"><span data-stu-id="35536-144">For the latter, access-constrained roles are required to enable access into the environment for management purposes.</span></span>

## <a name="cloud-service-vendors"></a><span data-ttu-id="35536-145">Proveedores de servicios en la nube</span><span class="sxs-lookup"><span data-stu-id="35536-145">Cloud service vendors</span></span>
<span data-ttu-id="35536-146">Después de hablar con muchos CSV, hemos identificado varios enfoques que puede adoptar para implementar servicios para los clientes, junto con los requisitos asociados.</span><span class="sxs-lookup"><span data-stu-id="35536-146">After talking to many CSVs, we identified multiple approaches you can take to deploy services for your customers and associated requirements.</span></span>

### <a name="csv-hosted-offering"></a><span data-ttu-id="35536-147">Oferta hospeda por el CSV</span><span class="sxs-lookup"><span data-stu-id="35536-147">CSV-hosted offering</span></span>
<span data-ttu-id="35536-148">Si hospeda su oferta en su propia suscripción de Azure, dos son los enfoques de hospedaje más comunes: realizar una implementación distinta para cada cliente o implementar unidades de escalado que respalden una infraestructura compartida usada para todos los clientes.</span><span class="sxs-lookup"><span data-stu-id="35536-148">If you host your offering in your own Azure subscription, two hosting approaches are common: deploying a distinct deployment for every customer or deploying scale units that underpin a shared infrastructure used for all customers.</span></span>

* <span data-ttu-id="35536-149">**Implementaciones distintas para cada cliente.**</span><span class="sxs-lookup"><span data-stu-id="35536-149">**Distinct deployments for each customer.**</span></span> <span data-ttu-id="35536-150">Las implementaciones distintas por cliente requieren topologías fijas de diferentes configuraciones conocidas.</span><span class="sxs-lookup"><span data-stu-id="35536-150">Distinct deployments per customer require fixed topologies of different known configurations.</span></span> <span data-ttu-id="35536-151">Dichas implementaciones pueden tener diferentes tamaños de máquinas virtuales, un número variable de nodos y distintas cantidades de almacenamiento asociado.</span><span class="sxs-lookup"><span data-stu-id="35536-151">These deployments may have different virtual machine (VM) sizes, varying numbers of nodes, and different amounts of associated storage.</span></span> <span data-ttu-id="35536-152">El etiquetado de las implementaciones se usa en el resumen de facturación de cada cliente.</span><span class="sxs-lookup"><span data-stu-id="35536-152">Tagging of deployments is used for roll-up billing of each customer.</span></span> <span data-ttu-id="35536-153">RBAC puede habilitarse para permitir a los clientes acceso a aspectos de su entorno de nube.</span><span class="sxs-lookup"><span data-stu-id="35536-153">RBAC may be enabled to allow customers access to aspects of their cloud environment.</span></span>
* <span data-ttu-id="35536-154">**Unidades de escalado en entornos multiempresa compartidos.**</span><span class="sxs-lookup"><span data-stu-id="35536-154">**Scale units in shared multi-tenant environments.**</span></span> <span data-ttu-id="35536-155">Una plantilla puede representar una unidad de escalado en entornos multiempresa.</span><span class="sxs-lookup"><span data-stu-id="35536-155">A template can represent a scale unit for multi-tenant environments.</span></span> <span data-ttu-id="35536-156">En este caso, se usa la misma infraestructura para respaldar a todos los clientes.</span><span class="sxs-lookup"><span data-stu-id="35536-156">In this case, the same infrastructure is used to support all customers.</span></span> <span data-ttu-id="35536-157">Las implementaciones representan un grupo de recursos que proporcionan un nivel de capacidad para la oferta hospedada, como el número de usuarios y el número de transacciones.</span><span class="sxs-lookup"><span data-stu-id="35536-157">The deployments represent a group of resources that deliver a level of capacity for the hosted offering, such as number of users and number of transactions.</span></span> <span data-ttu-id="35536-158">Estas unidades de escalado se aumentan o disminuyen según exija la demanda.</span><span class="sxs-lookup"><span data-stu-id="35536-158">These scale units are increased or decreased as demand requires.</span></span>

### <a name="csv-offering-injected-into-customer-subscription"></a><span data-ttu-id="35536-159">Oferta de CSV insertada en la suscripción del cliente</span><span class="sxs-lookup"><span data-stu-id="35536-159">CSV offering injected into customer subscription</span></span>
<span data-ttu-id="35536-160">Puede que quiera implementar su software en suscripciones propiedad de los clientes finales.</span><span class="sxs-lookup"><span data-stu-id="35536-160">You may want to deploy your software into subscriptions owned by end customers.</span></span> <span data-ttu-id="35536-161">Puede usar plantillas para realizar distintas implementaciones en la cuenta de Azure de un cliente.</span><span class="sxs-lookup"><span data-stu-id="35536-161">You can use templates to deploy distinct deployments into a customer’s Azure account.</span></span>

<span data-ttu-id="35536-162">Estas implementaciones usan RBAC de modo que puede actualizar y administrar la implementación en la cuenta del cliente.</span><span class="sxs-lookup"><span data-stu-id="35536-162">These deployments use RBAC so you can update and manage the deployment within the customer’s account.</span></span>

### <a name="azure-marketplace"></a><span data-ttu-id="35536-163">Azure Marketplace</span><span class="sxs-lookup"><span data-stu-id="35536-163">Azure Marketplace</span></span>
<span data-ttu-id="35536-164">Para anunciar y vender sus ofertas mediante un mercado, como Azure Marketplace, puede desarrollar plantillas para proporcionar distintos tipos de implementaciones que se ejecutan en la cuenta de Azure de un cliente.</span><span class="sxs-lookup"><span data-stu-id="35536-164">To advertise and sell your offerings through a marketplace, such as Azure Marketplace, you can develop templates to deliver distinct types of deployments that run in a customer’s Azure account.</span></span> <span data-ttu-id="35536-165">Estas distintas implementaciones pueden describirse normalmente como una talla de camiseta (pequeña, mediana, grande), el tipo de producto/público (comunidad, desarrollador, empresa) o el tipo de característica (básica, alta disponibilidad).</span><span class="sxs-lookup"><span data-stu-id="35536-165">These distinct deployments can be typically described as a t-shirt size (small, medium, large), product/audience type (community, developer, enterprise), or feature type (basic, high availability).</span></span>  <span data-ttu-id="35536-166">En algunos casos, estos tipos permiten especificar ciertos atributos de la implementación, como el tipo de máquina virtual o el número de discos.</span><span class="sxs-lookup"><span data-stu-id="35536-166">In some cases, these types allow you to specify certain attributes of the deployment, such as VM type or number of disks.</span></span>

## <a name="oss-projects"></a><span data-ttu-id="35536-167">Proyectos de software de código abierto</span><span class="sxs-lookup"><span data-stu-id="35536-167">OSS projects</span></span>
<span data-ttu-id="35536-168">Dentro de los proyectos de código abierto, las plantillas del Administrador de recursos permiten a una comunidad implementar una solución rápidamente mediante prácticas de demostrada eficacia.</span><span class="sxs-lookup"><span data-stu-id="35536-168">Within open source projects, Resource Manager templates enable a community to deploy a solution quickly using proven practices.</span></span> <span data-ttu-id="35536-169">Luego, puede almacenar las plantillas en un repositorio de GitHub para que la comunidad pueda revisarlas con el tiempo.</span><span class="sxs-lookup"><span data-stu-id="35536-169">You can store templates in a GitHub repository so the community can revise them over time.</span></span> <span data-ttu-id="35536-170">Los usuarios implementan estas plantillas en sus propias suscripciones de Azure.</span><span class="sxs-lookup"><span data-stu-id="35536-170">Users deploy these templates in their own Azure subscriptions.</span></span>

<span data-ttu-id="35536-171">En las secciones siguientes se identifican los aspectos que debe tener en cuenta antes de diseñar la solución.</span><span class="sxs-lookup"><span data-stu-id="35536-171">The following sections identify the things you need to consider before designing your solution.</span></span>

## <a name="identifying-what-is-outside-and-inside-a-vm"></a><span data-ttu-id="35536-172">Identificación de lo que está dentro y fuera de una máquina virtual</span><span class="sxs-lookup"><span data-stu-id="35536-172">Identifying what is outside and inside a VM</span></span>
<span data-ttu-id="35536-173">Al diseñar la plantilla, resulta útil examinar los requisitos en términos de lo que está fuera y dentro de las máquinas virtuales:</span><span class="sxs-lookup"><span data-stu-id="35536-173">As you design your template, it’s helpful to look at the requirements in terms of what's outside and inside the virtual machines (VMs):</span></span>

* <span data-ttu-id="35536-174">Fuera significa las máquinas virtuales y otros recursos de la implementación, como la topología de red, el etiquetado, las referencias a los certificados o secretos y el control de acceso basado en rol.</span><span class="sxs-lookup"><span data-stu-id="35536-174">Outside means the VMs and other resources of your deployment, such as the network topology, tagging, references to the certs/secrets, and role-based access control.</span></span> <span data-ttu-id="35536-175">Todos estos recursos forman parte de la plantilla.</span><span class="sxs-lookup"><span data-stu-id="35536-175">All these resources are part of your template.</span></span>
* <span data-ttu-id="35536-176">Dentro significa el software instalado y la configuración del estado global deseado.</span><span class="sxs-lookup"><span data-stu-id="35536-176">Inside means the installed software and overall desired state configuration.</span></span> <span data-ttu-id="35536-177">Otros mecanismos, como extensiones de máquina virtual o scripts, se usan en su totalidad o en parte.</span><span class="sxs-lookup"><span data-stu-id="35536-177">Other mechanisms, such as VM extensions or scripts, are used in whole or in part.</span></span> <span data-ttu-id="35536-178">La plantilla puede identificar y ejecutar estos mecanismos pero no están en ella.</span><span class="sxs-lookup"><span data-stu-id="35536-178">These mechanisms may be identified and executed by the template but aren’t in it.</span></span>

<span data-ttu-id="35536-179">Algunos ejemplos comunes de actividades que haría "dentro de la caja" serían:</span><span class="sxs-lookup"><span data-stu-id="35536-179">Common examples of activities you would do “inside the box” include -</span></span>  

* <span data-ttu-id="35536-180">Instalar o quitar características y roles de servidor</span><span class="sxs-lookup"><span data-stu-id="35536-180">Install or remove server roles and features</span></span>
* <span data-ttu-id="35536-181">Instalar y configurar software en el nivel de nodo o clúster</span><span class="sxs-lookup"><span data-stu-id="35536-181">Install and configure software at the node or cluster level</span></span>
* <span data-ttu-id="35536-182">Implementar sitios web en un servidor web</span><span class="sxs-lookup"><span data-stu-id="35536-182">Deploy websites on a web server</span></span>
* <span data-ttu-id="35536-183">Implementar esquemas de base de datos</span><span class="sxs-lookup"><span data-stu-id="35536-183">Deploy database schemas</span></span>
* <span data-ttu-id="35536-184">Administrar el Registro u otros tipos de valores de configuración</span><span class="sxs-lookup"><span data-stu-id="35536-184">Manage registry or other types of configuration settings</span></span>
* <span data-ttu-id="35536-185">Administrar archivos y directorios</span><span class="sxs-lookup"><span data-stu-id="35536-185">Manage files and directories</span></span>
* <span data-ttu-id="35536-186">Iniciar, detener y administrar procesos y servicios</span><span class="sxs-lookup"><span data-stu-id="35536-186">Start, stop, and manage processes and services</span></span>
* <span data-ttu-id="35536-187">Administrar cuentas de usuario y grupos locales</span><span class="sxs-lookup"><span data-stu-id="35536-187">Manage local groups and user accounts</span></span>
* <span data-ttu-id="35536-188">Instalar y administrar paquetes (.msi, .exe, yum, etc.).</span><span class="sxs-lookup"><span data-stu-id="35536-188">Install and manage packages (.msi, .exe, yum, etc.)</span></span>
* <span data-ttu-id="35536-189">Administrar variables de entorno</span><span class="sxs-lookup"><span data-stu-id="35536-189">Manage environment variables</span></span>
* <span data-ttu-id="35536-190">Ejecutar scripts nativos (Windows PowerShell, bash, etc.)</span><span class="sxs-lookup"><span data-stu-id="35536-190">Run native scripts (Windows PowerShell, bash, etc.)</span></span>

### <a name="desired-state-configuration-dsc"></a><span data-ttu-id="35536-191">Configuración de estado deseado (DSC)</span><span class="sxs-lookup"><span data-stu-id="35536-191">Desired state configuration (DSC)</span></span>
<span data-ttu-id="35536-192">Considerando el estado interno de las máquinas virtuales más allá de la implementación, querrá asegurarse de que esta implementación no se "desvía" de la configuración que ha definido y comprobado en el control de código fuente.</span><span class="sxs-lookup"><span data-stu-id="35536-192">Thinking about the internal state of your VMs beyond deployment, you want to make sure this deployment doesn’t "drift" from the configuration that you have defined and checked into source control.</span></span> <span data-ttu-id="35536-193">Este enfoque garantiza que los desarrolladores o el personal de operaciones no realizan cambios ad hoc en un entorno que no estén investigado, probando o registrando en el control de código fuente.</span><span class="sxs-lookup"><span data-stu-id="35536-193">This approach ensures your developers or operations staff don’t make ad-hoc changes to an environment that are not vetted, tested, or recorded in source control.</span></span> <span data-ttu-id="35536-194">Este control es importante porque los cambios manuales no están en el control de código fuente.</span><span class="sxs-lookup"><span data-stu-id="35536-194">This control is important, because the manual changes are not in source control.</span></span> <span data-ttu-id="35536-195">Tampoco forman parte de la implementación estándar y afectarán a futuras implementaciones automatizadas del software.</span><span class="sxs-lookup"><span data-stu-id="35536-195">They are also not part of the standard deployment and will impact future automated deployments of the software.</span></span>

<span data-ttu-id="35536-196">Dejando a un lado los empleados internos, la configuración de estado deseado también es importante desde el punto de vista de la seguridad.</span><span class="sxs-lookup"><span data-stu-id="35536-196">Beyond your internal employees, desired state configuration is also important from a security perspective.</span></span> <span data-ttu-id="35536-197">Los piratas informáticos intentan periódicamente poner en peligro y aprovechar las vulnerabilidades de los sistemas de software.</span><span class="sxs-lookup"><span data-stu-id="35536-197">Hackers are regularly trying to compromise and exploit software systems.</span></span> <span data-ttu-id="35536-198">Cuando lo consiguen, suelen instalar archivos y cambiar de algún modo el estado de un sistema en peligro.</span><span class="sxs-lookup"><span data-stu-id="35536-198">When successful, it's common to install files and otherwise change the state of a compromised system.</span></span> <span data-ttu-id="35536-199">Con la configuración de estado deseado, puede identificar diferencias entre el estado deseado y real y restaurar una configuración conocida.</span><span class="sxs-lookup"><span data-stu-id="35536-199">Using desired state configuration, you can identify deltas between the desired and actual state and restore a known configuration.</span></span>

<span data-ttu-id="35536-200">Existen extensiones de recursos para los mecanismos más conocidos de DSC: DSC de PowerShell, Chef y Puppet.</span><span class="sxs-lookup"><span data-stu-id="35536-200">There are resource extensions for the most popular mechanisms for DSC - PowerShell DSC, Chef, and Puppet.</span></span> <span data-ttu-id="35536-201">Cada una de estas extensiones puede implementar el estado inicial de la máquina virtual y también se puede usar para asegurarse de que se mantiene el estado deseado.</span><span class="sxs-lookup"><span data-stu-id="35536-201">Each of these extensions can deploy the initial state of your VM and also be used to make sure the desired state is maintained.</span></span>

## <a name="common-template-scopes"></a><span data-ttu-id="35536-202">Ámbitos comunes de plantillas</span><span class="sxs-lookup"><span data-stu-id="35536-202">Common template scopes</span></span>
<span data-ttu-id="35536-203">En nuestra experiencia, hemos asistido al surgimiento de tres ámbitos de plantillas de soluciones principales.</span><span class="sxs-lookup"><span data-stu-id="35536-203">In our experience, we’ve seen three key solution templates scopes emerge.</span></span> <span data-ttu-id="35536-204">Estos tres ámbitos, capacidad, funcionalidad y solución completa, se describen en las siguientes secciones.</span><span class="sxs-lookup"><span data-stu-id="35536-204">These three scopes – capacity, capability, and end-to-end solution – are described in the following sections.</span></span>

### <a name="capacity-scope"></a><span data-ttu-id="35536-205">Ámbito de capacidad</span><span class="sxs-lookup"><span data-stu-id="35536-205">Capacity scope</span></span>
<span data-ttu-id="35536-206">Un ámbito de capacidad proporciona un conjunto de recursos en una topología estándar que está preconfigurada para cumplir con las reglamentaciones y directivas.</span><span class="sxs-lookup"><span data-stu-id="35536-206">A capacity scope delivers a set of resources in a standard topology that is pre-configured to be in compliance with regulations and policies.</span></span> <span data-ttu-id="35536-207">El ejemplo más común es la implementación de un entorno de desarrollo estándar en un escenario de TI empresarial o de integradores de sistemas.</span><span class="sxs-lookup"><span data-stu-id="35536-207">The most common example is deploying a standard development environment in an Enterprise IT or SI scenario.</span></span>

### <a name="capability-scope"></a><span data-ttu-id="35536-208">Ámbito de funcionalidad</span><span class="sxs-lookup"><span data-stu-id="35536-208">Capability scope</span></span>
<span data-ttu-id="35536-209">Un ámbito de funcionalidad se centra en la implementación y configuración de una topología para una tecnología determinada.</span><span class="sxs-lookup"><span data-stu-id="35536-209">A capability scope is focused on deploying and configuring a topology for a given technology.</span></span> <span data-ttu-id="35536-210">Los escenarios comunes incluyen tecnologías como SQL Server, Cassandra y Hadoop.</span><span class="sxs-lookup"><span data-stu-id="35536-210">Common scenarios including technologies such as SQL Server, Cassandra, Hadoop.</span></span>

### <a name="end-to-end-solution-scope"></a><span data-ttu-id="35536-211">Ámbito de solución completa</span><span class="sxs-lookup"><span data-stu-id="35536-211">End-to-end solution scope</span></span>
<span data-ttu-id="35536-212">Un ámbito de solución completa va más allá de una funcionalidad única; se centra en la entrega de una solución completa compuesta por varias funcionalidades.</span><span class="sxs-lookup"><span data-stu-id="35536-212">An End-to-End Solution Scope is targeted beyond a single capability, and instead focused on delivering an end to end solution comprised of multiple capabilities.</span></span>  

<span data-ttu-id="35536-213">Una plantilla con ámbito de solución se manifiesta como un conjunto de una o varias plantillas con ámbito de funcionalidad con recursos, lógica y estado deseado específicos de una solución.</span><span class="sxs-lookup"><span data-stu-id="35536-213">A solution-scoped template scope manifests itself as a set of one or more capability-scoped templates with solution-specific resources, logic, and desired state.</span></span> <span data-ttu-id="35536-214">Un ejemplo de una plantilla con ámbito de solución es una plantilla de solución de la canalización de datos completa.</span><span class="sxs-lookup"><span data-stu-id="35536-214">An example of a solution-scoped template is an end to end data pipeline solution template.</span></span> <span data-ttu-id="35536-215">La plantilla puede mezclar la topología y el estado específicos de la solución con varias plantillas de solución con ámbito de funcionalidad, como Kafka, Storm y Hadoop.</span><span class="sxs-lookup"><span data-stu-id="35536-215">The template might mix solution-specific topology and state with multiple capability-scoped solution templates such as Kafka, Storm, and Hadoop.</span></span>

## <a name="choosing-free-form-vs-known-configurations"></a><span data-ttu-id="35536-216">Elección de configuraciones conocidas frente a forma libre</span><span class="sxs-lookup"><span data-stu-id="35536-216">Choosing free-form vs. known configurations</span></span>
<span data-ttu-id="35536-217">Es posible que inicialmente piense que una plantilla debe ofrecer a los clientes la máxima flexibilidad, pero son muchos los aspectos a tener en cuenta a la hora de decidir si usar configuraciones de forma libre o conocidas.</span><span class="sxs-lookup"><span data-stu-id="35536-217">You might initially think a template should give consumers the utmost flexibility, but many considerations affect the choice of whether to use free-form configurations vs. known configurations.</span></span> <span data-ttu-id="35536-218">En esta sección se identifican los requisitos clave de los clientes y las consideraciones técnicas que conforman el enfoque compartido en este documento.</span><span class="sxs-lookup"><span data-stu-id="35536-218">This section identifies the key customer requirements and technical considerations that shaped the approach shared in this document.</span></span>

### <a name="free-form-configurations"></a><span data-ttu-id="35536-219">Configuraciones de forma libre</span><span class="sxs-lookup"><span data-stu-id="35536-219">Free-form configurations</span></span>
<span data-ttu-id="35536-220">A primera vista, las configuraciones de forma libre parecen idóneas.</span><span class="sxs-lookup"><span data-stu-id="35536-220">On the surface, free-form configurations sound ideal.</span></span> <span data-ttu-id="35536-221">Permiten seleccionar un tipo de máquina virtual y proporcionan un número arbitrario de nodos y discos conectados para esos nodos, y lo hacen como parámetros para una plantilla.</span><span class="sxs-lookup"><span data-stu-id="35536-221">They allow you to select a VM type and provide an arbitrary number of nodes and attached disks for those nodes — and do so as parameters to a template.</span></span> <span data-ttu-id="35536-222">Sin embargo, este enfoque no es el ideal para algunos escenarios.</span><span class="sxs-lookup"><span data-stu-id="35536-222">However, this approach is not ideal for some scenarios.</span></span>

<span data-ttu-id="35536-223">En [Sizes for Windows virtual machines in Azure](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)(Tamaños de máquinas virtuales Windows en Azure), se identifican los distintos tipos y tamaños de máquina virtual disponibles, y cada número de discos durables (2, 4, 8, 16 o 32) que se pueden conectar.</span><span class="sxs-lookup"><span data-stu-id="35536-223">In [Sizes for virtual machines](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json), the different VM types and available sizes are identified, and each of the number of durable disks (2, 4, 8, 16, or 32) that can be attached.</span></span> <span data-ttu-id="35536-224">Cada disco conectado proporciona 500 IOPS, y se pueden agrupar múltiplos de estos discos por un multiplicador de ese número de IOPS.</span><span class="sxs-lookup"><span data-stu-id="35536-224">Each attached disk provides 500 IOPS and multiples of these disks can be pooled for a multiplier of that number of IOPS.</span></span> <span data-ttu-id="35536-225">Por ejemplo, se pueden agrupar 16 discos para proporcionar 8000 IOPS.</span><span class="sxs-lookup"><span data-stu-id="35536-225">For example, 16 disks can be pooled to provide 8,000 IOPS.</span></span> <span data-ttu-id="35536-226">La agrupación se realiza con la configuración del sistema operativo, usando espacios de almacenamiento de Microsoft Windows o una matriz redundante de discos independientes (RAID) en Linux.</span><span class="sxs-lookup"><span data-stu-id="35536-226">Pooling is done with configuration in the operating system, using Microsoft Windows Storage Spaces or redundant array of inexpensive disks (RAID) in Linux.</span></span>

<span data-ttu-id="35536-227">Una configuración de forma libre permite la selección de varias instancias de máquina virtual, diferentes tipos y tamaños de VM para esas instancias, varios discos para el tipo de máquina virtual y uno o más scripts para configurar el contenido de la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="35536-227">A free-form configuration enables the selection several VM instances, various VM types and sizes for those instances, various disks for the VM type, and one or more scripts to configure the VM contents.</span></span>

<span data-ttu-id="35536-228">Es frecuente que una implementación pueda tener varios tipos de nodos, como nodos maestros y de datos, por lo que esta flexibilidad se proporciona a menudo para cada tipo de nodo.</span><span class="sxs-lookup"><span data-stu-id="35536-228">It is common that a deployment may have multiple types of nodes, such as master and data nodes, so this flexibility is often provided for every node type.</span></span>

<span data-ttu-id="35536-229">Conforme empiece a implementar clústeres de cierta importancia, comenzará a trabajar con estos escenarios complejos.</span><span class="sxs-lookup"><span data-stu-id="35536-229">As you start to deploy clusters of any significance, you begin to work with these complex scenarios.</span></span> <span data-ttu-id="35536-230">Si fuera a implementara un clúster de Hadoop, por ejemplo, con 8 nodos maestros y 200 nodos de datos y agrupara 4 discos conectados en cada nodo principal y 16 discos conectados por nodo de datos, habría 208 máquinas virtuales y 3232 discos para administrar.</span><span class="sxs-lookup"><span data-stu-id="35536-230">If you were deploying a Hadoop cluster, for example, with 8 master nodes and 200 data nodes, and pooled 4 attached disks on each master node and pooled 16 attached disks per data node, you would have 208 VMs and 3,232 disks to manage.</span></span>

<span data-ttu-id="35536-231">Una cuenta de almacenamiento limita las solicitudes anteriores por encima de su límite identificado de 20 000 transacciones por segundo, por lo que debe examinar el particionamiento de la cuenta de almacenamiento y usar cálculos para determinar el número adecuado de cuentas de almacenamiento que hacen posible esta topología.</span><span class="sxs-lookup"><span data-stu-id="35536-231">A storage account will throttle requests above its identified 20,000 transactions/second limit, so you should look at storage account partitioning and use calculations to determine the appropriate number of storage accounts to accommodate this topology.</span></span> <span data-ttu-id="35536-232">Dada la gran variedad de combinaciones que admite el enfoque de forma libre, se requieren cálculos dinámicos para determinar el particionamiento adecuado.</span><span class="sxs-lookup"><span data-stu-id="35536-232">Given the multitude of combinations supported by the free-form approach, dynamic calculations are required to determine the appropriate partitioning.</span></span> <span data-ttu-id="35536-233">El lenguaje de plantillas del Administrador de recursos de Azure no proporciona actualmente funciones matemáticas, por lo que debe realizar estos cálculos en el código y generar una plantilla única codificada de forma rígida con los detalles correspondientes.</span><span class="sxs-lookup"><span data-stu-id="35536-233">The Azure Resource Manager Template Language does not presently provide mathematical functions, so you must perform these calculations in code, generating a unique, hard-coded template with the appropriate details.</span></span>

<span data-ttu-id="35536-234">En escenarios de integradores de sistemas y tecnología de la información, alguien debe mantener las plantillas y proporcionar soporte para las topologías implementadas en una o varias organizaciones.</span><span class="sxs-lookup"><span data-stu-id="35536-234">In enterprise IT and SI scenarios, someone must maintain the templates and support the deployed topologies for one or more organizations.</span></span> <span data-ttu-id="35536-235">Esta sobrecarga adicional, configuraciones y plantillas diferentes para cada cliente, está lejos de ser deseable.</span><span class="sxs-lookup"><span data-stu-id="35536-235">This additional overhead — different configurations and templates for each customer — is far from desirable.</span></span>

<span data-ttu-id="35536-236">Puede usar estas plantillas para implementar los entornos en la suscripción de Azure de sus clientes, pero tanto los equipos de TI corporativos como los CSV suelen implementarlos en sus propias suscripciones y usan una función de contracargo para facturar a sus clientes.</span><span class="sxs-lookup"><span data-stu-id="35536-236">You can use these templates to deploy environments in your customer’s Azure subscription, but both corporate IT teams and CSVs typically deploy them into their own subscriptions, using a chargeback function to bill their customers.</span></span> <span data-ttu-id="35536-237">En estos casos, el objetivo es implementar capacidad para varios clientes en un grupo de suscripciones y mantener las implementaciones densamente pobladas en las suscripciones a fin de minimizar la proliferación de estas; es decir, más suscripciones que administrar.</span><span class="sxs-lookup"><span data-stu-id="35536-237">In these scenarios, the goal is to deploy capacity for multiple customers across a pool of subscriptions and keep deployments densely populated into the subscriptions to minimize subscription sprawl—that is, more subscriptions to manage.</span></span> <span data-ttu-id="35536-238">Con tamaños de implementación verdaderamente dinámicos, conseguir este tipo de densidad requiere una cuidadosa planeación y el desarrollo adicional del trabajo de scaffolding en nombre de la organización.</span><span class="sxs-lookup"><span data-stu-id="35536-238">With truly dynamic deployment sizes, achieving this type of density requires careful planning and additional development for scaffolding work on behalf of the organization.</span></span>

<span data-ttu-id="35536-239">Además, no puede crear suscripciones mediante una llamada API, sino que deberá hacerlo manualmente mediante el portal.</span><span class="sxs-lookup"><span data-stu-id="35536-239">In addition, you can’t create subscriptions via an API call but must do so manually through the portal.</span></span> <span data-ttu-id="35536-240">A medida que aumenta el número de suscripciones, cualquier expansión resultante precisará de intervención humana, no se puede automatizar.</span><span class="sxs-lookup"><span data-stu-id="35536-240">As the number of subscriptions increases, any resulting subscription sprawl requires human intervention—it can’t be automated.</span></span> <span data-ttu-id="35536-241">Con tanta variabilidad en el tamaño de las implementaciones, tendrá que aprovisionar previamente una serie de suscripciones manualmente para asegurarse de que estén disponibles.</span><span class="sxs-lookup"><span data-stu-id="35536-241">With so much variability in the sizes of deployments, you would have to pre-provision a number of subscriptions manually to ensure subscriptions are available.</span></span>

<span data-ttu-id="35536-242">Teniendo en cuenta todos estos factores, una configuración verdaderamente de forma libre es menos atractiva que a primera vista.</span><span class="sxs-lookup"><span data-stu-id="35536-242">Considering all these factors, a truly free-form configuration is less appealing than at first blush.</span></span>

### <a name="known-configurations--the-t-shirt-sizing-approach"></a><span data-ttu-id="35536-243">Configuraciones conocidas: el enfoque del tamaño de camiseta</span><span class="sxs-lookup"><span data-stu-id="35536-243">Known configurations — the t-shirt sizing approach</span></span>
<span data-ttu-id="35536-244">En lugar de ofrecer una plantilla que proporcione flexibilidad total e incontables variaciones, un patrón común según nuestra experiencia es proporcionar la posibilidad de seleccionar configuraciones conocidas, de hecho, tamaños de camiseta estándar como pequeña, mediana y grande.</span><span class="sxs-lookup"><span data-stu-id="35536-244">Rather than offer a template that provides total flexibility and countless variations, in our experience a common pattern is to provide the ability to select known configurations — in effect, standard t-shirt sizes such as sandbox, small, medium, and large.</span></span> <span data-ttu-id="35536-245">Otros ejemplos de tamaños de camiseta son ofertas de productos, como edición para la comunidad o edición para impresa.</span><span class="sxs-lookup"><span data-stu-id="35536-245">Other examples of t-shirt sizes are product offerings, such as community edition or enterprise edition.</span></span>  <span data-ttu-id="35536-246">En otros casos, pueden ser configuraciones de una tecnología específicas de la carga de trabajo, como MapReduce o NoSQL.</span><span class="sxs-lookup"><span data-stu-id="35536-246">In other cases, it may be workload-specific configurations of a technology – such as map reduce or no sql.</span></span>

<span data-ttu-id="35536-247">Muchas organizaciones de TI corporativa, proveedores de software de código abierto e integradores de sistemas permiten que sus ofertas estén disponibles de esta manera en entornos virtualizados locales (empresas) o como ofertas de software como servicio (SaaS) (CSV y OSV).</span><span class="sxs-lookup"><span data-stu-id="35536-247">Many enterprise IT organizations, OSS vendors, and SIs make their offerings available today in this way in on-premises, virtualized environments (enterprises) or as software-as-a-service (SaaS) offerings (CSVs and OSVs).</span></span>

<span data-ttu-id="35536-248">Este enfoque proporciona configuraciones bien conocidas de tamaños variables que están preconfiguradas para los clientes.</span><span class="sxs-lookup"><span data-stu-id="35536-248">This approach provides good, known configurations of varying sizes that are preconfigured for customers.</span></span> <span data-ttu-id="35536-249">Sin configuraciones conocidas, los clientes finales deben determinar el tamaño del clúster por su cuenta, tener en cuenta las restricciones de recursos de plataforma y realizar cálculos matemáticos para identificar el particionamiento resultante de las cuentas de almacenamiento y otros recursos (debido a restricciones en el tamaño del clúster y los recursos).</span><span class="sxs-lookup"><span data-stu-id="35536-249">Without known configurations, end customers must determine cluster sizing on their own, factor in platform resource constraints, and do math to identify the resulting partitioning of storage accounts and other resources (due to cluster size and resource constraints).</span></span> <span data-ttu-id="35536-250">Las configuraciones conocidas permiten a los clientes seleccionar fácilmente el tamaño correcto de camiseta, es decir, una implementación determinada.</span><span class="sxs-lookup"><span data-stu-id="35536-250">Known configurations enable customers to easily select the right t-shirt size—that is, a given deployment.</span></span> <span data-ttu-id="35536-251">Además de crear una experiencia mejor para el cliente, un número pequeño de configuraciones conocidas es más fácil de mantener y puede ayudarle a ofrecer un nivel mayor de densidad.</span><span class="sxs-lookup"><span data-stu-id="35536-251">In addition to making a better experience for the customer, a small number of known configurations is easier to support and can help you deliver a higher level of density.</span></span>

<span data-ttu-id="35536-252">Un enfoque de configuración conocida centrado en los tamaños de camiseta también puede tener un número variable de nodos dentro de un mismo tamaño.</span><span class="sxs-lookup"><span data-stu-id="35536-252">A known configuration approach focused on t-shirt sizes may also have varying number of nodes within a size.</span></span> <span data-ttu-id="35536-253">Por ejemplo, un tamaño de camiseta pequeña puede estar entre 3 y 10 nodos.</span><span class="sxs-lookup"><span data-stu-id="35536-253">For example, a small t-shirt size may be between 3 and 10 nodes.</span></span>  <span data-ttu-id="35536-254">El tamaño de camiseta estaría diseñado para alojar hasta 10 nodos y proporcionaría al cliente la posibilidad de realizar selecciones de forma libre hasta el tamaño máximo identificado.</span><span class="sxs-lookup"><span data-stu-id="35536-254">The t-shirt size would be designed to accommodate up to 10 nodes and provide the consumer the ability to make free form selections up to the maximum size identified.</span></span>  

<span data-ttu-id="35536-255">Un tamaño de camiseta basado en el tipo de carga de trabajo puede tener más una naturaleza de forma libre en lo relativo al número de nodos que se pueden implementar, pero tendrá un tamaño de nodo distinto de carga de trabajo y la configuración del software en el nodo.</span><span class="sxs-lookup"><span data-stu-id="35536-255">A t-shirt size based on workload type, may be more free form in nature in terms of the number of nodes that can be deployed but will have workload distinct node size and configuration of the software on the node.</span></span>

<span data-ttu-id="35536-256">Las ofertas de productos basadas en los tamaños de camiseta, como Comunidad o Empresa, pueden tener tipos de recursos distintos y un número máximo de nodos que se pueden implementar, lo que va asociado normalmente a las consideraciones de licencia o la disponibilidad de características en las diferentes ofertas.</span><span class="sxs-lookup"><span data-stu-id="35536-256">T-shirt sizes based on product offerings, such as community or Enterprise, may have distinct resource types and maximum number of nodes that can be deployed, typically tied to licensing considerations or feature availability across the different offerings.</span></span>

<span data-ttu-id="35536-257">También puede adaptarse a los clientes con variantes únicas usando plantillas basadas en JSON.</span><span class="sxs-lookup"><span data-stu-id="35536-257">You can also accommodate customers with unique variants using the JSON-based templates.</span></span> <span data-ttu-id="35536-258">Cuando se trabaja con clientes atípicos, puede incorporar la planeación adecuada y las consideraciones sobre desarrollo, soporte técnico y costos.</span><span class="sxs-lookup"><span data-stu-id="35536-258">When dealing with outliers, you can incorporate the appropriate planning and considerations for development, support, and costing.</span></span>

<span data-ttu-id="35536-259">En función de los escenarios de consumo de plantillas del cliente y de los requisitos identificados al principio de este documento, identificamos un patrón para la descomposición de plantillas.</span><span class="sxs-lookup"><span data-stu-id="35536-259">Based on the customer template consumption scenarios, and requirements identified at the start of this document, we identified a pattern for template decomposition.</span></span>

## <a name="capacity-and-capability-scoped-solution-templates"></a><span data-ttu-id="35536-260">Plantillas de soluciones con ámbito de capacidad y de funcionalidad</span><span class="sxs-lookup"><span data-stu-id="35536-260">Capacity and capability-scoped solution templates</span></span>
<span data-ttu-id="35536-261">La descomposición proporciona un enfoque modular hacia el desarrollo de plantillas que admite la reutilización, la extensibilidad, la prueba y el uso de herramientas.</span><span class="sxs-lookup"><span data-stu-id="35536-261">Decomposition provides a modular approach to template development that supports reuse, extensibility, testing, and tooling.</span></span> <span data-ttu-id="35536-262">En esta sección se proporcionan detalles sobre cómo se puede aplicar un enfoque de descomposición a plantillas con un ámbito de capacidad o de funcionalidad.</span><span class="sxs-lookup"><span data-stu-id="35536-262">This section provides detail on how a decomposition approach can be applied to templates with a Capacity or Capability scope.</span></span>

<span data-ttu-id="35536-263">En este enfoque, una plantilla principal recibe los valores de parámetro de un consumidor de plantillas y luego se vincula a varios tipos de plantillas y scripts de nivel inferior tal y como se muestra a continuación.</span><span class="sxs-lookup"><span data-stu-id="35536-263">In this approach, a main template receives parameter values from a template consumer, then links to several types of templates and scripts downstream as shown below.</span></span> <span data-ttu-id="35536-264">Se usan parámetros, variables estáticas y variables generadas para proporcionar valores dentro y fuera de las plantillas vinculadas.</span><span class="sxs-lookup"><span data-stu-id="35536-264">Parameters, static variables, and generated variables are used to provide values in and out of the linked templates.</span></span>

![Parámetros de plantilla](./media/best-practices-resource-manager-design-templates/template-parameters.png)

<span data-ttu-id="35536-266">**Los parámetros se pasan a una plantilla principal y luego a plantillas vinculadas**</span><span class="sxs-lookup"><span data-stu-id="35536-266">**Parameters are passed to a main template then to linked templates**</span></span>

<span data-ttu-id="35536-267">Las secciones siguientes se centran en los tipos de plantillas y scripts que se descomponen en una sola plantilla.</span><span class="sxs-lookup"><span data-stu-id="35536-267">The following sections focus on the types of templates and scripts that a single template is decomposed into.</span></span> <span data-ttu-id="35536-268">Las secciones presentan enfoques para pasar información de estado entre las plantillas.</span><span class="sxs-lookup"><span data-stu-id="35536-268">The sections present approaches for passing state information among the templates.</span></span> <span data-ttu-id="35536-269">Cada plantilla y los tipos de scripts de la imagen se describen junto con ejemplos.</span><span class="sxs-lookup"><span data-stu-id="35536-269">Each template and the script types in the image are described along with examples.</span></span> <span data-ttu-id="35536-270">Para obtener un ejemplo contextual, vea "Integración: una implementación de ejemplo" más adelante en este documento.</span><span class="sxs-lookup"><span data-stu-id="35536-270">For a contextual example, see "Putting it together: a sample implementation" later in this document.</span></span>

### <a name="template-metadata"></a><span data-ttu-id="35536-271">Metadatos de plantilla</span><span class="sxs-lookup"><span data-stu-id="35536-271">Template metadata</span></span>
<span data-ttu-id="35536-272">Los metadatos de plantilla (archivo metadata.json) contienen los pares de clave y valor que describen una plantilla en JSON, que los seres humanos y los sistemas de software pueden leer.</span><span class="sxs-lookup"><span data-stu-id="35536-272">Template metadata (the metadata.json file) contains key/value pairs that describe a template in JSON, which can be read by humans and software systems.</span></span>

![Metadatos de plantilla](./media/best-practices-resource-manager-design-templates/template-metadata.png)

<span data-ttu-id="35536-274">**Los metadatos de plantilla se describen en el archivo metadata.json**</span><span class="sxs-lookup"><span data-stu-id="35536-274">**Template metadata is described in the metadata.json file**</span></span>

<span data-ttu-id="35536-275">Los agentes de software pueden recuperar el archivo metadata.json y publicar la información y un vínculo a la plantilla en una página o un directorio web.</span><span class="sxs-lookup"><span data-stu-id="35536-275">Software agents can retrieve the metadata.json file and publish the information and a link to the template in a web page or directory.</span></span> <span data-ttu-id="35536-276">Los elementos incluyen *itemDisplayName*, *description*, *summary*, *githubUsername* y *dateUpdated*.</span><span class="sxs-lookup"><span data-stu-id="35536-276">Elements include *itemDisplayName*, *description*, *summary*, *githubUsername*, and *dateUpdated*.</span></span>

<span data-ttu-id="35536-277">A continuación, se muestra un archivo de ejemplo en su totalidad.</span><span class="sxs-lookup"><span data-stu-id="35536-277">An example file is shown below in its entirety.</span></span>

    {
        "itemDisplayName": "PostgreSQL 9.3 on Ubuntu VMs",
        "description": "This template creates a PostgreSQL streaming-replication between a master and one or more slave servers each with 2 striped data disks. The database servers are deployed into a private-only subnet with one publicly accessible jumpbox VM in a DMZ subnet with public IP.",
        "summary": "PostgreSQL stream-replication with multiple slave servers and a publicly accessible jumpbox VM",
        "githubUsername": "arsenvlad",
        "dateUpdated": "2015-04-24"
    }

### <a name="main-template"></a><span data-ttu-id="35536-278">Plantilla principal</span><span class="sxs-lookup"><span data-stu-id="35536-278">Main template</span></span>
<span data-ttu-id="35536-279">La plantilla principal recibe parámetros de un usuario, usa esa información para rellenar las variables de objetos complejos y ejecuta las plantillas vinculadas.</span><span class="sxs-lookup"><span data-stu-id="35536-279">The main template receives parameters from a user, uses that information to populate complex object variables, and executes the linked templates.</span></span>

![Plantilla principal](./media/best-practices-resource-manager-design-templates/main-template.png)

<span data-ttu-id="35536-281">**La plantilla principal recibe parámetros de un usuario**</span><span class="sxs-lookup"><span data-stu-id="35536-281">**The main template receives parameters from a user**</span></span>

<span data-ttu-id="35536-282">Un parámetro proporcionado es un tipo de configuración conocida, también conocido como parámetro de tamaño de camiseta debido a sus valores estándar: pequeño, mediano o grande.</span><span class="sxs-lookup"><span data-stu-id="35536-282">One parameter that is provided is a known configuration type also known as the t-shirt size parameter because of its standardized values such as small, medium, or large.</span></span> <span data-ttu-id="35536-283">En la práctica, puede usar este parámetro de varias formas.</span><span class="sxs-lookup"><span data-stu-id="35536-283">In practice, you can use this parameter in multiple ways.</span></span> <span data-ttu-id="35536-284">Para obtener más información, vea "Plantilla de recursos de configuración conocida" más adelante en este documento.</span><span class="sxs-lookup"><span data-stu-id="35536-284">For details, see "Known configuration resources template" later in this document.</span></span>

<span data-ttu-id="35536-285">Algunos recursos se implementan sin tener en cuenta la configuración conocida especificada por un parámetro de usuario.</span><span class="sxs-lookup"><span data-stu-id="35536-285">Some resources are deployed regardless of the known configuration specified by a user parameter.</span></span> <span data-ttu-id="35536-286">Estos recursos se aprovisionan con una plantilla de recursos compartidos únicos y otras plantillas los comparten, por lo que la plantilla de recursos compartidos se ejecuta primero.</span><span class="sxs-lookup"><span data-stu-id="35536-286">These resources are provisioned using a single shared resource template and are shared by other templates, so the shared resource template is run first.</span></span>

<span data-ttu-id="35536-287">Algunos recursos se implementan opcionalmente, sin tener en cuenta la configuración conocida especificada.</span><span class="sxs-lookup"><span data-stu-id="35536-287">Some resources are deployed optionally regardless of the specified known configuration.</span></span>

### <a name="shared-resources-template"></a><span data-ttu-id="35536-288">Plantilla de recursos compartidos</span><span class="sxs-lookup"><span data-stu-id="35536-288">Shared resources template</span></span>
<span data-ttu-id="35536-289">Esta plantilla proporciona los recursos que son comunes a todas las configuraciones conocidas.</span><span class="sxs-lookup"><span data-stu-id="35536-289">This template delivers resources that are common across all known configurations.</span></span> <span data-ttu-id="35536-290">Contiene la red virtual, los conjuntos de disponibilidad y otros recursos que son necesarios, independientemente de la plantilla de configuración conocida que se implemente.</span><span class="sxs-lookup"><span data-stu-id="35536-290">It contains the virtual network, availability sets, and other resources that are required regardless of the known configuration template that is deployed.</span></span>

![Recursos de plantilla](./media/best-practices-resource-manager-design-templates/template-resources.png)

<span data-ttu-id="35536-292">**Plantilla de recursos compartidos**</span><span class="sxs-lookup"><span data-stu-id="35536-292">**Shared resources template**</span></span>

<span data-ttu-id="35536-293">Los nombres de los recursos, como el nombre de red virtual, se basan en la plantilla principal.</span><span class="sxs-lookup"><span data-stu-id="35536-293">Resource names, such as the virtual network name, are based on the main template.</span></span> <span data-ttu-id="35536-294">Puede especificarlos como una variable dentro de esa plantilla o recibirlos como un parámetro del usuario, según requiera su organización.</span><span class="sxs-lookup"><span data-stu-id="35536-294">You can specify them as a variable within that template or receive them as a parameter from the user, as required by your organization.</span></span>

### <a name="optional-resources-template"></a><span data-ttu-id="35536-295">Plantilla de recursos opcionales</span><span class="sxs-lookup"><span data-stu-id="35536-295">Optional resources template</span></span>
<span data-ttu-id="35536-296">La plantilla de recursos opcionales contiene los recursos que se implementan mediante programación en función del valor de un parámetro o de una variable.</span><span class="sxs-lookup"><span data-stu-id="35536-296">The optional resources template contains resources that are programmatically deployed based on the value of a parameter or variable.</span></span>

![Recursos opcionales](./media/best-practices-resource-manager-design-templates/optional-resources.png)

<span data-ttu-id="35536-298">**Plantilla de recursos opcionales**</span><span class="sxs-lookup"><span data-stu-id="35536-298">**Optional resources template**</span></span>

<span data-ttu-id="35536-299">Por ejemplo, puede usar una plantilla de recursos opcionales para configurar un Jumpbox que permita el acceso indirecto a un entorno implementado desde la Internet pública.</span><span class="sxs-lookup"><span data-stu-id="35536-299">For example, you can use an optional resources template to configure a jumpbox that enables indirect access to a deployed environment from the public Internet.</span></span> <span data-ttu-id="35536-300">Usaría un parámetro o una variable para determinar si debe habilitarse el Jumpbox y la función *concat* para crear el nombre de destino de la plantilla, como *jumpbox_enabled.json*.</span><span class="sxs-lookup"><span data-stu-id="35536-300">You would use a parameter or variable to identify whether the jumpbox should be enabled and the *concat* function to build the target name for the template, such as *jumpbox_enabled.json*.</span></span> <span data-ttu-id="35536-301">La vinculación de plantillas usaría la variable resultante para instalar el Jumpbox.</span><span class="sxs-lookup"><span data-stu-id="35536-301">Template linking would use the resulting variable to install the jumpbox.</span></span>

<span data-ttu-id="35536-302">Puede vincular la plantilla de recursos opcionales desde varios lugares:</span><span class="sxs-lookup"><span data-stu-id="35536-302">You can link the optional resources template from multiple places:</span></span>

* <span data-ttu-id="35536-303">Cuando sea aplicable para cada implementación, cree un vínculo controlado por parámetro de la plantilla de recursos compartidos.</span><span class="sxs-lookup"><span data-stu-id="35536-303">When applicable to every deployment, create a parameter-driven link from the shared resources template.</span></span>
* <span data-ttu-id="35536-304">Cuando sea aplicable para seleccionar configuraciones conocidas, por ejemplo, para instalar en implementaciones de gran envergadura, cree un vínculo controlado por variable o controlado por parámetro a partir de la plantilla de configuración conocida.</span><span class="sxs-lookup"><span data-stu-id="35536-304">When applicable to select known configurations—for example, only install on large deployments—create a parameter-driven or variable-driven link from the known configuration template.</span></span>

<span data-ttu-id="35536-305">Si un recurso determinado es opcional, podría no ser controlado por el consumidor de la plantilla, sino por el proveedor de la misma.</span><span class="sxs-lookup"><span data-stu-id="35536-305">Whether a given resource is optional may not be driven by the template consumer but instead by the template provider.</span></span> <span data-ttu-id="35536-306">Por ejemplo, puede que necesite satisfacer un determinado requisito de producto o complemento de producto (común para los CSV) o aplicar directivas (común para los SI y grupos de TI empresariales).</span><span class="sxs-lookup"><span data-stu-id="35536-306">For example, you may need to satisfy a particular product requirement or product add-on (common for CSVs) or to enforce policies (common for SIs and enterprise IT groups).</span></span> <span data-ttu-id="35536-307">En estos casos, puede usar una variable para identificar si el recurso que debe implementarse.</span><span class="sxs-lookup"><span data-stu-id="35536-307">In these cases, you can use a variable to identify whether the resource should be deployed.</span></span>

### <a name="known-configuration-resources-template"></a><span data-ttu-id="35536-308">Plantilla de recursos de configuración conocida</span><span class="sxs-lookup"><span data-stu-id="35536-308">Known configuration resources template</span></span>
<span data-ttu-id="35536-309">En la plantilla principal, se puede exponer un parámetro para permitir que el consumidor de la plantilla especifique una configuración conocida que desee implementar.</span><span class="sxs-lookup"><span data-stu-id="35536-309">In the main template, a parameter can be exposed to allow the template consumer to specify a desired known configuration to deploy.</span></span> <span data-ttu-id="35536-310">A menudo, esta configuración conocida usa un enfoque de tamaño de camiseta, con un conjunto de tamaños de configuración fijos, como espacio aislado, pequeña, mediana y grande.</span><span class="sxs-lookup"><span data-stu-id="35536-310">Often, this known configuration uses a t-shirt size approach with a set of fixed configuration sizes such as sandbox, small, medium, and large.</span></span>

![Recursos de configuración conocida](./media/best-practices-resource-manager-design-templates/known-config.png)

<span data-ttu-id="35536-312">**Plantilla de recursos de configuración conocida**</span><span class="sxs-lookup"><span data-stu-id="35536-312">**Known configuration resources template**</span></span>

<span data-ttu-id="35536-313">Normalmente se usa el enfoque de tamaño de camiseta, pero los parámetros pueden representar cualquier conjunto de configuraciones conocidas.</span><span class="sxs-lookup"><span data-stu-id="35536-313">The t-shirt size approach is commonly used, but the parameters can represent any set of known configurations.</span></span> <span data-ttu-id="35536-314">Por ejemplo, puede especificar un conjunto de entornos para una aplicación empresarial, como Desarrollo, Prueba y Producto.</span><span class="sxs-lookup"><span data-stu-id="35536-314">For example, you can specify a set of environments for an enterprise application such as Development, Test, and Product.</span></span> <span data-ttu-id="35536-315">O bien, puede usarlo en un servicio en la nube para representar unidades de escalado, versiones o configuraciones de producto diferentes como Comunidad, Desarrollador o Empresa.</span><span class="sxs-lookup"><span data-stu-id="35536-315">Or you could use it for a cloud service to represent different scale units, product versions, or product configurations such as Community, Developer, or Enterprise.</span></span>

<span data-ttu-id="35536-316">Al igual que con la plantilla de recursos compartidos, las variables se pasan a la plantilla de configuraciones conocidas desde:</span><span class="sxs-lookup"><span data-stu-id="35536-316">As with the shared resource template, variables are passed to the known configurations template from either:</span></span>

* <span data-ttu-id="35536-317">Un usuario final, es decir, los parámetros enviados a la plantilla principal.</span><span class="sxs-lookup"><span data-stu-id="35536-317">An end user—that is, the parameters sent to the main template.</span></span>
* <span data-ttu-id="35536-318">Una organización, es decir, las variables de la plantilla principal que representan los requisitos o directivas internos.</span><span class="sxs-lookup"><span data-stu-id="35536-318">An organization—that is, the variables in the main template that represent internal requirements or policies.</span></span>

### <a name="member-resources-template"></a><span data-ttu-id="35536-319">Plantilla de recursos de miembros</span><span class="sxs-lookup"><span data-stu-id="35536-319">Member resources template</span></span>
<span data-ttu-id="35536-320">Dentro de una configuración conocida, a menudo se incluyen uno o más tipos de nodos de miembros.</span><span class="sxs-lookup"><span data-stu-id="35536-320">Within a known configuration, one or more member node types are often included.</span></span> <span data-ttu-id="35536-321">Por ejemplo, con Hadoop tiene nodos maestros y de datos.</span><span class="sxs-lookup"><span data-stu-id="35536-321">For example, with Hadoop you have master nodes and data nodes.</span></span> <span data-ttu-id="35536-322">Si instala MongoDB, tiene nodos de datos y un árbitro.</span><span class="sxs-lookup"><span data-stu-id="35536-322">If you are installing MongoDB, you have data nodes and an arbiter.</span></span> <span data-ttu-id="35536-323">Si implementa DataStax, tiene nodos de datos, así como una máquina virtual con OpsCenter instalado.</span><span class="sxs-lookup"><span data-stu-id="35536-323">If you are deploying DataStax, you have data nodes and a VM with OpsCenter installed.</span></span>

![Recursos de miembros](./media/best-practices-resource-manager-design-templates/member-resources.png)

<span data-ttu-id="35536-325">**Plantilla de recursos de miembros**</span><span class="sxs-lookup"><span data-stu-id="35536-325">**Member resources template**</span></span>

<span data-ttu-id="35536-326">Cada tipo de nodo puede tener distintos tamaños de máquinas virtuales, números de discos conectados, scripts para instalar y configurar los nodos, configuraciones de puerto para las máquinas virtuales, número de instancias y otros detalles.</span><span class="sxs-lookup"><span data-stu-id="35536-326">Each type of nodes can have different sizes of VMs, numbers of attached disks, scripts to install and set up the nodes, port configurations for the VMs, number of instances, and other details.</span></span> <span data-ttu-id="35536-327">De modo que cada tipo de nodo obtiene su propia plantilla de recursos de miembros, que contiene los detalles para implementar y configurar una infraestructura, así como para ejecutar scripts para implementar y configurar el software en la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="35536-327">So each node type gets its own member resource template, which contains the details for deploying and configuring an infrastructure as well as executing scripts to deploy and configure software within the VM.</span></span>

<span data-ttu-id="35536-328">Para las máquinas virtuales se usan normalmente dos tipos de scripts: scripts ampliamente reutilizables y scripts personalizados.</span><span class="sxs-lookup"><span data-stu-id="35536-328">For VMs, typically two types of scripts are used, widely reusable and custom scripts.</span></span>

### <a name="widely-reusable-scripts"></a><span data-ttu-id="35536-329">Scripts ampliamente reutilizables</span><span class="sxs-lookup"><span data-stu-id="35536-329">Widely reusable scripts</span></span>
<span data-ttu-id="35536-330">Los scripts ampliamente reutilizables se pueden usar en varios tipos de plantillas.</span><span class="sxs-lookup"><span data-stu-id="35536-330">Widely reusable scripts can be used across multiple types of templates.</span></span> <span data-ttu-id="35536-331">En uno de los mejores ejemplos de estos scripts ampliamente reutilizables, se configura RAID en Linux para agrupar los discos y obtener un número mayor de IOPS.</span><span class="sxs-lookup"><span data-stu-id="35536-331">One of the better examples of these widely reusable scripts sets up RAID on Linux to pool disks and gain a greater number of IOPS.</span></span> <span data-ttu-id="35536-332">Sin tener en cuenta el software que se instala en la máquina virtual, este script proporciona la reutilización de prácticas de demostrada eficacia en escenarios comunes.</span><span class="sxs-lookup"><span data-stu-id="35536-332">Regardless of the software being installed in the VM, this script provides reuse of proven practices for common scenarios.</span></span>

![Scripts reutilizables](./media/best-practices-resource-manager-design-templates/reusable-scripts.png)

<span data-ttu-id="35536-334">**Las plantillas de recursos de miembros pueden llamar a los scripts ampliamente reutilizables**</span><span class="sxs-lookup"><span data-stu-id="35536-334">**Member resources templates can call widely reusable scripts**</span></span>

### <a name="custom-scripts"></a><span data-ttu-id="35536-335">Scripts personalizados</span><span class="sxs-lookup"><span data-stu-id="35536-335">Custom scripts</span></span>
<span data-ttu-id="35536-336">Las plantillas llaman habitualmente a uno o varios scripts que instalan y configuran software en las máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="35536-336">Templates commonly call one or more scripts that install and configure software within VMs.</span></span> <span data-ttu-id="35536-337">Se considera un patrón común con topologías grandes donde se implementan varias instancias de uno o varios tipos de miembros.</span><span class="sxs-lookup"><span data-stu-id="35536-337">A common pattern is seen with large topologies where multiple instances of one or more member types are deployed.</span></span> <span data-ttu-id="35536-338">Se inicia un script de instalación para cada máquina virtual que se puede ejecutar en paralelo, seguido de un script de configuración al que se llama después de que se implementan todas las máquinas virtuales (o todas las máquinas virtuales de un tipo de miembro especificado).</span><span class="sxs-lookup"><span data-stu-id="35536-338">An installation script is initiated for every VM that can be run in parallel, followed by a setup script that is called after all VMs (or all VMs of a given member type) are deployed.</span></span>

![Scripts personalizados](./media/best-practices-resource-manager-design-templates/custom-scripts.png)

<span data-ttu-id="35536-340">**Las plantillas de recursos de miembros pueden llamar a scripts de fin específico, como la configuración de una máquina virtual**</span><span class="sxs-lookup"><span data-stu-id="35536-340">**Member resources templates can call scripts for a specific purpose such as VM configuration**</span></span>

## <a name="capability-scoped-solution-template-example---redis"></a><span data-ttu-id="35536-341">Ejemplo de plantilla de solución con ámbito de funcionalidad: Redis</span><span class="sxs-lookup"><span data-stu-id="35536-341">Capability-scoped solution template example - Redis</span></span>
<span data-ttu-id="35536-342">Para mostrar cómo podría funcionar una implementación, echemos un vistazo a un ejemplo práctico de creación de una plantilla que facilita la implementación y configuración de Redis en tamaños de camiseta estándar.</span><span class="sxs-lookup"><span data-stu-id="35536-342">To show how an implementation might work, let's look at a practical example of building a template that facilitates the deployment and configuration of Redis in standard t-shirt sizes.</span></span>  

<span data-ttu-id="35536-343">Para la implementación, hay un conjunto de recursos opcionales (red virtual, cuenta de almacenamiento, conjuntos de disponibilidad) y un recurso opcional (Jumpbox).</span><span class="sxs-lookup"><span data-stu-id="35536-343">For the deployment, there are a set of shared resources (virtual network, storage account, availability sets) and an optional resource (jumpbox).</span></span> <span data-ttu-id="35536-344">Hay varias configuraciones conocidas representadas como tamaños de camiseta (pequeña, mediana, grande), pero cada una con un único tipo de nodo.</span><span class="sxs-lookup"><span data-stu-id="35536-344">There are multiple known configurations represented as t-shirt sizes (small, medium, large) but each with a single node type.</span></span> <span data-ttu-id="35536-345">También hay dos scripts de fin específico (instalación, configuración).</span><span class="sxs-lookup"><span data-stu-id="35536-345">There are also two purpose-specific scripts (installation, configuration).</span></span>

### <a name="creating-the-template-files"></a><span data-ttu-id="35536-346">Creación de los archivos de plantilla</span><span class="sxs-lookup"><span data-stu-id="35536-346">Creating the template files</span></span>
<span data-ttu-id="35536-347">Crea una plantilla principal denominada azuredeploy.json.</span><span class="sxs-lookup"><span data-stu-id="35536-347">You would create a Main Template named azuredeploy.json.</span></span>

<span data-ttu-id="35536-348">Crea una plantilla de recursos compartidos denominada resources.json.</span><span class="sxs-lookup"><span data-stu-id="35536-348">You create Shared Resources Template named shared-resources.json</span></span>

<span data-ttu-id="35536-349">Crea una plantilla de recursos opcionales para permitir la implementación de un Jumpbox, denominada jumpbox_enabled.json.</span><span class="sxs-lookup"><span data-stu-id="35536-349">You create an Optional Resource Template to enable the deployment of a jumpbox, named jumpbox_enabled.json</span></span>

<span data-ttu-id="35536-350">Redis usa un solo tipo de nodo, así que crea una sola plantilla de recursos de miembros denominada node-resources.json.</span><span class="sxs-lookup"><span data-stu-id="35536-350">Redis uses just a single node type, so you create a single Member Resource Template named node-resources.json.</span></span>

<span data-ttu-id="35536-351">Con Redis, desea instalar cada nodo individual y, a continuación, configurar el clúster.</span><span class="sxs-lookup"><span data-stu-id="35536-351">With Redis, you want to install each individual node, and then set up the cluster.</span></span>  <span data-ttu-id="35536-352">Dispone de scripts para la instalación y la configuración: redis-cluster-install.sh y redis-cluster-setup.sh.</span><span class="sxs-lookup"><span data-stu-id="35536-352">You have scripts to accommodate the installation and set up, redis-cluster-install.sh and redis-cluster-setup.sh.</span></span>

### <a name="linking-the-templates"></a><span data-ttu-id="35536-353">Vinculación de las plantillas</span><span class="sxs-lookup"><span data-stu-id="35536-353">Linking the templates</span></span>
<span data-ttu-id="35536-354">Mediante la vinculación de plantillas, la plantilla principal se vincula con la plantilla de recursos compartidos, que establece la red virtual.</span><span class="sxs-lookup"><span data-stu-id="35536-354">Using template linking, the main template links out to the shared resources template, which establishes the virtual network.</span></span>

<span data-ttu-id="35536-355">La lógica se agrega en la plantilla principal para permitir que los consumidores de la plantilla especifiquen si se debe implementar JumpBox.</span><span class="sxs-lookup"><span data-stu-id="35536-355">Logic is added within the main template to enable consumers of the template to specify whether a jumpbox should be deployed.</span></span> <span data-ttu-id="35536-356">Un valor *habilitado* para el parámetro *EnableJumpbox* indica que el cliente desea implementar un Jumpbox.</span><span class="sxs-lookup"><span data-stu-id="35536-356">An *enabled* value for the *EnableJumpbox* parameter indicates that the customer wants to deploy a jumpbox.</span></span> <span data-ttu-id="35536-357">Cuando se proporciona este valor, la plantilla concatena *_enabled* como sufijo de un nombre de plantilla base para la funcionalidad de JumpBox.</span><span class="sxs-lookup"><span data-stu-id="35536-357">When this value is provided, the template concatenates *_enabled* as a suffix to a base template name for the jumpbox capability.</span></span>

<span data-ttu-id="35536-358">La plantilla principal aplica el valor del parámetro *large* como sufijo a un nombre de plantilla base de tamaños de camiseta y luego usa ese valor en un vínculo de plantilla a *technology_on_os_large.json*.</span><span class="sxs-lookup"><span data-stu-id="35536-358">The main template applies the *large* parameter value as a suffix to a base template name for t-shirt sizes, and then uses that value in a template link out to *technology_on_os_large.json*.</span></span>

<span data-ttu-id="35536-359">La topología sería similar a esta ilustración.</span><span class="sxs-lookup"><span data-stu-id="35536-359">The topology would resemble this illustration.</span></span>

![Plantilla de Redis](./media/best-practices-resource-manager-design-templates/redis-template.png)

<span data-ttu-id="35536-361">**Estructura de plantilla para una plantilla de Redis**</span><span class="sxs-lookup"><span data-stu-id="35536-361">**Template structure for a Redis template**</span></span>

### <a name="configuring-state"></a><span data-ttu-id="35536-362">Estado de configuración</span><span class="sxs-lookup"><span data-stu-id="35536-362">Configuring state</span></span>
<span data-ttu-id="35536-363">Hay dos pasos para configurar el estado en los nodos del clúster, representados ambos por scripts de fin específico.</span><span class="sxs-lookup"><span data-stu-id="35536-363">For the nodes in the cluster, there are two steps to configuring the state, both represented by Purpose Specific Scripts.</span></span>  <span data-ttu-id="35536-364">"redis-cluster-install.sh" instala Redis y "redis-cluster-setup.sh" configura el clúster.</span><span class="sxs-lookup"><span data-stu-id="35536-364">"redis-cluster-install.sh" installs Redis and "redis-cluster-setup.sh" sets up the cluster.</span></span>

### <a name="supporting-different-size-deployments"></a><span data-ttu-id="35536-365">Soporte de implementaciones de diferentes tamaños</span><span class="sxs-lookup"><span data-stu-id="35536-365">Supporting Different Size Deployments</span></span>
<span data-ttu-id="35536-366">Dentro de las variables, la plantilla de tamaño de camiseta especifica el número de nodos de cada tipo que se implementa para el tamaño especificado (*grande*).</span><span class="sxs-lookup"><span data-stu-id="35536-366">Inside variables, the t-shirt size template specifies the number of nodes of each type to deploy for the specified size (*large*).</span></span> <span data-ttu-id="35536-367">A continuación, implementa ese número de instancias de máquina virtual mediante bucles de recursos, proporcionando nombres únicos a los recursos mediante la anexión de un nombre de nodo con un número de secuencia numérica de *copyIndex()*.</span><span class="sxs-lookup"><span data-stu-id="35536-367">It then deploys that number of VM instances using resource loops, providing unique names to resources by appending a node name with a numeric sequence number from *copyIndex()*.</span></span> <span data-ttu-id="35536-368">Lleva a cabo estos pasos para las máquinas virtuales de las zonas activa y semiactiva, según se define en la plantilla de nombre de camiseta.</span><span class="sxs-lookup"><span data-stu-id="35536-368">It does these steps for both hot and warm zone VMs, as defined in the t-shirt name template</span></span>

## <a name="decomposition-and-end-to-end-solution-scoped-templates"></a><span data-ttu-id="35536-369">Descomposición y plantillas con ámbito de solución completa</span><span class="sxs-lookup"><span data-stu-id="35536-369">Decomposition and end-to-end solution scoped templates</span></span>
<span data-ttu-id="35536-370">Una plantilla de solución con ámbito de solución completa se centra en proporcionar una solución completa.</span><span class="sxs-lookup"><span data-stu-id="35536-370">A solution template with an end-to-end solution scope is focused on delivering an end-to-end solution.</span></span>  <span data-ttu-id="35536-371">Normalmente, este enfoque es una composición de varias plantillas con ámbito de funcionalidad con recursos, lógica y estado adicionales.</span><span class="sxs-lookup"><span data-stu-id="35536-371">This approach is typically a composition of multiple capability-scoped templates with additional resources, logic, and state.</span></span>

<span data-ttu-id="35536-372">Como se resalta en la imagen siguiente, el mismo modelo usado para las plantillas con ámbito de funcionalidad se extiende a las plantillas con un ámbito de solución completa.</span><span class="sxs-lookup"><span data-stu-id="35536-372">As highlighted in the image below, the same model used for capability scoped templates is extended for templates with an End-to-End Solution Scope.</span></span>

<span data-ttu-id="35536-373">Las plantilla de recursos compartidos y las plantillas de recursos opcionales tienen la misma función que en los enfoques de plantillas con ámbito de capacidad y de funcionalidad, pero en el ámbito de la solución completa.</span><span class="sxs-lookup"><span data-stu-id="35536-373">A Shared Resources Template and Optional Resources Templates serve the same function as in the capacity and capability scoped template approaches, but are scoped for the end to end solution.</span></span>

<span data-ttu-id="35536-374">Como las plantillas con ámbito de solución completa también pueden tener normalmente tamaños de camiseta, la plantilla de recursos de configuración conocida refleja lo que se requiere para una configuración conocida dada de la solución.</span><span class="sxs-lookup"><span data-stu-id="35536-374">As end to end solution scoped templates also can typically have t-shirt sizes, the Known Configuration Resources template reflects what is required for a given known configuration of the solution.</span></span>

<span data-ttu-id="35536-375">La plantilla de recursos de configuración conocida se vincula a una o varias plantillas de solución con ámbito de funcionalidad que sean pertinentes para la solución completa y con las plantillas de recursos de miembros que sean necesarias para ella.</span><span class="sxs-lookup"><span data-stu-id="35536-375">The Known Configuration Resources Template links to one or more capability scoped solution templates that are relevant to the end to end solution as well as the Member Resource Templates that are required for the end to end solution.</span></span>

<span data-ttu-id="35536-376">Como el tamaño de camiseta de la solución puede ser diferente al de la plantilla individual con ámbito de funcionalidad, se usan variables dentro de la Plantilla de recursos de configuración conocida para proporcionar los valores adecuados para las plantillas de solución con ámbito de funcionalidad de nivel inferior a fin de implementar el tamaño de camiseta adecuado.</span><span class="sxs-lookup"><span data-stu-id="35536-376">As the t-shirt size of the solution may be different than the individual capability-scoped template, variables within the Known Configuration Resources Template are used to provide the appropriate values for downstream capability scoped solution templates to deploy the appropriate t-shirt size.</span></span>

![Completa](./media/best-practices-resource-manager-design-templates/end-to-end.png)

<span data-ttu-id="35536-378">**El modelo usado para las plantillas de solución con ámbito de capacidad o de funcionalidad se puede extender fácilmente a los ámbitos de plantilla de solución completa**</span><span class="sxs-lookup"><span data-stu-id="35536-378">**The model used for capacity or capability scoped solution templates can be readily extended for end to end solution template scopes**</span></span>

## <a name="preparing-templates-for-the-marketplace"></a><span data-ttu-id="35536-379">Preparación de las plantillas para Marketplace</span><span class="sxs-lookup"><span data-stu-id="35536-379">Preparing templates for the Marketplace</span></span>
<span data-ttu-id="35536-380">El enfoque anterior se adapta fácilmente a escenarios donde las empresas, los integradores de sistemas y los proveedores de soluciones en la nube desean implementar las plantillas ellos mismos o permitir que sus clientes las implementen por su cuenta.</span><span class="sxs-lookup"><span data-stu-id="35536-380">The preceding approach readily accommodates scenarios where Enterprises, SIs, and CSVs want to either deploy the templates themselves or enable their customers to deploy on their own.</span></span>

<span data-ttu-id="35536-381">Otro escenario deseado es la implementación de una plantilla mediante Marketplace.</span><span class="sxs-lookup"><span data-stu-id="35536-381">Another desired scenario is deploying a template via the marketplace.</span></span>  <span data-ttu-id="35536-382">Este enfoque de descomposición funciona también para Marketplace, con algunos cambios menores.</span><span class="sxs-lookup"><span data-stu-id="35536-382">This decomposition approach works for the marketplace as well, with some minor changes.</span></span>

<span data-ttu-id="35536-383">Como se mencionó anteriormente, las plantillas se pueden usar para ofrecer distintos tipos de implementación para la venta en Marketplace.</span><span class="sxs-lookup"><span data-stu-id="35536-383">As mentioned previously, templates can be used to offer distinct deployment types for sale in the marketplace.</span></span> <span data-ttu-id="35536-384">Algunos tipos de implementaciones diferentes pueden ser tamaños de camiseta (pequeña, mediana, grande), tipo de producto/público (comunidad, desarrollador, empresa) o tipo de característica (básica, alta disponibilidad).</span><span class="sxs-lookup"><span data-stu-id="35536-384">Distinct deployment types may be t-shirt sizes (small, medium, large), product/audience type (community, developer, enterprise), or feature type (basic, high availability).</span></span>

<span data-ttu-id="35536-385">Como se muestra a continuación, las plantillas con ámbito de funcionalidad o de solución completa se pueden usar fácilmente para mostrar las diferentes configuraciones conocidas en Marketplace.</span><span class="sxs-lookup"><span data-stu-id="35536-385">As shown below, the existing end to end solution or capability scoped templates can be readily utilized to list the different known configurations in the marketplace.</span></span>

<span data-ttu-id="35536-386">Primero se modifican los parámetros de la plantilla principal para quitar el parámetro de entrada denominado tshirtSize.</span><span class="sxs-lookup"><span data-stu-id="35536-386">The parameters to the main template are first modified to remove the inbound parameter named tshirtSize.</span></span>

<span data-ttu-id="35536-387">Aunque los distintos tipos de implementaciones se asignan a la plantilla de recursos de configuración conocida, también necesitan los recursos comunes y la configuración encontrada en la plantilla de recursos compartidos y, posiblemente, los de las plantillas de recursos opcionales.</span><span class="sxs-lookup"><span data-stu-id="35536-387">While the distinct deployment types map to the Known Configuration Resources Template, they also need the common resources and configuration found in the Shared Resources Template and potentially those in Optional Resource Templates.</span></span>

<span data-ttu-id="35536-388">Si desea publicar la plantilla en Marketplace, establezca distintas copias de la plantilla principal que reemplace el parámetro de entrada anteriormente disponible de tshirtSize por una variable incrustada dentro de la plantilla.</span><span class="sxs-lookup"><span data-stu-id="35536-388">If you want to publish your template to the marketplace, you establish distinct copies of your Main template that replaces the previously available inbound parameter of tshirtSize to a variable embedded within the template.</span></span>

![Marketplace](./media/best-practices-resource-manager-design-templates/marketplace.png)

<span data-ttu-id="35536-390">**Adaptación de una plantilla con ámbito de solución para Marketplace**</span><span class="sxs-lookup"><span data-stu-id="35536-390">**Adapting a solution scoped template for the marketplace**</span></span>

## <a name="next-steps"></a><span data-ttu-id="35536-391">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="35536-391">Next steps</span></span>
* <span data-ttu-id="35536-392">Para obtener información sobre cómo compartir el estado dentro y fuera de las plantillas, consulte [Uso compartido del estado en las plantillas del Administrador de recursos de Azure](best-practices-resource-manager-state.md).</span><span class="sxs-lookup"><span data-stu-id="35536-392">To learn about sharing state into and out of templates, see [Sharing state in Azure Resource Manager templates](best-practices-resource-manager-state.md).</span></span>
* <span data-ttu-id="35536-393">Para obtener instrucciones sobre cómo las empresas pueden utilizar Resource Manager para administrar eficazmente las suscripciones, vea [Scaffold empresarial de Azure: Gobierno de suscripción prescriptivo](resource-manager-subscription-governance.md).</span><span class="sxs-lookup"><span data-stu-id="35536-393">For guidance on how enterprises can use Resource Manager to effectively manage subscriptions, see [Azure enterprise scaffold - prescriptive subscription governance](resource-manager-subscription-governance.md).</span></span>


---
title: "Enrutamiento asimétrico | Microsoft Docs"
description: "Este artículo le guía a través de los problemas a los que se puede enfrentar un cliente con enrutamiento asimétrico en una red que tiene varios vínculos a un destino."
documentationcenter: na
services: expressroute
author: osamazia
manager: carmonm
editor: 
ms.assetid: a754bff9-95c9-44b5-9796-377fc21e8322
ms.service: expressroute
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/10/2016
ms.author: osamam
ms.openlocfilehash: 8568c13d2834a0643e15ab1814a35c92123837d1
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="asymmetric-routing-with-multiple-network-paths"></a><span data-ttu-id="c40e5-103">Enrutamiento asimétrico con varias rutas de acceso de red</span><span class="sxs-lookup"><span data-stu-id="c40e5-103">Asymmetric routing with multiple network paths</span></span>
<span data-ttu-id="c40e5-104">En este artículo se explica cómo el tráfico de red de reenvío y de retorno puede tomar distintas rutas cuando hay varias rutas de acceso disponibles entre el origen y el destino de la red.</span><span class="sxs-lookup"><span data-stu-id="c40e5-104">This article explains how forward and return network traffic might take different routes when multiple paths are available between network source and destination.</span></span>

<span data-ttu-id="c40e5-105">Para comprender el enrutamiento asimétrico, es importante entender dos conceptos.</span><span class="sxs-lookup"><span data-stu-id="c40e5-105">It's important to understand two concepts to understand asymmetric routing.</span></span> <span data-ttu-id="c40e5-106">Uno es el efecto que produce tener varias rutas de acceso de red.</span><span class="sxs-lookup"><span data-stu-id="c40e5-106">One is the effect of multiple network paths.</span></span> <span data-ttu-id="c40e5-107">El otro es ver cómo ciertos dispositivos, como un firewall, mantienen el estado.</span><span class="sxs-lookup"><span data-stu-id="c40e5-107">The other is how devices, like a firewall, keep state.</span></span> <span data-ttu-id="c40e5-108">Estos tipos de dispositivos se denominan dispositivos con estado.</span><span class="sxs-lookup"><span data-stu-id="c40e5-108">These types of devices are called stateful devices.</span></span> <span data-ttu-id="c40e5-109">Una combinación de estos dos factores permite crear escenarios en los que un dispositivo con estado interrumpe el tráfico de red porque no detecta que el tráfico se origina con el dispositivo mismo.</span><span class="sxs-lookup"><span data-stu-id="c40e5-109">A combination of these two factors creates scenarios in which network traffic is dropped by a stateful device because the stateful device didn't detect that traffic originated with the device itself.</span></span>

## <a name="multiple-network-paths"></a><span data-ttu-id="c40e5-110">Varias rutas de acceso de red</span><span class="sxs-lookup"><span data-stu-id="c40e5-110">Multiple network paths</span></span>
<span data-ttu-id="c40e5-111">Cuando una red empresarial solo tiene un vínculo a Internet a través de su proveedor de servicios de Internet, todo el tráfico hacia Internet y desde él viaja por la misma ruta de acceso.</span><span class="sxs-lookup"><span data-stu-id="c40e5-111">When an enterprise network has only one link to the Internet through their Internet service provider, all traffic to and from the Internet travels the same path.</span></span> <span data-ttu-id="c40e5-112">A menudo, las empresas adquieren varios circuitos, como rutas de acceso redundantes, para mejorar el tiempo de actividad de la red.</span><span class="sxs-lookup"><span data-stu-id="c40e5-112">Often, companies purchase multiple circuits, as redundant paths, to improve network uptime.</span></span> <span data-ttu-id="c40e5-113">Cuando esto sucede, es posible que el tráfico que sale de la red, hacia Internet, vaya a través de un vínculo mientras que el tráfico de retorno viene a través de un vínculo diferente.</span><span class="sxs-lookup"><span data-stu-id="c40e5-113">When this happens, it's possible that traffic that goes outside of the network, to the Internet, goes through one link, and the return traffic goes through a different link.</span></span> <span data-ttu-id="c40e5-114">Normalmente, esto se conoce como enrutamiento asimétrico.</span><span class="sxs-lookup"><span data-stu-id="c40e5-114">This is commonly known as asymmetric routing.</span></span> <span data-ttu-id="c40e5-115">En el enrutamiento asimétrico, el tráfico de red de retorno toma una ruta de acceso distinta a la del flujo original.</span><span class="sxs-lookup"><span data-stu-id="c40e5-115">In asymmetric routing, reverse network traffic takes a different path from the original flow.</span></span>

![Red con varias rutas de acceso](./media/expressroute-asymmetric-routing/AsymmetricRouting3.png)

<span data-ttu-id="c40e5-117">Aunque se produce principalmente en Internet, el enrutamiento asimétrico también se aplica a otras combinaciones de varias rutas de acceso.</span><span class="sxs-lookup"><span data-stu-id="c40e5-117">Although it primarily occurs on the Internet, asymmetric routing also applies to other combinations of multiple paths.</span></span> <span data-ttu-id="c40e5-118">Se aplica, por ejemplo, a una ruta de acceso de Internet y a una ruta de acceso privada que van al mismo destino, o a varias rutas de acceso privadas que van al mismo destino.</span><span class="sxs-lookup"><span data-stu-id="c40e5-118">It applies, for example, both to an Internet path and a private path that go to the same destination, and to multiple private paths that go to the same destination.</span></span>

<span data-ttu-id="c40e5-119">Cada enrutador del recorrido, desde el origen hasta el destino, calcula la mejor ruta para llegar al destino.</span><span class="sxs-lookup"><span data-stu-id="c40e5-119">Each router along the way, from source to destination, computes the best path to reach a destination.</span></span> <span data-ttu-id="c40e5-120">La determinación por parte del enrutador de la mejor ruta de acceso posible se basa en dos factores principales:</span><span class="sxs-lookup"><span data-stu-id="c40e5-120">The router's determination of best possible path is based on two main factors:</span></span>

* <span data-ttu-id="c40e5-121">El enrutamiento entre redes externas se basa en un protocolo de enrutamiento llamado Border Gateway Protocol (BGP).</span><span class="sxs-lookup"><span data-stu-id="c40e5-121">Routing between external networks is based on a routing protocol, Border Gateway Protocol (BGP).</span></span> <span data-ttu-id="c40e5-122">BGP toma anuncios de vecinos, ejecuta una serie de pasos con ellos para determinar la mejor ruta de acceso al destino deseado.</span><span class="sxs-lookup"><span data-stu-id="c40e5-122">BGP takes advertisements from neighbors and runs them through a series of steps to determine the best path to the intended destination.</span></span> <span data-ttu-id="c40e5-123">Y almacena la mejor ruta de acceso en su tabla de enrutamiento.</span><span class="sxs-lookup"><span data-stu-id="c40e5-123">It stores the best path in its routing table.</span></span>
* <span data-ttu-id="c40e5-124">La longitud de una máscara de subred asociada con una ruta influye en las rutas de acceso de los enrutamientos.</span><span class="sxs-lookup"><span data-stu-id="c40e5-124">The length of a subnet mask associated with a route influences routing paths.</span></span> <span data-ttu-id="c40e5-125">Si un enrutador recibe varios anuncios para la misma dirección IP pero con diferentes máscaras de subred, el enrutador prefiere el anuncio con la máscara de subred más larga porque se considera una ruta más específica.</span><span class="sxs-lookup"><span data-stu-id="c40e5-125">If a router receives multiple advertisements for the same IP address but with different subnet masks, the router prefers the advertisement with a longer subnet mask because it's considered a more specific route.</span></span>

## <a name="stateful-devices"></a><span data-ttu-id="c40e5-126">Dispositivos con estado</span><span class="sxs-lookup"><span data-stu-id="c40e5-126">Stateful devices</span></span>
<span data-ttu-id="c40e5-127">Los enrutadores miran el encabezado IP de un paquete para fines de enrutamiento.</span><span class="sxs-lookup"><span data-stu-id="c40e5-127">Routers look at the IP header of a packet for routing purposes.</span></span> <span data-ttu-id="c40e5-128">Algunos dispositivos miran de forma aún más profunda dentro del paquete.</span><span class="sxs-lookup"><span data-stu-id="c40e5-128">Some devices look even deeper inside the packet.</span></span> <span data-ttu-id="c40e5-129">Normalmente, estos dispositivos miran los encabezados de la capa (4) (Protocolo de control de transmisión o TCP, o Protocolo de datagramas de usuario o UDP) o incluso de la capa 7 (capa de aplicación).</span><span class="sxs-lookup"><span data-stu-id="c40e5-129">Typically, these devices look at Layer4 (Transmission Control Protocol, or TCP; or User Datagram Protocol, or UDP), or even Layer7 (Application Layer) headers.</span></span> <span data-ttu-id="c40e5-130">Estas variantes de dispositivos son dispositivos de seguridad o dispositivos de optimización de ancho de banda.</span><span class="sxs-lookup"><span data-stu-id="c40e5-130">These kinds of devices are either security devices or bandwidth-optimization devices.</span></span> 

<span data-ttu-id="c40e5-131">Un firewall es un ejemplo común de dispositivo con estado.</span><span class="sxs-lookup"><span data-stu-id="c40e5-131">A firewall is a common example of a stateful device.</span></span> <span data-ttu-id="c40e5-132">Un firewall permite o rechaza que un paquete pase a través de sus interfaces basándose en diversos campos, como protocolo, puerto TCP o UDP y encabezados de dirección URL.</span><span class="sxs-lookup"><span data-stu-id="c40e5-132">A firewall allows or denies a packet to pass through its interfaces based on various fields such as protocol, TCP/UDP port, and URL headers.</span></span> <span data-ttu-id="c40e5-133">Este nivel de inspección de paquete coloca una pesada carga de procesamiento en el dispositivo.</span><span class="sxs-lookup"><span data-stu-id="c40e5-133">This level of packet inspection puts a heavy processing load on the device.</span></span> <span data-ttu-id="c40e5-134">Para mejorar el rendimiento, el firewall inspecciona el primer paquete de un flujo.</span><span class="sxs-lookup"><span data-stu-id="c40e5-134">To improve performance, the firewall inspects the first packet of a flow.</span></span> <span data-ttu-id="c40e5-135">Si se permite que el paquete continúe, la información de flujo se mantiene en su tabla de estado.</span><span class="sxs-lookup"><span data-stu-id="c40e5-135">If it allows the packet to proceed, it keeps the flow information in its state table.</span></span> <span data-ttu-id="c40e5-136">Todos los paquetes posteriores relacionados con este flujo se permiten en función de la determinación inicial.</span><span class="sxs-lookup"><span data-stu-id="c40e5-136">All subsequent packets related to this flow are allowed based on the initial determination.</span></span> <span data-ttu-id="c40e5-137">Un paquete que forma parte de un flujo existente puede llegar al firewall.</span><span class="sxs-lookup"><span data-stu-id="c40e5-137">A packet that is part of an existing flow might arrive at the firewall.</span></span> <span data-ttu-id="c40e5-138">Si el firewall no tiene una información de estado anterior del paquete, lo descartará.</span><span class="sxs-lookup"><span data-stu-id="c40e5-138">If the firewall has no prior state information about it, the firewall drops the packet.</span></span>

## <a name="asymmetric-routing-with-expressroute"></a><span data-ttu-id="c40e5-139">Enrutamiento asimétrico con ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="c40e5-139">Asymmetric routing with ExpressRoute</span></span>
<span data-ttu-id="c40e5-140">Cuando se conecta a Microsoft a través de Azure ExpressRoute, se producen los siguientes cambios en la red:</span><span class="sxs-lookup"><span data-stu-id="c40e5-140">When you connect to Microsoft through Azure ExpressRoute, your network changes like this:</span></span>

* <span data-ttu-id="c40e5-141">Tiene varios vínculos con Microsoft.</span><span class="sxs-lookup"><span data-stu-id="c40e5-141">You have multiple links to Microsoft.</span></span> <span data-ttu-id="c40e5-142">Un vínculo es la conexión existente de Internet y el otro se realiza a través de ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c40e5-142">One link is your existing Internet connection, and the other is via ExpressRoute.</span></span> <span data-ttu-id="c40e5-143">Una parte del tráfico a Microsoft puede ir a través de Internet pero volver a través de ExpressRoute o viceversa.</span><span class="sxs-lookup"><span data-stu-id="c40e5-143">Some traffic to Microsoft might go through the Internet but come back via ExpressRoute, or vice versa.</span></span>
* <span data-ttu-id="c40e5-144">Recibe direcciones IP más específicas a través de ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c40e5-144">You receive more specific IP addresses via ExpressRoute.</span></span> <span data-ttu-id="c40e5-145">Por lo tanto, para el tráfico de la red a Microsoft de los servicios ofrecidos a través de ExpressRoute, los enrutadores siempre darán preferencia a ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c40e5-145">So, for traffic from your network to Microsoft for services offered via ExpressRoute, routers always prefer ExpressRoute.</span></span>

<span data-ttu-id="c40e5-146">Para comprender el efecto que estos dos cambios tienen en una red, veamos algunos escenarios.</span><span class="sxs-lookup"><span data-stu-id="c40e5-146">To understand the effect these two changes have on a network, let’s consider some scenarios.</span></span> <span data-ttu-id="c40e5-147">Por ejemplo, supongamos que solo tiene un circuito a Internet y consume todos los servicios de Microsoft a través de Internet.</span><span class="sxs-lookup"><span data-stu-id="c40e5-147">As an example, you have only one circuit to the Internet and you consume all Microsoft services via the Internet.</span></span> <span data-ttu-id="c40e5-148">El tráfico de la red a Microsoft y el de vuelta recorre el mismo vínculo de Internet y pasa a través del firewall.</span><span class="sxs-lookup"><span data-stu-id="c40e5-148">The traffic from your network to Microsoft and back traverses the same Internet link and passes through the firewall.</span></span> <span data-ttu-id="c40e5-149">El firewall registra el flujo según ve el primer paquete y los paquetes de retorno se permiten ya que el flujo existe en la tabla de estado.</span><span class="sxs-lookup"><span data-stu-id="c40e5-149">The firewall records the flow as it sees the first packet and return packets are allowed because the flow exists in the state table.</span></span>

![Enrutamiento asimétrico con ExpressRoute](./media/expressroute-asymmetric-routing/AsymmetricRouting1.png)

<span data-ttu-id="c40e5-151">A continuación, ya puede activar ExpressRoute y consumir los servicios ofrecidos por Microsoft a través de ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c40e5-151">Then, you turn on ExpressRoute and consume services offered by Microsoft over ExpressRoute.</span></span> <span data-ttu-id="c40e5-152">Todos los demás servicios de Microsoft se consumen a través de Internet.</span><span class="sxs-lookup"><span data-stu-id="c40e5-152">All other services from Microsoft are consumed over the Internet.</span></span> <span data-ttu-id="c40e5-153">Implemente un servidor de firewall independiente en su perímetro que se conecte a ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c40e5-153">You deploy a separate firewall at your edge that is connected to ExpressRoute.</span></span> <span data-ttu-id="c40e5-154">Microsoft anuncia prefijos más específicos en la red a través de ExpressRoute para servicios específicos.</span><span class="sxs-lookup"><span data-stu-id="c40e5-154">Microsoft advertises more specific prefixes to your network over ExpressRoute for specific services.</span></span> <span data-ttu-id="c40e5-155">La infraestructura de enrutamiento elige ExpressRoute como ruta de acceso preferida para estos prefijos.</span><span class="sxs-lookup"><span data-stu-id="c40e5-155">Your routing infrastructure chooses ExpressRoute as the preferred path for those prefixes.</span></span> <span data-ttu-id="c40e5-156">Si no va a anunciar direcciones IP públicas en Microsoft a través de ExpressRoute, Microsoft se comunicará con las direcciones IP públicas a través de Internet.</span><span class="sxs-lookup"><span data-stu-id="c40e5-156">If you are not advertising your public IP addresses to Microsoft over ExpressRoute, Microsoft communicates with your public IP addresses via the Internet.</span></span> <span data-ttu-id="c40e5-157">Por lo tanto, al reenviar el tráfico de la red a Microsoft, se usará ExpressRoute mientras que el tráfico inverso desde Microsoft utilizará Internet.</span><span class="sxs-lookup"><span data-stu-id="c40e5-157">Forward traffic from your network to Microsoft uses ExpressRoute, and reverse traffic from Microsoft uses the Internet.</span></span> <span data-ttu-id="c40e5-158">Si el firewall en el perímetro ve un paquete de respuesta de un flujo que no se encuentra en la tabla de estado, descartará el tráfico de retorno.</span><span class="sxs-lookup"><span data-stu-id="c40e5-158">When the firewall at the edge sees a response packet for a flow that it does not find in the state table, it drops the return traffic.</span></span>

<span data-ttu-id="c40e5-159">Si decide utilizar el mismo grupo de traducción de direcciones de red (NAT) para ExpressRoute e Internet, verá problemas similares con los clientes en las direcciones IP privadas de la red.</span><span class="sxs-lookup"><span data-stu-id="c40e5-159">If you choose to use the same network address translation (NAT) pool for ExpressRoute and for the Internet, you'll see similar issues with the clients in your network on private IP addresses.</span></span> <span data-ttu-id="c40e5-160">La solicitud de servicios como Windows Update pasará a través de Internet ya que las direcciones IP de estos servicios no se anuncian a través de ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c40e5-160">Requests for services like Windows Update go via the Internet because IP addresses for these services are not advertised via ExpressRoute.</span></span> <span data-ttu-id="c40e5-161">Sin embargo, el tráfico de retorno volverá a través de ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c40e5-161">However, the return traffic comes back via ExpressRoute.</span></span> <span data-ttu-id="c40e5-162">Si Microsoft recibe una dirección IP con la misma máscara de subred de Internet y ExpressRoute, dará preferencia a ExpressRoute en lugar de a Internet.</span><span class="sxs-lookup"><span data-stu-id="c40e5-162">If Microsoft receives an IP address with the same subnet mask from the Internet and ExpressRoute, it prefers ExpressRoute over the Internet.</span></span> <span data-ttu-id="c40e5-163">Si un firewall u otro dispositivo con estado en el perímetro de la red, orientado a ExpressRoute, no tiene ninguna información previa sobre el flujo, descartará los paquetes que pertenecen a ese flujo.</span><span class="sxs-lookup"><span data-stu-id="c40e5-163">If a firewall or another stateful device that is on your network edge and facing ExpressRoute has no prior information about the flow, it drops the packets that belong to that flow.</span></span>

## <a name="asymmetric-routing-solutions"></a><span data-ttu-id="c40e5-164">Soluciones de enrutamiento asimétrico</span><span class="sxs-lookup"><span data-stu-id="c40e5-164">Asymmetric routing solutions</span></span>
<span data-ttu-id="c40e5-165">Tiene dos opciones principales para solucionar el problema del enrutamiento asimétrico.</span><span class="sxs-lookup"><span data-stu-id="c40e5-165">You have two main options to solve the problem of asymmetric routing.</span></span> <span data-ttu-id="c40e5-166">Una es a través del enrutamiento y la otra es mediante el uso de NAT basada en origen (SNAT).</span><span class="sxs-lookup"><span data-stu-id="c40e5-166">One is through routing, and the other is by using source-based NAT (SNAT).</span></span>

### <a name="routing"></a><span data-ttu-id="c40e5-167">Enrutamiento</span><span class="sxs-lookup"><span data-stu-id="c40e5-167">Routing</span></span>
<span data-ttu-id="c40e5-168">Asegúrese de que las direcciones IP públicas se anuncian en los vínculos de red de área extensa (WAN) adecuados.</span><span class="sxs-lookup"><span data-stu-id="c40e5-168">Ensure that your public IP addresses are advertised to appropriate wide area network (WAN) links.</span></span> <span data-ttu-id="c40e5-169">Por ejemplo, si desea utilizar Internet para el tráfico de autenticación y ExpressRoute para el tráfico de correo, no debe anunciar las direcciones IP públicas de los Servicios de federación de Active Directory (AD FS) en ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c40e5-169">For example, if you want to use the Internet for authentication traffic and ExpressRoute for your mail traffic, you should not advertise your Active Directory Federation Services (AD FS) public IP addresses over ExpressRoute.</span></span> <span data-ttu-id="c40e5-170">De forma similar, asegúrese de no exponer un servidor local de AD FS a direcciones IP que el enrutador reciba a través de ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c40e5-170">Similarly, be sure not to expose an on-premises AD FS server to IP addresses that the router receives over ExpressRoute.</span></span> <span data-ttu-id="c40e5-171">Las rutas recibidas a través de ExpressRoute son más específicas, por lo que ExpressRoute será la ruta preferida para el tráfico de autenticación a Microsoft.</span><span class="sxs-lookup"><span data-stu-id="c40e5-171">Routes received over ExpressRoute are more specific so they make ExpressRoute the preferred path for authentication traffic to Microsoft.</span></span> <span data-ttu-id="c40e5-172">Esto provocará un enrutamiento asimétrico.</span><span class="sxs-lookup"><span data-stu-id="c40e5-172">This causes asymmetric routing.</span></span>

<span data-ttu-id="c40e5-173">Si desea usar ExpressRoute para la autenticación, asegúrese de que va a anunciar direcciones IP públicas de AD FS a través de ExpressRoute sin NAT.</span><span class="sxs-lookup"><span data-stu-id="c40e5-173">If you want to use ExpressRoute for authentication, make sure that you are advertising AD FS public IP addresses over ExpressRoute without NAT.</span></span> <span data-ttu-id="c40e5-174">De este modo, el tráfico que se origina en Microsoft y se dirige a un servidor local de AD FS se produce a través de ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c40e5-174">This way, traffic that originates from Microsoft and goes to an on-premises AD FS server goes over ExpressRoute.</span></span> <span data-ttu-id="c40e5-175">El tráfico de retorno del cliente a Microsoft utiliza ExpressRoute porque es la ruta preferida en lugar de Internet.</span><span class="sxs-lookup"><span data-stu-id="c40e5-175">Return traffic from customer to Microsoft uses ExpressRoute because it's the preferred route over the Internet.</span></span>

### <a name="source-based-nat"></a><span data-ttu-id="c40e5-176">NAT basada en origen</span><span class="sxs-lookup"><span data-stu-id="c40e5-176">Source-based NAT</span></span>
<span data-ttu-id="c40e5-177">Otra manera de resolver los problemas de enrutamiento asimétrico es mediante SNAT.</span><span class="sxs-lookup"><span data-stu-id="c40e5-177">Another way of solving asymmetric routing issues is by using SNAT.</span></span> <span data-ttu-id="c40e5-178">Por ejemplo, no ha anunciado la dirección IP pública de un servidor local de Protocolo simple de transferencia de correo (SMTP) en ExpressRoute ya que pretende utilizar Internet para este tipo de comunicación.</span><span class="sxs-lookup"><span data-stu-id="c40e5-178">For example, you have not advertised the public IP address of an on-premises Simple Mail Transfer Protocol (SMTP) server over ExpressRoute because you intend to use the Internet for this type of communication.</span></span> <span data-ttu-id="c40e5-179">Una solicitud que se origina con Microsoft y va, a continuación, al servidor SMTP local recorre Internet.</span><span class="sxs-lookup"><span data-stu-id="c40e5-179">A request that originates with Microsoft and then goes to your on-premises SMTP server traverses the Internet.</span></span> <span data-ttu-id="c40e5-180">Realice una SNAT con la solicitud entrante a una dirección IP interna.</span><span class="sxs-lookup"><span data-stu-id="c40e5-180">You SNAT the incoming request to an internal IP address.</span></span> <span data-ttu-id="c40e5-181">El tráfico inverso desde el servidor SMTP va al firewall perimetral (que utiliza para NAT) en lugar de a través de ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c40e5-181">Reverse traffic from the SMTP server goes to the edge firewall (which you use for NAT) instead of through ExpressRoute.</span></span> <span data-ttu-id="c40e5-182">El tráfico de retorno vuelve a través de Internet.</span><span class="sxs-lookup"><span data-stu-id="c40e5-182">The return traffic goes back via the Internet.</span></span>

![Configuración de red con NAT basada en origen](./media/expressroute-asymmetric-routing/AsymmetricRouting2.png)

## <a name="asymmetric-routing-detection"></a><span data-ttu-id="c40e5-184">Detección de enrutamiento asimétrico</span><span class="sxs-lookup"><span data-stu-id="c40e5-184">Asymmetric routing detection</span></span>
<span data-ttu-id="c40e5-185">Traceroute es la mejor manera de asegurarse de que el tráfico de la red recorra la ruta de acceso prevista.</span><span class="sxs-lookup"><span data-stu-id="c40e5-185">Traceroute is the best way to make sure that your network traffic is traversing the expected path.</span></span> <span data-ttu-id="c40e5-186">Si espera que el tráfico del servidor SMTP local a Microsoft tome la ruta de acceso de Internet, realice el traceroute previsto del servidor SMTP a Office 365.</span><span class="sxs-lookup"><span data-stu-id="c40e5-186">If you expect traffic from your on-premises SMTP server to Microsoft to take the Internet path, the expected traceroute is from the SMTP server to Office 365.</span></span> <span data-ttu-id="c40e5-187">El resultado validará que el tráfico sale de hecho de la red hacia Internet y no hacia ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c40e5-187">The result validates that traffic is indeed leaving your network toward the Internet and not toward ExpressRoute.</span></span>


---
title: "Optimización del enrutamiento de ExpressRoute: Azure | Microsoft Docs"
description: "Esta página proporciona detalles sobre cómo toooptimize enrutamiento cuando haya más de un ExpressRoute circuitos que establecer una conexión entre Microsoft y la red corp."
documentationcenter: na
services: expressroute
author: charwen
manager: carmonm
editor: 
ms.assetid: fca53249-d9c3-4cff-8916-f8749386a4dd
ms.service: expressroute
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/06/2017
ms.author: charwen
ms.openlocfilehash: ebcfb638f67a9ac78c3e476668bfd0bb0ffb9985
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="optimize-expressroute-routing"></a><span data-ttu-id="499e7-103">Optimización de enrutamiento de ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="499e7-103">Optimize ExpressRoute Routing</span></span>
<span data-ttu-id="499e7-104">Si tiene varios circuitos ExpressRoute, tener más de una ruta de acceso tooconnect tooMicrosoft.</span><span class="sxs-lookup"><span data-stu-id="499e7-104">When you have multiple ExpressRoute circuits, you have more than one path tooconnect tooMicrosoft.</span></span> <span data-ttu-id="499e7-105">Como resultado, enrutamiento poco óptimos puede ocurrir: es decir, el tráfico puede tardar un tooreach de ruta de acceso más Microsoft y Microsoft tooyour network.</span><span class="sxs-lookup"><span data-stu-id="499e7-105">As a result, suboptimal routing may happen - that is, your traffic may take a longer path tooreach Microsoft, and Microsoft tooyour network.</span></span> <span data-ttu-id="499e7-106">Hola más Hola ruta de red, una latencia Hola Hola superior.</span><span class="sxs-lookup"><span data-stu-id="499e7-106">hello longer hello network path, hello higher hello latency.</span></span> <span data-ttu-id="499e7-107">La latencia tiene un efecto directo en la experiencia del usuario y en el rendimiento de las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="499e7-107">Latency has direct impact on application performance and user experience.</span></span> <span data-ttu-id="499e7-108">En este artículo se muestran este problema y se explica cómo toooptimize ruta utilizando Hola tecnologías de enrutamiento estándares.</span><span class="sxs-lookup"><span data-stu-id="499e7-108">This article will illustrate this problem and explain how toooptimize routing using hello standard routing technologies.</span></span>

## <a name="suboptimal-routing-from-customer-toomicrosoft"></a><span data-ttu-id="499e7-109">Enrutamiento de tooMicrosoft de cliente no son óptimos</span><span class="sxs-lookup"><span data-stu-id="499e7-109">Suboptimal routing from customer tooMicrosoft</span></span>
<span data-ttu-id="499e7-110">¡Eche un vistazo cerrar al problema de enrutamiento de Hola por un ejemplo.</span><span class="sxs-lookup"><span data-stu-id="499e7-110">Let's take a close look at hello routing problem by an example.</span></span> <span data-ttu-id="499e7-111">Imagine que tiene dos oficinas en hello EE. UU., uno en Los Ángeles y uno en Nueva York.</span><span class="sxs-lookup"><span data-stu-id="499e7-111">Imagine you have two offices in hello US, one in Los Angeles and one in New York.</span></span> <span data-ttu-id="499e7-112">Las oficinas están conectadas a una red de área extensa (WAN), que puede ser su propia red troncal o la VPN de la dirección IP del proveedor de servicios.</span><span class="sxs-lookup"><span data-stu-id="499e7-112">Your offices are connected on a Wide Area Network (WAN), which can be either your own backbone network or your service provider's IP VPN.</span></span> <span data-ttu-id="499e7-113">Tiene dos circuitos ExpressRoute, uno en US West y otro en este de EE., que también están conectadas en hello WAN.</span><span class="sxs-lookup"><span data-stu-id="499e7-113">You have two ExpressRoute circuits, one in US West and one in US East, that are also connected on hello WAN.</span></span> <span data-ttu-id="499e7-114">Obviamente, tiene dos rutas de acceso tooconnect toohello de Microsoft network.</span><span class="sxs-lookup"><span data-stu-id="499e7-114">Obviously, you have two paths tooconnect toohello Microsoft network.</span></span> <span data-ttu-id="499e7-115">Ahora supongamos que tiene una implementación de Azure (por ejemplo, Azure App Service) en el Oeste de EE. UU. y en el Este de EE. UU.</span><span class="sxs-lookup"><span data-stu-id="499e7-115">Now imagine you have Azure deployment (for example, Azure App Service) in both US West and US East.</span></span> <span data-ttu-id="499e7-116">Su intención es tooconnect los usuarios en Los Ángeles tooAzure US West y los usuarios en Nueva York tooAzure este de EE. Dado que el Administrador de servicio anuncia que los usuarios en cada office access Hola cercano servicios de Azure para un rendimiento óptimo.</span><span class="sxs-lookup"><span data-stu-id="499e7-116">Your intention is tooconnect your users in Los Angeles tooAzure US West and your users in New York tooAzure US East because your service admin advertises that users in each office access hello nearby Azure services for optimal experiences.</span></span> <span data-ttu-id="499e7-117">Por desgracia, plan de hello resuelve bien para los usuarios de hello costa este, pero no para los usuarios de hello costa oeste.</span><span class="sxs-lookup"><span data-stu-id="499e7-117">Unfortunately, hello plan works out well for hello east coast users but not for hello west coast users.</span></span> <span data-ttu-id="499e7-118">causa de Hola de problema de hello es siguiente Hola.</span><span class="sxs-lookup"><span data-stu-id="499e7-118">hello cause of hello problem is hello following.</span></span> <span data-ttu-id="499e7-119">En cada circuito ExpressRoute, se anuncian tooyou tanto prefijo hello en Azure este de EE. (23.100.0.0/16) como prefijo de hello en Azure US West (13.100.0.0/16).</span><span class="sxs-lookup"><span data-stu-id="499e7-119">On each ExpressRoute circuit, we advertise tooyou both hello prefix in Azure US East (23.100.0.0/16) and hello prefix in Azure US West (13.100.0.0/16).</span></span> <span data-ttu-id="499e7-120">Si no sabe qué prefijo procede de qué región, no es capaz de tootreat se forma diferente.</span><span class="sxs-lookup"><span data-stu-id="499e7-120">If you don't know which prefix is from which region, you are not able tootreat it differently.</span></span> <span data-ttu-id="499e7-121">La red WAN puede pensar dos prefijos de hello están más cerca de este tooUS que nos oeste y, por tanto, enrutan ambos toohello de los usuarios de office circuito ExpressRoute en este de EE..</span><span class="sxs-lookup"><span data-stu-id="499e7-121">Your WAN network may think both of hello prefixes are closer tooUS East than US West and therefore route both office users toohello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="499e7-122">Final de hello, tendrá muchos usuarios descontento de Los Ángeles office Hola.</span><span class="sxs-lookup"><span data-stu-id="499e7-122">In hello end, you will have many unhappy users in hello Los Angeles office.</span></span>

![Problema de ExpressRoute caso 1 - óptimas de enrutamiento de tooMicrosoft de cliente](./media/expressroute-optimize-routing/expressroute-case1-problem.png)

### <a name="solution-use-bgp-communities"></a><span data-ttu-id="499e7-124">Solución: utilice comunidades de BGP.</span><span class="sxs-lookup"><span data-stu-id="499e7-124">Solution: use BGP Communities</span></span>
<span data-ttu-id="499e7-125">toooptimize enrutamiento tanto a los usuarios de office, necesita tooknow qué prefijo procede de Azure US West y que Azure este de EE..</span><span class="sxs-lookup"><span data-stu-id="499e7-125">toooptimize routing for both office users, you need tooknow which prefix is from Azure US West and which from Azure US East.</span></span> <span data-ttu-id="499e7-126">Esta información se codifica mediante los [valores de las comunidades de BGP](expressroute-routing.md).</span><span class="sxs-lookup"><span data-stu-id="499e7-126">We encode this information by using [BGP Community values](expressroute-routing.md).</span></span> <span data-ttu-id="499e7-127">Se ha asignado un tooeach de valor único de comunidad de BGP región de Azure, p. ej. "12076:51004" para el este de EE.UU. y "12076:51006" para el oeste.</span><span class="sxs-lookup"><span data-stu-id="499e7-127">We've assigned a unique BGP Community value tooeach Azure region, e.g. "12076:51004" for US East, "12076:51006" for US West.</span></span> <span data-ttu-id="499e7-128">Ahora que sabe qué prefijo pertenece a cada región de Azure, puede configurar qué circuito de ExpressRoute debe ser el preferido.</span><span class="sxs-lookup"><span data-stu-id="499e7-128">Now that you know which prefix is from which Azure region, you can configure which ExpressRoute circuit should be preferred.</span></span> <span data-ttu-id="499e7-129">Dado que usamos la información de enrutamiento tooexchange Hola BGP, puede usar enrutamiento de BGP preferencia Local tooinfluence.</span><span class="sxs-lookup"><span data-stu-id="499e7-129">Because we use hello BGP tooexchange routing info, you can use BGP's Local Preference tooinfluence routing.</span></span> <span data-ttu-id="499e7-130">En nuestro ejemplo, puede asignar una mayor ejemplo de preferencia local valor too13.100.0.0/16 en US West que este de EE. y de forma similar, un mayor ejemplo de preferencia local valor too23.100.0.0/16 en este de EE. que en el oeste de EE.</span><span class="sxs-lookup"><span data-stu-id="499e7-130">In our example, you can assign a higher local preference value too13.100.0.0/16 in US West than in US East, and similarly, a higher local preference value too23.100.0.0/16 in US East than in US West.</span></span> <span data-ttu-id="499e7-131">Esta configuración se asegurará de que, cuando ambos tooMicrosoft de rutas de acceso disponibles, los usuarios en Los Ángeles tendrá circuito de ExpressRoute de hello en tooAzure de tooconnect US West US West mientras que los usuarios de Nueva York toman hello ExpressRoute en este de EE. tooAzure este de EE. .</span><span class="sxs-lookup"><span data-stu-id="499e7-131">This configuration will make sure that, when both paths tooMicrosoft are available, your users in Los Angeles will take hello ExpressRoute circuit in US West tooconnect tooAzure US West whereas your users in New York take hello ExpressRoute in US East tooAzure US East.</span></span> <span data-ttu-id="499e7-132">Con lo cual, se obtendrá un enrutamiento óptimo en ambas regiones.</span><span class="sxs-lookup"><span data-stu-id="499e7-132">Routing is optimized on both sides.</span></span> 

![Solución de ExpressRoute caso 1: utilice comunidades de BGP](./media/expressroute-optimize-routing/expressroute-case1-solution.png)

> [!NOTE]
> <span data-ttu-id="499e7-134">Hola misma técnica, con preferencia Local, puede ser aplicada toorouting de cliente tooAzure red Virtual.</span><span class="sxs-lookup"><span data-stu-id="499e7-134">hello same technique, using Local Preference, can be applied toorouting from customer tooAzure Virtual Network.</span></span> <span data-ttu-id="499e7-135">Se no etiquete los prefijos de toohello de valor BGP Comunidad anunciados de red tooyour de Azure.</span><span class="sxs-lookup"><span data-stu-id="499e7-135">We don't tag BGP Community value toohello prefixes advertised from Azure tooyour network.</span></span> <span data-ttu-id="499e7-136">Sin embargo, dado que usted sabe que su implementación en una red Virtual es cerrar toowhich de su oficina, puede configurar los enrutadores en consecuencia tooprefer tooanother de circuito de ExpressRoute uno.</span><span class="sxs-lookup"><span data-stu-id="499e7-136">However, since you know which of your Virtual Network deployment is close toowhich of your office, you can configure your routers accordingly tooprefer one ExpressRoute circuit tooanother.</span></span>
>
>

## <a name="suboptimal-routing-from-microsoft-toocustomer"></a><span data-ttu-id="499e7-137">Poco óptimos de enrutamiento de Microsoft toocustomer</span><span class="sxs-lookup"><span data-stu-id="499e7-137">Suboptimal routing from Microsoft toocustomer</span></span>
<span data-ttu-id="499e7-138">Este es otro ejemplo donde conexiones desde Microsoft toman un tooreach de ruta de acceso más a la red.</span><span class="sxs-lookup"><span data-stu-id="499e7-138">Here is another example where connections from Microsoft take a longer path tooreach your network.</span></span> <span data-ttu-id="499e7-139">En este caso, se utilizan servidores de Exchange locales y Exchange Online en un [entorno híbrido](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span><span class="sxs-lookup"><span data-stu-id="499e7-139">In this case, you use on-premises Exchange servers and Exchange Online in a [hybrid environment](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span></span> <span data-ttu-id="499e7-140">La oficina está conectado tooa WAN.</span><span class="sxs-lookup"><span data-stu-id="499e7-140">Your offices are connected tooa WAN.</span></span> <span data-ttu-id="499e7-141">Anunciar prefijos de Hola de los servidores locales en ambos su tooMicrosoft oficinas a través de circuitos ExpressRoute de hello dos.</span><span class="sxs-lookup"><span data-stu-id="499e7-141">You advertise hello prefixes of your on-premises servers in both of your offices tooMicrosoft through hello two ExpressRoute circuits.</span></span> <span data-ttu-id="499e7-142">Exchange Online se iniciará servidores de conexiones toohello locales en casos como la migración de buzones de correo.</span><span class="sxs-lookup"><span data-stu-id="499e7-142">Exchange Online will initiate connections toohello on-premises servers in cases such as mailbox migration.</span></span> <span data-ttu-id="499e7-143">Desafortunadamente, Hola conexión tooyour Los Ángeles office es toohello enrutado circuito de ExpressRoute en este de EE. antes de recorrer costa oeste de hello todo toohello atrás continent.</span><span class="sxs-lookup"><span data-stu-id="499e7-143">Unfortunately, hello connection tooyour Los Angeles office is routed toohello ExpressRoute circuit in US East before traversing hello entire continent back toohello west coast.</span></span> <span data-ttu-id="499e7-144">causa del problema de Hola Hola es similar toohello primero.</span><span class="sxs-lookup"><span data-stu-id="499e7-144">hello cause of hello problem is similar toohello first one.</span></span> <span data-ttu-id="499e7-145">Sin ninguna sugerencia, red de Microsoft hello no puede saber qué prefijo de cliente es cerrar este tooUS y cuál es cerrar tooUS oeste.</span><span class="sxs-lookup"><span data-stu-id="499e7-145">Without any hint, hello Microsoft network can't tell which customer prefix is close tooUS East and which one is close tooUS West.</span></span> <span data-ttu-id="499e7-146">Se produce de office de tooyour de ruta de acceso incorrecto toopick hello en Los Ángeles.</span><span class="sxs-lookup"><span data-stu-id="499e7-146">It happens toopick hello wrong path tooyour office in Los Angeles.</span></span>

![Caso 2 - óptimas de enrutamiento de Microsoft toocustomer de ExpressRoute](./media/expressroute-optimize-routing/expressroute-case2-problem.png)

### <a name="solution-use-as-path-prepending"></a><span data-ttu-id="499e7-148">Solución: anteponga AS PATH</span><span class="sxs-lookup"><span data-stu-id="499e7-148">Solution: use AS PATH prepending</span></span>
<span data-ttu-id="499e7-149">Hay dos problemas de toohello de soluciones.</span><span class="sxs-lookup"><span data-stu-id="499e7-149">There are two solutions toohello problem.</span></span> <span data-ttu-id="499e7-150">Hello primero una es que simplemente anunciar el prefijo local para la oficina de Los Ángeles, 177.2.0.0/31, en el circuito de ExpressRoute de hello en US West y en sus instalaciones de prefijo para la oficina de Nueva York, 177.2.0.2/31, en el circuito de ExpressRoute de hello en este de EE..</span><span class="sxs-lookup"><span data-stu-id="499e7-150">hello first one is that you simply advertise your on-premises prefix for your Los Angeles office, 177.2.0.0/31, on hello ExpressRoute circuit in US West and your on-premises prefix for your New York office, 177.2.0.2/31, on hello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="499e7-151">Como resultado, hay solo una ruta de acceso para Microsoft tooconnect tooeach de la oficina.</span><span class="sxs-lookup"><span data-stu-id="499e7-151">As a result, there is only one path for Microsoft tooconnect tooeach of your offices.</span></span> <span data-ttu-id="499e7-152">No hay ninguna ambigüedad y, por tanto, el enrutamiento se optimiza.</span><span class="sxs-lookup"><span data-stu-id="499e7-152">There is no ambiguity and routing is optimized.</span></span> <span data-ttu-id="499e7-153">Con este diseño, debe toothink sobre la estrategia de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="499e7-153">With this design, you need toothink about your failover strategy.</span></span> <span data-ttu-id="499e7-154">Hola eventos que Hola tooMicrosoft de ruta de acceso a través de ExpressRoute se interrumpe, deberá toomake seguro de que Exchange Online pueden seguir conectándose servidores locales de tooyour.</span><span class="sxs-lookup"><span data-stu-id="499e7-154">In hello event that hello path tooMicrosoft via ExpressRoute is broken, you need toomake sure that Exchange Online can still connect tooyour on-premises servers.</span></span> 

<span data-ttu-id="499e7-155">Hola segunda solución es que continuar tooadvertise de prefijos de hello en dos circuitos ExpressRoute y además nos ofrecen una sugerencia de qué prefijo es toowhich cerrar uno de sus oficinas.</span><span class="sxs-lookup"><span data-stu-id="499e7-155">hello second solution is that you continue tooadvertise both of hello prefixes on both ExpressRoute circuits, and in addition you give us a hint of which prefix is close toowhich one of your offices.</span></span> <span data-ttu-id="499e7-156">Dado que se admite anteponiéndole la ruta de acceso de AS BGP, puede configurar hello como ruta de acceso para el enrutamiento de tooinfluence de prefijo.</span><span class="sxs-lookup"><span data-stu-id="499e7-156">Because we support BGP AS Path prepending, you can configure hello AS Path for your prefix tooinfluence routing.</span></span> <span data-ttu-id="499e7-157">En este ejemplo, puede alargar hello ruta de acceso de AS para 172.2.0.0/31 en este de EE. para que se preferirán circuito de ExpressRoute de hello en US West para el tráfico destinado a este prefijo (tal y como se consideren nuestra red prefijo de toothis de ruta de acceso de hello es de menor oeste hello).</span><span class="sxs-lookup"><span data-stu-id="499e7-157">In this example, you can lengthen hello AS PATH for 172.2.0.0/31 in US East so that we will prefer hello ExpressRoute circuit in US West for traffic destined for this prefix (as our network will think hello path toothis prefix is shorter in hello west).</span></span> <span data-ttu-id="499e7-158">Del mismo modo puede alargar hello ruta de acceso de AS para 172.2.0.2/31 en US West para que se le prefiere circuito de ExpressRoute de hello en este de EE..</span><span class="sxs-lookup"><span data-stu-id="499e7-158">Similarly you can lengthen hello AS PATH for 172.2.0.2/31 in US West so that we'll prefer hello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="499e7-159">De esta forma, se optimizará el enrutamiento para ambas oficinas.</span><span class="sxs-lookup"><span data-stu-id="499e7-159">Routing is optimized for both offices.</span></span> <span data-ttu-id="499e7-160">Con este diseño, si se interrumpe un circuito de ExpressRoute, Exchange Online podrá conectarse a través de otro circuito de ExpressRoute y de la red WAN.</span><span class="sxs-lookup"><span data-stu-id="499e7-160">With this design, if one ExpressRoute circuit is broken, Exchange Online can still reach you via another ExpressRoute circuit and your WAN.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="499e7-161">Quitamos privada como números en hello como ruta de acceso para los prefijos de hello reciben en Microsoft Peering.</span><span class="sxs-lookup"><span data-stu-id="499e7-161">We remove private AS numbers in hello AS PATH for hello prefixes received on Microsoft Peering.</span></span> <span data-ttu-id="499e7-162">Necesita tooappend pública como números en hello AS tooinfluence ruta de acceso para Microsoft Peering.</span><span class="sxs-lookup"><span data-stu-id="499e7-162">You need tooappend public AS numbers in hello AS PATH tooinfluence routing for Microsoft Peering.</span></span>
> 
> 

![Solución de ExpressRoute caso 2: anteponga la ruta de acceso AS](./media/expressroute-optimize-routing/expressroute-case2-solution.png)

> [!NOTE]
> <span data-ttu-id="499e7-164">Aunque los ejemplos de hello aquí especificados son de Microsoft y emparejamientos públicos, admitimos hello las mismas capacidades de intercambio de tráfico privado Hola.</span><span class="sxs-lookup"><span data-stu-id="499e7-164">While hello examples given here are for Microsoft and Public peerings, we do support hello same capabilities for hello Private peering.</span></span> <span data-ttu-id="499e7-165">Además, Hola anteponiendo funciona dentro de un circuito ExpressRoute único, selección de hello tooinfluence de rutas de acceso principal y secundaria de Hola de ruta de acceso de AS.</span><span class="sxs-lookup"><span data-stu-id="499e7-165">Also, hello AS Path prepending works within one single ExpressRoute circuit, tooinfluence hello selection of hello primary and secondary paths.</span></span>
> 
> 

## <a name="suboptimal-routing-between-virtual-networks"></a><span data-ttu-id="499e7-166">Enrutamiento no óptimo entre redes virtuales</span><span class="sxs-lookup"><span data-stu-id="499e7-166">Suboptimal routing between virtual networks</span></span>
<span data-ttu-id="499e7-167">Con ExpressRoute, puede habilitar la red Virtual tooVirtual red (también conocido como "red virtual") comunicación vinculándolos tooan circuito de ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="499e7-167">With ExpressRoute, you can enable Virtual Network tooVirtual Network (which is also known as "VNet") communication by linking them tooan ExpressRoute circuit.</span></span> <span data-ttu-id="499e7-168">Cuando se vinculan circuitos ExpressRoute de toomultiple, enrutamiento poco óptimos puede ocurrir entre Hola redes virtuales.</span><span class="sxs-lookup"><span data-stu-id="499e7-168">When you link them toomultiple ExpressRoute circuits, suboptimal routing can happen between hello VNets.</span></span> <span data-ttu-id="499e7-169">Veamos un ejemplo.</span><span class="sxs-lookup"><span data-stu-id="499e7-169">Let's consider an example.</span></span> <span data-ttu-id="499e7-170">Tiene dos circuitos ExpressRoute, uno en el Oeste de EE. UU. y otro en el Este de EE. UU.</span><span class="sxs-lookup"><span data-stu-id="499e7-170">You have two ExpressRoute circuits, one in US West and one in US East.</span></span> <span data-ttu-id="499e7-171">En cada región, tiene dos redes virtuales.</span><span class="sxs-lookup"><span data-stu-id="499e7-171">In each region, you have two VNets.</span></span> <span data-ttu-id="499e7-172">Los servidores web se implementan en una red virtual y Hola de servidores de aplicaciones en Sí.</span><span class="sxs-lookup"><span data-stu-id="499e7-172">Your web servers are deployed in one VNet and application servers in hello other.</span></span> <span data-ttu-id="499e7-173">Para conseguir redundancia, vincula Hola dos redes virtuales en cada circuito de ExpressRoute local de región tooboth Hola y Hola remoto circuito de ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="499e7-173">For redundancy, you link hello two VNets in each region tooboth hello local ExpressRoute circuit and hello remote ExpressRoute circuit.</span></span> <span data-ttu-id="499e7-174">Como puede verse a continuación, desde cada red virtual hay dos de las rutas de acceso toohello otra VNet.</span><span class="sxs-lookup"><span data-stu-id="499e7-174">As can be seen below, from each VNet there are two paths toohello other VNet.</span></span> <span data-ttu-id="499e7-175">Hola redes virtuales no sabe qué circuito de ExpressRoute no es local y cuál es remoto.</span><span class="sxs-lookup"><span data-stu-id="499e7-175">hello VNets don't know which ExpressRoute circuit is local and which one is remote.</span></span> <span data-ttu-id="499e7-176">Por lo tanto como lo hacen enrutar el tráfico de red virtual entre redes para las tooload saldo igual-costo-Multi-Path (ECMP), algunos flujos de tráfico emplearán ruta más larga de Hola y se enrutan al circuito de ExpressRoute remoto hello.</span><span class="sxs-lookup"><span data-stu-id="499e7-176">Consequently as they do Equal-Cost-Multi-Path (ECMP) routing tooload-balance inter-VNet traffic, some traffic flows will take hello longer path and get routed at hello remote ExpressRoute circuit.</span></span>

![ExpressRoute caso 3: enrutamiento no óptimo entre redes virtuales](./media/expressroute-optimize-routing/expressroute-case3-problem.png)

### <a name="solution-assign-a-high-weight-toolocal-connection"></a><span data-ttu-id="499e7-178">Solución: asignar una conexión de toolocal elevado peso</span><span class="sxs-lookup"><span data-stu-id="499e7-178">Solution: assign a high weight toolocal connection</span></span>
<span data-ttu-id="499e7-179">solución de Hello es simple.</span><span class="sxs-lookup"><span data-stu-id="499e7-179">hello solution is simple.</span></span> <span data-ttu-id="499e7-180">Puesto que conoce la ubicación de circuitos de hello hello y redes virtuales, puede cuéntenos qué ruta de acceso deberías optar por cada red virtual.</span><span class="sxs-lookup"><span data-stu-id="499e7-180">Since you know where hello VNets and hello circuits are, you can tell us which path each VNet should prefer.</span></span> <span data-ttu-id="499e7-181">Específicamente para este ejemplo, se asigna una peso toohello local conexión mayor que la conexión remota toohello (vea el ejemplo de configuración de hello [aquí](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span><span class="sxs-lookup"><span data-stu-id="499e7-181">Specifically for this example, you assign a higher weight toohello local connection than toohello remote connection (see hello configuration example [here](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span></span> <span data-ttu-id="499e7-182">Cuando una red virtual recibe prefijo Hola de hello otra VNet en varias conexiones preferirán conexión Hola Hola mayor peso toosend tráfico destinado a ese prefijo.</span><span class="sxs-lookup"><span data-stu-id="499e7-182">When a VNet receives hello prefix of hello other VNet on multiple connections it will prefer hello connection with hello highest weight toosend traffic destined for that prefix.</span></span>

![Solución de ExpressRoute caso 3: asignar elevado peso toolocal conexión](./media/expressroute-optimize-routing/expressroute-case3-solution.png)

> [!NOTE]
> <span data-ttu-id="499e7-184">También puede influir en el enrutamiento de red de red virtual tooyour local, si tiene varios circuitos ExpressRoute, mediante la configuración de peso de Hola de una conexión en lugar de aplicar la ruta de acceso de AS anteponiendo, una técnica descrita en hello segundo escenario anterior.</span><span class="sxs-lookup"><span data-stu-id="499e7-184">You can also influence routing from VNet tooyour on-premises network, if you have multiple ExpressRoute circuits, by configuring hello weight of a connection instead of applying AS PATH prepending, a technique described in hello second scenario above.</span></span> <span data-ttu-id="499e7-185">Para cada prefijo siempre veremos peso de conexión de Hola Hola longitud de ruta de acceso de AS antes de la hora de decidir cómo toosend tráfico.</span><span class="sxs-lookup"><span data-stu-id="499e7-185">For each prefix, we will always look at hello connection weight before hello AS Path length when deciding how toosend traffic.</span></span>
>
>

---
title: "Optimización del enrutamiento de ExpressRoute: Azure | Microsoft Docs"
description: "Esta página muestra información acerca de cómo optimizar el enrutamiento cuando tenga más de un circuito de ExpressRoute que se conecte entre Microsoft y la red corporativa."
documentationcenter: na
services: expressroute
author: charwen
manager: carmonm
editor: 
ms.assetid: fca53249-d9c3-4cff-8916-f8749386a4dd
ms.service: expressroute
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/06/2017
ms.author: charwen
ms.openlocfilehash: c3a85b9445d69330c3f6c7d298169efddb6ecca0
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="optimize-expressroute-routing"></a><span data-ttu-id="d42eb-103">Optimización de enrutamiento de ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="d42eb-103">Optimize ExpressRoute Routing</span></span>
<span data-ttu-id="d42eb-104">Cuando hay varios circuitos ExpressRoute, tiene más de una ruta de acceso para conectarse a Microsoft.</span><span class="sxs-lookup"><span data-stu-id="d42eb-104">When you have multiple ExpressRoute circuits, you have more than one path to connect to Microsoft.</span></span> <span data-ttu-id="d42eb-105">Como resultado, se puede producir un enrutamiento no óptimo: es decir, el tráfico puede utilizar una ruta más larga para conectarse con Microsoft y este a su vez, con su red.</span><span class="sxs-lookup"><span data-stu-id="d42eb-105">As a result, suboptimal routing may happen - that is, your traffic may take a longer path to reach Microsoft, and Microsoft to your network.</span></span> <span data-ttu-id="d42eb-106">Cuanto más larga sea la ruta de acceso a la red, mayor será la latencia.</span><span class="sxs-lookup"><span data-stu-id="d42eb-106">The longer the network path, the higher the latency.</span></span> <span data-ttu-id="d42eb-107">La latencia tiene un efecto directo en la experiencia del usuario y en el rendimiento de las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="d42eb-107">Latency has direct impact on application performance and user experience.</span></span> <span data-ttu-id="d42eb-108">En este artículo se describe este problema y se explica cómo optimizar el enrutamiento mediante las tecnologías de enrutamiento estándar.</span><span class="sxs-lookup"><span data-stu-id="d42eb-108">This article will illustrate this problem and explain how to optimize routing using the standard routing technologies.</span></span>

## <a name="suboptimal-routing-from-customer-to-microsoft"></a><span data-ttu-id="d42eb-109">Enrutamiento no óptimo de cliente a Microsoft</span><span class="sxs-lookup"><span data-stu-id="d42eb-109">Suboptimal routing from customer to Microsoft</span></span>
<span data-ttu-id="d42eb-110">Eche un vistazo más detenidamente al problema del enrutamiento mediante un ejemplo.</span><span class="sxs-lookup"><span data-stu-id="d42eb-110">Let's take a close look at the routing problem by an example.</span></span> <span data-ttu-id="d42eb-111">Imagine que tiene dos oficinas en Estados Unidos, una en Los Ángeles y la otra en Nueva York.</span><span class="sxs-lookup"><span data-stu-id="d42eb-111">Imagine you have two offices in the US, one in Los Angeles and one in New York.</span></span> <span data-ttu-id="d42eb-112">Las oficinas están conectadas a una red de área extensa (WAN), que puede ser su propia red troncal o la VPN de la dirección IP del proveedor de servicios.</span><span class="sxs-lookup"><span data-stu-id="d42eb-112">Your offices are connected on a Wide Area Network (WAN), which can be either your own backbone network or your service provider's IP VPN.</span></span> <span data-ttu-id="d42eb-113">Tiene dos circuitos ExpressRoute, uno en el oeste de EE.UU. y otro en el este, que también están conectados a la red de área extensa.</span><span class="sxs-lookup"><span data-stu-id="d42eb-113">You have two ExpressRoute circuits, one in US West and one in US East, that are also connected on the WAN.</span></span> <span data-ttu-id="d42eb-114">Obviamente, tiene dos rutas de acceso para conectarse a la red de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="d42eb-114">Obviously, you have two paths to connect to the Microsoft network.</span></span> <span data-ttu-id="d42eb-115">Ahora supongamos que tiene una implementación de Azure (por ejemplo, Azure App Service) en el Oeste de EE. UU. y en el Este de EE. UU.</span><span class="sxs-lookup"><span data-stu-id="d42eb-115">Now imagine you have Azure deployment (for example, Azure App Service) in both US West and US East.</span></span> <span data-ttu-id="d42eb-116">Su intención es que los usuarios de Los Ángeles se conecten a la implementación de Azure en el oeste y los de Nueva York a la del este, porque el Administrador de servicios aconseja que los usuarios de cada oficina accedan a los servicios de Azure más cercanos para conseguir un rendimiento óptimo.</span><span class="sxs-lookup"><span data-stu-id="d42eb-116">Your intention is to connect your users in Los Angeles to Azure US West and your users in New York to Azure US East because your service admin advertises that users in each office access the nearby Azure services for optimal experiences.</span></span> <span data-ttu-id="d42eb-117">Desafortunadamente, el plan funciona bien para los usuarios de la costa este, pero no para los usuarios de la costa oeste.</span><span class="sxs-lookup"><span data-stu-id="d42eb-117">Unfortunately, the plan works out well for the east coast users but not for the west coast users.</span></span> <span data-ttu-id="d42eb-118">La causa del problema es la siguiente.</span><span class="sxs-lookup"><span data-stu-id="d42eb-118">The cause of the problem is the following.</span></span> <span data-ttu-id="d42eb-119">En cada circuito ExpressRoute, se indica el prefijo para la implementación de Azure del este (23.100.0.0/16) y el prefijo para la del oeste (13.100.0.0/16).</span><span class="sxs-lookup"><span data-stu-id="d42eb-119">On each ExpressRoute circuit, we advertise to you both the prefix in Azure US East (23.100.0.0/16) and the prefix in Azure US West (13.100.0.0/16).</span></span> <span data-ttu-id="d42eb-120">Si no sabe qué prefijo pertenece a cada región, probablemente los tratará de la misma forma.</span><span class="sxs-lookup"><span data-stu-id="d42eb-120">If you don't know which prefix is from which region, you are not able to treat it differently.</span></span> <span data-ttu-id="d42eb-121">La red WAN puede considerar que ambos prefijos están más próximos a la implementación del este de EE.UU. que a la del oeste y, por tanto, enrutará a los usuarios de ambas oficinas al circuito ExpressRoute del este.</span><span class="sxs-lookup"><span data-stu-id="d42eb-121">Your WAN network may think both of the prefixes are closer to US East than US West and therefore route both office users to the ExpressRoute circuit in US East.</span></span> <span data-ttu-id="d42eb-122">Al final, tendrá muchos usuarios descontentos en la oficina de Los Ángeles.</span><span class="sxs-lookup"><span data-stu-id="d42eb-122">In the end, you will have many unhappy users in the Los Angeles office.</span></span>

![Problema de ExpressRoute caso 1: enrutamiento no óptimo de cliente a Microsoft](./media/expressroute-optimize-routing/expressroute-case1-problem.png)

### <a name="solution-use-bgp-communities"></a><span data-ttu-id="d42eb-124">Solución: utilice comunidades de BGP.</span><span class="sxs-lookup"><span data-stu-id="d42eb-124">Solution: use BGP Communities</span></span>
<span data-ttu-id="d42eb-125">Para optimizar el enrutamiento para los usuarios de ambas oficinas, debe saber qué prefijo pertenece al oeste y qué prefijo al este.</span><span class="sxs-lookup"><span data-stu-id="d42eb-125">To optimize routing for both office users, you need to know which prefix is from Azure US West and which from Azure US East.</span></span> <span data-ttu-id="d42eb-126">Esta información se codifica mediante los [valores de las comunidades de BGP](expressroute-routing.md).</span><span class="sxs-lookup"><span data-stu-id="d42eb-126">We encode this information by using [BGP Community values](expressroute-routing.md).</span></span> <span data-ttu-id="d42eb-127">Se ha asignado un valor único de comunidad de BGP para cada región de Azure, por ejemplo, "12076:51004" para el este de EE.UU. y "12076:51006" para el oeste.</span><span class="sxs-lookup"><span data-stu-id="d42eb-127">We've assigned a unique BGP Community value to each Azure region, e.g. "12076:51004" for US East, "12076:51006" for US West.</span></span> <span data-ttu-id="d42eb-128">Ahora que sabe qué prefijo pertenece a cada región de Azure, puede configurar qué circuito de ExpressRoute debe ser el preferido.</span><span class="sxs-lookup"><span data-stu-id="d42eb-128">Now that you know which prefix is from which Azure region, you can configure which ExpressRoute circuit should be preferred.</span></span> <span data-ttu-id="d42eb-129">Como se utiliza el BGP para intercambiar información de enrutamiento, puede usar la preferencia local de BGP para influir en el enrutamiento.</span><span class="sxs-lookup"><span data-stu-id="d42eb-129">Because we use the BGP to exchange routing info, you can use BGP's Local Preference to influence routing.</span></span> <span data-ttu-id="d42eb-130">En nuestro ejemplo, puede asignar un valor de preferencia local superior a 13.100.0.0/16 para el oeste y, de forma similar, un valor de preferencia local superior a 23.100.0.0/16 para el este.</span><span class="sxs-lookup"><span data-stu-id="d42eb-130">In our example, you can assign a higher local preference value to 13.100.0.0/16 in US West than in US East, and similarly, a higher local preference value to 23.100.0.0/16 in US East than in US West.</span></span> <span data-ttu-id="d42eb-131">Esta configuración garantiza que, cuando estén disponibles ambas rutas de acceso a Microsoft, los usuarios de Los Ángeles utilizarán el circuito de ExpressRoute del oeste para conectarse a la implementación oeste de Azure, mientras que los usuarios de Nueva York utilizarán el del este para conectarse a la implementación este.</span><span class="sxs-lookup"><span data-stu-id="d42eb-131">This configuration will make sure that, when both paths to Microsoft are available, your users in Los Angeles will take the ExpressRoute circuit in US West to connect to Azure US West whereas your users in New York take the ExpressRoute in US East to Azure US East.</span></span> <span data-ttu-id="d42eb-132">Con lo cual, se obtendrá un enrutamiento óptimo en ambas regiones.</span><span class="sxs-lookup"><span data-stu-id="d42eb-132">Routing is optimized on both sides.</span></span> 

![Solución de ExpressRoute caso 1: utilice comunidades de BGP](./media/expressroute-optimize-routing/expressroute-case1-solution.png)

> [!NOTE]
> <span data-ttu-id="d42eb-134">La misma técnica, con preferencia Local, se puede aplicar en el enrutamiento de cliente a Azure Virtual Network.</span><span class="sxs-lookup"><span data-stu-id="d42eb-134">The same technique, using Local Preference, can be applied to routing from customer to Azure Virtual Network.</span></span> <span data-ttu-id="d42eb-135">El valor de la comunidad de BGP no se etiqueta a los prefijos anunciados de Azure a su red.</span><span class="sxs-lookup"><span data-stu-id="d42eb-135">We don't tag BGP Community value to the prefixes advertised from Azure to your network.</span></span> <span data-ttu-id="d42eb-136">Sin embargo, dado que usted sabe cuál de las implementaciones de Virtual Network está cerca de cada oficina, puede configurar en consecuencia los enrutadores para que prefieran un circuito ExpressRoute a otro.</span><span class="sxs-lookup"><span data-stu-id="d42eb-136">However, since you know which of your Virtual Network deployment is close to which of your office, you can configure your routers accordingly to prefer one ExpressRoute circuit to another.</span></span>
>
>

## <a name="suboptimal-routing-from-microsoft-to-customer"></a><span data-ttu-id="d42eb-137">Enrutamiento no óptimo de Microsoft al cliente</span><span class="sxs-lookup"><span data-stu-id="d42eb-137">Suboptimal routing from Microsoft to customer</span></span>
<span data-ttu-id="d42eb-138">Este es otro ejemplo en el que las conexiones de Microsoft toman una ruta de acceso más larga para llegar a la red.</span><span class="sxs-lookup"><span data-stu-id="d42eb-138">Here is another example where connections from Microsoft take a longer path to reach your network.</span></span> <span data-ttu-id="d42eb-139">En este caso, se utilizan servidores de Exchange locales y Exchange Online en un [entorno híbrido](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span><span class="sxs-lookup"><span data-stu-id="d42eb-139">In this case, you use on-premises Exchange servers and Exchange Online in a [hybrid environment](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span></span> <span data-ttu-id="d42eb-140">Las oficinas están conectadas a una red WAN.</span><span class="sxs-lookup"><span data-stu-id="d42eb-140">Your offices are connected to a WAN.</span></span> <span data-ttu-id="d42eb-141">Usted indica los prefijos de los servidores locales de ambas oficinas a Microsoft a través de los dos circuitos de ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="d42eb-141">You advertise the prefixes of your on-premises servers in both of your offices to Microsoft through the two ExpressRoute circuits.</span></span> <span data-ttu-id="d42eb-142">Exchange Online inicia las conexiones a los servidores locales en algunos casos como, por ejemplo, la migración de buzones.</span><span class="sxs-lookup"><span data-stu-id="d42eb-142">Exchange Online will initiate connections to the on-premises servers in cases such as mailbox migration.</span></span> <span data-ttu-id="d42eb-143">Desafortunadamente, la conexión a la oficina de Los Ángeles se enruta a través del circuito de ExpressRoute en el este de EE.UU antes de atravesar todo el país hasta la costa oeste.</span><span class="sxs-lookup"><span data-stu-id="d42eb-143">Unfortunately, the connection to your Los Angeles office is routed to the ExpressRoute circuit in US East before traversing the entire continent back to the west coast.</span></span> <span data-ttu-id="d42eb-144">La causa del problema es similar a la del primer caso.</span><span class="sxs-lookup"><span data-stu-id="d42eb-144">The cause of the problem is similar to the first one.</span></span> <span data-ttu-id="d42eb-145">Sin ninguna indicación, la red de Microsoft no puede saber qué prefijo de cliente está más próximo al este de EE.UU. y cuál al oeste.</span><span class="sxs-lookup"><span data-stu-id="d42eb-145">Without any hint, the Microsoft network can't tell which customer prefix is close to US East and which one is close to US West.</span></span> <span data-ttu-id="d42eb-146">Y sucede que se elige la ruta de acceso incorrecta a la oficina de Los Ángeles.</span><span class="sxs-lookup"><span data-stu-id="d42eb-146">It happens to pick the wrong path to your office in Los Angeles.</span></span>

![ExpressRoute caso 2: enrutamiento no óptimo de Microsoft al cliente](./media/expressroute-optimize-routing/expressroute-case2-problem.png)

### <a name="solution-use-as-path-prepending"></a><span data-ttu-id="d42eb-148">Solución: anteponga AS PATH</span><span class="sxs-lookup"><span data-stu-id="d42eb-148">Solution: use AS PATH prepending</span></span>
<span data-ttu-id="d42eb-149">Hay dos soluciones al problema.</span><span class="sxs-lookup"><span data-stu-id="d42eb-149">There are two solutions to the problem.</span></span> <span data-ttu-id="d42eb-150">La primera consiste simplemente en que anuncie el prefijo local para la oficina de Los Ángeles, 177.2.0.0/31, en el circuito de ExpressRoute en el oeste y el prefijo local para la oficina de Nueva York, 177.2.0.2/31, en el circuito de ExpressRoute en el este.</span><span class="sxs-lookup"><span data-stu-id="d42eb-150">The first one is that you simply advertise your on-premises prefix for your Los Angeles office, 177.2.0.0/31, on the ExpressRoute circuit in US West and your on-premises prefix for your New York office, 177.2.0.2/31, on the ExpressRoute circuit in US East.</span></span> <span data-ttu-id="d42eb-151">Como resultado, habrá solo una ruta de acceso para que Microsoft se conecte a cada una de sus oficinas.</span><span class="sxs-lookup"><span data-stu-id="d42eb-151">As a result, there is only one path for Microsoft to connect to each of your offices.</span></span> <span data-ttu-id="d42eb-152">No hay ninguna ambigüedad y, por tanto, el enrutamiento se optimiza.</span><span class="sxs-lookup"><span data-stu-id="d42eb-152">There is no ambiguity and routing is optimized.</span></span> <span data-ttu-id="d42eb-153">Con este diseño, debe pensar acerca de la estrategia de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="d42eb-153">With this design, you need to think about your failover strategy.</span></span> <span data-ttu-id="d42eb-154">En caso de que la ruta de acceso a Microsoft a través de ExpressRoute se interrumpa, deberá asegurarse de que Exchange Online puede conectarse a los servidores locales a pesar de ello.</span><span class="sxs-lookup"><span data-stu-id="d42eb-154">In the event that the path to Microsoft via ExpressRoute is broken, you need to make sure that Exchange Online can still connect to your on-premises servers.</span></span> 

<span data-ttu-id="d42eb-155">La segunda solución es que continúe anunciando ambos prefijos para los dos circuitos de ExpressRoute y, además, nos indique qué prefijo está más cerca de cada una de sus oficinas.</span><span class="sxs-lookup"><span data-stu-id="d42eb-155">The second solution is that you continue to advertise both of the prefixes on both ExpressRoute circuits, and in addition you give us a hint of which prefix is close to which one of your offices.</span></span> <span data-ttu-id="d42eb-156">Dado que se admite la anteposición de BGP AS Path, puede configurar AS Path como prefijo para que influya en el enrutamiento.</span><span class="sxs-lookup"><span data-stu-id="d42eb-156">Because we support BGP AS Path prepending, you can configure the AS Path for your prefix to influence routing.</span></span> <span data-ttu-id="d42eb-157">En este ejemplo, puede alargar AS PATH para 172.2.0.0/31 en el este de EE.UU para que se prefiera el circuito de ExpressRoute del oeste para el tráfico destinado a este prefijo (ya que nuestra red creerá que la ruta de acceso a este prefijo es más corta en el oeste).</span><span class="sxs-lookup"><span data-stu-id="d42eb-157">In this example, you can lengthen the AS PATH for 172.2.0.0/31 in US East so that we will prefer the ExpressRoute circuit in US West for traffic destined for this prefix (as our network will think the path to this prefix is shorter in the west).</span></span> <span data-ttu-id="d42eb-158">De igual manera, puede alargar AS PATH para 172.2.0.2/31 en el oeste para que se prefiera el circuito de ExpressRoute en el este de EE.UU.</span><span class="sxs-lookup"><span data-stu-id="d42eb-158">Similarly you can lengthen the AS PATH for 172.2.0.2/31 in US West so that we'll prefer the ExpressRoute circuit in US East.</span></span> <span data-ttu-id="d42eb-159">De esta forma, se optimizará el enrutamiento para ambas oficinas.</span><span class="sxs-lookup"><span data-stu-id="d42eb-159">Routing is optimized for both offices.</span></span> <span data-ttu-id="d42eb-160">Con este diseño, si se interrumpe un circuito de ExpressRoute, Exchange Online podrá conectarse a través de otro circuito de ExpressRoute y de la red WAN.</span><span class="sxs-lookup"><span data-stu-id="d42eb-160">With this design, if one ExpressRoute circuit is broken, Exchange Online can still reach you via another ExpressRoute circuit and your WAN.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="d42eb-161">Se quitan los números AS privados en AS PATH para los prefijos recibidos en el emparejamiento de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="d42eb-161">We remove private AS numbers in the AS PATH for the prefixes received on Microsoft Peering.</span></span> <span data-ttu-id="d42eb-162">Debe adjuntar números AS públicos en AS PATH para que influyan en el enrutamiento del emparejamiento de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="d42eb-162">You need to append public AS numbers in the AS PATH to influence routing for Microsoft Peering.</span></span>
> 
> 

![Solución de ExpressRoute caso 2: anteponga la ruta de acceso AS](./media/expressroute-optimize-routing/expressroute-case2-solution.png)

> [!NOTE]
> <span data-ttu-id="d42eb-164">Aunque los ejemplos que se proporcionan aquí son para Microsoft y los emparejamientos públicos, se admiten las mismas funcionalidades para el emparejamiento privado.</span><span class="sxs-lookup"><span data-stu-id="d42eb-164">While the examples given here are for Microsoft and Public peerings, we do support the same capabilities for the Private peering.</span></span> <span data-ttu-id="d42eb-165">Además, la ruta de acceso de AS antepuesta funciona dentro de un único circuito ExpressRoute, para influir en la selección de las rutas de acceso principales y secundarias.</span><span class="sxs-lookup"><span data-stu-id="d42eb-165">Also, the AS Path prepending works within one single ExpressRoute circuit, to influence the selection of the primary and secondary paths.</span></span>
> 
> 

## <a name="suboptimal-routing-between-virtual-networks"></a><span data-ttu-id="d42eb-166">Enrutamiento no óptimo entre redes virtuales</span><span class="sxs-lookup"><span data-stu-id="d42eb-166">Suboptimal routing between virtual networks</span></span>
<span data-ttu-id="d42eb-167">Con ExpressRoute, puede habilitar la comunicación de una instancia de Virtual Network a otra instancia de Virtual Network (también conocidas cada una como "VNet" o "red virtual") vinculándolas a un circuito de ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="d42eb-167">With ExpressRoute, you can enable Virtual Network to Virtual Network (which is also known as "VNet") communication by linking them to an ExpressRoute circuit.</span></span> <span data-ttu-id="d42eb-168">Cuando se vinculan a varios circuitos de ExpressRoute, puede producirse enrutamiento no óptimo entre las redes virtuales.</span><span class="sxs-lookup"><span data-stu-id="d42eb-168">When you link them to multiple ExpressRoute circuits, suboptimal routing can happen between the VNets.</span></span> <span data-ttu-id="d42eb-169">Veamos un ejemplo.</span><span class="sxs-lookup"><span data-stu-id="d42eb-169">Let's consider an example.</span></span> <span data-ttu-id="d42eb-170">Tiene dos circuitos ExpressRoute, uno en el Oeste de EE. UU. y otro en el Este de EE. UU.</span><span class="sxs-lookup"><span data-stu-id="d42eb-170">You have two ExpressRoute circuits, one in US West and one in US East.</span></span> <span data-ttu-id="d42eb-171">En cada región, tiene dos redes virtuales.</span><span class="sxs-lookup"><span data-stu-id="d42eb-171">In each region, you have two VNets.</span></span> <span data-ttu-id="d42eb-172">Los servidores web están implementados en una red virtual y los servidores de aplicaciones en la otra.</span><span class="sxs-lookup"><span data-stu-id="d42eb-172">Your web servers are deployed in one VNet and application servers in the other.</span></span> <span data-ttu-id="d42eb-173">Para conseguir redundancia, vincule las dos redes virtuales en cada región tanto al circuito de ExpressRoute local como al remoto.</span><span class="sxs-lookup"><span data-stu-id="d42eb-173">For redundancy, you link the two VNets in each region to both the local ExpressRoute circuit and the remote ExpressRoute circuit.</span></span> <span data-ttu-id="d42eb-174">Como puede verse a continuación, de cada red virtual hay dos rutas de acceso a la otra red virtual.</span><span class="sxs-lookup"><span data-stu-id="d42eb-174">As can be seen below, from each VNet there are two paths to the other VNet.</span></span> <span data-ttu-id="d42eb-175">Las redes virtuales no saben cuál circuito de ExpressRoute es el local y cuál es el remoto.</span><span class="sxs-lookup"><span data-stu-id="d42eb-175">The VNets don't know which ExpressRoute circuit is local and which one is remote.</span></span> <span data-ttu-id="d42eb-176">Por lo tanto, teniendo en cuenta que hacen enrutamiento multidireccional de igual costo (ECMP) para equilibrar la carga del tráfico entre redes virtuales, algunos flujos de tráfico tomarán la ruta de acceso más larga y se enrutarán al circuito de ExpressRoute remoto.</span><span class="sxs-lookup"><span data-stu-id="d42eb-176">Consequently as they do Equal-Cost-Multi-Path (ECMP) routing to load-balance inter-VNet traffic, some traffic flows will take the longer path and get routed at the remote ExpressRoute circuit.</span></span>

![ExpressRoute caso 3: enrutamiento no óptimo entre redes virtuales](./media/expressroute-optimize-routing/expressroute-case3-problem.png)

### <a name="solution-assign-a-high-weight-to-local-connection"></a><span data-ttu-id="d42eb-178">Solución: asignar un peso alto a la conexión local</span><span class="sxs-lookup"><span data-stu-id="d42eb-178">Solution: assign a high weight to local connection</span></span>
<span data-ttu-id="d42eb-179">La solución es sencilla.</span><span class="sxs-lookup"><span data-stu-id="d42eb-179">The solution is simple.</span></span> <span data-ttu-id="d42eb-180">Dado que usted sabe dónde están las redes virtuales y los circuitos, puede decirnos cuál debería ser la ruta de acceso preferida de cada red virtual.</span><span class="sxs-lookup"><span data-stu-id="d42eb-180">Since you know where the VNets and the circuits are, you can tell us which path each VNet should prefer.</span></span> <span data-ttu-id="d42eb-181">Específicamente para este ejemplo, se asigna a la conexión local un peso mayor que a la conexión remota (vea el ejemplo de configuración [aquí](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span><span class="sxs-lookup"><span data-stu-id="d42eb-181">Specifically for this example, you assign a higher weight to the local connection than to the remote connection (see the configuration example [here](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span></span> <span data-ttu-id="d42eb-182">Cuando una red virtual recibe el prefijo de la otra red virtual en varias conexiones preferirá la conexión con el mayor peso para enviar el tráfico destinado a ese prefijo.</span><span class="sxs-lookup"><span data-stu-id="d42eb-182">When a VNet receives the prefix of the other VNet on multiple connections it will prefer the connection with the highest weight to send traffic destined for that prefix.</span></span>

![Solución de ExpressRoute caso 3: asignar un peso alto a la conexión local](./media/expressroute-optimize-routing/expressroute-case3-solution.png)

> [!NOTE]
> <span data-ttu-id="d42eb-184">También puede influir en el enrutamiento de la red virtual a la red local, si tiene varios circuitos ExpressRoute, configurando el peso de una conexión en lugar de aplicar la anteposición de la ruta de acceso AS, una técnica que se describe en el segundo escenario anterior.</span><span class="sxs-lookup"><span data-stu-id="d42eb-184">You can also influence routing from VNet to your on-premises network, if you have multiple ExpressRoute circuits, by configuring the weight of a connection instead of applying AS PATH prepending, a technique described in the second scenario above.</span></span> <span data-ttu-id="d42eb-185">Para cada prefijo siempre atenderemos primero al peso de la conexión antes que a la longitud de ruta de acceso AS a la hora de decidir cómo enviar tráfico.</span><span class="sxs-lookup"><span data-stu-id="d42eb-185">For each prefix, we will always look at the connection weight before the AS Path length when deciding how to send traffic.</span></span>
>
>

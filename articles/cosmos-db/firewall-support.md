---
title: control de acceso de soporte de firewall de base de datos de Cosmos aaaAzure & IP | Documentos de Microsoft
description: "Obtenga información acerca de cómo son compatibles con directivas de control de acceso IP de toouse de firewall en cuentas de base de datos de la base de datos de Azure Cosmos."
keywords: Control de acceso IP, compatibilidad con el firewall
services: cosmos-db
author: shahankur11
manager: jhubbard
editor: 
tags: azure-resource-manager
documentationcenter: 
ms.assetid: c1b9ede0-ed93-411a-ac9a-62c113a8e887
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/22/2017
ms.author: ankshah
ms.openlocfilehash: b5cdbdb28e9d7ee0fd0ea54aad277167b699929f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="azure-cosmos-db-firewall-support"></a><span data-ttu-id="4f1f4-104">Compatibilidad con un firewall de Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="4f1f4-104">Azure Cosmos DB firewall support</span></span>
<span data-ttu-id="4f1f4-105">toosecure los datos almacenados en una cuenta de base de datos de la base de datos de Azure Cosmos, Azure Cosmos DB proporcionaba compatibilidad para un secreto según [modelo de autorización](https://msdn.microsoft.com/library/azure/dn783368.aspx) que utiliza un código de autenticación de mensaje seguro basado en Hash (HMAC).</span><span class="sxs-lookup"><span data-stu-id="4f1f4-105">toosecure data stored in an Azure Cosmos DB database account, Azure Cosmos DB has provided support for a secret based [authorization model](https://msdn.microsoft.com/library/azure/dn783368.aspx) that utilizes a strong Hash-based message authentication code (HMAC).</span></span> <span data-ttu-id="4f1f4-106">Ahora, además toohello secreto basado en modelo de autorización, base de datos de Azure Cosmos admite directiva controlada por los controles de acceso basado en IP para la compatibilidad con firewall de entrada.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-106">Now, in addition toohello secret based authorization model, Azure Cosmos DB supports policy driven IP-based access controls for inbound firewall support.</span></span> <span data-ttu-id="4f1f4-107">Este modelo es muy similar reglas de firewall toohello de un sistema de base de datos tradicional y proporciona un nivel adicional de seguridad toohello cuenta de base de datos de la base de datos de Azure Cosmos.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-107">This model is very similar toohello firewall rules of a traditional database system and provides an additional level of security toohello Azure Cosmos DB database account.</span></span> <span data-ttu-id="4f1f4-108">Con este modelo, ahora puede configurar una toobe de cuenta de base de datos de base de datos de Azure Cosmos accesible sólo desde un conjunto de equipos aprobado o servicios en la nube.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-108">With this model, you can now configure an Azure Cosmos DB database account toobe accessible only from an approved set of machines and/or cloud services.</span></span> <span data-ttu-id="4f1f4-109">Tener acceso a recursos de base de datos de Cosmos tooAzure de estos conjuntos de aprobados de servicios y máquinas seguirán necesitando Hola llamador toopresent un token de autorización válido.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-109">Access tooAzure Cosmos DB resources from these approved sets of machines and services still require hello caller toopresent a valid authorization token.</span></span>

## <a name="ip-access-control-overview"></a><span data-ttu-id="4f1f4-110">Introducción al control de acceso IP</span><span class="sxs-lookup"><span data-stu-id="4f1f4-110">IP access control overview</span></span>
<span data-ttu-id="4f1f4-111">De forma predeterminada, una cuenta de base de datos de la base de datos de Azure Cosmos es accesible desde internet público como solicitud Hola está acompañado por un token de autorización válido.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-111">By default, an Azure Cosmos DB database account is accessible from public internet as long as hello request is accompanied by a valid authorization token.</span></span> <span data-ttu-id="4f1f4-112">control de acceso basado en directiva de tooconfigure IP, el usuario de hello debe proporcionar conjunto Hola de direcciones IP o intervalos de direcciones IP de CIDR formulario toobe incluidos como lista de direcciones IP de cliente para una cuenta de base de datos determinada de elementos permitido de Hola.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-112">tooconfigure IP policy-based access control, hello user must provide hello set of IP addresses or IP address ranges in CIDR form toobe included as hello allowed list of client IPs for a given database account.</span></span> <span data-ttu-id="4f1f4-113">Una vez que se aplique esta configuración, se bloquearán todas las solicitudes procedentes de máquinas de fuera de esta lista permitida por servidor hello.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-113">Once this configuration is applied, all requests originating from machines outside this allowed list will be blocked by hello server.</span></span>  <span data-ttu-id="4f1f4-114">conexión de Hello flujo de proceso de control de acceso basado en IP Hola se describe en hello siguiente diagrama.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-114">hello connection processing flow for hello IP-based access control is described in hello following diagram.</span></span>

![Diagrama que muestra el proceso de conexión de hello para el control de acceso basado en IP](./media/firewall-support/firewall-support-flow.png)

## <a name="connections-from-cloud-services"></a><span data-ttu-id="4f1f4-116">Conexiones desde servicios en la nube</span><span class="sxs-lookup"><span data-stu-id="4f1f4-116">Connections from cloud services</span></span>
<span data-ttu-id="4f1f4-117">En Azure, los servicios en la nube son una forma muy común de hospedar lógica de servicio de nivel intermedio mediante Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-117">In Azure, cloud services are a very common way for hosting middle tier service logic using Azure Cosmos DB.</span></span> <span data-ttu-id="4f1f4-118">tooenable acceso tooan cuenta de base de datos de base de datos de Azure Cosmos desde un servicio de nube, dirección IP pública de hello del servicio de nube de hello debe ser agregado toohello permitida la lista de direcciones IP asociadas a su cuenta de base de datos de la base de datos de Azure Cosmos por [configuración Hola directiva de control de acceso IP](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="4f1f4-118">tooenable access tooan Azure Cosmos DB database account from a cloud service, hello public IP address of hello cloud service must be added toohello allowed list of IP addresses associated with your Azure Cosmos DB database account by [configuring hello IP access control policy](#configure-ip-policy).</span></span>  <span data-ttu-id="4f1f4-119">Esto garantiza que todas las instancias de rol de servicios en la nube tienen acceso tooyour cuenta de base de datos de la base de datos de Azure Cosmos.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-119">This ensures that all role instances of cloud services have access tooyour Azure Cosmos DB database account.</span></span> <span data-ttu-id="4f1f4-120">Puede recuperar direcciones IP para los servicios de nube en hello portal de Azure, como se muestra en la siguiente captura de pantalla de Hola.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-120">You can retrieve IP addresses for your cloud services in hello Azure portal, as shown in hello following screenshot.</span></span>

![Captura de pantalla muestra la dirección IP pública de Hola para un servicio de nube que se muestran en hello portal de Azure](./media/firewall-support/public-ip-addresses.png)

<span data-ttu-id="4f1f4-122">Al escalar horizontalmente su servicio de nube mediante la adición de las instancias de rol adicionales, esas nuevas instancias tendrán automáticamente cuenta de base de datos de base de datos de Azure Cosmos acceso toohello ya que forman parte del programa Hola mismo servicio en la nube.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-122">When you scale out your cloud service by adding additional role instance(s), those new instances will automatically have access toohello Azure Cosmos DB database account since they are part of hello same cloud service.</span></span>

## <a name="connections-from-virtual-machines"></a><span data-ttu-id="4f1f4-123">Conexiones desde máquinas virtuales</span><span class="sxs-lookup"><span data-stu-id="4f1f4-123">Connections from virtual machines</span></span>
<span data-ttu-id="4f1f4-124">[Máquinas virtuales](https://azure.microsoft.com/services/virtual-machines/) o [conjuntos de escalas de máquina virtual](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) también puede ser usado toohost de servicios de nivel intermedio con la base de datos de Azure Cosmos.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-124">[Virtual machines](https://azure.microsoft.com/services/virtual-machines/) or [virtual machine scale sets](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) can also be used toohost middle tier services using Azure Cosmos DB.</span></span>  <span data-ttu-id="4f1f4-125">Hola tooconfigure acceso de tooallow de cuenta de base de datos de base de datos de Azure Cosmos desde máquinas virtuales, las direcciones IP públicas de máquina virtual o conjunto de escalas de máquina virtual debe estar configurado como uno de hello permitida direcciones IP para la cuenta de base de datos de la base de datos de Azure Cosmos por [configurar Directiva de control de acceso IP de hello](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="4f1f4-125">tooconfigure hello Azure Cosmos DB database account tooallow access from virtual machines, public IP addresses of virtual machine and/or virtual machine scale set must be configured as one of hello allowed IP addresses for your Azure Cosmos DB database account by [configuring hello IP access control policy](#configure-ip-policy).</span></span> <span data-ttu-id="4f1f4-126">Puede recuperar direcciones IP para máquinas virtuales en hello portal de Azure, como se muestra en la siguiente captura de pantalla de Hola.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-126">You can retrieve IP addresses for virtual machines in hello Azure portal, as shown in hello following screenshot.</span></span>

![Captura de pantalla muestra una dirección IP pública de una máquina virtual que muestra en hello portal de Azure](./media/firewall-support/public-ip-addresses-dns.png)

<span data-ttu-id="4f1f4-128">Cuando se agrega el grupo de toohello de instancias de máquina virtual adicional, se proporcionan automáticamente cuenta de base de datos de base de datos de Azure Cosmos acceso tooyour.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-128">When you add additional virtual machine instances toohello group, they are automatically provided access tooyour Azure Cosmos DB database account.</span></span>

## <a name="connections-from-hello-internet"></a><span data-ttu-id="4f1f4-129">Hola de conexiones de internet</span><span class="sxs-lookup"><span data-stu-id="4f1f4-129">Connections from hello internet</span></span>
<span data-ttu-id="4f1f4-130">Cuando el acceso a una base de datos de Azure Cosmos la base de datos cuenta desde un equipo en hello internet, hello dirección IP del cliente o intervalo de direcciones IP de la máquina de hello debe ser agregado toohello lista de direcciones IP para la cuenta de base de datos de la base de datos de Azure Cosmos Hola de elementos permitido.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-130">When you access an Azure Cosmos DB database account from a computer on hello internet, hello client IP address or IP address range of hello machine must be added toohello allowed list of IP address for hello Azure Cosmos DB database account.</span></span> 

## <span data-ttu-id="4f1f4-131"><a id="configure-ip-policy"></a>Configurar la directiva de control de acceso IP de Hola</span><span class="sxs-lookup"><span data-stu-id="4f1f4-131"><a id="configure-ip-policy"></a> Configuring hello IP access control policy</span></span>
<span data-ttu-id="4f1f4-132">Directiva de control de acceso de Hello IP se puede establecer en hello portal de Azure, o mediante programación a través [CLI de Azure](cli-samples.md), [Azure Powershell](powershell-samples.md), o hello [API de REST](/rest/api/documentdb/) actualizando hello `ipRangeFilter` propiedad.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-132">hello IP access control policy can be set in hello Azure portal, or programmatically through [Azure CLI](cli-samples.md), [Azure Powershell](powershell-samples.md), or hello [REST API](/rest/api/documentdb/) by updating hello `ipRangeFilter` property.</span></span> <span data-ttu-id="4f1f4-133">Los intervalos o direcciones IP deben ir separados por una coma y no deben contener espacios.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-133">IP addresses/ranges must be comma separated and must not contain any spaces.</span></span> <span data-ttu-id="4f1f4-134">Ejemplo: "13.91.6.132,13.91.6.1/24".</span><span class="sxs-lookup"><span data-stu-id="4f1f4-134">Example: "13.91.6.132,13.91.6.1/24".</span></span> <span data-ttu-id="4f1f4-135">Al actualizar la cuenta de base de datos a través de estos métodos, ser toopopulate seguro todos Hola propiedades tooprevent restablecer la configuración de toodefault.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-135">When updating your database account through these methods, be sure toopopulate all of hello properties tooprevent resetting toodefault settings.</span></span>

> [!NOTE]
> <span data-ttu-id="4f1f4-136">Al habilitar una directiva de control de acceso IP para la cuenta de base de datos de la base de datos de Azure Cosmos, todos los acceso tooyour cuenta de base de datos de base de datos de Azure Cosmos de máquinas de fuera Hola configurado permite lista de intervalos de direcciones IP están bloqueados.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-136">By enabling an IP access control policy for your Azure Cosmos DB database account, all access tooyour Azure Cosmos DB database account from machines outside hello configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="4f1f4-137">En virtud de este modelo, exploración de operación de plano de datos de Hola desde el portal de hello también será bloqueado tooensure Hola integridad de control de acceso.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-137">By virtue of this model, browsing hello data plane operation from hello portal will also be blocked tooensure hello integrity of access control.</span></span>

<span data-ttu-id="4f1f4-138">desarrollo de toosimplify, Hola portal de Azure le ayuda a identificar y agregar IP de Hola de su toohello de equipo cliente, lista de permitidos para que las aplicaciones que se ejecutan en el equipo pueden tener acceso a la cuenta de base de datos de Azure Cosmos Hola.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-138">toosimplify development, hello Azure portal helps you identify and add hello IP of your client machine toohello allowed list, so that apps running your machine can access hello Azure Cosmos DB account.</span></span> <span data-ttu-id="4f1f4-139">Tenga en cuenta que se detecta la dirección IP de cliente de hello aquí tal como se muestra en el portal de Hola.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-139">Note that hello client IP address here is detected as seen by hello portal.</span></span> <span data-ttu-id="4f1f4-140">Es posible dirección IP del cliente Hola de su equipo, pero también podría ser Hola de dirección IP de la puerta de enlace de red.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-140">It may be hello client IP address of your machine, but it could also be hello IP address of your network gateway.</span></span> <span data-ttu-id="4f1f4-141">No olvide tooremove con anterioridad tooproduction continuo.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-141">Do not forget tooremove it before going tooproduction.</span></span>

<span data-ttu-id="4f1f4-142">Directiva de control de acceso IP de tooset Hola Hola portal de Azure, navegue hoja de cuenta de base de datos de Azure Cosmos toohello, haga clic en **Firewall** en el menú de navegación de hello, a continuación, haga clic en **ON**</span><span class="sxs-lookup"><span data-stu-id="4f1f4-142">tooset hello IP access control policy in hello Azure portal, navigate toohello Azure Cosmos DB account blade, click **Firewall** in hello navigation menu, then click **ON**</span></span> 

![Captura de pantalla muestra cómo tooopen Hola hoja de Firewall en hello portal de Azure](./media/firewall-support/azure-portal-firewall.png)

<span data-ttu-id="4f1f4-144">En el nuevo panel de hello, especifique si hello portal de Azure puede tener acceso a la cuenta de hello y otras direcciones e intervalos según corresponda, a continuación, haga clic en **guardar**.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-144">In hello new pane, specify whether hello Azure portal can access hello account, and add other addresses and ranges as appropriate, then click **Save**.</span></span>  

> [!NOTE]
> <span data-ttu-id="4f1f4-145">Cuando se habilita una directiva de control de acceso IP, necesitará la dirección IP de Hola de tooadd para hello acceso toomaintain de portal de Azure.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-145">When you enable an IP access control policy, you need tooadd hello IP address for hello Azure portal toomaintain access.</span></span> <span data-ttu-id="4f1f4-146">direcciones IP de portal Hola son:</span><span class="sxs-lookup"><span data-stu-id="4f1f4-146">hello portal IP addresses are:</span></span>
> |<span data-ttu-id="4f1f4-147">Region</span><span class="sxs-lookup"><span data-stu-id="4f1f4-147">Region</span></span>|<span data-ttu-id="4f1f4-148">Dirección IP</span><span class="sxs-lookup"><span data-stu-id="4f1f4-148">IP address</span></span>|
> |------|----------|
> |<span data-ttu-id="4f1f4-149">Todas las regiones, a excepción de las especificadas a continuación</span><span class="sxs-lookup"><span data-stu-id="4f1f4-149">All regions except those specified below</span></span>| <span data-ttu-id="4f1f4-150">104.42.195.92</span><span class="sxs-lookup"><span data-stu-id="4f1f4-150">104.42.195.92</span></span>|
> |<span data-ttu-id="4f1f4-151">Alemania</span><span class="sxs-lookup"><span data-stu-id="4f1f4-151">Germany</span></span>|<span data-ttu-id="4f1f4-152">51.4.229.218</span><span class="sxs-lookup"><span data-stu-id="4f1f4-152">51.4.229.218</span></span>|
> |<span data-ttu-id="4f1f4-153">China</span><span class="sxs-lookup"><span data-stu-id="4f1f4-153">China</span></span>|<span data-ttu-id="4f1f4-154">139.217.8.252</span><span class="sxs-lookup"><span data-stu-id="4f1f4-154">139.217.8.252</span></span>|
> |<span data-ttu-id="4f1f4-155">Gobierno de EE. UU.: Arizona</span><span class="sxs-lookup"><span data-stu-id="4f1f4-155">US Gov Arizona</span></span>|<span data-ttu-id="4f1f4-156">52.244.48.71</span><span class="sxs-lookup"><span data-stu-id="4f1f4-156">52.244.48.71</span></span>|
>

![Captura de pantalla muestra cómo tooconfigure configuración del firewall en hello portal de Azure](./media/firewall-support/azure-portal-firewall-configure.png)

## <a name="troubleshooting-hello-ip-access-control-policy"></a><span data-ttu-id="4f1f4-158">Solución de problemas de directiva de control de acceso IP de Hola</span><span class="sxs-lookup"><span data-stu-id="4f1f4-158">Troubleshooting hello IP access control policy</span></span>
### <a name="portal-operations"></a><span data-ttu-id="4f1f4-159">Operaciones del portal</span><span class="sxs-lookup"><span data-stu-id="4f1f4-159">Portal operations</span></span>
<span data-ttu-id="4f1f4-160">Al habilitar una directiva de control de acceso IP para la cuenta de base de datos de la base de datos de Azure Cosmos, todos los acceso tooyour cuenta de base de datos de base de datos de Azure Cosmos de máquinas de fuera Hola configurado permite lista de intervalos de direcciones IP están bloqueados.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-160">By enabling an IP access control policy for your Azure Cosmos DB database account, all access tooyour Azure Cosmos DB database account from machines outside hello configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="4f1f4-161">Por lo tanto, si desea que las operaciones del plano de datos del portal de tooenable como navegar por las colecciones y consultar documentos, debe tooexplicitly permitir acceso de portal de Azure con hello **Firewall** hoja en el portal de Hola.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-161">Therefore if you want tooenable portal data plane operations like browsing collections and query documents, you need tooexplicitly allow Azure portal access using hello **Firewall** blade in hello portal.</span></span> 

![Captura de pantalla muestra cómo tooenable acceso toohello portal de Azure](./media/firewall-support/azure-portal-access-firewall.png)

### <a name="sdk--rest-api"></a><span data-ttu-id="4f1f4-163">SDK y API de Rest</span><span class="sxs-lookup"><span data-stu-id="4f1f4-163">SDK & Rest API</span></span>
<span data-ttu-id="4f1f4-164">Por motivos de seguridad, acceso a través de SDK o API de REST de máquinas no en la lista de elementos permitidos de hello devolverá un genérico respuesta de no encuentra 404 con ningún detalle adicional.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-164">For security reasons, access via SDK or REST API from machines not on hello allowed list will return a generic 404 Not Found response with no additional details.</span></span> <span data-ttu-id="4f1f4-165">Compruebe que IP Hola permitido lista configurada para la configuración de directiva correcta de base de datos de Azure Cosmos base de datos cuenta tooensure hello es aplicado tooyour cuenta de base de datos de la base de datos de Azure Cosmos.</span><span class="sxs-lookup"><span data-stu-id="4f1f4-165">Please verify hello IP allowed list configured for your Azure Cosmos DB database account tooensure hello correct policy configuration is applied tooyour Azure Cosmos DB database account.</span></span>

## <a name="next-steps"></a><span data-ttu-id="4f1f4-166">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="4f1f4-166">Next steps</span></span>
<span data-ttu-id="4f1f4-167">Para más información sobre las sugerencias de rendimiento relacionadas con la red, consulte [Sugerencias de rendimiento](performance-tips.md).</span><span class="sxs-lookup"><span data-stu-id="4f1f4-167">For information about network related performance tips, see [Performance tips](performance-tips.md).</span></span>


---
title: Compatibilidad con el firewall de Azure Cosmos DB y control de acceso basado en IP | Microsoft Docs
description: Aprenda a usar directivas de control de acceso IP para la compatibilidad con el firewall en cuentas de base de datos de Azure Cosmos DB.
keywords: Control de acceso IP, compatibilidad con el firewall
services: cosmos-db
author: shahankur11
manager: jhubbard
editor: 
tags: azure-resource-manager
documentationcenter: 
ms.assetid: c1b9ede0-ed93-411a-ac9a-62c113a8e887
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/22/2017
ms.author: ankshah
ms.openlocfilehash: e08c0ba9c1fc0bab72ae8c1158aafaad4f66920e
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="azure-cosmos-db-firewall-support"></a><span data-ttu-id="6e9e7-104">Compatibilidad con un firewall de Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="6e9e7-104">Azure Cosmos DB firewall support</span></span>
<span data-ttu-id="6e9e7-105">Para proteger los datos almacenados en una cuenta de base de datos de Azure Cosmos DB, este proporciona compatibilidad con un [modelo de autorización](https://msdn.microsoft.com/library/azure/dn783368.aspx) basado en secreto que utiliza un código seguro de autenticación de mensajes basado en hash (HMAC).</span><span class="sxs-lookup"><span data-stu-id="6e9e7-105">To secure data stored in an Azure Cosmos DB database account, Azure Cosmos DB has provided support for a secret based [authorization model](https://msdn.microsoft.com/library/azure/dn783368.aspx) that utilizes a strong Hash-based message authentication code (HMAC).</span></span> <span data-ttu-id="6e9e7-106">Ahora, además del modelo de autorización basado en secreto, Azure Cosmos DB admite controles de acceso basado en IP orientado a directivas para la compatibilidad con el firewall de entrada.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-106">Now, in addition to the secret based authorization model, Azure Cosmos DB supports policy driven IP-based access controls for inbound firewall support.</span></span> <span data-ttu-id="6e9e7-107">Este modelo es muy parecido a las reglas de firewall de un sistema de base de datos tradicional y proporciona un nivel de seguridad adicional para la cuenta de base de datos de Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-107">This model is very similar to the firewall rules of a traditional database system and provides an additional level of security to the Azure Cosmos DB database account.</span></span> <span data-ttu-id="6e9e7-108">Con él, ahora puede configurar una cuenta de base de datos de Azure Cosmos DB para que solo sea accesible desde un conjunto aprobado de máquinas o servicios en la nube.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-108">With this model, you can now configure an Azure Cosmos DB database account to be accessible only from an approved set of machines and/or cloud services.</span></span> <span data-ttu-id="6e9e7-109">El acceso a recursos de Azure Cosmos DB desde estos conjuntos aprobados de máquinas y servicios requerirá que el autor de la llamada presente un token de autorización válido.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-109">Access to Azure Cosmos DB resources from these approved sets of machines and services still require the caller to present a valid authorization token.</span></span>

## <a name="ip-access-control-overview"></a><span data-ttu-id="6e9e7-110">Introducción al control de acceso IP</span><span class="sxs-lookup"><span data-stu-id="6e9e7-110">IP access control overview</span></span>
<span data-ttu-id="6e9e7-111">De forma predeterminada, una cuenta de base de datos de Azure Cosmos DB es accesible desde la red Internet pública siempre y cuando la solicitud vaya acompañada de un token de autorización válido.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-111">By default, an Azure Cosmos DB database account is accessible from public internet as long as the request is accompanied by a valid authorization token.</span></span> <span data-ttu-id="6e9e7-112">Para configurar el control de acceso basado en directiva IP, el usuario debe proporcionar el conjunto de direcciones IP o los intervalos de direcciones IP en formato CIDR para incluir en la lista permitida de direcciones IP de cliente para una cuenta de base de datos dada.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-112">To configure IP policy-based access control, the user must provide the set of IP addresses or IP address ranges in CIDR form to be included as the allowed list of client IPs for a given database account.</span></span> <span data-ttu-id="6e9e7-113">Una vez que se aplica esta configuración, el servidor bloquea todas las solicitudes que se originan en máquinas que están fuera de esta lista de permitidos.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-113">Once this configuration is applied, all requests originating from machines outside this allowed list will be blocked by the server.</span></span>  <span data-ttu-id="6e9e7-114">En el diagrama siguiente, se describe el flujo de proceso de conexión para el control de acceso basado en IP.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-114">The connection processing flow for the IP-based access control is described in the following diagram.</span></span>

![Diagrama que muestra el proceso de conexión para el control de acceso basado en IP](./media/firewall-support/firewall-support-flow.png)

## <a name="connections-from-cloud-services"></a><span data-ttu-id="6e9e7-116">Conexiones desde servicios en la nube</span><span class="sxs-lookup"><span data-stu-id="6e9e7-116">Connections from cloud services</span></span>
<span data-ttu-id="6e9e7-117">En Azure, los servicios en la nube son una forma muy común de hospedar lógica de servicio de nivel intermedio mediante Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-117">In Azure, cloud services are a very common way for hosting middle tier service logic using Azure Cosmos DB.</span></span> <span data-ttu-id="6e9e7-118">Para permitir el acceso a una cuenta de base de datos de Azure Cosmos DB desde un servicio en la nube, la dirección IP pública del servicio en la nube se debe agregar a la lista de direcciones IP permitidas asociada a dicha cuenta mediante la [configuración de la directiva de control de acceso a la dirección IP](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="6e9e7-118">To enable access to an Azure Cosmos DB database account from a cloud service, the public IP address of the cloud service must be added to the allowed list of IP addresses associated with your Azure Cosmos DB database account by [configuring the IP access control policy](#configure-ip-policy).</span></span>  <span data-ttu-id="6e9e7-119">De esta forma se garantiza que todas las instancias de rol de servicios en la nube tengan acceso a la cuenta de base de datos de Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-119">This ensures that all role instances of cloud services have access to your Azure Cosmos DB database account.</span></span> <span data-ttu-id="6e9e7-120">Puede recuperar las direcciones IP para los servicios de nube en Azure Portal, como se muestra en la siguiente captura de pantalla.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-120">You can retrieve IP addresses for your cloud services in the Azure portal, as shown in the following screenshot.</span></span>

![Captura de pantalla con la dirección IP pública de un servicio en la nube que se muestra en Azure Portal](./media/firewall-support/public-ip-addresses.png)

<span data-ttu-id="6e9e7-122">Al escalar horizontalmente su servicio de nube mediante la adición de instancias de rol adicionales, esas nuevas instancias tendrán acceso automáticamente a la cuenta de base de datos de Azure Cosmos DB que forman parte del mismo servicio en la nube.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-122">When you scale out your cloud service by adding additional role instance(s), those new instances will automatically have access to the Azure Cosmos DB database account since they are part of the same cloud service.</span></span>

## <a name="connections-from-virtual-machines"></a><span data-ttu-id="6e9e7-123">Conexiones desde máquinas virtuales</span><span class="sxs-lookup"><span data-stu-id="6e9e7-123">Connections from virtual machines</span></span>
<span data-ttu-id="6e9e7-124">También se pueden usar [máquinas virtuales](https://azure.microsoft.com/services/virtual-machines/) o [conjuntos de escalado de máquinas virtuales](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) para hospedar servicios de nivel intermedio mediante Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-124">[Virtual machines](https://azure.microsoft.com/services/virtual-machines/) or [virtual machine scale sets](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) can also be used to host middle tier services using Azure Cosmos DB.</span></span>  <span data-ttu-id="6e9e7-125">Para configurar la cuenta de base de datos de Azure Cosmos DB con el fin de permitir el acceso desde máquinas virtuales, se deben configurar direcciones IP públicas de máquina virtual o un conjunto de escalado de máquinas virtuales como una de las direcciones IP permitidas para dicha cuenta mediante la [configuración de la directiva de control de acceso a la dirección IP](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="6e9e7-125">To configure the Azure Cosmos DB database account to allow access from virtual machines, public IP addresses of virtual machine and/or virtual machine scale set must be configured as one of the allowed IP addresses for your Azure Cosmos DB database account by [configuring the IP access control policy](#configure-ip-policy).</span></span> <span data-ttu-id="6e9e7-126">Puede recuperar las direcciones IP para máquinas virtuales en Azure Portal, como se muestra en la captura de pantalla siguiente.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-126">You can retrieve IP addresses for virtual machines in the Azure portal, as shown in the following screenshot.</span></span>

![Captura de pantalla con una dirección IP pública de una máquina virtual que se muestra en Azure Portal](./media/firewall-support/public-ip-addresses-dns.png)

<span data-ttu-id="6e9e7-128">Al agregar instancias adicionales de máquina virtual al grupo, se les proporciona automáticamente acceso a su cuenta de base de datos de Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-128">When you add additional virtual machine instances to the group, they are automatically provided access to your Azure Cosmos DB database account.</span></span>

## <a name="connections-from-the-internet"></a><span data-ttu-id="6e9e7-129">Conexiones desde Internet</span><span class="sxs-lookup"><span data-stu-id="6e9e7-129">Connections from the internet</span></span>
<span data-ttu-id="6e9e7-130">Cuando se accede a una cuenta de base de datos de Azure Cosmos DB desde un equipo de Internet, se debe agregar la dirección IP del cliente o el intervalo de direcciones IP de la máquina a la lista de direcciones IP permitidas para dicha cuenta.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-130">When you access an Azure Cosmos DB database account from a computer on the internet, the client IP address or IP address range of the machine must be added to the allowed list of IP address for the Azure Cosmos DB database account.</span></span> 

## <span data-ttu-id="6e9e7-131"><a id="configure-ip-policy"></a> Configuración de la directiva de control de acceso IP</span><span class="sxs-lookup"><span data-stu-id="6e9e7-131"><a id="configure-ip-policy"></a> Configuring the IP access control policy</span></span>
<span data-ttu-id="6e9e7-132">La directiva de control de acceso basado en IP se puede establecer en Azure Portal mediante programación a través la [CLI de Azure](cli-samples.md), [Azure Powershell](powershell-samples.md) o la [API de REST](/rest/api/documentdb/) actualizando la propiedad `ipRangeFilter`.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-132">The IP access control policy can be set in the Azure portal, or programmatically through [Azure CLI](cli-samples.md), [Azure Powershell](powershell-samples.md), or the [REST API](/rest/api/documentdb/) by updating the `ipRangeFilter` property.</span></span> <span data-ttu-id="6e9e7-133">Los intervalos o direcciones IP deben ir separados por una coma y no deben contener espacios.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-133">IP addresses/ranges must be comma separated and must not contain any spaces.</span></span> <span data-ttu-id="6e9e7-134">Ejemplo: "13.91.6.132,13.91.6.1/24".</span><span class="sxs-lookup"><span data-stu-id="6e9e7-134">Example: "13.91.6.132,13.91.6.1/24".</span></span> <span data-ttu-id="6e9e7-135">Al actualizar la cuenta de la base de datos mediante estos métodos, asegúrese de rellenar todas las propiedades para evitar que se restablezca la configuración predeterminada.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-135">When updating your database account through these methods, be sure to populate all of the properties to prevent resetting to default settings.</span></span>

> [!NOTE]
> <span data-ttu-id="6e9e7-136">Al habilitar una directiva de control de acceso IP para su cuenta de base de datos de Azure Cosmos DB, todo el acceso a esta cuenta desde máquinas fuera de la lista configurada de intervalos de direcciones IP permitidas se bloquea.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-136">By enabling an IP access control policy for your Azure Cosmos DB database account, all access to your Azure Cosmos DB database account from machines outside the configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="6e9e7-137">En virtud de este modelo, la exploración de la operación de plano de datos desde el portal también se bloqueará para garantizar la integridad del control de acceso.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-137">By virtue of this model, browsing the data plane operation from the portal will also be blocked to ensure the integrity of access control.</span></span>

<span data-ttu-id="6e9e7-138">Para simplificar el desarrollo, Azure Portal lo ayuda a identificar y agregar la dirección IP de su equipo cliente a la lista de permitidos, por lo que las aplicaciones que se ejecutan en la máquina pueden tener acceso a la cuenta de Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-138">To simplify development, the Azure portal helps you identify and add the IP of your client machine to the allowed list, so that apps running your machine can access the Azure Cosmos DB account.</span></span> <span data-ttu-id="6e9e7-139">Tenga en cuenta que la dirección IP de cliente se detecta tal como se muestra en el Portal.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-139">Note that the client IP address here is detected as seen by the portal.</span></span> <span data-ttu-id="6e9e7-140">Es posible que sea la dirección IP del cliente de la máquina, pero también podría ser la de la puerta de enlace de red.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-140">It may be the client IP address of your machine, but it could also be the IP address of your network gateway.</span></span> <span data-ttu-id="6e9e7-141">No olvide quitarla antes de pasar a la fase de producción.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-141">Do not forget to remove it before going to production.</span></span>

<span data-ttu-id="6e9e7-142">Para establecer la directiva de control de acceso de IP en Azure Portal, vaya a la hoja de la cuenta de Azure Cosmos DB, haga clic en **Firewall** en el menú de navegación, y en **ACTIVADO**.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-142">To set the IP access control policy in the Azure portal, navigate to the Azure Cosmos DB account blade, click **Firewall** in the navigation menu, then click **ON**</span></span> 

![Captura de pantalla que muestra cómo abrir la hoja Firewall en Azure Portal](./media/firewall-support/azure-portal-firewall.png)

<span data-ttu-id="6e9e7-144">En el panel nuevo, especifique si Azure Portal puede tener acceso a la cuenta y agregar otras direcciones e intervalos según corresponda. Después, haga clic en **Guardar**.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-144">In the new pane, specify whether the Azure portal can access the account, and add other addresses and ranges as appropriate, then click **Save**.</span></span>  

> [!NOTE]
> <span data-ttu-id="6e9e7-145">Cuando se habilita una directiva de control de acceso de IP, debe agregar la dirección IP correspondiente a Azure Portal para mantener el acceso.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-145">When you enable an IP access control policy, you need to add the IP address for the Azure portal to maintain access.</span></span> <span data-ttu-id="6e9e7-146">Las direcciones IP del portal son las siguientes:</span><span class="sxs-lookup"><span data-stu-id="6e9e7-146">The portal IP addresses are:</span></span>
> |<span data-ttu-id="6e9e7-147">Region</span><span class="sxs-lookup"><span data-stu-id="6e9e7-147">Region</span></span>|<span data-ttu-id="6e9e7-148">Dirección IP</span><span class="sxs-lookup"><span data-stu-id="6e9e7-148">IP address</span></span>|
> |------|----------|
> |<span data-ttu-id="6e9e7-149">Todas las regiones, a excepción de las especificadas a continuación</span><span class="sxs-lookup"><span data-stu-id="6e9e7-149">All regions except those specified below</span></span>| <span data-ttu-id="6e9e7-150">104.42.195.92</span><span class="sxs-lookup"><span data-stu-id="6e9e7-150">104.42.195.92</span></span>|
> |<span data-ttu-id="6e9e7-151">Alemania</span><span class="sxs-lookup"><span data-stu-id="6e9e7-151">Germany</span></span>|<span data-ttu-id="6e9e7-152">51.4.229.218</span><span class="sxs-lookup"><span data-stu-id="6e9e7-152">51.4.229.218</span></span>|
> |<span data-ttu-id="6e9e7-153">China</span><span class="sxs-lookup"><span data-stu-id="6e9e7-153">China</span></span>|<span data-ttu-id="6e9e7-154">139.217.8.252</span><span class="sxs-lookup"><span data-stu-id="6e9e7-154">139.217.8.252</span></span>|
> |<span data-ttu-id="6e9e7-155">Gobierno de EE. UU.: Arizona</span><span class="sxs-lookup"><span data-stu-id="6e9e7-155">US Gov Arizona</span></span>|<span data-ttu-id="6e9e7-156">52.244.48.71</span><span class="sxs-lookup"><span data-stu-id="6e9e7-156">52.244.48.71</span></span>|
>

![Captura de pantalla que muestra cómo configurar un firewall en Azure Portal](./media/firewall-support/azure-portal-firewall-configure.png)

## <a name="troubleshooting-the-ip-access-control-policy"></a><span data-ttu-id="6e9e7-158">Solución de problemas de la directiva de control de acceso IP</span><span class="sxs-lookup"><span data-stu-id="6e9e7-158">Troubleshooting the IP access control policy</span></span>
### <a name="portal-operations"></a><span data-ttu-id="6e9e7-159">Operaciones del portal</span><span class="sxs-lookup"><span data-stu-id="6e9e7-159">Portal operations</span></span>
<span data-ttu-id="6e9e7-160">Al habilitar una directiva de control de acceso IP para su cuenta de base de datos de Azure Cosmos DB, todo el acceso a esta cuenta desde máquinas fuera de la lista configurada de intervalos de direcciones IP permitidas se bloquea.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-160">By enabling an IP access control policy for your Azure Cosmos DB database account, all access to your Azure Cosmos DB database account from machines outside the configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="6e9e7-161">Por lo tanto, si desea habilitar las operaciones en el plano de los datos del Portal como explorar las colecciones y consultar documentos, debe permitir expresamente el acceso a Azure Portal usando la hoja **Firewall** del Portal.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-161">Therefore if you want to enable portal data plane operations like browsing collections and query documents, you need to explicitly allow Azure portal access using the **Firewall** blade in the portal.</span></span> 

![Captura de pantalla que muestra cómo habilitar el acceso a Azure Portal](./media/firewall-support/azure-portal-access-firewall.png)

### <a name="sdk--rest-api"></a><span data-ttu-id="6e9e7-163">SDK y API de Rest</span><span class="sxs-lookup"><span data-stu-id="6e9e7-163">SDK & Rest API</span></span>
<span data-ttu-id="6e9e7-164">Por motivos de seguridad, el acceso a través del SDK o la API de REST desde máquinas que no en la lista de permitidos, devolverá una respuesta genérica 404 No encontrado sin más detalles.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-164">For security reasons, access via SDK or REST API from machines not on the allowed list will return a generic 404 Not Found response with no additional details.</span></span> <span data-ttu-id="6e9e7-165">Compruebe la lista de direcciones IP permitidas configurada para su cuenta de base de datos de Azure Cosmos DB para asegurarse de que se aplica la configuración de directiva correcta a dicha cuenta.</span><span class="sxs-lookup"><span data-stu-id="6e9e7-165">Please verify the IP allowed list configured for your Azure Cosmos DB database account to ensure the correct policy configuration is applied to your Azure Cosmos DB database account.</span></span>

## <a name="next-steps"></a><span data-ttu-id="6e9e7-166">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="6e9e7-166">Next steps</span></span>
<span data-ttu-id="6e9e7-167">Para más información sobre las sugerencias de rendimiento relacionadas con la red, consulte [Sugerencias de rendimiento](performance-tips.md).</span><span class="sxs-lookup"><span data-stu-id="6e9e7-167">For information about network related performance tips, see [Performance tips](performance-tips.md).</span></span>


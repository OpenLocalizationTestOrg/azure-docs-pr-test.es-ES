---
title: "Métricas de consulta de SQL para la API de DocumentDB de Azure Cosmos DB | Microsoft Docs"
description: "Aprenda cómo instrumentar y depurar el rendimiento de consultas SQL de las solicitudes de Azure Cosmos DB."
keywords: consulta sql, consultas sql, sintaxis sql, lenguaje de consulta json, conceptos de base de datos y consultas sql, funciones de agregado
services: cosmos-db
documentationcenter: 
author: arramac
manager: jhubbard
editor: monicar
ms.assetid: b2fa8e8f-7291-45a3-9bd1-7284ed9077f8
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/15/2017
ms.author: arramac
ms.openlocfilehash: d928113e809e5ad43901e79dc256a8a39c210181
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/18/2017
---
# <a name="tuning-query-performance-with-azure-cosmos-db"></a><span data-ttu-id="6532f-104">Optimización del rendimiento de consultas con Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="6532f-104">Tuning query performance with Azure Cosmos DB</span></span>
<span data-ttu-id="6532f-105">Azure Cosmos DB proporciona una [API de SQL para consultar datos](documentdb-sql-query.md), sin necesidad de índices de esquema o secundarios.</span><span class="sxs-lookup"><span data-stu-id="6532f-105">Azure Cosmos DB provides a [SQL API for querying data](documentdb-sql-query.md), without requiring schema or secondary indexes.</span></span> <span data-ttu-id="6532f-106">En este artículo se proporciona la siguiente información para los desarrolladores:</span><span class="sxs-lookup"><span data-stu-id="6532f-106">This article provides the following information for developers:</span></span>

* <span data-ttu-id="6532f-107">Detalles de alto nivel sobre cómo funciona la ejecución de consultas SQL de Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="6532f-107">High-level details on how Azure Cosmos DB's SQL query execution works</span></span>
* <span data-ttu-id="6532f-108">Detalles sobre cómo consultar encabezados de solicitud y respuesta y opciones del SDK de cliente</span><span class="sxs-lookup"><span data-stu-id="6532f-108">Details on query request and response headers, and client SDK options</span></span>
* <span data-ttu-id="6532f-109">Sugerencias y procedimientos recomendados para el rendimiento de consultas</span><span class="sxs-lookup"><span data-stu-id="6532f-109">Tips and best practices for query performance</span></span>
* <span data-ttu-id="6532f-110">Ejemplos de cómo usar estadísticas de ejecución de SQL para depurar el rendimiento de las consultas</span><span class="sxs-lookup"><span data-stu-id="6532f-110">Examples of how to utilize SQL execution statistics to debug query performance</span></span>

## <a name="about-sql-query-execution"></a><span data-ttu-id="6532f-111">Acerca de la ejecución de consultas SQL</span><span class="sxs-lookup"><span data-stu-id="6532f-111">About SQL query execution</span></span>

<span data-ttu-id="6532f-112">En Azure Cosmos DB, se almacenan los datos en contenedores, que pueden crecer hasta cualquier [tamaño de almacenamiento o rendimiento de las solicitudes](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="6532f-112">In Azure Cosmos DB, you store data in containers, which can grow to any [storage size or request throughput](partition-data.md).</span></span> <span data-ttu-id="6532f-113">Azure Cosmos DB escala los datos de forma fluida entre particiones físicas en segundo plano para controlar el crecimiento de los datos o el aumento del rendimiento aprovisionado.</span><span class="sxs-lookup"><span data-stu-id="6532f-113">Azure Cosmos DB seamlessly scales data across physical partitions under the covers to handle data growth or increase in provisioned throughput.</span></span> <span data-ttu-id="6532f-114">Puede emitir consultas SQL a cualquier contenedor mediante la API de REST o uno de los [SDK de DocumentDB](documentdb-sdk-dotnet.md) compatibles.</span><span class="sxs-lookup"><span data-stu-id="6532f-114">You can issue SQL queries to any container using the REST API or one of the supported [DocumentDB SDKs](documentdb-sdk-dotnet.md).</span></span>

<span data-ttu-id="6532f-115">Una breve introducción a la creación de particiones: se define una clave de partición como "ciudad", que determina la forma en que los datos se dividen entre particiones físicas.</span><span class="sxs-lookup"><span data-stu-id="6532f-115">A brief overview of partitioning: you define a partition key like "city", which determines how data is split across physical partitions.</span></span> <span data-ttu-id="6532f-116">Los datos que pertenecen a una única clave de partición (por ejemplo, "city" == "Seattle") se almacenan en una partición física, pero normalmente una única partición física tiene varias claves de partición.</span><span class="sxs-lookup"><span data-stu-id="6532f-116">Data belonging to a single partition key (for example, "city" == "Seattle") is stored within a physical partition, but typically a single physical partition has multiple partition keys.</span></span> <span data-ttu-id="6532f-117">Cuando una partición alcanza su tamaño de almacenamiento, el servicio divide de forma fluida la partición en dos nuevas particiones y divide la clave de partición uniformemente entre estas particiones.</span><span class="sxs-lookup"><span data-stu-id="6532f-117">When a partition reaches its storage size, the service seamlessly splits the partition into two new partitions, and divides the partition key evenly across these partitions.</span></span> <span data-ttu-id="6532f-118">Como las particiones son transitorias, las API usan una abstracción de un "intervalo de claves de partición", que indica los intervalos de valores hash de clave de partición.</span><span class="sxs-lookup"><span data-stu-id="6532f-118">Since partitions are transient, the APIs use an abstraction of a "partition key range", which denotes the ranges of partition key hashes.</span></span> 

<span data-ttu-id="6532f-119">Cuando se emite una consulta a Azure Cosmos DB, el SDK realiza estos pasos lógicos:</span><span class="sxs-lookup"><span data-stu-id="6532f-119">When you issue a query to Azure Cosmos DB, the SDK performs these logical steps:</span></span>

* <span data-ttu-id="6532f-120">Analiza la consulta SQL para determinar el plan de ejecución de consultas.</span><span class="sxs-lookup"><span data-stu-id="6532f-120">Parse the SQL query to determine the query execution plan.</span></span> 
* <span data-ttu-id="6532f-121">Si la consulta incluye un filtro con la clave de partición, como `SELECT * FROM c WHERE c.city = "Seattle"`, se enruta a una única partición.</span><span class="sxs-lookup"><span data-stu-id="6532f-121">If the query includes a filter against the partition key, like `SELECT * FROM c WHERE c.city = "Seattle"`, it is routed to a single partition.</span></span> <span data-ttu-id="6532f-122">Si la consulta no tiene un filtro por la clave de partición, se ejecuta entonces en todas las particiones y los resultados se combinan en el cliente.</span><span class="sxs-lookup"><span data-stu-id="6532f-122">If the query does not have a filter on partition key, then it is executed in all partitions, and results are merged client side.</span></span>
* <span data-ttu-id="6532f-123">La consulta se ejecuta dentro de cada partición en serie o en paralelo, en función de la configuración del cliente.</span><span class="sxs-lookup"><span data-stu-id="6532f-123">The query is executed within each partition in series or parallel, based on client configuration.</span></span> <span data-ttu-id="6532f-124">En cada partición, la consulta podría realizar uno o varios viajes en función de la complejidad de la consulta, el tamaño de página configurado y el rendimiento aprovisionado de la colección.</span><span class="sxs-lookup"><span data-stu-id="6532f-124">Within each partition, the query might make one or more round trips depending on the query complexity, configured page size, and provisioned throughput of the collection.</span></span> <span data-ttu-id="6532f-125">Cada ejecución devuelve el número de [unidades de solicitud](request-units.md) que se consumen en la ejecución de consultas y, opcionalmente, las estadísticas de ejecución de consultas.</span><span class="sxs-lookup"><span data-stu-id="6532f-125">Each execution returns the number of [request units](request-units.md) consumed by query execution, and optionally, query execution statistics.</span></span> 
* <span data-ttu-id="6532f-126">El SDK realiza un resumen de los resultados de la consulta entre particiones.</span><span class="sxs-lookup"><span data-stu-id="6532f-126">The SDK performs a summarization of the query results across partitions.</span></span> <span data-ttu-id="6532f-127">Por ejemplo, si la consulta implica una cláusula ORDER BY entre particiones, los resultados de particiones individuales se ordenan mediante combinación para devolver resultados en orden clasificado globalmente.</span><span class="sxs-lookup"><span data-stu-id="6532f-127">For example, if the query involves an ORDER BY across partitions, then results from individual partitions are merge-sorted to return results in globally sorted order.</span></span> <span data-ttu-id="6532f-128">Si la consulta es una agregación como `COUNT`, los recuentos de particiones individuales se suman para generar el recuento total.</span><span class="sxs-lookup"><span data-stu-id="6532f-128">If the query is an aggregation like `COUNT`, the counts from individual partitions are summed to produce the overall count.</span></span>

<span data-ttu-id="6532f-129">Los SDK ofrecen diversas opciones para la ejecución de consultas.</span><span class="sxs-lookup"><span data-stu-id="6532f-129">The SDKs provide various options for query execution.</span></span> <span data-ttu-id="6532f-130">Por ejemplo, en .NET estas opciones están disponibles en la clase `FeedOptions`.</span><span class="sxs-lookup"><span data-stu-id="6532f-130">For example, in .NET these options are available in the `FeedOptions` class.</span></span> <span data-ttu-id="6532f-131">En la tabla siguiente se describen estas opciones y de qué manera pueden afectar el tiempo de ejecución de consulta.</span><span class="sxs-lookup"><span data-stu-id="6532f-131">The following table describes these options and how they impact query execution time.</span></span> 

| <span data-ttu-id="6532f-132">Opción</span><span class="sxs-lookup"><span data-stu-id="6532f-132">Option</span></span> | <span data-ttu-id="6532f-133">Descripción</span><span class="sxs-lookup"><span data-stu-id="6532f-133">Description</span></span> |
| ------ | ----------- |
| `EnableCrossPartitionQuery` | <span data-ttu-id="6532f-134">Se debe establecer en true para cualquier consulta que se deba ejecutar entre más de una partición.</span><span class="sxs-lookup"><span data-stu-id="6532f-134">Must be set to true for any query that requires to be executed across more than one partition.</span></span> <span data-ttu-id="6532f-135">Esta es una marca explícita que le permite realizar compensaciones conscientes de rendimiento durante el tiempo de desarrollo.</span><span class="sxs-lookup"><span data-stu-id="6532f-135">This is an explicit flag to enable you to make conscious performance tradeoffs during development time.</span></span> |
| `EnableScanInQuery` | <span data-ttu-id="6532f-136">Se debe establecer en true si ha decidido no indexar, pero quiere ejecutar la consulta de todos modos mediante una exploración.</span><span class="sxs-lookup"><span data-stu-id="6532f-136">Must be set to true if you have opted out of indexing, but want to run the query via a scan anyway.</span></span> <span data-ttu-id="6532f-137">Solo es aplicable si la indexación para la ruta de filtro solicitada está deshabilitada.</span><span class="sxs-lookup"><span data-stu-id="6532f-137">Only applicable if indexing for the requested filter path is disabled.</span></span> | 
| `MaxItemCount` | <span data-ttu-id="6532f-138">El número máximo de elementos que se devolverán por recorrido de ida y vuelta al servidor.</span><span class="sxs-lookup"><span data-stu-id="6532f-138">The maximum number of items to return per round trip to the server.</span></span> <span data-ttu-id="6532f-139">Si se establece en -1, puede dejar que el servidor administre el número de elementos.</span><span class="sxs-lookup"><span data-stu-id="6532f-139">By setting to -1, you can let the server manage the number of items.</span></span> <span data-ttu-id="6532f-140">O bien, puede reducir este valor para recuperar únicamente un pequeño número de elementos por recorrido de ida y vuelta.</span><span class="sxs-lookup"><span data-stu-id="6532f-140">Or, you can lower this value to retrieve only a small number of items per round trip.</span></span> 
| `MaxBufferedItemCount` | <span data-ttu-id="6532f-141">Esta es una opción de cliente y se usa para limitar el consumo de memoria al usar una cláusula ORDER BY entre particiones.</span><span class="sxs-lookup"><span data-stu-id="6532f-141">This is a client-side option, and used to limit the memory consumption when performing cross-partition ORDER BY.</span></span> <span data-ttu-id="6532f-142">Un valor más alto ayuda a reducir la latencia de ordenación entre particiones.</span><span class="sxs-lookup"><span data-stu-id="6532f-142">A higher value helps reduce the latency of cross-partition sorting.</span></span> |
| `MaxDegreeOfParallelism` | <span data-ttu-id="6532f-143">Obtiene o establece el número de operaciones simultáneas en el cliente durante la ejecución de consultas en paralelo en el servicio de base de datos de Azure DocumentDB.</span><span class="sxs-lookup"><span data-stu-id="6532f-143">Gets or sets the number of concurrent operations run client side during parallel query execution in the Azure DocumentDB database service.</span></span> <span data-ttu-id="6532f-144">Un valor de propiedad positivo limita el número de operaciones simultáneas al valor establecido.</span><span class="sxs-lookup"><span data-stu-id="6532f-144">A positive property value limits the number of concurrent operations to the set value.</span></span> <span data-ttu-id="6532f-145">Si se establece en un valor menor que 0, el sistema decide automáticamente el número de operaciones simultáneas que se ejecutarán.</span><span class="sxs-lookup"><span data-stu-id="6532f-145">If it is set to less than 0, the system automatically decides the number of concurrent operations to run.</span></span> |
| `PopulateQueryMetrics` | <span data-ttu-id="6532f-146">Permite el registro detallado de estadísticas del tiempo empleado en diversas fases de la ejecución de consultas, como tiempo de compilación, hora de ciclo del índice y tiempo de carga de documentos.</span><span class="sxs-lookup"><span data-stu-id="6532f-146">Enables detailed logging of statistics of time spent in various phases of query execution like compilation time, index loop time, and document load time.</span></span> <span data-ttu-id="6532f-147">Puede compartir la salida de las estadísticas de consulta con el soporte técnico de Azure con el fin de diagnosticar problemas de rendimiento de las consultas.</span><span class="sxs-lookup"><span data-stu-id="6532f-147">You can share output from query statistics with Azure Support to diagnose query performance issues.</span></span> |
| `RequestContinuation` | <span data-ttu-id="6532f-148">Puede reanudar la ejecución de consultas pasando el token de continuación opaco devuelto por cualquier consulta.</span><span class="sxs-lookup"><span data-stu-id="6532f-148">You can resume query execution by passing in the opaque continuation token returned by any query.</span></span> <span data-ttu-id="6532f-149">El token de continuación encapsula todo el estado necesario para la ejecución de consultas.</span><span class="sxs-lookup"><span data-stu-id="6532f-149">The continuation token encapsulates all state required for query execution.</span></span> |
| `ResponseContinuationTokenLimitInKb` | <span data-ttu-id="6532f-150">Puede limitar el tamaño máximo del token de continuación devuelto por el servidor.</span><span class="sxs-lookup"><span data-stu-id="6532f-150">You can limit the maximum size of the continuation token returned by the server.</span></span> <span data-ttu-id="6532f-151">Podría ser necesario establecer este valor si el host de la aplicación tiene límites en cuanto al tamaño del encabezado de respuesta.</span><span class="sxs-lookup"><span data-stu-id="6532f-151">You might need to set this if your application host has limits on response header size.</span></span> <span data-ttu-id="6532f-152">Si se establece, podría aumentar la duración total y las RU usadas para la consulta.</span><span class="sxs-lookup"><span data-stu-id="6532f-152">Setting this may increase the overall duration and RUs consumed for the query.</span></span>  |

<span data-ttu-id="6532f-153">Por ejemplo, tomemos una consulta de ejemplo sobre una clave de partición solicitada en una colección con `/city` como clave de partición y aprovisionada con 100 000 RU/s de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="6532f-153">For example, let's take an example query on partition key requested on a collection with `/city` as the partition key and provisioned with 100,000 RU/s of throughput.</span></span> <span data-ttu-id="6532f-154">Esta consulta se solicita mediante `CreateDocumentQuery<T>` en .NET, como se muestra a continuación:</span><span class="sxs-lookup"><span data-stu-id="6532f-154">You request this query using `CreateDocumentQuery<T>` in .NET like the following:</span></span>

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        PopulateQueryMetrics = true, 
        MaxItemCount = -1, 
        MaxDegreeOfParallelism = -1, 
        EnableCrossPartitionQuery = true 
    }).AsDocumentQuery();

FeedResponse<dynamic> result = await query.ExecuteNextAsync();
```

<span data-ttu-id="6532f-155">El fragmento de código del SDK que se muestra arriba, corresponde a la siguiente solicitud de API de REST:</span><span class="sxs-lookup"><span data-stu-id="6532f-155">The SDK snippet shown above, corresponds to the following REST API request:</span></span>

```
POST https://arramacquerymetrics-westus.documents.azure.com/dbs/db/colls/sample/docs HTTP/1.1
x-ms-continuation: 
x-ms-documentdb-isquery: True
x-ms-max-item-count: -1
x-ms-documentdb-query-enablecrosspartition: True
x-ms-documentdb-query-parallelizecrosspartitionquery: True
x-ms-documentdb-query-iscontinuationexpected: True
x-ms-documentdb-populatequerymetrics: True
x-ms-date: Tue, 27 Jun 2017 21:52:18 GMT
authorization: type%3dmaster%26ver%3d1.0%26sig%3drp1Hi83Y8aVV5V6LzZ6xhtQVXRAMz0WNMnUuvriUv%2b4%3d
x-ms-session-token: 7:8,6:2008,5:8,4:2008,3:8,2:2008,1:8,0:8,9:8,8:4008
Cache-Control: no-cache
x-ms-consistency-level: Session
User-Agent: documentdb-dotnet-sdk/1.14.1 Host/32-bit MicrosoftWindowsNT/6.2.9200.0
x-ms-version: 2017-02-22
Accept: application/json
Content-Type: application/query+json
Host: arramacquerymetrics-westus.documents.azure.com
Content-Length: 52
Expect: 100-continue

{"query":"SELECT * FROM c WHERE c.city = 'Seattle'"}
```

<span data-ttu-id="6532f-156">Cada página de ejecución de una consulta corresponde a una API de REST `POST` con el encabezado `Accept: application/query+json` y la consulta SQL en el cuerpo.</span><span class="sxs-lookup"><span data-stu-id="6532f-156">Each query execution page corresponds to a REST API `POST` with the `Accept: application/query+json` header, and the SQL query in the body.</span></span> <span data-ttu-id="6532f-157">Cada consulta realiza uno o varios recorridos de ida y vuelta al servidor, y el token `x-ms-continuation` se muestra entre el cliente y el servidor para reanudar la ejecución.</span><span class="sxs-lookup"><span data-stu-id="6532f-157">Each query makes one or more round trips to the server with the `x-ms-continuation` token echoed between the client and server to resume execution.</span></span> <span data-ttu-id="6532f-158">Las opciones de configuración en FeedOptions se pasan al servidor en forma de encabezados de solicitud.</span><span class="sxs-lookup"><span data-stu-id="6532f-158">The configuration options in FeedOptions are passed to the server in the form of request headers.</span></span> <span data-ttu-id="6532f-159">Por ejemplo, `MaxItemCount` corresponde a `x-ms-max-item-count`.</span><span class="sxs-lookup"><span data-stu-id="6532f-159">For example, `MaxItemCount` corresponds to `x-ms-max-item-count`.</span></span> 

<span data-ttu-id="6532f-160">La solicitud devuelve la respuesta siguiente (truncada para que se entienda mejor):</span><span class="sxs-lookup"><span data-stu-id="6532f-160">The request returns the following (truncated for readability) response:</span></span>

```
HTTP/1.1 200 Ok
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Server: Microsoft-HTTPAPI/2.0
Strict-Transport-Security: max-age=31536000
x-ms-last-state-change-utc: Tue, 27 Jun 2017 21:01:57.561 GMT
x-ms-resource-quota: documentSize=10240;documentsSize=10485760;documentsCount=-1;collectionSize=10485760;
x-ms-resource-usage: documentSize=1;documentsSize=884;documentsCount=2000;collectionSize=1408;
x-ms-item-count: 2000
x-ms-schemaversion: 1.3
x-ms-alt-content-path: dbs/db/colls/sample
x-ms-content-path: +9kEANVq0wA=
x-ms-xp-role: 1
x-ms-documentdb-query-metrics: totalExecutionTimeInMs=33.67;queryCompileTimeInMs=0.06;queryLogicalPlanBuildTimeInMs=0.02;queryPhysicalPlanBuildTimeInMs=0.10;queryOptimizationTimeInMs=0.00;VMExecutionTimeInMs=32.56;indexLookupTimeInMs=0.36;documentLoadTimeInMs=9.58;systemFunctionExecuteTimeInMs=0.00;userFunctionExecuteTimeInMs=0.00;retrievedDocumentCount=2000;retrievedDocumentSize=1125600;outputDocumentCount=2000;writeOutputTimeInMs=18.10;indexUtilizationRatio=1.00
x-ms-request-charge: 604.42
x-ms-serviceversion: version=1.14.34.4
x-ms-activity-id: 0df8b5f6-83b9-4493-abda-cce6d0f91486
x-ms-session-token: 2:2008
x-ms-gatewayversion: version=1.14.33.2
Date: Tue, 27 Jun 2017 21:59:49 GMT
```

<span data-ttu-id="6532f-161">Los encabezados de respuesta principales devueltos por la consulta incluyen los siguientes:</span><span class="sxs-lookup"><span data-stu-id="6532f-161">The key response headers returned from the query include the following:</span></span>

| <span data-ttu-id="6532f-162">Opción</span><span class="sxs-lookup"><span data-stu-id="6532f-162">Option</span></span> | <span data-ttu-id="6532f-163">Descripción</span><span class="sxs-lookup"><span data-stu-id="6532f-163">Description</span></span> |
| ------ | ----------- |
| `x-ms-item-count` | <span data-ttu-id="6532f-164">El número de elementos devueltos en la respuesta.</span><span class="sxs-lookup"><span data-stu-id="6532f-164">The number of items returned in the response.</span></span> <span data-ttu-id="6532f-165">Esto depende del valor de `x-ms-max-item-count` proporcionado, del número de elementos que se pueden incluir en el tamaño máximo de la carga de respuesta, del rendimiento aprovisionado y del tiempo de ejecución de consultas.</span><span class="sxs-lookup"><span data-stu-id="6532f-165">This is dependent on the supplied `x-ms-max-item-count`, the number of items that can be fit within the maximum response payload size, the provisioned throughput, and query execution time.</span></span> |  
| `x-ms-continuation:` | <span data-ttu-id="6532f-166">El token de continuación para reanudar la ejecución de la consulta, si hay más resultados disponibles.</span><span class="sxs-lookup"><span data-stu-id="6532f-166">The continuation token to resume execution of the query, if additional results are available.</span></span> | 
| `x-ms-documentdb-query-metrics` | <span data-ttu-id="6532f-167">Las estadísticas de consulta para la ejecución.</span><span class="sxs-lookup"><span data-stu-id="6532f-167">The query statistics for the execution.</span></span> <span data-ttu-id="6532f-168">Es una cadena delimitada que contiene las estadísticas del tiempo empleado en las distintas fases de ejecución de consultas.</span><span class="sxs-lookup"><span data-stu-id="6532f-168">This is a delimited string containing statistics of time spent in the various phases of query execution.</span></span> <span data-ttu-id="6532f-169">Se devuelve si `x-ms-documentdb-populatequerymetrics` está establecido en `True`.</span><span class="sxs-lookup"><span data-stu-id="6532f-169">Returned if `x-ms-documentdb-populatequerymetrics` is set to `True`.</span></span> | 
| `x-ms-request-charge` | <span data-ttu-id="6532f-170">El número de [unidades de solicitud](request-units.md) usadas por la consulta.</span><span class="sxs-lookup"><span data-stu-id="6532f-170">The number of [request units](request-units.md) consumed by the query.</span></span> | 

<span data-ttu-id="6532f-171">Para más información sobre los encabezados de consulta y las opciones de la API de REST, consulte [Querying resources using the DocumentDB REST API](https://docs.microsoft.com/rest/api/documentdb/querying-documentdb-resources-using-the-rest-api) (Consulta de recursos mediante la API de REST de DocumentDB).</span><span class="sxs-lookup"><span data-stu-id="6532f-171">For details on the REST API request headers and options, see [Querying resources using the DocumentDB REST API](https://docs.microsoft.com/rest/api/documentdb/querying-documentdb-resources-using-the-rest-api).</span></span>

## <a name="best-practices-for-query-performance"></a><span data-ttu-id="6532f-172">Procedimientos recomendados para el rendimiento de consultas</span><span class="sxs-lookup"><span data-stu-id="6532f-172">Best practices for query performance</span></span>
<span data-ttu-id="6532f-173">A continuación se muestran los factores más comunes que afectan al rendimiento de consultas de Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="6532f-173">The following are the most common factors that impact Azure Cosmos DB query performance.</span></span> <span data-ttu-id="6532f-174">Cada uno de estos temas se tratará con mayor detalle en este artículo.</span><span class="sxs-lookup"><span data-stu-id="6532f-174">We dig deeper into each of these topics in this article.</span></span>

| <span data-ttu-id="6532f-175">Factor</span><span class="sxs-lookup"><span data-stu-id="6532f-175">Factor</span></span> | <span data-ttu-id="6532f-176">Sugerencia</span><span class="sxs-lookup"><span data-stu-id="6532f-176">Tip</span></span> | 
| ------ | -----| 
| <span data-ttu-id="6532f-177">Rendimiento aprovisionado</span><span class="sxs-lookup"><span data-stu-id="6532f-177">Provisioned throughput</span></span> | <span data-ttu-id="6532f-178">Mida la RU por consulta y asegúrese de que tiene el rendimiento aprovisionado necesario para sus consultas.</span><span class="sxs-lookup"><span data-stu-id="6532f-178">Measure RU per query, and ensure that you have the required provisioned throughput for your queries.</span></span> | 
| <span data-ttu-id="6532f-179">Creación de particiones y claves de partición</span><span class="sxs-lookup"><span data-stu-id="6532f-179">Partitioning and partition keys</span></span> | <span data-ttu-id="6532f-180">Dé prioridad a las consultas con el valor de clave de partición de baja latencia en la cláusula de filtro.</span><span class="sxs-lookup"><span data-stu-id="6532f-180">Favor queries with the partition key value in the filter clause for low latency.</span></span> |
| <span data-ttu-id="6532f-181">SDK y opciones de consulta</span><span class="sxs-lookup"><span data-stu-id="6532f-181">SDK and query options</span></span> | <span data-ttu-id="6532f-182">Siga los procedimientos recomendados del SDK, como las opciones de conectividad directa y optimización de la ejecución de consultas de cliente.</span><span class="sxs-lookup"><span data-stu-id="6532f-182">Follow SDK best practices like direct connectivity, and tune client-side query execution options.</span></span> |
| <span data-ttu-id="6532f-183">Latencia de red</span><span class="sxs-lookup"><span data-stu-id="6532f-183">Network latency</span></span> | <span data-ttu-id="6532f-184">Justifique la sobrecarga de red en la medición, y use API de hospedaje múltiple para leer en la región más cercana.</span><span class="sxs-lookup"><span data-stu-id="6532f-184">Account for network overhead in measurement, and use multi-homing APIs to read from the nearest region.</span></span> |
| <span data-ttu-id="6532f-185">Directiva de indexación</span><span class="sxs-lookup"><span data-stu-id="6532f-185">Indexing Policy</span></span> | <span data-ttu-id="6532f-186">Asegúrese de que dispone de las rutas y directivas de indexación necesarias para la consulta.</span><span class="sxs-lookup"><span data-stu-id="6532f-186">Ensure that you have the required indexing paths/policy for the query.</span></span> |
| <span data-ttu-id="6532f-187">Métricas de ejecución de consultas</span><span class="sxs-lookup"><span data-stu-id="6532f-187">Query execution metrics</span></span> | <span data-ttu-id="6532f-188">Analice las métricas de ejecución de consultas para identificar posibles reescrituras de formas de datos y consultas.</span><span class="sxs-lookup"><span data-stu-id="6532f-188">Analyze the query execution metrics to identify potential rewrites of query and data shapes.</span></span>  |

### <a name="provisioned-throughput"></a><span data-ttu-id="6532f-189">Rendimiento aprovisionado</span><span class="sxs-lookup"><span data-stu-id="6532f-189">Provisioned throughput</span></span>
<span data-ttu-id="6532f-190">En Cosmos DB, se crean contenedores de datos, cada uno con un rendimiento reservado expresado en unidades de solicitud (RU) por segundo.</span><span class="sxs-lookup"><span data-stu-id="6532f-190">In Cosmos DB, you create containers of data, each with reserved throughput expressed in request units (RU) per-second.</span></span> <span data-ttu-id="6532f-191">Una lectura de un documento de 1 KB es 1 RU, y cada operación (incluidas las consultas) se normaliza a un número fijo de RU según su complejidad.</span><span class="sxs-lookup"><span data-stu-id="6532f-191">A read of a 1-KB document is 1 RU, and every operation (including queries) is normalized to a fixed number of RUs based on its complexity.</span></span> <span data-ttu-id="6532f-192">Por ejemplo, si tiene 1000 RU/s aprovisionadas en su contenedor y tiene una consulta como `SELECT * FROM c WHERE c.city = 'Seattle'` que consume 5 RU, puede realizar entonces (1000 RU/s)/(5 RU/consulta) = 200 consultas/s de estas por segundo.</span><span class="sxs-lookup"><span data-stu-id="6532f-192">For example, if you have 1000 RU/s provisioned for your container, and you have a query like `SELECT * FROM c WHERE c.city = 'Seattle'` that consumes 5 RUs, then you can perform (1000 RU/s) / (5 RU/query) = 200 query/s such queries per second.</span></span> 

<span data-ttu-id="6532f-193">Si envía más de 200 consultas/s, el servicio comienza a limitar la tasa de solicitudes entrantes por encima de 200/s.</span><span class="sxs-lookup"><span data-stu-id="6532f-193">If you submit more than 200 queries/sec, the service starts rate-limiting incoming requests above 200/s.</span></span> <span data-ttu-id="6532f-194">Los SDK controlan automáticamente este caso mediante la realización de un retroceso/reintento; por lo tanto, podría advertir una latencia más alta con estas consultas.</span><span class="sxs-lookup"><span data-stu-id="6532f-194">The SDKs automatically handle this case by performing a backoff/retry, therefore you might notice a higher latency for these queries.</span></span> <span data-ttu-id="6532f-195">El aumento del rendimiento aprovisionado al valor necesario mejora la latencia de las consultas y el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="6532f-195">Increasing the provisioned throughput to the required value improves your query latency and throughput.</span></span> 

<span data-ttu-id="6532f-196">Para más información sobre las unidades de solicitud, consulte [Unidades de solicitud](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="6532f-196">To learn more about request units, see [Request units](request-units.md).</span></span>

### <a name="partitioning-and-partition-keys"></a><span data-ttu-id="6532f-197">Creación de particiones y claves de partición</span><span class="sxs-lookup"><span data-stu-id="6532f-197">Partitioning and partition keys</span></span>
<span data-ttu-id="6532f-198">Con Azure Cosmos DB, las consultas se realizan normalmente en el orden siguiente: desde la más rápida o eficiente a la más lenta o menos eficiente.</span><span class="sxs-lookup"><span data-stu-id="6532f-198">With Azure Cosmos DB, typically queries perform in the following order from fastest/most efficient to slower/less efficient.</span></span> 

* <span data-ttu-id="6532f-199">GET en una única clave de partición y una clave de elemento</span><span class="sxs-lookup"><span data-stu-id="6532f-199">GET on a single partition key and item key</span></span>
* <span data-ttu-id="6532f-200">Consulta con una cláusula de filtro en una única clave de partición</span><span class="sxs-lookup"><span data-stu-id="6532f-200">Query with a filter clause on a single partition key</span></span>
* <span data-ttu-id="6532f-201">Consulta sin una cláusula de filtro de igualdad o intervalo en cualquier propiedad</span><span class="sxs-lookup"><span data-stu-id="6532f-201">Query without an equality or range filter clause on any property</span></span>
* <span data-ttu-id="6532f-202">Sin filtros de consulta</span><span class="sxs-lookup"><span data-stu-id="6532f-202">Query without filters</span></span>

<span data-ttu-id="6532f-203">Las consultas que necesitan consultar todas las particiones necesitan una mayor latencia y pueden consumir un mayor número de RU.</span><span class="sxs-lookup"><span data-stu-id="6532f-203">Queries that need to consult all partitions need higher latency, and can consume higher RUs.</span></span> <span data-ttu-id="6532f-204">Puesto que cada partición tiene indexación automática en todas las propiedades, la consulta se puede atender eficazmente desde el índice en este caso.</span><span class="sxs-lookup"><span data-stu-id="6532f-204">Since each partition has automatic indexing against all properties, the query can be served efficiently from the index in this case.</span></span> <span data-ttu-id="6532f-205">Puede acelerar las consultas que abarcan particiones mediante las opciones de paralelismo.</span><span class="sxs-lookup"><span data-stu-id="6532f-205">You can make queries that span partitions faster by using the parallelism options.</span></span>

<span data-ttu-id="6532f-206">Para aprender más sobre la creación de particiones y las claves de particiones, consulte [Creación de particiones en Azure Cosmos DB](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="6532f-206">To learn more about partitioning and partition keys, see [Partitioning in Azure Cosmos DB](partition-data.md).</span></span>

### <a name="sdk-and-query-options"></a><span data-ttu-id="6532f-207">SDK y opciones de consulta</span><span class="sxs-lookup"><span data-stu-id="6532f-207">SDK and query options</span></span>
<span data-ttu-id="6532f-208">Consulte [Sugerencias de rendimiento](performance-tips.md) y [Prueba de rendimiento](performance-testing.md) para saber cómo obtener el mejor rendimiento del cliente de Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="6532f-208">See [Performance Tips](performance-tips.md) and [Performance testing](performance-testing.md) for how to get the best client-side performance from Azure Cosmos DB.</span></span> <span data-ttu-id="6532f-209">Esto incluye el uso de los SDK más recientes, la configuración de opciones específicas de la plataforma, como el número predeterminado de conexiones, la frecuencia de recolección de elementos no utilizados y el uso de opciones de conectividad ligera, como Direct/TCP.</span><span class="sxs-lookup"><span data-stu-id="6532f-209">This includes using the latest SDKs, configuring platform-specific configurations like default number of connections, frequency of garbage collection, and using lightweight connectivity options like Direct/TCP.</span></span> 


#### <a name="max-item-count"></a><span data-ttu-id="6532f-210">Recuento máximo de elementos</span><span class="sxs-lookup"><span data-stu-id="6532f-210">Max Item Count</span></span>
<span data-ttu-id="6532f-211">Para las consultas, el valor de `MaxItemCount` puede tener un impacto significativo en el momento de realizar consultas globales.</span><span class="sxs-lookup"><span data-stu-id="6532f-211">For queries, the value of `MaxItemCount` can have a significant impact on end-to-end query time.</span></span> <span data-ttu-id="6532f-212">Cada recorrido de ida y vuelta al servidor devolverá un número de elementos inferior al especificado en `MaxItemCount` (con un valor predeterminado de 100 elementos).</span><span class="sxs-lookup"><span data-stu-id="6532f-212">Each round trip to the server will return no more than the number of items in `MaxItemCount` (Default of 100 items).</span></span> <span data-ttu-id="6532f-213">Si se establece en un valor más alto (-1 es el máximo y el número recomendado) mejorará la duración total de la consulta limitando el número de recorridos de ida y vuelta entre el servidor y cliente, especialmente en aquellas consultas con grandes conjuntos de resultados.</span><span class="sxs-lookup"><span data-stu-id="6532f-213">Setting this to a higher value (-1 is maximum, and recommended) will improve your query duration overall by limiting the number of round trips between server and client, especially for queries with large result sets.</span></span>

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        MaxItemCount = -1, 
    }).AsDocumentQuery();
```

#### <a name="max-degree-of-parallelism"></a><span data-ttu-id="6532f-214">Grado máximo de paralelismo</span><span class="sxs-lookup"><span data-stu-id="6532f-214">Max Degree of Parallelism</span></span>
<span data-ttu-id="6532f-215">Para las consultas, ajuste `MaxDegreeOfParallelism` para identificar las mejores configuraciones para su aplicación, en especial si realiza consultas entre particiones (sin un filtro en el valor de clave de partición).</span><span class="sxs-lookup"><span data-stu-id="6532f-215">For queries, tune the `MaxDegreeOfParallelism` to identify the best configurations for your application, especially if you perform cross-partition queries (without a filter on the partition-key value).</span></span> <span data-ttu-id="6532f-216">`MaxDegreeOfParallelism` controla el número máximo de tareas en paralelo, es decir, el número máximo de particiones que se van a visitar en paralelo.</span><span class="sxs-lookup"><span data-stu-id="6532f-216">`MaxDegreeOfParallelism`  controls the maximum number of parallel tasks, i.e., the maximum of partitions to be visited in parallel.</span></span> 

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        MaxDegreeOfParallelism = -1, 
        EnableCrossPartitionQuery = true 
    }).AsDocumentQuery();
```

<span data-ttu-id="6532f-217">Supongamos que</span><span class="sxs-lookup"><span data-stu-id="6532f-217">Let’s assume that</span></span>
* <span data-ttu-id="6532f-218">D. = número máximo predeterminado de tareas en paralelo (= número total de procesadores en el equipo cliente)</span><span class="sxs-lookup"><span data-stu-id="6532f-218">D = Default Maximum number of parallel tasks (= total number of processor in the client machine)</span></span>
* <span data-ttu-id="6532f-219">P = número máximo especificado por el usuario de tareas en paralelo</span><span class="sxs-lookup"><span data-stu-id="6532f-219">P = User-specified maximum number of parallel tasks</span></span>
* <span data-ttu-id="6532f-220">N = número de particiones que se necesita visitar para responder a una consulta</span><span class="sxs-lookup"><span data-stu-id="6532f-220">N = Number of partitions that needs  to be visited for answering a query</span></span>

<span data-ttu-id="6532f-221">A continuación se muestran las distintas implicaciones de cómo se comportarán las consultas en paralelo para valores diferentes de P.</span><span class="sxs-lookup"><span data-stu-id="6532f-221">Following are implications of how the parallel queries would behave for different values of P.</span></span>
* <span data-ttu-id="6532f-222">(P == 0) => modo serie</span><span class="sxs-lookup"><span data-stu-id="6532f-222">(P == 0) => Serial Mode</span></span>
* <span data-ttu-id="6532f-223">(P == 1) => un máximo de una tarea</span><span class="sxs-lookup"><span data-stu-id="6532f-223">(P == 1) => Maximum of one task</span></span>
* <span data-ttu-id="6532f-224">(P > 1) => mínimo de tareas en paralelo (P, N)</span><span class="sxs-lookup"><span data-stu-id="6532f-224">(P > 1) => Min (P, N) parallel tasks</span></span> 
* <span data-ttu-id="6532f-225">(P < 1) => mínimo de tareas en paralelo (N, D)</span><span class="sxs-lookup"><span data-stu-id="6532f-225">(P < 1) => Min (N, D) parallel tasks</span></span>

<span data-ttu-id="6532f-226">Para acceder a notas de versión de SDK y conocer detalles sobre las clases y los métodos implementados, consulte [SDK de DocumentDB](documentdb-sdk-dotnet.md)</span><span class="sxs-lookup"><span data-stu-id="6532f-226">For SDK release notes, and details on implemented classes and methods see [DocumentDB SDKs](documentdb-sdk-dotnet.md)</span></span>

### <a name="network-latency"></a><span data-ttu-id="6532f-227">Latencia de red</span><span class="sxs-lookup"><span data-stu-id="6532f-227">Network latency</span></span>
<span data-ttu-id="6532f-228">Para saber cómo configurar la distribución global y conectarse a la región más cercana, consulte [Distribución global de Azure Cosmos DB](tutorial-global-distribution-documentdb.md).</span><span class="sxs-lookup"><span data-stu-id="6532f-228">See [Azure Cosmos DB global distribution](tutorial-global-distribution-documentdb.md) for how to set up global distribution, and connect to the closest region.</span></span> <span data-ttu-id="6532f-229">La latencia de red tiene un impacto significativo en el rendimiento de consultas cuando es necesario realizar varios recorridos de ida y vuelta o recuperar un gran conjunto de resultados de la consulta.</span><span class="sxs-lookup"><span data-stu-id="6532f-229">Network latency has a significant impact on query performance when you need to make multiple round-trips or retrieve a large result set from the query.</span></span> 

<span data-ttu-id="6532f-230">La sección sobre métricas de ejecución de consultas explica cómo recuperar el tiempo de ejecución del servidor de consultas ( `totalExecutionTimeInMs`), de modo que pueda diferenciar entre el tiempo invertido en la ejecución de la consulta y el tiempo empleado en el tránsito de la red.</span><span class="sxs-lookup"><span data-stu-id="6532f-230">The section on query execution metrics explains how to retrieve the server execution time of queries ( `totalExecutionTimeInMs`), so that you can differentiate between time spent in query execution and time spent in network transit.</span></span>

### <a name="indexing-policy"></a><span data-ttu-id="6532f-231">Directiva de indexación</span><span class="sxs-lookup"><span data-stu-id="6532f-231">Indexing policy</span></span>
<span data-ttu-id="6532f-232">Para información sobre las rutas de indexación, las clases y los modos y cómo afectan a la ejecución de consultas, consulte [Configuración de la directiva de indexación](indexing-policies.md).</span><span class="sxs-lookup"><span data-stu-id="6532f-232">See [Configuring indexing policy](indexing-policies.md) for indexing paths, kinds, and modes, and how they impact query execution.</span></span> <span data-ttu-id="6532f-233">De forma predeterminada, la directiva de indexación usa la indexación de valores hash para las cadenas, que resulta eficaz para las consultas de igualdad, aunque no así para las consultas de intervalo y las consultas ORDER BY.</span><span class="sxs-lookup"><span data-stu-id="6532f-233">By default, the indexing policy uses Hash indexing for strings, which is effective for equality queries, but not for range queries/order by queries.</span></span> <span data-ttu-id="6532f-234">Si tiene consultas de intervalo para las cadenas, se recomienda especificar el tipo de índice de intervalo para todas las cadenas.</span><span class="sxs-lookup"><span data-stu-id="6532f-234">If you need range queries for strings, we recommend specifying the Range index type for all strings.</span></span> 

## <a name="query-execution-metrics"></a><span data-ttu-id="6532f-235">Métricas de ejecución de consultas</span><span class="sxs-lookup"><span data-stu-id="6532f-235">Query execution metrics</span></span>
<span data-ttu-id="6532f-236">Para obtener métrica detalladas sobre la ejecución de consultas, pase el encabezado opcional `x-ms-documentdb-populatequerymetrics` (`FeedOptions.PopulateQueryMetrics` en el SDK de .NET).</span><span class="sxs-lookup"><span data-stu-id="6532f-236">You can obtain detailed metrics on query execution by passing in the optional `x-ms-documentdb-populatequerymetrics` header (`FeedOptions.PopulateQueryMetrics` in the .NET SDK).</span></span> <span data-ttu-id="6532f-237">El valor devuelto en `x-ms-documentdb-query-metrics` tiene los siguientes pares de clave-valor pensados para la solución avanzada de problemas de la ejecución de consultas.</span><span class="sxs-lookup"><span data-stu-id="6532f-237">The value returned in `x-ms-documentdb-query-metrics` has the following key-value pairs meant for advanced troubleshooting of query execution.</span></span> 

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        PopulateQueryMetrics = true, 
    }).AsDocumentQuery();

FeedResponse<dynamic> result = await query.ExecuteNextAsync();

// Returns metrics by partition key range Id
IReadOnlyDictionary<string, QueryMetrics> metrics = result.QueryMetrics;

```

| <span data-ttu-id="6532f-238">Métrica</span><span class="sxs-lookup"><span data-stu-id="6532f-238">Metric</span></span> | <span data-ttu-id="6532f-239">Unidad</span><span class="sxs-lookup"><span data-stu-id="6532f-239">Unit</span></span> | <span data-ttu-id="6532f-240">Descripción</span><span class="sxs-lookup"><span data-stu-id="6532f-240">Description</span></span> | 
| ------ | -----| ----------- |
| `totalExecutionTimeInMs` | <span data-ttu-id="6532f-241">milisegundos</span><span class="sxs-lookup"><span data-stu-id="6532f-241">milliseconds</span></span> | <span data-ttu-id="6532f-242">Tiempo de ejecución de consulta</span><span class="sxs-lookup"><span data-stu-id="6532f-242">Query execution time</span></span> | 
| `queryCompileTimeInMs` | <span data-ttu-id="6532f-243">milisegundos</span><span class="sxs-lookup"><span data-stu-id="6532f-243">milliseconds</span></span> | <span data-ttu-id="6532f-244">Tiempo de compilación de consulta</span><span class="sxs-lookup"><span data-stu-id="6532f-244">Query compile time</span></span>  | 
| `queryLogicalPlanBuildTimeInMs` | <span data-ttu-id="6532f-245">milisegundos</span><span class="sxs-lookup"><span data-stu-id="6532f-245">milliseconds</span></span> | <span data-ttu-id="6532f-246">Tiempo en compilar el plan lógico de consultas</span><span class="sxs-lookup"><span data-stu-id="6532f-246">Time to build logical query plan</span></span> | 
| `queryPhysicalPlanBuildTimeInMs` | <span data-ttu-id="6532f-247">milisegundos</span><span class="sxs-lookup"><span data-stu-id="6532f-247">milliseconds</span></span> | <span data-ttu-id="6532f-248">Tiempo en compilar el plan físico de consulta</span><span class="sxs-lookup"><span data-stu-id="6532f-248">Time to build physical query plan</span></span> | 
| `queryOptimizationTimeInMs` | <span data-ttu-id="6532f-249">milisegundos</span><span class="sxs-lookup"><span data-stu-id="6532f-249">milliseconds</span></span> | <span data-ttu-id="6532f-250">Tiempo invertido en optimizar la consulta</span><span class="sxs-lookup"><span data-stu-id="6532f-250">Time spent in optimizing query</span></span> | 
| `VMExecutionTimeInMs` | <span data-ttu-id="6532f-251">milisegundos</span><span class="sxs-lookup"><span data-stu-id="6532f-251">milliseconds</span></span> | <span data-ttu-id="6532f-252">Tiempo invertido en el tiempo de ejecución de consulta</span><span class="sxs-lookup"><span data-stu-id="6532f-252">Time spent in query runtime</span></span> | 
| `indexLookupTimeInMs` | <span data-ttu-id="6532f-253">milisegundos</span><span class="sxs-lookup"><span data-stu-id="6532f-253">milliseconds</span></span> | <span data-ttu-id="6532f-254">Tiempo invertido en la capa física de índice</span><span class="sxs-lookup"><span data-stu-id="6532f-254">Time spent in physical index layer</span></span> | 
| `documentLoadTimeInMs` | <span data-ttu-id="6532f-255">milisegundos</span><span class="sxs-lookup"><span data-stu-id="6532f-255">milliseconds</span></span> | <span data-ttu-id="6532f-256">Tiempo invertido en la carga de documentos</span><span class="sxs-lookup"><span data-stu-id="6532f-256">Time spent in loading documents</span></span>  | 
| `systemFunctionExecuteTimeInMs` | <span data-ttu-id="6532f-257">milisegundos</span><span class="sxs-lookup"><span data-stu-id="6532f-257">milliseconds</span></span> | <span data-ttu-id="6532f-258">Tiempo total invertido en ejecutar funciones del sistema (integradas), en milisegundos</span><span class="sxs-lookup"><span data-stu-id="6532f-258">Total time spent executing system (built-in) functions in milliseconds</span></span>  | 
| `userFunctionExecuteTimeInMs` | <span data-ttu-id="6532f-259">milisegundos</span><span class="sxs-lookup"><span data-stu-id="6532f-259">milliseconds</span></span> | <span data-ttu-id="6532f-260">Tiempo total invertido en ejecutar funciones definidas por el usuario, en milisegundos</span><span class="sxs-lookup"><span data-stu-id="6532f-260">Total time spent executing user-defined functions in milliseconds</span></span> | 
| `retrievedDocumentCount` | <span data-ttu-id="6532f-261">milisegundos</span><span class="sxs-lookup"><span data-stu-id="6532f-261">milliseconds</span></span> | <span data-ttu-id="6532f-262">Número total de documentos recuperados</span><span class="sxs-lookup"><span data-stu-id="6532f-262">Total number of retrieved documents</span></span>  | 
| `retrievedDocumentSize` | <span data-ttu-id="6532f-263">bytes</span><span class="sxs-lookup"><span data-stu-id="6532f-263">bytes</span></span> | <span data-ttu-id="6532f-264">Tamaño total de los documentos recuperados, en bytes</span><span class="sxs-lookup"><span data-stu-id="6532f-264">Total size of retrieved documents in bytes</span></span>  | 
| `outputDocumentCount` | <span data-ttu-id="6532f-265">count</span><span class="sxs-lookup"><span data-stu-id="6532f-265">count</span></span> | <span data-ttu-id="6532f-266">Número de documentos de salida</span><span class="sxs-lookup"><span data-stu-id="6532f-266">Number of output documents</span></span> | 
| `writeOutputTimeInMs` | <span data-ttu-id="6532f-267">milisegundos</span><span class="sxs-lookup"><span data-stu-id="6532f-267">milliseconds</span></span> | <span data-ttu-id="6532f-268">Tiempo de ejecución de consultas, en milisegundos</span><span class="sxs-lookup"><span data-stu-id="6532f-268">Query execution time in milliseconds</span></span> | 
| `indexUtilizationRatio` | <span data-ttu-id="6532f-269">relación (<= 1)</span><span class="sxs-lookup"><span data-stu-id="6532f-269">ratio (<=1)</span></span> | <span data-ttu-id="6532f-270">Relación entre el número de documentos coincidentes mediante el filtro y el número de documentos cargados</span><span class="sxs-lookup"><span data-stu-id="6532f-270">Ratio of number of documents matched by the filter to the number of documents loaded</span></span>  | 

<span data-ttu-id="6532f-271">Los SDK del cliente pueden realizar internamente varias operaciones de consulta para atender la consulta dentro de cada partición.</span><span class="sxs-lookup"><span data-stu-id="6532f-271">The client SDKs may internally make multiple query operations to serve the query within each partition.</span></span> <span data-ttu-id="6532f-272">El cliente realiza más de una llamada por partición si los resultados totales superan `x-ms-max-item-count`, si la consulta supera el rendimiento aprovisionado de la partición, si la carga de consultas alcanza el tamaño máximo por página o si la consulta alcanza el límite de tiempo de espera asignado al sistema.</span><span class="sxs-lookup"><span data-stu-id="6532f-272">The client makes more than one call per-partition if the total results exceed `x-ms-max-item-count`, if the query exceeds the provisioned throughput for the partition, or if the query payload reaches the maximum size per page, or if the query reaches the system allocated timeout limit.</span></span> <span data-ttu-id="6532f-273">Cada ejecución de consultas parcial devuelve un valor `x-ms-documentdb-query-metrics` para esa página.</span><span class="sxs-lookup"><span data-stu-id="6532f-273">Each partial query execution returns a `x-ms-documentdb-query-metrics` for that page.</span></span> 

<span data-ttu-id="6532f-274">Estos son algunos ejemplos de consultas y cómo interpretar algunas de las métricas devueltas en la ejecución de consultas:</span><span class="sxs-lookup"><span data-stu-id="6532f-274">Here are some sample queries, and how to interpret some of the metrics returned from query execution:</span></span> 

| <span data-ttu-id="6532f-275">Consultar</span><span class="sxs-lookup"><span data-stu-id="6532f-275">Query</span></span> | <span data-ttu-id="6532f-276">Métrica de ejemplo</span><span class="sxs-lookup"><span data-stu-id="6532f-276">Sample Metric</span></span> | <span data-ttu-id="6532f-277">Descripción</span><span class="sxs-lookup"><span data-stu-id="6532f-277">Description</span></span> | 
| ------ | -----| ----------- |
| `SELECT TOP 100 * FROM c` | `"RetrievedDocumentCount": 101` | <span data-ttu-id="6532f-278">El número de documentos recuperados es 100 + 1 para coincidir con la cláusula TOP.</span><span class="sxs-lookup"><span data-stu-id="6532f-278">The number of documents retrieved is 100+1 to match the TOP clause.</span></span> <span data-ttu-id="6532f-279">El tiempo de la consulta se invierte mayormente en `WriteOutputTime` y `DocumentLoadTime` dado que es un examen.</span><span class="sxs-lookup"><span data-stu-id="6532f-279">Query time is mostly spent in `WriteOutputTime` and `DocumentLoadTime` since it is a scan.</span></span> | 
| `SELECT TOP 500 * FROM c` | `"RetrievedDocumentCount": 501` | <span data-ttu-id="6532f-280">RetrievedDocumentCount es ahora mayor (500 + 1 para coincidir con la cláusula TOP).</span><span class="sxs-lookup"><span data-stu-id="6532f-280">RetrievedDocumentCount is now higher (500+1 to match the TOP clause).</span></span> | 
| `SELECT * FROM c WHERE c.N = 55` | `"IndexLookupTime": "00:00:00.0009500"` | <span data-ttu-id="6532f-281">0,9 ms se invierten en IndexLookupTime en una búsqueda de claves, porque es una búsqueda de índice en `/N/?`.</span><span class="sxs-lookup"><span data-stu-id="6532f-281">About 0.9 ms is spent in IndexLookupTime for a key lookup, because it's an index lookup on `/N/?`.</span></span> | 
| `SELECT * FROM c WHERE c.N > 55` | `"IndexLookupTime": "00:00:00.0017700"` | <span data-ttu-id="6532f-282">Un poco más de tiempo (1,7 ms) se invierte en IndexLookupTime durante un examen de intervalo, porque es una búsqueda de índice en `/N/?`.</span><span class="sxs-lookup"><span data-stu-id="6532f-282">Slightly more time (1.7 ms) spent in IndexLookupTime over a range scan, because it's an index lookup on `/N/?`.</span></span> | 
| `SELECT TOP 500 c.N FROM c` | `"IndexLookupTime": "00:00:00.0017700"` | <span data-ttu-id="6532f-283">El mismo tiempo se invierte en `DocumentLoadTime` que en las consultas anteriores, pero menos `WriteOutputTime` porque solo se proyecta una propiedad.</span><span class="sxs-lookup"><span data-stu-id="6532f-283">Same time spent on `DocumentLoadTime` as previous queries, but lower `WriteOutputTime` because we're projecting only one property.</span></span> | 
| `SELECT TOP 500 udf.toPercent(c.N) FROM c` | `"UserDefinedFunctionExecutionTime": "00:00:00.2136500"` | <span data-ttu-id="6532f-284">Unos 213 ms se invierten en `UserDefinedFunctionExecutionTime` al ejecutar el UDF en cada valor de `c.N`.</span><span class="sxs-lookup"><span data-stu-id="6532f-284">About 213 ms is spent in `UserDefinedFunctionExecutionTime` executing the UDF on each value of `c.N`.</span></span> |
| `SELECT TOP 500 c.Name FROM c WHERE STARTSWITH(c.Name, 'Den')` | `"IndexLookupTime": "00:00:00.0006400", "SystemFunctionExecutionTime": "00:00:00.0074100"` | <span data-ttu-id="6532f-285">Aproximadamente 0,6 ms se invierten en `IndexLookupTime` en `/Name/?`.</span><span class="sxs-lookup"><span data-stu-id="6532f-285">About 0.6 ms is spent in `IndexLookupTime` on `/Name/?`.</span></span> <span data-ttu-id="6532f-286">La mayoría del tiempo de ejecución de consulta (~ 7 ms) se invierte en `SystemFunctionExecutionTime`.</span><span class="sxs-lookup"><span data-stu-id="6532f-286">Most of the query execution time (~7 ms) in `SystemFunctionExecutionTime`.</span></span> |
| `SELECT TOP 500 c.Name FROM c WHERE STARTSWITH(LOWER(c.Name), 'den')` | `"IndexLookupTime": "00:00:00", "RetrievedDocumentCount": 2491,  "OutputDocumentCount": 500` | <span data-ttu-id="6532f-287">La consulta se realiza como un examen porque se emplea `LOWER`, y se devuelven 500 de los 2491 documentos recuperados.</span><span class="sxs-lookup"><span data-stu-id="6532f-287">Query is performed as a scan because it uses `LOWER`, and 500 out of 2491 retrieved documents are returned.</span></span> |


## <a name="next-steps"></a><span data-ttu-id="6532f-288">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="6532f-288">Next steps</span></span>
* <span data-ttu-id="6532f-289">Para conocer los operadores de consulta y palabras clave SQL admitidos, consulte [Consultas SQL](documentdb-sql-query.md).</span><span class="sxs-lookup"><span data-stu-id="6532f-289">To learn about the supported SQL query operators and keywords, see [SQL query](documentdb-sql-query.md).</span></span> 
* <span data-ttu-id="6532f-290">Para aprender más sobre las unidades de solicitud, consulte [Unidades de solicitud](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="6532f-290">To learn about request units, see [request units](request-units.md).</span></span>
* <span data-ttu-id="6532f-291">Para aprender más sobre la directiva de indexación, consulte [Directiva de indexación](indexing-policies.md)</span><span class="sxs-lookup"><span data-stu-id="6532f-291">To learn about indexing policy, see [indexing policy](indexing-policies.md)</span></span> 



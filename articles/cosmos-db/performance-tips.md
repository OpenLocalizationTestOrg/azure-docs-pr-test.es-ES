---
title: 'Sugerencias de rendimiento: Azure Cosmos DB NoSQL | Microsoft Docs'
description: "Conozca las opciones de configuración de cliente para mejorar el rendimiento de las bases de datos de Azure Cosmos DB."
keywords: "cómo mejorar el rendimiento de la base de datos"
services: cosmos-db
author: mimig1
manager: jhubbard
editor: 
documentationcenter: 
ms.assetid: 94ff155e-f9bc-488f-8c7a-5e7037091bb9
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/23/2017
ms.author: mimig
ms.openlocfilehash: a94cda90eca9dca2b93adb8f5091d829e7375aa5
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/03/2017
---
# <a name="performance-tips-for-azure-cosmos-db"></a><span data-ttu-id="0d408-104">Sugerencias de rendimiento para Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="0d408-104">Performance tips for Azure Cosmos DB</span></span>
<span data-ttu-id="0d408-105">Azure Cosmos DB es una base de datos distribuida rápida y flexible que se escala sin problemas con una latencia y un rendimiento garantizados.</span><span class="sxs-lookup"><span data-stu-id="0d408-105">Azure Cosmos DB is a fast and flexible distributed database that scales seamlessly with guaranteed latency and throughput.</span></span> <span data-ttu-id="0d408-106">No es necesario realizar cambios de arquitectura importantes ni escribir código complejo para escalar la base de datos con Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="0d408-106">You do not have to make major architecture changes or write complex code to scale your database with Cosmos DB.</span></span> <span data-ttu-id="0d408-107">Escalar o reducir verticalmente es tan sencillo como realizar una única llamada de API o con el [método SDK](set-throughput.md#set-throughput-sdk).</span><span class="sxs-lookup"><span data-stu-id="0d408-107">Scaling up and down is as easy as making a single API call or [SDK method call](set-throughput.md#set-throughput-sdk).</span></span> <span data-ttu-id="0d408-108">Sin embargo, como el acceso a Cosmos DB se realiza mediante llamadas de red, puede realizar optimizaciones en el lado cliente para conseguir un rendimiento máximo.</span><span class="sxs-lookup"><span data-stu-id="0d408-108">However, because Cosmos DB is accessed via network calls there are client-side optimizations you can make to achieve peak performance.</span></span>

<span data-ttu-id="0d408-109">Así que si se está preguntando "¿Cómo puedo mejorar el rendimiento de la base de datos?",</span><span class="sxs-lookup"><span data-stu-id="0d408-109">So if you're asking "How can I improve my database performance?"</span></span> <span data-ttu-id="0d408-110">tenga en cuenta las opciones siguientes:</span><span class="sxs-lookup"><span data-stu-id="0d408-110">consider the following options:</span></span>

## <a name="networking"></a><span data-ttu-id="0d408-111">Redes</span><span class="sxs-lookup"><span data-stu-id="0d408-111">Networking</span></span>
<a id="direct-connection"></a>

1. <span data-ttu-id="0d408-112">**Directiva de conexión: uso del modo de conexión directa**</span><span class="sxs-lookup"><span data-stu-id="0d408-112">**Connection policy: Use direct connection mode**</span></span>

    <span data-ttu-id="0d408-113">El modo en que un cliente se conecta a Azure Cosmos DB tiene implicaciones importantes sobre el rendimiento, en concreto en términos de la latencia observada en el lado cliente.</span><span class="sxs-lookup"><span data-stu-id="0d408-113">How a client connects to Cosmos DB has important implications on performance, especially in terms of observed client-side latency.</span></span> <span data-ttu-id="0d408-114">Existen dos opciones de configuración principales disponibles para configurar la directiva de conexión de cliente: el *modo* de conexión y el [protocolo *de* conexión](#connection-protocol).</span><span class="sxs-lookup"><span data-stu-id="0d408-114">There are two key configuration settings available for configuring client Connection Policy – the connection *mode* and the [connection *protocol*](#connection-protocol).</span></span>  <span data-ttu-id="0d408-115">Los dos modos disponibles son:</span><span class="sxs-lookup"><span data-stu-id="0d408-115">The two available modes are:</span></span>

   1. <span data-ttu-id="0d408-116">Modo de puerta de enlace (predeterminado)</span><span class="sxs-lookup"><span data-stu-id="0d408-116">Gateway Mode (default)</span></span>
   2. <span data-ttu-id="0d408-117">Modo directo</span><span class="sxs-lookup"><span data-stu-id="0d408-117">Direct Mode</span></span>

      <span data-ttu-id="0d408-118">El modo de puerta de enlace se admite en todas las plataformas de SDK y es el valor predeterminado configurado.</span><span class="sxs-lookup"><span data-stu-id="0d408-118">Gateway Mode is supported on all SDK platforms and is the configured default.</span></span>  <span data-ttu-id="0d408-119">Si la aplicación se ejecuta dentro de una red corporativa con restricciones de firewall estrictas, el modo de puerta de enlace es la mejor opción, ya que utiliza el puerto HTTPS estándar y un único punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="0d408-119">If your application runs within a corporate network with strict firewall restrictions, Gateway Mode is the best choice since it uses the standard HTTPS port and a single endpoint.</span></span> <span data-ttu-id="0d408-120">La desventaja para el rendimiento, sin embargo, es que el modo de puerta de enlace implica un salto de red adicional cada vez que se leen o escriben datos en Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="0d408-120">The performance tradeoff, however, is that Gateway Mode involves an additional network hop every time data is read or written to Cosmos DB.</span></span> <span data-ttu-id="0d408-121">Por este motivo, el modo directo ofrece mejor rendimiento debido al número menor de saltos de red.</span><span class="sxs-lookup"><span data-stu-id="0d408-121">Because of this, Direct Mode offers better performance due to fewer network hops.</span></span>
<a id="use-tcp"></a>
2. <span data-ttu-id="0d408-122">**Directiva de conexión: uso del protocolo TCP**</span><span class="sxs-lookup"><span data-stu-id="0d408-122">**Connection policy: Use the TCP protocol**</span></span>

    <span data-ttu-id="0d408-123">Al usar el modo directo, hay dos opciones de protocolo disponibles:</span><span class="sxs-lookup"><span data-stu-id="0d408-123">When using Direct Mode, there are two protocol options available:</span></span>

   * <span data-ttu-id="0d408-124">TCP</span><span class="sxs-lookup"><span data-stu-id="0d408-124">TCP</span></span>
   * <span data-ttu-id="0d408-125">HTTPS</span><span class="sxs-lookup"><span data-stu-id="0d408-125">HTTPS</span></span>

     <span data-ttu-id="0d408-126">Cosmos DB ofrece un modelo de programación RESTful sencillo y abierto sobre HTTPS.</span><span class="sxs-lookup"><span data-stu-id="0d408-126">Cosmos DB offers a simple and open RESTful programming model over HTTPS.</span></span> <span data-ttu-id="0d408-127">Además, ofrece un protocolo TCP eficaz que también es RESTful en su modelo de comunicación y está disponible a través del SDK de cliente de .NET.</span><span class="sxs-lookup"><span data-stu-id="0d408-127">Additionally, it offers an efficient TCP protocol, which is also RESTful in its communication model and is available through the .NET client SDK.</span></span> <span data-ttu-id="0d408-128">Tanto HTTPS como TCP directo usan SSL para la autenticación inicial y cifrar el tráfico.</span><span class="sxs-lookup"><span data-stu-id="0d408-128">Both Direct TCP and HTTPS use SSL for initial authentication and encrypting traffic.</span></span> <span data-ttu-id="0d408-129">Para obtener el mejor rendimiento, utilice el protocolo TCP cuando sea posible.</span><span class="sxs-lookup"><span data-stu-id="0d408-129">For best performance, use the TCP protocol when possible.</span></span>

     <span data-ttu-id="0d408-130">Al utilizar TCP en modo de puerta de enlace, el puerto TCP 443 es el de Cosmos DB y el puerto 10255 es el puerto de la API de MongoDB.</span><span class="sxs-lookup"><span data-stu-id="0d408-130">When using TCP in Gateway Mode, TCP Port 443 is the Cosmos DB port, and 10255 is the MongoDB API port.</span></span> <span data-ttu-id="0d408-131">Al utilizar TCP en modo directo, además de los puertos de la puerta de enlace, debe garantizar que los puertos entre el 10000 y el 20000 estén abiertos, ya que Cosmos DB utiliza puertos TCP dinámicos.</span><span class="sxs-lookup"><span data-stu-id="0d408-131">When using TCP in Direct Mode, in addition to the Gateway ports, you need to ensure the port range between 10000 and 20000 is open because Cosmos DB uses dynamic TCP ports.</span></span> <span data-ttu-id="0d408-132">Si estos puertos no están abiertos y trata de utilizar TCP, recibirá un error 503 de servicio no disponible.</span><span class="sxs-lookup"><span data-stu-id="0d408-132">If these ports are not open and you attempt to use TCP, you receive a 503 Service Unavailable error.</span></span>

     <span data-ttu-id="0d408-133">El modo de conectividad se configura durante la construcción de la instancia de DocumentClient con el parámetro ConnectionPolicy.</span><span class="sxs-lookup"><span data-stu-id="0d408-133">The Connectivity Mode is configured during the construction of the DocumentClient instance with the ConnectionPolicy parameter.</span></span> <span data-ttu-id="0d408-134">Si se utiliza el modo directo, el protocolo también puede establecerse en el parámetro ConnectionPolicy.</span><span class="sxs-lookup"><span data-stu-id="0d408-134">If Direct Mode is used, the Protocol can also be set within the ConnectionPolicy parameter.</span></span>

    ```C#
    var serviceEndpoint = new Uri("https://contoso.documents.net");
    var authKey = new "your authKey from the Azure portal";
    DocumentClient client = new DocumentClient(serviceEndpoint, authKey,
    new ConnectionPolicy
    {
        ConnectionMode = ConnectionMode.Direct,
        ConnectionProtocol = Protocol.Tcp
    });
    ```

    <span data-ttu-id="0d408-135">Como TCP solo se admite en modo directo, si se utiliza el modo de puerta de enlace, siempre se usa el protocolo HTTPS para comunicarse con la puerta de enlace y se omite el valor de protocolo en el parámetro ConnectionPolicy.</span><span class="sxs-lookup"><span data-stu-id="0d408-135">Because TCP is only supported in Direct Mode, if Gateway Mode is used, then the HTTPS protocol is always used to communicate with the Gateway and the Protocol value in the ConnectionPolicy is ignored.</span></span>

    ![Ilustración de la directiva de conexión de Azure Cosmos DB](./media/performance-tips/connection-policy.png)

3. <span data-ttu-id="0d408-137">**Llamada a OpenAsync para evitar la latencia de inicio en la primera solicitud**</span><span class="sxs-lookup"><span data-stu-id="0d408-137">**Call OpenAsync to avoid startup latency on first request**</span></span>

    <span data-ttu-id="0d408-138">De forma predeterminada, la primera solicitud tendrá una latencia mayor porque debe capturar la tabla de enrutamiento de direcciones.</span><span class="sxs-lookup"><span data-stu-id="0d408-138">By default, the first request has a higher latency because it has to fetch the address routing table.</span></span> <span data-ttu-id="0d408-139">Para evitar esta latencia de inicio en la primera solicitud, se debe llamar a OpenAsync() una vez durante la inicialización de esta manera.</span><span class="sxs-lookup"><span data-stu-id="0d408-139">To avoid this startup latency on the first request, you should call OpenAsync() once during initialization as follows.</span></span>

        await client.OpenAsync();
   <a id="same-region"></a>
4. <span data-ttu-id="0d408-140">**Colocación de los clientes en la misma región de Azure para aumentar el rendimiento**</span><span class="sxs-lookup"><span data-stu-id="0d408-140">**Collocate clients in same Azure region for performance**</span></span>

    <span data-ttu-id="0d408-141">Cuando sea posible, coloque las aplicaciones que llaman a Cosmos DB en la misma región que la base de datos de Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="0d408-141">When possible, place any applications calling Cosmos DB in the same region as the Cosmos DB database.</span></span> <span data-ttu-id="0d408-142">Para obtener una comparación aproximada, las llamadas a Cosmos DB en la misma región se realizan en menos de 1 o 2 ms, pero la latencia entre las costas este y oeste de Estados Unidos es mayor de 50 ms.</span><span class="sxs-lookup"><span data-stu-id="0d408-142">For an approximate comparison, calls to Cosmos DB within the same region complete within 1-2 ms, but the latency between the West and East coast of the US is >50 ms.</span></span> <span data-ttu-id="0d408-143">Esta latencia podría variar de una solicitud a otra, según la ruta tomada por la solicitud cuando pasa del cliente al límite del centro de datos de Azure.</span><span class="sxs-lookup"><span data-stu-id="0d408-143">This latency can likely vary from request to request depending on the route taken by the request as it passes from the client to the Azure datacenter boundary.</span></span> <span data-ttu-id="0d408-144">Para conseguir la menor latencia posible, asegúrese de que la aplicación que llama se encuentra en la misma región de Azure que el punto de conexión de Cosmos DB aprovisionado.</span><span class="sxs-lookup"><span data-stu-id="0d408-144">The lowest possible latency is achieved by ensuring the calling application is located within the same Azure region as the provisioned Cosmos DB endpoint.</span></span> <span data-ttu-id="0d408-145">Para obtener una lista de regiones disponibles, consulte [Regiones de Azure](https://azure.microsoft.com/regions/#services).</span><span class="sxs-lookup"><span data-stu-id="0d408-145">For a list of available regions, see [Azure Regions](https://azure.microsoft.com/regions/#services).</span></span>

    <span data-ttu-id="0d408-146">![Ilustración de la directiva de conexión de Azure Cosmos DB](./media/performance-tips/same-region.png)
   <a id="increase-threads"></a></span><span class="sxs-lookup"><span data-stu-id="0d408-146">![Illustration of the Azure Cosmos DB connection policy](./media/performance-tips/same-region.png)
<a id="increase-threads"></a></span></span>
5. <span data-ttu-id="0d408-147">**Aumento del número de subprocesos y tareas**</span><span class="sxs-lookup"><span data-stu-id="0d408-147">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="0d408-148">Dado que las llamadas a Azure Cosmos DB se realizan a través de la red, puede que tenga que variar el grado de paralelismo de las solicitudes para reducir todo lo posible el tiempo que la aplicación cliente espera entre una solicitud y otra.</span><span class="sxs-lookup"><span data-stu-id="0d408-148">Since calls to Azure Cosmos DB are made over the network, you may need to vary the degree of parallelism of your requests so that the client application spends very little time waiting between requests.</span></span> <span data-ttu-id="0d408-149">Por ejemplo, si usa la [biblioteca TPL](https://msdn.microsoft.com//library/dd460717.aspx) de .NET, cree del orden de 100 tareas de lectura o escritura en Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="0d408-149">For example, if you're using .NET's [Task Parallel Library](https://msdn.microsoft.com//library/dd460717.aspx), create in the order of 100s of Tasks reading or writing to Cosmos DB.</span></span>

## <a name="sdk-usage"></a><span data-ttu-id="0d408-150">Uso del SDK</span><span class="sxs-lookup"><span data-stu-id="0d408-150">SDK Usage</span></span>
1. <span data-ttu-id="0d408-151">**Instalación del SDK más reciente**</span><span class="sxs-lookup"><span data-stu-id="0d408-151">**Install the most recent SDK**</span></span>

    <span data-ttu-id="0d408-152">Los SDK de Cosmos DB se mejoran constantemente para proporcionar el mejor rendimiento.</span><span class="sxs-lookup"><span data-stu-id="0d408-152">The Cosmos DB SDKs are constantly being improved to provide the best performance.</span></span> <span data-ttu-id="0d408-153">Consulte las páginas del [SDK de Cosmos DB](documentdb-sdk-dotnet.md) para determinar las mejoras de los SDK y las revisiones más recientes.</span><span class="sxs-lookup"><span data-stu-id="0d408-153">See the [Cosmos DB SDK](documentdb-sdk-dotnet.md) pages to determine the most recent SDK and review improvements.</span></span>
2. <span data-ttu-id="0d408-154">**Uso de un cliente de Cosmos DB singleton para aumentar la duración de la aplicación**</span><span class="sxs-lookup"><span data-stu-id="0d408-154">**Use a singleton Cosmos DB client for the lifetime of your application**</span></span>

    <span data-ttu-id="0d408-155">Tenga en cuenta que cada instancia de DocumentClient está protegida frente amenazas y realiza una administración de conexiones y un almacenamiento en caché de las direcciones de manera eficiente cuando funciona en modo directo.</span><span class="sxs-lookup"><span data-stu-id="0d408-155">Note that each DocumentClient instance is thread-safe and performs efficient connection management and address caching when operating in Direct Mode.</span></span> <span data-ttu-id="0d408-156">Para permitir la administración eficiente de las conexiones y un rendimiento mejor mediante DocumentClient, se recomienda usar una sola instancia de DocumentClient por AppDomain durante la vigencia de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="0d408-156">To allow efficient connection management and better performance by DocumentClient, it is recommended to use a single instance of DocumentClient per AppDomain for the lifetime of the application.</span></span>

   <a id="max-connection"></a>
3. <span data-ttu-id="0d408-157">**Aumento de System.Net MaxConnections por host al usar el modo de puerta de enlace**</span><span class="sxs-lookup"><span data-stu-id="0d408-157">**Increase System.Net MaxConnections per host when using Gateway mode**</span></span>

    <span data-ttu-id="0d408-158">Las solicitudes de Cosmos DB se realizan a través de HTTPS o REST cuando se usa el modo de puerta de enlace, y están condicionadas por los límites de conexión predeterminados por nombre de host o dirección IP.</span><span class="sxs-lookup"><span data-stu-id="0d408-158">Cosmos DB requests are made over HTTPS/REST when using Gateway mode, and are subjected to the default connection limit per hostname or IP address.</span></span> <span data-ttu-id="0d408-159">Puede que deba establecer MaxConnections en un valor mayor (100-1000) para que la biblioteca del cliente pueda utilizar varias conexiones simultáneas a Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="0d408-159">You may need to set the MaxConnections to a higher value (100-1000) so that the client library can utilize multiple simultaneous connections to Cosmos DB.</span></span> <span data-ttu-id="0d408-160">En el SDK 1.8.0 de .NET o versiones superiores, el valor predeterminado de [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) es 50 y para cambiar el valor, debe establecer [Documents.Client.ConnectionPolicy.MaxConnectionLimit](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx) en un valor más alto.</span><span class="sxs-lookup"><span data-stu-id="0d408-160">In the .NET SDK 1.8.0 and above, the default value for [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) is 50 and to change the value, you can set the [Documents.Client.ConnectionPolicy.MaxConnectionLimit](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx) to a higher value.</span></span>   
4. <span data-ttu-id="0d408-161">**Ajuste de consultas paralelas en colecciones particionadas**</span><span class="sxs-lookup"><span data-stu-id="0d408-161">**Tuning parallel queries for partitioned collections**</span></span>

     <span data-ttu-id="0d408-162">A partir de la versión 1.9.0 del SDK de .NET para DocumentDB se admiten consultas paralelas que permiten consultar una colección con particiones en paralelo (consulte [Trabajar con los SDK](documentdb-partition-data.md#working-with-the-azure-cosmos-db-sdks) y los [ejemplos de código](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) relacionados para más información).</span><span class="sxs-lookup"><span data-stu-id="0d408-162">DocumentDB .NET SDK version 1.9.0 and above support parallel queries, which enable you to query a partitioned collection in parallel (see [Working with the SDKs](documentdb-partition-data.md#working-with-the-azure-cosmos-db-sdks) and the related [code samples](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) for more info).</span></span> <span data-ttu-id="0d408-163">Las consultas paralelas están diseñadas para mejorar la latencia y el rendimiento de la consulta en todos sus homólogos seriales.</span><span class="sxs-lookup"><span data-stu-id="0d408-163">Parallel queries are designed to improve query latency and throughput over their serial counterpart.</span></span> <span data-ttu-id="0d408-164">Las consultas paralelas proporcionan dos parámetros que los usuarios pueden adaptar según sus necesidades: (a) MaxDegreeOfParallelism, para controlar el número máximo de particiones que se pueden consultar en paralelo, y (b) MaxBufferedItemCount, para controlar el número de resultados recuperados previamente.</span><span class="sxs-lookup"><span data-stu-id="0d408-164">Parallel queries provide two parameters that users can tune to custom-fit their requirements, (a) MaxDegreeOfParallelism: to control the maximum number of partitions then can be queried in parallel, and (b) MaxBufferedItemCount: to control the number of pre-fetched results.</span></span>

    <span data-ttu-id="0d408-165">(a) La consulta paralela ***Tuning MaxDegreeOfParallelism\:*** realiza consultas en varias particiones en paralelo.</span><span class="sxs-lookup"><span data-stu-id="0d408-165">(a) ***Tuning MaxDegreeOfParallelism\:*** Parallel query works by querying multiple partitions in parallel.</span></span> <span data-ttu-id="0d408-166">Sin embargo, los datos de una recopilación con particiones individual se capturan en serie con respecto a la consulta.</span><span class="sxs-lookup"><span data-stu-id="0d408-166">However, data from an individual partitioned collect is fetched serially with respect to the query.</span></span> <span data-ttu-id="0d408-167">Por lo tanto, establecer el parámetro MaxDegreeOfParallelism en el número de particiones tiene la máxima probabilidad de conseguir el mejor rendimiento de consulta, siempre y cuando el resto de las demás condiciones del sistema permanezcan invariables.</span><span class="sxs-lookup"><span data-stu-id="0d408-167">So, setting the MaxDegreeOfParallelism to the number of partitions has the maximum chance of achieving the most performant query, provided all other system conditions remain the same.</span></span> <span data-ttu-id="0d408-168">Si no conoce el número de particiones, puede establecer MaxDegreeOfParallelism en un número alto y el sistema elegirá el mínimo (número de particiones, entrada proporcionada por el usuario) como el valor de MaxDegreeOfParallelism.</span><span class="sxs-lookup"><span data-stu-id="0d408-168">If you don't know the number of partitions, you can set the MaxDegreeOfParallelism to a high number, and the system chooses the minimum (number of partitions, user provided input) as the MaxDegreeOfParallelism.</span></span>

    <span data-ttu-id="0d408-169">Es importante tener en cuenta que las consultas en paralelo producen los mejores beneficios si los datos se distribuyen uniformemente entre todas las particiones con respecto a la consulta.</span><span class="sxs-lookup"><span data-stu-id="0d408-169">It is important to note that parallel queries produce the best benefits if the data is evenly distributed across all partitions with respect to the query.</span></span> <span data-ttu-id="0d408-170">Si la colección con particiones está dividida de tal forma que todos, o la mayoría de los datos, devueltos por una consulta se concentran en algunas particiones (una partición en el peor de los casos), entonces el rendimiento de la consulta se vería afectada por cuellos de botella debido a esas particiones.</span><span class="sxs-lookup"><span data-stu-id="0d408-170">If the partitioned collection is partitioned such a way that all or a majority of the data returned by a query is concentrated in a few partitions (one partition in worst case), then the performance of the query would be bottlenecked by those partitions.</span></span>

    <span data-ttu-id="0d408-171">(b) La consulta paralela ***Tuning MaxBufferedItemCount\:*** está diseñada para capturar previamente los resultados mientras el cliente procesa el lote actual de resultados.</span><span class="sxs-lookup"><span data-stu-id="0d408-171">(b) ***Tuning MaxBufferedItemCount\:*** Parallel query is designed to pre-fetch results while the current batch of results is being processed by the client.</span></span> <span data-ttu-id="0d408-172">La captura previa ayuda a mejorar la latencia general de una consulta.</span><span class="sxs-lookup"><span data-stu-id="0d408-172">The pre-fetching helps in overall latency improvement of a query.</span></span> <span data-ttu-id="0d408-173">MaxBufferedItemCount es el parámetro para limitar el número de resultados capturados previamente.</span><span class="sxs-lookup"><span data-stu-id="0d408-173">MaxBufferedItemCount is the parameter to limit the number of pre-fetched results.</span></span> <span data-ttu-id="0d408-174">Establecer MaxBufferedItemCount en el número esperado de resultados devueltos (o un número más alto) permite que la consulta reciba el máximo beneficio de la captura previa.</span><span class="sxs-lookup"><span data-stu-id="0d408-174">Setting MaxBufferedItemCount to the expected number of results returned (or a higher number) allows the query to receive maximum benefit from pre-fetching.</span></span>

    <span data-ttu-id="0d408-175">Tenga en cuenta que la captura previa funciona de la misma manera con independencia de MaxDegreeOfParallelism, y que hay un único búfer para los datos de todas las particiones.</span><span class="sxs-lookup"><span data-stu-id="0d408-175">Note that pre-fetching works the same way irrespective of the MaxDegreeOfParallelism, and there is a single buffer for the data from all partitions.</span></span>  
5. <span data-ttu-id="0d408-176">**Activación de GC del lado servidor**</span><span class="sxs-lookup"><span data-stu-id="0d408-176">**Turn on server-side GC**</span></span>

    <span data-ttu-id="0d408-177">En algunos casos puede ser de ayuda reducir la frecuencia de recopilación de elementos no utilizados.</span><span class="sxs-lookup"><span data-stu-id="0d408-177">Reducing the frequency of garbage collection may help in some cases.</span></span> <span data-ttu-id="0d408-178">En .NET, establezca [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) en True.</span><span class="sxs-lookup"><span data-stu-id="0d408-178">In .NET, set [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) to true.</span></span>
6. <span data-ttu-id="0d408-179">**Implementación del retroceso según intervalos RetryAfter**</span><span class="sxs-lookup"><span data-stu-id="0d408-179">**Implement backoff at RetryAfter intervals**</span></span>

    <span data-ttu-id="0d408-180">Durante las pruebas de rendimiento, debe aumentar la carga hasta que se limite una tasa de solicitudes pequeña.</span><span class="sxs-lookup"><span data-stu-id="0d408-180">During performance testing, you should increase load until a small rate of requests get throttled.</span></span> <span data-ttu-id="0d408-181">Si se limita, la aplicación del cliente debe retroceder de acuerdo con la limitación para el intervalo de reintento que el servidor especificó.</span><span class="sxs-lookup"><span data-stu-id="0d408-181">If throttled, the client application should backoff on throttle for the server-specified retry interval.</span></span> <span data-ttu-id="0d408-182">Respetar el retroceso garantiza que dedica una cantidad de tiempo mínima de espera entre reintentos.</span><span class="sxs-lookup"><span data-stu-id="0d408-182">Respecting the backoff ensures that you spend minimal amount of time waiting between retries.</span></span> <span data-ttu-id="0d408-183">Se incluye compatibilidad con la directiva de reintentos en la versión 1.8.0 y superior de DocumentDB, [.NET](documentdb-sdk-dotnet.md) y [Java](documentdb-sdk-java.md), y en la versión 1.9.0 y superior de [Node.js](documentdb-sdk-node.md) y [Python](documentdb-sdk-python.md) y en todas las versiones compatibles de los SDK de [.NET Core](documentdb-sdk-dotnet-core.md).</span><span class="sxs-lookup"><span data-stu-id="0d408-183">Retry policy support is included in Version 1.8.0 and above of the DocumentDB [.NET](documentdb-sdk-dotnet.md) and [Java](documentdb-sdk-java.md), version 1.9.0 and above of the [Node.js](documentdb-sdk-node.md) and [Python](documentdb-sdk-python.md), and all supported versions of the [.NET Core](documentdb-sdk-dotnet-core.md) SDKs.</span></span> <span data-ttu-id="0d408-184">Para más información, consulte [Superación de los límites de rendimiento reservados](request-units.md#RequestRateTooLarge) y [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span><span class="sxs-lookup"><span data-stu-id="0d408-184">For more information, see [Exceeding reserved throughput limits](request-units.md#RequestRateTooLarge) and [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span></span>
7. <span data-ttu-id="0d408-185">**Escalado horizontal de la carga de trabajo de cliente**</span><span class="sxs-lookup"><span data-stu-id="0d408-185">**Scale out your client-workload**</span></span>

    <span data-ttu-id="0d408-186">Si va a realizar pruebas en niveles de alto rendimiento (>50 000 RU/s), la aplicación cliente puede volverse un cuello de botella debido a que la máquina limita el uso de CPU o de la red.</span><span class="sxs-lookup"><span data-stu-id="0d408-186">If you are testing at high throughput levels (>50,000 RU/s), the client application may become the bottleneck due to the machine capping out on CPU or Network utilization.</span></span> <span data-ttu-id="0d408-187">Si llega a este punto, puede seguir insertando la cuenta de Cosmos DB mediante la escala horizontal de las aplicaciones cliente en varios servidores.</span><span class="sxs-lookup"><span data-stu-id="0d408-187">If you reach this point, you can continue to push the Cosmos DB account further by scaling out your client applications across multiple servers.</span></span>
8. <span data-ttu-id="0d408-188">**Almacenamiento en caché de los identificadores URI de documentos para una latencia menor en las operaciones de lectura**</span><span class="sxs-lookup"><span data-stu-id="0d408-188">**Cache document URIs for lower read latency**</span></span>

    <span data-ttu-id="0d408-189">Siempre que sea posible, almacene en caché los identificadores URI para obtener el mejor rendimiento en las operaciones de lectura.</span><span class="sxs-lookup"><span data-stu-id="0d408-189">Cache document URIs whenever possible for the best read performance.</span></span>
   <a id="tune-page-size"></a>
9. <span data-ttu-id="0d408-190">**Ajuste del tamaño de página en consultas y fuentes de lectura para aumentar el rendimiento**</span><span class="sxs-lookup"><span data-stu-id="0d408-190">**Tune the page size for queries/read feeds for better performance**</span></span>

    <span data-ttu-id="0d408-191">Al realizar una lectura masiva de documentos mediante la funcionalidad de fuentes de lectura (por ejemplo, ReadDocumentFeedAsync) o al emitir una consulta SQL de DocumentDB, los resultados se devuelven de forma segmentada si el conjunto de resultados es demasiado grande.</span><span class="sxs-lookup"><span data-stu-id="0d408-191">When performing a bulk read of documents using read feed functionality (for example, ReadDocumentFeedAsync) or when issuing a DocumentDB SQL query, the results are returned in a segmented fashion if the result set is too large.</span></span> <span data-ttu-id="0d408-192">De forma predeterminada, se devuelven resultados en fragmentos de 1 MB o de 100 artículos, el límite que se alcance primero.</span><span class="sxs-lookup"><span data-stu-id="0d408-192">By default, results are returned in chunks of 100 items or 1 MB, whichever limit is hit first.</span></span>

    <span data-ttu-id="0d408-193">Para reducir el número de recorridos de ida y vuelta de red necesarios para recuperar todos los resultados aplicables, puede aumentar el tamaño de página con el encabezado de solicitud x-ms-max-item-count hasta a 1000.</span><span class="sxs-lookup"><span data-stu-id="0d408-193">To reduce the number of network round trips required to retrieve all applicable results, you can increase the page size using x-ms-max-item-count request header to up to 1000.</span></span> <span data-ttu-id="0d408-194">En aquellos casos en los que solo sea necesario mostrar unos cuantos resultados, por ejemplo, si la interfaz de usuario o la API de aplicación solo devuelven 10 resultados de una vez, también puede reducir el tamaño de página a 10 a fin de reducir el rendimiento consumido en las lecturas y consultas.</span><span class="sxs-lookup"><span data-stu-id="0d408-194">In cases where you need to display only a few results, for example, if your user interface or application API returns only 10 results a time, you can also decrease the page size to 10 to reduce the throughput consumed for reads and queries.</span></span>

    <span data-ttu-id="0d408-195">También puede establecer el tamaño de página mediante los SDK de Cosmos DB disponibles.</span><span class="sxs-lookup"><span data-stu-id="0d408-195">You may also set the page size using the available Cosmos DB SDKs.</span></span>  <span data-ttu-id="0d408-196">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="0d408-196">For example:</span></span>

        IQueryable<dynamic> authorResults = client.CreateDocumentQuery(documentCollection.SelfLink, "SELECT p.Author FROM Pages p WHERE p.Title = 'About Seattle'", new FeedOptions { MaxItemCount = 1000 });
10. <span data-ttu-id="0d408-197">**Aumento del número de subprocesos y tareas**</span><span class="sxs-lookup"><span data-stu-id="0d408-197">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="0d408-198">Consulte [Aumento del número de subprocesos y tareas](#increase-threads) en la sección Redes.</span><span class="sxs-lookup"><span data-stu-id="0d408-198">See [Increase number of threads/tasks](#increase-threads) in the Networking section.</span></span>

11. <span data-ttu-id="0d408-199">**Uso del proceso de host de 64 bits**</span><span class="sxs-lookup"><span data-stu-id="0d408-199">**Use 64-bit host processing**</span></span>

    <span data-ttu-id="0d408-200">El SDK de DocumentDB funciona en un proceso de host de 32 bits cuando se usa la versión 1.11.4 y superior del SDK de .NET de DocumentDB.</span><span class="sxs-lookup"><span data-stu-id="0d408-200">The DocumentDB SDK works in a 32-bit host process when you are using DocumentDB .NET SDK version 1.11.4 and above.</span></span> <span data-ttu-id="0d408-201">Sin embargo, si utiliza consultas entre particiones, se recomienda el proceso de host de 64 bits para obtener un mejor rendimiento.</span><span class="sxs-lookup"><span data-stu-id="0d408-201">However, if you are using cross partition queries, 64-bit host processing is recommended for improved performance.</span></span> <span data-ttu-id="0d408-202">De forma predeterminada, los siguientes tipos de aplicaciones tienen un proceso de host de 32 bits; para cambiar a 64 bits, siga estos pasos según el tipo de aplicación:</span><span class="sxs-lookup"><span data-stu-id="0d408-202">The following types of applications have 32-bit host process as the default, so in order to change that to 64-bit, follow these steps based on the type of your application:</span></span>

    - <span data-ttu-id="0d408-203">Para aplicaciones ejecutables, esto puede hacerse desactivando la opción **Preferencia de 32 bits** de la ventana **Propiedades del proyecto**, en la pestaña **Generar**.</span><span class="sxs-lookup"><span data-stu-id="0d408-203">For Executable applications, this can be done by unchecking the **Prefer 32-bit** option in the **Project Properties** window, on the **Build** tab.</span></span>

    - <span data-ttu-id="0d408-204">Para proyectos de prueba basados en VSTest, puede hacerlo seleccionando **Prueba**->**Configuración de pruebas**->**Arquitectura del procesador predeterminada como X64**, en la opción de menú **Prueba de Visual Studio**.</span><span class="sxs-lookup"><span data-stu-id="0d408-204">For VSTest based test projects, this can be done by selecting **Test**->**Test Settings**->**Default Processor Architecture as X64**, from the **Visual Studio Test** menu option.</span></span>

    - <span data-ttu-id="0d408-205">Para aplicaciones web de ASP.NET implementadas localmente, se puede hacer seleccionando **Usar la versión de 64 bits de IIS Express para proyectos y sitios web**, en **Herramientas**->**Opciones**->**Proyectos y soluciones**->**Proyectos Web**.</span><span class="sxs-lookup"><span data-stu-id="0d408-205">For locally deployed ASP.NET Web applications, this can be done by checking the **Use the 64-bit version of IIS Express for web sites and projects**, under **Tools**->**Options**->**Projects and Solutions**->**Web Projects**.</span></span>

    - <span data-ttu-id="0d408-206">Para aplicaciones web de ASP.NET implementadas en Azure, se puede hacer eligiendo la **Plataforma de 64 bits** en **Configuración de la aplicación** en Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="0d408-206">For ASP.NET Web applications deployed on Azure, this can be done by choosing the **Platform as 64-bit** in the **Application Settings** on the Azure portal.</span></span>

## <a name="indexing-policy"></a><span data-ttu-id="0d408-207">Directiva de indexación</span><span class="sxs-lookup"><span data-stu-id="0d408-207">Indexing Policy</span></span>
1. <span data-ttu-id="0d408-208">**Uso de la indexación diferida para lograr tasas de ingesta más rápidas a horas punta**</span><span class="sxs-lookup"><span data-stu-id="0d408-208">**Use lazy indexing for faster peak time ingestion rates**</span></span>

    <span data-ttu-id="0d408-209">Cosmos DB le permite especificar, en el nivel de colección, una directiva de indexación que le permite elegir si quiere que los documentos de una colección se indexen o no automáticamente.</span><span class="sxs-lookup"><span data-stu-id="0d408-209">Cosmos DB allows you to specify – at the collection level – an indexing policy, which enables you to choose if you want the documents in a collection to be automatically indexed or not.</span></span>  <span data-ttu-id="0d408-210">Además, puede elegir entre actualizaciones de índices sincrónicas (coherentes) y asincrónicas (diferidas).</span><span class="sxs-lookup"><span data-stu-id="0d408-210">In addition, you may also choose between synchronous (Consistent) and asynchronous (Lazy) index updates.</span></span> <span data-ttu-id="0d408-211">De forma predeterminada, el índice se actualiza de forma sincrónica con cada inserción, reemplazo o eliminación de un documento de la colección.</span><span class="sxs-lookup"><span data-stu-id="0d408-211">By default, the index is updated synchronously on each insert, replace, or delete of a document to the collection.</span></span> <span data-ttu-id="0d408-212">El modo sincrónico permite que las consultas tengan el mismo [nivel de coherencia](consistency-levels.md) que el de las lecturas de los documentos sin demoras en la actualización de los índices.</span><span class="sxs-lookup"><span data-stu-id="0d408-212">Synchronously mode enables the queries to honor the same [consistency level](consistency-levels.md) as that of the document reads without any delay for the index to “catch up".</span></span>

    <span data-ttu-id="0d408-213">La indexación diferida se puede considerar en escenarios en los que los datos se escriben en ráfagas y desea amortizar el trabajo necesario para indexar el contenido durante un período de tiempo más prolongado.</span><span class="sxs-lookup"><span data-stu-id="0d408-213">Lazy indexing may be considered for scenarios in which data is written in bursts, and you want to amortize the work required to index content over a longer period of time.</span></span> <span data-ttu-id="0d408-214">También permite usar de forma eficaz el rendimiento aprovisionado y atender a las solicitudes de escritura en las horas punta con una latencia mínima.</span><span class="sxs-lookup"><span data-stu-id="0d408-214">Lazy indexing also allows you to use your provisioned throughput effectively and serve write requests at peak times with minimal latency.</span></span> <span data-ttu-id="0d408-215">Sin embargo, es importante advertir que cuando la indexación diferida está habilitada, los resultados de consulta serán a la larga coherentes con independencia del nivel de coherencia configurado para la cuenta de Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="0d408-215">It is important to note, however, that when lazy indexing is enabled, query results are eventually consistent regardless of the consistency level configured for the Cosmos DB account.</span></span>

    <span data-ttu-id="0d408-216">Por lo tanto, el modo de indexación coherente (IndexingPolicy.IndexingMode está establecido en Coherente) genera el mayor gasto de unidad de solicitud por escritura (IndexingPolicy.IndexingMode está establecido en Diferido) y la ausencia de indexación (IndexingPolicy.Automatic está establecido en False) tiene cero costos de indexación en el momento de la escritura.</span><span class="sxs-lookup"><span data-stu-id="0d408-216">Hence, Consistent indexing mode (IndexingPolicy.IndexingMode is set to Consistent) incurs the highest request unit charge per write, while Lazy indexing mode (IndexingPolicy.IndexingMode is set to Lazy) and no indexing (IndexingPolicy.Automatic is set to False) have zero indexing cost at the time of write.</span></span>
2. <span data-ttu-id="0d408-217">**Exclusión de rutas de acceso sin utilizar de la indexación para acelerar las escrituras**</span><span class="sxs-lookup"><span data-stu-id="0d408-217">**Exclude unused paths from indexing for faster writes**</span></span>

    <span data-ttu-id="0d408-218">La directiva de indexación de Cosmos DB también le permite especificar las rutas de acceso de documentos que se incluirán en la indexación o se excluirán de esta mediante el aprovechamiento de las rutas de acceso de indexación (IndexingPolicy.IncludedPaths y IndexingPolicy.ExcludedPaths).</span><span class="sxs-lookup"><span data-stu-id="0d408-218">Cosmos DB’s indexing policy also allows you to specify which document paths to include or exclude from indexing by leveraging Indexing Paths (IndexingPolicy.IncludedPaths and IndexingPolicy.ExcludedPaths).</span></span> <span data-ttu-id="0d408-219">El uso de rutas de acceso de indexación puede ofrecer un rendimiento de escritura mejorado y un almacenamiento de índices reducido en escenarios en los que los patrones de consulta se conocen de antemano, dado que los costos de indexación están directamente correlacionados con el número de rutas de acceso únicas indexadas.</span><span class="sxs-lookup"><span data-stu-id="0d408-219">The use of indexing paths can offer improved write performance and lower index storage for scenarios in which the query patterns are known beforehand, as indexing costs are directly correlated to the number of unique paths indexed.</span></span>  <span data-ttu-id="0d408-220">Por ejemplo, el código siguiente muestra cómo excluir una sección completa de los documentos (también conocido como</span><span class="sxs-lookup"><span data-stu-id="0d408-220">For example, the following code shows how to exclude an entire section of the documents (a.k.a.</span></span> <span data-ttu-id="0d408-221">subárbol) de la indexación usando el comodín "*".</span><span class="sxs-lookup"><span data-stu-id="0d408-221">a subtree) from indexing using the "*" wildcard.</span></span>

    ```C#
    var collection = new DocumentCollection { Id = "excludedPathCollection" };
    collection.IndexingPolicy.IncludedPaths.Add(new IncludedPath { Path = "/*" });
    collection.IndexingPolicy.ExcludedPaths.Add(new ExcludedPath { Path = "/nonIndexedContent/*");
    collection = await client.CreateDocumentCollectionAsync(UriFactory.CreateDatabaseUri("db"), excluded);
    ```

    <span data-ttu-id="0d408-222">Para más información, consulte [Directivas de indexación de Azure Cosmos DB](indexing-policies.md).</span><span class="sxs-lookup"><span data-stu-id="0d408-222">For more information, see [Azure Cosmos DB indexing policies](indexing-policies.md).</span></span>

## <a name="throughput"></a><span data-ttu-id="0d408-223">Rendimiento</span><span class="sxs-lookup"><span data-stu-id="0d408-223">Throughput</span></span>
<a id="measure-rus"></a>

1. <span data-ttu-id="0d408-224">**Medición y optimización del uso menor de unidades de solicitud por segundo**</span><span class="sxs-lookup"><span data-stu-id="0d408-224">**Measure and tune for lower request units/second usage**</span></span>

    <span data-ttu-id="0d408-225">Cosmos DB ofrece un amplio conjunto de operaciones de base de datos, incluidas consultas relacionales y jerárquicas con funciones definidas por el usuario, procedimientos almacenados y desencadenadores. Todo funciona con los documentos dentro de una colección de base de datos.</span><span class="sxs-lookup"><span data-stu-id="0d408-225">Cosmos DB offers a rich set of database operations including relational and hierarchical queries with UDFs, stored procedures, and triggers – all operating on the documents within a database collection.</span></span> <span data-ttu-id="0d408-226">El costo asociado a cada una de estas operaciones variará en función de la CPU, la E/S y la memoria necesarias para completar la operación.</span><span class="sxs-lookup"><span data-stu-id="0d408-226">The cost associated with each of these operations varies based on the CPU, IO, and memory required to complete the operation.</span></span> <span data-ttu-id="0d408-227">En lugar de administrar y pensar sobre los recursos de hardware, puede pensar en una unidad de solicitud (RU) como una medida única para los recursos necesarios para realizar varias operaciones de la base de datos y dar servicio a una solicitud de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="0d408-227">Instead of thinking about and managing hardware resources, you can think of a request unit (RU) as a single measure for the resources required to perform various database operations and service an application request.</span></span>

    <span data-ttu-id="0d408-228">[unidades de solicitud](request-units.md) se aprovisionan para cada cuenta de base de datos según el número de unidades de capacidad que adquiera.</span><span class="sxs-lookup"><span data-stu-id="0d408-228">[Request units](request-units.md) are provisioned for each database account based on the number of capacity units that you purchase.</span></span> <span data-ttu-id="0d408-229">El consumo de la unidad de solicitud se evalúa como frecuencia por segundo.</span><span class="sxs-lookup"><span data-stu-id="0d408-229">Request unit consumption is evaluated as a rate per second.</span></span> <span data-ttu-id="0d408-230">Las aplicaciones que superan la frecuencia de unidad de solicitud aprovisionada para su cuenta se limitarán hasta que la frecuencia caiga por debajo del nivel reservado para la cuenta.</span><span class="sxs-lookup"><span data-stu-id="0d408-230">Applications that exceed the provisioned request unit rate for their account is limited until the rate drops below the reserved level for the account.</span></span> <span data-ttu-id="0d408-231">Si su aplicación necesita un nivel mayor de capacidad de proceso, puede adquirir unidades de capacidad adicionales.</span><span class="sxs-lookup"><span data-stu-id="0d408-231">If your application requires a higher level of throughput, you can purchase additional capacity units.</span></span>

    <span data-ttu-id="0d408-232">La complejidad de una consulta afecta a la cantidad de unidades de solicitud consumidas para una operación.</span><span class="sxs-lookup"><span data-stu-id="0d408-232">The complexity of a query impacts how many Request Units are consumed for an operation.</span></span> <span data-ttu-id="0d408-233">El número de predicados, la naturaleza de los predicados, el número de UDF y el tamaño del conjunto de datos de origen influyen en el costo de operaciones de consulta.</span><span class="sxs-lookup"><span data-stu-id="0d408-233">The number of predicates, nature of the predicates, number of UDFs, and the size of the source data set all influence the cost of query operations.</span></span>

    <span data-ttu-id="0d408-234">Para medir la sobrecarga de cualquier operación (crear, actualizar o eliminar), inspeccione el encabezado x-ms-request-charge (o la propiedad RequestCharge equivalente en ResourceResponse<T> o FeedResponse<T>del SDK de .NET) para medir el número de unidades de solicitudes usadas por estas operaciones.</span><span class="sxs-lookup"><span data-stu-id="0d408-234">To measure the overhead of any operation (create, update, or delete), inspect the x-ms-request-charge header (or the equivalent RequestCharge property in ResourceResponse<T> or FeedResponse<T> in the .NET SDK) to measure the number of request units consumed by these operations.</span></span>

    ```C#
    // Measure the performance (request units) of writes
    ResourceResponse<Document> response = await client.CreateDocumentAsync(collectionSelfLink, myDocument);
    Console.WriteLine("Insert of document consumed {0} request units", response.RequestCharge);
    // Measure the performance (request units) of queries
    IDocumentQuery<dynamic> queryable = client.CreateDocumentQuery(collectionSelfLink, queryString).AsDocumentQuery();
    while (queryable.HasMoreResults)
         {
              FeedResponse<dynamic> queryResponse = await queryable.ExecuteNextAsync<dynamic>();
              Console.WriteLine("Query batch consumed {0} request units", queryResponse.RequestCharge);
         }
    ```             

    <span data-ttu-id="0d408-235">El cargo de solicitud devuelto en este encabezado es una fracción de la capacidad de proceso aprovisionada (es decir, 2000 RU/segundo).</span><span class="sxs-lookup"><span data-stu-id="0d408-235">The request charge returned in this header is a fraction of your provisioned throughput (i.e., 2000 RUs / second).</span></span> <span data-ttu-id="0d408-236">Por ejemplo, si la consulta anterior devuelve 1000 documentos de 1 KB, el coste de la operación será 1000.</span><span class="sxs-lookup"><span data-stu-id="0d408-236">For example, if the preceding query returns 1000 1KB-documents, the cost of the operation is 1000.</span></span> <span data-ttu-id="0d408-237">Por lo tanto, al cabo de un segundo, el servidor respetará solo dos de estas solicitudes antes de limitar las que vengan a continuación.</span><span class="sxs-lookup"><span data-stu-id="0d408-237">As such, within one second, the server honors only two such requests before throttling subsequent requests.</span></span> <span data-ttu-id="0d408-238">Para más información, consulte [Unidades de solicitud](request-units.md) y la [calculadora de unidades de solicitud](https://www.documentdb.com/capacityplanner).</span><span class="sxs-lookup"><span data-stu-id="0d408-238">For more information, see [Request units](request-units.md) and the [request unit calculator](https://www.documentdb.com/capacityplanner).</span></span>
<a id="429"></a>
2. <span data-ttu-id="0d408-239">**Administración de la limitación de velocidad y la tasa de solicitudes demasiado grande**</span><span class="sxs-lookup"><span data-stu-id="0d408-239">**Handle rate limiting/request rate too large**</span></span>

    <span data-ttu-id="0d408-240">Cuando un cliente intenta superar la capacidad de proceso reservada para una cuenta, no habrá ninguna degradación del rendimiento en el servidor y no se utilizará ninguna capacidad de proceso más allá del nivel reservado.</span><span class="sxs-lookup"><span data-stu-id="0d408-240">When a client attempts to exceed the reserved throughput for an account, there is no performance degradation at the server and no use of throughput capacity beyond the reserved level.</span></span> <span data-ttu-id="0d408-241">El servidor finalizará de forma preventiva la solicitud con RequestRateTooLarge (código de estado HTTP 429) y devolverá el encabezado x-ms-retry-after-ms para indicar la cantidad de tiempo, en milisegundos, que el usuario debe esperar antes de volver a intentar realizar la solicitud.</span><span class="sxs-lookup"><span data-stu-id="0d408-241">The server will preemptively end the request with RequestRateTooLarge (HTTP status code 429) and return the x-ms-retry-after-ms header indicating the amount of time, in milliseconds, that the user must wait before reattempting the request.</span></span>

        HTTP Status 429,
        Status Line: RequestRateTooLarge
        x-ms-retry-after-ms :100

    <span data-ttu-id="0d408-242">Los SDK capturan implícitamente esta respuesta, respetan el encabezado retry-after especificado por el servidor y reintentan la solicitud.</span><span class="sxs-lookup"><span data-stu-id="0d408-242">The SDKs all implicitly catch this response, respect the server-specified retry-after header, and retry the request.</span></span> <span data-ttu-id="0d408-243">A menos que varios clientes obtengan acceso a la cuenta al mismo tiempo, el siguiente reintento se realizará correctamente.</span><span class="sxs-lookup"><span data-stu-id="0d408-243">Unless your account is being accessed concurrently by multiple clients, the next retry will succeed.</span></span>

    <span data-ttu-id="0d408-244">Si tiene más de un cliente que funciona acumulativamente de forma coherente por encima de la tasa de solicitudes, puede que el número de reintentos predeterminado establecido actualmente en 9 de manera interna por el cliente no sea suficiente; en este caso, el cliente producirá una excepción DocumentClientException con el código de estado 429 para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="0d408-244">If you have more than one client cumulatively operating consistently above the request rate, the default retry count currently set to 9 internally by the client may not suffice; in this case, the client throws a DocumentClientException with status code 429 to the application.</span></span> <span data-ttu-id="0d408-245">El número de reintentos predeterminado se puede cambiar estableciendo RetryOptions en la instancia ConnectionPolicy.</span><span class="sxs-lookup"><span data-stu-id="0d408-245">The default retry count can be changed by setting the RetryOptions on the ConnectionPolicy instance.</span></span> <span data-ttu-id="0d408-246">De forma predeterminada, la excepción DocumentClientException con el código de estado 429 se devuelve tras un tiempo de espera acumulativo de 30 segundos si la solicitud sigue funcionando por encima de la tasa de solicitudes.</span><span class="sxs-lookup"><span data-stu-id="0d408-246">By default, the DocumentClientException with status code 429 is returned after a cumulative wait time of 30 seconds if the request continues to operate above the request rate.</span></span> <span data-ttu-id="0d408-247">Esto sucede incluso cuando el número de reintentos actual es inferior al número de reintentos máximo de 9, el valor predeterminado, o un valor definido por el usuario.</span><span class="sxs-lookup"><span data-stu-id="0d408-247">This occurs even when the current retry count is less than the max retry count, be it the default of 9 or a user-defined value.</span></span>

    <span data-ttu-id="0d408-248">Aunque el comportamiento de reintento automático ayuda a mejorar la resistencia y la usabilidad en la mayoría de las aplicaciones, podría no resultar ventajoso al realizar comparativas de rendimiento, en especial al medir la latencia.</span><span class="sxs-lookup"><span data-stu-id="0d408-248">While the automated retry behavior helps to improve resiliency and usability for the most applications, it might come at odds when doing performance benchmarks, especially when measuring latency.</span></span>  <span data-ttu-id="0d408-249">La latencia observada del cliente aumentará si el experimento llega a la limitación del servidor y hace que el SDK del cliente realice reintentos de forma silenciosa.</span><span class="sxs-lookup"><span data-stu-id="0d408-249">The client-observed latency will spike if the experiment hits the server throttle and causes the client SDK to silently retry.</span></span> <span data-ttu-id="0d408-250">Para evitar aumentos de latencia durante los experimentos de rendimiento, mida el gasto devuelto por cada operación y asegúrese de que las solicitudes funcionan por debajo de la tasa de solicitudes observada.</span><span class="sxs-lookup"><span data-stu-id="0d408-250">To avoid latency spikes during performance experiments, measure the charge returned by each operation and ensure that requests are operating below the reserved request rate.</span></span> <span data-ttu-id="0d408-251">Para más información, consulte [Unidades de solicitud](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="0d408-251">For more information, see [Request units](request-units.md).</span></span>
3. <span data-ttu-id="0d408-252">**Diseño de documentos más pequeños para un mayor rendimiento**</span><span class="sxs-lookup"><span data-stu-id="0d408-252">**Design for smaller documents for higher throughput**</span></span>

    <span data-ttu-id="0d408-253">El gasto de solicitud (es decir, el costo de procesamiento de solicitudes) de una operación dada está directamente correlacionado con el tamaño del documento.</span><span class="sxs-lookup"><span data-stu-id="0d408-253">The request charge (i.e. request processing cost) of a given operation is directly correlated to the size of the document.</span></span> <span data-ttu-id="0d408-254">Las operaciones con documentos grandes cuestan más que las operaciones con documentos pequeños.</span><span class="sxs-lookup"><span data-stu-id="0d408-254">Operations on large documents cost more than operations for small documents.</span></span>

## <a name="next-steps"></a><span data-ttu-id="0d408-255">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="0d408-255">Next steps</span></span>
<span data-ttu-id="0d408-256">Si quiere ver una aplicación de ejemplo usada para evaluar Cosmos DB en escenarios de alto rendimiento en un pequeño número de máquinas cliente, consulte [Pruebas de escala y rendimiento con Cosmos DB](performance-testing.md).</span><span class="sxs-lookup"><span data-stu-id="0d408-256">For a sample application used to evaluate Cosmos DB for high-performance scenarios on a few client machines, see [Performance and scale testing with Cosmos DB](performance-testing.md).</span></span>

<span data-ttu-id="0d408-257">Para más información sobre cómo diseñar la aplicación para escalarla y obtener un alto rendimiento, consulte [Partición y escalado en Azure Cosmos DB](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="0d408-257">Also, to learn more about designing your application for scale and high performance, see [Partitioning and scaling in Azure Cosmos DB](partition-data.md).</span></span>

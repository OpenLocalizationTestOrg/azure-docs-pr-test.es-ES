---
title: "Copias de seguridad y restauración en línea con Azure Cosmos DB | Microsoft Docs"
description: "Obtenga información sobre cómo ejecutar copias de seguridad y restauración automáticas de bases de datos de Azure Cosmos DB."
keywords: "copias de seguridad y restauración, copia de seguridad en línea"
services: cosmos-db
documentationcenter: 
author: RahulPrasad16
manager: jhubbard
editor: monicar
ms.assetid: 98eade4a-7ef4-4667-b167-6603ecd80b79
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 08/11/2017
ms.author: raprasa
ms.openlocfilehash: 130f0eb259621737d6dbdb151e363915fb334ce1
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/18/2017
---
# <a name="automatic-online-backup-and-restore-with-azure-cosmos-db"></a><span data-ttu-id="4d04d-104">Copias de seguridad y restauración automáticas en línea con Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="4d04d-104">Automatic online backup and restore with Azure Cosmos DB</span></span>
<span data-ttu-id="4d04d-105">Azure Cosmos DB crea automáticamente copias de seguridad de todos los datos a intervalos regulares.</span><span class="sxs-lookup"><span data-stu-id="4d04d-105">Azure Cosmos DB automatically takes backups of all your data at regular intervals.</span></span> <span data-ttu-id="4d04d-106">Las copias de seguridad automáticas se crean sin afectar el rendimiento ni la disponibilidad de las operaciones de bases de datos.</span><span class="sxs-lookup"><span data-stu-id="4d04d-106">The automatic backups are taken without affecting the performance or availability of your database operations.</span></span> <span data-ttu-id="4d04d-107">Todas las copias de seguridad se almacenan por separado en otro servicio de almacenamiento y se replican globalmente para lograr resistencia frente a desastres regionales.</span><span class="sxs-lookup"><span data-stu-id="4d04d-107">All your backups are stored separately in another storage service, and those backups are globally replicated for resiliency against regional disasters.</span></span> <span data-ttu-id="4d04d-108">Las copias de seguridad automáticas están pensadas para escenarios en los que se elimina accidentalmente el contenedor de Cosmos DB y que después requieren una solución de recuperación de datos o recuperación ante desastres.</span><span class="sxs-lookup"><span data-stu-id="4d04d-108">The automatic backups are intended for scenarios when you accidentally delete your Comos DB container and later require data recovery or a disaster recovery solution.</span></span>  

<span data-ttu-id="4d04d-109">Este artículo comienza con un resumen rápido de la disponibilidad y redundancia de datos en Cosmos DB y, luego, analiza las copias de seguridad.</span><span class="sxs-lookup"><span data-stu-id="4d04d-109">This article starts with a quick recap of the data redundancy and availability in Cosmos DB, and then discusses backups.</span></span> 

## <a name="high-availability-with-cosmos-db---a-recap"></a><span data-ttu-id="4d04d-110">Resumen de la alta disponibilidad con Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="4d04d-110">High availability with Cosmos DB - a recap</span></span>
<span data-ttu-id="4d04d-111">Cosmos DB está diseñado para su [distribución global](distribute-data-globally.md): le permite escalar el rendimiento en varias regiones de Azure junto con API transparentes de hospedaje múltiple y conmutación por error controlada por directivas.</span><span class="sxs-lookup"><span data-stu-id="4d04d-111">Cosmos DB is designed to be [globally distributed](distribute-data-globally.md) – it allows you to scale throughput across multiple Azure regions along with policy driven failover and transparent multi-homing APIs.</span></span> <span data-ttu-id="4d04d-112">Debido a que el sistema de la base de datos ofrece [Acuerdos de Nivel de Servicio de una disponibilidad del 99,99 %](https://azure.microsoft.com/support/legal/sla/cosmos-db), todas las escrituras en Cosmos DB se envían de forma duradera a los discos locales mediante un cuórum de réplicas dentro de un centro de datos local antes de informar al cliente.</span><span class="sxs-lookup"><span data-stu-id="4d04d-112">As a database system offering [99.99% availability SLAs](https://azure.microsoft.com/support/legal/sla/cosmos-db), all the writes in Cosmos DB are durably committed to local disks by a quorum of replicas within a local data center before acknowledging to the client.</span></span> <span data-ttu-id="4d04d-113">Tenga en cuenta que la alta disponibilidad de Cosmos DB se basa en el almacenamiento local y no depende de ninguna tecnología de almacenamiento externo.</span><span class="sxs-lookup"><span data-stu-id="4d04d-113">Note that the high availability of Cosmos DB relies on local storage and does not depend on any external storage technologies.</span></span> <span data-ttu-id="4d04d-114">Además, si la cuenta de base de datos está asociada con más de una región de Azure, las escrituras se replicarán también en otras regiones.</span><span class="sxs-lookup"><span data-stu-id="4d04d-114">Additionally, if your database account is associated with more than one Azure region, your writes are replicated across other regions as well.</span></span> <span data-ttu-id="4d04d-115">Para escalar el rendimiento y los datos de acceso a bajas latencias, puede tener todas las regiones de lectura asociadas que desee con la cuenta de base de datos.</span><span class="sxs-lookup"><span data-stu-id="4d04d-115">To scale your throughput and access data at low latencies, you can have as many read regions associated with your database account as you like.</span></span> <span data-ttu-id="4d04d-116">En cada región de lectura, los datos (replicados) persisten de forma duradera en un conjunto de réplicas.</span><span class="sxs-lookup"><span data-stu-id="4d04d-116">In each read region, the (replicated) data is durably persisted across a replica set.</span></span>  

<span data-ttu-id="4d04d-117">Tal como aparece en el diagrama siguiente, un único contenedor de Cosmos DB tiene [particiones horizontales](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="4d04d-117">As illustrated in the following diagram, a single Cosmos DB container is [horizontally partitioned](partition-data.md).</span></span> <span data-ttu-id="4d04d-118">En el siguiente diagrama, las "particiones" se indican con un círculo y cada una de ellas tiene alta disponibilidad a través de un conjunto de réplicas.</span><span class="sxs-lookup"><span data-stu-id="4d04d-118">A “partition” is denoted by a circle in the following diagram, and each partition is made highly available via a replica set.</span></span> <span data-ttu-id="4d04d-119">Esta es la distribución local dentro de una región de Azure (se indica mediante el eje X).</span><span class="sxs-lookup"><span data-stu-id="4d04d-119">This is the local distribution within a single Azure region (denoted by the X axis).</span></span> <span data-ttu-id="4d04d-120">Además, cada partición (con su conjunto de réplicas correspondiente) se distribuye globalmente en varias regiones asociadas con su cuenta de base de datos (por ejemplo, en esta ilustración, las tres regiones: este de EE. UU., oeste de EE. UU. y centro de la India).</span><span class="sxs-lookup"><span data-stu-id="4d04d-120">Further, each partition (with its corresponding replica set) is then globally distributed across multiple regions associated with your database account (for example, in this illustration the three regions – East US, West US and Central India).</span></span> <span data-ttu-id="4d04d-121">El "conjunto de particiones" es una entidad distribuida globalmente que consta de varias copias de los datos en cada región (se indica mediante el eje Y).</span><span class="sxs-lookup"><span data-stu-id="4d04d-121">The “partition set” is a globally distributed entity comprising of multiple copies of your data in each region (denoted by the Y axis).</span></span> <span data-ttu-id="4d04d-122">Puede asignar prioridad a las regiones asociadas con su cuenta de base de datos y Cosmos DB realizará una conmutación por error de forma transparente a la región siguiente en caso de desastre.</span><span class="sxs-lookup"><span data-stu-id="4d04d-122">You can assign priority to the regions associated with your database account and Cosmos DB will transparently failover to the next region in case of disaster.</span></span> <span data-ttu-id="4d04d-123">También puede simular manualmente una conmutación por error para probar la disponibilidad completa de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="4d04d-123">You can also manually simulate failover to test the end-to-end availability of your application.</span></span>  

<span data-ttu-id="4d04d-124">La imagen siguiente ilustra el alto grado de redundancia con Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="4d04d-124">The following image illustrates the high degree of redundancy with Cosmos DB.</span></span>

![Alto grado de redundancia con Cosmos DB](./media/online-backup-and-restore/redundancy.png)

![Alto grado de redundancia con Cosmos DB](./media/online-backup-and-restore/global-distribution.png)

## <a name="full-automatic-online-backups"></a><span data-ttu-id="4d04d-127">Copias de seguridad completas, automáticas y en línea</span><span class="sxs-lookup"><span data-stu-id="4d04d-127">Full, automatic, online backups</span></span>
<span data-ttu-id="4d04d-128">¡Vaya! Eliminé mi contenedor o base de datos.</span><span class="sxs-lookup"><span data-stu-id="4d04d-128">Oops, I deleted my container or database!</span></span> <span data-ttu-id="4d04d-129">Con Cosmos DB, no solo los datos son altamente redundantes y resistentes ante los desastres regionales, sino que también las copias de seguridad de los mismos datos.</span><span class="sxs-lookup"><span data-stu-id="4d04d-129">With Cosmos DB, not only your data, but the backups of your data are also made highly redundant and resilient to regional disasters.</span></span> <span data-ttu-id="4d04d-130">Actualmente, estas copias de seguridad automatizadas se crean aproximadamente cada cuatro horas y se almacenan las dos copias de seguridad más recientes en todo momento.</span><span class="sxs-lookup"><span data-stu-id="4d04d-130">These automated backups are currently taken approximately every four hours and latest 2 backups are stored at all times.</span></span> <span data-ttu-id="4d04d-131">Si los datos se quitan o dañan accidentalmente, [póngase en contacto con el soporte técnico de Azure](https://azure.microsoft.com/support/options/) en un plazo de 8 horas.</span><span class="sxs-lookup"><span data-stu-id="4d04d-131">If the data is accidently dropped or corrupted, please [contact Azure support](https://azure.microsoft.com/support/options/) within 8 hours.</span></span> 

<span data-ttu-id="4d04d-132">Las copias de seguridad se crean sin afectar el rendimiento ni la disponibilidad de las operaciones de bases de datos.</span><span class="sxs-lookup"><span data-stu-id="4d04d-132">The backups are taken without affecting the performance or availability of your database operations.</span></span> <span data-ttu-id="4d04d-133">Cosmos DB crea la copia de seguridad en segundo plano y no consume las RU aprovisionadas ni tampoco afecta el rendimiento ni la disponibilidad de su base de datos.</span><span class="sxs-lookup"><span data-stu-id="4d04d-133">Cosmos DB takes the backup in the background without consuming your provisioned RUs or affecting the performance and without affecting the availability of your database.</span></span> 

<span data-ttu-id="4d04d-134">A diferencia de los datos almacenados en Cosmos DB, las copias de seguridad automáticas se almacenan en el servicio Azure Blob Storage.</span><span class="sxs-lookup"><span data-stu-id="4d04d-134">Unlike your data that is stored inside Cosmos DB, the automatic backups are stored in Azure Blob Storage service.</span></span> <span data-ttu-id="4d04d-135">Para garantizar la carga eficaz/de baja latencia, la instantánea de la copia de seguridad se carga a una instancia de Azure Blob Storage en la misma región que la región de escritura actual de la cuenta de base de datos de Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="4d04d-135">To guarantee the low latency/efficient upload, the snapshot of your backup is uploaded to an instance of Azure Blob storage in the same region as the current write region of your Cosmos DB database account.</span></span> <span data-ttu-id="4d04d-136">Para lograr resistencia frente a algún desastre regional, cada instantánea de la copia de seguridad de los datos en Azure Blob Storage se vuelve a replicar mediante almacenamiento con redundancia geográfica (GRS) a otra región.</span><span class="sxs-lookup"><span data-stu-id="4d04d-136">For resiliency against regional disaster, each snapshot of your backup data in Azure Blob Storage is again replicated via geo-redundant storage (GRS) to another region.</span></span> <span data-ttu-id="4d04d-137">El diagrama siguiente muestra que se crea una copia de seguridad de todo el contenedor de Cosmos DB (en este ejemplo, con las tres particiones principales en el oeste de EE. UU.) en una cuenta de Azure Blob Storage remota en el oeste de EE. UU. y, luego, se replica mediante GRS al este de EE. UU.</span><span class="sxs-lookup"><span data-stu-id="4d04d-137">The following diagram shows that the entire Cosmos DB container (with all three primary partitions in West US, in this example) is backed up in a remote Azure Blob Storage account in West US and then GRS replicated to East US.</span></span> 

<span data-ttu-id="4d04d-138">La imagen siguiente ilustra copias de seguridad completas y periódicas de todas las entidades de Cosmos DB en Azure Storage de GRS.</span><span class="sxs-lookup"><span data-stu-id="4d04d-138">The following image illustrates periodic full backups of all Cosmos DB entities in GRS Azure Storage.</span></span>

![Copias de seguridad completas y periódicas de todas las entidades de Cosmos DB en Azure Storage de GRS](./media/online-backup-and-restore/automatic-backup.png)

## <a name="backup-retention-period"></a><span data-ttu-id="4d04d-140">Período de retención de copia de seguridad</span><span class="sxs-lookup"><span data-stu-id="4d04d-140">Backup retention period</span></span>
<span data-ttu-id="4d04d-141">Como se describió anteriormente, Azure Cosmos DB toma instantáneas de los datos cada cuatro horas y conserva las últimas dos instantáneas de cada partición durante 30 días.</span><span class="sxs-lookup"><span data-stu-id="4d04d-141">As described above, Azure Cosmos DB takes snapshots of your data every four hours and retains the last two snapshots of every partition for 30 days.</span></span> <span data-ttu-id="4d04d-142">Siguiendo nuestras normas de cumplimiento, las instantáneas se purgan después de 90 días.</span><span class="sxs-lookup"><span data-stu-id="4d04d-142">Per our compliance regulations, snapshots are purged after 90 days.</span></span>

<span data-ttu-id="4d04d-143">Si desea mantener sus propias instantáneas, puede utilizar la opción de exportación a JSON [herramienta de migración de datos](import-data.md#export-to-json-file) en la base de datos de Azure Cosmos para programar copias de seguridad adicionales.</span><span class="sxs-lookup"><span data-stu-id="4d04d-143">If you want to maintain your own snapshots, you can use the export to JSON option in the Azure Cosmos DB [Data Migration tool](import-data.md#export-to-json-file) to schedule additional backups.</span></span> 

## <a name="restoring-a-database-from-an-online-backup"></a><span data-ttu-id="4d04d-144">Restauración de una base de datos desde una copia de seguridad en línea</span><span class="sxs-lookup"><span data-stu-id="4d04d-144">Restoring a database from an online backup</span></span>
<span data-ttu-id="4d04d-145">En caso de que elimine accidentalmente su base de datos o colección, puede [presentar un vale de soporte técnico](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) o llamar al [servicio de soporte técnico de Azure](https://azure.microsoft.com/support/options/) para restaurar los datos a partir de la copia de seguridad automática más reciente.</span><span class="sxs-lookup"><span data-stu-id="4d04d-145">If you accidentally delete your database or collection, you can [file a support ticket](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) or [call Azure support](https://azure.microsoft.com/support/options/) to restore the data from the last automatic backup.</span></span> <span data-ttu-id="4d04d-146">Si necesita restaurar la base de datos debido a problemas de datos dañados, consulte [Control de los datos dañados](#handling-data-corruption) ya que puede ser necesario realizar pasos adicionales para impedir que los datos dañados se escriban en las copias de seguridad.</span><span class="sxs-lookup"><span data-stu-id="4d04d-146">If you need to restore your database because of data corruption issue, see [Handling data corruption](#handling-data-corruption) as you need to take additional steps to prevent the corrupted data from penetrating the backups.</span></span> <span data-ttu-id="4d04d-147">Si se va a restaurar una instantánea específica de su copia de seguridad, Cosmos DB requiere que los datos hayan estado disponibles durante el ciclo de copia de seguridad de esa instantánea.</span><span class="sxs-lookup"><span data-stu-id="4d04d-147">For a specific snapshot of your backup to be restored, Cosmos DB requires that the data was available for the duration of the backup cycle for that snapshot.</span></span>

## <a name="handling-data-corruption"></a><span data-ttu-id="4d04d-148">Control de los datos dañados</span><span class="sxs-lookup"><span data-stu-id="4d04d-148">Handling data corruption</span></span>
<span data-ttu-id="4d04d-149">Azure Cosmos DB conserva las dos últimas copias de seguridad de cada partición en el sistema.</span><span class="sxs-lookup"><span data-stu-id="4d04d-149">Azure Cosmos DB retains the last two backups of every partition in the system.</span></span> <span data-ttu-id="4d04d-150">Este modelo funciona muy bien cuando un contenedor (colección de documentos, grafos o tablas) o una base de datos se eliminan accidentalmente porque una de las últimas versiones se puede restaurar.</span><span class="sxs-lookup"><span data-stu-id="4d04d-150">This model works very well when a container (collection of documents, graph, table) or a database is accidentally deleted since one of the last versions can be restored.</span></span> <span data-ttu-id="4d04d-151">Sin embargo, cuando se presenta un problema de daños en los datos, Azure Cosmos DB puede no ser consciente de los daños en los datos y es posible que los daños puedan haber entrado en las copias de seguridad.</span><span class="sxs-lookup"><span data-stu-id="4d04d-151">However, in the case when when users may introduce a data corruption issue, Azure Cosmos DB may be unaware of the data corruption, and it is possible that the corruption may have penetrated the backups.</span></span> <span data-ttu-id="4d04d-152">En cuanto se detectan daños, se debe eliminar el contenedor dañado (colección, grafo o tabla) para que las copias de seguridad estén protegidas de ser sobrescritas con datos dañados.</span><span class="sxs-lookup"><span data-stu-id="4d04d-152">As soon as corruption is detected, you should delete the corrupted container (collection/graph/table) so that backups are protected from being overwritten with corrupted data.</span></span> <span data-ttu-id="4d04d-153">Puesto que la última copia de seguridad podría ser de cuatro horas de antigüedad, el usuario puede emplear [Cambiar fuente](change-feed.md) para capturar y almacenar las últimas cuatro horas de datos antes de eliminar el contenedor.</span><span class="sxs-lookup"><span data-stu-id="4d04d-153">Since the last backup could be four hours old, the user can employ [change feed](change-feed.md) to capture and store the last four hours worth of data before deleting the container.</span></span>

## <a name="next-steps"></a><span data-ttu-id="4d04d-154">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="4d04d-154">Next steps</span></span>

<span data-ttu-id="4d04d-155">Para replicar la base de datos en varios centros de datos, consulte [Distribución global de datos con Cosmos DB](distribute-data-globally.md).</span><span class="sxs-lookup"><span data-stu-id="4d04d-155">To replicate your database in multiple data centers, see [distribute your data globally with Cosmos DB](distribute-data-globally.md).</span></span> 

<span data-ttu-id="4d04d-156">Para ponerse en contacto con el servicio de soporte técnico de Azure, [presente una incidencia de soporte técnico en Azure Portal](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span><span class="sxs-lookup"><span data-stu-id="4d04d-156">To file contact Azure Support, [file a ticket from the Azure portal](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span></span>


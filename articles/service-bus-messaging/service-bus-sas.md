---
title: "Autenticación en Azure Service Bus con firmas de acceso compartido | Microsoft Docs"
description: "Información general sobre la autenticación en Service Bus con Firma de acceso compartido, detalles de la autenticación con SAS en Azure Service Bus."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: 
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 08/23/2017
ms.author: sethm
ms.openlocfilehash: a2760072acb7c62204759f3ec0d3cb9899460f2d
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/29/2017
---
# <a name="service-bus-authentication-with-shared-access-signatures"></a><span data-ttu-id="f6d77-103">Autenticación en Service Bus con Firmas de acceso compartido</span><span class="sxs-lookup"><span data-stu-id="f6d77-103">Service Bus authentication with Shared Access Signatures</span></span>

<span data-ttu-id="f6d77-104">Las *firmas de acceso compartido* (SAS) son el mecanismo de seguridad principal de la mensajería de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="f6d77-104">*Shared Access Signatures* (SAS) are the primary security mechanism for Service Bus messaging.</span></span> <span data-ttu-id="f6d77-105">En este artículo se tratan las firmas acceso compartido, cómo funcionan y cómo usarlas independientemente de la plataforma.</span><span class="sxs-lookup"><span data-stu-id="f6d77-105">This article discusses SAS, how they work, and how to use them in a platform-agnostic way.</span></span>

<span data-ttu-id="f6d77-106">La autenticación con SAS permite a las aplicaciones autenticarse en Service Bus mediante una clave de acceso configurada en el espacio de nombres o en la entidad de mensajería (cola o tema) al que se asocian derechos específicos.</span><span class="sxs-lookup"><span data-stu-id="f6d77-106">SAS authentication enables applications to authenticate to Service Bus using an access key configured on the namespace, or on the messaging entity (queue or topic) with which specific rights are associated.</span></span> <span data-ttu-id="f6d77-107">A continuación, puede usar esta clave para generar un token SAS que a su vez, los clientes pueden usar para autenticarse en el Bus de servicio.</span><span class="sxs-lookup"><span data-stu-id="f6d77-107">You can then use this key to generate a SAS token that clients can in turn use to authenticate to Service Bus.</span></span>

<span data-ttu-id="f6d77-108">La compatibilidad con la autenticación SAS se incluye en el SDK de Azure 2.0 y versiones posteriores.</span><span class="sxs-lookup"><span data-stu-id="f6d77-108">SAS authentication support is included in the Azure SDK version 2.0 and later.</span></span>

## <a name="overview-of-sas"></a><span data-ttu-id="f6d77-109">Información general de SAS</span><span class="sxs-lookup"><span data-stu-id="f6d77-109">Overview of SAS</span></span>

<span data-ttu-id="f6d77-110">Firmas de acceso compartido son un mecanismo de autenticación basado en URI y valores hash seguros SHA-256.</span><span class="sxs-lookup"><span data-stu-id="f6d77-110">Shared Access Signatures are an authentication mechanism based on SHA-256 secure hashes or URIs.</span></span> <span data-ttu-id="f6d77-111">SAS es un mecanismo muy eficaz que se usa por todos los servicios del Bus de servicio.</span><span class="sxs-lookup"><span data-stu-id="f6d77-111">SAS is an extremely powerful mechanism that is used by all Service Bus services.</span></span> <span data-ttu-id="f6d77-112">En el uso real, SAS tiene dos componentes: una *directiva de acceso compartido* y una *firma de acceso compartido* (a menudo denominada *token*).</span><span class="sxs-lookup"><span data-stu-id="f6d77-112">In actual use, SAS has two components: a *shared access policy* and a *Shared Access Signature* (often called a *token*).</span></span>

<span data-ttu-id="f6d77-113">La autenticación SAS en el Bus de servicio implica la configuración de una clave criptográfica con derechos asociados en un recurso del Bus de servicio.</span><span class="sxs-lookup"><span data-stu-id="f6d77-113">SAS authentication in Service Bus involves the configuration of a cryptographic key with associated rights on a Service Bus resource.</span></span> <span data-ttu-id="f6d77-114">Los clientes reclaman acceso a los recursos del Bus de servicio mediante la presentación de un token SAS.</span><span class="sxs-lookup"><span data-stu-id="f6d77-114">Clients claim access to Service Bus resources by presenting a SAS token.</span></span> <span data-ttu-id="f6d77-115">Este token consta del URI del recurso al que se accede y una caducidad firmada con la clave configurada.</span><span class="sxs-lookup"><span data-stu-id="f6d77-115">This token consists of the resource URI being accessed, and an expiry signed with the configured key.</span></span>

<span data-ttu-id="f6d77-116">Puede configurar reglas de autorización de firma de acceso compartido en [retransmisiones](service-bus-fundamentals-hybrid-solutions.md#relays), [colas](service-bus-fundamentals-hybrid-solutions.md#queues) y [temas](service-bus-fundamentals-hybrid-solutions.md#topics) de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="f6d77-116">You can configure Shared Access Signature authorization rules on Service Bus [relays](service-bus-fundamentals-hybrid-solutions.md#relays), [queues](service-bus-fundamentals-hybrid-solutions.md#queues), and [topics](service-bus-fundamentals-hybrid-solutions.md#topics).</span></span>

<span data-ttu-id="f6d77-117">La autenticación SAS usa los siguientes elementos:</span><span class="sxs-lookup"><span data-stu-id="f6d77-117">SAS authentication uses the following elements:</span></span>

* <span data-ttu-id="f6d77-118">[Regla de autorización de acceso compartido](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule): clave criptográfica principal de 256 bits en representación Base64, una clave secundaria opcional y un nombre de clave y derechos asociados (una colección de derechos de *escucha*, *envío* o *administración*).</span><span class="sxs-lookup"><span data-stu-id="f6d77-118">[Shared Access authorization rule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule): A 256-bit primary cryptographic key in Base64 representation, an optional secondary key, and a key name and associated rights (a collection of *Listen*, *Send*, or *Manage* rights).</span></span>
* <span data-ttu-id="f6d77-119">[Firma de acceso compartido](/dotnet/api/microsoft.servicebus.sharedaccesssignaturetokenprovider) : generado con el HMAC-SHA256 de una cadena de recursos, formada por el URI del recurso al que se accede y una caducidad, con la clave criptográfica.</span><span class="sxs-lookup"><span data-stu-id="f6d77-119">[Shared Access Signature](/dotnet/api/microsoft.servicebus.sharedaccesssignaturetokenprovider) token: Generated using the HMAC-SHA256 of a resource string, consisting of the URI of the resource that is accessed and an expiry, with the cryptographic key.</span></span> <span data-ttu-id="f6d77-120">La firma y otros elementos que se describen en las secciones siguientes tienen formato de cadena para formar el token SAS.</span><span class="sxs-lookup"><span data-stu-id="f6d77-120">The signature and other elements described in the following sections are formatted into a string to form the SAS token.</span></span>

## <a name="shared-access-policy"></a><span data-ttu-id="f6d77-121">Directiva de acceso compartido</span><span class="sxs-lookup"><span data-stu-id="f6d77-121">Shared access policy</span></span>

<span data-ttu-id="f6d77-122">Entre otras cosas, es importante entender que SAS empieza con una directiva.</span><span class="sxs-lookup"><span data-stu-id="f6d77-122">An important thing to understand about SAS is that it starts with a policy.</span></span> <span data-ttu-id="f6d77-123">Para cada directiva, decida tres tipos de información: **nombre**, **ámbito** y **permisos**.</span><span class="sxs-lookup"><span data-stu-id="f6d77-123">For each policy, you decide on three pieces of information: **name**, **scope**, and **permissions**.</span></span> <span data-ttu-id="f6d77-124">El **nombre** es solo eso; un nombre único dentro de ese ámbito.</span><span class="sxs-lookup"><span data-stu-id="f6d77-124">The **name** is just that; a unique name within that scope.</span></span> <span data-ttu-id="f6d77-125">El ámbito es bastante sencillo: es el URI del recurso en cuestión.</span><span class="sxs-lookup"><span data-stu-id="f6d77-125">The scope is easy enough: it's the URI of the resource in question.</span></span> <span data-ttu-id="f6d77-126">Para un espacio de nombres de Service Bus, el ámbito es el nombre de dominio completo (FQDN), como `https://<yournamespace>.servicebus.windows.net/`.</span><span class="sxs-lookup"><span data-stu-id="f6d77-126">For a Service Bus namespace, the scope is the fully qualified domain name (FQDN), such as `https://<yournamespace>.servicebus.windows.net/`.</span></span>

<span data-ttu-id="f6d77-127">Los permisos disponibles para una directiva son en gran parte explicativos:</span><span class="sxs-lookup"><span data-stu-id="f6d77-127">The available permissions for a policy are largely self-explanatory:</span></span>

* <span data-ttu-id="f6d77-128">Los métodos Send</span><span class="sxs-lookup"><span data-stu-id="f6d77-128">Send</span></span>
* <span data-ttu-id="f6d77-129">Escuchar</span><span class="sxs-lookup"><span data-stu-id="f6d77-129">Listen</span></span>
* <span data-ttu-id="f6d77-130">Administrar</span><span class="sxs-lookup"><span data-stu-id="f6d77-130">Manage</span></span>

<span data-ttu-id="f6d77-131">Después de crear la directiva, se le asigna una *clave principal* y una *clave secundaria*.</span><span class="sxs-lookup"><span data-stu-id="f6d77-131">After you create the policy, it is assigned a *Primary Key* and a *Secondary Key*.</span></span> <span data-ttu-id="f6d77-132">Son claves de alta seguridad criptográfica.</span><span class="sxs-lookup"><span data-stu-id="f6d77-132">These are cryptographically strong keys.</span></span> <span data-ttu-id="f6d77-133">No las pierda ni las revele; siempre estarán disponibles en [Azure Portal][Azure portal].</span><span class="sxs-lookup"><span data-stu-id="f6d77-133">Don't lose them or leak them - they'll always be available in the [Azure portal][Azure portal].</span></span> <span data-ttu-id="f6d77-134">Puede usar cualquiera de las claves generadas y regenerarlas en cualquier momento.</span><span class="sxs-lookup"><span data-stu-id="f6d77-134">You can use either of the generated keys, and you can regenerate them at any time.</span></span> <span data-ttu-id="f6d77-135">Sin embargo, si regenera o cambia la clave principal en la directiva, se invalidará cualquier firma de acceso compartido creada a partir de ella.</span><span class="sxs-lookup"><span data-stu-id="f6d77-135">However, if you regenerate or change the primary key in the policy, any Shared Access Signatures created from it will be invalidated.</span></span>

<span data-ttu-id="f6d77-136">Cuando se crea un espacio de nombres de Service Bus, se crea automáticamente una directiva para todo el espacio de nombres denominado **RootManageSharedAccessKey** y esta directiva tiene todos los permisos.</span><span class="sxs-lookup"><span data-stu-id="f6d77-136">When you create a Service Bus namespace, a policy is automatically created for the entire namespace called **RootManageSharedAccessKey**, and this policy has all permissions.</span></span> <span data-ttu-id="f6d77-137">No inicia sesión como **raíz**; por tanto, no use esta directiva a menos que exista realmente una buena razón.</span><span class="sxs-lookup"><span data-stu-id="f6d77-137">You don't log on as **root**, so don't use this policy unless there's a really good reason.</span></span> <span data-ttu-id="f6d77-138">Puede crear directivas adicionales en la pestaña **Configurar** para el espacio de nombres en el portal.</span><span class="sxs-lookup"><span data-stu-id="f6d77-138">You can create additional policies in the **Configure** tab for the namespace in the portal.</span></span> <span data-ttu-id="f6d77-139">Es importante tener en cuenta que un nivel de árbol único en Service Bus (espacio de nombres, cola, etc.) solo puede tener hasta 12 directivas asociadas.</span><span class="sxs-lookup"><span data-stu-id="f6d77-139">It's important to note that a single tree level in Service Bus (namespace, queue, etc.) can only have up to 12 policies attached to it.</span></span>

## <a name="configuration-for-shared-access-signature-authentication"></a><span data-ttu-id="f6d77-140">Configuración de la autenticación de firma de acceso compartido</span><span class="sxs-lookup"><span data-stu-id="f6d77-140">Configuration for Shared Access Signature authentication</span></span>
<span data-ttu-id="f6d77-141">Puede configurar la regla [SharedAccessAuthorizationRule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule) en los espacios de nombres, las colas o los temas del Bus de servicio.</span><span class="sxs-lookup"><span data-stu-id="f6d77-141">You can configure the [SharedAccessAuthorizationRule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule) rule on Service Bus namespaces, queues, or topics.</span></span> <span data-ttu-id="f6d77-142">La configuración de una regla [SharedAccessAuthorizationRule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule) en una suscripción del Bus de servicio no se admite, pero puede usar las reglas configuradas en un espacio de nombres o un tema para asegurar el acceso a las suscripciones.</span><span class="sxs-lookup"><span data-stu-id="f6d77-142">Configuring a [SharedAccessAuthorizationRule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule) on a Service Bus subscription is currently not supported, but you can use rules configured on a namespace or topic to secure access to subscriptions.</span></span> <span data-ttu-id="f6d77-143">Para ver un ejemplo funcional que ilustra este procedimiento, consulte el ejemplo [Uso de la autenticación de firma de acceso compartido (SAS) con suscripciones del Bus de servicio](http://code.msdn.microsoft.com/Using-Shared-Access-e605b37c) .</span><span class="sxs-lookup"><span data-stu-id="f6d77-143">For a working sample that illustrates this procedure, see the [Using Shared Access Signature (SAS) authentication with Service Bus Subscriptions](http://code.msdn.microsoft.com/Using-Shared-Access-e605b37c) sample.</span></span>

<span data-ttu-id="f6d77-144">Puede configurarse un máximo de 12 reglas en un espacio de nombres, una cola o un tema del Bus de servicio.</span><span class="sxs-lookup"><span data-stu-id="f6d77-144">A maximum of 12 such rules can be configured on a Service Bus namespace, queue, or topic.</span></span> <span data-ttu-id="f6d77-145">Las reglas que se configuran en un espacio de nombres del Bus de servicio se aplican a todas las entidades en ese espacio de nombres.</span><span class="sxs-lookup"><span data-stu-id="f6d77-145">Rules that are configured on a Service Bus namespace apply to all entities in that namespace.</span></span>

![SAS](./media/service-bus-sas/service-bus-namespace.png)

<span data-ttu-id="f6d77-147">En esta ilustración, las reglas de autorización *manageRuleNS*, *sendRuleNS* y *listenRuleNS* se aplican tanto a la cola Q1 como al tema T1, mientras que *listenRuleQ* y *sendRuleQ* se aplican solo a la cola Q1 y *sendRuleT* solo al tema T1.</span><span class="sxs-lookup"><span data-stu-id="f6d77-147">In this figure, the *manageRuleNS*, *sendRuleNS*, and *listenRuleNS* authorization rules apply to both queue Q1 and topic T1, while *listenRuleQ* and *sendRuleQ* apply only to queue Q1 and *sendRuleT* applies only to topic T1.</span></span>

<span data-ttu-id="f6d77-148">Los parámetros clave de un objeto [SharedAccessAuthorizationRule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule) son los siguientes:</span><span class="sxs-lookup"><span data-stu-id="f6d77-148">The key parameters of a [SharedAccessAuthorizationRule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule) are as follows:</span></span>

| <span data-ttu-id="f6d77-149">Parámetro</span><span class="sxs-lookup"><span data-stu-id="f6d77-149">Parameter</span></span> | <span data-ttu-id="f6d77-150">Descripción</span><span class="sxs-lookup"><span data-stu-id="f6d77-150">Description</span></span> |
| --- | --- |
| <span data-ttu-id="f6d77-151">*KeyName*</span><span class="sxs-lookup"><span data-stu-id="f6d77-151">*KeyName*</span></span> |<span data-ttu-id="f6d77-152">Una cadena que describe la regla de autorización.</span><span class="sxs-lookup"><span data-stu-id="f6d77-152">A string that describes the authorization rule.</span></span> |
| <span data-ttu-id="f6d77-153">*PrimaryKey*</span><span class="sxs-lookup"><span data-stu-id="f6d77-153">*PrimaryKey*</span></span> |<span data-ttu-id="f6d77-154">Una clave principal de 256 bits con codificación base64 para firmar y validar el token SAS.</span><span class="sxs-lookup"><span data-stu-id="f6d77-154">A base64-encoded 256-bit primary key for signing and validating the SAS token.</span></span> |
| <span data-ttu-id="f6d77-155">*SecondaryKey*</span><span class="sxs-lookup"><span data-stu-id="f6d77-155">*SecondaryKey*</span></span> |<span data-ttu-id="f6d77-156">Una clave secundaria de 256 bits con codificación base64 para firmar y validar el token SAS.</span><span class="sxs-lookup"><span data-stu-id="f6d77-156">A base64-encoded 256-bit secondary key for signing and validating the SAS token.</span></span> |
| <span data-ttu-id="f6d77-157">*AccessRights*</span><span class="sxs-lookup"><span data-stu-id="f6d77-157">*AccessRights*</span></span> |<span data-ttu-id="f6d77-158">Una lista de derechos de acceso concedidos por la regla de autorización.</span><span class="sxs-lookup"><span data-stu-id="f6d77-158">A list of access rights granted by the authorization rule.</span></span> <span data-ttu-id="f6d77-159">Estos derechos pueden ser cualquier colección de derechos de escucha, envío y administración.</span><span class="sxs-lookup"><span data-stu-id="f6d77-159">These rights can be any collection of Listen, Send, and Manage rights.</span></span> |

<span data-ttu-id="f6d77-160">Cuando se aprovisiona un espacio de nombres de Service Bus, se crea de forma predeterminada [SharedAccessAuthorizationRule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule), con [KeyName](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule#Microsoft_ServiceBus_Messaging_SharedAccessAuthorizationRule_KeyName) establecido en **RootManageSharedAccessKey**.</span><span class="sxs-lookup"><span data-stu-id="f6d77-160">When a Service Bus namespace is provisioned, a [SharedAccessAuthorizationRule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule), with [KeyName](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule#Microsoft_ServiceBus_Messaging_SharedAccessAuthorizationRule_KeyName) set to **RootManageSharedAccessKey**, is created by default.</span></span>

## <a name="generate-a-shared-access-signature-token"></a><span data-ttu-id="f6d77-161">Generación de firmas de acceso compartido (tokens)</span><span class="sxs-lookup"><span data-stu-id="f6d77-161">Generate a Shared Access Signature (token)</span></span>

<span data-ttu-id="f6d77-162">La propia directiva no es el token de acceso para el Bus de servicio.</span><span class="sxs-lookup"><span data-stu-id="f6d77-162">The policy itself is not the access token for Service Bus.</span></span> <span data-ttu-id="f6d77-163">Es el objeto desde el que se genera el token de acceso, mediante la clave principal o la clave secundaria.</span><span class="sxs-lookup"><span data-stu-id="f6d77-163">It is the object from which the access token is generated - using either the primary or secondary key.</span></span> <span data-ttu-id="f6d77-164">Cualquier cliente que tenga acceso a las claves de firma especificadas en la regla de autorización de acceso compartido puede generar el token SAS.</span><span class="sxs-lookup"><span data-stu-id="f6d77-164">Any client that has access to the signing keys specified in the shared access authorization rule can generate the SAS token.</span></span> <span data-ttu-id="f6d77-165">El token se genera elaborando cuidadosamente una cadena con el siguiente formato:</span><span class="sxs-lookup"><span data-stu-id="f6d77-165">The token is generated by carefully crafting a string in the following format:</span></span>

```
SharedAccessSignature sig=<signature-string>&se=<expiry>&skn=<keyName>&sr=<URL-encoded-resourceURI>
```

<span data-ttu-id="f6d77-166">Donde `signature-string` es el hash SHA-256 del ámbito del token (**ámbito** como se describe en la sección anterior) con un CRLF anexado y una hora de expiración (en segundos desde la época: `00:00:00 UTC` el 1 de enero de 1970).</span><span class="sxs-lookup"><span data-stu-id="f6d77-166">Where `signature-string` is the SHA-256 hash of the scope of the token (**scope** as described in the previous section) with a CRLF appended and an expiry time (in seconds since the epoch: `00:00:00 UTC` on 1 January 1970).</span></span> 

> [!NOTE]
> <span data-ttu-id="f6d77-167">Para evitar una hora de caducidad próxima del token, se recomienda que codifique el valor de hora de caducidad como mínimo como un entero de 32 bits sin signo o, preferiblemente, un entero largo (64 bits).</span><span class="sxs-lookup"><span data-stu-id="f6d77-167">To avoid a short token expiry time, it is recommended that you encode the expiry time value as at least a 32-bit unsigned integer, or preferably a long (64-bit) integer.</span></span>  
> 
> 

<span data-ttu-id="f6d77-168">El hash es similar al siguiente pseudocódigo y devuelve 32 bytes.</span><span class="sxs-lookup"><span data-stu-id="f6d77-168">The hash looks similar to the following pseudo code and returns 32 bytes.</span></span>

```
SHA-256('https://<yournamespace>.servicebus.windows.net/'+'\n'+ 1438205742)
```

<span data-ttu-id="f6d77-169">Los valores que no son de hash se encuentran en la cadena **SharedAccessSignature** para que el destinatario puede calcular el hash con los mismos parámetros, para asegurarse de que devuelve el mismo resultado.</span><span class="sxs-lookup"><span data-stu-id="f6d77-169">The non-hashed values are in the **SharedAccessSignature** string so that the recipient can compute the hash with the same parameters, to be sure that it returns the same result.</span></span> <span data-ttu-id="f6d77-170">El URI especifica el ámbito y el nombre de la clave identifica la directiva que se usará para calcular el hash.</span><span class="sxs-lookup"><span data-stu-id="f6d77-170">The URI specifies the scope, and the key name identifies the policy to be used to compute the hash.</span></span> <span data-ttu-id="f6d77-171">Esto es importante desde una perspectiva de seguridad.</span><span class="sxs-lookup"><span data-stu-id="f6d77-171">This is important from a security standpoint.</span></span> <span data-ttu-id="f6d77-172">Si la firma no coincide con la que el destinatario calcula (Bus de servicio), se denegará el acceso.</span><span class="sxs-lookup"><span data-stu-id="f6d77-172">If the signature doesn't match that which the recipient (Service Bus) calculates, then access is denied.</span></span> <span data-ttu-id="f6d77-173">En este punto puede estar seguro de que el remitente ha tenido acceso a la clave y que se le deberían haber concedido los derechos especificados en la directiva.</span><span class="sxs-lookup"><span data-stu-id="f6d77-173">At this point you can be sure that the sender had access to the key and should be granted the rights specified in the policy.</span></span>

<span data-ttu-id="f6d77-174">Tenga en cuenta que debe usar el URI de recurso codificado para esta operación.</span><span class="sxs-lookup"><span data-stu-id="f6d77-174">Note that you should use the encoded resource URI for this operation.</span></span> <span data-ttu-id="f6d77-175">El URI de recurso es el URI completo del recurso del Bus de servicio al que se solicita el acceso.</span><span class="sxs-lookup"><span data-stu-id="f6d77-175">The resource URI is the full URI of the Service Bus resource to which access is claimed.</span></span> <span data-ttu-id="f6d77-176">Por ejemplo, `http://<namespace>.servicebus.windows.net/<entityPath>` o `sb://<namespace>.servicebus.windows.net/<entityPath>`; es decir, `http://contoso.servicebus.windows.net/contosoTopics/T1/Subscriptions/S3`.</span><span class="sxs-lookup"><span data-stu-id="f6d77-176">For example, `http://<namespace>.servicebus.windows.net/<entityPath>` or `sb://<namespace>.servicebus.windows.net/<entityPath>`; that is, `http://contoso.servicebus.windows.net/contosoTopics/T1/Subscriptions/S3`.</span></span>

<span data-ttu-id="f6d77-177">La regla de autorización de acceso compartido usada para firmar debe configurarse en la entidad especificada por este URI, o uno de sus primarios jerárquicos.</span><span class="sxs-lookup"><span data-stu-id="f6d77-177">The shared access authorization rule used for signing must be configured on the entity specified by this URI, or by one of its hierarchical parents.</span></span> <span data-ttu-id="f6d77-178">Por ejemplo, `http://contoso.servicebus.windows.net/contosoTopics/T1` o `http://contoso.servicebus.windows.net` en el ejemplo anterior.</span><span class="sxs-lookup"><span data-stu-id="f6d77-178">For example, `http://contoso.servicebus.windows.net/contosoTopics/T1` or `http://contoso.servicebus.windows.net` in the previous example.</span></span>

<span data-ttu-id="f6d77-179">Un token SAS es válido para todos los recursos de `<resourceURI>` que se usen en `signature-string`.</span><span class="sxs-lookup"><span data-stu-id="f6d77-179">A SAS token is valid for all resources under the `<resourceURI>` used in the `signature-string`.</span></span>

<span data-ttu-id="f6d77-180">[KeyName](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule#Microsoft_ServiceBus_Messaging_SharedAccessAuthorizationRule_KeyName) en los token SAS se refiere al **keyName** de la regla de autorización de acceso compartido usado para generar el token.</span><span class="sxs-lookup"><span data-stu-id="f6d77-180">The [KeyName](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule#Microsoft_ServiceBus_Messaging_SharedAccessAuthorizationRule_KeyName) in the SAS token refers to the **keyName** of the shared access authorization rule used to generate the token.</span></span>

<span data-ttu-id="f6d77-181">El *URL-encoded-resourceURI* debe ser el mismo que el URI usado en la cadena para firmar durante el cálculo de la firma.</span><span class="sxs-lookup"><span data-stu-id="f6d77-181">The *URL-encoded-resourceURI* must be the same as the URI used in the string-to-sign during the computation of the signature.</span></span> <span data-ttu-id="f6d77-182">Debe estar [codificado por porcentaje](https://msdn.microsoft.com/library/4fkewx0t.aspx).</span><span class="sxs-lookup"><span data-stu-id="f6d77-182">It should be [percent-encoded](https://msdn.microsoft.com/library/4fkewx0t.aspx).</span></span>

<span data-ttu-id="f6d77-183">Se recomienda regenerar periódicamente las claves usadas en el objeto [SharedAccessAuthorizationRule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule) .</span><span class="sxs-lookup"><span data-stu-id="f6d77-183">It is recommended that you periodically regenerate the keys used in the [SharedAccessAuthorizationRule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule) object.</span></span> <span data-ttu-id="f6d77-184">Normalmente, las aplicaciones deben usar [PrimaryKey](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule#Microsoft_ServiceBus_Messaging_SharedAccessAuthorizationRule_PrimaryKey) para generar un token SAS.</span><span class="sxs-lookup"><span data-stu-id="f6d77-184">Applications should generally use the [PrimaryKey](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule#Microsoft_ServiceBus_Messaging_SharedAccessAuthorizationRule_PrimaryKey) to generate a SAS token.</span></span> <span data-ttu-id="f6d77-185">Al volver a generar las claves, debe reemplazar [SecondaryKey](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule#Microsoft_ServiceBus_Messaging_SharedAccessAuthorizationRule_SecondaryKey) por la antigua clave principal y generar una nueva clave como nueva clave principal.</span><span class="sxs-lookup"><span data-stu-id="f6d77-185">When regenerating the keys, you should replace the [SecondaryKey](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule#Microsoft_ServiceBus_Messaging_SharedAccessAuthorizationRule_SecondaryKey) with the old primary key, and generate a new key as the new primary key.</span></span> <span data-ttu-id="f6d77-186">Esto le permite seguir usando tokens para la autorización que se emitieron con la clave principal anterior y que aún no hayan caducado.</span><span class="sxs-lookup"><span data-stu-id="f6d77-186">This enables you to continue using tokens for authorization that were issued with the old primary key, and that have not yet expired.</span></span>

<span data-ttu-id="f6d77-187">Si se ve comprometida una clave y es necesario revocar las claves, puede volver a generar los valores de [PrimaryKey](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule#Microsoft_ServiceBus_Messaging_SharedAccessAuthorizationRule_PrimaryKey) y [SecondaryKey](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule#Microsoft_ServiceBus_Messaging_SharedAccessAuthorizationRule_SecondaryKey) de un objeto [SharedAccessAuthorizationRule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule), y reemplazarlos por las nuevas claves.</span><span class="sxs-lookup"><span data-stu-id="f6d77-187">If a key is compromised and you have to revoke the keys, you can regenerate both the [PrimaryKey](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule#Microsoft_ServiceBus_Messaging_SharedAccessAuthorizationRule_PrimaryKey) and the [SecondaryKey](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule#Microsoft_ServiceBus_Messaging_SharedAccessAuthorizationRule_SecondaryKey) of a [SharedAccessAuthorizationRule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule), replacing them with new keys.</span></span> <span data-ttu-id="f6d77-188">Este procedimiento invalida todos los tokens firmados con las claves antiguas.</span><span class="sxs-lookup"><span data-stu-id="f6d77-188">This procedure invalidates all tokens signed with the old keys.</span></span>

## <a name="how-to-use-shared-access-signature-authentication-with-service-bus"></a><span data-ttu-id="f6d77-189">Uso de la autenticación con firma de acceso compartido en el Bus de servicio</span><span class="sxs-lookup"><span data-stu-id="f6d77-189">How to use Shared Access Signature authentication with Service Bus</span></span>

<span data-ttu-id="f6d77-190">Los siguientes escenarios incluyen la configuración de reglas de autorización, la generación de tokens SAS y la autorización del cliente.</span><span class="sxs-lookup"><span data-stu-id="f6d77-190">The following scenarios include configuration of authorization rules, generation of SAS tokens, and client authorization.</span></span>

<span data-ttu-id="f6d77-191">Para un ejemplo funcional completo de una aplicación del Bus de servicio que ilustra la configuración y usa la autorización SAS, consulte [Autenticación con firma de acceso compartido en Service Bus](http://code.msdn.microsoft.com/Shared-Access-Signature-0a88adf8).</span><span class="sxs-lookup"><span data-stu-id="f6d77-191">For a full working sample of a Service Bus application that illustrates the configuration and uses SAS authorization, see [Shared Access Signature authentication with Service Bus](http://code.msdn.microsoft.com/Shared-Access-Signature-0a88adf8).</span></span> <span data-ttu-id="f6d77-192">Hay un ejemplo relacionado que ilustra el uso de reglas de autorización SAS configuradas en espacios de nombres o temas para proteger las suscripciones del Bus de servicio disponible aquí: [Uso de la autenticación de firma de acceso compartido (SAS) con suscripciones del Bus de servicio](http://code.msdn.microsoft.com/Using-Shared-Access-e605b37c).</span><span class="sxs-lookup"><span data-stu-id="f6d77-192">A related sample that illustrates the use of SAS authorization rules configured on namespaces or topics to secure Service Bus subscriptions is available here: [Using Shared Access Signature (SAS) authentication with Service Bus Subscriptions](http://code.msdn.microsoft.com/Using-Shared-Access-e605b37c).</span></span>

## <a name="access-shared-access-authorization-rules-on-a-namespace"></a><span data-ttu-id="f6d77-193">Acceso a las reglas de autorización de acceso compartido en un espacio de nombres</span><span class="sxs-lookup"><span data-stu-id="f6d77-193">Access Shared Access Authorization rules on a namespace</span></span>

<span data-ttu-id="f6d77-194">Las operaciones en la raíz del espacio de nombres del Bus de servicio requieren la autenticación con certificados.</span><span class="sxs-lookup"><span data-stu-id="f6d77-194">Operations on the Service Bus namespace root require certificate authentication.</span></span> <span data-ttu-id="f6d77-195">Debe cargar un certificado de administración para la suscripción de Azure.</span><span class="sxs-lookup"><span data-stu-id="f6d77-195">You must upload a management certificate for your Azure subscription.</span></span> <span data-ttu-id="f6d77-196">Para cargar un certificado de administración, siga [estos pasos](../cloud-services/cloud-services-configure-ssl-certificate-portal.md#step-3-upload-a-certificate) con [Azure Portal][Azure portal].</span><span class="sxs-lookup"><span data-stu-id="f6d77-196">To upload a management certificate, follow the steps [here](../cloud-services/cloud-services-configure-ssl-certificate-portal.md#step-3-upload-a-certificate), using the [Azure portal][Azure portal].</span></span> <span data-ttu-id="f6d77-197">Para obtener más información sobre los certificados de administración de Azure, consulte [Introducción a los certificados para los servicios en la nube de Azure](../cloud-services/cloud-services-certs-create.md#what-are-management-certificates).</span><span class="sxs-lookup"><span data-stu-id="f6d77-197">For more information about Azure management certificates, see the [Azure certificates overview](../cloud-services/cloud-services-certs-create.md#what-are-management-certificates).</span></span>

<span data-ttu-id="f6d77-198">El extremo para acceder a las reglas de autorización de acceso compartido en un espacio de nombres del Bus de servicio es el siguiente:</span><span class="sxs-lookup"><span data-stu-id="f6d77-198">The endpoint for accessing shared access authorization rules on a Service Bus namespace is as follows:</span></span>

```http
https://management.core.windows.net/{subscriptionId}/services/ServiceBus/namespaces/{namespace}/AuthorizationRules/
```

<span data-ttu-id="f6d77-199">Para crear un objeto [SharedAccessAuthorizationRule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule) en un espacio de nombres del Bus de servicio, ejecute una operación POST en este punto de conexión con la información de la regla serializada como JSON o XML.</span><span class="sxs-lookup"><span data-stu-id="f6d77-199">To create a [SharedAccessAuthorizationRule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule) object on a Service Bus namespace, execute a POST operation on this endpoint with the rule information serialized as JSON or XML.</span></span> <span data-ttu-id="f6d77-200">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="f6d77-200">For example:</span></span>

```csharp
// Base address for accessing authorization rules on a namespace
string baseAddress = @"https://management.core.windows.net/<subscriptionId>/services/ServiceBus/namespaces/<namespace>/AuthorizationRules/";

// Configure authorization rule with base64-encoded 256-bit key and Send rights
var sendRule = new SharedAccessAuthorizationRule("contosoSendAll",
    SharedAccessAuthorizationRule.GenerateRandomKey(),
    new[] { AccessRights.Send });

// Operations on the Service Bus namespace root require certificate authentication.
WebRequestHandler handler = new WebRequestHandler
{
    ClientCertificateOptions = ClientCertificateOption.Manual
};
// Access the management certificate by subject name
handler.ClientCertificates.Add(GetCertificate(<certificateSN>));

HttpClient httpClient = new HttpClient(handler)
{
    BaseAddress = new Uri(baseAddress)
};
httpClient.DefaultRequestHeaders.Accept.Add(
    new MediaTypeWithQualityHeaderValue("application/json"));
httpClient.DefaultRequestHeaders.Add("x-ms-version", "2015-01-01");

// Execute a POST operation on the baseAddress above to create an auth rule
var postResult = httpClient.PostAsJsonAsync("", sendRule).Result;
```

<span data-ttu-id="f6d77-201">Del mismo modo, use una operación GET en el extremo para leer las reglas de autorización configuradas en el espacio de nombres.</span><span class="sxs-lookup"><span data-stu-id="f6d77-201">Similarly, use a GET operation on the endpoint to read the authorization rules configured on the namespace.</span></span>

<span data-ttu-id="f6d77-202">Para actualizar o eliminar una regla de autorización específica, use el siguiente extremo:</span><span class="sxs-lookup"><span data-stu-id="f6d77-202">To update or delete a specific authorization rule, use the following endpoint:</span></span>

```http
https://management.core.windows.net/{subscriptionId}/services/ServiceBus/namespaces/{namespace}/AuthorizationRules/{KeyName}
```

## <a name="access-shared-access-authorization-rules-on-an-entity"></a><span data-ttu-id="f6d77-203">Acceso a las reglas de autorización de acceso compartido en una entidad</span><span class="sxs-lookup"><span data-stu-id="f6d77-203">Access Shared Access Authorization rules on an entity</span></span>

<span data-ttu-id="f6d77-204">Puede acceder a un objeto [Microsoft.ServiceBus.Messaging.SharedAccessAuthorizationRule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule) configurado en una cola o un tema de Service Bus mediante la colección [AuthorizationRules](/dotnet/api/microsoft.servicebus.messaging.authorizationrules) en los objetos [QueueDescription](/dotnet/api/microsoft.servicebus.messaging.queuedescription) o [TopicDescription](/dotnet/api/microsoft.servicebus.messaging.topicdescription) correspondientes.</span><span class="sxs-lookup"><span data-stu-id="f6d77-204">You can access a [Microsoft.ServiceBus.Messaging.SharedAccessAuthorizationRule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule) object configured on a Service Bus queue or topic through the [AuthorizationRules](/dotnet/api/microsoft.servicebus.messaging.authorizationrules) collection in the corresponding [QueueDescription](/dotnet/api/microsoft.servicebus.messaging.queuedescription) or [TopicDescription](/dotnet/api/microsoft.servicebus.messaging.topicdescription).</span></span>

<span data-ttu-id="f6d77-205">El código siguiente muestra cómo agregar reglas de autorización para una cola.</span><span class="sxs-lookup"><span data-stu-id="f6d77-205">The following code shows how to add authorization rules for a queue.</span></span>

```csharp
// Create an instance of NamespaceManager for the operation
NamespaceManager nsm = NamespaceManager.CreateFromConnectionString(
    <connectionString> );
QueueDescription qd = new QueueDescription( <qPath> );

// Create a rule with send rights with keyName as "contosoQSendKey"
// and add it to the queue description.
qd.Authorization.Add(new SharedAccessAuthorizationRule("contosoSendKey",
    SharedAccessAuthorizationRule.GenerateRandomKey(),
    new[] { AccessRights.Send }));

// Create a rule with listen rights with keyName as "contosoQListenKey"
// and add it to the queue description.
qd.Authorization.Add(new SharedAccessAuthorizationRule("contosoQListenKey",
    SharedAccessAuthorizationRule.GenerateRandomKey(),
    new[] { AccessRights.Listen }));

// Create a rule with manage rights with keyName as "contosoQManageKey"
// and add it to the queue description.
// A rule with manage rights must also have send and receive rights.
qd.Authorization.Add(new SharedAccessAuthorizationRule("contosoQManageKey",
    SharedAccessAuthorizationRule.GenerateRandomKey(),
    new[] {AccessRights.Manage, AccessRights.Listen, AccessRights.Send }));

// Create the queue.
nsm.CreateQueue(qd);
```

## <a name="use-shared-access-signature-authorization"></a><span data-ttu-id="f6d77-206">Uso de la autorización de la firma de acceso compartido</span><span class="sxs-lookup"><span data-stu-id="f6d77-206">Use Shared Access Signature authorization</span></span>

<span data-ttu-id="f6d77-207">Las aplicaciones que usan el SDK de .NET de Azure con las bibliotecas .NET del Bus de servicio pueden usar la autorización SAS mediante la clase [SharedAccessSignatureTokenProvider](/dotnet/api/microsoft.servicebus.sharedaccesssignaturetokenprovider) .</span><span class="sxs-lookup"><span data-stu-id="f6d77-207">Applications using the Azure .NET SDK with the Service Bus .NET libraries can use SAS authorization through the [SharedAccessSignatureTokenProvider](/dotnet/api/microsoft.servicebus.sharedaccesssignaturetokenprovider) class.</span></span> <span data-ttu-id="f6d77-208">El código siguiente muestra el uso del proveedor de token para enviar mensajes a una cola del Bus de servicio.</span><span class="sxs-lookup"><span data-stu-id="f6d77-208">The following code illustrates the use of the token provider to send messages to a Service Bus queue.</span></span>

```csharp
Uri runtimeUri = ServiceBusEnvironment.CreateServiceUri("sb",
    <yourServiceNamespace>, string.Empty);
MessagingFactory mf = MessagingFactory.Create(runtimeUri,
    TokenProvider.CreateSharedAccessSignatureTokenProvider(keyName, key));
QueueClient sendClient = mf.CreateQueueClient(qPath);

//Sending hello message to queue.
BrokeredMessage helloMessage = new BrokeredMessage("Hello, Service Bus!");
helloMessage.MessageId = "SAS-Sample-Message";
sendClient.Send(helloMessage);
```

<span data-ttu-id="f6d77-209">Las aplicaciones también pueden usar SAS para la autenticación mediante una cadena de conexión SAS en métodos que acepten cadenas de conexión.</span><span class="sxs-lookup"><span data-stu-id="f6d77-209">Applications can also use SAS for authentication by using a SAS connection string in methods that accept connection strings.</span></span>

<span data-ttu-id="f6d77-210">Tenga en cuenta que para usar la autorización SAS con retransmisiones del Bus de servicio, puede usar claves SAS configuradas en el espacio de nombres del Bus de servicio.</span><span class="sxs-lookup"><span data-stu-id="f6d77-210">Note that to use SAS authorization with Service Bus relays, you can use SAS keys configured on the Service Bus namespace.</span></span> <span data-ttu-id="f6d77-211">Si crea explícitamente una retransmisión en el espacio de nombres [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) con un objeto [RelayDescription](/dotnet/api/microsoft.servicebus.messaging.relaydescription), puede establecer las reglas SAS para dicha retransmisión.</span><span class="sxs-lookup"><span data-stu-id="f6d77-211">If you explicitly create a relay on the namespace ([NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) with a [RelayDescription](/dotnet/api/microsoft.servicebus.messaging.relaydescription)) object, you can set the SAS rules just for that relay.</span></span> <span data-ttu-id="f6d77-212">Para usar la autorización SAS con suscripciones del Bus de servicio, puede usar claves SAS configuradas en un espacio de nombres del Bus de servicio o en un tema.</span><span class="sxs-lookup"><span data-stu-id="f6d77-212">To use SAS authorization with Service Bus subscriptions, you can use SAS keys configured on a Service Bus namespace or on a topic.</span></span>

## <a name="use-the-shared-access-signature-at-http-level"></a><span data-ttu-id="f6d77-213">Uso de la firma de acceso compartido (en el nivel HTTP)</span><span class="sxs-lookup"><span data-stu-id="f6d77-213">Use the Shared Access Signature (at HTTP level)</span></span>

<span data-ttu-id="f6d77-214">Ahora que sabe cómo crear firmas de acceso compartido para cualquier entidad del Bus de servicio, estará listo para llevar a cabo una solicitud HTTP POST:</span><span class="sxs-lookup"><span data-stu-id="f6d77-214">Now that you know how to create Shared Access Signatures for any entities in Service Bus, you are ready to perform an HTTP POST:</span></span>

```http
POST https://<yournamespace>.servicebus.windows.net/<yourentity>/messages
Content-Type: application/json
Authorization: SharedAccessSignature sr=https%3A%2F%2F<yournamespace>.servicebus.windows.net%2F<yourentity>&sig=<yoursignature from code above>&se=1438205742&skn=KeyName
ContentType: application/atom+xml;type=entry;charset=utf-8
``` 

<span data-ttu-id="f6d77-215">Recuerde que esto funciona para todo.</span><span class="sxs-lookup"><span data-stu-id="f6d77-215">Remember, this works for everything.</span></span> <span data-ttu-id="f6d77-216">Puede crear SAS para una cola, un tema o una suscripción.</span><span class="sxs-lookup"><span data-stu-id="f6d77-216">You can create SAS for a queue, topic, or subscription.</span></span> 

<span data-ttu-id="f6d77-217">Si le da un token de SAS a un remitente o cliente, no tiene la clave directamente y no pueden invertir el hash para obtenerla.</span><span class="sxs-lookup"><span data-stu-id="f6d77-217">If you give a sender or client a SAS token, they don't have the key directly, and they cannot reverse the hash to obtain it.</span></span> <span data-ttu-id="f6d77-218">Como tal, tiene control sobre a lo que pueden tener acceso y durante cuánto tiempo.</span><span class="sxs-lookup"><span data-stu-id="f6d77-218">As such, you have control over what they can access, and for how long.</span></span> <span data-ttu-id="f6d77-219">Algo importante de recordar es que si cambia la clave principal de la directiva, se invalidará cualquier firma de acceso compartido creada a partir de ella.</span><span class="sxs-lookup"><span data-stu-id="f6d77-219">An important thing to remember is that if you change the primary key in the policy, any Shared Access Signatures created from it will be invalidated.</span></span>

## <a name="use-the-shared-access-signature-at-amqp-level"></a><span data-ttu-id="f6d77-220">Uso de la firma de acceso compartido (en el nivel AMQP)</span><span class="sxs-lookup"><span data-stu-id="f6d77-220">Use the Shared Access Signature (at AMQP level)</span></span>

<span data-ttu-id="f6d77-221">En la sección anterior, vimos cómo usar el token SAS con una solicitud HTTP POST para enviar datos al Bus de servicio.</span><span class="sxs-lookup"><span data-stu-id="f6d77-221">In the previous section, you saw how to use the SAS token with an HTTP POST request for sending data to the Service Bus.</span></span> <span data-ttu-id="f6d77-222">Como sabe, puede obtener acceso a Bus de servicio mediante Advanced Message Queuing Protocol (AMQP), que es el protocolo preferido por motivos de rendimiento en muchos escenarios.</span><span class="sxs-lookup"><span data-stu-id="f6d77-222">As you know, you can access Service Bus using the Advanced Message Queuing Protocol (AMQP) that is the preferred protocol to use for performance reasons, in many scenarios.</span></span> <span data-ttu-id="f6d77-223">El uso de tokens SAS con AMQP se describe en el documento [Seguridad basada en notificaciones de AMQP, versión 1.0](https://www.oasis-open.org/committees/download.php/50506/amqp-cbs-v1%200-wd02%202013-08-12.doc) que está en fase de borrador desde 2013, pero que es compatible con Azure actualmente.</span><span class="sxs-lookup"><span data-stu-id="f6d77-223">The SAS token usage with AMQP is described in the document [AMQP Claim-Based Security Version 1.0](https://www.oasis-open.org/committees/download.php/50506/amqp-cbs-v1%200-wd02%202013-08-12.doc) that is in working draft since 2013 but well-supported by Azure today.</span></span>

<span data-ttu-id="f6d77-224">Antes de comenzar a enviar datos a Service Bus, el publicador debe enviar el token de SAS de un mensaje de AMQP a un nodo de AMQP bien definido con el nombre **$cbs** (puede verlo como una cola especial usada por el servicio para adquirir y validar todos los tokens de SAS).</span><span class="sxs-lookup"><span data-stu-id="f6d77-224">Before starting to send data to Service Bus, the publisher must send the SAS token inside an AMQP message to a well-defined AMQP node named **$cbs** (you can see it as a "special" queue used by the service to acquire and validate all the SAS tokens).</span></span> <span data-ttu-id="f6d77-225">El publicador debe especificar el campo **ReplyTo** en el mensaje de AMQP. Este es el nodo en el que el servicio contestará al publicador con el resultado de la validación del token (un patrón sencillo de solicitud/respuesta entre el publicador y el servicio).</span><span class="sxs-lookup"><span data-stu-id="f6d77-225">The publisher must specify the **ReplyTo** field inside the AMQP message; this is the node in which the service replies to the publisher with the result of the token validation (a simple request/reply pattern between publisher and service).</span></span> <span data-ttu-id="f6d77-226">Este nodo de respuesta se crea "sobre la marcha" en lo que respecta a la "creación dinámica de nodo remoto", tal como describe la especificación de AMQP 1.0.</span><span class="sxs-lookup"><span data-stu-id="f6d77-226">This reply node is created "on the fly," speaking about "dynamic creation of remote node" as described by the AMQP 1.0 specification.</span></span> <span data-ttu-id="f6d77-227">Después de comprobar que el token SAS es válido, el publicador puede avanzar y comenzar a enviar datos al servicio.</span><span class="sxs-lookup"><span data-stu-id="f6d77-227">After checking that the SAS token is valid, the publisher can go forward and start to send data to the service.</span></span>

<span data-ttu-id="f6d77-228">Los pasos siguientes muestran cómo enviar el token de SAS con protocolo AMQP mediante la biblioteca [AMQP.Net Lite](https://github.com/Azure/amqpnetlite) .</span><span class="sxs-lookup"><span data-stu-id="f6d77-228">The following steps show how to send the SAS token with AMQP protocol using the [AMQP.Net Lite](https://github.com/Azure/amqpnetlite) library.</span></span> <span data-ttu-id="f6d77-229">Esto es útil si no puede usar el SDK oficial de Service Bus (por ejemplo, en WinRT, .Net Compact Framework, .Net Micro Framework y Mono) al desarrollar en C\#.</span><span class="sxs-lookup"><span data-stu-id="f6d77-229">This is useful if you can't use the official Service Bus SDK (for example on WinRT, .Net Compact Framework, .Net Micro Framework and Mono) developing in C\#.</span></span> <span data-ttu-id="f6d77-230">Por supuesto, esta biblioteca es útil para comprender cómo funciona la seguridad basada en notificaciones en el nivel AMQP, como pudo observar en el nivel HTTP (con una solicitud HTTP POST y el token de SAS enviado en el encabezado "Autorización").</span><span class="sxs-lookup"><span data-stu-id="f6d77-230">Of course, this library is useful to help understand how claims-based security works at the AMQP level, as you saw how it works at the HTTP level (with an HTTP POST request and the SAS token sent inside the "Authorization" header).</span></span> <span data-ttu-id="f6d77-231">Si no necesita un conocimiento tan profundo sobre AMQP, puede usar el SDK oficial de Bus de servicio con aplicaciones de .NET Framework, que lo hará por usted.</span><span class="sxs-lookup"><span data-stu-id="f6d77-231">If you don't need such deep knowledge about AMQP, you can use the official Service Bus SDK with .Net Framework applications, which will do it for you.</span></span>

### <a name="c35"></a><span data-ttu-id="f6d77-232">C&#35;</span><span class="sxs-lookup"><span data-stu-id="f6d77-232">C&#35;</span></span>

```csharp
/// <summary>
/// Send claim-based security (CBS) token
/// </summary>
/// <param name="shareAccessSignature">Shared access signature (token) to send</param>
private bool PutCbsToken(Connection connection, string sasToken)
{
    bool result = true;
    Session session = new Session(connection);

    string cbsClientAddress = "cbs-client-reply-to";
    var cbsSender = new SenderLink(session, "cbs-sender", "$cbs");
    var cbsReceiver = new ReceiverLink(session, cbsClientAddress, "$cbs");

    // construct the put-token message
    var request = new Message(sasToken);
    request.Properties = new Properties();
    request.Properties.MessageId = Guid.NewGuid().ToString();
    request.Properties.ReplyTo = cbsClientAddress;
    request.ApplicationProperties = new ApplicationProperties();
    request.ApplicationProperties["operation"] = "put-token";
    request.ApplicationProperties["type"] = "servicebus.windows.net:sastoken";
    request.ApplicationProperties["name"] = Fx.Format("amqp://{0}/{1}", sbNamespace, entity);
    cbsSender.Send(request);

    // receive the response
    var response = cbsReceiver.Receive();
    if (response == null || response.Properties == null || response.ApplicationProperties == null)
    {
        result = false;
    }
    else
    {
        int statusCode = (int)response.ApplicationProperties["status-code"];
        if (statusCode != (int)HttpStatusCode.Accepted && statusCode != (int)HttpStatusCode.OK)
        {
            result = false;
        }
    }

    // the sender/receiver may be kept open for refreshing tokens
    cbsSender.Close();
    cbsReceiver.Close();
    session.Close();

    return result;
}
```

<span data-ttu-id="f6d77-233">El método `PutCbsToken()` recibe la *conexión* (instancia de clase de conexión de AMQP, proporcionada por la [biblioteca .NET Lite de AMQP](https://github.com/Azure/amqpnetlite)) que representa la conexión TCP al servicio y el parámetro *sasToken* que es el token de SAS que se va a enviar.</span><span class="sxs-lookup"><span data-stu-id="f6d77-233">The `PutCbsToken()` method receives the *connection* (AMQP connection class instance as provided by the [AMQP .NET Lite library](https://github.com/Azure/amqpnetlite)) that represents the TCP connection to the service and the *sasToken* parameter that is the SAS token to send.</span></span> 

> [!NOTE]
> <span data-ttu-id="f6d77-234">Es importante que la conexión se cree con el **mecanismo de autenticación SASL establecido en EXTERNAL** (y no con el valor PLAIN predeterminado con el nombre de usuario y la contraseña usados cuando no tiene que enviar el token de SAS).</span><span class="sxs-lookup"><span data-stu-id="f6d77-234">It's important that the connection is created with **SASL authentication mechanism set to EXTERNAL** (and not the default PLAIN with username and password used when you don't need to send the SAS token).</span></span>
> 
> 

<span data-ttu-id="f6d77-235">A continuación, el publicador crea dos vínculos de AMQP para el envío del token de SAS y la recepción de la respuesta (resultado de validación del token) del servicio.</span><span class="sxs-lookup"><span data-stu-id="f6d77-235">Next, the publisher creates two AMQP links for sending the SAS token and receiving the reply (the token validation result) from the service.</span></span>

<span data-ttu-id="f6d77-236">El mensaje de AMQP contiene una serie de propiedades y más información que un mensaje simple.</span><span class="sxs-lookup"><span data-stu-id="f6d77-236">The AMQP message contains a set of properties, and more information than a simple message.</span></span> <span data-ttu-id="f6d77-237">El token de SAS es el cuerpo del mensaje (mediante su constructor).</span><span class="sxs-lookup"><span data-stu-id="f6d77-237">The SAS token is the body of the message (using its constructor).</span></span> <span data-ttu-id="f6d77-238">La propiedad **"ReplyTo"** se establece en el nombre del nodo para recibir el resultado de la validación en el vínculo del receptor (puede cambiar su nombre si lo desea y el servicio lo creará dinámicamente).</span><span class="sxs-lookup"><span data-stu-id="f6d77-238">The **"ReplyTo"** property is set to the node name for receiving the validation result on the receiver link (you can change its name if you want, and it will be created dynamically by the service).</span></span> <span data-ttu-id="f6d77-239">El servicio usa las últimas tres propiedades personalizadas/de aplicación para indicar qué tipo de operación tiene que ejecutar.</span><span class="sxs-lookup"><span data-stu-id="f6d77-239">The last three application/custom properties are used by the service to indicate what kind of operation it has to execute.</span></span> <span data-ttu-id="f6d77-240">Como describe la especificación del borrador de CBS, deben ser el **nombre de operación** ("put-token"), el **tipo de token** (en este caso, "servicebus.windows.net:sastoken") y el **"nombre" de la audiencia** a la que se aplica el token (toda la entidad).</span><span class="sxs-lookup"><span data-stu-id="f6d77-240">As described by the CBS draft specification, they must be the **operation name** ("put-token"), the **type of token** (in this case, a "servicebus.windows.net:sastoken"), and the **"name" of the audience** to which the token applies (the entire entity).</span></span>

<span data-ttu-id="f6d77-241">Después de enviar el token de SAS en el vínculo del remitente, el publicador debe leer la respuesta en el vínculo del receptor.</span><span class="sxs-lookup"><span data-stu-id="f6d77-241">After sending the SAS token on the sender link, the publisher must read the reply on the receiver link.</span></span> <span data-ttu-id="f6d77-242">La respuesta es un mensaje de AMQP simple con una propiedad de la aplicación denominada **"status-code"** que puede contener los mismos valores que un código de estado HTTP.</span><span class="sxs-lookup"><span data-stu-id="f6d77-242">The reply is a simple AMQP message with an application property named **"status-code"** that can contain the same values as an HTTP status code.</span></span>

## <a name="rights-required-for-service-bus-operations"></a><span data-ttu-id="f6d77-243">Derechos necesarios para realizar operaciones del Bus de servicio</span><span class="sxs-lookup"><span data-stu-id="f6d77-243">Rights required for Service Bus operations</span></span>

<span data-ttu-id="f6d77-244">La siguiente tabla muestra los derechos de acceso necesarios para realizar diversas operaciones en recursos del Bus de servicio.</span><span class="sxs-lookup"><span data-stu-id="f6d77-244">The following table shows the access rights required for various operations on Service Bus resources.</span></span>

| <span data-ttu-id="f6d77-245">Operación</span><span class="sxs-lookup"><span data-stu-id="f6d77-245">Operation</span></span> | <span data-ttu-id="f6d77-246">Solicitud necesaria</span><span class="sxs-lookup"><span data-stu-id="f6d77-246">Claim Required</span></span> | <span data-ttu-id="f6d77-247">Ámbito de solicitud</span><span class="sxs-lookup"><span data-stu-id="f6d77-247">Claim Scope</span></span> |
| --- | --- | --- |
| <span data-ttu-id="f6d77-248">**Espacio de nombres**</span><span class="sxs-lookup"><span data-stu-id="f6d77-248">**Namespace**</span></span> | | |
| <span data-ttu-id="f6d77-249">Configurar la regla de autorización en un espacio de nombres</span><span class="sxs-lookup"><span data-stu-id="f6d77-249">Configure authorization rule on a namespace</span></span> |<span data-ttu-id="f6d77-250">administración</span><span class="sxs-lookup"><span data-stu-id="f6d77-250">Manage</span></span> |<span data-ttu-id="f6d77-251">Cualquier dirección de espacio de nombres</span><span class="sxs-lookup"><span data-stu-id="f6d77-251">Any namespace address</span></span> |
| <span data-ttu-id="f6d77-252">**Registro del servicio**</span><span class="sxs-lookup"><span data-stu-id="f6d77-252">**Service Registry**</span></span> | | |
| <span data-ttu-id="f6d77-253">Enumerar directivas privadas</span><span class="sxs-lookup"><span data-stu-id="f6d77-253">Enumerate Private Policies</span></span> |<span data-ttu-id="f6d77-254">administración</span><span class="sxs-lookup"><span data-stu-id="f6d77-254">Manage</span></span> |<span data-ttu-id="f6d77-255">Cualquier dirección de espacio de nombres</span><span class="sxs-lookup"><span data-stu-id="f6d77-255">Any namespace address</span></span> |
| <span data-ttu-id="f6d77-256">Empezar a escuchar en un espacio de nombres</span><span class="sxs-lookup"><span data-stu-id="f6d77-256">Begin listening on a namespace</span></span> |<span data-ttu-id="f6d77-257">Escuchar</span><span class="sxs-lookup"><span data-stu-id="f6d77-257">Listen</span></span> |<span data-ttu-id="f6d77-258">Cualquier dirección de espacio de nombres</span><span class="sxs-lookup"><span data-stu-id="f6d77-258">Any namespace address</span></span> |
| <span data-ttu-id="f6d77-259">Enviar mensajes a un agente de escucha en un espacio de nombres</span><span class="sxs-lookup"><span data-stu-id="f6d77-259">Send messages to a listener at a namespace</span></span> |<span data-ttu-id="f6d77-260">Los métodos Send</span><span class="sxs-lookup"><span data-stu-id="f6d77-260">Send</span></span> |<span data-ttu-id="f6d77-261">Cualquier dirección de espacio de nombres</span><span class="sxs-lookup"><span data-stu-id="f6d77-261">Any namespace address</span></span> |
| <span data-ttu-id="f6d77-262">**Cola**</span><span class="sxs-lookup"><span data-stu-id="f6d77-262">**Queue**</span></span> | | |
| <span data-ttu-id="f6d77-263">Creación de una cola</span><span class="sxs-lookup"><span data-stu-id="f6d77-263">Create a queue</span></span> |<span data-ttu-id="f6d77-264">administración</span><span class="sxs-lookup"><span data-stu-id="f6d77-264">Manage</span></span> |<span data-ttu-id="f6d77-265">Cualquier dirección de espacio de nombres</span><span class="sxs-lookup"><span data-stu-id="f6d77-265">Any namespace address</span></span> |
| <span data-ttu-id="f6d77-266">Eliminación de una cola</span><span class="sxs-lookup"><span data-stu-id="f6d77-266">Delete a queue</span></span> |<span data-ttu-id="f6d77-267">administración</span><span class="sxs-lookup"><span data-stu-id="f6d77-267">Manage</span></span> |<span data-ttu-id="f6d77-268">Cualquier dirección de cola válida</span><span class="sxs-lookup"><span data-stu-id="f6d77-268">Any valid queue address</span></span> |
| <span data-ttu-id="f6d77-269">Enumerar colas</span><span class="sxs-lookup"><span data-stu-id="f6d77-269">Enumerate queues</span></span> |<span data-ttu-id="f6d77-270">administración</span><span class="sxs-lookup"><span data-stu-id="f6d77-270">Manage</span></span> |<span data-ttu-id="f6d77-271">/$Resources/Queues</span><span class="sxs-lookup"><span data-stu-id="f6d77-271">/$Resources/Queues</span></span> |
| <span data-ttu-id="f6d77-272">Obtener la descripción de la cola</span><span class="sxs-lookup"><span data-stu-id="f6d77-272">Get the queue description</span></span> |<span data-ttu-id="f6d77-273">Administrar</span><span class="sxs-lookup"><span data-stu-id="f6d77-273">Manage</span></span> |<span data-ttu-id="f6d77-274">Cualquier dirección de cola válida</span><span class="sxs-lookup"><span data-stu-id="f6d77-274">Any valid queue address</span></span> |
| <span data-ttu-id="f6d77-275">Configurar la regla de autorización para una cola</span><span class="sxs-lookup"><span data-stu-id="f6d77-275">Configure authorization rule for a queue</span></span> |<span data-ttu-id="f6d77-276">administración</span><span class="sxs-lookup"><span data-stu-id="f6d77-276">Manage</span></span> |<span data-ttu-id="f6d77-277">Cualquier dirección de cola válida</span><span class="sxs-lookup"><span data-stu-id="f6d77-277">Any valid queue address</span></span> |
| <span data-ttu-id="f6d77-278">Enviar a la cola</span><span class="sxs-lookup"><span data-stu-id="f6d77-278">Send into to the queue</span></span> |<span data-ttu-id="f6d77-279">Los métodos Send</span><span class="sxs-lookup"><span data-stu-id="f6d77-279">Send</span></span> |<span data-ttu-id="f6d77-280">Cualquier dirección de cola válida</span><span class="sxs-lookup"><span data-stu-id="f6d77-280">Any valid queue address</span></span> |
| <span data-ttu-id="f6d77-281">mensajes de una cola</span><span class="sxs-lookup"><span data-stu-id="f6d77-281">Receive messages from a queue</span></span> |<span data-ttu-id="f6d77-282">Escuchar</span><span class="sxs-lookup"><span data-stu-id="f6d77-282">Listen</span></span> |<span data-ttu-id="f6d77-283">Cualquier dirección de cola válida</span><span class="sxs-lookup"><span data-stu-id="f6d77-283">Any valid queue address</span></span> |
| <span data-ttu-id="f6d77-284">Abandone o complete los mensajes después de recibir el mensaje en el modo de bloqueo de información</span><span class="sxs-lookup"><span data-stu-id="f6d77-284">Abandon or complete messages after receiving the message in peek-lock mode</span></span> |<span data-ttu-id="f6d77-285">Escuchar</span><span class="sxs-lookup"><span data-stu-id="f6d77-285">Listen</span></span> |<span data-ttu-id="f6d77-286">Cualquier dirección de cola válida</span><span class="sxs-lookup"><span data-stu-id="f6d77-286">Any valid queue address</span></span> |
| <span data-ttu-id="f6d77-287">Aplazar un mensaje para su recuperación posterior</span><span class="sxs-lookup"><span data-stu-id="f6d77-287">Defer a message for later retrieval</span></span> |<span data-ttu-id="f6d77-288">Escuchar</span><span class="sxs-lookup"><span data-stu-id="f6d77-288">Listen</span></span> |<span data-ttu-id="f6d77-289">Cualquier dirección de cola válida</span><span class="sxs-lookup"><span data-stu-id="f6d77-289">Any valid queue address</span></span> |
| <span data-ttu-id="f6d77-290">Mensaje fallido</span><span class="sxs-lookup"><span data-stu-id="f6d77-290">Deadletter a message</span></span> |<span data-ttu-id="f6d77-291">Escuchar</span><span class="sxs-lookup"><span data-stu-id="f6d77-291">Listen</span></span> |<span data-ttu-id="f6d77-292">Cualquier dirección de cola válida</span><span class="sxs-lookup"><span data-stu-id="f6d77-292">Any valid queue address</span></span> |
| <span data-ttu-id="f6d77-293">Obtener el estado asociado a una sesión de cola de mensajes</span><span class="sxs-lookup"><span data-stu-id="f6d77-293">Get the state associated with a message queue session</span></span> |<span data-ttu-id="f6d77-294">Escuchar</span><span class="sxs-lookup"><span data-stu-id="f6d77-294">Listen</span></span> |<span data-ttu-id="f6d77-295">Cualquier dirección de cola válida</span><span class="sxs-lookup"><span data-stu-id="f6d77-295">Any valid queue address</span></span> |
| <span data-ttu-id="f6d77-296">Establecer el estado asociado a una sesión de cola de mensajes</span><span class="sxs-lookup"><span data-stu-id="f6d77-296">Set the state associated with a message queue session</span></span> |<span data-ttu-id="f6d77-297">Escuchar</span><span class="sxs-lookup"><span data-stu-id="f6d77-297">Listen</span></span> |<span data-ttu-id="f6d77-298">Cualquier dirección de cola válida</span><span class="sxs-lookup"><span data-stu-id="f6d77-298">Any valid queue address</span></span> |
| <span data-ttu-id="f6d77-299">**Tema.**</span><span class="sxs-lookup"><span data-stu-id="f6d77-299">**Topic**</span></span> | | |
| <span data-ttu-id="f6d77-300">de un tema</span><span class="sxs-lookup"><span data-stu-id="f6d77-300">Create a topic</span></span> |<span data-ttu-id="f6d77-301">administración</span><span class="sxs-lookup"><span data-stu-id="f6d77-301">Manage</span></span> |<span data-ttu-id="f6d77-302">Cualquier dirección de espacio de nombres</span><span class="sxs-lookup"><span data-stu-id="f6d77-302">Any namespace address</span></span> |
| <span data-ttu-id="f6d77-303">Eliminación de un tema</span><span class="sxs-lookup"><span data-stu-id="f6d77-303">Delete a topic</span></span> |<span data-ttu-id="f6d77-304">administración</span><span class="sxs-lookup"><span data-stu-id="f6d77-304">Manage</span></span> |<span data-ttu-id="f6d77-305">Cualquier dirección de tema válida</span><span class="sxs-lookup"><span data-stu-id="f6d77-305">Any valid topic address</span></span> |
| <span data-ttu-id="f6d77-306">Enumerar temas</span><span class="sxs-lookup"><span data-stu-id="f6d77-306">Enumerate topics</span></span> |<span data-ttu-id="f6d77-307">administración</span><span class="sxs-lookup"><span data-stu-id="f6d77-307">Manage</span></span> |<span data-ttu-id="f6d77-308">/$Resources/Topics</span><span class="sxs-lookup"><span data-stu-id="f6d77-308">/$Resources/Topics</span></span> |
| <span data-ttu-id="f6d77-309">Obtener la descripción del tema</span><span class="sxs-lookup"><span data-stu-id="f6d77-309">Get the topic description</span></span> |<span data-ttu-id="f6d77-310">Administrar</span><span class="sxs-lookup"><span data-stu-id="f6d77-310">Manage</span></span> |<span data-ttu-id="f6d77-311">Cualquier dirección de tema válida</span><span class="sxs-lookup"><span data-stu-id="f6d77-311">Any valid topic address</span></span> |
| <span data-ttu-id="f6d77-312">Configurar la regla de autorización para un tema</span><span class="sxs-lookup"><span data-stu-id="f6d77-312">Configure authorization rule for a topic</span></span> |<span data-ttu-id="f6d77-313">administración</span><span class="sxs-lookup"><span data-stu-id="f6d77-313">Manage</span></span> |<span data-ttu-id="f6d77-314">Cualquier dirección de tema válida</span><span class="sxs-lookup"><span data-stu-id="f6d77-314">Any valid topic address</span></span> |
| <span data-ttu-id="f6d77-315">Enviar al tema</span><span class="sxs-lookup"><span data-stu-id="f6d77-315">Send to the topic</span></span> |<span data-ttu-id="f6d77-316">Los métodos Send</span><span class="sxs-lookup"><span data-stu-id="f6d77-316">Send</span></span> |<span data-ttu-id="f6d77-317">Cualquier dirección de tema válida</span><span class="sxs-lookup"><span data-stu-id="f6d77-317">Any valid topic address</span></span> |
| <span data-ttu-id="f6d77-318">**Suscripción**</span><span class="sxs-lookup"><span data-stu-id="f6d77-318">**Subscription**</span></span> | | |
| <span data-ttu-id="f6d77-319">una suscripción</span><span class="sxs-lookup"><span data-stu-id="f6d77-319">Create a subscription</span></span> |<span data-ttu-id="f6d77-320">administración</span><span class="sxs-lookup"><span data-stu-id="f6d77-320">Manage</span></span> |<span data-ttu-id="f6d77-321">Cualquier dirección de espacio de nombres</span><span class="sxs-lookup"><span data-stu-id="f6d77-321">Any namespace address</span></span> |
| <span data-ttu-id="f6d77-322">Eliminar suscripción</span><span class="sxs-lookup"><span data-stu-id="f6d77-322">Delete subscription</span></span> |<span data-ttu-id="f6d77-323">administración</span><span class="sxs-lookup"><span data-stu-id="f6d77-323">Manage</span></span> |<span data-ttu-id="f6d77-324">../myTopic/Subscriptions/mySubscription</span><span class="sxs-lookup"><span data-stu-id="f6d77-324">../myTopic/Subscriptions/mySubscription</span></span> |
| <span data-ttu-id="f6d77-325">Enumerar suscripciones</span><span class="sxs-lookup"><span data-stu-id="f6d77-325">Enumerate subscriptions</span></span> |<span data-ttu-id="f6d77-326">administración</span><span class="sxs-lookup"><span data-stu-id="f6d77-326">Manage</span></span> |<span data-ttu-id="f6d77-327">../myTopic/Subscriptions</span><span class="sxs-lookup"><span data-stu-id="f6d77-327">../myTopic/Subscriptions</span></span> |
| <span data-ttu-id="f6d77-328">Obtener la descripción de la suscripción</span><span class="sxs-lookup"><span data-stu-id="f6d77-328">Get subscription description</span></span> |<span data-ttu-id="f6d77-329">Administrar</span><span class="sxs-lookup"><span data-stu-id="f6d77-329">Manage</span></span> |<span data-ttu-id="f6d77-330">../myTopic/Subscriptions/mySubscription</span><span class="sxs-lookup"><span data-stu-id="f6d77-330">../myTopic/Subscriptions/mySubscription</span></span> |
| <span data-ttu-id="f6d77-331">Abandone o complete los mensajes después de recibir el mensaje en el modo de bloqueo de información</span><span class="sxs-lookup"><span data-stu-id="f6d77-331">Abandon or complete messages after receiving the message in peek-lock mode</span></span> |<span data-ttu-id="f6d77-332">Escuchar</span><span class="sxs-lookup"><span data-stu-id="f6d77-332">Listen</span></span> |<span data-ttu-id="f6d77-333">../myTopic/Subscriptions/mySubscription</span><span class="sxs-lookup"><span data-stu-id="f6d77-333">../myTopic/Subscriptions/mySubscription</span></span> |
| <span data-ttu-id="f6d77-334">Aplazar un mensaje para su recuperación posterior</span><span class="sxs-lookup"><span data-stu-id="f6d77-334">Defer a message for later retrieval</span></span> |<span data-ttu-id="f6d77-335">Escuchar</span><span class="sxs-lookup"><span data-stu-id="f6d77-335">Listen</span></span> |<span data-ttu-id="f6d77-336">../myTopic/Subscriptions/mySubscription</span><span class="sxs-lookup"><span data-stu-id="f6d77-336">../myTopic/Subscriptions/mySubscription</span></span> |
| <span data-ttu-id="f6d77-337">Mensaje fallido</span><span class="sxs-lookup"><span data-stu-id="f6d77-337">Deadletter a message</span></span> |<span data-ttu-id="f6d77-338">Escuchar</span><span class="sxs-lookup"><span data-stu-id="f6d77-338">Listen</span></span> |<span data-ttu-id="f6d77-339">../myTopic/Subscriptions/mySubscription</span><span class="sxs-lookup"><span data-stu-id="f6d77-339">../myTopic/Subscriptions/mySubscription</span></span> |
| <span data-ttu-id="f6d77-340">Obtener el estado asociado a una sesión de tema</span><span class="sxs-lookup"><span data-stu-id="f6d77-340">Get the state associated with a topic session</span></span> |<span data-ttu-id="f6d77-341">Escuchar</span><span class="sxs-lookup"><span data-stu-id="f6d77-341">Listen</span></span> |<span data-ttu-id="f6d77-342">../myTopic/Subscriptions/mySubscription</span><span class="sxs-lookup"><span data-stu-id="f6d77-342">../myTopic/Subscriptions/mySubscription</span></span> |
| <span data-ttu-id="f6d77-343">Establecer el estado asociado a una sesión de tema</span><span class="sxs-lookup"><span data-stu-id="f6d77-343">Set the state associated with a topic session</span></span> |<span data-ttu-id="f6d77-344">Escuchar</span><span class="sxs-lookup"><span data-stu-id="f6d77-344">Listen</span></span> |<span data-ttu-id="f6d77-345">../myTopic/Subscriptions/mySubscription</span><span class="sxs-lookup"><span data-stu-id="f6d77-345">../myTopic/Subscriptions/mySubscription</span></span> |
| <span data-ttu-id="f6d77-346">**Reglas**</span><span class="sxs-lookup"><span data-stu-id="f6d77-346">**Rules**</span></span> | | |
| <span data-ttu-id="f6d77-347">Crear una regla</span><span class="sxs-lookup"><span data-stu-id="f6d77-347">Create a rule</span></span> |<span data-ttu-id="f6d77-348">administración</span><span class="sxs-lookup"><span data-stu-id="f6d77-348">Manage</span></span> |<span data-ttu-id="f6d77-349">../myTopic/Subscriptions/mySubscription</span><span class="sxs-lookup"><span data-stu-id="f6d77-349">../myTopic/Subscriptions/mySubscription</span></span> |
| <span data-ttu-id="f6d77-350">Eliminar una regla</span><span class="sxs-lookup"><span data-stu-id="f6d77-350">Delete a rule</span></span> |<span data-ttu-id="f6d77-351">administración</span><span class="sxs-lookup"><span data-stu-id="f6d77-351">Manage</span></span> |<span data-ttu-id="f6d77-352">../myTopic/Subscriptions/mySubscription</span><span class="sxs-lookup"><span data-stu-id="f6d77-352">../myTopic/Subscriptions/mySubscription</span></span> |
| <span data-ttu-id="f6d77-353">Enumerar reglas</span><span class="sxs-lookup"><span data-stu-id="f6d77-353">Enumerate rules</span></span> |<span data-ttu-id="f6d77-354">Administrar o escuchar</span><span class="sxs-lookup"><span data-stu-id="f6d77-354">Manage or Listen</span></span> |<span data-ttu-id="f6d77-355">../myTopic/Subscriptions/mySubscription/Rules</span><span class="sxs-lookup"><span data-stu-id="f6d77-355">../myTopic/Subscriptions/mySubscription/Rules</span></span> 

## <a name="next-steps"></a><span data-ttu-id="f6d77-356">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="f6d77-356">Next steps</span></span>

<span data-ttu-id="f6d77-357">Para más información sobre la mensajería de Service Bus, consulte los siguientes temas.</span><span class="sxs-lookup"><span data-stu-id="f6d77-357">To learn more about Service Bus messaging, see the following topics.</span></span>

* [<span data-ttu-id="f6d77-358">Elementos fundamentales del Bus de servicio</span><span class="sxs-lookup"><span data-stu-id="f6d77-358">Service Bus fundamentals</span></span>](service-bus-fundamentals-hybrid-solutions.md)
* [<span data-ttu-id="f6d77-359">Colas, temas y suscripciones de Service Bus</span><span class="sxs-lookup"><span data-stu-id="f6d77-359">Service Bus queues, topics, and subscriptions</span></span>](service-bus-queues-topics-subscriptions.md)
* [<span data-ttu-id="f6d77-360">Utilización de las colas del Bus de servicio</span><span class="sxs-lookup"><span data-stu-id="f6d77-360">How to use Service Bus queues</span></span>](service-bus-dotnet-get-started-with-queues.md)
* [<span data-ttu-id="f6d77-361">Uso de temas y suscripciones de Service Bus</span><span class="sxs-lookup"><span data-stu-id="f6d77-361">How to use Service Bus topics and subscriptions</span></span>](service-bus-dotnet-how-to-use-topics-subscriptions.md)

[Azure portal]: https://portal.azure.com
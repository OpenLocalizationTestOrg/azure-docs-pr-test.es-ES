---
title: aplicaciones de aaaWrite que usan colas de Service Bus de Azure | Documentos de Microsoft
description: "¿Cómo toowrite una aplicación simple basada en cola que usa Service Bus de Azure."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: 754d91b3-1426-405e-84b4-fd36d65b114a
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 08/07/2017
ms.author: sethm
ms.openlocfilehash: 93b75902a06becd6e33e05298e09f5669d0e2aef
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="create-applications-that-use-service-bus-queues"></a><span data-ttu-id="a9919-103">Creación de aplicaciones que usan colas del Bus de servicio</span><span class="sxs-lookup"><span data-stu-id="a9919-103">Create applications that use Service Bus queues</span></span>
<span data-ttu-id="a9919-104">En este tema se describen las colas de Bus de servicio y se muestra cómo toowrite una aplicación simple basada en cola que usa Service Bus.</span><span class="sxs-lookup"><span data-stu-id="a9919-104">This topic describes Service Bus queues and shows how toowrite a simple queue-based application that uses Service Bus.</span></span>

<span data-ttu-id="a9919-105">Considere un escenario de Hola a todos de la venta directa en que los datos de ventas de individuales Point (POS) deben ser terminales dirigirse sistema de administración de inventario de tooan que usa Hola datos toodetermine cuándo toobe reponerse existencias.</span><span class="sxs-lookup"><span data-stu-id="a9919-105">Consider a scenario from hello world of retail in which sales data from individual Point-of-Sale (POS) terminals must be routed tooan inventory management system that uses hello data toodetermine when stock has toobe replenished.</span></span> <span data-ttu-id="a9919-106">Esta solución usa mensajería de Bus de servicio para la comunicación de hello entre terminales de Hola y el sistema de administración de inventario de hello, como se muestra en hello figura siguiente:</span><span class="sxs-lookup"><span data-stu-id="a9919-106">This solution uses Service Bus messaging for hello communication between hello terminals and hello inventory management system, as illustrated in hello following figure:</span></span>

![Imagen de colas de Service Bus 1](./media/service-bus-create-queues/IC657161.gif)

<span data-ttu-id="a9919-108">Cada terminal de punto de venta informa de sus datos de venta enviando mensajes toohello **DataCollectionQueue**.</span><span class="sxs-lookup"><span data-stu-id="a9919-108">Each POS terminal reports its sales data by sending messages toohello **DataCollectionQueue**.</span></span> <span data-ttu-id="a9919-109">Estos mensajes permanecen en esta cola hasta que se recuperan mediante el sistema de administración de inventario de Hola.</span><span class="sxs-lookup"><span data-stu-id="a9919-109">These messages remain in this queue until they are retrieved by hello inventory management system.</span></span> <span data-ttu-id="a9919-110">Este patrón se denomina a menudo *mensajería asincrónica*, porque terminal Hola POS no tiene toowait una respuesta de procesamiento de toocontinue de sistema de administración de inventario de Hola.</span><span class="sxs-lookup"><span data-stu-id="a9919-110">This pattern is often termed *asynchronous messaging*, because hello POS terminal does not have toowait for a reply from hello inventory management system toocontinue processing.</span></span>

## <a name="why-queuing"></a><span data-ttu-id="a9919-111">Motivos para usar la cola</span><span class="sxs-lookup"><span data-stu-id="a9919-111">Why queuing?</span></span>
<span data-ttu-id="a9919-112">Antes de adentrarnos en el código de hello tooset necesaria de esta aplicación, considere la posibilidad de ventajas de hello del uso de una cola en este escenario en lugar de tener terminales Hola POS hablar directamente (sincrónicamente) toohello el sistema de administración de inventario.</span><span class="sxs-lookup"><span data-stu-id="a9919-112">Before we look at hello code that is required tooset up this application, consider hello advantages of using a queue in this scenario instead of having hello POS terminals talk directly (synchronously) toohello inventory management system.</span></span>

### <a name="temporal-decoupling"></a><span data-ttu-id="a9919-113">Desacoplamiento temporal</span><span class="sxs-lookup"><span data-stu-id="a9919-113">Temporal decoupling</span></span>
<span data-ttu-id="a9919-114">Con el patrón de mensajería asincrónica de hello, productores y consumidores no tienen toobe en línea en hello mismo tiempo.</span><span class="sxs-lookup"><span data-stu-id="a9919-114">With hello asynchronous messaging pattern, producers and consumers do not have toobe online at hello same time.</span></span> <span data-ttu-id="a9919-115">infraestructura de mensajería de Hello almacena de forma confiable los mensajes hasta que la parte consumidora de hello esté listo tooreceive ellos.</span><span class="sxs-lookup"><span data-stu-id="a9919-115">hello messaging infrastructure reliably stores messages until hello consuming party is ready tooreceive them.</span></span> <span data-ttu-id="a9919-116">Esto significa componentes Hola de aplicación hello distribuida pueden estar desconectados, ya sea voluntariamente; Por ejemplo, para el mantenimiento o debido a un bloqueo del componente tooa, sin que afecte a todo sistema de Hola.</span><span class="sxs-lookup"><span data-stu-id="a9919-116">This means hello components of hello distributed application can be disconnected, either voluntarily; for example, for maintenance, or due tooa component crash, without affecting hello whole system.</span></span> <span data-ttu-id="a9919-117">Además, Hola consumiendo aplicación solo puede tener toobe en línea durante determinadas horas del día de Hola.</span><span class="sxs-lookup"><span data-stu-id="a9919-117">Furthermore, hello consuming application may only have toobe online during certain times of hello day.</span></span> <span data-ttu-id="a9919-118">Por ejemplo, en este escenario comercial, sistema de administración de inventario de hello solo puede tener toocome en línea después del final de Hola de día laborable de Hola.</span><span class="sxs-lookup"><span data-stu-id="a9919-118">For example, in this retail scenario, hello inventory management system may only have toocome online after hello end of hello business day.</span></span>

### <a name="load-leveling"></a><span data-ttu-id="a9919-119">Redistribución de la carga</span><span class="sxs-lookup"><span data-stu-id="a9919-119">Load leveling</span></span>
<span data-ttu-id="a9919-120">En muchas aplicaciones de la carga del sistema cambia con el tiempo, mientras que el tiempo de procesamiento de hello necesario para cada unidad de trabajo es normalmente constante.</span><span class="sxs-lookup"><span data-stu-id="a9919-120">In many applications system load varies over time, whereas hello processing time required for each unit of work is typically constant.</span></span> <span data-ttu-id="a9919-121">Intermediar mensaje productores y consumidores con un medio de cola que Hola aplicación que consume (trabajo hello) solo tiene toobe aprovisiona tooservice un promedio de carga en lugar de una carga máxima.</span><span class="sxs-lookup"><span data-stu-id="a9919-121">Intermediating message producers and consumers with a queue means that hello consuming application (hello worker) only has toobe provisioned tooservice an average load rather than a peak load.</span></span> <span data-ttu-id="a9919-122">profundidad de Hola de cola de hello crecerán y contrato Hola entrante carga varía.</span><span class="sxs-lookup"><span data-stu-id="a9919-122">hello depth of hello queue will grow and contract as hello incoming load varies.</span></span> <span data-ttu-id="a9919-123">Esto directamente ahorra dinero con cantidad de toohello independientemente de la carga de la aplicación de infraestructura necesario tooservice Hola.</span><span class="sxs-lookup"><span data-stu-id="a9919-123">This directly saves money with regard toohello amount of infrastructure required tooservice hello application load.</span></span>

![Imagen de colas de Service Bus 2](./media/service-bus-create-queues/IC657162.gif)

### <a name="load-balancing"></a><span data-ttu-id="a9919-125">Equilibrio de carga</span><span class="sxs-lookup"><span data-stu-id="a9919-125">Load balancing</span></span>
<span data-ttu-id="a9919-126">Como Hola aumenta la carga, más procesos de trabajo pueden ser agregado tooread de cola de trabajo de Hola.</span><span class="sxs-lookup"><span data-stu-id="a9919-126">As hello load increases, more worker processes can be added tooread from hello worker queue.</span></span> <span data-ttu-id="a9919-127">Cada mensaje se procesa solamente mediante uno de los procesos de trabajo de Hola.</span><span class="sxs-lookup"><span data-stu-id="a9919-127">Each message is processed by only one of hello worker processes.</span></span> <span data-ttu-id="a9919-128">Además, este equilibrio de carga basados en extracción permite un uso óptimo de los equipos de trabajo de Hola incluso si los equipos de trabajo de hello diferencian la potencia de tooprocessing tener en cuenta, ya que extraerán mensajes a su propia velocidad máxima.</span><span class="sxs-lookup"><span data-stu-id="a9919-128">Furthermore, this pull-based load balancing allows for optimum usage of hello worker computers even if hello worker computers differ with regard tooprocessing power, as they will pull messages at their own maximum rate.</span></span> <span data-ttu-id="a9919-129">Este patrón a menudo se denomina patrón de consumidor competencia Hola.</span><span class="sxs-lookup"><span data-stu-id="a9919-129">This pattern is often termed hello competing consumer pattern.</span></span>

![Imagen de colas de Service Bus 3](./media/service-bus-create-queues/IC657163.gif)

### <a name="loose-coupling"></a><span data-ttu-id="a9919-131">Acoplamiento débil</span><span class="sxs-lookup"><span data-stu-id="a9919-131">Loose coupling</span></span>
<span data-ttu-id="a9919-132">Uso de message Queue Server toointermediate entre los consumidores y productores de mensajes proporciona un acoplamiento débil intrínseco entre los componentes de Hola.</span><span class="sxs-lookup"><span data-stu-id="a9919-132">Using message queuing toointermediate between message producers and consumers provides an intrinsic loose coupling between hello components.</span></span> <span data-ttu-id="a9919-133">Como los productores y consumidores no son compatibles con unos de otros, un consumidor puede actualizarse sin tener ningún efecto en productor Hola.</span><span class="sxs-lookup"><span data-stu-id="a9919-133">Because producers and consumers are not aware of each other, a consumer can be upgraded without having any effect on hello producer.</span></span> <span data-ttu-id="a9919-134">Además, Hola topología de mensajería puede evolucionar sin que afecte a los extremos existentes de Hola.</span><span class="sxs-lookup"><span data-stu-id="a9919-134">Furthermore, hello messaging topology can evolve without affecting hello existing endpoints.</span></span> <span data-ttu-id="a9919-135">Esto se tratará con mayor detalle cuando se expliquen la publicación y la suscripción.</span><span class="sxs-lookup"><span data-stu-id="a9919-135">We’ll discuss this more when we talk about publish/subscribe.</span></span>

## <a name="show-me-hello-code"></a><span data-ttu-id="a9919-136">Muéstrame el código de hello</span><span class="sxs-lookup"><span data-stu-id="a9919-136">Show me hello code</span></span>
<span data-ttu-id="a9919-137">Hola la siguiente sección se muestra cómo toouse Service Bus toobuild esta aplicación.</span><span class="sxs-lookup"><span data-stu-id="a9919-137">hello following section shows how toouse Service Bus toobuild this application.</span></span>

### <a name="sign-up-for-an-azure-account"></a><span data-ttu-id="a9919-138">Registro para obtener una cuenta de Azure</span><span class="sxs-lookup"><span data-stu-id="a9919-138">Sign up for an Azure account</span></span>
<span data-ttu-id="a9919-139">Necesitará una cuenta de Azure en toostart orden trabajar con Bus de servicio.</span><span class="sxs-lookup"><span data-stu-id="a9919-139">You’ll need an Azure account in order toostart working with Service Bus.</span></span> <span data-ttu-id="a9919-140">Si no tiene una, puede registrarse para obtener una cuenta gratuita [aquí](https://azure.microsoft.com/pricing/free-trial/?WT.mc_id=A85619ABF).</span><span class="sxs-lookup"><span data-stu-id="a9919-140">If you do not already have one, you can sign up for a free account [here](https://azure.microsoft.com/pricing/free-trial/?WT.mc_id=A85619ABF).</span></span>

### <a name="create-a-namespace"></a><span data-ttu-id="a9919-141">Creación de un espacio de nombres</span><span class="sxs-lookup"><span data-stu-id="a9919-141">Create a namespace</span></span>
<span data-ttu-id="a9919-142">Una vez que tenga una suscripción, puede [crear un espacio de nombres de servicio](service-bus-create-namespace-portal.md).</span><span class="sxs-lookup"><span data-stu-id="a9919-142">Once you have a subscription, you can [create a service namespace](service-bus-create-namespace-portal.md).</span></span> <span data-ttu-id="a9919-143">Cada espacio de nombres actúa como contenedor con un ámbito para un conjunto de entidades de Bus de servicio.</span><span class="sxs-lookup"><span data-stu-id="a9919-143">Each namespace acts as a scoping container for a set of Service Bus entities.</span></span> <span data-ttu-id="a9919-144">Asigne un nombre único al nuevo espacio de nombres en todas las cuentas de Bus de servicio.</span><span class="sxs-lookup"><span data-stu-id="a9919-144">Give your new namespace a unique name across all Service Bus accounts.</span></span> 

### <a name="install-hello-nuget-package"></a><span data-ttu-id="a9919-145">Instalar el paquete de NuGet Hola</span><span class="sxs-lookup"><span data-stu-id="a9919-145">Install hello NuGet package</span></span>
<span data-ttu-id="a9919-146">espacio de nombres de Bus de servicio de hello toouse, una aplicación debe hacer referencia a Hola ensamblado de Bus de servicio, específicamente Microsoft.ServiceBus.dll.</span><span class="sxs-lookup"><span data-stu-id="a9919-146">toouse hello Service Bus namespace, an application must reference hello Service Bus assembly, specifically Microsoft.ServiceBus.dll.</span></span> <span data-ttu-id="a9919-147">Puede encontrar este ensamblado como parte del SDK de Microsoft Azure de Hola y Hola descarga está disponible en hello [página de descarga del SDK de Azure](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="a9919-147">You can find this assembly as part of hello Microsoft Azure SDK, and hello download is available at hello [Azure SDK download page](https://azure.microsoft.com/downloads/).</span></span> <span data-ttu-id="a9919-148">Sin embargo, Hola [paquete NuGet de Bus de servicio](https://www.nuget.org/packages/WindowsAzure.ServiceBus) es hello tooget de manera más fácil de hello API de Service Bus y tooconfigure la aplicación con todas las dependencias de Bus de servicio de Hola de.</span><span class="sxs-lookup"><span data-stu-id="a9919-148">However, hello [Service Bus NuGet package](https://www.nuget.org/packages/WindowsAzure.ServiceBus) is hello easiest way tooget hello Service Bus API and tooconfigure your application with all of hello Service Bus dependencies.</span></span>

### <a name="create-hello-queue"></a><span data-ttu-id="a9919-149">Crear cola Hola</span><span class="sxs-lookup"><span data-stu-id="a9919-149">Create hello queue</span></span>
<span data-ttu-id="a9919-150">Las operaciones de administración de Service Bus entidades de mensajería (colas y publicación/suscripción temas) se realizan a través de hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) clase.</span><span class="sxs-lookup"><span data-stu-id="a9919-150">Management operations for Service Bus messaging entities (queues and publish/subscribe topics) are performed via hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) class.</span></span> <span data-ttu-id="a9919-151">Service Bus usa un modelo de seguridad basado en la [firma de acceso compartido (SAS)](service-bus-sas.md).</span><span class="sxs-lookup"><span data-stu-id="a9919-151">Service Bus uses a [Shared Access Signature (SAS)](service-bus-sas.md) based security model.</span></span> <span data-ttu-id="a9919-152">Hola [TokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider) clase representa un proveedor de tokens de seguridad con métodos de fábrica integrados que devuelven algunos proveedores de tokens bien conocidos.</span><span class="sxs-lookup"><span data-stu-id="a9919-152">hello [TokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider) class represents a security token provider with built-in factory methods returning some well-known token providers.</span></span> <span data-ttu-id="a9919-153">Vamos a usar un [CreateSharedAccessSignatureTokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#Microsoft_ServiceBus_TokenProvider_CreateSharedAccessSignatureTokenProvider_System_String_) credenciales SAS de método toohold Hola.</span><span class="sxs-lookup"><span data-stu-id="a9919-153">We’ll use a [CreateSharedAccessSignatureTokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#Microsoft_ServiceBus_TokenProvider_CreateSharedAccessSignatureTokenProvider_System_String_) method toohold hello SAS credentials.</span></span> <span data-ttu-id="a9919-154">Hola [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) instancia, a continuación, se construye con la dirección base de hello del espacio de nombres de Bus de servicio de Hola y el proveedor de tokens de Hola.</span><span class="sxs-lookup"><span data-stu-id="a9919-154">hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) instance is then constructed with hello base address of hello Service Bus namespace and hello token provider.</span></span>

<span data-ttu-id="a9919-155">Hola [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) clase proporciona métodos toocreate, enumerar y eliminar entidades de mensajería.</span><span class="sxs-lookup"><span data-stu-id="a9919-155">hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) class provides methods toocreate, enumerate and delete messaging entities.</span></span> <span data-ttu-id="a9919-156">Hola código que se muestra a continuación se muestra cómo Hola [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) instancia es Hola crea y se utiliza toocreate **DataCollectionQueue** cola.</span><span class="sxs-lookup"><span data-stu-id="a9919-156">hello code that is shown here shows how hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) instance is created and used toocreate hello **DataCollectionQueue** queue.</span></span>

```csharp
Uri uri = ServiceBusEnvironment.CreateServiceUri("sb", 
                "test-blog", string.Empty);
string name = "RootManageSharedAccessKey";
string key = "abcdefghijklmopqrstuvwxyz";

TokenProvider tokenProvider = 
    TokenProvider.CreateSharedAccessSignatureTokenProvider(name, key);
NamespaceManager namespaceManager = 
    new NamespaceManager(uri, tokenProvider);
namespaceManager.CreateQueue("DataCollectionQueue");
```

<span data-ttu-id="a9919-157">Tenga en cuenta que hay sobrecargas de hello [CreateQueue](/dotnet/api/microsoft.servicebus.namespacemanager#Microsoft_ServiceBus_NamespaceManager_CreateQueue_System_String_) método que permiten las propiedades de hello cola toobe optimizado.</span><span class="sxs-lookup"><span data-stu-id="a9919-157">Note that there are overloads of hello [CreateQueue](/dotnet/api/microsoft.servicebus.namespacemanager#Microsoft_ServiceBus_NamespaceManager_CreateQueue_System_String_) method that enable properties of hello queue toobe tuned.</span></span> <span data-ttu-id="a9919-158">Por ejemplo, puede establecer Hola time-to-live (TTL) predeterminado para los mensajes enviados a cola toohello.</span><span class="sxs-lookup"><span data-stu-id="a9919-158">For example, you can set hello default time-to-live (TTL) value for messages sent toohello queue.</span></span>

### <a name="send-messages-toohello-queue"></a><span data-ttu-id="a9919-159">Cola de mensajes toohello de envío</span><span class="sxs-lookup"><span data-stu-id="a9919-159">Send messages toohello queue</span></span>
<span data-ttu-id="a9919-160">En el caso de operaciones en tiempo de ejecución en entidades de Service Bus (por ejemplo, enviar y recibir mensajes), una aplicación debe crear primero un objeto [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory).</span><span class="sxs-lookup"><span data-stu-id="a9919-160">For run-time operations on Service Bus entities; for example, sending and receiving messages, an application must first create a [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) object.</span></span> <span data-ttu-id="a9919-161">Toohello similar [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) clase hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) se crea una instancia de la dirección base de Hola de espacio de nombres de servicio de Hola y el proveedor de tokens de Hola.</span><span class="sxs-lookup"><span data-stu-id="a9919-161">Similar toohello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) class, hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) instance is created from hello base address of hello service namespace and hello token provider.</span></span>

```csharp
 BrokeredMessage bm = new BrokeredMessage(salesData);
 bm.Label = "SalesReport";
 bm.Properties["StoreName"] = "Redmond";
 bm.Properties["MachineID"] = "POS_1";
```

<span data-ttu-id="a9919-162">Mensajes envían a y recibidos de Bus de servicio colas son instancias de hello [BrokeredMessage](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) clase.</span><span class="sxs-lookup"><span data-stu-id="a9919-162">Messages sent to, and received from Service Bus queues are instances of hello [BrokeredMessage](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) class.</span></span> <span data-ttu-id="a9919-163">Esta clase está formada por un conjunto de propiedades estándar (como [etiqueta](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label) y [TimeToLive](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive)), un diccionario de propiedades de la aplicación de uso toohold y un cuerpo de datos de aplicación arbitrarios.</span><span class="sxs-lookup"><span data-stu-id="a9919-163">This class consists of a set of standard properties (such as [Label](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label) and [TimeToLive](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive)), a dictionary that is used toohold application properties, and a body of arbitrary application data.</span></span> <span data-ttu-id="a9919-164">Una aplicación puede establecer cuerpo Hola pasando cualquier objeto serializable (hello en el ejemplo siguiente se pasa en un **SalesData** objeto que representa los datos de ventas de Hola de terminal de hello POS), que va a usar hello [ DataContractSerializer](https://msdn.microsoft.com/library/system.runtime.serialization.datacontractserializer.aspx) objeto de hello tooserialize.</span><span class="sxs-lookup"><span data-stu-id="a9919-164">An application can set hello body by passing in any serializable object (hello following example passes in a **SalesData** object that represents hello sales data from hello POS terminal), which will use hello [DataContractSerializer](https://msdn.microsoft.com/library/system.runtime.serialization.datacontractserializer.aspx) tooserialize hello object.</span></span> <span data-ttu-id="a9919-165">También se puede proporcionar un objeto [Stream](https://msdn.microsoft.com/library/system.io.stream.aspx).</span><span class="sxs-lookup"><span data-stu-id="a9919-165">Alternatively, a [Stream](https://msdn.microsoft.com/library/system.io.stream.aspx) object can be provided.</span></span>

<span data-ttu-id="a9919-166">Hola tooa de mensajes de toosend de manera más fácil dada cola, en nuestro caso hello **DataCollectionQueue**, es toouse [CreateMessageSender](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageSender_System_String_) toocreate una [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) objeto directamente desde hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) instancia.</span><span class="sxs-lookup"><span data-stu-id="a9919-166">hello easiest way toosend messages tooa given queue, in our case hello **DataCollectionQueue**, is toouse [CreateMessageSender](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageSender_System_String_) toocreate a [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) object directly from hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) instance.</span></span>

```csharp
MessageSender sender = factory.CreateMessageSender("DataCollectionQueue");
sender.Send(bm);
```

### <a name="receiving-messages-from-hello-queue"></a><span data-ttu-id="a9919-167">Recibir mensajes de Hola cola</span><span class="sxs-lookup"><span data-stu-id="a9919-167">Receiving messages from hello queue</span></span>
<span data-ttu-id="a9919-168">tooreceive mensajes de cola de hello, puede usar un [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) objeto que cree directamente desde hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) con [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_).</span><span class="sxs-lookup"><span data-stu-id="a9919-168">tooreceive messages from hello queue, you can use a [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) object which you create directly from hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) using [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_).</span></span> <span data-ttu-id="a9919-169">Los receptores de mensajes pueden funcionar en dos modos distintos: **ReceiveAndDelete** y **PeekLock**.</span><span class="sxs-lookup"><span data-stu-id="a9919-169">Message receivers can work in two different modes: **ReceiveAndDelete** and **PeekLock**.</span></span> <span data-ttu-id="a9919-170">Hola [ReceiveMode](/dotnet/api/microsoft.servicebus.messaging.receivemode) se establece cuando se crea el receptor del mensaje de Hola, como un parámetro toohello [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory?redirectedfrom=MSDN#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_Microsoft_ServiceBus_Messaging_ReceiveMode_) llamar.</span><span class="sxs-lookup"><span data-stu-id="a9919-170">hello [ReceiveMode](/dotnet/api/microsoft.servicebus.messaging.receivemode) is set when hello message receiver is created, as a parameter toohello [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory?redirectedfrom=MSDN#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_Microsoft_ServiceBus_Messaging_ReceiveMode_) call.</span></span>

<span data-ttu-id="a9919-171">Cuando se usa hello **ReceiveAndDelete** Hola de modo de recepción es una operación de captura único; es decir, al Bus de servicio recibe una solicitud de hello, marca Hola mensaje como consumido y lo devuelve toohello aplicación.</span><span class="sxs-lookup"><span data-stu-id="a9919-171">When using hello **ReceiveAndDelete** mode, hello receive is a single-shot operation; that is, when Service Bus receives hello request, it marks hello message as being consumed and returns it toohello application.</span></span> <span data-ttu-id="a9919-172">**ReceiveAndDelete** modo es el modelo más sencillo de Hola y funciona mejor para escenarios en qué Hola aplicación puede tolerar no procesar un mensaje si toooccur de fuera de un error.</span><span class="sxs-lookup"><span data-stu-id="a9919-172">**ReceiveAndDelete** mode is hello simplest model and works best for scenarios in which hello application can tolerate not processing a message if a failure were toooccur.</span></span> <span data-ttu-id="a9919-173">toounderstand esto, considere un escenario en los problemas del consumidor Hola Hola recibir la solicitud y, a continuación, se bloquea antes de procesarlo.</span><span class="sxs-lookup"><span data-stu-id="a9919-173">toounderstand this, consider a scenario in which hello consumer issues hello receive request and then crashes before processing it.</span></span> <span data-ttu-id="a9919-174">Puesto que el Bus de servicio marcado como mensaje de Hola como consumido, cuando reinicios de la aplicación hello y consumir mensajes de nuevo, se inicia habrá perdido mensaje de Hola que se consumió antes bloqueo Hola.</span><span class="sxs-lookup"><span data-stu-id="a9919-174">Since Service Bus marked hello message as being consumed, when hello application restarts and starts consuming messages again, it will have missed hello message that was consumed before hello crash.</span></span>

<span data-ttu-id="a9919-175">En **PeekLock** Hola de modo de recepción se convierte en una operación de dos fases, lo que hace posible toosupport aplicaciones que no pueden tolerar mensajes perdidos.</span><span class="sxs-lookup"><span data-stu-id="a9919-175">In **PeekLock** mode, hello receive becomes a two-stage operation, which makes it possible toosupport applications that cannot tolerate missing messages.</span></span> <span data-ttu-id="a9919-176">Al Bus de servicio recibe una solicitud de hello, lo busca Hola siguiente mensaje toobe consumido, lo bloquea tooprevent otros consumidores de recibirlo y, a continuación, lo devuelve toohello aplicación.</span><span class="sxs-lookup"><span data-stu-id="a9919-176">When Service Bus receives hello request, it finds hello next message toobe consumed, locks it tooprevent other consumers receiving it, and then returns it toohello application.</span></span> <span data-ttu-id="a9919-177">Después de aplicación hello finaliza el procesamiento de mensajes de bienvenida (o lo almacena de forma confiable para el procesamiento futuro), completa Hola segunda fase del programa Hola a recibir el proceso mediante una llamada a [completar](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) en mensajes de bienvenida recibido.</span><span class="sxs-lookup"><span data-stu-id="a9919-177">After hello application finishes processing hello message (or stores it reliably for future processing), it completes hello second stage of hello receive process by calling [Complete](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) on hello received message.</span></span> <span data-ttu-id="a9919-178">Al Bus de servicio ve hello [completar](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) llamada, marca Hola mensaje como consumido.</span><span class="sxs-lookup"><span data-stu-id="a9919-178">When Service Bus sees hello [Complete](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) call, it marks hello message as being consumed.</span></span>

<span data-ttu-id="a9919-179">Hay otros dos resultados posibles.</span><span class="sxs-lookup"><span data-stu-id="a9919-179">Two other outcomes are possible.</span></span> <span data-ttu-id="a9919-180">En primer lugar, si no puede aplicación hello tooprocess Hola mensaje por alguna razón, puede llamar a [abandonar](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Abandon) en el mensaje de bienvenida recibido (en lugar de [completar](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete)).</span><span class="sxs-lookup"><span data-stu-id="a9919-180">First, if hello application is unable tooprocess hello message for some reason, it can call [Abandon](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Abandon) on hello received message (instead of [Complete](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete)).</span></span> <span data-ttu-id="a9919-181">Esto hace que el mensaje de bienvenida de Bus de servicio toounlock y hacerla disponible toobe recibido de nuevo, ya sea mediante Hola mismo consumidor o por otro consumidor completando.</span><span class="sxs-lookup"><span data-stu-id="a9919-181">This causes Service Bus toounlock hello message and make it available toobe received again, either by hello same consumer or by another completing consumer.</span></span> <span data-ttu-id="a9919-182">En segundo lugar, hay un tiempo de espera asociado con bloqueo de Hola y mensaje de Hola y configurarlo toobe disponible como si la aplicación hello no puede procesar el mensaje de bienvenida antes de tiempo de espera de bloqueo de hello expira (por ejemplo, si se bloquea aplicación hello), a continuación, desbloqueará Bus de servicio recibido nuevo (básicamente realizar un [abandonar](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Abandon) operación de forma predeterminada).</span><span class="sxs-lookup"><span data-stu-id="a9919-182">Second, there is a time-out associated with hello lock and if hello application cannot process hello message before hello lock time-out expires (for example, if hello application crashes), then Service Bus will unlock hello message and make it available toobe received again (essentially performing an [Abandon](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Abandon) operation by default).</span></span>

<span data-ttu-id="a9919-183">Tenga en cuenta que si hello aplicación se bloquea después de procesar mensajes de bienvenida, pero antes de hello [completar](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) se emitió la solicitud, mensaje de saludo será aplicación toohello entregados de nuevo cuando se reinicia.</span><span class="sxs-lookup"><span data-stu-id="a9919-183">Note that if hello application crashes after it processes hello message but before hello [Complete](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) request was issued, hello message will be redelivered toohello application when it restarts.</span></span> <span data-ttu-id="a9919-184">Esto se suele denominar * al menos una vez * de procesamiento.</span><span class="sxs-lookup"><span data-stu-id="a9919-184">This is often termed *At Least Once * processing.</span></span> <span data-ttu-id="a9919-185">Esto significa que cada mensaje se procesará al menos una vez, pero en cierto Hola de situaciones puede volverse a entregar el mismo mensaje.</span><span class="sxs-lookup"><span data-stu-id="a9919-185">This means that each message will be processed at least once but in certain situations hello same message may be redelivered.</span></span> <span data-ttu-id="a9919-186">Si el escenario de hello no puede tolerar el procesamiento duplicado, se requiere ninguna lógica adicional duplicados de toodetect aplicación Hola.</span><span class="sxs-lookup"><span data-stu-id="a9919-186">If hello scenario cannot tolerate duplicate processing, then additional logic is required in hello application toodetect duplicates.</span></span> <span data-ttu-id="a9919-187">Esto se puede conseguir basándose en hello [MessageId](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId) propiedad de mensaje de bienvenida.</span><span class="sxs-lookup"><span data-stu-id="a9919-187">This can be achieved based on hello [MessageId](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId) property of hello message.</span></span> <span data-ttu-id="a9919-188">valor de Hola de esta propiedad permanece constante entre intentos de entrega.</span><span class="sxs-lookup"><span data-stu-id="a9919-188">hello value of this property remains constant across delivery attempts.</span></span> <span data-ttu-id="a9919-189">Esto se conoce como procesamiento *Una sola vez*.</span><span class="sxs-lookup"><span data-stu-id="a9919-189">This is termed *Exactly Once* processing.</span></span>

<span data-ttu-id="a9919-190">recibe Hello código que se muestra aquí y procesa un mensaje mediante hello **PeekLock** modo, que es el valor predeterminado de Hola si no hay ningún [ReceiveMode](/dotnet/api/microsoft.servicebus.messaging.receivemode) valor se proporciona explícitamente.</span><span class="sxs-lookup"><span data-stu-id="a9919-190">hello code that is shown here receives and processes a message using hello **PeekLock** mode, which is hello default if no [ReceiveMode](/dotnet/api/microsoft.servicebus.messaging.receivemode) value is explicitly provided.</span></span>

```csharp
MessageReceiver receiver = factory.CreateMessageReceiver("DataCollectionQueue");
BrokeredMessage receivedMessage = receiver.Receive();
try
{
    ProcessMessage(receivedMessage);
    receivedMessage.Complete();
}
catch (Exception e)
{
    receivedMessage.Abandon();
}
```

### <a name="use-hello-queue-client"></a><span data-ttu-id="a9919-191">Usar el cliente de cola de Hola</span><span class="sxs-lookup"><span data-stu-id="a9919-191">Use hello queue client</span></span>
<span data-ttu-id="a9919-192">Hola ejemplos anteriores de esta sección crean [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) y [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) objetos directamente desde hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) toosend y recibir mensajes desde la cola de hello, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="a9919-192">hello examples earlier in this section created [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) and [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) objects directly from hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) toosend and receive messages from hello queue, respectively.</span></span> <span data-ttu-id="a9919-193">Un enfoque alternativo es toouse una [QueueClient](/dotnet/api/microsoft.servicebus.messaging.queueclient) objeto, que admite enviar y recibe las operaciones de adición toomore características avanzadas, como las sesiones.</span><span class="sxs-lookup"><span data-stu-id="a9919-193">An alternative approach is toouse a [QueueClient](/dotnet/api/microsoft.servicebus.messaging.queueclient) object, which supports both send and receive operations in addition toomore advanced features, such as sessions.</span></span>

```csharp
QueueClient queueClient = factory.CreateQueueClient("DataCollectionQueue");
queueClient.Send(bm);

BrokeredMessage message = queueClient.Receive();

try
{
    ProcessMessage(message);
    message.Complete();
}
catch (Exception e)
{
    message.Abandon();
} 
```

## <a name="next-steps"></a><span data-ttu-id="a9919-194">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="a9919-194">Next steps</span></span>
<span data-ttu-id="a9919-195">Ahora que ha aprendido conceptos básicos de Hola de colas, vea [crear aplicaciones que usan los temas de Bus de servicio y suscripciones](service-bus-create-topics-subscriptions.md) toocontinue esta discusión con capacidades de publicación/suscripción de Hola de temas de Bus de servicio y suscripciones.</span><span class="sxs-lookup"><span data-stu-id="a9919-195">Now that you've learned hello basics of queues, see [Create applications that use Service Bus topics and subscriptions](service-bus-create-topics-subscriptions.md) toocontinue this discussion using hello publish/subscribe capabilities of Service Bus topics and subscriptions.</span></span>


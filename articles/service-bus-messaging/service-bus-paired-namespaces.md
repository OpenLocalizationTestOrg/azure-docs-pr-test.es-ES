---
title: Espacios de nombres emparejados de Azure Service Bus | Microsoft Docs
description: "Detalles de la implementación y costos de los espacios de nombres emparejados"
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: 2440c8d3-ed2e-47e0-93cf-ab7fbb855d2e
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/25/2017
ms.author: sethm
ms.openlocfilehash: a200ea7937b9f5296c743928a9408897adfba428
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="paired-namespace-implementation-details-and-cost-implications"></a><span data-ttu-id="e82fa-103">Detalles de implementación y costos asociados de los espacios de nombres emparejados</span><span class="sxs-lookup"><span data-stu-id="e82fa-103">Paired namespace implementation details and cost implications</span></span>
<span data-ttu-id="e82fa-104">El método [PairNamespaceAsync][PairNamespaceAsync], que usa una instancia de [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions], realiza tareas visibles en su nombre.</span><span class="sxs-lookup"><span data-stu-id="e82fa-104">The [PairNamespaceAsync][PairNamespaceAsync] method, using a [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] instance, performs visible tasks on your behalf.</span></span> <span data-ttu-id="e82fa-105">Dado que el uso de esta característica tiene ciertos costes asociados, resulta útil conocer dichas tareas para que su comportamiento no le pille desprevenido.</span><span class="sxs-lookup"><span data-stu-id="e82fa-105">Because there are cost considerations when using the feature, it is useful to understand those tasks so that you expect the behavior when it happens.</span></span> <span data-ttu-id="e82fa-106">La API interactúa con el siguiente comportamiento automático en su nombre:</span><span class="sxs-lookup"><span data-stu-id="e82fa-106">The API engages the following automatic behavior on your behalf:</span></span>

* <span data-ttu-id="e82fa-107">Creación de colas de trabajos pendientes.</span><span class="sxs-lookup"><span data-stu-id="e82fa-107">Creation of backlog queues.</span></span>
* <span data-ttu-id="e82fa-108">Creación de un objeto [MessageSender][MessageSender] que se comunique con colas o temas.</span><span class="sxs-lookup"><span data-stu-id="e82fa-108">Creation of a [MessageSender][MessageSender] object that talks to queues or topics.</span></span>
* <span data-ttu-id="e82fa-109">Cuando una entidad de mensajería deja de estar disponible, envía mensajes Ping a la entidad para intentar detectar cuándo vuelve a estar disponible dicha entidad.</span><span class="sxs-lookup"><span data-stu-id="e82fa-109">When a messaging entity becomes unavailable, sends ping messages to the entity in an attempt to detect when that entity becomes available again.</span></span>
* <span data-ttu-id="e82fa-110">Opcionalmente, crea un conjunto de "suministros de mensajes" que mueven los mensajes de las colas de trabajos pendientes a las colas principales.</span><span class="sxs-lookup"><span data-stu-id="e82fa-110">Optionally creates of a set of “message pumps” that move messages from the backlog queues to the primary queues.</span></span>
* <span data-ttu-id="e82fa-111">Coordina el cierre o error de las instancias de [MessagingFactory][MessagingFactory] principal y secundaria.</span><span class="sxs-lookup"><span data-stu-id="e82fa-111">Coordinates closing/faulting of the primary and secondary [MessagingFactory][MessagingFactory] instances.</span></span>

<span data-ttu-id="e82fa-112">A un alto nivel, la característica funciona del siguiente modo: cuando la entidad principal es correcta, se producen cambios de comportamiento.</span><span class="sxs-lookup"><span data-stu-id="e82fa-112">At a high level, the feature works as follows: when the primary entity is healthy, no behavior changes occur.</span></span> <span data-ttu-id="e82fa-113">Si transcurre la duración de [FailoverInterval][FailoverInterval] y la entidad principal no ve envíos correctos después de unas excepciones [MessagingException][MessagingException] o [TimeoutException no transitorias][TimeoutException], se produce el siguiente comportamiento:</span><span class="sxs-lookup"><span data-stu-id="e82fa-113">When the [FailoverInterval][FailoverInterval] duration elapses, and the primary entity sees no successful sends after a non-transient [MessagingException][MessagingException] or a [TimeoutException][TimeoutException], the following behavior occurs:</span></span>

1. <span data-ttu-id="e82fa-114">Las operaciones de envío a la entidad principal están deshabilitadas y el sistema hace ping a la entidad principal hasta que los pings se puedan entregar correctamente.</span><span class="sxs-lookup"><span data-stu-id="e82fa-114">Send operations to the primary entity are disabled and the system pings the primary entity until pings can be successfully delivered.</span></span>
2. <span data-ttu-id="e82fa-115">Se selecciona una cola de trabajos pendientes aleatoria.</span><span class="sxs-lookup"><span data-stu-id="e82fa-115">A random backlog queue is selected.</span></span>
3. <span data-ttu-id="e82fa-116">Los objetos [BrokeredMessage][BrokeredMessage] se enrutan a la cola de trabajos pendientes elegida.</span><span class="sxs-lookup"><span data-stu-id="e82fa-116">[BrokeredMessage][BrokeredMessage] objects are routed to the chosen backlog queue.</span></span>
4. <span data-ttu-id="e82fa-117">Si se produce un error en una operación de envío a la cola de trabajos pendientes elegidas, dicha cola se extrae de la rotación y se selecciona una nueva cola.</span><span class="sxs-lookup"><span data-stu-id="e82fa-117">If a send operation to the chosen backlog queue fails, that queue is pulled from the rotation and a new queue is selected.</span></span> <span data-ttu-id="e82fa-118">Todos los remitentes de la instancia de [MessagingFactory][MessagingFactory] reciben información del error.</span><span class="sxs-lookup"><span data-stu-id="e82fa-118">All senders on the [MessagingFactory][MessagingFactory] instance learn of the failure.</span></span>

<span data-ttu-id="e82fa-119">Las ilustraciones siguientes muestran la secuencia.</span><span class="sxs-lookup"><span data-stu-id="e82fa-119">The following figures depict the sequence.</span></span> <span data-ttu-id="e82fa-120">En primer lugar, el remitente envía los mensajes.</span><span class="sxs-lookup"><span data-stu-id="e82fa-120">First, the sender sends messages.</span></span>

![Espacios de nombres emparejados][0]

<span data-ttu-id="e82fa-122">Si se produce un error en el envío a la cola principal, el remitente comienza a enviar los mensajes a una cola de trabajos pendientes elegida aleatoriamente.</span><span class="sxs-lookup"><span data-stu-id="e82fa-122">Upon failure to send to the primary queue, the sender begins sending messages to a randomly chosen backlog queue.</span></span> <span data-ttu-id="e82fa-123">Simultáneamente, se inicia una tarea de ping.</span><span class="sxs-lookup"><span data-stu-id="e82fa-123">Simultaneously, it starts a ping task.</span></span>

![Espacios de nombres emparejados][1]

<span data-ttu-id="e82fa-125">En este momento, los mensajes siguen en la cola secundaria y no se han entregado a la cola principal.</span><span class="sxs-lookup"><span data-stu-id="e82fa-125">At this point the messages are still in the secondary queue and have not been delivered to the primary queue.</span></span> <span data-ttu-id="e82fa-126">Una vez que la cola principal es correcta de nuevo, al menos un proceso debe ejecutar el sifón.</span><span class="sxs-lookup"><span data-stu-id="e82fa-126">Once the primary queue is healthy again, at least one process should be running the syphon.</span></span> <span data-ttu-id="e82fa-127">El sifón entrega los mensajes de las distintas colas de trabajos pendientes a las entidades de destino apropiadas (colas y temas).</span><span class="sxs-lookup"><span data-stu-id="e82fa-127">The syphon delivers the messages from all the various backlog queues to the proper destination entities (queues and topics).</span></span>

![Espacios de nombres emparejados][2]

<span data-ttu-id="e82fa-129">En el resto de este tema se tratan los detalles concretos del funcionamiento de estas partes.</span><span class="sxs-lookup"><span data-stu-id="e82fa-129">The remainder of this topic discusses the specific details of how these pieces work.</span></span>

## <a name="creation-of-backlog-queues"></a><span data-ttu-id="e82fa-130">Creación de colas de trabajos pendientes</span><span class="sxs-lookup"><span data-stu-id="e82fa-130">Creation of backlog queues</span></span>
<span data-ttu-id="e82fa-131">El objeto [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] pasado al método [PairNamespaceAsync][PairNamespaceAsync] indica el número de colas de trabajos pendientes que desea usar.</span><span class="sxs-lookup"><span data-stu-id="e82fa-131">The [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] object passed to the [PairNamespaceAsync][PairNamespaceAsync] method indicates the number of backlog queues you want to use.</span></span> <span data-ttu-id="e82fa-132">A continuación, se crean las colas de trabajos pendientes con las siguientes propiedades definidas explícitamente (en los restantes valores se seleccionan los valores predeterminados de [QueueDescription][QueueDescription]):</span><span class="sxs-lookup"><span data-stu-id="e82fa-132">Each backlog queue is then created with the following properties explicitly set (all other values are set to the [QueueDescription][QueueDescription] defaults):</span></span>

| <span data-ttu-id="e82fa-133">Ruta de acceso</span><span class="sxs-lookup"><span data-stu-id="e82fa-133">Path</span></span> | <span data-ttu-id="e82fa-134">[espacio de nombres principal] / x-servicebus-transfer / [index] donde [index] es un valor de [0, BacklogQueueCount)</span><span class="sxs-lookup"><span data-stu-id="e82fa-134">[primary namespace]/x-servicebus-transfer/[index] where [index] is a value in [0, BacklogQueueCount)</span></span> |
| --- | --- |
| <span data-ttu-id="e82fa-135">MaxSizeInMegabytes</span><span class="sxs-lookup"><span data-stu-id="e82fa-135">MaxSizeInMegabytes</span></span> |<span data-ttu-id="e82fa-136">5120</span><span class="sxs-lookup"><span data-stu-id="e82fa-136">5120</span></span> |
| <span data-ttu-id="e82fa-137">MaxDeliveryCount</span><span class="sxs-lookup"><span data-stu-id="e82fa-137">MaxDeliveryCount</span></span> |<span data-ttu-id="e82fa-138">int.MaxValue</span><span class="sxs-lookup"><span data-stu-id="e82fa-138">int.MaxValue</span></span> |
| <span data-ttu-id="e82fa-139">DefaultMessageTimeToLive</span><span class="sxs-lookup"><span data-stu-id="e82fa-139">DefaultMessageTimeToLive</span></span> |<span data-ttu-id="e82fa-140">TimeSpan.MaxValue</span><span class="sxs-lookup"><span data-stu-id="e82fa-140">TimeSpan.MaxValue</span></span> |
| <span data-ttu-id="e82fa-141">AutoDeleteOnIdle</span><span class="sxs-lookup"><span data-stu-id="e82fa-141">AutoDeleteOnIdle</span></span> |<span data-ttu-id="e82fa-142">TimeSpan.MaxValue</span><span class="sxs-lookup"><span data-stu-id="e82fa-142">TimeSpan.MaxValue</span></span> |
| <span data-ttu-id="e82fa-143">LockDuration</span><span class="sxs-lookup"><span data-stu-id="e82fa-143">LockDuration</span></span> |<span data-ttu-id="e82fa-144">1 minuto</span><span class="sxs-lookup"><span data-stu-id="e82fa-144">1 minute</span></span> |
| <span data-ttu-id="e82fa-145">EnableDeadLetteringOnMessageExpiration</span><span class="sxs-lookup"><span data-stu-id="e82fa-145">EnableDeadLetteringOnMessageExpiration</span></span> |<span data-ttu-id="e82fa-146">true</span><span class="sxs-lookup"><span data-stu-id="e82fa-146">true</span></span> |
| <span data-ttu-id="e82fa-147">EnableBatchedOperations</span><span class="sxs-lookup"><span data-stu-id="e82fa-147">EnableBatchedOperations</span></span> |<span data-ttu-id="e82fa-148">true</span><span class="sxs-lookup"><span data-stu-id="e82fa-148">true</span></span> |

<span data-ttu-id="e82fa-149">Por ejemplo, la primera cola de trabajos pendientes creada para el espacio de nombres **contoso** se denomina `contoso/x-servicebus-transfer/0`.</span><span class="sxs-lookup"><span data-stu-id="e82fa-149">For example, the first backlog queue created for namespace **contoso** is named `contoso/x-servicebus-transfer/0`.</span></span>

<span data-ttu-id="e82fa-150">Cuando se crean las colas, el código comprueba primero si existe dicha cola.</span><span class="sxs-lookup"><span data-stu-id="e82fa-150">When creating the queues, the code first checks to see if such a queue exists.</span></span> <span data-ttu-id="e82fa-151">Si la cola no existe, se crea.</span><span class="sxs-lookup"><span data-stu-id="e82fa-151">If the queue does not exist, then the queue is created.</span></span> <span data-ttu-id="e82fa-152">El código no limpiar la colas de trabajos pendientes "adicionales".</span><span class="sxs-lookup"><span data-stu-id="e82fa-152">The code does not clean up "extra" backlog queues.</span></span> <span data-ttu-id="e82fa-153">En concreto, si la aplicación con el espacio de nombres principal **contoso** solicita cinco colas de trabajos pendientes, pero existe una cola con la ruta de acceso `contoso/x-servicebus-transfer/7`, dicha cola de trabajos pendientes adicional está presente pero no se usa.</span><span class="sxs-lookup"><span data-stu-id="e82fa-153">Specifically, if the application with the primary namespace **contoso** requests five backlog queues but a backlog queue with the path `contoso/x-servicebus-transfer/7` exists, that extra backlog queue is still present but is not used.</span></span> <span data-ttu-id="e82fa-154">El sistema permite explícitamente que existan colas de trabajos pendientes adicionales que no se usan.</span><span class="sxs-lookup"><span data-stu-id="e82fa-154">The system explicitly allows extra backlog queues to exist that would not be used.</span></span> <span data-ttu-id="e82fa-155">El propietario del espacio de nombres, es el responsable de limpiar las colas de trabajos pendientes sin usar o no deseadas.</span><span class="sxs-lookup"><span data-stu-id="e82fa-155">As the namespace owner, you are responsible for cleaning up any unused/unwanted backlog queues.</span></span> <span data-ttu-id="e82fa-156">La razón para tomar esta decisión es que el bus de servicio no puede saber qué fines tienen todas las colas del espacio de nombres.</span><span class="sxs-lookup"><span data-stu-id="e82fa-156">The reason for this decision is that Service Bus cannot know what purposes exist for all the queues in your namespace.</span></span> <span data-ttu-id="e82fa-157">Además, si existe una cola con el nombre especificado, pero NO cumple la [QueueDescription][QueueDescription] asumida, las razones son las suyas propias para cambiar el comportamiento predeterminado.</span><span class="sxs-lookup"><span data-stu-id="e82fa-157">Furthermore, if a queue exists with the given name but does not meet the assumed [QueueDescription][QueueDescription], then your reasons are your own for changing the default behavior.</span></span> <span data-ttu-id="e82fa-158">No se garantizan las modificaciones en las colas de registros pendientes realizadas por el código.</span><span class="sxs-lookup"><span data-stu-id="e82fa-158">No guarantees are made for modifications to the backlog queues by your code.</span></span> <span data-ttu-id="e82fa-159">Asegúrese de probar exhaustivamente los cambios.</span><span class="sxs-lookup"><span data-stu-id="e82fa-159">Make sure to test your changes thoroughly.</span></span>

## <a name="custom-messagesender"></a><span data-ttu-id="e82fa-160">MessageSender personalizado</span><span class="sxs-lookup"><span data-stu-id="e82fa-160">Custom MessageSender</span></span>
<span data-ttu-id="e82fa-161">Cuando se envían, todos los mensajes atraviesan un objeto [MessageSender][MessageSender] interno que se comporta con normalidad cuando todo funciona y se redirigen a las colas de trabajos pendiente cuando algo "deja de funcionar".</span><span class="sxs-lookup"><span data-stu-id="e82fa-161">When sending, all messages go through an internal [MessageSender][MessageSender] object that behaves normally when everything works, and redirects to the backlog queues when things "break."</span></span> <span data-ttu-id="e82fa-162">Al recibir un error no transitorio, se inicia un temporizador.</span><span class="sxs-lookup"><span data-stu-id="e82fa-162">Upon receiving a non-transient failure, a timer starts.</span></span> <span data-ttu-id="e82fa-163">Después de un período [TimeSpan][TimeSpan] que consta del valor de la propiedad [FailoverInterval][FailoverInterval] durante el que no se envían mensajes correctos, se activa la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="e82fa-163">After a [TimeSpan][TimeSpan] period consisting of the [FailoverInterval][FailoverInterval] property value during which no successful messages are sent, the failover is engaged.</span></span> <span data-ttu-id="e82fa-164">En este punto, esto es lo que ocurre en cada entidad:</span><span class="sxs-lookup"><span data-stu-id="e82fa-164">At this point, the following things happen for each entity:</span></span>

* <span data-ttu-id="e82fa-165">Se ejecuta una tarea de ping cada [PingPrimaryInterval][PingPrimaryInterval] para comprobar si la entidad está disponible.</span><span class="sxs-lookup"><span data-stu-id="e82fa-165">A ping task executes every [PingPrimaryInterval][PingPrimaryInterval] to check if the entity is available.</span></span> <span data-ttu-id="e82fa-166">Una vez que esta tarea se realiza correctamente, todo el código de cliente que usa la entidad inmediatamente comienza a enviar mensajes nuevos al espacio de nombres principal.</span><span class="sxs-lookup"><span data-stu-id="e82fa-166">Once this task succeeds, all client code that uses the entity immediately starts sending new messages to the primary namespace.</span></span>
* <span data-ttu-id="e82fa-167">Las solicitudes de envío a la misma entidad que se realicen en el futuro desde otros remitentes provocarán que el [BrokeredMessage][BrokeredMessage] enviado se modifique para permanecer en la cola de trabajos pendientes.</span><span class="sxs-lookup"><span data-stu-id="e82fa-167">Future requests to send to that same entity from any other senders will result in the [BrokeredMessage][BrokeredMessage] being sent to be modified to sit in the backlog queue.</span></span> <span data-ttu-id="e82fa-168">La modificación elimina algunas de las propiedades del objeto [BrokeredMessage][BrokeredMessage] y las almacena en otro lugar.</span><span class="sxs-lookup"><span data-stu-id="e82fa-168">The modification removes some properties from the [BrokeredMessage][BrokeredMessage] object and stores them elsewhere.</span></span> <span data-ttu-id="e82fa-169">Las siguientes propiedades se borran y se agregan con un nuevo alias, lo que permite que el bus de servicio y el SDK procesen los mensajes de manera uniforme:</span><span class="sxs-lookup"><span data-stu-id="e82fa-169">The following properties are cleared and added under a new alias, allowing Service Bus and the SDK to process messages uniformly:</span></span>

| <span data-ttu-id="e82fa-170">Nombre de propiedad anterior</span><span class="sxs-lookup"><span data-stu-id="e82fa-170">Old Property Name</span></span> | <span data-ttu-id="e82fa-171">Nombre de propiedad nuevo</span><span class="sxs-lookup"><span data-stu-id="e82fa-171">New Property Name</span></span> |
| --- | --- |
| <span data-ttu-id="e82fa-172">SessionId</span><span class="sxs-lookup"><span data-stu-id="e82fa-172">SessionId</span></span> |<span data-ttu-id="e82fa-173">x-ms-sessionid</span><span class="sxs-lookup"><span data-stu-id="e82fa-173">x-ms-sessionid</span></span> |
| <span data-ttu-id="e82fa-174">TimeToLive</span><span class="sxs-lookup"><span data-stu-id="e82fa-174">TimeToLive</span></span> |<span data-ttu-id="e82fa-175">x-ms-timetolive</span><span class="sxs-lookup"><span data-stu-id="e82fa-175">x-ms-timetolive</span></span> |
| <span data-ttu-id="e82fa-176">ScheduledEnqueueTimeUtc</span><span class="sxs-lookup"><span data-stu-id="e82fa-176">ScheduledEnqueueTimeUtc</span></span> |<span data-ttu-id="e82fa-177">x-ms-path</span><span class="sxs-lookup"><span data-stu-id="e82fa-177">x-ms-path</span></span> |

<span data-ttu-id="e82fa-178">La ruta de acceso de destino original se almacena también en el mensaje como una propiedad denominada x-ms-path.</span><span class="sxs-lookup"><span data-stu-id="e82fa-178">The original destination path is also stored within the message as a property named x-ms-path.</span></span> <span data-ttu-id="e82fa-179">Este diseño permite que coexistan mensajes de varias entidades en una única cola de trabajos pendientes.</span><span class="sxs-lookup"><span data-stu-id="e82fa-179">This design allows messages for many entities to coexist in a single backlog queue.</span></span> <span data-ttu-id="e82fa-180">El sifón vuelve a convertir las propiedades.</span><span class="sxs-lookup"><span data-stu-id="e82fa-180">The properties are translated back by the syphon.</span></span>

<span data-ttu-id="e82fa-181">El objeto [MessageSender][MessageSender] personalizado puede encontrar problemas cuando los mensajes se acerquen al límite de 256 KB y se active la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="e82fa-181">The custom [MessageSender][MessageSender] object can encounter issues when messages approach the 256-KB limit and failover is engaged.</span></span> <span data-ttu-id="e82fa-182">El objeto [MessageSender][MessageSender] personalizado almacena los mensajes de todas las colas y temas juntos en las colas de trabajos pendientes.</span><span class="sxs-lookup"><span data-stu-id="e82fa-182">The custom [MessageSender][MessageSender] object stores messages for all queues and topics together in the backlog queues.</span></span> <span data-ttu-id="e82fa-183">Este objeto mezcla los mensajes de muchas entidades principales en las colas de trabajos pendientes.</span><span class="sxs-lookup"><span data-stu-id="e82fa-183">This object mixes messages from many primaries together within the backlog queues.</span></span> <span data-ttu-id="e82fa-184">Para controlar el equilibrio de carga entre muchos clientes que no se conocen entre sí, el SDK elige aleatoriamente una cola de trabajos pendientes para cada [QueueClient][QueueClient] o [TopicClient que se crea en el código][TopicClient].</span><span class="sxs-lookup"><span data-stu-id="e82fa-184">To handle load balancing among many clients that do not know each other, the SDK randomly picks one backlog queue for each [QueueClient][QueueClient] or [TopicClient][TopicClient] you create in code.</span></span>

## <a name="pings"></a><span data-ttu-id="e82fa-185">Pings</span><span class="sxs-lookup"><span data-stu-id="e82fa-185">Pings</span></span>
<span data-ttu-id="e82fa-186">Un mensaje Ping es un [BrokeredMessage][BrokeredMessage] vacío con su propiedad [ContentType][ContentType] establecida en application/vnd.ms-servicebus-ping y un valor de [TimeToLive][TimeToLive] de 1 segundo.</span><span class="sxs-lookup"><span data-stu-id="e82fa-186">A ping message is an empty [BrokeredMessage][BrokeredMessage] with its [ContentType][ContentType] property set to application/vnd.ms-servicebus-ping and a [TimeToLive][TimeToLive] value of 1 second.</span></span> <span data-ttu-id="e82fa-187">Este ping tiene una característica especial en Service Bus: el servidor nunca entrega un ping cuando algún llamador solicita un [BrokeredMessage][BrokeredMessage].</span><span class="sxs-lookup"><span data-stu-id="e82fa-187">This ping has one special characteristic in Service Bus: the server never delivers a ping when any caller requests a [BrokeredMessage][BrokeredMessage].</span></span> <span data-ttu-id="e82fa-188">Por lo tanto, nunca tendrá que aprender a recibir e ignorar estos mensajes.</span><span class="sxs-lookup"><span data-stu-id="e82fa-188">Thus, you never have to learn how to receive and ignore these messages.</span></span> <span data-ttu-id="e82fa-189">Se hará ping a todas las entidades (cola o tema únicos) por instancia de [MessagingFactory][MessagingFactory] por cliente cuando se considere que no están disponibles.</span><span class="sxs-lookup"><span data-stu-id="e82fa-189">Each entity (unique queue or topic) per [MessagingFactory][MessagingFactory] instance per client will be pinged when they are considered to be unavailable.</span></span> <span data-ttu-id="e82fa-190">De forma predeterminada, esto ocurre una vez por minuto.</span><span class="sxs-lookup"><span data-stu-id="e82fa-190">By default, this happens once per minute.</span></span> <span data-ttu-id="e82fa-191">Se considera que los mensajes Ping son mensajes normales del bus de servicio y pueden dar lugar a gastos de ancho de banda y mensajes.</span><span class="sxs-lookup"><span data-stu-id="e82fa-191">Ping messages are considered to be regular Service Bus messages, and can result in charges for bandwidth and messages.</span></span> <span data-ttu-id="e82fa-192">En cuanto los clientes detectan que el sistema está disponible, los mensajes se detienen.</span><span class="sxs-lookup"><span data-stu-id="e82fa-192">As soon as the clients detect that the system is available, the messages stop.</span></span>

## <a name="the-syphon"></a><span data-ttu-id="e82fa-193">El sifón</span><span class="sxs-lookup"><span data-stu-id="e82fa-193">The syphon</span></span>
<span data-ttu-id="e82fa-194">Al menos uno de los programas ejecutables de la aplicación debe ejecutar activamente el sifón.</span><span class="sxs-lookup"><span data-stu-id="e82fa-194">At least one executable program in the application should be actively running the syphon.</span></span> <span data-ttu-id="e82fa-195">El sifón realiza una recepción de sondeo largo que dura 15 minutos.</span><span class="sxs-lookup"><span data-stu-id="e82fa-195">The syphon performs a long poll receive that lasts 15 minutes.</span></span> <span data-ttu-id="e82fa-196">Si todas las entidades están disponibles y tiene 10 colas de trabajos pendientes, la aplicación que hospeda el sifón llama a la operación de recepción 40 veces por hora, 960 veces al día y 28800 veces en 30 días.</span><span class="sxs-lookup"><span data-stu-id="e82fa-196">When all entities are available and you have 10 backlog queues, the application that hosts the syphon calls the receive operation 40 times per hour, 960 times per day, and 28800 times in 30 days.</span></span> <span data-ttu-id="e82fa-197">Cuando el sifón mueve activamente mensajes desde la cola de trabajos pendientes a la cola principal, cada mensaje experimenta los siguientes cargos (se aplican cargos estándar según el tamaño del mensaje y el ancho de banda en todas las fases):</span><span class="sxs-lookup"><span data-stu-id="e82fa-197">When the syphon is actively moving messages from the backlog to the primary queue, each message experiences the following charges (standard charges for message size and bandwidth apply in all stages):</span></span>

1. <span data-ttu-id="e82fa-198">Enviar a la cola de trabajos pendientes.</span><span class="sxs-lookup"><span data-stu-id="e82fa-198">Send to the backlog.</span></span>
2. <span data-ttu-id="e82fa-199">Recibir de la cola de trabajos pendientes.</span><span class="sxs-lookup"><span data-stu-id="e82fa-199">Receive from the backlog.</span></span>
3. <span data-ttu-id="e82fa-200">Enviar a la cola principal.</span><span class="sxs-lookup"><span data-stu-id="e82fa-200">Send to the primary.</span></span>
4. <span data-ttu-id="e82fa-201">Recibir de la cola principal.</span><span class="sxs-lookup"><span data-stu-id="e82fa-201">Receive from the primary.</span></span>

## <a name="closefault-behavior"></a><span data-ttu-id="e82fa-202">Comportamiento de cierre o error</span><span class="sxs-lookup"><span data-stu-id="e82fa-202">Close/fault behavior</span></span>
<span data-ttu-id="e82fa-203">Dentro de una aplicación que hospeda el sifón, una vez que el elemento principal o secundario [MessagingFactory][MessagingFactory] genera un error o se cierra sin que su partner genere un error o se cierre y el sifón detecta este estado, el sifón actúa.</span><span class="sxs-lookup"><span data-stu-id="e82fa-203">Within an application that hosts the syphon, once the primary or secondary [MessagingFactory][MessagingFactory] faults or is closed without its partner also being faulted/closed and the syphon detects this state, the syphon acts.</span></span> <span data-ttu-id="e82fa-204">Si el otro [MessagingFactory][MessagingFactory] no se cierra en 5 segundos, el sifón generará un error en el [MessagingFactory][MessagingFactory] que aún está abierto.</span><span class="sxs-lookup"><span data-stu-id="e82fa-204">If the other [MessagingFactory][MessagingFactory] is not closed within 5 seconds, the syphon will fault the still open [MessagingFactory][MessagingFactory].</span></span>

## <a name="next-steps"></a><span data-ttu-id="e82fa-205">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="e82fa-205">Next steps</span></span>
<span data-ttu-id="e82fa-206">Para más información sobre la mensajería asincrónica de Service Bus, consulte [Patrones de mensajería asincrónica y alta disponibilidad][Asynchronous messaging patterns and high availability].</span><span class="sxs-lookup"><span data-stu-id="e82fa-206">See [Asynchronous messaging patterns and high availability][Asynchronous messaging patterns and high availability] for a detailed discussion of Service Bus asynchronous messaging.</span></span> 

[PairNamespaceAsync]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_PairNamespaceAsync_Microsoft_ServiceBus_Messaging_PairedNamespaceOptions_
[SendAvailabilityPairedNamespaceOptions]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions
[MessageSender]: /dotnet/api/microsoft.servicebus.messaging.messagesender
[MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[FailoverInterval]: /dotnet/api/microsoft.servicebus.messaging.pairednamespaceoptions#Microsoft_ServiceBus_Messaging_PairedNamespaceOptions_FailoverInterval
[MessagingException]: /dotnet/api/microsoft.servicebus.messaging.messagingexception
[TimeoutException]: https://msdn.microsoft.com/library/azure/system.timeoutexception.aspx
[BrokeredMessage]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage
[QueueDescription]: /dotnet/api/microsoft.servicebus.messaging.queuedescription
[TimeSpan]: https://msdn.microsoft.com/library/azure/system.timespan.aspx
[PingPrimaryInterval]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions#Microsoft_ServiceBus_Messaging_SendAvailabilityPairedNamespaceOptions_PingPrimaryInterval
[QueueClient]: /dotnet/api/microsoft.servicebus.messaging.queueclient
[TopicClient]: /dotnet/api/microsoft.servicebus.messaging.topicclient
[ContentType]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_ContentType
[TimeToLive]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive
[Asynchronous messaging patterns and high availability]: service-bus-async-messaging.md
[0]: ./media/service-bus-paired-namespaces/IC673405.png
[1]: ./media/service-bus-paired-namespaces/IC673406.png
[2]: ./media/service-bus-paired-namespaces/IC673407.png

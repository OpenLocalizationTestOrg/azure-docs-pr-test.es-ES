---
title: "Mensajería asincrónica de Service Bus | Microsoft Docs"
description: "Descripción de la mensajería asincrónica de Azure Service Bus."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: f1435549-e1f2-40cb-a280-64ea07b39fc7
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/19/2017
ms.author: sethm
ms.openlocfilehash: 95d6f295ba145a55fe4ed3fc7c6f627c9d419a3c
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="asynchronous-messaging-patterns-and-high-availability"></a><span data-ttu-id="946cf-103">Patrones de mensajería asincrónica y alta disponibilidad</span><span class="sxs-lookup"><span data-stu-id="946cf-103">Asynchronous messaging patterns and high availability</span></span>

<span data-ttu-id="946cf-104">La mensajería asincrónica se puede implementar de varias maneras.</span><span class="sxs-lookup"><span data-stu-id="946cf-104">Asynchronous messaging can be implemented in a variety of different ways.</span></span> <span data-ttu-id="946cf-105">Con colas, temas y suscripciones, Azure Service Bus admite la asincronía a través de un mecanismo de almacenamiento y reenvío.</span><span class="sxs-lookup"><span data-stu-id="946cf-105">With queues, topics, and subscriptions, Azure Service Bus supports asynchronism via a store and forward mechanism.</span></span> <span data-ttu-id="946cf-106">En un funcionamiento normal (sincrónico), se envían mensajes a colas y temas, y se reciben mensajes de colas y suscripciones.</span><span class="sxs-lookup"><span data-stu-id="946cf-106">In normal (synchronous) operation, you send messages to queues and topics, and receive messages from queues and subscriptions.</span></span> <span data-ttu-id="946cf-107">Las aplicaciones que escriba dependen de que estas entidades estén siempre disponibles.</span><span class="sxs-lookup"><span data-stu-id="946cf-107">Applications you write depend on these entities always being available.</span></span> <span data-ttu-id="946cf-108">Cuando cambia el estado de la entidad, debido a varias circunstancias, necesita una manera de proporcionar una entidad de capacidad reducida que pueda satisfacer la mayoría de las necesidades.</span><span class="sxs-lookup"><span data-stu-id="946cf-108">When the entity health changes, due to a variety of circumstances, you need a way to provide a reduced capability entity that can satisfy most needs.</span></span>

<span data-ttu-id="946cf-109">Las aplicaciones suelen usar patrones de mensajería asincrónica para habilitar varios escenarios de comunicación.</span><span class="sxs-lookup"><span data-stu-id="946cf-109">Applications typically use asynchronous messaging patterns to enable a number of communication scenarios.</span></span> <span data-ttu-id="946cf-110">Puede compilar aplicaciones en las que los clientes puedan enviar mensajes a servicios, incluso cuando el servicio no esté en ejecución.</span><span class="sxs-lookup"><span data-stu-id="946cf-110">You can build applications in which clients can send messages to services, even when the service is not running.</span></span> <span data-ttu-id="946cf-111">En las aplicaciones que sufren ráfagas de comunicaciones, una cola puede ayudar a nivelar la carga, ya que proporciona un lugar para almacenar las comunicaciones en el búfer.</span><span class="sxs-lookup"><span data-stu-id="946cf-111">For applications that experience bursts of communications, a queue can help level the load by providing a place to buffer communications.</span></span> <span data-ttu-id="946cf-112">Por último, puede obtener un equilibrador de carga simple, pero eficaz, para distribuir los mensajes entre varias máquinas.</span><span class="sxs-lookup"><span data-stu-id="946cf-112">Finally, you can get a simple but effective load balancer to distribute messages across multiple machines.</span></span>

<span data-ttu-id="946cf-113">Para mantener la disponibilidad de todas estas entidades, considere las distintas maneras en que estas entidades pueden aparecer no disponibles para un sistema de mensajería duradero.</span><span class="sxs-lookup"><span data-stu-id="946cf-113">In order to maintain availability of any of these entities, consider a number of different ways in which these entities can appear unavailable for a durable messaging system.</span></span> <span data-ttu-id="946cf-114">Por lo general, vemos que la entidad deja de estar disponible para las aplicaciones que escribimos de las siguientes maneras:</span><span class="sxs-lookup"><span data-stu-id="946cf-114">Generally speaking, we see the entity become unavailable to applications we write in the following different ways:</span></span>

* <span data-ttu-id="946cf-115">No es posible enviar mensajes.</span><span class="sxs-lookup"><span data-stu-id="946cf-115">Unable to send messages.</span></span>
* <span data-ttu-id="946cf-116">No es posible recibir mensajes.</span><span class="sxs-lookup"><span data-stu-id="946cf-116">Unable to receive messages.</span></span>
* <span data-ttu-id="946cf-117">No es posible administrar entidades (crear, recuperar, actualizar o eliminar entidades).</span><span class="sxs-lookup"><span data-stu-id="946cf-117">Unable to manage entities (create, retrieve, update, or delete entities).</span></span>
* <span data-ttu-id="946cf-118">No es posible ponerse en contacto con el servicio.</span><span class="sxs-lookup"><span data-stu-id="946cf-118">Unable to contact the service.</span></span>

<span data-ttu-id="946cf-119">Para cada uno de estos errores, existen modos de error diferentes que permiten que las aplicaciones sigan en funcionamiento con cierto nivel de capacidad reducida.</span><span class="sxs-lookup"><span data-stu-id="946cf-119">For each of these failures, different failure modes exist that enable an application to continue to perform work at some level of reduced capability.</span></span> <span data-ttu-id="946cf-120">Por ejemplo, un sistema que puede enviar mensajes, pero no recibirlos, puede recibir pedidos de clientes pero no procesarlos.</span><span class="sxs-lookup"><span data-stu-id="946cf-120">For example, a system that can send messages but not receive them can still receive orders from customers but cannot process those orders.</span></span> <span data-ttu-id="946cf-121">En este tema se tratan los posibles problemas que se pueden producir y cómo se mitigan.</span><span class="sxs-lookup"><span data-stu-id="946cf-121">This topic discusses potential issues that can occur, and how those issues are mitigated.</span></span> <span data-ttu-id="946cf-122">Service Bus ha introducido varias mitigaciones en las que debe participar y en este tema también se describen las reglas que rigen el uso de ellas.</span><span class="sxs-lookup"><span data-stu-id="946cf-122">Service Bus has introduced a number of mitigations which you must opt into, and this topic also discusses the rules governing the use of those opt-in mitigations.</span></span>

## <a name="reliability-in-service-bus"></a><span data-ttu-id="946cf-123">Confiabilidad en Service Bus</span><span class="sxs-lookup"><span data-stu-id="946cf-123">Reliability in Service Bus</span></span>
<span data-ttu-id="946cf-124">Hay varias maneras de tratar los problemas de los mensajes y de las entidades, y hay directrices que rigen el uso adecuado de dichos procedimientos para mitigar problemas.</span><span class="sxs-lookup"><span data-stu-id="946cf-124">There are several ways to handle message and entity issues, and there are guidelines governing the appropriate use of those mitigations.</span></span> <span data-ttu-id="946cf-125">Para comprender las directrices, primero es preciso saber qué es lo que puede generar errores en Service Bus.</span><span class="sxs-lookup"><span data-stu-id="946cf-125">To understand the guidelines, you must first understand what can fail in Service Bus.</span></span> <span data-ttu-id="946cf-126">Dado el diseño de los sistemas de Azure, todos estos problemas tienden a durar poco tiempo.</span><span class="sxs-lookup"><span data-stu-id="946cf-126">Due to the design of Azure systems, all of these issues tend to be short-lived.</span></span> <span data-ttu-id="946cf-127">A alto nivel, las diferentes causas de la no disponibilidad aparecerán como sigue:</span><span class="sxs-lookup"><span data-stu-id="946cf-127">At a high level, the different causes of unavailability appear as follows:</span></span>

* <span data-ttu-id="946cf-128">Limitación desde un sistema externo del que depende Service Bus.</span><span class="sxs-lookup"><span data-stu-id="946cf-128">Throttling from an external system on which Service Bus depends.</span></span> <span data-ttu-id="946cf-129">Se produce una limitación de las interacciones con los recursos de proceso y almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="946cf-129">Throttling occurs from interactions with storage and compute resources.</span></span>
* <span data-ttu-id="946cf-130">Problema en un sistema del que depende Service Bus.</span><span class="sxs-lookup"><span data-stu-id="946cf-130">Issue for a system on which Service Bus depends.</span></span> <span data-ttu-id="946cf-131">Por ejemplo, pueden aparecer problemas en una parte determinada del almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="946cf-131">For example, a given part of storage can encounter issues.</span></span>
* <span data-ttu-id="946cf-132">Error de Service Bus en un subsistema individual.</span><span class="sxs-lookup"><span data-stu-id="946cf-132">Failure of Service Bus on single subsystem.</span></span> <span data-ttu-id="946cf-133">En esta situación, un nodo de proceso puede entrar en un estado incoherente y debe reiniciarse, provocando que todas las entidades a las que sirve equilibren su carga con otros nodos.</span><span class="sxs-lookup"><span data-stu-id="946cf-133">In this situation, a compute node can get into an inconsistent state and must restart itself, causing all entities it serves to load balance to other nodes.</span></span> <span data-ttu-id="946cf-134">A su vez, esto puede provocar que los mensajes se procesen más lentamente durante un breve periodo.</span><span class="sxs-lookup"><span data-stu-id="946cf-134">This in turn can cause a short period of slow message processing.</span></span>
* <span data-ttu-id="946cf-135">Error de Service Bus en un centro de datos de Azure.</span><span class="sxs-lookup"><span data-stu-id="946cf-135">Failure of Service Bus within an Azure datacenter.</span></span> <span data-ttu-id="946cf-136">Se trata de un error grave y es imposible acceder el sistema durante varios minutos, o incluso horas.</span><span class="sxs-lookup"><span data-stu-id="946cf-136">This is a "catastrophic failure" during which the system is unreachable for many minutes or a few hours.</span></span>

> [!NOTE]
> <span data-ttu-id="946cf-137">El término **almacenamiento** puede significar Azure Storage y SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="946cf-137">The term **storage** can mean both Azure Storage and SQL Azure.</span></span>
> 
> 

<span data-ttu-id="946cf-138">Service Bus contiene varios procedimientos para mitigar estos problemas.</span><span class="sxs-lookup"><span data-stu-id="946cf-138">Service Bus contains a number of mitigations for these issues.</span></span> <span data-ttu-id="946cf-139">En las secciones siguientes se tratan todos estos problema y los respectivos procedimientos para mitigarlos.</span><span class="sxs-lookup"><span data-stu-id="946cf-139">The following sections discuss each issue and their respective mitigations.</span></span>

### <a name="throttling"></a><span data-ttu-id="946cf-140">Limitaciones</span><span class="sxs-lookup"><span data-stu-id="946cf-140">Throttling</span></span>
<span data-ttu-id="946cf-141">Con Service Bus, la limitación permite la administración cooperativa de la velocidad de los mensajes.</span><span class="sxs-lookup"><span data-stu-id="946cf-141">With Service Bus, throttling enables cooperative message rate management.</span></span> <span data-ttu-id="946cf-142">Cada nodo individual de Service Bus alberga muchas entidades.</span><span class="sxs-lookup"><span data-stu-id="946cf-142">Each individual Service Bus node houses many entities.</span></span> <span data-ttu-id="946cf-143">Cada una de esas entidades realiza peticiones al sistema en cuanto a CPU, memoria, almacenamiento, etc.</span><span class="sxs-lookup"><span data-stu-id="946cf-143">Each of those entities makes demands on the system in terms of CPU, memory, storage, and other facets.</span></span> <span data-ttu-id="946cf-144">Si cualquiera de estas facetas detecta un uso que supera los umbrales definidos, Service Bus puede denegar una solicitud determinada.</span><span class="sxs-lookup"><span data-stu-id="946cf-144">When any of these facets detects usage that exceeds defined thresholds, Service Bus can deny a given request.</span></span> <span data-ttu-id="946cf-145">El llamador recibe una excepción [ServerBusyException][ServerBusyException] y lo reintenta transcurridos 10 segundos.</span><span class="sxs-lookup"><span data-stu-id="946cf-145">The caller receives a [ServerBusyException][ServerBusyException] and retries after 10 seconds.</span></span>

<span data-ttu-id="946cf-146">Como mitigación, el código debe leer el error y detener todos los reintentos del mensaje durante al menos 10 segundos.</span><span class="sxs-lookup"><span data-stu-id="946cf-146">As a mitigation, the code must read the error and halt any retries of the message for at least 10 seconds.</span></span> <span data-ttu-id="946cf-147">Puesto que el error puede producirse en varias partes de la aplicación de cliente, se espera que cada una de ellas ejecute la lógica de reintento de forma independiente.</span><span class="sxs-lookup"><span data-stu-id="946cf-147">Since the error can happen across pieces of the customer application, it is expected that each piece independently executes the retry logic.</span></span> <span data-ttu-id="946cf-148">El código puede reducir la posibilidad de que la habilitación de particiones en una cola o tema pueda suponer una limitación.</span><span class="sxs-lookup"><span data-stu-id="946cf-148">The code can reduce the probability of being throttled by enabling partitioning on a queue or topic.</span></span>

### <a name="issue-for-an-azure-dependency"></a><span data-ttu-id="946cf-149">Problema en una dependencia de Azure</span><span class="sxs-lookup"><span data-stu-id="946cf-149">Issue for an Azure dependency</span></span>
<span data-ttu-id="946cf-150">Otros componentes de Azure en ocasiones pueden tener problemas de servicio ocasionalmente.</span><span class="sxs-lookup"><span data-stu-id="946cf-150">Other components within Azure can occasionally have service issues.</span></span> <span data-ttu-id="946cf-151">Por ejemplo, cuando se actualiza un sistema que usa Service Bus, dicho sistema puede experimentar temporalmente la reducción de sus funcionalidades.</span><span class="sxs-lookup"><span data-stu-id="946cf-151">For example, when a system that Service Bus uses is being upgraded, that system can temporarily experience reduced capabilities.</span></span> <span data-ttu-id="946cf-152">Para solucionar estos tipos de problemas, Service Bus investiga periódicamente e implementa las mitigaciones.</span><span class="sxs-lookup"><span data-stu-id="946cf-152">To work around these types of issues, Service Bus regularly investigates and implements mitigations.</span></span> <span data-ttu-id="946cf-153">Aparecen los efectos secundarios de estas mitigaciones.</span><span class="sxs-lookup"><span data-stu-id="946cf-153">Side effects of these mitigations do appear.</span></span> <span data-ttu-id="946cf-154">Por ejemplo, para controlar problemas transitorios de almacenamiento, Service Bus implementa un sistema que permite que las operaciones de envío funcionen de forma coherente.</span><span class="sxs-lookup"><span data-stu-id="946cf-154">For example, to handle transient issues with storage, Service Bus implements a system that allows message send operations to work consistently.</span></span> <span data-ttu-id="946cf-155">Dada la propia naturaleza de la mitigación, un mensaje enviado puede tardar hasta 15 minutos en aparecer en la cola o suscripción afectadas, y estar listo para una operación de recepción.</span><span class="sxs-lookup"><span data-stu-id="946cf-155">Due to the nature of the mitigation, a sent message can take up to 15 minutes to appear in the affected queue or subscription and be ready for a receive operation.</span></span> <span data-ttu-id="946cf-156">Por lo general, la mayoría de las entidades no sufrirán este problema.</span><span class="sxs-lookup"><span data-stu-id="946cf-156">Generally speaking, most entities will not experience this issue.</span></span> <span data-ttu-id="946cf-157">Sin embargo, dado el número de entidades de Service Bus en Azure, a veces esta mitigación es necesaria para un pequeño subconjunto de los clientes de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="946cf-157">However, given the number of entities in Service Bus within Azure, this mitigation is sometimes needed for a small subset of Service Bus customers.</span></span>

### <a name="service-bus-failure-on-a-single-subsystem"></a><span data-ttu-id="946cf-158">Error de Service Bus en un subsistema individual</span><span class="sxs-lookup"><span data-stu-id="946cf-158">Service Bus failure on a single subsystem</span></span>
<span data-ttu-id="946cf-159">Con cualquier aplicación, las circunstancias pueden provocar que algún componente interno de Service Bus pueda volverse incoherente.</span><span class="sxs-lookup"><span data-stu-id="946cf-159">With any application, circumstances can cause an internal component of Service Bus to become inconsistent.</span></span> <span data-ttu-id="946cf-160">Cuando Service Bus lo detecta, recopila datos de la aplicación para ayudar a diagnosticar lo que sucedió.</span><span class="sxs-lookup"><span data-stu-id="946cf-160">When Service Bus detects this, it collects data from the application to aid in diagnosing what happened.</span></span> <span data-ttu-id="946cf-161">Una vez que se hayan recopilado los datos, la aplicación se reinicia para intentar que vuelva a un estado coherente.</span><span class="sxs-lookup"><span data-stu-id="946cf-161">Once the data is collected, the application is restarted in an attempt to return it to a consistent state.</span></span> <span data-ttu-id="946cf-162">Este proceso ocurre con bastante rapidez y su resultado es que una entidad parezca que no está disponible durante unos minutos, aunque los tiempos de inactividad son mucho menores.</span><span class="sxs-lookup"><span data-stu-id="946cf-162">This process happens fairly quickly, and results in an entity appearing to be unavailable for up to a few minutes, though typical down times are much shorter.</span></span>

<span data-ttu-id="946cf-163">En estos casos, la aplicación cliente genera una excepción [System.TimeoutException][System.TimeoutException] o [MessagingException][MessagingException].</span><span class="sxs-lookup"><span data-stu-id="946cf-163">In these cases, the client application generates a [System.TimeoutException][System.TimeoutException] or [MessagingException][MessagingException] exception.</span></span> <span data-ttu-id="946cf-164">Service Bus contiene una mitigación para este problema en forma de lógica de reintento de cliente automatizado.</span><span class="sxs-lookup"><span data-stu-id="946cf-164">Service Bus contains a mitigation for this issue in the form of automated client retry logic.</span></span> <span data-ttu-id="946cf-165">Si se agotó el período de reintento y no se entregó el mensaje, puede probar con otras funciones, como los [espacios de nombres emparejados][paired namespaces].</span><span class="sxs-lookup"><span data-stu-id="946cf-165">Once the retry period is exhausted and the message is not delivered, you can explore using other features such as [paired namespaces][paired namespaces].</span></span> <span data-ttu-id="946cf-166">Estos espacios de nombres tienen otros riesgos que se describen en este artículo.</span><span class="sxs-lookup"><span data-stu-id="946cf-166">Paired namespaces have other caveats that are discussed in that article.</span></span>

### <a name="failure-of-service-bus-within-an-azure-datacenter"></a><span data-ttu-id="946cf-167">Error de Service Bus en un centro de datos de Azure</span><span class="sxs-lookup"><span data-stu-id="946cf-167">Failure of Service Bus within an Azure datacenter</span></span>
<span data-ttu-id="946cf-168">El motivo más probable de error en un centro de datos de Azure es un error en la implementación de una actualización de Service Bus o de un sistema dependiente.</span><span class="sxs-lookup"><span data-stu-id="946cf-168">The most probable reason for a failure in an Azure datacenter is a failed upgrade deployment of Service Bus or a dependent system.</span></span> <span data-ttu-id="946cf-169">Al haber madurado la plataforma, la probabilidad de que se produzca este tipo de error se ha reducido.</span><span class="sxs-lookup"><span data-stu-id="946cf-169">As the platform has matured, the likelihood of this type of failure has diminished.</span></span> <span data-ttu-id="946cf-170">También puede producir un error en el centro de datos por otros motivos, entre los que se incluyen:</span><span class="sxs-lookup"><span data-stu-id="946cf-170">A datacenter failure can also happen for reasons that include the following:</span></span>

* <span data-ttu-id="946cf-171">Interrupción del suministro eléctrico (desaparecen la fuente de alimentación y la generación de energía).</span><span class="sxs-lookup"><span data-stu-id="946cf-171">Electrical outage (power supply and generating power disappear).</span></span>
* <span data-ttu-id="946cf-172">Conectividad (interrupción de Internet entre los clientes y Azure).</span><span class="sxs-lookup"><span data-stu-id="946cf-172">Connectivity (internet break between your clients and Azure).</span></span>

<span data-ttu-id="946cf-173">En ambos casos, el problema lo provocó un desastre natural o causado por el hombre.</span><span class="sxs-lookup"><span data-stu-id="946cf-173">In both cases, a natural or man-made disaster caused the issue.</span></span> <span data-ttu-id="946cf-174">Para solucionar este problema y asegurarse de que se pueden enviar mensajes, puede usar [espacios de nombres emparejados[paired namespaces]] para permitir que los mensajes se envíen a una segunda ubicación mientras se repara la ubicación principal.</span><span class="sxs-lookup"><span data-stu-id="946cf-174">To work around this and make sure that you can still send messages, you can use [paired namespaces][paired namespaces] to enable messages to be sent to a second location while the primary location is made healthy again.</span></span> <span data-ttu-id="946cf-175">Para más información, consulte [Procedimientos recomendados para aislar aplicaciones ante desastres e interrupciones de Service Bus][Best practices for insulating applications against Service Bus outages and disasters].</span><span class="sxs-lookup"><span data-stu-id="946cf-175">For more information, see [Best practices for insulating applications against Service Bus outages and disasters][Best practices for insulating applications against Service Bus outages and disasters].</span></span>

## <a name="paired-namespaces"></a><span data-ttu-id="946cf-176">Espacios de nombres emparejados</span><span class="sxs-lookup"><span data-stu-id="946cf-176">Paired namespaces</span></span>
<span data-ttu-id="946cf-177">La característica de [espacios de nombres emparejados][paired namespaces] admite escenarios en los que una entidad o implementación de Service Bus dentro de un centro de datos deja de estar disponible.</span><span class="sxs-lookup"><span data-stu-id="946cf-177">The [paired namespaces][paired namespaces] feature supports scenarios in which a Service Bus entity or deployment within a data center becomes unavailable.</span></span> <span data-ttu-id="946cf-178">Aunque este evento se produce con poca frecuencia, los sistemas distribuidos deben estar preparados para controlar los escenarios más desfavorables.</span><span class="sxs-lookup"><span data-stu-id="946cf-178">While this event occurs infrequently, distributed systems still must be prepared to handle worst case scenarios.</span></span> <span data-ttu-id="946cf-179">Normalmente, este evento se produce porque algún elemento del que depende Service Bus sufre un problema temporal.</span><span class="sxs-lookup"><span data-stu-id="946cf-179">Typically, this event happens because some element on which Service Bus depends is experiencing a short-term issue.</span></span> <span data-ttu-id="946cf-180">Para mantener la disponibilidad de las aplicaciones en caso una interrupción, los usuarios de Service Bus pueden usar dos espacios de nombres independientes, preferiblemente de centros de datos independientes, para hospedar sus entidades de mensajería.</span><span class="sxs-lookup"><span data-stu-id="946cf-180">To maintain application availability during an outage, Service Bus users can use two separate namespaces, preferably in separate data centers, to host their messaging entities.</span></span> <span data-ttu-id="946cf-181">En el resto de la sección se usa la siguiente terminología:</span><span class="sxs-lookup"><span data-stu-id="946cf-181">The remainder of this section uses the following terminology:</span></span>

* <span data-ttu-id="946cf-182">Espacio de nombres principal: el espacio de nombres con el que interactúa la aplicación para enviar y recibir operaciones.</span><span class="sxs-lookup"><span data-stu-id="946cf-182">Primary namespace: The namespace with which your application interacts, for send and receive operations.</span></span>
* <span data-ttu-id="946cf-183">Espacio de nombres secundario: el espacio de nombres que actúa como una copia de seguridad del espacio de nombres principal.</span><span class="sxs-lookup"><span data-stu-id="946cf-183">Secondary namespace: The namespace that acts as a backup to the primary namespace.</span></span> <span data-ttu-id="946cf-184">La lógica de la aplicación no interactúa con este espacio de nombres.</span><span class="sxs-lookup"><span data-stu-id="946cf-184">Application logic does not interact with this namespace.</span></span>
* <span data-ttu-id="946cf-185">Intervalo de conmutación por error: el tiempo durante el que se aceptan errores normales antes de que la aplicación cambie del espacio de nombres principal al espacio de nombres secundario.</span><span class="sxs-lookup"><span data-stu-id="946cf-185">Failover interval: The amount of time to accept normal failures before the application switches from the primary namespace to the secondary namespace.</span></span>

<span data-ttu-id="946cf-186">Los espacios de nombres emparejados admiten la *disponibilidad de envío*.</span><span class="sxs-lookup"><span data-stu-id="946cf-186">Paired namespaces support *send availability*.</span></span> <span data-ttu-id="946cf-187">La disponibilidad de envío se centra en mantener la capacidad para enviar mensajes.</span><span class="sxs-lookup"><span data-stu-id="946cf-187">Send availability preserves the ability to send messages.</span></span> <span data-ttu-id="946cf-188">Para usar la disponibilidad de envío, la aplicación debe cumplir los siguientes requisitos:</span><span class="sxs-lookup"><span data-stu-id="946cf-188">To use send availability, your application must meet the following requirements:</span></span>

1. <span data-ttu-id="946cf-189">Solo se reciben mensajes del espacio de nombres principal.</span><span class="sxs-lookup"><span data-stu-id="946cf-189">Messages are only received from the primary namespace.</span></span>
2. <span data-ttu-id="946cf-190">Los mensajes enviados a una cola o tema determinados pueden llegar desordenados.</span><span class="sxs-lookup"><span data-stu-id="946cf-190">Messages sent to a given queue or topic might arrive out of order.</span></span>
3. <span data-ttu-id="946cf-191">Los mensajes de una sesión pueden llegar desordenados.</span><span class="sxs-lookup"><span data-stu-id="946cf-191">Messages within a session might arrive out of order.</span></span> <span data-ttu-id="946cf-192">Esto no es algo habitual en el funcionamiento normal de las sesiones,</span><span class="sxs-lookup"><span data-stu-id="946cf-192">This is a break from normal functionality of sessions.</span></span> <span data-ttu-id="946cf-193">ya que la aplicación usa las sesiones para agrupar los mensajes de forma lógica.</span><span class="sxs-lookup"><span data-stu-id="946cf-193">This means that your application uses sessions to logically group messages.</span></span>
4. <span data-ttu-id="946cf-194">El estado de sesión solo se mantiene en el espacio de nombres principal.</span><span class="sxs-lookup"><span data-stu-id="946cf-194">Session state is only maintained on the primary namespace.</span></span>
5. <span data-ttu-id="946cf-195">La cola principal puede conectarse y empezar a aceptar mensajes antes de que la cola secundaria le entregue todos los mensajes.</span><span class="sxs-lookup"><span data-stu-id="946cf-195">The primary queue can come online and start accepting messages before the secondary queue delivers all messages into the primary queue.</span></span>

<span data-ttu-id="946cf-196">En las secciones siguientes se describen las API y cómo se implementan las API, y se muestra código de ejemplo que usa la característica.</span><span class="sxs-lookup"><span data-stu-id="946cf-196">The following sections discuss the APIs, how the APIs are implemented, and shows sample code that uses the feature.</span></span> <span data-ttu-id="946cf-197">Tenga en cuenta que esta característica tiene asociadas unos costos.</span><span class="sxs-lookup"><span data-stu-id="946cf-197">Note that there are billing implications associated with this feature.</span></span>

### <a name="the-messagingfactorypairnamespaceasync-api"></a><span data-ttu-id="946cf-198">La API de MessagingFactory.PairNamespaceAsync</span><span class="sxs-lookup"><span data-stu-id="946cf-198">The MessagingFactory.PairNamespaceAsync API</span></span>
<span data-ttu-id="946cf-199">La característica de espacios de nombres emparejados incluye el método [PairNamespaceAsync ][PairNamespaceAsync]en la clase [Microsoft.ServiceBus.Messaging.MessagingFactory][Microsoft.ServiceBus.Messaging.MessagingFactory]:</span><span class="sxs-lookup"><span data-stu-id="946cf-199">The paired namespaces feature includes the [PairNamespaceAsync][PairNamespaceAsync] method on the [Microsoft.ServiceBus.Messaging.MessagingFactory][Microsoft.ServiceBus.Messaging.MessagingFactory] class:</span></span>

```csharp
public Task PairNamespaceAsync(PairedNamespaceOptions options);
```

<span data-ttu-id="946cf-200">Cuando la tarea se completa, también lo hace el emparejamiento de espacios de nombres, que está listo para actuar en cualquier objeto [MessageReceiver][MessageReceiver], [QueueClient][QueueClient] o [TopicClient][TopicClient] creado con la instancia de [MessagingFactory][MessagingFactory].</span><span class="sxs-lookup"><span data-stu-id="946cf-200">When the task completes, the namespace pairing is also complete and ready to act upon for any [MessageReceiver][MessageReceiver], [QueueClient][QueueClient], or [TopicClient][TopicClient] created with the [MessagingFactory][MessagingFactory] instance.</span></span> <span data-ttu-id="946cf-201">[Microsoft.ServiceBus.Messaging.PairedNamespaceOptions][Microsoft.ServiceBus.Messaging.PairedNamespaceOptions] es la clase base para los distintos tipos de emparejamiento disponibles con un objeto [MessagingFactory][MessagingFactory].</span><span class="sxs-lookup"><span data-stu-id="946cf-201">[Microsoft.ServiceBus.Messaging.PairedNamespaceOptions][Microsoft.ServiceBus.Messaging.PairedNamespaceOptions] is the base class for the different types of pairing that are available with a [MessagingFactory][MessagingFactory] object.</span></span> <span data-ttu-id="946cf-202">Actualmente, la única clase derivada es la denominada [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions], que implementa los requisitos de disponibilidad de envío.</span><span class="sxs-lookup"><span data-stu-id="946cf-202">Currently, the only derived class is one named [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions], which implements the send availability requirements.</span></span> <span data-ttu-id="946cf-203">[SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] tiene un conjunto de constructores que se compilan entre sí.</span><span class="sxs-lookup"><span data-stu-id="946cf-203">[SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] has a set of constructors that build on each other.</span></span> <span data-ttu-id="946cf-204">Si se examina el constructor con más parámetros, se puede comprender el comportamiento de los restantes.</span><span class="sxs-lookup"><span data-stu-id="946cf-204">Looking at the constructor with the most parameters, you can understand the behavior of the other constructors.</span></span>

```csharp
public SendAvailabilityPairedNamespaceOptions(
    NamespaceManager secondaryNamespaceManager,
    MessagingFactory messagingFactory,
    int backlogQueueCount,
    TimeSpan failoverInterval,
    bool enableSyphon)
```

<span data-ttu-id="946cf-205">Estos parámetros tienen los significados siguientes:</span><span class="sxs-lookup"><span data-stu-id="946cf-205">These parameters have the following meanings:</span></span>

* <span data-ttu-id="946cf-206">*secondaryNamespaceManager*: instancia de [NamespaceManager][NamespaceManager] inicializada para el espacio de nombres secundario que el método [PairNamespaceAsync][PairNamespaceAsync] puede usar para configurar dicho espacio de nombres.</span><span class="sxs-lookup"><span data-stu-id="946cf-206">*secondaryNamespaceManager*: An initialized [NamespaceManager][NamespaceManager] instance for the secondary namespace that the [PairNamespaceAsync][PairNamespaceAsync] method can use to set up the secondary namespace.</span></span> <span data-ttu-id="946cf-207">El administrador de espacio de nombres se usará para obtener la lista de colas del espacio de nombres y asegurarse de que existen las colas de trabajos pendientes requeridas.</span><span class="sxs-lookup"><span data-stu-id="946cf-207">The namespace manager is used to obtain the list of queues in the namespace and to make sure that the required backlog queues exist.</span></span> <span data-ttu-id="946cf-208">Si no existen, se crearán.</span><span class="sxs-lookup"><span data-stu-id="946cf-208">If those queues do not exist, they are created.</span></span> <span data-ttu-id="946cf-209">[NamespaceManager][NamespaceManager] requiere la capacidad de crear un token con la notificación de **administración**.</span><span class="sxs-lookup"><span data-stu-id="946cf-209">[NamespaceManager][NamespaceManager] requires the ability to create a token with the **Manage** claim.</span></span>
* <span data-ttu-id="946cf-210">*messagingFactory*: la instancia de [MessagingFactory][MessagingFactory] para el espacio de nombres secundario.</span><span class="sxs-lookup"><span data-stu-id="946cf-210">*messagingFactory*: The [MessagingFactory][MessagingFactory] instance for the secondary namespace.</span></span> <span data-ttu-id="946cf-211">El objeto [MessagingFactory][MessagingFactory] se usa para enviar y, si la propiedad [EnableSyphon][EnableSyphon] está establecida en **true**, para recibir mensajes de las colas de trabajos pendientes.</span><span class="sxs-lookup"><span data-stu-id="946cf-211">The [MessagingFactory][MessagingFactory] object is used to send and, if the [EnableSyphon][EnableSyphon] property is set to **true**, receive messages from the backlog queues.</span></span>
* <span data-ttu-id="946cf-212">*backlogQueueCount*: el número de colas de trabajos pendientes que se crean.</span><span class="sxs-lookup"><span data-stu-id="946cf-212">*backlogQueueCount*: The number of backlog queues to create.</span></span> <span data-ttu-id="946cf-213">Este valor debe ser al menos 1.</span><span class="sxs-lookup"><span data-stu-id="946cf-213">This value must be at least 1.</span></span> <span data-ttu-id="946cf-214">Al enviar mensajes al trabajo pendiente, se elige aleatoriamente una de estas colas.</span><span class="sxs-lookup"><span data-stu-id="946cf-214">When sending messages to the backlog, one of these queues is randomly chosen.</span></span> <span data-ttu-id="946cf-215">Si establece el valor en 1, solo se puede usar una cola.</span><span class="sxs-lookup"><span data-stu-id="946cf-215">If you set the value to 1, then only one queue can ever be used.</span></span> <span data-ttu-id="946cf-216">Cuando esto ocurre y la única cola de trabajos pendientes genera errores, el cliente no puede probar otra cola de trabajos pendientes y se puede producir un error al enviar el mensaje.</span><span class="sxs-lookup"><span data-stu-id="946cf-216">When this happens and the one backlog queue generates errors, the client is not able to try a different backlog queue and may fail to send your message.</span></span> <span data-ttu-id="946cf-217">Se recomienda seleccionar un valor mayor y que el valor predeterminado sea 10.</span><span class="sxs-lookup"><span data-stu-id="946cf-217">We recommend setting this value to some larger value and default the value to 10.</span></span> <span data-ttu-id="946cf-218">Puede cambiarlo a un valor mayor o menor en función de la cantidad de datos que la aplicación envíe al día.</span><span class="sxs-lookup"><span data-stu-id="946cf-218">You can change this to a higher or lower value depending on how much data your application sends per day.</span></span> <span data-ttu-id="946cf-219">Cada cola de trabajos pendientes puede contener hasta 5 GB de mensajes.</span><span class="sxs-lookup"><span data-stu-id="946cf-219">Each backlog queue can hold up to 5 GB of messages.</span></span>
* <span data-ttu-id="946cf-220">*failoverInterval*: el periodo durante el cual se aceptarán errores en el espacio de nombres principal antes de cambiar cualquier entidad única al espacio de nombres secundario.</span><span class="sxs-lookup"><span data-stu-id="946cf-220">*failoverInterval*: The amount of time during which you will accept failures on the primary namespace before switching any single entity over to the secondary namespace.</span></span> <span data-ttu-id="946cf-221">Las conmutaciones por error se producen entidad por entidad.</span><span class="sxs-lookup"><span data-stu-id="946cf-221">Failovers occur on an entity-by-entity basis.</span></span> <span data-ttu-id="946cf-222">Con frecuencia,  las entidades de un espacio de nombres individual residen en nodos diferentes de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="946cf-222">Entities in a single namespace frequently live in different nodes within Service Bus.</span></span> <span data-ttu-id="946cf-223">Un error en una de las entidades no implica un error en otra.</span><span class="sxs-lookup"><span data-stu-id="946cf-223">A failure in one entity does not imply a failure in another.</span></span> <span data-ttu-id="946cf-224">Este valor se puede establecer en [System.TimeSpan.Zero][System.TimeSpan.Zero] para conmutar por error al secundario inmediatamente después del primer error no transitorio.</span><span class="sxs-lookup"><span data-stu-id="946cf-224">You can set this value to [System.TimeSpan.Zero][System.TimeSpan.Zero] to failover to the secondary immediately after your first, non-transient failure.</span></span> <span data-ttu-id="946cf-225">Los errores que desencadenan el temporizador de conmutación por error son cualquier [MessagingException][MessagingException] en donde la propiedad [IsTransient][IsTransient] sea false o un [System.TimeoutException][System.TimeoutException].</span><span class="sxs-lookup"><span data-stu-id="946cf-225">Failures that trigger the failover timer are any [MessagingException][MessagingException] in which the [IsTransient][IsTransient] property is false, or a [System.TimeoutException][System.TimeoutException].</span></span> <span data-ttu-id="946cf-226">Otras excepciones, como [UnauthorizedAccessException][UnauthorizedAccessException], no provocan la conmutación por error, ya que indican que el cliente no está configurado correctamente.</span><span class="sxs-lookup"><span data-stu-id="946cf-226">Other exceptions, such as [UnauthorizedAccessException][UnauthorizedAccessException] do not cause failover, because they indicate that the client is configured incorrectly.</span></span> <span data-ttu-id="946cf-227">[ServerBusyException][ServerBusyException] no causa la conmutación por error porque el patrón correcto es esperar 10 segundos y, a continuación, volver a enviar el mensaje.</span><span class="sxs-lookup"><span data-stu-id="946cf-227">A [ServerBusyException][ServerBusyException] does not cause failover because the correct pattern is to wait 10 seconds, then send the message again.</span></span>
* <span data-ttu-id="946cf-228">*enableSyphon*: indica que este emparejamiento concreto también debe extraer con sifón los mensajes del espacio de nombres secundario al espacio de nombres principal.</span><span class="sxs-lookup"><span data-stu-id="946cf-228">*enableSyphon*: Indicates that this particular pairing should also syphon messages from the secondary namespace back to the primary namespace.</span></span> <span data-ttu-id="946cf-229">En general, las aplicaciones que envían mensajes deben establecer este valor en **false**, mientras que las que los reciben mensajes deben establecerlo en **true**.</span><span class="sxs-lookup"><span data-stu-id="946cf-229">In general, applications that send messages should set this value to **false**; applications that receive messages should set this value to **true**.</span></span> <span data-ttu-id="946cf-230">Esto se debe a que, con frecuencia, hay menos destinatarios de mensajes que remitentes.</span><span class="sxs-lookup"><span data-stu-id="946cf-230">The reason for this is that frequently, there are fewer message receivers than message senders.</span></span> <span data-ttu-id="946cf-231">En función del número de destinatarios, puede elegir que una instancia individual de la aplicación controle las tareas del sifón.</span><span class="sxs-lookup"><span data-stu-id="946cf-231">Depending on the number of receivers, you can choose to have a single application instance handle the syphon duties.</span></span> <span data-ttu-id="946cf-232">El uso de muchos destinatarios conlleva costos por cada cola de trabajos pendientes.</span><span class="sxs-lookup"><span data-stu-id="946cf-232">Using many receivers has billing implications for each backlog queue.</span></span>

<span data-ttu-id="946cf-233">Para usar el código, cree una instancia principal de [MessagingFactory][MessagingFactory], una instancia secundaria de [MessagingFactory][MessagingFactory], una instancia secundaria de [NamespaceManager][NamespaceManager] y una instancia de [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions].</span><span class="sxs-lookup"><span data-stu-id="946cf-233">To use the code, create a primary [MessagingFactory][MessagingFactory] instance, a secondary [MessagingFactory][MessagingFactory] instance, a secondary [NamespaceManager][NamespaceManager] instance, and a [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] instance.</span></span> <span data-ttu-id="946cf-234">La llamada puede ser tan simple como la siguiente:</span><span class="sxs-lookup"><span data-stu-id="946cf-234">The call can be as simple as the following:</span></span>

```csharp
SendAvailabilityPairedNamespaceOptions sendAvailabilityOptions = new SendAvailabilityPairedNamespaceOptions(secondaryNamespaceManager, secondary);
primary.PairNamespaceAsync(sendAvailabilityOptions).Wait();
```

<span data-ttu-id="946cf-235">Cuando se completa la tarea que devuelve el método [PairNamespaceAsync][PairNamespaceAsync], todo está configurado y listo para su uso.</span><span class="sxs-lookup"><span data-stu-id="946cf-235">When the task returned by the [PairNamespaceAsync][PairNamespaceAsync] method completes, everything is set up and ready to use.</span></span> <span data-ttu-id="946cf-236">Antes de que se devuelva la tarea, es posible que no haya completado todo el trabajo en segundo plano necesario para que el emparejamiento funcione correctamente.</span><span class="sxs-lookup"><span data-stu-id="946cf-236">Before the task is returned, you may not have completed all of the background work necessary for the pairing to work right.</span></span> <span data-ttu-id="946cf-237">Como consecuencia, no debe empezar a enviar mensajes hasta que se devuelva la tarea.</span><span class="sxs-lookup"><span data-stu-id="946cf-237">As a result, you should not start sending messages until the task returns.</span></span> <span data-ttu-id="946cf-238">Si se produce algún error, como unas credenciales incorrectas o un error al crear las colas de trabajos pendientes, las excepciones se iniciarán una vez que se complete la tarea.</span><span class="sxs-lookup"><span data-stu-id="946cf-238">If any failures occurred, such as bad credentials, or failure to create the backlog queues, those exceptions will be thrown once the task completes.</span></span> <span data-ttu-id="946cf-239">Una vez que la tarea se devuelva, compruebe que las colas se han encontrado o creado, para lo que es preciso examinar la propiedad [BacklogQueueCount][BacklogQueueCount] de la instancia de [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions].</span><span class="sxs-lookup"><span data-stu-id="946cf-239">Once the task returns, verify that the queues were found or created by examining the [BacklogQueueCount][BacklogQueueCount] property on your [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] instance.</span></span> <span data-ttu-id="946cf-240">Para el código anterior, la operación aparece como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="946cf-240">For the preceding code, that operation appears as follows:</span></span>

```csharp
if (sendAvailabilityOptions.BacklogQueueCount < 1)
{
    // Handle case where no queues were created.
}
```

## <a name="next-steps"></a><span data-ttu-id="946cf-241">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="946cf-241">Next steps</span></span>
<span data-ttu-id="946cf-242">Ahora que ha aprendido los conceptos básicos de la mensajería asincrónica en Service Bus, obtenga más detalles sobre los [espacios de nombres emparejados][paired namespaces].</span><span class="sxs-lookup"><span data-stu-id="946cf-242">Now that you've learned the basics of asynchronous messaging in Service Bus, read more details about [paired namespaces][paired namespaces].</span></span>

[ServerBusyException]: /dotnet/api/microsoft.servicebus.messaging.serverbusyexception
[System.TimeoutException]: https://msdn.microsoft.com/library/system.timeoutexception.aspx
[MessagingException]: /dotnet/api/microsoft.servicebus.messaging.messagingexception
[Best practices for insulating applications against Service Bus outages and disasters]: service-bus-outages-disasters.md
[Microsoft.ServiceBus.Messaging.MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[MessageReceiver]: /dotnet/api/microsoft.servicebus.messaging.messagereceiver
[QueueClient]: /dotnet/api/microsoft.servicebus.messaging.queueclient
[TopicClient]: /dotnet/api/microsoft.servicebus.messaging.topicclient
[Microsoft.ServiceBus.Messaging.PairedNamespaceOptions]: /dotnet/api/microsoft.servicebus.messaging.pairednamespaceoptions
[MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[SendAvailabilityPairedNamespaceOptions]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions
[NamespaceManager]: /dotnet/api/microsoft.servicebus.namespacemanager
[PairNamespaceAsync]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_PairNamespaceAsync_Microsoft_ServiceBus_Messaging_PairedNamespaceOptions_
[EnableSyphon]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions#Microsoft_ServiceBus_Messaging_SendAvailabilityPairedNamespaceOptions_EnableSyphon
[System.TimeSpan.Zero]: https://msdn.microsoft.com/library/system.timespan.zero.aspx
[IsTransient]: /dotnet/api/microsoft.servicebus.messaging.messagingexception#Microsoft_ServiceBus_Messaging_MessagingException_IsTransient
[UnauthorizedAccessException]: https://msdn.microsoft.com/library/system.unauthorizedaccessexception.aspx
[BacklogQueueCount]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions?redirectedfrom=MSDN#Microsoft_ServiceBus_Messaging_SendAvailabilityPairedNamespaceOptions_BacklogQueueCount
[paired namespaces]: service-bus-paired-namespaces.md

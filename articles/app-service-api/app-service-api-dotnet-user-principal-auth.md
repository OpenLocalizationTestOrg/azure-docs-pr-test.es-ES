---
title: "Autenticación de usuario para API Apps en Azure App Service | Microsoft Docs"
description: "Obtenga información sobre cómo proteger una aplicación de API del Servicio de aplicaciones de Azure al permitir el acceso únicamente a usuarios autenticados."
services: app-service\api
documentationcenter: .net
author: alexkarcher-msft
manager: erikre
editor: 
ms.assetid: 3896760d-46ff-4b67-b98a-edd233f24758
ms.service: app-service-api
ms.workload: na
ms.tgt_pltfrm: dotnet
ms.devlang: na
ms.topic: article
ms.date: 06/30/2016
ms.author: alkarche
ms.openlocfilehash: a5b713f3a60b3886d813438496d704f464d914e6
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="user-authentication-for-api-apps-in-azure-app-service"></a><span data-ttu-id="55ee6-103">Autenticación de usuario para aplicaciones de API en el Servicio de aplicaciones de Azure</span><span class="sxs-lookup"><span data-stu-id="55ee6-103">User authentication for API Apps in Azure App Service</span></span>
## <a name="overview"></a><span data-ttu-id="55ee6-104">Información general</span><span class="sxs-lookup"><span data-stu-id="55ee6-104">Overview</span></span>
<span data-ttu-id="55ee6-105">Este artículo muestra cómo proteger una aplicación de API de Azure para que solo puedan llamarla los usuarios autenticados.</span><span class="sxs-lookup"><span data-stu-id="55ee6-105">This article shows how to protect an Azure API app so that only authenticated users can call it.</span></span> <span data-ttu-id="55ee6-106">Se da por supuesto que ha leído [Autenticación y autorización en el Servicio de aplicaciones de Azure](../app-service/app-service-authentication-overview.md).</span><span class="sxs-lookup"><span data-stu-id="55ee6-106">The article assumes that you have read the [Azure App Service authentication overview](../app-service/app-service-authentication-overview.md).</span></span>

<span data-ttu-id="55ee6-107">Aprenderá a realizar los siguientes procedimientos:</span><span class="sxs-lookup"><span data-stu-id="55ee6-107">You'll learn:</span></span>

* <span data-ttu-id="55ee6-108">Cómo configurar un proveedor de autenticación, con detalles para Azure Active Directory (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="55ee6-108">How to configure an authentication provider, with details for Azure Active Directory (Azure AD).</span></span>
* <span data-ttu-id="55ee6-109">Cómo consumir una aplicación de API protegida mediante la [Biblioteca de autenticación de Active Directory (ADAL) para JavaScript](https://github.com/AzureAD/azure-activedirectory-library-for-js).</span><span class="sxs-lookup"><span data-stu-id="55ee6-109">How to consume a protected API app by using the [Active Directory Authentication Library (ADAL) for JavaScript](https://github.com/AzureAD/azure-activedirectory-library-for-js).</span></span>

<span data-ttu-id="55ee6-110">El artículo contiene dos secciones:</span><span class="sxs-lookup"><span data-stu-id="55ee6-110">The article contains two sections:</span></span>

* <span data-ttu-id="55ee6-111">La sección [Configuración de la autenticación de usuarios en el Servicio de aplicaciones de Azure](#authconfig) explica de forma general cómo configurar la autenticación de usuarios de cualquier aplicación de API y se aplica por igual a todos los marcos compatibles con el Servicio de aplicaciones, incluyendo .NET, Node.js y Java.</span><span class="sxs-lookup"><span data-stu-id="55ee6-111">The [How to configure user authentication in Azure App Service](#authconfig) section explains in general how to configure user authentication for any API app and applies equally to all frameworks supported by App Service, including .NET, Node.js, and Java.</span></span>
* <span data-ttu-id="55ee6-112">A partir de la sección [Continuación de los tutoriales de aplicaciones de API de .NET](#tutorialstart) , el artículo lo guía en la configuración de una aplicación de ejemplo con un back-end de .NET y un front-end de AngularJS para que use Azure Active Directory para la autenticación de los usuarios.</span><span class="sxs-lookup"><span data-stu-id="55ee6-112">Starting with the [Continuing the .NET API Apps tutorials](#tutorialstart) section, the article guides you through configuring a sample application with a .NET back end and an AngularJS front end so that it uses Azure Active Directory for user authentication.</span></span> 

## <span data-ttu-id="55ee6-113"><a id="authconfig"></a> Configuración de la autenticación de usuarios en el Servicio de aplicaciones de Azure</span><span class="sxs-lookup"><span data-stu-id="55ee6-113"><a id="authconfig"></a> How to configure user authentication in Azure App Service</span></span>
<span data-ttu-id="55ee6-114">Esta sección proporciona instrucciones generales que se aplican a cualquier aplicación de API.</span><span class="sxs-lookup"><span data-stu-id="55ee6-114">This section provides general instructions that apply to any API app.</span></span> <span data-ttu-id="55ee6-115">Para obtener los pasos específicos para la aplicación de ejemplo de .NET To Do List, vaya a [Continuación de los tutoriales de aplicaciones de API de .NET](#tutorialstart).</span><span class="sxs-lookup"><span data-stu-id="55ee6-115">For steps specific to the To Do List .NET sample application, go to [Continuing the .NET getting-started tutorials](#tutorialstart).</span></span>

1. <span data-ttu-id="55ee6-116">En [Azure Portal](https://portal.azure.com/), vaya a la hoja **Configuración** de la aplicación de API que quiere proteger, busque la sección **Características** y haga clic en **Autenticación/autorización**.</span><span class="sxs-lookup"><span data-stu-id="55ee6-116">In the [Azure portal](https://portal.azure.com/), navigate to the **Settings** blade of the API app that you want to protect, find the **Features** section, and then click **Authentication/ Authorization**.</span></span>
   
    ![Autenticación/autorización del Portal de Azure](./media/app-service-api-dotnet-user-principal-auth/features.png)
2. <span data-ttu-id="55ee6-118">En la hoja **Autenticación/autorización**, haga clic en **Activado**.</span><span class="sxs-lookup"><span data-stu-id="55ee6-118">In the **Authentication / Authorization** blade, click **On**.</span></span>
3. <span data-ttu-id="55ee6-119">Seleccione una de las opciones de la lista desplegable **Acción necesaria cuando la solicitud no está autenticada** .</span><span class="sxs-lookup"><span data-stu-id="55ee6-119">Select one of the options from the **Action to take when request is not authenticated** drop-down list.</span></span>
   
   * <span data-ttu-id="55ee6-120">Si desea que solo puedan acceder a la aplicación de API las llamadas que estén autenticadas, elija una de las opciones de **Iniciar sesión con** .</span><span class="sxs-lookup"><span data-stu-id="55ee6-120">If you want only authenticated calls to reach your API app, choose one of the **Log in with ...** options.</span></span> <span data-ttu-id="55ee6-121">Esta opción permite proteger la aplicación de API sin escribir código que se ejecute en ella.</span><span class="sxs-lookup"><span data-stu-id="55ee6-121">This option enables you to protect the API app without writing any code that runs in it.</span></span>
   * <span data-ttu-id="55ee6-122">Si desea que todas las llamadas accedan a la aplicación de API, elija **Permitir solicitud (sin acción)**.</span><span class="sxs-lookup"><span data-stu-id="55ee6-122">If you want all calls to reach your API app, choose **Allow request (no action)**.</span></span> <span data-ttu-id="55ee6-123">Esta opción se puede utilizar para mostrar a los autores de llamadas no autenticados los proveedores de autenticación entre los que pueden elegir.</span><span class="sxs-lookup"><span data-stu-id="55ee6-123">You can use this option to direct unauthenticated callers to a choice of authentication providers.</span></span> <span data-ttu-id="55ee6-124">Con esta opción es preciso escribir código para controlar la autorización.</span><span class="sxs-lookup"><span data-stu-id="55ee6-124">With this option you have to write code to handle authorization.</span></span>
     
     <span data-ttu-id="55ee6-125">Para más información, consulte [Autenticación y autorización para Aplicaciones de API en el Servicio de aplicaciones de Azure](app-service-api-authentication.md#multiple-protection-options).</span><span class="sxs-lookup"><span data-stu-id="55ee6-125">For more information, see [Authentication and authorization for API Apps in Azure App Service](app-service-api-authentication.md#multiple-protection-options).</span></span>
4. <span data-ttu-id="55ee6-126">Seleccione uno o varios **proveedores de autenticación**.</span><span class="sxs-lookup"><span data-stu-id="55ee6-126">Select one or more of the **Authentication Providers**.</span></span>
   
    <span data-ttu-id="55ee6-127">La imagen muestra las opciones que requieren que Azure AD autentique a todos los autores de llamadas.</span><span class="sxs-lookup"><span data-stu-id="55ee6-127">The image shows    choices that require all callers to be authenticated by Azure AD.</span></span>
   
    ![Hoja Autenticación/autorización del Portal de Azure](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
   
    <span data-ttu-id="55ee6-129">Al elegir un proveedor de autenticación, el portal muestra la hoja de configuración de dicho proveedor.</span><span class="sxs-lookup"><span data-stu-id="55ee6-129">When you choose an authentication provider, the portal displays a configuration blade for that provider.</span></span> 
   
    <span data-ttu-id="55ee6-130">Para más información sobre cómo configurar las hojas de configuración de los proveedores de autenticación, consulte [Configuración de la aplicación del Servicio de aplicaciones para usar el inicio de sesión de Azure Active Directory](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="55ee6-130">For detailed instructions that explain how to configure the authentication provider configuration blades, see [How to configure your App Service application to use Azure Active Directory login](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span></span> <span data-ttu-id="55ee6-131">(El vínculo abre un artículo sobre Azure AD, pero el propio artículo contiene pestañas con vínculos a artículos para los restantes proveedores de autenticación).</span><span class="sxs-lookup"><span data-stu-id="55ee6-131">(The link goes to an article about Azure AD, but the article itself contains tabs that link to articles for the other authentication providers.)</span></span>
5. <span data-ttu-id="55ee6-132">Cuando termine con la hoja de configuración del proveedor de autenticación, haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="55ee6-132">When you're done with the authentication provider configuration blade, click **OK**.</span></span>
6. <span data-ttu-id="55ee6-133">En la hoja **Autenticación/autorización**, haga clic en **Guardar**.</span><span class="sxs-lookup"><span data-stu-id="55ee6-133">In the **Authentication / Authorization** blade, click **Save**.</span></span>

<span data-ttu-id="55ee6-134">Al hacerlo, el Servicio de aplicaciones autentica todas las llamadas API antes de que lleguen a la aplicación de API.</span><span class="sxs-lookup"><span data-stu-id="55ee6-134">When this is done, App Service authenticates all API calls before they reach the API app.</span></span> <span data-ttu-id="55ee6-135">Estos servicios de autenticación funcionan igual en todos los lenguajes que admite el Servicio de aplicaciones, como .NET, Node.js y Java.</span><span class="sxs-lookup"><span data-stu-id="55ee6-135">The authentication services work the same for all languages that App service supports, including .NET, Node.js, and Java.</span></span> 

<span data-ttu-id="55ee6-136">Para realizar llamadas API autenticadas, el autor de la llamada incluye el token de portador de OAuth 2.0 del proveedor de autenticación en el encabezado de autorización de las solicitudes HTTP.</span><span class="sxs-lookup"><span data-stu-id="55ee6-136">To make authenticated API calls, the caller includes the authentication provider's OAuth 2.0 bearer token in the Authorization header of HTTP requests.</span></span> <span data-ttu-id="55ee6-137">El token se puede adquirir mediante el SDK del proveedor de autenticación.</span><span class="sxs-lookup"><span data-stu-id="55ee6-137">The token can be acquired by using the authentication provider's SDK.</span></span>

## <span data-ttu-id="55ee6-138"><a id="tutorialstart"></a> Continuación de los tutoriales de aplicaciones de API de .NET</span><span class="sxs-lookup"><span data-stu-id="55ee6-138"><a id="tutorialstart"></a> Continuing the .NET API Apps tutorials</span></span>
<span data-ttu-id="55ee6-139">Si está siguiendo la serie de tutoriales de Node.js o Java para aplicaciones de API, vaya al siguiente artículo, [Autenticación de entidad de servicio para Aplicaciones de API en el Servicio de aplicaciones de Azure](app-service-api-dotnet-service-principal-auth.md).</span><span class="sxs-lookup"><span data-stu-id="55ee6-139">If you are following the Node.js or Java tutorials for API apps, skip to the next article, [service principal authentication for API apps](app-service-api-dotnet-service-principal-auth.md).</span></span> 

<span data-ttu-id="55ee6-140">Si está siguiendo la serie de tutoriales de .NET para aplicaciones de API y ya ha implementado la aplicación de ejemplo como se indica en el [primer](app-service-api-dotnet-get-started.md) y el [segundo](app-service-api-cors-consume-javascript.md) tutorial, vaya a la sección [Configuración de la autenticación en App Service y Azure AD](#azureauth).</span><span class="sxs-lookup"><span data-stu-id="55ee6-140">If you are following the .NET tutorial series for API apps and have already deployed the sample application as directed in the [first](app-service-api-dotnet-get-started.md) and [second](app-service-api-cors-consume-javascript.md) tutorials, skip to the [Set up authentication in App Service and Azure AD](#azureauth) section.</span></span>

<span data-ttu-id="55ee6-141">Si desea seguir este tutorial sin completar el primero ni el segundo, lleve a cabo los pasos siguientes que explican cómo empezar a trabajar usando un proceso automatizado para implementar la aplicación de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="55ee6-141">If you want to follow this tutorial without going through the first and second tutorials, do the following steps which explain how to get started by using an automated process to deploy the sample application.</span></span>

> [!NOTE]
> <span data-ttu-id="55ee6-142">Los siguientes pasos lo llevan al mismo punto de partida, como si hubiera hecho los dos primeros tutoriales, con una excepción: Visual Studio ya no sabrá en qué aplicación web o aplicación de API se implementa cada proyecto.</span><span class="sxs-lookup"><span data-stu-id="55ee6-142">The following steps get you to the same starting point as if you did the first two tutorials, with one exception: Visual Studio won't already know which web app or API app that each project gets deployed to.</span></span> <span data-ttu-id="55ee6-143">Esto significa que este tutorial no ofrecerá instrucciones exactas sobre cómo implementar en los objetivos correctos.</span><span class="sxs-lookup"><span data-stu-id="55ee6-143">That means you won't have exact instructions in this tutorial that explain how to deploy to the right targets.</span></span> <span data-ttu-id="55ee6-144">Si no se siente cómodo averiguando los pasos de implementación por su cuenta, se recomienda que siga la serie de tutoriales desde el [primero](app-service-api-dotnet-get-started.md) en lugar de comenzar con este proceso de implementación automatizado.</span><span class="sxs-lookup"><span data-stu-id="55ee6-144">If you're not comfortable with figuring out how to do the deployment steps on your own, it's better to follow the tutorial series from the [first tutorial](app-service-api-dotnet-get-started.md) than to start with this automated deployment process.</span></span>
> 
> 

1. <span data-ttu-id="55ee6-145">Asegúrese de que cumple todos los requisitos previos descritos en el [primer tutorial](app-service-api-dotnet-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="55ee6-145">Make sure that you have all of the prerequisites listed in the [first tutorial](app-service-api-dotnet-get-started.md).</span></span> <span data-ttu-id="55ee6-146">Además de los requisitos previos descritos, en estos tutoriales de autenticación se da por hecho que ha trabajado con aplicaciones web del Servicio de aplicaciones y aplicaciones de API en Visual Studio y el Portal de Azure.</span><span class="sxs-lookup"><span data-stu-id="55ee6-146">In addition to the prerequisites listed, these authentication tutorials assume that you have worked with App Service web apps and API apps in Visual Studio and the Azure portal.</span></span>
2. <span data-ttu-id="55ee6-147">Haga clic en el botón **Deploy to Azure** (Implementar en Azure) en el [archivo Léame del repositorio del ejemplo To Do List](https://github.com/azure-samples/app-service-api-dotnet-todo-list/blob/master/readme.md) para implementar las aplicaciones de API y la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="55ee6-147">Click the **Deploy to Azure** button in the [To Do List sample repository readme file](https://github.com/azure-samples/app-service-api-dotnet-todo-list/blob/master/readme.md) to deploy the API apps and the web app.</span></span> <span data-ttu-id="55ee6-148">Tome nota del grupo de recursos de Azure que se crea, ya que puede usar más adelante esta información para buscar nombres de aplicación web y de aplicación de API.</span><span class="sxs-lookup"><span data-stu-id="55ee6-148">Make a note of the Azure resource group that gets created, as you can use this later to look up web app and API app names.</span></span>
3. <span data-ttu-id="55ee6-149">Descargue o clone el [repositorio del ejemplo To Do List](https://github.com/Azure-Samples/app-service-api-dotnet-todo-list) para obtener el código que funcionará localmente en Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="55ee6-149">Download or clone the [To Do List sample repository](https://github.com/Azure-Samples/app-service-api-dotnet-todo-list) to get the code that you'll work with locally in Visual Studio.</span></span>

## <span data-ttu-id="55ee6-150"><a id="azureauth"></a> Configuración de la autenticación en el Servicio de aplicaciones y Azure AD</span><span class="sxs-lookup"><span data-stu-id="55ee6-150"><a id="azureauth"></a> Set up authentication in App Service and Azure AD</span></span>
<span data-ttu-id="55ee6-151">En este momento. la aplicación se ejecuta en el Servicio de aplicaciones de Azure sin necesidad de que los usuarios se autentiquen.</span><span class="sxs-lookup"><span data-stu-id="55ee6-151">You now have the application running in Azure App Service without requiring that users be authenticated.</span></span> <span data-ttu-id="55ee6-152">En esta sección se agregará la autenticación, para lo que es preciso realizar las siguientes tareas:</span><span class="sxs-lookup"><span data-stu-id="55ee6-152">In this section you add authentication by doing the following tasks:</span></span>

* <span data-ttu-id="55ee6-153">Configurar el Servicio de aplicaciones para que requiera la autenticación de Azure Active Directory (Azure AD) para llamar a la aplicación de API de nivel intermedio.</span><span class="sxs-lookup"><span data-stu-id="55ee6-153">Configure App Service to require Azure Active Directory (Azure AD) authentication for calling the middle tier API app.</span></span>
* <span data-ttu-id="55ee6-154">Crear una aplicación de Azure.</span><span class="sxs-lookup"><span data-stu-id="55ee6-154">Create an Azure AD application.</span></span>
* <span data-ttu-id="55ee6-155">Configurar la aplicación de Azure AD para enviar el token de portador después de iniciar sesión en el front-end de AngularJS.</span><span class="sxs-lookup"><span data-stu-id="55ee6-155">Configure the Azure AD application to send the bearer token after logon to the AngularJS front end.</span></span> 

<span data-ttu-id="55ee6-156">Si experimenta problemas al seguir las instrucciones del tutorial, consulte la sección [Solución de problemas](#troubleshooting) al final.</span><span class="sxs-lookup"><span data-stu-id="55ee6-156">If you run into problems while following the tutorial directions, see the [Troubleshooting](#troubleshooting) section at the end of the tutorial.</span></span> 

### <a name="configure-authentication-for-the-middle-tier-api-app"></a><span data-ttu-id="55ee6-157">Configuración de la autenticación para la aplicación de API de nivel intermedio</span><span class="sxs-lookup"><span data-stu-id="55ee6-157">Configure authentication for the middle tier API app</span></span>
1. <span data-ttu-id="55ee6-158">En [Azure Portal](https://portal.azure.com/), vaya a la hoja **Configuración** de la aplicación de API que creó para el proyecto ToDoListAPI, busque la sección **Características** y haga clic en **Autenticación/autorización**.</span><span class="sxs-lookup"><span data-stu-id="55ee6-158">In the [Azure portal](https://portal.azure.com/), navigate to the **Settings** blade of the API app that you created for the ToDoListAPI project, find the **Features** section, and then click **Authentication / Authorization**.</span></span>
   
    ![Autenticación/autorización del Portal de Azure](./media/app-service-api-dotnet-user-principal-auth/features.png)
2. <span data-ttu-id="55ee6-160">En la hoja **Autenticación/autorización**, haga clic en **Activado**.</span><span class="sxs-lookup"><span data-stu-id="55ee6-160">In the **Authentication / Authorization** blade, click **On**.</span></span>
3. <span data-ttu-id="55ee6-161">En la lista desplegable **Acción por realizar cuando no se autentique la solicitud**, seleccione **Iniciar sesión con Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="55ee6-161">In the **Action to take when request is not authenticated** drop-down list, select **Log in with Azure Active Directory**.</span></span>
   
    <span data-ttu-id="55ee6-162">Esta opción garantiza que ninguna solicitud no autenticada llegará a la aplicación de API.</span><span class="sxs-lookup"><span data-stu-id="55ee6-162">This option ensures that no unauathenticated requests will reach the API app.</span></span> 
4. <span data-ttu-id="55ee6-163">En **Proveedores de autenticación**, haga clic en **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="55ee6-163">Under **Authentication Providers**, click **Azure Active Directory**.</span></span>
   
    ![Hoja Autenticación/autorización del Portal de Azure](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
5. <span data-ttu-id="55ee6-165">En la hoja **Configuración de Azure Active Directory**, haga clic en **Rápido**.</span><span class="sxs-lookup"><span data-stu-id="55ee6-165">In the **Azure Active Directory Settings** blade, click **Express**</span></span>
   
    ![Opción Express de Autenticación/autorización del Portal de Azure](./media/app-service-api-dotnet-user-principal-auth/aadsettings.png)
   
    <span data-ttu-id="55ee6-167">Con la opción **Rápido**, App Service puede crear automáticamente una aplicación de Azure AD en su [inquilino](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant)de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="55ee6-167">With the **Express** option, App Service can automatically create an Azure AD application in your Azure AD [tenant](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span></span> 
   
    <span data-ttu-id="55ee6-168">No es preciso que cree un inquilino, porque todas las cuenta de Azure tienen uno automáticamente.</span><span class="sxs-lookup"><span data-stu-id="55ee6-168">You don't have to create a tenant, because every Azure account automatically has one.</span></span>
6. <span data-ttu-id="55ee6-169">En **Modo de administración**, haga clic en **Crear nueva aplicación de AD** si no está seleccionada y observe el valor que se encuentra en el cuadro de texto **Crear aplicación**; más adelante buscará esta aplicación de AAD en el Portal de Azure clásico.</span><span class="sxs-lookup"><span data-stu-id="55ee6-169">Under **Management mode**, click **Create New AD App** if it isn't already selected, and notice the value that is in the **Create App** text box; you'll look up this AAD application in the Azure classic portal later.</span></span>
   
    ![Configuración de Azure AD del Portal de Azure](./media/app-service-api-dotnet-user-principal-auth/aadsettings2.png)
   
    <span data-ttu-id="55ee6-171">Azure creará automáticamente una aplicación de Azure AD con el nombre indicado en su inquilino de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="55ee6-171">Azure will automatically create an Azure AD application with the indicated name in your Azure AD tenant.</span></span> <span data-ttu-id="55ee6-172">De forma predeterminada, la aplicación de Azure AD recibe el mismo nombre que la aplicación de API.</span><span class="sxs-lookup"><span data-stu-id="55ee6-172">By default, the Azure AD application is named the same as the API app.</span></span> <span data-ttu-id="55ee6-173">Si lo prefiere, escriba un nombre diferente.</span><span class="sxs-lookup"><span data-stu-id="55ee6-173">If you prefer, you can enter a different name.</span></span>
7. <span data-ttu-id="55ee6-174">Haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="55ee6-174">Click **OK**.</span></span>
8. <span data-ttu-id="55ee6-175">En la hoja **Autenticación/autorización**, haga clic en **Guardar**.</span><span class="sxs-lookup"><span data-stu-id="55ee6-175">In the **Authentication / Authorization** blade, click **Save**.</span></span>
   
    ![Haga clic en Guardar](./media/app-service-api-dotnet-user-principal-auth/authsave.png)

<span data-ttu-id="55ee6-177">Ahora los usuarios de su inquilino de Azure AD son los únicos que pueden llamar a la aplicación de API.</span><span class="sxs-lookup"><span data-stu-id="55ee6-177">Now only users in your Azure AD tenant can call the API app.</span></span>

### <a name="optional-test-the-api-app"></a><span data-ttu-id="55ee6-178">Opcional: prueba de la aplicación de API</span><span class="sxs-lookup"><span data-stu-id="55ee6-178">Optional: Test the API app</span></span>
1. <span data-ttu-id="55ee6-179">En un explorador, vaya a la dirección URL de la aplicación de API: en la hoja **Aplicación de API** de Azure Portal, haga clic en el vínculo bajo **URL**.</span><span class="sxs-lookup"><span data-stu-id="55ee6-179">In a browser go to the URL of the API app: in the **API app** blade in the Azure portal, click the link under **URL**.</span></span>  
   
    <span data-ttu-id="55ee6-180">Se le redirigirá a una pantalla de inicio de sesión porque no se permite que las solicitudes no autenticadas tengan acceso a la aplicación de API.</span><span class="sxs-lookup"><span data-stu-id="55ee6-180">You are redirected to a login screen because unauthenticated requests are not allowed to reach the API app.</span></span>
   
    <span data-ttu-id="55ee6-181">Si el explorador va a la página que indica que "se creó correctamente", es posible que el explorador ya haya iniciado sesión (en ese caso, abra una ventana de InPrivate o Incognito y vaya a la dirección URL de la aplicación de API).</span><span class="sxs-lookup"><span data-stu-id="55ee6-181">If your browser goes to the "successfully created" page, the browser might already be logged on -- in that case, open an InPrivate or Incognito window and go to the API app's URL.</span></span>
2. <span data-ttu-id="55ee6-182">Inicie sesión con las credenciales de un usuario en su inquilino de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="55ee6-182">Log on using credentials for a user in your Azure AD tenant.</span></span>
   
    <span data-ttu-id="55ee6-183">Una vez iniciada la sesión, en el explorador aparece una página que indica que "se creó correctamente".</span><span class="sxs-lookup"><span data-stu-id="55ee6-183">When you're logged on, the "successfully created" page appears in the browser.</span></span>
3. <span data-ttu-id="55ee6-184">Cierre el explorador.</span><span class="sxs-lookup"><span data-stu-id="55ee6-184">Close the browser.</span></span>

### <a name="configure-the-azure-ad-application"></a><span data-ttu-id="55ee6-185">Configuración de la aplicación de Azure AD</span><span class="sxs-lookup"><span data-stu-id="55ee6-185">Configure the Azure AD application</span></span>
<span data-ttu-id="55ee6-186">Cuando se configuró la autenticación de Azure AD, el Servicio de aplicaciones creó automáticamente una aplicación de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="55ee6-186">When you configured Azure AD authentication, App Service created an Azure AD application for you.</span></span> <span data-ttu-id="55ee6-187">De forma predeterminada, la nueva aplicación de Azure AD se configuró para proporcionar el token de portador a la dirección URL de la aplicación de API.</span><span class="sxs-lookup"><span data-stu-id="55ee6-187">By default the new Azure AD application was configured to provide the bearer token to the API app's URL.</span></span> <span data-ttu-id="55ee6-188">En esta sección, configurará la aplicación de Azure AD para que proporcione el token de portador al front-end de AngularJS, en lugar de directamente a la aplicación de API de nivel intermedio.</span><span class="sxs-lookup"><span data-stu-id="55ee6-188">In this section you configure the Azure AD application to provide the bearer token to the AngularJS front end instead of directly to the middle tier API app.</span></span> <span data-ttu-id="55ee6-189">El front-end de AngularJS enviará el token a la aplicación de API al llamarla.</span><span class="sxs-lookup"><span data-stu-id="55ee6-189">The AngularJS front end will send the token to the API app when it calls the API app.</span></span>

> [!NOTE]
> <span data-ttu-id="55ee6-190">Para mantener el proceso lo más sencillo posible, en este tutorial se utiliza una aplicación única de Azure AD tanto para el front-end como para la aplicación de API de nivel intermedio.</span><span class="sxs-lookup"><span data-stu-id="55ee6-190">To keep the process as simple as possible, this tutorial uses a single Azure AD application for both the front end and the middle tier API app.</span></span> <span data-ttu-id="55ee6-191">Otra opción es usar dos aplicaciones de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="55ee6-191">Another option is to use two Azure AD applications.</span></span> <span data-ttu-id="55ee6-192">En ese caso, tendría que conceder permiso a la aplicación de Azure AD del front-end para llamar a la aplicación de Azure AD de nivel intermedio.</span><span class="sxs-lookup"><span data-stu-id="55ee6-192">In that case you would have to give the front end's Azure AD application permission to call the middle tier's Azure AD application.</span></span> <span data-ttu-id="55ee6-193">Este enfoque de varias aplicaciones le proporcionaría un control más específico sobre los permisos para cada nivel.</span><span class="sxs-lookup"><span data-stu-id="55ee6-193">This multi-application approach would give you more granular control over permissions to each tier.</span></span>
> 
> 

1. <span data-ttu-id="55ee6-194">En el [Portal de Azure clásico](https://manage.windowsazure.com/), vaya a **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="55ee6-194">In the [Azure classic portal](https://manage.windowsazure.com/), go to **Azure Active Directory**.</span></span>
   
   <span data-ttu-id="55ee6-195">Tiene que usar al portal clásico porque varias de las opciones de Azure Active Directory a las que necesita acceder aún no están disponibles en el Portal de Azure actual.</span><span class="sxs-lookup"><span data-stu-id="55ee6-195">You have to use the classic portal because certain Azure Active Directory settings that you need access to are not yet available in the current Azure portal.</span></span>
2. <span data-ttu-id="55ee6-196">En la pestaña **Directorio** , haga clic en su inquilino de AAD.</span><span class="sxs-lookup"><span data-stu-id="55ee6-196">On the **Directory** tab, click your AAD tenant.</span></span>
   
   ![Azure AD en el Portal clásico](./media/app-service-api-dotnet-user-principal-auth/selecttenant.png)
3. <span data-ttu-id="55ee6-198">Haga clic en **Aplicaciones > Aplicación propiedad de mi compañía** y, después, en la marca de verificación.</span><span class="sxs-lookup"><span data-stu-id="55ee6-198">Click **Applications > Applications my company owns**, and then click the check mark.</span></span>
   
   <span data-ttu-id="55ee6-199">También es posible que tenga que actualizar la página para ver la nueva aplicación.</span><span class="sxs-lookup"><span data-stu-id="55ee6-199">You might also have to refresh the page to see the new application.</span></span>
4. <span data-ttu-id="55ee6-200">En la lista de aplicaciones, haga clic en el nombre de aquella que Azure creó automáticamente cuando habilitó la autenticación para la aplicación de API.</span><span class="sxs-lookup"><span data-stu-id="55ee6-200">In the list of applications, click the name of the one that Azure created for you when you enabled authentication for your API app.</span></span>
   
   ![Pestaña Aplicaciones de Azure AD](./media/app-service-api-dotnet-user-principal-auth/appstab.png)
5. <span data-ttu-id="55ee6-202">Haga clic en **Configurar**.</span><span class="sxs-lookup"><span data-stu-id="55ee6-202">Click **Configure**.</span></span>
   
   ![Pestaña Configurar de Azure AD](./media/app-service-api-dotnet-user-principal-auth/configure.png)
6. <span data-ttu-id="55ee6-204">En **URL de inicio de sesión** , escriba la dirección URL de la aplicación web de AngularJS, sin barra diagonal final.</span><span class="sxs-lookup"><span data-stu-id="55ee6-204">Set **Sign-on URL** to the URL for your AngularJS web app, no trailing slash.</span></span>
   
   <span data-ttu-id="55ee6-205">Por ejemplo, https://todolistangular.azurewebsites.net.</span><span class="sxs-lookup"><span data-stu-id="55ee6-205">For example: https://todolistangular.azurewebsites.net</span></span>
   
   ![URL de inicio de sesión](./media/app-service-api-dotnet-user-principal-auth/signonurlazure.png)
7. <span data-ttu-id="55ee6-207">En **URL de respuesta** , escriba la dirección URL de su aplicación web, sin barra diagonal final.</span><span class="sxs-lookup"><span data-stu-id="55ee6-207">Set **Reply URL** to the URL for your web app, no trailing slash.</span></span>
   
   <span data-ttu-id="55ee6-208">Por ejemplo: https://todolistsangular.azurewebsites.net.</span><span class="sxs-lookup"><span data-stu-id="55ee6-208">For example: https://todolistsangular.azurewebsites.net</span></span>
8. <span data-ttu-id="55ee6-209">Haga clic en **Save**.</span><span class="sxs-lookup"><span data-stu-id="55ee6-209">Click **Save**.</span></span>
   
   ![URL de respuesta](./media/app-service-api-dotnet-user-principal-auth/replyurlazure.png)
9. <span data-ttu-id="55ee6-211">En la parte inferior de la página, haga clic en **Administrar manifiesto > Descargar manifiesto**.</span><span class="sxs-lookup"><span data-stu-id="55ee6-211">At the bottom of the page, click **Manage manifest > Download manifest**.</span></span>
   
   ![Descargar el manifiesto](./media/app-service-api-dotnet-user-principal-auth/downloadmanifest.png)
10. <span data-ttu-id="55ee6-213">Descargue el archivo en una ubicación en que pueda editar.</span><span class="sxs-lookup"><span data-stu-id="55ee6-213">Download the file to a location where you can edit it.</span></span>
11. <span data-ttu-id="55ee6-214">En el archivo de manifiesto descargado, busque la propiedad `oauth2AllowImplicitFlow`.</span><span class="sxs-lookup"><span data-stu-id="55ee6-214">In the downloaded manifest file, search for the  `oauth2AllowImplicitFlow` property.</span></span> <span data-ttu-id="55ee6-215">Cambie el valor de esta propiedad de `false` a `true` y después guarde el archivo.</span><span class="sxs-lookup"><span data-stu-id="55ee6-215">Change the value of this property from `false` to `true`, and then save the file.</span></span>
    
    <span data-ttu-id="55ee6-216">Esta configuración es necesaria para el acceso desde una aplicación de una página de JavaScript.</span><span class="sxs-lookup"><span data-stu-id="55ee6-216">This setting is required for access from a JavaScript single-page application.</span></span> <span data-ttu-id="55ee6-217">Permite que el token de portador de Oauth 2.0 se devuelva al fragmento de dirección URL.</span><span class="sxs-lookup"><span data-stu-id="55ee6-217">It enables the Oauth 2.0 bearer token to be returned in the URL fragment.</span></span>
12. <span data-ttu-id="55ee6-218">Haga clic en **Administrar manifiesto > Cargar manifiesto** y cargue el archivo actualizado en el paso anterior.</span><span class="sxs-lookup"><span data-stu-id="55ee6-218">Click **Manage manifest > Upload manifest**, and upload the file that you updated in the preceding step.</span></span>
    
    ![Cargar el manifiesto](./media/app-service-api-dotnet-user-principal-auth/uploadmanifest.png)
13. <span data-ttu-id="55ee6-220">Copie el valor de **Id. de cliente** y guárdelo en un lugar donde pueda recuperarlo más adelante.</span><span class="sxs-lookup"><span data-stu-id="55ee6-220">Copy the **Client ID** value and save it somewhere you can get it from later.</span></span>

## <a name="configure-the-todolistangular-project-to-use-authentication"></a><span data-ttu-id="55ee6-221">Configuración del proyecto ToDoListAngular para que use la autenticación</span><span class="sxs-lookup"><span data-stu-id="55ee6-221">Configure the ToDoListAngular project to use authentication</span></span>
<span data-ttu-id="55ee6-222">En esta sección, cambiará el front-end de AngularJS para que use la Biblioteca de autenticación de Active Directory (ADAL) para JS para adquirir en Azure AD un token de portador de usuario que ha iniciado sesión.</span><span class="sxs-lookup"><span data-stu-id="55ee6-222">In this section you change the AngularJS front end so that it uses Active Directory Authentication Library (ADAL) for JS to acquire a bearer token for the logged-on user from Azure AD.</span></span> <span data-ttu-id="55ee6-223">El código incluirá el token en las solicitudes HTTP enviadas al nivel intermedio, tal como se muestra en el diagrama siguiente.</span><span class="sxs-lookup"><span data-stu-id="55ee6-223">The code will include the token in HTTP requests sent to the middle tier, as shown in the following diagram.</span></span> 

![Diagrama de autenticación de usuario](./media/app-service-api-dotnet-user-principal-auth/appdiagram.png)

<span data-ttu-id="55ee6-225">Realice los cambios siguientes en los archivos del proyecto ToDoListAngular.</span><span class="sxs-lookup"><span data-stu-id="55ee6-225">Make the following changes to files in the ToDoListAngular project.</span></span>

1. <span data-ttu-id="55ee6-226">Abra el archivo *index.cshtml*.</span><span class="sxs-lookup"><span data-stu-id="55ee6-226">Open the *index.cshtml* file.</span></span>
2. <span data-ttu-id="55ee6-227">Quite la marca de comentario de las líneas que hacen referencia a la Biblioteca de autenticación de Active Directory (ADAL) para scripts JS.</span><span class="sxs-lookup"><span data-stu-id="55ee6-227">Uncomment the lines that reference the Active Directory Authentication Library (ADAL) for JS scripts.</span></span>
   
        <script src="app/scripts/adal.js"></script>
        <script src="app/scripts/adal-angular.js"></script>
3. <span data-ttu-id="55ee6-228">Abra el archivo *app/scripts/app.js* .</span><span class="sxs-lookup"><span data-stu-id="55ee6-228">Open the *app/scripts/app.js* file.</span></span>
4. <span data-ttu-id="55ee6-229">Convierta en comentario el bloque de código marcado para "sin autenticación" y quite la marca de comentario del bloque de código marcado para "con autenticación".</span><span class="sxs-lookup"><span data-stu-id="55ee6-229">Comment out the block of code marked for "without authentication" and uncomment the block of code marked for "with authentication".</span></span>
   
    <span data-ttu-id="55ee6-230">Este cambio hace referencia al proveedor de autenticación de ADAL JS y le proporciona los valores de configuración.</span><span class="sxs-lookup"><span data-stu-id="55ee6-230">This change references the ADAL JS authentication provider and provides configuration values to it.</span></span> <span data-ttu-id="55ee6-231">En los pasos siguientes, establezca los valores de configuración tanto de su aplicación de API como de la aplicación de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="55ee6-231">In the following steps you set the configuration values for your API app and Azure AD application.</span></span>
5. <span data-ttu-id="55ee6-232">En el código que establece la variable `endpoints` , establezca la dirección URL de la API en la dirección URL de la aplicación de API que creó para el proyecto ToDoListAPI y establezca el identificador de la aplicación de Azure AD en el identificador de cliente que copió del Portal de Azure clásico.</span><span class="sxs-lookup"><span data-stu-id="55ee6-232">In the code that sets the `endpoints` variable, set the API URL to the URL of the API app that you created for the ToDoListAPI project, and set the Azure AD application ID to the client ID that you copied from the Azure classic portal.</span></span>
   
    <span data-ttu-id="55ee6-233">El código será similar al del ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="55ee6-233">The code is now similar to the following example.</span></span>
   
        var endpoints = {
            "https://todolistapi0121.azurewebsites.net/": "1cf55bc9-9ed8-4df31cf55bc9-9ed8-4df3"
        };
6. <span data-ttu-id="55ee6-234">En la llamada a `adalProvider.init`, establezca `tenant` en el nombre del inquilino y `clientId` en el mismo valor que usó en el paso anterior.</span><span class="sxs-lookup"><span data-stu-id="55ee6-234">In the call to `adalProvider.init`, set `tenant` to your tenant name and `clientId` to same value you used in the previous step.</span></span>
   
    <span data-ttu-id="55ee6-235">El código será similar al del ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="55ee6-235">The code is now similar to the following example.</span></span>
   
        adalProvider.init(
            {
                instance: 'https://login.microsoftonline.com/', 
                tenant: 'contoso.onmicrosoft.com',
                clientId: '1cf55bc9-9ed8-4df31cf55bc9-9ed8-4df3',
                extraQueryParameter: 'nux=1',
                endpoints: endpoints
            },
            $httpProvider
            );
   
    <span data-ttu-id="55ee6-236">Estos cambios en `app.js` especifican que el código de llamada y la API a la que se ha llamado están en la misma aplicación de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="55ee6-236">These changes to `app.js` specify that the calling code and the called API are in the same Azure AD application.</span></span>
7. <span data-ttu-id="55ee6-237">Abra el archivo *app/scripts/homeCtrl.js* .</span><span class="sxs-lookup"><span data-stu-id="55ee6-237">Open the *app/scripts/homeCtrl.js* file.</span></span>
8. <span data-ttu-id="55ee6-238">Convierta en comentario el bloque de código marcado para "sin autenticación" y quite la marca de comentario del bloque de código marcado para "con autenticación".</span><span class="sxs-lookup"><span data-stu-id="55ee6-238">Comment out the block of code marked for "without authentication" and uncomment the block of code marked for "with authentication".</span></span>
9. <span data-ttu-id="55ee6-239">Abra el archivo *app/scripts/indexCtrl.js* .</span><span class="sxs-lookup"><span data-stu-id="55ee6-239">Open the *app/scripts/indexCtrl.js* file.</span></span>
10. <span data-ttu-id="55ee6-240">Convierta en comentario el bloque de código marcado para "sin autenticación" y quite la marca de comentario del bloque de código marcado para "con autenticación".</span><span class="sxs-lookup"><span data-stu-id="55ee6-240">Comment out the block of code marked for "without authentication" and uncomment the block of code marked for "with authentication".</span></span>

### <a name="deploy-the-todolistangular-project-to-azure"></a><span data-ttu-id="55ee6-241">Implementación del proyecto ToDoListAngular en Azure</span><span class="sxs-lookup"><span data-stu-id="55ee6-241">Deploy the ToDoListAngular project to Azure</span></span>
1. <span data-ttu-id="55ee6-242">En el **Explorador de soluciones**, haga clic con el botón derecho en el proyecto ToDoListAngular y, después, en **Publicar**.</span><span class="sxs-lookup"><span data-stu-id="55ee6-242">In **Solution Explorer**, right-click the ToDoListAngular project, and then click **Publish**.</span></span>
2. <span data-ttu-id="55ee6-243">Haga clic en **Publicar**.</span><span class="sxs-lookup"><span data-stu-id="55ee6-243">Click **Publish**.</span></span>
   
    <span data-ttu-id="55ee6-244">Visual Studio implementa el proyecto y abre un explorador en la dirección URL base de la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="55ee6-244">Visual Studio deploys the project and opens a browser to the web app's base URL.</span></span> <span data-ttu-id="55ee6-245">Esto mostrará una página de error 403, lo que es normal cuando se intenta ir a una dirección URL base de Web API desde un explorador.</span><span class="sxs-lookup"><span data-stu-id="55ee6-245">This will show a 403 error page, which is normal for an attempt to go to a Web API base URL from a browser.</span></span>
   
    <span data-ttu-id="55ee6-246">Para poder probar la aplicación, será preciso que previamente realice un cambio en la aplicación de API de nivel intermedio.</span><span class="sxs-lookup"><span data-stu-id="55ee6-246">You still have to make a change to the middle tier API app before you can test the application.</span></span>
3. <span data-ttu-id="55ee6-247">Cierre el explorador.</span><span class="sxs-lookup"><span data-stu-id="55ee6-247">Close the browser.</span></span>

## <a name="configure-the-todolistapi-project-to-use-authentication"></a><span data-ttu-id="55ee6-248">Configuración del proyecto ToDoListAPI para que use la autenticación</span><span class="sxs-lookup"><span data-stu-id="55ee6-248">Configure the ToDoListAPI project to use authentication</span></span>
<span data-ttu-id="55ee6-249">Actualmente, el proyecto ToDoListAPI envía "*" como valor de `owner` a ToDoListDataAPI.</span><span class="sxs-lookup"><span data-stu-id="55ee6-249">Currently the ToDoListAPI project sends "*" as the `owner` value to ToDoListDataAPI.</span></span> <span data-ttu-id="55ee6-250">En esta sección cambiará el código para enviar el identificador del usuario que ha iniciado sesión.</span><span class="sxs-lookup"><span data-stu-id="55ee6-250">In this section you change the code to send the ID of the logged-on user.</span></span>

<span data-ttu-id="55ee6-251">Realice los cambios siguientes en el proyecto ToDoListAPI.</span><span class="sxs-lookup"><span data-stu-id="55ee6-251">Make the following changes in the ToDoListAPI project.</span></span>

1. <span data-ttu-id="55ee6-252">Abra el archivo *Controllers/ToDoListController.cs* y quite la marca de comentario de la línea en cada método de acción que establece `owner` en el valor de la notificación `NameIdentifier` de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="55ee6-252">Open the *Controllers/ToDoListController.cs* file, and uncomment the line in each action method that sets `owner` to the Azure AD `NameIdentifier` claim value.</span></span> <span data-ttu-id="55ee6-253">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="55ee6-253">For example:</span></span>
   
        owner = ((ClaimsIdentity)User.Identity).FindFirst(ClaimTypes.NameIdentifier).Value;
   
    <span data-ttu-id="55ee6-254">**Importante**: No quite la marca de comentario del código en el método `ToDoListDataAPI`; lo hará más adelante en el tutorial de autenticación de la entidad de servicio.</span><span class="sxs-lookup"><span data-stu-id="55ee6-254">**Important**: Don't uncomment code in the `ToDoListDataAPI` method; you'll do that later for the service principal authentication tutorial.</span></span>

### <a name="deploy-the-todolistapi-project-to-azure"></a><span data-ttu-id="55ee6-255">Implementación del proyecto ToDoListAPI en Azure</span><span class="sxs-lookup"><span data-stu-id="55ee6-255">Deploy the ToDoListAPI project to Azure</span></span>
1. <span data-ttu-id="55ee6-256">En el **Explorador de soluciones**, haga clic con el botón derecho en el proyecto ToDoListAPI y haga clic en **Publicar**.</span><span class="sxs-lookup"><span data-stu-id="55ee6-256">In **Solution Explorer**, right-click the ToDoListAPI project, and then click **Publish**.</span></span>
2. <span data-ttu-id="55ee6-257">Haga clic en **Publicar**.</span><span class="sxs-lookup"><span data-stu-id="55ee6-257">Click **Publish**.</span></span>
   
    <span data-ttu-id="55ee6-258">Visual Studio implementa el proyecto y abre un explorador en la URL base de la aplicación de API.</span><span class="sxs-lookup"><span data-stu-id="55ee6-258">Visual Studio deploys the project and opens a browser to the API app's base URL.</span></span>
3. <span data-ttu-id="55ee6-259">Cierre el explorador.</span><span class="sxs-lookup"><span data-stu-id="55ee6-259">Close the browser.</span></span>

### <a name="test-the-application"></a><span data-ttu-id="55ee6-260">Prueba de la aplicación</span><span class="sxs-lookup"><span data-stu-id="55ee6-260">Test the application</span></span>
1. <span data-ttu-id="55ee6-261">Vaya a la dirección URL de la aplicación web, **mediante HTTPS, no HTTP**.</span><span class="sxs-lookup"><span data-stu-id="55ee6-261">Go to the URL of the web app, **using HTTPS, not HTTP**.</span></span>
2. <span data-ttu-id="55ee6-262">Haga clic en la pestaña **Lista de tareas pendientes** .</span><span class="sxs-lookup"><span data-stu-id="55ee6-262">Click the **To Do List** tab.</span></span>
   
    <span data-ttu-id="55ee6-263">Se le pedirá que inicie sesión.</span><span class="sxs-lookup"><span data-stu-id="55ee6-263">You are prompted to log in.</span></span>
3. <span data-ttu-id="55ee6-264">Inicie sesión con las credenciales de usuario en su inquilino de AAD.</span><span class="sxs-lookup"><span data-stu-id="55ee6-264">Log in with the credentials of a user in your AAD tenant.</span></span>
4. <span data-ttu-id="55ee6-265">Aparece la página **Lista de tareas pendientes** .</span><span class="sxs-lookup"><span data-stu-id="55ee6-265">The **To Do List** page appears.</span></span>
   
   ![Página de Lista de tareas pendientes](./media/app-service-api-dotnet-user-principal-auth/webappindex.png)
   
   <span data-ttu-id="55ee6-267">No se muestran tareas pendientes porque hasta todas han sido para el propietario "*".</span><span class="sxs-lookup"><span data-stu-id="55ee6-267">No to-do items are displayed because until now they have all been for owner "*".</span></span> <span data-ttu-id="55ee6-268">Ahora el nivel intermedio solicita tareas para el usuario que ha iniciado sesión y aún no se ha creado ninguna.</span><span class="sxs-lookup"><span data-stu-id="55ee6-268">Now the middle tier is requesting items for the logged-on user, and none have been created yet.</span></span>
5. <span data-ttu-id="55ee6-269">Agregue nuevas tareas pendientes para comprobar que la aplicación funciona.</span><span class="sxs-lookup"><span data-stu-id="55ee6-269">Add new to-do items to verify that the application is working.</span></span>
6. <span data-ttu-id="55ee6-270">En otra ventana del explorador, vaya a la dirección URL de la interfaz de usuario de Swagger para la aplicación de API de ToDoListDataAPI y haga clic en **ToDoList > Get** (ToDoList > Obtener).</span><span class="sxs-lookup"><span data-stu-id="55ee6-270">In another browser window, go to the Swagger UI URL for the ToDoListDataAPI API app and click **ToDoList > Get**.</span></span> <span data-ttu-id="55ee6-271">Escriba un asterisco en el parámetro `owner` y haga clic en **Try it out**(Probarlo).</span><span class="sxs-lookup"><span data-stu-id="55ee6-271">Enter an asterisk for the `owner` parameter, and then click **Try it out**.</span></span>
   
   <span data-ttu-id="55ee6-272">La respuesta muestra que las nuevas tareas pendientes tienen el identificador de usuario real de Azure AD en la propiedad Owner.</span><span class="sxs-lookup"><span data-stu-id="55ee6-272">The response shows that the new to-do items have the actual Azure AD user ID in the Owner property.</span></span>
   
   ![Id. de propietario en respuesta JSON](./media/app-service-api-dotnet-user-principal-auth/todolistapiauth.png)

## <a name="building-the-projects-from-scratch"></a><span data-ttu-id="55ee6-274">Creación de los proyectos desde cero</span><span class="sxs-lookup"><span data-stu-id="55ee6-274">Building the projects from scratch</span></span>
<span data-ttu-id="55ee6-275">Los dos proyectos de Web API se crearon con la plantilla de proyecto **Aplicación de API de Azure** y reemplazando el controlador de los valores predeterminados por un controlador de ToDoList.</span><span class="sxs-lookup"><span data-stu-id="55ee6-275">The two Web API projects were created by using the **Azure API App** project template and replacing the default Values controller with a ToDoList controller.</span></span> 

<span data-ttu-id="55ee6-276">Para más información sobre cómo crear una aplicación de una página de AngularJS con un back-end de API web 2, consulte [Hands On Lab: Build a Single Page Application (SPA) with ASP.NET Web API and Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs)(Laboratorio práctico: creación de una aplicación de una sola página con ASP.NET Web API y Angular.js).</span><span class="sxs-lookup"><span data-stu-id="55ee6-276">For information about how to  create an AngularJS single-page application with a Web API 2 back end, see  [Hands On Lab: Build a Single Page Application (SPA) with ASP.NET Web API and Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span></span> <span data-ttu-id="55ee6-277">Para obtener información acerca de cómo agregar código de autenticación de Azure AD, consulte los siguientes recursos:</span><span class="sxs-lookup"><span data-stu-id="55ee6-277">For information about how to add Azure AD authentication code, see the following resources:</span></span>

* <span data-ttu-id="55ee6-278">[Seguridad de las aplicaciones de una sola página AngularJS con Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span><span class="sxs-lookup"><span data-stu-id="55ee6-278">[Securing AngularJS Single Page Apps with Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span></span>
* [<span data-ttu-id="55ee6-279">Introducing ADAL JS v1 (Presentación de ADAL JS v1)</span><span class="sxs-lookup"><span data-stu-id="55ee6-279">Introducing ADAL JS v1</span></span>](http://www.cloudidentity.com/blog/2015/02/19/introducing-adal-js-v1/)

## <a name="troubleshooting"></a><span data-ttu-id="55ee6-280">Solución de problemas</span><span class="sxs-lookup"><span data-stu-id="55ee6-280">Troubleshooting</span></span>
[!INCLUDE [troubleshooting](../../includes/app-service-api-auth-troubleshooting.md)]

* <span data-ttu-id="55ee6-281">Asegúrese de no confundir ToDoListAPI (nivel intermedio) con ToDoListDataAPI (capa de datos).</span><span class="sxs-lookup"><span data-stu-id="55ee6-281">Make sure that you don't confuse ToDoListAPI (middle tier) and ToDoListDataAPI (data tier).</span></span> <span data-ttu-id="55ee6-282">Por ejemplo, compruebe que ha agregado autenticación a la aplicación de API de nivel intermedio, no a la capa de datos.</span><span class="sxs-lookup"><span data-stu-id="55ee6-282">For example, verify that you added authentication to the middle tier API app, not the data tier.</span></span> 
* <span data-ttu-id="55ee6-283">Asegúrese de que el código fuente de AngularJS hace referencia a la URL de la aplicación de API de nivel intermedio (ToDoListAPI, no ToDoListDataAPI) y al identificador de cliente de Azure AD correcto.</span><span class="sxs-lookup"><span data-stu-id="55ee6-283">Make sure that the AngularJS source code references the middle tier API app URL (ToDoListAPI, not ToDoListDataAPI)and the correct Azure AD client ID.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="55ee6-284">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="55ee6-284">Next steps</span></span>
<span data-ttu-id="55ee6-285">En este tutorial ha aprendido a utilizar la autenticación del Servicio de aplicaciones para una aplicación de API y a llamar a la aplicación de API mediante la biblioteca de ADAL JS.</span><span class="sxs-lookup"><span data-stu-id="55ee6-285">In this tutorial you learned how to use App Service authentication for an API app and how to call the API app by using the ADAL JS library.</span></span> <span data-ttu-id="55ee6-286">En el siguiente tutorial aprenderá a [acceder de forma segura a la aplicación de API en escenarios de servicio a servicio](app-service-api-dotnet-service-principal-auth.md).</span><span class="sxs-lookup"><span data-stu-id="55ee6-286">In the next tutorial you'll learn how to [secure access to your API app for service-to-service scenarios](app-service-api-dotnet-service-principal-auth.md).</span></span>


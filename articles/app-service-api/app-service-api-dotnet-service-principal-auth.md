---
title: "aaaService autenticación principal para las aplicaciones de API de servicio de aplicaciones de Azure | Documentos de Microsoft"
description: "Obtenga información acerca de la aplicación de tooprotect una API de servicio de aplicaciones de Azure para escenarios de servicio al servicio."
services: app-service\api
documentationcenter: .net
author: alexkarcher-msft
manager: erikre
editor: 
ms.assetid: 7ca0bab2-1d29-4d51-b779-dce0edd34f8b
ms.service: app-service-api
ms.workload: na
ms.tgt_pltfrm: dotnet
ms.devlang: na
ms.topic: article
ms.date: 06/30/2016
ms.author: alkarche
ms.openlocfilehash: 94d9ee11f38293df4a2fd815ef02c59cc6defed4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="service-principal-authentication-for-api-apps-in-azure-app-service"></a><span data-ttu-id="400f4-103">Autenticación de entidad de servicio para Aplicaciones de API en el Servicio de aplicaciones de Azure</span><span class="sxs-lookup"><span data-stu-id="400f4-103">Service principal authentication for API Apps in Azure App Service</span></span>
## <a name="overview"></a><span data-ttu-id="400f4-104">Información general</span><span class="sxs-lookup"><span data-stu-id="400f4-104">Overview</span></span>
<span data-ttu-id="400f4-105">Este artículo se explica cómo toouse autenticación de servicio de aplicaciones para *interno* acceder a las aplicaciones de tooAPI.</span><span class="sxs-lookup"><span data-stu-id="400f4-105">This article explains how toouse App Service authentication for *internal* access tooAPI apps.</span></span> <span data-ttu-id="400f4-106">Un escenario interno es donde haya una aplicación de API que desea toobe pueden utilizar su propio código de aplicación.</span><span class="sxs-lookup"><span data-stu-id="400f4-106">An internal scenario is where you have an API app that you want toobe consumable only by your own application code.</span></span> <span data-ttu-id="400f4-107">Hola recomienda forma tooimplement este escenario en el servicio de aplicaciones se toouse Azure AD tooprotect Hola llama aplicación de API.</span><span class="sxs-lookup"><span data-stu-id="400f4-107">hello recommended way tooimplement this scenario in App Service is toouse Azure AD tooprotect hello called API app.</span></span> <span data-ttu-id="400f4-108">Se llama a la aplicación de API de hello protegido con un token de portador que obtendrá de Azure AD proporcionando las credenciales (entidad de servicio) de identidad de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="400f4-108">You call hello protected API app with a bearer token that you get from Azure AD by providing application identity (service principal) credentials.</span></span> <span data-ttu-id="400f4-109">Para alternativas toousing Azure AD, vea hello **autenticación del servicio a servicio** sección de hello [información general de la autenticación de servicio de aplicaciones de Azure](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span><span class="sxs-lookup"><span data-stu-id="400f4-109">For alternatives toousing Azure AD, see hello **Service-to-service authentication** section of hello [Azure App Service authentication overview](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span></span>

<span data-ttu-id="400f4-110">En este artículo, aprenderá lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="400f4-110">In this article, you'll learn:</span></span>

* <span data-ttu-id="400f4-111">La aplicación de tooprotect una API de Azure Active Directory (Azure AD) toouse de acceso no autenticado.</span><span class="sxs-lookup"><span data-stu-id="400f4-111">How toouse Azure Active Directory (Azure AD) tooprotect an API app from unauthenticated access.</span></span>
* <span data-ttu-id="400f4-112">La aplicación de tooconsume API protegida desde una aplicación de API, aplicación web o aplicación móvil mediante el uso de credenciales de la entidad de seguridad (identidad de aplicación) de servicio de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="400f4-112">How tooconsume a protected API app from an API app, web app, or mobile app by using Azure AD service principal (app identity) credentials.</span></span> <span data-ttu-id="400f4-113">Para obtener información acerca de cómo tooconsume desde una aplicación de lógica, consulte [mediante la API personalizada hospedada en el servicio de aplicaciones a las aplicaciones lógicas](../logic-apps/logic-apps-custom-hosted-api.md).</span><span class="sxs-lookup"><span data-stu-id="400f4-113">For information about how tooconsume from a logic app, see [Using your custom API hosted on App Service with Logic apps](../logic-apps/logic-apps-custom-hosted-api.md).</span></span>
* <span data-ttu-id="400f4-114">Cómo toomake seguro de que Hola protegido aplicación de API no se puede llamar desde un explorador, para iniciar sesión a los usuarios.</span><span class="sxs-lookup"><span data-stu-id="400f4-114">How toomake sure that hello protected API app can't be called from a browser by logged on users.</span></span>
* <span data-ttu-id="400f4-115">Cómo toomake seguro de que Hola protegido aplicación de API solo puede llamarse mediante un determinado entidad de servicio de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="400f4-115">How toomake sure that hello protected API app can only be called by a specific Azure AD service principal.</span></span>

<span data-ttu-id="400f4-116">artículo de Hello contiene dos secciones:</span><span class="sxs-lookup"><span data-stu-id="400f4-116">hello article contains two sections:</span></span>

* <span data-ttu-id="400f4-117">Hola [cómo tooconfigure service autenticación principal en el servicio de aplicación de Azure](#authconfig) sección se explica cómo general tooconfigure autenticación para cualquier aplicación de API y cómo hello tooconsume protección de aplicación de API.</span><span class="sxs-lookup"><span data-stu-id="400f4-117">hello [How tooconfigure service principal authentication in Azure App Service](#authconfig) section explains in general how tooconfigure authentication for any API app, and how tooconsume hello protected API app.</span></span> <span data-ttu-id="400f4-118">En esta sección se aplica por igual marcos tooall compatibles con el servicio de aplicación, incluido. NET, Node.js y Java.</span><span class="sxs-lookup"><span data-stu-id="400f4-118">This section applies equally tooall frameworks supported by App Service, including .NET, Node.js, and Java.</span></span>
* <span data-ttu-id="400f4-119">A partir de hello [continuar tutoriales de introducción a .NET de hello](#tutorialstart) sección tutorial Hola le guía a través de configuración de un escenario de "acceso interno" para una aplicación de ejemplo de .NET en ejecución en el servicio de aplicación.</span><span class="sxs-lookup"><span data-stu-id="400f4-119">Starting with hello [Continuing hello .NET getting-started tutorials](#tutorialstart) section, hello tutorial guides you through configuring an "internal access" scenario for a .NET sample application running in App Service.</span></span> 

## <span data-ttu-id="400f4-120"><a id="authconfig"></a>Cómo tooconfigure service autenticación principal en el servicio de aplicación de Azure</span><span class="sxs-lookup"><span data-stu-id="400f4-120"><a id="authconfig"></a> How tooconfigure service principal authentication in Azure App Service</span></span>
<span data-ttu-id="400f4-121">Esta sección proporciona instrucciones generales que se aplican a la aplicación de API de tooany.</span><span class="sxs-lookup"><span data-stu-id="400f4-121">This section provides general instructions that apply tooany API app.</span></span> <span data-ttu-id="400f4-122">Para pasos específicos toohello tooDo aplicación de ejemplo de .NET de la lista, vaya demasiado[continuar serie de tutoriales de aplicaciones de API de .NET de hello](#tutorialstart).</span><span class="sxs-lookup"><span data-stu-id="400f4-122">For steps specific toohello tooDo List .NET sample application, go too[Continuing hello .NET API Apps tutorial series](#tutorialstart).</span></span>

1. <span data-ttu-id="400f4-123">Hola [portal de Azure](https://portal.azure.com/), navegue toohello **configuración** hoja de aplicación de hello API que desee tooprotect y, a continuación, busque hello **características** sección y haga clic en **Autenticación / autorización**.</span><span class="sxs-lookup"><span data-stu-id="400f4-123">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you want tooprotect, and then find hello **Features** section and click **Authentication/ Authorization**.</span></span>
   
    ![Autenticación/autorización en el Portal de Azure](./media/app-service-api-dotnet-user-principal-auth/features.png)
2. <span data-ttu-id="400f4-125">Hola **autenticación / autorización** hoja, haga clic en **en**.</span><span class="sxs-lookup"><span data-stu-id="400f4-125">In hello **Authentication / Authorization** blade, click **On**.</span></span>
3. <span data-ttu-id="400f4-126">Hola **tootake de acción cuando no se autentica la solicitud** lista desplegable, seleccione **iniciar sesión con Azure Active Directory** .</span><span class="sxs-lookup"><span data-stu-id="400f4-126">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory** .</span></span>
4. <span data-ttu-id="400f4-127">En **Proveedores de autenticación,** seleccione **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="400f4-127">Under **Authentication Providers**, select **Azure Active Directory**.</span></span>
   
    ![Hoja Autenticación/autorización del Portal de Azure](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
5. <span data-ttu-id="400f4-129">Configurar hello **configuración de Azure Active Directory** hoja toocreate un Azure nueva aplicación de AD, o utilizar una aplicación de Azure AD existente si ya tiene una que desea toouse.</span><span class="sxs-lookup"><span data-stu-id="400f4-129">Configure hello **Azure Active Directory Settings** blade toocreate a new Azure AD application, or use an existing Azure AD application if you already have one that you want toouse.</span></span>
   
    <span data-ttu-id="400f4-130">En los escenarios internos normalmente hay una aplicación de API que llama a una aplicación de API.</span><span class="sxs-lookup"><span data-stu-id="400f4-130">Internal scenarios typically involve an API app calling an API app.</span></span> <span data-ttu-id="400f4-131">Puede usar aplicaciones de AD independientes para cada aplicación de API o una sola aplicación de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="400f4-131">You can use separate Azure AD applications for each API app or just one Azure AD application.</span></span>
   
    <span data-ttu-id="400f4-132">Para obtener instrucciones detalladas sobre esta hoja, vea [cómo tooconfigure su inicio de sesión de Azure Active Directory de servicio de aplicaciones aplicación toouse](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="400f4-132">For detailed instructions on this blade, see [How tooconfigure your App Service application toouse Azure Active Directory login](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span></span>
6. <span data-ttu-id="400f4-133">Cuando haya terminado con la hoja de configuración de proveedor de autenticación de hello, haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="400f4-133">When you're done with hello authentication provider configuration blade, click **OK**.</span></span>
7. <span data-ttu-id="400f4-134">Hola **autenticación / autorización** hoja, haga clic en **guardar**.</span><span class="sxs-lookup"><span data-stu-id="400f4-134">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
   
    ![Haga clic en Guardar](./media/app-service-api-dotnet-service-principal-auth/authsave.png)

<span data-ttu-id="400f4-136">Cuando esto sucede, servicio de aplicaciones solo permite las solicitudes de los llamadores de inquilino de Azure AD Hola configurado.</span><span class="sxs-lookup"><span data-stu-id="400f4-136">When this is done, App Service only allows requests from callers in hello configured Azure AD tenant.</span></span> <span data-ttu-id="400f4-137">No se requiere ningún código de autenticación o autorización de aplicación de API de hello protegido.</span><span class="sxs-lookup"><span data-stu-id="400f4-137">No authentication or authorization code is required in hello protected API app.</span></span> <span data-ttu-id="400f4-138">Hello token de portador se pasa toohello API aplicación junto con notificaciones de uso frecuente en encabezados HTTP, y puede leer esa información en código toovalidate que las solicitudes proceden de un determinado autor de llamada, como una entidad de servicio.</span><span class="sxs-lookup"><span data-stu-id="400f4-138">hello bearer token is passed toohello API app along with commonly used claims in HTTP headers, and you can read that information in code toovalidate that requests are from a particular caller, such as a service principal.</span></span>

<span data-ttu-id="400f4-139">Esta funcionalidad de autenticación funciona Hola admite ese servicio de aplicaciones de igual en todos los idiomas, incluido. NET, Node.js y Java.</span><span class="sxs-lookup"><span data-stu-id="400f4-139">This authentication functionality works hello same way for all languages that App service supports, including .NET, Node.js, and Java.</span></span> 

#### <a name="how-tooconsume-hello-protected-api-app"></a><span data-ttu-id="400f4-140">Cómo tooconsume Hola protección de aplicación de API</span><span class="sxs-lookup"><span data-stu-id="400f4-140">How tooconsume hello protected API app</span></span>
<span data-ttu-id="400f4-141">llamador de Hello debe proporcionar un token de portador de Azure AD con llamadas a API.</span><span class="sxs-lookup"><span data-stu-id="400f4-141">hello caller must provide an Azure AD bearer token with API calls.</span></span> <span data-ttu-id="400f4-142">tooget un token de portador con credenciales de servicio principal, el llamador de hello usa biblioteca de autenticación de Active Directory (ADAL para [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), o [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span><span class="sxs-lookup"><span data-stu-id="400f4-142">tooget a bearer token using service principal credentials, hello caller uses Active Directory Authentication Library (ADAL for [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), or [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span></span> <span data-ttu-id="400f4-143">tooget un token, código de hello que llama a AAL proporciona hello tooADAL siguiente información:</span><span class="sxs-lookup"><span data-stu-id="400f4-143">tooget a token, hello code that calls ADAL provides tooADAL hello following information:</span></span>

* <span data-ttu-id="400f4-144">nombre de Hello del inquilino de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="400f4-144">hello name of your Azure AD tenant.</span></span>
* <span data-ttu-id="400f4-145">Hola cliente y el identificador de secreto del cliente (clave de aplicación) de aplicación hello Azure AD asociado con un llamador de Hola.</span><span class="sxs-lookup"><span data-stu-id="400f4-145">hello client ID and client secret (app key) of hello Azure AD app associated with hello caller.</span></span>
* <span data-ttu-id="400f4-146">Hola Id. de cliente de aplicación de Azure AD asociada Hola Hola protegido aplicación de API.</span><span class="sxs-lookup"><span data-stu-id="400f4-146">hello client ID of hello Azure AD application associated with hello protected API app.</span></span> <span data-ttu-id="400f4-147">(Si se usa una sola aplicación de Azure AD, esto es Hola mismo identificador de cliente como uno para el llamador de Hola Hola.)</span><span class="sxs-lookup"><span data-stu-id="400f4-147">(If just one Azure AD application is used, this is hello same client ID as hello one for hello caller.)</span></span>

<span data-ttu-id="400f4-148">Estos valores están disponibles en las páginas de hello Azure AD de hello [portal de Azure clásico](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="400f4-148">These values are available in hello Azure AD pages of hello [Azure classic portal](https://manage.windowsazure.com/).</span></span>

<span data-ttu-id="400f4-149">Una vez que se ha adquirido el token de hello, llamador Hola incluye con las solicitudes HTTP en el encabezado de autorización de Hola.</span><span class="sxs-lookup"><span data-stu-id="400f4-149">Once hello token has been acquired, hello caller includes it with HTTP requests in hello Authorization header.</span></span>  <span data-ttu-id="400f4-150">Servicio de aplicación valida el token de Hola y permite Hola Hola de tooreach solicitudes protegido aplicación de API.</span><span class="sxs-lookup"><span data-stu-id="400f4-150">App Service validates hello token and allows hello requests tooreach hello protected API app.</span></span>

#### <a name="how-tooprotect-hello-api-app-from-access-by-users-in-hello-same-tenant"></a><span data-ttu-id="400f4-151">¿Cómo tooprotect Hola API aplicación del acceso de los usuarios de hello mismo inquilino</span><span class="sxs-lookup"><span data-stu-id="400f4-151">How tooprotect hello API app from access by users in hello same tenant</span></span>
<span data-ttu-id="400f4-152">Tokens de portador para los usuarios de hello mismo inquilino se consideran válidos para hello protegen aplicación de API.</span><span class="sxs-lookup"><span data-stu-id="400f4-152">Bearer tokens for users in hello same tenant are considered valid for hello protected API app.</span></span>  <span data-ttu-id="400f4-153">Si desea que tooensure que puede llamar un servicio principal Hola aplicación API protegida, agregar código de hello protegido Hola de toovalidate de aplicación de API después de las notificaciones de token de hello:</span><span class="sxs-lookup"><span data-stu-id="400f4-153">If you want tooensure that only a service principal can call hello protected API app, add code in hello protected API app toovalidate hello following claims from hello token:</span></span>

* <span data-ttu-id="400f4-154">`appid`debe ser el identificador de cliente de Hola de aplicación de Azure AD de Hola que está asociado con el autor de llamada de Hola.</span><span class="sxs-lookup"><span data-stu-id="400f4-154">`appid` should be hello client ID of hello Azure AD application that is associated with hello caller.</span></span> 
* <span data-ttu-id="400f4-155">`oid`(`objectidentifier`) debe ser el identificador de entidad de seguridad de servicio de Hola del autor de llamada de Hola.</span><span class="sxs-lookup"><span data-stu-id="400f4-155">`oid` (`objectidentifier`) should be hello service principal ID of hello caller.</span></span> 

<span data-ttu-id="400f4-156">Servicio de aplicaciones también proporciona hello `objectidentifier` notificación en el encabezado X-MS-CLIENT-entidad de seguridad-ID de Hola.</span><span class="sxs-lookup"><span data-stu-id="400f4-156">App Service also provides hello `objectidentifier` claim in hello X-MS-CLIENT-PRINCIPAL-ID header.</span></span>

### <a name="how-tooprotect-hello-api-app-from-browser-access"></a><span data-ttu-id="400f4-157">¿Cómo tooprotect Hola aplicación de API de acceso de explorador</span><span class="sxs-lookup"><span data-stu-id="400f4-157">How tooprotect hello API app from browser access</span></span>
<span data-ttu-id="400f4-158">Si no valida las notificaciones en el código de aplicación de API de hello protegido, y si usa un independiente aplicación de Azure AD para hello protegido aplicación de API, asegúrese de que ese hello es la dirección URL de respuesta de la aplicación de Azure AD no Hola igual que la dirección URL base de la aplicación de API de Hola.</span><span class="sxs-lookup"><span data-stu-id="400f4-158">If you don't validate claims in code in hello protected API app, and if you use a separate Azure AD application for hello protected API app, make sure that hello Azure AD application's Reply URL is not hello same as hello API app's base URL.</span></span> <span data-ttu-id="400f4-159">Si Hola dirección URL de respuesta apunta directamente aplicación de API de toohello protegido, un usuario inquilino Hola mismo AD de Azure podría examinar la aplicación de API de toohello, inicie sesión y llamar correctamente a la API de Hola.</span><span class="sxs-lookup"><span data-stu-id="400f4-159">If hello Reply URL points directly toohello protected API app, a user in hello same Azure AD tenant could browse toohello API app, log on, and successfully call hello API.</span></span>

## <span data-ttu-id="400f4-160"><a id="tutorialstart"></a>Continuar la serie de tutoriales de aplicaciones de API de .NET de Hola</span><span class="sxs-lookup"><span data-stu-id="400f4-160"><a id="tutorialstart"></a> Continuing hello .NET API Apps tutorial series</span></span>
<span data-ttu-id="400f4-161">Si está siguiendo hello Node.js o Java serie de tutoriales para aplicaciones de API, omitir toohello [pasos siguientes](#next-steps) sección.</span><span class="sxs-lookup"><span data-stu-id="400f4-161">If you are following hello Node.js or Java tutorial series for API apps, skip toohello [Next steps](#next-steps) section.</span></span> 

<span data-ttu-id="400f4-162">resto de Hola de este artículo continúa la serie de tutoriales de aplicaciones de API de .NET de Hola y se da por supuesto que se completaron hello [tutorial de autenticación de usuario](app-service-api-dotnet-user-principal-auth.md) y se ejecuta en Azure con autenticación de usuarios de aplicación de ejemplo de Hola habilitado.</span><span class="sxs-lookup"><span data-stu-id="400f4-162">hello remainder of this article continues hello .NET API Apps tutorial series and assumes that you have completed hello [user authentication tutorial](app-service-api-dotnet-user-principal-auth.md) and have hello sample application running in Azure with user authentication enabled.</span></span>

## <a name="set-up-authentication-in-azure"></a><span data-ttu-id="400f4-163">Configuración de la autenticación en Azure</span><span class="sxs-lookup"><span data-stu-id="400f4-163">Set up authentication in Azure</span></span>
<span data-ttu-id="400f4-164">En esta sección Configurar servicio de aplicaciones por lo que ese Hola solicitudes de HTTP solo permite la aplicación de API de nivel de datos de tooreach Hola Hola las que tienen Azure válida tokens de portador de AD.</span><span class="sxs-lookup"><span data-stu-id="400f4-164">In this section you configure App Service so that hello only HTTP requests it allows tooreach hello data tier API app are hello ones that have valid Azure AD bearer tokens.</span></span> 

<span data-ttu-id="400f4-165">Hola la siguiente sección, configurar la aplicación de nivel intermedio API hello toosend aplicación credenciales tooAzure AD, regresar un token de portador y enviar a portador Hola aplicación de API de nivel de datos de token toohello.</span><span class="sxs-lookup"><span data-stu-id="400f4-165">In hello following section, you configure hello middle tier API app toosend application credentials tooAzure AD, get back a bearer token, and send hello bearer token toohello data tier API app.</span></span> <span data-ttu-id="400f4-166">Este proceso se muestra en el diagrama de Hola.</span><span class="sxs-lookup"><span data-stu-id="400f4-166">This process is illustrated in hello diagram.</span></span>

![Diagrama de autenticación del servicio](./media/app-service-api-dotnet-service-principal-auth/appdiagram.png)

<span data-ttu-id="400f4-168">Si experimenta problemas al siguiente instrucciones de tutorial de hello, vea hello [solución de problemas](#troubleshooting) sección al final de hello del tutorial Hola.</span><span class="sxs-lookup"><span data-stu-id="400f4-168">If you run into problems while following hello tutorial directions, see hello [Troubleshooting](#troubleshooting) section at hello end of hello tutorial.</span></span> 

1. <span data-ttu-id="400f4-169">Hola [portal de Azure](https://portal.azure.com/), navegue toohello **configuración** hoja de aplicación Hola API que creó para la aplicación de API de hello ToDoListDataAPI (capa de datos) y, a continuación, haga clic en **configuración**.</span><span class="sxs-lookup"><span data-stu-id="400f4-169">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you created for hello ToDoListDataAPI (data tier) API app, and then click **Settings**.</span></span>
2. <span data-ttu-id="400f4-170">Hola **configuración** hoja, buscar hello **características** sección y, a continuación, haga clic en **autenticación / autorización**.</span><span class="sxs-lookup"><span data-stu-id="400f4-170">In hello **Settings** blade, find hello **Features** section, and then click **Authentication / Authorization**.</span></span>
   
    ![Autenticación/autorización en el Portal de Azure](./media/app-service-api-dotnet-user-principal-auth/features.png)
3. <span data-ttu-id="400f4-172">Hola **autenticación / autorización** hoja, haga clic en **en**.</span><span class="sxs-lookup"><span data-stu-id="400f4-172">In hello **Authentication / Authorization** blade, click **On**.</span></span>
4. <span data-ttu-id="400f4-173">Hola **tootake de acción cuando no se autentica la solicitud** lista desplegable, seleccione **iniciar sesión con Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="400f4-173">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory**.</span></span>
   
    <span data-ttu-id="400f4-174">Esta es la configuración de Hola que provoca tooensure de servicio de aplicaciones que solo autenticados aplicación de API de Hola de alcance de las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="400f4-174">This is hello setting that causes App Service tooensure that only authenticated requests reach hello API app.</span></span> <span data-ttu-id="400f4-175">Para las solicitudes que tienen los tokens de portador válido, servicio de aplicaciones pasa tokens de Hola a lo largo de la aplicación toohello API y rellena los encabezados HTTP con notificaciones utilizadas toomake esa información código tooyour disponibles con más facilidad.</span><span class="sxs-lookup"><span data-stu-id="400f4-175">For requests that have valid bearer tokens, App Service passes hello tokens along toohello API app and populates HTTP headers with commonly used claims toomake that information more easily available tooyour code.</span></span>
5. <span data-ttu-id="400f4-176">En **Proveedores de autenticación**, haga clic en **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="400f4-176">Under **Authentication Providers**, click **Azure Active Directory**.</span></span>
   
    ![Hoja Autenticación/autorización del Portal de Azure](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
6. <span data-ttu-id="400f4-178">Hola **configuración de Azure Active Directory** hoja, haga clic en **Express**.</span><span class="sxs-lookup"><span data-stu-id="400f4-178">In hello **Azure Active Directory Settings** blade, click **Express**.</span></span>
   
    <span data-ttu-id="400f4-179">Con hello **Express** opción Azure puede crear automáticamente una aplicación AAD de Azure AD [inquilino](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span><span class="sxs-lookup"><span data-stu-id="400f4-179">With hello **Express** option Azure can automatically create an AAD application in your Azure AD [tenant](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span></span> 
   
    <span data-ttu-id="400f4-180">No tienes toocreate un inquilino, porque cada cuenta de Azure automáticamente tiene uno.</span><span class="sxs-lookup"><span data-stu-id="400f4-180">You don't have toocreate a tenant, because every Azure account automatically has one.</span></span>
7. <span data-ttu-id="400f4-181">En **Modo de administración**, haga clic en **Crear nueva aplicación de AD** si aún no está seleccionado.</span><span class="sxs-lookup"><span data-stu-id="400f4-181">Under **Management mode**, click **Create New AD App** if it isn't already selected.</span></span>
   
    <span data-ttu-id="400f4-182">Hola conecta el portal de Hello **crear aplicación** cuadro de entrada con un valor predeterminado.</span><span class="sxs-lookup"><span data-stu-id="400f4-182">hello portal plugs hello **Create App** input box with a default value.</span></span> <span data-ttu-id="400f4-183">De forma predeterminada, se denomina aplicación de Azure AD Hola Hola igual como aplicación hello API.</span><span class="sxs-lookup"><span data-stu-id="400f4-183">By default, hello Azure AD application is named hello same as hello API app.</span></span> <span data-ttu-id="400f4-184">Si lo prefiere, escriba un nombre diferente.</span><span class="sxs-lookup"><span data-stu-id="400f4-184">If you prefer, you can enter a different name.</span></span>
   
    ![Configuración de Azure AD](./media/app-service-api-dotnet-service-principal-auth/aadsettings.png)
   
    <span data-ttu-id="400f4-186">**Tenga en cuenta**: como alternativa, puede usar un único anuncio Azure aplicación para ambos Hola aplicación que realiza la llamada de API y Hola protegido aplicación de API.</span><span class="sxs-lookup"><span data-stu-id="400f4-186">**Note**: As an alternative, you could use a single Azure AD application for both hello calling API app and hello protected API app.</span></span> <span data-ttu-id="400f4-187">Si opta por esa alternativa, no necesitará hello **crear nueva aplicación de AD** opción aquí porque se ha creado una aplicación de Azure AD anteriormente en el tutorial de autenticación de usuario de Hola.</span><span class="sxs-lookup"><span data-stu-id="400f4-187">If you chose that alternative, you would not need hello **Create New AD App** option here because you already created an Azure AD application earlier in hello user authentication tutorial.</span></span> <span data-ttu-id="400f4-188">Para este tutorial, usará separe las aplicaciones de Azure AD para hello llamada aplicación de API y Hola protegido aplicación de API.</span><span class="sxs-lookup"><span data-stu-id="400f4-188">For this tutorial, you'll use separate Azure AD applications for hello calling API app and hello protected API app.</span></span>
8. <span data-ttu-id="400f4-189">Tome nota del valor de Hola Hola **crear aplicación** cuadro de entrada; podrá buscar esta aplicación AAD Hola portal de Azure clásico más adelante.</span><span class="sxs-lookup"><span data-stu-id="400f4-189">Make a note of hello value that is in hello **Create App** input box; you'll look up this AAD application in hello Azure classic portal later.</span></span>
9. <span data-ttu-id="400f4-190">Haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="400f4-190">Click **OK**.</span></span>
10. <span data-ttu-id="400f4-191">Hola **autenticación / autorización** hoja, haga clic en **guardar**.</span><span class="sxs-lookup"><span data-stu-id="400f4-191">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
    
    ![Haga clic en Guardar](./media/app-service-api-dotnet-service-principal-auth/saveauth.png)
    
    <span data-ttu-id="400f4-193">Servicio de aplicaciones crea una aplicación de Azure Active Directory con **dirección URL de inicio de sesión** y **dirección URL de respuesta** establece automáticamente la dirección URL de toohello de la aplicación de API.</span><span class="sxs-lookup"><span data-stu-id="400f4-193">App Service creates an Azure Active Directory application with **Sign-on URL** and **Reply URL** automatically set toohello URL of your API app.</span></span> <span data-ttu-id="400f4-194">último valor de Hola permite a los usuarios en su toolog del inquilino AAD en y aplicación de API de acceso hello.</span><span class="sxs-lookup"><span data-stu-id="400f4-194">hello latter value enables users in your AAD tenant toolog in and access hello API app.</span></span>

### <a name="verify-that-hello-api-app-is-protected"></a><span data-ttu-id="400f4-195">Comprobar que la aplicación hello API está protegida</span><span class="sxs-lookup"><span data-stu-id="400f4-195">Verify that hello API app is protected</span></span>
1. <span data-ttu-id="400f4-196">En un explorador, vaya toohello URL de aplicación hello API: Hola **aplicación de API** hoja Hola portal de Azure, haga clic en vínculo hello en **URL**.</span><span class="sxs-lookup"><span data-stu-id="400f4-196">In a browser go toohello URL of hello API app: in hello **API app** blade in hello Azure portal, click hello link under **URL**.</span></span> 
   
    <span data-ttu-id="400f4-197">Son redirigidos tooa pantalla de inicio de sesión dado que las solicitudes no autenticadas no se permiten la aplicación de API de hello tooreach.</span><span class="sxs-lookup"><span data-stu-id="400f4-197">You are redirected tooa login screen because unauthenticated requests are not allowed tooreach hello API app.</span></span> 
   
    <span data-ttu-id="400f4-198">Si el explorador vaya toohello Swagger de interfaz de usuario, el explorador ya podría haber iniciado sesión, en ese caso, abra una ventana de InPrivate o de incógnito y vaya toohello Swagger dirección URL de interfaz de usuario.</span><span class="sxs-lookup"><span data-stu-id="400f4-198">If your browser does go toohello Swagger UI, your browser might already be logged on -- in that case, open an InPrivate or Incognito window and go toohello Swagger UI URL.</span></span>
2. <span data-ttu-id="400f4-199">Inicie sesión con las credenciales de un usuario en su inquilino de AAD.</span><span class="sxs-lookup"><span data-stu-id="400f4-199">Log in with credentials of a user in your AAD tenant.</span></span>
   
   <span data-ttu-id="400f4-200">Cuando ha iniciado sesión, Hola "se creó correctamente" página aparece en el Explorador de Hola.</span><span class="sxs-lookup"><span data-stu-id="400f4-200">When you're logged on, hello "successfully created" page appears in hello browser.</span></span>

## <a name="configure-hello-todolistapi-project-tooacquire-and-send-hello-azure-ad-token"></a><span data-ttu-id="400f4-201">Configurar hello ToDoListAPI proyecto tooacquire y enviar el token de Azure AD Hola</span><span class="sxs-lookup"><span data-stu-id="400f4-201">Configure hello ToDoListAPI project tooacquire and send hello Azure AD token</span></span>
<span data-ttu-id="400f4-202">En esta sección hello las siguientes tareas:</span><span class="sxs-lookup"><span data-stu-id="400f4-202">In this section you do hello following tasks:</span></span>

* <span data-ttu-id="400f4-203">Agregue el código de aplicación de API de nivel intermedio de Hola que usa Azure AD aplicación credenciales tooacquire un token y enviar con HTTP solicitudes de aplicación de API de nivel de datos de toohello.</span><span class="sxs-lookup"><span data-stu-id="400f4-203">Add code in hello middle tier API app that uses Azure AD application credentials tooacquire a token and send it with HTTP requests toohello data tier API app.</span></span>
* <span data-ttu-id="400f4-204">Obtener las credenciales de Hola que necesita de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="400f4-204">Get hello credentials you need from Azure AD.</span></span>
* <span data-ttu-id="400f4-205">Escriba las credenciales de hello en configuración del entorno de servicio de aplicaciones de Azure en tiempo de ejecución en el nivel intermedio de hello aplicación de API.</span><span class="sxs-lookup"><span data-stu-id="400f4-205">Enter hello credentials into Azure App Service runtime environment settings in hello middle tier API app.</span></span> 

### <a name="configure-hello-todolistapi-project-tooacquire-and-send-hello-azure-ad-token"></a><span data-ttu-id="400f4-206">Configurar hello ToDoListAPI proyecto tooacquire y enviar el token de Azure AD Hola</span><span class="sxs-lookup"><span data-stu-id="400f4-206">Configure hello ToDoListAPI project tooacquire and send hello Azure AD token</span></span>
<span data-ttu-id="400f4-207">Asegúrese de hello después cambios en hello ToDoListAPI proyecto en Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="400f4-207">Make hello following changes in hello ToDoListAPI project in Visual Studio.</span></span>

1. <span data-ttu-id="400f4-208">Quite todo código de hello en hello *ServicePrincipal.cs* archivo.</span><span class="sxs-lookup"><span data-stu-id="400f4-208">Uncomment all of hello code in hello *ServicePrincipal.cs* file.</span></span>
   
    <span data-ttu-id="400f4-209">Se trata de código de hello que usa ADAL para el token de portador de .NET tooacquire hello Azure AD.</span><span class="sxs-lookup"><span data-stu-id="400f4-209">This is hello code that uses ADAL for .NET tooacquire hello Azure AD bearer token.</span></span>  <span data-ttu-id="400f4-210">Utiliza varios valores de configuración que se configuran en el entorno de Azure en tiempo de ejecución de hello más tarde.</span><span class="sxs-lookup"><span data-stu-id="400f4-210">It uses several configuration values that you'll set in hello Azure runtime environment later.</span></span> <span data-ttu-id="400f4-211">Este es el código de hello.</span><span class="sxs-lookup"><span data-stu-id="400f4-211">Here's hello code:</span></span> 
   
        public static class ServicePrincipal
        {
            static string authority = ConfigurationManager.AppSettings["ida:Authority"];
            static string clientId = ConfigurationManager.AppSettings["ida:ClientId"];
            static string clientSecret = ConfigurationManager.AppSettings["ida:ClientSecret"];
            static string resource = ConfigurationManager.AppSettings["ida:Resource"];
   
            public static AuthenticationResult GetS2SAccessTokenForProdMSA()
            {
                return GetS2SAccessToken(authority, resource, clientId, clientSecret);
            }
   
            static AuthenticationResult GetS2SAccessToken(string authority, string resource, string clientId, string clientSecret)
            {
                var clientCredential = new ClientCredential(clientId, clientSecret);
                AuthenticationContext context = new AuthenticationContext(authority, false);
                AuthenticationResult authenticationResult = context.AcquireToken(
                    resource,
                    clientCredential);
                return authenticationResult;
            }
        }
   
    <span data-ttu-id="400f4-212">**Nota:** este código requiere Hola AAL para el paquete NuGet de .NET (Microsoft.IdentityModel.Clients.ActiveDirectory), que ya está instalado en el proyecto de Hola.</span><span class="sxs-lookup"><span data-stu-id="400f4-212">**Note:** This code requires hello ADAL for .NET NuGet package (Microsoft.IdentityModel.Clients.ActiveDirectory), which is already installed in hello project.</span></span> <span data-ttu-id="400f4-213">Si estuviera creando este proyecto desde el principio, tendrás que tooinstall este paquete.</span><span class="sxs-lookup"><span data-stu-id="400f4-213">If you were creating this project from scratch, you would have tooinstall this package.</span></span> <span data-ttu-id="400f4-214">Este paquete no se instala automáticamente con la plantilla de proyecto nuevo de aplicación de API de Hola.</span><span class="sxs-lookup"><span data-stu-id="400f4-214">This package is not automatically installed by hello API app new-project template.</span></span>
2. <span data-ttu-id="400f4-215">En *controladores/ToDoListController*, quite el comentario de código de hello en hello `NewDataAPIClient` método que agrega las solicitudes de token tooHTTP Hola Hola encabezado de autorización.</span><span class="sxs-lookup"><span data-stu-id="400f4-215">In *Controllers/ToDoListController*, uncomment hello code in hello `NewDataAPIClient` method that adds hello token tooHTTP requests in hello authorization header.</span></span>
   
        client.HttpClient.DefaultRequestHeaders.Authorization =
            new AuthenticationHeaderValue("Bearer", ServicePrincipal.GetS2SAccessTokenForProdMSA().AccessToken);
3. <span data-ttu-id="400f4-216">Implementar proyecto de ToDoListAPI Hola.</span><span class="sxs-lookup"><span data-stu-id="400f4-216">Deploy hello ToDoListAPI project.</span></span> <span data-ttu-id="400f4-217">(Haga clic en proyecto de hello, a continuación, haga clic en **publicar > Publicar**.)</span><span class="sxs-lookup"><span data-stu-id="400f4-217">(Right-click hello project, then click **Publish > Publish**.)</span></span>
   
    <span data-ttu-id="400f4-218">Visual Studio implementa Hola proyecto y abre la dirección URL base de la aplicación web de toohello de explorador.</span><span class="sxs-lookup"><span data-stu-id="400f4-218">Visual Studio deploys hello project and opens a browser toohello web app's base URL.</span></span> <span data-ttu-id="400f4-219">Esto mostrará una página de 403 error, que es normal que un intento de toogo tooa API Web dirección URL base desde un explorador.</span><span class="sxs-lookup"><span data-stu-id="400f4-219">This will show a 403 error page, which is normal for an attempt toogo tooa Web API base URL from a browser.</span></span>
4. <span data-ttu-id="400f4-220">Explorador de hello cerrar.</span><span class="sxs-lookup"><span data-stu-id="400f4-220">Close hello browser.</span></span>

### <a name="get-azure-ad-configuration-values"></a><span data-ttu-id="400f4-221">Obtención de los valores de configuración de Azure AD</span><span class="sxs-lookup"><span data-stu-id="400f4-221">Get Azure AD configuration values</span></span>
1. <span data-ttu-id="400f4-222">Hola [portal de Azure clásico](https://manage.windowsazure.com/), vaya demasiado**Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="400f4-222">In hello [Azure classic portal](https://manage.windowsazure.com/), go too**Azure Active Directory**.</span></span>
2. <span data-ttu-id="400f4-223">En hello **directorio** , haga clic en su inquilino de AAD.</span><span class="sxs-lookup"><span data-stu-id="400f4-223">On hello **Directory** tab, click your AAD tenant.</span></span>
3. <span data-ttu-id="400f4-224">Haga clic en **aplicaciones > las aplicaciones que tiene mi compañía**y, a continuación, haga clic en la casilla de verificación Hola.</span><span class="sxs-lookup"><span data-stu-id="400f4-224">Click **Applications > Applications my company owns**, and then click hello check mark.</span></span>
4. <span data-ttu-id="400f4-225">En la lista Hola de aplicaciones, haga clic en Hola Hola uno que Azure crea automáticamente cuando se ha habilitado la autenticación para aplicación de API de hello ToDoListDataAPI (capa de datos).</span><span class="sxs-lookup"><span data-stu-id="400f4-225">In hello list of applications, click hello name of hello one that Azure created for you when you enabled authentication for hello ToDoListDataAPI (data tier) API app.</span></span>
5. <span data-ttu-id="400f4-226">Haga clic en hello **configurar** ficha.</span><span class="sxs-lookup"><span data-stu-id="400f4-226">Click hello **Configure** tab.</span></span>
6. <span data-ttu-id="400f4-227">Hola copia **Id. de cliente** valor y guardar un lugar puede obtener desde más tarde.</span><span class="sxs-lookup"><span data-stu-id="400f4-227">Copy hello **Client ID** value and save it someplace you can get it from later.</span></span> 
7. <span data-ttu-id="400f4-228">En el portal de Azure clásico Hola volver atrás lista toohello de **aplicaciones tiene mi compañía**y haga clic en la aplicación de AAD de Hola que creó para la aplicación de API ToDoListAPI de nivel intermedio de hello (Hola creada en el tutorial anterior de hello, no Hola que creó en este tutorial).</span><span class="sxs-lookup"><span data-stu-id="400f4-228">In hello Azure classic portal go back toohello list of **Applications my company owns**, and click hello AAD application that you created for hello middle tier ToDoListAPI API app (hello one you created in hello previous tutorial, not hello one you created in this tutorial).</span></span>
8. <span data-ttu-id="400f4-229">Haga clic en hello **configurar** ficha.</span><span class="sxs-lookup"><span data-stu-id="400f4-229">Click hello **Configure** tab.</span></span>
9. <span data-ttu-id="400f4-230">Hola copia **Id. de cliente** valor y guardar un lugar puede obtener desde más tarde.</span><span class="sxs-lookup"><span data-stu-id="400f4-230">Copy hello **Client ID** value and save it someplace you can get it from later.</span></span>
10. <span data-ttu-id="400f4-231">En **claves**, seleccione **1 año** de hello **seleccione duración** lista desplegable.</span><span class="sxs-lookup"><span data-stu-id="400f4-231">Under **keys**, select **1 year** from hello **Select duration** drop-down list.</span></span>
11. <span data-ttu-id="400f4-232">Haga clic en **Guardar**.</span><span class="sxs-lookup"><span data-stu-id="400f4-232">Click **Save**.</span></span>
    
     ![Generar clave de aplicación](./media/app-service-api-dotnet-service-principal-auth/genkey.png)
12. <span data-ttu-id="400f4-234">Copie el valor de clave de Hola y lo guarda un lugar que puede obtener desde más tarde.</span><span class="sxs-lookup"><span data-stu-id="400f4-234">Copy hello key value and save it someplace you can get it from later.</span></span>
    
     ![Copiar la nueva clave de aplicación](./media/app-service-api-dotnet-service-principal-auth/genkeycopy.png)

### <a name="configure-azure-ad-settings-in-hello-middle-tier-api-apps-runtime-environment"></a><span data-ttu-id="400f4-236">Configurar opciones de Azure AD en el entorno de tiempo de ejecución de la aplicación de API de nivel intermedio de Hola</span><span class="sxs-lookup"><span data-stu-id="400f4-236">Configure Azure AD settings in hello middle tier API app's runtime environment</span></span>
1. <span data-ttu-id="400f4-237">Vaya toohello [portal de Azure](https://portal.azure.com/)y, a continuación, navegue toohello **API App** hoja para la aplicación hello API que hospeda el proyecto de hello TodoListAPI (nivel intermedio).</span><span class="sxs-lookup"><span data-stu-id="400f4-237">Go toohello [Azure portal](https://portal.azure.com/), and then navigate toohello **API App** blade for hello API app that hosts hello TodoListAPI (middle tier) project.</span></span>
2. <span data-ttu-id="400f4-238">Haga clic en **Configuración > Configuración de la aplicación**.</span><span class="sxs-lookup"><span data-stu-id="400f4-238">Click **Settings > Application Settings**.</span></span>
3. <span data-ttu-id="400f4-239">Hola **configuración de la aplicación** sección, agregue Hola siguiendo las claves y valores:</span><span class="sxs-lookup"><span data-stu-id="400f4-239">In hello **App settings** section, add hello following keys and values:</span></span>
   
   | <span data-ttu-id="400f4-240">**Clave**</span><span class="sxs-lookup"><span data-stu-id="400f4-240">**Key**</span></span> | <span data-ttu-id="400f4-241">ida:Authority</span><span class="sxs-lookup"><span data-stu-id="400f4-241">ida:Authority</span></span> |
   | --- | --- |
   | <span data-ttu-id="400f4-242">**Valor**</span><span class="sxs-lookup"><span data-stu-id="400f4-242">**Value**</span></span> |<span data-ttu-id="400f4-243">https://login.microsoftonline.com/{su nombre de inquilino de Azure AD}</span><span class="sxs-lookup"><span data-stu-id="400f4-243">https://login.microsoftonline.com/{your Azure AD tenant name}</span></span> |
   | <span data-ttu-id="400f4-244">**Ejemplo**</span><span class="sxs-lookup"><span data-stu-id="400f4-244">**Example**</span></span> |<span data-ttu-id="400f4-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="400f4-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span></span> |
   
   | <span data-ttu-id="400f4-246">**Clave**</span><span class="sxs-lookup"><span data-stu-id="400f4-246">**Key**</span></span> | <span data-ttu-id="400f4-247">ida:ClientId</span><span class="sxs-lookup"><span data-stu-id="400f4-247">ida:ClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="400f4-248">**Valor**</span><span class="sxs-lookup"><span data-stu-id="400f4-248">**Value**</span></span> |<span data-ttu-id="400f4-249">Id. de cliente del programa Hola a llamar a la aplicación (nivel intermedio - ToDoListAPI)</span><span class="sxs-lookup"><span data-stu-id="400f4-249">Client ID of hello calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="400f4-250">**Ejemplo**</span><span class="sxs-lookup"><span data-stu-id="400f4-250">**Example**</span></span> |<span data-ttu-id="400f4-251">960adec2-b74a-484a-960adec2-b74a-484a</span><span class="sxs-lookup"><span data-stu-id="400f4-251">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
   
   | <span data-ttu-id="400f4-252">**Clave**</span><span class="sxs-lookup"><span data-stu-id="400f4-252">**Key**</span></span> | <span data-ttu-id="400f4-253">ida:ClientSecret</span><span class="sxs-lookup"><span data-stu-id="400f4-253">ida:ClientSecret</span></span> |
   | --- | --- |
   | <span data-ttu-id="400f4-254">**Valor**</span><span class="sxs-lookup"><span data-stu-id="400f4-254">**Value**</span></span> |<span data-ttu-id="400f4-255">Clave de aplicación del programa Hola a llamar a la aplicación (nivel intermedio - ToDoListAPI)</span><span class="sxs-lookup"><span data-stu-id="400f4-255">App key of hello calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="400f4-256">**Ejemplo**</span><span class="sxs-lookup"><span data-stu-id="400f4-256">**Example**</span></span> |<span data-ttu-id="400f4-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="400f4-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
   | <span data-ttu-id="400f4-258">**Clave**</span><span class="sxs-lookup"><span data-stu-id="400f4-258">**Key**</span></span> | <span data-ttu-id="400f4-259">ida:Resource</span><span class="sxs-lookup"><span data-stu-id="400f4-259">ida:Resource</span></span> |
   | --- | --- |
   | <span data-ttu-id="400f4-260">**Valor**</span><span class="sxs-lookup"><span data-stu-id="400f4-260">**Value**</span></span> |<span data-ttu-id="400f4-261">Identificador de cliente de Hola se denomina aplicación (capa de datos - ToDoListDataAPI)</span><span class="sxs-lookup"><span data-stu-id="400f4-261">Client ID of hello called application (data tier - ToDoListDataAPI)</span></span> |
   | <span data-ttu-id="400f4-262">**Ejemplo**</span><span class="sxs-lookup"><span data-stu-id="400f4-262">**Example**</span></span> |<span data-ttu-id="400f4-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="400f4-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
    <span data-ttu-id="400f4-264">**Tenga en cuenta**: para `ida:Resource`, asegúrese de usar Hola llama a la aplicación **Id. de cliente** y no su **App ID URI**.</span><span class="sxs-lookup"><span data-stu-id="400f4-264">**Note**: For `ida:Resource`, make sure you use hello called application's **client ID** and not its **App ID URI**.</span></span>
   
    <span data-ttu-id="400f4-265">`ida:ClientId`y `ida:Resource` son diferentes valores para este tutorial porque lo está utilizando separan applicaations de Azure AD para el nivel intermedio de Hola y de capa de datos.</span><span class="sxs-lookup"><span data-stu-id="400f4-265">`ida:ClientId` and `ida:Resource` are different values for this tutorial because you're using separate Azure AD applicaations for hello middle tier and data tier.</span></span> <span data-ttu-id="400f4-266">Si usaba una única aplicación de Azure AD para llamar a hello y aplicación de API de hello protegido aplicación de API, usaría Hola mismo valor en ambos `ida:ClientId` y `ida:Resource`.</span><span class="sxs-lookup"><span data-stu-id="400f4-266">If you were using a single Azure AD application for hello calling API app and hello protected API app, you would use hello same value in both `ida:ClientId` and `ida:Resource`.</span></span>
   
    <span data-ttu-id="400f4-267">código de Hello usa ConfigurationManager tooget estos valores, por lo que se puede almacenar en el archivo Web.config del proyecto de Hola o en el entorno de Azure en tiempo de ejecución de Hola.</span><span class="sxs-lookup"><span data-stu-id="400f4-267">hello code uses ConfigurationManager tooget these values, so they could be stored in hello project's Web.config file or in hello Azure runtime environment.</span></span> <span data-ttu-id="400f4-268">Mientras se ejecuta una aplicación ASP.NET en el Servicio de aplicaciones de Azure, la configuración del entorno invalida automáticamente la configuración de Web.config. Configuración del entorno es generalmente una [más segura información confidencial de manera toostore en comparación con el archivo Web.config de tooa](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span><span class="sxs-lookup"><span data-stu-id="400f4-268">While an ASP.NET application is running in Azure App Service, environment settings automatically override settings from Web.config. Environment settings are generally a [more secure way toostore sensitive information compared tooa Web.config file](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span></span>
4. <span data-ttu-id="400f4-269">Haga clic en **Guardar**.</span><span class="sxs-lookup"><span data-stu-id="400f4-269">Click **Save**.</span></span>
   
    ![Haga clic en Guardar](./media/app-service-api-dotnet-service-principal-auth/appsettings.png)

### <a name="test-hello-application"></a><span data-ttu-id="400f4-271">Probar la aplicación hello</span><span class="sxs-lookup"><span data-stu-id="400f4-271">Test hello application</span></span>
1. <span data-ttu-id="400f4-272">En un explorador vaya toohello dirección URL HTTPS de aplicación de hello AngularJS front-end web.</span><span class="sxs-lookup"><span data-stu-id="400f4-272">In a browser go toohello HTTPS URL of hello AngularJS front end web app.</span></span>
2. <span data-ttu-id="400f4-273">Haga clic en hello **tooDo lista** ficha e inicie sesión con credenciales de un usuario en su inquilino de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="400f4-273">Click hello **tooDo List** tab and log in with credentials for a user in your Azure AD tenant.</span></span> 
3. <span data-ttu-id="400f4-274">Agregar tooverify de elementos de tarea que la aplicación hello funciona.</span><span class="sxs-lookup"><span data-stu-id="400f4-274">Add to-do items tooverify that hello application is working.</span></span>
   
    ![página de lista tooDo](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)
   
    <span data-ttu-id="400f4-276">Si la aplicación hello no funciona según lo previsto, compruebe todos los valores de hello que escribió en hello portal de Azure.</span><span class="sxs-lookup"><span data-stu-id="400f4-276">If hello application doesn't work as expected, double-check all of hello settings you entered in hello Azure portal.</span></span> <span data-ttu-id="400f4-277">Si todos los valores de hello aparecen toobe correcta, vea hello [solución de problemas](#troubleshooting) sección más adelante en este tutorial.</span><span class="sxs-lookup"><span data-stu-id="400f4-277">If all of hello settings appear toobe correct, see hello [Troubleshooting](#troubleshooting) section later in this tutorial.</span></span>

## <a name="protect-hello-api-app-from-browser-access"></a><span data-ttu-id="400f4-278">Proteger la aplicación de API de hello contra el acceso de explorador</span><span class="sxs-lookup"><span data-stu-id="400f4-278">Protect hello API app from browser access</span></span>
<span data-ttu-id="400f4-279">En este tutorial ha creado una independiente aplicación de Azure AD para la aplicación hello API ToDoListDataAPI (capa de datos).</span><span class="sxs-lookup"><span data-stu-id="400f4-279">For this tutorial you created a separate Azure AD application for hello ToDoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="400f4-280">Tal y como se ha visto, cuando el servicio de aplicaciones crea una aplicación de AAD, configura la aplicación AAD de hello de forma que permite a un usuario toogo toohello API URL de la aplicación en un explorador e inicie sesión en.</span><span class="sxs-lookup"><span data-stu-id="400f4-280">As you've seen, when App Service creates an AAD application, it configures hello AAD application in a way that enables a user toogo toohello API app's URL in a browser and log on.</span></span> <span data-ttu-id="400f4-281">Eso significa es posible que un usuario final en el inquilino de Azure AD, no solo una entidad de servicio, tooaccess Hola API.</span><span class="sxs-lookup"><span data-stu-id="400f4-281">That means it's possible for an end user in your Azure AD tenant, not just a service principal, tooaccess hello API.</span></span> 

<span data-ttu-id="400f4-282">Si desea que el acceso de explorador tooprevent sin escribir ningún código de hello protegidos aplicación de API, puede cambiar hello **dirección URL de respuesta** Hola aplicación AAD para que sea diferente de la aplicación hello API dirección URL base.</span><span class="sxs-lookup"><span data-stu-id="400f4-282">If you want tooprevent browser access without writing any code in hello protected API app, you can change hello **Reply URL** in hello AAD application so that it's different from hello API app's base URL.</span></span> 

### <a name="disable-browser-access"></a><span data-ttu-id="400f4-283">Deshabilitación del acceso desde el explorador</span><span class="sxs-lookup"><span data-stu-id="400f4-283">Disable browser access</span></span>
1. <span data-ttu-id="400f4-284">En del portal clásico de hello **configurar** pestaña aplicación AAD de Hola que se creó para hello TodoListService, cambie el valor de Hola Hola **dirección URL de respuesta** campo para que sea una dirección URL válida, pero no Hola API de la aplicación DIRECCIÓN URL.</span><span class="sxs-lookup"><span data-stu-id="400f4-284">In hello classic portal's **Configure** tab for hello AAD application that was created for hello TodoListService, change hello value in hello **Reply URL** field so that it is a valid URL but not hello API app's URL.</span></span>
2. <span data-ttu-id="400f4-285">Haga clic en **Guardar**.</span><span class="sxs-lookup"><span data-stu-id="400f4-285">Click **Save**.</span></span>

### <a name="verify-browser-access-no-longer-works"></a><span data-ttu-id="400f4-286">Comprobación de que el acceso desde el explorador ya no funciona</span><span class="sxs-lookup"><span data-stu-id="400f4-286">Verify browser access no longer works</span></span>
<span data-ttu-id="400f4-287">Anteriormente, ha comprobado que puede ir toohello URL de la aplicación de API desde un explorador, inicie sesión con credenciales de un usuario concreto.</span><span class="sxs-lookup"><span data-stu-id="400f4-287">Earlier you verified that you can go toohello API app URL from a browser by logging on with an individual user's credentials.</span></span> <span data-ttu-id="400f4-288">En esta sección, comprobará que ya no es posible.</span><span class="sxs-lookup"><span data-stu-id="400f4-288">In this section, you verify that this is no longer possible.</span></span> 

1. <span data-ttu-id="400f4-289">En una nueva ventana del explorador, vaya toohello URL de aplicación de API de Hola de nuevo.</span><span class="sxs-lookup"><span data-stu-id="400f4-289">In a new browser window, go toohello URL of hello API app again.</span></span>
2. <span data-ttu-id="400f4-290">Inicio de sesión cuando se le pida toodo así.</span><span class="sxs-lookup"><span data-stu-id="400f4-290">Log in when prompted toodo so.</span></span>
3. <span data-ttu-id="400f4-291">Inicio de sesión se realiza correctamente pero conduce tooan página de error.</span><span class="sxs-lookup"><span data-stu-id="400f4-291">Login succeeds but leads tooan error page.</span></span>
   
    <span data-ttu-id="400f4-292">Ha configurado la aplicación AAD de hello para que los usuarios de inquilino de AAD de hello no se pueden iniciar sesión y tener acceso a Hola API desde un explorador.</span><span class="sxs-lookup"><span data-stu-id="400f4-292">You've configured hello AAD app so that users in hello AAD tenant cannot log in and access hello API from a browser.</span></span> <span data-ttu-id="400f4-293">Todavía puede tener acceso a la aplicación de API de hello mediante el uso de un token de entidad de seguridad de servicio, que puede comprobar desde la dirección URL de la aplicación web toohello y agregar más elementos de tareas pendientes.</span><span class="sxs-lookup"><span data-stu-id="400f4-293">You can still access hello API app by using a service principal token, which you can verify by going toohello web app's URL and adding more to-do items.</span></span>

## <a name="restrict-access-tooa-particular-service-principal"></a><span data-ttu-id="400f4-294">Restringir la entidad de servicio determinado de tooa de acceso</span><span class="sxs-lookup"><span data-stu-id="400f4-294">Restrict access tooa particular service principal</span></span>
<span data-ttu-id="400f4-295">En este momento, cualquier llamador que puede obtener un token para un usuario o entidad de servicio en su inquilino de Azure AD puede llamar a la aplicación hello API TodoListDataAPI (capa de datos).</span><span class="sxs-lookup"><span data-stu-id="400f4-295">Right now, any caller that can get a token for a user or service principal in your Azure AD tenant can call hello TodoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="400f4-296">Puede ser conveniente toomake seguro de que esa aplicación de API de nivel de datos de hello solo acepta llamadas de aplicación de API de hello TodoListAPI (nivel intermedio) y solo de una entidad de servicio determinado.</span><span class="sxs-lookup"><span data-stu-id="400f4-296">You might want toomake sure that hello data tier API app only accepts calls from hello TodoListAPI (middle tier) API app, and only from a particular service principal.</span></span> 

<span data-ttu-id="400f4-297">Puede agregar estas restricciones mediante la adición de Hola de código toovalidate `appid` y `objectidentifier` notificaciones en las llamadas entrantes.</span><span class="sxs-lookup"><span data-stu-id="400f4-297">You can add these restrictions by adding code toovalidate hello `appid` and `objectidentifier` claims on incoming calls.</span></span>

<span data-ttu-id="400f4-298">Para este tutorial colocan el código de hello que valida el identificador de la aplicación y el Id. de entidad de seguridad de servicio directamente en las acciones de controlador.</span><span class="sxs-lookup"><span data-stu-id="400f4-298">For this tutorial you put hello code that validates app ID and service principal ID directly in your controller actions.</span></span>  <span data-ttu-id="400f4-299">Alternativas son toouse personalizado `Authorize` atributo o toodo esta validación en las secuencias de inicio (por ejemplo, el middleware de OWIN).</span><span class="sxs-lookup"><span data-stu-id="400f4-299">Alternatives are toouse a custom `Authorize` attribute or toodo this validation in your startup sequences (e.g. OWIN middleware).</span></span> <span data-ttu-id="400f4-300">Para obtener un ejemplo de Hola esta última, vea [esta aplicación de ejemplo](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span><span class="sxs-lookup"><span data-stu-id="400f4-300">For an example of hello latter, see [this sample application](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span></span> 

<span data-ttu-id="400f4-301">Asegúrese de hello después de proyecto de TodoListDataAPI toohello de cambios.</span><span class="sxs-lookup"><span data-stu-id="400f4-301">Make hello following changes toohello TodoListDataAPI project.</span></span>

1. <span data-ttu-id="400f4-302">Abra hello *Controllers/TodoListController.cs* archivo.</span><span class="sxs-lookup"><span data-stu-id="400f4-302">Open hello *Controllers/TodoListController.cs* file.</span></span>
2. <span data-ttu-id="400f4-303">Quite el comentario de las líneas de Hola que establecen `trustedCallerClientId` y `trustedCallerServicePrincipalId`.</span><span class="sxs-lookup"><span data-stu-id="400f4-303">Uncomment hello lines that set `trustedCallerClientId` and `trustedCallerServicePrincipalId`.</span></span>
   
        private static string trustedCallerClientId = ConfigurationManager.AppSettings["todo:TrustedCallerClientId"];
        private static string trustedCallerServicePrincipalId = ConfigurationManager.AppSettings["todo:TrustedCallerServicePrincipalId"];
3. <span data-ttu-id="400f4-304">Quite el comentario de código de hello en hello CheckCallerId método.</span><span class="sxs-lookup"><span data-stu-id="400f4-304">Uncomment hello code in hello CheckCallerId method.</span></span> <span data-ttu-id="400f4-305">Este método se llama al inicio de Hola de cada método de acción de controlador de Hola.</span><span class="sxs-lookup"><span data-stu-id="400f4-305">This method is called at hello start of every action method in hello controller.</span></span> 
   
        private static void CheckCallerId()
        {
            string currentCallerClientId = ClaimsPrincipal.Current.FindFirst("appid").Value;
            string currentCallerServicePrincipalId = ClaimsPrincipal.Current.FindFirst("http://schemas.microsoft.com/identity/claims/objectidentifier").Value;
            if (currentCallerClientId != trustedCallerClientId || currentCallerServicePrincipalId != trustedCallerServicePrincipalId)
            {
                throw new HttpResponseException(new HttpResponseMessage { StatusCode = HttpStatusCode.Unauthorized, ReasonPhrase = "hello appID or service principal ID is not hello expected value." });
            }
        }
4. <span data-ttu-id="400f4-306">Volver a implementar hello ToDoListDataAPI proyecto tooAzure servicio de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="400f4-306">Redeploy hello ToDoListDataAPI project tooAzure App Service.</span></span>
5. <span data-ttu-id="400f4-307">En el explorador, vaya la dirección URL de HTTPS de la aplicación de toohello AngularJS front-end web y en la página de inicio de hello, haga clic en hello **tooDo lista** ficha.</span><span class="sxs-lookup"><span data-stu-id="400f4-307">In your browser, go toohello AngularJS front end web app's HTTPS URL, and in hello home page click hello **tooDo List** tab.</span></span>
   
    <span data-ttu-id="400f4-308">aplicación Hello no funciona porque se producen errores en llamadas finalizar toohello atrás.</span><span class="sxs-lookup"><span data-stu-id="400f4-308">hello application doesn't work because calls toohello back end are failing.</span></span> <span data-ttu-id="400f4-309">nuevo código de Hello está comprobando appid real y objectidentifier pero todavía no tiene Hola valores correctos toocheck usarlas con.</span><span class="sxs-lookup"><span data-stu-id="400f4-309">hello new code is checking actual appid and objectidentifier but it doesn't yet have hello correct values toocheck them against.</span></span> <span data-ttu-id="400f4-310">Hola explorador la consola de herramientas para desarrolladores informa de que ese servidor hello está devolviendo un error HTTP 401.</span><span class="sxs-lookup"><span data-stu-id="400f4-310">hello browser Developer Tools Console reports that hello server is returning an HTTP 401 error.</span></span>
   
    ![Error en la Consola de Developer Tools](./media/app-service-api-dotnet-service-principal-auth/webapperror.png)
   
    <span data-ttu-id="400f4-312">Hola pasos configurar valores esperados de Hola.</span><span class="sxs-lookup"><span data-stu-id="400f4-312">In hello following steps you configure hello expected values.</span></span>
6. <span data-ttu-id="400f4-313">Con PowerShell de Azure AD, obtener valor de hello del servicio de hello principal para la aplicación de Azure AD que haya creado para el proyecto de TodoListWebApp Hola Hola.</span><span class="sxs-lookup"><span data-stu-id="400f4-313">Using Azure AD PowerShell, get hello value of hello service principal for hello Azure AD application that you created for hello TodoListWebApp project.</span></span>
   
    <span data-ttu-id="400f4-314">a.</span><span class="sxs-lookup"><span data-stu-id="400f4-314">a.</span></span> <span data-ttu-id="400f4-315">Para obtener instrucciones sobre cómo tooinstall PowerShell de Azure y conectar tooyour suscripción, vea [con Azure PowerShell con el Administrador de recursos de Azure](../powershell-azure-resource-manager.md).</span><span class="sxs-lookup"><span data-stu-id="400f4-315">For instructions on how tooinstall Azure PowerShell and connect tooyour subscription, see [Using Azure PowerShell with Azure Resource Manager](../powershell-azure-resource-manager.md).</span></span>
   
    <span data-ttu-id="400f4-316">b.</span><span class="sxs-lookup"><span data-stu-id="400f4-316">b.</span></span> <span data-ttu-id="400f4-317">tooget una lista de entidades de servicio, ejecute hello `Login-AzureRmAccount` comando y, a continuación, Hola `Get-AzureRmADServicePrincipal` comando.</span><span class="sxs-lookup"><span data-stu-id="400f4-317">tooget a list of service principals, execute hello `Login-AzureRmAccount` command and then hello `Get-AzureRmADServicePrincipal` command.</span></span>
   
    <span data-ttu-id="400f4-318">c.</span><span class="sxs-lookup"><span data-stu-id="400f4-318">c.</span></span> <span data-ttu-id="400f4-319">Busque objectid Hola Hola entidad de servicio de aplicación de hello TodoListAPI y guárdelo en una ubicación que se puede copiar desde más adelante.</span><span class="sxs-lookup"><span data-stu-id="400f4-319">Find hello objectid for hello service principal of hello TodoListAPI application, and save it in a location you can copy from later.</span></span>
7. <span data-ttu-id="400f4-320">Hola portal de Azure, navegue toohello hoja de aplicaciones de API para la aplicación de API de Hola que implementó hello ToDoListDataAPI proyecto a.</span><span class="sxs-lookup"><span data-stu-id="400f4-320">In hello Azure portal, navigate toohello API app blade for hello API app that you deployed hello ToDoListDataAPI project to.</span></span>
8. <span data-ttu-id="400f4-321">Haga clic en **Configuración > Configuración de la aplicación**.</span><span class="sxs-lookup"><span data-stu-id="400f4-321">Click **Settings > Application settings**.</span></span>
9. <span data-ttu-id="400f4-322">Hola **configuración de la aplicación** sección, agregue Hola siguiendo las claves y valores:</span><span class="sxs-lookup"><span data-stu-id="400f4-322">In hello **App settings** section, add hello following keys and values:</span></span>
   
   | <span data-ttu-id="400f4-323">**Clave**</span><span class="sxs-lookup"><span data-stu-id="400f4-323">**Key**</span></span> | <span data-ttu-id="400f4-324">todo:TrustedCallerServicePrincipalId</span><span class="sxs-lookup"><span data-stu-id="400f4-324">todo:TrustedCallerServicePrincipalId</span></span> |
   | --- | --- |
   | <span data-ttu-id="400f4-325">**Valor**</span><span class="sxs-lookup"><span data-stu-id="400f4-325">**Value**</span></span> |<span data-ttu-id="400f4-326">Id. de entidad de servicio de la aplicación que realiza la llamada</span><span class="sxs-lookup"><span data-stu-id="400f4-326">Service principal id of calling application</span></span> |
   | <span data-ttu-id="400f4-327">**Ejemplo**</span><span class="sxs-lookup"><span data-stu-id="400f4-327">**Example**</span></span> |<span data-ttu-id="400f4-328">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span><span class="sxs-lookup"><span data-stu-id="400f4-328">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span></span> |
   
   | <span data-ttu-id="400f4-329">**Clave**</span><span class="sxs-lookup"><span data-stu-id="400f4-329">**Key**</span></span> | <span data-ttu-id="400f4-330">todo:TrustedCallerClientId</span><span class="sxs-lookup"><span data-stu-id="400f4-330">todo:TrustedCallerClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="400f4-331">**Valor**</span><span class="sxs-lookup"><span data-stu-id="400f4-331">**Value**</span></span> |<span data-ttu-id="400f4-332">Id. de cliente de la llamada a la aplicación - copiado desde la aplicación de Azure AD TodoListAPI hello</span><span class="sxs-lookup"><span data-stu-id="400f4-332">Client ID of calling application - copied from hello TodoListAPI Azure AD application</span></span> |
   | <span data-ttu-id="400f4-333">**Ejemplo**</span><span class="sxs-lookup"><span data-stu-id="400f4-333">**Example**</span></span> |<span data-ttu-id="400f4-334">960adec2-b74a-484a-960adec2-b74a-484a</span><span class="sxs-lookup"><span data-stu-id="400f4-334">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
10. <span data-ttu-id="400f4-335">Haga clic en **Guardar**.</span><span class="sxs-lookup"><span data-stu-id="400f4-335">Click **Save**.</span></span>
    
     ![Haga clic en Guardar](./media/app-service-api-dotnet-service-principal-auth/trustedcaller.png)
11. <span data-ttu-id="400f4-337">En el explorador, la dirección URL de la aplicación web toohello de retorno y en la página de inicio de hello, haga clic en hello **tooDo lista** ficha.</span><span class="sxs-lookup"><span data-stu-id="400f4-337">In your browser, return toohello web app's URL, and in hello home page click hello **tooDo List** tab.</span></span>
    
     <span data-ttu-id="400f4-338">Esta aplicación en tiempo de hello funciona como se espera porque la aplicación del llamador de confianza de hello identificador y el identificador de entidad de seguridad de servicio son los valores esperados Hola.</span><span class="sxs-lookup"><span data-stu-id="400f4-338">This time hello application works as expected because hello trusted caller app ID and service principal ID are hello expected values.</span></span>
    
     ![página de lista tooDo](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)

## <a name="building-hello-projects-from-scratch"></a><span data-ttu-id="400f4-340">Compilar proyectos de Hola desde el principio</span><span class="sxs-lookup"><span data-stu-id="400f4-340">Building hello projects from scratch</span></span>
<span data-ttu-id="400f4-341">proyectos de Hello dos API Web se crearon con hello **aplicación de API de Azure** de proyectos de plantilla y reemplazando Hola valores de controlador predeterminado con un controlador ToDoList.</span><span class="sxs-lookup"><span data-stu-id="400f4-341">hello two Web API projects were created by using hello **Azure API App** project template and replacing hello default Values controller with a ToDoList controller.</span></span> <span data-ttu-id="400f4-342">Para adquirir tokens de entidad de seguridad de servicio de Azure AD en proyecto de hello ToDoListAPI, Hola [Active Directory Authentication Library (ADAL) para .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) se instaló el paquete NuGet.</span><span class="sxs-lookup"><span data-stu-id="400f4-342">For acquiring Azure AD service principal tokens in hello ToDoListAPI project, hello [Active Directory Authentication Library (ADAL) for .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet package was installed.</span></span>

<span data-ttu-id="400f4-343">Para obtener información acerca de cómo crear demasiado una aplicación de página de AngularJS con un back-end Web API como ToDoListAngular, consulte [manos en laboratorio: compilar una aplicación de página única (SPA) con ASP.NET Web API y Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span><span class="sxs-lookup"><span data-stu-id="400f4-343">For information about how too create an AngularJS single-page application with a Web API back end like ToDoListAngular, see  [Hands On Lab: Build a Single Page Application (SPA) with ASP.NET Web API and Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span></span> <span data-ttu-id="400f4-344">Para obtener información acerca de cómo tooadd código de autenticación de Azure AD, consulte [proteger AngularJS única página aplicaciones con Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span><span class="sxs-lookup"><span data-stu-id="400f4-344">For information about how tooadd Azure AD authentication code, see [Securing AngularJS Single Page Apps with Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="400f4-345">Solución de problemas</span><span class="sxs-lookup"><span data-stu-id="400f4-345">Troubleshooting</span></span>
[!INCLUDE [troubleshooting](../../includes/app-service-api-auth-troubleshooting.md)]

* <span data-ttu-id="400f4-346">Asegúrese de no confundir ToDoListAPI (nivel intermedio) con ToDoListDataAPI (capa de datos).</span><span class="sxs-lookup"><span data-stu-id="400f4-346">Make sure that you don't confuse ToDoListAPI (middle tier) and ToDoListDataAPI (data tier).</span></span> <span data-ttu-id="400f4-347">Por ejemplo, en este tutorial agrega aplicación de API de nivel de datos de autenticación toohello, **pero clave de aplicación Hola debe proceder de hello aplicación de Azure AD que haya creado para la aplicación de API de nivel intermedio de hello**.</span><span class="sxs-lookup"><span data-stu-id="400f4-347">For example, in this tutorial you add authentication toohello data tier API app, **but hello app key must come from hello Azure AD application that you created for hello middle tier API app**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="400f4-348">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="400f4-348">Next steps</span></span>
<span data-ttu-id="400f4-349">Se trata de último tutorial de Hola Hola serie de aplicaciones de API.</span><span class="sxs-lookup"><span data-stu-id="400f4-349">This is hello last tutorial in hello API Apps series.</span></span> 

<span data-ttu-id="400f4-350">Para obtener más información acerca de Active Directory de Azure, vea Hola recursos siguientes.</span><span class="sxs-lookup"><span data-stu-id="400f4-350">For more information about Azure Active Directory, see hello following resources.</span></span>

* [<span data-ttu-id="400f4-351">Guía para desarrolladores de Azure AD</span><span class="sxs-lookup"><span data-stu-id="400f4-351">Azure AD developers' guide</span></span>](http://aka.ms/aaddev)
* [<span data-ttu-id="400f4-352">Escenarios de Azure AD</span><span class="sxs-lookup"><span data-stu-id="400f4-352">Azure AD scenarios</span></span>](http://aka.ms/aadscenarios)
* [<span data-ttu-id="400f4-353">Ejemplos de Azure AD</span><span class="sxs-lookup"><span data-stu-id="400f4-353">Azure AD samples</span></span>](http://aka.ms/aadsamples)
  
    <span data-ttu-id="400f4-354">Hola [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) ejemplo es similar toowhat se muestra en este tutorial, pero sin usar la autenticación de servicio de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="400f4-354">hello [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) sample is similar toowhat is shown in this tutorial, but without using App Service authentication.</span></span>

<span data-ttu-id="400f4-355">Para obtener información sobre otras maneras de toodeploy Visual Studio proyectos tooAPI aplicaciones, mediante Visual Studio o [automatizar la implementación](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) desde una [sistema de control de código fuente](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), vea [cómo toodeploy un Aplicación de servicio de aplicaciones de Azure](../app-service-web/web-sites-deploy.md).</span><span class="sxs-lookup"><span data-stu-id="400f4-355">For information about other ways toodeploy Visual Studio projects tooAPI apps, by using Visual Studio or by [automating deployment](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) from a [source control system](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), see [How toodeploy an Azure App Service app](../app-service-web/web-sites-deploy.md).</span></span>


---
title: "Escalado automático de nodos de proceso en un grupo de Azure Batch | Microsoft Docs"
description: "Habilite el escalado automático en un grupo en la nube para ajustar de forma dinámica el número de nodos de ejecución del grupo."
services: batch
documentationcenter: 
author: tamram
manager: timlt
editor: tysonn
ms.assetid: c624cdfc-c5f2-4d13-a7d7-ae080833b779
ms.service: batch
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: multiple
ms.date: 06/20/2017
ms.author: tamram
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: f0e49cd8a64a48c53f5b6104703164a597c797f0
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="create-an-automatic-scaling-formula-for-scaling-compute-nodes-in-a-batch-pool"></a><span data-ttu-id="d6242-103">Creación de una fórmula de escala automática para escalar nodos de proceso en un grupo de Batch</span><span class="sxs-lookup"><span data-stu-id="d6242-103">Create an automatic scaling formula for scaling compute nodes in a Batch pool</span></span>

<span data-ttu-id="d6242-104">Azure Batch puede escalar grupos automáticamente en función de los parámetros que defina.</span><span class="sxs-lookup"><span data-stu-id="d6242-104">Azure Batch can automatically scale pools based on parameters that you define.</span></span> <span data-ttu-id="d6242-105">Con el escalado automático, Batch agrega nodos dinámicamente a un grupo a medida que aumenta la demanda de tareas y quita nodos de ejecución a medida que disminuye.</span><span class="sxs-lookup"><span data-stu-id="d6242-105">With automatic scaling, Batch dynamically adds nodes to a pool as task demands increase, and removes compute nodes as they decrease.</span></span> <span data-ttu-id="d6242-106">El ajuste automático del número de nodos de ejecución que usa la aplicación Batch puede suponer un ahorro de tiempo y dinero.</span><span class="sxs-lookup"><span data-stu-id="d6242-106">You can save both time and money by automatically adjusting the number of compute nodes used by your Batch application.</span></span> 

<span data-ttu-id="d6242-107">Habilite el escalado automático en un grupo de nodos de ejecución asociándolo a una *fórmula de escalado automático* que se puede definir.</span><span class="sxs-lookup"><span data-stu-id="d6242-107">You enable automatic scaling on a pool of compute nodes by associating with it an *autoscale formula* that you define.</span></span> <span data-ttu-id="d6242-108">El servicio Batch usa esta fórmula para determinar el número de nodos de ejecución que se necesitan para ejecutar la carga de trabajo.</span><span class="sxs-lookup"><span data-stu-id="d6242-108">The Batch service uses the autoscale formula to determine the number of compute nodes that are needed to execute your workload.</span></span> <span data-ttu-id="d6242-109">Los nodos de ejecución pueden ser nodos dedicados o [nodos de prioridad baja](batch-low-pri-vms.md).</span><span class="sxs-lookup"><span data-stu-id="d6242-109">Compute nodes may be dedicated nodes or [low-priority nodes](batch-low-pri-vms.md).</span></span> <span data-ttu-id="d6242-110">Batch responde a los datos de métricas de servicio que se recolectan periódicamente.</span><span class="sxs-lookup"><span data-stu-id="d6242-110">Batch responds to service metrics data that is collected periodically.</span></span> <span data-ttu-id="d6242-111">Con estos datos de métricas, Batch ajusta el número de nodos de ejecución del grupo en función de la fórmula y en un intervalo configurable.</span><span class="sxs-lookup"><span data-stu-id="d6242-111">Using this metrics data, Batch adjusts the number of compute nodes in the pool based on your formula and at a configurable interval.</span></span>

<span data-ttu-id="d6242-112">Puede habilitar el escalado automático al crear un grupo o bien en un grupo existente.</span><span class="sxs-lookup"><span data-stu-id="d6242-112">You can enable automatic scaling either when a pool is created, or on an existing pool.</span></span> <span data-ttu-id="d6242-113">También puede cambiar una fórmula existente en un grupo configurado para el escalado automático.</span><span class="sxs-lookup"><span data-stu-id="d6242-113">You can also change an existing formula on a pool that is configured for autoscaling.</span></span> <span data-ttu-id="d6242-114">Batch le permite evaluar las fórmulas antes de asignarlas a grupos y supervisar el estado de las ejecuciones de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="d6242-114">Batch enables you to evaluate your formulas before assigning them to pools and to monitor the status of automatic scaling runs.</span></span>

<span data-ttu-id="d6242-115">En este artículo se describen las distintas entidades que conforman las fórmulas de escalado automático, por ejemplo, variables, operadores, operaciones y funciones.</span><span class="sxs-lookup"><span data-stu-id="d6242-115">This article discusses the various entities that make up your autoscale formulas, including variables, operators, operations, and functions.</span></span> <span data-ttu-id="d6242-116">Trataremos cómo obtener distintas métricas de recursos y tareas de proceso en Batch.</span><span class="sxs-lookup"><span data-stu-id="d6242-116">We discuss how to obtain various compute resource and task metrics within Batch.</span></span> <span data-ttu-id="d6242-117">Puede usar estas métricas para ajustar el número de nodos del grupo en función del estado de las tareas y del uso de recursos.</span><span class="sxs-lookup"><span data-stu-id="d6242-117">You can use these metrics to adjust your pool's node count based on resource usage and task status.</span></span> <span data-ttu-id="d6242-118">También explicaremos cómo construir una fórmula y habilitar el escalado automático en un grupo mediante API de .NET y API de REST de Batch.</span><span class="sxs-lookup"><span data-stu-id="d6242-118">We then describe how to construct a formula and enable automatic scaling on a pool by using both the Batch REST and .NET APIs.</span></span> <span data-ttu-id="d6242-119">Por último, terminaremos con algunas fórmulas de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="d6242-119">Finally, we finish up with a few example formulas.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d6242-120">Al crear una cuenta de Batch puede especificar la [configuración de la cuenta](batch-api-basics.md#account), que determina si se asignan grupos en una suscripción de servicio de Batch (opción predeterminada) o en su suscripción de usuario.</span><span class="sxs-lookup"><span data-stu-id="d6242-120">When you create a Batch account, you can specify the [account configuration](batch-api-basics.md#account), which determines whether pools are allocated in a Batch service subscription (the default), or in your user subscription.</span></span> <span data-ttu-id="d6242-121">Si ha creado su cuenta de Batch con la configuración predeterminada del servicio de Batch, la cuenta estará limitada a un máximo de núcleos que se pueden usar para el procesamiento.</span><span class="sxs-lookup"><span data-stu-id="d6242-121">If you created your Batch account with the default Batch Service configuration, then your account is limited to a maximum number of cores that can be used for processing.</span></span> <span data-ttu-id="d6242-122">El servicio de Batch escala nodos de ejecución solo hasta ese límite de núcleos.</span><span class="sxs-lookup"><span data-stu-id="d6242-122">The Batch service scales compute nodes only up to that core limit.</span></span> <span data-ttu-id="d6242-123">Por este motivo, puede que el servicio de Batch no alcance el número de nodos de ejecución que se especifiquen con una fórmula de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="d6242-123">For this reason, the Batch service may not reach the target number of compute nodes specified by an autoscale formula.</span></span> <span data-ttu-id="d6242-124">Consulte [Cuotas y límites del servicio de Lote de Azure](batch-quota-limit.md) para más información sobre la visualización y aumento de las cuotas de la cuenta.</span><span class="sxs-lookup"><span data-stu-id="d6242-124">See [Quotas and limits for the Azure Batch service](batch-quota-limit.md) for information on viewing and increasing your account quotas.</span></span>
>
><span data-ttu-id="d6242-125">Si ha creado su cuenta con la configuración de suscripción de usuario, su cuenta comparte la cuota de núcleos de la suscripción.</span><span class="sxs-lookup"><span data-stu-id="d6242-125">If you created your account with the User Subscription configuration, then your account shares in the core quota for the subscription.</span></span> <span data-ttu-id="d6242-126">Para más información, consulte [Límites de Virtual Machines](../azure-subscription-service-limits.md#virtual-machines-limits) en [Límites, cuotas y restricciones de suscripción y servicios de Microsoft Azure](../azure-subscription-service-limits.md).</span><span class="sxs-lookup"><span data-stu-id="d6242-126">For more information, see [Virtual Machines limits](../azure-subscription-service-limits.md#virtual-machines-limits) in [Azure subscription and service limits, quotas, and constraints](../azure-subscription-service-limits.md).</span></span>
>
>

## <a name="automatic-scaling-formulas"></a><span data-ttu-id="d6242-127">Fórmulas de escalado automático</span><span class="sxs-lookup"><span data-stu-id="d6242-127">Automatic scaling formulas</span></span>
<span data-ttu-id="d6242-128">Una fórmula de escalado automático es un valor de cadena que el usuario define y contiene una o varias instrucciones.</span><span class="sxs-lookup"><span data-stu-id="d6242-128">An automatic scaling formula is a string value that you define that contains one or more statements.</span></span> <span data-ttu-id="d6242-129">La fórmula de escalado automático se asigna a un elemento [autoScaleFormula][rest_autoscaleformula] de un grupo (REST de Batch) o a una propiedad [CloudPool.AutoScaleFormula][net_cloudpool_autoscaleformula] (Batch .NET).</span><span class="sxs-lookup"><span data-stu-id="d6242-129">The autoscale formula is assigned to a pool's [autoScaleFormula][rest_autoscaleformula] element (Batch REST) or [CloudPool.AutoScaleFormula][net_cloudpool_autoscaleformula] property (Batch .NET).</span></span> <span data-ttu-id="d6242-130">El servicio Batch usa la fórmula para determinar el número de nodos de ejecución del grupo durante el intervalo de procesamiento siguiente.</span><span class="sxs-lookup"><span data-stu-id="d6242-130">The Batch service uses your formula to determine the target number of compute nodes in the pool for the next interval of processing.</span></span> <span data-ttu-id="d6242-131">La cadena de fórmula no puede superar los 8 KB y puede incluir hasta 100 instrucciones separadas por punto y coma, así como saltos de línea y comentarios.</span><span class="sxs-lookup"><span data-stu-id="d6242-131">The formula string cannot exceed 8 KB, can include up to 100 statements that are separated by semicolons, and can include line breaks and comments.</span></span>

<span data-ttu-id="d6242-132">Puede imaginarse que las fórmulas de escalado automático son un "lenguaje" de escalado automático de Batch.</span><span class="sxs-lookup"><span data-stu-id="d6242-132">You can think of automatic scaling formulas as a Batch autoscale "language."</span></span> <span data-ttu-id="d6242-133">Las instrucciones de fórmula son expresiones de forma libre que pueden incluir variables definidas por el servicio (variables definidas por el servicio de Lote) y variables definidas por el usuario (variables que usted define).</span><span class="sxs-lookup"><span data-stu-id="d6242-133">Formula statements are free-formed expressions that can include both service-defined variables (variables defined by the Batch service) and user-defined variables (variables that you define).</span></span> <span data-ttu-id="d6242-134">Pueden realizar diversas operaciones en estos valores mediante funciones, operadores y tipos integrados.</span><span class="sxs-lookup"><span data-stu-id="d6242-134">They can perform various operations on these values by using built-in types, operators, and functions.</span></span> <span data-ttu-id="d6242-135">Por ejemplo, una instrucción podría tener la forma siguiente:</span><span class="sxs-lookup"><span data-stu-id="d6242-135">For example, a statement might take the following form:</span></span>

```
$myNewVariable = function($ServiceDefinedVariable, $myCustomVariable);
```

<span data-ttu-id="d6242-136">Las fórmulas suelen tener varias instrucciones que realizan operaciones en los valores obtenidos en las instrucciones anteriores.</span><span class="sxs-lookup"><span data-stu-id="d6242-136">Formulas generally contain multiple statements that perform operations on values that are obtained in previous statements.</span></span> <span data-ttu-id="d6242-137">Por ejemplo, en primer lugar, se obtiene un valor para `variable1`, a continuación, se pasa a una función para rellenar `variable2`:</span><span class="sxs-lookup"><span data-stu-id="d6242-137">For example, first we obtain a value for `variable1`, then pass it to a function to populate `variable2`:</span></span>

```
$variable1 = function1($ServiceDefinedVariable);
$variable2 = function2($OtherServiceDefinedVariable, $variable1);
```

<span data-ttu-id="d6242-138">Incluya estas instrucciones en la fórmula de escalado automático para llegar a un determinado número de nodos de ejecución.</span><span class="sxs-lookup"><span data-stu-id="d6242-138">Include these statements in your autoscale formula to arrive at a target number of compute nodes.</span></span> <span data-ttu-id="d6242-139">Los nodos dedicados y los nodos de prioridad baja tienen sus propios valores de destino, por lo que puede definir un destino para cada tipo de nodo.</span><span class="sxs-lookup"><span data-stu-id="d6242-139">Dedicated nodes and low-priority nodes each have their own target settings, so that you can define a target for each type of node.</span></span> <span data-ttu-id="d6242-140">Una fórmula de escalado automático puede incluir un valor de destino para los nodos dedicados, un valor de destino para los nodos de prioridad baja o ambos.</span><span class="sxs-lookup"><span data-stu-id="d6242-140">An autoscale formula can include a target value for dedicated nodes, a target value for low-priority nodes, or both.</span></span>

<span data-ttu-id="d6242-141">El número objetivo de nodos puede ser mayor, menor o igual que el número actual de nodos de ese tipo que hay en el grupo.</span><span class="sxs-lookup"><span data-stu-id="d6242-141">The target number of nodes may be higher, lower, or the same as the current number of nodes of that type in the pool.</span></span> <span data-ttu-id="d6242-142">Batch evalúa la fórmula de escalado automático del grupo según un intervalo específico (consulte [Intervalo de escalado automático](#automatic-scaling-interval)).</span><span class="sxs-lookup"><span data-stu-id="d6242-142">Batch evaluates a pool's autoscale formula at a specific interval (see [automatic scaling intervals](#automatic-scaling-interval)).</span></span> <span data-ttu-id="d6242-143">Batch ajusta el número de destino de cada tipo de nodo del grupo al número que especifica la fórmula de escalado automático en el momento de la evaluación.</span><span class="sxs-lookup"><span data-stu-id="d6242-143">Batch adjusts the target number of each type of node in the pool to the number that your autoscale formula specifies at the time of evaluation.</span></span>

### <a name="sample-autoscale-formula"></a><span data-ttu-id="d6242-144">Fórmula de escalado automático de muestras</span><span class="sxs-lookup"><span data-stu-id="d6242-144">Sample autoscale formula</span></span>

<span data-ttu-id="d6242-145">Aquí puede ver un ejemplo de fórmula de escalado automático que se puede ajustar para trabajar en la mayoría de escenarios.</span><span class="sxs-lookup"><span data-stu-id="d6242-145">Here is an example of an autoscale formula that can be adjusted to work for most scenarios.</span></span> <span data-ttu-id="d6242-146">Las variables `startingNumberOfVMs` y `maxNumberofVMs` de la fórmula de ejemplo se pueden ajustar a sus necesidades.</span><span class="sxs-lookup"><span data-stu-id="d6242-146">The variables `startingNumberOfVMs` and `maxNumberofVMs` in the example formula can be adjusted to your needs.</span></span> <span data-ttu-id="d6242-147">Esta fórmula escala los nodos dedicados, pero se puede modificar para escalar también los nodos de prioridad baja.</span><span class="sxs-lookup"><span data-stu-id="d6242-147">This formula scales dedicated nodes, but can be modified to apply to scale low-priority nodes as well.</span></span> 

```
startingNumberOfVMs = 1;
maxNumberofVMs = 25;
pendingTaskSamplePercent = $PendingTasks.GetSamplePercent(180 * TimeInterval_Second);
pendingTaskSamples = pendingTaskSamplePercent < 70 ? startingNumberOfVMs : avg($PendingTasks.GetSample(180 * TimeInterval_Second));
$TargetDedicatedNodes=min(maxNumberofVMs, pendingTaskSamples);
```

<span data-ttu-id="d6242-148">Con esta fórmula de escalado automático, el grupo se crea inicialmente con una sola máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="d6242-148">With this autoscale formula, the pool is initially created with a single VM.</span></span> <span data-ttu-id="d6242-149">La métrica `$PendingTasks` define el número de tareas que están en ejecución o en cola.</span><span class="sxs-lookup"><span data-stu-id="d6242-149">The `$PendingTasks` metric defines the number of tasks that are running or queued.</span></span> <span data-ttu-id="d6242-150">La fórmula busca el número promedio de tareas pendientes en los últimos 180 segundos y establece la variable `$TargetDedicatedNodes` en consecuencia.</span><span class="sxs-lookup"><span data-stu-id="d6242-150">The formula finds the average number of pending tasks in the last 180 seconds and sets the `$TargetDedicatedNodes` variable accordingly.</span></span> <span data-ttu-id="d6242-151">La fórmula garantiza que el número de destino de nodos dedicados nunca supere la cantidad de 25 máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="d6242-151">The formula ensures that the target number of dedicated nodes never exceeds 25 VMs.</span></span> <span data-ttu-id="d6242-152">El grupo crece automáticamente a medida que se envían nuevas tareas.</span><span class="sxs-lookup"><span data-stu-id="d6242-152">As new tasks are submitted, the pool automatically grows.</span></span> <span data-ttu-id="d6242-153">Cuando las tareas finalizan, las máquinas virtuales quedan libres una a una y la fórmula de escalado automático reduce el grupo.</span><span class="sxs-lookup"><span data-stu-id="d6242-153">As tasks complete, VMs become free one by one and the autoscaling formula shrinks the pool.</span></span>

## <a name="variables"></a><span data-ttu-id="d6242-154">variables</span><span class="sxs-lookup"><span data-stu-id="d6242-154">Variables</span></span>
<span data-ttu-id="d6242-155">En las fórmulas de escalado automático puede usar tanto variables **definidas por el servicio** como variables **definidas por el usuario**.</span><span class="sxs-lookup"><span data-stu-id="d6242-155">You can use both **service-defined** and **user-defined** variables in your autoscale formulas.</span></span> <span data-ttu-id="d6242-156">Las variables definidas por el servicio están integradas en el servicio de Batch.</span><span class="sxs-lookup"><span data-stu-id="d6242-156">The service-defined variables are built in to the Batch service.</span></span> <span data-ttu-id="d6242-157">Algunas variables definidas por el servicio son de lectura y escritura, mientras que otras son de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="d6242-157">Some service-defined variables are read-write, and some are read-only.</span></span> <span data-ttu-id="d6242-158">Las variables definidas por el usuario son las que usted define.</span><span class="sxs-lookup"><span data-stu-id="d6242-158">User-defined variables are variables that you define.</span></span> <span data-ttu-id="d6242-159">En la fórmula de ejemplo que se muestra en la sección anterior, `$TargetDedicatedNodes` y `$PendingTasks` son variables definidas por el servicio.</span><span class="sxs-lookup"><span data-stu-id="d6242-159">In the example formula shown in the previous section, `$TargetDedicatedNodes` and `$PendingTasks` are service-defined variables.</span></span> <span data-ttu-id="d6242-160">Las variables `startingNumberOfVMs` y `maxNumberofVMs` son variables definidas por el usuario.</span><span class="sxs-lookup"><span data-stu-id="d6242-160">Variables `startingNumberOfVMs` and `maxNumberofVMs` are user-defined variables.</span></span>

> [!NOTE]
> <span data-ttu-id="d6242-161">Las variables definidas por el servicio van siempre precedidas de un símbolo de dólar ($).</span><span class="sxs-lookup"><span data-stu-id="d6242-161">Service-defined variables are always preceded by a dollar sign ($).</span></span> <span data-ttu-id="d6242-162">En el caso de las variables definidas por el usuario, el símbolo de dólar es opcional.</span><span class="sxs-lookup"><span data-stu-id="d6242-162">For user-defined variables, the dollar sign is optional.</span></span>
>
>

<span data-ttu-id="d6242-163">En las siguientes tablas se muestran las variables de lectura y escritura y de solo lectura definidas por el servicio de Batch.</span><span class="sxs-lookup"><span data-stu-id="d6242-163">The following tables show both read-write and read-only variables that are defined by the Batch service.</span></span>

<span data-ttu-id="d6242-164">Puede obtener y establecer los valores de estas variables definidas por el servicio para administrar el número de nodos de ejecución de un grupo:</span><span class="sxs-lookup"><span data-stu-id="d6242-164">You can get and set the values of these service-defined variables to manage the number of compute nodes in a pool:</span></span>

| <span data-ttu-id="d6242-165">Variables definidas por el servicio de solo escritura</span><span class="sxs-lookup"><span data-stu-id="d6242-165">Read-write service-defined variables</span></span> | <span data-ttu-id="d6242-166">Descripción</span><span class="sxs-lookup"><span data-stu-id="d6242-166">Description</span></span> |
| --- | --- |
| <span data-ttu-id="d6242-167">$TargetDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="d6242-167">$TargetDedicatedNodes</span></span> |<span data-ttu-id="d6242-168">Número objetivo de nodos de ejecución dedicados para el grupo.</span><span class="sxs-lookup"><span data-stu-id="d6242-168">The target number of dedicated compute nodes for the pool.</span></span> <span data-ttu-id="d6242-169">El número de nodos dedicados se especifica como destino porque un grupo podría no lograr siempre el número de nodos deseado.</span><span class="sxs-lookup"><span data-stu-id="d6242-169">The number of dedicated nodes is specified as a target because a pool may not always achieve the desired number of nodes.</span></span> <span data-ttu-id="d6242-170">Por ejemplo, podría pasar que el grupo no alcanzara el número de destino si el número de nodos dedicados se modifica con una evaluación de escalado automático antes de que el grupo haya alcanzado el valor de destino inicial.</span><span class="sxs-lookup"><span data-stu-id="d6242-170">For example, if the target number of dedicated nodes is modified by an autoscale evaluation before the pool has reached the initial target, then the pool may not reach the target.</span></span> <br /><br /> <span data-ttu-id="d6242-171">Podría pasar que un grupo de una cuenta creada con la configuración del servicio de Batch no alcanzara su valor de destino si el destino supera una cuota de núcleos o de nodos de la cuenta de Batch.</span><span class="sxs-lookup"><span data-stu-id="d6242-171">A pool in an account created with the Batch Service configuration may not achieve its target if the target exceeds a Batch account node or core quota.</span></span> <span data-ttu-id="d6242-172">Podría pasar que un grupo de una cuenta creada con la configuración de suscripción de usuario no alcanzara su valor de destino si el destino supera la cuota de núcleos compartidos de la suscripción.</span><span class="sxs-lookup"><span data-stu-id="d6242-172">A pool in an account created with the User Subscription configuration may not achieve its target if the target exceeds the shared core quota for the subscription.</span></span>|
| <span data-ttu-id="d6242-173">$TargetLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="d6242-173">$TargetLowPriorityNodes</span></span> |<span data-ttu-id="d6242-174">Número objetivo de nodos de ejecución de prioridad baja para el grupo.</span><span class="sxs-lookup"><span data-stu-id="d6242-174">The target number of low-priority compute nodes for the pool.</span></span> <span data-ttu-id="d6242-175">El número de nodos de prioridad baja se especifica como destino porque un grupo podría no lograr siempre el número de nodos deseado.</span><span class="sxs-lookup"><span data-stu-id="d6242-175">The number of low-priority nodes is specified as a target because a pool may not always achieve the desired number of nodes.</span></span> <span data-ttu-id="d6242-176">Por ejemplo, podría pasar que el grupo no alcanzara el número de destino si el número de nodos de prioridad baja se modifica con una evaluación de escalado automático antes de que el grupo haya alcanzado el valor de destino inicial.</span><span class="sxs-lookup"><span data-stu-id="d6242-176">For example, if the target number of low-priority nodes is modified by an autoscale evaluation before the pool has reached the initial target, then the pool may not reach the target.</span></span> <span data-ttu-id="d6242-177">Además, también podría pasar que un grupo no alcanzara el valor de destino si el destino supera una cuota de núcleos o de nodos de la cuenta de Batch.</span><span class="sxs-lookup"><span data-stu-id="d6242-177">A pool may also not achieve its target if the target exceeds a Batch account node or core quota.</span></span> <br /><br /> <span data-ttu-id="d6242-178">Para obtener más información sobre los nodos de ejecución de prioridad baja, consulte [Uso de máquinas virtuales de prioridad baja con Batch (versión preliminar)](batch-low-pri-vms.md).</span><span class="sxs-lookup"><span data-stu-id="d6242-178">For more information on low-priority compute nodes, see [Use low-priority VMs with Batch (Preview)](batch-low-pri-vms.md).</span></span> |
| <span data-ttu-id="d6242-179">$NodeDeallocationOption</span><span class="sxs-lookup"><span data-stu-id="d6242-179">$NodeDeallocationOption</span></span> |<span data-ttu-id="d6242-180">La acción que se produce cuando se quitan los nodos de ejecución de un grupo.</span><span class="sxs-lookup"><span data-stu-id="d6242-180">The action that occurs when compute nodes are removed from a pool.</span></span> <span data-ttu-id="d6242-181">Los valores posibles son:</span><span class="sxs-lookup"><span data-stu-id="d6242-181">Possible values are:</span></span><ul><li><span data-ttu-id="d6242-182">**requeue**: finaliza las tareas de inmediato y las vuelve a poner en la cola de trabajos para que se vuelvan a programar.</span><span class="sxs-lookup"><span data-stu-id="d6242-182">**requeue**--Terminates tasks immediately and puts them back on the job queue so that they are rescheduled.</span></span><li><span data-ttu-id="d6242-183">**terminate**: finaliza las tareas de inmediato y las quitar de la cola de trabajos.</span><span class="sxs-lookup"><span data-stu-id="d6242-183">**terminate**--Terminates tasks immediately and removes them from the job queue.</span></span><li><span data-ttu-id="d6242-184">**taskcompletion**: espera a que finalicen las tareas actualmente en ejecución y, a continuación, quita el nodo del grupo.</span><span class="sxs-lookup"><span data-stu-id="d6242-184">**taskcompletion**--Waits for currently running tasks to finish and then removes the node from the pool.</span></span><li><span data-ttu-id="d6242-185">**retaineddata**: espera a que todos los datos que se conservan en la tarea local en el nodo se limpien antes de quitar el nodo del grupo.</span><span class="sxs-lookup"><span data-stu-id="d6242-185">**retaineddata**--Waits for all the local task-retained data on the node to be cleaned up before removing the node from the pool.</span></span></ul> |

<span data-ttu-id="d6242-186">Puede obtener el valor de estas variables definidas por el servicio para efectuar ajustes basados en las métricas del servicio de Batch:</span><span class="sxs-lookup"><span data-stu-id="d6242-186">You can get the value of these service-defined variables to make adjustments that are based on metrics from the Batch service:</span></span>

| <span data-ttu-id="d6242-187">Variables definidas por el servicio de solo lectura</span><span class="sxs-lookup"><span data-stu-id="d6242-187">Read-only service-defined variables</span></span> | <span data-ttu-id="d6242-188">Description</span><span class="sxs-lookup"><span data-stu-id="d6242-188">Description</span></span> |
| --- | --- |
| <span data-ttu-id="d6242-189">$CPUPercent</span><span class="sxs-lookup"><span data-stu-id="d6242-189">$CPUPercent</span></span> |<span data-ttu-id="d6242-190">El porcentaje medio de uso de CPU.</span><span class="sxs-lookup"><span data-stu-id="d6242-190">The average percentage of CPU usage.</span></span> |
| <span data-ttu-id="d6242-191">$WallClockSeconds</span><span class="sxs-lookup"><span data-stu-id="d6242-191">$WallClockSeconds</span></span> |<span data-ttu-id="d6242-192">El número de segundos consumidos.</span><span class="sxs-lookup"><span data-stu-id="d6242-192">The number of seconds consumed.</span></span> |
| <span data-ttu-id="d6242-193">$MemoryBytes</span><span class="sxs-lookup"><span data-stu-id="d6242-193">$MemoryBytes</span></span> |<span data-ttu-id="d6242-194">La media de megabytes usados.</span><span class="sxs-lookup"><span data-stu-id="d6242-194">The average number of megabytes used.</span></span> |
| <span data-ttu-id="d6242-195">$DiskBytes</span><span class="sxs-lookup"><span data-stu-id="d6242-195">$DiskBytes</span></span> |<span data-ttu-id="d6242-196">La media de gigabytes usados en los discos locales.</span><span class="sxs-lookup"><span data-stu-id="d6242-196">The average number of gigabytes used on the local disks.</span></span> |
| <span data-ttu-id="d6242-197">$DiskReadBytes</span><span class="sxs-lookup"><span data-stu-id="d6242-197">$DiskReadBytes</span></span> |<span data-ttu-id="d6242-198">El número de bytes leídos.</span><span class="sxs-lookup"><span data-stu-id="d6242-198">The number of bytes read.</span></span> |
| <span data-ttu-id="d6242-199">$DiskWriteBytes</span><span class="sxs-lookup"><span data-stu-id="d6242-199">$DiskWriteBytes</span></span> |<span data-ttu-id="d6242-200">El número de bytes escritos.</span><span class="sxs-lookup"><span data-stu-id="d6242-200">The number of bytes written.</span></span> |
| <span data-ttu-id="d6242-201">$DiskReadOps</span><span class="sxs-lookup"><span data-stu-id="d6242-201">$DiskReadOps</span></span> |<span data-ttu-id="d6242-202">El número de operaciones de disco de lectura realizadas.</span><span class="sxs-lookup"><span data-stu-id="d6242-202">The count of read disk operations performed.</span></span> |
| <span data-ttu-id="d6242-203">$DiskWriteOps</span><span class="sxs-lookup"><span data-stu-id="d6242-203">$DiskWriteOps</span></span> |<span data-ttu-id="d6242-204">El número de operaciones de disco de escritura realizadas.</span><span class="sxs-lookup"><span data-stu-id="d6242-204">The count of write disk operations performed.</span></span> |
| <span data-ttu-id="d6242-205">$NetworkInBytes</span><span class="sxs-lookup"><span data-stu-id="d6242-205">$NetworkInBytes</span></span> |<span data-ttu-id="d6242-206">El número de bytes entrantes.</span><span class="sxs-lookup"><span data-stu-id="d6242-206">The number of inbound bytes.</span></span> |
| <span data-ttu-id="d6242-207">$NetworkOutBytes</span><span class="sxs-lookup"><span data-stu-id="d6242-207">$NetworkOutBytes</span></span> |<span data-ttu-id="d6242-208">El número de bytes salientes.</span><span class="sxs-lookup"><span data-stu-id="d6242-208">The number of outbound bytes.</span></span> |
| <span data-ttu-id="d6242-209">$SampleNodeCount</span><span class="sxs-lookup"><span data-stu-id="d6242-209">$SampleNodeCount</span></span> |<span data-ttu-id="d6242-210">El número de nodos de ejecución.</span><span class="sxs-lookup"><span data-stu-id="d6242-210">The count of compute nodes.</span></span> |
| <span data-ttu-id="d6242-211">$ActiveTasks</span><span class="sxs-lookup"><span data-stu-id="d6242-211">$ActiveTasks</span></span> |<span data-ttu-id="d6242-212">Número de tareas que están listas para su ejecución pero que aún no se están ejecutando.</span><span class="sxs-lookup"><span data-stu-id="d6242-212">The number of tasks that are ready to execute but are not yet executing.</span></span> <span data-ttu-id="d6242-213">El recuento de $ActiveTasks incluye todas las tareas que tienen un estado activo y cuyas dependencias se han cumplido.</span><span class="sxs-lookup"><span data-stu-id="d6242-213">The $ActiveTasks count includes all tasks that are in the active state and whose dependencies have been satisfied.</span></span> <span data-ttu-id="d6242-214">Todas las tareas que tengan un estado activo pero cuyas dependencias no se hayan cumplido se excluirán del recuento de $ActiveTasks.</span><span class="sxs-lookup"><span data-stu-id="d6242-214">Any tasks that are in the active state but whose dependencies have not been satisfied are excluded from the $ActiveTasks count.</span></span>|
| <span data-ttu-id="d6242-215">$RunningTasks</span><span class="sxs-lookup"><span data-stu-id="d6242-215">$RunningTasks</span></span> |<span data-ttu-id="d6242-216">El número de tareas en un estado de ejecución.</span><span class="sxs-lookup"><span data-stu-id="d6242-216">The number of tasks in a running state.</span></span> |
| <span data-ttu-id="d6242-217">$PendingTasks</span><span class="sxs-lookup"><span data-stu-id="d6242-217">$PendingTasks</span></span> |<span data-ttu-id="d6242-218">La suma de $ActiveTasks y $RunningTasks.</span><span class="sxs-lookup"><span data-stu-id="d6242-218">The sum of $ActiveTasks and $RunningTasks.</span></span> |
| <span data-ttu-id="d6242-219">$SucceededTasks</span><span class="sxs-lookup"><span data-stu-id="d6242-219">$SucceededTasks</span></span> |<span data-ttu-id="d6242-220">El número de tareas que finalizó correctamente.</span><span class="sxs-lookup"><span data-stu-id="d6242-220">The number of tasks that finished successfully.</span></span> |
| <span data-ttu-id="d6242-221">$FailedTasks</span><span class="sxs-lookup"><span data-stu-id="d6242-221">$FailedTasks</span></span> |<span data-ttu-id="d6242-222">El número de tareas erróneas.</span><span class="sxs-lookup"><span data-stu-id="d6242-222">The number of tasks that failed.</span></span> |
| <span data-ttu-id="d6242-223">$CurrentDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="d6242-223">$CurrentDedicatedNodes</span></span> |<span data-ttu-id="d6242-224">El número actual de dedicado de nodos de ejecución dedicados.</span><span class="sxs-lookup"><span data-stu-id="d6242-224">The current number of dedicated compute nodes.</span></span> |
| <span data-ttu-id="d6242-225">$CurrentLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="d6242-225">$CurrentLowPriorityNodes</span></span> |<span data-ttu-id="d6242-226">Número actual de nodos de ejecución de prioridad baja, incluidos todos los nodos adelantados.</span><span class="sxs-lookup"><span data-stu-id="d6242-226">The current number of low-priority compute nodes, including any nodes that have been pre-empted.</span></span> |
| <span data-ttu-id="d6242-227">$PreemptedNodeCount</span><span class="sxs-lookup"><span data-stu-id="d6242-227">$PreemptedNodeCount</span></span> | <span data-ttu-id="d6242-228">Número de nodos del grupo que se encuentran en estado adelantado.</span><span class="sxs-lookup"><span data-stu-id="d6242-228">The number of nodes in the pool that are in a pre-empted state.</span></span> |

> [!TIP]
> <span data-ttu-id="d6242-229">Las variables de solo lectura definidas por el servicio que se muestran en la tabla anterior son *objetos* que proporcionan distintos métodos para obtener acceso a los datos asociados a cada uno de ellos.</span><span class="sxs-lookup"><span data-stu-id="d6242-229">The read-only, service-defined variables that are shown in the previous table are *objects* that provide various methods to access data associated with each.</span></span> <span data-ttu-id="d6242-230">Para obtener más información, consulte la sección [Obtención de datos de ejemplo](#getsampledata), descrita más adelante en este artículo.</span><span class="sxs-lookup"><span data-stu-id="d6242-230">For more information, see [Obtain sample data](#getsampledata) later in this article.</span></span>
>
>

## <a name="types"></a><span data-ttu-id="d6242-231">Tipos</span><span class="sxs-lookup"><span data-stu-id="d6242-231">Types</span></span>
<span data-ttu-id="d6242-232">Estos son los tipos que se admiten en las fórmulas:</span><span class="sxs-lookup"><span data-stu-id="d6242-232">These types are supported in a formula:</span></span>

* <span data-ttu-id="d6242-233">double</span><span class="sxs-lookup"><span data-stu-id="d6242-233">double</span></span>
* <span data-ttu-id="d6242-234">doubleVec</span><span class="sxs-lookup"><span data-stu-id="d6242-234">doubleVec</span></span>
* <span data-ttu-id="d6242-235">doubleVecList</span><span class="sxs-lookup"><span data-stu-id="d6242-235">doubleVecList</span></span>
* <span data-ttu-id="d6242-236">string</span><span class="sxs-lookup"><span data-stu-id="d6242-236">string</span></span>
* <span data-ttu-id="d6242-237">timestamp: timestamp es una estructura compuesta que contiene los siguientes miembros:</span><span class="sxs-lookup"><span data-stu-id="d6242-237">timestamp--timestamp is a compound structure that contains the following members:</span></span>

  * <span data-ttu-id="d6242-238">year</span><span class="sxs-lookup"><span data-stu-id="d6242-238">year</span></span>
  * <span data-ttu-id="d6242-239">mes (1-12)</span><span class="sxs-lookup"><span data-stu-id="d6242-239">month (1-12)</span></span>
  * <span data-ttu-id="d6242-240">día (1-31)</span><span class="sxs-lookup"><span data-stu-id="d6242-240">day (1-31)</span></span>
  * <span data-ttu-id="d6242-241">día de la semana (en formato de número; por ejemplo, 1 para lunes)</span><span class="sxs-lookup"><span data-stu-id="d6242-241">weekday (in the format of number; for example, 1 for Monday)</span></span>
  * <span data-ttu-id="d6242-242">hora (en formato de número de 24 horas; por ejemplo, 13 significa 1 p.m.)</span><span class="sxs-lookup"><span data-stu-id="d6242-242">hour (in 24-hour number format; for example, 13 means 1 PM)</span></span>
  * <span data-ttu-id="d6242-243">minuto (00-59)</span><span class="sxs-lookup"><span data-stu-id="d6242-243">minute (00-59)</span></span>
  * <span data-ttu-id="d6242-244">segundo (00-59)</span><span class="sxs-lookup"><span data-stu-id="d6242-244">second (00-59)</span></span>
* <span data-ttu-id="d6242-245">timeinterval</span><span class="sxs-lookup"><span data-stu-id="d6242-245">timeinterval</span></span>

  * <span data-ttu-id="d6242-246">TimeInterval_Zero</span><span class="sxs-lookup"><span data-stu-id="d6242-246">TimeInterval_Zero</span></span>
  * <span data-ttu-id="d6242-247">TimeInterval_100ns</span><span class="sxs-lookup"><span data-stu-id="d6242-247">TimeInterval_100ns</span></span>
  * <span data-ttu-id="d6242-248">TimeInterval_Microsecond</span><span class="sxs-lookup"><span data-stu-id="d6242-248">TimeInterval_Microsecond</span></span>
  * <span data-ttu-id="d6242-249">TimeInterval_Millisecond</span><span class="sxs-lookup"><span data-stu-id="d6242-249">TimeInterval_Millisecond</span></span>
  * <span data-ttu-id="d6242-250">TimeInterval_Second</span><span class="sxs-lookup"><span data-stu-id="d6242-250">TimeInterval_Second</span></span>
  * <span data-ttu-id="d6242-251">TimeInterval_Minute</span><span class="sxs-lookup"><span data-stu-id="d6242-251">TimeInterval_Minute</span></span>
  * <span data-ttu-id="d6242-252">TimeInterval_Hour</span><span class="sxs-lookup"><span data-stu-id="d6242-252">TimeInterval_Hour</span></span>
  * <span data-ttu-id="d6242-253">TimeInterval_Day</span><span class="sxs-lookup"><span data-stu-id="d6242-253">TimeInterval_Day</span></span>
  * <span data-ttu-id="d6242-254">TimeInterval_Week</span><span class="sxs-lookup"><span data-stu-id="d6242-254">TimeInterval_Week</span></span>
  * <span data-ttu-id="d6242-255">TimeInterval_Year</span><span class="sxs-lookup"><span data-stu-id="d6242-255">TimeInterval_Year</span></span>

## <a name="operations"></a><span data-ttu-id="d6242-256">Operaciones</span><span class="sxs-lookup"><span data-stu-id="d6242-256">Operations</span></span>
<span data-ttu-id="d6242-257">Estas operaciones se permiten en los tipos que constan en la sección anterior.</span><span class="sxs-lookup"><span data-stu-id="d6242-257">These operations are allowed on the types that are listed in the previous section.</span></span>

| <span data-ttu-id="d6242-258">Operación</span><span class="sxs-lookup"><span data-stu-id="d6242-258">Operation</span></span> | <span data-ttu-id="d6242-259">Operadores admitidos</span><span class="sxs-lookup"><span data-stu-id="d6242-259">Supported operators</span></span> | <span data-ttu-id="d6242-260">Tipo de resultado</span><span class="sxs-lookup"><span data-stu-id="d6242-260">Result type</span></span> |
| --- | --- | --- |
| <span data-ttu-id="d6242-261">double *operador* double</span><span class="sxs-lookup"><span data-stu-id="d6242-261">double *operator* double</span></span> |<span data-ttu-id="d6242-262">+, -, *, /</span><span class="sxs-lookup"><span data-stu-id="d6242-262">+, -, *, /</span></span> |<span data-ttu-id="d6242-263">double</span><span class="sxs-lookup"><span data-stu-id="d6242-263">double</span></span> |
| <span data-ttu-id="d6242-264">double *operador* timeinterval</span><span class="sxs-lookup"><span data-stu-id="d6242-264">double *operator* timeinterval</span></span> |* |<span data-ttu-id="d6242-265">timeinterval</span><span class="sxs-lookup"><span data-stu-id="d6242-265">timeinterval</span></span> |
| <span data-ttu-id="d6242-266">doubleVec *operador* double</span><span class="sxs-lookup"><span data-stu-id="d6242-266">doubleVec *operator* double</span></span> |<span data-ttu-id="d6242-267">+, -, *, /</span><span class="sxs-lookup"><span data-stu-id="d6242-267">+, -, *, /</span></span> |<span data-ttu-id="d6242-268">doubleVec</span><span class="sxs-lookup"><span data-stu-id="d6242-268">doubleVec</span></span> |
| <span data-ttu-id="d6242-269">doubleVec *operador* doubleVec</span><span class="sxs-lookup"><span data-stu-id="d6242-269">doubleVec *operator* doubleVec</span></span> |<span data-ttu-id="d6242-270">+, -, *, /</span><span class="sxs-lookup"><span data-stu-id="d6242-270">+, -, *, /</span></span> |<span data-ttu-id="d6242-271">doubleVec</span><span class="sxs-lookup"><span data-stu-id="d6242-271">doubleVec</span></span> |
| <span data-ttu-id="d6242-272">timeinterval *operador* double</span><span class="sxs-lookup"><span data-stu-id="d6242-272">timeinterval *operator* double</span></span> |<span data-ttu-id="d6242-273">*, /</span><span class="sxs-lookup"><span data-stu-id="d6242-273">*, /</span></span> |<span data-ttu-id="d6242-274">timeinterval</span><span class="sxs-lookup"><span data-stu-id="d6242-274">timeinterval</span></span> |
| <span data-ttu-id="d6242-275">timeinterval *operador* timeinterval</span><span class="sxs-lookup"><span data-stu-id="d6242-275">timeinterval *operator* timeinterval</span></span> |<span data-ttu-id="d6242-276">+, -</span><span class="sxs-lookup"><span data-stu-id="d6242-276">+, -</span></span> |<span data-ttu-id="d6242-277">timeinterval</span><span class="sxs-lookup"><span data-stu-id="d6242-277">timeinterval</span></span> |
| <span data-ttu-id="d6242-278">timeinterval *operador* timestamp</span><span class="sxs-lookup"><span data-stu-id="d6242-278">timeinterval *operator* timestamp</span></span> |+ |<span data-ttu-id="d6242-279">timestamp</span><span class="sxs-lookup"><span data-stu-id="d6242-279">timestamp</span></span> |
| <span data-ttu-id="d6242-280">timestamp *operador* timeinterval</span><span class="sxs-lookup"><span data-stu-id="d6242-280">timestamp *operator* timeinterval</span></span> |+ |<span data-ttu-id="d6242-281">timestamp</span><span class="sxs-lookup"><span data-stu-id="d6242-281">timestamp</span></span> |
| <span data-ttu-id="d6242-282">timestamp *operador* timestamp</span><span class="sxs-lookup"><span data-stu-id="d6242-282">timestamp *operator* timestamp</span></span> |- |<span data-ttu-id="d6242-283">timeinterval</span><span class="sxs-lookup"><span data-stu-id="d6242-283">timeinterval</span></span> |
| <span data-ttu-id="d6242-284">*operador*double</span><span class="sxs-lookup"><span data-stu-id="d6242-284">*operator*double</span></span> |<span data-ttu-id="d6242-285">-, !</span><span class="sxs-lookup"><span data-stu-id="d6242-285">-, !</span></span> |<span data-ttu-id="d6242-286">double</span><span class="sxs-lookup"><span data-stu-id="d6242-286">double</span></span> |
| <span data-ttu-id="d6242-287">*operador*timeinterval</span><span class="sxs-lookup"><span data-stu-id="d6242-287">*operator*timeinterval</span></span> |- |<span data-ttu-id="d6242-288">timeinterval</span><span class="sxs-lookup"><span data-stu-id="d6242-288">timeinterval</span></span> |
| <span data-ttu-id="d6242-289">double *operador* double</span><span class="sxs-lookup"><span data-stu-id="d6242-289">double *operator* double</span></span> |<span data-ttu-id="d6242-290"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="d6242-290"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="d6242-291">double</span><span class="sxs-lookup"><span data-stu-id="d6242-291">double</span></span> |
| <span data-ttu-id="d6242-292">string *operador* string</span><span class="sxs-lookup"><span data-stu-id="d6242-292">string *operator* string</span></span> |<span data-ttu-id="d6242-293"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="d6242-293"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="d6242-294">double</span><span class="sxs-lookup"><span data-stu-id="d6242-294">double</span></span> |
| <span data-ttu-id="d6242-295">timestamp *operador* timestamp</span><span class="sxs-lookup"><span data-stu-id="d6242-295">timestamp *operator* timestamp</span></span> |<span data-ttu-id="d6242-296"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="d6242-296"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="d6242-297">double</span><span class="sxs-lookup"><span data-stu-id="d6242-297">double</span></span> |
| <span data-ttu-id="d6242-298">timeinterval *operador* timeinterval</span><span class="sxs-lookup"><span data-stu-id="d6242-298">timeinterval *operator* timeinterval</span></span> |<span data-ttu-id="d6242-299"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="d6242-299"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="d6242-300">double</span><span class="sxs-lookup"><span data-stu-id="d6242-300">double</span></span> |
| <span data-ttu-id="d6242-301">double *operador* double</span><span class="sxs-lookup"><span data-stu-id="d6242-301">double *operator* double</span></span> |<span data-ttu-id="d6242-302">&&, &#124;&#124;</span><span class="sxs-lookup"><span data-stu-id="d6242-302">&&, &#124;&#124;</span></span> |<span data-ttu-id="d6242-303">double</span><span class="sxs-lookup"><span data-stu-id="d6242-303">double</span></span> |

<span data-ttu-id="d6242-304">Cuando se prueba un valor double con un operador ternario (`double ? statement1 : statement2`), el valor distinto de cero es **true** y cero es **false**.</span><span class="sxs-lookup"><span data-stu-id="d6242-304">When testing a double with a ternary operator (`double ? statement1 : statement2`), nonzero is **true**, and zero is **false**.</span></span>

## <a name="functions"></a><span data-ttu-id="d6242-305">Funciones</span><span class="sxs-lookup"><span data-stu-id="d6242-305">Functions</span></span>
<span data-ttu-id="d6242-306">Estas **funciones** predefinidas están disponibles para que las use al definir fórmulas de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="d6242-306">These predefined **functions** are available for you to use in defining an automatic scaling formula.</span></span>

| <span data-ttu-id="d6242-307">Función</span><span class="sxs-lookup"><span data-stu-id="d6242-307">Function</span></span> | <span data-ttu-id="d6242-308">Tipo de valor devuelto</span><span class="sxs-lookup"><span data-stu-id="d6242-308">Return type</span></span> | <span data-ttu-id="d6242-309">Description</span><span class="sxs-lookup"><span data-stu-id="d6242-309">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="d6242-310">avg(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="d6242-310">avg(doubleVecList)</span></span> |<span data-ttu-id="d6242-311">double</span><span class="sxs-lookup"><span data-stu-id="d6242-311">double</span></span> |<span data-ttu-id="d6242-312">Devuelve el valor medio de todos los valores de doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="d6242-312">Returns the average value for all values in the doubleVecList.</span></span> |
| <span data-ttu-id="d6242-313">len(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="d6242-313">len(doubleVecList)</span></span> |<span data-ttu-id="d6242-314">double</span><span class="sxs-lookup"><span data-stu-id="d6242-314">double</span></span> |<span data-ttu-id="d6242-315">Devuelve la longitud del vector creado a partir de doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="d6242-315">Returns the length of the vector that is created from the doubleVecList.</span></span> |
| <span data-ttu-id="d6242-316">lg(double)</span><span class="sxs-lookup"><span data-stu-id="d6242-316">lg(double)</span></span> |<span data-ttu-id="d6242-317">double</span><span class="sxs-lookup"><span data-stu-id="d6242-317">double</span></span> |<span data-ttu-id="d6242-318">Devuelve la base logarítmica 2 de double.</span><span class="sxs-lookup"><span data-stu-id="d6242-318">Returns the log base 2 of the double.</span></span> |
| <span data-ttu-id="d6242-319">lg(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="d6242-319">lg(doubleVecList)</span></span> |<span data-ttu-id="d6242-320">doubleVec</span><span class="sxs-lookup"><span data-stu-id="d6242-320">doubleVec</span></span> |<span data-ttu-id="d6242-321">Devuelve la base logarítmica de componentes 2 de doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="d6242-321">Returns the component-wise log base 2 of the doubleVecList.</span></span> <span data-ttu-id="d6242-322">Se debe pasar explícitamente un vec(double) para el parámetro.</span><span class="sxs-lookup"><span data-stu-id="d6242-322">A vec(double) must be explicitly passed for the parameter.</span></span> <span data-ttu-id="d6242-323">En caso contrario, se supone la versión double lg(double).</span><span class="sxs-lookup"><span data-stu-id="d6242-323">Otherwise, the double lg(double) version is assumed.</span></span> |
| <span data-ttu-id="d6242-324">ln(double)</span><span class="sxs-lookup"><span data-stu-id="d6242-324">ln(double)</span></span> |<span data-ttu-id="d6242-325">double</span><span class="sxs-lookup"><span data-stu-id="d6242-325">double</span></span> |<span data-ttu-id="d6242-326">Devuelve el registro natural de double.</span><span class="sxs-lookup"><span data-stu-id="d6242-326">Returns the natural log of the double.</span></span> |
| <span data-ttu-id="d6242-327">ln(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="d6242-327">ln(doubleVecList)</span></span> |<span data-ttu-id="d6242-328">doubleVec</span><span class="sxs-lookup"><span data-stu-id="d6242-328">doubleVec</span></span> |<span data-ttu-id="d6242-329">Devuelve la base logarítmica de componentes 2 de doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="d6242-329">Returns the component-wise log base 2 of the doubleVecList.</span></span> <span data-ttu-id="d6242-330">Se debe pasar explícitamente un vec(double) para el parámetro.</span><span class="sxs-lookup"><span data-stu-id="d6242-330">A vec(double) must be explicitly passed for the parameter.</span></span> <span data-ttu-id="d6242-331">En caso contrario, se supone la versión double lg(double).</span><span class="sxs-lookup"><span data-stu-id="d6242-331">Otherwise, the double lg(double) version is assumed.</span></span> |
| <span data-ttu-id="d6242-332">log(double)</span><span class="sxs-lookup"><span data-stu-id="d6242-332">log(double)</span></span> |<span data-ttu-id="d6242-333">double</span><span class="sxs-lookup"><span data-stu-id="d6242-333">double</span></span> |<span data-ttu-id="d6242-334">Devuelve la base logarítmica 10 de double.</span><span class="sxs-lookup"><span data-stu-id="d6242-334">Returns the log base 10 of the double.</span></span> |
| <span data-ttu-id="d6242-335">log(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="d6242-335">log(doubleVecList)</span></span> |<span data-ttu-id="d6242-336">doubleVec</span><span class="sxs-lookup"><span data-stu-id="d6242-336">doubleVec</span></span> |<span data-ttu-id="d6242-337">Devuelve la base logarítmica de componentes 10 de doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="d6242-337">Returns the component-wise log base 10 of the doubleVecList.</span></span> <span data-ttu-id="d6242-338">Se debe pasar explícitamente un vec(double) para un único parámetro double.</span><span class="sxs-lookup"><span data-stu-id="d6242-338">A vec(double) must be explicitly passed for the single double parameter.</span></span> <span data-ttu-id="d6242-339">En caso contrario, se supone la versión double log(double).</span><span class="sxs-lookup"><span data-stu-id="d6242-339">Otherwise, the double log(double) version is assumed.</span></span> |
| <span data-ttu-id="d6242-340">max(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="d6242-340">max(doubleVecList)</span></span> |<span data-ttu-id="d6242-341">double</span><span class="sxs-lookup"><span data-stu-id="d6242-341">double</span></span> |<span data-ttu-id="d6242-342">Devuelve el valor máximo de doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="d6242-342">Returns the maximum value in the doubleVecList.</span></span> |
| <span data-ttu-id="d6242-343">min(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="d6242-343">min(doubleVecList)</span></span> |<span data-ttu-id="d6242-344">double</span><span class="sxs-lookup"><span data-stu-id="d6242-344">double</span></span> |<span data-ttu-id="d6242-345">Devuelve el valor mínimo de doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="d6242-345">Returns the minimum value in the doubleVecList.</span></span> |
| <span data-ttu-id="d6242-346">norm(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="d6242-346">norm(doubleVecList)</span></span> |<span data-ttu-id="d6242-347">double</span><span class="sxs-lookup"><span data-stu-id="d6242-347">double</span></span> |<span data-ttu-id="d6242-348">Devuelve la norma de dos del vector creado a partir de doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="d6242-348">Returns the two-norm of the vector that is created from the doubleVecList.</span></span> |
| <span data-ttu-id="d6242-349">percentile(doubleVec v, double p)</span><span class="sxs-lookup"><span data-stu-id="d6242-349">percentile(doubleVec v, double p)</span></span> |<span data-ttu-id="d6242-350">double</span><span class="sxs-lookup"><span data-stu-id="d6242-350">double</span></span> |<span data-ttu-id="d6242-351">Devuelve el elemento percentil del vector v.</span><span class="sxs-lookup"><span data-stu-id="d6242-351">Returns the percentile element of the vector v.</span></span> |
| <span data-ttu-id="d6242-352">rand()</span><span class="sxs-lookup"><span data-stu-id="d6242-352">rand()</span></span> |<span data-ttu-id="d6242-353">double</span><span class="sxs-lookup"><span data-stu-id="d6242-353">double</span></span> |<span data-ttu-id="d6242-354">Devuelve un valor aleatorio entre 0,0 y 1,0.</span><span class="sxs-lookup"><span data-stu-id="d6242-354">Returns a random value between 0.0 and 1.0.</span></span> |
| <span data-ttu-id="d6242-355">range(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="d6242-355">range(doubleVecList)</span></span> |<span data-ttu-id="d6242-356">double</span><span class="sxs-lookup"><span data-stu-id="d6242-356">double</span></span> |<span data-ttu-id="d6242-357">Devuelve la diferencia entre los valores máximo y mínimo en doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="d6242-357">Returns the difference between the min and max values in the doubleVecList.</span></span> |
| <span data-ttu-id="d6242-358">std(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="d6242-358">std(doubleVecList)</span></span> |<span data-ttu-id="d6242-359">double</span><span class="sxs-lookup"><span data-stu-id="d6242-359">double</span></span> |<span data-ttu-id="d6242-360">Devuelve la desviación de muestra estándar de los valores en doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="d6242-360">Returns the sample standard deviation of the values in the doubleVecList.</span></span> |
| <span data-ttu-id="d6242-361">stop()</span><span class="sxs-lookup"><span data-stu-id="d6242-361">stop()</span></span> | |<span data-ttu-id="d6242-362">Detiene la evaluación de la expresión de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="d6242-362">Stops evaluation of the autoscaling expression.</span></span> |
| <span data-ttu-id="d6242-363">sum(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="d6242-363">sum(doubleVecList)</span></span> |<span data-ttu-id="d6242-364">double</span><span class="sxs-lookup"><span data-stu-id="d6242-364">double</span></span> |<span data-ttu-id="d6242-365">Devuelve la suma de todos los componentes de doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="d6242-365">Returns the sum of all the components of the doubleVecList.</span></span> |
| <span data-ttu-id="d6242-366">time(string dateTime="")</span><span class="sxs-lookup"><span data-stu-id="d6242-366">time(string dateTime="")</span></span> |<span data-ttu-id="d6242-367">timestamp</span><span class="sxs-lookup"><span data-stu-id="d6242-367">timestamp</span></span> |<span data-ttu-id="d6242-368">Devuelve la marca de tiempo de la hora actual si no se pasan los parámetros o la marca de hora de la cadena dateTime si se pasó.</span><span class="sxs-lookup"><span data-stu-id="d6242-368">Returns the time stamp of the current time if no parameters are passed, or the time stamp of the dateTime string if it is passed.</span></span> <span data-ttu-id="d6242-369">Los formatos de dateTime compatibles son W3C-DTF y RFC 1123.</span><span class="sxs-lookup"><span data-stu-id="d6242-369">Supported dateTime formats are W3C-DTF and RFC 1123.</span></span> |
| <span data-ttu-id="d6242-370">val(doubleVec v, double i)</span><span class="sxs-lookup"><span data-stu-id="d6242-370">val(doubleVec v, double i)</span></span> |<span data-ttu-id="d6242-371">double</span><span class="sxs-lookup"><span data-stu-id="d6242-371">double</span></span> |<span data-ttu-id="d6242-372">Devuelve el valor del elemento que está en la ubicación i en el vector v con el índice inicial de cero.</span><span class="sxs-lookup"><span data-stu-id="d6242-372">Returns the value of the element that is at location i in vector v, with a starting index of zero.</span></span> |

<span data-ttu-id="d6242-373">Algunas de las funciones descritas en la tabla anterior pueden aceptar una lista como argumento.</span><span class="sxs-lookup"><span data-stu-id="d6242-373">Some of the functions that are described in the previous table can accept a list as an argument.</span></span> <span data-ttu-id="d6242-374">La lista separada por comas es cualquier combinación de *double* y *doubleVec*.</span><span class="sxs-lookup"><span data-stu-id="d6242-374">The comma-separated list is any combination of *double* and *doubleVec*.</span></span> <span data-ttu-id="d6242-375">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="d6242-375">For example:</span></span>

`doubleVecList := ( (double | doubleVec)+(, (double | doubleVec) )* )?`

<span data-ttu-id="d6242-376">El valor *doubleVecList* se convierte en un *doubleVec* individual antes de la evaluación.</span><span class="sxs-lookup"><span data-stu-id="d6242-376">The *doubleVecList* value is converted to a single *doubleVec* before evaluation.</span></span> <span data-ttu-id="d6242-377">Por ejemplo, si `v = [1,2,3]`, entonces, llamar a `avg(v)` es equivalente a llamar a `avg(1,2,3)`.</span><span class="sxs-lookup"><span data-stu-id="d6242-377">For example, if `v = [1,2,3]`, then calling `avg(v)` is equivalent to calling `avg(1,2,3)`.</span></span> <span data-ttu-id="d6242-378">Llamar a `avg(v, 7)` es equivalente a llamar a `avg(1,2,3,7)`.</span><span class="sxs-lookup"><span data-stu-id="d6242-378">Calling `avg(v, 7)` is equivalent to calling `avg(1,2,3,7)`.</span></span>

## <span data-ttu-id="d6242-379"><a name="getsampledata"></a>Obtención de datos de ejemplo</span><span class="sxs-lookup"><span data-stu-id="d6242-379"><a name="getsampledata"></a>Obtain sample data</span></span>
<span data-ttu-id="d6242-380">Las fórmulas de escalado automático actúan en datos de métricas (muestras) proporcionados por el servicio Lote.</span><span class="sxs-lookup"><span data-stu-id="d6242-380">Autoscale formulas act on metrics data (samples) that is provided by the Batch service.</span></span> <span data-ttu-id="d6242-381">Una fórmula aumenta o reduce el tamaño del grupo según los valores que obtiene del servicio.</span><span class="sxs-lookup"><span data-stu-id="d6242-381">A formula grows or shrinks pool size based on the values that it obtains from the service.</span></span> <span data-ttu-id="d6242-382">Las variables definidas por el servicio descritas anteriormente son objetos que proporcionan varios métodos para obtener acceso a los datos que están asociados a ese objeto.</span><span class="sxs-lookup"><span data-stu-id="d6242-382">The service-defined variables that were described previously are objects that provide various methods to access data that is associated with that object.</span></span> <span data-ttu-id="d6242-383">Por ejemplo, la siguiente expresión muestra una solicitud para obtener los últimos cinco minutos de uso de CPU:</span><span class="sxs-lookup"><span data-stu-id="d6242-383">For example, the following expression shows a request to get the last five minutes of CPU usage:</span></span>

```
$CPUPercent.GetSample(TimeInterval_Minute * 5)
```

| <span data-ttu-id="d6242-384">Método</span><span class="sxs-lookup"><span data-stu-id="d6242-384">Method</span></span> | <span data-ttu-id="d6242-385">Description</span><span class="sxs-lookup"><span data-stu-id="d6242-385">Description</span></span> |
| --- | --- |
| <span data-ttu-id="d6242-386">GetSample()</span><span class="sxs-lookup"><span data-stu-id="d6242-386">GetSample()</span></span> |<span data-ttu-id="d6242-387">El método `GetSample()` devuelve un vector de muestras de datos.</span><span class="sxs-lookup"><span data-stu-id="d6242-387">The `GetSample()` method returns a vector of data samples.</span></span><br/><br/><span data-ttu-id="d6242-388">Un ejemplo tiene un valor de 30 segundos de datos de métrica.</span><span class="sxs-lookup"><span data-stu-id="d6242-388">A sample is 30 seconds worth of metrics data.</span></span> <span data-ttu-id="d6242-389">En otras palabras, las muestras se obtienen cada 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="d6242-389">In other words, samples are obtained every 30 seconds.</span></span> <span data-ttu-id="d6242-390">No obstante, tal como se mencionó anteriormente, hay un retraso entre cuándo se recopila una muestra y cuándo está disponible para una fórmula.</span><span class="sxs-lookup"><span data-stu-id="d6242-390">But as noted below, there is a delay between when a sample is collected and when it is available to a formula.</span></span> <span data-ttu-id="d6242-391">Por lo tanto, puede que no todos los ejemplos durante un período de tiempo determinado estén disponibles para la evaluación a través de una fórmula.</span><span class="sxs-lookup"><span data-stu-id="d6242-391">As such, not all samples for a given time period may be available for evaluation by a formula.</span></span><ul><li>`doubleVec GetSample(double count)`<br/><span data-ttu-id="d6242-392">Especifica el número de muestras que se obtienen a partir de las muestras recogidas más recientes.</span><span class="sxs-lookup"><span data-stu-id="d6242-392">Specifies the number of samples to obtain from the most recent samples that were collected.</span></span><br/><br/><span data-ttu-id="d6242-393">`GetSample(1)` devuelve la última muestra disponible.</span><span class="sxs-lookup"><span data-stu-id="d6242-393">`GetSample(1)` returns the last available sample.</span></span> <span data-ttu-id="d6242-394">Para métricas como `$CPUPercent`, sin embargo, esto no debe usarse porque es imposible saber *cuándo* se recopiló la muestra.</span><span class="sxs-lookup"><span data-stu-id="d6242-394">For metrics like `$CPUPercent`, however, this should not be used because it is impossible to know *when* the sample was collected.</span></span> <span data-ttu-id="d6242-395">Puede ser reciente o, debido a problemas del sistema, puede ser mucho más antiguo.</span><span class="sxs-lookup"><span data-stu-id="d6242-395">It might be recent, or, because of system issues, it might be much older.</span></span> <span data-ttu-id="d6242-396">En estos casos es mejor usar un intervalo de tiempo como se muestra a continuación.</span><span class="sxs-lookup"><span data-stu-id="d6242-396">It is better in such cases to use a time interval as shown below.</span></span><li>`doubleVec GetSample((timestamp or timeinterval) startTime [, double samplePercent])`<br/><span data-ttu-id="d6242-397">Especifica un período de tiempo para recopilar datos de muestra.</span><span class="sxs-lookup"><span data-stu-id="d6242-397">Specifies a time frame for gathering sample data.</span></span> <span data-ttu-id="d6242-398">Opcionalmente, también especifica el porcentaje de muestras que deben estar disponibles en el marco de tiempo solicitado.</span><span class="sxs-lookup"><span data-stu-id="d6242-398">Optionally, it also specifies the percentage of samples that must be available in the requested time frame.</span></span><br/><br/><span data-ttu-id="d6242-399">`$CPUPercent.GetSample(TimeInterval_Minute * 10)` debería devolver 20 muestras si todas las muestras de los últimos 10 minutos están presentes en el historial de CPUPercent.</span><span class="sxs-lookup"><span data-stu-id="d6242-399">`$CPUPercent.GetSample(TimeInterval_Minute * 10)` would return 20 samples if all samples for the last 10 minutes are present in the CPUPercent history.</span></span> <span data-ttu-id="d6242-400">Si el último minuto del historial no estaba disponible, solo se devolverán, no obstante, 18 muestras.</span><span class="sxs-lookup"><span data-stu-id="d6242-400">If the last minute of history was not available, however, only 18 samples would be returned.</span></span> <span data-ttu-id="d6242-401">En este caso:</span><span class="sxs-lookup"><span data-stu-id="d6242-401">In this case:</span></span><br/><br/><span data-ttu-id="d6242-402">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 95)` daría error porque solo el 90 por ciento de las muestras están disponibles.</span><span class="sxs-lookup"><span data-stu-id="d6242-402">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 95)` would fail because only 90 percent of the samples are available.</span></span><br/><br/><span data-ttu-id="d6242-403">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 80)` se realizaría correctamente.</span><span class="sxs-lookup"><span data-stu-id="d6242-403">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 80)` would succeed.</span></span><li>`doubleVec GetSample((timestamp or timeinterval) startTime, (timestamp or timeinterval) endTime [, double samplePercent])`<br/><span data-ttu-id="d6242-404">Especifica un período de tiempo para recopilar datos, con una hora de inicio y una hora de finalización.</span><span class="sxs-lookup"><span data-stu-id="d6242-404">Specifies a time frame for gathering data, with both a start time and an end time.</span></span><br/><br/><span data-ttu-id="d6242-405">Como se mencionó anteriormente, hay un retraso entre cuando se recopila un ejemplo y cuando está disponible para una fórmula.</span><span class="sxs-lookup"><span data-stu-id="d6242-405">As mentioned above, there is a delay between when a sample is collected and when it is available to a formula.</span></span> <span data-ttu-id="d6242-406">Tenga en cuenta este retraso a la hora de usar el método `GetSample`.</span><span class="sxs-lookup"><span data-stu-id="d6242-406">Consider this delay when you use the `GetSample` method.</span></span> <span data-ttu-id="d6242-407">Consulte `GetSamplePercent` a continuación.</span><span class="sxs-lookup"><span data-stu-id="d6242-407">See `GetSamplePercent` below.</span></span> |
| <span data-ttu-id="d6242-408">GetSamplePeriod()</span><span class="sxs-lookup"><span data-stu-id="d6242-408">GetSamplePeriod()</span></span> |<span data-ttu-id="d6242-409">Devuelve el período de las muestras tomadas en un conjunto de datos de muestras históricos.</span><span class="sxs-lookup"><span data-stu-id="d6242-409">Returns the period of samples that were taken in a historical sample data set.</span></span> |
| <span data-ttu-id="d6242-410">Count()</span><span class="sxs-lookup"><span data-stu-id="d6242-410">Count()</span></span> |<span data-ttu-id="d6242-411">Devuelve el número total de ejemplos en el historial de métrica.</span><span class="sxs-lookup"><span data-stu-id="d6242-411">Returns the total number of samples in the metric history.</span></span> |
| <span data-ttu-id="d6242-412">HistoryBeginTime()</span><span class="sxs-lookup"><span data-stu-id="d6242-412">HistoryBeginTime()</span></span> |<span data-ttu-id="d6242-413">Devuelve la marca de tiempo de la muestra de datos disponible más antigua para la métrica.</span><span class="sxs-lookup"><span data-stu-id="d6242-413">Returns the time stamp of the oldest available data sample for the metric.</span></span> |
| <span data-ttu-id="d6242-414">GetSamplePercent()</span><span class="sxs-lookup"><span data-stu-id="d6242-414">GetSamplePercent()</span></span> |<span data-ttu-id="d6242-415">Devuelve el porcentaje de muestras que están disponibles para un intervalo de tiempo dado.</span><span class="sxs-lookup"><span data-stu-id="d6242-415">Returns the percentage of samples that are available for a given time interval.</span></span> <span data-ttu-id="d6242-416">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="d6242-416">For example:</span></span><br/><br/>`doubleVec GetSamplePercent( (timestamp or timeinterval) startTime [, (timestamp or timeinterval) endTime] )`<br/><br/><span data-ttu-id="d6242-417">Debido a que se produce un error en el método `GetSample` si el porcentaje de muestras devueltas es inferior al valor de `samplePercent` especificado, puede utilizar el método `GetSamplePercent` para comprobarlo primero.</span><span class="sxs-lookup"><span data-stu-id="d6242-417">Because the `GetSample` method fails if the percentage of samples returned is less than the `samplePercent` specified, you can use the `GetSamplePercent` method to check first.</span></span> <span data-ttu-id="d6242-418">A continuación, puede realizar una acción alternativa si no hay suficientes muestras presentes, sin detener la evaluación de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="d6242-418">Then you can perform an alternate action if insufficient samples are present, without halting the automatic scaling evaluation.</span></span> |

### <a name="samples-sample-percentage-and-the-getsample-method"></a><span data-ttu-id="d6242-419">Ejemplos, porcentaje de ejemplo y el método *GetSample()*</span><span class="sxs-lookup"><span data-stu-id="d6242-419">Samples, sample percentage, and the *GetSample()* method</span></span>
<span data-ttu-id="d6242-420">La operación principal de una fórmula de escalado automático es la obtención de datos de métricas de tareas y recursos y el ajuste posterior del tamaño de grupo según esos datos.</span><span class="sxs-lookup"><span data-stu-id="d6242-420">The core operation of an autoscale formula is to obtain task and resource metric data and then adjust pool size based on that data.</span></span> <span data-ttu-id="d6242-421">Por lo tanto, es importante tener una idea clara de cómo interactúan las fórmulas de escalado automático con los datos de métricas (muestras).</span><span class="sxs-lookup"><span data-stu-id="d6242-421">As such, it is important to have a clear understanding of how autoscale formulas interact with metrics data (samples).</span></span>

<span data-ttu-id="d6242-422">**Ejemplos**</span><span class="sxs-lookup"><span data-stu-id="d6242-422">**Samples**</span></span>

<span data-ttu-id="d6242-423">El servicio de Batch toma periódicamente ejemplos de métricas de tareas y recursos y los pone a disposición de las fórmulas de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="d6242-423">The Batch service periodically takes samples of task and resource metrics and makes them available to your autoscale formulas.</span></span> <span data-ttu-id="d6242-424">El servicio Lote graba estas muestras cada 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="d6242-424">These samples are recorded every 30 seconds by the Batch service.</span></span> <span data-ttu-id="d6242-425">Pero suele producirse un retraso entre el momento en el que se grabaron esas muestras y el momento en el que se ponen a disposición de las fórmulas de escalado automático y estas pueden leer aquellas.</span><span class="sxs-lookup"><span data-stu-id="d6242-425">However, there is typically a delay between when those samples were recorded and when they are made available to (and can be read by) your autoscale formulas.</span></span> <span data-ttu-id="d6242-426">Además, debido a diversos factores como problemas con la red o de infraestructura, es posible que las muestras no se hayan grabado para un intervalo en concreto.</span><span class="sxs-lookup"><span data-stu-id="d6242-426">Additionally, due to various factors such as network or other infrastructure issues, samples may not be recorded for a particular interval.</span></span>

<span data-ttu-id="d6242-427">**Porcentaje de muestras**</span><span class="sxs-lookup"><span data-stu-id="d6242-427">**Sample percentage**</span></span>

<span data-ttu-id="d6242-428">Al pasar `samplePercent` al método `GetSample()` o al llamar al método `GetSamplePercent()`, _porcentaje_ hace referencia a una comparación entre el número posible total de ejemplos que graba el servicio de Batch y el número de muestras que están disponibles para la fórmula de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="d6242-428">When `samplePercent` is passed to the `GetSample()` method or the `GetSamplePercent()` method is called, _percent_ refers to a comparison between the total possible number of samples that are recorded by the Batch service and the number of samples that are available to your autoscale formula.</span></span>

<span data-ttu-id="d6242-429">Echemos un vistazo a un intervalo de tiempo de 10 minutos como ejemplo.</span><span class="sxs-lookup"><span data-stu-id="d6242-429">Let's look at a 10-minute timespan as an example.</span></span> <span data-ttu-id="d6242-430">Dado que las muestras se graban cada 30 segundos, el número total máximo de muestras que Batch graba en un intervalo de tiempo de 10 minutos habría sido de 20 muestras (2 por minuto).</span><span class="sxs-lookup"><span data-stu-id="d6242-430">Because samples are recorded every 30 seconds within a 10-minute timespan, the maximum total number of samples that are recorded by Batch would be 20 samples (2 per minute).</span></span> <span data-ttu-id="d6242-431">Pero, debido a la latencia inherente del mecanismo de informes y a otros problemas existentes en Azure, podría haber solo 15 muestras disponibles para leer la fórmula de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="d6242-431">However, due to the inherent latency of the reporting mechanism and other issues within Azure, there may be only 15 samples that are available to your autoscale formula for reading.</span></span> <span data-ttu-id="d6242-432">Así, por ejemplo, durante ese período de 10 minutos, solo el 75 % del número total de ejemplos que se graban podría estar disponible para la fórmula.</span><span class="sxs-lookup"><span data-stu-id="d6242-432">So, for example, for that 10-minute period, only 75% of the total number of samples recorded may be available to your formula.</span></span>

<span data-ttu-id="d6242-433">**GetSample() e intervalos de muestra**</span><span class="sxs-lookup"><span data-stu-id="d6242-433">**GetSample() and sample ranges**</span></span>

<span data-ttu-id="d6242-434">Las fórmulas de escalado automático van a aumentar y reducir los grupos (al agregar o quitar nodos).</span><span class="sxs-lookup"><span data-stu-id="d6242-434">Your autoscale formulas are going to be growing and shrinking your pools &mdash; adding nodes or removing nodes.</span></span> <span data-ttu-id="d6242-435">Dado que los nodos cuestan dinero, desea asegurarse de que las fórmulas utilizan un método de análisis inteligente que se basa en un número de datos suficiente.</span><span class="sxs-lookup"><span data-stu-id="d6242-435">Because nodes cost you money, you want to ensure that your formulas use an intelligent method of analysis that is based on sufficient data.</span></span> <span data-ttu-id="d6242-436">Por lo tanto, recomendamos que use un análisis de tipo tendencias en las fórmulas.</span><span class="sxs-lookup"><span data-stu-id="d6242-436">Therefore, we recommend that you use a trending-type analysis in your formulas.</span></span> <span data-ttu-id="d6242-437">Este tipo aumenta y reduce los grupos basándose en un intervalo de ejemplos recopilados.</span><span class="sxs-lookup"><span data-stu-id="d6242-437">This type grows and shrinks your pools based on a range of collected samples.</span></span>

<span data-ttu-id="d6242-438">Para ello, use `GetSample(interval look-back start, interval look-back end)` para devolver un vector de ejemplos:</span><span class="sxs-lookup"><span data-stu-id="d6242-438">To do so, use `GetSample(interval look-back start, interval look-back end)` to return a vector of samples:</span></span>

```
$runningTasksSample = $RunningTasks.GetSample(1 * TimeInterval_Minute, 6 * TimeInterval_Minute);
```

<span data-ttu-id="d6242-439">Cuando Batch evalúe la línea anterior, devolverá un intervalo de muestras como vector de valores.</span><span class="sxs-lookup"><span data-stu-id="d6242-439">When the above line is evaluated by Batch, it returns a range of samples as a vector of values.</span></span> <span data-ttu-id="d6242-440">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="d6242-440">For example:</span></span>

```
$runningTasksSample=[1,1,1,1,1,1,1,1,1,1];
```

<span data-ttu-id="d6242-441">Una vez recopilado el vector de ejemplos, puede usar funciones como `min()`, `max()` y `avg()` para derivar valores significativos del intervalo recopilado.</span><span class="sxs-lookup"><span data-stu-id="d6242-441">Once you've collected the vector of samples, you can then use functions like `min()`, `max()`, and `avg()` to derive meaningful values from the collected range.</span></span>

<span data-ttu-id="d6242-442">Para mayor seguridad, puede forzar el error en una evaluación de fórmula si menos de un determinado porcentaje de ejemplos está disponible para un período de tiempo determinado.</span><span class="sxs-lookup"><span data-stu-id="d6242-442">For additional security, you can force a formula evaluation to fail if less than a certain sample percentage is available for a particular time period.</span></span> <span data-ttu-id="d6242-443">Al forzar el error en una evaluación de fórmula, indica a Batch que deje de evaluar la fórmula si el porcentaje de muestras especificado no está disponible.</span><span class="sxs-lookup"><span data-stu-id="d6242-443">When you force a formula evaluation to fail, you instruct Batch to cease further evaluation of the formula if the specified percentage of samples is not available.</span></span> <span data-ttu-id="d6242-444">En este caso, no se efectúa ningún cambio en el tamaño del grupo.</span><span class="sxs-lookup"><span data-stu-id="d6242-444">In this case, no change is made to the pool size.</span></span> <span data-ttu-id="d6242-445">Para especificar un porcentaje necesario de ejemplos para que la evaluación se realice correctamente, especifíquelo como el tercer parámetro de `GetSample()`.</span><span class="sxs-lookup"><span data-stu-id="d6242-445">To specify a required percentage of samples for the evaluation to succeed, specify it as the third parameter to `GetSample()`.</span></span> <span data-ttu-id="d6242-446">En este caso, se especifica un requisito del 75 por ciento de muestras:</span><span class="sxs-lookup"><span data-stu-id="d6242-446">Here, a requirement of 75 percent of samples is specified:</span></span>

```
$runningTasksSample = $RunningTasks.GetSample(60 * TimeInterval_Second, 120 * TimeInterval_Second, 75);
```

<span data-ttu-id="d6242-447">Dado que puede haber un retraso en la disponibilidad de muestras, es importante especificar siempre un intervalo de tiempo con una hora de inicio retrospectiva cuya anterioridad sea superior a un minuto.</span><span class="sxs-lookup"><span data-stu-id="d6242-447">Because there may be a delay in sample availability, it is important to always specify a time range with a look-back start time that is older than one minute.</span></span> <span data-ttu-id="d6242-448">Las muestras tardan aproximadamente un minuto en propagarse por el sistema, por lo que puede que las muestras del rango `(0 * TimeInterval_Second, 60 * TimeInterval_Second)` no estén disponibles.</span><span class="sxs-lookup"><span data-stu-id="d6242-448">It takes approximately one minute for samples to propagate through the system, so samples in the range `(0 * TimeInterval_Second, 60 * TimeInterval_Second)` may not be available.</span></span> <span data-ttu-id="d6242-449">De nuevo, puede utilizar el parámetro de porcentaje de `GetSample()` para forzar un requisito de porcentaje de ejemplos concreto.</span><span class="sxs-lookup"><span data-stu-id="d6242-449">Again, you can use the percentage parameter of `GetSample()` to force a particular sample percentage requirement.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d6242-450">Es **muy recomendable** que **evite confiar *solo* en**  en las fórmulas de escalado automático`GetSample(1)`.</span><span class="sxs-lookup"><span data-stu-id="d6242-450">We **strongly recommend** that you **avoid relying *only* on `GetSample(1)` in your autoscale formulas**.</span></span> <span data-ttu-id="d6242-451">Esto se debe a que `GetSample(1)` dice básicamente al servicio Batch "dame la muestra más reciente que tengas, independientemente de cuánto tiempo hace que la tienes".</span><span class="sxs-lookup"><span data-stu-id="d6242-451">This is because `GetSample(1)` essentially says to the Batch service, "Give me the last sample you have, no matter how long ago you retrieved it."</span></span> <span data-ttu-id="d6242-452">Puesto que es solo una muestra única, y puede ser una muestra más antigua, no puede ser representativa de la imagen más grande del estado reciente de la tarea o el recurso.</span><span class="sxs-lookup"><span data-stu-id="d6242-452">Since it is only a single sample, and it may be an older sample, it may not be representative of the larger picture of recent task or resource state.</span></span> <span data-ttu-id="d6242-453">Si usa `GetSample(1)`, asegúrese de que forma parte de una instrucción más grande y no solo el punto de datos en el que se basa la fórmula.</span><span class="sxs-lookup"><span data-stu-id="d6242-453">If you do use `GetSample(1)`, make sure that it's part of a larger statement and not the only data point that your formula relies on.</span></span>
>
>

## <a name="metrics"></a><span data-ttu-id="d6242-454">Métricas</span><span class="sxs-lookup"><span data-stu-id="d6242-454">Metrics</span></span>
<span data-ttu-id="d6242-455">Puede usar tanto métricas de recurso como de tarea al definir una fórmula.</span><span class="sxs-lookup"><span data-stu-id="d6242-455">You can use both resource and task metrics when you're defining a formula.</span></span> <span data-ttu-id="d6242-456">El número de nodos dedicados de destino se ajusta en el grupo basándose en los datos de métricas que obtenga y evalúe.</span><span class="sxs-lookup"><span data-stu-id="d6242-456">You adjust the target number of dedicated nodes in the pool based on the metrics data that you obtain and evaluate.</span></span> <span data-ttu-id="d6242-457">Consulte la sección [Variables](#variables) más arriba para más información sobre cada métrica.</span><span class="sxs-lookup"><span data-stu-id="d6242-457">See the [Variables](#variables) section above for more information on each metric.</span></span>

<table>
  <tr>
    <th><span data-ttu-id="d6242-458">Métrica</span><span class="sxs-lookup"><span data-stu-id="d6242-458">Metric</span></span></th>
    <th><span data-ttu-id="d6242-459">Descripción</span><span class="sxs-lookup"><span data-stu-id="d6242-459">Description</span></span></th>
  </tr>
  <tr>
    <td><span data-ttu-id="d6242-460"><b>Recurso</b></span><span class="sxs-lookup"><span data-stu-id="d6242-460"><b>Resource</b></span></span></td>
    <td><p><span data-ttu-id="d6242-461">Las métricas de recurso se basan en la CPU, el ancho de banda y el uso de la memoria de los nodos de ejecución, así como en el número de nodos.</span><span class="sxs-lookup"><span data-stu-id="d6242-461">Resource metrics are based on the CPU, the bandwidth, the memory usage of compute nodes, and the number of nodes.</span></span></p>
        <p> <span data-ttu-id="d6242-462">Estas variables definidas por el servicio se usan para realizar ajustes basados en el número de nodos:</span><span class="sxs-lookup"><span data-stu-id="d6242-462">These service-defined variables are useful for making adjustments based on node count:</span></span></p>
    <p><ul>
            <li><span data-ttu-id="d6242-463">$TargetDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="d6242-463">$TargetDedicatedNodes</span></span></li>
            <li><span data-ttu-id="d6242-464">$TargetLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="d6242-464">$TargetLowPriorityNodes</span></span></li>
            <li><span data-ttu-id="d6242-465">$CurrentDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="d6242-465">$CurrentDedicatedNodes</span></span></li>
            <li><span data-ttu-id="d6242-466">$CurrentLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="d6242-466">$CurrentLowPriorityNodes</span></span></li>
            <li><span data-ttu-id="d6242-467">$preemptedNodeCount</span><span class="sxs-lookup"><span data-stu-id="d6242-467">$preemptedNodeCount</span></span></li>
            <li><span data-ttu-id="d6242-468">$SampleNodeCount</span><span class="sxs-lookup"><span data-stu-id="d6242-468">$SampleNodeCount</span></span></li>
    </ul></p>
    <p><span data-ttu-id="d6242-469">Estas variables definidas por el servicio se usan para realizar ajustes basados en el uso de recursos de nodo:</span><span class="sxs-lookup"><span data-stu-id="d6242-469">These service-defined variables are useful for making adjustments based on node resource usage:</span></span></p>
    <p><ul>
      <li><span data-ttu-id="d6242-470">$CPUPercent</span><span class="sxs-lookup"><span data-stu-id="d6242-470">$CPUPercent</span></span></li>
      <li><span data-ttu-id="d6242-471">$WallClockSeconds</span><span class="sxs-lookup"><span data-stu-id="d6242-471">$WallClockSeconds</span></span></li>
      <li><span data-ttu-id="d6242-472">$MemoryBytes</span><span class="sxs-lookup"><span data-stu-id="d6242-472">$MemoryBytes</span></span></li>
      <li><span data-ttu-id="d6242-473">$DiskBytes</span><span class="sxs-lookup"><span data-stu-id="d6242-473">$DiskBytes</span></span></li>
      <li><span data-ttu-id="d6242-474">$DiskReadBytes</span><span class="sxs-lookup"><span data-stu-id="d6242-474">$DiskReadBytes</span></span></li>
      <li><span data-ttu-id="d6242-475">$DiskWriteBytes</span><span class="sxs-lookup"><span data-stu-id="d6242-475">$DiskWriteBytes</span></span></li>
      <li><span data-ttu-id="d6242-476">$DiskReadOps</span><span class="sxs-lookup"><span data-stu-id="d6242-476">$DiskReadOps</span></span></li>
      <li><span data-ttu-id="d6242-477">$DiskWriteOps</span><span class="sxs-lookup"><span data-stu-id="d6242-477">$DiskWriteOps</span></span></li>
      <li><span data-ttu-id="d6242-478">$NetworkInBytes</span><span class="sxs-lookup"><span data-stu-id="d6242-478">$NetworkInBytes</span></span></li>
      <li><span data-ttu-id="d6242-479">$NetworkOutBytes</span><span class="sxs-lookup"><span data-stu-id="d6242-479">$NetworkOutBytes</span></span></li></ul></p>
  </tr>
  <tr>
    <td><span data-ttu-id="d6242-480"><b>Task</b></span><span class="sxs-lookup"><span data-stu-id="d6242-480"><b>Task</b></span></span></td>
    <td><p><span data-ttu-id="d6242-481">Las métricas de tarea se basan en el estado de las tareas, como Activo, Pendiente y Completado.</span><span class="sxs-lookup"><span data-stu-id="d6242-481">Task metrics are based on the status of tasks, such as Active, Pending, and Completed.</span></span> <span data-ttu-id="d6242-482">Las siguientes variables definidas por el servicio se usan para realizar ajustes de tamaño de grupo basados en las métricas de tarea:</span><span class="sxs-lookup"><span data-stu-id="d6242-482">The following service-defined variables are useful for making pool-size adjustments based on task metrics:</span></span></p>
    <p><ul>
      <li><span data-ttu-id="d6242-483">$ActiveTasks</span><span class="sxs-lookup"><span data-stu-id="d6242-483">$ActiveTasks</span></span></li>
      <li><span data-ttu-id="d6242-484">$RunningTasks</span><span class="sxs-lookup"><span data-stu-id="d6242-484">$RunningTasks</span></span></li>
      <li><span data-ttu-id="d6242-485">$PendingTasks</span><span class="sxs-lookup"><span data-stu-id="d6242-485">$PendingTasks</span></span></li>
      <li><span data-ttu-id="d6242-486">$SucceededTasks</span><span class="sxs-lookup"><span data-stu-id="d6242-486">$SucceededTasks</span></span></li>
            <li><span data-ttu-id="d6242-487">$FailedTasks</span><span class="sxs-lookup"><span data-stu-id="d6242-487">$FailedTasks</span></span></li></ul></p>
        </td>
  </tr>
</table>

## <a name="write-an-autoscale-formula"></a><span data-ttu-id="d6242-488">Escritura de una fórmula de escalado automático</span><span class="sxs-lookup"><span data-stu-id="d6242-488">Write an autoscale formula</span></span>
<span data-ttu-id="d6242-489">Para construir una fórmula de escalado automático, es preciso formar instrucciones que usen los componentes anteriores y luego combinar esas instrucciones en una fórmula completa.</span><span class="sxs-lookup"><span data-stu-id="d6242-489">You build an autoscale formula by forming statements that use the above components, then combine those statements into a complete formula.</span></span> <span data-ttu-id="d6242-490">En esta sección vamos a crear una fórmula de escalado automático de ejemplo que puede tomar algunas decisiones reales de escalado.</span><span class="sxs-lookup"><span data-stu-id="d6242-490">In this section, we create an example autoscale formula that can perform some real-world scaling decisions.</span></span>

<span data-ttu-id="d6242-491">En primer lugar, vamos a definir los requisitos de nuestra nueva fórmula de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="d6242-491">First, let's define the requirements for our new autoscale formula.</span></span> <span data-ttu-id="d6242-492">La fórmula debe:</span><span class="sxs-lookup"><span data-stu-id="d6242-492">The formula should:</span></span>

1. <span data-ttu-id="d6242-493">Aumentar el número objetivo de nodos de ejecución dedicados en un grupo si el uso de la CPU es alto.</span><span class="sxs-lookup"><span data-stu-id="d6242-493">Increase the target number of dedicated compute nodes in a pool if CPU usage is high.</span></span>
2. <span data-ttu-id="d6242-494">Reducir el número objetivo de nodos de ejecución dedicados en un grupo si el uso de la CPU es bajo.</span><span class="sxs-lookup"><span data-stu-id="d6242-494">Decrease the target number of dedicated compute nodes in a pool when CPU usage is low.</span></span>
3. <span data-ttu-id="d6242-495">Restringir siempre el número máximo de nodos dedicados a 400.</span><span class="sxs-lookup"><span data-stu-id="d6242-495">Always restrict the maximum number of dedicated nodes to 400.</span></span>

<span data-ttu-id="d6242-496">Para aumentar el número de nodos durante un uso elevado de la CPU, definimos la instrucción que rellena una variable definida por el usuario (`$totalDedicatedNodes`) con un valor que representa un 110 por ciento del número de nodos dedicados del destino actual, pero solo si el uso medio mínimo de la CPU en los 10 últimos minutos era superior al 70 por ciento.</span><span class="sxs-lookup"><span data-stu-id="d6242-496">To increase the number of nodes during high CPU usage, define the statement that populates a user-defined variable (`$totalDedicatedNodes`) with a value that is 110 percent of the current target number of dedicated nodes, but only if the minimum average CPU usage during the last 10 minutes was above 70 percent.</span></span> <span data-ttu-id="d6242-497">En caso contrario, use el valor del número actual de nodos dedicados.</span><span class="sxs-lookup"><span data-stu-id="d6242-497">Otherwise, use the value for the current number of dedicated nodes.</span></span>

```
$totalDedicatedNodes =
    (min($CPUPercent.GetSample(TimeInterval_Minute * 10)) > 0.7) ?
    ($CurrentDedicatedNodes * 1.1) : $CurrentDedicatedNodes;
```

<span data-ttu-id="d6242-498">Para *reducir* el número de nodos dedicados durante un uso bajo de la CPU, la siguiente instrucción de nuestra fórmula establece la misma variable `$totalDedicatedNodes` en el 90 por ciento del número objetivo actual de nodos dedicados si el uso medio de la CPU en los últimos 60 minutos estaba por debajo del 20 por ciento.</span><span class="sxs-lookup"><span data-stu-id="d6242-498">To *decrease* the number of dedicated nodes during low CPU usage, the next statement in our formula sets the same `$totalDedicatedNodes` variable to 90 percent of the current target number of dedicated nodes if the average CPU usage in the past 60 minutes was under 20 percent.</span></span> <span data-ttu-id="d6242-499">De lo contrario, use el valor actual de `$totalDedicatedNodes` que se rellenamos en la instrucción anterior.</span><span class="sxs-lookup"><span data-stu-id="d6242-499">Otherwise, use the current value of `$totalDedicatedNodes` that we populated in the statement above.</span></span>

```
$totalDedicatedNodes =
    (avg($CPUPercent.GetSample(TimeInterval_Minute * 60)) < 0.2) ?
    ($CurrentDedicatedNodes * 0.9) : $totalDedicatedNodes;
```

<span data-ttu-id="d6242-500">Ahora limite el número objetivo de nodos de ejecución dedicados a un máximo de 400:</span><span class="sxs-lookup"><span data-stu-id="d6242-500">Now limit the target number of dedicated compute nodes to a maximum of 400:</span></span>

```
$TargetDedicatedNodes = min(400, $totalDedicatedNodes)
```

<span data-ttu-id="d6242-501">Esta es la fórmula completa:</span><span class="sxs-lookup"><span data-stu-id="d6242-501">Here's the complete formula:</span></span>

```
$totalDedicatedNodes =
    (min($CPUPercent.GetSample(TimeInterval_Minute * 10)) > 0.7) ?
    ($CurrentDedicatedNodes * 1.1) : $CurrentDedicatedNodes;
$totalDedicatedNodes =
    (avg($CPUPercent.GetSample(TimeInterval_Minute * 60)) < 0.2) ?
    ($CurrentDedicatedNodes * 0.9) : $totalDedicatedNodes;
$TargetDedicatedNodes = min(400, $totalDedicatedNodes)
```

## <a name="create-an-autoscale-enabled-pool-with-net"></a><span data-ttu-id="d6242-502">Crear un grupo habilitado para el escalado automático con .NET</span><span class="sxs-lookup"><span data-stu-id="d6242-502">Create an autoscale-enabled pool with .NET</span></span>

<span data-ttu-id="d6242-503">Para crear un grupo con el escalado automático habilitado en. NET, siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="d6242-503">To create a pool with autoscaling enabled in .NET, follow these steps:</span></span>

1. <span data-ttu-id="d6242-504">Crear el grupo con [BatchClient.PoolOperations.CreatePool](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.createpool).</span><span class="sxs-lookup"><span data-stu-id="d6242-504">Create the pool with [BatchClient.PoolOperations.CreatePool](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.createpool).</span></span>
2. <span data-ttu-id="d6242-505">Establecer la propiedad [CloudPool.AutoScaleEnabled](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleenabled) en `true`.</span><span class="sxs-lookup"><span data-stu-id="d6242-505">Set the [CloudPool.AutoScaleEnabled](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleenabled) property to `true`.</span></span>
3. <span data-ttu-id="d6242-506">Establecer la propiedad [CloudPool.AutoScaleFormula](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleformula) con la fórmula de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="d6242-506">Set the [CloudPool.AutoScaleFormula](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleformula) property with your autoscale formula.</span></span>
4. <span data-ttu-id="d6242-507">(Opcional) Establecer la propiedad [CloudPool.AutoScaleEvaluationInterval](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleevaluationinterval) (el valor predeterminado es 15 minutos).</span><span class="sxs-lookup"><span data-stu-id="d6242-507">(Optional) Set the [CloudPool.AutoScaleEvaluationInterval](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleevaluationinterval) property (default is 15 minutes).</span></span>
5. <span data-ttu-id="d6242-508">Confirmar el grupo con [CloudPool.Commit](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commit) o [CommitAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commitasync).</span><span class="sxs-lookup"><span data-stu-id="d6242-508">Commit the pool with [CloudPool.Commit](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commit) or [CommitAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commitasync).</span></span>

<span data-ttu-id="d6242-509">El fragmento de código siguiente crea un grupo habilitado para el escalado automático en .NET.</span><span class="sxs-lookup"><span data-stu-id="d6242-509">The following code snippet creates an autoscale-enabled pool in .NET.</span></span> <span data-ttu-id="d6242-510">La fórmula de escalado automático del grupo establece el número objetivo de nodos dedicados en 5 los lunes y en 1 los demás días de la semana.</span><span class="sxs-lookup"><span data-stu-id="d6242-510">The pool's autoscale formula sets the target number of dedicated nodes to 5 on Mondays, and 1 on every other day of the week.</span></span> <span data-ttu-id="d6242-511">El [intervalo de escalado automático](#automatic-scaling-interval) está establecido en 30 minutos.</span><span class="sxs-lookup"><span data-stu-id="d6242-511">The [automatic scaling interval](#automatic-scaling-interval) is set to 30 minutes.</span></span> <span data-ttu-id="d6242-512">En este y en otros fragmentos de código de C# de este artículo, `myBatchClient` es una instancia inicializada correctamente de la clase [BatchClient][net_batchclient].</span><span class="sxs-lookup"><span data-stu-id="d6242-512">In this and the other C# snippets in this article, `myBatchClient` is a properly initialized instance of the [BatchClient][net_batchclient] class.</span></span>

```csharp
CloudPool pool = myBatchClient.PoolOperations.CreatePool(
                    poolId: "mypool",
                    virtualMachineSize: "small", // single-core, 1.75 GB memory, 225 GB disk
                    cloudServiceConfiguration: new CloudServiceConfiguration(osFamily: "5"));    
pool.AutoScaleEnabled = true;
pool.AutoScaleFormula = "$TargetDedicatedNodes = (time().weekday == 1 ? 5:1);";
pool.AutoScaleEvaluationInterval = TimeSpan.FromMinutes(30);
await pool.CommitAsync();
```

> [!IMPORTANT]
> <span data-ttu-id="d6242-513">Al crear un grupo habilitado para el escalado automático, no especifique el parámetro _targetDedicatedComputeNodes_ ni el parámetro _targetLowPriorityComputeNodes_ en la llamada a **CreatePool**.</span><span class="sxs-lookup"><span data-stu-id="d6242-513">When you create an autoscale-enabled pool, do not specify the _targetDedicatedComputeNodes_ parameter or the _targetLowPriorityComputeNodes_ parameter on the call to **CreatePool**.</span></span> <span data-ttu-id="d6242-514">En su lugar, especifique las propiedades **AutoScaleEnabled** y **AutoScaleFormula** en el grupo.</span><span class="sxs-lookup"><span data-stu-id="d6242-514">Instead, specify the **AutoScaleEnabled** and **AutoScaleFormula** properties on the pool.</span></span> <span data-ttu-id="d6242-515">Los valores de estas propiedades determinan el número de destino de cada tipo de nodo.</span><span class="sxs-lookup"><span data-stu-id="d6242-515">The values for these properties determine the target number of each type of node.</span></span> <span data-ttu-id="d6242-516">Además, para cambiar manualmente el tamaño de un grupo habilitado para el escalado automático (por ejemplo, con [BatchClient.PoolOperations.ResizePoolAsync][net_poolops_resizepoolasync]), primero debe **deshabilitar** el escalado automático en el grupo y, después, cambiar su tamaño.</span><span class="sxs-lookup"><span data-stu-id="d6242-516">Also, to manually resize an autoscale-enabled pool (for example, with [BatchClient.PoolOperations.ResizePoolAsync][net_poolops_resizepoolasync]), first **disable** automatic scaling on the pool, then resize it.</span></span>
>
>

<span data-ttu-id="d6242-517">Además de Batch .NET, puede usar cualquiera de los demás [SDK de Batch](batch-apis-tools.md#azure-accounts-for-batch-development), [REST de Batch](https://docs.microsoft.com/rest/api/batchservice/), [cmdlets de PowerShell para Batch](batch-powershell-cmdlets-get-started.md) y la [CLI de Batch](batch-cli-get-started.md) para configurar el escalado automático.</span><span class="sxs-lookup"><span data-stu-id="d6242-517">In addition to Batch .NET, you can use any of the other [Batch SDKs](batch-apis-tools.md#azure-accounts-for-batch-development), [Batch REST](https://docs.microsoft.com/rest/api/batchservice/), [Batch PowerShell cmdlets](batch-powershell-cmdlets-get-started.md), and the [Batch CLI](batch-cli-get-started.md) to configure autoscaling.</span></span>


### <a name="automatic-scaling-interval"></a><span data-ttu-id="d6242-518">Intervalo de escalado automático</span><span class="sxs-lookup"><span data-stu-id="d6242-518">Automatic scaling interval</span></span>
<span data-ttu-id="d6242-519">De forma predeterminada, el servicio de Batch ajusta el tamaño de un grupo según su fórmula de escalado automático cada 15 minutos.</span><span class="sxs-lookup"><span data-stu-id="d6242-519">By default, the Batch service adjusts a pool's size according to its autoscale formula every 15 minutes.</span></span> <span data-ttu-id="d6242-520">Este intervalo se puede configurar con las siguientes propiedades de grupo:</span><span class="sxs-lookup"><span data-stu-id="d6242-520">This interval is configurable by using the following pool properties:</span></span>

* <span data-ttu-id="d6242-521">[CloudPool.AutoScaleEvaluationInterval][net_cloudpool_autoscaleevalinterval] (.NET para Batch)</span><span class="sxs-lookup"><span data-stu-id="d6242-521">[CloudPool.AutoScaleEvaluationInterval][net_cloudpool_autoscaleevalinterval] (Batch .NET)</span></span>
* <span data-ttu-id="d6242-522">[autoScaleEvaluationInterval][rest_autoscaleinterval] (API de REST)</span><span class="sxs-lookup"><span data-stu-id="d6242-522">[autoScaleEvaluationInterval][rest_autoscaleinterval] (REST API)</span></span>

<span data-ttu-id="d6242-523">Los intervalos mínimo y máximo son cinco minutos y 168 horas, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="d6242-523">The minimum interval is five minutes, and the maximum is 168 hours.</span></span> <span data-ttu-id="d6242-524">Si se especifica un intervalo que se sitúa fuera de este margen, el servicio de Batch devolverá un error de solicitud incorrecta (400).</span><span class="sxs-lookup"><span data-stu-id="d6242-524">If an interval outside this range is specified, the Batch service returns a Bad Request (400) error.</span></span>

> [!NOTE]
> <span data-ttu-id="d6242-525">Actualmente, el escalado automático no está pensado como respuesta inmediata a los cambios, sino para ajustar el tamaño del grupo gradualmente mientras ejecuta una carga de trabajo.</span><span class="sxs-lookup"><span data-stu-id="d6242-525">Autoscaling is not currently intended to respond to changes in less than a minute, but rather is intended to adjust the size of your pool gradually as you run a workload.</span></span>
>
>

## <a name="enable-autoscaling-on-an-existing-pool"></a><span data-ttu-id="d6242-526">Habilitación del escalado automático en un grupo existente</span><span class="sxs-lookup"><span data-stu-id="d6242-526">Enable autoscaling on an existing pool</span></span>

<span data-ttu-id="d6242-527">Cada SDK de Batch proporciona un método para habilitar el escalado automático.</span><span class="sxs-lookup"><span data-stu-id="d6242-527">Each Batch SDK provides a way to enable autoscaling.</span></span> <span data-ttu-id="d6242-528">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="d6242-528">For example:</span></span>

* <span data-ttu-id="d6242-529">[BatchClient.PoolOperations.EnableAutoScaleAsync][net_enableautoscaleasync] (Batch .NET)</span><span class="sxs-lookup"><span data-stu-id="d6242-529">[BatchClient.PoolOperations.EnableAutoScaleAsync][net_enableautoscaleasync] (Batch .NET)</span></span>
* <span data-ttu-id="d6242-530">[Activar la escala automática en un grupo de servidores][rest_enableautoscale] (API de REST)</span><span class="sxs-lookup"><span data-stu-id="d6242-530">[Enable automatic scaling on a pool][rest_enableautoscale] (REST API)</span></span>

<span data-ttu-id="d6242-531">Al habilitar el escalado automático en un grupo existente, tenga en cuenta las siguientes cuestiones:</span><span class="sxs-lookup"><span data-stu-id="d6242-531">When you enable autoscaling on an existing pool, keep in mind the following points:</span></span>

* <span data-ttu-id="d6242-532">Si el escalado automático está deshabilitado en el grupo a la hora de emitir la solicitud para habilitar el escalado automático, debe especificar una fórmula de escalado automático válida al emitir la solicitud.</span><span class="sxs-lookup"><span data-stu-id="d6242-532">If automatic scaling is currently disabled on the pool when you issue the request to enable autoscaling, you must specify a valid autoscale formula when you issue the request.</span></span> <span data-ttu-id="d6242-533">También puede especificar un intervalo de evaluación de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="d6242-533">You can optionally specify an autoscale evaluation interval.</span></span> <span data-ttu-id="d6242-534">Si no especifica un intervalo, se usa el valor predeterminado de 15 minutos.</span><span class="sxs-lookup"><span data-stu-id="d6242-534">If you do not specify an interval, the default value of 15 minutes is used.</span></span>
* <span data-ttu-id="d6242-535">Si el escalado automático está habilitado en el grupo, puede especificar una fórmula de escalado automático, un intervalo de evaluación o ambas cosas.</span><span class="sxs-lookup"><span data-stu-id="d6242-535">If autoscale is currently enabled on the pool, you can specify an autoscale formula, an evaluation interval, or both.</span></span> <span data-ttu-id="d6242-536">Debe especificar al menos una de estas propiedades.</span><span class="sxs-lookup"><span data-stu-id="d6242-536">You must specify at least one of these properties.</span></span>

  * <span data-ttu-id="d6242-537">Si especifica un nuevo intervalo de evaluación de escalado automático, la programación de evaluación existente se detiene y se inicia una nueva.</span><span class="sxs-lookup"><span data-stu-id="d6242-537">If you specify a new autoscale evaluation interval, then the existing evaluation schedule is stopped and a new schedule is started.</span></span> <span data-ttu-id="d6242-538">La hora de inicio de la nueva programación es la hora a la que se emitió la solicitud para habilitar el escalado automático.</span><span class="sxs-lookup"><span data-stu-id="d6242-538">The new schedule's start time is the time at which the request to enable autoscaling was issued.</span></span>
  * <span data-ttu-id="d6242-539">Si se omite la fórmula de escalado automático o el intervalo de evaluación, el servicio Batch sigue usando el valor actual de dicha configuración.</span><span class="sxs-lookup"><span data-stu-id="d6242-539">If you omit either the autoscale formula or evaluation interval, the Batch service continues to use the current value of that setting.</span></span>

> [!NOTE]
> <span data-ttu-id="d6242-540">Si especificó valores para los parámetros *targetDedicatedComputeNodes* o *targetLowPriorityComputeNodes* del método **CreatePool** al crear el grupo en .NET, o bien para los parámetros comparables en otro lenguaje, dichos valores se omitirán cuando se evalúe la fórmula de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="d6242-540">If you specified values for the *targetDedicatedComputeNodes* or *targetLowPriorityComputeNodes* parameters of the **CreatePool** method when you created the pool in .NET, or for the comparable parameters in another language, then those values are ignored when the automatic scaling formula is evaluated.</span></span>
>
>

<span data-ttu-id="d6242-541">Este fragmento de código de C# usa la biblioteca [.NET para Batch][net_api] para habilitar el escalado automático en un grupo existente:</span><span class="sxs-lookup"><span data-stu-id="d6242-541">This C# code snippet uses the [Batch .NET][net_api] library to enable autoscaling on an existing pool:</span></span>

```csharp
// Define the autoscaling formula. This formula sets the target number of nodes
// to 5 on Mondays, and 1 on every other day of the week
string myAutoScaleFormula = "$TargetDedicatedNodes = (time().weekday == 1 ? 5:1);";

// Set the autoscale formula on the existing pool
await myBatchClient.PoolOperations.EnableAutoScaleAsync(
    "myexistingpool",
    autoscaleFormula: myAutoScaleFormula);
```

### <a name="update-an-autoscale-formula"></a><span data-ttu-id="d6242-542">Actualización de una fórmula de escalado automático</span><span class="sxs-lookup"><span data-stu-id="d6242-542">Update an autoscale formula</span></span>

<span data-ttu-id="d6242-543">Para actualizar la fórmula en un grupo existente habilitado para el escalado automático, vuelva a llamar a la operación para habilitar el escalado automático con la nueva fórmula.</span><span class="sxs-lookup"><span data-stu-id="d6242-543">To update the formula on an existing autoscale-enabled pool, call the operation to enable autoscaling again with the new formula.</span></span> <span data-ttu-id="d6242-544">Por ejemplo, si el escalado automático ya está habilitado en `myexistingpool` cuando se ejecuta el siguiente código de .NET, su fórmula de escalado automático se sustituirá por el contenido de `myNewFormula`.</span><span class="sxs-lookup"><span data-stu-id="d6242-544">For example, if autoscaling is already enabled on `myexistingpool` when the following .NET code is executed, its autoscale formula is replaced with the contents of `myNewFormula`.</span></span>

```csharp
await myBatchClient.PoolOperations.EnableAutoScaleAsync(
    "myexistingpool",
    autoscaleFormula: myNewFormula);
```

### <a name="update-the-autoscale-interval"></a><span data-ttu-id="d6242-545">Actualización del intervalo de escalado automático</span><span class="sxs-lookup"><span data-stu-id="d6242-545">Update the autoscale interval</span></span>

<span data-ttu-id="d6242-546">Para actualizar el intervalo de evaluación de escalado automático en un grupo existente habilitado para el escalado automático, vuelva a llamar a la operación para habilitar el escalado automático con el nuevo intervalo.</span><span class="sxs-lookup"><span data-stu-id="d6242-546">To update the autoscale evaluation interval of an existing autoscale-enabled pool, call the operation to enable autoscaling again with the new interval.</span></span> <span data-ttu-id="d6242-547">Por ejemplo, para establecer el intervalo de evaluación de escalado automático en 60 minutos para un grupo que ya tiene habilitado el escalado automático en .NET:</span><span class="sxs-lookup"><span data-stu-id="d6242-547">For example, to set the autoscale evaluation interval to 60 minutes for a pool that's already autoscale-enabled in .NET:</span></span>

```csharp
await myBatchClient.PoolOperations.EnableAutoScaleAsync(
    "myexistingpool",
    autoscaleEvaluationInterval: TimeSpan.FromMinutes(60));
```

## <a name="evaluate-an-autoscale-formula"></a><span data-ttu-id="d6242-548">Evaluación de una fórmula de escalado automático</span><span class="sxs-lookup"><span data-stu-id="d6242-548">Evaluate an autoscale formula</span></span>

<span data-ttu-id="d6242-549">Puede evaluar una fórmula antes de aplicarla a un grupo.</span><span class="sxs-lookup"><span data-stu-id="d6242-549">You can evaluate a formula before applying it to a pool.</span></span> <span data-ttu-id="d6242-550">De esta manera puede probar la fórmula para ver cómo se evalúan sus instrucciones antes de usarla en producción.</span><span class="sxs-lookup"><span data-stu-id="d6242-550">In this way, you can test the formula to see how its statements evaluate before you put the formula into production.</span></span>

<span data-ttu-id="d6242-551">Para evaluar una fórmula de escalado automático, primero debe habilitar el escalado automático en el grupo con una fórmula válida.</span><span class="sxs-lookup"><span data-stu-id="d6242-551">To evaluate an autoscale formula, you must first enable autoscaling on the pool with a valid formula.</span></span> <span data-ttu-id="d6242-552">Para probar una fórmula en un grupo que aún no tiene habilitado el escalado automático, use la fórmula de una línea `$TargetDedicatedNodes = 0` la primera vez que habilite el escalado automático.</span><span class="sxs-lookup"><span data-stu-id="d6242-552">To test a formula on a pool that doesn't yet have autoscaling enabled, use the one-line formula `$TargetDedicatedNodes = 0` when you first enable autoscaling.</span></span> <span data-ttu-id="d6242-553">A continuación, use uno de los siguientes métodos para evaluar la fórmula que quiere probar:</span><span class="sxs-lookup"><span data-stu-id="d6242-553">Then, use one of the following to evaluate the formula you want to test:</span></span>

* <span data-ttu-id="d6242-554">[BatchClient.PoolOperations.EvaluateAutoScale](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscale) o [EvaluateAutoScaleAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscaleasync)</span><span class="sxs-lookup"><span data-stu-id="d6242-554">[BatchClient.PoolOperations.EvaluateAutoScale](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscale) or [EvaluateAutoScaleAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscaleasync)</span></span>

    <span data-ttu-id="d6242-555">Estos métodos .NET de Batch requieren el identificador de un grupo existente y una cadena que contenga la fórmula de escalado automático que se evaluará.</span><span class="sxs-lookup"><span data-stu-id="d6242-555">These Batch .NET methods require the ID of an existing pool and a string containing the autoscale formula to evaluate.</span></span>

* [<span data-ttu-id="d6242-556">Evaluación de una fórmula de escalado automático</span><span class="sxs-lookup"><span data-stu-id="d6242-556">Evaluate an automatic scaling formula</span></span>](https://docs.microsoft.com/rest/api/batchservice/evaluate-an-automatic-scaling-formula)

    <span data-ttu-id="d6242-557">En esta solicitud de API de REST, especifique el identificador del grupo en el URI y la fórmula de escalado automático en el elemento *autoScaleFormula* del cuerpo de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="d6242-557">In this REST API request, specify the pool ID in the URI, and the autoscale formula in the *autoScaleFormula* element of the request body.</span></span> <span data-ttu-id="d6242-558">La respuesta de la operación contiene cualquier información de error que pueda relacionarse con la fórmula.</span><span class="sxs-lookup"><span data-stu-id="d6242-558">The response of the operation contains any error information that might be related to the formula.</span></span>

<span data-ttu-id="d6242-559">En este fragmento de código de [Batch .NET][net_api] se evalúa una fórmula de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="d6242-559">In this [Batch .NET][net_api] code snippet, we evaluate an autoscale formula.</span></span> <span data-ttu-id="d6242-560">Si el grupo no tiene habilitado el escalado automático, lo habilitaremos primero.</span><span class="sxs-lookup"><span data-stu-id="d6242-560">If the pool does not have autoscaling enabled, we enable it first.</span></span>

```csharp
// First obtain a reference to an existing pool
CloudPool pool = await batchClient.PoolOperations.GetPoolAsync("myExistingPool");

// If autoscaling isn't already enabled on the pool, enable it.
// You can't evaluate an autoscale formula on non-autoscale-enabled pool.
if (pool.AutoScaleEnabled == false)
{
    // We need a valid autoscale formula to enable autoscaling on the
    // pool. This formula is valid, but won't resize the pool:
    await pool.EnableAutoScaleAsync(
        autoscaleFormula: "$TargetDedicatedNodes = {pool.CurrentDedicatedNodes};",
        autoscaleEvaluationInterval: TimeSpan.FromMinutes(5));

    // Batch limits EnableAutoScaleAsync calls to once every 30 seconds.
    // Because we want to apply our new autoscale formula below if it
    // evaluates successfully, and we *just* enabled autoscaling on
    // this pool, we pause here to ensure we pass that threshold.
    Thread.Sleep(TimeSpan.FromSeconds(31));

    // Refresh the properties of the pool so that we've got the
    // latest value for AutoScaleEnabled
    await pool.RefreshAsync();
}

// We must ensure that autoscaling is enabled on the pool prior to
// evaluating a formula
if (pool.AutoScaleEnabled == true)
{
    // The formula to evaluate - adjusts target number of nodes based on
    // day of week and time of day
    string myFormula = @"
        $curTime = time();
        $workHours = $curTime.hour >= 8 && $curTime.hour < 18;
        $isWeekday = $curTime.weekday >= 1 && $curTime.weekday <= 5;
        $isWorkingWeekdayHour = $workHours && $isWeekday;
        $TargetDedicatedNodes = $isWorkingWeekdayHour ? 20:10;
    ";

    // Perform the autoscale formula evaluation. Note that this code does not
    // actually apply the formula to the pool.
    AutoScaleRun eval =
        await batchClient.PoolOperations.EvaluateAutoScaleAsync(pool.Id, myFormula);

    if (eval.Error == null)
    {
        // Evaluation success - print the results of the AutoScaleRun.
        // This will display the values of each variable as evaluated by the
        // autoscale formula.
        Console.WriteLine("AutoScaleRun.Results: " +
            eval.Results.Replace("$", "\n    $"));

        // Apply the formula to the pool since it evaluated successfully
        await batchClient.PoolOperations.EnableAutoScaleAsync(pool.Id, myFormula);
    }
    else
    {
        // Evaluation failed, output the message associated with the error
        Console.WriteLine("AutoScaleRun.Error.Message: " +
            eval.Error.Message);
    }
}
```

<span data-ttu-id="d6242-561">Una evaluación correcta de la fórmula que se muestra en este fragmento de código genera unos resultados similares a esto:</span><span class="sxs-lookup"><span data-stu-id="d6242-561">Successful evaluation of the formula shown in this code snippet produces results similar to:</span></span>

```
AutoScaleRun.Results:
    $TargetDedicatedNodes=10;
    $NodeDeallocationOption=requeue;
    $curTime=2016-10-13T19:18:47.805Z;
    $isWeekday=1;
    $isWorkingWeekdayHour=0;
    $workHours=0
```

## <a name="get-information-about-autoscale-runs"></a><span data-ttu-id="d6242-562">Obtención de información sobre la ejecución del escalado automático</span><span class="sxs-lookup"><span data-stu-id="d6242-562">Get information about autoscale runs</span></span>

<span data-ttu-id="d6242-563">Para asegurarse de que la fórmula se ejecuta según lo esperado, le recomendamos que compruebe periódicamente los resultados de las ejecuciones de escalado automático que lleva a cabo Batch en su grupo.</span><span class="sxs-lookup"><span data-stu-id="d6242-563">To ensure that your formula is performing as expected, we recommend that you periodically check the results of the autoscaling runs that Batch performs on your pool.</span></span> <span data-ttu-id="d6242-564">Para ello, obtenga (o actualice) una referencia al grupo y examine las propiedades de su última ejecución de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="d6242-564">To do so, get (or refresh) a reference to the pool, and examine the properties of its last autoscale run.</span></span>

<span data-ttu-id="d6242-565">En Batch .NET, la propiedad [CloudPool.AutoScaleRun](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscalerun) tiene varias propiedades que proporcionan información sobre la última ejecución de escalado automático efectuada en el grupo:</span><span class="sxs-lookup"><span data-stu-id="d6242-565">In Batch .NET, the [CloudPool.AutoScaleRun](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscalerun) property has several properties that provide information about the latest automatic scaling run performed on the pool:</span></span>

* [<span data-ttu-id="d6242-566">AutoScaleRun.Timestamp</span><span class="sxs-lookup"><span data-stu-id="d6242-566">AutoScaleRun.Timestamp</span></span>](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.autoscalerun.timestamp)
* [<span data-ttu-id="d6242-567">AutoScaleRun.Results</span><span class="sxs-lookup"><span data-stu-id="d6242-567">AutoScaleRun.Results</span></span>](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.autoscalerun.results)
* [<span data-ttu-id="d6242-568">AutoScaleRun.Error</span><span class="sxs-lookup"><span data-stu-id="d6242-568">AutoScaleRun.Error</span></span>](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.autoscalerun.error)

<span data-ttu-id="d6242-569">En la API de REST, la solicitud para [obtener información sobre un grupo](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool) devuelve información sobre el grupo (por ejemplo, información sobre la última ejecución de escalado automático en la propiedad [autoScaleRun](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool#bk_autrun)).</span><span class="sxs-lookup"><span data-stu-id="d6242-569">In the REST API, the [Get information about a pool](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool) request returns information about the pool, which includes the latest automatic scaling run information in the [autoScaleRun](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool#bk_autrun) property.</span></span>

<span data-ttu-id="d6242-570">El siguiente fragmento de código de C# usa la biblioteca Batch .NET para imprimir información sobre la última ejecución de escalado automático en el grupo _myPool_:</span><span class="sxs-lookup"><span data-stu-id="d6242-570">The following C# code snippet uses the Batch .NET library to print information about the last autoscaling run on pool _myPool_:</span></span>

```csharp
await Cloud pool = myBatchClient.PoolOperations.GetPoolAsync("myPool");
Console.WriteLine("Last execution: " + pool.AutoScaleRun.Timestamp);
Console.WriteLine("Result:" + pool.AutoScaleRun.Results.Replace("$", "\n  $"));
Console.WriteLine("Error: " + pool.AutoScaleRun.Error);
```

<span data-ttu-id="d6242-571">Salida de ejemplo del fragmento de código anterior:</span><span class="sxs-lookup"><span data-stu-id="d6242-571">Sample output of the preceding snippet:</span></span>

```
Last execution: 10/14/2016 18:36:43
Result:
  $TargetDedicatedNodes=10;
  $NodeDeallocationOption=requeue;
  $curTime=2016-10-14T18:36:43.282Z;
  $isWeekday=1;
  $isWorkingWeekdayHour=0;
  $workHours=0
Error:
```

## <a name="example-autoscale-formulas"></a><span data-ttu-id="d6242-572">Ejemplo de fórmulas de escalado automático</span><span class="sxs-lookup"><span data-stu-id="d6242-572">Example autoscale formulas</span></span>
<span data-ttu-id="d6242-573">Echemos un vistazo a algunas fórmulas que muestran distintas formas de ajustar la cantidad de recursos de proceso de un grupo.</span><span class="sxs-lookup"><span data-stu-id="d6242-573">Let's look at a few formulas that show different ways to adjust the amount of compute resources in a pool.</span></span>

### <a name="example-1-time-based-adjustment"></a><span data-ttu-id="d6242-574">Ejemplo 1: Ajuste basado en la fecha y hora</span><span class="sxs-lookup"><span data-stu-id="d6242-574">Example 1: Time-based adjustment</span></span>
<span data-ttu-id="d6242-575">Imagínese que quiere ajustar el tamaño del grupo en función de la hora y el día de la semana.</span><span class="sxs-lookup"><span data-stu-id="d6242-575">Suppose you want to adjust the pool size based on the day of the week and time of day.</span></span> <span data-ttu-id="d6242-576">En este ejemplo se muestra cómo aumentar o disminuir en consecuencia el número de nodos del grupo.</span><span class="sxs-lookup"><span data-stu-id="d6242-576">This example shows how to increase or decrease the number of nodes in the pool accordingly.</span></span>

<span data-ttu-id="d6242-577">En primer lugar, la fórmula obtiene la hora actual.</span><span class="sxs-lookup"><span data-stu-id="d6242-577">The formula first obtains the current time.</span></span> <span data-ttu-id="d6242-578">Si se trata de un día laborable (1-5) y dentro del horario laboral (de 8 a.m. a 6 p.m.), el tamaño del grupo de destino se establece en 20 nodos.</span><span class="sxs-lookup"><span data-stu-id="d6242-578">If it's a weekday (1-5) and within working hours (8 AM to 6 PM), the target pool size is set to 20 nodes.</span></span> <span data-ttu-id="d6242-579">De lo contrario, se establece en 10 nodos.</span><span class="sxs-lookup"><span data-stu-id="d6242-579">Otherwise, it's set to 10 nodes.</span></span>

```
$curTime = time();
$workHours = $curTime.hour >= 8 && $curTime.hour < 18;
$isWeekday = $curTime.weekday >= 1 && $curTime.weekday <= 5;
$isWorkingWeekdayHour = $workHours && $isWeekday;
$TargetDedicatedNodes = $isWorkingWeekdayHour ? 20:10;
```

### <a name="example-2-task-based-adjustment"></a><span data-ttu-id="d6242-580">Ejemplo 2: Ajuste basado en tareas</span><span class="sxs-lookup"><span data-stu-id="d6242-580">Example 2: Task-based adjustment</span></span>
<span data-ttu-id="d6242-581">En este ejemplo, el tamaño del grupo se ajusta en función del número de tareas en la cola.</span><span class="sxs-lookup"><span data-stu-id="d6242-581">In this example, the pool size is adjusted based on the number of tasks in the queue.</span></span> <span data-ttu-id="d6242-582">Las cadenas de la fórmula aceptan tanto comentarios como saltos de línea.</span><span class="sxs-lookup"><span data-stu-id="d6242-582">Both comments and line breaks are acceptable in formula strings.</span></span>

```csharp
// Get pending tasks for the past 15 minutes.
$samples = $ActiveTasks.GetSamplePercent(TimeInterval_Minute * 15);
// If we have fewer than 70 percent data points, we use the last sample point,
// otherwise we use the maximum of last sample point and the history average.
$tasks = $samples < 70 ? max(0,$ActiveTasks.GetSample(1)) : max( $ActiveTasks.GetSample(1), avg($ActiveTasks.GetSample(TimeInterval_Minute * 15)));
// If number of pending tasks is not 0, set targetVM to pending tasks, otherwise
// half of current dedicated.
$targetVMs = $tasks > 0? $tasks:max(0, $TargetDedicatedNodes/2);
// The pool size is capped at 20, if target VM value is more than that, set it
// to 20. This value should be adjusted according to your use case.
$TargetDedicatedNodes = max(0, min($targetVMs, 20));
// Set node deallocation mode - keep nodes active only until tasks finish
$NodeDeallocationOption = taskcompletion;
```

### <a name="example-3-accounting-for-parallel-tasks"></a><span data-ttu-id="d6242-583">Ejemplo 3: Contabilidad para tareas paralelas</span><span class="sxs-lookup"><span data-stu-id="d6242-583">Example 3: Accounting for parallel tasks</span></span>
<span data-ttu-id="d6242-584">Este ejemplo ajusta el tamaño del grupo en función del número de tareas.</span><span class="sxs-lookup"><span data-stu-id="d6242-584">This example adjusts the pool size based on the number of tasks.</span></span> <span data-ttu-id="d6242-585">Esta fórmula también tiene en cuenta el valor de [MaxTasksPerComputeNode][net_maxtasks] que se ha establecido para el grupo.</span><span class="sxs-lookup"><span data-stu-id="d6242-585">This formula also takes into account the [MaxTasksPerComputeNode][net_maxtasks] value that has been set for the pool.</span></span> <span data-ttu-id="d6242-586">Este enfoque es útil en aquellas situaciones en las que la [ejecución de tareas paralelas](batch-parallel-node-tasks.md) se ha habilitado en el grupo.</span><span class="sxs-lookup"><span data-stu-id="d6242-586">This approach is useful in situations where [parallel task execution](batch-parallel-node-tasks.md) has been enabled on your pool.</span></span>

```csharp
// Determine whether 70 percent of the samples have been recorded in the past
// 15 minutes; if not, use last sample
$samples = $ActiveTasks.GetSamplePercent(TimeInterval_Minute * 15);
$tasks = $samples < 70 ? max(0,$ActiveTasks.GetSample(1)) : max( $ActiveTasks.GetSample(1),avg($ActiveTasks.GetSample(TimeInterval_Minute * 15)));
// Set the number of nodes to add to one-fourth the number of active tasks (the
// MaxTasksPerComputeNode property on this pool is set to 4, adjust this number
// for your use case)
$cores = $TargetDedicatedNodes * 4;
$extraVMs = (($tasks - $cores) + 3) / 4;
$targetVMs = ($TargetDedicatedNodes + $extraVMs);
// Attempt to grow the number of compute nodes to match the number of active
// tasks, with a maximum of 3
$TargetDedicatedNodes = max(0,min($targetVMs,3));
// Keep the nodes active until the tasks finish
$NodeDeallocationOption = taskcompletion;
```

### <a name="example-4-setting-an-initial-pool-size"></a><span data-ttu-id="d6242-587">Ejemplo 4: Configuración de un tamaño de grupo inicial</span><span class="sxs-lookup"><span data-stu-id="d6242-587">Example 4: Setting an initial pool size</span></span>
<span data-ttu-id="d6242-588">En este ejemplo se muestra un fragmento de código de C# con una fórmula de escalado automático que establece el tamaño del grupo en un número de nodos específico durante un período de tiempo inicial.</span><span class="sxs-lookup"><span data-stu-id="d6242-588">This example shows a C# code snippet with an autoscale formula that sets the pool size to a specified number of nodes for an initial time period.</span></span> <span data-ttu-id="d6242-589">A continuación, se ajusta el tamaño del grupo según el número de tareas activas y en ejecución una vez transcurrido el período de tiempo inicial.</span><span class="sxs-lookup"><span data-stu-id="d6242-589">Then it adjusts the pool size based on the number of running and active tasks after the initial time period has elapsed.</span></span>

<span data-ttu-id="d6242-590">La fórmula en el siguiente fragmento de código:</span><span class="sxs-lookup"><span data-stu-id="d6242-590">The formula in the following code snippet:</span></span>

* <span data-ttu-id="d6242-591">Establece el tamaño inicial del grupo en cuatro nodos.</span><span class="sxs-lookup"><span data-stu-id="d6242-591">Sets the initial pool size to four nodes.</span></span>
* <span data-ttu-id="d6242-592">No ajusta el tamaño del grupo en los 10 primeros minutos del ciclo de vida del mismo.</span><span class="sxs-lookup"><span data-stu-id="d6242-592">Does not adjust the pool size within the first 10 minutes of the pool's lifecycle.</span></span>
* <span data-ttu-id="d6242-593">Después de 10 minutos, obtiene el valor máximo del número de tareas activas y en ejecución en los últimos 60 minutos.</span><span class="sxs-lookup"><span data-stu-id="d6242-593">After 10 minutes, obtains the max value of the number of running and active tasks within the past 60 minutes.</span></span>
  * <span data-ttu-id="d6242-594">Si ambos valores son 0 (lo que indica que no hay tareas activas o en ejecución en los últimos 60 minutos) el tamaño del grupo se establece en 0.</span><span class="sxs-lookup"><span data-stu-id="d6242-594">If both values are 0 (indicating that no tasks were running or active in the last 60 minutes), the pool size is set to 0.</span></span>
  * <span data-ttu-id="d6242-595">Si cualquier valor es mayor que cero, no hay cambios.</span><span class="sxs-lookup"><span data-stu-id="d6242-595">If either value is greater than zero, no change is made.</span></span>

```csharp
string now = DateTime.UtcNow.ToString("r");
string formula = string.Format(@"
    $TargetDedicatedNodes = {1};
    lifespan         = time() - time(""{0}"");
    span             = TimeInterval_Minute * 60;
    startup          = TimeInterval_Minute * 10;
    ratio            = 50;

    $TargetDedicatedNodes = (lifespan > startup ? (max($RunningTasks.GetSample(span, ratio), $ActiveTasks.GetSample(span, ratio)) == 0 ? 0 : $TargetDedicatedNodes) : {1});
    ", now, 4);
```

## <a name="next-steps"></a><span data-ttu-id="d6242-596">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="d6242-596">Next steps</span></span>
* <span data-ttu-id="d6242-597">[Maximizar el uso de recursos de proceso de Lote de Azure con tareas simultáneas de nodo](batch-parallel-node-tasks.md) contiene detalles acerca de cómo se pueden ejecutar varias tareas simultáneamente en los nodos de proceso en el grupo.</span><span class="sxs-lookup"><span data-stu-id="d6242-597">[Maximize Azure Batch compute resource usage with concurrent node tasks](batch-parallel-node-tasks.md) contains details about how you can execute multiple tasks simultaneously on the compute nodes in your pool.</span></span> <span data-ttu-id="d6242-598">Además del escalado automático, esta característica puede ayudar a reducir la duración del trabajo para algunas cargas de trabajo, lo que permite ahorrar dinero.</span><span class="sxs-lookup"><span data-stu-id="d6242-598">In addition to autoscaling, this feature may help to lower job duration for some workloads, saving you money.</span></span>
* <span data-ttu-id="d6242-599">Para otro ajuste de la eficacia, asegúrese de que la aplicación Lote consulta el servicio Lote de la manera más óptima.</span><span class="sxs-lookup"><span data-stu-id="d6242-599">For another efficiency booster, ensure that your Batch application queries the Batch service in the most optimal way.</span></span> <span data-ttu-id="d6242-600">Consulte [Creación de consultas para enumerar los recursos de Batch con eficacia](batch-efficient-list-queries.md) para aprender a limitar la cantidad de datos que atraviesan la conexión al consultar el estado de posiblemente miles de nodos de ejecución o tareas.</span><span class="sxs-lookup"><span data-stu-id="d6242-600">See [Query the Azure Batch service efficiently](batch-efficient-list-queries.md) to learn how to limit the amount of data that crosses the wire when you query the status of potentially thousands of compute nodes or tasks.</span></span>

[net_api]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch
[net_batchclient]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.batchclient
[net_cloudpool_autoscaleformula]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleformula
[net_cloudpool_autoscaleevalinterval]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleevaluationinterval
[net_enableautoscaleasync]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.enableautoscaleasync
[net_maxtasks]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.maxtaskspercomputenode
[net_poolops_resizepoolasync]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.resizepoolasync

[rest_api]: https://docs.microsoft.com/rest/api/batchservice/
[rest_autoscaleformula]: https://docs.microsoft.com/rest/api/batchservice/enable-automatic-scaling-on-a-pool
[rest_autoscaleinterval]: https://docs.microsoft.com/rest/api/batchservice/enable-automatic-scaling-on-a-pool
[rest_enableautoscale]: https://docs.microsoft.com/rest/api/batchservice/enable-automatic-scaling-on-a-pool

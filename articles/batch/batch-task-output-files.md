---
title: Guardar salidas de trabajos y tareas en Azure Storage con la API del servicio Azure Batch | Microsoft Docs
description: Aprenda a usar la API del servicio Batch para guardar salidas de trabajos y tareas de Batch en Azure Storage.
services: batch
author: tamram
manager: timlt
editor: 
ms.service: batch
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: big-compute
ms.date: 06/16/2017
ms.author: tamram
ms.openlocfilehash: 2530b7c20347b9fb58aee4dfe693847cf3911741
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/29/2017
---
# <a name="persist-task-data-to-azure-storage-with-the-batch-service-api"></a><span data-ttu-id="5be1d-103">Almacenamiento de datos de tareas en Azure Storage con la API del servicio Batch</span><span class="sxs-lookup"><span data-stu-id="5be1d-103">Persist task data to Azure Storage with the Batch service API</span></span>

[!INCLUDE [batch-task-output-include](../../includes/batch-task-output-include.md)]

<span data-ttu-id="5be1d-104">Empezando por la versión del 1 de mayo de 2017, la API del servicio Batch permite guardar datos de salida en Azure Storage para tareas simples y tareas de administrador de trabajos que se ejecutan en los grupos con la configuración de máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="5be1d-104">Starting with version 2017-05-01, the Batch service API supports persisting output data to Azure Storage for tasks and job manager tasks that run on pools with the virtual machine configuration.</span></span> <span data-ttu-id="5be1d-105">Cuando se agrega una tarea, puede especificar un contenedor de Azure Storage como destino para la salida de la tarea.</span><span class="sxs-lookup"><span data-stu-id="5be1d-105">When you add a task, you can specify a container in Azure Storage as the destination for the task's output.</span></span> <span data-ttu-id="5be1d-106">Posteriormente, el servicio Batch escribe los datos de salida en ese contenedor cuando se completa la tarea.</span><span class="sxs-lookup"><span data-stu-id="5be1d-106">The Batch service then writes any output data to that container when the task is complete.</span></span>

<span data-ttu-id="5be1d-107">Una ventaja de utilizar la API del servicio Batch para guardar la salida de las tareas es que no es necesario modificar la aplicación que la tarea ejecuta.</span><span class="sxs-lookup"><span data-stu-id="5be1d-107">An advantage to using the Batch service API to persist task output is that you do not need to modify the application that the task is running.</span></span> <span data-ttu-id="5be1d-108">En su lugar, con unas simples modificaciones en la aplicación cliente, puede guardar la salida de las tareas desde dentro del código que crea la tarea.</span><span class="sxs-lookup"><span data-stu-id="5be1d-108">Instead, with a few simple modifications to your client application, you can persist the task's output from within the code that creates the task.</span></span>   

## <a name="when-do-i-use-the-batch-service-api-to-persist-task-output"></a><span data-ttu-id="5be1d-109">¿Cuándo debo usar la API del servicio Batch para almacenar la salida de tarea?</span><span class="sxs-lookup"><span data-stu-id="5be1d-109">When do I use the Batch service API to persist task output?</span></span>

<span data-ttu-id="5be1d-110">Azure Batch proporciona más de una manera de guardar las salidas de tareas.</span><span class="sxs-lookup"><span data-stu-id="5be1d-110">Azure Batch provides more than one way to persist task output.</span></span> <span data-ttu-id="5be1d-111">El uso de la API de servicio de Batch es el método más adecuado para estos escenarios:</span><span class="sxs-lookup"><span data-stu-id="5be1d-111">Using the Batch service API is a convenient approach that's best suited to these scenarios:</span></span>

- <span data-ttu-id="5be1d-112">Desea escribir código para guardar la salida de las tareas desde dentro de la aplicación cliente, sin modificar la aplicación que la tarea ejecuta.</span><span class="sxs-lookup"><span data-stu-id="5be1d-112">You want to write code to persist task output from within your client application, without modifying the application that your task is running.</span></span>
- <span data-ttu-id="5be1d-113">Quiere guardar las salidas de las tareas y trabajos del administrador de Batch en grupos creados con la configuración de máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="5be1d-113">You want to persist output from Batch tasks and job manager tasks in pools created with the virtual machine configuration.</span></span>
- <span data-ttu-id="5be1d-114">Quiere guardar salidas en un contenedor de Azure Storage con un nombre arbitrario.</span><span class="sxs-lookup"><span data-stu-id="5be1d-114">You want to persist output to an Azure Storage container with an arbitrary name.</span></span>
- <span data-ttu-id="5be1d-115">Quiere almacenar salidas en un contenedor de Azure Storage denominado según el [estándar de convenciones de archivo de Batch](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span><span class="sxs-lookup"><span data-stu-id="5be1d-115">You want to persist output to an Azure Storage container named according to the [Batch File Conventions standard](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span></span> 

<span data-ttu-id="5be1d-116">Si su escenario es diferente de los mencionados anteriormente, considere la adopción de un enfoque diferente.</span><span class="sxs-lookup"><span data-stu-id="5be1d-116">If your scenario differs from those listed above, you may need to consider a different approach.</span></span> <span data-ttu-id="5be1d-117">Por ejemplo, la API del servicio Batch no admite actualmente la transmisión de la salida a Azure Storage mientras se ejecuta la tarea.</span><span class="sxs-lookup"><span data-stu-id="5be1d-117">For example, the Batch service API does not currently support streaming output to Azure Storage while the task is running.</span></span> <span data-ttu-id="5be1d-118">Para transmitir salidas, considere el uso de la biblioteca de convenciones de archivo de Batch, disponible para. NET.</span><span class="sxs-lookup"><span data-stu-id="5be1d-118">To stream output, consider using the Batch File Conventions library, available for .NET.</span></span> <span data-ttu-id="5be1d-119">Para otros lenguajes, debe implementar su propia solución.</span><span class="sxs-lookup"><span data-stu-id="5be1d-119">For other languages, you'll need to implement your own solution.</span></span> <span data-ttu-id="5be1d-120">Para más información sobre otras opciones para guardar la salida de tareas, consulte [Guardar salidas de trabajos y tareas en Azure Storage](batch-task-output.md).</span><span class="sxs-lookup"><span data-stu-id="5be1d-120">For more information on other options for persisting task output, see [Persist job and task output to Azure Storage](batch-task-output.md).</span></span> 

## <a name="create-a-container-in-azure-storage"></a><span data-ttu-id="5be1d-121">Creación de un contenedor en Azure Storage</span><span class="sxs-lookup"><span data-stu-id="5be1d-121">Create a container in Azure Storage</span></span>

<span data-ttu-id="5be1d-122">Para guardar las salidas de tareas en Azure Storage, debe crear un contenedor que actúe como destino de los archivos de salida.</span><span class="sxs-lookup"><span data-stu-id="5be1d-122">To persist task output to Azure Storage, you'll need to create a container that serves as the destination for your output files.</span></span> <span data-ttu-id="5be1d-123">Cree el contenedor antes de ejecutar la tarea, preferiblemente antes de enviar el trabajo.</span><span class="sxs-lookup"><span data-stu-id="5be1d-123">Create the container before you run your task, preferably before you submit your job.</span></span> <span data-ttu-id="5be1d-124">Para crear el contenedor, use la biblioteca de cliente o SDK adecuados de Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="5be1d-124">To create the container, use the appropriate Azure Storage client library or SDK.</span></span> <span data-ttu-id="5be1d-125">Para más información sobre las API de Azure Storage, consulte [Documentación de Azure Storage](https://docs.microsoft.com/azure/storage/).</span><span class="sxs-lookup"><span data-stu-id="5be1d-125">For more information about Azure Storage APIs, see the [Azure Storage documentation](https://docs.microsoft.com/azure/storage/).</span></span>

<span data-ttu-id="5be1d-126">Por ejemplo, si va a escribir la aplicación en C#, utilice la [biblioteca de cliente para .NET de Azure Storage](https://www.nuget.org/packages/WindowsAzure.Storage/).</span><span class="sxs-lookup"><span data-stu-id="5be1d-126">For example, if you are writing your application in C#, use the [Azure Storage client library for .NET](https://www.nuget.org/packages/WindowsAzure.Storage/).</span></span> <span data-ttu-id="5be1d-127">En el ejemplo siguiente se muestra cómo crear un contenedor:</span><span class="sxs-lookup"><span data-stu-id="5be1d-127">The following example shows how to create a container:</span></span>

```csharp
CloudBlobContainer container = storageAccount.CreateCloudBlobClient().GetContainerReference(containerName);
await conainer.CreateIfNotExists();
```

## <a name="get-a-shared-access-signature-for-the-container"></a><span data-ttu-id="5be1d-128">Obtención de una firma de acceso compartido para el contenedor</span><span class="sxs-lookup"><span data-stu-id="5be1d-128">Get a shared access signature for the container</span></span>

<span data-ttu-id="5be1d-129">Después de crear el contenedor, obtenga una firma de acceso compartido (SAS) con acceso de escritura en el contenedor.</span><span class="sxs-lookup"><span data-stu-id="5be1d-129">After you create the container, get a shared access signature (SAS) with write access to the container.</span></span> <span data-ttu-id="5be1d-130">Una SAS proporciona acceso delegado al contenedor.</span><span class="sxs-lookup"><span data-stu-id="5be1d-130">A SAS provides delegated access to the container.</span></span> <span data-ttu-id="5be1d-131">La SAS concede acceso con un conjunto de permisos y durante un intervalo de tiempo que puede especificar.</span><span class="sxs-lookup"><span data-stu-id="5be1d-131">The SAS grants access with a specified set of permissions and over a specified time interval.</span></span> <span data-ttu-id="5be1d-132">El servicio Batch necesita una SAS con permisos de escritura para escribir la salida de la tarea en el contenedor.</span><span class="sxs-lookup"><span data-stu-id="5be1d-132">The Batch service needs a SAS with write permissions to write task output to the container.</span></span> <span data-ttu-id="5be1d-133">Para más información sobre las firmas de acceso compartido, consulte [Uso de firmas de acceso compartido \(SAS\) en Azure Storage](../storage/common/storage-dotnet-shared-access-signature-part-1.md).</span><span class="sxs-lookup"><span data-stu-id="5be1d-133">For more information about SAS, see [Using shared access signatures \(SAS\) in Azure Storage](../storage/common/storage-dotnet-shared-access-signature-part-1.md).</span></span>

<span data-ttu-id="5be1d-134">Cuando se obtiene una SAS mediante las API de Azure Storage, la API devuelve una cadena de token de SAS.</span><span class="sxs-lookup"><span data-stu-id="5be1d-134">When you get a SAS using the Azure Storage APIs, the API returns a SAS token string.</span></span> <span data-ttu-id="5be1d-135">Esta cadena de token incluye todos los parámetros de la SAS, incluidos los permisos y el intervalo durante el que la SAS es válida.</span><span class="sxs-lookup"><span data-stu-id="5be1d-135">This token string includes all parameters of the SAS, including the permissions and the interval over which the SAS is valid.</span></span> <span data-ttu-id="5be1d-136">Para usar la SAS para acceder a un contenedor de Azure Storage, es necesario anexar la cadena de token de SAS al URI del recurso.</span><span class="sxs-lookup"><span data-stu-id="5be1d-136">To use the SAS to access a container in Azure Storage, you need to append the SAS token string to the resource URI.</span></span> <span data-ttu-id="5be1d-137">El identificador URI del recurso, junto con el token de SAS anexado, proporciona acceso autenticado a Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="5be1d-137">The resource URI, together with the appended SAS token, provides authenticated access to Azure Storage.</span></span>

<span data-ttu-id="5be1d-138">En el ejemplo siguiente se muestra cómo obtener una cadena de token de SAS de solo escritura para el contenedor y, a continuación, anexar la SAS al URI de este:</span><span class="sxs-lookup"><span data-stu-id="5be1d-138">The following example shows how to get a write-only SAS token string for the container, then appends the SAS to the container URI:</span></span>

```csharp
string containerSasToken = container.GetSharedAccessSignature(new SharedAccessBlobPolicy()
{
    SharedAccessExpiryTime = DateTimeOffset.UtcNow.AddDays(1),
    Permissions = SharedAccessBlobPermissions.Write
});

string containerSasUrl = container.Uri.AbsoluteUri + containerSasToken; 
```

## <a name="specify-output-files-for-task-output"></a><span data-ttu-id="5be1d-139">Especificar archivos de salida para la salida de la tarea</span><span class="sxs-lookup"><span data-stu-id="5be1d-139">Specify output files for task output</span></span>

<span data-ttu-id="5be1d-140">Para especificar archivos de salida para una tarea, cree una colección de objetos [OutputFile](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile) y asígnela a la propiedad [CloudTask.OutputFiles](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudtask.outputfiles#Microsoft_Azure_Batch_CloudTask_OutputFiles) cuando cree la tarea.</span><span class="sxs-lookup"><span data-stu-id="5be1d-140">To specify output files for a task, create a collection of [OutputFile](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile) objects and assign it to the [CloudTask.OutputFiles](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudtask.outputfiles#Microsoft_Azure_Batch_CloudTask_OutputFiles) property when you create the task.</span></span> 

<span data-ttu-id="5be1d-141">El siguiente ejemplo de código .NET crea una tarea que escribe números aleatorios en un archivo denominado `output.txt`.</span><span class="sxs-lookup"><span data-stu-id="5be1d-141">The following .NET code example creates a task that writes random numbers to a file named `output.txt`.</span></span> <span data-ttu-id="5be1d-142">En el ejemplo se crea un archivo de salida para `output.txt` que se escribe en el contenedor.</span><span class="sxs-lookup"><span data-stu-id="5be1d-142">The example creates an output file for `output.txt` to be written to the container.</span></span> <span data-ttu-id="5be1d-143">En el ejemplo también se crean archivos de salida para todos los archivos de registro que coinciden con el patrón de archivos `std*.txt` (_p. ej._, `stdout.txt` y `stderr.txt`).</span><span class="sxs-lookup"><span data-stu-id="5be1d-143">The example also creates output files for any log files that match the file pattern `std*.txt` (_e.g._, `stdout.txt` and `stderr.txt`).</span></span> <span data-ttu-id="5be1d-144">La URL del contenedor requiere la SAS que creó anteriormente para este.</span><span class="sxs-lookup"><span data-stu-id="5be1d-144">The container URL requires the SAS that was created previously for the container.</span></span> <span data-ttu-id="5be1d-145">El servicio Batch utiliza la SAS para autenticar el acceso al contenedor:</span><span class="sxs-lookup"><span data-stu-id="5be1d-145">The Batch service uses the SAS to authenticate access to the container:</span></span> 

```csharp
new CloudTask(taskId, "cmd /v:ON /c \"echo off && set && (FOR /L %i IN (1,1,100000) DO (ECHO !RANDOM!)) > output.txt\"")
{
    OutputFiles = new List<OutputFile>
    {
        new OutputFile(
            filePattern: @"..\std*.txt",
            destination: new OutputFileDestination(
         new OutputFileBlobContainerDestination(
                    containerUrl: containerSasUrl,
                    path: taskId)),
            uploadOptions: new OutputFileUploadOptions(
            uploadCondition: OutputFileUploadCondition.TaskCompletion)),
        new OutputFile(
            filePattern: @"output.txt",
            destination: 
         new OutputFileDestination(new OutputFileBlobContainerDestination(
                    containerUrl: containerSasUrl,
                    path: taskId + @"\output.txt")),
            uploadOptions: new OutputFileUploadOptions(
            uploadCondition: OutputFileUploadCondition.TaskCompletion)),
}
```

### <a name="specify-a-file-pattern-for-matching"></a><span data-ttu-id="5be1d-146">Especifique un patrón de archivos para buscar coincidencias</span><span class="sxs-lookup"><span data-stu-id="5be1d-146">Specify a file pattern for matching</span></span>

<span data-ttu-id="5be1d-147">Cuando especifica un archivo de salida, puede usar la propiedad [OutputFile.FilePattern](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile.filepattern#Microsoft_Azure_Batch_OutputFile_FilePattern) para especificar un patrón de archivos para buscar coincidencias.</span><span class="sxs-lookup"><span data-stu-id="5be1d-147">When you specify an output file, you can use the [OutputFile.FilePattern](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile.filepattern#Microsoft_Azure_Batch_OutputFile_FilePattern) property to specify a file pattern for matching.</span></span> <span data-ttu-id="5be1d-148">El patrón de archivos puede no coincidir con ningún archivo, coincidir con un solo archivo o con un conjunto de archivos creados por la tarea.</span><span class="sxs-lookup"><span data-stu-id="5be1d-148">The file pattern may match zero files, a single file, or a set of files that are created by the task.</span></span>

<span data-ttu-id="5be1d-149">La propiedad **FilePattern** admite caracteres comodín del sistema de archivos estándar, como `*` (para coincidencias no recursivas) y `**` (para coincidencias recursivas).</span><span class="sxs-lookup"><span data-stu-id="5be1d-149">The **FilePattern** property supports standard filesystem wildcards such as `*` (for non-recursive matches) and `**` (for recursive matches).</span></span> <span data-ttu-id="5be1d-150">Por ejemplo, el ejemplo de código anterior especifica el patrón de archivos para que coincida con `std*.txt` de manera no recursiva:</span><span class="sxs-lookup"><span data-stu-id="5be1d-150">For example, the code sample above specifies the file pattern to match `std*.txt` non-recursively:</span></span> 

`filePattern: @"..\std*.txt"`

<span data-ttu-id="5be1d-151">Para cargar un único archivo, especifique un patrón de archivos sin ningún carácter comodín.</span><span class="sxs-lookup"><span data-stu-id="5be1d-151">To upload a single file, specify a file pattern with no wildcards.</span></span> <span data-ttu-id="5be1d-152">Por ejemplo, el ejemplo de código anterior especifica el patrón de archivos para que coincida con `output.txt`:</span><span class="sxs-lookup"><span data-stu-id="5be1d-152">For example, the code sample above specifies the file pattern to match `output.txt`:</span></span>

`filePattern: @"output.txt"`

### <a name="specify-an-upload-condition"></a><span data-ttu-id="5be1d-153">Especificar una condición de carga</span><span class="sxs-lookup"><span data-stu-id="5be1d-153">Specify an upload condition</span></span>

<span data-ttu-id="5be1d-154">La propiedad [OutputFileUploadOptions.UploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileuploadoptions.uploadcondition#Microsoft_Azure_Batch_OutputFileUploadOptions_UploadCondition) permite la carga condicional de archivos de salida.</span><span class="sxs-lookup"><span data-stu-id="5be1d-154">The [OutputFileUploadOptions.UploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileuploadoptions.uploadcondition#Microsoft_Azure_Batch_OutputFileUploadOptions_UploadCondition) property permits conditional uploading of output files.</span></span> <span data-ttu-id="5be1d-155">Un escenario común consiste en cargar un conjunto de archivos si la tarea finaliza correctamente y otro diferente si se produce un error.</span><span class="sxs-lookup"><span data-stu-id="5be1d-155">A common scenario is to upload one set of files if the task succeeds, and a different set of files if it fails.</span></span> <span data-ttu-id="5be1d-156">Por ejemplo, puede que desee cargar archivos de registro detallados solo cuando se produce un error en la tarea y finaliza con un código de salida distinto de cero.</span><span class="sxs-lookup"><span data-stu-id="5be1d-156">For example, you may want to upload verbose log files only when the task fails and exits with a nonzero exit code.</span></span> <span data-ttu-id="5be1d-157">De igual forma, es posible que quiera cargar los archivos de resultados solo si la tarea finaliza correctamente, ya que puede que esos archivos falten o estén incompletos si se produce un error en la tarea.</span><span class="sxs-lookup"><span data-stu-id="5be1d-157">Similarly, you may want to upload result files only if the task succeeds, as those files may be missing or incomplete if the task fails.</span></span>

<span data-ttu-id="5be1d-158">El ejemplo de código anterior permite establecer la propiedad **UploadCondition** en **TaskCompletion**.</span><span class="sxs-lookup"><span data-stu-id="5be1d-158">The code sample above sets the **UploadCondition** property to **TaskCompletion**.</span></span> <span data-ttu-id="5be1d-159">Esta configuración especifica que se debe cargar el archivo una vez completada la tarea, independientemente del valor del código de salida.</span><span class="sxs-lookup"><span data-stu-id="5be1d-159">This setting specifies that the file is to be uploaded after the tasks completes, regardless of the value of the exit code.</span></span> 

`uploadCondition: OutputFileUploadCondition.TaskCompletion`

<span data-ttu-id="5be1d-160">Para otras configuraciones, consulte la enumeración [OutputFileUploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.common.outputfileuploadcondition).</span><span class="sxs-lookup"><span data-stu-id="5be1d-160">For other settings, see the [OutputFileUploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.common.outputfileuploadcondition) enum.</span></span>

### <a name="disambiguate-files-with-the-same-name"></a><span data-ttu-id="5be1d-161">Distinción entre archivos con el mismo nombre</span><span class="sxs-lookup"><span data-stu-id="5be1d-161">Disambiguate files with the same name</span></span>

<span data-ttu-id="5be1d-162">Las tareas de un trabajo pueden producir archivos que tienen el mismo nombre.</span><span class="sxs-lookup"><span data-stu-id="5be1d-162">The tasks in a job may produce files that have the same name.</span></span> <span data-ttu-id="5be1d-163">Por ejemplo, `stdout.txt` y `stderr.txt` se crean para todas las tareas que se ejecutan en un trabajo.</span><span class="sxs-lookup"><span data-stu-id="5be1d-163">For example, `stdout.txt` and `stderr.txt` are created for every task that runs in a job.</span></span> <span data-ttu-id="5be1d-164">Como cada tarea se ejecuta en su propio contexto, estos archivos no están en conflicto en el sistema de archivos del nodo.</span><span class="sxs-lookup"><span data-stu-id="5be1d-164">Because each task runs in its own context, these files don't conflict on the node's file system.</span></span> <span data-ttu-id="5be1d-165">Sin embargo, al cargar archivos de varias tareas en un contenedor compartido, debe realizar la distinción de los archivos con el mismo nombre.</span><span class="sxs-lookup"><span data-stu-id="5be1d-165">However, when you upload files from multiple tasks to a shared container, you'll need to disambiguate files with the same name.</span></span>

<span data-ttu-id="5be1d-166">La propiedad [OutputFileBlobContainerDestination.Path](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination.path#Microsoft_Azure_Batch_OutputFileBlobContainerDestination_Path) especifica el blob de destino o directorio virtual para los archivos de salida.</span><span class="sxs-lookup"><span data-stu-id="5be1d-166">The [OutputFileBlobContainerDestination.Path](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination.path#Microsoft_Azure_Batch_OutputFileBlobContainerDestination_Path) property specifies the destination blob or virtual directory for output files.</span></span> <span data-ttu-id="5be1d-167">Puede usar la propiedad **Path** para dar nombre al blob o directorio virtual de tal manera que los archivos de salida con el mismo nombre reciban un nombre único en Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="5be1d-167">You can use the **Path** property to name the blob or virtual directory in such a way that output files with the same name are uniquely named in Azure Storage.</span></span> <span data-ttu-id="5be1d-168">El uso del identificador de la tarea en la ruta es una buena manera de asegurarse nombres únicos y una fácil identificación de los archivos.</span><span class="sxs-lookup"><span data-stu-id="5be1d-168">Using the task ID in the path is a good way to ensure unique names and easily identify files.</span></span>

<span data-ttu-id="5be1d-169">Si la propiedad **FilePattern** está establecida en una expresión comodín, se cargarán todos los archivos que coincidan con el patrón en el directorio virtual especificado en la propiedad **Path**.</span><span class="sxs-lookup"><span data-stu-id="5be1d-169">If the **FilePattern** property is set to a wildcard expression, then all files that match the pattern are uploaded to the virtual directory specified by the **Path** property.</span></span> <span data-ttu-id="5be1d-170">Por ejemplo, si el contenedor es `mycontainer`, el identificador de la tarea es `mytask` y el patrón de archivo es `..\std*.txt`, los identificadores URI absolutos de los archivos de salida de Azure Storage serán similares a este:</span><span class="sxs-lookup"><span data-stu-id="5be1d-170">For example, if the container is `mycontainer`, the task ID is `mytask`, and the file pattern is `..\std*.txt`, then the absolute URIs to the output files in Azure Storage will be similar to:</span></span>

```
https://myaccount.blob.core.windows.net/mycontainer/mytask/stderr.txt
https://myaccount.blob.core.windows.net/mycontainer/mytask/stdout.txt
```

<span data-ttu-id="5be1d-171">Si la propiedad **FilePattern** se establece para que coincida con un único nombre de archivo, lo que implica que no contiene caracteres comodín, el valor de la propiedad **Path** especifica el nombre completo del blob.</span><span class="sxs-lookup"><span data-stu-id="5be1d-171">If the **FilePattern** property is set to match a single file name, meaning it does not contain any wildcard characters, then the value of the **Path** property specifies the fully qualified blob name.</span></span> <span data-ttu-id="5be1d-172">Si prevé conflictos de nomenclatura con un único archivo de varias tareas, incluya el nombre del directorio virtual como parte del nombre de archivo para distinguir entre esos archivos.</span><span class="sxs-lookup"><span data-stu-id="5be1d-172">If you anticipate naming conflicts with a single file from multiple tasks, then include the name of the virtual directory as part of the file name to disambiguate those files.</span></span> <span data-ttu-id="5be1d-173">Por ejemplo, establezca la propiedad **Path** para que incluya el identificador de tarea, el carácter delimitador (normalmente una barra diagonal) y el nombre de archivo:</span><span class="sxs-lookup"><span data-stu-id="5be1d-173">For example, set the **Path** property to include the task ID, the delimiter character (typically a forward slash), and the file name:</span></span>

`path: taskId + @"/output.txt"`

<span data-ttu-id="5be1d-174">Los identificadores URI absolutos de los archivos de salida de un conjunto de tareas serán parecidos a:</span><span class="sxs-lookup"><span data-stu-id="5be1d-174">The absolute URIs to the output files for a set of tasks will be similar to:</span></span>

```
https://myaccount.blob.core.windows.net/mycontainer/task1/output.txt
https://myaccount.blob.core.windows.net/mycontainer/task2/output.txt
```

<span data-ttu-id="5be1d-175">Para más información acerca de los directorios virtuales de Azure Storage, consulte [Enumerar los blobs de un contenedor](../storage/blobs/storage-dotnet-how-to-use-blobs.md#list-the-blobs-in-a-container).</span><span class="sxs-lookup"><span data-stu-id="5be1d-175">For more information about virtual directories in Azure Storage, see [List the blobs in a container](../storage/blobs/storage-dotnet-how-to-use-blobs.md#list-the-blobs-in-a-container).</span></span>


## <a name="diagnose-file-upload-errors"></a><span data-ttu-id="5be1d-176">Diagnóstico de errores de carga de archivos</span><span class="sxs-lookup"><span data-stu-id="5be1d-176">Diagnose file upload errors</span></span>

<span data-ttu-id="5be1d-177">Si se produce un error en la carga de archivos de salida en Azure Storage, la tarea pasa al estado **Completado** y se establece la propiedad [TaskExecutionInformation.FailureInformation](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.taskexecutioninformation.failureinformation#Microsoft_Azure_Batch_TaskExecutionInformation_FailureInformation).</span><span class="sxs-lookup"><span data-stu-id="5be1d-177">If uploading output files to Azure Storage fails, then the task moves to the **Completed** state and the [TaskExecutionInformation.FailureInformation](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.taskexecutioninformation.failureinformation#Microsoft_Azure_Batch_TaskExecutionInformation_FailureInformation) property is set.</span></span> <span data-ttu-id="5be1d-178">Examine la propiedad **FailureInformation** para determinar cuál fue el error.</span><span class="sxs-lookup"><span data-stu-id="5be1d-178">Examine the **FailureInformation** property to determine what error occurred.</span></span> <span data-ttu-id="5be1d-179">Por ejemplo, este es un error que se produce en la carga de archivos si no se puede encontrar el contenedor:</span><span class="sxs-lookup"><span data-stu-id="5be1d-179">For example, here is an error that occurs on file upload if the container cannot be found:</span></span> 

```
Category: UserError
Code: FileUploadContainerNotFound
Message: One of the specified Azure container(s) was not found while attempting to upload an output file
```

<span data-ttu-id="5be1d-180">En cada carga de archivos, Batch escribe dos archivos de registro en el nodo de proceso, `fileuploadout.txt` y `fileuploaderr.txt`.</span><span class="sxs-lookup"><span data-stu-id="5be1d-180">On every file upload, Batch writes two log files to the compute node, `fileuploadout.txt` and `fileuploaderr.txt`.</span></span> <span data-ttu-id="5be1d-181">Puede examinar estos archivos de registro para obtener más información sobre un error específico.</span><span class="sxs-lookup"><span data-stu-id="5be1d-181">You can examine these log files to learn more about a specific failure.</span></span> <span data-ttu-id="5be1d-182">En aquellos casos en los que la carga de archivos nunca llegó a comenzar, por ejemplo, porque no se pudo ejecutar la tarea propiamente dicha, estos archivos de registro no existen.</span><span class="sxs-lookup"><span data-stu-id="5be1d-182">In cases where the file upload was never attempted, for example because the task itself couldn’t run, then these log files will not exist.</span></span>

## <a name="diagnose-file-upload-performance"></a><span data-ttu-id="5be1d-183">Diagnóstico del rendimiento de la carga de archivos</span><span class="sxs-lookup"><span data-stu-id="5be1d-183">Diagnose file upload performance</span></span>

<span data-ttu-id="5be1d-184">El archivo `fileuploadout.txt` registra el progreso de la carga.</span><span class="sxs-lookup"><span data-stu-id="5be1d-184">The `fileuploadout.txt` file logs upload progress.</span></span> <span data-ttu-id="5be1d-185">Puede examinar este archivo para obtener más información acerca de cuánto tiempo tardan los archivos en cargarse.</span><span class="sxs-lookup"><span data-stu-id="5be1d-185">You can examine this file to learn more about how long your file uploads are taking.</span></span> <span data-ttu-id="5be1d-186">Tenga en cuenta que hay muchos factores que influyen en el rendimiento de carga como, por ejemplo, el tamaño del nodo, otra actividad del nodo en el momento de la carga, si el contenedor de destino está en la misma región que el grupo de Batch, cuántos nodos están cargando archivos en la cuenta de almacenamiento al mismo tiempo, etc.</span><span class="sxs-lookup"><span data-stu-id="5be1d-186">Keep in mind that there are many contributing factors to upload performance, including the size of the node, other activity on the node at the time of the upload, whether the target container is in the same region as the Batch pool, how many nodes are uploading to the storage account at the same time, and so on.</span></span>

## <a name="use-the-batch-service-api-with-the-batch-file-conventions-standard"></a><span data-ttu-id="5be1d-187">Uso de la API del servicio Batch con el estándar de convenciones de archivo de Batch</span><span class="sxs-lookup"><span data-stu-id="5be1d-187">Use the Batch service API with the Batch File Conventions standard</span></span>

<span data-ttu-id="5be1d-188">Cuando guarda la salida de la tarea con la API del servicio Batch, puede asignar el nombre que desee al contenedor y a los blobs de destino.</span><span class="sxs-lookup"><span data-stu-id="5be1d-188">When you persist task output with the Batch service API, you can name your destination container and blobs however you like.</span></span> <span data-ttu-id="5be1d-189">También puede decidir asignarles un nombre conforme al [estándar de convenciones de archivo de Batch](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span><span class="sxs-lookup"><span data-stu-id="5be1d-189">You can also choose to name them according to the [Batch File Conventions standard](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span></span> <span data-ttu-id="5be1d-190">El estándar de convenciones de archivos determina los nombres del contenedor de destino y el blob en Azure Storage para un archivo de salida dado según los nombres del trabajo y de la tarea.</span><span class="sxs-lookup"><span data-stu-id="5be1d-190">The File Conventions standard determines the names of the destination container and blob in Azure Storage for a given output file based on the names of the job and task.</span></span> <span data-ttu-id="5be1d-191">Si usa el estándar de convenciones de archivos para la denominación de archivos de salida, estos se podrán ver en [Azure Portal](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="5be1d-191">If you do use the File Conventions standard for naming output files, then your output files are available for viewing in the [Azure portal](https://portal.azure.com).</span></span>

<span data-ttu-id="5be1d-192">Si va a desarrollar con C#, puede usar los métodos integrados en la [biblioteca de convenciones de archivo para .NET de Batch](https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files).</span><span class="sxs-lookup"><span data-stu-id="5be1d-192">If you are developing in C#, you can use the methods built into the [Batch File Conventions library for .NET](https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files).</span></span> <span data-ttu-id="5be1d-193">Esta biblioteca crea los contenedores y las rutas de acceso de blobs con los nombres correctos.</span><span class="sxs-lookup"><span data-stu-id="5be1d-193">This library creates the properly named containers and blob paths for you.</span></span> <span data-ttu-id="5be1d-194">Por ejemplo, puede llamar a la API para obtener el nombre correcto del contenedor, basándose en el nombre del trabajo:</span><span class="sxs-lookup"><span data-stu-id="5be1d-194">For example, you can call the API to get the correct name for the container, based on the job name:</span></span>

```csharp
string containerName = job.OutputStorageContainerName();
```

<span data-ttu-id="5be1d-195">Puede usar el método [CloudJobExtensions.GetOutputStorageContainerUrl](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.conventions.files.cloudjobextensions.getoutputstoragecontainerurl) para devolver una URL de firma de acceso compartido (SAS) que se utiliza para escribir en el contenedor.</span><span class="sxs-lookup"><span data-stu-id="5be1d-195">You can use the [CloudJobExtensions.GetOutputStorageContainerUrl](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.conventions.files.cloudjobextensions.getoutputstoragecontainerurl) method to return a shared access signature (SAS) URL that is used to write to the container.</span></span> <span data-ttu-id="5be1d-196">A continuación, puede pasar esta SAS al constructor [OutputFileBlobContainerDestination](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination).</span><span class="sxs-lookup"><span data-stu-id="5be1d-196">You can then pass this SAS to the [OutputFileBlobContainerDestination](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination) constructor.</span></span>

<span data-ttu-id="5be1d-197">Si va a desarrollar con un lenguaje distinto de C#, tendrá que implementar el estándar de convenciones de archivos usted mismo.</span><span class="sxs-lookup"><span data-stu-id="5be1d-197">If you are developing in a language other than C#, you will need to implement the File Conventions standard yourself.</span></span>

## <a name="code-sample"></a><span data-ttu-id="5be1d-198">Código de ejemplo</span><span class="sxs-lookup"><span data-stu-id="5be1d-198">Code sample</span></span>

<span data-ttu-id="5be1d-199">El proyecto de ejemplo [PersistOutputs][github_persistoutputs] es uno de los ejemplos de código de [Azure Batch][github_samples] de GitHub.</span><span class="sxs-lookup"><span data-stu-id="5be1d-199">The [PersistOutputs][github_persistoutputs] sample project is one of the [Azure Batch code samples][github_samples] on GitHub.</span></span> <span data-ttu-id="5be1d-200">Esta solución de Visual Studio muestra cómo utilizar la biblioteca de cliente para .NET de Azure Batch para guardar la salida de las tareas en un almacenamiento duradero.</span><span class="sxs-lookup"><span data-stu-id="5be1d-200">This Visual Studio solution demonstrates how to use the Batch client library for .NET to persist task output to durable storage.</span></span> <span data-ttu-id="5be1d-201">Para ejecutar el ejemplo, siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="5be1d-201">To run the sample, follow these steps:</span></span>

1. <span data-ttu-id="5be1d-202">Abra el proyecto en **Visual Studio 2015 o una versión más reciente**.</span><span class="sxs-lookup"><span data-stu-id="5be1d-202">Open the project in **Visual Studio 2015 or newer**.</span></span>
2. <span data-ttu-id="5be1d-203">Agregue las **credenciales de cuenta** de Batch y Storage a **AccountSettings.settings** al proyecto Microsoft.Azure.Batch.Samples.Common.</span><span class="sxs-lookup"><span data-stu-id="5be1d-203">Add your Batch and Storage **account credentials** to **AccountSettings.settings** in the Microsoft.Azure.Batch.Samples.Common project.</span></span>
3. <span data-ttu-id="5be1d-204">**Compile** (pero no ejecute) la solución.</span><span class="sxs-lookup"><span data-stu-id="5be1d-204">**Build** (but do not run) the solution.</span></span> <span data-ttu-id="5be1d-205">Si se le solicita, restaure los paquetes NuGet.</span><span class="sxs-lookup"><span data-stu-id="5be1d-205">Restore any NuGet packages if prompted.</span></span>
4. <span data-ttu-id="5be1d-206">Use el Portal de Azure para cargar un [paquete de aplicación](batch-application-packages.md) para **PersistOutputsTask**.</span><span class="sxs-lookup"><span data-stu-id="5be1d-206">Use the Azure portal to upload an [application package](batch-application-packages.md) for **PersistOutputsTask**.</span></span> <span data-ttu-id="5be1d-207">Incluya el archivo `PersistOutputsTask.exe` y los ensamblados dependientes en el paquete zip, establezca el identificador de la aplicación en "PersistOutputsTask" y la versión del paquete de aplicación en "1.0".</span><span class="sxs-lookup"><span data-stu-id="5be1d-207">Include the `PersistOutputsTask.exe` and its dependent assemblies in the .zip package, set the application ID to "PersistOutputsTask", and the application package version to "1.0".</span></span>
5. <span data-ttu-id="5be1d-208">**Inicie** (ejecute) el proyecto**PersistOutputs**.</span><span class="sxs-lookup"><span data-stu-id="5be1d-208">**Start** (run) the **PersistOutputs** project.</span></span>
6. <span data-ttu-id="5be1d-209">Cuando se le solicite que elija la tecnología de guardado que desea usar para ejecutar el ejemplo, escriba **2** si desea ejecutarlo mediante la API del servicio Batch para guardar la salida de la tarea.</span><span class="sxs-lookup"><span data-stu-id="5be1d-209">When prompted to choose the persistence technology to use for running the sample, enter **2** to run the sample using the Batch service API to persist task output.</span></span>
7. <span data-ttu-id="5be1d-210">Si lo desea, ejecute el ejemplo de nuevo, y escriba **3** para guardar la salida con la API del servicio Batch y asignar nombre al contenedor de destino y a la ruta del blob según el estándar de convenciones de archivos.</span><span class="sxs-lookup"><span data-stu-id="5be1d-210">If desired, run the sample again, entering **3** to persist output with the Batch service API, and also to name the destination container and blob path according to the File Conventions standard.</span></span>

## <a name="next-steps"></a><span data-ttu-id="5be1d-211">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="5be1d-211">Next steps</span></span>

- <span data-ttu-id="5be1d-212">Para más información sobre el almacenamiento de salidas de tareas con la biblioteca File Conventions para .NET, consulte [Persist job and task data to Azure Storage with the Batch File Conventions library for .NET to persist ](batch-task-output-file-conventions.md) (Almacenamiento de datos de trabajos y tareas en Azure Storage con la biblioteca Batch File Conventions para .NET para conservarlos).</span><span class="sxs-lookup"><span data-stu-id="5be1d-212">For more information on persisting task output with the File Conventions library for .NET, see [Persist job and task data to Azure Storage with the Batch File Conventions library for .NET to persist ](batch-task-output-file-conventions.md).</span></span>
- <span data-ttu-id="5be1d-213">Para más información sobre otros métodos para guardar la salida de tareas en Azure Batch, consulte [Guardar salidas de trabajos y tareas en Azure Storage](batch-task-output.md).</span><span class="sxs-lookup"><span data-stu-id="5be1d-213">For information on other approaches for persisting output data in Azure Batch, see [Persist job and task output to Azure Storage](batch-task-output.md).</span></span>

[github_persistoutputs]: https://github.com/Azure/azure-batch-samples/tree/master/CSharp/ArticleProjects/PersistOutputs
[github_samples]: https://github.com/Azure/azure-batch-samples

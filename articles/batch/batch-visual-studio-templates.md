---
title: Empezar a crear soluciones de Batch con plantillas de proyecto de Visual Studio - Azure | Microsoft Docs
description: "Descubra cómo las plantillas de proyecto de Visual Studio pueden ayudarlo a implementar y ejecutar cargas de trabajo de proceso intensivo en Azure Batch."
services: batch
documentationcenter: .net
author: fayora
manager: timlt
editor: 
ms.assetid: 5e041ae2-25af-4882-a79e-3aa63c4bfb20
ms.service: batch
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: big-compute
ms.date: 02/27/2017
ms.author: tamram
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: da77ce827c65deb18d9d84ce5cf768d89788e205
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="use-visual-studio-project-templates-to-jump-start-batch-solutions"></a><span data-ttu-id="b3b1b-103">Uso de plantillas de proyecto de Visual Studio para empezar a crear soluciones de Batch</span><span class="sxs-lookup"><span data-stu-id="b3b1b-103">Use Visual Studio project templates to jump-start Batch solutions</span></span>

<span data-ttu-id="b3b1b-104">Las **plantillas de Visual Studio para el administrador de trabajos**y el **procesador de tareas** para Batch proporcionan código para ayudar a implementar y ejecutar las cargas de trabajo de proceso intensivo en Batch con el mínimo esfuerzo.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-104">The **Job Manager** and **Task Processor Visual Studio templates** for Batch provide code to help you to implement and run your compute-intensive workloads on Batch with the least amount of effort.</span></span> <span data-ttu-id="b3b1b-105">En este documento se describen estas plantillas y se proporcionan instrucciones para utilizarlas.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-105">This document describes these templates and provides guidance for how to use them.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b3b1b-106">En este artículo se describe solo información aplicable a estas dos plantillas, y se supone que está familiarizado con el servicio Batch y con los conceptos clave relacionados con él: grupos, nodos de proceso, trabajos y tareas, tareas del administrador de trabajos, variables de entorno y otra información pertinente.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-106">This article discusses only information applicable to these two templates, and assumes that you are familiar with the Batch service and key concepts related to it: pools, compute nodes, jobs and tasks, job manager tasks, environment variables, and other relevant information.</span></span> <span data-ttu-id="b3b1b-107">Puede encontrar más información en [Datos básicos de Azure Batch](batch-technical-overview.md), [Información general de las características de Batch para desarrolladores](batch-api-basics.md) e [Introducción a la biblioteca de Azure Batch para .NET](batch-dotnet-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="b3b1b-107">You can find more information in [Basics of Azure Batch](batch-technical-overview.md), [Batch feature overview for developers](batch-api-basics.md), and [Get started with the Azure Batch library for .NET](batch-dotnet-get-started.md).</span></span>
> 
> 

## <a name="high-level-overview"></a><span data-ttu-id="b3b1b-108">Información general de alto nivel</span><span class="sxs-lookup"><span data-stu-id="b3b1b-108">High-level overview</span></span>
<span data-ttu-id="b3b1b-109">Las plantillas del administrador de trabajos y del procesador de tareas pueden utilizarse para crear dos componentes útiles:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-109">The Job Manager and Task Processor templates can be used to create two useful components:</span></span>

* <span data-ttu-id="b3b1b-110">Una tarea del administrador de trabajos que implementa un separador de trabajo que puede desglosar un trabajo en varias tareas que se pueden ejecutar de forma independiente, en paralelo.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-110">A job manager task that implements a job splitter that can break a job down into multiple tasks that can run independently, in parallel.</span></span>
* <span data-ttu-id="b3b1b-111">Un procesador de tareas que puede utilizarse para realizar un procesamiento previo y posterior alrededor de una línea de comandos de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-111">A task processor that can be used to perform pre-processing and post-processing around an application command line.</span></span>

<span data-ttu-id="b3b1b-112">Por ejemplo, en un escenario de representación de película, el separador de trabajos podría convertir un trabajo de película único en cientos o miles de tareas independientes que procesan los fotogramas individuales por separado.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-112">For example, in a movie rendering scenario, the job splitter would turn a single movie job into hundreds or thousands of separate tasks that would process individual frames separately.</span></span> <span data-ttu-id="b3b1b-113">En consecuencia, el procesador de tareas podría invocar la aplicación de representación y todos los procesos dependientes que se necesitan para representar cada fotograma, así como realizar acciones adicionales (por ejemplo, copiar el fotograma representado en una ubicación de almacenamiento).</span><span class="sxs-lookup"><span data-stu-id="b3b1b-113">Correspondingly, the task processor would invoke the rendering application and all dependent processes that are needed to render each frame, as well as perform any additional actions (for example, copying the rendered frame to a storage location).</span></span>

> [!NOTE]
> <span data-ttu-id="b3b1b-114">Las plantillas del administrador de trabajos y del procesador de tareas son independientes entre sí, por lo que puede elegir usar ambas, o solo una de ellas, dependiendo de los requisitos del trabajo de proceso y de las preferencias.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-114">The Job Manager and Task Processor templates are independent of each other, so you can choose to use both, or only one of them, depending on the requirements of your compute job and on your preferences.</span></span>
> 
> 

<span data-ttu-id="b3b1b-115">Como se muestra en el diagrama siguiente, un trabajo de proceso que usa estas plantillas pasará por tres fases:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-115">As shown in the diagram below, a compute job that uses these templates will go through three stages:</span></span>

1. <span data-ttu-id="b3b1b-116">El código de cliente (por ejemplo, aplicación, servicio web, etc.) envía un trabajo al servicio Azure Batch, en el que se especifica el programa de administrador de trabajos como la tarea del administrador de trabajos.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-116">The client code (e.g., application, web service, etc.) submits a job to the Batch service on Azure, specifying as its job manager task the job manager program.</span></span>
2. <span data-ttu-id="b3b1b-117">El servicio Batch ejecuta la tarea del administrador de trabajos en un nodo de ejecución, y el separador de trabajos inicia el número especificado de las tareas del procesador de tareas, en tantos nodos de proceso como sea necesario, según los parámetros y las especificaciones del código del separador de trabajos.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-117">The Batch service runs the job manager task on a compute node and the job splitter launches the specified number of task processor tasks, on as many compute nodes as required, based on the parameters and specifications in the job splitter code.</span></span>
3. <span data-ttu-id="b3b1b-118">Las tareas del procesador de tareas se ejecutan de forma independiente, en paralelo, para procesar los datos de entrada y generar los datos de salida.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-118">The task processor tasks run independently, in parallel, to process the input data and generate the output data.</span></span>

![Diagrama que muestra cómo interactúa el código de cliente con el servicio Batch][diagram01]

## <a name="prerequisites"></a><span data-ttu-id="b3b1b-120">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="b3b1b-120">Prerequisites</span></span>
<span data-ttu-id="b3b1b-121">Para utilizar las plantillas de Batch, necesita lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-121">To use the Batch templates, you will need the following:</span></span>

* <span data-ttu-id="b3b1b-122">Un equipo con Visual Studio 2015 instalado.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-122">A computer with Visual Studio 2015 installed.</span></span> <span data-ttu-id="b3b1b-123">Las plantillas de proceso por lotes solo se admiten actualmente para Visual Studio 2015.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-123">Batch templates are currently only supported for Visual Studio 2015.</span></span>
* <span data-ttu-id="b3b1b-124">Las plantillas de Batch, que están disponibles en la [Galería de Visual Studio][vs_gallery] como extensiones de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-124">The Batch templates, which are available from the [Visual Studio Gallery][vs_gallery] as Visual Studio extensions.</span></span> <span data-ttu-id="b3b1b-125">Las plantillas se pueden obtener de dos formas:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-125">There are two ways to get the templates:</span></span>
  
  * <span data-ttu-id="b3b1b-126">Instale las plantillas con el cuadro de diálogo **Extensiones y actualizaciones** de Visual Studio (para obtener más información, vea [Buscar y usar extensiones de Visual Studio][vs_find_use_ext]).</span><span class="sxs-lookup"><span data-stu-id="b3b1b-126">Install the templates using the **Extensions and Updates** dialog box in Visual Studio (for more information, see [Finding and Using Visual Studio Extensions][vs_find_use_ext]).</span></span> <span data-ttu-id="b3b1b-127">En el cuadro de diálogo **Extensiones y actualizaciones** , busque y descargue las dos extensiones siguientes:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-127">In the **Extensions and Updates** dialog box, search and download the following two extensions:</span></span>
    
    * <span data-ttu-id="b3b1b-128">Administrador de trabajos de Azure Batch con separador de trabajos</span><span class="sxs-lookup"><span data-stu-id="b3b1b-128">Azure Batch Job Manager with Job Splitter</span></span>
    * <span data-ttu-id="b3b1b-129">Procesador de tareas de Azure Batch</span><span class="sxs-lookup"><span data-stu-id="b3b1b-129">Azure Batch Task Processor</span></span>
  * <span data-ttu-id="b3b1b-130">Descargue las plantillas de la galería en línea para Visual Studio: [plantillas de proyecto de Microsoft Azure Batch][vs_gallery_templates]</span><span class="sxs-lookup"><span data-stu-id="b3b1b-130">Download the templates from the online gallery for Visual Studio: [Microsoft Azure Batch Project Templates][vs_gallery_templates]</span></span>
* <span data-ttu-id="b3b1b-131">Si piensa utilizar la característica [Paquetes de aplicación](batch-application-packages.md) para implementar el administrador de trabajos y el procesador de tareas en los nodos de proceso de Batch, debe vincular una cuenta de almacenamiento a la cuenta de Batch.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-131">If you plan to use the [Application Packages](batch-application-packages.md) feature to deploy the job manager and task processor to the Batch compute nodes, you need to link a storage account to your Batch account.</span></span>

## <a name="preparation"></a><span data-ttu-id="b3b1b-132">Preparación</span><span class="sxs-lookup"><span data-stu-id="b3b1b-132">Preparation</span></span>
<span data-ttu-id="b3b1b-133">Se recomienda crear una solución que puede contener el administrador de trabajos, así como el procesador de tareas, ya que esto puede facilitar el uso compartido de código entre el administrador de trabajos y los programas de procesador de tareas.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-133">We recommend creating a solution that can contain your job manager as well as your task processor, because this can make it easier to share code between your job manager and task processor programs.</span></span> <span data-ttu-id="b3b1b-134">Para crear esta solución, siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-134">To create this solution, follow these steps:</span></span>

1. <span data-ttu-id="b3b1b-135">Abra Visual Studio, seleccione **Archivo** > **Nuevo** > **Proyecto**.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-135">Open Visual Studio and select **File** > **New** > **Project**.</span></span>
2. <span data-ttu-id="b3b1b-136">En **Plantillas**, expanda **Otros tipos de proyectos**, haga clic en **Soluciones de Visual Studio** y, luego, seleccione **Solución en blanco**.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-136">Under **Templates**, expand **Other Project Types**, click **Visual Studio Solutions**, and then select **Blank Solution**.</span></span>
3. <span data-ttu-id="b3b1b-137">Escriba un nombre que describa la aplicación y el propósito de esta solución (por ejemplo, "LitwareBatchTaskPrograms").</span><span class="sxs-lookup"><span data-stu-id="b3b1b-137">Type a name that describes your application and the purpose of this solution (e.g., "LitwareBatchTaskPrograms").</span></span>
4. <span data-ttu-id="b3b1b-138">Para crear una solución nueva, haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-138">To create the new solution, click **OK**.</span></span>

## <a name="job-manager-template"></a><span data-ttu-id="b3b1b-139">Plantilla del administrador de trabajos</span><span class="sxs-lookup"><span data-stu-id="b3b1b-139">Job Manager template</span></span>
<span data-ttu-id="b3b1b-140">La plantilla del administrador de trabajos ayuda a implementar una tarea del administrador de trabajos que puede realizar las siguientes acciones:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-140">The Job Manager template helps you to implement a job manager task that can perform the following actions:</span></span>

* <span data-ttu-id="b3b1b-141">Separar un trabajo en varias tareas.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-141">Split a job into multiple tasks.</span></span>
* <span data-ttu-id="b3b1b-142">Enviar esas tareas para ejecutarlas en Batch.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-142">Submit those tasks to run on Batch.</span></span>

> [!NOTE]
> <span data-ttu-id="b3b1b-143">Para obtener más información sobre las tareas del administrador de trabajos, vea [Información general de las características de Batch para desarrolladores](batch-api-basics.md#job-manager-task).</span><span class="sxs-lookup"><span data-stu-id="b3b1b-143">For more information about job manager tasks, see [Batch feature overview for developers](batch-api-basics.md#job-manager-task).</span></span>
> 
> 

### <a name="create-a-job-manager-using-the-template"></a><span data-ttu-id="b3b1b-144">Creación de un administrador de trabajos con la plantilla</span><span class="sxs-lookup"><span data-stu-id="b3b1b-144">Create a Job Manager using the template</span></span>
<span data-ttu-id="b3b1b-145">Para agregar un administrador de trabajos a la solución creada anteriormente, siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-145">To add a job manager to the solution that you created earlier, follow these steps:</span></span>

1. <span data-ttu-id="b3b1b-146">Abra la solución existente en Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-146">Open your existing solution in Visual Studio.</span></span>
2. <span data-ttu-id="b3b1b-147">En el Explorador de soluciones, haga clic con el botón derecho en la solución y seleccione **Agregar** > **Nuevo proyecto**.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-147">In Solution Explorer, right-click the solution, click **Add** > **New Project**.</span></span>
3. <span data-ttu-id="b3b1b-148">En **Visual C#**, haga clic en **Nube** y, luego, haga clic en **Administrador de trabajos de Azure Batch con separador de trabajos**.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-148">Under **Visual C#**, click **Cloud**, and then click **Azure Batch Job Manager with Job Splitter**.</span></span>
4. <span data-ttu-id="b3b1b-149">Escriba un nombre que describe la aplicación e identifica este proyecto como el administrador de trabajos (p. ej., "LitwareJobManager").</span><span class="sxs-lookup"><span data-stu-id="b3b1b-149">Type a name that describes your application and identifies this project as the job manager (e.g. "LitwareJobManager").</span></span>
5. <span data-ttu-id="b3b1b-150">Para crear el proyecto, haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-150">To create the project, click **OK**.</span></span>
6. <span data-ttu-id="b3b1b-151">Por último, compile el proyecto para obligar a Visual Studio a cargar todos los paquetes NuGet a que se hace referencia y comprobar que es válido el proyecto antes de comenzar a modificarlo.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-151">Finally, build the project to force Visual Studio to load all referenced NuGet packages and to verify that the project is valid before you start modifying it.</span></span>

### <a name="job-manager-template-files-and-their-purpose"></a><span data-ttu-id="b3b1b-152">Archivos de plantilla del administrador de trabajos y su propósito</span><span class="sxs-lookup"><span data-stu-id="b3b1b-152">Job Manager template files and their purpose</span></span>
<span data-ttu-id="b3b1b-153">Cuando se crea un proyecto mediante la plantilla del administrador de trabajos, genera tres grupos de archivos de código:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-153">When you create a project using the Job Manager template, it generates three groups of code files:</span></span>

* <span data-ttu-id="b3b1b-154">El archivo de programa principal (Program.cs).</span><span class="sxs-lookup"><span data-stu-id="b3b1b-154">The main program file (Program.cs).</span></span> <span data-ttu-id="b3b1b-155">Contiene el punto de entrada del programa y el control de excepciones de nivel superior.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-155">This contains the program entry point and top-level exception handling.</span></span> <span data-ttu-id="b3b1b-156">Normalmente no es necesario modificar esto.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-156">You shouldn't normally need to modify this.</span></span>
* <span data-ttu-id="b3b1b-157">El directorio Framework.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-157">The Framework directory.</span></span> <span data-ttu-id="b3b1b-158">Contiene los archivos responsables del trabajo “reutilizable” realizado por el programa del administrador de trabajos: desempaquetar parámetros, agregar tareas al trabajo de Batch, etc. Normalmente no es necesario modificar estos archivos.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-158">This contains the files responsible for the 'boilerplate' work done by the job manager program – unpacking parameters, adding tasks to the Batch job, etc. You shouldn't normally need to modify these files.</span></span>
* <span data-ttu-id="b3b1b-159">El archivo separador de trabajos (JobSplitter.cs).</span><span class="sxs-lookup"><span data-stu-id="b3b1b-159">The job splitter file (JobSplitter.cs).</span></span> <span data-ttu-id="b3b1b-160">Aquí es donde colocará la lógica específica de la aplicación para separar un trabajo en tareas.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-160">This is where you will put your application-specific logic for splitting a job into tasks.</span></span>

<span data-ttu-id="b3b1b-161">Por supuesto puede agregar archivos adicionales según sea necesario para admitir el código del separador de trabajos, según la complejidad de la lógica de separación de trabajos.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-161">Of course you can add additional files as required to support your job splitter code, depending on the complexity of the job splitting logic.</span></span>

<span data-ttu-id="b3b1b-162">La plantilla también genera archivos de proyecto estándar de .NET como un archivo .csproj, app.config, packages.config, etc.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-162">The template also generates standard .NET project files such as a .csproj file, app.config, packages.config, etc.</span></span>

<span data-ttu-id="b3b1b-163">En el resto de esta sección se describen los diferentes archivos y su estructura de código y, además, se explica lo que hace cada clase.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-163">The rest of this section describes the different files and their code structure, and explains what each class does.</span></span>

![Explorador de soluciones de Visual Studio que muestra la solución de la plantilla del administrador de trabajos][solution_explorer01]

<span data-ttu-id="b3b1b-165">**Archivos de Framework**</span><span class="sxs-lookup"><span data-stu-id="b3b1b-165">**Framework files**</span></span>

* <span data-ttu-id="b3b1b-166">`Configuration.cs`: encapsula la carga de datos de configuración de trabajos, como los detalles de la cuenta de Batch, las credenciales de la cuenta de almacenamiento vinculada, la información sobre el trabajo y la tarea y los parámetros del trabajo.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-166">`Configuration.cs`: Encapsulates the loading of job configuration data such as Batch account details, linked storage account credentials, job and task information, and job parameters.</span></span> <span data-ttu-id="b3b1b-167">También proporciona acceso a las variables de entorno definidas por Batch (vea Configuración del entorno para las tareas, en la documentación de Batch) mediante la clase Configuration.EnvironmentVariable.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-167">It also provides access to Batch-defined environment variables (see Environment settings for tasks, in the Batch documentation) via the Configuration.EnvironmentVariable class.</span></span>
* <span data-ttu-id="b3b1b-168">`IConfiguration.cs`: abstrae la implementación de la clase de configuración, para que pueda realizar una prueba unitaria del separador de trabajos mediante un objeto de configuración falsa o simulada.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-168">`IConfiguration.cs`: Abstracts the implementation of the Configuration class, so that you can unit test your job splitter using a fake or mock configuration object.</span></span>
* <span data-ttu-id="b3b1b-169">`JobManager.cs`: organiza los componentes del programa del administrador de trabajos.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-169">`JobManager.cs`: Orchestrates the components of the job manager program.</span></span> <span data-ttu-id="b3b1b-170">Es responsable de inicializar el separador de trabajos, invocarlo y enviar las tareas devueltas por el separador de trabajos al remitente de la tarea.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-170">It is responsible for the initializing the job splitter, invoking the job splitter, and dispatching the tasks returned by the job splitter to the task submitter.</span></span>
* <span data-ttu-id="b3b1b-171">`JobManagerException.cs`: representa un error que requiere la terminación del administrador de trabajos.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-171">`JobManagerException.cs`: Represents an error that requires the job manager to terminate.</span></span> <span data-ttu-id="b3b1b-172">JobManagerException se utiliza para ajustar los errores “esperados” donde se puede proporcionar información de diagnóstico específica como parte de la finalización.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-172">JobManagerException is used to wrap 'expected' errors where specific diagnostic information can be provided as part of termination.</span></span>
* <span data-ttu-id="b3b1b-173">`TaskSubmitter.cs`: esta clase es responsable de agregar tareas devueltas por el separador de trabajos al trabajo de Batch.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-173">`TaskSubmitter.cs`: This class is responsible to adding tasks returned by the job splitter to the Batch job.</span></span> <span data-ttu-id="b3b1b-174">La clase JobManager agrega la secuencia de tareas en lotes para la incorporación eficaz pero oportuna al trabajo; luego llama a TaskSubmitter.SubmitTasks en un subproceso en segundo plano para cada lote.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-174">The JobManager class aggregates the sequence of tasks into batches for efficient but timely addition to the job, then calls TaskSubmitter.SubmitTasks on a background thread for each batch.</span></span>

<span data-ttu-id="b3b1b-175">**Separador de trabajos**</span><span class="sxs-lookup"><span data-stu-id="b3b1b-175">**Job Splitter**</span></span>

<span data-ttu-id="b3b1b-176">`JobSplitter.cs`: esta clase contiene la lógica específica de la aplicación para separar el trabajo en tareas.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-176">`JobSplitter.cs`: This class contains application-specific logic for splitting the job into tasks.</span></span> <span data-ttu-id="b3b1b-177">El marco de trabajo invoca el método JobSplitter.Split para obtener una secuencia de tareas, que agrega al trabajo a medida que el método las devuelve.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-177">The framework invokes the JobSplitter.Split method to obtain a sequence of tasks, which it adds to the job as the method returns them.</span></span> <span data-ttu-id="b3b1b-178">Esta es la clase donde se insertará la lógica de su trabajo.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-178">This is the class where you will inject the logic of your job.</span></span> <span data-ttu-id="b3b1b-179">Implemente el método de separación para devolver una secuencia de instancias de CloudTask que representan las tareas en las que desea partir el trabajo.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-179">Implement the Split method to return a sequence of CloudTask instances representing the tasks into which you want to partition the job.</span></span>

<span data-ttu-id="b3b1b-180">**Archivos de proyecto de línea de comandos de .NET estándar**</span><span class="sxs-lookup"><span data-stu-id="b3b1b-180">**Standard .NET command line project files**</span></span>

* <span data-ttu-id="b3b1b-181">`App.config`: archivo de configuración de la aplicación. NET estándar.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-181">`App.config`: Standard .NET application configuration file.</span></span>
* <span data-ttu-id="b3b1b-182">`Packages.config`: archivo de dependencia de paquetes NuGet estándar.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-182">`Packages.config`: Standard NuGet package dependency file.</span></span>
* <span data-ttu-id="b3b1b-183">`Program.cs`: contiene el punto de entrada del programa y el control de excepciones de nivel superior.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-183">`Program.cs`: Contains the program entry point and top-level exception handling.</span></span>

### <a name="implementing-the-job-splitter"></a><span data-ttu-id="b3b1b-184">Implementación del separador de trabajos</span><span class="sxs-lookup"><span data-stu-id="b3b1b-184">Implementing the job splitter</span></span>
<span data-ttu-id="b3b1b-185">Al abrir el proyecto de plantilla del administrador de trabajos, el proyecto tendrá el archivo JobSplitter.cs abierto de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-185">When you open the Job Manager template project, the project will have the JobSplitter.cs file open by default.</span></span> <span data-ttu-id="b3b1b-186">Puede implementar la lógica de separación de las tareas en la carga de trabajo mediante el uso del método Split() siguiente:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-186">You can implement the split logic for the tasks in your workload by using the Split() method show below:</span></span>

```csharp
/// <summary>
/// Gets the tasks into which to split the job. This is where you inject
/// your application-specific logic for decomposing the job into tasks.
///
/// The job manager framework invokes the Split method for you; you need
/// only to implement it, not to call it yourself. Typically, your
/// implementation should return tasks lazily, for example using a C#
/// iterator and the "yield return" statement; this allows tasks to be added
/// and to start running while splitting is still in progress.
/// </summary>
/// <returns>The tasks to be added to the job. Tasks are added automatically
/// by the job manager framework as they are returned by this method.</returns>
public IEnumerable<CloudTask> Split()
{
    // Your code for the split logic goes here.
    int startFrame = Convert.ToInt32(_parameters["StartFrame"]);
    int endFrame = Convert.ToInt32(_parameters["EndFrame"]);

    for (int i = startFrame; i <= endFrame; i++)
    {
        yield return new CloudTask("myTask" + i, "cmd /c dir");
    }
}
```

> [!NOTE]
> <span data-ttu-id="b3b1b-187">La sección anotada en el método `Split()` es la única sección del código de plantilla del administrador de trabajos que está pensada para que se modifique agregando la lógica para separar los trabajos en tareas distintas.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-187">The annotated section in the `Split()` method is the only section of the Job Manager template code that is intended for you to modify by adding the logic to split your jobs into different tasks.</span></span> <span data-ttu-id="b3b1b-188">Si desea modificar una sección diferente de la plantilla, asegúrese de familiarizarse con el funcionamiento de Batch y pruebe algunos de los [ejemplos de código de Batch][github_samples].</span><span class="sxs-lookup"><span data-stu-id="b3b1b-188">If you want to modify a different section of the template, please ensure you are familiarized with how Batch works, and try out a few of the [Batch code samples][github_samples].</span></span>
> 
> 

<span data-ttu-id="b3b1b-189">La implementación de Split() dispone de acceso a:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-189">Your Split() implementation has access to:</span></span>

* <span data-ttu-id="b3b1b-190">Los parámetros de trabajo, a través del campo `_parameters` .</span><span class="sxs-lookup"><span data-stu-id="b3b1b-190">The job parameters, via the `_parameters` field.</span></span>
* <span data-ttu-id="b3b1b-191">El objeto CloudJob que representa el trabajo, a través del campo `_job` .</span><span class="sxs-lookup"><span data-stu-id="b3b1b-191">The CloudJob object representing the job, via the `_job` field.</span></span>
* <span data-ttu-id="b3b1b-192">El objeto CloudTask que representa la tarea del administrador de trabajos, a través del campo `_jobManagerTask` .</span><span class="sxs-lookup"><span data-stu-id="b3b1b-192">The CloudTask object representing the job manager task, via the `_jobManagerTask` field.</span></span>

<span data-ttu-id="b3b1b-193">La implementación de `Split()` no necesita agregar tareas al trabajo directamente.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-193">Your `Split()` implementation does not need to add tasks to the job directly.</span></span> <span data-ttu-id="b3b1b-194">En su lugar, el código debe devolver una secuencia de objetos CloudTask, y se agregarán al trabajo automáticamente mediante las clases de marco de trabajo que invocan el separador de trabajos.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-194">Instead, your code should return a sequence of CloudTask objects, and these will be added to the job automatically by the framework classes that invoke the job splitter.</span></span> <span data-ttu-id="b3b1b-195">Es habitual utilizar la característica del iterador de C# (`yield return`) para implementar los separadores de trabajos, ya que esto permite que las tareas empiecen a ejecutarse lo antes posible, en lugar de esperar a que se calculen todas las tareas.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-195">It's common to use C#'s iterator (`yield return`) feature to implement job splitters as this allows the tasks to start running as soon as possible rather than waiting for all tasks to be calculated.</span></span>

<span data-ttu-id="b3b1b-196">**Error del separador de trabajos**</span><span class="sxs-lookup"><span data-stu-id="b3b1b-196">**Job splitter failure**</span></span>

<span data-ttu-id="b3b1b-197">Si el separador de trabajos detecta un error, debe:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-197">If your job splitter encounters an error, it should either:</span></span>

* <span data-ttu-id="b3b1b-198">Finalizar la secuencia utilizando la instrucción `yield break` de C#, en el caso de que el administrador de trabajos se trate como correcto.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-198">Terminate the sequence using the C# `yield break` statement, in which case the job manager will be treated as successful; or</span></span>
* <span data-ttu-id="b3b1b-199">Producir una excepción, en cuyo caso se contemplarán errores en el administrador de trabajos, que podrá volver a ejecutarse en función de cómo lo haya configurado el cliente.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-199">Throw an exception, in which case the job manager will be treated as failed and may be retried depending on how the client has configured it).</span></span>

<span data-ttu-id="b3b1b-200">En ambos casos, se pueden ejecutar todas las tareas que el separador de trabajos ya haya devuelvo y que se hayan agregado al trabajo de Batch.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-200">In both cases, any tasks already returned by the job splitter and added to the Batch job will be eligible to run.</span></span> <span data-ttu-id="b3b1b-201">Si no desea que esto ocurra, entonces puede:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-201">If you don't want this to happen, then you could:</span></span>

* <span data-ttu-id="b3b1b-202">Finalizar el trabajo antes de abandonar el separador de trabajos</span><span class="sxs-lookup"><span data-stu-id="b3b1b-202">Terminate the job before returning from the job splitter</span></span>
* <span data-ttu-id="b3b1b-203">Fomular la colección de tareas completa antes de devolverla (es decir, devolver `ICollection<CloudTask>` o `IList<CloudTask>` instead of implementing your job splitter using a C# iterato)</span><span class="sxs-lookup"><span data-stu-id="b3b1b-203">Formulate the entire task collection before returning it (that is, return an `ICollection<CloudTask>` or `IList<CloudTask>` instead of implementing your job splitter using a C# iterator)</span></span>
* <span data-ttu-id="b3b1b-204">Utilizar las dependencias de tareas para realizar todas las tareas que dependen de la finalización correcta del administrador de trabajos</span><span class="sxs-lookup"><span data-stu-id="b3b1b-204">Use task dependencies to make all tasks depend on the successful completion of the job manager</span></span>

<span data-ttu-id="b3b1b-205">**Reintentos del administrador de trabajos**</span><span class="sxs-lookup"><span data-stu-id="b3b1b-205">**Job manager retries**</span></span>

<span data-ttu-id="b3b1b-206">Si se produce un error en el administrador de trabajos, el servicio Batch puede reintentarlo en función de la configuración de reintentos del cliente.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-206">If the job manager fails, it may be retried by the Batch service depending on the client retry settings.</span></span> <span data-ttu-id="b3b1b-207">En general, esto es seguro, porque cuando el marco de trabajo agrega tareas al trabajo, omite cualquier tarea que ya existe.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-207">In general, this is safe, because when the framework adds tasks to the job, it ignores any tasks that already exist.</span></span> <span data-ttu-id="b3b1b-208">Sin embargo, si la tarea de cálculo es cara, no puede incurrir en el costo de volver a calcular las tareas que ya se han agregado al trabajo; por el contrario, si no se garantiza que volver a realizar la ejecución genere los mismos identificadores de tarea, no se iniciará el comportamiento “Omitir duplicados”.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-208">However, if calculating tasks is expensive, you may not wish to incur the cost of recalculating tasks that have already been added to the job; conversely, if the re-run is not guaranteed to generate the same task IDs then the 'ignore duplicates' behavior will not kick in.</span></span> <span data-ttu-id="b3b1b-209">En estos casos, es necesario diseñar el separador de trabajos para detectar el trabajo que se ha hecho ya y no repetirlo, por ejemplo mediante la realización de una tarea CloudJob.ListTasks antes de comenzar a producir tareas.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-209">In these cases you should design your job splitter to detect the work that has already been done and not repeat it, for example by performing a CloudJob.ListTasks before starting to yield tasks.</span></span>

### <a name="exit-codes-and-exceptions-in-the-job-manager-template"></a><span data-ttu-id="b3b1b-210">Excepciones y códigos de salida en la plantilla del administrador de trabajos</span><span class="sxs-lookup"><span data-stu-id="b3b1b-210">Exit codes and exceptions in the Job Manager template</span></span>
<span data-ttu-id="b3b1b-211">Las excepciones y los códigos de salida proporcionan un mecanismo para determinar el resultado de ejecutar un programa, y pueden ayudar a identificar los problemas con la ejecución del programa.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-211">Exit codes and exceptions provide a mechanism to determine the outcome of running a program, and they can help to identify any problems with the execution of the program.</span></span> <span data-ttu-id="b3b1b-212">La plantilla del administrador de trabajos implementa las excepciones y los códigos de salida que se describen en esta sección.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-212">The Job Manager template implements the exit codes and exceptions described in this section.</span></span>

<span data-ttu-id="b3b1b-213">Una tarea del administrador de trabajos que se implementa con la plantilla del administrador de trabajos puede devolver tres códigos de salida posibles:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-213">A job manager task that is implemented with the Job Manager template can return three possible exit codes:</span></span>

| <span data-ttu-id="b3b1b-214">Código</span><span class="sxs-lookup"><span data-stu-id="b3b1b-214">Code</span></span> | <span data-ttu-id="b3b1b-215">Description</span><span class="sxs-lookup"><span data-stu-id="b3b1b-215">Description</span></span> |
| --- | --- |
| <span data-ttu-id="b3b1b-216">0</span><span class="sxs-lookup"><span data-stu-id="b3b1b-216">0</span></span> |<span data-ttu-id="b3b1b-217">El administrador de trabajos se ha completado correctamente.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-217">The job manager completed successfully.</span></span> <span data-ttu-id="b3b1b-218">El código del separador de trabajos se ejecutó hasta completarse, y todas las tareas se han agregado al trabajo.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-218">Your job splitter code ran to completion, and all tasks were added to the job.</span></span> |
| <span data-ttu-id="b3b1b-219">1</span><span class="sxs-lookup"><span data-stu-id="b3b1b-219">1</span></span> |<span data-ttu-id="b3b1b-220">Error de la tarea del administrador de trabajos con una excepción en un elemento “esperado” del programa.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-220">The job manager task failed with an exception in an 'expected' part of the program.</span></span> <span data-ttu-id="b3b1b-221">La excepción se ha traducido a JobManagerException con información de diagnóstico y, cuando sea posible, con sugerencias para resolver el error.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-221">The exception was translated to a JobManagerException with diagnostic information and, where possible, suggestions for resolving the failure.</span></span> |
| <span data-ttu-id="b3b1b-222">2</span><span class="sxs-lookup"><span data-stu-id="b3b1b-222">2</span></span> |<span data-ttu-id="b3b1b-223">Error de la tarea del administrador de trabajos con una excepción “inesperada”.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-223">The job manager task failed with an 'unexpected' exception.</span></span> <span data-ttu-id="b3b1b-224">La excepción se ha registrado en la salida estándar, pero el administrador de trabajos no pudo agregar ninguna información adicional de diagnóstico o corrección.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-224">The exception was logged to standard output, but the job manager was unable to add any additional diagnostic or remediation information.</span></span> |

<span data-ttu-id="b3b1b-225">En el caso de errores de tareas del administrador de trabajos, algunas tareas aún pueden haberse agregado al servicio antes de producirse el error.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-225">In the case of job manager task failure, some tasks may still have been added to the service before the error occurred.</span></span> <span data-ttu-id="b3b1b-226">Estas tareas se ejecutarán como normales.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-226">These tasks will run as normal.</span></span> <span data-ttu-id="b3b1b-227">Vea la sección "Error del separador de trabajos" más arriba para consultar el análisis de esta ruta de acceso del código.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-227">See "Job Splitter Failure" above for discussion of this code path.</span></span>

<span data-ttu-id="b3b1b-228">Toda la información devuelta por las excepciones se escribe en archivos stdout.txt y stderr.txt.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-228">All the information returned by exceptions is written into stdout.txt and stderr.txt files.</span></span> <span data-ttu-id="b3b1b-229">Para obtener más información, vea [Control de errores](batch-api-basics.md#error-handling).</span><span class="sxs-lookup"><span data-stu-id="b3b1b-229">For more information, see [Error Handling](batch-api-basics.md#error-handling).</span></span>

### <a name="client-considerations"></a><span data-ttu-id="b3b1b-230">Consideraciones de cliente</span><span class="sxs-lookup"><span data-stu-id="b3b1b-230">Client considerations</span></span>
<span data-ttu-id="b3b1b-231">En esta sección se describen algunos requisitos de implementación de cliente al invocar un administrador de trabajos basado en esta plantilla.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-231">This section describes some client implementation requirements when invoking a job manager based on this template.</span></span> <span data-ttu-id="b3b1b-232">Vea [cómo pasar parámetros y variables de entorno desde el código de cliente](#pass-environment-settings) para obtener más información sobre cómo pasar los parámetros y la configuración del entorno.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-232">See [How to pass parameters and environment variables from the client code](#pass-environment-settings) for details on passing parameters and environment settings.</span></span>

<span data-ttu-id="b3b1b-233">**Credenciales obligatorias**</span><span class="sxs-lookup"><span data-stu-id="b3b1b-233">**Mandatory credentials**</span></span>

<span data-ttu-id="b3b1b-234">Para agregar tareas al trabajo de Azure Batch, la tarea del administrador de trabajos requiere la dirección URL y la clave de la cuenta de Azure Batch.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-234">In order to add tasks to the Azure Batch job, the job manager task requires your Azure Batch account URL and key.</span></span> <span data-ttu-id="b3b1b-235">Debe pasar estos datos en variables de entorno denominadas YOUR_BATCH_URL y YOUR_BATCH_KEY.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-235">You must pass these in environment variables named YOUR_BATCH_URL and YOUR_BATCH_KEY.</span></span> <span data-ttu-id="b3b1b-236">También puede establecerlos en la configuración del entorno de tareas del administrador de trabajos.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-236">You can set these in the Job Manager task environment settings.</span></span> <span data-ttu-id="b3b1b-237">Por ejemplo, en un cliente de C#:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-237">For example, in a C# client:</span></span>

```csharp
job.JobManagerTask.EnvironmentSettings = new [] {
    new EnvironmentSetting("YOUR_BATCH_URL", "https://account.region.batch.azure.com"),
    new EnvironmentSetting("YOUR_BATCH_KEY", "{your_base64_encoded_account_key}"),
};
```
<span data-ttu-id="b3b1b-238">**Credenciales de almacenamiento**</span><span class="sxs-lookup"><span data-stu-id="b3b1b-238">**Storage credentials**</span></span>

<span data-ttu-id="b3b1b-239">Normalmente, el cliente no necesita proporcionar las credenciales de la cuenta de almacenamiento vinculada a la tarea del administrador de trabajos porque a) la mayoría de los administradores de trabajos no necesitan acceder de manera explícita a la cuenta de almacenamiento vinculada y b) la cuenta de almacenamiento vinculada suele proporcionarse a todas las tareas como una configuración de entorno común para el trabajo.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-239">Typically, the client does not need to provide the linked storage account credentials to the job manager task because (a) most job managers do not need to explicitly access the linked storage account and (b) the linked storage account is often provided to all tasks as a common environment setting for the job.</span></span> <span data-ttu-id="b3b1b-240">Si no se proporciona la cuenta de almacenamiento vinculada a través de la configuración de entorno común, y el administrador de trabajos requiere acceso al almacenamiento vinculado, debe proporcionar las credenciales de almacenamiento vinculado como sigue:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-240">If you are not providing the linked storage account via the common environment settings, and the job manager requires access to linked storage, then you should supply the linked storage credentials as follows:</span></span>

```csharp
job.JobManagerTask.EnvironmentSettings = new [] {
    /* other environment settings */
    new EnvironmentSetting("LINKED_STORAGE_ACCOUNT", "{storageAccountName}"),
    new EnvironmentSetting("LINKED_STORAGE_KEY", "{storageAccountKey}"),
};
```

<span data-ttu-id="b3b1b-241">**Configuración de tareas del administrador de trabajos**</span><span class="sxs-lookup"><span data-stu-id="b3b1b-241">**Job manager task settings**</span></span>

<span data-ttu-id="b3b1b-242">El cliente debe establecer la marca *killJobOnCompletion* del administrador de trabajos en **false**.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-242">The client should set the job manager *killJobOnCompletion* flag to **false**.</span></span>

<span data-ttu-id="b3b1b-243">Normalmente es seguro que el cliente establezca *runExclusive* como **false**.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-243">It is usually safe for the client to set *runExclusive* to **false**.</span></span>

<span data-ttu-id="b3b1b-244">El cliente debe utilizar la colección *resourceFiles* o *applicationPackageReferences* para que el ejecutable del administrador de trabajos (y sus DLL necesarios) se implementen en el nodo de proceso.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-244">The client should use the *resourceFiles* or *applicationPackageReferences* collection to have the job manager executable (and its required DLLs) deployed to the compute node.</span></span>

<span data-ttu-id="b3b1b-245">De forma predeterminada, no se ejecutará ningún reintento del administrador de trabajos si se produce algún error.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-245">By default, the job manager will not be retried if it fails.</span></span> <span data-ttu-id="b3b1b-246">Según la lógica del administrador de trabajos, es posible que el cliente desee habilitar los reintentos mediante *constraints*/*maxTaskRetryCount*.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-246">Depending on your job manager logic, the client may want to enable retries via *constraints*/*maxTaskRetryCount*.</span></span>

<span data-ttu-id="b3b1b-247">**Configuración de trabajos**</span><span class="sxs-lookup"><span data-stu-id="b3b1b-247">**Job settings**</span></span>

<span data-ttu-id="b3b1b-248">Si el separador de trabajos emite tareas con dependencias, el cliente debe establecer usesTaskDependencies del trabajo en true.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-248">If the job splitter emits tasks with dependencies, the client must set the job's usesTaskDependencies to true.</span></span>

<span data-ttu-id="b3b1b-249">En el modelo del separador de trabajos, es poco común que los clientes deseen agregar tareas a trabajos más allá de lo que crea el separador de trabajos.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-249">In the job splitter model, it is unusual for clients to wish to add tasks to jobs over and above what the job splitter creates.</span></span> <span data-ttu-id="b3b1b-250">El cliente, por tanto, normalmente debe establecer la opción *onAllTasksComplete* del trabajo en **terminatejob**.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-250">The client should therefore normally set the job's *onAllTasksComplete* to **terminatejob**.</span></span>

## <a name="task-processor-template"></a><span data-ttu-id="b3b1b-251">Plantilla del procesador de tareas</span><span class="sxs-lookup"><span data-stu-id="b3b1b-251">Task Processor template</span></span>
<span data-ttu-id="b3b1b-252">La plantilla del procesador de tareas ayuda a implementar un procesador de tareas que puede realizar las siguientes acciones:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-252">A Task Processor template helps you to implement a task processor that can perform the following actions:</span></span>

* <span data-ttu-id="b3b1b-253">Configurar la información requerida por cada tarea de Batch para ejecutarla.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-253">Set up the information required by each Batch task to run.</span></span>
* <span data-ttu-id="b3b1b-254">Ejecutar todas las acciones requeridas por cada tarea de Batch.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-254">Run all actions required by each Batch task.</span></span>
* <span data-ttu-id="b3b1b-255">Guardar los resultados de las tareas en el almacenamiento persistente.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-255">Save task outputs to persistent storage.</span></span>

<span data-ttu-id="b3b1b-256">Aunque no es necesario que un procesador de tareas ejecute tareas en Batch, la principal ventaja de usar un procesador de tareas es que proporciona un contenedor para implementar todas las acciones de ejecución de tareas en una ubicación.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-256">Although a task processor is not required to run tasks on Batch, the key advantage of using a task processor is that it provides a wrapper to implement all task execution actions in one location.</span></span> <span data-ttu-id="b3b1b-257">Por ejemplo, si necesita ejecutar varias aplicaciones en el contexto de cada tarea, o si tiene que copiar datos al almacenamiento persistente después de completar cada tarea.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-257">For example, if you need to run several applications in the context of each task, or if you need to copy data to persistent storage after completing each task.</span></span>

<span data-ttu-id="b3b1b-258">Las acciones realizadas por el procesador de tareas pueden ser simples o complejas, o bien muchas o pocas, según sea necesario para la carga de trabajo.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-258">The actions performed by the task processor can be as simple or complex, and as many or as few, as required by your workload.</span></span> <span data-ttu-id="b3b1b-259">Además, mediante la implementación de todas las acciones de las tareas en un procesador de tareas, puede actualizar o agregar acciones fácilmente en función de los cambios de los requisitos de las aplicaciones o cargas de trabajo.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-259">Additionally, by implementing all task actions into one task processor, you can readily update or add actions based on changes to applications or workload requirements.</span></span> <span data-ttu-id="b3b1b-260">Sin embargo, en algunos casos un procesador de tareas puede no ser la solución óptima para la implementación, ya que puede agregar una complejidad innecesaria, por ejemplo cuando se ejecutan trabajos que se pueden iniciar rápidamente desde una línea de comandos simple.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-260">However, in some cases a task processor might not be the optimal solution for your implementation as it can add unnecessary complexity, for example when running jobs that can be quickly started from a simple command line.</span></span>

### <a name="create-a-task-processor-using-the-template"></a><span data-ttu-id="b3b1b-261">Creación de un procesador de tareas con la plantilla</span><span class="sxs-lookup"><span data-stu-id="b3b1b-261">Create a Task Processor using the template</span></span>
<span data-ttu-id="b3b1b-262">Para agregar un procesador de tareas a la solución creada anteriormente, siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-262">To add a task processor to the solution that you created earlier, follow these steps:</span></span>

1. <span data-ttu-id="b3b1b-263">Abra la solución existente en Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-263">Open your existing solution in Visual Studio.</span></span>
2. <span data-ttu-id="b3b1b-264">En el Explorador de soluciones, haga clic con el botón derecho en la solución; luego, en **Agregar** y en **Nuevo proyecto**.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-264">In Solution Explorer, right-click the solution, click **Add**, and then click **New Project**.</span></span>
3. <span data-ttu-id="b3b1b-265">En **Visual C#**, haga clic en **Nube** y, luego, haga clic en **Procesador de tareas de Azure Batch**.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-265">Under **Visual C#**, click **Cloud**, and then click **Azure Batch Task Processor**.</span></span>
4. <span data-ttu-id="b3b1b-266">Escriba un nombre que describe la aplicación e identifica este proyecto como el procesador de tareas (p. ej., "LitwareTaskProcessor").</span><span class="sxs-lookup"><span data-stu-id="b3b1b-266">Type a name that describes your application and identifies this project as the task processor (e.g. "LitwareTaskProcessor").</span></span>
5. <span data-ttu-id="b3b1b-267">Para crear el proyecto, haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-267">To create the project, click **OK**.</span></span>
6. <span data-ttu-id="b3b1b-268">Por último, compile el proyecto para obligar a Visual Studio a cargar todos los paquetes NuGet a que se hace referencia y comprobar que es válido el proyecto antes de comenzar a modificarlo.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-268">Finally, build the project to force Visual Studio to load all referenced NuGet packages and to verify that the project is valid before you start modifying it.</span></span>

### <a name="task-processor-template-files-and-their-purpose"></a><span data-ttu-id="b3b1b-269">Archivos de plantilla del procesador de tareas y su propósito</span><span class="sxs-lookup"><span data-stu-id="b3b1b-269">Task Processor template files and their purpose</span></span>
<span data-ttu-id="b3b1b-270">Cuando se crea un proyecto mediante la plantilla del procesador de tareas, genera tres grupos de archivos de código:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-270">When you create a project using the task processor template, it generates three groups of code files:</span></span>

* <span data-ttu-id="b3b1b-271">El archivo de programa principal (Program.cs).</span><span class="sxs-lookup"><span data-stu-id="b3b1b-271">The main program file (Program.cs).</span></span> <span data-ttu-id="b3b1b-272">Contiene el punto de entrada del programa y el control de excepciones de nivel superior.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-272">This contains the program entry point and top-level exception handling.</span></span> <span data-ttu-id="b3b1b-273">Normalmente no es necesario modificar esto.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-273">You shouldn't normally need to modify this.</span></span>
* <span data-ttu-id="b3b1b-274">El directorio Framework.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-274">The Framework directory.</span></span> <span data-ttu-id="b3b1b-275">Contiene los archivos responsables del trabajo “reutilizable” realizado por el programa del administrador de trabajos: desempaquetar parámetros, agregar tareas al trabajo de Batch, etc. Normalmente no es necesario modificar estos archivos.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-275">This contains the files responsible for the 'boilerplate' work done by the job manager program – unpacking parameters, adding tasks to the Batch job, etc. You shouldn't normally need to modify these files.</span></span>
* <span data-ttu-id="b3b1b-276">El archivo de procesador de tareas (TaskProcessor.cs).</span><span class="sxs-lookup"><span data-stu-id="b3b1b-276">The task processor file (TaskProcessor.cs).</span></span> <span data-ttu-id="b3b1b-277">Es donde colocará la lógica específica de la aplicación para la ejecución de una tarea (normalmente llama a un archivo ejecutable existente).</span><span class="sxs-lookup"><span data-stu-id="b3b1b-277">This is where you will put your application-specific logic for executing a task (typically by calling out to an existing executable).</span></span> <span data-ttu-id="b3b1b-278">Código de procesamiento previo y posterior, como descargar datos adicionales o cargar archivos de resultados, que también va aquí.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-278">Pre- and post-processing code, such as downloading additional data or uploading result files, also goes here.</span></span>

<span data-ttu-id="b3b1b-279">Por supuesto puede agregar archivos adicionales según sea necesario para admitir el código del procesador de tareas, según la complejidad de la lógica de separación de trabajos.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-279">Of course you can add additional files as required to support your task processor code, depending on the complexity of the job splitting logic.</span></span>

<span data-ttu-id="b3b1b-280">La plantilla también genera archivos de proyecto estándar de .NET como un archivo .csproj, app.config, packages.config, etc.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-280">The template also generates standard .NET project files such as a .csproj file, app.config, packages.config, etc.</span></span>

<span data-ttu-id="b3b1b-281">En el resto de esta sección se describen los diferentes archivos y su estructura de código y, además, se explica lo que hace cada clase.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-281">The rest of this section describes the different files and their code structure, and explains what each class does.</span></span>

![Explorador de soluciones de Visual Studio que muestra la solución de la plantilla del procesador de tareas][solution_explorer02]

<span data-ttu-id="b3b1b-283">**Archivos de Framework**</span><span class="sxs-lookup"><span data-stu-id="b3b1b-283">**Framework files**</span></span>

* <span data-ttu-id="b3b1b-284">`Configuration.cs`: encapsula la carga de datos de configuración de trabajos, como los detalles de la cuenta de Batch, las credenciales de la cuenta de almacenamiento vinculada, la información sobre el trabajo y la tarea y los parámetros del trabajo.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-284">`Configuration.cs`: Encapsulates the loading of job configuration data such as Batch account details, linked storage account credentials, job and task information, and job parameters.</span></span> <span data-ttu-id="b3b1b-285">También proporciona acceso a las variables de entorno definidas por Batch (vea Configuración del entorno para las tareas, en la documentación de Batch) mediante la clase Configuration.EnvironmentVariable.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-285">It also provides access to Batch-defined environment variables (see Environment settings for tasks, in the Batch documentation) via the Configuration.EnvironmentVariable class.</span></span>
* <span data-ttu-id="b3b1b-286">`IConfiguration.cs`: abstrae la implementación de la clase de configuración, para que pueda realizar una prueba unitaria del separador de trabajos mediante un objeto de configuración falsa o simulada.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-286">`IConfiguration.cs`: Abstracts the implementation of the Configuration class, so that you can unit test your job splitter using a fake or mock configuration object.</span></span>
* <span data-ttu-id="b3b1b-287">`TaskProcessorException.cs`: representa un error que requiere la terminación del administrador de trabajos.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-287">`TaskProcessorException.cs`: Represents an error that requires the job manager to terminate.</span></span> <span data-ttu-id="b3b1b-288">TaskProcessorException se utiliza para ajustar los errores “esperados” donde se puede proporcionar información de diagnóstico específica como parte de la finalización.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-288">TaskProcessorException is used to wrap 'expected' errors where specific diagnostic information can be provided as part of termination.</span></span>

<span data-ttu-id="b3b1b-289">**Procesador de tareas**</span><span class="sxs-lookup"><span data-stu-id="b3b1b-289">**Task Processor**</span></span>

* <span data-ttu-id="b3b1b-290">`TaskProcessor.cs`: ejecuta la tarea.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-290">`TaskProcessor.cs`: Runs the task.</span></span> <span data-ttu-id="b3b1b-291">El marco de trabajo invoca el método TaskProcessor.Run.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-291">The framework invokes the TaskProcessor.Run method.</span></span> <span data-ttu-id="b3b1b-292">Esta es la clase donde se insertará la lógica específica de la aplicación de la tarea.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-292">This is the class where you will inject the application-specific logic of your task.</span></span> <span data-ttu-id="b3b1b-293">Implemente el método de ejecución para:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-293">Implement the Run method to:</span></span>
  * <span data-ttu-id="b3b1b-294">Analizar y validar todos los parámetros de la tarea</span><span class="sxs-lookup"><span data-stu-id="b3b1b-294">Parse and validate any task parameters</span></span>
  * <span data-ttu-id="b3b1b-295">Crear la línea de comandos para cualquier programa externo que desea invocar</span><span class="sxs-lookup"><span data-stu-id="b3b1b-295">Compose the command line for any external program you want to invoke</span></span>
  * <span data-ttu-id="b3b1b-296">Registra cualquier información de diagnóstico que necesita para fines de depuración</span><span class="sxs-lookup"><span data-stu-id="b3b1b-296">Log any diagnostic information you may require for debugging purposes</span></span>
  * <span data-ttu-id="b3b1b-297">Iniciar un proceso mediante la línea de comandos</span><span class="sxs-lookup"><span data-stu-id="b3b1b-297">Start a process using that command line</span></span>
  * <span data-ttu-id="b3b1b-298">Esperar a que el proceso termine</span><span class="sxs-lookup"><span data-stu-id="b3b1b-298">Wait for the process to exit</span></span>
  * <span data-ttu-id="b3b1b-299">Capturar el código de salida del proceso para determinar si se realizó correctamente o no</span><span class="sxs-lookup"><span data-stu-id="b3b1b-299">Capture the exit code of the process to determine if it succeeded or failed</span></span>
  * <span data-ttu-id="b3b1b-300">Guardar los archivos de salida que desea conservar en el almacenamiento persistente</span><span class="sxs-lookup"><span data-stu-id="b3b1b-300">Save any output files you want to keep to persistent storage</span></span>

<span data-ttu-id="b3b1b-301">**Archivos de proyecto de línea de comandos de .NET estándar**</span><span class="sxs-lookup"><span data-stu-id="b3b1b-301">**Standard .NET command line project files**</span></span>

* <span data-ttu-id="b3b1b-302">`App.config`: archivo de configuración de la aplicación. NET estándar.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-302">`App.config`: Standard .NET application configuration file.</span></span>
* <span data-ttu-id="b3b1b-303">`Packages.config`: archivo de dependencia de paquetes NuGet estándar.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-303">`Packages.config`: Standard NuGet package dependency file.</span></span>
* <span data-ttu-id="b3b1b-304">`Program.cs`: contiene el punto de entrada del programa y el control de excepciones de nivel superior.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-304">`Program.cs`: Contains the program entry point and top-level exception handling.</span></span>

## <a name="implementing-the-task-processor"></a><span data-ttu-id="b3b1b-305">Implementación del procesador de tareas</span><span class="sxs-lookup"><span data-stu-id="b3b1b-305">Implementing the task processor</span></span>
<span data-ttu-id="b3b1b-306">Al abrir el proyecto de plantilla del procesador de tareas, el proyecto tendrá el archivo TaskProcessor.cs abierto de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-306">When you open the Task Processor template project, the project will have the TaskProcessor.cs file open by default.</span></span> <span data-ttu-id="b3b1b-307">Puede implementar la lógica de ejecución de las tareas en la carga de trabajo con el método Run() que se muestra a continuación:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-307">You can implement the run logic for the tasks in your workload by using the Run() method shown below:</span></span>

```csharp
/// <summary>
/// Runs the task processing logic. This is where you inject
/// your application-specific logic for decomposing the job into tasks.
///
/// The task processor framework invokes the Run method for you; you need
/// only to implement it, not to call it yourself. Typically, your
/// implementation will execute an external program (from resource files or
/// an application package), check the exit code of that program and
/// save output files to persistent storage.
/// </summary>
public async Task<int> Run()

{
    try
    {
        //Your code for the task processor goes here.
        var command = $"compare {_parameters["Frame1"]} {_parameters["Frame2"]} compare.gif";
        using (var process = Process.Start($"cmd /c {command}"))
        {
            process.WaitForExit();
            var taskOutputStorage = new TaskOutputStorage(
            _configuration.StorageAccount,
            _configuration.JobId,
            _configuration.TaskId
            );
            await taskOutputStorage.SaveAsync(
            TaskOutputKind.TaskOutput,
            @"..\stdout.txt",
            @"stdout.txt"
            );
            return process.ExitCode;
        }
    }
    catch (Exception ex)
    {
        throw new TaskProcessorException(
        $"{ex.GetType().Name} exception in run task processor: {ex.Message}",
        ex
        );
    }
}
```
> [!NOTE]
> <span data-ttu-id="b3b1b-308">La sección anotada en el método Run() es la única sección del código de plantilla del procesador de tareas que está pensada para que se modifique agregando la lógica de ejecución de las tareas a la carga de trabajo.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-308">The annotated section in the Run() method is the only section of the Task Processor template code that is intended for you to modify by adding the run logic for the tasks in your workload.</span></span> <span data-ttu-id="b3b1b-309">Si desea modificar una sección diferente de la plantilla, primero consulte la documentación de Batch para familiarizarse con el funcionamiento de Batch y pruebe algunos de los ejemplos de código de Batch.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-309">If you want to modify a different section of the template, please first familiarize yourself with how Batch works by reviewing the Batch documentation and trying out a few of the Batch code samples.</span></span>
> 
> 

<span data-ttu-id="b3b1b-310">El método Run() es responsable de ejecutar la línea de comandos, iniciar uno o varios procesos, esperar a que todos los procesos se completen, guardar los resultados y, por último, devolver un código de salida.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-310">The Run() method is responsible for launching the command line, starting one or more processes, waiting for all process to complete, saving the results, and finally returning with an exit code.</span></span> <span data-ttu-id="b3b1b-311">El método Run() es donde se implementa la lógica de procesamiento de sus tareas.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-311">The Run() method is where you implement the processing logic for your tasks.</span></span> <span data-ttu-id="b3b1b-312">El marco de trabajo del procesador de tareas invoca el método Run(); no es necesario llamarlo usted mismo.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-312">The task processor framework invokes the Run() method for you; you do not need to call it yourself.</span></span>

<span data-ttu-id="b3b1b-313">La implementación de Run() dispone de acceso a:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-313">Your Run() implementation has access to:</span></span>

* <span data-ttu-id="b3b1b-314">Los parámetros de tareas, a través del campo `_parameters`.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-314">The task parameters, via the `_parameters` field.</span></span>
* <span data-ttu-id="b3b1b-315">Los identificadores de trabajos y tareas, a través de los campos `_jobId`y `_taskId`.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-315">The job and task ids, via the `_jobId` and `_taskId` fields.</span></span>
* <span data-ttu-id="b3b1b-316">La configuración de la tarea, a través del campo `_configuration` .</span><span class="sxs-lookup"><span data-stu-id="b3b1b-316">The task configuration, via the `_configuration` field.</span></span>

<span data-ttu-id="b3b1b-317">**Error de tarea**</span><span class="sxs-lookup"><span data-stu-id="b3b1b-317">**Task failure**</span></span>

<span data-ttu-id="b3b1b-318">En caso de error, puede salir del método Run() iniciando una excepción, pero esto deja al controlador de excepciones de nivel superior el control del código de salida de la tarea.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-318">In case of failure, you can exit the Run() method by throwing an exception, but this leaves the top level exception handler in control of the task exit code.</span></span> <span data-ttu-id="b3b1b-319">Si necesita controlar el código de salida para que pueda distinguir los diferentes tipos de error, por ejemplo con fines de diagnóstico o porque algunos modos de error deben finalizar el trabajo y otros no, debe salir del método Run() devolviendo un código de salida distinto de cero.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-319">If you need to control the exit code so that you can distinguish different types of failure, for example for diagnostic purposes or because some failure modes should terminate the job and others should not, then you should exit the Run() method by returning a non-zero exit code.</span></span> <span data-ttu-id="b3b1b-320">Esto se convierte en el código de salida de la tarea.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-320">This becomes the task exit code.</span></span>

### <a name="exit-codes-and-exceptions-in-the-task-processor-template"></a><span data-ttu-id="b3b1b-321">Excepciones y códigos de salida en la plantilla del procesador de tareas</span><span class="sxs-lookup"><span data-stu-id="b3b1b-321">Exit codes and exceptions in the Task Processor template</span></span>
<span data-ttu-id="b3b1b-322">Las excepciones y los códigos de salida proporcionan un mecanismo para determinar el resultado de ejecutar un programa, y pueden ayudar a identificar los problemas con la ejecución del programa.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-322">Exit codes and exceptions provide a mechanism to determine the outcome of running a program, and they can help identify any problems with the execution of the program.</span></span> <span data-ttu-id="b3b1b-323">La plantilla del procesador de tareas implementa las excepciones y los códigos de salida que se describen en esta sección.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-323">The Task Processor template implements the exit codes and exceptions described in this section.</span></span>

<span data-ttu-id="b3b1b-324">Una tarea del procesador de tareas que se implementa con la plantilla del procesador de tareas puede devolver tres códigos de salida posibles:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-324">A task processor task that is implemented with the Task Processor template can return three possible exit codes:</span></span>

| <span data-ttu-id="b3b1b-325">Código</span><span class="sxs-lookup"><span data-stu-id="b3b1b-325">Code</span></span> | <span data-ttu-id="b3b1b-326">Descripción</span><span class="sxs-lookup"><span data-stu-id="b3b1b-326">Description</span></span> |
| --- | --- |
| <span data-ttu-id="b3b1b-327">[Process.ExitCode][process_exitcode]</span><span class="sxs-lookup"><span data-stu-id="b3b1b-327">[Process.ExitCode][process_exitcode]</span></span> |<span data-ttu-id="b3b1b-328">El procesador de tareas se ejecutó hasta completarse.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-328">The task processor ran to completion.</span></span> <span data-ttu-id="b3b1b-329">Tenga en cuenta que esto no implica que el programa invocado sea correcto, solo que el procesador de tareas lo invocó correctamente y realizó cualquier procesamiento posterior sin excepciones.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-329">Note that this does not imply that the program you invoked was successful – only that the task processor invoked it successfully and performed any post-processing without exceptions.</span></span> <span data-ttu-id="b3b1b-330">El significado de los códigos de salida depende del programa invocado, normalmente el código de salida 0 significa que el programa se ha ejecutado correctamente y cualquier otro código de salida significa que se ha producido algún error en el programa.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-330">The meaning of the exit code depends on the invoked program – typically exit code 0 means the program succeeded and any other exit code means the program failed.</span></span> |
| <span data-ttu-id="b3b1b-331">1</span><span class="sxs-lookup"><span data-stu-id="b3b1b-331">1</span></span> |<span data-ttu-id="b3b1b-332">Error del procesador de tareas con una excepción en un elemento “esperado” del programa.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-332">The task processor failed with an exception in an 'expected' part of the program.</span></span> <span data-ttu-id="b3b1b-333">La excepción se ha traducido a `TaskProcessorException` con información de diagnóstico y, cuando sea posible, con sugerencias para resolver el error.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-333">The exception was translated to a `TaskProcessorException` with diagnostic information and, where possible, suggestions for resolving the failure.</span></span> |
| <span data-ttu-id="b3b1b-334">2</span><span class="sxs-lookup"><span data-stu-id="b3b1b-334">2</span></span> |<span data-ttu-id="b3b1b-335">Error del procesador de tareas con una excepción “inesperada”.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-335">The task processor failed with an 'unexpected' exception.</span></span> <span data-ttu-id="b3b1b-336">La excepción se ha registrado en la salida estándar, pero el procesador de tareas no pudo agregar ninguna información adicional de diagnóstico o corrección.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-336">The exception was logged to standard output, but the task processor was unable to add any additional diagnostic or remediation information.</span></span> |

> [!NOTE]
> <span data-ttu-id="b3b1b-337">Si el programa que se invoca utiliza códigos de salida de 1 y 2 para indicar modos de error específicos, resulta ambiguo utilizar los códigos de salida 1 y 2 para los errores del procesador de tareas.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-337">If the program you invoke uses exit codes 1 and 2 to indicate specific failure modes, then using exit codes 1 and 2 for task processor errors is ambiguous.</span></span> <span data-ttu-id="b3b1b-338">Puede cambiar estos códigos de error del procesador de tareas por códigos de salida distintos mediante la edición de los casos de excepción en el archivo Program.cs.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-338">You can change these task processor error codes to distinctive exit codes by editing the exception cases in the Program.cs file.</span></span>
> 
> 

<span data-ttu-id="b3b1b-339">Toda la información devuelta por las excepciones se escribe en archivos stdout.txt y stderr.txt.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-339">All the information returned by exceptions is written into stdout.txt and stderr.txt files.</span></span> <span data-ttu-id="b3b1b-340">Para más información, vea Control de errores en la documentación de Batch.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-340">For more information, see Error Handling, in the Batch documentation.</span></span>

### <a name="client-considerations"></a><span data-ttu-id="b3b1b-341">Consideraciones de cliente</span><span class="sxs-lookup"><span data-stu-id="b3b1b-341">Client considerations</span></span>
<span data-ttu-id="b3b1b-342">**Credenciales de almacenamiento**</span><span class="sxs-lookup"><span data-stu-id="b3b1b-342">**Storage credentials**</span></span>

<span data-ttu-id="b3b1b-343">Si el procesador de tareas usa Azure Blob Storage para conservar las salidas, por ejemplo, mediante la biblioteca auxiliar de convenciones de archivo, necesita acceso a *cualquiera* de las credenciales de la cuenta de almacenamiento en nube *o* a una URL de contenedor de blobs que incluye una firma de acceso compartido (SAS).</span><span class="sxs-lookup"><span data-stu-id="b3b1b-343">If your task processor uses Azure blob storage to persist outputs, for example using the file conventions helper library, then it needs access to *either* the cloud storage account credentials *or* a blob container URL that includes a shared access signature (SAS).</span></span> <span data-ttu-id="b3b1b-344">La plantilla incluye compatibilidad para proporcionar credenciales a través de variables de entorno común.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-344">The template includes support for providing credentials via common environment variables.</span></span> <span data-ttu-id="b3b1b-345">El cliente puede pasar las credenciales de almacenamiento como sigue:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-345">Your client can pass the storage credentials as follows:</span></span>

```csharp
job.CommonEnvironmentSettings = new [] {
    new EnvironmentSetting("LINKED_STORAGE_ACCOUNT", "{storageAccountName}"),
    new EnvironmentSetting("LINKED_STORAGE_KEY", "{storageAccountKey}"),
};
```

<span data-ttu-id="b3b1b-346">La cuenta de almacenamiento está disponible en la clase TaskProcessor a través de la propiedad `_configuration.StorageAccount` .</span><span class="sxs-lookup"><span data-stu-id="b3b1b-346">The storage account is then available in the TaskProcessor class via the `_configuration.StorageAccount` property.</span></span>

<span data-ttu-id="b3b1b-347">Si prefiere usar una dirección URL de contenedor con SAS, también puede pasar esto a través de una configuración de entorno de trabajo común, pero la plantilla del procesador de tareas no incluyen actualmente compatibilidad integrada para esto.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-347">If you prefer to use a container URL with SAS, you can also pass this via an job common environment setting, but the task processor template does not currently include built-in support for this.</span></span>

<span data-ttu-id="b3b1b-348">**Configuración de almacenamiento**</span><span class="sxs-lookup"><span data-stu-id="b3b1b-348">**Storage setup**</span></span>

<span data-ttu-id="b3b1b-349">Se recomienda que la tarea del administrador de clientes o de trabajos cree los contenedores requeridos por las tareas antes de agregar las tareas al trabajo.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-349">It is recommended that the client or job manager task create any containers required by tasks before adding the tasks to the job.</span></span> <span data-ttu-id="b3b1b-350">Esto es obligatorio si se utiliza una dirección URL de contenedor con SAS, ya que dicha dirección URL no incluye permisos para crear el contenedor.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-350">This is mandatory if you use a container URL with SAS, as such a URL does not include permission to create the container.</span></span> <span data-ttu-id="b3b1b-351">Se recomienda incluso si pasa las credenciales de la cuenta de almacenamiento, puesto que se guarda cada tarea que tiene que llamar a CloudBlobContainer.CreateIfNotExistsAsync en el contenedor.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-351">It is recommended even if you pass storage account credentials, as it saves every task having to call CloudBlobContainer.CreateIfNotExistsAsync on the container.</span></span>

## <a name="pass-parameters-and-environment-variables"></a><span data-ttu-id="b3b1b-352">Transferencia de parámetros y variables de entorno</span><span class="sxs-lookup"><span data-stu-id="b3b1b-352">Pass parameters and environment variables</span></span>
### <a name="pass-environment-settings"></a><span data-ttu-id="b3b1b-353">Configuración del entorno de transferencia</span><span class="sxs-lookup"><span data-stu-id="b3b1b-353">Pass environment settings</span></span>
<span data-ttu-id="b3b1b-354">Un cliente puede transferir información a la tarea del administrador de trabajos en el formulario de configuración del entorno.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-354">A client can pass information to the job manager task in the form of environment settings.</span></span> <span data-ttu-id="b3b1b-355">La tarea del administrador de trabajos puede usar esta información al generar las tareas del procesador de tareas que se ejecutarán como parte del trabajo de proceso.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-355">This information can then be used by the job manager task when generating the task processor tasks that will run as part of the compute job.</span></span> <span data-ttu-id="b3b1b-356">Ejemplos de la información que se puede transferir como configuración del entorno:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-356">Examples of the information that you can pass as environment settings are:</span></span>

* <span data-ttu-id="b3b1b-357">Claves de cuenta y nombre de cuenta de Storage</span><span class="sxs-lookup"><span data-stu-id="b3b1b-357">Storage account name and account keys</span></span>
* <span data-ttu-id="b3b1b-358">Dirección URL de la cuenta de Batch</span><span class="sxs-lookup"><span data-stu-id="b3b1b-358">Batch account URL</span></span>
* <span data-ttu-id="b3b1b-359">Clave de cuenta de Batch</span><span class="sxs-lookup"><span data-stu-id="b3b1b-359">Batch account key</span></span>

<span data-ttu-id="b3b1b-360">El servicio Batch tiene un mecanismo sencillo para transferir la configuración del entorno a una tarea del administrador de trabajos mediante la propiedad `EnvironmentSettings` en [Microsoft.Azure.Batch.JobManagerTask][net_jobmanagertask].</span><span class="sxs-lookup"><span data-stu-id="b3b1b-360">The Batch service has a simple mechanism to pass environment settings to a job manager task by using the `EnvironmentSettings` property in [Microsoft.Azure.Batch.JobManagerTask][net_jobmanagertask].</span></span>

<span data-ttu-id="b3b1b-361">Por ejemplo, para obtener la instancia `BatchClient` para una cuenta de Batch, puede transferir como variables de entorno del código de cliente la dirección URL y las credenciales de claves compartidas para la cuenta de Batch.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-361">For example, to get the `BatchClient` instance for a Batch account, you can pass as environment variables from the client code the URL and shared key credentials for the Batch account.</span></span> <span data-ttu-id="b3b1b-362">Del mismo modo, para tener acceso a la cuenta de almacenamiento que está vinculada a la cuenta de Batch, puede transferir el nombre de la cuenta de almacenamiento y la clave de la cuenta de almacenamiento como variables de entorno.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-362">Likewise, to access the storage account that is linked to the Batch account, you can pass the storage account name and the storage account key as environment variables.</span></span>

### <a name="pass-parameters-to-the-job-manager-template"></a><span data-ttu-id="b3b1b-363">Transferencia de parámetros a la plantilla del administrador de trabajos</span><span class="sxs-lookup"><span data-stu-id="b3b1b-363">Pass parameters to the Job Manager template</span></span>
<span data-ttu-id="b3b1b-364">En muchos casos, resulta útil transferir los parámetros de cada trabajo a la tarea del administrador de trabajos, para controlar el proceso de separación de trabajos o para configurar las tareas del trabajo.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-364">In many cases, it's useful to pass per-job parameters to the job manager task, either to control the job splitting process or to configure the tasks for the job.</span></span> <span data-ttu-id="b3b1b-365">Puede hacerlo mediante la carga de un archivo JSON llamado parameters.json como un archivo de recursos para la tarea del administrador de trabajos.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-365">You can do this by uploading a JSON file named parameters.json as a resource file for the job manager task.</span></span> <span data-ttu-id="b3b1b-366">Los parámetros pueden estar disponibles después en el campo `JobSplitter._parameters` de la plantilla del administrador de trabajos.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-366">The parameters can then become available in the `JobSplitter._parameters` field in the Job Manager template.</span></span>

> [!NOTE]
> <span data-ttu-id="b3b1b-367">El controlador de parámetros integrado admite solamente los diccionarios de cadena a cadena.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-367">The built-in parameter handler supports only string-to-string dictionaries.</span></span> <span data-ttu-id="b3b1b-368">Si desea transferir valores JSON complejos como valores de parámetro, debe transferir estos elementos como cadenas y analizarlos en el separador de trabajos o modificar el método `Configuration.GetJobParameters` del marco de trabajo.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-368">If you want to pass complex JSON values as parameter values, you will need to pass these as strings and parse them in the job splitter, or modify the framework's `Configuration.GetJobParameters` method.</span></span>
> 
> 

### <a name="pass-parameters-to-the-task-processor-template"></a><span data-ttu-id="b3b1b-369">Transferencia de parámetros a la plantilla del procesador de tareas</span><span class="sxs-lookup"><span data-stu-id="b3b1b-369">Pass parameters to the Task Processor template</span></span>
<span data-ttu-id="b3b1b-370">También puede transferir parámetros a tareas individuales que se implementan utilizando la plantilla del procesador de tareas.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-370">You can also pass parameters to individual tasks implemented using the Task Processor template.</span></span> <span data-ttu-id="b3b1b-371">Al igual que con la plantilla del administrador de trabajos, la plantilla del procesador de tareas busca un archivo de recursos denominado</span><span class="sxs-lookup"><span data-stu-id="b3b1b-371">Just as with the job manager template, the task processor template looks for a resource file named</span></span>

<span data-ttu-id="b3b1b-372">parameters.json y, si lo encuentra, lo carga como el diccionario de parámetros.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-372">parameters.json, and if found it loads it as the parameters dictionary.</span></span> <span data-ttu-id="b3b1b-373">Hay un par de opciones sobre cómo transferir parámetros a las tareas del procesador de tareas:</span><span class="sxs-lookup"><span data-stu-id="b3b1b-373">There are a couple of options for how to pass parameters to the task processor tasks:</span></span>

* <span data-ttu-id="b3b1b-374">Volver a usar los parámetros del trabajo JSON.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-374">Reuse the job parameters JSON.</span></span> <span data-ttu-id="b3b1b-375">Esto funciona bien si solo los parámetros son todo el trabajo (por ejemplo, una representación de anchura y altura).</span><span class="sxs-lookup"><span data-stu-id="b3b1b-375">This works well if the only parameters are job-wide ones (for example, a render height and width).</span></span> <span data-ttu-id="b3b1b-376">Para ello, al crear una tarea CloudTask en el separador de trabajos, agregue una referencia al objeto de archivo de recursos parameters.json desde ResourceFiles de la tarea del administrador de trabajos (`JobSplitter._jobManagerTask.ResourceFiles`) a la colección ResourceFiles de CloudTask.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-376">To do this, when creating a CloudTask in the job splitter, add a reference to the parameters.json resource file object from the job manager task's ResourceFiles (`JobSplitter._jobManagerTask.ResourceFiles`) to the CloudTask's ResourceFiles collection.</span></span>
* <span data-ttu-id="b3b1b-377">Generar y cargar un documento parameters.json específico de la tarea como parte de la ejecución del separador de trabajos y hacer referencia a ese blob en la colección de archivos de recursos de la tarea.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-377">Generate and upload a task-specific parameters.json document as part of job splitter execution, and reference that blob in the task's resource files collection.</span></span> <span data-ttu-id="b3b1b-378">Esto es necesario si diferentes tareas tienen parámetros distintos.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-378">This is necessary if different tasks have different parameters.</span></span> <span data-ttu-id="b3b1b-379">Un ejemplo podría ser un escenario de representación 3D en que el índice de fotograma se transfiere a la tarea como un parámetro.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-379">An example might be a 3D rendering scenario where the frame index is passed to the task as a parameter.</span></span>

> [!NOTE]
> <span data-ttu-id="b3b1b-380">El controlador de parámetros integrado admite solamente los diccionarios de cadena a cadena.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-380">The built-in parameter handler supports only string-to-string dictionaries.</span></span> <span data-ttu-id="b3b1b-381">Si desea transferir valores JSON complejos como valores de parámetro, debe transferir estos elementos como cadenas y analizarlos en el procesador de tareas o modificar el método `Configuration.GetTaskParameters` del marco de trabajo.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-381">If you want to pass complex JSON values as parameter values, you will need to pass these as strings and parse them in the task processor, or modify the framework's `Configuration.GetTaskParameters` method.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="b3b1b-382">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="b3b1b-382">Next steps</span></span>
### <a name="persist-job-and-task-output-to-azure-storage"></a><span data-ttu-id="b3b1b-383">Guardar salidas de trabajos y tareas en Azure Storage</span><span class="sxs-lookup"><span data-stu-id="b3b1b-383">Persist job and task output to Azure Storage</span></span>
<span data-ttu-id="b3b1b-384">Otra herramienta útil en el desarrollo de soluciones de Batch es [Azure Batch File Conventions][nuget_package] (Convenciones de archivos de Azure Batch).</span><span class="sxs-lookup"><span data-stu-id="b3b1b-384">Another helpful tool in Batch solution development is [Azure Batch File Conventions][nuget_package].</span></span> <span data-ttu-id="b3b1b-385">Utilice esta biblioteca de clases .NET (que actualmente se encuentra disponible en versión preliminar) para almacenar y recuperar fácilmente las salidas de las tareas en o desde Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-385">Use this .NET class library (currently in preview) in your Batch .NET applications to easily store and retrieve task outputs to and from Azure Storage.</span></span> <span data-ttu-id="b3b1b-386">[Almacenamiento de la salida de trabajos y tareas de Azure Batch](batch-task-output.md) se incluye una descripción completa de la biblioteca y su uso.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-386">[Persist Azure Batch job and task output](batch-task-output.md) contains a full discussion of the library and its usage.</span></span>

### <a name="batch-forum"></a><span data-ttu-id="b3b1b-387">Foro de Batch</span><span class="sxs-lookup"><span data-stu-id="b3b1b-387">Batch Forum</span></span>
<span data-ttu-id="b3b1b-388">El [foro de Azure Batch][forum] en MSDN es un lugar excelente para debatir y formular preguntas sobre el servicio.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-388">The [Azure Batch Forum][forum] on MSDN is a great place to discuss Batch and ask questions about the service.</span></span> <span data-ttu-id="b3b1b-389">Lea los mensajes útiles publicados y envíe sus preguntas a medida que surjan mientras compila sus soluciones del servicio Batch.</span><span class="sxs-lookup"><span data-stu-id="b3b1b-389">Head on over for helpful "sticky" posts, and post your questions as they arise while you build your Batch solutions.</span></span>

[forum]: https://social.msdn.microsoft.com/forums/azure/en-US/home?forum=azurebatch
[net_jobmanagertask]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.jobmanagertask.aspx
[github_samples]: https://github.com/Azure/azure-batch-samples
[nuget_package]: https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files
[process_exitcode]: https://msdn.microsoft.com/library/system.diagnostics.process.exitcode.aspx
[vs_gallery]: https://visualstudiogallery.msdn.microsoft.com/
[vs_gallery_templates]: https://go.microsoft.com/fwlink/?linkid=820714
[vs_find_use_ext]: https://msdn.microsoft.com/library/dd293638.aspx

[diagram01]: ./media/batch-visual-studio-templates/diagram01.png
[solution_explorer01]: ./media/batch-visual-studio-templates/solution_explorer01.png
[solution_explorer02]: ./media/batch-visual-studio-templates/solution_explorer02.png

---
title: "especificación de introducción de aaaAzure Media Services live MP4 fragmentado | Documentos de Microsoft"
description: "Esta especificación describe el protocolo de Hola y el formato fragmentado MP4-based live streaming ingesta de servicios multimedia de Azure. Puede usar eventos en directo de toostream de servicios multimedia de Azure y difundir contenido en tiempo real mediante el uso de Azure como plataforma de nube de Hola. Este documento también describe las prácticas recomendadas para crear mecanismos de ingesta en vivo sólidos y de alta redundancia."
services: media-services
documentationcenter: 
author: cenkdin
manager: cfowler
editor: 
ms.assetid: 43fac263-a5ea-44af-8dd5-cc88e423b4de
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/29/2017
ms.author: cenkd;juliako
ms.openlocfilehash: 0c191f8d6c5a595621feaba0e571fb984b666f34
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="azure-media-services-fragmented-mp4-live-ingest-specification"></a><span data-ttu-id="b569d-105">Especificación de la introducción en directo de MP4 fragmentado de Azure Media Services</span><span class="sxs-lookup"><span data-stu-id="b569d-105">Azure Media Services fragmented MP4 live ingest specification</span></span>
<span data-ttu-id="b569d-106">Esta especificación describe el protocolo de Hola y el formato fragmentado MP4-based live streaming ingesta de servicios multimedia de Azure.</span><span class="sxs-lookup"><span data-stu-id="b569d-106">This specification describes hello protocol and format for fragmented MP4-based live streaming ingestion for Azure Media Services.</span></span> <span data-ttu-id="b569d-107">Servicios multimedia proporciona un servicio de transmisión por secuencias en directo que los clientes pueden usar eventos en directo de toostream y difundir contenido en tiempo real mediante el uso de Azure como plataforma de nube de Hola.</span><span class="sxs-lookup"><span data-stu-id="b569d-107">Media Services provides a live streaming service that customers can use toostream live events and broadcast content in real time by using Azure as hello cloud platform.</span></span> <span data-ttu-id="b569d-108">Este documento también describe las prácticas recomendadas para crear mecanismos de ingesta en vivo sólidos y de alta redundancia.</span><span class="sxs-lookup"><span data-stu-id="b569d-108">This document also discusses best practices for building highly redundant and robust live ingest mechanisms.</span></span>

## <a name="1-conformance-notation"></a><span data-ttu-id="b569d-109">1. Notación de cumplimiento</span><span class="sxs-lookup"><span data-stu-id="b569d-109">1. Conformance notation</span></span>
<span data-ttu-id="b569d-110">Hello palabras clave "debe", "no debe," "Requerido", "Se tendrá que", "no deberá," "Debe", "No debería," "Recomendado", "MAY","y"Opcional"en este documento son toobe lo interpretado como que se describen en RFC 2119.</span><span class="sxs-lookup"><span data-stu-id="b569d-110">hello key words "MUST," "MUST NOT," "REQUIRED," "SHALL," "SHALL NOT," "SHOULD," "SHOULD NOT," "RECOMMENDED," "MAY," and "OPTIONAL" in this document are toobe interpreted as they are described in RFC 2119.</span></span>

## <a name="2-service-diagram"></a><span data-ttu-id="b569d-111">2. Diagrama del servicio</span><span class="sxs-lookup"><span data-stu-id="b569d-111">2. Service diagram</span></span>
<span data-ttu-id="b569d-112">Hello siguiente diagrama muestra arquitectura de alto nivel de Hola de hello en vivo de servicio en los servicios multimedia de transmisión por secuencias:</span><span class="sxs-lookup"><span data-stu-id="b569d-112">hello following diagram shows hello high-level architecture of hello live streaming service in Media Services:</span></span>

1. <span data-ttu-id="b569d-113">Un codificador en directo inserta toochannels fuentes en directo que se crea y se suministra a través de hello SDK de servicios multimedia de Azure.</span><span class="sxs-lookup"><span data-stu-id="b569d-113">A live encoder pushes live feeds toochannels that are created and provisioned via hello Azure Media Services SDK.</span></span>
2. <span data-ttu-id="b569d-114">Canales, programas y los extremos de streaming en hello todos live streaming funcionalidades, incluida la introducción, formato, el identificador de servicios multimedia en la nube de DVR, la seguridad, la escalabilidad y la redundancia.</span><span class="sxs-lookup"><span data-stu-id="b569d-114">Channels, programs, and streaming endpoints in Media Services handle all hello live streaming functionalities, including ingest, formatting, cloud DVR, security, scalability, and redundancy.</span></span>
3. <span data-ttu-id="b569d-115">Opcionalmente, los clientes pueden elegir toodeploy una capa de red de entrega de contenido de Azure entre Hola punto de conexión y los puntos de conexión de cliente de Hola de transmisión por secuencias.</span><span class="sxs-lookup"><span data-stu-id="b569d-115">Optionally, customers can choose toodeploy an Azure Content Delivery Network layer between hello streaming endpoint and hello client endpoints.</span></span>
4. <span data-ttu-id="b569d-116">Secuencia de puntos de conexión de cliente de hello extremo de streaming a través de protocolos de transmisión por secuencias adaptativa HTTP.</span><span class="sxs-lookup"><span data-stu-id="b569d-116">Client endpoints stream from hello streaming endpoint by using HTTP Adaptive Streaming protocols.</span></span> <span data-ttu-id="b569d-117">Algunos ejemplos son Microsoft Smooth Streaming, Dynamic Adaptive Streaming sobre HTTP (DASH o MPEG-DASH) y Apple HTTP Live Streaming (HLS).</span><span class="sxs-lookup"><span data-stu-id="b569d-117">Examples include Microsoft Smooth Streaming, Dynamic Adaptive Streaming over HTTP (DASH, or MPEG-DASH), and Apple HTTP Live Streaming (HLS).</span></span>

![flujo de ingestión][image1]

## <a name="3-bitstream-format--iso-14496-12-fragmented-mp4"></a><span data-ttu-id="b569d-119">3. Formato de secuencia de bits: MP4 fragmentado según ISO 14496-12</span><span class="sxs-lookup"><span data-stu-id="b569d-119">3. Bitstream format – ISO 14496-12 fragmented MP4</span></span>
<span data-ttu-id="b569d-120">Hello formato de transmisión por secuencias en directo de introducción se describe en este documento se basa en [ISO-14496-12].</span><span class="sxs-lookup"><span data-stu-id="b569d-120">hello wire format for live streaming ingest discussed in this document is based on [ISO-14496-12].</span></span> <span data-ttu-id="b569d-121">Consulte [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx) para una explicación detallada del formato MP4 fragmentado y de las extensiones tanto para archivos de vídeo bajo demanda como para la ingesta de streaming en vivo.</span><span class="sxs-lookup"><span data-stu-id="b569d-121">For a detailed explanation of fragmented MP4 format and extensions both for video-on-demand files and live streaming ingestion, see [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx).</span></span>

### <a name="live-ingest-format-definitions"></a><span data-ttu-id="b569d-122">Definiciones de formato de introducción en directo</span><span class="sxs-lookup"><span data-stu-id="b569d-122">Live ingest format definitions</span></span>
<span data-ttu-id="b569d-123">Hello lista siguiente describen las definiciones que se aplican toolive Introducción a servicios multimedia de Azure de formato especiales:</span><span class="sxs-lookup"><span data-stu-id="b569d-123">hello following list describes special format definitions that apply toolive ingest into Azure Media Services:</span></span>

1. <span data-ttu-id="b569d-124">Hola **ftyp**, **cuadro del manifiesto de servidor de Live**, y **moov** cuadros deben enviarse con cada solicitud (HTTP POST).</span><span class="sxs-lookup"><span data-stu-id="b569d-124">hello **ftyp**, **Live Server Manifest Box**, and **moov** boxes MUST be sent with each request (HTTP POST).</span></span> <span data-ttu-id="b569d-125">Estos cuadros deben enviarse al principio de Hola de secuencia de Hola y cualquier momento codificador Hola debe volver a conectar tooresume flujo de introducción.</span><span class="sxs-lookup"><span data-stu-id="b569d-125">These boxes MUST be sent at hello beginning of hello stream and any time hello encoder must reconnect tooresume stream ingest.</span></span> <span data-ttu-id="b569d-126">Para más información, consulte la sección 6 en [1].</span><span class="sxs-lookup"><span data-stu-id="b569d-126">For more information, see Section 6 in [1].</span></span>
2. <span data-ttu-id="b569d-127">La sección 3.3.2 en [1] define un cuadro opcional denominado **StreamManifestBox** para la ingestión en vivo.</span><span class="sxs-lookup"><span data-stu-id="b569d-127">Section 3.3.2 in [1] defines an optional box called **StreamManifestBox** for live ingest.</span></span> <span data-ttu-id="b569d-128">Debido a toohello la lógica de enrutamiento del equilibrador de carga de Azure de hello, mediante este cuadro está en desuso.</span><span class="sxs-lookup"><span data-stu-id="b569d-128">Due toohello routing logic of hello Azure load balancer, using this box is deprecated.</span></span> <span data-ttu-id="b569d-129">cuadro de Hello no debe estar presente cuando se recopila en los servicios multimedia.</span><span class="sxs-lookup"><span data-stu-id="b569d-129">hello box SHOULD NOT be present when ingesting into Media Services.</span></span> <span data-ttu-id="b569d-130">Si el cuadro está presente, Media Services lo omite de modo silencioso.</span><span class="sxs-lookup"><span data-stu-id="b569d-130">If this box is present, Media Services silently ignores it.</span></span>
3. <span data-ttu-id="b569d-131">Hola **TrackFragmentExtendedHeaderBox** cuadro definida en 3.2.3.2 en [1] debe estar presente para cada fragmento.</span><span class="sxs-lookup"><span data-stu-id="b569d-131">hello **TrackFragmentExtendedHeaderBox** box defined in 3.2.3.2 in [1] MUST be present for each fragment.</span></span>
4. <span data-ttu-id="b569d-132">Versión 2 de hello **TrackFragmentExtendedHeaderBox** cuadro debe ser toogenerate usa segmentos de medios que tienen direcciones URL idénticas en varios centros de datos.</span><span class="sxs-lookup"><span data-stu-id="b569d-132">Version 2 of hello **TrackFragmentExtendedHeaderBox** box SHOULD be used toogenerate media segments that have identical URLs in multiple datacenters.</span></span> <span data-ttu-id="b569d-133">campo de fragmento de índice de Hello es REQUIRED para conmutación por error de entre centros de datos de los formatos de streaming basada en índice como Apple HLS y MPEG-DASH basada en índice.</span><span class="sxs-lookup"><span data-stu-id="b569d-133">hello fragment index field is REQUIRED for cross-datacenter failover of index-based streaming formats such as Apple HLS and index-based MPEG-DASH.</span></span> <span data-ttu-id="b569d-134">conmutación por error de tooenable entre centros de datos, el índice de fragmento de hello debe sincronizarse a través de varios codificadores y se incrementa en 1 para cada fragmento multimedia sucesivos, incluso en todos los reinicios de codificador o los errores.</span><span class="sxs-lookup"><span data-stu-id="b569d-134">tooenable cross-datacenter failover, hello fragment index MUST be synced across multiple encoders and be increased by 1 for each successive media fragment, even across encoder restarts or failures.</span></span>
5. <span data-ttu-id="b569d-135">Sección 3.3.6 en [1] define un cuadro denominado **MovieFragmentRandomAccessBox** (**mfra**) que se pueden enviar al final de Hola de canal de toohello de ingesta en vivo tooindicate final de secuencia (sobrecargas eléctricas).</span><span class="sxs-lookup"><span data-stu-id="b569d-135">Section 3.3.6 in [1] defines a box called **MovieFragmentRandomAccessBox** (**mfra**) that MAY be sent at hello end of live ingestion tooindicate end-of-stream (EOS) toohello channel.</span></span> <span data-ttu-id="b569d-136">Due toohello introducir lógica de servicios multimedia, utilizando sobrecargas eléctricas está en desuso y Hola **mfra** cuadro para la ingesta en vivo no se enviarán.</span><span class="sxs-lookup"><span data-stu-id="b569d-136">Due toohello ingest logic of Media Services, using EOS is deprecated, and hello **mfra** box for live ingestion SHOULD NOT be sent.</span></span> <span data-ttu-id="b569d-137">Si se envía, Media Services lo omite de modo silencioso.</span><span class="sxs-lookup"><span data-stu-id="b569d-137">If sent, Media Services silently ignores it.</span></span> <span data-ttu-id="b569d-138">estado de hello tooreset de hello introducir punto, se recomienda que use [restablecer el canal](https://docs.microsoft.com/rest/api/media/operations/channel#reset_channels).</span><span class="sxs-lookup"><span data-stu-id="b569d-138">tooreset hello state of hello ingest point, we recommend that you use [Channel Reset](https://docs.microsoft.com/rest/api/media/operations/channel#reset_channels).</span></span> <span data-ttu-id="b569d-139">También se recomienda que use [programa detener](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) tooend una presentación y la secuencia.</span><span class="sxs-lookup"><span data-stu-id="b569d-139">We also recommend that you use [Program Stop](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) tooend a presentation and stream.</span></span>
6. <span data-ttu-id="b569d-140">duración del fragmento Hola MP4 debe ser una constante, tamaño de hello tooreduce de manifiestos de cliente de Hola.</span><span class="sxs-lookup"><span data-stu-id="b569d-140">hello MP4 fragment duration SHOULD be constant, tooreduce hello size of hello client manifests.</span></span> <span data-ttu-id="b569d-141">Una duración del fragmento MP4 constante también mejora la heurística de descarga de cliente mediante el uso de Hola de etiquetas de repetición.</span><span class="sxs-lookup"><span data-stu-id="b569d-141">A constant MP4 fragment duration also improves client download heuristics through hello use of repeat tags.</span></span> <span data-ttu-id="b569d-142">duración de Hello puede fluctuar toocompensate para velocidades de fotogramas no entero.</span><span class="sxs-lookup"><span data-stu-id="b569d-142">hello duration MAY fluctuate toocompensate for non-integer frame rates.</span></span>
7. <span data-ttu-id="b569d-143">duración del fragmento Hola MP4 debe estar entre aproximadamente 2 y 6 segundos.</span><span class="sxs-lookup"><span data-stu-id="b569d-143">hello MP4 fragment duration SHOULD be between approximately 2 and 6 seconds.</span></span>
8. <span data-ttu-id="b569d-144">Las marcas de tiempo de los fragmentos MP4 y los índices (**TrackFragmentExtendedHeaderBox** `fragment_ absolute_ time` y `fragment_index`) DEBERÍAN llegar en orden ascendente.</span><span class="sxs-lookup"><span data-stu-id="b569d-144">MP4 fragment timestamps and indexes (**TrackFragmentExtendedHeaderBox** `fragment_ absolute_ time` and `fragment_index`) SHOULD arrive in increasing order.</span></span> <span data-ttu-id="b569d-145">Aunque los servicios multimedia son fragmentos tooduplicate resistente, tiene limitado fragmentos de tooreorder capacidad según la escala de tiempo de toohello medio.</span><span class="sxs-lookup"><span data-stu-id="b569d-145">Although Media Services is resilient tooduplicate fragments, it has limited ability tooreorder fragments according toohello media timeline.</span></span>

## <a name="4-protocol-format--http"></a><span data-ttu-id="b569d-146">4. Formato de protocolo: HTTP</span><span class="sxs-lookup"><span data-stu-id="b569d-146">4. Protocol format – HTTP</span></span>
<span data-ttu-id="b569d-147">En vivo ISO fragmentado la basada en MP4 ingesta de servicios multimedia usa un estándar HTTP POST solicitud tootransmit codificado medios datos de ejecución prolongada que está empaquetados en el servicio de toohello de formato MP4 fragmentado.</span><span class="sxs-lookup"><span data-stu-id="b569d-147">ISO fragmented MP4-based live ingest for Media Services uses a standard long-running HTTP POST request tootransmit encoded media data that is packaged in fragmented MP4 format toohello service.</span></span> <span data-ttu-id="b569d-148">Cada POST de HTTP envía una completa fragmentado secuencia de bits MP4 ("stream"), desde el principio de hello con cuadros de encabezado (**ftyp**, **cuadro del manifiesto de servidor de Live**, y **moov** cuadros) y continuando con una secuencia de fragmentos (**moof** y **mdat** cuadros).</span><span class="sxs-lookup"><span data-stu-id="b569d-148">Each HTTP POST sends a complete fragmented MP4 bitstream ("stream"), starting from hello beginning with header boxes (**ftyp**, **Live Server Manifest Box**, and **moov** boxes), and continuing with a sequence of fragments (**moof** and **mdat** boxes).</span></span> <span data-ttu-id="b569d-149">Sintaxis de dirección URL de solicitud HTTP POST de hello, vea la sección 9.2 en [1].</span><span class="sxs-lookup"><span data-stu-id="b569d-149">For URL syntax for hello HTTP POST request, see section 9.2 in [1].</span></span> <span data-ttu-id="b569d-150">Es un ejemplo de Hola dirección URL de POST:</span><span class="sxs-lookup"><span data-stu-id="b569d-150">An example of hello POST URL is:</span></span> 

    http://customer.channel.mediaservices.windows.net/ingest.isml/streams(720p)

### <a name="requirements"></a><span data-ttu-id="b569d-151">Requisitos</span><span class="sxs-lookup"><span data-stu-id="b569d-151">Requirements</span></span>
<span data-ttu-id="b569d-152">Estos son Hola requisitos detallados:</span><span class="sxs-lookup"><span data-stu-id="b569d-152">Here are hello detailed requirements:</span></span>

1. <span data-ttu-id="b569d-153">Hello codificador debe iniciarse Hola difundir enviando una solicitud HTTP POST con vacío "cuerpo" (longitud de contenido cero) mediante el uso de Hola la misma dirección URL de recopilación.</span><span class="sxs-lookup"><span data-stu-id="b569d-153">hello encoder SHOULD start hello broadcast by sending an HTTP POST request with an empty “body” (zero content length) by using hello same ingestion URL.</span></span> <span data-ttu-id="b569d-154">Esto puede ayudar a codificador Hola detectar rápidamente si el punto de conexión de hello ingesta en vivo es válido y si no hay ninguna autenticación u otras condiciones necesarios.</span><span class="sxs-lookup"><span data-stu-id="b569d-154">This can help hello encoder quickly detect whether hello live ingestion endpoint is valid, and if there are any authentication or other conditions required.</span></span> <span data-ttu-id="b569d-155">Por el protocolo HTTP, Hola servidor no devolvió una respuesta HTTP hasta hello completa, incluido el cuerpo POST hello, se recibe una solicitud.</span><span class="sxs-lookup"><span data-stu-id="b569d-155">Per HTTP protocol, hello server can't send back an HTTP response until hello entire request, including hello POST body, is received.</span></span> <span data-ttu-id="b569d-156">Dada la naturaleza de ejecución prolongada de Hola de un evento en directo, sin este paso, el codificador de hello podría no ser capaz de toodetect cualquier error hasta que termine de enviar todos los datos de Hola.</span><span class="sxs-lookup"><span data-stu-id="b569d-156">Given hello long-running nature of a live event, without this step, hello encoder might not be able toodetect any error until it finishes sending all hello data.</span></span>
2. <span data-ttu-id="b569d-157">Codificador de Hello debe controlar los errores o los desafíos de autenticación debido a (1).</span><span class="sxs-lookup"><span data-stu-id="b569d-157">hello encoder MUST handle any errors or authentication challenges because of (1).</span></span> <span data-ttu-id="b569d-158">Si (1) se realiza correctamente con una respuesta 200, continúe.</span><span class="sxs-lookup"><span data-stu-id="b569d-158">If (1) succeeds with a 200 response, continue.</span></span>
3. <span data-ttu-id="b569d-159">Codificador de Hello debe iniciar una nueva solicitud de HTTP POST con flujo de MP4 de hello fragmentado.</span><span class="sxs-lookup"><span data-stu-id="b569d-159">hello encoder MUST start a new HTTP POST request with hello fragmented MP4 stream.</span></span> <span data-ttu-id="b569d-160">carga de Hello debe empezar con los cuadros de encabezado de hello, seguidos de fragmentos.</span><span class="sxs-lookup"><span data-stu-id="b569d-160">hello payload MUST start with hello header boxes, followed by fragments.</span></span> <span data-ttu-id="b569d-161">Tenga en cuenta que hello **ftyp**, **cuadro del manifiesto de servidor de Live**, y **moov** cuadros (en este orden) se deben enviar con cada solicitud, incluso si el codificador de hello debe volver a conectarse porque Hola la solicitud anterior finalizó toohello anterior final de secuencia de Hola.</span><span class="sxs-lookup"><span data-stu-id="b569d-161">Note that hello **ftyp**, **Live Server Manifest Box**, and **moov** boxes (in this order) MUST be sent with each request, even if hello encoder must reconnect because hello previous request was terminated prior toohello end of hello stream.</span></span> 
4. <span data-ttu-id="b569d-162">Codificador de Hola debe utilizar la codificación para cargar fragmentada, porque es imposible toopredict Hola todo longitud del contenido de hello activas eventos.</span><span class="sxs-lookup"><span data-stu-id="b569d-162">hello encoder MUST use chunked transfer encoding for uploading, because it’s impossible toopredict hello entire content length of hello live event.</span></span>
5. <span data-ttu-id="b569d-163">Cuando el evento de hello es a través, después de enviar el último fragmento de hello, codificador Hola debe finalizar correctamente Hola fragmentada la secuencia del mensaje (mayoría pilas de cliente HTTP controlen automáticamente) de codificación de transferencia.</span><span class="sxs-lookup"><span data-stu-id="b569d-163">When hello event is over, after sending hello last fragment, hello encoder MUST gracefully end hello chunked transfer encoding message sequence (most HTTP client stacks handle it automatically).</span></span> <span data-ttu-id="b569d-164">Codificador de Hello debe esperar para código de hello servicio tooreturn Hola respuesta final y, a continuación, terminan conexión Hola.</span><span class="sxs-lookup"><span data-stu-id="b569d-164">hello encoder MUST wait for hello service tooreturn hello final response code, and then terminate hello connection.</span></span> 
6. <span data-ttu-id="b569d-165">Codificador de Hello no debe usar hello `Events()` sustantivo tal como se describe en 9.2 [1] para la ingesta en vivo en los servicios multimedia.</span><span class="sxs-lookup"><span data-stu-id="b569d-165">hello encoder MUST NOT use hello `Events()` noun as described in 9.2 in [1] for live ingestion into Media Services.</span></span>
7. <span data-ttu-id="b569d-166">Si finaliza la solicitud HTTP POST de Hola u horas con un extremo TCP error toohello anterior del flujo de hello, codificador Hola debe emitir una nueva solicitud POST con una conexión nueva y siga Hola requisitos anteriores.</span><span class="sxs-lookup"><span data-stu-id="b569d-166">If hello HTTP POST request terminates or times out with a TCP error prior toohello end of hello stream, hello encoder MUST issue a new POST request by using a new connection, and follow hello preceding requirements.</span></span> <span data-ttu-id="b569d-167">Además, codificador Hola debe reenviar Hola anterior dos fragmentos de MP4 de cada pista en secuencia de Hola y reanudar sin introducir una discontinuidad en la escala de tiempo de hello medio.</span><span class="sxs-lookup"><span data-stu-id="b569d-167">Additionally, hello encoder MUST resend hello previous two MP4 fragments for each track in hello stream, and resume without introducing a discontinuity in hello media timeline.</span></span> <span data-ttu-id="b569d-168">Volver a enviar Hola últimos dos fragmentos de MP4 de cada pista garantiza que no hay ninguna pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="b569d-168">Resending hello last two MP4 fragments for each track ensures that there is no data loss.</span></span> <span data-ttu-id="b569d-169">En otras palabras, si una secuencia contiene un sonido y una pista de vídeo y se produce un error en la solicitud POST actual de hello, debe volver a conectar el codificador de Hola y reenvió Hola últimos dos fragmentos de pista de audio de hello, que anteriormente se han enviado correctamente, y Hola dos últimas fragmentos para Hola pista de vídeo, que previamente enviados correctamente, tooensure que no hay ninguna pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="b569d-169">In other words, if a stream contains both an audio and a video track, and hello current POST request fails, hello encoder must reconnect and resend hello last two fragments for hello audio track, which were previously successfully sent, and hello last two fragments for hello video track, which were previously successfully sent, tooensure that there is no data loss.</span></span> <span data-ttu-id="b569d-170">Codificador de Hello debe mantener un búfer "forward" de los fragmentos multimedia, que vuelve a enviar cuando se vuelve a conectar.</span><span class="sxs-lookup"><span data-stu-id="b569d-170">hello encoder MUST maintain a “forward” buffer of media fragments, which it resends when it reconnects.</span></span>

## <a name="5-timescale"></a><span data-ttu-id="b569d-171">5. Escala de tiempo</span><span class="sxs-lookup"><span data-stu-id="b569d-171">5. Timescale</span></span>
<span data-ttu-id="b569d-172">[[MS-SSTR] ](https://msdn.microsoft.com/library/ff469518.aspx) describe el uso de Hola de escala de tiempo para **SmoothStreamingMedia** (sección 2.2.2.1), **StreamElement** (sección 2.2.2.3), **StreamFragmentElement**(Sección 2.2.2.6), y **LiveSMIL** (sección 2.2.7.3.1).</span><span class="sxs-lookup"><span data-stu-id="b569d-172">[[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx) describes hello usage of timescale for **SmoothStreamingMedia** (Section 2.2.2.1), **StreamElement** (Section 2.2.2.3), **StreamFragmentElement** (Section 2.2.2.6), and **LiveSMIL** (Section 2.2.7.3.1).</span></span> <span data-ttu-id="b569d-173">Si el valor de escala de tiempo de hello no está presente, el valor predeterminado de hello usado es 10.000.000 (10 MHz).</span><span class="sxs-lookup"><span data-stu-id="b569d-173">If hello timescale value is not present, hello default value used is 10,000,000 (10 MHz).</span></span> <span data-ttu-id="b569d-174">Aunque Hola especificación de formato de transmisión por secuencias suave no bloquea el uso de otros valores de escala de tiempo, la mayoría de las implementaciones de codificador usa este valor predeterminado toogenerate valor (10 MHz) Smooth Streaming introducir datos.</span><span class="sxs-lookup"><span data-stu-id="b569d-174">Although hello Smooth Streaming format specification doesn’t block usage of other timescale values, most encoder implementations use this default value (10 MHz) toogenerate Smooth Streaming ingest data.</span></span> <span data-ttu-id="b569d-175">Due toohello [empaquetado dinámico de Azure Media](media-services-dynamic-packaging-overview.md) característica, se recomienda usar una escala de tiempo de 90 KHz para secuencias de vídeo y 44,1 KHz o 48.1 KHz para secuencias de audio.</span><span class="sxs-lookup"><span data-stu-id="b569d-175">Due toohello [Azure Media Dynamic Packaging](media-services-dynamic-packaging-overview.md) feature, we recommend that you use a 90-KHz timescale for video streams and 44.1 KHz or 48.1 KHz for audio streams.</span></span> <span data-ttu-id="b569d-176">Si se utilizan valores de escala de tiempo diferente para las secuencias diferentes, se debe enviar la escala temporal del nivel de la secuencia de Hola.</span><span class="sxs-lookup"><span data-stu-id="b569d-176">If different timescale values are used for different streams, hello stream-level timescale MUST be sent.</span></span> <span data-ttu-id="b569d-177">Para más información, consulte [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).</span><span class="sxs-lookup"><span data-stu-id="b569d-177">For more information, see [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).</span></span>     

## <a name="6-definition-of-stream"></a><span data-ttu-id="b569d-178">6. Definición de "secuencia"</span><span class="sxs-lookup"><span data-stu-id="b569d-178">6. Definition of “stream”</span></span>
<span data-ttu-id="b569d-179">Secuencia es Hola unidad básica de operación de ingesta en vivo para crear presentaciones en directo, control de transmisión por secuencias de conmutación por error y escenarios de redundancia.</span><span class="sxs-lookup"><span data-stu-id="b569d-179">Stream is hello basic unit of operation in live ingestion for composing live presentations, handling streaming failover, and redundancy scenarios.</span></span> <span data-ttu-id="b569d-180">"Secuencia" se define como una única secuencia de bits MP4 fragmentada que puede contener una sola pista o varias pistas.</span><span class="sxs-lookup"><span data-stu-id="b569d-180">Stream is defined as one unique, fragmented MP4 bitstream that might contain a single track or multiple tracks.</span></span> <span data-ttu-id="b569d-181">Una presentación en directo completa puede contener uno o varios flujos, dependiendo de los codificadores en directo de hello configuración de Hola.</span><span class="sxs-lookup"><span data-stu-id="b569d-181">A full live presentation might contain one or more streams, depending on hello configuration of hello live encoders.</span></span> <span data-ttu-id="b569d-182">Hello en los ejemplos siguientes muestra distintas opciones de uso de secuencias toocompose una presentación en directo completa.</span><span class="sxs-lookup"><span data-stu-id="b569d-182">hello following examples illustrate various options of using streams toocompose a full live presentation.</span></span>

<span data-ttu-id="b569d-183">**Ejemplo:**</span><span class="sxs-lookup"><span data-stu-id="b569d-183">**Example:**</span></span> 

<span data-ttu-id="b569d-184">Un cliente desea toocreate una presentación de transmisión por secuencias en directo que incluye Hola siguientes velocidades de bits de audio/vídeo:</span><span class="sxs-lookup"><span data-stu-id="b569d-184">A customer wants toocreate a live streaming presentation that includes hello following audio/video bitrates:</span></span>

<span data-ttu-id="b569d-185">Vídeo: 3000 kbps, 1500 kbps, 750 kbps</span><span class="sxs-lookup"><span data-stu-id="b569d-185">Video – 3000 kbps, 1500 kbps, 750 kbps</span></span>

<span data-ttu-id="b569d-186">Audio: 128 kbps</span><span class="sxs-lookup"><span data-stu-id="b569d-186">Audio – 128 kbps</span></span>

### <a name="option-1-all-tracks-in-one-stream"></a><span data-ttu-id="b569d-187">Opción 1: todas las pistas de una secuencia</span><span class="sxs-lookup"><span data-stu-id="b569d-187">Option 1: All tracks in one stream</span></span>
<span data-ttu-id="b569d-188">En esta opción, un único codificador genera todas las pistas de audio y vídeo y, a continuación, las agrupa en una secuencia de bits MP4 fragmentada.</span><span class="sxs-lookup"><span data-stu-id="b569d-188">In this option, a single encoder generates all audio/video tracks, and then bundles them into one fragmented MP4 bitstream.</span></span> <span data-ttu-id="b569d-189">Hola fragmentado MP4 secuencia de bits, a continuación, se envía a través de una sola conexión de HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="b569d-189">hello fragmented MP4 bitstream is then sent via a single HTTP POST connection.</span></span> <span data-ttu-id="b569d-190">En este ejemplo, solo hay una secuencia para esta presentación en directo.</span><span class="sxs-lookup"><span data-stu-id="b569d-190">In this example, there is only one stream for this live presentation.</span></span>

![Secuencias: una pista][image2]

### <a name="option-2-each-track-in-a-separate-stream"></a><span data-ttu-id="b569d-192">Opción 2: Cada pista de una secuencia independiente</span><span class="sxs-lookup"><span data-stu-id="b569d-192">Option 2: Each track in a separate stream</span></span>
<span data-ttu-id="b569d-193">En esta opción, codificador Hola coloca una pista en cada secuencia de bits de fragmento MP4 y, a continuación, registra todas las secuencias de Hola a través de conexiones HTTP independientes.</span><span class="sxs-lookup"><span data-stu-id="b569d-193">In this option, hello encoder puts one track into each fragment MP4 bitstream, and then posts all of hello streams over separate HTTP connections.</span></span> <span data-ttu-id="b569d-194">Esto se puede realizar con un codificador o con varios.</span><span class="sxs-lookup"><span data-stu-id="b569d-194">This can be done with one encoder or with multiple encoders.</span></span> <span data-ttu-id="b569d-195">ingesta en vivo de Hello ve esta presentación en directo, tal y como se compone de cuatro secuencias.</span><span class="sxs-lookup"><span data-stu-id="b569d-195">hello live ingestion sees this live presentation as composed of four streams.</span></span>

![Secuencias: pistas independientes][image3]

### <a name="option-3-bundle-audio-track-with-hello-lowest-bitrate-video-track-into-one-stream"></a><span data-ttu-id="b569d-197">Opción 3: Agrupar pista de audio con la pista de vídeo de velocidad de bits más baja hello en una secuencia</span><span class="sxs-lookup"><span data-stu-id="b569d-197">Option 3: Bundle audio track with hello lowest bitrate video track into one stream</span></span>
<span data-ttu-id="b569d-198">En esta opción, el cliente de hello elige pista de audio de Hola de toobundle con pista de vídeo de velocidades de bits bajas de hello en la secuencia de bits de un fragmento MP4 y deje Hola otros dos pistas de vídeo como secuencias independientes.</span><span class="sxs-lookup"><span data-stu-id="b569d-198">In this option, hello customer chooses toobundle hello audio track with hello lowest-bitrate video track in one fragment MP4 bitstream, and leave hello other two video tracks as separate streams.</span></span> 

![Secuencias: pistas de audio y vídeo][image4]

### <a name="summary"></a><span data-ttu-id="b569d-200">Resumen</span><span class="sxs-lookup"><span data-stu-id="b569d-200">Summary</span></span>
<span data-ttu-id="b569d-201">Esta no es una lista exhaustiva de todas las opciones de ingestión posibles para este ejemplo.</span><span class="sxs-lookup"><span data-stu-id="b569d-201">This is not an exhaustive list of all possible ingestion options for this example.</span></span> <span data-ttu-id="b569d-202">De hecho, cualquier agrupación de pistas en secuencias es compatible con la ingesta en vivo.</span><span class="sxs-lookup"><span data-stu-id="b569d-202">As a matter of fact, any grouping of tracks into streams is supported by live ingestion.</span></span> <span data-ttu-id="b569d-203">Los clientes y los proveedores de codificación pueden elegir sus propias implementaciones en función de la complejidad de ingeniería, de la capacidad del codificador, y de las consideraciones de redundancia y conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="b569d-203">Customers and encoder vendors can choose their own implementations based on engineering complexity, encoder capacity, and redundancy and failover considerations.</span></span> <span data-ttu-id="b569d-204">Sin embargo, en la mayoría de los casos, hay sólo una pista de audio para toda la presentación en directo Hola.</span><span class="sxs-lookup"><span data-stu-id="b569d-204">However, in most cases, there is only one audio track for hello entire live presentation.</span></span> <span data-ttu-id="b569d-205">Por lo tanto, es importante tooensure Hola buen estado del programa Hola a introducir flujo que contiene la pista de audio de Hola. Esta consideración a menudo como resultado poner pista de audio de hello en su propio flujo (como en la opción 2) o unión con la pista de vídeo de velocidades de bits bajas hello (como en la opción 3).</span><span class="sxs-lookup"><span data-stu-id="b569d-205">So, it’s important tooensure hello healthiness of hello ingest stream that contains hello audio track. This consideration often results in putting hello audio track in its own stream (as in Option 2) or bundling it with hello lowest-bitrate video track (as in Option 3).</span></span> <span data-ttu-id="b569d-206">Además, para una mejor redundancia y tolerancia a errores, enviar Hola misma pista de audio en dos secuencias diferentes (opción 2 con pistas de audio redundantes) o agrupación pista de audio de hello con al menos dos de pistas de vídeo de velocidades de bits bajas de hello (opción 3 con el audio a secuencias de vídeo de dos menos) es muy recomendable para en vivo en los servicios multimedia de introducción.</span><span class="sxs-lookup"><span data-stu-id="b569d-206">Also, for better redundancy and fault tolerance, sending hello same audio track in two different streams (Option 2 with redundant audio tracks) or bundling hello audio track with at least two of hello lowest-bitrate video tracks (Option 3 with audio bundled in at least two video streams) is highly recommended for live ingest into Media Services.</span></span>

## <a name="7-service-failover"></a><span data-ttu-id="b569d-207">7. Conmutación por error del servicio</span><span class="sxs-lookup"><span data-stu-id="b569d-207">7. Service failover</span></span>
<span data-ttu-id="b569d-208">Dada la naturaleza de Hola de transmisión por secuencias en directo, es fundamental para garantizar la disponibilidad del servicio de Hola Hola compatibilidad con buena conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="b569d-208">Given hello nature of live streaming, good failover support is critical for ensuring hello availability of hello service.</span></span> <span data-ttu-id="b569d-209">Servicios multimedia es toohandle diseñada diversos tipos de errores, incluidos los errores de red, errores de servidor y problemas de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="b569d-209">Media Services is designed toohandle various types of failures, including network errors, server errors, and storage issues.</span></span> <span data-ttu-id="b569d-210">Cuando se utiliza junto con la lógica adecuada de conmutación por error del lado de codificador en directo de hello, los clientes pueden lograr un servicio de transmisión por secuencias en directo altamente confiable de nube de Hola.</span><span class="sxs-lookup"><span data-stu-id="b569d-210">When used in conjunction with proper failover logic from hello live encoder side, customers can achieve a highly reliable live streaming service from hello cloud.</span></span>

<span data-ttu-id="b569d-211">En esta sección, trataremos los escenarios de conmutación por error del servicio.</span><span class="sxs-lookup"><span data-stu-id="b569d-211">In this section, we discuss service failover scenarios.</span></span> <span data-ttu-id="b569d-212">En este caso, error Hola ocurre en algún lugar dentro de servicio de Hola y se manifiesta como un error de red.</span><span class="sxs-lookup"><span data-stu-id="b569d-212">In this case, hello failure happens somewhere within hello service, and it manifests itself as a network error.</span></span> <span data-ttu-id="b569d-213">Estas son algunas recomendaciones para la implementación del codificador Hola para controlar la conmutación por error de servicio:</span><span class="sxs-lookup"><span data-stu-id="b569d-213">Here are some recommendations for hello encoder implementation for handling service failover:</span></span>

1. <span data-ttu-id="b569d-214">Utilice un tiempo de espera de 10 segundos para establecer la conexión de TCP de Hola.</span><span class="sxs-lookup"><span data-stu-id="b569d-214">Use a 10-second timeout for establishing hello TCP connection.</span></span> <span data-ttu-id="b569d-215">Si una conexión de intento tooestablish Hola tarda más de 10 segundos, anular la operación de Hola y vuelva a intentarlo.</span><span class="sxs-lookup"><span data-stu-id="b569d-215">If an attempt tooestablish hello connection takes longer than 10 seconds, abort hello operation and try again.</span></span> 
2. <span data-ttu-id="b569d-216">Utilice un tiempo de espera corto para el envío de fragmentos de mensajes de solicitud de hello HTTP.</span><span class="sxs-lookup"><span data-stu-id="b569d-216">Use a short timeout for sending hello HTTP request message chunks.</span></span> <span data-ttu-id="b569d-217">Si la duración del fragmento de MP4 de destino de hello es N segundos, usar un tiempo de espera de envío entre N y 2 N segundos; Por ejemplo, si la duración del fragmento MP4 hello es de 6 segundos, utilice un tiempo de espera de 6 segundos too12.</span><span class="sxs-lookup"><span data-stu-id="b569d-217">If hello target MP4 fragment duration is N seconds, use a send timeout between N and 2 N seconds; for example, if hello MP4 fragment duration is 6 seconds, use a timeout of 6 too12 seconds.</span></span> <span data-ttu-id="b569d-218">Si se produce un tiempo de espera, restablecer la conexión de hello, abra una conexión nueva y secuencia de reanudación de introducción en las conexiones nuevas Hola.</span><span class="sxs-lookup"><span data-stu-id="b569d-218">If a timeout occurs, reset hello connection, open a new connection, and resume stream ingest on hello new connection.</span></span> 
3. <span data-ttu-id="b569d-219">Mantener un búfer gradual con hello última dos fragmentos de cada pista que se enviaron correctamente y completamente toohello servicio.</span><span class="sxs-lookup"><span data-stu-id="b569d-219">Maintain a rolling buffer that has hello last two fragments for each track that were successfully and completely sent toohello service.</span></span>  <span data-ttu-id="b569d-220">Si solicitud HTTP POST de Hola para un flujo de tiempo de espera toohello anterior final de secuencia de Hola o se termina, abrir una nueva conexión y comenzar otra solicitud HTTP POST, enviar encabezados de la secuencia de hello, reenviar Hola última dos fragmentos de cada pista y reanudar el flujo de hello sin Introducción a una discontinuidad en la escala de tiempo de hello medio.</span><span class="sxs-lookup"><span data-stu-id="b569d-220">If hello HTTP POST request for a stream is terminated or times out prior toohello end of hello stream, open a new connection and begin another HTTP POST request, resend hello stream headers, resend hello last two fragments for each track, and resume hello stream without introducing a discontinuity in hello media timeline.</span></span> <span data-ttu-id="b569d-221">Esto reduce la posibilidad de Hola de pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="b569d-221">This reduces hello chance of data loss.</span></span>
4. <span data-ttu-id="b569d-222">Se recomienda que codificador hello no limitar número de Hola de reintentos tooestablish una conexión o reanudar la transmisión por secuencias cuando se produce un error TCP.</span><span class="sxs-lookup"><span data-stu-id="b569d-222">We recommend that hello encoder does NOT limit hello number of retries tooestablish a connection or resume streaming after a TCP error occurs.</span></span>
5. <span data-ttu-id="b569d-223">Después de un error TCP:</span><span class="sxs-lookup"><span data-stu-id="b569d-223">After a TCP error:</span></span>
  
    <span data-ttu-id="b569d-224">a.</span><span class="sxs-lookup"><span data-stu-id="b569d-224">a.</span></span> <span data-ttu-id="b569d-225">se debe cerrar la conexión actual de Hola y debe crearse una nueva conexión para una nueva solicitud HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="b569d-225">hello current connection MUST be closed, and a new connection MUST be created for a new HTTP POST request.</span></span>

    <span data-ttu-id="b569d-226">b.</span><span class="sxs-lookup"><span data-stu-id="b569d-226">b.</span></span> <span data-ttu-id="b569d-227">Hola nueva HTTP POST dirección URL debe ser igual que Hola inicial de dirección URL de POST Hola.</span><span class="sxs-lookup"><span data-stu-id="b569d-227">hello new HTTP POST URL MUST be hello same as hello initial POST URL.</span></span>
  
    <span data-ttu-id="b569d-228">c.</span><span class="sxs-lookup"><span data-stu-id="b569d-228">c.</span></span> <span data-ttu-id="b569d-229">Hello nueva HTTP POST debe incluir encabezados de secuencia (**ftyp**, **cuadro del manifiesto de servidor de Live**, y **moov** cuadros) que son encabezados de la secuencia de toohello idénticos en hello inicial POST.</span><span class="sxs-lookup"><span data-stu-id="b569d-229">hello new HTTP POST MUST include stream headers (**ftyp**, **Live Server Manifest Box**, and **moov** boxes) that are identical toohello stream headers in hello initial POST.</span></span>
  
    <span data-ttu-id="b569d-230">d.</span><span class="sxs-lookup"><span data-stu-id="b569d-230">d.</span></span> <span data-ttu-id="b569d-231">deben volver a enviarse dos últimas fragmentos Hola enviados de cada pista y transmisión por secuencias debe reanudar sin introducir una discontinuidad en la escala de tiempo de hello medio.</span><span class="sxs-lookup"><span data-stu-id="b569d-231">hello last two fragments sent for each track must be resent, and streaming must resume without introducing a discontinuity in hello media timeline.</span></span> <span data-ttu-id="b569d-232">Hola marcas de tiempo de fragmento MP4 debe aumentar de forma continua, incluso a través de solicitudes HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="b569d-232">hello MP4 fragment timestamps must increase continuously, even across HTTP POST requests.</span></span>
6. <span data-ttu-id="b569d-233">Codificador de Hello debe finalizar la solicitud HTTP POST de hello si no se envía datos a una velocidad según la duración del fragmento MP4 Hola.</span><span class="sxs-lookup"><span data-stu-id="b569d-233">hello encoder SHOULD terminate hello HTTP POST request if data is not being sent at a rate commensurate with hello MP4 fragment duration.</span></span>  <span data-ttu-id="b569d-234">Una solicitud HTTP POST que no envía datos puede impedir que los servicios multimedia rápidamente desconectando codificador hello en caso de hello de una actualización de servicio.</span><span class="sxs-lookup"><span data-stu-id="b569d-234">An HTTP POST request that does not send data can prevent Media Services from quickly disconnecting from hello encoder in hello event of a service update.</span></span> <span data-ttu-id="b569d-235">Por esta razón, Hola HTTP POST para dispersas (señal de anuncio) realiza un seguimiento debe ser de corta duración, terminar tan pronto como fragmento disperso Hola se envía.</span><span class="sxs-lookup"><span data-stu-id="b569d-235">For this reason, hello HTTP POST for sparse (ad signal) tracks SHOULD be short-lived, terminating as soon as hello sparse fragment is sent.</span></span>

## <a name="8-encoder-failover"></a><span data-ttu-id="b569d-236">8. Conmutación por error del codificador</span><span class="sxs-lookup"><span data-stu-id="b569d-236">8. Encoder failover</span></span>
<span data-ttu-id="b569d-237">Conmutación por error del codificador es el segundo tipo de escenario de conmutación por error que necesita toobe dirigirse para la entrega de transmisión por secuencias en directo-to-end de Hola.</span><span class="sxs-lookup"><span data-stu-id="b569d-237">Encoder failover is hello second type of failover scenario that needs toobe addressed for end-to-end live streaming delivery.</span></span> <span data-ttu-id="b569d-238">En este escenario, condición de error de Hola se produce en el lado del codificador de Hola.</span><span class="sxs-lookup"><span data-stu-id="b569d-238">In this scenario, hello error condition occurs on hello encoder side.</span></span> 

![conmutación por error del codificador][image5]

<span data-ttu-id="b569d-240">Hola siguiendo las expectativas se aplica desde el punto de conexión de hello ingesta en directo cuando se produce la conmutación por error del codificador:</span><span class="sxs-lookup"><span data-stu-id="b569d-240">hello following expectations apply from hello live ingestion endpoint when encoder failover happens:</span></span>

1. <span data-ttu-id="b569d-241">Una nueva instancia de codificador debe crearse toocontinue transmisión por secuencias, como se muestra en el diagrama de hello (secuencia de vídeo con línea discontinua de 3000k).</span><span class="sxs-lookup"><span data-stu-id="b569d-241">A new encoder instance SHOULD be created toocontinue streaming, as illustrated in hello diagram (Stream for 3000k video, with dashed line).</span></span>
2. <span data-ttu-id="b569d-242">DEBE usar Hola misma dirección URL de HTTP POST solicita como Hola de nuevo codificador de Hello error instancia.</span><span class="sxs-lookup"><span data-stu-id="b569d-242">hello new encoder MUST use hello same URL for HTTP POST requests as hello failed instance.</span></span>
3. <span data-ttu-id="b569d-243">Hello solicitud POST del nuevo codificador debe incluir Hola mismo fragmentado MP4 cuadros de encabezado como Hola instancia con errores.</span><span class="sxs-lookup"><span data-stu-id="b569d-243">hello new encoder’s POST request MUST include hello same fragmented MP4 header boxes as hello failed instance.</span></span>
4. <span data-ttu-id="b569d-244">nuevo codificador de Hello debe sincronizarse correctamente con todos los demás codificadores de ejecución para hello mismo toogenerate de presentación en directo sincronizó muestras de audio/vídeo con los límites del fragmento alineado.</span><span class="sxs-lookup"><span data-stu-id="b569d-244">hello new encoder MUST be properly synced with all other running encoders for hello same live presentation toogenerate synced audio/video samples with aligned fragment boundaries.</span></span>
5. <span data-ttu-id="b569d-245">nuevo flujo de Hello debe ser semánticamente equivalente con secuencia anterior de hello e intercambiables en los niveles de encabezado y el fragmento de Hola.</span><span class="sxs-lookup"><span data-stu-id="b569d-245">hello new stream MUST be semantically equivalent with hello previous stream, and interchangeable at hello header and fragment levels.</span></span>
6. <span data-ttu-id="b569d-246">nuevo codificador de Hello debe intentar toominimize pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="b569d-246">hello new encoder SHOULD try toominimize data loss.</span></span> <span data-ttu-id="b569d-247">Hola `fragment_absolute_time` y `fragment_index` de medios deben aumentar los fragmentos desde punto de Hola donde codificador Hola detuvo la última vez.</span><span class="sxs-lookup"><span data-stu-id="b569d-247">hello `fragment_absolute_time` and `fragment_index` of media fragments SHOULD increase from hello point where hello encoder last stopped.</span></span> <span data-ttu-id="b569d-248">Hola `fragment_absolute_time` y `fragment_index` debería aumentar de forma continua, pero resulta toointroduce admisible una discontinuidad, si es necesario.</span><span class="sxs-lookup"><span data-stu-id="b569d-248">hello `fragment_absolute_time` and `fragment_index` SHOULD increase in a continuous manner, but it is permissible toointroduce a discontinuity, if necessary.</span></span> <span data-ttu-id="b569d-249">Servicios multimedia omite los fragmentos que ya ha recibido y procesado, por lo que es mejor tooerr en lado de Hola de volverlo a enviar fragmentos que toointroduce discontinuidades en la escala de tiempo de hello medio.</span><span class="sxs-lookup"><span data-stu-id="b569d-249">Media Services ignores fragments that it has already received and processed, so it's better tooerr on hello side of resending fragments than toointroduce discontinuities in hello media timeline.</span></span> 

## <a name="9-encoder-redundancy"></a><span data-ttu-id="b569d-250">9. Redundancia del codificador</span><span class="sxs-lookup"><span data-stu-id="b569d-250">9. Encoder redundancy</span></span>
<span data-ttu-id="b569d-251">Para ciertos eventos críticos en directo que petición incluso mayor disponibilidad y calidad de la experiencia, se recomienda usar codificadores redundantes activo-activo tooachieve sin problemas de conmutación por error sin pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="b569d-251">For certain critical live events that demand even higher availability and quality of experience, we recommended that you use active-active redundant encoders tooachieve seamless failover with no data loss.</span></span>

![redundancia del codificador][image6]

<span data-ttu-id="b569d-253">Tal y como se muestra en este diagrama, dos grupos de codificadores inserción dos copias de cada secuencia simultáneamente en el servicio de live Hola.</span><span class="sxs-lookup"><span data-stu-id="b569d-253">As illustrated in this diagram, two groups of encoders push two copies of each stream simultaneously into hello live service.</span></span> <span data-ttu-id="b569d-254">Esta configuración se admite porque Media Services puede filtrar fragmentos duplicados según el identificador de secuencia y la marca de tiempo del fragmento.</span><span class="sxs-lookup"><span data-stu-id="b569d-254">This setup is supported because Media Services can filter out duplicate fragments based on stream ID and fragment timestamp.</span></span> <span data-ttu-id="b569d-255">Hola resultante secuencia en directo y de archivo son una sola copia de todas las secuencias de hello es Hola la agregación mejor posible de dos orígenes de Hola.</span><span class="sxs-lookup"><span data-stu-id="b569d-255">hello resulting live stream and archive is a single copy of all hello streams that is hello best possible aggregation from hello two sources.</span></span> <span data-ttu-id="b569d-256">Por ejemplo, en un caso extremo hipotético, siempre que hay un codificador (no tiene toobe Hola uno mismo) ejecutando en un momento dado en el tiempo para cada secuencia, hello resultante de la secuencia en directo desde el servicio de hello es continua sin pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="b569d-256">For example, in a hypothetical extreme case, as long as there is one encoder (it doesn’t have toobe hello same one) running at any given point in time for each stream, hello resulting live stream from hello service is continuous without data loss.</span></span> 

<span data-ttu-id="b569d-257">requisitos de Hola para este escenario son casi Hola igual como requisitos de hello en caso de "Codificador conmutación por error" ¡hello, con excepción de Hola que se ejecutan segundo conjunto de codificadores de hello en hello mismo tiempo como Hola codificadores principales.</span><span class="sxs-lookup"><span data-stu-id="b569d-257">hello requirements for this scenario are almost hello same as hello requirements in hello "Encoder failover" case, with hello exception that hello second set of encoders are running at hello same time as hello primary encoders.</span></span>

## <a name="10-service-redundancy"></a><span data-ttu-id="b569d-258">10. Redundancia del servicio</span><span class="sxs-lookup"><span data-stu-id="b569d-258">10. Service redundancy</span></span>
<span data-ttu-id="b569d-259">Para la distribución global gran redundancia, a veces deben tener desastres regionales toohandle de copia de seguridad entre regiones.</span><span class="sxs-lookup"><span data-stu-id="b569d-259">For highly redundant global distribution, sometimes you must have cross-region backup toohandle regional disasters.</span></span> <span data-ttu-id="b569d-260">Al expandir en la topología de "Redundancia codificador" Hola, los clientes pueden elegir toohave una implementación de servicio redundantes en una región distinta a la que está conectada con el segundo conjunto de Hola de codificadores.</span><span class="sxs-lookup"><span data-stu-id="b569d-260">Expanding on hello “Encoder redundancy” topology, customers can choose toohave a redundant service deployment in a different region that's connected with hello second set of encoders.</span></span> <span data-ttu-id="b569d-261">Los clientes también pueden trabajar con un toodeploy de proveedor un administrador de tráfico Global delante Hola dos servicio implementaciones tooseamlessly enrutar cliente el tráfico de red de entrega de contenido.</span><span class="sxs-lookup"><span data-stu-id="b569d-261">Customers also can work with a Content Delivery Network provider toodeploy a Global Traffic Manager in front of hello two service deployments tooseamlessly route client traffic.</span></span> <span data-ttu-id="b569d-262">requisitos de Hola para los codificadores de hello son idénticos a cómo Hola caso "Redundancia codificador" Hola.</span><span class="sxs-lookup"><span data-stu-id="b569d-262">hello requirements for hello encoders are hello same as hello “Encoder redundancy” case.</span></span> <span data-ttu-id="b569d-263">Hello solo excepción es que segundo conjunto de Hola de codificadores necesidades toobe que apunta tooa diferentes en vivo extremo de introducción.</span><span class="sxs-lookup"><span data-stu-id="b569d-263">hello only exception is that hello second set of encoders needs toobe pointed tooa different live ingest endpoint.</span></span> <span data-ttu-id="b569d-264">Hello siguiente diagrama muestra esta configuración:</span><span class="sxs-lookup"><span data-stu-id="b569d-264">hello following diagram shows this setup:</span></span>

![redundancia del servicio][image7]

## <a name="11-special-types-of-ingestion-formats"></a><span data-ttu-id="b569d-266">11. Tipos especiales de formatos de ingesta</span><span class="sxs-lookup"><span data-stu-id="b569d-266">11. Special types of ingestion formats</span></span>
<span data-ttu-id="b569d-267">Esta sección describen los tipos especiales de formatos de ingesta en vivo que están diseñadas toohandle de escenarios concretos.</span><span class="sxs-lookup"><span data-stu-id="b569d-267">This section discusses special types of live ingestion formats that are designed toohandle specific scenarios.</span></span>

### <a name="sparse-track"></a><span data-ttu-id="b569d-268">Pista dispersa</span><span class="sxs-lookup"><span data-stu-id="b569d-268">Sparse track</span></span>
<span data-ttu-id="b569d-269">Cuando se entrega una presentación de transmisión por secuencias en directo con una experiencia de cliente enriquecido, a menudo es necesario tootransmit sincronizados por tiempo eventos o señala en banda con datos de medios principal de saludo.</span><span class="sxs-lookup"><span data-stu-id="b569d-269">When delivering a live streaming presentation with a rich client experience, often it's necessary tootransmit time-synced events or signals in-band with hello main media data.</span></span> <span data-ttu-id="b569d-270">Un ejemplo de esto es la inserción de anuncios en directo dinámicos.</span><span class="sxs-lookup"><span data-stu-id="b569d-270">An example of this is dynamic live ad insertion.</span></span> <span data-ttu-id="b569d-271">Este tipo de señalización de eventos es diferente del streaming de audio y vídeo regular debido a su naturaleza dispersa.</span><span class="sxs-lookup"><span data-stu-id="b569d-271">This type of event signaling is different from regular audio/video streaming because of its sparse nature.</span></span> <span data-ttu-id="b569d-272">En otras palabras, hello señalización datos normalmente no se producen continuamente, y el intervalo de saludo puede ser difícil toopredict.</span><span class="sxs-lookup"><span data-stu-id="b569d-272">In other words, hello signaling data usually does not happen continuously, and hello interval can be hard toopredict.</span></span> <span data-ttu-id="b569d-273">concepto de Hola de pista dispersa era tooingest diseñada y datos de señalización de difusión en la banda.</span><span class="sxs-lookup"><span data-stu-id="b569d-273">hello concept of sparse track was designed tooingest and broadcast in-band signaling data.</span></span>

<span data-ttu-id="b569d-274">Hello pasos siguientes son una implementación recomendada para el consumo de pista dispersa:</span><span class="sxs-lookup"><span data-stu-id="b569d-274">hello following steps are a recommended implementation for ingesting sparse track:</span></span>

1. <span data-ttu-id="b569d-275">Cree una secuencia de bits MP4 fragmentada independiente que solo contenga pistas dispersas, sin pistas de audio y vídeo.</span><span class="sxs-lookup"><span data-stu-id="b569d-275">Create a separate fragmented MP4 bitstream that contains only sparse tracks, without audio/video tracks.</span></span>
2. <span data-ttu-id="b569d-276">Hola **cuadro del manifiesto de servidor de Live** tal como se define en la sección 6 en [1], usar hello *parentTrackName* nombre del parámetro toospecify Hola de pista de hello primario. Para más información, consulte la sección 4.2.1.2.1.2 en [1].</span><span class="sxs-lookup"><span data-stu-id="b569d-276">In hello **Live Server Manifest Box** as defined in Section 6 in [1], use hello *parentTrackName* parameter toospecify hello name of hello parent track. For more information, see section 4.2.1.2.1.2 in [1].</span></span>
3. <span data-ttu-id="b569d-277">Hola **cuadro del manifiesto de servidor de Live**, **manifestOutput** debe establecerse demasiado**true**.</span><span class="sxs-lookup"><span data-stu-id="b569d-277">In hello **Live Server Manifest Box**, **manifestOutput** MUST be set too**true**.</span></span>
4. <span data-ttu-id="b569d-278">Dada la naturaleza dispersas de Hola de hello señalar el evento, se recomienda siguiente hello:</span><span class="sxs-lookup"><span data-stu-id="b569d-278">Given hello sparse nature of hello signaling event, we recommended hello following:</span></span>
   
    <span data-ttu-id="b569d-279">a.</span><span class="sxs-lookup"><span data-stu-id="b569d-279">a.</span></span> <span data-ttu-id="b569d-280">En principio Hola de evento en vivo de hello, codificador Hola envía cuadros encabezado inicial de hello toohello servicio, lo que permite a pista dispersa de hello servicio tooregister Hola manifiesto de cliente de Hola.</span><span class="sxs-lookup"><span data-stu-id="b569d-280">At hello beginning of hello live event, hello encoder sends hello initial header boxes toohello service, which allows hello service tooregister hello sparse track in hello client manifest.</span></span>
   
    <span data-ttu-id="b569d-281">b.</span><span class="sxs-lookup"><span data-stu-id="b569d-281">b.</span></span> <span data-ttu-id="b569d-282">codificador Hola debería finalizar la solicitud HTTP POST de hello cuando no están enviando datos.</span><span class="sxs-lookup"><span data-stu-id="b569d-282">hello encoder SHOULD terminate hello HTTP POST request when data is not being sent.</span></span> <span data-ttu-id="b569d-283">Un HTTP POST de ejecución prolongada que no envía datos pueden impedir que los servicios multimedia rápidamente desconectando codificador hello en caso de hello de un reinicio del servicio update o servidor.</span><span class="sxs-lookup"><span data-stu-id="b569d-283">A long-running HTTP POST that does not send data can prevent Media Services from quickly disconnecting from hello encoder in hello event of a service update or server reboot.</span></span> <span data-ttu-id="b569d-284">En estos casos, el servidor multimedia Hola está bloqueado temporalmente en una operación de recepción en el socket de Hola.</span><span class="sxs-lookup"><span data-stu-id="b569d-284">In these cases, hello media server is temporarily blocked in a receive operation on hello socket.</span></span>
   
    <span data-ttu-id="b569d-285">c.</span><span class="sxs-lookup"><span data-stu-id="b569d-285">c.</span></span> <span data-ttu-id="b569d-286">Durante el tiempo de hello cuando señalización datos no está disponible, codificador Hola debería cerrar la solicitud HTTP POST de Hola.</span><span class="sxs-lookup"><span data-stu-id="b569d-286">During hello time when signaling data is not available, hello encoder SHOULD close hello HTTP POST request.</span></span> <span data-ttu-id="b569d-287">Mientras está activa la solicitud POST hello, codificador Hola debe enviar los datos.</span><span class="sxs-lookup"><span data-stu-id="b569d-287">While hello POST request is active, hello encoder SHOULD send data.</span></span>

    <span data-ttu-id="b569d-288">d.</span><span class="sxs-lookup"><span data-stu-id="b569d-288">d.</span></span> <span data-ttu-id="b569d-289">Al enviar fragmentos dispersos, codificador Hola puede establecer un encabezado content-length explícito, si está disponible.</span><span class="sxs-lookup"><span data-stu-id="b569d-289">When sending sparse fragments, hello encoder can set an explicit content-length header, if it’s available.</span></span>

    <span data-ttu-id="b569d-290">e.</span><span class="sxs-lookup"><span data-stu-id="b569d-290">e.</span></span> <span data-ttu-id="b569d-291">Al enviar fragmentos dispersas con una nueva conexión, codificador Hola debería empezar a enviar desde los cuadros de encabezado de hello, seguidos de fragmentos de hello nueva.</span><span class="sxs-lookup"><span data-stu-id="b569d-291">When sending sparse fragments with a new connection, hello encoder SHOULD start sending from hello header boxes, followed by hello new fragments.</span></span> <span data-ttu-id="b569d-292">Esto ocurre para los casos en que conmutan por error entre y nueva conexión dispersas Hola se está establecida tooa nuevo servidor que no se ha visto la pista dispersa de hello antes.</span><span class="sxs-lookup"><span data-stu-id="b569d-292">This is for cases in which failover happens in-between, and hello new sparse connection is being established tooa new server that has not seen hello sparse track before.</span></span>

    <span data-ttu-id="b569d-293">f.</span><span class="sxs-lookup"><span data-stu-id="b569d-293">f.</span></span> <span data-ttu-id="b569d-294">fragmento de pista dispersa Hola se vuelve disponible toohello cliente cuando Hola primario pista fragmento correspondiente que tiene un valor de marca de tiempo igual o mayor estará disponible toohello cliente.</span><span class="sxs-lookup"><span data-stu-id="b569d-294">hello sparse track fragment becomes available toohello client when hello corresponding parent track fragment that has an equal or larger timestamp value is made available toohello client.</span></span> <span data-ttu-id="b569d-295">Por ejemplo, si el fragmento disperso hello tiene una marca de tiempo de t = 1000, se espera que una vez cliente hello ve fragmentar la marca de tiempo 1000 "vídeo" (suponiendo que nombres de pistas de hello primario "vídeo") o versiones posteriores, puede descargar Hola fragmento disperso t = 1000.</span><span class="sxs-lookup"><span data-stu-id="b569d-295">For example, if hello sparse fragment has a timestamp of t=1000, it is expected that after hello client sees "video" (assuming hello parent track name is "video") fragment timestamp 1000 or beyond, it can download hello sparse fragment t=1000.</span></span> <span data-ttu-id="b569d-296">Tenga en cuenta que Hola señal real podría usarse para una posición diferente en la escala de tiempo de presentación de Hola para su propósito designado.</span><span class="sxs-lookup"><span data-stu-id="b569d-296">Note that hello actual signal could be used for a different position in hello presentation timeline for its designated purpose.</span></span> <span data-ttu-id="b569d-297">En este ejemplo, del posible que Hola dispersa fragmento de t = 1000 tiene una carga XML, que es para insertar un anuncio en una posición que se unos segundos más tarde.</span><span class="sxs-lookup"><span data-stu-id="b569d-297">In this example, it’s possible that hello sparse fragment of t=1000 has an XML payload, which is for inserting an ad in a position that’s a few seconds later.</span></span>

    <span data-ttu-id="b569d-298">g.</span><span class="sxs-lookup"><span data-stu-id="b569d-298">g.</span></span> <span data-ttu-id="b569d-299">carga de Hola de fragmentos de pista dispersa puede estar en diferentes formatos (por ejemplo, XML, texto o binario), según el escenario de Hola.</span><span class="sxs-lookup"><span data-stu-id="b569d-299">hello payload of sparse track fragments can be in different formats (such as XML, text, or binary), depending on hello scenario.</span></span>

### <a name="redundant-audio-track"></a><span data-ttu-id="b569d-300">Pista de audio redundante</span><span class="sxs-lookup"><span data-stu-id="b569d-300">Redundant audio track</span></span>
<span data-ttu-id="b569d-301">En un HTTP adaptive streaming escenario típico (por ejemplo, Smooth Streaming o guión), a menudo, hay sólo una pista de audio en toda la presentación Hola.</span><span class="sxs-lookup"><span data-stu-id="b569d-301">In a typical HTTP adaptive streaming scenario (for example, Smooth Streaming or DASH), often, there's only one audio track in hello entire presentation.</span></span> <span data-ttu-id="b569d-302">A diferencia de las pistas de vídeo, que tienen varios niveles de calidad para hello toochoose de cliente de en condiciones de error, pista de audio de hello puede ser un único punto de error si hello ingesta de secuencia de Hola que contiene la pista de audio de Hola se interrumpe.</span><span class="sxs-lookup"><span data-stu-id="b569d-302">Unlike video tracks, which have multiple quality levels for hello client toochoose from in error conditions, hello audio track can be a single point of failure if hello ingestion of hello stream that contains hello audio track is broken.</span></span> 

<span data-ttu-id="b569d-303">toosolve es compatible con este problema, los servicios multimedia en directo ingesta redundantes de pistas de audio.</span><span class="sxs-lookup"><span data-stu-id="b569d-303">toosolve this problem, Media Services supports live ingestion of redundant audio tracks.</span></span> <span data-ttu-id="b569d-304">idea Hello es ese hello misma pista de audio se puede enviar varias veces en diferentes flujos.</span><span class="sxs-lookup"><span data-stu-id="b569d-304">hello idea is that hello same audio track can be sent multiple times in different streams.</span></span> <span data-ttu-id="b569d-305">Aunque hello servicio sólo registra pista de audio de hello una vez en el manifiesto de cliente hello, puede utilizar redundancia pistas de audio como las copias de seguridad para recuperar fragmentos de audio si pista de audio principal hello tiene problemas.</span><span class="sxs-lookup"><span data-stu-id="b569d-305">Although hello service only registers hello audio track once in hello client manifest, it can use redundant audio tracks as backups for retrieving audio fragments if hello primary audio track has issues.</span></span> <span data-ttu-id="b569d-306">tooingest pistas de audio redundantes, codificador Hola debe:</span><span class="sxs-lookup"><span data-stu-id="b569d-306">tooingest redundant audio tracks, hello encoder needs to:</span></span>

1. <span data-ttu-id="b569d-307">Crear Hola pista de audio mismo en varios fragmentos MP4 bitstreams.</span><span class="sxs-lookup"><span data-stu-id="b569d-307">Create hello same audio track in multiple fragment MP4 bitstreams.</span></span> <span data-ttu-id="b569d-308">las pistas de audio redundantes de Hello deben ser semánticamente equivalentes, con hello mismo fragmento de marcas de tiempo y ser intercambiables en el encabezado de Hola y niveles de fragmento.</span><span class="sxs-lookup"><span data-stu-id="b569d-308">hello redundant audio tracks MUST be semantically equivalent, with hello same fragment timestamps, and be interchangeable at hello header and fragment levels.</span></span>
2. <span data-ttu-id="b569d-309">Asegurarse de esa entrada de "audio" Hola Hola Live Server manifiesto (sección 6 en [1]) se hello igual para redundancia todas las pistas de audio.</span><span class="sxs-lookup"><span data-stu-id="b569d-309">Ensure that hello “audio” entry in hello Live Server Manifest (Section 6 in [1]) is hello same for all redundant audio tracks.</span></span>

<span data-ttu-id="b569d-310">Hola después de la implementación se recomienda en las pistas de audio redundantes:</span><span class="sxs-lookup"><span data-stu-id="b569d-310">hello following implementation is recommended for redundant audio tracks:</span></span>

1. <span data-ttu-id="b569d-311">Envíe cada pista de audio única en una secuencia de manera individual.</span><span class="sxs-lookup"><span data-stu-id="b569d-311">Send each unique audio track in a stream by itself.</span></span> <span data-ttu-id="b569d-312">Además, envíe una secuencia redundante para cada una de estas secuencias de pista de audio, donde segundo flujo de hello solo se diferencia de hello en primer lugar por identificador hello en hello dirección URL de POST de HTTP: {protocolo} :// {dirección del servidor} / {path}/Streams({identifier}) de punto de publicación.</span><span class="sxs-lookup"><span data-stu-id="b569d-312">Also, send a redundant stream for each of these audio track streams, where hello second stream differs from hello first only by hello identifier in hello HTTP POST URL: {protocol}://{server address}/{publishing point path}/Streams({identifier}).</span></span>
2. <span data-ttu-id="b569d-313">Utilice secuencias independientes toosend Hola dos más bajo vídeo velocidades de bits.</span><span class="sxs-lookup"><span data-stu-id="b569d-313">Use separate streams toosend hello two lowest video bitrates.</span></span> <span data-ttu-id="b569d-314">Cada una de estas secuencias también DEBERÍA contener una copia de cada pista de audio única. Por ejemplo, cuando se admiten varios idiomas, estas secuencias DEBERÍAN contener pistas de audio para cada idioma.</span><span class="sxs-lookup"><span data-stu-id="b569d-314">Each of these streams SHOULD also contain a copy of each unique audio track. For example, when multiple languages are supported, these streams SHOULD contain audio tracks for each language.</span></span>
3. <span data-ttu-id="b569d-315">Utilizar tooencode de instancias de servidor independiente (codificador) y enviar secuencias de redundancia de hello mencionados en (1) y (2).</span><span class="sxs-lookup"><span data-stu-id="b569d-315">Use separate server (encoder) instances tooencode and send hello redundant streams mentioned in (1) and (2).</span></span> 

## <a name="media-services-learning-paths"></a><span data-ttu-id="b569d-316">Rutas de aprendizaje de Servicios multimedia</span><span class="sxs-lookup"><span data-stu-id="b569d-316">Media Services learning paths</span></span>
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="b569d-317">Envío de comentarios</span><span class="sxs-lookup"><span data-stu-id="b569d-317">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]

[image1]: ./media/media-services-fmp4-live-ingest-overview/media-services-image1.png
[image2]: ./media/media-services-fmp4-live-ingest-overview/media-services-image2.png
[image3]: ./media/media-services-fmp4-live-ingest-overview/media-services-image3.png
[image4]: ./media/media-services-fmp4-live-ingest-overview/media-services-image4.png
[image5]: ./media/media-services-fmp4-live-ingest-overview/media-services-image5.png
[image6]: ./media/media-services-fmp4-live-ingest-overview/media-services-image6.png
[image7]: ./media/media-services-fmp4-live-ingest-overview/media-services-image7.png

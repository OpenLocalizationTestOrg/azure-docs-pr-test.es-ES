---
title: "Configuración de la directiva de autorización de claves de contenido mediante Azure Portal | Microsoft Docs"
description: "Aprenda a configurar una directiva de autorización para una clave de contenido."
services: media-services
documentationcenter: 
author: juliako
manager: cfowler
editor: 
ms.assetid: ee82a3fa-c34b-48f2-a108-8ba321f1691e
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/09/2017
ms.author: juliako
ms.openlocfilehash: 5a35c7255a1c30a693862589c14f6a22a1900790
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/29/2017
---
# <a name="configure-content-key-authorization-policy"></a><span data-ttu-id="f9097-103">Configuración de la directiva de autorización de claves de contenido</span><span class="sxs-lookup"><span data-stu-id="f9097-103">Configure Content Key Authorization Policy</span></span>
[!INCLUDE [media-services-selector-content-key-auth-policy](../../includes/media-services-selector-content-key-auth-policy.md)]

## <a name="overview"></a><span data-ttu-id="f9097-104">Información general</span><span class="sxs-lookup"><span data-stu-id="f9097-104">Overview</span></span>
<span data-ttu-id="f9097-105">Servicios multimedia de Microsoft Azure permute entregar transmisiones MPEG-DASH, Smooth Streaming y HTTP-Live-Streaming (HLS) protegidas con Estándar de cifrado avanzado (AES) (usando claves de cifrado de 128 bits) o [DRM de Microsoft PlayReady](https://www.microsoft.com/playready/overview/).</span><span class="sxs-lookup"><span data-stu-id="f9097-105">Microsoft Azure Media Services enables you to deliver MPEG-DASH, Smooth Streaming, and HTTP-Live-Streaming (HLS) streams protected with Advanced Encryption Standard (AES) (using 128-bit encryption keys) or [Microsoft PlayReady DRM](https://www.microsoft.com/playready/overview/).</span></span> <span data-ttu-id="f9097-106">AMS también permite entregar transmisiones DASH cifradas con DRM de Widevine.</span><span class="sxs-lookup"><span data-stu-id="f9097-106">AMS also enables you to deliver DASH streams encrypted with Widevine DRM.</span></span> <span data-ttu-id="f9097-107">Tanto PlayReady como Widewine se cifran según la especificación de cifrado común (ISO/IEC 23001-7 CENC).</span><span class="sxs-lookup"><span data-stu-id="f9097-107">Both PlayReady and Widevine are encrypted per the Common Encryption (ISO/IEC 23001-7 CENC) specification.</span></span>

<span data-ttu-id="f9097-108">Servicios multimedia también proporciona un **servicio de entrega de claves/licencias** con el que los clientes pueden obtener claves AES o licencias de PlayReady/Widevine con el fin de reproducir el contenido cifrado.</span><span class="sxs-lookup"><span data-stu-id="f9097-108">Media Services also provides a **Key/License Delivery Service** from which clients can obtain AES keys or PlayReady/Widevine licenses to play the encrypted content.</span></span>

<span data-ttu-id="f9097-109">Este tema muestra cómo usar Azure Portal para configurar la directiva de autorización de claves de contenido.</span><span class="sxs-lookup"><span data-stu-id="f9097-109">This topic shows how to use the Azure portal to configure the content key authorization policy.</span></span> <span data-ttu-id="f9097-110">La clave se puede usar posteriormente para cifrar el contenido de forma dinámica.</span><span class="sxs-lookup"><span data-stu-id="f9097-110">The key can later be used to dynamically encrypt your content.</span></span> <span data-ttu-id="f9097-111">Tenga en cuenta que actualmente puede cifrar los formatos de streaming siguientes: HLS, MPEG DASH y Smooth Streaming.</span><span class="sxs-lookup"><span data-stu-id="f9097-111">Note that currently you can encrypt the following streaming formats: HLS, MPEG DASH, and Smooth Streaming.</span></span> <span data-ttu-id="f9097-112">No se pueden cifrar las descargas progresivas.</span><span class="sxs-lookup"><span data-stu-id="f9097-112">You cannot encrypt progressive downloads.</span></span>

<span data-ttu-id="f9097-113">Cuando un reproductor solicita una transmisión que se establece para cifrarse de forma dinámica, Servicios multimedia usa la clave configurada para cifrar dinámicamente el contenido mediante cifrado AES o DRM.</span><span class="sxs-lookup"><span data-stu-id="f9097-113">When a player requests a stream that is set to be dynamically encrypted, Media Services uses the configured key to dynamically encrypt your content using AES or DRM encryption.</span></span> <span data-ttu-id="f9097-114">Para descifrar la secuencia, el reproductor solicitará la clave del servicio de entrega de claves.</span><span class="sxs-lookup"><span data-stu-id="f9097-114">To decrypt the stream, the player will request the key from the key delivery service.</span></span> <span data-ttu-id="f9097-115">Para decidir si el usuario está o no autorizado para obtener la clave, el servicio evalúa las directivas de autorización que especificó para la clave.</span><span class="sxs-lookup"><span data-stu-id="f9097-115">To decide whether or not the user is authorized to get the key, the service evaluates the authorization policies that you specified for the key.</span></span>

<span data-ttu-id="f9097-116">Si planea tener varias claves de contenido o desea especificar una dirección URL del **servicio de entrega de claves/licencias** que no sea el servicio de entrega de claves de Servicios multimedia, use el SDK de Servicios multimedia para .NET o las API de REST.</span><span class="sxs-lookup"><span data-stu-id="f9097-116">If you plan to have multiple content keys or want to specify a **Key/License Delivery Service** URL other than the Media Services key delivery service, use Media Services .NET SDK or REST APIs.</span></span>

[<span data-ttu-id="f9097-117">Configuración de la directiva de autorización de claves mediante el SDK de Servicios multimedia para .NET</span><span class="sxs-lookup"><span data-stu-id="f9097-117">Configure Content Key Authorization Policy using Media Services .NET SDK</span></span>](media-services-dotnet-configure-content-key-auth-policy.md)

[<span data-ttu-id="f9097-118">Configuración de la directiva de autorización de claves mediante la API de REST de Servicios multimedia</span><span class="sxs-lookup"><span data-stu-id="f9097-118">Configure Content Key Authorization Policy using Media Services REST API</span></span>](media-services-rest-configure-content-key-auth-policy.md)

### <a name="some-considerations-apply"></a><span data-ttu-id="f9097-119">Se aplican algunas consideraciones:</span><span class="sxs-lookup"><span data-stu-id="f9097-119">Some considerations apply:</span></span>
* <span data-ttu-id="f9097-120">Cuando se crea la cuenta de AMS, se agrega un punto de conexión de streaming **predeterminado** a la cuenta en estado **Stopped** (Detenido).</span><span class="sxs-lookup"><span data-stu-id="f9097-120">When your AMS account is created a **default** streaming endpoint is added  to your account in the **Stopped** state.</span></span> <span data-ttu-id="f9097-121">Para iniciar la transmisión del contenido y aprovechar el empaquetado dinámico y el cifrado dinámico, el punto de conexión de streaming debe estar en estado **Running** (En ejecución).</span><span class="sxs-lookup"><span data-stu-id="f9097-121">To start streaming your content and take advantage of dynamic packaging and dynamic encryption, your streaming endpoint has to be in the **Running** state.</span></span> 
* <span data-ttu-id="f9097-122">El recurso debe contener un conjunto de archivos MP4 de velocidad de bits adaptable o archivos Smooth Streaming de velocidad de bits adaptable.</span><span class="sxs-lookup"><span data-stu-id="f9097-122">Your asset must contain a set of adaptive bitrate MP4s or adaptive bitrate Smooth Streaming files.</span></span> <span data-ttu-id="f9097-123">Para obtener más información, consulte [Codificación de un recurso](media-services-encode-asset.md).</span><span class="sxs-lookup"><span data-stu-id="f9097-123">For more information, see [Encode an asset](media-services-encode-asset.md).</span></span>
* <span data-ttu-id="f9097-124">El servicio de entrega de claves almacena en caché ContentKeyAuthorizationPolicy y sus objetos relacionados (opciones y restricciones de directiva) durante 15 minutos.</span><span class="sxs-lookup"><span data-stu-id="f9097-124">The Key Delivery service caches ContentKeyAuthorizationPolicy and its related objects (policy options and restrictions) for 15 minutes.</span></span>  <span data-ttu-id="f9097-125">Si crea una entidad ContentKeyAuthorizationPolicy y especifica el uso de una restricción "Token", pruébela y, a continuación, actualice la directiva a la restricción "Open"; la directiva tardará aproximadamente 15 minutos antes de cambiar a la versión "Open" de la misma.</span><span class="sxs-lookup"><span data-stu-id="f9097-125">If you create a ContentKeyAuthorizationPolicy and specify to use a “Token” restriction, then test it, and then update the policy to “Open” restriction, it will take roughly 15 minutes before the policy switches to the “Open” version of the policy.</span></span>

## <a name="how-to-configure-the-key-authorization-policy"></a><span data-ttu-id="f9097-126">Procedimiento: configuración de la directiva de autorización de claves</span><span class="sxs-lookup"><span data-stu-id="f9097-126">How to: configure the key authorization policy</span></span>
<span data-ttu-id="f9097-127">Para configurar la directiva de autorización de claves, seleccione la página **PROTECCIÓN DE CONTENIDO** .</span><span class="sxs-lookup"><span data-stu-id="f9097-127">To configure the key authorization policy, select the **CONTENT PROTECTION** page.</span></span>

<span data-ttu-id="f9097-128">Servicios multimedia admite varias formas de autenticar a los usuarios que realizan solicitudes de clave.</span><span class="sxs-lookup"><span data-stu-id="f9097-128">Media Services supports multiple ways of authenticating users who make key requests.</span></span> <span data-ttu-id="f9097-129">La directiva de autorización de claves de contenido puede tener restricciones de autorización **open**, **token** o **IP** (**IP** puede configurarse con REST o el SDK de .NET).</span><span class="sxs-lookup"><span data-stu-id="f9097-129">The content key authorization policy can have **open**, **token**, or **IP** authorization restrictions (**IP** can be configured with REST or .NET SDK).</span></span>

### <a name="open-restriction"></a><span data-ttu-id="f9097-130">Restricción open</span><span class="sxs-lookup"><span data-stu-id="f9097-130">Open restriction</span></span>
<span data-ttu-id="f9097-131">La restricción **open** significa que el sistema entregará la clave a cualquier persona que realice una solicitud de clave.</span><span class="sxs-lookup"><span data-stu-id="f9097-131">The **open** restriction means the system will deliver the key to anyone who makes a key request.</span></span> <span data-ttu-id="f9097-132">Esta restricción puede ser útil para realizar pruebas.</span><span class="sxs-lookup"><span data-stu-id="f9097-132">This restriction might be useful for testing purposes.</span></span>

![OpenPolicy][open_policy]

### <a name="token-restriction"></a><span data-ttu-id="f9097-134">Restricción de token</span><span class="sxs-lookup"><span data-stu-id="f9097-134">Token restriction</span></span>
<span data-ttu-id="f9097-135">Para elegir la directiva de token restringida, presione el botón **TOKEN** .</span><span class="sxs-lookup"><span data-stu-id="f9097-135">To choose the token restricted policy, press the **TOKEN** button.</span></span>

<span data-ttu-id="f9097-136">La directiva con restricción **token** debe ir acompañada de un token emitido por un **Servicio de tokens seguros** (STS).</span><span class="sxs-lookup"><span data-stu-id="f9097-136">The **token** restricted policy must be accompanied by a token issued by a **Secure Token Service** (STS).</span></span> <span data-ttu-id="f9097-137">Media Services admite tokens en formato **Token de web simple** ([SWT](https://msdn.microsoft.com/library/gg185950.aspx#BKMK_2)) y en formato **JSON Web Token** (JWT).</span><span class="sxs-lookup"><span data-stu-id="f9097-137">Media Services supports tokens in the **Simple Web Tokens** ([SWT](https://msdn.microsoft.com/library/gg185950.aspx#BKMK_2)) format and **JSON Web Token** (JWT) format.</span></span> <span data-ttu-id="f9097-138">Para obtener información, consulte [Autenticación de token JWT](http://www.gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span><span class="sxs-lookup"><span data-stu-id="f9097-138">For information, see [JWT token authentication](http://www.gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span></span>

<span data-ttu-id="f9097-139">Servicios multimedia no proporciona **Servicios de tokens seguros**.</span><span class="sxs-lookup"><span data-stu-id="f9097-139">Media Services does not provide **Secure Token Services**.</span></span> <span data-ttu-id="f9097-140">Puede crear un STS personalizado o aprovechar el Servicio de control de acceso (ACS) de Microsoft Azure para emitir tokens.</span><span class="sxs-lookup"><span data-stu-id="f9097-140">You can create a custom STS or leverage Microsoft Azure ACS to issue tokens.</span></span> <span data-ttu-id="f9097-141">Se debe configurar el STS para crear un token firmado con las notificaciones de clave y emisión que especificó en la configuración de restricción de tokens.</span><span class="sxs-lookup"><span data-stu-id="f9097-141">The STS must be configured to create a token signed with the specified key and issue claims that you specified in the token restriction configuration.</span></span> <span data-ttu-id="f9097-142">El servicio de entrega de claves de los Servicios multimedia devolverá la clave de cifrado al cliente si el token es válido y las notificaciones del token coinciden con las configuradas para la clave de contenido.</span><span class="sxs-lookup"><span data-stu-id="f9097-142">The Media Services key delivery service will return the encryption key to the client if the token is valid and the claims in the token match those configured for the content key.</span></span> <span data-ttu-id="f9097-143">Para obtener más información, consulte [Uso de Azure ACS para emitir tokens](http://mingfeiy.com/acs-with-key-services).</span><span class="sxs-lookup"><span data-stu-id="f9097-143">For more information, see [Use Azure ACS to issue tokens](http://mingfeiy.com/acs-with-key-services).</span></span>

<span data-ttu-id="f9097-144">Al configurar la directiva con restricción **TOKEN**, debe establecer los valores de **clave de verificación**, **emisor** y **público**.</span><span class="sxs-lookup"><span data-stu-id="f9097-144">When configuring the **TOKEN** restricted policy, you must set values for **verification key**, **issuer** and **audience**.</span></span> <span data-ttu-id="f9097-145">La clave de comprobación principal contiene la clave con la que se firmó el token y el emisor es el servicio de tokens seguros que emite el token.</span><span class="sxs-lookup"><span data-stu-id="f9097-145">The primary verification key contains the key that the token was signed with, issuer is the secure token service that issues the token.</span></span> <span data-ttu-id="f9097-146">El público (a veces denominado ámbito) describe la intención del token o del recurso cuyo acceso está autorizado por el token.</span><span class="sxs-lookup"><span data-stu-id="f9097-146">The audience (sometimes called scope) describes the intent of the token or the resource the token authorizes access to.</span></span> <span data-ttu-id="f9097-147">El servicio de entrega de claves de los Servicios multimedia valida que estos valores del token coincidan con los valores de la plantilla.</span><span class="sxs-lookup"><span data-stu-id="f9097-147">The Media Services key delivery service validates that these values in the token match the values in the template.</span></span>

### <a name="playready"></a><span data-ttu-id="f9097-148">PlayReady</span><span class="sxs-lookup"><span data-stu-id="f9097-148">PlayReady</span></span>
<span data-ttu-id="f9097-149">Al proteger su contenido con **PlayReady**, una de las cosas que debe especificar en la directiva de autorización es una cadena XML que defina la plantilla de licencia de PlayReady.</span><span class="sxs-lookup"><span data-stu-id="f9097-149">When protecting your content with **PlayReady**, one of the things you need to specify in your authorization policy is an XML string that defines the PlayReady license template.</span></span> <span data-ttu-id="f9097-150">De forma predeterminada, se establece la siguiente directiva:</span><span class="sxs-lookup"><span data-stu-id="f9097-150">By default, the following policy is set:</span></span>

<span data-ttu-id="f9097-151"><PlayReadyLicenseResponseTemplate xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.microsoft.com/Azure/MediaServices/KeyDelivery/PlayReadyTemplate/v1"> <LicenseTemplates> <PlayReadyLicenseTemplate><AllowTestDevices>true</AllowTestDevices> <ContentKey i:type="ContentEncryptionKeyFromHeader" /> <LicenseType>Nonpersistent</LicenseType> <PlayRight> <AllowPassingVideoContentToUnknownOutput>Permitido</AllowPassingVideoContentToUnknownOutput> </PlayRight> </PlayReadyLicenseTemplate> </LicenseTemplates> </PlayReadyLicenseResponseTemplate></span><span class="sxs-lookup"><span data-stu-id="f9097-151"><PlayReadyLicenseResponseTemplate xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.microsoft.com/Azure/MediaServices/KeyDelivery/PlayReadyTemplate/v1"> <LicenseTemplates> <PlayReadyLicenseTemplate><AllowTestDevices>true</AllowTestDevices> <ContentKey i:type="ContentEncryptionKeyFromHeader" /> <LicenseType>Nonpersistent</LicenseType> <PlayRight> <AllowPassingVideoContentToUnknownOutput>Allowed</AllowPassingVideoContentToUnknownOutput> </PlayRight> </PlayReadyLicenseTemplate> </LicenseTemplates> </PlayReadyLicenseResponseTemplate></span></span>

<span data-ttu-id="f9097-152">Puede hacer clic en el botón **Importar directiva xml** y proporcionar un archivo XML diferente que se ajuste al esquema XML definido [aquí](media-services-playready-license-template-overview.md).</span><span class="sxs-lookup"><span data-stu-id="f9097-152">You can click the **import policy xml** button and provide a different XML which conforms to the  XML Schema defined [here](media-services-playready-license-template-overview.md).</span></span>

## <a name="next-step"></a><span data-ttu-id="f9097-153">Paso siguiente</span><span class="sxs-lookup"><span data-stu-id="f9097-153">Next step</span></span>
<span data-ttu-id="f9097-154">Consulte las rutas de aprendizaje de Servicios multimedia.</span><span class="sxs-lookup"><span data-stu-id="f9097-154">Review Media Services learning paths.</span></span>

[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="f9097-155">Envío de comentarios</span><span class="sxs-lookup"><span data-stu-id="f9097-155">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]

[open_policy]: ./media/media-services-portal-configure-content-key-auth-policy/media-services-protect-content-with-open-restriction.png
[token_policy]: ./media/media-services-key-authorization-policy/media-services-protect-content-with-token-restriction.png


---
title: "CENC con varios DRM y Access Control: diseño e implementación de referencia en Azure y Azure Media Services | Microsoft Docs"
description: "Obtenga información acerca de cómo toolicensing Hola Microsoft® Smooth Streaming Client Porting Kit."
services: media-services
documentationcenter: 
author: willzhan
manager: cfowler
editor: 
ms.assetid: 7814739b-cea9-4b9b-8370-538702e5c615
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/19/2017
ms.author: willzhan;kilroyh;yanmf;juliako
ms.openlocfilehash: 033fb618650c4fbe9069d467159a8734da759bba
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="cenc-with-multi-drm-and-access-control-a-reference-design-and-implementation-on-azure-and-azure-media-services"></a><span data-ttu-id="47ef8-103">CENC con varios DRM y control de acceso: diseño e implementación de referencia en Azure y Servicios multimedia de Azure</span><span class="sxs-lookup"><span data-stu-id="47ef8-103">CENC with Multi-DRM and Access Control: A Reference Design and Implementation on Azure and Azure Media Services</span></span>
 
## <a name="introduction"></a><span data-ttu-id="47ef8-104">Introducción</span><span class="sxs-lookup"><span data-stu-id="47ef8-104">Introduction</span></span>
<span data-ttu-id="47ef8-105">Es muy conocidos que es una tarea compleja toodesign y generar un subsistema DRM para un OTT o en pantalla de solución de transmisión por secuencias.</span><span class="sxs-lookup"><span data-stu-id="47ef8-105">It is well known that it is a complex task toodesign and build a DRM subsystem for an OTT or online streaming solution.</span></span> <span data-ttu-id="47ef8-106">Y es una práctica común para operadores/en línea toooutsource de proveedores de vídeo este proveedores de servicios de parte toospecialized DRM.</span><span class="sxs-lookup"><span data-stu-id="47ef8-106">And it is a common practice for operators/online video providers toooutsource this part toospecialized DRM service providers.</span></span> <span data-ttu-id="47ef8-107">objetivo de Hola de este documento es toopresent un diseño de referencia y la implementación de subsistema DRM-to-end de OTT o una solución de transmisión por secuencias en línea.</span><span class="sxs-lookup"><span data-stu-id="47ef8-107">hello goal of this document is toopresent a reference design and implementation of end-to-end DRM subsystem in OTT or online streaming solution.</span></span>

<span data-ttu-id="47ef8-108">los lectores de Hello como destinada de este documento son ingenieros que trabajan en el subsistema DRM de OTT o soluciones en línea de transmisión por secuencias/multi-screen o cualquier lector interesado en el subsistema DRM.</span><span class="sxs-lookup"><span data-stu-id="47ef8-108">hello targeted readers of this document are engineers working in DRM subsystem of OTT or online streaming/multi-screen solutions, or any readers interested in DRM subsystem.</span></span> <span data-ttu-id="47ef8-109">Hola, se supone que los lectores están familiarizados con al menos una de las tecnologías DRM de hello en el mercado de hello, como PlayReady, Widevine, FairPlay o acceso de Adobe.</span><span class="sxs-lookup"><span data-stu-id="47ef8-109">hello assumption is that readers are familiar with at least one of hello DRM technologies on hello market, such as PlayReady, Widevine, FairPlay or Adobe Access.</span></span>

<span data-ttu-id="47ef8-110">En el término DRM, también incluimos CENC (Cifrado común) con varios DRM.</span><span class="sxs-lookup"><span data-stu-id="47ef8-110">By DRM, we also include CENC (Common Encryption) with multi-DRM.</span></span> <span data-ttu-id="47ef8-111">Una tendencia principal en streaming en línea y sector OTT es toouse CENC con varios-native-DRM en varias plataformas de cliente, que es un cambio de tendencia anterior de hello del uso de un único DRM y el SDK de cliente para varias plataformas de cliente.</span><span class="sxs-lookup"><span data-stu-id="47ef8-111">A major trend in online streaming and OTT industry is toouse CENC with multi-native-DRM on various client platforms, which is a shift from hello previous trend of using a single DRM and its client SDK for various client platforms.</span></span> <span data-ttu-id="47ef8-112">Al utilizar CENC con varios native DRM, PlayReady y Widevine se cifran por hello [cifrado común (ISO/IEC 23001-7 CENC)](http://www.iso.org/iso/home/store/catalogue_ics/catalogue_detail_ics.htm?csnumber=65271/) especificación.</span><span class="sxs-lookup"><span data-stu-id="47ef8-112">When using CENC with multi-native-DRM, both PlayReady and Widevine are encrypted per hello [Common Encryption (ISO/IEC 23001-7 CENC)](http://www.iso.org/iso/home/store/catalogue_ics/catalogue_detail_ics.htm?csnumber=65271/) specification.</span></span>

<span data-ttu-id="47ef8-113">ventajas de Hola de CENC con DRM de múltiples son los siguientes:</span><span class="sxs-lookup"><span data-stu-id="47ef8-113">hello benefits of CENC with multi-DRM are as follows:</span></span>

1. <span data-ttu-id="47ef8-114">Reduce el costo del cifrado puesto que se emplea un solo procesamiento de cifrado que tiene como destino distintas plataformas con sus DRM nativos.</span><span class="sxs-lookup"><span data-stu-id="47ef8-114">Reduces encryption cost since a single encryption processing is used targeting different platforms with its native DRMs;</span></span>
2. <span data-ttu-id="47ef8-115">Reduce el costo de Hola de administrar los recursos cifrados dado que no se necesita una sola copia de los recursos cifrados;</span><span class="sxs-lookup"><span data-stu-id="47ef8-115">Reduces hello cost of managing encrypted assets since only a single copy of encrypted assets is needed;</span></span>
3. <span data-ttu-id="47ef8-116">Elimina el costo de licencia porque Hola native client DRM es suele ser gratis en su plataforma nativa de cliente DRM.</span><span class="sxs-lookup"><span data-stu-id="47ef8-116">Eliminates DRM client licensing cost since hello native DRM client is usually free on its native platform.</span></span>

<span data-ttu-id="47ef8-117">Microsoft ha sido un promotor activo de DASH y CENC junto con algunos de los principales reproductores del sector.</span><span class="sxs-lookup"><span data-stu-id="47ef8-117">Microsoft has been an active promoter of DASH and CENC together with some major industry players.</span></span> <span data-ttu-id="47ef8-118">Servicios multimedia de Microsoft Azure ha estado ofreciendo soporte técnico para DASH y CENC.</span><span class="sxs-lookup"><span data-stu-id="47ef8-118">Microsoft Azure Media Services has been providing support of DASH and CENC.</span></span> <span data-ttu-id="47ef8-119">Para conocer los anuncios recientes, consulte los blogs de Mingfei: [Announcing Google Widevine license delivery services in Azure Media Services](https://azure.microsoft.com/blog/announcing-general-availability-of-google-widevine-license-services/) (Anuncio de los servicios de entrega de licencias de Google Widevine) y [Azure Media Services adds Google Widevine packaging for delivering multi-DRM stream](https://azure.microsoft.com/blog/azure-media-services-adds-google-widevine-packaging-for-delivering-multi-drm-stream/) (Azure Media Services agregan el paquete Google Widevine para la entrega de transmisiones de varios DRM).</span><span class="sxs-lookup"><span data-stu-id="47ef8-119">For recent announcements, please see Mingfei’s blogs: [Announcing Google Widevine license delivery services in Azure Media Services](https://azure.microsoft.com/blog/announcing-general-availability-of-google-widevine-license-services/), and [Azure Media Services adds Google Widevine packaging for delivering multi-DRM stream](https://azure.microsoft.com/blog/azure-media-services-adds-google-widevine-packaging-for-delivering-multi-drm-stream/).</span></span>  

### <a name="overview-of-this-article"></a><span data-ttu-id="47ef8-120">Información general de este artículo</span><span class="sxs-lookup"><span data-stu-id="47ef8-120">Overview of this article</span></span>
<span data-ttu-id="47ef8-121">objetivo de Hola de este artículo incluye siguiente de hello:</span><span class="sxs-lookup"><span data-stu-id="47ef8-121">hello goal of this article includes hello following:</span></span>

1. <span data-ttu-id="47ef8-122">Proporcionar un diseño de referencia del subsistema DRM mediante CENC con varios DRM.</span><span class="sxs-lookup"><span data-stu-id="47ef8-122">Provides a reference design of DRM subsystem using CENC with multi-DRM;</span></span>
2. <span data-ttu-id="47ef8-123">Proporcionar una implementación de referencia en la plataforma de Servicios multimedia de Azure o Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="47ef8-123">Provides a reference implementation on Microsoft Azure/Azure Media Services platform;</span></span>
3. <span data-ttu-id="47ef8-124">Describir algunos temas de diseño e implementación.</span><span class="sxs-lookup"><span data-stu-id="47ef8-124">Discusses some design and implementation topics.</span></span>

<span data-ttu-id="47ef8-125">En el artículo de hello, "multi-DRM" cubre siguiente hello:</span><span class="sxs-lookup"><span data-stu-id="47ef8-125">In hello article, “multi-DRM” covers hello following:</span></span>

1. <span data-ttu-id="47ef8-126">Microsoft PlayReady</span><span class="sxs-lookup"><span data-stu-id="47ef8-126">Microsoft PlayReady</span></span>
2. <span data-ttu-id="47ef8-127">Google Widevine</span><span class="sxs-lookup"><span data-stu-id="47ef8-127">Google Widevine</span></span>
3. <span data-ttu-id="47ef8-128">Apple FairPlay</span><span class="sxs-lookup"><span data-stu-id="47ef8-128">Apple FairPlay</span></span> 

<span data-ttu-id="47ef8-129">Hello siguiente tabla resume aplicación nativa y plataforma nativa de hello y exploradores compatibles con cada DRM.</span><span class="sxs-lookup"><span data-stu-id="47ef8-129">hello following table summarizes hello native platform/native app, and browsers supported by each DRM.</span></span>

| <span data-ttu-id="47ef8-130">**Plataforma de cliente**</span><span class="sxs-lookup"><span data-stu-id="47ef8-130">**Client Platform**</span></span> | <span data-ttu-id="47ef8-131">**Compatibilidad con DRM nativo**</span><span class="sxs-lookup"><span data-stu-id="47ef8-131">**Native DRM Support**</span></span> | <span data-ttu-id="47ef8-132">**Explorador/aplicación**</span><span class="sxs-lookup"><span data-stu-id="47ef8-132">**Browser/App**</span></span> | <span data-ttu-id="47ef8-133">**Formatos de streaming**</span><span class="sxs-lookup"><span data-stu-id="47ef8-133">**Streaming Formats**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="47ef8-134">**Televisores inteligentes, operador STB, OTT STB**</span><span class="sxs-lookup"><span data-stu-id="47ef8-134">**Smart TVs, operator STBs, OTT STBs**</span></span> |<span data-ttu-id="47ef8-135">PlayReady principalmente o Widevine u otros</span><span class="sxs-lookup"><span data-stu-id="47ef8-135">PlayReady primarily, and/or Widevine, and/or other</span></span> |<span data-ttu-id="47ef8-136">Linux, Opera y WebKit, otros</span><span class="sxs-lookup"><span data-stu-id="47ef8-136">Linux, Opera, WebKit, Other</span></span> |<span data-ttu-id="47ef8-137">Varios formatos</span><span class="sxs-lookup"><span data-stu-id="47ef8-137">Various formats</span></span> |
| <span data-ttu-id="47ef8-138">**Dispositivos Windows 10 (Windows PC, tabletas de Windows, Windows Phone, Xbox)**</span><span class="sxs-lookup"><span data-stu-id="47ef8-138">**Windows 10 devices (Windows PC, Windows Tablets, Windows Phone, Xbox)**</span></span> |<span data-ttu-id="47ef8-139">PlayReady</span><span class="sxs-lookup"><span data-stu-id="47ef8-139">PlayReady</span></span> |<span data-ttu-id="47ef8-140">MS Edge/IE11/EME</span><span class="sxs-lookup"><span data-stu-id="47ef8-140">MS Edge/IE11/EME</span></span><br/><br/><br/><span data-ttu-id="47ef8-141">UWP</span><span class="sxs-lookup"><span data-stu-id="47ef8-141">UWP</span></span> |<span data-ttu-id="47ef8-142">DASH (no se admite PlayReady para HLS)</span><span class="sxs-lookup"><span data-stu-id="47ef8-142">DASH (For HLS, PlayReady is not supported)</span></span><br/><br/><span data-ttu-id="47ef8-143">DASH, Smooth Streaming (no se admite PlayReady para HLS)</span><span class="sxs-lookup"><span data-stu-id="47ef8-143">DASH, Smooth Streaming (For HLS, PlayReady is not supported)</span></span> |
| <span data-ttu-id="47ef8-144">**Dispositivos Android (teléfono, tableta, TV)**</span><span class="sxs-lookup"><span data-stu-id="47ef8-144">**Android devices (Phone, Tablet, TV)**</span></span> |<span data-ttu-id="47ef8-145">Widevine</span><span class="sxs-lookup"><span data-stu-id="47ef8-145">Widevine</span></span> |<span data-ttu-id="47ef8-146">Chrome/EME</span><span class="sxs-lookup"><span data-stu-id="47ef8-146">Chrome/EME</span></span> |<span data-ttu-id="47ef8-147">DASH, HLS</span><span class="sxs-lookup"><span data-stu-id="47ef8-147">DASH,HLS</span></span> |
| <span data-ttu-id="47ef8-148">**iOS (iPhone, iPad), clientes de OS X y Apple TV**</span><span class="sxs-lookup"><span data-stu-id="47ef8-148">**iOS (iPhone, iPad), OS X clients and Apple TV**</span></span> |<span data-ttu-id="47ef8-149">FairPlay</span><span class="sxs-lookup"><span data-stu-id="47ef8-149">FairPlay</span></span> |<span data-ttu-id="47ef8-150">Safari 8+/EME</span><span class="sxs-lookup"><span data-stu-id="47ef8-150">Safari 8+/EME</span></span> |<span data-ttu-id="47ef8-151">HLS</span><span class="sxs-lookup"><span data-stu-id="47ef8-151">HLS</span></span> |


<span data-ttu-id="47ef8-152">Teniendo en cuenta el estado actual de Hola de implementación para cada DRM, un servicio normalmente, deseará tooimplement 2 o 3 DRMs toomake seguro de que tratar todos los tipos de Hola de puntos de conexión de hello mejor manera.</span><span class="sxs-lookup"><span data-stu-id="47ef8-152">Considering hello current state of deployment for each DRM, a service will typically want tooimplement 2 or 3 DRMs toomake sure you address all hello types of endpoints in hello best way.</span></span>

<span data-ttu-id="47ef8-153">Hay un equilibrio entre la complejidad de Hola de lógica de servicio de Hola y complejidad de hello en tooreach de lado de cliente de hello un cierto nivel de usuario de la experiencia en hello varios clientes.</span><span class="sxs-lookup"><span data-stu-id="47ef8-153">There is a tradeoff between hello complexity of hello service logic and hello complexity on hello client side tooreach a certain level of user experience on hello various clients.</span></span>

<span data-ttu-id="47ef8-154">toomake su selección, tenga en cuenta estos hechos:</span><span class="sxs-lookup"><span data-stu-id="47ef8-154">toomake your selection, keep in mind these facts:</span></span>

* <span data-ttu-id="47ef8-155">PlayReady se implementa de forma nativa en cada dispositivo de Windows, en algunos dispositivos Android y está disponibles a través de SDK de software en prácticamente cualquier plataforma.</span><span class="sxs-lookup"><span data-stu-id="47ef8-155">PlayReady is natively implemented in every Windows device, on some Android devices, and available through software SDKs on virtually any platform</span></span>
* <span data-ttu-id="47ef8-156">Widevine se implementa de forma nativa en todos los dispositivos Android, en Chrome y algunos otros dispositivos.</span><span class="sxs-lookup"><span data-stu-id="47ef8-156">Widevine is natively implemented in every Android device, in Chrome, and in some other devices</span></span>
* <span data-ttu-id="47ef8-157">FairPlay solo está disponible en clientes iOS y Mac OS o a través de iTunes.</span><span class="sxs-lookup"><span data-stu-id="47ef8-157">FairPlay is available only on iOS and Mac OS clients or through iTunes.</span></span>

<span data-ttu-id="47ef8-158">Por tanto un multi-DRM típico sería:</span><span class="sxs-lookup"><span data-stu-id="47ef8-158">So a typical multi-DRM would be:</span></span>

* <span data-ttu-id="47ef8-159">Opción 1: PlayReady y Widevine</span><span class="sxs-lookup"><span data-stu-id="47ef8-159">Option 1: PlayReady and Widevine</span></span>
* <span data-ttu-id="47ef8-160">Opción 2: PlayReady, Widevine y FairPlay</span><span class="sxs-lookup"><span data-stu-id="47ef8-160">Option 2: PlayReady, Widevine and FairPlay</span></span>

## <a name="a-reference-design"></a><span data-ttu-id="47ef8-161">Un diseño de referencia</span><span class="sxs-lookup"><span data-stu-id="47ef8-161">A reference design</span></span>
<span data-ttu-id="47ef8-162">En esta sección, se presentará un diseño de referencia que es independiente tootechnologies utiliza tooimplement lo.</span><span class="sxs-lookup"><span data-stu-id="47ef8-162">In this section, we will present a reference design which is agnostic tootechnologies used tooimplement it.</span></span>

<span data-ttu-id="47ef8-163">Un subsistema DRM puede contener Hola de los componentes siguientes:</span><span class="sxs-lookup"><span data-stu-id="47ef8-163">A DRM subsystem may contain hello following components:</span></span>

1. <span data-ttu-id="47ef8-164">Administración de claves</span><span class="sxs-lookup"><span data-stu-id="47ef8-164">Key management</span></span>
2. <span data-ttu-id="47ef8-165">Empaquetado de DRM</span><span class="sxs-lookup"><span data-stu-id="47ef8-165">DRM packaging</span></span>
3. <span data-ttu-id="47ef8-166">Entrega de licencias DRM</span><span class="sxs-lookup"><span data-stu-id="47ef8-166">DRM license delivery</span></span>
4. <span data-ttu-id="47ef8-167">Comprobación de derechos</span><span class="sxs-lookup"><span data-stu-id="47ef8-167">Entitlement check</span></span>
5. <span data-ttu-id="47ef8-168">Autenticación y autorización</span><span class="sxs-lookup"><span data-stu-id="47ef8-168">Authentication/authorization</span></span>
6. <span data-ttu-id="47ef8-169">Reproductor</span><span class="sxs-lookup"><span data-stu-id="47ef8-169">Player</span></span>
7. <span data-ttu-id="47ef8-170">Origen y CDN</span><span class="sxs-lookup"><span data-stu-id="47ef8-170">Origin/CDN</span></span>

<span data-ttu-id="47ef8-171">Hello siguiente diagrama muestra hello alto nivel interacción entre los componentes de hello en un subsistema DRM.</span><span class="sxs-lookup"><span data-stu-id="47ef8-171">hello following diagram illustrates hello high level interaction among hello components in a DRM subsystem.</span></span>

![Subsistema DRM con CENC](./media/media-services-cenc-with-multidrm-access-control/media-services-generic-drm-subsystem-with-cenc.png)

<span data-ttu-id="47ef8-173">Hay tres básicas "capas" en el diseño de hello:</span><span class="sxs-lookup"><span data-stu-id="47ef8-173">There are three basic “layers” in hello design:</span></span>

1. <span data-ttu-id="47ef8-174">Capa de área de operaciones (en negro), que no se expone externamente.</span><span class="sxs-lookup"><span data-stu-id="47ef8-174">Back office layer (in black) which are not exposed externally;</span></span>
2. <span data-ttu-id="47ef8-175">Capa de "Zona Desmilitarizada" (azul) que contiene todos los extremos de hello orientados al público;</span><span class="sxs-lookup"><span data-stu-id="47ef8-175">“DMZ” layer (blue) containing all hello endpoints facing public;</span></span>
3. <span data-ttu-id="47ef8-176">Capa de Internet pública (azul claro), que contiene la CDN y los reproductores con el tráfico que atraviesa la Internet pública.</span><span class="sxs-lookup"><span data-stu-id="47ef8-176">Public Internet layer (light blue) containing CDN and players with traffic across public Internet.</span></span>

<span data-ttu-id="47ef8-177">Debe haber una herramienta de administración del contenido para controlar la protección DRM, con independencia de que el cifrado sea estático o dinámico.</span><span class="sxs-lookup"><span data-stu-id="47ef8-177">There should be a content management tool for controlling DRM protection, regardless it is static or dynamic encryption.</span></span> <span data-ttu-id="47ef8-178">deben incluir entradas de Hello para el cifrado de DRM:</span><span class="sxs-lookup"><span data-stu-id="47ef8-178">hello inputs for DRM encryption should include:</span></span>

1. <span data-ttu-id="47ef8-179">Contenido de vídeo MBR</span><span class="sxs-lookup"><span data-stu-id="47ef8-179">MBR video content;</span></span>
2. <span data-ttu-id="47ef8-180">Clave de contenido</span><span class="sxs-lookup"><span data-stu-id="47ef8-180">Content key;</span></span>
3. <span data-ttu-id="47ef8-181">Las direcciones URL de adquisición de licencias.</span><span class="sxs-lookup"><span data-stu-id="47ef8-181">License acquisition URLs.</span></span>

<span data-ttu-id="47ef8-182">Durante el tiempo de reproducción, flujo de nivel alto de hello es:</span><span class="sxs-lookup"><span data-stu-id="47ef8-182">During playback time, hello high level flow is:</span></span>

1. <span data-ttu-id="47ef8-183">El usuario está autenticado.</span><span class="sxs-lookup"><span data-stu-id="47ef8-183">User is authenticated;</span></span>
2. <span data-ttu-id="47ef8-184">Token de autorización se crea para el usuario de hello;</span><span class="sxs-lookup"><span data-stu-id="47ef8-184">Authorization token is created for hello user;</span></span>
3. <span data-ttu-id="47ef8-185">El contenido protegido con DRM (manifiesto) está descargado tooplayer;</span><span class="sxs-lookup"><span data-stu-id="47ef8-185">DRM protected content (manifest) is downloaded tooplayer;</span></span>
4. <span data-ttu-id="47ef8-186">El Reproductor envía servidores de toolicense de solicitud de adquisición de licencias junto con el identificador de clave y la autorización token.</span><span class="sxs-lookup"><span data-stu-id="47ef8-186">Player submits license acquisition request toolicense servers together with key ID and authorization token.</span></span>

<span data-ttu-id="47ef8-187">Antes de mover toohello siguiente tema, algunas palabras sobre Hola de diseño de administración de claves.</span><span class="sxs-lookup"><span data-stu-id="47ef8-187">Before moving toohello next topic, a few words about hello design of key management.</span></span>

| <span data-ttu-id="47ef8-188">**Clave de contenido a activo**</span><span class="sxs-lookup"><span data-stu-id="47ef8-188">**ContentKey–to-Asset**</span></span> | <span data-ttu-id="47ef8-189">**Escenario**</span><span class="sxs-lookup"><span data-stu-id="47ef8-189">**Scenario**</span></span> |
| --- | --- |
| <span data-ttu-id="47ef8-190">1-1</span><span class="sxs-lookup"><span data-stu-id="47ef8-190">1–to-1</span></span> |<span data-ttu-id="47ef8-191">caso más simple de Hola.</span><span class="sxs-lookup"><span data-stu-id="47ef8-191">hello simplest case.</span></span> <span data-ttu-id="47ef8-192">Proporciona mejor control posible Hola.</span><span class="sxs-lookup"><span data-stu-id="47ef8-192">It provides hello finest control.</span></span> <span data-ttu-id="47ef8-193">Pero eso se suele traducir en el coste de entrega de licencia más elevado de Hola.</span><span class="sxs-lookup"><span data-stu-id="47ef8-193">But this generally results in hello highest license delivery cost.</span></span> <span data-ttu-id="47ef8-194">Se requiere al menos una solicitud de licencia para cada activo protegido.</span><span class="sxs-lookup"><span data-stu-id="47ef8-194">At minimum one license request is required for each protected asset.</span></span> |
| <span data-ttu-id="47ef8-195">1 a muchos</span><span class="sxs-lookup"><span data-stu-id="47ef8-195">1–to-Many</span></span> |<span data-ttu-id="47ef8-196">Puede usar Hola mismo contenido clave para varios activos.</span><span class="sxs-lookup"><span data-stu-id="47ef8-196">You could use hello same content key for multiple assets.</span></span> <span data-ttu-id="47ef8-197">Por ejemplo, para todos los recursos de hello en un grupo lógico como un género o un subconjunto de género (o película Gene), podría utilizar una única clave de contenido.</span><span class="sxs-lookup"><span data-stu-id="47ef8-197">For example, for all hello assets in a logical group such as a genre or subset of genre (or Movie Gene), you could use a single content key.</span></span> |
| <span data-ttu-id="47ef8-198">Muchos a 1</span><span class="sxs-lookup"><span data-stu-id="47ef8-198">Many–to-1</span></span> |<span data-ttu-id="47ef8-199">Se necesitan varias claves de contenido para cada activo.</span><span class="sxs-lookup"><span data-stu-id="47ef8-199">Multiple content keys are needed for each asset.</span></span> <br/><br/><span data-ttu-id="47ef8-200">Por ejemplo, si necesita tooapply dinámica CENC protección con DRM de múltiples de MPEG-DASH y cifrado de AES-128 dinámico para HLS, necesita dos claves de contenido independientes, cada uno con su propio ContentKeyType.</span><span class="sxs-lookup"><span data-stu-id="47ef8-200">For example, if you need tooapply dynamic CENC protection with multi-DRM for MPEG-DASH, and dynamic AES-128 encryption for HLS, you need two separate content keys, each with its own ContentKeyType.</span></span> <span data-ttu-id="47ef8-201">(Hola clave de contenido utilizado para la protección de CENC dinámico, ContentKeyType.CommonEncryption debe usarse, mientras que para hello contenido se debe utilizar la clave utilizada para el cifrado AES-128 dinámico, ContentKeyType.EnvelopeEncryption.)</span><span class="sxs-lookup"><span data-stu-id="47ef8-201">(For hello content key used for dynamic CENC protection, ContentKeyType.CommonEncryption should be used, while for hello content key used for dynamic AES-128 encryption, ContentKeyType.EnvelopeEncryption should be used.)</span></span><br/><br/><span data-ttu-id="47ef8-202">Otro ejemplo, en la protección de CENC de guión de contenido, en teoría, una clave de contenido puede ser usado tooprotect secuencia de vídeo y otra secuencia de audio tooprotect de clave de contenido.</span><span class="sxs-lookup"><span data-stu-id="47ef8-202">Another example, in CENC protection of DASH content, in theory, one content key can be used tooprotect video stream and another content key tooprotect audio stream.</span></span> |
| <span data-ttu-id="47ef8-203">Muchos – demasiado varios</span><span class="sxs-lookup"><span data-stu-id="47ef8-203">Many – too- Many</span></span> |<span data-ttu-id="47ef8-204">Combinación de Hola por encima de los dos escenarios: Hola a un conjunto de contenido de las claves se utilizan para cada uno de varios activos en hello mismo "ID".</span><span class="sxs-lookup"><span data-stu-id="47ef8-204">Combination of hello above two scenarios: one set of content keys are used for each of hello multiple assets in hello same asset “group”.</span></span> |

<span data-ttu-id="47ef8-205">Tooconsider de otro factor importante es el uso de Hola de licencias persistentes y no persistentes.</span><span class="sxs-lookup"><span data-stu-id="47ef8-205">Another important factor tooconsider is hello use of persistent and non-persistent licenses.</span></span>

<span data-ttu-id="47ef8-206">¿Por qué son importantes estas consideraciones?</span><span class="sxs-lookup"><span data-stu-id="47ef8-206">Why are these considerations important?</span></span>

<span data-ttu-id="47ef8-207">Disponen de entrega de impacto directo toolicense costo si usas nube pública para la entrega de licencia.</span><span class="sxs-lookup"><span data-stu-id="47ef8-207">They have direct impact toolicense delivery cost if you use public cloud for license delivery.</span></span> <span data-ttu-id="47ef8-208">Veamos Hola siguiendo dos diseños casos tooillustrate:</span><span class="sxs-lookup"><span data-stu-id="47ef8-208">Let’s consider hello following two different design cases tooillustrate:</span></span>

1. <span data-ttu-id="47ef8-209">Suscripción mensual: utiliza licencias persistentes y la asignación 1 a muchos entre claves de contenido y recursos.</span><span class="sxs-lookup"><span data-stu-id="47ef8-209">Monthly subscription: Use persistent license, and 1-to-many content key-to-asset mapping.</span></span> <span data-ttu-id="47ef8-210">Por ejemplo,</span><span class="sxs-lookup"><span data-stu-id="47ef8-210">E.g.</span></span> <span data-ttu-id="47ef8-211">para todas las películas de niños hello, usamos una sola clave de contenido para el cifrado.</span><span class="sxs-lookup"><span data-stu-id="47ef8-211">for all hello kids movies, we use a single content key for encryption.</span></span> <span data-ttu-id="47ef8-212">En este caso:</span><span class="sxs-lookup"><span data-stu-id="47ef8-212">In this case:</span></span>

    <span data-ttu-id="47ef8-213">El número total de licencias solicitadas para todas las películas o dispositivos de niños = 1</span><span class="sxs-lookup"><span data-stu-id="47ef8-213">Total # licenses requested for all kids movies/device = 1</span></span>
2. <span data-ttu-id="47ef8-214">Suscripción mensual: utiliza licencias no persistentes y asignación 1 a 1 entre claves de contenido y recursos.</span><span class="sxs-lookup"><span data-stu-id="47ef8-214">Monthly subscription: Use non-persistent license, and 1-to-1 mapping between content key and asset.</span></span> <span data-ttu-id="47ef8-215">En este caso:</span><span class="sxs-lookup"><span data-stu-id="47ef8-215">In this case:</span></span>

    <span data-ttu-id="47ef8-216">El número total de licencias solicitadas para todas las películas o dispositivos de niños =  [n.º de películas vistas] x [n.º de sesiones].</span><span class="sxs-lookup"><span data-stu-id="47ef8-216">Total # licenses requested for all kids movies/device = [# movies watched] x [# sessions]</span></span>

<span data-ttu-id="47ef8-217">Como puede ver fácilmente, Hola dos diseños diferentes como resultado licencia muy diferente solicitar patrones, por tanto, entrega de licencia de costo si no se proporciona el servicio de entrega de licencias por una nube pública, como los servicios multimedia de Azure.</span><span class="sxs-lookup"><span data-stu-id="47ef8-217">As you can easily see, hello two different designs result in very different license request patterns hence license delivery cost if license delivery service is provided by a public cloud such as Azure Media Services.</span></span>

## <a name="mapping-design-tootechnology-for-implementation"></a><span data-ttu-id="47ef8-218">Asignación tootechnology de diseño para la implementación</span><span class="sxs-lookup"><span data-stu-id="47ef8-218">Mapping design tootechnology for implementation</span></span>
<span data-ttu-id="47ef8-219">A continuación, se asigna el nuestro tootechnologies diseño genérico en la plataforma de servicios multimedia de Microsoft Azure o SQL Azure, mediante la especificación de qué toouse tecnología para cada bloque de creación.</span><span class="sxs-lookup"><span data-stu-id="47ef8-219">Next, we map our generic design tootechnologies on Microsoft Azure/Azure Media Services platform, by specifying which technology toouse for each building block.</span></span>

<span data-ttu-id="47ef8-220">Hello siguiente tabla muestra hello asignación:</span><span class="sxs-lookup"><span data-stu-id="47ef8-220">hello following table shows hello mapping:</span></span>

| <span data-ttu-id="47ef8-221">**Bloque de creación**</span><span class="sxs-lookup"><span data-stu-id="47ef8-221">**Building Block**</span></span> | <span data-ttu-id="47ef8-222">**Technology**</span><span class="sxs-lookup"><span data-stu-id="47ef8-222">**Technology**</span></span> |
| --- | --- |
| <span data-ttu-id="47ef8-223">**Reproductor**</span><span class="sxs-lookup"><span data-stu-id="47ef8-223">**Player**</span></span> |[<span data-ttu-id="47ef8-224">Reproductor multimedia de Azure</span><span class="sxs-lookup"><span data-stu-id="47ef8-224">Azure Media Player</span></span>](https://azure.microsoft.com/services/media-services/media-player/) |
| <span data-ttu-id="47ef8-225">**Proveedor de identidades (IDP)**</span><span class="sxs-lookup"><span data-stu-id="47ef8-225">**Identity Provider (IDP)**</span></span> |<span data-ttu-id="47ef8-226">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="47ef8-226">Azure Active Directory</span></span> |
| <span data-ttu-id="47ef8-227">**Servicio de token seguro (STS)**</span><span class="sxs-lookup"><span data-stu-id="47ef8-227">**Secure Token Service (STS)**</span></span> |<span data-ttu-id="47ef8-228">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="47ef8-228">Azure Active Directory</span></span> |
| <span data-ttu-id="47ef8-229">**Flujo de trabajo de protección DRM**</span><span class="sxs-lookup"><span data-stu-id="47ef8-229">**DRM Protection Workflow**</span></span> |<span data-ttu-id="47ef8-230">Protección dinámica de Servicios multimedia de Azure</span><span class="sxs-lookup"><span data-stu-id="47ef8-230">Azure Media Services Dynamic Protection</span></span> |
| <span data-ttu-id="47ef8-231">**Entrega de licencias DRM**</span><span class="sxs-lookup"><span data-stu-id="47ef8-231">**DRM License Delivery**</span></span> |<span data-ttu-id="47ef8-232">1. Entrega de licencias de Azure Media Services (PlayReady, Widevine, FairPlay), o</span><span class="sxs-lookup"><span data-stu-id="47ef8-232">1. Azure Media Services License Delivery (PlayReady, Widevine, FairPlay), or</span></span> <br/><span data-ttu-id="47ef8-233">2. Servidor de licencias de Axinom,</span><span class="sxs-lookup"><span data-stu-id="47ef8-233">2. Axinom License Server,</span></span> <br/><span data-ttu-id="47ef8-234">3. Servidor de licencias personalizado de PlayReady</span><span class="sxs-lookup"><span data-stu-id="47ef8-234">3. Custom PlayReady License Server</span></span> |
| <span data-ttu-id="47ef8-235">**Origen**</span><span class="sxs-lookup"><span data-stu-id="47ef8-235">**Origin**</span></span> |<span data-ttu-id="47ef8-236">Punto de conexión de streaming de Servicios multimedia de Azure</span><span class="sxs-lookup"><span data-stu-id="47ef8-236">Azure Media Services Streaming Endpoint</span></span> |
| <span data-ttu-id="47ef8-237">**Administración de claves**</span><span class="sxs-lookup"><span data-stu-id="47ef8-237">**Key Management**</span></span> |<span data-ttu-id="47ef8-238">No es necesaria para la implementación de referencia.</span><span class="sxs-lookup"><span data-stu-id="47ef8-238">Not needed for reference implementation</span></span> |
| <span data-ttu-id="47ef8-239">**Administración de contenido**</span><span class="sxs-lookup"><span data-stu-id="47ef8-239">**Content Management**</span></span> |<span data-ttu-id="47ef8-240">Una aplicación de consola de C#.</span><span class="sxs-lookup"><span data-stu-id="47ef8-240">A C# console application</span></span> |

<span data-ttu-id="47ef8-241">En otras palabras, el proveedor de identidades (IDP) y el servicio de token seguro (STS) serán Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47ef8-241">In other words, both Identity Provider (IDP) and Secure Token Service (STS) will be Azure AD.</span></span> <span data-ttu-id="47ef8-242">Para el reproductor, usaremos la [API del Reproductor multimedia de Azure](http://amp.azure.net/libs/amp/latest/docs/).</span><span class="sxs-lookup"><span data-stu-id="47ef8-242">For player, we will use [Azure Media Player API](http://amp.azure.net/libs/amp/latest/docs/).</span></span> <span data-ttu-id="47ef8-243">Tanto los Servicios multimedia de Azure como el Reproductor multimedia de Azure admiten DASH y CENC con varios DRM.</span><span class="sxs-lookup"><span data-stu-id="47ef8-243">Both Azure Media Services and Azure Media Player support DASH and CENC with multi-DRM.</span></span>

<span data-ttu-id="47ef8-244">Hola siguiente diagrama muestra Hola estructura y el flujo global con hello por encima de la asignación de tecnología.</span><span class="sxs-lookup"><span data-stu-id="47ef8-244">hello following diagram shows hello overall structure and flow with hello above technology mapping.</span></span>

![CENC en AMS](./media/media-services-cenc-with-multidrm-access-control/media-services-cenc-subsystem-on-AMS-platform.png)

<span data-ttu-id="47ef8-246">En orden tooset el cifrado dinámico de CENC, herramienta de administración de contenido de hello usará Hola siguientes entradas:</span><span class="sxs-lookup"><span data-stu-id="47ef8-246">In order tooset up dynamic CENC encryption, hello content management tool will use hello following inputs:</span></span>

1. <span data-ttu-id="47ef8-247">Contenido abierto</span><span class="sxs-lookup"><span data-stu-id="47ef8-247">Open content;</span></span>
2. <span data-ttu-id="47ef8-248">Clave de contenido de la generación o administración de claves</span><span class="sxs-lookup"><span data-stu-id="47ef8-248">Content key from key generation/management;</span></span>
3. <span data-ttu-id="47ef8-249">Direcciones URL de adquisición de licencias</span><span class="sxs-lookup"><span data-stu-id="47ef8-249">License acquisition URLs;</span></span>
4. <span data-ttu-id="47ef8-250">Una lista de información de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47ef8-250">A list of information from Azure AD.</span></span>

<span data-ttu-id="47ef8-251">resultado de Hello de la herramienta de administración de contenido de hello será:</span><span class="sxs-lookup"><span data-stu-id="47ef8-251">hello output of hello content management tool will be:</span></span>

1. <span data-ttu-id="47ef8-252">ContentKeyAuthorizationPolicy que contiene la especificación de hello en la entrega de licencias comprueba un token de JWT y especificaciones de licencias DRM;</span><span class="sxs-lookup"><span data-stu-id="47ef8-252">ContentKeyAuthorizationPolicy containing hello specification on how license delivery verifies a JWT token and DRM license specifications;</span></span>
2. <span data-ttu-id="47ef8-253">AssetDeliveryPolicy, que contiene las especificaciones de formato de streaming, protección DRM y direcciones URL de adquisición de licencias.</span><span class="sxs-lookup"><span data-stu-id="47ef8-253">AssetDeliveryPolicy containing specifications on streaming format, DRM protection and license acquisition URLs.</span></span>

<span data-ttu-id="47ef8-254">En tiempo de ejecución, flujo de hello es como a continuación:</span><span class="sxs-lookup"><span data-stu-id="47ef8-254">During runtime, hello flow is as below:</span></span>

1. <span data-ttu-id="47ef8-255">Tras la autenticación del usuario, se genera un token de JWT.</span><span class="sxs-lookup"><span data-stu-id="47ef8-255">Upon user authentication, a JWT token is generated;</span></span>
2. <span data-ttu-id="47ef8-256">Una de las notificaciones de hello contenidas en el token de JWT de Hola es notificación "grupos" que contiene el identificador de objeto de grupo de Hola de "EntitledUserGroup".</span><span class="sxs-lookup"><span data-stu-id="47ef8-256">One of hello claims contained in hello JWT token is “groups” claim containing hello group object ID of “EntitledUserGroup”.</span></span> <span data-ttu-id="47ef8-257">Esta notificación se utilizará para pasar la "comprobación de derechos".</span><span class="sxs-lookup"><span data-stu-id="47ef8-257">This claim will be used for passing “entitlement check”.</span></span>
3. <span data-ttu-id="47ef8-258">Manifiesto de cliente de descargas de Reproductor de un CENC contenido protegido y "ve" siguiente hello:</span><span class="sxs-lookup"><span data-stu-id="47ef8-258">Player downloads client manifest of a CENC protected content and “sees” hello following:</span></span>

   1. <span data-ttu-id="47ef8-259">El id. de clave.</span><span class="sxs-lookup"><span data-stu-id="47ef8-259">key ID,</span></span>
   2. <span data-ttu-id="47ef8-260">contenido de Hello es CENC protegido,</span><span class="sxs-lookup"><span data-stu-id="47ef8-260">hello content is CENC protected,</span></span>
   3. <span data-ttu-id="47ef8-261">Las direcciones URL de adquisición de licencias.</span><span class="sxs-lookup"><span data-stu-id="47ef8-261">License acquisition URLs.</span></span>
4. <span data-ttu-id="47ef8-262">El Reproductor realiza una solicitud de adquisición de licencias basada en Explorador de Hola/DRM admite.</span><span class="sxs-lookup"><span data-stu-id="47ef8-262">Player makes a license acquisition request based on hello browser/DRM supported.</span></span> <span data-ttu-id="47ef8-263">Símbolo (token) también se enviarán en solicitud de adquisición de licencias de hello, Id. de clave y de hello JWT.</span><span class="sxs-lookup"><span data-stu-id="47ef8-263">In hello license acquisition request, key ID and hello JWT token will also be submitted.</span></span> <span data-ttu-id="47ef8-264">Servicio de entrega de licencia comprobará el token JWT de Hola y notificaciones de hello contenidas antes de emitir Hola necesita licencia.</span><span class="sxs-lookup"><span data-stu-id="47ef8-264">License delivery service will verify hello JWT token and hello claims contained before issuing hello needed license.</span></span>

## <a name="implementation"></a><span data-ttu-id="47ef8-265">Implementación</span><span class="sxs-lookup"><span data-stu-id="47ef8-265">Implementation</span></span>
### <a name="implementation-procedures"></a><span data-ttu-id="47ef8-266">Procedimientos de implementación</span><span class="sxs-lookup"><span data-stu-id="47ef8-266">Implementation procedures</span></span>
<span data-ttu-id="47ef8-267">implementación de Hello incluirá Hola pasos:</span><span class="sxs-lookup"><span data-stu-id="47ef8-267">hello implementation will include hello following steps:</span></span>

1. <span data-ttu-id="47ef8-268">Preparar los recursos de prueba: fragmentado de codificar/paquete un vídeo de prueba toomulti-bitrate MP4 en servicios multimedia de Azure.</span><span class="sxs-lookup"><span data-stu-id="47ef8-268">Prepare test asset(s): encode/package a test video toomulti-bitrate fragmented MP4 in Azure Media Services.</span></span> <span data-ttu-id="47ef8-269">Este activo NO está protegido con DRM.</span><span class="sxs-lookup"><span data-stu-id="47ef8-269">This asset is NOT DRM protected.</span></span> <span data-ttu-id="47ef8-270">La protección DRM se realizará posteriormente mediante protección dinámica.</span><span class="sxs-lookup"><span data-stu-id="47ef8-270">DRM protection will be done by dynamic protection later.</span></span>
2. <span data-ttu-id="47ef8-271">Crear el id. de clave y la clave de contenido (opcionalmente a partir de la inicialización de clave).</span><span class="sxs-lookup"><span data-stu-id="47ef8-271">Create key ID and content key (optionally from key seed).</span></span> <span data-ttu-id="47ef8-272">Para nuestro propósito, el sistema de administración de claves no es necesario puesto que estamos trabajando con un solo conjunto de id. de clave y clave de contenido para un par de activos de prueba.</span><span class="sxs-lookup"><span data-stu-id="47ef8-272">For our purpose, key management system is not needed since we are dealing with only a single set of key ID and content key for a couple of test assets;</span></span>
3. <span data-ttu-id="47ef8-273">Usar servicios de entrega de licencia AMS API tooconfigure multi-DRM de los activos de prueba de Hola.</span><span class="sxs-lookup"><span data-stu-id="47ef8-273">Use AMS API tooconfigure multi-DRM license delivery services for hello test asset.</span></span> <span data-ttu-id="47ef8-274">Si usa servidores de licencias personalizados por su empresa o los proveedores de su empresa en lugar de servicios de licencias de servicios multimedia de Azure, puede omitir este paso y especifique las direcciones URL de adquisición de licencias en el paso de hello para la configuración de entrega de licencia.</span><span class="sxs-lookup"><span data-stu-id="47ef8-274">If you are using custom license servers by your company or your company’s vendors instead of license services in Azure Media Services, you can skip this step and specify license acquisition URLs in hello step for configuring license delivery.</span></span> <span data-ttu-id="47ef8-275">API de AMS es necesario toospecify detallada algunas configuraciones, como la restricción de la directiva de autorización, plantillas de respuesta de los servicios de licencias DRM diferentes, etcetera de licencia. En este momento, Hola portal de Azure proporcionan Hola necesita la interfaz de usuario para esta configuración, todavía no.</span><span class="sxs-lookup"><span data-stu-id="47ef8-275">AMS API is needed toospecify some detailed configurations, such as authorization policy restriction, license response templates for different DRM license services, etc. At this time, hello Azure portal does not yet provide hello needed UI for this configuration.</span></span> <span data-ttu-id="47ef8-276">Puede encontrar información de nivel de API y código de ejemplo en el documento de Julia Kornich: [Uso de cifrado dinámico común de PlayReady o Widevine](media-services-protect-with-drm.md).</span><span class="sxs-lookup"><span data-stu-id="47ef8-276">You can find API level info and sample code in Julia Kornich’s document: [Using PlayReady and/or Widevine Dynamic Common Encryption](media-services-protect-with-drm.md).</span></span>
4. <span data-ttu-id="47ef8-277">Usar Directiva de entrega de API de AMS tooconfigure activo de los activos de prueba de Hola.</span><span class="sxs-lookup"><span data-stu-id="47ef8-277">Use AMS API tooconfigure asset delivery policy for hello test asset.</span></span> <span data-ttu-id="47ef8-278">Puede encontrar información de nivel de API y código de ejemplo en el documento de Julia Kornich: [Uso de cifrado dinámico común de PlayReady o Widevine](media-services-protect-with-drm.md).</span><span class="sxs-lookup"><span data-stu-id="47ef8-278">You can find API level info and sample code in Julia Kornich’s document: [Using PlayReady and/or Widevine Dynamic Common Encryption](media-services-protect-with-drm.md).</span></span>
5. <span data-ttu-id="47ef8-279">Crear y configurar un inquilino de Azure Active Directory en Azure.</span><span class="sxs-lookup"><span data-stu-id="47ef8-279">Create and configure an Azure Active Directory tenant in Azure;</span></span>
6. <span data-ttu-id="47ef8-280">Crear algunas cuentas de usuario y grupos en su inquilino de Azure Active Directory: debe crear al menos "EntitledUser" agrupar y agregar un grupo de toothis de usuario.</span><span class="sxs-lookup"><span data-stu-id="47ef8-280">Create a few user accounts and groups in your Azure Active Directory tenant: you should create at least “EntitledUser” group and add a user toothis group.</span></span> <span data-ttu-id="47ef8-281">Los usuarios de este grupo pasará la comprobación de derechos en la adquisición de licencias y los usuarios de este grupo se producirá un error de comprobación de la autenticación de toopass y no se puede tooacquire ninguna licencia.</span><span class="sxs-lookup"><span data-stu-id="47ef8-281">Users in this group will pass entitlement check in license acquisition and users not in this group will fail toopass authentication check and will not be able tooacquire any license.</span></span> <span data-ttu-id="47ef8-282">Ser un miembro de este grupo de "EntitledUser" es una notificación "grupos" necesarios en hello token de JWT emitido por Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47ef8-282">Being a member of this “EntitledUser” group is a required “groups” claim in hello JWT token issued by Azure AD.</span></span> <span data-ttu-id="47ef8-283">Este requisito de notificación debe especificarse en la configuración del paso de servicios de entrega de licencias de varios DRM.</span><span class="sxs-lookup"><span data-stu-id="47ef8-283">This claim requirement should be specified in configuring multi-DRM license delivery services step.</span></span>
7. <span data-ttu-id="47ef8-284">Crear una aplicación de ASP.NET MVC que hospedará el reproductor de vídeo.</span><span class="sxs-lookup"><span data-stu-id="47ef8-284">Create an ASP.NET MVC app which will be hosting your video player.</span></span> <span data-ttu-id="47ef8-285">Esta aplicación ASP.NET se protegerán con la autenticación del usuario en el inquilino de Azure Active Directory Hola.</span><span class="sxs-lookup"><span data-stu-id="47ef8-285">This ASP.NET app will be protected with user authentication against hello Azure Active Directory tenant.</span></span> <span data-ttu-id="47ef8-286">Notificaciones adecuadas se incluirán en los tokens de acceso de hello obtenidos después de la autenticación de usuario.</span><span class="sxs-lookup"><span data-stu-id="47ef8-286">Proper claims will be included in hello access tokens obtained after user authentication.</span></span> <span data-ttu-id="47ef8-287">Para este paso se recomienda la API de OpenID Connect.</span><span class="sxs-lookup"><span data-stu-id="47ef8-287">OpenID Connect API is recommended for this step.</span></span> <span data-ttu-id="47ef8-288">Necesita hello tooinstall siguientes paquetes de NuGet:</span><span class="sxs-lookup"><span data-stu-id="47ef8-288">You need tooinstall hello following NuGet packages:</span></span>
   * <span data-ttu-id="47ef8-289">Install-Package Microsoft.Azure.ActiveDirectory.GraphClient</span><span class="sxs-lookup"><span data-stu-id="47ef8-289">Install-Package Microsoft.Azure.ActiveDirectory.GraphClient</span></span>
   * <span data-ttu-id="47ef8-290">Install-Package Microsoft.Owin.Security.OpenIdConnect</span><span class="sxs-lookup"><span data-stu-id="47ef8-290">Install-Package Microsoft.Owin.Security.OpenIdConnect</span></span>
   * <span data-ttu-id="47ef8-291">Install-Package Microsoft.Owin.Security.Cookies</span><span class="sxs-lookup"><span data-stu-id="47ef8-291">Install-Package Microsoft.Owin.Security.Cookies</span></span>
   * <span data-ttu-id="47ef8-292">Install-Package Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="47ef8-292">Install-Package Microsoft.Owin.Host.SystemWeb</span></span>
   * <span data-ttu-id="47ef8-293">Install-Package Microsoft.IdentityModel.Clients.ActiveDirectory</span><span class="sxs-lookup"><span data-stu-id="47ef8-293">Install-Package Microsoft.IdentityModel.Clients.ActiveDirectory</span></span>
8. <span data-ttu-id="47ef8-294">Crear un reproductor mediante la [API del Reproductor multimedia de Azure](http://amp.azure.net/libs/amp/latest/docs/).</span><span class="sxs-lookup"><span data-stu-id="47ef8-294">Create a player using [Azure Media Player API](http://amp.azure.net/libs/amp/latest/docs/).</span></span> <span data-ttu-id="47ef8-295">[API del Azure Reproductor ProtectionInfo](http://amp.azure.net/libs/amp/latest/docs/) permite toospecify qué toouse de tecnología DRM en otra plataforma DRM.</span><span class="sxs-lookup"><span data-stu-id="47ef8-295">[Azure Media Player’s ProtectionInfo API](http://amp.azure.net/libs/amp/latest/docs/) allows you toospecify which DRM technology toouse on different DRM platform.</span></span>
9. <span data-ttu-id="47ef8-296">Matriz de pruebas:</span><span class="sxs-lookup"><span data-stu-id="47ef8-296">Test matrix:</span></span>

| <span data-ttu-id="47ef8-297">**DRM**</span><span class="sxs-lookup"><span data-stu-id="47ef8-297">**DRM**</span></span> | <span data-ttu-id="47ef8-298">**Browser**</span><span class="sxs-lookup"><span data-stu-id="47ef8-298">**Browser**</span></span> | <span data-ttu-id="47ef8-299">**Resultado de usuario autorizado**</span><span class="sxs-lookup"><span data-stu-id="47ef8-299">**Result for Entitled User**</span></span> | <span data-ttu-id="47ef8-300">**Resultado de usuario no autorizado**</span><span class="sxs-lookup"><span data-stu-id="47ef8-300">**Result for Un-entitled User**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="47ef8-301">**PlayReady**</span><span class="sxs-lookup"><span data-stu-id="47ef8-301">**PlayReady**</span></span> |<span data-ttu-id="47ef8-302">MS Edge o IE11 en Windows 10</span><span class="sxs-lookup"><span data-stu-id="47ef8-302">MS Edge or IE11 on Windows 10</span></span> |<span data-ttu-id="47ef8-303">Correcto</span><span class="sxs-lookup"><span data-stu-id="47ef8-303">Succeed</span></span> |<span data-ttu-id="47ef8-304">Fail (no superado)</span><span class="sxs-lookup"><span data-stu-id="47ef8-304">Fail</span></span> |
| <span data-ttu-id="47ef8-305">**Widevine**</span><span class="sxs-lookup"><span data-stu-id="47ef8-305">**Widevine**</span></span> |<span data-ttu-id="47ef8-306">Chrome en Windows 10</span><span class="sxs-lookup"><span data-stu-id="47ef8-306">Chrome on Windows 10</span></span> |<span data-ttu-id="47ef8-307">Correcto</span><span class="sxs-lookup"><span data-stu-id="47ef8-307">Succeed</span></span> |<span data-ttu-id="47ef8-308">Fail (no superado)</span><span class="sxs-lookup"><span data-stu-id="47ef8-308">Fail</span></span> |
| <span data-ttu-id="47ef8-309">**FairPlay**</span><span class="sxs-lookup"><span data-stu-id="47ef8-309">**FairPlay**</span></span> |<span data-ttu-id="47ef8-310">TBD</span><span class="sxs-lookup"><span data-stu-id="47ef8-310">TBD</span></span> | | |

<span data-ttu-id="47ef8-311">George Trifonov, del equipo de Servicios multimedia de Azure, ha escrito un blog donde se proporcionan los pasos detallados para configurar Azure Active Directory para una aplicación de reproductor ASP.NET MVC: [Integrate Azure Media Services OWIN MVC based app with Azure Active Directory and restrict content key delivery based on JWT claims](http://gtrifonov.com/2015/01/24/mvc-owin-azure-media-services-ad-integration/)(Integración de una aplicación basada en OWIN MVC de Servicios multimedia de Azure con Azure Active Directory y restricción de la entrega de claves de contenido en función de las notificaciones JWT).</span><span class="sxs-lookup"><span data-stu-id="47ef8-311">George Trifonov of Azure Media Services Team has written a blog providing detailed steps in setting up Azure Active Directory for an ASP.NET MVC player app: [Integrate Azure Media Services OWIN MVC based app with Azure Active Directory and restrict content key delivery based on JWT claims](http://gtrifonov.com/2015/01/24/mvc-owin-azure-media-services-ad-integration/).</span></span>

<span data-ttu-id="47ef8-312">George también ha escrito un blog sobre la [autenticación de tokens de JWT en Servicios multimedia de Azure y Cifrado dinámico](http://gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span><span class="sxs-lookup"><span data-stu-id="47ef8-312">George has also written a blog on [JWT token Authentication in Azure Media Services and Dynamic Encryption](http://gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span></span> <span data-ttu-id="47ef8-313">Y este es su [ejemplo sobre la integración de Azure AD con la entrega de claves de Servicios multimedia de Azure](https://github.com/AzureMediaServicesSamples/Key-delivery-with-AAD-integration/).</span><span class="sxs-lookup"><span data-stu-id="47ef8-313">And here is his [sample on Azure AD integration with Azure Media Services key delivery](https://github.com/AzureMediaServicesSamples/Key-delivery-with-AAD-integration/).</span></span>

<span data-ttu-id="47ef8-314">Para más información sobre Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="47ef8-314">For information on Azure Active Directory:</span></span>

* <span data-ttu-id="47ef8-315">Puede encontrar información para desarrolladores en la [Guía para desarrolladores de Azure Active Directory](../active-directory/active-directory-developers-guide.md).</span><span class="sxs-lookup"><span data-stu-id="47ef8-315">You can find developer information in [Azure Active Directory Developer’s Guide](../active-directory/active-directory-developers-guide.md).</span></span>
* <span data-ttu-id="47ef8-316">Puede encontrar información para administradores en [Administración del directorio de Azure AD](../active-directory/active-directory-administer.md).</span><span class="sxs-lookup"><span data-stu-id="47ef8-316">You can find administrator information in [Administer Your Azure AD Directory](../active-directory/active-directory-administer.md).</span></span>

### <a name="some-gotchas-in-implementation"></a><span data-ttu-id="47ef8-317">Algunos problemas de implementación</span><span class="sxs-lookup"><span data-stu-id="47ef8-317">Some gotchas in implementation</span></span>
<span data-ttu-id="47ef8-318">Hay algunos problemas "comunes" en la implementación de Hola.</span><span class="sxs-lookup"><span data-stu-id="47ef8-318">There are some “gotchas” in hello implementation.</span></span> <span data-ttu-id="47ef8-319">Espero Hola después de la lista de "sugerencia" puede ayudarle en caso de encontrarse con problemas de la solución de problemas.</span><span class="sxs-lookup"><span data-stu-id="47ef8-319">Hopefully hello following list of “gotchas” can help you troubleshooting in case you run into issues.</span></span>

1. <span data-ttu-id="47ef8-320">La dirección URL del **emisor** debe terminar con **"/"**.</span><span class="sxs-lookup"><span data-stu-id="47ef8-320">**Issuer** URL should end with **"/"**.</span></span>  

    <span data-ttu-id="47ef8-321">**Audiencia** debe ser Hola Id. de cliente de aplicación de Reproductor y también debe agregar **"/"** final Hola de dirección URL del emisor Hola.</span><span class="sxs-lookup"><span data-stu-id="47ef8-321">**Audience** should be hello player application client ID and you should also add **"/"** at hello end of hello issuer URL.</span></span>

        <add key="ida:audience" value="[Application Client ID GUID]" />
        <add key="ida:issuer" value="https://sts.windows.net/[AAD Tenant ID]/" />

    <span data-ttu-id="47ef8-322">En [JWT descodificador](http://jwt.calebb.net/), debería ver **aud** y **iss** las indicadas a continuación en el token JWT de hello:</span><span class="sxs-lookup"><span data-stu-id="47ef8-322">In [JWT Decoder](http://jwt.calebb.net/), you should see **aud** and **iss** as below in hello JWT token:</span></span>

    ![Problema 1](./media/media-services-cenc-with-multidrm-access-control/media-services-1st-gotcha.png)
2. <span data-ttu-id="47ef8-324">Agregar permisos de aplicaciones de toohello en AAD (en la ficha configurar de la aplicación hello).</span><span class="sxs-lookup"><span data-stu-id="47ef8-324">Add Permissions toohello application in AAD (on Configure tab of hello application).</span></span> <span data-ttu-id="47ef8-325">Este paso es necesario para cada aplicación (las versiones local e implementada).</span><span class="sxs-lookup"><span data-stu-id="47ef8-325">This is required for each application (local and deployed versions).</span></span>

    ![Problema 2](./media/media-services-cenc-with-multidrm-access-control/media-services-perms-to-other-apps.png)
3. <span data-ttu-id="47ef8-327">Usar a emisor correcto de hello en configuración de la protección de CENC dinámica:</span><span class="sxs-lookup"><span data-stu-id="47ef8-327">Use hello right issuer in setting up dynamic CENC protection:</span></span>

        <add key="ida:issuer" value="https://sts.windows.net/[AAD Tenant ID]/"/>

    <span data-ttu-id="47ef8-328">Hola método siguiente no funcionará:</span><span class="sxs-lookup"><span data-stu-id="47ef8-328">hello following will not work:</span></span>

        <add key="ida:issuer" value="https://willzhanad.onmicrosoft.com/" />

    <span data-ttu-id="47ef8-329">Hola GUID es el identificador del inquilino AAD de Hola.</span><span class="sxs-lookup"><span data-stu-id="47ef8-329">hello GUID is hello AAD tenant ID.</span></span> <span data-ttu-id="47ef8-330">Hola GUID se puede encontrar en la ventana emergente de puntos de conexión en el portal de Azure.</span><span class="sxs-lookup"><span data-stu-id="47ef8-330">hello GUID can be found in Endpoints popup in Azure portal.</span></span>
4. <span data-ttu-id="47ef8-331">Otorgue privilegios de notificaciones de pertenencia a grupo.</span><span class="sxs-lookup"><span data-stu-id="47ef8-331">Grant group membership claims privileges.</span></span> <span data-ttu-id="47ef8-332">Asegúrese de que en el archivo de manifiesto de aplicación de AAD, tenemos siguiente Hola</span><span class="sxs-lookup"><span data-stu-id="47ef8-332">Make sure in AAD application manifest file, we have hello following</span></span>

    <span data-ttu-id="47ef8-333">"groupMembershipClaims": "All", (el valor predeterminado de hello es null)</span><span class="sxs-lookup"><span data-stu-id="47ef8-333">"groupMembershipClaims": "All",    (hello default value is null)</span></span>
5. <span data-ttu-id="47ef8-334">Establezca el valor adecuado de TokenType al crear los requisitos de restricción.</span><span class="sxs-lookup"><span data-stu-id="47ef8-334">Setting proper TokenType when creating restriction requirements.</span></span>

        objTokenRestrictionTemplate.TokenType = TokenType.JWT;

    <span data-ttu-id="47ef8-335">Dado que agregar compatibilidad de JWT (AAD) además de tooSWT (ACS), valor predeterminado de hello TokenType es TokenType.JWT.</span><span class="sxs-lookup"><span data-stu-id="47ef8-335">Since adding support of JWT (AAD) in addition tooSWT (ACS), hello default TokenType is TokenType.JWT.</span></span> <span data-ttu-id="47ef8-336">Si usas SWT/ACS, debe establecer tooTokenType.SWT.</span><span class="sxs-lookup"><span data-stu-id="47ef8-336">If you use SWT/ACS, you must set tooTokenType.SWT.</span></span>

## <a name="additional-topics-for-implementation"></a><span data-ttu-id="47ef8-337">Temas adicionales para la implementación</span><span class="sxs-lookup"><span data-stu-id="47ef8-337">Additional Topics for Implementation</span></span>
<span data-ttu-id="47ef8-338">A continuación trataremos algunos temas adicionales de nuestro diseño e implementación.</span><span class="sxs-lookup"><span data-stu-id="47ef8-338">Next we will disc uss some additional topics in our design and implementation.</span></span>

### <a name="http-or-https"></a><span data-ttu-id="47ef8-339">¿HTTP o HTTPS?</span><span class="sxs-lookup"><span data-stu-id="47ef8-339">HTTP or HTTPS?</span></span>
<span data-ttu-id="47ef8-340">Hola aplicación de Reproductor de ASP.NET MVC que creábamos debe admitir siguiente hello:</span><span class="sxs-lookup"><span data-stu-id="47ef8-340">hello ASP.NET MVC player application we built must support hello following:</span></span>

1. <span data-ttu-id="47ef8-341">Autenticación de usuario a través de Azure AD que necesita toobe en HTTPS;</span><span class="sxs-lookup"><span data-stu-id="47ef8-341">User authentication through Azure AD which needs toobe under HTTPS;</span></span>
2. <span data-ttu-id="47ef8-342">Intercambio de token de JWT entre cliente y Azure AD que necesita toobe en HTTPS;</span><span class="sxs-lookup"><span data-stu-id="47ef8-342">JWT token exchange between client and Azure AD which needs toobe under HTTPS;</span></span>
3. <span data-ttu-id="47ef8-343">Adquisición de licencias DRM cliente hello que es necesario toobe en HTTPS si se proporciona entrega de licencia por servicios multimedia de Azure.</span><span class="sxs-lookup"><span data-stu-id="47ef8-343">DRM license acquisition by hello client which is required toobe under HTTPS if license delivery is provided by Azure Media Services.</span></span> <span data-ttu-id="47ef8-344">Por supuesto, el conjunto de productos de PlayReady no impone HTTPS para la entrega de licencias.</span><span class="sxs-lookup"><span data-stu-id="47ef8-344">Of course, PlayReady product suite does not mandate HTTPS for license delivery.</span></span> <span data-ttu-id="47ef8-345">Si el servidor de licencias de PlayReady está fuera de Servicios multimedia de Azure, se podría usar HTTP o HTTPS.</span><span class="sxs-lookup"><span data-stu-id="47ef8-345">If your PlayReady license server is outside of Azure Media Services, either HTTP or HTTPS could be used.</span></span>

<span data-ttu-id="47ef8-346">Por lo tanto, Hola aplicación de Reproductor ASP.NET usará HTTPS como práctica recomendada.</span><span class="sxs-lookup"><span data-stu-id="47ef8-346">Therefore, hello ASP.NET player application will use HTTPS as a best practice.</span></span> <span data-ttu-id="47ef8-347">Esto significa Hola que Reproductor multimedia de Azure se incluirá en una página en HTTPS.</span><span class="sxs-lookup"><span data-stu-id="47ef8-347">This means hello Azure Media Player will be on a page under HTTPS.</span></span> <span data-ttu-id="47ef8-348">Sin embargo, para la transmisión por secuencias se prefiere HTTP, por lo tanto, necesitamos tooconsider mixto problema contenido.</span><span class="sxs-lookup"><span data-stu-id="47ef8-348">However, for streaming we prefer HTTP, hence we need tooconsider mixed content issue.</span></span>

1. <span data-ttu-id="47ef8-349">El explorador no permite contenido mixto.</span><span class="sxs-lookup"><span data-stu-id="47ef8-349">Browser does not allow mixed content.</span></span> <span data-ttu-id="47ef8-350">Pero, los complementos como Silverlight y OSMF para Smooth y DASH sí lo hacen.</span><span class="sxs-lookup"><span data-stu-id="47ef8-350">But plugins like Silverlight and OSMF plugin for smooth and DASH allow.</span></span> <span data-ttu-id="47ef8-351">Contenido mixto es un problema de seguridad: Esto es debido a las amenazas de toohello de tooinject de capacidad de Hola JS malintencionados que puede producir Hola toobe de datos de cliente en peligro.</span><span class="sxs-lookup"><span data-stu-id="47ef8-351">Mixed content is a security concern - This is due toohello threat of hello ability tooinject malicious JS which can cause hello customer data toobe at risk.</span></span>  <span data-ttu-id="47ef8-352">Exploradores bloquea de forma predeterminada y hasta ahora hello toowork de manera única alrededor de ella es en el lado del servidor (origen) hello, tooallow todos los dominios (sin tener en cuenta https o http).</span><span class="sxs-lookup"><span data-stu-id="47ef8-352">Browsers block this by default and so far hello only way toowork around it is on hello server (origin) side, tooallow all domains (regardless https or http).</span></span> <span data-ttu-id="47ef8-353">Probablemente esto tampoco sea una buena idea.</span><span class="sxs-lookup"><span data-stu-id="47ef8-353">This is probably not a good idea either.</span></span>
2. <span data-ttu-id="47ef8-354">Debemos evitar contenido mixto: tanto si se usa HTTP o HTTPS.</span><span class="sxs-lookup"><span data-stu-id="47ef8-354">We should avoid mixed content: either both use HTTP or both use HTTPS.</span></span> <span data-ttu-id="47ef8-355">Al reproducir contenido mixto, silverlightSS tech requiere que se borre una advertencia de contenido mixto.</span><span class="sxs-lookup"><span data-stu-id="47ef8-355">When playing mixed content, silverlightSS tech requires clearing a mixed content warning.</span></span> <span data-ttu-id="47ef8-356">flashSS tech controla el contenido mixto sin advertencia de contenido mixto.</span><span class="sxs-lookup"><span data-stu-id="47ef8-356">flashSS tech handles mixed content without mixed content warning.</span></span>
3. <span data-ttu-id="47ef8-357">Si su punto de conexión de streaming se creó antes de agosto de 2014, no admitirá HTTPS.</span><span class="sxs-lookup"><span data-stu-id="47ef8-357">If your streaming endpoint was created before August 2014, it will not support HTTPS.</span></span> <span data-ttu-id="47ef8-358">En este caso, cree y utilice un nuevo punto de conexión de streaming para HTTPS.</span><span class="sxs-lookup"><span data-stu-id="47ef8-358">In this case, please create and use a new streaming endpoint for HTTPS.</span></span>

<span data-ttu-id="47ef8-359">En la implementación de referencia de hello, para contenido protegido con DRM, aplicación y la transmisión por secuencias estarán bajo HTTTPS.</span><span class="sxs-lookup"><span data-stu-id="47ef8-359">In hello reference implementation, for DRM protected contents, both application and streaming will be under HTTTPS.</span></span> <span data-ttu-id="47ef8-360">Para abrir contenido, el Reproductor de hello no necesita autenticación o licencia, así tienen Hola liberty toouse HTTP o HTTPS.</span><span class="sxs-lookup"><span data-stu-id="47ef8-360">For open contents, hello player does not need authentication or license, so you have hello liberty toouse either HTTP or HTTPS.</span></span>

### <a name="azure-active-directory-signing-key-rollover"></a><span data-ttu-id="47ef8-361">Sustitución de claves de firma de Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="47ef8-361">Azure Active Directory signing key rollover</span></span>
<span data-ttu-id="47ef8-362">Se trata de un tootake punto importante en la cuenta de su implementación.</span><span class="sxs-lookup"><span data-stu-id="47ef8-362">This is an important point tootake into consideration of your implementation.</span></span> <span data-ttu-id="47ef8-363">Si no se considera en su implementación, sistema de hello completado finalmente dejará de funcionar completamente dentro de al menos 6 semanas.</span><span class="sxs-lookup"><span data-stu-id="47ef8-363">If you do not consider this in your implementation, hello completed system will eventually stop working completely within at most 6 weeks.</span></span>

<span data-ttu-id="47ef8-364">Azure AD usa sector estándar tooestablish confianza entre sí y las aplicaciones con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47ef8-364">Azure AD uses industry standard tooestablish trust between itself and applications using Azure AD.</span></span> <span data-ttu-id="47ef8-365">En concreto, Azure AD utiliza una clave de firma que consta de un par de claves pública y privada.</span><span class="sxs-lookup"><span data-stu-id="47ef8-365">Specifically, Azure AD uses a signing key that consists of a public and private key pair.</span></span> <span data-ttu-id="47ef8-366">Cuando Azure AD crea un token de seguridad que contiene información acerca del usuario de hello, este token está firmado por Azure AD utilizando su clave privada antes de enviarlo aplicación toohello atrás.</span><span class="sxs-lookup"><span data-stu-id="47ef8-366">When Azure AD creates a security token that contains information about hello user, this token is signed by Azure AD using its private key before it is sent back toohello application.</span></span> <span data-ttu-id="47ef8-367">tooverify que Hola token es válido y realmente se ha originado en Azure AD, aplicación hello debe validar la firma del token de hello usando la clave pública de hello expuesta por Azure AD que se encuentra en el documento de metadatos de federación del inquilino de Hola.</span><span class="sxs-lookup"><span data-stu-id="47ef8-367">tooverify that hello token is valid and actually originated from Azure AD, hello application must validate hello token’s signature using hello public key exposed by Azure AD that is contained in hello tenant’s federation metadata document.</span></span> <span data-ttu-id="47ef8-368">Esta clave pública: y Hola del que se deriva de clave de firma – sean hello uno mismo usan todos los inquilinos en Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47ef8-368">This public key – and hello signing key from which it derives – is hello same one used for all tenants in Azure AD.</span></span>

<span data-ttu-id="47ef8-369">Información detallada sobre de sustitución de claves de Azure AD puede encontrarse en el documento de hello: [información importante acerca de la sustitución de clave de firma en Azure AD](../active-directory/active-directory-signing-key-rollover.md).</span><span class="sxs-lookup"><span data-stu-id="47ef8-369">Detailed info on Azure AD key rollover can be found in hello document: [Important Information about Signing Key Rollover in Azure AD](../active-directory/active-directory-signing-key-rollover.md).</span></span>

<span data-ttu-id="47ef8-370">Entre hello [par de claves pública y privada](https://login.microsoftonline.com/common/discovery/keys/),</span><span class="sxs-lookup"><span data-stu-id="47ef8-370">Between hello [public-private key pair](https://login.microsoftonline.com/common/discovery/keys/),</span></span>

* <span data-ttu-id="47ef8-371">se utiliza la clave privada de Hola por Azure Active Directory toogenerate un token JWT;</span><span class="sxs-lookup"><span data-stu-id="47ef8-371">hello private key is used by Azure Active Directory toogenerate a JWT token;</span></span>
* <span data-ttu-id="47ef8-372">clave pública de Hello es utilizado por una aplicación, como servicios de entrega de licencias de DRM en token de JWT de AMS tooverify Hola;</span><span class="sxs-lookup"><span data-stu-id="47ef8-372">hello public key is used by an application such as DRM License Delivery Services in AMS tooverify hello JWT token;</span></span>

<span data-ttu-id="47ef8-373">Por motivos de seguridad, Azure Active Directory realiza la rotación de este certificado periódicamente (cada 6 semanas).</span><span class="sxs-lookup"><span data-stu-id="47ef8-373">For security purpose, Azure Active Directory rotates this certificate periodically (every 6 weeks).</span></span> <span data-ttu-id="47ef8-374">En el caso de infracciones de seguridad, la sustitución de clave Hola se produce cada vez.</span><span class="sxs-lookup"><span data-stu-id="47ef8-374">In case of security breaches, hello key rollover can occur any time.</span></span> <span data-ttu-id="47ef8-375">Por lo tanto, servicios de entrega de licencia de hello en AMS necesitan clave pública que hello tooupdate usa Azure AD gira el par de claves de hello, en caso contrario, se producirá un error de autenticación de token en AMS y no se emitirá ninguna licencia.</span><span class="sxs-lookup"><span data-stu-id="47ef8-375">Therefore, hello license delivery services in AMS need tooupdate hello public key used as Azure AD rotates hello key pair, otherwise token authentication in AMS will fail and no license will be issued.</span></span>

<span data-ttu-id="47ef8-376">Para ello, es necesario establecer TokenRestrictionTemplate.OpenIdConnectDiscoveryDocument al configurar los servicios de entrega de licencias de DRM.</span><span class="sxs-lookup"><span data-stu-id="47ef8-376">This is achieved by setting TokenRestrictionTemplate.OpenIdConnectDiscoveryDocument when configuring DRM license delivery services.</span></span>

<span data-ttu-id="47ef8-377">Hola flujo de tokens de JWT es como a continuación:</span><span class="sxs-lookup"><span data-stu-id="47ef8-377">hello JWT token flow is as below:</span></span>

1. <span data-ttu-id="47ef8-378">Azure AD pueda emitir el token de JWT de hello con clave privada actual de Hola para un usuario autenticado;</span><span class="sxs-lookup"><span data-stu-id="47ef8-378">Azure AD will issue hello JWT token with hello current private key for an authenticated user;</span></span>
2. <span data-ttu-id="47ef8-379">Cuando un reproductor ve una CENC con contenido protegido con DRM-múltiple, buscará en primer lugar token JWT de hello emitido por Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47ef8-379">When a player sees a CENC with multi-DRM protected content, it will first locate hello JWT token issued by Azure AD.</span></span>
3. <span data-ttu-id="47ef8-380">Reproductor de Hello envía la solicitud de adquisición de licencias con servicios de entrega de toolicense token de JWT de hello en AMS;</span><span class="sxs-lookup"><span data-stu-id="47ef8-380">hello player sends license acquisition request with hello JWT token toolicense delivery services in AMS;</span></span>
4. <span data-ttu-id="47ef8-381">Servicios de entrega de licencia de Hello en AMS usará una clave pública actual/válida Hola de token JWT de Azure AD tooverify hello, antes de emitir licencias.</span><span class="sxs-lookup"><span data-stu-id="47ef8-381">hello license delivery services in AMS will use hello current/valid public key from Azure AD tooverify hello JWT token, before issuing licenses.</span></span>

<span data-ttu-id="47ef8-382">Servicios de entrega de licencias DRM se siempre que esté buscando una clave pública actual/válida Hola de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47ef8-382">DRM license delivery services will always be checking for hello current/valid public key from Azure AD.</span></span> <span data-ttu-id="47ef8-383">clave pública de Hello presentada por Azure AD estará calve de Hola para comprobar un token JWT emitido por Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47ef8-383">hello public key presented by Azure AD will be hello key used for verifying a JWT token issued by Azure AD.</span></span>

<span data-ttu-id="47ef8-384">¿Qué ocurre si sustitución de claves de hello ocurre después de AAD genera un token de JWT pero antes de hello JWT token se envía por reproductores tooDRM entrega servicios de licencias en AMS para la comprobación?</span><span class="sxs-lookup"><span data-stu-id="47ef8-384">What if hello key rollover happens after AAD generates a JWT token but before hello JWT token is sent by players tooDRM license delivery services in AMS for verification?</span></span>

<span data-ttu-id="47ef8-385">Dado que una clave se puede sustituir en cualquier momento, siempre hay más de una clave pública válida disponible en el documento de metadatos de federación de Hola.</span><span class="sxs-lookup"><span data-stu-id="47ef8-385">Because a key may be rolled at any moment, there is always more than one valid public key available in hello federation metadata document.</span></span> <span data-ttu-id="47ef8-386">Entrega de licencias de servicios multimedia de Azure puede usar cualquiera de hello claves especificada en el documento de hello, ya que se puede sustituir una clave pronto, otra puede ser su sustituta y así sucesivamente.</span><span class="sxs-lookup"><span data-stu-id="47ef8-386">Azure Media Services license delivery can use any of hello keys specified in hello document, since one key may be rolled soon, another may be its replacement, and so forth.</span></span>

### <a name="where-is-hello-access-token"></a><span data-ttu-id="47ef8-387">¿Donde es Hola Token de acceso?</span><span class="sxs-lookup"><span data-stu-id="47ef8-387">Where is hello Access Token?</span></span>
<span data-ttu-id="47ef8-388">Si observa cómo una aplicación web llama a una aplicación de API en [identidad de aplicación con concesión de credenciales de cliente de OAuth 2.0](../active-directory/develop/active-directory-authentication-scenarios.md#web-application-to-web-api), flujo de autenticación de hello es como a continuación:</span><span class="sxs-lookup"><span data-stu-id="47ef8-388">If you look at how a web app calls an API app under [Application Identity with OAuth 2.0 Client Credentials Grant](../active-directory/develop/active-directory-authentication-scenarios.md#web-application-to-web-api), hello authentication flow is as below:</span></span>

1. <span data-ttu-id="47ef8-389">Un usuario ha iniciado sesión tooAzure AD en la aplicación web de hello (vea hello [tooWeb aplicación de explorador Web](../active-directory/develop/active-directory-authentication-scenarios.md#web-browser-to-web-application).</span><span class="sxs-lookup"><span data-stu-id="47ef8-389">A user is signed in tooAzure AD in hello web application (see hello [Web Browser tooWeb Application](../active-directory/develop/active-directory-authentication-scenarios.md#web-browser-to-web-application).</span></span>
2. <span data-ttu-id="47ef8-390">extremo de autorización de Hello Azure AD redirige aplicación Hola usuario agente toohello atrás cliente con un código de autorización.</span><span class="sxs-lookup"><span data-stu-id="47ef8-390">hello Azure AD authorization endpoint redirects hello user agent back toohello client application with an authorization code.</span></span> <span data-ttu-id="47ef8-391">agente de usuario de Hello devuelve el URI de redireccionamiento de la aplicación del cliente de toohello código de autorización.</span><span class="sxs-lookup"><span data-stu-id="47ef8-391">hello user agent returns authorization code toohello client application’s redirect URI.</span></span>
3. <span data-ttu-id="47ef8-392">aplicación web de Hello debe tooacquire un token de acceso para que pueda autenticar toohello web API y recuperar recursos de hello deseado.</span><span class="sxs-lookup"><span data-stu-id="47ef8-392">hello web application needs tooacquire an access token so that it can authenticate toohello web API and retrieve hello desired resource.</span></span> <span data-ttu-id="47ef8-393">Realiza una tooAzure de solicitud de AD extremo de token y proporcionar credenciales de hello, Id. de cliente y URI de Id. de la aplicación de API de web.</span><span class="sxs-lookup"><span data-stu-id="47ef8-393">It makes a request tooAzure AD’s token endpoint, providing hello credential, client ID, and web API’s application ID URI.</span></span> <span data-ttu-id="47ef8-394">Presenta tooprove de código de autorización de Hola que Hola usuario ha dado su consentimiento.</span><span class="sxs-lookup"><span data-stu-id="47ef8-394">It presents hello authorization code tooprove that hello user has consented.</span></span>
4. <span data-ttu-id="47ef8-395">Azure AD autentica la aplicación hello y devuelve un token de acceso JWT que es usado toocall hello web API.</span><span class="sxs-lookup"><span data-stu-id="47ef8-395">Azure AD authenticates hello application and returns a JWT access token that is used toocall hello web API.</span></span>
5. <span data-ttu-id="47ef8-396">A través de HTTPS, aplicación web de hello usa Hola devuelve Hola de tooadd de token de acceso JWT cadena JWT con una designación "Bearer" en encabezado de autorización de Hola de toohello web API de hello solicitud.</span><span class="sxs-lookup"><span data-stu-id="47ef8-396">Over HTTPS, hello web application uses hello returned JWT access token tooadd hello JWT string with a “Bearer” designation in hello Authorization header of hello request toohello web API.</span></span> <span data-ttu-id="47ef8-397">API de web Hello, a continuación, valida el token JWT de Hola y si la validación es correcta, devuelve Hola deseado recursos.</span><span class="sxs-lookup"><span data-stu-id="47ef8-397">hello web API then validates hello JWT token, and if validation is successful, returns hello desired resource.</span></span>

<span data-ttu-id="47ef8-398">En este flujo de "application identity" API de hello web confía en ese usuario de hello web aplicación Hola autenticado.</span><span class="sxs-lookup"><span data-stu-id="47ef8-398">In this “application identity” flow, hello web API trusts that hello web application authenticated hello user.</span></span> <span data-ttu-id="47ef8-399">Por ello, este patrón se conoce como subsistema de confianza.</span><span class="sxs-lookup"><span data-stu-id="47ef8-399">For this reason, this pattern is called a trusted subsystem.</span></span> <span data-ttu-id="47ef8-400">Hola [diagrama en esta página](https://docs.microsoft.com/azure/active-directory/active-directory-protocols-oauth-code) describe cómo el código de autorización concede funciona de flujo.</span><span class="sxs-lookup"><span data-stu-id="47ef8-400">hello [diagram on this page](https://docs.microsoft.com/azure/active-directory/active-directory-protocols-oauth-code) describes how authorization code grant flow works.</span></span>

<span data-ttu-id="47ef8-401">En la adquisición de licencias con la restricción de token, nos estamos siguiendo Hola mismo patrón de subsistema de confianza.</span><span class="sxs-lookup"><span data-stu-id="47ef8-401">In license acquisition with token restriction, we are following hello same trusted subsystem pattern.</span></span> <span data-ttu-id="47ef8-402">Y servicio de entrega de licencia de hello en los servicios de multimedia de Azure es el recurso de API web de hello, Hola "recurso de back-end" una aplicación web necesita tooaccess.</span><span class="sxs-lookup"><span data-stu-id="47ef8-402">And hello license delivery service in Azure Media Services is hello web API resource, hello “backend resource” a web application needs tooaccess.</span></span> <span data-ttu-id="47ef8-403">¿Entonces, donde es el token de acceso de hello?</span><span class="sxs-lookup"><span data-stu-id="47ef8-403">So where is hello access token?</span></span>

<span data-ttu-id="47ef8-404">De hecho, vamos a obtener el token de acceso desde Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47ef8-404">Indeed, we are obtaining access token from Azure AD.</span></span> <span data-ttu-id="47ef8-405">Después de autenticar al usuario correctamente, se devuelve el código de autorización.</span><span class="sxs-lookup"><span data-stu-id="47ef8-405">After successful user authentication, authorization code is returned.</span></span> <span data-ttu-id="47ef8-406">código de autorización de Hello, a continuación, se usa, junto con la clave de identificador y una aplicación de cliente, tooexchange de token de acceso.</span><span class="sxs-lookup"><span data-stu-id="47ef8-406">hello authorization code is then used, together with client ID and app key, tooexchange for access token.</span></span> <span data-ttu-id="47ef8-407">Y es el token de acceso de hello para tener acceso a una aplicación de "puntero" que señala o que representa el servicio de entrega de licencias de servicios multimedia de Azure.</span><span class="sxs-lookup"><span data-stu-id="47ef8-407">And hello access token is for accessing a “pointer” application pointing or representing Azure Media Services license delivery service.</span></span>

<span data-ttu-id="47ef8-408">Se necesita tooregister y configura aplicación de "puntero" hello en Azure AD Hola pasos siguientes:</span><span class="sxs-lookup"><span data-stu-id="47ef8-408">We need tooregister and configure hello “pointer” app in Azure AD by following hello steps below:</span></span>

1. <span data-ttu-id="47ef8-409">En el inquilino de hello Azure AD</span><span class="sxs-lookup"><span data-stu-id="47ef8-409">In hello Azure AD tenant</span></span>

   * <span data-ttu-id="47ef8-410">agregue una aplicación (recurso) con la dirección URL de inicio de sesión</span><span class="sxs-lookup"><span data-stu-id="47ef8-410">add an application (resource) with sign-on URL:</span></span>

   <span data-ttu-id="47ef8-411">https://[resource_name].azurewebsites.net/ and</span><span class="sxs-lookup"><span data-stu-id="47ef8-411">https://[resource_name].azurewebsites.net/ and</span></span>

   * <span data-ttu-id="47ef8-412">la URL de identificador de aplicación</span><span class="sxs-lookup"><span data-stu-id="47ef8-412">app ID URL:</span></span>

   <span data-ttu-id="47ef8-413">https://[aad_tenant_name].onmicrosoft.com/[resource_name];</span><span class="sxs-lookup"><span data-stu-id="47ef8-413">https://[aad_tenant_name].onmicrosoft.com/[resource_name];</span></span>
2. <span data-ttu-id="47ef8-414">Agregue una nueva clave para la aplicación de recursos de hello;</span><span class="sxs-lookup"><span data-stu-id="47ef8-414">Add a new key for hello resource app;</span></span>
3. <span data-ttu-id="47ef8-415">Actualizar el archivo de manifiesto de aplicación Hola para que la propiedad de groupMembershipClaims hello tiene Hola siguiente valor: "groupMembershipClaims": "All",</span><span class="sxs-lookup"><span data-stu-id="47ef8-415">Update hello app manifest file so that hello groupMembershipClaims property has hello following value: "groupMembershipClaims": "All",</span></span>  
4. <span data-ttu-id="47ef8-416">En la aplicación de Azure AD de Hola que señala toohello Reproductor web app y en la sección de Hola "permisos tooother aplicaciones", Agregar aplicación de recursos de hello que se agregó en el paso 1 anterior.</span><span class="sxs-lookup"><span data-stu-id="47ef8-416">In hello Azure AD app pointing toohello player web app, in hello section “permissions tooother applications”, add hello resource app which was added in step 1 above.</span></span> <span data-ttu-id="47ef8-417">En "Permisos delegados", active la casilla "Acceso [nombre_de_recurso]".</span><span class="sxs-lookup"><span data-stu-id="47ef8-417">Under “delegated permissions” check “Access [resource_name]” checkmark.</span></span> <span data-ttu-id="47ef8-418">Esto proporciona permiso de aplicación web de hello toocreate los tokens de acceso para tener acceso a la aplicación de recursos de hello.</span><span class="sxs-lookup"><span data-stu-id="47ef8-418">This gives hello web app permission toocreate access tokens for accessing hello resource app.</span></span> <span data-ttu-id="47ef8-419">Debe hacerlo para local e implementada la versión de la aplicación web de hello, si está desarrollando a la aplicación web de Visual Studio y Azure.</span><span class="sxs-lookup"><span data-stu-id="47ef8-419">You should do this for both local and deployed version of hello web app if you are developing with Visual Studio and Azure web app.</span></span>

<span data-ttu-id="47ef8-420">Por lo tanto, el token JWT de hello emitido por Azure AD es realmente token de acceso de hello para tener acceso a este recurso de "puntero".</span><span class="sxs-lookup"><span data-stu-id="47ef8-420">Therefore, hello JWT token issued by Azure AD is indeed hello access token for accessing this “pointer” resource.</span></span>

### <a name="what-about-live-streaming"></a><span data-ttu-id="47ef8-421">¿Y qué pasa con el streaming en vivo?</span><span class="sxs-lookup"><span data-stu-id="47ef8-421">What about Live Streaming?</span></span>
<span data-ttu-id="47ef8-422">Hola anterior, nuestro análisis han se centre primero en activos de petición.</span><span class="sxs-lookup"><span data-stu-id="47ef8-422">In hello above, our discussion has been focusing on on-demand assets.</span></span> <span data-ttu-id="47ef8-423">¿Y qué pasa con el streaming en vivo?</span><span class="sxs-lookup"><span data-stu-id="47ef8-423">What about live streaming?</span></span>

<span data-ttu-id="47ef8-424">Hello buenas noticias son que se puede utilizar exactamente Hola mismo diseño e implementación para la protección de streaming en vivo en los servicios de multimedia de Azure, trátelo asset Hola asociado con un programa como un "recurso VOD".</span><span class="sxs-lookup"><span data-stu-id="47ef8-424">hello good news is that you can use exactly hello same design and implementation for protecting live streaming in Azure Media Services, by treating hello asset associated with a program as a “VOD asset”.</span></span>

<span data-ttu-id="47ef8-425">En concreto, es muy conocido que toodo live streaming de servicios multimedia de Azure, debes toocreate un canal y, a continuación, un programa en el canal de Hola.</span><span class="sxs-lookup"><span data-stu-id="47ef8-425">Specifically, it is well known that toodo live streaming in Azure Media Services, you need toocreate a channel, then a program under hello channel.</span></span> <span data-ttu-id="47ef8-426">programa hello de toocreate, deberá toocreate un activo que contendrá los archivos activos de hello programa Hola.</span><span class="sxs-lookup"><span data-stu-id="47ef8-426">toocreate hello program, you need toocreate an asset which will contain hello live archive for hello program.</span></span> <span data-ttu-id="47ef8-427">En orden tooprovide CENC con protección multi-DRM de contenido en directo de hello, todo lo que necesita toodo, se tooapply Hola mismo activo de toohello el programa de instalación/procesamiento como si fuera un "recurso VOD" antes de iniciar el programa de Hola.</span><span class="sxs-lookup"><span data-stu-id="47ef8-427">In order tooprovide CENC with multi-DRM protection of hello live content, all you need toodo, is tooapply hello same setup/processing toohello asset as if it was a “VOD asset” before you start hello program.</span></span>

### <a name="what-about-license-servers-outside-of-azure-media-services"></a><span data-ttu-id="47ef8-428">¿Y qué sucede con los servidores de licencias que están fuera de Servicios multimedia de Azure?</span><span class="sxs-lookup"><span data-stu-id="47ef8-428">What about license servers outside of Azure Media Services?</span></span>
<span data-ttu-id="47ef8-429">Con frecuencia, puede ocurrir que los clientes inviertan en granjas de servidores de licencias en su propio centro de datos u hospedados por proveedores de servicios DRM.</span><span class="sxs-lookup"><span data-stu-id="47ef8-429">Often, customers may have invested in license server farm either in their own data center or hosted by DRM service providers.</span></span> <span data-ttu-id="47ef8-430">Afortunadamente, protección de contenido de Azure Media Services le permite toooperate en modo híbrido: contenido hospedado y protegido dinámicamente en los servicios de multimedia de Azure, mientras que las licencias DRM se entregan por servidores ajenos a servicios multimedia de Azure.</span><span class="sxs-lookup"><span data-stu-id="47ef8-430">Fortunately, Azure Media Services Content Protection allows you toooperate in hybrid mode: contents hosted and dynamically protected in Azure Media Services, while DRM licenses are delivered by servers outside Azure Media Services.</span></span> <span data-ttu-id="47ef8-431">En este caso, hay Hola siguiendo las consideraciones de los cambios:</span><span class="sxs-lookup"><span data-stu-id="47ef8-431">In this case, there are hello following considerations of changes:</span></span>

1. <span data-ttu-id="47ef8-432">Hola el servicio de Token seguro necesidades tooissue tokens que son aceptables y se pueden comprobar por granja de servidores de licencias de Hola.</span><span class="sxs-lookup"><span data-stu-id="47ef8-432">hello Secure Token Service needs tooissue tokens which are acceptable and can be verified by hello license server farm.</span></span> <span data-ttu-id="47ef8-433">Por ejemplo, servidores de licencias de Widevine Hola proporcionados por Axinom requiere un token JWT específico que contiene "mensaje de derechos".</span><span class="sxs-lookup"><span data-stu-id="47ef8-433">For example, hello Widevine license servers provided by Axinom requires a specific JWT token which contains “entitlement message”.</span></span> <span data-ttu-id="47ef8-434">Por lo tanto, deberá toohave un tooissue STS tal token JWT.</span><span class="sxs-lookup"><span data-stu-id="47ef8-434">Therefore, you need toohave an STS tooissue such JWT token.</span></span> <span data-ttu-id="47ef8-435">los autores de Hello han completado este tipo de implementación y puede encontrar detalles Hola Hola después de documento en [centro de documentación](https://azure.microsoft.com/documentation/): [Axinom utilizando toodeliver Widevine licencias de servicios de multimedia de tooAzure](media-services-axinom-integration.md).</span><span class="sxs-lookup"><span data-stu-id="47ef8-435">hello authors have completed such an implementation and you can find hello details in hello following document in [Azure Documentation Center](https://azure.microsoft.com/documentation/): [Using Axinom toodeliver Widevine licenses tooAzure Media Services](media-services-axinom-integration.md).</span></span>
2. <span data-ttu-id="47ef8-436">Ya no necesita el servicio de entrega de licencia de tooconfigure (ContentKeyAuthorizationPolicy) en servicios multimedia de Azure.</span><span class="sxs-lookup"><span data-stu-id="47ef8-436">You no longer need tooconfigure license delivery service (ContentKeyAuthorizationPolicy) in Azure Media Services.</span></span> <span data-ttu-id="47ef8-437">Lo que necesita toodo es tooprovide direcciones de URL de adquisición de licencias de hello (para PlayReady, Widevine y FairPlay) al configurar AssetDeliveryPolicy de configuración de CENC con DRM de múltiples.</span><span class="sxs-lookup"><span data-stu-id="47ef8-437">What you need toodo is tooprovide hello license acquisition URLs (for PlayReady, Widevine and FairPlay) when you configure AssetDeliveryPolicy in setting up CENC with multi-DRM.</span></span>

### <a name="what-if-i-want-toouse-a-custom-sts"></a><span data-ttu-id="47ef8-438">¿Qué ocurre si deseo toouse un STS personalizado?</span><span class="sxs-lookup"><span data-stu-id="47ef8-438">What if I want toouse a custom STS?</span></span>
<span data-ttu-id="47ef8-439">Puede haber varias razones por las que un cliente puede elegir toouse un STS personalizado (servicio de tokens seguro) para proporcionar tokens JWT.</span><span class="sxs-lookup"><span data-stu-id="47ef8-439">There could be a few reasons that a customer may choose toouse a custom STS (Secure Token Service) for providing JWT tokens.</span></span> <span data-ttu-id="47ef8-440">Algunas de ellas son:</span><span class="sxs-lookup"><span data-stu-id="47ef8-440">Some of them are:</span></span>

1. <span data-ttu-id="47ef8-441">Proveedor de identidad (IDP) usados por el cliente de Hola Hola no admite a STS.</span><span class="sxs-lookup"><span data-stu-id="47ef8-441">hello Identity Provider (IDP) used by hello customer does not support STS.</span></span> <span data-ttu-id="47ef8-442">En este caso, un STS personalizado puede ser una opción.</span><span class="sxs-lookup"><span data-stu-id="47ef8-442">In this case a custom STS may be an option.</span></span>
2. <span data-ttu-id="47ef8-443">cliente de Hello tendrá un control más flexible o más estricto en la integración de STS con sistema de facturación de los suscriptores del cliente.</span><span class="sxs-lookup"><span data-stu-id="47ef8-443">hello customer may need more flexible or tighter control in integrating STS with customer’s subscriber billing system.</span></span> <span data-ttu-id="47ef8-444">Por ejemplo, un operador MVPD puede ofrecer varios paquetes de suscriptor OTT como premium, basic, deportes, operador de hello etc. aconsejable toomatch Hola notificaciones en un token con el paquete de un suscriptor para que sólo el contenido en el paquete adecuado de Hola se pone a disposición.</span><span class="sxs-lookup"><span data-stu-id="47ef8-444">For example, an MVPD operator may offer multiple OTT subscriber packages such as premium, basic, sports, etc. hello operator may want toomatch hello claims in a token with a subscriber’s package so that only contents in hello right package is made available.</span></span> <span data-ttu-id="47ef8-445">En este caso, un STS personalizado proporciona Hola necesario flexibilidad y control.</span><span class="sxs-lookup"><span data-stu-id="47ef8-445">In this case, a custom STS provides hello needed flexibility and control.</span></span>

<span data-ttu-id="47ef8-446">Dos cambios necesitan toobe realizado al usar a un STS personalizado:</span><span class="sxs-lookup"><span data-stu-id="47ef8-446">Two changes need toobe made when using a custom STS:</span></span>

1. <span data-ttu-id="47ef8-447">Al configurar el servicio de entrega de licencia para un activo, se necesita la clave de seguridad de Hola de toospecify Hola personalizado STS (más detalles a continuación) en lugar de la clave actual de Hola de Azure Active Directory utiliza para la comprobación.</span><span class="sxs-lookup"><span data-stu-id="47ef8-447">When configuring license delivery service for an asset, you need toospecify hello security key used for verification by hello custom STS (more details below) instead of hello current key from Azure Active Directory.</span></span>
2. <span data-ttu-id="47ef8-448">Cuando se genera un token JTW, se especifica una clave de seguridad en lugar de la clave privada de hello del certificado de hello X509 actual en Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="47ef8-448">When a JTW token is generated, a security key is specified instead of hello private key of hello current X509 certificate in Azure Active Directory.</span></span>

<span data-ttu-id="47ef8-449">Hay dos tipos de claves de seguridad:</span><span class="sxs-lookup"><span data-stu-id="47ef8-449">There are two types of security keys:</span></span>

1. <span data-ttu-id="47ef8-450">Clave simétrica: Hola misma clave se usa para generar y comprobar un token JWT;</span><span class="sxs-lookup"><span data-stu-id="47ef8-450">Symmetric key: hello same key is used for both generating and verifying a JWT token;</span></span>
2. <span data-ttu-id="47ef8-451">Clave asimétrica: un par de claves pública y privada en un certificado se utiliza con la clave privada para cifrar y generar un JWT hello y el token de clave pública para comprobar el token de Hola de X509.</span><span class="sxs-lookup"><span data-stu-id="47ef8-451">Asymmetric key: a public-private key pair in an X509 certificate is used with private key for encrypting/generating a JWT token and hello public key for verifying hello token.</span></span>

#### <a name="tech-note"></a><span data-ttu-id="47ef8-452">Nota técnica</span><span class="sxs-lookup"><span data-stu-id="47ef8-452">Tech note</span></span>
<span data-ttu-id="47ef8-453">Si usa .NET Framework / C# como plataforma de desarrollo, Hola X509 certificado usado para la clave de seguridad asimétrico debe tener una longitud de clave de al menos 2048.</span><span class="sxs-lookup"><span data-stu-id="47ef8-453">If you use .NET Framework/C# as your development platform, hello X509 certificate used for asymmetric security key must have key length at least 2048.</span></span> <span data-ttu-id="47ef8-454">Se trata de un requisito de la clase hello System.IdentityModel.Tokens.X509AsymmetricSecurityKey en .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="47ef8-454">This is a requirement of hello class System.IdentityModel.Tokens.X509AsymmetricSecurityKey in .NET Framework.</span></span> <span data-ttu-id="47ef8-455">De lo contrario, se producirá Hola tras excepción:</span><span class="sxs-lookup"><span data-stu-id="47ef8-455">Otherwise, hello following exception will be thrown:</span></span>

<span data-ttu-id="47ef8-456">IDX10630: hello 'System.IdentityModel.Tokens.X509AsymmetricSecurityKey' para la firma no puede ser menor que '2048' bits.</span><span class="sxs-lookup"><span data-stu-id="47ef8-456">IDX10630: hello 'System.IdentityModel.Tokens.X509AsymmetricSecurityKey' for signing cannot be smaller than '2048' bits.</span></span>

## <a name="hello-completed-system-and-test"></a><span data-ttu-id="47ef8-457">prueba y del sistema de hello completado</span><span class="sxs-lookup"><span data-stu-id="47ef8-457">hello completed system and test</span></span>
<span data-ttu-id="47ef8-458">Se le guiará a través de una serie de escenarios en sistema de hello completado-to-end para que los lectores pueden tener una "imagen" del comportamiento de hello basic antes de obtener una cuenta de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="47ef8-458">We will walk through a few scenarios in hello completed end-to-end system so that readers can have a basic “picture” of hello behavior before getting a login account.</span></span>

<span data-ttu-id="47ef8-459">Hello aplicación web de reproducción y su inicio de sesión pueden encontrarse [aquí](https://openidconnectweb.azurewebsites.net/).</span><span class="sxs-lookup"><span data-stu-id="47ef8-459">hello player web application and its login can be found [here](https://openidconnectweb.azurewebsites.net/).</span></span>

<span data-ttu-id="47ef8-460">Si lo que necesita es "no integrado" escenario: recursos de vídeo hospedan en servicios multimedia de Azure que son cualquiera desprotegido o protegido con DRM pero sin autenticación de token (emitir un toowhoever de licencia que lo solicite), puede probarlo sin inicio de sesión (cambiando tooHTTP si el vídeo de transmisión por secuencias es a través de HTTP).</span><span class="sxs-lookup"><span data-stu-id="47ef8-460">If what you need is “non-integrated” scenario: video assets hosted in Azure Media Services which are either unprotected, or DRM protected but without token authentication (issuing a license toowhoever requesting it), you can test it without login (by switching tooHTTP if your video streaming is over HTTP).</span></span>

<span data-ttu-id="47ef8-461">Si lo que necesita es el escenario integrado-to-end: recursos de vídeo está bajo protección dinámica de DRM en servicios de multimedia de Azure, con autenticación de token y el token JWT que se genera mediante Azure AD, deberá toologin.</span><span class="sxs-lookup"><span data-stu-id="47ef8-461">If what you need is end-to-end integrated scenario: video assets is under dynamic DRM protection in Azure Media Services, with token authentication and JWT token being generated by Azure AD, you need toologin.</span></span>

### <a name="user-login"></a><span data-ttu-id="47ef8-462">Inicio de sesión de usuario</span><span class="sxs-lookup"><span data-stu-id="47ef8-462">User login</span></span>
<span data-ttu-id="47ef8-463">En orden tootest Hola-to-end DRM sistema integrado, debe toohave una "cuenta" creen o agreguen.</span><span class="sxs-lookup"><span data-stu-id="47ef8-463">In order tootest hello end-to-end integrated DRM system, you need toohave an “account” created or added.</span></span>

<span data-ttu-id="47ef8-464">¿Qué cuenta?</span><span class="sxs-lookup"><span data-stu-id="47ef8-464">What account?</span></span>

<span data-ttu-id="47ef8-465">Aunque Azure inicialmente permitía el acceso únicamente a usuarios de cuentas Microsoft, ahora permite el acceso a usuarios de ambos sistemas.</span><span class="sxs-lookup"><span data-stu-id="47ef8-465">Although Azure originally allowed access only by Microsoft account users, it now allows access by users from both systems.</span></span> <span data-ttu-id="47ef8-466">Esto se hacía manteniendo la confianza de Azure propiedades de todos los hello Azure AD para la autenticación, haciendo que Azure AD autenticar usuarios de la organización y mediante la creación de una relación de federación que Azure AD confía en sistema de identidad de cliente de cuentas de Microsoft de Hola usuarios de consumidor de tooauthenticate.</span><span class="sxs-lookup"><span data-stu-id="47ef8-466">This was done by having all hello Azure properties trust Azure AD for authentication, having Azure AD authenticate organizational users, and by creating a federation relationship where Azure AD trusts hello Microsoft account consumer identity system tooauthenticate consumer users.</span></span> <span data-ttu-id="47ef8-467">Como resultado, Azure AD es capaz de tooauthenticate cuentas de Microsoft de "Invitado", así como cuentas "nativas" Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47ef8-467">As a result, Azure AD is able tooauthenticate “guest” Microsoft accounts as well as “native” Azure AD accounts.</span></span>

<span data-ttu-id="47ef8-468">Puesto que Azure AD confía en el dominio de cuenta de Microsoft (MSA), puede agregar las cuentas de cualquiera de hello después toohello dominios personalizado AD Azure inquilino y usar Hola cuenta toologin:</span><span class="sxs-lookup"><span data-stu-id="47ef8-468">Since Azure AD trusts Microsoft Account (MSA) domain, you can add any accounts from any of hello following domains toohello custom Azure AD tenant and use hello account toologin:</span></span>

| <span data-ttu-id="47ef8-469">**Nombre de dominio**</span><span class="sxs-lookup"><span data-stu-id="47ef8-469">**Domain Name**</span></span> | <span data-ttu-id="47ef8-470">**Dominio**</span><span class="sxs-lookup"><span data-stu-id="47ef8-470">**Domain**</span></span> |
| --- | --- |
| <span data-ttu-id="47ef8-471">**Dominio de inquilino de Azure AD personalizado**</span><span class="sxs-lookup"><span data-stu-id="47ef8-471">**Custom Azure AD tenant domain**</span></span> |<span data-ttu-id="47ef8-472">somename.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="47ef8-472">somename.onmicrosoft.com</span></span> |
| <span data-ttu-id="47ef8-473">**Dominio corporativo**</span><span class="sxs-lookup"><span data-stu-id="47ef8-473">**Corporate domain**</span></span> |<span data-ttu-id="47ef8-474">microsoft.com</span><span class="sxs-lookup"><span data-stu-id="47ef8-474">microsoft.com</span></span> |
| <span data-ttu-id="47ef8-475">**Dominio de la cuenta Microsoft (MSA)**</span><span class="sxs-lookup"><span data-stu-id="47ef8-475">**Microsoft Account (MSA) domain**</span></span> |<span data-ttu-id="47ef8-476">outlook.com, live.com, hotmail.com</span><span class="sxs-lookup"><span data-stu-id="47ef8-476">outlook.com, live.com, hotmail.com</span></span> |

<span data-ttu-id="47ef8-477">Puede ponerse en contacto con cualquiera de los autores de hello toohave una cuenta que se crea o se agrega.</span><span class="sxs-lookup"><span data-stu-id="47ef8-477">You may contact any of hello authors toohave an account created or added for you.</span></span>

<span data-ttu-id="47ef8-478">A continuación se muestran capturas de pantalla de Hola de páginas de inicio de sesión diferente utilizadas diferentes cuentas de dominio.</span><span class="sxs-lookup"><span data-stu-id="47ef8-478">Below are hello screenshots of different login pages used by different domain accounts.</span></span>

<span data-ttu-id="47ef8-479">**Cuenta de dominio de inquilino de AD de Azure personalizada**: en este caso, verá la página de inicio de sesión personalizado Hola de dominio del inquilino Hola personalizado AD de Azure.</span><span class="sxs-lookup"><span data-stu-id="47ef8-479">**Custom Azure AD tenant domain account**: In this case, you see hello customized login page of hello custom Azure AD tenant domain.</span></span>

![Cuenta de dominio de inquilino de Azure AD personalizado](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain1.png)

<span data-ttu-id="47ef8-481">**Cuenta de dominio de Microsoft con tarjeta inteligente**: en este caso verá la página de inicio de sesión de hello personalizar Microsoft corporativa TI con la autenticación en dos fases.</span><span class="sxs-lookup"><span data-stu-id="47ef8-481">**Microsoft domain account with smart card**: In this case you see hello login page customized by Microsoft corporate IT with two-factor authentication.</span></span>

![Cuenta de dominio de inquilino de Azure AD personalizado](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain2.png)

<span data-ttu-id="47ef8-483">**Cuenta de Microsoft (MSA)**: en este caso, verá la página de inicio de sesión de Hola de Account de Microsoft para los consumidores.</span><span class="sxs-lookup"><span data-stu-id="47ef8-483">**Microsoft Account (MSA)**: In this case, you see hello login page of Microsoft Account for consumers.</span></span>

![Cuenta de dominio de inquilino de Azure AD personalizado](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain3.png)

### <a name="using-encrypted-media-extensions-for-playready"></a><span data-ttu-id="47ef8-485">Uso de extensiones multimedia cifradas para PlayReady</span><span class="sxs-lookup"><span data-stu-id="47ef8-485">Using Encrypted Media Extensions for PlayReady</span></span>
<span data-ttu-id="47ef8-486">En un explorador moderno extensiones con medios cifrada (EME) para la compatibilidad, por ejemplo, el Explorador de Internet Explorer 11 en Windows 8.1 o superior y Microsoft Edge en Windows 10, PlayReady será de PlayReady hello DRM subyacente para EME.</span><span class="sxs-lookup"><span data-stu-id="47ef8-486">On a modern browser with Encrypted Media Extensions (EME) for PlayReady support, such as IE 11 on Windows 8.1 and up, and Microsoft Edge browser on Windows 10, PlayReady will be hello underlying DRM for EME.</span></span>

![Uso de EME para PlayReady](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-playready1.png)

<span data-ttu-id="47ef8-488">área de Reproductor oscuro Hello es debido a que la protección PlayReady impide que uno de realizar la captura de pantalla de vídeo protegido de hechos de toohello.</span><span class="sxs-lookup"><span data-stu-id="47ef8-488">hello dark player area is due toohello fact that PlayReady protection prevents one from making screen capture of protected video.</span></span>

<span data-ttu-id="47ef8-489">Hello pantalla siguiente muestra hello Reproductor complementos y soporte técnico MSE/EME.</span><span class="sxs-lookup"><span data-stu-id="47ef8-489">hello following screen shows hello player plugins and MSE/EME support.</span></span>

![Uso de EME para PlayReady](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-playready2.png)

<span data-ttu-id="47ef8-491">EME en Microsoft Edge e Internet Explorer 11 en Windows 10 permiten invocar [PlayReady SL3000](https://www.microsoft.com/playready/features/EnhancedContentProtection.aspx/) en dispositivos de Windows 10 que lo admitan.</span><span class="sxs-lookup"><span data-stu-id="47ef8-491">EME in Microsoft Edge and IE 11 on Windows 10 allows invoking of [PlayReady SL3000](https://www.microsoft.com/playready/features/EnhancedContentProtection.aspx/) on Windows 10 devices which support it.</span></span> <span data-ttu-id="47ef8-492">PlayReady SL3000 desbloquea flujo Hola de contenido premium mejorado (4K, HDR, etc.) y nuevos modelos de entrega de contenido (ventana temprana para contenido mejorado).</span><span class="sxs-lookup"><span data-stu-id="47ef8-492">PlayReady SL3000 unlocks hello flow of enhanced premium content (4K, HDR, etc.) and new content delivery models (early window for Enhanced Content).</span></span>

<span data-ttu-id="47ef8-493">Centrarse en los dispositivos de Windows hello: PlayReady es Hola solo DRM en hello HW disponible en dispositivos de Windows (PlayReady SL3000).</span><span class="sxs-lookup"><span data-stu-id="47ef8-493">Focus on hello Windows devices: PlayReady is hello only DRM in hello HW available on Windows devices (PlayReady SL3000).</span></span> <span data-ttu-id="47ef8-494">Un servicio de streaming puede usar PlayReady mediante EME o una aplicación de UWP y ofrecer una mayor calidad de vídeo con PlayReady SL3000 que otro DRM.</span><span class="sxs-lookup"><span data-stu-id="47ef8-494">A streaming service can use PlayReady through EME or through a UWP application and offer a higher video quality using PlayReady SL3000 than another DRM.</span></span> <span data-ttu-id="47ef8-495">Por lo general, contenido de 2K fluirá a través de Chrome o Firefox y 4 K contenido a través de Microsoft Edge/IE11 o una aplicación de UWP en Hola mismo dispositivo (según la configuración del servicio y la implementación).</span><span class="sxs-lookup"><span data-stu-id="47ef8-495">Typically, 2K content will flow through Chrome or Firefox, and 4K content through Microsoft Edge/IE11 or a UWP application on hello same device (depending on service settings and implementation).</span></span>

#### <a name="using-eme-for-widevine"></a><span data-ttu-id="47ef8-496">Uso de EME para Widevine</span><span class="sxs-lookup"><span data-stu-id="47ef8-496">Using EME for Widevine</span></span>
<span data-ttu-id="47ef8-497">En un explorador moderno con compatibilidad EME/Widevine, por ejemplo, Chrome 41 + en Windows 10, Windows 8.1, Mac OSX Yosemite y Chrome en 4.4.4 Android, Google Widevine es hello DRM detrás EME.</span><span class="sxs-lookup"><span data-stu-id="47ef8-497">On a modern browser with EME/Widevine support, such as Chrome 41+ on Windows 10, Windows 8.1, Mac OSX Yosemite, and Chrome on Android 4.4.4, Google Widevine is hello DRM behind EME.</span></span>

![Uso de EME para Widevine](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-widevine1.png)

<span data-ttu-id="47ef8-499">Tenga en cuenta que Widevine no impide la realización de capturas de pantalla de vídeo protegido.</span><span class="sxs-lookup"><span data-stu-id="47ef8-499">Notice that Widevine does not prevent one from making screen capture of protected video.</span></span>

![Uso de EME para Widevine](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-widevine2.png)

### <a name="not-entitled-users"></a><span data-ttu-id="47ef8-501">Usuarios no autorizados</span><span class="sxs-lookup"><span data-stu-id="47ef8-501">Not entitled users</span></span>
<span data-ttu-id="47ef8-502">Si un usuario no es miembro del grupo "Usuarios"titulada ", usuario de hello no será capaz de toopass"comprobación de derechos"y servicio de licencias de DRM de múltiples Hola rechazará la licencia solicitada de hello tooissue tal y como se muestra a continuación.</span><span class="sxs-lookup"><span data-stu-id="47ef8-502">If a user is not a member of "Entitled Users" group, hello user will not be able toopass “entitlement check” and hello multi-DRM license service will refuse tooissue hello requested license as shown below.</span></span> <span data-ttu-id="47ef8-503">Hola descripción detallada es "adquirir licencias no se pudo", que es como se ha diseñado.</span><span class="sxs-lookup"><span data-stu-id="47ef8-503">hello detailed description is “License acquire failed”, which is as designed.</span></span>

![Usuarios no autorizados](./media/media-services-cenc-with-multidrm-access-control/media-services-unentitledusers.png)

### <a name="running-custom-secure-token-service"></a><span data-ttu-id="47ef8-505">Ejecución del servicio de token seguro personalizado</span><span class="sxs-lookup"><span data-stu-id="47ef8-505">Running custom Secure Token Service</span></span>
<span data-ttu-id="47ef8-506">Para el escenario de Hola de ejecución personalizado Token servicio seguro (STS), token de JWT de Hola se emitirá por STS personalizado Hola con clave simétrica o asimétrica.</span><span class="sxs-lookup"><span data-stu-id="47ef8-506">For hello scenario of running custom Secure Token Service (STS), hello JWT token will be issued by hello custom STS using either symmetric or asymmetric key.</span></span>

<span data-ttu-id="47ef8-507">caso de Hello del uso de clave simétrica (con Chrome):</span><span class="sxs-lookup"><span data-stu-id="47ef8-507">hello case of using symmetric key (using Chrome):</span></span>

![Ejecución del STS personalizado](./media/media-services-cenc-with-multidrm-access-control/media-services-running-sts1.png)

<span data-ttu-id="47ef8-509">Hola caso del uso de clave asimétrica a través de un X509 de certificados (mediante el explorador moderno de Microsoft).</span><span class="sxs-lookup"><span data-stu-id="47ef8-509">hello case of using asymmetric key via an X509 certificate (using Microsoft modern browser).</span></span>

![Ejecución del STS personalizado](./media/media-services-cenc-with-multidrm-access-control/media-services-running-sts2.png)

<span data-ttu-id="47ef8-511">En ambos Hola por encima de los casos, la autenticación de usuario sigue Hola igual: a través de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47ef8-511">In both of hello above cases, user authentication stays hello same – through Azure AD.</span></span> <span data-ttu-id="47ef8-512">Hola única diferencia es que se emiten tokens JWT Hola STS personalizado en lugar de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47ef8-512">hello only difference is that JWT tokens are issued by hello custom STS instead of Azure AD.</span></span> <span data-ttu-id="47ef8-513">Por supuesto, al configurar la protección de CENC dinámico, restricción Hola de servicio de entrega de licencia especifica tipo hello de token JWT, clave simétrica o asimétrica.</span><span class="sxs-lookup"><span data-stu-id="47ef8-513">Of course, when configuring dynamic CENC protection, hello restriction of license delivery service specifies hello type of JWT token, either symmetric or asymmetric key.</span></span>

## <a name="summary"></a><span data-ttu-id="47ef8-514">Resumen</span><span class="sxs-lookup"><span data-stu-id="47ef8-514">Summary</span></span>
<span data-ttu-id="47ef8-515">En este documento, hemos examinado el CENC con varios DRM nativos y el control de acceso mediante la autenticación con tokens: su diseño y su implementación mediante Azure, Servicios multimedia de Azure y el Reproductor multimedia de Azure.</span><span class="sxs-lookup"><span data-stu-id="47ef8-515">In this document, we discussed CENC with multi-native-DRM and access control via token authentication: its design and its implementation using Azure, Azure Media Services and Azure Media Player.</span></span>

* <span data-ttu-id="47ef8-516">Se presenta un diseño de referencia que contiene todos los componentes necesarios de hello en un subsistema DRM/CENC;</span><span class="sxs-lookup"><span data-stu-id="47ef8-516">A reference design is presented which contains all hello necessary components in a DRM/CENC subsystem;</span></span>
* <span data-ttu-id="47ef8-517">y una implementación de referencia en Azure, Servicios multimedia de Azure y el Reproductor multimedia de Azure.</span><span class="sxs-lookup"><span data-stu-id="47ef8-517">A reference implementation on Azure, Azure Media Services and Azure Media Player.</span></span>
* <span data-ttu-id="47ef8-518">También se describen algunos de los temas directamente relacionadas con la implementación y diseño Hola.</span><span class="sxs-lookup"><span data-stu-id="47ef8-518">Some topics directly involved in hello design and implementation are also discussed.</span></span>

## <a name="media-services-learning-paths"></a><span data-ttu-id="47ef8-519">Rutas de aprendizaje de Servicios multimedia</span><span class="sxs-lookup"><span data-stu-id="47ef8-519">Media Services learning paths</span></span>
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="47ef8-520">Envío de comentarios</span><span class="sxs-lookup"><span data-stu-id="47ef8-520">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]
 

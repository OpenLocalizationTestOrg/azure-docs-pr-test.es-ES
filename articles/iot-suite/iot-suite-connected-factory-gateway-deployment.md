---
title: "aaaDeploy el conjunto de IoT de Azure conectado puerta de enlace de fábrica | Documentos de Microsoft"
description: "Cómo toodeploy una puerta de enlace de Windows o Linux toohello de conectividad de tooenable había conectado fábrica preconfigurado solución."
services: 
suite: iot-suite
documentationcenter: na
author: dominicbetts
manager: timlt
editor: 
ms.service: iot-suite
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/24/2017
ms.author: dobett
ms.openlocfilehash: 72436dec60eda0de20143f362fe740b0c4412f36
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="deploy-a-gateway-on-windows-or-linux-for-hello-connected-factory-preconfigured-solution"></a><span data-ttu-id="82e84-103">Implementar una puerta de enlace de Windows o Linux para la solución de fábrica preconfigurado Hola conectado</span><span class="sxs-lookup"><span data-stu-id="82e84-103">Deploy a gateway on Windows or Linux for hello connected factory preconfigured solution</span></span>

<span data-ttu-id="82e84-104">Hello requiere software toodeploy una puerta de enlace para la solución de fábrica preconfigurado Hola conectado tiene dos componentes:</span><span class="sxs-lookup"><span data-stu-id="82e84-104">hello software required toodeploy a gateway for hello connected factory preconfigured solution has two components:</span></span>

* <span data-ttu-id="82e84-105">Hola *OPC Proxy* establece un concentrador de conexión tooIoT.</span><span class="sxs-lookup"><span data-stu-id="82e84-105">hello *OPC Proxy* establishes a connection tooIoT Hub.</span></span> <span data-ttu-id="82e84-106">Hola *OPC Proxy* , a continuación, espera a que los mensajes de comando y control de hello integrado OPC explorador que se ejecuta en el portal de solución de hello generador conectado.</span><span class="sxs-lookup"><span data-stu-id="82e84-106">hello *OPC Proxy* then waits for command and control messages from hello integrated OPC Browser that runs in hello connected factory solution portal.</span></span>
* <span data-ttu-id="82e84-107">Hola *Publisher OPC* se conecta a servidores de agente de usuario de OPC tooexisting locales y reenvía los mensajes de telemetría de ellos tooIoT concentrador.</span><span class="sxs-lookup"><span data-stu-id="82e84-107">hello *OPC Publisher* connects tooexisting on-premises OPC UA servers and forwards telemetry messages from them tooIoT Hub.</span></span>

<span data-ttu-id="82e84-108">Ambos componentes son de código abierto y están disponibles como código fuente en GitHub y como contenedores de Docker:</span><span class="sxs-lookup"><span data-stu-id="82e84-108">Both components are open-source and are available as source on GitHub and as Docker containers:</span></span>

| <span data-ttu-id="82e84-109">GitHub</span><span class="sxs-lookup"><span data-stu-id="82e84-109">GitHub</span></span> | <span data-ttu-id="82e84-110">DockerHub</span><span class="sxs-lookup"><span data-stu-id="82e84-110">DockerHub</span></span> |
| ------ | --------- |
| <span data-ttu-id="82e84-111">[OPC Publisher][lnk-publisher-github]</span><span class="sxs-lookup"><span data-stu-id="82e84-111">[OPC Publisher][lnk-publisher-github]</span></span> | <span data-ttu-id="82e84-112">[OPC Publisher][lnk-publisher-docker]</span><span class="sxs-lookup"><span data-stu-id="82e84-112">[OPC Publisher][lnk-publisher-docker]</span></span> |
| <span data-ttu-id="82e84-113">[OPC Proxy][lnk-proxy-github]</span><span class="sxs-lookup"><span data-stu-id="82e84-113">[OPC Proxy][lnk-proxy-github]</span></span> | <span data-ttu-id="82e84-114">[OPC Proxy][lnk-proxy-docker]</span><span class="sxs-lookup"><span data-stu-id="82e84-114">[OPC Proxy][lnk-proxy-docker]</span></span> |

<span data-ttu-id="82e84-115">Ninguna dirección IP de orientados al público o agujeros en firewall de puerta de enlace de hello son necesarios para alguno de los componentes.</span><span class="sxs-lookup"><span data-stu-id="82e84-115">No public-facing IP address or holes in hello gateway firewall are required for either component.</span></span> <span data-ttu-id="82e84-116">Hola OPC Proxy y el publicador de OPC utilizan solo los puertos de salida 8883, 5671 y 443.</span><span class="sxs-lookup"><span data-stu-id="82e84-116">hello OPC Proxy and OPC Publisher use only outbound ports 443, 5671, and 8883.</span></span>

<span data-ttu-id="82e84-117">Hello pasos en este artículo muestra cómo toodeploy una puerta de enlace con Docker en cualquier [Windows](#windows-deployment) o [Linux](#linux-deployment).</span><span class="sxs-lookup"><span data-stu-id="82e84-117">hello steps in this article show you how toodeploy a gateway using Docker on either [Windows](#windows-deployment) or [Linux](#linux-deployment).</span></span> <span data-ttu-id="82e84-118">puerta de enlace de Hello habilita la solución de conectividad toohello conectado fábrica preconfigurado.</span><span class="sxs-lookup"><span data-stu-id="82e84-118">hello gateway enables connectivity toohello connected factory preconfigured solution.</span></span>

> [!NOTE]
> <span data-ttu-id="82e84-119">software de puerta de enlace de Hola que se ejecuta en el contenedor de Docker de hello es [Azure IoT borde].</span><span class="sxs-lookup"><span data-stu-id="82e84-119">hello gateway software that runs in hello Docker container is [Azure IoT Edge].</span></span>

## <a name="windows-deployment"></a><span data-ttu-id="82e84-120">Implementación de Windows</span><span class="sxs-lookup"><span data-stu-id="82e84-120">Windows deployment</span></span>

> [!NOTE]
> <span data-ttu-id="82e84-121">Si todavía no tiene un dispositivo de puerta de enlace, Microsoft le recomienda comprar una puerta de enlace comercial con uno de nuestros asociados.</span><span class="sxs-lookup"><span data-stu-id="82e84-121">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of our partners.</span></span> <span data-ttu-id="82e84-122">Visite hello [catálogo de dispositivos de IoT de Azure] para obtener una lista de dispositivos de puerta de enlace compatibles con hello conectado solución de fábrica.</span><span class="sxs-lookup"><span data-stu-id="82e84-122">Visit hello [Azure IoT device catalog] for a list of gateway devices compatible with hello connected factory solution.</span></span> <span data-ttu-id="82e84-123">Siga las instrucciones de Hola que vienen con hello tooset de dispositivo de puerta de enlace de Hola.</span><span class="sxs-lookup"><span data-stu-id="82e84-123">Follow hello instructions that come with hello device tooset up hello gateway.</span></span> <span data-ttu-id="82e84-124">O bien, usar hello después de configurar una de las puertas de enlace existentes de toomanually de instrucciones.</span><span class="sxs-lookup"><span data-stu-id="82e84-124">Alternatively, use hello following instructions toomanually set up one of your existing gateways.</span></span>

### <a name="install-docker"></a><span data-ttu-id="82e84-125">Instalación de Docker</span><span class="sxs-lookup"><span data-stu-id="82e84-125">Install Docker</span></span>

<span data-ttu-id="82e84-126">Instale [Docker para Windows] en el dispositivo de puerta de enlace Windows.</span><span class="sxs-lookup"><span data-stu-id="82e84-126">Install [Docker for Windows] on your Windows-based gateway device.</span></span> <span data-ttu-id="82e84-127">Durante la instalación de Docker de Windows, seleccione una unidad en el tooshare de máquina de host con Docker.</span><span class="sxs-lookup"><span data-stu-id="82e84-127">During Windows Docker setup, select a drive on your host machine tooshare with Docker.</span></span> <span data-ttu-id="82e84-128">Hola siguiente captura de pantalla muestra comparten unidad Hola D en el sistema de Windows:</span><span class="sxs-lookup"><span data-stu-id="82e84-128">hello following screenshot shows sharing hello D drive on your Windows system:</span></span>

![Instalación de Docker][img-install-docker]

<span data-ttu-id="82e84-130">A continuación, cree una carpeta denominada **docker** en la raíz de Hola de hello unidad compartida.</span><span class="sxs-lookup"><span data-stu-id="82e84-130">Then create a folder called **docker** in hello root of hello shared drive.</span></span>
<span data-ttu-id="82e84-131">También puede realizar este paso después de instalar docker desde hello **configuración** menú.</span><span class="sxs-lookup"><span data-stu-id="82e84-131">You can also perform this step after installing docker from hello **Settings** menu.</span></span>

### <a name="configure-hello-gateway"></a><span data-ttu-id="82e84-132">Configurar la puerta de enlace de Hola</span><span class="sxs-lookup"><span data-stu-id="82e84-132">Configure hello gateway</span></span>

1. <span data-ttu-id="82e84-133">Necesita hello **iothubowner** cadena de conexión de su conjunto de IoT de Azure conectado implementación de puerta de enlace de fábrica implementación toocomplete Hola.</span><span class="sxs-lookup"><span data-stu-id="82e84-133">You need hello **iothubowner** connection string of your Azure IoT Suite connected factory deployment toocomplete hello gateway deployment.</span></span> <span data-ttu-id="82e84-134">Hola [portal de Azure], navegue tooyour centro de IoT en grupo de recursos de hello crearon al implementar soluciones de fábrica de hello conectado.</span><span class="sxs-lookup"><span data-stu-id="82e84-134">In hello [Azure portal], navigate tooyour IoT Hub in hello resource group created when you deployed hello connected factory solution.</span></span> <span data-ttu-id="82e84-135">Haga clic en **directivas de acceso compartido** tooaccess hello **iothubowner** cadena de conexión:</span><span class="sxs-lookup"><span data-stu-id="82e84-135">Click **Shared access policies** tooaccess hello **iothubowner** connection string:</span></span>

    ![Buscar la cadena de conexión de centro de IoT Hola][img-hub-connection]

    <span data-ttu-id="82e84-137">Hola copia **cadena de conexión: clave principal** valor.</span><span class="sxs-lookup"><span data-stu-id="82e84-137">Copy hello **Connection string--primary key** value.</span></span>

1. <span data-ttu-id="82e84-138">Configurar la puerta de enlace de hello para el centro de IoT mediante la ejecución de los módulos de puerta de enlace de hello dos **una vez** desde un símbolo del sistema con:</span><span class="sxs-lookup"><span data-stu-id="82e84-138">Configure hello gateway for your IoT Hub by running hello two gateway modules **once** from a command prompt with:</span></span>

    `docker run -it --rm -h <ApplicationName> -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v //D/docker:/root/.dotnet/corefx/cryptography/x509stores microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName> "<IoTHubOwnerConnectionString>"`

    `docker run -it --rm -v //D/docker:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db`

    * <span data-ttu-id="82e84-139">**&lt;ApplicationName&gt;**  es Hola nombre toogive tooyour OPC UA publicador en formato de hello **publisher.&lt; el nombre de dominio completo&gt;**.</span><span class="sxs-lookup"><span data-stu-id="82e84-139">**&lt;ApplicationName&gt;** is hello name toogive tooyour OPC UA Publisher in hello format **publisher.&lt;your fully qualified domain name&gt;**.</span></span> <span data-ttu-id="82e84-140">Por ejemplo, si se llama a la red de fábrica **myfactorynetwork.com**, hello **ApplicationName** valor es **publisher.myfactorynetwork.com**.</span><span class="sxs-lookup"><span data-stu-id="82e84-140">For example, if your factory network is called **myfactorynetwork.com**, hello **ApplicationName** value is **publisher.myfactorynetwork.com**.</span></span>
    * <span data-ttu-id="82e84-141">**&lt;IoTHubOwnerConnectionString&gt;**  es hello **iothubowner** cadena de conexión copió en el paso anterior de Hola.</span><span class="sxs-lookup"><span data-stu-id="82e84-141">**&lt;IoTHubOwnerConnectionString&gt;** is hello **iothubowner** connection string you copied in hello previous step.</span></span> <span data-ttu-id="82e84-142">Esta cadena de conexión solo se utiliza en este paso, no la necesite en hello pasos:</span><span class="sxs-lookup"><span data-stu-id="82e84-142">This connection string is only used in this step, you don’t need it in hello following steps:</span></span>

    <span data-ttu-id="82e84-143">Usa Hola asignado D:\\carpeta docker (hello `-v` argumento) toopersist posterior Hola dos certificados X.509 que utilizar los módulos de puerta de enlace de Hola.</span><span class="sxs-lookup"><span data-stu-id="82e84-143">You use hello mapped D:\\docker folder (hello `-v` argument) later toopersist hello two X.509 certificates that hello gateway modules use.</span></span>

### <a name="run-hello-gateway"></a><span data-ttu-id="82e84-144">Ejecutar la puerta de enlace de Hola</span><span class="sxs-lookup"><span data-stu-id="82e84-144">Run hello gateway</span></span>

1. <span data-ttu-id="82e84-145">Reinicie la puerta de enlace de hello mediante Hola siguientes comandos:</span><span class="sxs-lookup"><span data-stu-id="82e84-145">Restart hello gateway using hello following commands:</span></span>

    `docker run -it --rm -h <ApplicationName> --expose 62222 -p 62222:62222 -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/Logs -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v //D/docker:/shared -v //D/docker:/root/.dotnet/corefx/cryptography/x509stores -e _GW_PNFP="/shared/publishednodes.JSON" microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName>`

    `docker run -it --rm -v //D/docker:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -D /mapped/cs.db`

1. <span data-ttu-id="82e84-146">Por motivos de seguridad, los certificados X.509 Hola dos se conservan en hello D:\\carpeta docker contienen la clave privada de Hola.</span><span class="sxs-lookup"><span data-stu-id="82e84-146">For security reasons, hello two X.509 certificates persisted in hello D:\\docker folder contain hello private key.</span></span> <span data-ttu-id="82e84-147">Limitar las credenciales de acceso toothis carpeta toohello (normalmente **administradores**) utilizar el contenedor de Docker de toorun Hola.</span><span class="sxs-lookup"><span data-stu-id="82e84-147">Limit access toothis folder toohello credentials (typically **Administrators**) you use toorun hello Docker container.</span></span> <span data-ttu-id="82e84-148">Hola contextual D:\\carpeta docker, elija **propiedades**, a continuación, **seguridad**y, a continuación, **editar**.</span><span class="sxs-lookup"><span data-stu-id="82e84-148">Right-click hello D:\\docker folder, choose **Properties**, then **Security**, and then **Edit**.</span></span> <span data-ttu-id="82e84-149">Conceda a los **administradores** el control total y quite a todos los demás:</span><span class="sxs-lookup"><span data-stu-id="82e84-149">Give **Administrators** full control and remove everyone else:</span></span>

    ![Recurso compartido de conceder permisos tooDocker][img-docker-share]

1. <span data-ttu-id="82e84-151">Compruebe la conectividad de la red.</span><span class="sxs-lookup"><span data-stu-id="82e84-151">Verify network connectivity.</span></span> <span data-ttu-id="82e84-152">Desde un símbolo del sistema, escriba el comando de hello `ping publisher.<your fully qualified domain name>` tooping la puerta de enlace.</span><span class="sxs-lookup"><span data-stu-id="82e84-152">From a command prompt, enter hello command `ping publisher.<your fully qualified domain name>` tooping your gateway.</span></span> <span data-ttu-id="82e84-153">Si se puede alcanzar el destino de hello, agregue la dirección IP de Hola y el nombre de archivo de hosts toohello de puerta de enlace en la puerta de enlace.</span><span class="sxs-lookup"><span data-stu-id="82e84-153">If hello destination is unreachable, add hello IP address and name of your gateway toohello hosts file on your gateway.</span></span> <span data-ttu-id="82e84-154">archivo de hosts de Hola se encuentra en hello **Windows\\System32\\controladores\\etcetera** carpeta.</span><span class="sxs-lookup"><span data-stu-id="82e84-154">hello hosts file is located in hello **Windows\\System32\\drivers\\etc** folder.</span></span>

1. <span data-ttu-id="82e84-155">A continuación, intente tooconnect toohello publicador con un cliente local de OPC UA con puerta de enlace de Hola.</span><span class="sxs-lookup"><span data-stu-id="82e84-155">Next, try tooconnect toohello publisher using a local OPC UA client running on hello gateway.</span></span> <span data-ttu-id="82e84-156">Hola es la dirección URL de extremo de OPC UA `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span><span class="sxs-lookup"><span data-stu-id="82e84-156">hello OPC UA endpoint URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span></span> <span data-ttu-id="82e84-157">Si no tiene un cliente OPC UA, puede descargar un [cliente OPC UA de código abierto] y úselo.</span><span class="sxs-lookup"><span data-stu-id="82e84-157">If you don't have an OPC UA client, you can download and use an [open-source OPC UA client].</span></span>

1. <span data-ttu-id="82e84-158">Cuando haya completado correctamente estas pruebas locales, busque toohello **conectar su propio servidor de agente de usuario de OPC** página del portal de solución de hello generador conectado.</span><span class="sxs-lookup"><span data-stu-id="82e84-158">When you have successfully completed these local tests, browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="82e84-159">Escriba la dirección URL del extremo de publicador de hello (`tcp://publisher.<your fully qualified domain name>:62222`) y haga clic en **conectar**.</span><span class="sxs-lookup"><span data-stu-id="82e84-159">Enter hello publisher endpoint URL (`tcp://publisher.<your fully qualified domain name>:62222`) and click **Connect**.</span></span> <span data-ttu-id="82e84-160">Recibirá una advertencia de certificado; luego, haga clic en **Proceed** (Continuar).</span><span class="sxs-lookup"><span data-stu-id="82e84-160">You get a certificate warning, then click **Proceed.**</span></span> <span data-ttu-id="82e84-161">A continuación se produce un error que Hola publicador no confía en hello cliente de agente de usuario Web.</span><span class="sxs-lookup"><span data-stu-id="82e84-161">Next you get an error that hello publisher doesn’t trust hello UA Web Client.</span></span> <span data-ttu-id="82e84-162">tooresolve este error, Hola copia **cliente de agente de usuario Web** certificado de hello **D:\\docker\\certificados rechazó\\certificados** carpeta toohello **D:\\docker\\aplicaciones de agente de usuario\\certificados** carpeta en la puerta de enlace de Hola.</span><span class="sxs-lookup"><span data-stu-id="82e84-162">tooresolve this error, copy hello **UA Web Client** certificate from hello **D:\\docker\\Rejected Certificates\\certs** folder toohello **D:\\docker\\UA Applications\\certs** folder on hello gateway.</span></span> <span data-ttu-id="82e84-163">No es necesario toorestart de puerta de enlace de Hola.</span><span class="sxs-lookup"><span data-stu-id="82e84-163">You do not need toorestart of hello gateway.</span></span> <span data-ttu-id="82e84-164">Repita este paso.</span><span class="sxs-lookup"><span data-stu-id="82e84-164">Repeat this step.</span></span> <span data-ttu-id="82e84-165">Ahora puede conectarse toohello puerta de enlace de nube de Hola y está listo tooadd toohello solución de OPC UA servidores.</span><span class="sxs-lookup"><span data-stu-id="82e84-165">You can now connect toohello gateway from hello cloud, and you are ready tooadd OPC UA servers toohello solution.</span></span>

### <a name="add-your-opc-ua-servers"></a><span data-ttu-id="82e84-166">Incorporación de los servidores OPC UA</span><span class="sxs-lookup"><span data-stu-id="82e84-166">Add your OPC UA servers</span></span>

1. <span data-ttu-id="82e84-167">Examinar toohello **conectar su propio servidor de agente de usuario de OPC** página del portal de solución de hello generador conectado.</span><span class="sxs-lookup"><span data-stu-id="82e84-167">Browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="82e84-168">Siga los mismos pasos de hello anterior sección tooestablish confianza entre Hola portal generador conectado y Hola servidor OPC UA de Hola.</span><span class="sxs-lookup"><span data-stu-id="82e84-168">Follow hello same steps as in hello preceding section tooestablish trust between hello connected factory portal and hello OPC UA server.</span></span> <span data-ttu-id="82e84-169">Este paso establece una confianza mutua de certificados de Hola de hello conectado hello servidor OPC UA y portal de fábrica y crea una conexión.</span><span class="sxs-lookup"><span data-stu-id="82e84-169">This step establishes a mutual trust of hello certificates from hello connected factory portal and hello OPC UA server and creates a connection.</span></span>

1. <span data-ttu-id="82e84-170">Examinar el árbol de nodos de OPC UA del servidor OPC UA hello, haga clic en los nodos OPC hello y seleccione **publicar**.</span><span class="sxs-lookup"><span data-stu-id="82e84-170">Browse hello OPC UA nodes tree of your OPC UA server, right-click hello OPC nodes, and select **publish**.</span></span> <span data-ttu-id="82e84-171">Para publicación de toowork de esta manera, Hola servidor OPC UA y Hola publicador debe ser en hello misma red.</span><span class="sxs-lookup"><span data-stu-id="82e84-171">For publishing toowork this way, hello OPC UA server and hello publisher must be on hello same network.</span></span> <span data-ttu-id="82e84-172">En otras palabras, si Hola completo nombre de dominio del publicador de hello es **publisher.mydomain.com** , a continuación, nombre de dominio completo de Hola de hello OPC UA servidor debe ser, por ejemplo, **myopcuaserver.mydomain.com**. Si el programa de instalación es diferente, puede agregar manualmente los nodos toohello publishesnodes.json archivo encontrado en archivos hello **D:\\docker** carpeta.</span><span class="sxs-lookup"><span data-stu-id="82e84-172">In other words, if hello fully qualified domain name of hello publisher is **publisher.mydomain.com** then hello fully qualified domain name of hello OPC UA server must be, for example, **myopcuaserver.mydomain.com**. If your setup is different, you can manually add nodes toohello publishesnodes.json file found in hello **D:\\docker** folder.</span></span> <span data-ttu-id="82e84-173">Hello publishesnodes.json archivo se genera automáticamente en hello primero correcta de publicación de un nodo de OPC.</span><span class="sxs-lookup"><span data-stu-id="82e84-173">hello publishesnodes.json file is automatically generated on hello first successful publish of an OPC node.</span></span>

1. <span data-ttu-id="82e84-174">Ahora los flujos de telemetría de dispositivo de puerta de enlace de Hola.</span><span class="sxs-lookup"><span data-stu-id="82e84-174">Telemetry now flows from hello gateway device.</span></span> <span data-ttu-id="82e84-175">Puede ver telemetría Hola Hola **Factory Locations** ver del portal de fábrica conectado hello en **nuevo generador**.</span><span class="sxs-lookup"><span data-stu-id="82e84-175">You can view hello telemetry in hello **Factory Locations** view of hello connected factory portal under **New Factory**.</span></span>

## <a name="linux-deployment"></a><span data-ttu-id="82e84-176">Implementación de Linux</span><span class="sxs-lookup"><span data-stu-id="82e84-176">Linux deployment</span></span>

> [!NOTE]
> <span data-ttu-id="82e84-177">Si todavía no tiene un dispositivo de puerta de enlace, Microsoft le recomienda comprar una puerta de enlace comercial con uno de nuestros asociados.</span><span class="sxs-lookup"><span data-stu-id="82e84-177">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of our partners.</span></span> <span data-ttu-id="82e84-178">Visite hello [catálogo de dispositivos de IoT de Azure] para obtener una lista de dispositivos de puerta de enlace compatibles con hello conectado solución de fábrica.</span><span class="sxs-lookup"><span data-stu-id="82e84-178">Visit hello [Azure IoT device catalog] for a list of gateway devices compatible with hello connected factory solution.</span></span> <span data-ttu-id="82e84-179">Siga las instrucciones de Hola que vienen con hello tooset de dispositivo de puerta de enlace de Hola.</span><span class="sxs-lookup"><span data-stu-id="82e84-179">Follow hello instructions that come with hello device tooset up hello gateway.</span></span> <span data-ttu-id="82e84-180">O bien, usar hello después de configurar una de las puertas de enlace existentes de toomanually de instrucciones.</span><span class="sxs-lookup"><span data-stu-id="82e84-180">Alternatively, use hello following instructions toomanually set up one of your existing gateways.</span></span>

<span data-ttu-id="82e84-181">[Instale Docker] en el dispositivo de puerta de enlace Linux.</span><span class="sxs-lookup"><span data-stu-id="82e84-181">[Install Docker] on your Linux gateway device.</span></span>

### <a name="configure-hello-gateway"></a><span data-ttu-id="82e84-182">Configurar la puerta de enlace de Hola</span><span class="sxs-lookup"><span data-stu-id="82e84-182">Configure hello gateway</span></span>

1. <span data-ttu-id="82e84-183">Necesita hello **iothubowner** cadena de conexión de su conjunto de IoT de Azure conectado implementación de puerta de enlace de fábrica implementación toocomplete Hola.</span><span class="sxs-lookup"><span data-stu-id="82e84-183">You need hello **iothubowner** connection string of your Azure IoT Suite connected factory deployment toocomplete hello gateway deployment.</span></span> <span data-ttu-id="82e84-184">Hola [portal de Azure], navegue tooyour centro de IoT en grupo de recursos de hello crearon al implementar soluciones de fábrica de hello conectado.</span><span class="sxs-lookup"><span data-stu-id="82e84-184">In hello [Azure portal], navigate tooyour IoT Hub in hello resource group created when you deployed hello connected factory solution.</span></span> <span data-ttu-id="82e84-185">Haga clic en **directivas de acceso compartido** tooaccess hello **iothubowner** cadena de conexión:</span><span class="sxs-lookup"><span data-stu-id="82e84-185">Click **Shared access policies** tooaccess hello **iothubowner** connection string:</span></span>

    ![Buscar la cadena de conexión de centro de IoT Hola][img-hub-connection]

    <span data-ttu-id="82e84-187">Hola copia **cadena de conexión: clave principal** valor.</span><span class="sxs-lookup"><span data-stu-id="82e84-187">Copy hello **Connection string--primary key** value.</span></span>

1. <span data-ttu-id="82e84-188">Configurar la puerta de enlace de hello para el centro de IoT mediante la ejecución de los módulos de puerta de enlace de hello dos **una vez** desde un shell con:</span><span class="sxs-lookup"><span data-stu-id="82e84-188">Configure hello gateway for your IoT Hub by running hello two gateway modules **once** from a shell with:</span></span>

    `sudo docker run -it --rm -h <ApplicationName> -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/ -v /shared:/root/.dotnet/corefx/cryptography/x509stores microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName> "<IoTHubOwnerConnectionString>"`

    `sudo docker run --rm -it -v /shared:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db`

    * <span data-ttu-id="82e84-189">**&lt;ApplicationName&gt;**  es nombre Hola de hello puerta de enlace de OPC UA aplicación Hola crea en formato de hello **publisher.&lt; el nombre de dominio completo&gt;**.</span><span class="sxs-lookup"><span data-stu-id="82e84-189">**&lt;ApplicationName&gt;** is hello name of hello OPC UA application hello gateway creates in hello format **publisher.&lt;your fully qualified domain name&gt;**.</span></span> <span data-ttu-id="82e84-190">Por ejemplo, **publisher.microsoft.com**.</span><span class="sxs-lookup"><span data-stu-id="82e84-190">For example, **publisher.microsoft.com**.</span></span>
    * <span data-ttu-id="82e84-191">**&lt;IoTHubOwnerConnectionString&gt;**  es hello **iothubowner** cadena de conexión copió en el paso anterior de Hola.</span><span class="sxs-lookup"><span data-stu-id="82e84-191">**&lt;IoTHubOwnerConnectionString&gt;** is hello **iothubowner** connection string you copied in hello previous step.</span></span> <span data-ttu-id="82e84-192">Esta cadena de conexión solo se utiliza en este paso, no la necesite en hello pasos:</span><span class="sxs-lookup"><span data-stu-id="82e84-192">This connection string is only used in this step, you don’t need it in hello following steps:</span></span>

    <span data-ttu-id="82e84-193">Usar hello **/ compartido** carpeta (hello `-v` argumento) toopersist posterior Hola dos certificados X.509 que utilizar los módulos de puerta de enlace de Hola.</span><span class="sxs-lookup"><span data-stu-id="82e84-193">You use hello **/shared** folder (hello `-v` argument) later toopersist hello two X.509 certificates that hello gateway modules use.</span></span>

### <a name="run-hello-gateway"></a><span data-ttu-id="82e84-194">Ejecutar la puerta de enlace de Hola</span><span class="sxs-lookup"><span data-stu-id="82e84-194">Run hello gateway</span></span>

1. <span data-ttu-id="82e84-195">Reinicie la puerta de enlace de hello mediante Hola siguientes comandos:</span><span class="sxs-lookup"><span data-stu-id="82e84-195">Restart hello gateway using hello following commands:</span></span>

    `sudo docker run -it -h <ApplicationName> --expose 62222 -p 62222:62222 –-rm -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/Logs -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v /shared:/shared -v /shared:/root/.dotnet/corefx/cryptography/x509stores -e _GW_PNFP="/shared/publishednodes.JSON" microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName>`

    `sudo docker run -it -v /shared:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -D /mapped/cs.db`

1. <span data-ttu-id="82e84-196">Por motivos de seguridad, los certificados X.509 Hola dos se conservan en hello **/ compartido** carpeta contienen la clave privada de Hola.</span><span class="sxs-lookup"><span data-stu-id="82e84-196">For security reasons, hello two X.509 certificates persisted in hello **/shared** folder contain hello private key.</span></span> <span data-ttu-id="82e84-197">Límite toothis carpeta toohello las credenciales de acceso usar toorun Hola contenedor Docker.</span><span class="sxs-lookup"><span data-stu-id="82e84-197">Limit access toothis folder toohello credentials you use toorun hello Docker container.</span></span> <span data-ttu-id="82e84-198">permisos de hello tooset para **raíz** únicamente, use hello `chmod` shell de comandos en carpeta Hola.</span><span class="sxs-lookup"><span data-stu-id="82e84-198">tooset hello permissions for **root** only, use hello `chmod` shell command on hello folder.</span></span>

1. <span data-ttu-id="82e84-199">Compruebe la conectividad de la red.</span><span class="sxs-lookup"><span data-stu-id="82e84-199">Verify network connectivity.</span></span> <span data-ttu-id="82e84-200">Desde un shell, escriba el comando de hello `ping publisher.<your fully qualified domain name>` tooping la puerta de enlace.</span><span class="sxs-lookup"><span data-stu-id="82e84-200">From a shell, enter hello command `ping publisher.<your fully qualified domain name>` tooping your gateway.</span></span> <span data-ttu-id="82e84-201">Si se puede alcanzar el destino de hello, agregue la dirección IP de Hola y el nombre de archivo de hosts tooyour de puerta de enlace en la puerta de enlace.</span><span class="sxs-lookup"><span data-stu-id="82e84-201">If hello destination is unreachable, add hello IP address and name of your gateway tooyour hosts file on your gateway.</span></span> <span data-ttu-id="82e84-202">archivo de hosts de Hola se encuentra en hello **/etcetera** carpeta.</span><span class="sxs-lookup"><span data-stu-id="82e84-202">hello hosts file is located in hello **/etc** folder.</span></span>

1. <span data-ttu-id="82e84-203">A continuación, intente tooconnect toohello publicador con un cliente local de OPC UA con puerta de enlace de Hola.</span><span class="sxs-lookup"><span data-stu-id="82e84-203">Next, try tooconnect toohello publisher using a local OPC UA client running on hello gateway.</span></span> <span data-ttu-id="82e84-204">Hola es la dirección URL de extremo de OPC UA `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span><span class="sxs-lookup"><span data-stu-id="82e84-204">hello OPC UA endpoint URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span></span> <span data-ttu-id="82e84-205">Si no tiene un cliente OPC UA, puede descargar un [cliente OPC UA de código abierto] y úselo.</span><span class="sxs-lookup"><span data-stu-id="82e84-205">If you don't have an OPC UA client, you can download and use an [open-source OPC UA client].</span></span>

1. <span data-ttu-id="82e84-206">Cuando haya completado correctamente estas pruebas locales, busque toohello **conectar su propio servidor de agente de usuario de OPC** página del portal de solución de hello generador conectado.</span><span class="sxs-lookup"><span data-stu-id="82e84-206">When you have successfully completed these local tests, browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="82e84-207">Escriba la dirección URL del extremo de publicador de hello (`tcp://publisher.<your fully qualified domain name>:62222`) y haga clic en **conectar**.</span><span class="sxs-lookup"><span data-stu-id="82e84-207">Enter hello publisher endpoint URL (`tcp://publisher.<your fully qualified domain name>:62222`) and click **Connect**.</span></span> <span data-ttu-id="82e84-208">Recibirá una advertencia de certificado; luego, haga clic en **Proceed** (Continuar).</span><span class="sxs-lookup"><span data-stu-id="82e84-208">You get a certificate warning, then click **Proceed.**</span></span> <span data-ttu-id="82e84-209">A continuación se produce un error que Hola publicador no confía en hello cliente de agente de usuario Web.</span><span class="sxs-lookup"><span data-stu-id="82e84-209">Next you get an error that hello publisher doesn’t trust hello UA Web Client.</span></span> <span data-ttu-id="82e84-210">tooresolve este error, Hola copia **cliente de agente de usuario Web** certificado de hello **/compartido/rechazado certificados/certificados** carpeta toohello **/shared/UA aplicaciones/certificados** carpeta de puerta de enlace de Hola.</span><span class="sxs-lookup"><span data-stu-id="82e84-210">tooresolve this error, copy hello **UA Web Client** certificate from hello **/shared/Rejected Certificates/certs** folder toohello **/shared/UA Applications/certs** folder on hello gateway.</span></span> <span data-ttu-id="82e84-211">No es necesario toorestart de puerta de enlace de Hola.</span><span class="sxs-lookup"><span data-stu-id="82e84-211">You do not need toorestart of hello gateway.</span></span> <span data-ttu-id="82e84-212">Repita este paso.</span><span class="sxs-lookup"><span data-stu-id="82e84-212">Repeat this step.</span></span> <span data-ttu-id="82e84-213">Ahora puede conectarse toohello puerta de enlace de nube de Hola y está listo tooadd toohello solución de OPC UA servidores.</span><span class="sxs-lookup"><span data-stu-id="82e84-213">You can now connect toohello gateway from hello cloud, and you are ready tooadd OPC UA servers toohello solution.</span></span>

### <a name="add-your-opc-ua-servers"></a><span data-ttu-id="82e84-214">Incorporación de los servidores OPC UA</span><span class="sxs-lookup"><span data-stu-id="82e84-214">Add your OPC UA servers</span></span>

1. <span data-ttu-id="82e84-215">Examinar toohello **conectar su propio servidor de agente de usuario de OPC** página del portal de solución de hello generador conectado.</span><span class="sxs-lookup"><span data-stu-id="82e84-215">Browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="82e84-216">Siga los mismos pasos de hello anterior sección tooestablish confianza entre Hola portal generador conectado y Hola servidor OPC UA de Hola.</span><span class="sxs-lookup"><span data-stu-id="82e84-216">Follow hello same steps as in hello preceding section tooestablish trust between hello connected factory portal and hello OPC UA server.</span></span> <span data-ttu-id="82e84-217">Este paso establece una confianza mutua de certificados de Hola de hello conectado hello servidor OPC UA y portal de fábrica y crea una conexión.</span><span class="sxs-lookup"><span data-stu-id="82e84-217">This step establishes a mutual trust of hello certificates from hello connected factory portal and hello OPC UA server and creates a connection.</span></span>

1. <span data-ttu-id="82e84-218">Examinar el árbol de nodos de OPC UA del servidor OPC UA hello, haga clic en los nodos OPC hello y seleccione **publicar**.</span><span class="sxs-lookup"><span data-stu-id="82e84-218">Browse hello OPC UA nodes tree of your OPC UA server, right-click hello OPC nodes, and select **publish**.</span></span> <span data-ttu-id="82e84-219">Para publicación de toowork de esta manera, Hola servidor OPC UA y Hola publicador debe ser en hello misma red.</span><span class="sxs-lookup"><span data-stu-id="82e84-219">For publishing toowork this way, hello OPC UA server and hello publisher must be on hello same network.</span></span> <span data-ttu-id="82e84-220">En otras palabras, si Hola completo nombre de dominio del publicador de hello es **publisher.mydomain.com** , a continuación, nombre de dominio completo de Hola de hello OPC UA servidor debe ser, por ejemplo, **myopcuaserver.mydomain.com**. Si el programa de instalación es diferente, puede agregar manualmente los nodos toohello publishesnodes.json archivo encontrado en archivos hello **/ compartido** carpeta.</span><span class="sxs-lookup"><span data-stu-id="82e84-220">In other words, if hello fully qualified domain name of hello publisher is **publisher.mydomain.com** then hello fully qualified domain name of hello OPC UA server must be, for example, **myopcuaserver.mydomain.com**. If your setup is different, you can manually add nodes toohello publishesnodes.json file found in hello **/shared** folder.</span></span> <span data-ttu-id="82e84-221">Hola publishesnodes.json se genera automáticamente en hello primero correcta de publicación de un nodo de OPC.</span><span class="sxs-lookup"><span data-stu-id="82e84-221">hello publishesnodes.json is automatically generated on hello first successful publish of an OPC node.</span></span>

1. <span data-ttu-id="82e84-222">Ahora los flujos de telemetría de dispositivo de puerta de enlace de Hola.</span><span class="sxs-lookup"><span data-stu-id="82e84-222">Telemetry now flows from hello gateway device.</span></span> <span data-ttu-id="82e84-223">Puede ver telemetría Hola Hola **Factory Locations** ver del portal de fábrica conectado hello en **nuevo generador**.</span><span class="sxs-lookup"><span data-stu-id="82e84-223">You can view hello telemetry in hello **Factory Locations** view of hello connected factory portal under **New Factory**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="82e84-224">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="82e84-224">Next steps</span></span>

<span data-ttu-id="82e84-225">toolearn más información acerca de arquitectura de Hola de fábrica conectado Hola preconfigurado solución, vea [conectado fábrica preconfigurado tutorial de la solución][lnk-walkthrough].</span><span class="sxs-lookup"><span data-stu-id="82e84-225">toolearn more about hello architecture of hello connected factory preconfigured solution, see [Connected factory preconfigured solution walkthrough][lnk-walkthrough].</span></span>

[img-install-docker]: ./media/iot-suite-connected-factory-gateway-deployment/image1.png
[img-hub-connection]: ./media/iot-suite-connected-factory-gateway-deployment/image2.png
[img-docker-share]: ./media/iot-suite-connected-factory-gateway-deployment/image3.png

[Docker para Windows]: https://www.docker.com/docker-windows
[catálogo de dispositivos de IoT de Azure]: https://catalog.azureiotsuite.com/?q=opc
[portal de Azure]: http://portal.azure.com/
[cliente OPC UA de código abierto]: https://github.com/OPCFoundation/UA-.NETStandardLibrary/tree/master/SampleApplications/Samples/Client.Net4
[Instale Docker]: https://www.docker.com/community-edition#/download
[lnk-walkthrough]: iot-suite-connected-factory-sample-walkthrough.md
[Azure IoT borde]: https://github.com/Azure/iot-edge

[lnk-publisher-github]: https://github.com/Azure/iot-edge-opc-publisher
[lnk-publisher-docker]: https://hub.docker.com/r/microsoft/iot-gateway-opc-ua
[lnk-proxy-github]: https://github.com/Azure/iot-edge-opc-proxy
[lnk-proxy-docker]: https://hub.docker.com/r/microsoft/iot-gateway-opc-ua-proxy
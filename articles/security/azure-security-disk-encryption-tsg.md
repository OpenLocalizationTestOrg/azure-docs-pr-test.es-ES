---
title: "aaaAzure la solución de problemas de cifrado de disco | Documentos de Microsoft"
description: "En este artículo se ofrecen sugerencias para solucionar problemas de Microsoft Azure Disk Encryption para máquinas virtuales IaaS con Windows y Linux."
services: security
documentationcenter: na
author: deventiwari
manager: avibm
editor: yuridio
ms.assetid: ce0e23bd-07eb-43af-a56c-aa1a73bdb747
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/27/2017
ms.author: devtiw
ms.openlocfilehash: 2ecb8df1fb869e3bf8f3be4be4494e6485e75695
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="azure-disk-encryption-troubleshooting-guide"></a><span data-ttu-id="5ef38-103">Guía de solución de problemas de Azure Disk Encryption</span><span class="sxs-lookup"><span data-stu-id="5ef38-103">Azure Disk Encryption Troubleshooting Guide</span></span>

<span data-ttu-id="5ef38-104">Esta guía está dirigida a profesionales de tecnologías de información, información los analistas de seguridad y problemas relacionados con los administradores de nube cuyas organizaciones usan el cifrado de disco de Azure y necesitan instrucciones tootroubleshoot cifrado de disco.</span><span class="sxs-lookup"><span data-stu-id="5ef38-104">This guide is for information technology (IT) professionals, information security analysts, and cloud administrators whose organizations are using Azure disk encryption and need guidance tootroubleshoot disk-encryption related issues.</span></span>

## <a name="troubleshooting-linux-os-disk-encryption"></a><span data-ttu-id="5ef38-105">Solución de problemas del cifrado de discos con el SO Linux</span><span class="sxs-lookup"><span data-stu-id="5ef38-105">Troubleshooting Linux OS disk encryption</span></span>

<span data-ttu-id="5ef38-106">Cifrado del disco de sistema operativo Linux debe desmontar Hola SO unidad anterior toorunning a través del proceso de cifrado de disco completo Hola.</span><span class="sxs-lookup"><span data-stu-id="5ef38-106">Linux OS disk encryption must unmount hello OS drive prior toorunning it through hello full disk encryption process.</span></span>   <span data-ttu-id="5ef38-107">Si no es posible, un mensaje de error "no se pudo toounmount después..."</span><span class="sxs-lookup"><span data-stu-id="5ef38-107">If it cannot, an error message of "failed toounmount after…"</span></span> <span data-ttu-id="5ef38-108">mensaje de error es probable que toooccur.</span><span class="sxs-lookup"><span data-stu-id="5ef38-108">error message is likely toooccur.</span></span>

<span data-ttu-id="5ef38-109">Suele ocurrir cuando se intenta el cifrado del disco del sistema operativo en un entorno de máquina virtual de destino que se ha modificado o cambiado desde su imagen de la galería admitida.</span><span class="sxs-lookup"><span data-stu-id="5ef38-109">This is most likely when OS disk encryption is attempted on a target VM environment that has been modified or changed from its supported stock gallery image.</span></span>  <span data-ttu-id="5ef38-110">Ejemplos de desviaciones de la imagen de hello admitida, lo que puede interferir con la unidad de la extensión de hello capacidad toounmount Hola OS:</span><span class="sxs-lookup"><span data-stu-id="5ef38-110">Examples of deviations from hello supported image, which can interfere with hello extension’s ability toounmount hello OS drive include:</span></span>
- <span data-ttu-id="5ef38-111">Imágenes personalizadas que ya no coinciden con un sistema de archivos o esquema de partición compatibles.</span><span class="sxs-lookup"><span data-stu-id="5ef38-111">Customized images that no longer match a supported file system and/or partitioning scheme.</span></span>
- <span data-ttu-id="5ef38-112">Imágenes personalizadas con aplicaciones como antivirus, Docker, SAP, MongoDB o Casandra de Apache que se ejecutan en tooencryption anterior del sistema operativo de Hola.</span><span class="sxs-lookup"><span data-stu-id="5ef38-112">Customized images with applications such as antivirus, Docker, SAP, MongoDB, or Apache Cassandra running in hello OS prior tooencryption.</span></span>  <span data-ttu-id="5ef38-113">Estas aplicaciones son difíciles de tooterminate y cuando mantienen unidad de toohello SO de identificadores de archivos abiertos, unidad de hello no se puede desmontar, provocando el error.</span><span class="sxs-lookup"><span data-stu-id="5ef38-113">These applications are difficult tooterminate, and when they retain open file handles toohello OS drive, hello drive cannot be unmounted, causing failure.</span></span>
- <span data-ttu-id="5ef38-114">Scripts personalizados que se ejecutan en cierran tiempo paso de cifrado de proximidad toohello puede interferir y hacer que este error.</span><span class="sxs-lookup"><span data-stu-id="5ef38-114">Custom scripts that run in close time proximity toohello encryption step can interfere and cause this failure.</span></span> <span data-ttu-id="5ef38-115">Esto puede ocurrir cuando una plantilla de administrador de recursos define varios tooexecute extensiones al mismo tiempo, o cuando una extensión de la secuencia de comandos personalizada o a otra acción se ejecuta simultáneamente toodisk cifrado.</span><span class="sxs-lookup"><span data-stu-id="5ef38-115">This can happen when a Resource Manager template defines multiple extensions tooexecute simultaneously, or when a custom script extension or other action is run simultaneously toodisk encryption.</span></span>   <span data-ttu-id="5ef38-116">Serialización y el aislamiento de estos pasos para resolver el problema de Hola.</span><span class="sxs-lookup"><span data-stu-id="5ef38-116">Serializing and isolating such steps may resolve hello issue.</span></span>
- <span data-ttu-id="5ef38-117">Cuando SELinux no se ha cifrado deshabilitado tooenabling anterior, Hola desmonte paso produce un error.</span><span class="sxs-lookup"><span data-stu-id="5ef38-117">When SELinux has not been disabled prior tooenabling encryption, hello unmount step fails.</span></span>  <span data-ttu-id="5ef38-118">SELinux puede habilitarse de nuevo después de completarse el cifrado.</span><span class="sxs-lookup"><span data-stu-id="5ef38-118">SELinux can be re-enabled after encryption has completed.</span></span>
- <span data-ttu-id="5ef38-119">Cuando el disco de SO de Hola usa un esquema de LVM (aunque hay compatibilidad limitada de disco de datos LVM, disco del sistema operativo LVM no es)</span><span class="sxs-lookup"><span data-stu-id="5ef38-119">When hello OS disk is using an LVM scheme (although limited LVM data disk support is available, LVM OS disk is not)</span></span>
- <span data-ttu-id="5ef38-120">Cuando no se cumplen los requisitos mínimos de memoria (se recomiendan 7GB para el cifrado del disco de sistema operativo)</span><span class="sxs-lookup"><span data-stu-id="5ef38-120">When minimum memory requirements are not met (7GB is suggested for OS disk encryption)</span></span>
- <span data-ttu-id="5ef38-121">Cuando las unidades de datos se han montado recursivamente en el directorio /mnt/ o entre sí (por ejemplo, /mnt/datos1, /mnt/datos2, /datos3 + /datos3/datos4, etc.)</span><span class="sxs-lookup"><span data-stu-id="5ef38-121">When data drives have been recursively mounted under /mnt/ directory, or each other (for example, /mnt/data1, /mnt/data2, /data3 + /data3/data4, etc.)</span></span>
- <span data-ttu-id="5ef38-122">Cuando no se cumplen otros [requisitos previos](https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption) de Azure Disk Encryption para Linux</span><span class="sxs-lookup"><span data-stu-id="5ef38-122">When other Azure Disk Encryption [prerequisites](https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption) for Linux are not met</span></span>

## <a name="unable-tooencrypt"></a><span data-ttu-id="5ef38-123">No se puede tooencrypt</span><span class="sxs-lookup"><span data-stu-id="5ef38-123">Unable tooencrypt</span></span>

<span data-ttu-id="5ef38-124">En algunos casos, cifrado de disco Linux Hola aparece toobe atascada en "Se inició el cifrado de disco de SO" y SSH está deshabilitada.</span><span class="sxs-lookup"><span data-stu-id="5ef38-124">In some cases, hello Linux disk encryption appears toobe stuck at "OS disk encryption started" and SSH is disabled.</span></span> <span data-ttu-id="5ef38-125">Este proceso puede tardar entre toocomplete 3-16 horas en una imagen de la Galería estándar.</span><span class="sxs-lookup"><span data-stu-id="5ef38-125">This process can take between 3-16 hours toocomplete on a stock gallery image.</span></span>  <span data-ttu-id="5ef38-126">Si se agregan discos de datos de tamaño de múltiples TB, el proceso de hello puede tardar días.</span><span class="sxs-lookup"><span data-stu-id="5ef38-126">If multi-TB size data disks are added, hello process may take days.</span></span> <span data-ttu-id="5ef38-127">Hello secuencia de cifrado del disco de sistema operativo Linux desmonta la unidad de hello SO temporalmente y realiza el cifrado de bloque a bloque de disco del sistema operativo completo hello, antes de volver a montar en su estado cifrado.</span><span class="sxs-lookup"><span data-stu-id="5ef38-127">hello Linux OS disk encryption sequence unmounts hello OS drive temporarily, and performs block by block encryption of hello entire OS disk, before remounting it in its encrypted state.</span></span>   <span data-ttu-id="5ef38-128">A diferencia del cifrado de disco de Azure en Windows, Linux cifrado del disco no permite uso simultáneo de hello VM durante el cifrado de hello en curso.</span><span class="sxs-lookup"><span data-stu-id="5ef38-128">Unlike Azure Disk Encryption on Windows, Linux Disk Encryption does not allow concurrent use of hello VM while hello encryption is in progress.</span></span>  <span data-ttu-id="5ef38-129">características de rendimiento de Hola de hello máquina virtual, incluido el tamaño de Hola de disco de Hola y si cuenta de almacenamiento de hello está respaldado por el sistema de almacenamiento (SSD) standard o premium, pueden influir en gran medida Hola tiempo necesario toocomplete cifrado.</span><span class="sxs-lookup"><span data-stu-id="5ef38-129">hello performance characteristics of hello VM, including hello size of hello disk and whether hello storage account is backed by standard or premium (SSD) storage, can greatly influence hello time required toocomplete encryption.</span></span>

<span data-ttu-id="5ef38-130">toocheck estado, los campos de ProgressMessage Hola devueltos desde hello [AzureRmVmDiskEncryptionStatus Get](https://docs.microsoft.com/powershell/module/azurerm.compute/get-azurermvmdiskencryptionstatus) puede sondearse comando.</span><span class="sxs-lookup"><span data-stu-id="5ef38-130">toocheck status, hello ProgressMessage field returned from hello [Get-AzureRmVmDiskEncryptionStatus](https://docs.microsoft.com/powershell/module/azurerm.compute/get-azurermvmdiskencryptionstatus) command can be polled.</span></span>   <span data-ttu-id="5ef38-131">Cuando se cifra la unidad de hello SO, Hola VM entra en estado de mantenimiento y SSH también es tooprevent deshabilitado ningún proceso continuo de toohello de interrupción.</span><span class="sxs-lookup"><span data-stu-id="5ef38-131">While hello OS drive is being encrypted, hello VM enters a servicing state, and SSH is also disabled tooprevent any disruption toohello ongoing process.</span></span>  <span data-ttu-id="5ef38-132">EncryptionInProgress se mostrarán para la mayoría de hello del tiempo de Hola durante el cifrado en curso, seguido de más tarde varias horas con un mensaje de confirmación toorestart Hola VM del VMRestartPending.</span><span class="sxs-lookup"><span data-stu-id="5ef38-132">EncryptionInProgress will be reported for hello majority of hello time while encryption is in progress, followed several hours later with a VMRestartPending message prompting toorestart hello VM.</span></span>  <span data-ttu-id="5ef38-133">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="5ef38-133">For example:</span></span>


```
PS > Get-AzureRmVMDiskEncryptionStatus -ResourceGroupName $resourceGroupName -VMName $vmName
OsVolumeEncrypted          : EncryptionInProgress
DataVolumesEncrypted       : EncryptionInProgress
OsVolumeEncryptionSettings : Microsoft.Azure.Management.Compute.Models.DiskEncryptionSettings
ProgressMessage            : OS disk encryption started

PS > Get-AzureRmVMDiskEncryptionStatus -ResourceGroupName $resourceGroupName -VMName $vmName
OsVolumeEncrypted          : VMRestartPending
DataVolumesEncrypted       : Encrypted
OsVolumeEncryptionSettings : Microsoft.Azure.Management.Compute.Models.DiskEncryptionSettings
ProgressMessage            : OS disk successfully encrypted, please reboot hello VM
```

<span data-ttu-id="5ef38-134">Una vez se le pida tooreboot Hola VM y, después de reiniciar Hola VM y conceder a 2 a 3 minutos para el reinicio de Hola y toobe pasos finales realizada en el destino de hello, mensaje de bienvenida de estado indicará que el cifrado finalmente ha completado.</span><span class="sxs-lookup"><span data-stu-id="5ef38-134">Once prompted tooreboot hello VM, and after restarting hello VM, and giving 2-3 minutes for hello reboot and for final steps toobe performed on hello target, hello status message will indicate that encryption has finally completed.</span></span>   <span data-ttu-id="5ef38-135">Cuando este mensaje está disponible, unidad del SO Hola cifrada es esperado toobe listo para su uso y para hello toobe de máquina virtual puede usar de nuevo.</span><span class="sxs-lookup"><span data-stu-id="5ef38-135">Once this message is available, hello encrypted OS drive is expected toobe ready for use and for hello VM toobe usable again.</span></span>

<span data-ttu-id="5ef38-136">En casos donde no se ha visto esta secuencia, o si otros indicadores de error, mensaje de progreso o información de inicio de informe que no se ha cifrado del sistema operativo en medio de Hola de este proceso (por ejemplo, si ve el error de "error toounmount" hello descrito en esta guía), se recomienda instantánea toohello atrás de toorestore Hola VM o copia de seguridad realizada tooencryption inmediatamente anterior.</span><span class="sxs-lookup"><span data-stu-id="5ef38-136">In cases where this sequence was not seen, or if boot information, progress message, or other error indicators report that OS encryption has failed in hello middle of this process (for example if you are seeing hello "failed toounmount" error described in this guide), it is recommended toorestore hello VM back toohello snapshot or backup taken immediately prior tooencryption.</span></span>  <span data-ttu-id="5ef38-137">Toohello anterior siguiente intento, es toore sugerido: evaluar las características de Hola de hello VM y asegúrese de que se cumplen todos los requisitos previos.</span><span class="sxs-lookup"><span data-stu-id="5ef38-137">Prior toohello next attempt, it is suggested toore-evaluate hello characteristics of hello VM and ensure that all prerequisites are satisfied.</span></span>

## <a name="troubleshooting-azure-disk-encryption-behind-a-firewall"></a><span data-ttu-id="5ef38-138">Solución de problemas de Azure Disk Encryption detrás de un firewall</span><span class="sxs-lookup"><span data-stu-id="5ef38-138">Troubleshooting Azure Disk Encryption behind a Firewall</span></span>
<span data-ttu-id="5ef38-139">Cuando conectividad está restringida por una capacidad Hola firewall, el requisito de proxy o la configuración de grupo (NSG) de seguridad de red, Hola extensión tooperform necesitan puede interrumpir las tareas.</span><span class="sxs-lookup"><span data-stu-id="5ef38-139">When connectivity is restricted by a firewall, proxy requirement, or network security group (NSG) settings, hello ability of hello extension tooperform needed tasks can be disrupted.</span></span>   <span data-ttu-id="5ef38-140">Esto puede dar lugar a mensajes de estado como "Estado de extensión no está disponible en hello VM" y en los escenarios esperados por error toofinish.</span><span class="sxs-lookup"><span data-stu-id="5ef38-140">This can result in status messages such as "Extension status not available on hello VM" and in expected scenarios failing toofinish.</span></span>  <span data-ttu-id="5ef38-141">secciones de Hola que van a continuación tiene algunos problemas comunes de firewall que puede investigar.</span><span class="sxs-lookup"><span data-stu-id="5ef38-141">hello sections that follow has some common firewall issues that you may investigate.</span></span>

### <a name="network-security-groups"></a><span data-ttu-id="5ef38-142">Grupos de seguridad de red</span><span class="sxs-lookup"><span data-stu-id="5ef38-142">Network security groups</span></span>
<span data-ttu-id="5ef38-143">Aplicada ninguna configuración de grupo de seguridad de red todavía debe permitir la configuración de red de hello documentado de hello extremo toomeet [requisitos previos](https://docs.microsoft.com/azure/security/azure-security-disk-encryption#prerequisites) para el cifrado de disco.</span><span class="sxs-lookup"><span data-stu-id="5ef38-143">Any network security group settings applied must still allow hello endpoint toomeet hello documented network configuration [prerequisites](https://docs.microsoft.com/azure/security/azure-security-disk-encryption#prerequisites) for disk encryption.</span></span>

### <a name="azure-keyvault-behind-firewall"></a><span data-ttu-id="5ef38-144">Azure Key Vault detrás del firewall</span><span class="sxs-lookup"><span data-stu-id="5ef38-144">Azure Keyvault behind firewall</span></span>
<span data-ttu-id="5ef38-145">Hola VM debe ser capaz de tooaccess el almacén de claves.</span><span class="sxs-lookup"><span data-stu-id="5ef38-145">hello VM must be able tooaccess key vault.</span></span> <span data-ttu-id="5ef38-146">Consulte tooguidance en errores de acceso tookey detrás de un firewall que se mantiene por hello [el almacén de claves](https://docs.microsoft.com/azure/key-vault/key-vault-access-behind-firewall) equipo.</span><span class="sxs-lookup"><span data-stu-id="5ef38-146">Refer tooguidance on access tookey fault from behind a firewall that is maintained by hello [Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-access-behind-firewall) team.</span></span>

### <a name="linux-package-management-behind-firewall"></a><span data-ttu-id="5ef38-147">Administración de paquetes de Linux detrás del firewall</span><span class="sxs-lookup"><span data-stu-id="5ef38-147">Linux package management behind firewall</span></span>
<span data-ttu-id="5ef38-148">En tiempo de ejecución, cifrado de disco de Azure para Linux se basa en paquete administración tooinstall necesitado componentes de requisitos previos anteriores tooenabling el cifrado del sistema la distribución de destino de hello.</span><span class="sxs-lookup"><span data-stu-id="5ef38-148">At run time, Azure Disk Encryption for Linux relies on hello target distribution’s package management system tooinstall needed prerequisite components prior tooenabling encryption.</span></span>  <span data-ttu-id="5ef38-149">Si la configuración de firewall impiden Hola VM pueda toodownload e instala estos componentes, a continuación, se esperan que produzcan errores posteriores.</span><span class="sxs-lookup"><span data-stu-id="5ef38-149">If firewall settings prevent hello VM from being able toodownload and install these components, then subsequent failures are expected.</span></span>    <span data-ttu-id="5ef38-150">pasos de Hello tooconfigure que esto puede variar en función de distribución.</span><span class="sxs-lookup"><span data-stu-id="5ef38-150">hello steps tooconfigure this may vary by distribution.</span></span>  <span data-ttu-id="5ef38-151">En Red Hat, cuando se requiere un proxy, es vital asegurarse de que el administrador de la suscripción y yum están configurados correctamente.</span><span class="sxs-lookup"><span data-stu-id="5ef38-151">On Red Hat, when a proxy is required, ensuring that subscription-manager and yum are set up properly is vital.</span></span>  <span data-ttu-id="5ef38-152">Consulte [este artículo](https://access.redhat.com/solutions/189533) de soporte técnico de Red Hat sobre este tema.</span><span class="sxs-lookup"><span data-stu-id="5ef38-152">See [this](https://access.redhat.com/solutions/189533) Red Hat support article on this topic.</span></span>  

## <a name="troubleshooting-windows-server-2016-server-core"></a><span data-ttu-id="5ef38-153">Solución de problemas de Windows Server 2016 Server Core</span><span class="sxs-lookup"><span data-stu-id="5ef38-153">Troubleshooting Windows Server 2016 Server Core</span></span>

<span data-ttu-id="5ef38-154">En Server Core de Windows Server 2016, componente de hello bdehdcfg no está disponible de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="5ef38-154">On Windows Server 2016 Server Core, hello bdehdcfg component is not available by default.</span></span> <span data-ttu-id="5ef38-155">y Azure Disk Encryption necesita dicho componente.</span><span class="sxs-lookup"><span data-stu-id="5ef38-155">This component is required by Azure Disk Encryption.</span></span>

<span data-ttu-id="5ef38-156">tooworkaround este problema, Hola copia siguientes 4 archivos de una carpeta de VM de centro de datos de Windows Server 2016 toohello c:\windows\system32 de imagen de Server Core de hello:</span><span class="sxs-lookup"><span data-stu-id="5ef38-156">tooworkaround this issue, copy hello following 4 files from a Windows Server 2016 Data Center VM toohello c:\windows\system32 folder of hello Server Core image:</span></span>

```
bdehdcfg.exe
bdehdcfglib.dll
bdehdcfglib.dll.mui
bdehdcfg.exe.mui
```

<span data-ttu-id="5ef38-157">A continuación, ejecute el siguiente comando de hello:</span><span class="sxs-lookup"><span data-stu-id="5ef38-157">Then, run hello following command:</span></span>

```
bdehdcfg.exe -target default
```

<span data-ttu-id="5ef38-158">Esto creará una partición de sistema de 550MB y, a continuación, tras un reinicio, puede usar Diskpart toocheck Hola volúmenes y continuar.</span><span class="sxs-lookup"><span data-stu-id="5ef38-158">This will create a 550MB system partition and then after a reboot, you can use Diskpart toocheck hello volumes, and proceed.</span></span>  

<span data-ttu-id="5ef38-159">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="5ef38-159">For example:</span></span>

```
DISKPART> list vol

  Volume ###  Ltr  Label        Fs     Type        Size     Status     Info
  ----------  ---  -----------  -----  ----------  -------  ---------  --------
  Volume 0     C                NTFS   Partition    126 GB  Healthy    Boot
  Volume 1                      NTFS   Partition    550 MB  Healthy    System
  Volume 2     D   Temporary S  NTFS   Partition     13 GB  Healthy    Pagefile
```
## <a name="see-also"></a><span data-ttu-id="5ef38-160">Otras referencias</span><span class="sxs-lookup"><span data-stu-id="5ef38-160">See also</span></span>
<span data-ttu-id="5ef38-161">En este documento, ha aprendido más información acerca de algunos problemas comunes en el cifrado de disco de Azure y cómo tootroubleshoot.</span><span class="sxs-lookup"><span data-stu-id="5ef38-161">In this document, you learned more about some common issues in Azure disk encryption, and how tootroubleshoot.</span></span> <span data-ttu-id="5ef38-162">Para más información acerca de este servicio y su funcionalidad, lea:</span><span class="sxs-lookup"><span data-stu-id="5ef38-162">For more information about this service and its capability read:</span></span>

- [<span data-ttu-id="5ef38-163">Aplicación de cifrado de discos en Azure Security Center</span><span class="sxs-lookup"><span data-stu-id="5ef38-163">Apply disk encryption in Azure Security Center</span></span>](https://docs.microsoft.com/azure/security-center/security-center-apply-disk-encryption)
- [<span data-ttu-id="5ef38-164">Cifrado de una máquina virtual de Azure</span><span class="sxs-lookup"><span data-stu-id="5ef38-164">Encrypt an Azure Virtual Machine</span></span>](https://docs.microsoft.com/azure/security-center/security-center-disk-encryption)
- [<span data-ttu-id="5ef38-165">Cifrado en reposo de datos de Azure</span><span class="sxs-lookup"><span data-stu-id="5ef38-165">Azure Data Encryption-at-Rest</span></span>](https://docs.microsoft.com/azure/security/azure-security-encryption-atrest)

---
title: "Generación de perfiles de aplicaciones web activas en Azure con Application Insights | Microsoft Docs"
description: "Identifique la ruta de acceso activa en el código del servidor web con un generador de perfiles de bajo impacto."
services: application-insights
documentationcenter: 
author: CFreemanwa
manager: carmonm
ms.service: application-insights
ms.workload: tbd
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: article
ms.date: 05/04/2017
ms.author: bwren
ms.openlocfilehash: ff39f9a84b86c14859aaee50ee368643fb2848ea
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/18/2017
---
# <a name="profiling-live-azure-web-apps-with-application-insights"></a><span data-ttu-id="f3327-103">Introducción a la supervisión de aplicaciones web de Azure con Application Insights</span><span class="sxs-lookup"><span data-stu-id="f3327-103">Profiling live Azure web apps with Application Insights</span></span>

<span data-ttu-id="f3327-104">*Esta característica de Application Insights está en GA para App Services y en versión preliminar para Compute.*</span><span class="sxs-lookup"><span data-stu-id="f3327-104">*This feature of Application Insights is GA for App Services and in preview for Compute.*</span></span>

<span data-ttu-id="f3327-105">Averigüe cuánto tiempo se dedica a cada método en la aplicación web activa con la herramienta de generación de perfiles de [Azure Application Insights](app-insights-overview.md).</span><span class="sxs-lookup"><span data-stu-id="f3327-105">Find out how much time is spent in each method in your live web application by using the profiling tool of [Azure Application Insights](app-insights-overview.md).</span></span> <span data-ttu-id="f3327-106">Esta herramienta le muestra perfiles detallados de solicitudes activas que han sido atendidas por su aplicación y resalta la "ruta de acceso activa" que se usa la mayor parte del tiempo.</span><span class="sxs-lookup"><span data-stu-id="f3327-106">It shows you detailed profiles of live requests that were served by your app, and highlights the 'hot path' that is using the most time.</span></span> <span data-ttu-id="f3327-107">Selecciona automáticamente ejemplos con distintos tiempos de respuesta.</span><span class="sxs-lookup"><span data-stu-id="f3327-107">It automatically selects examples that have different response times.</span></span> <span data-ttu-id="f3327-108">El generador de perfiles usa diversas técnicas para minimizar la sobrecarga.</span><span class="sxs-lookup"><span data-stu-id="f3327-108">The profiler uses various techniques to minimize overhead.</span></span>

<span data-ttu-id="f3327-109">El generador de perfiles actualmente funciona para las aplicaciones web ASP.NET con Azure App Services, en al menos el plan de tarifa Básico.</span><span class="sxs-lookup"><span data-stu-id="f3327-109">The profiler currently works for ASP.NET web apps running on Azure App Services, in at least the Basic pricing tier.</span></span> 

<a id="installation"></a>
## <a name="enable-the-profiler"></a><span data-ttu-id="f3327-110">Habilitar el generador de perfiles</span><span class="sxs-lookup"><span data-stu-id="f3327-110">Enable the profiler</span></span>

<span data-ttu-id="f3327-111">Instale [Application Insights](app-insights-asp-net.md) en el código.</span><span class="sxs-lookup"><span data-stu-id="f3327-111">[Install Application Insights](app-insights-asp-net.md) in your code.</span></span> <span data-ttu-id="f3327-112">Si ya está instalado, asegúrese de que tiene la última versión.</span><span class="sxs-lookup"><span data-stu-id="f3327-112">If it's already installed, make sure you have the latest version.</span></span> <span data-ttu-id="f3327-113">(Para ello, haga clic con el botón derecho en el proyecto en el Explorador de soluciones y elija Administrar paquetes de NuGet.</span><span class="sxs-lookup"><span data-stu-id="f3327-113">(To do this, right-click your project in Solution Explorer, and choose Manage NuGet packages.</span></span> <span data-ttu-id="f3327-114">Seleccione Actualizaciones y actualice todos los paquetes). Vuelva a implementar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f3327-114">Select Updates and update all packages.) Re-deploy your app.</span></span>

<span data-ttu-id="f3327-115">*¿Usa ASP.NET Core? [Haga clic aquí](#aspnetcore).*</span><span class="sxs-lookup"><span data-stu-id="f3327-115">*Using ASP.NET Core? [Check here](#aspnetcore).*</span></span>

<span data-ttu-id="f3327-116">En [https://portal.azure.com](https://portal.azure.com), abra el recurso Application Insights para su aplicación.</span><span class="sxs-lookup"><span data-stu-id="f3327-116">In [https://portal.azure.com](https://portal.azure.com), open the Application Insights resource for your web app.</span></span> <span data-ttu-id="f3327-117">Abra **Rendimiento** y haga clic en **Habilitar Application Insights Profiler**.</span><span class="sxs-lookup"><span data-stu-id="f3327-117">Open **Performance** and click **Enable Application Insights Profiler...**.</span></span>

![Haga clic en el banner de habilitación de Profiler.][enable-profiler-banner]

<span data-ttu-id="f3327-119">O bien, siempre puede hacer clic en **Configurar** para ver el estado, o para habilitar o deshabilitar Profiler.</span><span class="sxs-lookup"><span data-stu-id="f3327-119">Alternatively, you can always click **Configure** to view status, enable, or disable the Profiler.</span></span>

![En la hoja Rendimiento, haga clic en Configurar][performance-blade]

<span data-ttu-id="f3327-121">Las aplicaciones web que se configuran con Application Insights se muestran en la Configurar.</span><span class="sxs-lookup"><span data-stu-id="f3327-121">Web apps that are configured with Application Insights are listed on Configure blade.</span></span> <span data-ttu-id="f3327-122">Siga las instrucciones para instalar al agente de Profiler si es necesario.</span><span class="sxs-lookup"><span data-stu-id="f3327-122">Follow instructions to install the Profiler agent if needed.</span></span> <span data-ttu-id="f3327-123">Si no hay ninguna aplicación web configurada con Application Insights aún, haga clic en *Agregar aplicaciones vinculadas*.</span><span class="sxs-lookup"><span data-stu-id="f3327-123">If no web app is configured with Application Insights yet, click *Add Linked Apps*.</span></span>

<span data-ttu-id="f3327-124">Use los botones *Habilitar profiler* o *Deshabilitar Profiler* de la hoja Configurar para controlar Profiler en todas las aplicaciones web vinculadas.</span><span class="sxs-lookup"><span data-stu-id="f3327-124">Use the *Enable Profiler* or *Disable Profiler* buttons in the Configure blade to control the Profiler on all your linked web apps.</span></span>



![Hoja Configurar][linked app services]

<span data-ttu-id="f3327-126">Si tiene que detener o reiniciar Profiler para una instancia de App Services, lo encontrará **en el recurso App Service**, en **Trabajos web**.</span><span class="sxs-lookup"><span data-stu-id="f3327-126">To stop or restart the profiler for an individual App Service instance, you'll find it **in the App Service resource**, in **Web Jobs**.</span></span> <span data-ttu-id="f3327-127">Para eliminarlo, mire en **Extensiones**.</span><span class="sxs-lookup"><span data-stu-id="f3327-127">To delete it, look under **Extensions**.</span></span>

![Deshabilitación de Profiler para los trabajos web][disable-profiler-webjob]

<span data-ttu-id="f3327-129">Recomendamos tener Profiler habilitado en todas las aplicaciones web para detectar cualquier problema de rendimiento lo antes posible.</span><span class="sxs-lookup"><span data-stu-id="f3327-129">We recommend that you have the Profiler enabled on all your web apps to discover any performance issues as soon as possible.</span></span>

<span data-ttu-id="f3327-130">Si usa WebDeploy para implementar cambios en la aplicación web, asegúrese de que la carpeta **App_Data** no se elimine durante la implementación.</span><span class="sxs-lookup"><span data-stu-id="f3327-130">If you use WebDeploy to deploy changes to your web application, ensure that you exclude the **App_Data** folder from being deleted during deployment.</span></span> <span data-ttu-id="f3327-131">De lo contrario, los archivos de la extensión del generador de perfiles se eliminarán la próxima vez que implemente la aplicación web en Azure.</span><span class="sxs-lookup"><span data-stu-id="f3327-131">Otherwise, the profiler extension's files will be deleted when you next deploy the web application to Azure.</span></span>

### <a name="using-profiler-with-azure-vms-and-compute-resources-preview"></a><span data-ttu-id="f3327-132">Uso de Profiler con máquinas virtuales de Azure y recursos de Compute (versión preliminar)</span><span class="sxs-lookup"><span data-stu-id="f3327-132">Using profiler with Azure VMs and Compute resources (preview)</span></span>

<span data-ttu-id="f3327-133">Cuando se [habilita Application Insights para Azure App Service en tiempo de ejecución](app-insights-azure-web-apps.md#run-time-instrumentation-with-application-insights), Profiler está disponible automáticamente</span><span class="sxs-lookup"><span data-stu-id="f3327-133">When you [enable Application Insights for Azure app services at run time](app-insights-azure-web-apps.md#run-time-instrumentation-with-application-insights), Profiler is automatically available.</span></span> <span data-ttu-id="f3327-134">(si ya está habilitado Application Insights para el recurso, tendrá que actualizar a la versión más reciente a través del Asistente para **configuración**).</span><span class="sxs-lookup"><span data-stu-id="f3327-134">(If you already enabled Application Insights for the resource, you might need to update to the lates version through the **Configure** wizard.)</span></span>

<span data-ttu-id="f3327-135">Hay una [versión preliminar de Profiler para los recursos de Azure Compute](https://go.microsoft.com/fwlink/?linkid=848155).</span><span class="sxs-lookup"><span data-stu-id="f3327-135">There is a [preview version of the Profiler for Azure Compute resources](https://go.microsoft.com/fwlink/?linkid=848155).</span></span>


## <a name="limits"></a><span data-ttu-id="f3327-136">Límites</span><span class="sxs-lookup"><span data-stu-id="f3327-136">Limits</span></span>

<span data-ttu-id="f3327-137">La retención de datos predeterminada es de 5 días.</span><span class="sxs-lookup"><span data-stu-id="f3327-137">The default data retention is 5 days.</span></span> <span data-ttu-id="f3327-138">La ingesta máxima por día es de 10 GB.</span><span class="sxs-lookup"><span data-stu-id="f3327-138">Maximum 10 GB ingested per day.</span></span>

<span data-ttu-id="f3327-139">No se aplica ningún cargo por el servicio Profiler.</span><span class="sxs-lookup"><span data-stu-id="f3327-139">There is no charge for the profiler service.</span></span> <span data-ttu-id="f3327-140">La aplicación web debe hospedarse en al menos el nivel Básico de App Services.</span><span class="sxs-lookup"><span data-stu-id="f3327-140">Your web app must be hosted in at least the Basic tier of App Services.</span></span>

## <a name="viewing-profiler-data"></a><span data-ttu-id="f3327-141">Visualización de datos del generador de perfiles</span><span class="sxs-lookup"><span data-stu-id="f3327-141">Viewing profiler data</span></span>

<span data-ttu-id="f3327-142">Abra la hoja Rendimiento y desplácese hasta la lista de operaciones.</span><span class="sxs-lookup"><span data-stu-id="f3327-142">Open the Performance blade and scroll down to the operation list.</span></span>




![Columna de ejemplos de la hoja Rendimiento de Application Insights][performance-blade-examples]

<span data-ttu-id="f3327-144">Las columnas de la tabla son las siguientes:</span><span class="sxs-lookup"><span data-stu-id="f3327-144">The columns in the table are:</span></span>

* <span data-ttu-id="f3327-145">**Recuento**: número de estas solicitudes en el intervalo de tiempo de la hoja.</span><span class="sxs-lookup"><span data-stu-id="f3327-145">**Count** - The number of these requests in the time range of the blade.</span></span>
* <span data-ttu-id="f3327-146">**Valor medio**: tiempo típico que tarda la aplicación en responder a una solicitud.</span><span class="sxs-lookup"><span data-stu-id="f3327-146">**Median** - The typical time your app takes to respond to a request.</span></span> <span data-ttu-id="f3327-147">La mitas de todas las respuestas fueron más rápidas.</span><span class="sxs-lookup"><span data-stu-id="f3327-147">Half of all responses were faster than this.</span></span>
* <span data-ttu-id="f3327-148">**95.° percentil** el 95 % de las respuestas fueron más rápidas.</span><span class="sxs-lookup"><span data-stu-id="f3327-148">**95th percentile** 95% of responses were faster than this.</span></span> <span data-ttu-id="f3327-149">Si esta cifra se aleja mucho del valor medio, puede que haya un problema intermitente con la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f3327-149">If this figure is very different from the median, there might be an intermittent problem with your app.</span></span> <span data-ttu-id="f3327-150">(También es posible que se explique por una característica de diseño, como el almacenamiento en caché).</span><span class="sxs-lookup"><span data-stu-id="f3327-150">(Or it might be explained by a design feature such as caching.)</span></span>
* <span data-ttu-id="f3327-151">**Ejemplos**: icono que indica que el generador de perfiles ha capturado seguimientos de la pila para esta operación.</span><span class="sxs-lookup"><span data-stu-id="f3327-151">**Examples** - an icon indicates that the profiler has captured stack traces for this operation.</span></span>

<span data-ttu-id="f3327-152">Haga clic en el icono de Ejemplos para abrir el explorador de seguimiento.</span><span class="sxs-lookup"><span data-stu-id="f3327-152">Click the Examples icon to open the trace explorer.</span></span> <span data-ttu-id="f3327-153">El explorador muestra varios muestras capturadas por el generador de perfiles, clasificadas por tiempo de respuesta.</span><span class="sxs-lookup"><span data-stu-id="f3327-153">The explorer shows several samples that the profiler has captured, classified by response time.</span></span>

<span data-ttu-id="f3327-154">Seleccione una muestra para mostrar un desglose de nivel de código del tiempo dedicado a ejecutar la solicitud.</span><span class="sxs-lookup"><span data-stu-id="f3327-154">Select a sample to show a code-level breakdown of time spent executing the request.</span></span>

![Explorador de seguimiento de Application Insights][trace-explorer]

<span data-ttu-id="f3327-156">**Show hot path** (Mostrar ruta de acceso activa) abre el mayor nodo hoja o al menos algo que se aproxime.</span><span class="sxs-lookup"><span data-stu-id="f3327-156">**Show hot path** opens the biggest leaf node, or at least something close.</span></span> <span data-ttu-id="f3327-157">En la mayoría de los casos, este nodo estará adyacente a un cuello de botella de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="f3327-157">In most cases this node will be adjacent to a performance bottleneck.</span></span>



* <span data-ttu-id="f3327-158">**Etiqueta**: nombre de la función o el evento.</span><span class="sxs-lookup"><span data-stu-id="f3327-158">**Label**: The name of the function or event.</span></span> <span data-ttu-id="f3327-159">El árbol muestra una combinación de código y eventos que se han producido (como, por ejemplo eventos http y SQL).</span><span class="sxs-lookup"><span data-stu-id="f3327-159">The tree shows a mix of code and events that occurred (such as SQL and http events).</span></span> <span data-ttu-id="f3327-160">El evento superior representa la duración total de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="f3327-160">The top event represents the overall request duration.</span></span>
* <span data-ttu-id="f3327-161">**Transcurrido**: el intervalo de tiempo entre el inicio de la operación y el final.</span><span class="sxs-lookup"><span data-stu-id="f3327-161">**Elapsed**: The time interval between the start of the operation and the end.</span></span>
* <span data-ttu-id="f3327-162">**Cuándo**: muestra el momento en que se ejecutó la función o el evento con relación a otras funciones.</span><span class="sxs-lookup"><span data-stu-id="f3327-162">**When**: Shows when the function/event was running in relation to other functions.</span></span>

## <a name="how-to-read-performance-data"></a><span data-ttu-id="f3327-163">Cómo leer datos de rendimiento</span><span class="sxs-lookup"><span data-stu-id="f3327-163">How to read performance data</span></span>

<span data-ttu-id="f3327-164">El generador de perfiles de servicios Microsoft usa una combinación de método de muestreo e instrumentación para analizar el rendimiento de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f3327-164">Microsoft service profiler uses a combination of sampling method and instrumentation to analyze the performance of your application.</span></span>
<span data-ttu-id="f3327-165">Cuando la colección detallada está en curso, el generador de perfiles del servicio muestrea el puntero de instrucción de las CPU de cada una de las máquinas en cada milisegundo.</span><span class="sxs-lookup"><span data-stu-id="f3327-165">When detailed collection is in progress, service profiler samples the instruction pointer of each of the machine's CPU in every millisecond.</span></span>
<span data-ttu-id="f3327-166">Cada muestra captura la pila de llamadas completa del subproceso en ejecución, lo que proporciona información detallada y útil sobre lo que subproceso realizaba en los niveles de abstracción tanto altos como bajos.</span><span class="sxs-lookup"><span data-stu-id="f3327-166">Each sample captures the complete call stack of the thread currently executing, giving detailed and useful information about what that thread was doing at both high and low levels of abstraction.</span></span> <span data-ttu-id="f3327-167">El generador de perfiles del servicio también recopila otros eventos como, por ejemplo, eventos de cambio de contexto, eventos de y eventos de grupo de subprocesos para realizar el seguimiento de la causalidad y la correlación de actividades.</span><span class="sxs-lookup"><span data-stu-id="f3327-167">Service profiler also collects other events such as context switching events, TPL events, and thread-pool events to track activity correlation and causality.</span></span>

<span data-ttu-id="f3327-168">La pila de llamadas que se muestra en la vista de escala de tiempo es el resultado del muestreo y la instrumentación anteriores.</span><span class="sxs-lookup"><span data-stu-id="f3327-168">The call stack shown in the timeline view is the result of the above sampling and instrumentation.</span></span> <span data-ttu-id="f3327-169">Dado que cada muestra captura toda la pila de llamadas del subproceso, incluye código de .NET Framework, así como de otras plataformas a las que se haga referencia.</span><span class="sxs-lookup"><span data-stu-id="f3327-169">Because each sample captures the complete call stack of the thread, it includes code from the .NET framework, as well as other frameworks you reference.</span></span>

### <span data-ttu-id="f3327-170"><a id="jitnewobj"></a>Asignación de objetos (`clr!JIT\_New or clr!JIT\_Newarr1`)</span><span class="sxs-lookup"><span data-stu-id="f3327-170"><a id="jitnewobj"></a>Object Allocation (`clr!JIT\_New or clr!JIT\_Newarr1`)</span></span>
<span data-ttu-id="f3327-171">`clr!JIT\_New and clr!JIT\_Newarr1` son funciones auxiliares dentro de .NET Framework que asignan memoria del montón administrado.</span><span class="sxs-lookup"><span data-stu-id="f3327-171">`clr!JIT\_New and clr!JIT\_Newarr1` are helper functions inside .NET framework that allocates memory from managed heap.</span></span> <span data-ttu-id="f3327-172">`clr!JIT\_New` se invoca cuando se asigna un objeto.</span><span class="sxs-lookup"><span data-stu-id="f3327-172">`clr!JIT\_New` is invoked when an object is allocated.</span></span> <span data-ttu-id="f3327-173">`clr!JIT\_Newarr1` se invoca cuando se asigna una matriz de objetos.</span><span class="sxs-lookup"><span data-stu-id="f3327-173">`clr!JIT\_Newarr1` is invoked when an object array is allocated.</span></span> <span data-ttu-id="f3327-174">Estas dos funciones suelen ser muy rápidas y deben tardar una cantidad relativamente pequeña de tiempo.</span><span class="sxs-lookup"><span data-stu-id="f3327-174">These two functions are typically very fast and should take relatively small amount of time.</span></span> <span data-ttu-id="f3327-175">Si ve que `clr!JIT\_New` o `clr!JIT\_Newarr1` tardan una cantidad sustancial de tiempo en la escala de tiempo, es una indicación de que tal vez el código esté asignando muchos objetos y consuma una cantidad significativa de memoria.</span><span class="sxs-lookup"><span data-stu-id="f3327-175">If you see `clr!JIT\_New` or `clr!JIT\_Newarr1` take a substantial amount of time in your timeline, it's an indication that the code may be allocating many objects and consuming significant amount of memory.</span></span>

### <span data-ttu-id="f3327-176"><a id="theprestub"></a>Carga de código (`clr!ThePreStub`)</span><span class="sxs-lookup"><span data-stu-id="f3327-176"><a id="theprestub"></a>Loading Code (`clr!ThePreStub`)</span></span>
<span data-ttu-id="f3327-177">`clr!ThePreStub` es una función auxiliar dentro de .NET Framework que prepara el código para ejecutarlo por primera vez.</span><span class="sxs-lookup"><span data-stu-id="f3327-177">`clr!ThePreStub` is a helper function inside .NET framework that prepares the code to execute for the first time.</span></span> <span data-ttu-id="f3327-178">Suele incluir, pero sin limitarse a ello, compilación JIT (Just-In-Time).</span><span class="sxs-lookup"><span data-stu-id="f3327-178">This typically includes, but not limited to, JIT (Just In Time) compilation.</span></span> <span data-ttu-id="f3327-179">Para cada método de C#, `clr!ThePreStub` debe invocarse como máximo una vez durante todo el proceso.</span><span class="sxs-lookup"><span data-stu-id="f3327-179">For each C# method, `clr!ThePreStub` should be invoked at most once during the lifetime of a process.</span></span>

<span data-ttu-id="f3327-180">Si ve que `clr!ThePreStub` tarda una cantidad considerable de tiempo en una solicitud, indica que la solicitud es la primera que ejecuta ese método y el tiempo que tarda el motor en tiempo de ejecución de .NET Framework en cargar ese método es significativo.</span><span class="sxs-lookup"><span data-stu-id="f3327-180">If you see `clr!ThePreStub` takes significant amount of time for a request, it indicates that request is the first one that executes that method, and the time for .NET framework runtime to load that method is significant.</span></span> <span data-ttu-id="f3327-181">Puede plantearse un proceso de preparación que ejecute esa parte del código antes de que los usuarios accedan a él o contemplar la ejecución de NGen en los ensamblados.</span><span class="sxs-lookup"><span data-stu-id="f3327-181">You can consider a warm-up process that executes that portion of the code before your users access it, or consider running NGen on your assemblies.</span></span>

### <span data-ttu-id="f3327-182"><a id="lockcontention"></a>Contención de bloqueo (`clr!JITutil\_MonContention` o `clr!JITutil\_MonEnterWorker`)</span><span class="sxs-lookup"><span data-stu-id="f3327-182"><a id="lockcontention"></a>Lock Contention (`clr!JITutil\_MonContention` or `clr!JITutil\_MonEnterWorker`)</span></span>
<span data-ttu-id="f3327-183">`clr!JITutil\_MonContention` o `clr!JITutil\_MonEnterWorker` indican que el subproceso actual espera a que se libere un bloqueo.</span><span class="sxs-lookup"><span data-stu-id="f3327-183">`clr!JITutil\_MonContention` or `clr!JITutil\_MonEnterWorker` indicate the current thread is waiting for a lock to be released.</span></span> <span data-ttu-id="f3327-184">Suele presentarse cuando se ejecuta una instrucción de bloqueo de C#, se invoca el método Monitor.Enter o se invoca un método con el atributo MethodImplOptions.Synchronized.</span><span class="sxs-lookup"><span data-stu-id="f3327-184">This typically shows up when executing a C# lock statement, invoking Monitor.Enter method, or invoking a method with MethodImplOptions.Synchronized attribute.</span></span> <span data-ttu-id="f3327-185">La contención de bloqueo se produce normalmente cuando un subproceso A adquiere un bloqueo y un subproceso B intenta adquirir el mismo bloqueo antes de que el subproceso A lo libere.</span><span class="sxs-lookup"><span data-stu-id="f3327-185">Lock contention typically happens when thread A acquires a lock, and thread B tries to acquire the same lock before thread A releases it.</span></span>

### <span data-ttu-id="f3327-186"><a id="ngencold"></a>Carga de código (`[COLD]`)</span><span class="sxs-lookup"><span data-stu-id="f3327-186"><a id="ngencold"></a>Loading code (`[COLD]`)</span></span>
<span data-ttu-id="f3327-187">Si el nombre del método contiene `[COLD]`, como `mscorlib.ni![COLD]System.Reflection.CustomAttribute.IsDefined`, significa que el tiempo de ejecución de .NET Framework ejecuta código que no se ha optimizado mediante <a href="https://msdn.microsoft.com/library/e7k32f4k.aspx">optimización guiada por perfiles</a> por primera vez.</span><span class="sxs-lookup"><span data-stu-id="f3327-187">If the method name contains `[COLD]`, such as `mscorlib.ni![COLD]System.Reflection.CustomAttribute.IsDefined`, it means that the .NET framework runtime is executing code that is not optimized by <a href="https://msdn.microsoft.com/library/e7k32f4k.aspx">profile-guided optimization</a> for the first time.</span></span> <span data-ttu-id="f3327-188">Para cada método, debe presentarse como máximo una vez durante todo el proceso.</span><span class="sxs-lookup"><span data-stu-id="f3327-188">For each method, it should show up at most once during the lifetime of the process.</span></span>

<span data-ttu-id="f3327-189">Si la carga de código tarda una cantidad de tiempo considerable en una solicitud, indica que la solicitud es la primera que ejecuta la parte no optimizada del método.</span><span class="sxs-lookup"><span data-stu-id="f3327-189">If loading code takes significant amount of time for a request, it indicates that request is the first one to execute the unoptimized portion of the method.</span></span> <span data-ttu-id="f3327-190">Puede plantearse un proceso de preparación que ejecute esa parte del código antes de que los usuarios accedan e él.</span><span class="sxs-lookup"><span data-stu-id="f3327-190">You can consider a warm up process that executes that portion of the code before your users access it.</span></span>

### <span data-ttu-id="f3327-191"><a id="httpclientsend"></a>Envío de solicitud HTTP</span><span class="sxs-lookup"><span data-stu-id="f3327-191"><a id="httpclientsend"></a>Send HTTP Request</span></span>
<span data-ttu-id="f3327-192">Métodos como `HttpClient.Send` indican que el código espera a que se complete una solicitud HTTP.</span><span class="sxs-lookup"><span data-stu-id="f3327-192">Methods such as `HttpClient.Send` indicate the code is waiting for a HTTP request to complete.</span></span>

### <span data-ttu-id="f3327-193"><a id="sqlcommand"></a>Operación de base de datos</span><span class="sxs-lookup"><span data-stu-id="f3327-193"><a id="sqlcommand"></a>Database Operation</span></span>
<span data-ttu-id="f3327-194">Un método como SqlCommand.Execute indica que el código espera a que se complete una operación de base de datos.</span><span class="sxs-lookup"><span data-stu-id="f3327-194">Method such as SqlCommand.Execute indicates the code is waiting for a database operation to complete.</span></span>

### <span data-ttu-id="f3327-195"><a id="await"></a>En espera (`AWAIT\_TIME`)</span><span class="sxs-lookup"><span data-stu-id="f3327-195"><a id="await"></a>Waiting (`AWAIT\_TIME`)</span></span>
<span data-ttu-id="f3327-196">`AWAIT\_TIME` indica que el código espera a que se complete otra tarea.</span><span class="sxs-lookup"><span data-stu-id="f3327-196">`AWAIT\_TIME` indicates the code is waiting for another task to complete.</span></span> <span data-ttu-id="f3327-197">Suele producirse con la instrucción "await"de C#.</span><span class="sxs-lookup"><span data-stu-id="f3327-197">This typically happens with C# 'await' statement.</span></span> <span data-ttu-id="f3327-198">Cuando el código efectúa una instrucción "await" de C#, el subproceso se desenreda y devuelve el control al grupo de subprocesos, y no hay ningún subproceso bloqueado en espera de que finalice la "await".</span><span class="sxs-lookup"><span data-stu-id="f3327-198">When the code does a C# 'await', the thread unwinds and returns control to the thread-pool, and there is no thread that is blocked waiting for the 'await' to finish.</span></span> <span data-ttu-id="f3327-199">Pero, lógicamente, el subproceso que realizó la "await" se "bloquea" en espera de que se complete la operación.</span><span class="sxs-lookup"><span data-stu-id="f3327-199">However, logically the thread that did the await is 'blocked' waiting for the operation to complete.</span></span> <span data-ttu-id="f3327-200">`AWAIT\_TIME` indica el tiempo de bloqueo en espera a que se complete la tarea.</span><span class="sxs-lookup"><span data-stu-id="f3327-200">The `AWAIT\_TIME` indicates the blocked time waiting for the task to complete.</span></span>

### <span data-ttu-id="f3327-201"><a id="block"></a>Tiempo de bloqueo</span><span class="sxs-lookup"><span data-stu-id="f3327-201"><a id="block"></a>Blocked Time</span></span>
<span data-ttu-id="f3327-202">`BLOCKED_TIME` indica que el código espera a que esté disponible otro recurso, como cuando se espera por un objeto de sincronización, se espera a que esté disponible un subproceso o se espera a que finalice una solicitud.</span><span class="sxs-lookup"><span data-stu-id="f3327-202">`BLOCKED_TIME` indicates the code is waiting for another resource to be available, such as waiting for a synchronization object, waiting for a thread to be available, or waiting for a request to finish.</span></span>

### <span data-ttu-id="f3327-203"><a id="cpu"></a>Tiempo de CPU</span><span class="sxs-lookup"><span data-stu-id="f3327-203"><a id="cpu"></a>CPU Time</span></span>
<span data-ttu-id="f3327-204">La CPU está ocupada ejecutando las instrucciones.</span><span class="sxs-lookup"><span data-stu-id="f3327-204">The CPU is busy executing the instructions.</span></span>

### <span data-ttu-id="f3327-205"><a id="disk"></a>Tiempo de disco</span><span class="sxs-lookup"><span data-stu-id="f3327-205"><a id="disk"></a>Disk Time</span></span>
<span data-ttu-id="f3327-206">La aplicación está ejecutando operaciones de disco.</span><span class="sxs-lookup"><span data-stu-id="f3327-206">The application is performing disk operations.</span></span>

### <span data-ttu-id="f3327-207"><a id="network"></a>Tiempo de red</span><span class="sxs-lookup"><span data-stu-id="f3327-207"><a id="network"></a>Network Time</span></span>
<span data-ttu-id="f3327-208">La aplicación está ejecutando operaciones de red.</span><span class="sxs-lookup"><span data-stu-id="f3327-208">The application is performing network operations.</span></span>

### <span data-ttu-id="f3327-209"><a id="when"></a>Columna Cuándo</span><span class="sxs-lookup"><span data-stu-id="f3327-209"><a id="when"></a>When column</span></span>
<span data-ttu-id="f3327-210">Se trata de una visualización de cómo varían con el tiempo las muestras inclusivas recopiladas para un nodo varían.</span><span class="sxs-lookup"><span data-stu-id="f3327-210">This is a visualization of how the INCLUSIVE samples collected for a node vary over time.</span></span> <span data-ttu-id="f3327-211">El intervalo total de la solicitud se divide en 32 ciclos y las muestras inclusivas para ese nodo se acumulan en los 32 depósitos respectivos.</span><span class="sxs-lookup"><span data-stu-id="f3327-211">The total range of the request is divided into 32 time buckets and the inclusive samples for that node are accumulated into those 32 buckets.</span></span> <span data-ttu-id="f3327-212">Cada depósito se representa luego como una barra cuyo alto representa un valor escalado.</span><span class="sxs-lookup"><span data-stu-id="f3327-212">Each bucket is then represented as a bar whose height represents a scaled value.</span></span> <span data-ttu-id="f3327-213">En el caso de nodos marcados `CPU_TIME` o `BLOCKED_TIME`, o cuando existe una relación obvia de consumo de un recurso (cpu, disco, subproceso), la barra representa el consumo de uno de esos recursos durante el tiempo de ese ciclo.</span><span class="sxs-lookup"><span data-stu-id="f3327-213">For nodes marked `CPU_TIME` or `BLOCKED_TIME`, or where there is an obvious relationship of consuming a resource (cpu, disk, thread), the bar represents consuming one of those resources for the period of time of that bucket.</span></span> <span data-ttu-id="f3327-214">Con estas métricas puede conseguir más del 100 % si consume varios recursos.</span><span class="sxs-lookup"><span data-stu-id="f3327-214">For these metrics you can get greater than 100% by consuming multiple resources.</span></span> <span data-ttu-id="f3327-215">Por ejemplo, si por término medio usa dos CPU a lo largo de un intervalo, consigue el 200 %.</span><span class="sxs-lookup"><span data-stu-id="f3327-215">For example, if on average you use two CPUs over an interval then you get 200%.</span></span>


## <span data-ttu-id="f3327-216"><a id="troubleshooting"></a>Solución de problemas</span><span class="sxs-lookup"><span data-stu-id="f3327-216"><a id="troubleshooting"></a>Troubleshooting</span></span>

### <a name="how-can-i-know-whether-application-insights-profiler-is-running"></a><span data-ttu-id="f3327-217">¿Cómo se puede saber si Application Insights Profiler se está ejecutando?</span><span class="sxs-lookup"><span data-stu-id="f3327-217">How can I know whether Application Insights profiler is running?</span></span>

<span data-ttu-id="f3327-218">El generador de perfiles se ejecuta como un trabajo web continuo de Aplicación web.</span><span class="sxs-lookup"><span data-stu-id="f3327-218">The profiler runs as a continuous web job in Web App.</span></span> <span data-ttu-id="f3327-219">Puede abrir el recurso Aplicación web en https://portal.azure.com y comprobar el estado de "ApplicationInsightsProfiler" en la hoja Trabajos Web.</span><span class="sxs-lookup"><span data-stu-id="f3327-219">You can open the Web App resource in https://portal.azure.com and check "ApplicationInsightsProfiler" status in the WebJobs blade.</span></span> <span data-ttu-id="f3327-220">Si se está ejecutando, abra **Registros** para saber más.</span><span class="sxs-lookup"><span data-stu-id="f3327-220">If it isn't running, open **Logs** to find out more.</span></span>

### <a name="why-cant-i-find-any-stack-examples-even-though-the-profiler-is-running"></a><span data-ttu-id="f3327-221">¿Por qué no encuentro ningún ejemplo de pila aunque el generador de perfiles se esté ejecutando?</span><span class="sxs-lookup"><span data-stu-id="f3327-221">Why can't I find any stack examples even though the profiler is running?</span></span>

<span data-ttu-id="f3327-222">Aquí tiene algunas cosas que puede comprobar.</span><span class="sxs-lookup"><span data-stu-id="f3327-222">Here are a few things you can check.</span></span>

1. <span data-ttu-id="f3327-223">Asegúrese de que el plan de App Service web es de nivel Básico o superior.</span><span class="sxs-lookup"><span data-stu-id="f3327-223">Make sure your Web App Service Plan is Basic tier and above.</span></span>
2. <span data-ttu-id="f3327-224">Asegúrese de que la Aplicación web tiene habilitado el SDK 2.2 Beta y superior de Application Insights.</span><span class="sxs-lookup"><span data-stu-id="f3327-224">Make sure your Web App has Application Insights SDK 2.2 Beta and above enabled.</span></span>
3. <span data-ttu-id="f3327-225">Asegúrese de que la Aplicación web tiene el ajuste de configuración APPINSIGHTS_INSTRUMENTATIONKEY con la misma clave de instrumentación que usa el SDK de Application Insights.</span><span class="sxs-lookup"><span data-stu-id="f3327-225">Make sure your Web App has the APPINSIGHTS_INSTRUMENTATIONKEY setting with the same instrumentation key used by Application Insights SDK.</span></span>
4. <span data-ttu-id="f3327-226">Asegúrese de que la Aplicación web se ejecuta en .Net Framework 4.6.</span><span class="sxs-lookup"><span data-stu-id="f3327-226">Make sure your Web App is running on .Net Framework 4.6.</span></span>
5. <span data-ttu-id="f3327-227">Si se trata de una aplicación ASP.NET Core, compruebe también las [dependencias requeridas](#aspnetcore).</span><span class="sxs-lookup"><span data-stu-id="f3327-227">If it's an ASP.NET Core application, please also check [the required dependencies](#aspnetcore).</span></span>

<span data-ttu-id="f3327-228">Una vez iniciado el generador de perfiles, hay un breve proceso de preparación cuando el generador de perfiles recopila activamente varios seguimientos de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="f3327-228">After the profiler is started, there is a short warm-up period when the profiler actively collects several performance traces.</span></span> <span data-ttu-id="f3327-229">Después, el generador de perfiles recopila seguimientos de rendimiento durante dos minutos cada hora.</span><span class="sxs-lookup"><span data-stu-id="f3327-229">After that, the profiler collects performance traces for two minutes in every hour.</span></span>  

### <a name="i-was-using-azure-service-profiler-what-happened-to-it"></a><span data-ttu-id="f3327-230">Yo usaba Azure Service Profiler.</span><span class="sxs-lookup"><span data-stu-id="f3327-230">I was using Azure Service Profiler.</span></span> <span data-ttu-id="f3327-231">¿Qué ha ocurrido?</span><span class="sxs-lookup"><span data-stu-id="f3327-231">What happened to it?</span></span>  

<span data-ttu-id="f3327-232">Cuando se habilita Application Insights Profiler, se deshabilita el agente Azure Service Profiler.</span><span class="sxs-lookup"><span data-stu-id="f3327-232">When you enable Application Insights Profiler, Azure Service Profiler agent is disabled.</span></span>

### <span data-ttu-id="f3327-233"><a id="double-counting"></a>Doble recuento de subprocesos paralelos</span><span class="sxs-lookup"><span data-stu-id="f3327-233"><a id="double-counting"></a>Double counting in parallel threads</span></span>

<span data-ttu-id="f3327-234">En algunos casos, la métrica de tiempo total del visor de la pila es mayor que la duración real de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="f3327-234">In some cases the total time metric in the stack viewer is more than the actual duration of the request.</span></span>

<span data-ttu-id="f3327-235">Esto puede suceder cuando hay dos o más subprocesos que funcionan en paralelo asociados a una solicitud.</span><span class="sxs-lookup"><span data-stu-id="f3327-235">This can happen when there are two or more threads associated with a request, operating in parallel.</span></span> <span data-ttu-id="f3327-236">El tiempo total de los subprocesos es entonces mayor que el tiempo transcurrido.</span><span class="sxs-lookup"><span data-stu-id="f3327-236">The total thread time is then more than the elapsed time.</span></span> <span data-ttu-id="f3327-237">En muchos casos, es posible que uno de los subprocesos espere a que el otro se complete.</span><span class="sxs-lookup"><span data-stu-id="f3327-237">In many cases one thread may be waiting on the other to complete.</span></span> <span data-ttu-id="f3327-238">El visor intenta detectar esto y omite la espera carente de interés, pero es preferible mostrar demasiado que omitir lo que pudiera ser información crítica.</span><span class="sxs-lookup"><span data-stu-id="f3327-238">The viewer tries to detect this and omit the uninteresting wait, but errs on the side of showing too much rather than omitting what may be critical information.</span></span>  

<span data-ttu-id="f3327-239">Cuando vea subprocesos en paralelo en su seguimientos, tendrá que determinar cuáles son los subprocesos que esperan para poder establecer la ruta crítica de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="f3327-239">When you see parallel threads in your traces, you need to determine which threads are waiting so you can determine the critical path for the request.</span></span> <span data-ttu-id="f3327-240">En la mayoría de los casos, el subproceso que pasa rápidamente a un estado de espera tan solo espera a los demás subprocesos.</span><span class="sxs-lookup"><span data-stu-id="f3327-240">In most cases, the thread that quickly goes into a wait state is simply waiting on the other threads.</span></span> <span data-ttu-id="f3327-241">Concéntrese en los demás e ignore el tiempo de los subprocesos en espera.</span><span class="sxs-lookup"><span data-stu-id="f3327-241">Concentrate on the others and ignore the time in the waiting threads.</span></span>

### <span data-ttu-id="f3327-242"><a id="issue-loading-trace-in-viewer"></a>No hay datos de generación de perfiles</span><span class="sxs-lookup"><span data-stu-id="f3327-242"><a id="issue-loading-trace-in-viewer"></a>No profiling data</span></span>

1. <span data-ttu-id="f3327-243">Si la antigüedad de los datos que intenta ver supera el par de semanas, procure limitar el filtro de tiempo y inténtelo de nuevo.</span><span class="sxs-lookup"><span data-stu-id="f3327-243">If the data you are trying to view is older than a couple of weeks, try limiting your time filter and try again.</span></span>

2. <span data-ttu-id="f3327-244">Compruebe que no haya servidores proxy ni un firewall que bloqueen el acceso a https://gateway.azureserviceprofiler.net.</span><span class="sxs-lookup"><span data-stu-id="f3327-244">Check that proxies or a firewall have not blocked access to https://gateway.azureserviceprofiler.net.</span></span>

3. <span data-ttu-id="f3327-245">Compruebe que la clave de instrumentación de Application Insights que usa en las aplicaciones sea la misma del recurso de Application Insights con el que ha habilitado la generación de perfiles.</span><span class="sxs-lookup"><span data-stu-id="f3327-245">Check that the Application Insights instrumentation key you are using in your app is the same as the Application Insights resource you've enabled profiling with.</span></span> <span data-ttu-id="f3327-246">La clave suele estar en ApplicationInsights.config pero también puede encontrarse en web.config o app.config.</span><span class="sxs-lookup"><span data-stu-id="f3327-246">The key is usually in ApplicationInsights.config but can also be found in web.config or app.config.</span></span>

### <a name="error-report-in-the-profiling-viewer"></a><span data-ttu-id="f3327-247">Informe de errores del visor de generación de perfiles</span><span class="sxs-lookup"><span data-stu-id="f3327-247">Error report in the profiling viewer</span></span>

<span data-ttu-id="f3327-248">Abra una incidencia de soporte técnico desde el portal.</span><span class="sxs-lookup"><span data-stu-id="f3327-248">File a support ticket from the portal.</span></span> <span data-ttu-id="f3327-249">Incluya el identificador de correlación del mensaje de errores.</span><span class="sxs-lookup"><span data-stu-id="f3327-249">Please include the correlation ID from the error message.</span></span>

## <a name="manual-installation"></a><span data-ttu-id="f3327-250">Instalación manual</span><span class="sxs-lookup"><span data-stu-id="f3327-250">Manual installation</span></span>

<span data-ttu-id="f3327-251">Cuando se configura el generador de perfiles, se realizan las siguientes actualizaciones a la configuración de la Aplicación web.</span><span class="sxs-lookup"><span data-stu-id="f3327-251">When you configure the profiler, the following updates are made to the Web App's settings.</span></span> <span data-ttu-id="f3327-252">Puede hacerlo manualmente si el entorno lo requiere; por ejemplo, si la aplicación se ejecuta en una instancia de Azure App Service Environment (ASE):</span><span class="sxs-lookup"><span data-stu-id="f3327-252">You can do them yourself manually if your environment requires, for example, if your application runs in Azure App Service Environment (ASE):</span></span>

1. <span data-ttu-id="f3327-253">En la hoja de control de la aplicación web, abra Configuración.</span><span class="sxs-lookup"><span data-stu-id="f3327-253">In the web app control blade, open Settings.</span></span>
2. <span data-ttu-id="f3327-254">Establezca "Versión de .Net Framework" en v4.6.</span><span class="sxs-lookup"><span data-stu-id="f3327-254">Set ".Net Framework version" to v4.6.</span></span>
3. <span data-ttu-id="f3327-255">Establezca "Siempre activado" en activado.</span><span class="sxs-lookup"><span data-stu-id="f3327-255">Set "Always On" to On.</span></span>
4. <span data-ttu-id="f3327-256">Agregue el ajuste de configuración de la aplicación "__APPINSIGHTS_INSTRUMENTATIONKEY__" y establezca el valor en la misma clave de instrumentación que el SDK.</span><span class="sxs-lookup"><span data-stu-id="f3327-256">Add app setting "__APPINSIGHTS_INSTRUMENTATIONKEY__" and set the value to the same instrumentation key used by the SDK.</span></span>
5. <span data-ttu-id="f3327-257">Abra Herramientas avanzadas.</span><span class="sxs-lookup"><span data-stu-id="f3327-257">Open Advanced Tools.</span></span>
6. <span data-ttu-id="f3327-258">Haga clic en "Ir" para abrir el sitio Web de Kudu.</span><span class="sxs-lookup"><span data-stu-id="f3327-258">Click "Go" to open the Kudu website.</span></span>
7. <span data-ttu-id="f3327-259">En el sitio Web de Kudu, seleccione "Site extensions" (Extensiones de sitio).</span><span class="sxs-lookup"><span data-stu-id="f3327-259">In the Kudu website, select "Site extensions".</span></span>
8. <span data-ttu-id="f3327-260">Instale "__Application Insights__" desde la galería.</span><span class="sxs-lookup"><span data-stu-id="f3327-260">Install "__Application Insights__" from Gallery.</span></span>
9. <span data-ttu-id="f3327-261">Reinicie la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="f3327-261">Restart the web app.</span></span>

## <span data-ttu-id="f3327-262"><a id="aspnetcore"></a>Compatibilidad con ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="f3327-262"><a id="aspnetcore"></a>ASP.NET Core Support</span></span>

<span data-ttu-id="f3327-263">La aplicación ASP.NET Core necesita instalar el paquete de Nuget Microsoft.ApplicationInsights.AspNetCore 2.1.0-beta6 o posterior para trabajar con el generador de perfiles.</span><span class="sxs-lookup"><span data-stu-id="f3327-263">ASP.NET Core application needs to install Microsoft.ApplicationInsights.AspNetCore Nuget package 2.1.0-beta6 or higher to work with the Profiler.</span></span> <span data-ttu-id="f3327-264">Ya no se admiten las versiones anteriores después de 6/27/2017.</span><span class="sxs-lookup"><span data-stu-id="f3327-264">We no longer support the lower versions after 6/27/2017.</span></span>

## <a name="next-steps"></a><span data-ttu-id="f3327-265">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="f3327-265">Next steps</span></span>

* [<span data-ttu-id="f3327-266">Trabajo con Application Insights en Visual Studio</span><span class="sxs-lookup"><span data-stu-id="f3327-266">Working with Application Insights in Visual Studio</span></span>](https://docs.microsoft.com/azure/application-insights/app-insights-visual-studio)

[performance-blade]: ./media/app-insights-profiler/performance-blade.png
[performance-blade-examples]: ./media/app-insights-profiler/performance-blade-examples.png
[trace-explorer]: ./media/app-insights-profiler/trace-explorer.png
[trace-explorer-toolbar]: ./media/app-insights-profiler/trace-explorer-toolbar.png
[trace-explorer-hint-tip]: ./media/app-insights-profiler/trace-explorer-hint-tip.png
[trace-explorer-hot-path]: ./media/app-insights-profiler/trace-explorer-hot-path.png
[enable-profiler-banner]: ./media/app-insights-profiler/enable-profiler-banner.png
[disable-profiler-webjob]: ./media/app-insights-profiler/disable-profiler-webjob.png
[linked app services]: ./media/app-insights-profiler/linked-app-services.png

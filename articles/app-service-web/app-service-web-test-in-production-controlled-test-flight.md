---
title: "Implementación de la distribución de paquetes piloto (pruebas beta) en el Servicio de aplicaciones de Azure"
description: "Aprenda a distribuir paquetes piloto de nuevas características en las aplicaciones o a probar la versión beta de sus actualizaciones en este tutorial integral. Reúne las características del Servicio de aplicaciones como publicación continua, ranuras, enrutamiento de tráfico y la integración de Application Insights."
services: app-service\web
documentationcenter: 
author: cephalin
manager: erikre
editor: 
ms.assetid: 17953c51-38f8-442d-bb0b-f69c1542f0e9
ms.service: app-service-web
ms.workload: web
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/02/2016
ms.author: cephalin
ms.openlocfilehash: 83e3247310461ac148fff3c4ade3aa7216478537
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="flighting-deployment-beta-testing-in-azure-app-service"></a><span data-ttu-id="c70f0-104">Implementación de la distribución de paquetes piloto (pruebas beta) en el Servicio de aplicaciones de Azure</span><span class="sxs-lookup"><span data-stu-id="c70f0-104">Flighting deployment (beta testing) in Azure App Service</span></span>
<span data-ttu-id="c70f0-105">Este tutorial muestra cómo hacer *implementaciones de distribución de paquetes piloto* mediante la integración de las distintas capacidades de [Azure App Service](http://go.microsoft.com/fwlink/?LinkId=529714) y [Azure Application Insights](/services/application-insights/).</span><span class="sxs-lookup"><span data-stu-id="c70f0-105">This tutorial shows you how to do *flighting deployments* by integrating the various capabilities of [Azure App Service](http://go.microsoft.com/fwlink/?LinkId=529714) and [Azure Application Insights](/services/application-insights/).</span></span>

<span data-ttu-id="c70f0-106">*La distribución de paquetes piloto* es un proceso de implementación que valida una nueva característica o cambio con un número limitado de clientes reales, y es una prueba importante en el escenario de producción.</span><span class="sxs-lookup"><span data-stu-id="c70f0-106">*Flighting* is a deployment process that validates a new feature or change with a limited number of real customers, and is a major testing in production scenario.</span></span> <span data-ttu-id="c70f0-107">Es similar a las pruebas beta y a veces se conoce como "vuelo de prueba controlado".</span><span class="sxs-lookup"><span data-stu-id="c70f0-107">It is akin to beta testing and is sometimes known as "controlled test flight".</span></span> <span data-ttu-id="c70f0-108">Muchas grandes empresas con una presencia web usan este enfoque para obtener validación temprana en las actualizaciones de sus aplicaciones dentro de su prácticas de [desarrollo ágil](https://en.wikipedia.org/wiki/Agile_software_development).</span><span class="sxs-lookup"><span data-stu-id="c70f0-108">Many large enterprises with a web presence use this approach to get early validation on their app updates in their practice of [agile development](https://en.wikipedia.org/wiki/Agile_software_development).</span></span> <span data-ttu-id="c70f0-109">El Servicio de aplicaciones de Azure le permite integrar la prueba en producción con publicación continua y con Application Insight para implementar el mismo escenario de DevOps.</span><span class="sxs-lookup"><span data-stu-id="c70f0-109">Azure App Service enables you to integrate test in production with continous publishing and Application Insights to implement the same DevOps scenario.</span></span> <span data-ttu-id="c70f0-110">Las ventajas de este enfoque incluyen:</span><span class="sxs-lookup"><span data-stu-id="c70f0-110">Benefits of this approach include:</span></span>

* <span data-ttu-id="c70f0-111">**Obtención de información real a partir de comentarios *antes* de que se publiquen las actualizaciones en el entorno de producción** (si hay algo mejor que recibir comentarios tan pronto como la versión se publique, es recibir comentarios antes de publicar).</span><span class="sxs-lookup"><span data-stu-id="c70f0-111">**Gain real feedback *before* updates are released to production** - The only thing better than gaining feedback as soon as you release is gaining feedback before you release.</span></span> <span data-ttu-id="c70f0-112">Puede probar las actualizaciones con tráfico y comportamientos reales de los usuarios tan pronto como desee dentro el ciclo de vida del producto.</span><span class="sxs-lookup"><span data-stu-id="c70f0-112">You can test updates with real user traffic and behaviors as early as you desire in the product life cycle.</span></span>
* <span data-ttu-id="c70f0-113">**Mejora [del desarrollo continuo controlado por pruebas (CTDD)](https://en.wikipedia.org/wiki/Continuous_test-driven_development)** a través de la integración de pruebas en la producción, con integración continua e instrumentación con Application Insights, la validación de usuario se produce al principio y de forma automática dentro del ciclo de vida del producto.</span><span class="sxs-lookup"><span data-stu-id="c70f0-113">**Enhance [continuous test-driven development (CTDD)](https://en.wikipedia.org/wiki/Continuous_test-driven_development)** - By integrating test in production with continuous integration and instrumentation with Application Insights, user validation happens early and automatically in your product life cycle.</span></span> <span data-ttu-id="c70f0-114">Esto ayuda a reducir las inversiones de tiempo de ejecución de pruebas manuales.</span><span class="sxs-lookup"><span data-stu-id="c70f0-114">This helps reduce time investments in manual test execution.</span></span>
* <span data-ttu-id="c70f0-115">**Optimización del flujo de trabajo de prueba**: Mediante la automatización de la prueba en producción con instrumentación de supervisión continua, puede lograr en un único proceso los objetivos de distintos tipos de pruebas, como [integración](https://en.wikipedia.org/wiki/Integration_testing), [regresión](https://en.wikipedia.org/wiki/Regression_testing), [facilidad de uso](https://en.wikipedia.org/wiki/Usability_testing), accesibilidad, localización, [rendimiento](https://en.wikipedia.org/wiki/Software_performance_testing), [seguridad](https://en.wikipedia.org/wiki/Security_testing) y [aceptación](https://en.wikipedia.org/wiki/Acceptance_testing).</span><span class="sxs-lookup"><span data-stu-id="c70f0-115">**Optimize test workflow** - By automating test in production with continuous monitoring instrumentation, you can potentially accomplish the goals of various kinds of tests in a single process, such as [integration](https://en.wikipedia.org/wiki/Integration_testing), [regression](https://en.wikipedia.org/wiki/Regression_testing), [usability](https://en.wikipedia.org/wiki/Usability_testing), accessibility, localization, [performance](https://en.wikipedia.org/wiki/Software_performance_testing), [security](https://en.wikipedia.org/wiki/Security_testing), and [acceptance](https://en.wikipedia.org/wiki/Acceptance_testing).</span></span>

<span data-ttu-id="c70f0-116">En una implementación de distribución de paquetes piloto, no se trata solamente del enrutamiento de tráfico real.</span><span class="sxs-lookup"><span data-stu-id="c70f0-116">A flighting deployment is not just about routing live traffic.</span></span> <span data-ttu-id="c70f0-117">En este tipo de implementación lo que se pretende es tener una percepción y conocimientos sobre la misma lo antes posible, tanto si se trata de un error inesperado como de la degradación del rendimiento o de problemas de experiencia de usuario.</span><span class="sxs-lookup"><span data-stu-id="c70f0-117">In such a deployment you want to gain insight as quickly as possible, whether it be an unexpected bug, performance degradation, user experience issues.</span></span> <span data-ttu-id="c70f0-118">Recuerde que se trata de los clientes reales.</span><span class="sxs-lookup"><span data-stu-id="c70f0-118">Remember, you are dealing with real customers.</span></span> <span data-ttu-id="c70f0-119">Así que para hacerlo bien, tiene que asegurarse de que ha configurado la implementación de distribución de paquetes piloto de forma que pueda recopilar todos los datos que necesita para tomar una decisión informada en el paso siguiente.</span><span class="sxs-lookup"><span data-stu-id="c70f0-119">So to do it right, you must make sure that you have set up your flighting deployment to gather all the data you need in order to make an informed decision for your next step.</span></span> <span data-ttu-id="c70f0-120">Este tutorial muestra cómo recopilar datos con Application Insights, pero puede usar New Relic u otra tecnología que se adapte a su situación.</span><span class="sxs-lookup"><span data-stu-id="c70f0-120">This tutorial shows you how to collect data with Application Insights, but you can use New Relic or other technologies that suits your scenario.</span></span>

## <a name="what-you-will-do"></a><span data-ttu-id="c70f0-121">Lo que hará</span><span class="sxs-lookup"><span data-stu-id="c70f0-121">What you will do</span></span>
<span data-ttu-id="c70f0-122">En este tutorial, obtendrá información sobre cómo reunir los escenarios siguientes para probar su aplicación de Servicio de la aplicaciones en producción:</span><span class="sxs-lookup"><span data-stu-id="c70f0-122">In this tutorial, you will learn how to bring the following scenarios together to test your App Service app in production:</span></span>

* <span data-ttu-id="c70f0-123">[Enrutar el tráfico de producción](app-service-web-test-in-production-get-start.md) a la aplicación beta</span><span class="sxs-lookup"><span data-stu-id="c70f0-123">[Route production traffic](app-service-web-test-in-production-get-start.md) to your beta app</span></span>
* <span data-ttu-id="c70f0-124">[Instrumentar la aplicación](../application-insights/app-insights-web-track-usage.md) para obtener métricas útiles</span><span class="sxs-lookup"><span data-stu-id="c70f0-124">[Instrument your app](../application-insights/app-insights-web-track-usage.md) to obtain useful metrics</span></span>
* <span data-ttu-id="c70f0-125">Implementar la aplicación beta y realizar un seguimiento de las métricas de aplicación de forma continua</span><span class="sxs-lookup"><span data-stu-id="c70f0-125">Continuously deploy your beta app and track live app metrics</span></span>
* <span data-ttu-id="c70f0-126">Comparar las métricas entre la aplicación de producción y la aplicación beta para ver de qué forma los cambios de código se traducen en resultados</span><span class="sxs-lookup"><span data-stu-id="c70f0-126">Compare metrics between the production app and the beta app to see how code changes translate to results</span></span>

## <a name="what-you-will-need"></a><span data-ttu-id="c70f0-127">Qué necesita</span><span class="sxs-lookup"><span data-stu-id="c70f0-127">What you will need</span></span>
* <span data-ttu-id="c70f0-128">Una cuenta de Azure</span><span class="sxs-lookup"><span data-stu-id="c70f0-128">An Azure account</span></span>
* <span data-ttu-id="c70f0-129">Una cuenta [GitHub](https://github.com/)</span><span class="sxs-lookup"><span data-stu-id="c70f0-129">A [GitHub](https://github.com/) account</span></span>
* <span data-ttu-id="c70f0-130">Visual Studio de 2015, puede descargar la [edición Community](https://www.visualstudio.com/en-us/products/visual-studio-express-vs.aspx).</span><span class="sxs-lookup"><span data-stu-id="c70f0-130">Visual Studio 2015 - you can download the [Community edition](https://www.visualstudio.com/en-us/products/visual-studio-express-vs.aspx).</span></span>
* <span data-ttu-id="c70f0-131">Shell de Git (instalado con [GitHub para Windows](https://windows.github.com/)): esto le permite ejecutar comandos de PowerShell y Git en la misma sesión</span><span class="sxs-lookup"><span data-stu-id="c70f0-131">Git Shell (installed with [GitHub for Windows](https://windows.github.com/)) - this enables you to run both the Git and PowerShell commands in the same session</span></span>
* <span data-ttu-id="c70f0-132">Bits más recientes de [Azure PowerShell](https://github.com/Azure/azure-powershell/releases/download/v0.9.8-September2015/azure-powershell.0.9.8.msi)</span><span class="sxs-lookup"><span data-stu-id="c70f0-132">Latest [Azure PowerShell](https://github.com/Azure/azure-powershell/releases/download/v0.9.8-September2015/azure-powershell.0.9.8.msi) bits</span></span>
* <span data-ttu-id="c70f0-133">Conocimientos básicos de lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="c70f0-133">Basic understanding of the following:</span></span>
  * <span data-ttu-id="c70f0-134">Implementación de plantillas de [Azure Resource Manager](../azure-resource-manager/resource-group-overview.md) (consulte [Aprovisionamiento e implementación predecibles de microservicios en Azure](app-service-deploy-complex-application-predictably.md))</span><span class="sxs-lookup"><span data-stu-id="c70f0-134">[Azure Resource Manager](../azure-resource-manager/resource-group-overview.md) template deployment (see [Deploy a complex application predictably in Azure](app-service-deploy-complex-application-predictably.md))</span></span>
  * [<span data-ttu-id="c70f0-135">Git</span><span class="sxs-lookup"><span data-stu-id="c70f0-135">Git</span></span>](http://git-scm.com/documentation)
  * [<span data-ttu-id="c70f0-136">PowerShell</span><span class="sxs-lookup"><span data-stu-id="c70f0-136">PowerShell</span></span>](https://technet.microsoft.com/library/bb978526.aspx)

> [!NOTE]
> <span data-ttu-id="c70f0-137">Para completar este tutorial, deberá tener una cuenta de Azure:</span><span class="sxs-lookup"><span data-stu-id="c70f0-137">You need an Azure account to complete this tutorial:</span></span>
>
> * <span data-ttu-id="c70f0-138">Puede [abrir una cuenta de Azure de manera gratuita](https://azure.microsoft.com/pricing/free-trial/) : obtiene crédito que puede usar para probar los servicios de Azure de pago, e incluso una vez agotado este podrá mantener la cuenta y usar servicios gratuitos de Azure, tales como Aplicaciones web.</span><span class="sxs-lookup"><span data-stu-id="c70f0-138">You can [open an Azure account for free](https://azure.microsoft.com/pricing/free-trial/) - You get credits you can use to try out paid Azure services, and even after they're used up you can keep the account and use free Azure services, such as Web Apps.</span></span>
> * <span data-ttu-id="c70f0-139">Puede [activar las ventajas de suscriptor de Visual Studio](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) : su suscripción a Visual Studio le proporciona crédito todos los meses que puede usar con servicios de Azure de pago.</span><span class="sxs-lookup"><span data-stu-id="c70f0-139">You can [activate Visual Studio subscriber benefits](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) - Your Visual Studio subscription gives you credits every month that you can use for paid Azure services.</span></span>
>
> <span data-ttu-id="c70f0-140">Si desea empezar a trabajar con el Servicio de aplicaciones de Azure antes de inscribirse para abrir una cuenta de Azure, vaya a [Prueba del Servicio de aplicaciones](https://azure.microsoft.com/try/app-service/), donde podrá crear inmediatamente una aplicación web de inicio de corta duración en el Servicio de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="c70f0-140">If you want to get started with Azure App Service before signing up for an Azure account, go to [Try App Service](https://azure.microsoft.com/try/app-service/), where you can immediately create a short-lived starter web app in App Service.</span></span> <span data-ttu-id="c70f0-141">No es necesario proporcionar ninguna tarjeta de crédito ni asumir ningún compromiso.</span><span class="sxs-lookup"><span data-stu-id="c70f0-141">No credit cards required; no commitments.</span></span>
>
>

## <a name="set-up-your-production-web-app"></a><span data-ttu-id="c70f0-142">Configuración de la aplicación web de producción</span><span class="sxs-lookup"><span data-stu-id="c70f0-142">Set up your production web app</span></span>
> [!NOTE]
> <span data-ttu-id="c70f0-143">El script que se emplea en este tutorial configurará automáticamente la publicación continua desde el repositorio de GitHub.</span><span class="sxs-lookup"><span data-stu-id="c70f0-143">The script used in this tutorial will automatically configure continuous publishing from your GitHub repository.</span></span> <span data-ttu-id="c70f0-144">Esto requiere que las credenciales de GitHub ya estén almacenadas en Azure; en caso contrario, no se realizará la implementación con script al intentar definir la configuración del control de código fuente para las aplicaciones web.</span><span class="sxs-lookup"><span data-stu-id="c70f0-144">This requires that your GitHub credentials are already stored in Azure, otherwise the scripted deployment will fail when attempting to configure source control settings for the web apps.</span></span>
>
> <span data-ttu-id="c70f0-145">Para almacenar sus credenciales de GitHub en Azure, cree una aplicación web en [Azure Portal](https://portal.azure.com/) y [configure la implementación de GitHub](app-service-continuous-deployment.md).</span><span class="sxs-lookup"><span data-stu-id="c70f0-145">To store your GitHub credentials in Azure, create a web app in the [Azure Portal](https://portal.azure.com/) and [configure GitHub deployment](app-service-continuous-deployment.md).</span></span> <span data-ttu-id="c70f0-146">Solo tiene que hacer esto una vez.</span><span class="sxs-lookup"><span data-stu-id="c70f0-146">You only need to do this once.</span></span>
>
>

<span data-ttu-id="c70f0-147">En un escenario típico de DevOps, tiene una aplicación que se ejecuta directamente en Azure y quiere realizar cambios en ella mediante publicación continua.</span><span class="sxs-lookup"><span data-stu-id="c70f0-147">In a typical DevOps scenario, you have an application that’s running live in Azure, and you want to make changes to it through continuous publishing.</span></span> <span data-ttu-id="c70f0-148">En este escenario, se implementará en producción una plantilla que haya desarrollado y probado.</span><span class="sxs-lookup"><span data-stu-id="c70f0-148">In this scenario, you will deploy to production a template that you have developed and tested.</span></span>

1. <span data-ttu-id="c70f0-149">Cree su propia bifurcación del repositorio [ToDoApp](https://github.com/azure-appservice-samples/ToDoApp) .</span><span class="sxs-lookup"><span data-stu-id="c70f0-149">Create your own fork of the [ToDoApp](https://github.com/azure-appservice-samples/ToDoApp) repository.</span></span> <span data-ttu-id="c70f0-150">Para obtener información sobre la creación de la bifurcación, consulte [Bifurcación de un repositorio](https://help.github.com/articles/fork-a-repo/).</span><span class="sxs-lookup"><span data-stu-id="c70f0-150">For information on creating your fork, see [Fork a Repo](https://help.github.com/articles/fork-a-repo/).</span></span> <span data-ttu-id="c70f0-151">Una vez creada la bifurcación, puede verla en el explorador.</span><span class="sxs-lookup"><span data-stu-id="c70f0-151">Once your fork is created, you can see it in your browser.</span></span>

   ![](./media/app-service-agile-software-development/production-1-private-repo.png)
2. <span data-ttu-id="c70f0-152">Abra una sesión del Shell de Git.</span><span class="sxs-lookup"><span data-stu-id="c70f0-152">Open a Git Shell session.</span></span> <span data-ttu-id="c70f0-153">Si aún no tiene el Shell de Git, instale ahora [GitHub para Windows](https://windows.github.com/) .</span><span class="sxs-lookup"><span data-stu-id="c70f0-153">If you don't have Git Shell yet, install [GitHub for Windows](https://windows.github.com/) now.</span></span>
3. <span data-ttu-id="c70f0-154">Cree un clon local de la bifurcación ejecutando el comando siguiente:</span><span class="sxs-lookup"><span data-stu-id="c70f0-154">Create a local clone of your fork by executing the following command:</span></span>

     <span data-ttu-id="c70f0-155">git clone https://github.com/<su_bifurcación>/ToDoApp.git</span><span class="sxs-lookup"><span data-stu-id="c70f0-155">git clone https://github.com/<your_fork>/ToDoApp.git</span></span>
4. <span data-ttu-id="c70f0-156">Cuando tenga el clon local, vaya a *&lt;raíz_repositorio>*\ARMTemplates y ejecute el script deploy.ps1 con un sufijo único, como se muestra a continuación:</span><span class="sxs-lookup"><span data-stu-id="c70f0-156">Once you have your local clone, navigate to *&lt;repository_root>*\ARMTemplates, and run the deploy.ps1 script with a unique suffix, as shown below:</span></span>

     <span data-ttu-id="c70f0-157">.\deploy.ps1 –RepoUrl https://github.com/<your_fork>/todoapp.git -ResourceGroupSuffix <your_suffix></span><span class="sxs-lookup"><span data-stu-id="c70f0-157">.\deploy.ps1 –RepoUrl https://github.com/<your_fork>/todoapp.git -ResourceGroupSuffix <your_suffix></span></span>
5. <span data-ttu-id="c70f0-158">Cuando se le solicite, escriba el nombre de usuario y la contraseña que quiera para el acceso a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c70f0-158">When prompted, type in the desired username and password for database access.</span></span> <span data-ttu-id="c70f0-159">Recuerde las credenciales de la base de datos porque tendrá que especificarlas al actualizar el grupo de recursos.</span><span class="sxs-lookup"><span data-stu-id="c70f0-159">Remember your database credentials because you will need to specify them again when updating the resource group.</span></span>

   <span data-ttu-id="c70f0-160">Debería ver el progreso de aprovisionamiento de varios recursos de Azure.</span><span class="sxs-lookup"><span data-stu-id="c70f0-160">You should see the provisioning progress of various Azure resources.</span></span> <span data-ttu-id="c70f0-161">Cuando finalice la implementación, el script iniciará la aplicación en el explorador y emitirá un bip.</span><span class="sxs-lookup"><span data-stu-id="c70f0-161">When deployment completes, the script will launch the application in the browser and give you a friendly beep.</span></span>
   ![](./media/app-service-web-test-in-production-controlled-test-flight/00.1-app-in-browser.png)
6. <span data-ttu-id="c70f0-162">De nuevo en la sesión del Shell de Git, ejecute:</span><span class="sxs-lookup"><span data-stu-id="c70f0-162">Back in your Git Shell session, run:</span></span>

     <span data-ttu-id="c70f0-163">.\swap –Name ToDoApp<su_sufijo></span><span class="sxs-lookup"><span data-stu-id="c70f0-163">.\swap –Name ToDoApp<your_suffix></span></span>

   ![](./media/app-service-web-test-in-production-controlled-test-flight/00.2-swap-to-production.png)
7. <span data-ttu-id="c70f0-164">Cuando finalice el script, vuelva a examinar la dirección del front-end (http://ToDoApp*&lt;su_sufijo>*.azurewebsites.net/) para ver la ejecución de la aplicación en producción.</span><span class="sxs-lookup"><span data-stu-id="c70f0-164">When the script finishes, go back to browse to the frontend’s address (http://ToDoApp*&lt;your_suffix>*.azurewebsites.net/) to see the application running in production.</span></span>
8. <span data-ttu-id="c70f0-165">Inicie sesión en el [Portal de Azure](https://portal.azure.com/) y observe lo que se crea.</span><span class="sxs-lookup"><span data-stu-id="c70f0-165">Log into the [Azure Portal](https://portal.azure.com/) and take a look at what’s created.</span></span>

   <span data-ttu-id="c70f0-166">Podrá ver dos aplicaciones web en el mismo grupo de recursos, una con el sufijo `Api` en el nombre.</span><span class="sxs-lookup"><span data-stu-id="c70f0-166">You should be able to see two web apps in the same resource group, one with the `Api` suffix in the name.</span></span> <span data-ttu-id="c70f0-167">Si observa la vista de grupo de recursos, también verá el servidor y Base de datos SQL, el plan de Servicio de aplicaciones y las ranuras de ensayo para las aplicaciones web.</span><span class="sxs-lookup"><span data-stu-id="c70f0-167">If you look at the resource group view, you will also see the SQL Database and server, the App Service plan, and the staging slots for the web apps.</span></span> <span data-ttu-id="c70f0-168">Examine los distintos recursos y compárelos con *&lt;ráiz_repositorio>*\ARMTemplates\ProdAndStage.json para ver cómo están configurados en la plantilla.</span><span class="sxs-lookup"><span data-stu-id="c70f0-168">Browse through the different resources and compare them with *&lt;repository_root>*\ARMTemplates\ProdAndStage.json to see how they are configured in the template.</span></span>

   ![](./media/app-service-web-test-in-production-controlled-test-flight/00.3-resource-group-view.png)

<span data-ttu-id="c70f0-169">Ha configurado la aplicación de producción.</span><span class="sxs-lookup"><span data-stu-id="c70f0-169">You have set up the production app.</span></span>  <span data-ttu-id="c70f0-170">Ahora, imaginemos que recibe comentarios informándole de que la facilidad de uso de la aplicación es insuficiente.</span><span class="sxs-lookup"><span data-stu-id="c70f0-170">Now, let's imagine that you receive feedback that usability is poor for the app.</span></span> <span data-ttu-id="c70f0-171">Por lo que decide investigar.</span><span class="sxs-lookup"><span data-stu-id="c70f0-171">So you decide to investigate.</span></span> <span data-ttu-id="c70f0-172">Va a instrumentar la aplicación para que le proporcione información.</span><span class="sxs-lookup"><span data-stu-id="c70f0-172">You're going to instrument your app to give you feedback.</span></span>

## <a name="investigate-instrument-your-client-app-for-monitoringmetrics"></a><span data-ttu-id="c70f0-173">Investigación: instrumentar la aplicación de cliente para supervisión y métricas</span><span class="sxs-lookup"><span data-stu-id="c70f0-173">Investigate: Instrument your client app for monitoring/metrics</span></span>
1. <span data-ttu-id="c70f0-174">Abra *&lt;raíz_repositorio>*\src\MultiChannelToDo.sln en Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="c70f0-174">Open *&lt;repository_root>*\src\MultiChannelToDo.sln in Visual Studio.</span></span>
2. <span data-ttu-id="c70f0-175">Restaure todos los paquetes de Nuget haciendo clic con el botón derecho en la solución > **Administrar paquetes de NuGet para la solución** > **Restaurar**.</span><span class="sxs-lookup"><span data-stu-id="c70f0-175">Restore all Nuget packages by right-clicking solution > **Manage NuGet Packages for Solution** > **Restore**.</span></span>
3. <span data-ttu-id="c70f0-176">Haga clic con el botón derecho en **MultiChannelToDo.Web** > **Agregar Telemetría de Application Insights** > **Definir la configuración** > Cambie el grupo de recursos a ToDoApp*&lt;su_sufijo>* > **Agregar Application Insights al proyecto**.</span><span class="sxs-lookup"><span data-stu-id="c70f0-176">Right-click **MultiChannelToDo.Web** > **Add Application Insights Telemetry** > **Configure Settings** > Change resource group to ToDoApp*&lt;your_suffix>* > **Add Application Insights to Project**.</span></span>
4. <span data-ttu-id="c70f0-177">En el Portal de Azure, abra la hoja para el recurso de Application Insight **MultiChannelToDo.Web** .</span><span class="sxs-lookup"><span data-stu-id="c70f0-177">In the Azure Portal, open the blade for the **MultiChannelToDo.Web** Application Insight resource.</span></span> <span data-ttu-id="c70f0-178">A continuación, en la parte de **Estado de la aplicación**, haga clic en **Obtenga información sobre cómo recopilar datos de carga de página del explorador** > Copiar código.</span><span class="sxs-lookup"><span data-stu-id="c70f0-178">Then in the **Application health** part, click **Learn how to collect browser page load data** > copy code.</span></span>
5. <span data-ttu-id="c70f0-179">Agregue el código de instrumentación JS copiado a *&lt;raíz_repsitorio>*\src\MultiChannelToDo.Web\app\Index.cshtml, justo antes de la etiqueta `<heading>` de cierre.</span><span class="sxs-lookup"><span data-stu-id="c70f0-179">Add the copied JS instrumentation code to *&lt;repository_root>*\src\MultiChannelToDo.Web\app\Index.cshtml, just before the closing `<heading>` tag.</span></span> <span data-ttu-id="c70f0-180">Debe contener la clave de instrumentación única del recurso de Application Insight.</span><span class="sxs-lookup"><span data-stu-id="c70f0-180">It should contain the unique instrumentation key of your Application Insight resource.</span></span>

        <script type="text/javascript">
        var appInsights=window.appInsights||function(config){
            function s(config){t[config]=function(){var i=arguments;t.queue.push(function(){t[config].apply(t,i)})}}var t={config:config},r=document,f=window,e="script",o=r.createElement(e),i,u;for(o.src=config.url||"//az416426.vo.msecnd.net/scripts/a/ai.0.js",r.getElementsByTagName(e)[0].parentNode.appendChild(o),t.cookie=r.cookie,t.queue=[],i=["Event","Exception","Metric","PageView","Trace"];i.length;)s("track"+i.pop());return config.disableExceptionTracking||(i="onerror",s("_"+i),u=f[i],f[i]=function(config,r,f,e,o){var s=u&&u(config,r,f,e,o);return s!==!0&&t["_"+i](config,r,f,e,o),s}),t
        }({
            instrumentationKey:"<your_unique_instrumentation_key>"
        });

        window.appInsights=appInsights;
        appInsights.trackPageView();
        </script>
6. <span data-ttu-id="c70f0-181">Envíe eventos personalizados a Application Insights para los clics del mouse agregando el código siguiente a la parte inferior del cuerpo:</span><span class="sxs-lookup"><span data-stu-id="c70f0-181">Send custom events to Application Insights for mouse clicks by adding the following code to the bottom of body:</span></span>

       <script>
           $(document.body).find("*").click(function(event) {

               appInsights.trackEvent(event.target.tagName + ": " + event.target.className);
           });
       </script>

   <span data-ttu-id="c70f0-182">Este fragmento de código de JavaScript envía un evento personalizado a Application Insights cada vez que un usuario hace clic en cualquier parte de la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="c70f0-182">This JavaScript snippet sends a custom event to Application Insights every time a user clicks anywhere in the web app.</span></span>
7. <span data-ttu-id="c70f0-183">En el Shell de Git, confirme e inserte los cambios en la bifurcación en GitHub.</span><span class="sxs-lookup"><span data-stu-id="c70f0-183">In Git Shell, commit and push your changes to your fork in GitHub.</span></span> <span data-ttu-id="c70f0-184">A continuación, espere a que los clientes actualicen el explorador.</span><span class="sxs-lookup"><span data-stu-id="c70f0-184">Then, wait for clients to refresh browser.</span></span>

       git add -A :/
       git commit -m "add AI configuration for client app"
       git push origin master
8. <span data-ttu-id="c70f0-185">Cambie los cambios de la aplicación implementados a producción:</span><span class="sxs-lookup"><span data-stu-id="c70f0-185">Swap the deployed app changes to production:</span></span>

     <span data-ttu-id="c70f0-186">.\swap –Name ToDoApp<su_sufijo></span><span class="sxs-lookup"><span data-stu-id="c70f0-186">.\swap –Name ToDoApp<your_suffix></span></span>
9. <span data-ttu-id="c70f0-187">Busque el recurso de Application Insights que configuró.</span><span class="sxs-lookup"><span data-stu-id="c70f0-187">Browse to the Application Insights resource that you configured.</span></span> <span data-ttu-id="c70f0-188">Haga clic en Eventos personalizados</span><span class="sxs-lookup"><span data-stu-id="c70f0-188">Click Custom events.</span></span>

   ![](./media/app-service-web-test-in-production-controlled-test-flight/01-custom-events.png)

   <span data-ttu-id="c70f0-189">Si no ve las métricas para los eventos personalizados, espere unos minutos y haga clic en **Actualizar**.</span><span class="sxs-lookup"><span data-stu-id="c70f0-189">If you don't see metrics for custom events, wait a few minutes and click **Refresh**.</span></span>

<span data-ttu-id="c70f0-190">Supongamos que ve un gráfico como el siguiente:</span><span class="sxs-lookup"><span data-stu-id="c70f0-190">Suppose you see a chart like below:</span></span>

![](./media/app-service-web-test-in-production-controlled-test-flight/02-custom-events-chart-view.png)

<span data-ttu-id="c70f0-191">Y la cuadrícula de eventos debajo de él:</span><span class="sxs-lookup"><span data-stu-id="c70f0-191">And the event grid below it:</span></span>

![](./media/app-service-web-test-in-production-controlled-test-flight/03-custom-event-grid-view.png)

<span data-ttu-id="c70f0-192">Según el código de aplicación ToDoApp, el evento **BUTTON** se corresponde con el botón Enviar y el evento **INPUT** se corresponde con el cuadro de texto.</span><span class="sxs-lookup"><span data-stu-id="c70f0-192">According to your ToDoApp application code, the **BUTTON** event corresponds to the submit button, and the **INPUT** event corresponds to the textbox.</span></span> <span data-ttu-id="c70f0-193">Hasta aquí, todo está claro.</span><span class="sxs-lookup"><span data-stu-id="c70f0-193">So far, things make sense.</span></span> <span data-ttu-id="c70f0-194">Sin embargo, parece que hay bastantes clics y muy pocos clics en los elementos de tareas pendientes (el evento **LI** ).</span><span class="sxs-lookup"><span data-stu-id="c70f0-194">However, it looks like there's a good amount of clicks and very few clicks on the to-do items (the **LI** events).</span></span>

<span data-ttu-id="c70f0-195">Según esto, puede formular la hipótesis de que algunos usuarios no tienen claro en qué parte de la interfaz de usuario se puede hacer clic, y es porque el cursor se ha adaptado para la selección de texto cuando se mantiene el mouse sobre los elementos de lista y sus iconos.</span><span class="sxs-lookup"><span data-stu-id="c70f0-195">Based on this, you form your hypothesis that some users are confused which part of the UI is clickable and it is because the cursor is styled for text selection when it hovers on the list items and their icons.</span></span>

![](./media/app-service-web-test-in-production-controlled-test-flight/04-to-do-list-item-ui.png)

<span data-ttu-id="c70f0-196">Este podría ser un ejemplo inventado.</span><span class="sxs-lookup"><span data-stu-id="c70f0-196">This might be a contrived example.</span></span> <span data-ttu-id="c70f0-197">De cualquier forma, realice una mejora en la aplicación y, a continuación, implemente una distribución de paquetes piloto para obtener comentarios sobre la facilidad de uso por parte de los clientes.</span><span class="sxs-lookup"><span data-stu-id="c70f0-197">Nevertheless, you're going to make an improvement to your app, and then perform a flighting deployment to get usability feedback from live customers.</span></span>

### <a name="instrument-your-server-app-for-monitoringmetrics"></a><span data-ttu-id="c70f0-198">Instrumentación de la aplicación del servidor para supervisión y métricas</span><span class="sxs-lookup"><span data-stu-id="c70f0-198">Instrument your server app for monitoring/metrics</span></span>
<span data-ttu-id="c70f0-199">Este es un tema tangencial, porque el escenario con el que se trabaja en este tutorial solo concierne a la aplicación cliente.</span><span class="sxs-lookup"><span data-stu-id="c70f0-199">This is a tangent since the scenario demonstrated in this tutorial only deals with the client app.</span></span> <span data-ttu-id="c70f0-200">De todas formas, para tener una visión completa se configurará también la aplicación del lado del servidor.</span><span class="sxs-lookup"><span data-stu-id="c70f0-200">However, for completeness you will set up the server-side app.</span></span>

1. <span data-ttu-id="c70f0-201">Haga clic con el botón derecho en **MultiChannelToDo** > **Agregar Telemetría de Application Insights** > **Definir la configuración** > Cambie el grupo de recursos a ToDoApp*&lt;su_sufijo>* > **Agregar Application Insights al proyecto**.</span><span class="sxs-lookup"><span data-stu-id="c70f0-201">Right-click **MultiChannelToDo** > **Add Application Insights Telemetry** > **Configure Settings** > Change resource group to ToDoApp*&lt;your_suffix>* > **Add Application Insights to Project**.</span></span>
2. <span data-ttu-id="c70f0-202">En el Shell de Git, confirme e inserte los cambios en la bifurcación en GitHub.</span><span class="sxs-lookup"><span data-stu-id="c70f0-202">In Git Shell, commit and push your changes to your fork in GitHub.</span></span> <span data-ttu-id="c70f0-203">A continuación, espere a que los clientes actualicen el explorador.</span><span class="sxs-lookup"><span data-stu-id="c70f0-203">Then, wait for clients to refresh browser.</span></span>

       git add -A :/
       git commit -m "add AI configuration for server app"
       git push origin master
3. <span data-ttu-id="c70f0-204">Cambie los cambios de la aplicación implementados a producción:</span><span class="sxs-lookup"><span data-stu-id="c70f0-204">Swap the deployed app changes to production:</span></span>

     <span data-ttu-id="c70f0-205">.\swap –Name ToDoApp<su_sufijo></span><span class="sxs-lookup"><span data-stu-id="c70f0-205">.\swap –Name ToDoApp<your_suffix></span></span>

<span data-ttu-id="c70f0-206">Eso es todo.</span><span class="sxs-lookup"><span data-stu-id="c70f0-206">That's it!</span></span>

## <a name="investigate-add-slot-specific-tags-to-your-client-app-metrics"></a><span data-ttu-id="c70f0-207">Investigación: agregar etiquetas específicas de ranura a las métricas de la aplicación de cliente</span><span class="sxs-lookup"><span data-stu-id="c70f0-207">Investigate: Add slot-specific tags to your client app metrics</span></span>
<span data-ttu-id="c70f0-208">En esta sección, configurará las diferentes ranuras de implementación para enviar telemetría específica de cada ranura al mismo recurso de Application Insights.</span><span class="sxs-lookup"><span data-stu-id="c70f0-208">In this section, you will configure the different deployment slots to send slot-specific telemetry to the same Application Insights resource.</span></span> <span data-ttu-id="c70f0-209">De este modo, puede comparar los datos de telemetría entre el tráfico de las diferentes ranuras (entornos de implementación) para ver rápidamente el efecto de los cambios que se realizaron en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c70f0-209">This way, you can compare telemetry data between traffic from different slots (deployment environments) to easily see the effect of your app changes.</span></span> <span data-ttu-id="c70f0-210">Al mismo tiempo, puede separar el tráfico de producción del resto para poder continuar supervisando la aplicación de producción, según sea necesario.</span><span class="sxs-lookup"><span data-stu-id="c70f0-210">At the same time, you can separate the production traffic from the rest so you can continue to monitor your production app as needed.</span></span>

<span data-ttu-id="c70f0-211">Como está recopilando datos sobre el comportamiento del cliente, [agregará un inicializador de telemetría al código JavaScript](../application-insights/app-insights-api-filtering-sampling.md) en index.cshtml.</span><span class="sxs-lookup"><span data-stu-id="c70f0-211">Since you're gathering data on client behavior, you will [add a telemetry initializer to your JavaScript code](../application-insights/app-insights-api-filtering-sampling.md) in index.cshtml.</span></span> <span data-ttu-id="c70f0-212">Si desea probar el rendimiento del servidor, por ejemplo, puede hacer algo similar en el código del servidor (consulte [API de Application Insights para eventos y métricas personalizados](../application-insights/app-insights-api-custom-events-metrics.md)).</span><span class="sxs-lookup"><span data-stu-id="c70f0-212">If you want to test server-side performance, for example, you can also do similarly in your server code (see [Application Insights API for custom events and metrics](../application-insights/app-insights-api-custom-events-metrics.md).</span></span>

1. <span data-ttu-id="c70f0-213">En primer lugar, agregue el código entre los dos comentarios `//` a continuación en el código JavaScript que agregó antes a la etiqueta `<heading>`.</span><span class="sxs-lookup"><span data-stu-id="c70f0-213">First, add the code bewteen the two `//` comments below in the JavaScript block that you added to the `<heading>` tag earlier.</span></span>

        window.appInsights = appInsights;

        // Begin new code
        appInsights.queue.push(function () {
            appInsights.context.addTelemetryInitializer(function (envelope) {
                var telemetryItem = envelope.data.baseData;
                telemetryItem.properties = telemetryItem.properties || {};
                telemetryItem.properties["Environment"] = "@System.Configuration.ConfigurationManager.AppSettings["environment"]";
            });
        });
        // End new code

        appInsights.trackPageView();

    <span data-ttu-id="c70f0-214">Este código de inicializador hace que el objeto `appInsights` agregue una propiedad personalizada denominada `Environment` a cada dato de telemetría que envía.</span><span class="sxs-lookup"><span data-stu-id="c70f0-214">This initializer code causes the `appInsights` object to add the a custom property called `Environment` to every piece of telemetry it sends.</span></span>
2. <span data-ttu-id="c70f0-215">A continuación, agregue esta propiedad personalizada como una [configuración de ranura](web-sites-staged-publishing.md#AboutConfiguration) para la aplicación web en Azure.</span><span class="sxs-lookup"><span data-stu-id="c70f0-215">Next, add this custom property as a [slot setting](web-sites-staged-publishing.md#AboutConfiguration) for your web app in Azure.</span></span> <span data-ttu-id="c70f0-216">Para ello, ejecute el siguiente comando en la sesión de Shell de Git:</span><span class="sxs-lookup"><span data-stu-id="c70f0-216">To do this, run the following commands in your Git Shell session.</span></span>

        $app = Get-AzureWebsite -Name todoapp<your_suffix> -Slot production
        $app.AppSettings.Add("environment", "Production")
        $app.SlotStickyAppSettingNames.Add("environment")
        $app | Set-AzureWebsite -Name todoapp<your_suffix> -Slot production

    <span data-ttu-id="c70f0-217">El archivo Web.config del proyecto ya define el valor `environment` de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c70f0-217">The Web.config in your project already defines the `environment` app setting.</span></span> <span data-ttu-id="c70f0-218">Con esta configuración, al probar la aplicación localmente, las métricas se etiquetarán con `VS Debugger`.</span><span class="sxs-lookup"><span data-stu-id="c70f0-218">With this setting, when you test the app locally, your metrics will be tagged with `VS Debugger`.</span></span> <span data-ttu-id="c70f0-219">De todas formas, cuando inserte los cambios en Azure, Azure encontrará y usará el valor de la aplicación `environment` en la configuración de la aplicación web en su lugar, y las métricas se etiquetarán con `Production`.</span><span class="sxs-lookup"><span data-stu-id="c70f0-219">However, when you push your changes to Azure, Azure will find and use the `environment` app setting in the web app's configuration instead, and your metrics will be tagged with `Production`.</span></span>
3. <span data-ttu-id="c70f0-220">Confirme e inserte los cambios de código para la bifurcación en GitHub, y espere a que los usuarios usen la nueva aplicación (es necesario actualizar el explorador).</span><span class="sxs-lookup"><span data-stu-id="c70f0-220">Commit and push your code changes to your fork on GitHub, and then wait for your users to use the new app (need to refresh the browser).</span></span> <span data-ttu-id="c70f0-221">La nueva propiedad tarda unos 15 minutos en aparecer en el recurso `MultiChannelToDo.Web` de Application Insights.</span><span class="sxs-lookup"><span data-stu-id="c70f0-221">It takes about 15 minutes for the new property to show up in your Application Insights `MultiChannelToDo.Web` resource.</span></span>

        git add -A :/
        git commit -m "add environment property to AI events for client app"
        git push origin master
4. <span data-ttu-id="c70f0-222">Ahora, vaya a la hoja **Eventos personalizados** de nuevo y filtre las métricas en `Environment=Production`.</span><span class="sxs-lookup"><span data-stu-id="c70f0-222">Now, go to the **Custom events** blade again and filter the metrics on `Environment=Production`.</span></span> <span data-ttu-id="c70f0-223">Verá todos los nuevos eventos personalizados en la ranura de producción con este filtro.</span><span class="sxs-lookup"><span data-stu-id="c70f0-223">You should now be able to see all the new custom events in the production slot with this filter.</span></span>

    ![](./media/app-service-web-test-in-production-controlled-test-flight/05-filter-on-production-environment.png)
5. <span data-ttu-id="c70f0-224">Haga clic en el botón **Favoritos** para guardar la configuración actual del Explorador de métricas con un nombre del tipo **Eventos personalizados: producción**.</span><span class="sxs-lookup"><span data-stu-id="c70f0-224">Click the **Favorites** button to save the current Metrics Explorer settings to something like **Custom events: Production**.</span></span> <span data-ttu-id="c70f0-225">Más adelante puede cambiar fácilmente entre esta vista y la vista de una ranura de implementación.</span><span class="sxs-lookup"><span data-stu-id="c70f0-225">You can easily switch between this view and a deployment slot view later.</span></span>

   > [!TIP]
   > <span data-ttu-id="c70f0-226">Para realizar análisis aún más eficaces, considere la posibilidad de la [integración de los recursos de Application Insights con Power BI](../application-insights/app-insights-export-power-bi.md).</span><span class="sxs-lookup"><span data-stu-id="c70f0-226">For even more powerful analytics, consider [integrating your Application Insights resource with Power BI](../application-insights/app-insights-export-power-bi.md).</span></span>
   >
   >

### <a name="add-slot-specific-tags-to-your-server-app-metrics"></a><span data-ttu-id="c70f0-227">Incorporación de etiquetas específicas de ranura a las métricas de la aplicación de servidor</span><span class="sxs-lookup"><span data-stu-id="c70f0-227">Add slot-specific tags to your server app metrics</span></span>
<span data-ttu-id="c70f0-228">De nuevo, con el fin de tener una visión completa se configurará también la aplicación del lado del servidor.</span><span class="sxs-lookup"><span data-stu-id="c70f0-228">Again, for completeness you will set up the server-side app.</span></span> <span data-ttu-id="c70f0-229">A diferencia de la aplicación de cliente que se instrumenta en JavaScript, las etiquetas específicas de ranura para la aplicación de servidor se instrumentan con código. NET.</span><span class="sxs-lookup"><span data-stu-id="c70f0-229">Unlike the client app which is instrumented in JavaScript, slot-specific tags for the server app is instrumented with .NET code.</span></span>

1. <span data-ttu-id="c70f0-230">Abra *&lt;raíz_repositorio>*\src\MultiChannelToDo\Global.asax.cs.</span><span class="sxs-lookup"><span data-stu-id="c70f0-230">Open *&lt;repository_root>*\src\MultiChannelToDo\Global.asax.cs.</span></span> <span data-ttu-id="c70f0-231">Agregue el bloque de código siguiente, justo antes de cerrar la llave del espacio de nombres.</span><span class="sxs-lookup"><span data-stu-id="c70f0-231">Add the code block below, just before the closing namespace curly brace.</span></span>

        namespace MultiChannelToDo
        {
                ...

                // Begin new code
            public class ConfigInitializer
            : ITelemetryInitializer
            {
                void ITelemetryInitializer.Initialize(ITelemetry telemetry)
                {
                    telemetry.Context.Properties["Environment"] = System.Configuration.ConfigurationManager.AppSettings["environment"];
                }
            }
                // End new code
        }
2. <span data-ttu-id="c70f0-232">Corrija los errores de resolución de nombres mediante la incorporación al principio del archivo de las instrucciones `using` a continuación:</span><span class="sxs-lookup"><span data-stu-id="c70f0-232">Correct the name resolution errors by adding the `using` statements below to the beginning of the file:</span></span>

        using Microsoft.ApplicationInsights.Channel;
        using Microsoft.ApplicationInsights.Extensibility;
3. <span data-ttu-id="c70f0-233">Agregue el código siguiente al principio del método `Application_Start()` :</span><span class="sxs-lookup"><span data-stu-id="c70f0-233">Add the code below to the beginning of the `Application_Start()` method:</span></span>

        TelemetryConfiguration.Active.TelemetryInitializers.Add(new ConfigInitializer());
4. <span data-ttu-id="c70f0-234">Confirme e inserte los cambios de código para la bifurcación en GitHub, y espere a que los usuarios usen la nueva aplicación (es necesario actualizar el explorador).</span><span class="sxs-lookup"><span data-stu-id="c70f0-234">Commit and push your code changes to your fork on GitHub, and then wait for your users to use the new app (need to refresh the browser).</span></span> <span data-ttu-id="c70f0-235">La nueva propiedad tarda unos 15 minutos en aparecer en el recurso `MultiChannelToDo` de Application Insights.</span><span class="sxs-lookup"><span data-stu-id="c70f0-235">It takes about 15 minutes for the new property to show up in your Application Insights `MultiChannelToDo` resource.</span></span>

        git add -A :/
        git commit -m "add environment property to AI events for server app"
        git push origin master

## <a name="update-set-up-your-beta-branch"></a><span data-ttu-id="c70f0-236">Actualización: configurar la bifurcación de la versión beta</span><span class="sxs-lookup"><span data-stu-id="c70f0-236">Update: Set up your beta branch</span></span>
1. <span data-ttu-id="c70f0-237">Abra *&lt;raíz_repositorio>*\ARMTemplates\ProdAndStagetest.json y encuentre los recursos `appsettings` (busque `"name": "appsettings"`).</span><span class="sxs-lookup"><span data-stu-id="c70f0-237">Open *&lt;repository_root>*\ARMTemplates\ProdAndStagetest.json and find the `appsettings` resources (search for `"name": "appsettings"`).</span></span> <span data-ttu-id="c70f0-238">Hay 4 de ellos, uno para cada ranura.</span><span class="sxs-lookup"><span data-stu-id="c70f0-238">There are 4 of them, one for each slot.</span></span>
2. <span data-ttu-id="c70f0-239">Para cada recurso `appsettings`, agregue un valor de aplicación `"environment": "[parameters('slotName')]"` al final de la matriz `properties`.</span><span class="sxs-lookup"><span data-stu-id="c70f0-239">For each `appsettings` resource, add an  `"environment": "[parameters('slotName')]"` app setting to the end of the `properties` array.</span></span> <span data-ttu-id="c70f0-240">No olvide poner una coma al final de la línea anterior.</span><span class="sxs-lookup"><span data-stu-id="c70f0-240">Don't forget to end the previous line with a comma.</span></span>

    ![](./media/app-service-web-test-in-production-controlled-test-flight/06-arm-app-setting-with-slot-name.png)

    <span data-ttu-id="c70f0-241">Acaba de agregar el valor de aplicación `environment` a todas las ranuras de la plantilla.</span><span class="sxs-lookup"><span data-stu-id="c70f0-241">You have just added the `environment` app setting to all the slots in the template.</span></span>
3. <span data-ttu-id="c70f0-242">En el mismo archivo, busque los recursos `slotconfignames` (buscar `"name": "slotconfignames"`).</span><span class="sxs-lookup"><span data-stu-id="c70f0-242">In the same file, find the `slotconfignames` resources (search for `"name": "slotconfignames"`).</span></span> <span data-ttu-id="c70f0-243">Hay 2 de ellos, uno para cada aplicación.</span><span class="sxs-lookup"><span data-stu-id="c70f0-243">There are 2 of them, one for each app.</span></span>
4. <span data-ttu-id="c70f0-244">Para cada recurso `slotconfignames`, agregue `"environment"` al final de la matriz `appSettingNames`.</span><span class="sxs-lookup"><span data-stu-id="c70f0-244">For each `slotconfignames` resource, add `"environment"` to the end of the `appSettingNames` array.</span></span> <span data-ttu-id="c70f0-245">No olvide poner una coma al final de la línea anterior.</span><span class="sxs-lookup"><span data-stu-id="c70f0-245">Don't forget to end the previous line with a comma.</span></span>

    <span data-ttu-id="c70f0-246">Acaba de hacer que el valor de aplicación `environment` se ajuste a la ranura de implementación correspondiente para ambas aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="c70f0-246">You have just made the `environment` app setting stick to its respective deployment slot for both apps.</span></span>  
5. <span data-ttu-id="c70f0-247">En su sesión del Git Shell, ejecute los comandos siguientes con el mismo sufijo de grupo de recursos que usó antes.</span><span class="sxs-lookup"><span data-stu-id="c70f0-247">In your Git Shell session, run the following commands with the same resource group suffix that you used before.</span></span>

        git checkout -b beta
        git push origin beta
        .\deploy.ps1 -RepoUrl https://github.com/<your_fork>/ToDoApp.git -ResourceGroupSuffix <your_suffix> -SlotName beta -Branch beta
6. <span data-ttu-id="c70f0-248">Cuando se le pida, especifique las mismas credenciales de Base de datos SQL que antes.</span><span class="sxs-lookup"><span data-stu-id="c70f0-248">When prompted, specify the same SQL database credentials as before.</span></span> <span data-ttu-id="c70f0-249">A continuación, cuando se le pida que actualice el grupo de recursos, escriba `Y`, y luego `ENTER`.</span><span class="sxs-lookup"><span data-stu-id="c70f0-249">Then, when asked to update the resource group, type `Y`, then `ENTER`.</span></span>

    <span data-ttu-id="c70f0-250">Una vez que finalice el script, se conservan todos los recursos en el grupo de recursos original, pero se crea en él una nueva ranura llamada "beta" con la misma configuración que la ranura de "Ensayo" que se creó al principio.</span><span class="sxs-lookup"><span data-stu-id="c70f0-250">Once the script finishes, all your resources in the original resource group are retained, but a new slot named "beta" is created in it with the same configuration as the "Staging" slot that was created in the beginning.</span></span>

   > [!NOTE]
   > <span data-ttu-id="c70f0-251">Este método de creación de diferentes entornos de implementación es diferente del método en [Agile Software Development con el Servicio de aplicaciones de Azure](app-service-agile-software-development.md).</span><span class="sxs-lookup"><span data-stu-id="c70f0-251">This method of creating different deployment environments is different from the method in [Agile software development with Azure App Service](app-service-agile-software-development.md).</span></span> <span data-ttu-id="c70f0-252">Aquí puede crear entornos de implementación con las ranuras de implementación, mientras que en el otro caso los entornos de implementación se crean con grupos de recursos.</span><span class="sxs-lookup"><span data-stu-id="c70f0-252">Here, you create deployment environments with deployment slots, where as there you create deployment environments with resource groups.</span></span> <span data-ttu-id="c70f0-253">Administrar entornos de implementación con grupos de recursos le permite mantener el entorno de producción fuera del radio de acción de los desarrolladores, pero no es fácil realizar pruebas en producción, lo que sí es fácil de hacer con las ranuras.</span><span class="sxs-lookup"><span data-stu-id="c70f0-253">Managing deployment environments with resource groups enables you to keep the production environment off-limits to developers, but it's not easy to do testing in production, which you can do easily with slots.</span></span>
   >
   >

<span data-ttu-id="c70f0-254">Si lo desea, también puede crear una aplicación alfa ejecutando</span><span class="sxs-lookup"><span data-stu-id="c70f0-254">If you wish, you can also create an alpha app by running</span></span>

    git checkout -b alpha
    git push origin alpha
    .\deploy.ps1 -RepoUrl https://github.com/<your_fork>/ToDoApp.git -ResourceGroupSuffix <your_suffix> -SlotName beta -Branch alpha

<span data-ttu-id="c70f0-255">Para este tutorial, continúe usando la aplicación beta.</span><span class="sxs-lookup"><span data-stu-id="c70f0-255">For this tutorial, you will just keep using your beta app.</span></span>

## <a name="update-push-your-updates-to-the-beta-app"></a><span data-ttu-id="c70f0-256">Actualización: insertar las actualizaciones en la aplicación beta</span><span class="sxs-lookup"><span data-stu-id="c70f0-256">Update: Push your updates to the beta app</span></span>
<span data-ttu-id="c70f0-257">Volver a la aplicación que desea mejorar.</span><span class="sxs-lookup"><span data-stu-id="c70f0-257">Back to your app that you want to improve.</span></span>

1. <span data-ttu-id="c70f0-258">Asegúrese de que se encuentra ahora en la bifurcación de la versión beta</span><span class="sxs-lookup"><span data-stu-id="c70f0-258">Make sure you're now in your beta branch</span></span>

        git checkout beta
2. <span data-ttu-id="c70f0-259">En *&lt;raíz_repositorio>*\src\MultiChannelToDo.Web\app\Index.cshtml, encuentre la etiqueta `<li>` y agregue el atributo `style="cursor:pointer"`, como se muestra a continuación.</span><span class="sxs-lookup"><span data-stu-id="c70f0-259">In *&lt;repository_root>*\src\MultiChannelToDo.Web\app\Index.cshtml, find the `<li>` tag and add the `style="cursor:pointer"` attribute, as shown below.</span></span>

    ![](./media/app-service-web-test-in-production-controlled-test-flight/07-change-cursor-style-on-li.png)
3. <span data-ttu-id="c70f0-260">confirme e inserte en Azure.</span><span class="sxs-lookup"><span data-stu-id="c70f0-260">commit and push to Azure.</span></span>
4. <span data-ttu-id="c70f0-261">Compruebe que el cambio se refleja en la ranura de la versión beta yendo a http://todoapp*&lt;su_sufijo>*-beta.azurewebsites.net/.</span><span class="sxs-lookup"><span data-stu-id="c70f0-261">Verify that the change is now reflected in the beta slot by navigating to http://todoapp*&lt;your_suffix>*-beta.azurewebsites.net/.</span></span> <span data-ttu-id="c70f0-262">Si aún no ve el cambio, actualice el explorador para obtener el nuevo código de javascript.</span><span class="sxs-lookup"><span data-stu-id="c70f0-262">If you don't see the change yet, refresh your browser to get the new javascript code.</span></span>

    ![](./media/app-service-web-test-in-production-controlled-test-flight/08-verify-change-in-beta-site.png)

<span data-ttu-id="c70f0-263">Ahora que ya tiene el cambio ejecutándose en la ranura de la versión beta, está listo para realizar una implementación de distribución de paquetes piloto.</span><span class="sxs-lookup"><span data-stu-id="c70f0-263">Now that you have your change running in the beta slot, you are ready to perform a flighting deployment.</span></span>

## <a name="validate-route-traffic-to-the-beta-app"></a><span data-ttu-id="c70f0-264">Validación: enrutar el tráfico a la aplicación beta</span><span class="sxs-lookup"><span data-stu-id="c70f0-264">Validate: Route traffic to the beta app</span></span>
<span data-ttu-id="c70f0-265">En esta sección, enrutará el tráfico a la aplicación beta.</span><span class="sxs-lookup"><span data-stu-id="c70f0-265">In this section, you will route traffic to the beta app.</span></span> <span data-ttu-id="c70f0-266">Por motivos de claridad en la demostración, va a enrutar una parte significativa de tráfico de usuario a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c70f0-266">For sake of clarity of demonstration, you're going to route a significant portion of the user traffic to it.</span></span> <span data-ttu-id="c70f0-267">En realidad, la cantidad de tráfico que debe enrutar dependerá de la situación específica.</span><span class="sxs-lookup"><span data-stu-id="c70f0-267">In reality, the amount of traffic you want to route will depend on your specific situation.</span></span> <span data-ttu-id="c70f0-268">Por ejemplo, si su sitio está en la escala de microsoft.com, probablemente necesite menos del uno por ciento del tráfico total para poder obtener datos útiles.</span><span class="sxs-lookup"><span data-stu-id="c70f0-268">For example, if your site is at the scale of microsoft.com, then you may need less than one percent of your total traffic in order to gain useful data.</span></span>

1. <span data-ttu-id="c70f0-269">En su sesión del Git Shell, ejecute los siguientes comandos para enrutar la mitad del tráfico de producción a la ranura de versión beta:</span><span class="sxs-lookup"><span data-stu-id="c70f0-269">In your Git Shell session, run the following commands to route half of the production traffic to the beta slot:</span></span>

        $siteName = "ToDoApp<your suffix>"
        $rule = New-Object Microsoft.WindowsAzure.Commands.Utilities.Websites.Services.WebEntities.RampUpRule
        $rule.ActionHostName = "$siteName-beta.azurewebsites.net"
        $rule.ReroutePercentage = 50
        $rule.Name = "beta"
        Set-AzureWebsite $siteName -Slot Production -RoutingRules $rule

   <span data-ttu-id="c70f0-270">La propiedad `ReroutePercentage=50` especifica que el 50 % del tráfico de producción se enrutará a la URL de la aplicación beta (especificada por la propiedad `ActionHostName`).</span><span class="sxs-lookup"><span data-stu-id="c70f0-270">The `ReroutePercentage=50` property specifies that 50% of the production traffic will be routed to the beta app's URL (specified by the `ActionHostName` property).</span></span>
2. <span data-ttu-id="c70f0-271">Vaya ahora a http://ToDoApp*&lt;su_sufijo>*.azurewebsites.net.</span><span class="sxs-lookup"><span data-stu-id="c70f0-271">Now navigate to http://ToDoApp*&lt;your_suffix>*.azurewebsites.net.</span></span> <span data-ttu-id="c70f0-272">El 50 % del tráfico debería ahora redirigirse a la ranura de la versión beta.</span><span class="sxs-lookup"><span data-stu-id="c70f0-272">50% of the traffic should now be redirected to the beta slot.</span></span>
3. <span data-ttu-id="c70f0-273">En el recurso de Application Insights, filtre las métricas por entorno = "beta".</span><span class="sxs-lookup"><span data-stu-id="c70f0-273">In your Application Insights resource, filter the metrics by environment="beta".</span></span>

   > [!NOTE]
   > <span data-ttu-id="c70f0-274">Si guarda esta vista filtrada como otro favorito, es muy fácil alternar las vistas del explorador de métrica entre las vista de producción y de la versión beta.</span><span class="sxs-lookup"><span data-stu-id="c70f0-274">If you save this filtered view as another favorite, then you can easily flip the metric explorer views between production and beta views.</span></span>
   >
   >

<span data-ttu-id="c70f0-275">Supongamos que en Application Insights ve algo similar a lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="c70f0-275">Suppose in Application Insights you see something similar to the following:</span></span>

![](./media/app-service-web-test-in-production-controlled-test-flight/09-test-beta-site-in-production.png)

<span data-ttu-id="c70f0-276">No solo se muestra que se están haciendo muchos más clics en las etiquetas `<li>`, sino que parece haber un aumento importante de clics en las etiquetas `<li>`.</span><span class="sxs-lookup"><span data-stu-id="c70f0-276">Not only is this showing that there are many more clicks on the `<li>` tags, but there seems to be a surge of clicks on `<li>` tags.</span></span> <span data-ttu-id="c70f0-277">Por tanto se puede concluir que los usuarios han descubierto que se puede hacer clic en las nuevas etiquetas `<li>` y ahora están borrando todas sus tareas completadas previamente en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c70f0-277">You can then conclude that people have discovered the new `<li>` tags are clickable and are now clearing all their previously-completed tasks in the app.</span></span>

<span data-ttu-id="c70f0-278">Según los datos de la implementación de distribución de paquetes piloto, usted decide que la nueva interfaz de usuario está lista para su fase de producción.</span><span class="sxs-lookup"><span data-stu-id="c70f0-278">Based on the data of your flighting deployment, you decide that your new UI is ready for production.</span></span>

## <a name="go-live-move-your-new-code-into-production"></a><span data-ttu-id="c70f0-279">Puesta en marcha: mover el código nuevo a producción</span><span class="sxs-lookup"><span data-stu-id="c70f0-279">Go live: Move your new code into production</span></span>
<span data-ttu-id="c70f0-280">Ahora ya está listo para mover la actualización a producción.</span><span class="sxs-lookup"><span data-stu-id="c70f0-280">You're now ready to move your update to production.</span></span> <span data-ttu-id="c70f0-281">Lo bueno es que ahora sabe que la actualización ya se ha validado *antes* de que se inserte en producción.</span><span class="sxs-lookup"><span data-stu-id="c70f0-281">What's great is that now you know that your update has already been validated *before* it is pushed to production.</span></span> <span data-ttu-id="c70f0-282">Ahora puede implementarlo con confianza.</span><span class="sxs-lookup"><span data-stu-id="c70f0-282">So now you can confidently deploy it.</span></span> <span data-ttu-id="c70f0-283">Puesto que realizó una actualización a la aplicación de cliente AngularJS, solo se valida el código de cliente.</span><span class="sxs-lookup"><span data-stu-id="c70f0-283">Since you made an update to the AngularJS client app, you only validated the client-side code.</span></span> <span data-ttu-id="c70f0-284">Si desea realizar cambios en la aplicación de la API de web de back-end, puede validar los cambios de forma similar y fácilmente.</span><span class="sxs-lookup"><span data-stu-id="c70f0-284">If you were to make changes to the back-end Web API app, you could validate your changes similarly and easily.</span></span>

1. <span data-ttu-id="c70f0-285">En el Shell de Git, ejecute el comando siguiente para quitar la regla de enrutamiento de tráfico:</span><span class="sxs-lookup"><span data-stu-id="c70f0-285">In Git Shell, remove the traffic routing rule by running the following command:</span></span>

        Set-AzureWebsite $siteName -Slot Production -RoutingRules @()
2. <span data-ttu-id="c70f0-286">Ejecute los comandos Git:</span><span class="sxs-lookup"><span data-stu-id="c70f0-286">Run the Git commands:</span></span>

        git checkout master
        git pull origin master
        git merge beta
        git push origin master
3. <span data-ttu-id="c70f0-287">Espere unos minutos para que el nuevo código se implemente en la ranura de ensayo y luego inicie http://ToDoApp*&lt;su_sufijo>*-staging.azurewebsites.net para comprobar que la nueva actualización está preparada en la ranura de ensayo.</span><span class="sxs-lookup"><span data-stu-id="c70f0-287">Wait for a few minutes for the new code to be deployed to the staging slot, then launch http://ToDoApp*&lt;your_suffix>*-staging.azurewebsites.net to verify that the new update is warmed up in the staging slot.</span></span> <span data-ttu-id="c70f0-288">Recuerde que la rama de la bifurcación principal está vinculado a la ranura de ensayo de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c70f0-288">Remember that the your fork's master branch is linked to the staging slot of your app.</span></span>
4. <span data-ttu-id="c70f0-289">Ahora, cambie la ranura de ensayo a producción</span><span class="sxs-lookup"><span data-stu-id="c70f0-289">Now, swap the staging slot into production</span></span>

        cd <ROOT>\ToDoApp\ARMTemplates
        .\swap.ps1 -Name todoapp<your_suffix>

## <a name="summary"></a><span data-ttu-id="c70f0-290">Resumen</span><span class="sxs-lookup"><span data-stu-id="c70f0-290">Summary</span></span>
<span data-ttu-id="c70f0-291">El Servicio de aplicaciones de Azure permite que las pequeñas y medianas empresas prueben con facilidad sus aplicaciones para clientes en producción, algo que tradicionalmente estaba reservado a las grandes empresas.</span><span class="sxs-lookup"><span data-stu-id="c70f0-291">Azure App Service makes it easy for small- to medium-sized businesses to test their customer-facing apps in production, something that has been traditionally done in big enterprises.</span></span> <span data-ttu-id="c70f0-292">Esperamos que este tutorial le haya proporcionado los conocimientos necesarios para reunir el Servicio de aplicaciones y Application Insights y posibilitar la implementación de la distribución de paquetes piloto, e incluso para otros escenarios de prueba en producción en su entorno de DevOps.</span><span class="sxs-lookup"><span data-stu-id="c70f0-292">Hopefully, this tutorial has given you the knowledge you need to bring together App Service and Application Insights to make possible flighting deployment, and even other test-in-production scenarios, in your DevOps world.</span></span>

## <a name="more-resources"></a><span data-ttu-id="c70f0-293">Más recursos</span><span class="sxs-lookup"><span data-stu-id="c70f0-293">More resources</span></span>
* [<span data-ttu-id="c70f0-294">Agile Software Development con el Servicio de aplicaciones de Azure</span><span class="sxs-lookup"><span data-stu-id="c70f0-294">Agile software development with Azure App Service</span></span>](app-service-agile-software-development.md)
* [<span data-ttu-id="c70f0-295">Configuración de entornos de ensayo para aplicaciones web en el Servicio de aplicaciones de Azure</span><span class="sxs-lookup"><span data-stu-id="c70f0-295">Set up staging environments for web apps in Azure App Service</span></span>](web-sites-staged-publishing.md)
* [<span data-ttu-id="c70f0-296">Implementación predecible de una aplicación compleja en Azure</span><span class="sxs-lookup"><span data-stu-id="c70f0-296">Deploy a complex application predictably in Azure</span></span>](app-service-deploy-complex-application-predictably.md)
* [<span data-ttu-id="c70f0-297">Creación de plantillas de Administrador de recursos de Azure</span><span class="sxs-lookup"><span data-stu-id="c70f0-297">Authoring Azure Resource Manager Templates</span></span>](../azure-resource-manager/resource-group-authoring-templates.md)
* [<span data-ttu-id="c70f0-298">JSONLint: validador de JSON</span><span class="sxs-lookup"><span data-stu-id="c70f0-298">JSONLint - The JSON Validator</span></span>](http://jsonlint.com/)
* [<span data-ttu-id="c70f0-299">Creación de ramas de Git: combinación y creación de ramas básicas</span><span class="sxs-lookup"><span data-stu-id="c70f0-299">Git Branching – Basic Branching and Merging</span></span>](http://www.git-scm.com/book/en/v2/Git-Branching-Basic-Branching-and-Merging)
* [<span data-ttu-id="c70f0-300">Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="c70f0-300">Azure PowerShell</span></span>](/powershell/azure/overview)
* [<span data-ttu-id="c70f0-301">Wiki de Project Kudu</span><span class="sxs-lookup"><span data-stu-id="c70f0-301">Project Kudu Wiki</span></span>](https://github.com/projectkudu/kudu/wiki)

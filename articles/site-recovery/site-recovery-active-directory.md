---
title: aaaProtect Active Directory y DNS con Azure Site Recovery | Documentos de Microsoft
description: "Este artículo se describe cómo tooimplement una solución de recuperación ante desastres para Active Directory con Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: prateek9us
manager: gauravd
editor: 
ms.assetid: af1d9b26-1956-46ef-bd05-c545980b72dc
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 7/20/2017
ms.author: pratshar
ms.openlocfilehash: 49903e54f6d6e1839b0571b7a852c6d7517f0aa1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="protect-active-directory-and-dns-with-azure-site-recovery"></a><span data-ttu-id="f868d-103">Protección de Active Directory y DNS con Azure Site Recovery</span><span class="sxs-lookup"><span data-stu-id="f868d-103">Protect Active Directory and DNS with Azure Site Recovery</span></span>
<span data-ttu-id="f868d-104">Las aplicaciones empresariales como SharePoint, Dynamics AX y SAP dependen de Active Directory y un toofunction de infraestructura DNS correctamente.</span><span class="sxs-lookup"><span data-stu-id="f868d-104">Enterprise applications such as SharePoint, Dynamics AX, and SAP depend on Active Directory and a DNS infrastructure toofunction correctly.</span></span> <span data-ttu-id="f868d-105">Cuando se crea una solución de recuperación ante desastres para las aplicaciones, es importante tooremember que necesita tooprotect y recuperación de Active Directory y DNS antes de hello otros componentes de la aplicación, tooensure que cosas funcionan correctamente cuando se produce un desastre.</span><span class="sxs-lookup"><span data-stu-id="f868d-105">When you create a disaster recovery solution for applications, it's important tooremember that you need tooprotect and recover Active Directory and DNS before hello other application components, tooensure that things function correctly when disaster occurs.</span></span>

<span data-ttu-id="f868d-106">Site Recovery es un servicio de Azure que proporciona funcionalidades de recuperación ante desastres mediante la organización de la replicación, la conmutación por error y la recuperación de máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="f868d-106">Site Recovery is an Azure service that provides disaster recovery by orchestrating replication, failover, and recovery of virtual machines.</span></span> <span data-ttu-id="f868d-107">Recuperación de sitio admite una serie de escenarios de replicación tooconsistently proteger y sin problemas en las nubes de tooprivate, pública o proveedor de hospedaje de máquinas virtuales y las aplicaciones de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="f868d-107">Site Recovery supports a number of replication scenarios tooconsistently protect, and seamlessly failover virtual machines and applications tooprivate, public, or hoster clouds.</span></span>

<span data-ttu-id="f868d-108">Con Site Recovery, puede crear un plan completo de recuperación ante desastres automatizada para Active Directory.</span><span class="sxs-lookup"><span data-stu-id="f868d-108">Using Site Recovery, you can create a complete automated disaster recovery plan for Active Directory.</span></span> <span data-ttu-id="f868d-109">En el momento en el que se produce una interrupción, puede iniciar la conmutación por error en segundos desde cualquier lugar y hacer que Active Directory vuelva a funcionar en unos minutos.</span><span class="sxs-lookup"><span data-stu-id="f868d-109">When disruptions occur, you can initiate a failover within seconds from anywhere and get Active Directory up and running in a few minutes.</span></span> <span data-ttu-id="f868d-110">Si ha implementado Active Directory para varias aplicaciones, como SharePoint y SAP en el sitio principal, y desea toofail sobre sitio completo hello, puede producir un error a través de Active Directory primero mediante Site Recovery y, a continuación, conmutar por error Hola otras aplicaciones uso de planes de recuperación específica de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f868d-110">If you've deployed Active Directory for multiple applications such as SharePoint and SAP in your primary site, and you want toofail over hello complete site, you can fail over Active Directory first using Site Recovery, and then fail over hello other applications using application-specific recovery plans.</span></span>

<span data-ttu-id="f868d-111">Este artículo explica cómo toocreate una solución de recuperación ante desastres para Active Directory, cómo tooperform planeada, no planeada y las conmutaciones por error de prueba con un plan de recuperación de un solo clic, Hola configuraciones admitidas y requisitos previos.</span><span class="sxs-lookup"><span data-stu-id="f868d-111">This article explains how toocreate a disaster recovery solution for Active Directory, how tooperform planned, unplanned, and test failovers using a one-click recovery plan, hello supported configurations, and prerequisites.</span></span>  <span data-ttu-id="f868d-112">Debe estar familiarizado con Active Directory y Azure Site Recovery antes de empezar.</span><span class="sxs-lookup"><span data-stu-id="f868d-112">You should be familiar with Active Directory and Azure Site Recovery before you start.</span></span>

## <a name="replicating-domain-controller"></a><span data-ttu-id="f868d-113">Replicación de controlador de dominio</span><span class="sxs-lookup"><span data-stu-id="f868d-113">Replicating Domain Controller</span></span>

<span data-ttu-id="f868d-114">Necesita toosetup [replicación de Site Recovery](#enable-protection-using-site-recovery) en al menos una máquina virtual que hospeda el controlador de dominio y DNS.</span><span class="sxs-lookup"><span data-stu-id="f868d-114">You need toosetup [Site Recovery replication](#enable-protection-using-site-recovery) on at least one virtual machine hosting Domain Controller and DNS.</span></span> <span data-ttu-id="f868d-115">Si tiene [varios controladores de dominio](#environment-with-multiple-domain-controllers) en su entorno, además tooreplicating Hola máquina de virtual de controlador de dominio con la recuperación de sitio también podría tener tooset hasta un [delcontroladordedominioadicional](#protect-active-directory-with-active-directory-replication) en el sitio de destino de hello (Azure o un centro de datos local secundario).</span><span class="sxs-lookup"><span data-stu-id="f868d-115">If you have [multiple domain controllers](#environment-with-multiple-domain-controllers) in your environment, in addition tooreplicating hello domain controller virtual machine with Site Recovery you would also have tooset up an [additional domain controller](#protect-active-directory-with-active-directory-replication) on hello target site (Azure or a secondary on-premises datacenter).</span></span> 

### <a name="single-domain-controller-environment"></a><span data-ttu-id="f868d-116">Entorno con un solo controlador de dominio</span><span class="sxs-lookup"><span data-stu-id="f868d-116">Single domain controller environment</span></span>
<span data-ttu-id="f868d-117">Si tiene algunas aplicaciones y un controlador de dominio único y desea toofail sobre todo el sitio Hola juntos, le recomendamos con controladores de dominio de Site Recovery tooreplicate hello toohello de sitio secundario (si está conmuta tooAzure o sitio secundario de tooa).</span><span class="sxs-lookup"><span data-stu-id="f868d-117">If you have a few applications and only a single domain controller, and you want toofail over hello entire site together, then we recommend using Site Recovery tooreplicate hello domain controller toohello secondary site (whether you're failing over tooAzure or tooa secondary site).</span></span> <span data-ttu-id="f868d-118">Hello mismo replicado puede utilizarse la máquina virtual de controlador/DNS para el dominio [probar conmutación por error](#test-failover-considerations) así.</span><span class="sxs-lookup"><span data-stu-id="f868d-118">hello same replicated domain controller/DNS virtual machine can be used for [test failover](#test-failover-considerations) as well.</span></span>

### <a name="environment-with-multiple-domain-controllers"></a><span data-ttu-id="f868d-119">Entorno con varios controladores de dominio</span><span class="sxs-lookup"><span data-stu-id="f868d-119">Environment with multiple domain controllers</span></span>
<span data-ttu-id="f868d-120">Si tiene muchas aplicaciones y hay más de un controlador de dominio en el entorno de Hola o si tiene previsto toofail sobre algunas aplicaciones a la vez, se recomienda que además tooreplicating controlador de dominio de hello virtual automático con Site Recovery se también configurar un [controlador de dominio adicional](#protect-active-directory-with-active-directory-replication) en el sitio de destino de hello (Azure o un centro de datos local secundario).</span><span class="sxs-lookup"><span data-stu-id="f868d-120">If you have many applications and there's more than one domain controller in hello environment, or if you plan toofail over a few applications at a time, we recommend that in addition tooreplicating hello domain controller virtual machine with Site Recovery you also set up an [additional domain controller](#protect-active-directory-with-active-directory-replication) on hello target site (Azure or a secondary on-premises datacenter).</span></span> <span data-ttu-id="f868d-121">Para [probar conmutación por error](#test-failover-considerations), utilice el controlador de dominio replicada Site Recovery y de conmutación por error, controlador de dominio adicional de hello en el sitio de destino de Hola.</span><span class="sxs-lookup"><span data-stu-id="f868d-121">For [test failover](#test-failover-considerations), you use domain controller replicated by Site Recovery and for failover, hello additional domain controller on hello target site.</span></span> 


<span data-ttu-id="f868d-122">Hello siguientes secciones se explica cómo tooenable protección para un controlador de dominio en la recuperación del sitio y cómo tooset un controlador de dominio en Azure.</span><span class="sxs-lookup"><span data-stu-id="f868d-122">hello following sections explain how tooenable protection for a domain controller in Site Recovery, and how tooset up a domain controller in Azure.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="f868d-123">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="f868d-123">Prerequisites</span></span>
* <span data-ttu-id="f868d-124">Una implementación local del servidor DNS y Active Directory.</span><span class="sxs-lookup"><span data-stu-id="f868d-124">An on-premises deployment of Active Directory and DNS server.</span></span>
* <span data-ttu-id="f868d-125">Un almacén de los servicios de Azure Site Recovery en una suscripción de Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="f868d-125">An Azure Site Recovery Services vault in a Microsoft Azure subscription.</span></span>
* <span data-ttu-id="f868d-126">Si replica tooAzure, ejecute la herramienta de evaluación de preparación de máquina Virtual de Azure de hello en tooensure de máquinas virtuales que son compatibles con máquinas virtuales de Azure y servicios de Azure Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="f868d-126">If you're replicating tooAzure, run hello Azure Virtual Machine Readiness Assessment tool on VMs tooensure they're compatible with Azure VMs and Azure Site Recovery Services.</span></span>

## <a name="enable-protection-using-site-recovery"></a><span data-ttu-id="f868d-127">Habilitación de la protección con Site Recovery</span><span class="sxs-lookup"><span data-stu-id="f868d-127">Enable protection using Site Recovery</span></span>
### <a name="protect-hello-virtual-machine"></a><span data-ttu-id="f868d-128">Proteger la máquina virtual de Hola</span><span class="sxs-lookup"><span data-stu-id="f868d-128">Protect hello virtual machine</span></span>
<span data-ttu-id="f868d-129">Habilitar la protección de máquina virtual controlador/DNS del dominio hello en Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="f868d-129">Enable protection of hello domain controller/DNS virtual machine in Site Recovery.</span></span> <span data-ttu-id="f868d-130">Configurar opciones de recuperación del sitio en función de tipo de máquina virtual de hello (Hyper-V o VMware).</span><span class="sxs-lookup"><span data-stu-id="f868d-130">Configure Site Recovery settings based on hello virtual machine type (Hyper-V or VMware).</span></span> <span data-ttu-id="f868d-131">controlador de dominio de Hello replicada con Site Recovery se utiliza para [probar conmutación por error](#test-failover-considerations).</span><span class="sxs-lookup"><span data-stu-id="f868d-131">hello domain controller replicated using Site Recovery is used for [test failover](#test-failover-considerations).</span></span> <span data-ttu-id="f868d-132">Asegúrese de que cumple Hola según los requisitos:</span><span class="sxs-lookup"><span data-stu-id="f868d-132">Make sure it meets hello following requirements:</span></span>

1. <span data-ttu-id="f868d-133">controlador de dominio de Hello es un servidor de catálogo global</span><span class="sxs-lookup"><span data-stu-id="f868d-133">hello domain controller is a global catalog server</span></span>
2. <span data-ttu-id="f868d-134">controlador de dominio de Hello debe ser propietario de la función FSMO Hola para los roles que serán necesarias durante una conmutación por error de prueba (lo contrario, estas funciones necesitará toobe [confiscado](http://aka.ms/ad_seize_fsmo) después de la conmutación por error de hello)</span><span class="sxs-lookup"><span data-stu-id="f868d-134">hello domain controller should be hello FSMO role owner for roles that will be needed during a test failover (else these roles will need toobe [seized](http://aka.ms/ad_seize_fsmo) after hello failover)</span></span>

### <a name="configure-virtual-machine-network-settings"></a><span data-ttu-id="f868d-135">Configuración de los valores de red de la máquina virtual</span><span class="sxs-lookup"><span data-stu-id="f868d-135">Configure virtual machine network settings</span></span>
<span data-ttu-id="f868d-136">Para DNS/controlador de dominio Hola máquina virtual, configurar opciones de red en Site Recovery para que Hola podrá máquina virtual toohello adjunto de red apropiado después de la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="f868d-136">For hello domain controller/DNS virtual machine, configure network settings in Site Recovery so that hello virtual machine will be attached toohello right network after failover.</span></span> 

![Configuración de red de máquina virtual](./media/site-recovery-active-directory/DNS-Target-IP.png)

## <a name="protect-active-directory-with-active-directory-replication"></a><span data-ttu-id="f868d-138">Protección de Active Directory con la replicación de Active Directory</span><span class="sxs-lookup"><span data-stu-id="f868d-138">Protect Active Directory with Active Directory replication</span></span>
### <a name="site-to-site-protection"></a><span data-ttu-id="f868d-139">Protección de sitio a sitio</span><span class="sxs-lookup"><span data-stu-id="f868d-139">Site-to-site protection</span></span>
<span data-ttu-id="f868d-140">Crear un controlador de dominio en el sitio secundario de Hola.</span><span class="sxs-lookup"><span data-stu-id="f868d-140">Create a domain controller on hello secondary site.</span></span> <span data-ttu-id="f868d-141">Cuando se promueve la función de controlador de dominio de hello server tooa, especifique el nombre de Hola de hello mismo dominio que se utiliza en el sitio principal de Hola.</span><span class="sxs-lookup"><span data-stu-id="f868d-141">When you promote hello server tooa domain controller role, specify hello name of hello same domain that is being used on hello primary site.</span></span> <span data-ttu-id="f868d-142">Puede usar hello **servicios y sitios de Active Directory** tooconfigure configuración de vínculo a sitios Hola se agregan sitios de hello toowhich del objeto de complemento.</span><span class="sxs-lookup"><span data-stu-id="f868d-142">You can use hello **Active Directory Sites and Services** snap-in tooconfigure settings on hello site link object toowhich hello sites are added.</span></span> <span data-ttu-id="f868d-143">Al configurar los valores en un vínculo de sitio, puede controlar cuándo se produce la replicación entre dos o más sitios y con qué frecuencia se produce.</span><span class="sxs-lookup"><span data-stu-id="f868d-143">By configuring settings on a site link, you can control when replication occurs between two or more sites, and how often.</span></span> <span data-ttu-id="f868d-144">Para más información, consulte [Programación de la replicación entre sitios](https://technet.microsoft.com/library/cc731862.aspx).</span><span class="sxs-lookup"><span data-stu-id="f868d-144">For more information, see [Scheduling Replication Between Sites](https://technet.microsoft.com/library/cc731862.aspx).</span></span>

### <a name="site-to-azure-protection"></a><span data-ttu-id="f868d-145">Protección del sitio en Azure</span><span class="sxs-lookup"><span data-stu-id="f868d-145">Site-to-Azure protection</span></span>
<span data-ttu-id="f868d-146">Siga las instrucciones de hello demasiado[crear un controlador de dominio en una red virtual de Azure](../active-directory/active-directory-install-replica-active-directory-domain-controller.md).</span><span class="sxs-lookup"><span data-stu-id="f868d-146">Follow hello instructions too[create a domain controller in an Azure virtual network](../active-directory/active-directory-install-replica-active-directory-domain-controller.md).</span></span> <span data-ttu-id="f868d-147">Cuando se promueve la función de controlador de dominio de hello server tooa, especifique Hola mismo nombre de dominio que se usa en el sitio primario de Hola.</span><span class="sxs-lookup"><span data-stu-id="f868d-147">When you promote hello server tooa domain controller role, specify hello same domain name that's used on hello primary site.</span></span>

<span data-ttu-id="f868d-148">A continuación, [volver a configurar el servidor DNS de hello para la red virtual de hello](../active-directory/active-directory-install-replica-active-directory-domain-controller.md#reconfigure-dns-server-for-the-virtual-network), servidor DNS de hello toouse en Azure.</span><span class="sxs-lookup"><span data-stu-id="f868d-148">Then [reconfigure hello DNS server for hello virtual network](../active-directory/active-directory-install-replica-active-directory-domain-controller.md#reconfigure-dns-server-for-the-virtual-network), toouse hello DNS server in Azure.</span></span>

![Red de Azure](./media/site-recovery-active-directory/azure-network.png)

<span data-ttu-id="f868d-150">**DNS en la red de producción de Azure**</span><span class="sxs-lookup"><span data-stu-id="f868d-150">**DNS in Azure Production Network**</span></span>

## <a name="test-failover-considerations"></a><span data-ttu-id="f868d-151">Consideraciones sobre la conmutación por error de prueba</span><span class="sxs-lookup"><span data-stu-id="f868d-151">Test failover considerations</span></span>
<span data-ttu-id="f868d-152">La conmutación por error de prueba se produce en una red que está aislada de la red de producción para que no haya impacto alguno en la carga de trabajo de producción.</span><span class="sxs-lookup"><span data-stu-id="f868d-152">Test failover occurs in a network that's isolated from production network so that there's no impact on production workloads.</span></span>

<span data-ttu-id="f868d-153">Mayoría de las aplicaciones también requiere la presencia de Hola de un controlador de dominio y un toofunction de servidor DNS.</span><span class="sxs-lookup"><span data-stu-id="f868d-153">Most applications also require hello presence of a domain controller and a DNS server toofunction.</span></span> <span data-ttu-id="f868d-154">Por lo tanto, antes de que se conmuta la aplicación hello, un controlador de dominio debe toobe creado en hello aislamiento de red toobe utilizado para la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="f868d-154">Therefore, before hello application is failed over, a domain controller needs toobe created in hello isolated network toobe used for test failover.</span></span> <span data-ttu-id="f868d-155">Hola toodo de manera más sencilla es tooreplicate una máquina virtual de controlador/DNS de dominio con Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="f868d-155">hello easiest way toodo this is tooreplicate a domain controller/DNS virtual machine with Site Recovery.</span></span> <span data-ttu-id="f868d-156">A continuación, ejecute una conmutación por error de prueba de la máquina virtual de controlador de hello dominio antes de ejecutar una conmutación por error de prueba del plan de recuperación de Hola para la aplicación hello.</span><span class="sxs-lookup"><span data-stu-id="f868d-156">Then run a test failover of hello domain controller virtual machine before running a test failover of hello recovery plan for hello application.</span></span> <span data-ttu-id="f868d-157">Así es cómo debe hacerlo:</span><span class="sxs-lookup"><span data-stu-id="f868d-157">Here's how you do that:</span></span>

1. <span data-ttu-id="f868d-158">[Replicar](site-recovery-replicate-vmware-to-azure.md) Hola máquina virtual controlador/DNS del dominio con Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="f868d-158">[Replicate](site-recovery-replicate-vmware-to-azure.md) hello domain controller/DNS virtual machine using Site Recovery.</span></span>
1. <span data-ttu-id="f868d-159">Cree una red aislada.</span><span class="sxs-lookup"><span data-stu-id="f868d-159">Create an isolated network.</span></span> <span data-ttu-id="f868d-160">Cualquier red virtual que se cree en Azure de forma predeterminada está aislada de otras redes.</span><span class="sxs-lookup"><span data-stu-id="f868d-160">Any virtual network created in Azure by default is isolated from other networks.</span></span> <span data-ttu-id="f868d-161">Se recomienda que el intervalo de direcciones IP de Hola para esta red sea igual que el de la red de producción.</span><span class="sxs-lookup"><span data-stu-id="f868d-161">We recommend that hello IP address range for this network is same as that of your production network.</span></span> <span data-ttu-id="f868d-162">No habilite la conectividad de sitio a sitio en esta red.</span><span class="sxs-lookup"><span data-stu-id="f868d-162">Don't enable site-to-site connectivity on this network.</span></span>
1. <span data-ttu-id="f868d-163">Proporcione una dirección IP de DNS de red Hola creado, como la dirección IP de Hola que espera tooget de máquina virtual de hello DNS.</span><span class="sxs-lookup"><span data-stu-id="f868d-163">Provide a DNS IP address in hello network created, as hello IP address that you expect hello DNS virtual machine tooget.</span></span> <span data-ttu-id="f868d-164">Si replica tooAzure, proporcione direcciones IP de Hola de hello máquina virtual que se utiliza en la conmutación por error en **IP de destino** en **proceso y red** configuración.</span><span class="sxs-lookup"><span data-stu-id="f868d-164">If you're replicating tooAzure, then provide hello IP address for hello VM that is used on failover in **Target IP** setting in **Compute and Network** settings.</span></span> 

    <span data-ttu-id="f868d-165">![IP de destino](./media/site-recovery-active-directory/DNS-Target-IP.png)**IP de destino**</span><span class="sxs-lookup"><span data-stu-id="f868d-165">![Target IP](./media/site-recovery-active-directory/DNS-Target-IP.png) **Target IP**</span></span>

    ![Red de prueba de Azure](./media/site-recovery-active-directory/azure-test-network.png)

    <span data-ttu-id="f868d-167">**DNS en la red de prueba de Azure**</span><span class="sxs-lookup"><span data-stu-id="f868d-167">**DNS in Azure Test Network**</span></span>

> [!TIP]
> <span data-ttu-id="f868d-168">Máquinas virtuales de prueba toocreate en una subred del mismo nombre de intentos de recuperación de sitio y usar Hola IP misma que la proporcionada en **proceso y red** configuración de máquina virtual de Hola.</span><span class="sxs-lookup"><span data-stu-id="f868d-168">Site Recovery attempts toocreate test virtual machines in a subnet of same name and using hello same IP as that provided in **Compute and Network** settings of hello virtual machine.</span></span> <span data-ttu-id="f868d-169">Si la subred del mismo nombre no está disponible en hello red virtual de Azure proporcionado para la conmutación por error de prueba, máquina virtual de prueba se crea en la primera subred de hello alfabéticamente.</span><span class="sxs-lookup"><span data-stu-id="f868d-169">If subnet of same name is not available in hello Azure virtual network provided for test failover, then test virtual machine is created in hello first subnet alphabetically.</span></span> <span data-ttu-id="f868d-170">Si IP de destino de hello forma parte de hello elegido subred, Site Recovery intenta toocreate Hola prueba de conmutación por error máquina virtual a través Hola IP de destino.</span><span class="sxs-lookup"><span data-stu-id="f868d-170">If hello target IP is part of hello chosen subnet, then Site Recovery tries toocreate hello test failover virtual machine using hello target IP.</span></span> <span data-ttu-id="f868d-171">Si IP de destino de hello no forma parte de hello elegido subred, máquina virtual de conmutación por error de prueba se crea con cualquier dirección IP disponible en hello elegido subred.</span><span class="sxs-lookup"><span data-stu-id="f868d-171">If hello target IP is not part of hello chosen subnet, then test failover virtual machine gets created using any available IP in hello chosen subnet.</span></span> 
>
>


1. <span data-ttu-id="f868d-172">Si replica tooanother al sitio local y usa DHCP, siga las instrucciones de hello demasiado[la instalación de DNS y DHCP para conmutación por error de prueba](site-recovery-test-failover-vmm-to-vmm.md#prepare-dhcp)</span><span class="sxs-lookup"><span data-stu-id="f868d-172">If you're replicating tooanother on-premises site and you're using DHCP, follow hello instructions too[setup DNS and DHCP for test failover](site-recovery-test-failover-vmm-to-vmm.md#prepare-dhcp)</span></span>
1. <span data-ttu-id="f868d-173">Realice una conmutación por error de prueba de la máquina de virtual del controlador de dominio de hello ejecutar en la red aislada Hola.</span><span class="sxs-lookup"><span data-stu-id="f868d-173">Do a test failover of hello domain controller virtual machine run in hello isolated network.</span></span> <span data-ttu-id="f868d-174">Usar más reciente disponible **coherentes con la aplicación** punto de recuperación de hello dominio controlador máquina virtual toodo Hola conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="f868d-174">Use latest available **application consistent** recovery point of hello domain controller virtual machine toodo hello test failover.</span></span> 
1. <span data-ttu-id="f868d-175">Ejecute una conmutación por error de prueba para el plan de recuperación de Hola que contiene máquinas virtuales de la aplicación hello.</span><span class="sxs-lookup"><span data-stu-id="f868d-175">Run a test failover for hello recovery plan that contains virtual machines of hello application.</span></span> 
1. <span data-ttu-id="f868d-176">Una vez finalizada, prueba **conmutación por error de prueba de limpieza** en hello máquina de virtual de controlador de dominio.</span><span class="sxs-lookup"><span data-stu-id="f868d-176">After testing is complete, **Cleanup test failover** on hello domain controller virtual machine.</span></span> <span data-ttu-id="f868d-177">Este paso elimina el controlador de dominio de Hola que se creó para la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="f868d-177">This step deletes hello domain controller that was created for test failover.</span></span>


### <a name="removing-reference-tooother-domain-controllers"></a><span data-ttu-id="f868d-178">Quitar controladores de dominio de referencia tooother</span><span class="sxs-lookup"><span data-stu-id="f868d-178">Removing reference tooother domain controllers</span></span>
<span data-ttu-id="f868d-179">Cuando realiza una conmutación por error de prueba, no ponga todos los controladores de dominio de hello en red de prueba de Hola.</span><span class="sxs-lookup"><span data-stu-id="f868d-179">When you are doing a test failover, you don't bring all hello domain controllers in hello test network.</span></span> <span data-ttu-id="f868d-180">referencia de hello tooremove de otros controladores de dominio que existen en el entorno de producción, es posible que tenga demasiado[asumir roles FSMO Active Directory](http://aka.ms/ad_seize_fsmo) y realice [la limpieza de metadatos](https://technet.microsoft.com/library/cc816907.aspx) para le falta el dominio controladores.</span><span class="sxs-lookup"><span data-stu-id="f868d-180">tooremove hello reference of other domain controllers that exist in your production environment, you might need too[seize FSMO Active Directory roles](http://aka.ms/ad_seize_fsmo) and do [metadata cleanup](https://technet.microsoft.com/library/cc816907.aspx) for missing domain controllers.</span></span> 



> [!IMPORTANT]
> <span data-ttu-id="f868d-181">Algunas de las configuraciones de Hola que se describe en los pasos de la sección de hello no son configuraciones de controlador de dominio de hello estándar de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="f868d-181">Some of hello configurations described in hello following section are not hello standard/default domain controller configurations.</span></span> <span data-ttu-id="f868d-182">Si no desea que toomake que estos controlador de dominio de producción de cambios tooa; a continuación, puede crear un toobe dedicado de controlador de dominio utilizado para la recuperación de sitio de conmutación por error de prueba y realice estos cambios toothat.</span><span class="sxs-lookup"><span data-stu-id="f868d-182">If you don't want toomake these changes tooa production domain controller, then you can create a domain controller dedicated toobe used for Site Recovery test failover and make these changes toothat.</span></span>  
>
>

### <a name="issues-because-of-virtualization-safeguards"></a><span data-ttu-id="f868d-183">Problemas debidos a las medidas de seguridad de la virtualización</span><span class="sxs-lookup"><span data-stu-id="f868d-183">Issues because of virtualization safeguards</span></span> 

<span data-ttu-id="f868d-184">A partir de Windows Server 2012, [se han integrado medidas de seguridad adicionales en Active Directory Domain Services](https://technet.microsoft.com/windows-server-docs/identity/ad-ds/introduction-to-active-directory-domain-services-ad-ds-virtualization-level-100).</span><span class="sxs-lookup"><span data-stu-id="f868d-184">Beginning with Windows Server 2012, [additional safeguards have been built into Active Directory Domain Services](https://technet.microsoft.com/windows-server-docs/identity/ad-ds/introduction-to-active-directory-domain-services-ad-ds-virtualization-level-100).</span></span> <span data-ttu-id="f868d-185">Estas medidas de seguridad ayudan a proteger los controladores de dominio virtualizado frente reversiones de USN, como plataforma de hipervisor de hello subyacente admita VM-GenerationID.</span><span class="sxs-lookup"><span data-stu-id="f868d-185">These safeguards help protect virtualized domain controllers against USN Rollbacks, as long as hello underlying hypervisor platform supports VM-GenerationID.</span></span> <span data-ttu-id="f868d-186">Azure admite VM-GenerationID, lo que significa que los controladores de dominio que ejecutan Windows Server 2012 o posterior en Azure máquinas virtuales tienen medidas de seguridad adicionales de Hola.</span><span class="sxs-lookup"><span data-stu-id="f868d-186">Azure supports VM-GenerationID, which means that domain controllers that run Windows Server 2012 or later on Azure virtual machines have hello additional safeguards.</span></span> 


<span data-ttu-id="f868d-187">Cuando se restablece el VM-GenerationID hello, también se restablece el invocationID Hola de base de datos de hello AD DS, se descarta Hola grupo RID y SYSVOL se marca como no autoritativo.</span><span class="sxs-lookup"><span data-stu-id="f868d-187">When hello VM-GenerationID is reset, hello invocationID of hello AD DS database is also reset, hello RID pool is discarded, and SYSVOL is marked as non-authoritative.</span></span> <span data-ttu-id="f868d-188">Para obtener más información, consulte [Introducción tooActive virtualización de servicios de dominio de Directory](https://technet.microsoft.com/windows-server-docs/identity/ad-ds/introduction-to-active-directory-domain-services-ad-ds-virtualization-level-100) y [virtualización segura de DFSR](https://blogs.technet.microsoft.com/filecab/2013/04/05/safely-virtualizing-dfsr/)</span><span class="sxs-lookup"><span data-stu-id="f868d-188">For more information, see [Introduction tooActive Directory Domain Services Virtualization](https://technet.microsoft.com/windows-server-docs/identity/ad-ds/introduction-to-active-directory-domain-services-ad-ds-virtualization-level-100) and [Safely Virtualizing DFSR](https://blogs.technet.microsoft.com/filecab/2013/04/05/safely-virtualizing-dfsr/)</span></span>

<span data-ttu-id="f868d-189">Conmutar por error tooAzure puede causar restablecer de VM-GenerationID y que se inicia en medidas de seguridad adicionales de hello cuando se inicia Hola máquina de virtual de controlador de dominio en Azure.</span><span class="sxs-lookup"><span data-stu-id="f868d-189">Failing over tooAzure may cause resetting of VM-GenerationID and that kicks in hello additional safeguards when hello domain controller virtual machine starts in Azure.</span></span> <span data-ttu-id="f868d-190">Esto puede dar lugar a un **un retraso importante** de usuario que se va a la máquina de virtual del controlador de dominio de toologin puede toohello.</span><span class="sxs-lookup"><span data-stu-id="f868d-190">This may result in a **significant delay** in user being able toologin toohello domain controller virtual machine.</span></span> <span data-ttu-id="f868d-191">Puesto que este controlador de dominio se utilizaría solo en una conmutación por error de prueba, las medidas de seguridad de virtualización no son necesarias.</span><span class="sxs-lookup"><span data-stu-id="f868d-191">Since this domain controller would be used only in a test failover, virtualization safeguards are not necessary.</span></span> <span data-ttu-id="f868d-192">tooensure que VM-GenerationID de máquina de virtual del controlador de dominio de hello no cambia, a continuación, se puede cambiar el valor de Hola de too4 DWORD siguientes en el controlador de dominio local de Hola.</span><span class="sxs-lookup"><span data-stu-id="f868d-192">tooensure that VM-GenerationID for hello domain controller virtual machine doesn't change, then you can change hello value of following DWORD too4 in hello on-premises domain controller.</span></span>

        
        HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\gencounter\Start
 

#### <a name="symptoms-of-virtualization-safeguards"></a><span data-ttu-id="f868d-193">Síntomas de las medidas de seguridad de la virtualización</span><span class="sxs-lookup"><span data-stu-id="f868d-193">Symptoms of virtualization safeguards</span></span>
 
<span data-ttu-id="f868d-194">Si se han tomado medidas de seguridad de virtualización después de una conmutación por error de prueba, podría ver uno o varios de los síntomas siguientes:</span><span class="sxs-lookup"><span data-stu-id="f868d-194">If virtualization safeguards have kicked in after a test failover, you may see one or more of following symptoms:</span></span>  

<span data-ttu-id="f868d-195">Cambio del Id. de generación</span><span class="sxs-lookup"><span data-stu-id="f868d-195">Generation ID change</span></span>

![Cambio del Id. de generación](./media/site-recovery-active-directory/Event2170.png)

<span data-ttu-id="f868d-197">Cambio del Id. de invocación</span><span class="sxs-lookup"><span data-stu-id="f868d-197">Invocation ID change</span></span>

![Cambio del Id. de invocación](./media/site-recovery-active-directory/Event1109.png)

<span data-ttu-id="f868d-199">Recursos compartidos de Sysvol y Netlogon no disponibles</span><span class="sxs-lookup"><span data-stu-id="f868d-199">Sysvol and Netlogon shares are not available</span></span>

![Recurso compartido Sysvol](./media/site-recovery-active-directory/sysvolshare.png)

![Ntfrs Sysvol](./media/site-recovery-active-directory/Event13565.png)

<span data-ttu-id="f868d-202">Bases de datos DFSR eliminadas</span><span class="sxs-lookup"><span data-stu-id="f868d-202">Any DFSR databases are deleted</span></span>

![Base de datos de DFSR eliminada](./media/site-recovery-active-directory/Event2208.png)


> [!IMPORTANT]
> <span data-ttu-id="f868d-204">Algunas de las configuraciones de Hola que se describe en los pasos de la sección de hello no son configuraciones de controlador de dominio de hello estándar de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="f868d-204">Some of hello configurations described in hello following section are not hello standard/default domain controller configurations.</span></span> <span data-ttu-id="f868d-205">Si no desea que toomake que estos controlador de dominio de producción de cambios tooa; a continuación, puede crear un toobe dedicado de controlador de dominio utilizado para la recuperación de sitio de conmutación por error de prueba y realice estos cambios toothat.</span><span class="sxs-lookup"><span data-stu-id="f868d-205">If you don't want toomake these changes tooa production domain controller, then you can create a domain controller dedicated toobe used for Site Recovery test failover and make these changes toothat.</span></span>  
>
>


### <a name="troubleshooting-domain-controller-issues-during-test-failover"></a><span data-ttu-id="f868d-206">Solución de los problemas de controlador de dominio durante la conmutación por error de prueba</span><span class="sxs-lookup"><span data-stu-id="f868d-206">Troubleshooting domain controller issues during test failover</span></span>


<span data-ttu-id="f868d-207">En un símbolo del sistema, ejecute hello después toocheck comando si comparten carpetas SYSVOL y NETLOGON:</span><span class="sxs-lookup"><span data-stu-id="f868d-207">On a command prompt, run hello following command toocheck whether SYSVOL and NETLOGON folders are shared:</span></span>

    NET SHARE

<span data-ttu-id="f868d-208">En el símbolo de hello, ejecute hello siguiente comando tooensure que Hola de controlador de dominio está funcionando correctamente.</span><span class="sxs-lookup"><span data-stu-id="f868d-208">On hello command prompt, run hello following command tooensure that hello domain controller is functioning properly.</span></span>

    dcdiag /v > dcdiag.txt

<span data-ttu-id="f868d-209">En el registro de salida de hello, busque tooconfirm texto siguiente que Hola de controlador de dominio está funcionando bien.</span><span class="sxs-lookup"><span data-stu-id="f868d-209">In hello output log, look for following text tooconfirm that hello domain controller is functioning well.</span></span> 

* <span data-ttu-id="f868d-210">"passed test Connectivity"</span><span class="sxs-lookup"><span data-stu-id="f868d-210">"passed test Connectivity"</span></span>
* <span data-ttu-id="f868d-211">"passed test Advertising"</span><span class="sxs-lookup"><span data-stu-id="f868d-211">"passed test Advertising"</span></span>
* <span data-ttu-id="f868d-212">"passed test MachineAccount"</span><span class="sxs-lookup"><span data-stu-id="f868d-212">"passed test MachineAccount"</span></span>

<span data-ttu-id="f868d-213">Si hello condiciones anteriores se cumplen, es probable que ese controlador de dominio de hello está funcionando bien.</span><span class="sxs-lookup"><span data-stu-id="f868d-213">If hello preceding conditions are satisfied, it is likely that hello domain controller is functioning well.</span></span> <span data-ttu-id="f868d-214">En caso contrario, realice estos pasos.</span><span class="sxs-lookup"><span data-stu-id="f868d-214">If not, try following steps.</span></span>


* <span data-ttu-id="f868d-215">Realizar una restauración autoritativa del controlador de dominio de Hola.</span><span class="sxs-lookup"><span data-stu-id="f868d-215">Do an authoritative restore of hello domain controller.</span></span>
    * <span data-ttu-id="f868d-216">Aunque es [no recomienda la replicación FRS toouse](https://blogs.technet.microsoft.com/filecab/2014/06/25/the-end-is-nigh-for-frs/), pero si todavía está utilizando, siga los pasos de hello proporciona [aquí](https://support.microsoft.com/kb/290762) toodo una restauración autoritativa.</span><span class="sxs-lookup"><span data-stu-id="f868d-216">Although it is [not recommended toouse FRS replication](https://blogs.technet.microsoft.com/filecab/2014/06/25/the-end-is-nigh-for-frs/), but if you are still using it then follow hello steps provided [here](https://support.microsoft.com/kb/290762) toodo an authoritative restore.</span></span> <span data-ttu-id="f868d-217">Puede obtener más información acerca de Burflags comentado en el vínculo anterior de hello [aquí](https://blogs.technet.microsoft.com/janelewis/2006/09/18/d2-and-d4-what-is-it-for/).</span><span class="sxs-lookup"><span data-stu-id="f868d-217">You can read more about Burflags talked about in hello previous link [here](https://blogs.technet.microsoft.com/janelewis/2006/09/18/d2-and-d4-what-is-it-for/).</span></span>
    * <span data-ttu-id="f868d-218">Si está utilizando la replicación DFSR, a continuación, siga pasos Hola disponibles [aquí](https://support.microsoft.com/kb/2218556) toodo una restauración autoritativa.</span><span class="sxs-lookup"><span data-stu-id="f868d-218">If you are using DFSR replication, then follow hello steps available [here](https://support.microsoft.com/kb/2218556) toodo an authoritative restore.</span></span> <span data-ttu-id="f868d-219">También puede usar las funciones de Powershell disponibles [aquí](https://blogs.technet.microsoft.com/thbouche/2013/08/28/dfsr-sysvol-authoritative-non-authoritative-restore-powershell-functions/).</span><span class="sxs-lookup"><span data-stu-id="f868d-219">You can also use Powershell functions available on this [link](https://blogs.technet.microsoft.com/thbouche/2013/08/28/dfsr-sysvol-authoritative-non-authoritative-restore-powershell-functions/) for this purpose.</span></span> 
    
* <span data-ttu-id="f868d-220">Omitir el requisito de sincronización inicial estableciendo después too0 de clave del registro en el controlador de dominio local de Hola.</span><span class="sxs-lookup"><span data-stu-id="f868d-220">Bypass initial synchronization requirement by setting following registry key too0 in hello on-premises domain controller.</span></span> <span data-ttu-id="f868d-221">Si esta DWORD no existe, créela en el nodo "Parameters".</span><span class="sxs-lookup"><span data-stu-id="f868d-221">If this DWORD doesn't exist, then you can create it under node 'Parameters'.</span></span> <span data-ttu-id="f868d-222">Puede leer más sobre este tema [aquí](https://support.microsoft.com/kb/2001093).</span><span class="sxs-lookup"><span data-stu-id="f868d-222">You can read more about it [here](https://support.microsoft.com/kb/2001093)</span></span>

        HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NTDS\Parameters\Repl Perform Initial Synchronizations

* <span data-ttu-id="f868d-223">Deshabilitar el requisito de Hola que un servidor de catálogo global está disponible toovalidate inicio de sesión de usuario estableciendo después too1 de clave del registro en el controlador de dominio local de Hola.</span><span class="sxs-lookup"><span data-stu-id="f868d-223">Disable hello requirement that a global catalog server is available toovalidate user logon by setting following registry key too1 in hello on-premises domain controller.</span></span> <span data-ttu-id="f868d-224">Si esta DWORD no existe, créela en el nodo "Lsa".</span><span class="sxs-lookup"><span data-stu-id="f868d-224">If this DWORD doesn't exist, then you can create it under node 'Lsa'.</span></span> <span data-ttu-id="f868d-225">Puede leer más sobre este tema [aquí](http://support.microsoft.com/kb/241789).</span><span class="sxs-lookup"><span data-stu-id="f868d-225">You can read more about it [here](http://support.microsoft.com/kb/241789)</span></span>

        HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\IgnoreGCFailures



### <a name="dns-and-domain-controller-on-different-machines"></a><span data-ttu-id="f868d-226">DNS y controlador de dominio en equipos diferentes</span><span class="sxs-lookup"><span data-stu-id="f868d-226">DNS and domain controller on different machines</span></span>
<span data-ttu-id="f868d-227">Si DNS no está en hello misma máquina virtual como controlador de dominio de hello, deberá toocreate una VM de DNS para la conmutación por error de prueba de Hola.</span><span class="sxs-lookup"><span data-stu-id="f868d-227">If DNS isn't on hello same virtual machine as hello domain controller, you need toocreate a DNS VM for hello test failover.</span></span> <span data-ttu-id="f868d-228">Si encuentra en Hola misma máquina virtual, puede omitir esta sección.</span><span class="sxs-lookup"><span data-stu-id="f868d-228">If they're on hello same VM, you can skip this section.</span></span>

<span data-ttu-id="f868d-229">Puede usar un nuevo servidor DNS y crear todas las zonas de hello necesario.</span><span class="sxs-lookup"><span data-stu-id="f868d-229">You can use a fresh DNS server and create all hello required zones.</span></span> <span data-ttu-id="f868d-230">Por ejemplo, si el dominio de Active Directory es contoso.com, puede crear una zona DNS con hello nombre contoso.com. las entradas de Hello correspondientes tooActive directorio deben actualizarse en DNS, como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="f868d-230">For example, if your Active Directory domain is contoso.com, you can create a DNS zone with hello name contoso.com. hello entries corresponding tooActive Directory must be updated in DNS, as follows:</span></span>

1. <span data-ttu-id="f868d-231">Asegúrese de que estos valores están en vigor antes de cualquier otra máquina virtual en el plan de recuperación de hello aparece:</span><span class="sxs-lookup"><span data-stu-id="f868d-231">Ensure these settings are in place before any other virtual machine in hello recovery plan comes up:</span></span>
   
   * <span data-ttu-id="f868d-232">zona de Hello debe denominarse después el nombre de raíz del bosque de Hola.</span><span class="sxs-lookup"><span data-stu-id="f868d-232">hello zone must be named after hello forest root name.</span></span>
   * <span data-ttu-id="f868d-233">zona de Hello debe estar basado en archivos.</span><span class="sxs-lookup"><span data-stu-id="f868d-233">hello zone must be file-backed.</span></span>
   * <span data-ttu-id="f868d-234">Hola zona debe estar habilitada para actualizaciones seguras y no seguras.</span><span class="sxs-lookup"><span data-stu-id="f868d-234">hello zone must be enabled for secure and non-secure updates.</span></span>
   * <span data-ttu-id="f868d-235">resolución de Hola de máquina virtual de controlador de hello dominio debe apuntar toohello dirección IP de la máquina virtual de hello DNS.</span><span class="sxs-lookup"><span data-stu-id="f868d-235">hello resolver of hello domain controller virtual machine should point toohello IP address of hello DNS virtual machine.</span></span>
2. <span data-ttu-id="f868d-236">Ejecute el siguiente comando en la máquina virtual de controlador de dominio de hello:</span><span class="sxs-lookup"><span data-stu-id="f868d-236">Run hello following command on domain controller virtual machine:</span></span>
   
    `nltest /dsregdns`
3. <span data-ttu-id="f868d-237">Agregar una zona en el servidor DNS de hello, permitir actualizaciones no seguras y agregue una entrada para él tooDNS:</span><span class="sxs-lookup"><span data-stu-id="f868d-237">Add a zone on hello DNS server, allow non-secure updates, and add an entry for it tooDNS:</span></span>
   
        dnscmd /zoneadd contoso.com  /Primary
        dnscmd /recordadd contoso.com  contoso.com. SOA %computername%.contoso.com. hostmaster. 1 15 10 1 1
        dnscmd /recordadd contoso.com %computername%  A <IP_OF_DNS_VM>
        dnscmd /config contoso.com /allowupdate 1

## <a name="next-steps"></a><span data-ttu-id="f868d-238">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="f868d-238">Next steps</span></span>
<span data-ttu-id="f868d-239">Lectura [¿qué cargas de trabajo se debe proteger?](site-recovery-workload.md) toolearn más sobre la protección de cargas de trabajo empresariales con Azure Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="f868d-239">Read [What workloads can I protect?](site-recovery-workload.md) toolearn more about protecting enterprise workloads with Azure Site Recovery.</span></span>


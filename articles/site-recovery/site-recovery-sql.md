---
title: "Replicación de aplicaciones con SQL Server y Azure Site Recovery | Microsoft Docs"
description: "En este artículo se describe cómo replicar SQL Server mediante Azure Site Recovery, una de las funcionalidades de recuperación ante desastres de SQL Server."
services: site-recovery
documentationcenter: 
author: prateek9us
manager: gauravd
editor: 
ms.assetid: 9126f5e8-e9ed-4c31-b6b4-bf969c12c184
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/11/2017
ms.author: pratshar
ms.openlocfilehash: e53f60979e01a0eabe118d3ae6457a61bd4b0ded
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/18/2017
---
# <a name="protect-sql-server-using-sql-server-disaster-recovery-and-azure-site-recovery"></a><span data-ttu-id="920be-103">Proteger SQL Server con la recuperación ante desastres de SQL Server y Azure Site Recovery</span><span class="sxs-lookup"><span data-stu-id="920be-103">Protect SQL Server using SQL Server disaster recovery and Azure Site Recovery</span></span>

<span data-ttu-id="920be-104">En este artículo se describe cómo proteger el back-end de SQL Server de una aplicación con una combinación de tecnologías de continuidad empresarial y recuperación ante desastres (BCDR) de SQL Server y [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="920be-104">This article describes how to protect the SQL Server back end of an application using a combination of SQL Server business continuity and disaster recovery (BCDR) technologies, and [Azure Site Recovery](site-recovery-overview.md).</span></span>

<span data-ttu-id="920be-105">Antes de empezar, asegúrese de que comprende las funcionalidades de recuperación ante desastres de SQL Server, incluidos los clústeres de conmutación por error, los grupos de disponibilidad AlwaysOn, la creación de reflejo de la base de datos y el trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="920be-105">Before you start, make sure you understand SQL Server disaster recovery capabilities, including failover clustering, Always On availability groups, database mirroring, and log shipping.</span></span>


## <a name="sql-server-deployments"></a><span data-ttu-id="920be-106">Implementaciones de SQL Server</span><span class="sxs-lookup"><span data-stu-id="920be-106">SQL Server deployments</span></span>

<span data-ttu-id="920be-107">Muchas cargas de trabajo usan SQL Server como base que, además, se puede integrar con aplicaciones como SharePoint, Dynamics y SAP para implementar servicios de datos.</span><span class="sxs-lookup"><span data-stu-id="920be-107">Many workloads use SQL Server as a foundation, and it can be integrated with apps such as SharePoint, Dynamics, and SAP, to implement data services.</span></span>  <span data-ttu-id="920be-108">SQL Server se puede implementar de varias maneras:</span><span class="sxs-lookup"><span data-stu-id="920be-108">SQL Server can be deployed in a number of ways:</span></span>

* <span data-ttu-id="920be-109">**Servidor SQL independiente**: SQL Server y todas las bases de datos se hospedan en una sola máquina (física o virtual).</span><span class="sxs-lookup"><span data-stu-id="920be-109">**Standalone SQL Server**: SQL Server and all databases are hosted on a single machine (physical or a virtual).</span></span> <span data-ttu-id="920be-110">Cuando se virtualiza, la agrupación en clústeres de host se utiliza para conseguir una elevada disponibilidad local.</span><span class="sxs-lookup"><span data-stu-id="920be-110">When virtualized, host clustering is used for local high availability.</span></span> <span data-ttu-id="920be-111">No se implementa alta disponibilidad de nivel de invitado.</span><span class="sxs-lookup"><span data-stu-id="920be-111">Guest-level high availability isn't implemented.</span></span>
* <span data-ttu-id="920be-112">**Instancias de agrupación en clústeres de conmutación por error de SQL Server**: dos o más nodos que ejecutan instancias de SQL Server con discos compartidos se configuran en un clúster de conmutación por error de Windows.</span><span class="sxs-lookup"><span data-stu-id="920be-112">**SQL Server Failover Clustering Instances (Always On FCI)**: Two or more nodes running SQL Server instanced with shared disks are configured in a Windows Failover cluster.</span></span> <span data-ttu-id="920be-113">Si un nodo está inactivo, el clúster puede conmutar por error SQL Server en otra instancia.</span><span class="sxs-lookup"><span data-stu-id="920be-113">If a node is down, the cluster can fail SQL Server over to another instance.</span></span> <span data-ttu-id="920be-114">Esta configuración normalmente se usa para implementar la alta disponibilidad en un sitio principal.</span><span class="sxs-lookup"><span data-stu-id="920be-114">This setup is typically used to implement high availability at a primary site.</span></span> <span data-ttu-id="920be-115">Esta implementación no protege frente a errores o una interrupción en la capa de almacenamiento compartido.</span><span class="sxs-lookup"><span data-stu-id="920be-115">This deployment doesn't protect against failure or outage in the shared storage layer.</span></span> <span data-ttu-id="920be-116">Un disco compartido se puede implementar con iSCSI, canal de fibra o VHDx compartido.</span><span class="sxs-lookup"><span data-stu-id="920be-116">A shared disk can be implemented using iSCSI, fiber channel or shared vhdx.</span></span>
* <span data-ttu-id="920be-117">**Grupos de disponibilidad AlwaysOn de SQL**: se configuran dos o más nodos en un clúster no compartido, con bases de datos SQL Server configuradas en un grupo de disponibilidad, con replicación sincrónica y conmutación por error automática.</span><span class="sxs-lookup"><span data-stu-id="920be-117">**SQL Always On Availability Groups**: Two or more nodes are set up in a shared nothing cluster, with SQL Server databases configured in an availability group, with synchronous replication and automatic failover.</span></span>

 <span data-ttu-id="920be-118">En este artículo se aprovechan las siguientes tecnologías nativas de recuperación ante desastres de SQL para recuperar bases datos en un sitio de remoto:</span><span class="sxs-lookup"><span data-stu-id="920be-118">This article leverages the following native SQL disaster recovery technologies for recovering databases to a remote site:</span></span>

* <span data-ttu-id="920be-119">Grupos de disponibilidad AlwayOn de SQL para proponer recuperación ante desastres para ediciones empresariales de SQL 2012 o 2014.</span><span class="sxs-lookup"><span data-stu-id="920be-119">SQL Always On Availability Groups, to provide for disaster recovery for SQL Server 2012 or 2014 Enterprise editions.</span></span>
* <span data-ttu-id="920be-120">Reflejo de base de datos SQL en modo de alta seguridad para SQL Server Standard Edition (cualquier versión) o SQL Server 2008 R2.</span><span class="sxs-lookup"><span data-stu-id="920be-120">SQL database mirroring in high safety mode, for SQL Server Standard edition (any version), or for SQL Server 2008 R2.</span></span>

## <a name="site-recovery-support"></a><span data-ttu-id="920be-121">Compatibilidad de Site Recovery</span><span class="sxs-lookup"><span data-stu-id="920be-121">Site Recovery support</span></span>

### <a name="supported-scenarios"></a><span data-ttu-id="920be-122">Escenarios admitidos</span><span class="sxs-lookup"><span data-stu-id="920be-122">Supported scenarios</span></span>
<span data-ttu-id="920be-123">Site Recovery puede proteger SQL Server como se resume en la tabla.</span><span class="sxs-lookup"><span data-stu-id="920be-123">Site Recovery can protect SQL Server as summarized in the table.</span></span>

<span data-ttu-id="920be-124">**Escenario**</span><span class="sxs-lookup"><span data-stu-id="920be-124">**Scenario**</span></span> | <span data-ttu-id="920be-125">**En un sitio secundario**</span><span class="sxs-lookup"><span data-stu-id="920be-125">**To a secondary site**</span></span> | <span data-ttu-id="920be-126">**En Azure**</span><span class="sxs-lookup"><span data-stu-id="920be-126">**To Azure**</span></span>
--- | --- | ---
<span data-ttu-id="920be-127">**Hyper-V**</span><span class="sxs-lookup"><span data-stu-id="920be-127">**Hyper-V**</span></span> | <span data-ttu-id="920be-128">Sí</span><span class="sxs-lookup"><span data-stu-id="920be-128">Yes</span></span> | <span data-ttu-id="920be-129">Sí</span><span class="sxs-lookup"><span data-stu-id="920be-129">Yes</span></span>
<span data-ttu-id="920be-130">**VMware**</span><span class="sxs-lookup"><span data-stu-id="920be-130">**VMware**</span></span> | <span data-ttu-id="920be-131">Sí</span><span class="sxs-lookup"><span data-stu-id="920be-131">Yes</span></span> | <span data-ttu-id="920be-132">Sí</span><span class="sxs-lookup"><span data-stu-id="920be-132">Yes</span></span>
<span data-ttu-id="920be-133">**Servidor físico**</span><span class="sxs-lookup"><span data-stu-id="920be-133">**Physical server**</span></span> | <span data-ttu-id="920be-134">Sí</span><span class="sxs-lookup"><span data-stu-id="920be-134">Yes</span></span> | <span data-ttu-id="920be-135">Sí</span><span class="sxs-lookup"><span data-stu-id="920be-135">Yes</span></span>

### <a name="supported-sql-server-versions"></a><span data-ttu-id="920be-136">Versiones admitidas de SQL Server</span><span class="sxs-lookup"><span data-stu-id="920be-136">Supported SQL Server versions</span></span>
<span data-ttu-id="920be-137">Se admiten estas versiones de SQL Server en los escenarios admitidos:</span><span class="sxs-lookup"><span data-stu-id="920be-137">These SQL Server versions are supported, for the supported scenarios:</span></span>

* <span data-ttu-id="920be-138">SQL Server 2016 Enterprise y Standard</span><span class="sxs-lookup"><span data-stu-id="920be-138">SQL Server 2016 Enterprise and Standard</span></span>
* <span data-ttu-id="920be-139">SQL Server 2014 Enterprise y Standard</span><span class="sxs-lookup"><span data-stu-id="920be-139">SQL Server 2014 Enterprise and Standard</span></span>
* <span data-ttu-id="920be-140">SQL Server 2012 Enterprise y Standard</span><span class="sxs-lookup"><span data-stu-id="920be-140">SQL Server 2012 Enterprise and Standard</span></span>
* <span data-ttu-id="920be-141">SQL Server 2008 R2 Enterprise y Standard</span><span class="sxs-lookup"><span data-stu-id="920be-141">SQL Server 2008 R2 Enterprise and Standard</span></span>

### <a name="supported-sql-server-integration"></a><span data-ttu-id="920be-142">Integración de SQL Server admitida</span><span class="sxs-lookup"><span data-stu-id="920be-142">Supported SQL Server integration</span></span>

<span data-ttu-id="920be-143">Site Recovery se puede integrar con las tecnologías nativas de SQL Server BCDR resumidas en la tabla para proporcionar una solución de recuperación ante desastres.</span><span class="sxs-lookup"><span data-stu-id="920be-143">Site Recovery can be integrated with native SQL Server BCDR technologies summarized in the table, to provide a disaster recovery solution.</span></span>

<span data-ttu-id="920be-144">**Característica**</span><span class="sxs-lookup"><span data-stu-id="920be-144">**Feature**</span></span> | <span data-ttu-id="920be-145">**Detalles**</span><span class="sxs-lookup"><span data-stu-id="920be-145">**Details**</span></span> | <span data-ttu-id="920be-146">**SQL Server**</span><span class="sxs-lookup"><span data-stu-id="920be-146">**SQL Server**</span></span> |
--- | --- | ---
<span data-ttu-id="920be-147">**Grupos de disponibilidad AlwaysOn**</span><span class="sxs-lookup"><span data-stu-id="920be-147">**Always On availability group**</span></span> | <span data-ttu-id="920be-148">Se ejecutan varias instancias independientes de SQL Server, cada una en un clúster de conmutación por error que tiene varios nodos.</span><span class="sxs-lookup"><span data-stu-id="920be-148">Multiple standalone instances of SQL Server each run in a failover cluster that has multiple nodes.</span></span><br/><br/><span data-ttu-id="920be-149">Las bases de datos se pueden agrupar en grupos de conmutación por error que se puede copiar (reflejar) en instancias de SQL Server para que no se necesite ningún almacenamiento compartido.</span><span class="sxs-lookup"><span data-stu-id="920be-149">Databases can be grouped into failover groups that can be copied (mirrored) on SQL Server instances so that no shared storage is needed.</span></span><br/><br/><span data-ttu-id="920be-150">Proporciona recuperación ante desastres entre un sitio principal y uno o más sitios secundarios.</span><span class="sxs-lookup"><span data-stu-id="920be-150">Provides disaster recovery between a primary site and one or more secondary sites.</span></span> <span data-ttu-id="920be-151">Dos nodos pueden configurarse en un clúster no compartido con Bases de datos de SQL Server configurado en un grupo de disponibilidad con replicación sincrónica y conmutación por error automática.</span><span class="sxs-lookup"><span data-stu-id="920be-151">Two nodes can be set up in a shared nothing cluster with SQL Server databases configured in an availability group with synchronous replication and automatic failover.</span></span> | <span data-ttu-id="920be-152">SQL Server 2014 y 2012 Enterprise Edition</span><span class="sxs-lookup"><span data-stu-id="920be-152">SQL Server 2014 & 2012 Enterprise edition</span></span>
<span data-ttu-id="920be-153">**Clústeres de conmutación por error (FCI AlwaysOn)**</span><span class="sxs-lookup"><span data-stu-id="920be-153">**Failover clustering (Always On FCI)**</span></span> | <span data-ttu-id="920be-154">SQL Server aprovecha la agrupación en clústeres de conmutación por error de Windows para conseguir alta disponibilidad de las cargas de trabajo locales de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="920be-154">SQL Server leverages Windows failover clustering for high availability of on-premises SQL Server workloads.</span></span><br/><br/><span data-ttu-id="920be-155">Los nodos que ejecutan instancias de SQL Server con discos compartidos se configuran en un clúster de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="920be-155">Nodes running instances of SQL Server with shared disks are configured in a failover cluster.</span></span> <span data-ttu-id="920be-156">Si una instancia está inactiva, el clúster conmuta por error a una diferente.</span><span class="sxs-lookup"><span data-stu-id="920be-156">If an instance is down the cluster fails over to different one.</span></span><br/><br/><span data-ttu-id="920be-157">El clúster no protege frente a errores o interrupciones en el almacenamiento compartido.</span><span class="sxs-lookup"><span data-stu-id="920be-157">The cluster doesn't protect against failure or outages in shared storage.</span></span> <span data-ttu-id="920be-158">El disco compartido se puede implementar con iSCSI, canal de fibra o VHDX compartido.</span><span class="sxs-lookup"><span data-stu-id="920be-158">The shared disk can be implemented with iSCSI, fiber channel, or shared VHDXs.</span></span> | <span data-ttu-id="920be-159">SQL Server Enterprise Edition</span><span class="sxs-lookup"><span data-stu-id="920be-159">SQL Server Enterprise editions</span></span><br/><br/><span data-ttu-id="920be-160">SQL Server Standard Edition (limitada a solo dos nodos)</span><span class="sxs-lookup"><span data-stu-id="920be-160">SQL Server Standard edition (limited to two nodes only)</span></span>
<span data-ttu-id="920be-161">**Creación de un reflejo de la base de datos (modo de alta seguridad)**</span><span class="sxs-lookup"><span data-stu-id="920be-161">**Database mirroring (high safety mode)**</span></span> | <span data-ttu-id="920be-162">Protege una sola base de datos en una única copia secundaria.</span><span class="sxs-lookup"><span data-stu-id="920be-162">Protects a single database to a single secondary copy.</span></span> <span data-ttu-id="920be-163">Disponible en modos de replicación de seguridad alta (sincrónica) y de alto rendimiento (asincrónica).</span><span class="sxs-lookup"><span data-stu-id="920be-163">Available in both high safety (synchronous) and high performance (asynchronous) replication modes.</span></span> <span data-ttu-id="920be-164">No requiere un clúster de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="920be-164">Doesn’t require a failover cluster.</span></span> | <span data-ttu-id="920be-165">SQL Server 2008 R2</span><span class="sxs-lookup"><span data-stu-id="920be-165">SQL Server 2008 R2</span></span><br/><br/><span data-ttu-id="920be-166">Todas las ediciones de SQL Server Enterprise</span><span class="sxs-lookup"><span data-stu-id="920be-166">SQL Server Enterprise all editions</span></span>
<span data-ttu-id="920be-167">**SQL Server independiente**</span><span class="sxs-lookup"><span data-stu-id="920be-167">**Standalone SQL Server**</span></span> | <span data-ttu-id="920be-168">SQL Server y la base de datos se hospedan en un único servidor (físico o virtual).</span><span class="sxs-lookup"><span data-stu-id="920be-168">The SQL Server and database are hosted on a single server (physical or virtual).</span></span> <span data-ttu-id="920be-169">Los clústeres de host se utilizan para lograr alta disponibilidad, si el servidor virtual.</span><span class="sxs-lookup"><span data-stu-id="920be-169">Host clustering is used for high availability if the server is virtual.</span></span> <span data-ttu-id="920be-170">Sin alta disponibilidad de nivel de invitado.</span><span class="sxs-lookup"><span data-stu-id="920be-170">No guest-level high availability.</span></span> | <span data-ttu-id="920be-171">Edición Enterprise o Standard</span><span class="sxs-lookup"><span data-stu-id="920be-171">Enterprise or Standard edition</span></span>

## <a name="deployment-recommendations"></a><span data-ttu-id="920be-172">Recomendaciones de implementación</span><span class="sxs-lookup"><span data-stu-id="920be-172">Deployment recommendations</span></span>

<span data-ttu-id="920be-173">En la siguiente tabla se resumen nuestras recomendaciones para integrar las tecnologías de SQL Server BCDR con Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="920be-173">This table summarizes our recommendations for integrating SQL Server BCDR technologies with Site Recovery.</span></span>

| <span data-ttu-id="920be-174">**Versión**</span><span class="sxs-lookup"><span data-stu-id="920be-174">**Version**</span></span> | <span data-ttu-id="920be-175">**Edición**</span><span class="sxs-lookup"><span data-stu-id="920be-175">**Edition**</span></span> | <span data-ttu-id="920be-176">**Implementación**</span><span class="sxs-lookup"><span data-stu-id="920be-176">**Deployment**</span></span> | <span data-ttu-id="920be-177">**De local a local**</span><span class="sxs-lookup"><span data-stu-id="920be-177">**On-prem to on-prem**</span></span> | <span data-ttu-id="920be-178">**De local a Azure**</span><span class="sxs-lookup"><span data-stu-id="920be-178">**On-prem to Azure**</span></span> |
| --- | --- | --- | --- | --- |
| <span data-ttu-id="920be-179">SQL Server 2014 o 2012</span><span class="sxs-lookup"><span data-stu-id="920be-179">SQL Server 2014 or 2012</span></span> |<span data-ttu-id="920be-180">Enterprise</span><span class="sxs-lookup"><span data-stu-id="920be-180">Enterprise</span></span> |<span data-ttu-id="920be-181">Instancia de clúster de conmutación por error</span><span class="sxs-lookup"><span data-stu-id="920be-181">Failover cluster instance</span></span> |<span data-ttu-id="920be-182">Grupos de disponibilidad AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="920be-182">Always On availability groups</span></span> |<span data-ttu-id="920be-183">Grupos de disponibilidad AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="920be-183">Always On availability groups</span></span> |
|| <span data-ttu-id="920be-184">Enterprise</span><span class="sxs-lookup"><span data-stu-id="920be-184">Enterprise</span></span> |<span data-ttu-id="920be-185">Grupos de disponibilidad AlwaysOn para alta disponibilidad</span><span class="sxs-lookup"><span data-stu-id="920be-185">Always On availability groups for high availability</span></span> |<span data-ttu-id="920be-186">Grupos de disponibilidad AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="920be-186">Always On availability groups</span></span> |<span data-ttu-id="920be-187">Grupos de disponibilidad AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="920be-187">Always On availability groups</span></span> | |
|| <span data-ttu-id="920be-188">Standard</span><span class="sxs-lookup"><span data-stu-id="920be-188">Standard</span></span> |<span data-ttu-id="920be-189">Instancia de clúster de conmutación por error (FCI)</span><span class="sxs-lookup"><span data-stu-id="920be-189">Failover cluster instance (FCI)</span></span> |<span data-ttu-id="920be-190">Replicación de Site Recovery con un reflejo local</span><span class="sxs-lookup"><span data-stu-id="920be-190">Site Recovery replication with local mirror</span></span> |<span data-ttu-id="920be-191">Replicación de Site Recovery con un reflejo local</span><span class="sxs-lookup"><span data-stu-id="920be-191">Site Recovery replication with local mirror</span></span> | |
|| <span data-ttu-id="920be-192">Enterprise o Standard</span><span class="sxs-lookup"><span data-stu-id="920be-192">Enterprise or Standard</span></span> |<span data-ttu-id="920be-193">Independiente</span><span class="sxs-lookup"><span data-stu-id="920be-193">Standalone</span></span> |<span data-ttu-id="920be-194">Replicación de Site Recovery</span><span class="sxs-lookup"><span data-stu-id="920be-194">Site Recovery replication</span></span> |<span data-ttu-id="920be-195">Replicación de Site Recovery</span><span class="sxs-lookup"><span data-stu-id="920be-195">Site Recovery replication</span></span> | |
| <span data-ttu-id="920be-196">SQL Server 2008 R2 o 2008</span><span class="sxs-lookup"><span data-stu-id="920be-196">SQL Server 2008 R2 or 2008</span></span> |<span data-ttu-id="920be-197">Enterprise o Standard</span><span class="sxs-lookup"><span data-stu-id="920be-197">Enterprise or Standard</span></span> |<span data-ttu-id="920be-198">Instancia de clúster de conmutación por error (FCI)</span><span class="sxs-lookup"><span data-stu-id="920be-198">Failover cluster instance (FCI)</span></span> |<span data-ttu-id="920be-199">Replicación de Site Recovery con un reflejo local</span><span class="sxs-lookup"><span data-stu-id="920be-199">Site Recovery replication with local mirror</span></span> |<span data-ttu-id="920be-200">Replicación de Site Recovery con un reflejo local</span><span class="sxs-lookup"><span data-stu-id="920be-200">Site Recovery replication with local mirror</span></span> |
|| <span data-ttu-id="920be-201">Enterprise o Standard</span><span class="sxs-lookup"><span data-stu-id="920be-201">Enterprise or Standard</span></span> |<span data-ttu-id="920be-202">Independiente</span><span class="sxs-lookup"><span data-stu-id="920be-202">Standalone</span></span> |<span data-ttu-id="920be-203">Replicación de Site Recovery</span><span class="sxs-lookup"><span data-stu-id="920be-203">Site Recovery replication</span></span> |<span data-ttu-id="920be-204">Replicación de Site Recovery</span><span class="sxs-lookup"><span data-stu-id="920be-204">Site Recovery replication</span></span> | |
| <span data-ttu-id="920be-205">SQL Server (cualquier versión)</span><span class="sxs-lookup"><span data-stu-id="920be-205">SQL Server (Any version)</span></span> |<span data-ttu-id="920be-206">Enterprise o Standard</span><span class="sxs-lookup"><span data-stu-id="920be-206">Enterprise or Standard</span></span> |<span data-ttu-id="920be-207">Instancia de clúster de conmutación por error: aplicación de DTC</span><span class="sxs-lookup"><span data-stu-id="920be-207">Failover cluster instance - DTC application</span></span> |<span data-ttu-id="920be-208">Replicación de Site Recovery</span><span class="sxs-lookup"><span data-stu-id="920be-208">Site Recovery replication</span></span> |<span data-ttu-id="920be-209">No compatible</span><span class="sxs-lookup"><span data-stu-id="920be-209">Not Supported</span></span> |

## <a name="deployment-prerequisites"></a><span data-ttu-id="920be-210">Requisitos previos de implementación</span><span class="sxs-lookup"><span data-stu-id="920be-210">Deployment prerequisites</span></span>

* <span data-ttu-id="920be-211">La implementación local de SQL Server ejecuta una versión compatible de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="920be-211">An on-premises SQL Server deployment, running a supported SQL Server version.</span></span> <span data-ttu-id="920be-212">Normalmente, también necesitará Active Directory para SQL Server.</span><span class="sxs-lookup"><span data-stu-id="920be-212">Typically, you also need Active Directory for your SQL server.</span></span>
* <span data-ttu-id="920be-213">Requisitos para el escenario que desea implementar.</span><span class="sxs-lookup"><span data-stu-id="920be-213">The requirements for the scenario you want to deploy.</span></span> <span data-ttu-id="920be-214">Obtenga más información sobre los requisitos de compatibilidad para la [replicación en Azure](site-recovery-support-matrix-to-azure.md) y la replicación [local](site-recovery-support-matrix.md), y los [requisitos previos de implementación](site-recovery-prereq.md).</span><span class="sxs-lookup"><span data-stu-id="920be-214">Learn more about support requirements for [replication to Azure](site-recovery-support-matrix-to-azure.md) and [on-premises](site-recovery-support-matrix.md), and [deployment prerequisites](site-recovery-prereq.md).</span></span>
* <span data-ttu-id="920be-215">Para configurar la recuperación de Azure, ejecute la herramienta [Evaluación de preparación de máquinas virtuales de Azure](http://www.microsoft.com/download/details.aspx?id=40898) en sus máquinas virtuales de SQL Server para asegurarse de que son compatibles con Azure y Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="920be-215">To set up recovery in Azure, run the [Azure Virtual Machine Readiness Assessment](http://www.microsoft.com/download/details.aspx?id=40898) tool on your SQL Server virtual machines, to make sure they're compatible with Azure and Site Recovery.</span></span>

## <a name="set-up-active-directory"></a><span data-ttu-id="920be-216">Configuración de Active Directory</span><span class="sxs-lookup"><span data-stu-id="920be-216">Set up Active Directory</span></span>

<span data-ttu-id="920be-217">Configure Active Directory en el sitio de recuperación secundario para que SQL Server se ejecute correctamente.</span><span class="sxs-lookup"><span data-stu-id="920be-217">Set up Active Directory, in the secondary recovery site, for SQL Server to run properly.</span></span>

* <span data-ttu-id="920be-218">**Empresas pequeñas**: con un pequeño número de aplicaciones y un solo controlador de dominio para el sitio local, si desea conmutar por error todo el sitio, se recomienda utilizar la replicación de Site Recovery para replicar el controlador de dominio en el centro de datos secundario o en Azure.</span><span class="sxs-lookup"><span data-stu-id="920be-218">**Small enterprise**—With a small number of applications, and single domain controller for the on-premises site, if you want to fail over the entire site, we recommend you use Site Recovery replication to replicate the domain controller to the secondary datacenter, or to Azure.</span></span>
* <span data-ttu-id="920be-219">**Empresas medianas y grandes**: si tiene un gran número de aplicaciones, un bosque de Active Directory y desea que la conmutación por error se realice por aplicaciones o cargas de trabajo, se recomienda configurar un controlador de dominio adicional en el centro de datos secundario o en Azure.</span><span class="sxs-lookup"><span data-stu-id="920be-219">**Medium to large enterprise**—If you have a large number of applications, an Active Directory forest, and you want to fail over by application or workload, we recommend you set up an additional domain controller in the secondary datacenter, or in Azure.</span></span> <span data-ttu-id="920be-220">Si usa grupos de disponibilidad AlwaysOn para recuperar en un sitio remoto, se recomienda configurar otro controlador de dominio adicional en el sitio secundario o en Azure, que se utilizará para la instancia de SQL Server recuperada.</span><span class="sxs-lookup"><span data-stu-id="920be-220">If you're using Always On availability groups to recover to a remote site, we recommend you set up another additional domain controller on the secondary site or in Azure, to use for the recovered SQL Server instance.</span></span>

<span data-ttu-id="920be-221">Las instrucciones de este artículo suponen que un controlador de dominio está disponible en la ubicación secundaria.</span><span class="sxs-lookup"><span data-stu-id="920be-221">The instructions in this article presume that a domain controller is available in the secondary location.</span></span> <span data-ttu-id="920be-222">[Más información](site-recovery-active-directory.md) sobre la protección de Active Directory con Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="920be-222">[Read more](site-recovery-active-directory.md) about protecting Active Directory with Site Recovery.</span></span>


## <a name="integrate-with-sql-server-always-on-for-replication-to-azure"></a><span data-ttu-id="920be-223">Integración con SQL Server AlwaysOn para la replicación en Azure</span><span class="sxs-lookup"><span data-stu-id="920be-223">Integrate with SQL Server Always On for replication to Azure</span></span>

<span data-ttu-id="920be-224">Esto es lo que debe hacer:</span><span class="sxs-lookup"><span data-stu-id="920be-224">Here's what you need to do:</span></span>

1. <span data-ttu-id="920be-225">Importe scripts en su cuenta de Azure Automation.</span><span class="sxs-lookup"><span data-stu-id="920be-225">Import scripts into your Azure Automation account.</span></span> <span data-ttu-id="920be-226">Esta cuenta contiene los scripts para conmutar por error grupos de disponibilidad de SQL en una [máquina virtual de Resource Manager](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/asr-automation-recovery/scripts/ASR-SQL-FailoverAG.ps1) y una [máquina virtual clásica](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/asr-automation-recovery/scripts/ASR-SQL-FailoverAGClassic.ps1).</span><span class="sxs-lookup"><span data-stu-id="920be-226">This contains the scripts to failover SQL Availability Group in a [Resource Manager virtual machine](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/asr-automation-recovery/scripts/ASR-SQL-FailoverAG.ps1) and a [Classic virtual machine](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/asr-automation-recovery/scripts/ASR-SQL-FailoverAGClassic.ps1).</span></span>

    <span data-ttu-id="920be-227">[![Implementación en Azure](https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c4803408-340e-49e3-9a1f-0ed3f689813d.png)](https://aka.ms/asr-automationrunbooks-deploy)</span><span class="sxs-lookup"><span data-stu-id="920be-227">[![Deploy to Azure](https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c4803408-340e-49e3-9a1f-0ed3f689813d.png)](https://aka.ms/asr-automationrunbooks-deploy)</span></span>


1. <span data-ttu-id="920be-228">Agregue ASR-SQL-FailoverAG como acción previa del primer grupo del plan de recuperación.</span><span class="sxs-lookup"><span data-stu-id="920be-228">Add ASR-SQL-FailoverAG as a pre action of the first group of the recovery plan.</span></span>

1. <span data-ttu-id="920be-229">Siga las instrucciones disponibles en el script para crear una variable de automatización para proporcionar el nombre de los grupos de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="920be-229">Follow the instructions available in the script to create an automation variable to provide the name of the availability groups.</span></span>

### <a name="steps-to-do-a-test-failover"></a><span data-ttu-id="920be-230">Pasos para realizar una conmutación por error de prueba</span><span class="sxs-lookup"><span data-stu-id="920be-230">Steps to do a test failover</span></span>

<span data-ttu-id="920be-231">SQL AlwaysOn no admite de forma nativa la conmutación por error de prueba.</span><span class="sxs-lookup"><span data-stu-id="920be-231">SQL Always On doesn’t natively support test failover.</span></span> <span data-ttu-id="920be-232">Por consiguiente, es recomendable que:</span><span class="sxs-lookup"><span data-stu-id="920be-232">Therefore, we recommend the following:</span></span>

1. <span data-ttu-id="920be-233">Configure [Azure Backup](../backup/backup-azure-vms.md) en la máquina virtual que hospeda la réplica del grupo de disponibilidad en Azure.</span><span class="sxs-lookup"><span data-stu-id="920be-233">Set up [Azure Backup](../backup/backup-azure-vms.md) on the virtual machine that hosts the availability group replica in Azure.</span></span>

1. <span data-ttu-id="920be-234">Antes de desencadenar la conmutación por error del plan de recuperación, recupere la máquina virtual a partir de la copia de seguridad realizada en el paso anterior.</span><span class="sxs-lookup"><span data-stu-id="920be-234">Before triggering test failover of the recovery plan, recover the virtual machine from the backup taken in the previous step.</span></span>

    ![<span data-ttu-id="920be-235">Restauración de datos de Azure Backup</span><span class="sxs-lookup"><span data-stu-id="920be-235">Restore from Azure Backup</span></span> ](./media/site-recovery-sql/restore-from-backup.png)

1. <span data-ttu-id="920be-236">[Fuerce un quórum](https://docs.microsoft.com/sql/sql-server/failover-clusters/windows/force-a-wsfc-cluster-to-start-without-a-quorum#PowerShellProcedure) en la máquina virtual restaurada de la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="920be-236">[Force a quorum](https://docs.microsoft.com/sql/sql-server/failover-clusters/windows/force-a-wsfc-cluster-to-start-without-a-quorum#PowerShellProcedure) in the virtual machine restored from backup.</span></span>

1. <span data-ttu-id="920be-237">Actualice la IP del agente de escucha a una dirección IP disponible en la red de conmutación por error de prueba.</span><span class="sxs-lookup"><span data-stu-id="920be-237">Update IP of the listener to an IP available in the test failover network.</span></span>

    ![Actualización de la dirección IP del agente de escucha](./media/site-recovery-sql/update-listener-ip.png)

1. <span data-ttu-id="920be-239">Conecte el agente de escucha.</span><span class="sxs-lookup"><span data-stu-id="920be-239">Bring listener online.</span></span>

    ![Conexión del agente de escucha](./media/site-recovery-sql/bring-listener-online.png)

1. <span data-ttu-id="920be-241">Cree un equilibrador de carga con una dirección IP creada en el grupo de direcciones IP de front-end correspondiente a cada agente de escucha de grupo de disponibilidad y con la máquina virtual SQL agregada en el grupo de back-end.</span><span class="sxs-lookup"><span data-stu-id="920be-241">Create a load balancer with one IP created under frontend IP pool corresponding to each availability group listener and with the SQL virtual machine added in the backend pool.</span></span>

     ![<span data-ttu-id="920be-242">Creación del equilibrador de carga: grupo de direcciones IP de front-end</span><span class="sxs-lookup"><span data-stu-id="920be-242">Create Load Balancer - Frontend IP pool</span></span> ](./media/site-recovery-sql/create-load-balancer1.png)

    ![<span data-ttu-id="920be-243">Creación del equilibrador de carga: grupo de direcciones IP de back-end</span><span class="sxs-lookup"><span data-stu-id="920be-243">Create Load Balancer - Backend pool</span></span> ](./media/site-recovery-sql/create-load-balancer2.png)

1. <span data-ttu-id="920be-244">Realice una conmutación por error del plan de recuperación.</span><span class="sxs-lookup"><span data-stu-id="920be-244">Do a test failover of the recovery plan.</span></span>

### <a name="steps-to-do-a-failover"></a><span data-ttu-id="920be-245">Pasos para realizar una conmutación por error</span><span class="sxs-lookup"><span data-stu-id="920be-245">Steps to do a failover</span></span>

<span data-ttu-id="920be-246">Una vez que ha agregado el script en el plan de recuperación y ha validado el plan de recuperación mediante una conmutación por error de prueba, puede realizar una conmutación por error del plan de recuperación.</span><span class="sxs-lookup"><span data-stu-id="920be-246">Once you have added the script in the recovery plan and validated the recovery plan by doing a test failover, you can do failover of the recovery plan.</span></span>


## <a name="integrate-with-sql-server-always-on-for-replication-to-a-secondary-on-premises-site"></a><span data-ttu-id="920be-247">Integración con SQL Server Always On para la replicación en un sitio local secundario</span><span class="sxs-lookup"><span data-stu-id="920be-247">Integrate with SQL Server Always On for replication to a secondary on-premises site</span></span>

<span data-ttu-id="920be-248">Si el servidor SQL Server utiliza grupos de disponibilidad para alta disponibilidad (o un FCI), se recomienda utilizar también grupos de disponibilidad en el sitio de recuperación.</span><span class="sxs-lookup"><span data-stu-id="920be-248">If the SQL Server is using availability groups for high availability (or an FCI), we recommend using availability groups on the recovery site as well.</span></span> <span data-ttu-id="920be-249">Tenga en cuenta que esto es aplicable a aplicaciones que no utilizan transacciones distribuidas.</span><span class="sxs-lookup"><span data-stu-id="920be-249">Note that this applies to apps that don't use distributed transactions.</span></span>

1. <span data-ttu-id="920be-250">[Configure bases de datos](https://msdn.microsoft.com/library/hh213078.aspx) en grupos de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="920be-250">[Configure databases](https://msdn.microsoft.com/library/hh213078.aspx) into availability groups.</span></span>
1. <span data-ttu-id="920be-251">Cree una red virtual en el sitio secundario.</span><span class="sxs-lookup"><span data-stu-id="920be-251">Create a virtual network on the secondary site.</span></span>
1. <span data-ttu-id="920be-252">Configure una conexión VPN de sitio a sitio entre la red virtual y el sitio principal.</span><span class="sxs-lookup"><span data-stu-id="920be-252">Set up a site-to-site VPN connection between the virtual network, and the primary site.</span></span>
1. <span data-ttu-id="920be-253">Cree una máquina virtual en el sitio de recuperación e instale SQL Server en ella.</span><span class="sxs-lookup"><span data-stu-id="920be-253">Create a virtual machine on the recovery site, and install SQL Server on it.</span></span>
1. <span data-ttu-id="920be-254">Amplíe los grupos de disponibilidad AlwaysOn existentes a la nueva VM con SQL Server.</span><span class="sxs-lookup"><span data-stu-id="920be-254">Extend the existing Always On availability groups to the new SQL Server VM.</span></span> <span data-ttu-id="920be-255">Configure esta instancia de SQL Server como una copia de réplica asincrónica.</span><span class="sxs-lookup"><span data-stu-id="920be-255">Configure this SQL Server instance as an asynchronous replica copy.</span></span>
1. <span data-ttu-id="920be-256">Cree un agente de escucha del grupo de disponibilidad o actualice el agente de escucha existente para incluir la máquina virtual de réplica asincrónica.</span><span class="sxs-lookup"><span data-stu-id="920be-256">Create an availability group listener, or update the existing listener to include the asynchronous replica virtual machine.</span></span>
1. <span data-ttu-id="920be-257">Asegúrese de que la granja de aplicaciones está configurada con el agente de escucha.</span><span class="sxs-lookup"><span data-stu-id="920be-257">Make sure that the application farm is set up using the listener.</span></span> <span data-ttu-id="920be-258">Si realiza la configuración mediante el nombre del servidor de la base de datos, actualícelo para utilizar el agente de escucha para que no tenga que volver a configurar después de la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="920be-258">If it's setup up using the database server name, update it to use the listener, so you don't need to reconfigure it after the failover.</span></span>

<span data-ttu-id="920be-259">Para las aplicaciones que usan transacciones distribuidas, le recomendamos implementar Site Recovery con la [replicación entre sitios de VMware o servidores físicos](site-recovery-vmware-to-vmware.md).</span><span class="sxs-lookup"><span data-stu-id="920be-259">For applications that use distributed transactions, we recommend you deploy Site Recovery with [VMware/physical server site-to-site replication](site-recovery-vmware-to-vmware.md).</span></span>

### <a name="recovery-plan-considerations"></a><span data-ttu-id="920be-260">Consideraciones del plan de recuperación</span><span class="sxs-lookup"><span data-stu-id="920be-260">Recovery plan considerations</span></span>
1. <span data-ttu-id="920be-261">Agregue este script de ejemplo a la biblioteca de VMM en los sitios principales y secundarios.</span><span class="sxs-lookup"><span data-stu-id="920be-261">Add this sample script to the VMM library, on the primary and secondary sites.</span></span>

        Param(
        [string]$SQLAvailabilityGroupPath
        )
        import-module sqlps
        Switch-SqlAvailabilityGroup -Path $SQLAvailabilityGroupPath -AllowDataLoss -force

1. <span data-ttu-id="920be-262">Al crear un plan de recuperación para la aplicación, agregue una acción previa al paso de script Group-1, que invoca el script para realizar la conmutación por error de grupos de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="920be-262">When you create a recovery plan for the application, add a pre action to Group-1 scripted step, that invokes the script to fail over availability groups.</span></span>

## <a name="protect-a-standalone-sql-server"></a><span data-ttu-id="920be-263">Protección de un servidor SQL Server independiente</span><span class="sxs-lookup"><span data-stu-id="920be-263">Protect a standalone SQL Server</span></span>

<span data-ttu-id="920be-264">En este escenario, se recomienda que utilice la replicación de Site Recovery para proteger la máquina de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="920be-264">In this scenario, we recommend that you use Site Recovery replication to protect the SQL Server machine.</span></span> <span data-ttu-id="920be-265">Los pasos exactos dependerán de si SQL Server está en una máquina virtual o en un servidor físico y si desea replicar en Azure o en un sitio local secundario.</span><span class="sxs-lookup"><span data-stu-id="920be-265">The exact steps will depend whether SQL Server is a VM or a physical server, and whether you want to replicate to Azure or a secondary on-premises site.</span></span> <span data-ttu-id="920be-266">Más información acerca de [escenarios de Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="920be-266">Learn about [Site Recovery scenarios](site-recovery-overview.md).</span></span>

## <a name="protect-a-sql-server-cluster-standard-editionwindows-server-2008-r2"></a><span data-ttu-id="920be-267">Protección de un clúster de SQL Server (Standard Edition o Windows Server 2008 R2)</span><span class="sxs-lookup"><span data-stu-id="920be-267">Protect a SQL Server cluster (standard edition/Windows Server 2008 R2)</span></span>

<span data-ttu-id="920be-268">Para un clúster que ejecuta SQL Server Standard Edition o SQL Server 2008 R2, se recomienda utilizar la replicación de Site Recovery para proteger SQL Server.</span><span class="sxs-lookup"><span data-stu-id="920be-268">For a cluster running SQL Server Standard edition, or SQL Server 2008 R2, we recommend you use Site Recovery replication to protect SQL Server.</span></span>

### <a name="on-premises-to-on-premises"></a><span data-ttu-id="920be-269">De local a local</span><span class="sxs-lookup"><span data-stu-id="920be-269">On-premises to on-premises</span></span>

* <span data-ttu-id="920be-270">Si la aplicación usa transacciones distribuidas, se recomienda implementar [Site Recovery con la replicación de SAN](site-recovery-vmm-san.md) en caso de un entorno de Hyper-V y [VMware/servidor físico a VMware](site-recovery-vmware-to-vmware.md) si se trata de un entorno de VMware.</span><span class="sxs-lookup"><span data-stu-id="920be-270">If the app uses distributed transactions we recommend you deploy [Site Recovery with SAN replication](site-recovery-vmm-san.md) for a Hyper-V environment, or [VMware/physical server to VMware](site-recovery-vmware-to-vmware.md) for a VMware environment.</span></span>
* <span data-ttu-id="920be-271">Para las aplicaciones que no sean DTC, use el enfoque anterior para recuperar el clúster como un servidor independiente mediante el uso de un reflejo de la base de datos local de seguridad alta.</span><span class="sxs-lookup"><span data-stu-id="920be-271">For non-DTC applications, use the above approach to recover the cluster as a standalone server, by leveraging a local high safety DB mirror.</span></span>

### <a name="on-premises-to-azure"></a><span data-ttu-id="920be-272">De local a Azure</span><span class="sxs-lookup"><span data-stu-id="920be-272">On-premises to Azure</span></span>

<span data-ttu-id="920be-273">Site Recovery no proporciona la compatibilidad con clústeres invitados al replicar en Azure.</span><span class="sxs-lookup"><span data-stu-id="920be-273">Site Recovery doesn't provide guest cluster support when replicating to Azure.</span></span> <span data-ttu-id="920be-274">SQL Server tampoco proporciona una solución de recuperación ante desastres de bajo costo para la edición Standard.</span><span class="sxs-lookup"><span data-stu-id="920be-274">SQL Server also doesn't provide a low-cost disaster recovery solution for Standard edition.</span></span> <span data-ttu-id="920be-275">En este escenario, se recomienda proteger el clúster de SQL Server local en un servidor SQL Server independiente y recuperarlo en Azure.</span><span class="sxs-lookup"><span data-stu-id="920be-275">In this scenario, we recommend you protect the on-premises SQL Server cluster to a standalone SQL Server, and recover it in Azure.</span></span>

1. <span data-ttu-id="920be-276">Configure una instancia de SQL Server independiente adicional en el sitio local.</span><span class="sxs-lookup"><span data-stu-id="920be-276">Configure an additional standalone SQL Server instance on the on-premises site.</span></span>
1. <span data-ttu-id="920be-277">Configure esta instancia para actuar como un reflejo para las bases de datos que desea proteger.</span><span class="sxs-lookup"><span data-stu-id="920be-277">Configure the instance to serve as a mirror for the databases you want to protect.</span></span> <span data-ttu-id="920be-278">Configure el reflejo en modo de alta seguridad.</span><span class="sxs-lookup"><span data-stu-id="920be-278">Configure mirroring in high safety mode.</span></span>
1. <span data-ttu-id="920be-279">Configure Site Recovery en el sitio local para [Hyper-V](site-recovery-hyper-v-site-to-azure.md) o para [máquinas virtuales de VMware o servidores físicos](site-recovery-vmware-to-azure-classic.md).</span><span class="sxs-lookup"><span data-stu-id="920be-279">Configure Site Recovery on the on-premises site, for ([Hyper-V](site-recovery-hyper-v-site-to-azure.md) or [VMware VMs/physical servers)](site-recovery-vmware-to-azure-classic.md).</span></span>
1. <span data-ttu-id="920be-280">Utilice la replicación de Site Recovery para replicar la nueva instancia de SQL Server en Azure.</span><span class="sxs-lookup"><span data-stu-id="920be-280">Use Site Recovery replication to replicate the new SQL Server instance to Azure.</span></span> <span data-ttu-id="920be-281">Como es una copia de alta seguridad de reflejo, se sincronizará con el clúster principal, pero se puede replicar en Azure con la replicación de Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="920be-281">Since it's a high safety mirror copy, it will be synchronized with the primary cluster, but it will be replicated to Azure using Site Recovery replication.</span></span>


![Clúster estándar](./media/site-recovery-sql/standalone-cluster-local.png)

### <a name="failback-considerations"></a><span data-ttu-id="920be-283">Consideraciones de la conmutación por recuperación</span><span class="sxs-lookup"><span data-stu-id="920be-283">Failback considerations</span></span>

<span data-ttu-id="920be-284">Para los clústeres de SQL Server Standard, la conmutación por recuperación después de una conmutación por error no planeada requiere realizar una copia de seguridad de SQL Server y una restauración de la instancia reflejada en el clúster original y, a continuación, restablecer el reflejo.</span><span class="sxs-lookup"><span data-stu-id="920be-284">For SQL Server Standard clusters, failback after an unplanned failover requires a SQL server backup and restore, from the mirror instance to the original cluster, with reestablishment of the mirror.</span></span>

## <a name="next-steps"></a><span data-ttu-id="920be-285">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="920be-285">Next steps</span></span>
<span data-ttu-id="920be-286">[Obtenga información](site-recovery-components.md) acerca de la arquitectura de Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="920be-286">[Learn more](site-recovery-components.md) about Site Recovery architecture.</span></span>

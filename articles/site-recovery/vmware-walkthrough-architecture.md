---
title: "Revisar la arquitectura para la replicación de VMware en Azure | Microsoft Docs"
description: "Este artículo proporciona información general de los componentes y la arquitectura usados al replicar máquinas virtuales de VMware locales en Azure con el servicio Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: c413efcd-d750-4b22-b34b-15bcaa03934a
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/27.017
ms.author: raynew
ms.openlocfilehash: 4aae04a793bab11562c20ceec0e1ae8f1a035a0f
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="step-1-review-the-architecture-for-vmware-replication-to-azure"></a><span data-ttu-id="c3053-103">Paso 1: Revisión de la arquitectura para la replicación de VMware en Azure</span><span class="sxs-lookup"><span data-stu-id="c3053-103">Step 1: Review the architecture for VMware replication to Azure</span></span>

<span data-ttu-id="c3053-104">En este artículo se describen los componentes y los procesos usados al replicar máquinas virtuales de VMware locales en Azure mediante el servicio [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="c3053-104">This article describes the components and processes used when replicating on-premises VMware virtual machines to Azure using the [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="c3053-105">Publique cualquier comentario en la parte inferior de este artículo, o bien en el [foro de Azure Recovery Services](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="c3053-105">Post any comments at the bottom of this article, or ask questions in the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="c3053-106">Componentes de la arquitectura</span><span class="sxs-lookup"><span data-stu-id="c3053-106">Architectural components</span></span>

<span data-ttu-id="c3053-107">En la tabla se resumen los componentes necesarios.</span><span class="sxs-lookup"><span data-stu-id="c3053-107">The table summarizes the components you need.</span></span>

<span data-ttu-id="c3053-108">**Componente**</span><span class="sxs-lookup"><span data-stu-id="c3053-108">**Component**</span></span> | <span data-ttu-id="c3053-109">**Requisito**</span><span class="sxs-lookup"><span data-stu-id="c3053-109">**Requirement**</span></span> | <span data-ttu-id="c3053-110">**Detalles**</span><span class="sxs-lookup"><span data-stu-id="c3053-110">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="c3053-111">**Las tablas de Azure**</span><span class="sxs-lookup"><span data-stu-id="c3053-111">**Azure**</span></span> | <span data-ttu-id="c3053-112">Necesita una suscripción de Azure, una cuenta de Azure Storage y una red de Azure.</span><span class="sxs-lookup"><span data-stu-id="c3053-112">You need an Azure subscription, an Azure storage account, and an Azure network.</span></span> | <span data-ttu-id="c3053-113">Los datos replicados se almacenan en la cuenta de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="c3053-113">Replicated data is stored in the storage account.</span></span> <span data-ttu-id="c3053-114">Las máquinas virtuales de Azure se crean con los datos replicados cuando se produce la conmutación por error desde el sitio local.</span><span class="sxs-lookup"><span data-stu-id="c3053-114">Azure VMs are created with the replicated data when failover from your on-premises site occurs.</span></span> <span data-ttu-id="c3053-115">Las máquinas virtuales de Azure se conectan a la red virtual de Azure cuando se crean.</span><span class="sxs-lookup"><span data-stu-id="c3053-115">The Azure VMs connect to the Azure virtual network when they're created.</span></span>
<span data-ttu-id="c3053-116">**Servidor de configuración**</span><span class="sxs-lookup"><span data-stu-id="c3053-116">**Configuration server**</span></span> | <span data-ttu-id="c3053-117">Un único servidor de administración local (máquina virtual de VMware) que ejecuta todos componentes locales de Site Recovery para la implementación.</span><span class="sxs-lookup"><span data-stu-id="c3053-117">A single on-premises management server (VMware VM) that runs all the on-premises Site Recovery components for the deployment.</span></span> <span data-ttu-id="c3053-118">Estos incluyen un servidor de configuración, un servidor de procesos y un servidor de destino maestro.</span><span class="sxs-lookup"><span data-stu-id="c3053-118">These include a configuration server, process server, master target server.</span></span> | <span data-ttu-id="c3053-119">El componente servidor de configuración coordina las comunicaciones entre el entorno local y Azure y administra la replicación de datos.</span><span class="sxs-lookup"><span data-stu-id="c3053-119">The configuration server component coordinates communications between on-premises and Azure, and manages data replication.</span></span>
 <span data-ttu-id="c3053-120">**Servidor de proceso**:</span><span class="sxs-lookup"><span data-stu-id="c3053-120">**Process server**:</span></span>  | <span data-ttu-id="c3053-121">Se instala de forma predeterminada en el servidor de configuración.</span><span class="sxs-lookup"><span data-stu-id="c3053-121">Installed by default on the configuration server.</span></span> | <span data-ttu-id="c3053-122">Actúa como puerta de enlace de replicación.</span><span class="sxs-lookup"><span data-stu-id="c3053-122">Acts as a replication gateway.</span></span> <span data-ttu-id="c3053-123">Recibe datos de replicación, los optimiza con almacenamiento en caché, compresión y cifrado y los envía al almacenamiento de Azure.</span><span class="sxs-lookup"><span data-stu-id="c3053-123">Receives replication data, optimizes it with caching, compression, and encryption, and sends it to Azure storage.</span></span><br/><br/> <span data-ttu-id="c3053-124">El servidor de procesos también controla la instalación de inserción del Servicio de movilidad en máquinas protegidas y realiza la detección automática de máquinas virtuales de VMware.</span><span class="sxs-lookup"><span data-stu-id="c3053-124">The process server also handles push installation of the Mobility service to protected machines, and performs automatic discovery of VMware VMs.</span></span><br/><br/> <span data-ttu-id="c3053-125">A medida que crezca la implementación, podrá agregar más servidores de procesos dedicados independientes para controlar mayores volúmenes de tráfico de replicación.</span><span class="sxs-lookup"><span data-stu-id="c3053-125">As your deployment grows you can add additional separate dedicated process servers to handle increasing volumes of replication traffic.</span></span>
 <span data-ttu-id="c3053-126">**Servidor de destino principal**</span><span class="sxs-lookup"><span data-stu-id="c3053-126">**Master target server**</span></span> | <span data-ttu-id="c3053-127">Se instala de forma predeterminada en el servidor de configuración local.</span><span class="sxs-lookup"><span data-stu-id="c3053-127">Installed by default on the on-premises configuration server.</span></span> | <span data-ttu-id="c3053-128">Controla los datos de replicación durante la conmutación por recuperación desde Azure.</span><span class="sxs-lookup"><span data-stu-id="c3053-128">Handles replication data during failback from Azure.</span></span><br/><br/> <span data-ttu-id="c3053-129">Si los volúmenes de tráfico de la conmutación por recuperación son altos, puede implementar un servidor de destino maestro independiente para la conmutación por recuperación.</span><span class="sxs-lookup"><span data-stu-id="c3053-129">If volumes of failback traffic are high, you can deploy a separate master target server for failback.</span></span>
<span data-ttu-id="c3053-130">**Servidores de VMware**</span><span class="sxs-lookup"><span data-stu-id="c3053-130">**VMware servers**</span></span> | <span data-ttu-id="c3053-131">Las máquinas virtuales de VMware se hospedan en servidores de vSphere ESXi y se recomienda un servidor de vCenter para administrar los hosts.</span><span class="sxs-lookup"><span data-stu-id="c3053-131">VMware VMs are hosted on vSphere ESXi servers, and we recommend a vCenter server to manage the hosts.</span></span> | <span data-ttu-id="c3053-132">Añada servidores de VMware al almacén de Recovery Services.</span><span class="sxs-lookup"><span data-stu-id="c3053-132">You add VMware servers to your Recovery Services vault.</span></span>
<span data-ttu-id="c3053-133">**Máquinas replicadas**</span><span class="sxs-lookup"><span data-stu-id="c3053-133">**Replicated machines**</span></span> | <span data-ttu-id="c3053-134">El Servicio de movilidad se instalará en cada máquina virtual de VMware que se replique.</span><span class="sxs-lookup"><span data-stu-id="c3053-134">The Mobility service will be installed on each VMware VM you replicate.</span></span> <span data-ttu-id="c3053-135">Se puede instalar manualmente en cada equipo o con una instalación de inserción desde el servidor de procesos.</span><span class="sxs-lookup"><span data-stu-id="c3053-135">It can be installed manually on each machine, or with a push installation from the process server.</span></span>

<span data-ttu-id="c3053-136">**Figura 1: VMware en componentes de Azure**</span><span class="sxs-lookup"><span data-stu-id="c3053-136">**Figure 1: VMware to Azure components**</span></span>

![Componentes](./media/vmware-walkthrough-architecture/arch-enhanced.png)

## <a name="replication-process"></a><span data-ttu-id="c3053-138">Proceso de replicación</span><span class="sxs-lookup"><span data-stu-id="c3053-138">Replication process</span></span>

1. <span data-ttu-id="c3053-139">Configure la implementación, incluidos los componentes de Azure y locales.</span><span class="sxs-lookup"><span data-stu-id="c3053-139">You set up the deployment, including on-premises and Azure components.</span></span> <span data-ttu-id="c3053-140">En el almacén de Recovery Services, especifique el origen y el destino de la replicación, configure el servidor de configuración, cree una directiva de replicación, implemente el Servicio de movilidad, habilite la replicación y ejecute una conmutación por error de prueba.</span><span class="sxs-lookup"><span data-stu-id="c3053-140">In the Recovery Services vault, you specify the replication source and target, set up the configuration server, create a replication policy, deploy the Mobility service, enable replication, and run a test failover.</span></span>
2. <span data-ttu-id="c3053-141">Las máquinas se replican de acuerdo con la directiva de replicación y una copia inicial de los datos se replica en Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="c3053-141">Machines replicate in accordance with the replication policy, and an initial copy of the data is replicated to Azure storage.</span></span>
3. <span data-ttu-id="c3053-142">Una vez terminada la replicación inicial, comienza la de los cambios incrementales en Azure.</span><span class="sxs-lookup"><span data-stu-id="c3053-142">After initial replication finishes, replication of delta changes to Azure begins.</span></span> <span data-ttu-id="c3053-143">Las marcas de revisión de una máquina se conservan en un archivo .hrl.</span><span class="sxs-lookup"><span data-stu-id="c3053-143">Tracked changes for a machine are held in a .hrl file.</span></span>
    - <span data-ttu-id="c3053-144">Las máquinas que están en replicación se comunican con el servidor de configuración en el puerto HTTPS 443 entrante para la administración de la replicación.</span><span class="sxs-lookup"><span data-stu-id="c3053-144">Replicating machines communicate with the configuration server on port HTTPS 443 inbound, for replication management.</span></span>
    - <span data-ttu-id="c3053-145">Las máquinas en replicación envían datos de replicación al servidor de procesos del puerto HTTPS 9443 entrante (se puede modificar).</span><span class="sxs-lookup"><span data-stu-id="c3053-145">Replicating machines send replication data to the process server on port HTTPS 9443 inbound (can be modified).</span></span>
    - <span data-ttu-id="c3053-146">El servidor de configuración organiza la administración de la replicación con Azure a través del puerto HTTPS 443 saliente.</span><span class="sxs-lookup"><span data-stu-id="c3053-146">The configuration server orchestrates replication management with Azure over port HTTPS 443 outbound.</span></span>
    - <span data-ttu-id="c3053-147">El servidor de procesos recibe datos de las máquinas de origen, los optimiza y los cifra y los envía al almacenamiento de Azure a través del puerto 443 saliente.</span><span class="sxs-lookup"><span data-stu-id="c3053-147">The process server receives data from source machines, optimizes and encrypts it, and sends it to Azure storage over port 443 outbound.</span></span>
    - <span data-ttu-id="c3053-148">Si habilita la coherencia entre varias máquinas virtuales, las máquinas del grupo de replicación se comunican entre sí a través del puerto 20004.</span><span class="sxs-lookup"><span data-stu-id="c3053-148">If you enable multi-VM consistency, then machines in the replication group communicate with each other over port 20004.</span></span> <span data-ttu-id="c3053-149">La implementación de varias máquinas virtuales se usa si agrupa varias máquinas en grupos de replicación que tienen puntos de recuperación coherentes con los bloqueos y coherentes con la aplicación cuando conmutan por error.</span><span class="sxs-lookup"><span data-stu-id="c3053-149">Multi-VM is used if you group multiple machines into replication groups that share crash-consistent and app-consistent recovery points when they fail over.</span></span> <span data-ttu-id="c3053-150">Esto resulta útil si las máquinas ejecutan la misma carga de trabajo y necesitan ser coherentes.</span><span class="sxs-lookup"><span data-stu-id="c3053-150">This is useful if machines are running the same workload and need to be consistent.</span></span>
4. <span data-ttu-id="c3053-151">El tráfico se replica en los puntos de conexión públicos del almacenamiento de Azure a través de Internet.</span><span class="sxs-lookup"><span data-stu-id="c3053-151">Traffic is replicated to Azure storage public endpoints, over the internet.</span></span> <span data-ttu-id="c3053-152">Como alternativa, puede usar el [emparejamiento público](../expressroute/expressroute-circuit-peerings.md#public-peering) de Azure ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c3053-152">Alternately, you can use Azure ExpressRoute [public peering](../expressroute/expressroute-circuit-peerings.md#public-peering).</span></span> <span data-ttu-id="c3053-153">No se admite la replicación del tráfico a través de una VPN de sitio a sitio desde un sitio local en Azure.</span><span class="sxs-lookup"><span data-stu-id="c3053-153">Replicating traffic over a site-to-site VPN from an on-premises site to Azure isn't supported.</span></span>


<span data-ttu-id="c3053-154">**Figura 2: VMware en replicación de Azure**</span><span class="sxs-lookup"><span data-stu-id="c3053-154">**Figure 2: VMware to Azure replication**</span></span>

![Mejorada](./media/vmware-walkthrough-architecture/v2a-architecture-henry.png)

## <a name="failover-and-failback-process"></a><span data-ttu-id="c3053-156">Proceso de conmutación por error y conmutación por recuperación</span><span class="sxs-lookup"><span data-stu-id="c3053-156">Failover and failback process</span></span>

1. <span data-ttu-id="c3053-157">Después de comprobar que la conmutación por error de prueba funciona según lo previsto, puede ejecutar las conmutaciones por error no planeadas en Azure según sea necesario.</span><span class="sxs-lookup"><span data-stu-id="c3053-157">After you verify that test failover is working as expected, you can run unplanned failovers to Azure as required.</span></span> <span data-ttu-id="c3053-158">No se admite la conmutación por error planeada.</span><span class="sxs-lookup"><span data-stu-id="c3053-158">Planned failover isn't supported.</span></span>
2. <span data-ttu-id="c3053-159">Puede conmutar por error una única máquina o crear [planes de recuperación](site-recovery-create-recovery-plans.md) para realizar la conmutación por error de varias máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="c3053-159">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md), to fail over multiple VMs.</span></span>
3. <span data-ttu-id="c3053-160">Cuando se ejecuta una conmutación por error, las máquinas virtuales de la réplica se crean en Azure.</span><span class="sxs-lookup"><span data-stu-id="c3053-160">When you run a failover, replica VMs are created in Azure.</span></span> <span data-ttu-id="c3053-161">Realice una conmutación por error para iniciar el acceso a la carga de trabajo desde la máquina virtual de Azure de la réplica.</span><span class="sxs-lookup"><span data-stu-id="c3053-161">You commit a failover to start accessing the workload from the replica Azure VM.</span></span>
4. <span data-ttu-id="c3053-162">Cuando el sitio local principal esté disponible de nuevo, podrá realizar una conmutación por recuperación.</span><span class="sxs-lookup"><span data-stu-id="c3053-162">When your primary on-premises site is available again, you can fail back.</span></span> <span data-ttu-id="c3053-163">Configure una infraestructura de conmutación por recuperación, empiece a replicar la máquina desde el sitio secundario al principal y ejecute una conmutación por error no planeada desde el sitio secundario.</span><span class="sxs-lookup"><span data-stu-id="c3053-163">You set up a failback infrastructure, start replicating the machine from the secondary site to the primary, and run an unplanned failover from the secondary site.</span></span> <span data-ttu-id="c3053-164">Después de ejecutar esta conmutación por error, los datos volverán a la ubicación local y deberá habilitar la replicación en Azure de nuevo.</span><span class="sxs-lookup"><span data-stu-id="c3053-164">After you commit this failover, data will be back on-premises, and you need to enable replication to Azure again.</span></span> [<span data-ttu-id="c3053-165">Más información</span><span class="sxs-lookup"><span data-stu-id="c3053-165">Learn more</span></span>](site-recovery-failback-azure-to-vmware.md)

<span data-ttu-id="c3053-166">Hay varios requisitos para la conmutación por recuperación:</span><span class="sxs-lookup"><span data-stu-id="c3053-166">There are a few failback requirements:</span></span>


- <span data-ttu-id="c3053-167">**Servidor de procesos temporal en Azure**: si desea realizar la conmutación por recuperación desde Azure después de una conmutación por error, será preciso que configure una máquina virtual de Azure como servidor de procesos para que controle la replicación desde Azure.</span><span class="sxs-lookup"><span data-stu-id="c3053-167">**Temporary process server in Azure**: If you want to fail back from Azure after failover you'll need to set up an Azure VM configured as a process server, to handle replication from Azure.</span></span> <span data-ttu-id="c3053-168">Dicha máquina virtual se puede eliminar cuando finalice la conmutación por recuperación.</span><span class="sxs-lookup"><span data-stu-id="c3053-168">You can delete this VM after failback finishes.</span></span>
- <span data-ttu-id="c3053-169">**Conexión VPN**: para realizar la conmutación por recuperación, necesitará que se haya configurado una conexión VPN (o Azure ExpressRoute) desde la red de Azure y el sitio local.</span><span class="sxs-lookup"><span data-stu-id="c3053-169">**VPN connection**: For failback you'll need a VPN connection (or Azure ExpressRoute) set up from the Azure network to the on-premises site.</span></span>
- <span data-ttu-id="c3053-170">**Servidor de destino maestro local independiente**: el servidor de destino maestro local controla la conmutación por recuperación.</span><span class="sxs-lookup"><span data-stu-id="c3053-170">**Separate on-premises master target server**: The on-premises master target server handles failback.</span></span> <span data-ttu-id="c3053-171">El servidor de destino maestro se instala de forma predeterminada en el servidor de administración, pero si se va a realizar la conmutación por recuperación de grandes volúmenes de tráfico, se debe configurar un servidor de destino maestro local independiente para este propósito.</span><span class="sxs-lookup"><span data-stu-id="c3053-171">The master target server is installed by default on the management server, but if you're failing back larger volumes of traffic you should set up a separate on-premises master target server for this purpose.</span></span>
- <span data-ttu-id="c3053-172">**Directiva de conmutación por recuperación**: para replicar de nuevo en el sitio local, necesita una directiva de conmutación por recuperación.</span><span class="sxs-lookup"><span data-stu-id="c3053-172">**Failback policy**: To replicate back to your on-premises site, you need a failback policy.</span></span> <span data-ttu-id="c3053-173">Esta se crea automáticamente al crear la directiva de replicación.</span><span class="sxs-lookup"><span data-stu-id="c3053-173">This is automatically created when you created your replication policy.</span></span>
- <span data-ttu-id="c3053-174">**Infraestructura de VMware**: debe conmutar por recuperación a una máquina virtual de VMware local.</span><span class="sxs-lookup"><span data-stu-id="c3053-174">**VMware infrastructure**: You must fail back to an on-premises VMware VM.</span></span> <span data-ttu-id="c3053-175">Esto significa que necesita una infraestructura de VMware local, incluso si está replicando servidores físicos locales a Azure.</span><span class="sxs-lookup"><span data-stu-id="c3053-175">This means you need an on-premises VMware infrastructure, even if you're replicating on-premises physical servers to Azure.</span></span>

<span data-ttu-id="c3053-176">**Figura 3: VMware y conmutación por recuperación física**</span><span class="sxs-lookup"><span data-stu-id="c3053-176">**Figure 3: VMware/physical failback**</span></span>

![Conmutación por recuperación](./media/vmware-walkthrough-architecture/enhanced-failback.png)


## <a name="next-steps"></a><span data-ttu-id="c3053-178">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="c3053-178">Next steps</span></span>

<span data-ttu-id="c3053-179">Vaya a [Paso 2: Comprobación de los requisitos previos y las limitaciones](vmware-walkthrough-prerequisites.md)</span><span class="sxs-lookup"><span data-stu-id="c3053-179">Go to [Step 2: Verify prerequisites and limitations](vmware-walkthrough-prerequisites.md)</span></span>

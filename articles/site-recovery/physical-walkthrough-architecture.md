---
title: "Revisión de la arquitectura para la replicación de un servidor físico en Azure con Azure Site Recovery | Microsoft Docs"
description: "En este artículo se proporciona información general de los componentes y la arquitectura que se usan al replicar servidores físicos locales en Azure con el servicio Azure Site Recovery"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: 09c9b136-35f5-465e-8d0f-f4c5d5d9f880
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/27/2017
ms.author: raynew
ms.openlocfilehash: 843c3f1b54f50fe50b162ed242deab717a080830
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="step-1-review-the-architecture-for-physical-server-replication-to-azure"></a><span data-ttu-id="459b1-103">Step 1: Revisar la arquitectura para la replicación de un servidor físico en Azure</span><span class="sxs-lookup"><span data-stu-id="459b1-103">Step 1: Review the architecture for physical server replication to Azure</span></span>

<span data-ttu-id="459b1-104">En este artículo se describen los componentes y procesos que se usan cuando se replican servidores físicos Windows o Linux locales en Azure mediante el servicio [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="459b1-104">This article describes the components and processes used when you replicate on-premises Windows/Linux physical servers to Azure, using the [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="459b1-105">Publique cualquier comentario en la parte inferior de este artículo, o bien en el [foro de Azure Recovery Services](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="459b1-105">Post any comments at the bottom of this article, or ask questions in the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="459b1-106">Componentes de la arquitectura</span><span class="sxs-lookup"><span data-stu-id="459b1-106">Architectural components</span></span>

<span data-ttu-id="459b1-107">En la tabla se resumen los componentes necesarios.</span><span class="sxs-lookup"><span data-stu-id="459b1-107">The table summarizes the components you need.</span></span>

<span data-ttu-id="459b1-108">**Componente**</span><span class="sxs-lookup"><span data-stu-id="459b1-108">**Component**</span></span> | <span data-ttu-id="459b1-109">**Requisito**</span><span class="sxs-lookup"><span data-stu-id="459b1-109">**Requirement**</span></span> | <span data-ttu-id="459b1-110">**Detalles**</span><span class="sxs-lookup"><span data-stu-id="459b1-110">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="459b1-111">**Las tablas de Azure**</span><span class="sxs-lookup"><span data-stu-id="459b1-111">**Azure**</span></span> | <span data-ttu-id="459b1-112">Se necesita una cuenta de Azure, una cuenta de Azure Storage y una red de Azure.</span><span class="sxs-lookup"><span data-stu-id="459b1-112">You need an Azure account, an Azure storage account, and an Azure network.</span></span> | <span data-ttu-id="459b1-113">Los datos replicados se almacenan en la cuenta de almacenamiento y se crean máquinas virtuales de Azure con los datos replicados cuando se produce la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="459b1-113">Replicated data is stored in the storage account, and Azure VMs are created with the replicated data when failover occurs.</span></span> <span data-ttu-id="459b1-114">Las máquinas virtuales de Azure se conectan a la red virtual de Azure cuando se crean.</span><span class="sxs-lookup"><span data-stu-id="459b1-114">Azure VMs connect to the Azure virtual network when they're created.</span></span>
<span data-ttu-id="459b1-115">**Servidor de configuración**</span><span class="sxs-lookup"><span data-stu-id="459b1-115">**Configuration server**</span></span> | <span data-ttu-id="459b1-116">Un único servidor de administración local (servidor físico o máquina virtual de VMware) que ejecuta todos componentes locales de Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="459b1-116">A single on-premises management server (physical server or VMware VM) that runs all the on-premises Site Recovery components.</span></span> <span data-ttu-id="459b1-117">Estos incluyen un servidor de configuración, un servidor de procesos y un servidor de destino maestro.</span><span class="sxs-lookup"><span data-stu-id="459b1-117">These include a configuration server, process server, master target server.</span></span> | <span data-ttu-id="459b1-118">El componente servidor de configuración coordina las comunicaciones entre el entorno local y Azure y administra la replicación de datos.</span><span class="sxs-lookup"><span data-stu-id="459b1-118">The configuration server component coordinates communications between on-premises and Azure, and manages data replication.</span></span>
 <span data-ttu-id="459b1-119">**Servidor de proceso**</span><span class="sxs-lookup"><span data-stu-id="459b1-119">**Process server**</span></span>  | <span data-ttu-id="459b1-120">Se instala de forma predeterminada en el servidor de configuración.</span><span class="sxs-lookup"><span data-stu-id="459b1-120">Installed by default on the configuration server.</span></span> | <span data-ttu-id="459b1-121">Actúa como puerta de enlace de replicación.</span><span class="sxs-lookup"><span data-stu-id="459b1-121">Acts as a replication gateway.</span></span> <span data-ttu-id="459b1-122">Recibe datos de replicación, los optimiza con almacenamiento en caché, compresión y cifrado y los envía al almacenamiento de Azure.</span><span class="sxs-lookup"><span data-stu-id="459b1-122">Receives replication data, optimizes it with caching, compression, and encryption, and sends it to Azure storage.</span></span><br/><br/> <span data-ttu-id="459b1-123">El servidor de procesos también controla la instalación de inserción del servicio Mobility en máquinas protegidas.</span><span class="sxs-lookup"><span data-stu-id="459b1-123">The process server also handles push installation of the Mobility service to protected machines.</span></span><br/><br/> <span data-ttu-id="459b1-124">También puede agregar más servidores de procesos dedicados independientes para controlar mayores volúmenes de tráfico de replicación.</span><span class="sxs-lookup"><span data-stu-id="459b1-124">You can add additional separate dedicated process servers, to handle increasing volumes of replication traffic.</span></span>
 <span data-ttu-id="459b1-125">**Servidor de destino principal**</span><span class="sxs-lookup"><span data-stu-id="459b1-125">**Master target server**</span></span> | <span data-ttu-id="459b1-126">Se instala de forma predeterminada en el servidor de configuración local.</span><span class="sxs-lookup"><span data-stu-id="459b1-126">Installed by default on the on-premises configuration server.</span></span> | <span data-ttu-id="459b1-127">Controla los datos de replicación durante la conmutación por recuperación desde Azure.</span><span class="sxs-lookup"><span data-stu-id="459b1-127">Handles replication data during failback from Azure.</span></span><br/><br/> <span data-ttu-id="459b1-128">Si los volúmenes de tráfico de la conmutación por recuperación son altos, puede implementar un servidor de destino maestro independiente para la conmutación por recuperación.</span><span class="sxs-lookup"><span data-stu-id="459b1-128">If volumes of failback traffic are high, you can deploy a separate master target server for failback.</span></span>
<span data-ttu-id="459b1-129">**Servidores replicados**</span><span class="sxs-lookup"><span data-stu-id="459b1-129">**Replicated servers**</span></span> | <span data-ttu-id="459b1-130">El componente del servicio Mobility se instala en todos los servidores Windows o Linux que se desee replicar.</span><span class="sxs-lookup"><span data-stu-id="459b1-130">The Mobility service component is installed on each Windows/Linux server you want to replicate.</span></span> <span data-ttu-id="459b1-131">Se puede instalar manualmente en cada equipo o con una instalación de inserción desde el servidor de procesos.</span><span class="sxs-lookup"><span data-stu-id="459b1-131">It can be installed manually on each machine, or with a push installation from the process server.</span></span>
<span data-ttu-id="459b1-132">**Conmutación por recuperación**</span><span class="sxs-lookup"><span data-stu-id="459b1-132">**Failback**</span></span> | <span data-ttu-id="459b1-133">Para la conmutación por recuperación se requiere una infraestructura de VMware.</span><span class="sxs-lookup"><span data-stu-id="459b1-133">For failback a VMware infrastructure is required.</span></span> <span data-ttu-id="459b1-134">No se puede realizar la conmutación por recuperación a un servidor físico.</span><span class="sxs-lookup"><span data-stu-id="459b1-134">You can't fail back to a physical server.</span></span>


<span data-ttu-id="459b1-135">**Ilustración 1: Componentes de entorno físico a Azure**</span><span class="sxs-lookup"><span data-stu-id="459b1-135">**Figure 1: Physical to Azure components**</span></span>

![Componentes](./media/physical-walkthrough-architecture/arch-enhanced.png)

## <a name="replication-process"></a><span data-ttu-id="459b1-137">Proceso de replicación</span><span class="sxs-lookup"><span data-stu-id="459b1-137">Replication process</span></span>

1. <span data-ttu-id="459b1-138">Configure la implementación, incluidos los componentes de Azure y locales.</span><span class="sxs-lookup"><span data-stu-id="459b1-138">You set up the deployment, including on-premises and Azure components.</span></span> <span data-ttu-id="459b1-139">En el almacén de Recovery Services, especifique el origen y el destino de la replicación, configure el servidor de configuración, cree una directiva de replicación, implemente el Servicio de movilidad, habilite la replicación y ejecute una conmutación por error de prueba.</span><span class="sxs-lookup"><span data-stu-id="459b1-139">In the Recovery Services vault, you specify the replication source and target, set up the configuration server, create a replication policy, deploy the Mobility service, enable replication, and run a test failover.</span></span>
2.  <span data-ttu-id="459b1-140">Las máquinas se replican de acuerdo con la directiva de replicación y una copia inicial de los datos se replica en Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="459b1-140">Machines replicate in accordance with the replication policy, and an initial copy of the data is replicated to Azure storage.</span></span>
4. <span data-ttu-id="459b1-141">Una vez terminada la replicación inicial, comienza la de los cambios incrementales en Azure.</span><span class="sxs-lookup"><span data-stu-id="459b1-141">After initial replication finishes, replication of delta changes to Azure begins.</span></span> <span data-ttu-id="459b1-142">Las marcas de revisión de una máquina se conservan en un archivo .hrl.</span><span class="sxs-lookup"><span data-stu-id="459b1-142">Tracked changes for a machine are held in a .hrl file.</span></span>
    - <span data-ttu-id="459b1-143">Las máquinas que están en replicación se comunican con el servidor de configuración en el puerto HTTPS 443 entrante para la administración de la replicación.</span><span class="sxs-lookup"><span data-stu-id="459b1-143">Replicating machines communicate with the configuration server on port HTTPS 443 inbound, for replication management.</span></span>
    - <span data-ttu-id="459b1-144">Las máquinas en replicación envían datos de replicación al servidor de procesos del puerto HTTPS 9443 entrante (se puede modificar).</span><span class="sxs-lookup"><span data-stu-id="459b1-144">Replicating machines send replication data to the process server on port HTTPS 9443 inbound (can be modified).</span></span>
    - <span data-ttu-id="459b1-145">El servidor de configuración organiza la administración de la replicación con Azure a través del puerto HTTPS 443 saliente.</span><span class="sxs-lookup"><span data-stu-id="459b1-145">The configuration server orchestrates replication management with Azure over port HTTPS 443 outbound.</span></span>
    - <span data-ttu-id="459b1-146">El servidor de procesos recibe datos de las máquinas de origen, los optimiza y los cifra y los envía al almacenamiento de Azure a través del puerto 443 saliente.</span><span class="sxs-lookup"><span data-stu-id="459b1-146">The process server receives data from source machines, optimizes and encrypts it, and sends it to Azure storage over port 443 outbound.</span></span>
    - <span data-ttu-id="459b1-147">Si habilita la coherencia entre varias máquinas virtuales, las máquinas del grupo de replicación se comunican entre sí a través del puerto 20004.</span><span class="sxs-lookup"><span data-stu-id="459b1-147">If you enable multi-VM consistency, then machines in the replication group communicate with each other over port 20004.</span></span> <span data-ttu-id="459b1-148">La implementación de varias máquinas virtuales se usa si agrupa varias máquinas en grupos de replicación que tienen puntos de recuperación coherentes con los bloqueos y coherentes con la aplicación cuando conmutan por error.</span><span class="sxs-lookup"><span data-stu-id="459b1-148">Multi-VM is used if you group multiple machines into replication groups that share crash-consistent and app-consistent recovery points when they fail over.</span></span> <span data-ttu-id="459b1-149">Esto resulta útil si las máquinas ejecutan la misma carga de trabajo y necesitan ser coherentes.</span><span class="sxs-lookup"><span data-stu-id="459b1-149">This is useful if machines are running the same workload and need to be consistent.</span></span>
5. <span data-ttu-id="459b1-150">El tráfico se replica en los puntos de conexión públicos del almacenamiento de Azure a través de Internet.</span><span class="sxs-lookup"><span data-stu-id="459b1-150">Traffic is replicated to Azure storage public endpoints, over the internet.</span></span> <span data-ttu-id="459b1-151">Como alternativa, puede usar el [emparejamiento público](../expressroute/expressroute-circuit-peerings.md#public-peering) de Azure ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="459b1-151">Alternately, you can use Azure ExpressRoute [public peering](../expressroute/expressroute-circuit-peerings.md#public-peering).</span></span> <span data-ttu-id="459b1-152">No se admite la replicación del tráfico a través de una VPN de sitio a sitio desde un sitio local en Azure.</span><span class="sxs-lookup"><span data-stu-id="459b1-152">Replicating traffic over a site-to-site VPN from an on-premises site to Azure isn't supported.</span></span>

<span data-ttu-id="459b1-153">**Ilustración 2: Replicación de entorno físico a Azure**</span><span class="sxs-lookup"><span data-stu-id="459b1-153">**Figure 2: Physical to Azure replication**</span></span>

![Mejorada](./media/physical-walkthrough-architecture/v2a-architecture-henry.png)

## <a name="failover-and-failback-process"></a><span data-ttu-id="459b1-155">Proceso de conmutación por error y conmutación por recuperación</span><span class="sxs-lookup"><span data-stu-id="459b1-155">Failover and failback process</span></span>

<span data-ttu-id="459b1-156">Después de comprobar que la conmutación por error de prueba funciona según lo previsto, puede ejecutar las conmutaciones por error no planeadas en Azure según sea necesario.</span><span class="sxs-lookup"><span data-stu-id="459b1-156">After you verify that test failover is working as expected, you can run unplanned failovers to Azure as required.</span></span> <span data-ttu-id="459b1-157">Cuando se ejecuta una conmutación por error, se crean máquinas virtuales de Azure a partir de los datos replicados.</span><span class="sxs-lookup"><span data-stu-id="459b1-157">When you run a failover, Azure VMs are created from replicated data.</span></span> <span data-ttu-id="459b1-158">Luego, cuando el sitio local principal esté disponible de nuevo, podrá realizar una conmutación por recuperación.</span><span class="sxs-lookup"><span data-stu-id="459b1-158">Then, when your primary on-premises site is available again, you can fail back.</span></span> <span data-ttu-id="459b1-159">Observe lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="459b1-159">Note that:</span></span>

- <span data-ttu-id="459b1-160">No se admite la conmutación por error planeada.</span><span class="sxs-lookup"><span data-stu-id="459b1-160">Planned failover isn't supported.</span></span>
- <span data-ttu-id="459b1-161">La conmutación por error se puede realizar en una sola máquina, o bien crear [planes de recuperación](site-recovery-create-recovery-plans.md) para realizar la conmutación por error en máquinas a la vez.</span><span class="sxs-lookup"><span data-stu-id="459b1-161">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md), to fail over multiple machines together.</span></span>
- <span data-ttu-id="459b1-162">Realice una conmutación por error para iniciar el acceso a la carga de trabajo desde la máquina virtual de Azure de la réplica.</span><span class="sxs-lookup"><span data-stu-id="459b1-162">You commit a failover to start accessing the workload from the replica Azure VM.</span></span>
- <span data-ttu-id="459b1-163">Cuando el sitio principal vuelva a estar disponible, replique la máquina desde el sitio secundario al principal.</span><span class="sxs-lookup"><span data-stu-id="459b1-163">When the primary site is available again, you replicate the machine from the secondary to the primary site.</span></span> <span data-ttu-id="459b1-164">Luego, realice una conmutación por error no planeada desde el sitio secundario.</span><span class="sxs-lookup"><span data-stu-id="459b1-164">Then, run an unplanned failover from the secondary site.</span></span> <span data-ttu-id="459b1-165">Después de ejecutar esta conmutación por error, los datos volverán a la ubicación local y deberá habilitar la replicación en Azure de nuevo.</span><span class="sxs-lookup"><span data-stu-id="459b1-165">After you commit this failover, data will be back on-premises, and you need to enable replication to Azure again.</span></span>

<span data-ttu-id="459b1-166">Entre los componentes de la conmutación por recuperación se incluyen:</span><span class="sxs-lookup"><span data-stu-id="459b1-166">Failback components include:</span></span>

- <span data-ttu-id="459b1-167">**Servidor de procesos temporal en Azure**: necesita configurar una máquina virtual de Azure que actúe como servidor de procesos para controlar la replicación desde Azure.</span><span class="sxs-lookup"><span data-stu-id="459b1-167">**Temporary process server in Azure**: You need to set up an Azure VM to act as a process server, to handle replication from Azure.</span></span> <span data-ttu-id="459b1-168">Dicha máquina virtual se puede eliminar cuando finalice la conmutación por recuperación.</span><span class="sxs-lookup"><span data-stu-id="459b1-168">You can delete this VM after failback finishes.</span></span>
- <span data-ttu-id="459b1-169">**Conexión VPN**: necesita una conmutación VPN (o Azure ExpressRoute) desde la red de Azure al sitio local.</span><span class="sxs-lookup"><span data-stu-id="459b1-169">**VPN connection**: You need a VPN connection (or Azure ExpressRoute) from the Azure network to the on-premises site.</span></span>
- <span data-ttu-id="459b1-170">**Servidor de destino maestro local independiente**: el servidor de destino maestro local (que se instala de manera predeterminada en el servidor de configuración) controla la conmutación por recuperación.</span><span class="sxs-lookup"><span data-stu-id="459b1-170">**Separate on-premises master target server**: The on-premises master target server (installed by default on the configuration server) handles failback.</span></span> <span data-ttu-id="459b1-171">Si se realiza la conmutación por recuperación en grandes volúmenes de tráfico, debe configurar un servidor de destino maestro local independiente para este propósito.</span><span class="sxs-lookup"><span data-stu-id="459b1-171">If you fail back large volumes of traffic, you should set up a separate on-premises master target server for this purpose.</span></span>
- <span data-ttu-id="459b1-172">**Directiva de conmutación por recuperación**: necesita una directiva de conmutación por recuperación.</span><span class="sxs-lookup"><span data-stu-id="459b1-172">**Failback policy**: You need a failback policy.</span></span> <span data-ttu-id="459b1-173">Esta se crea automáticamente al crear la directiva de replicación.</span><span class="sxs-lookup"><span data-stu-id="459b1-173">This is automatically created when you created your replication policy.</span></span>
- <span data-ttu-id="459b1-174">**Infraestructura de VMware**: debe conmutar por recuperación a una máquina virtual de VMware local.</span><span class="sxs-lookup"><span data-stu-id="459b1-174">**VMware infrastructure**: You must fail back to an on-premises VMware VM.</span></span> <span data-ttu-id="459b1-175">Esto significa que necesita una infraestructura de VMware local, incluso si está replicando servidores físicos locales a Azure.</span><span class="sxs-lookup"><span data-stu-id="459b1-175">This means you need an on-premises VMware infrastructure, even if you're replicating on-premises physical servers to Azure.</span></span>

<span data-ttu-id="459b1-176">**Ilustración 3: Conmutación por recuperación de servidor físico**</span><span class="sxs-lookup"><span data-stu-id="459b1-176">**Figure 3: Physical server failback**</span></span>

![Conmutación por recuperación](./media/physical-walkthrough-architecture/enhanced-failback.png)


## <a name="next-steps"></a><span data-ttu-id="459b1-178">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="459b1-178">Next steps</span></span>

<span data-ttu-id="459b1-179">Vaya a [Paso 2: Comprobación de los requisitos previos y las limitaciones](physical-walkthrough-prerequisites.md)</span><span class="sxs-lookup"><span data-stu-id="459b1-179">Go to [Step 2: Verify prerequisites and limitations](physical-walkthrough-prerequisites.md)</span></span>

---
title: "Conmutación por error de prueba a Azure en Site Recovery | Microsoft Docs"
description: "Obtenga información sobre cómo ejecutar una conmutación por error de prueba desde su entorno local a Azure"
services: site-recovery
documentationcenter: 
author: prateek9us
manager: gauravd
editor: 
ms.assetid: 44813a48-c680-4581-a92e-cecc57cc3b1e
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 07/04/2017
ms.author: pratshar
ms.openlocfilehash: 54f62af6abcdd38254fd5379b95baa05656dc90b
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="test--failover-to-azure-in-site-recovery"></a><span data-ttu-id="ff657-103">Conmutación por error de prueba a Azure en Site Recovery</span><span class="sxs-lookup"><span data-stu-id="ff657-103">Test  Failover to Azure in Site Recovery</span></span>



<span data-ttu-id="ff657-104">En este artículo se proporciona información e instrucciones para realizar una conmutación por error de prueba o una exploración de recuperación ante desastres de máquinas virtuales y servidores físicos que están protegidos con Site Recovery, utilizando para ello Azure como sitio de recuperación.</span><span class="sxs-lookup"><span data-stu-id="ff657-104">This article provides information and instructions for doing a test failover or a DR drill of virtual machines and physical servers that are protected with Site Recovery using Azure as the recovery site.</span></span>

<span data-ttu-id="ff657-105">Publique cualquier comentario o pregunta que tenga en la parte inferior de este artículo, o bien en el [foro de Servicios de recuperación de Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="ff657-105">Post any comments or questions at the bottom of this article, or on the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>

<span data-ttu-id="ff657-106">La conmutación por error de prueba se ejecuta para validar la estrategia de replicación o para realizar una exploración de la recuperación ante desastres sin perder datos ni tiempo de actividad.</span><span class="sxs-lookup"><span data-stu-id="ff657-106">Test failover is run to validate your replication strategy or perform a disaster recovery drill without any data loss or downtime.</span></span> <span data-ttu-id="ff657-107">Realizar una conmutación por error de prueba no afecta a la replicación en curso ni al entorno de producción.</span><span class="sxs-lookup"><span data-stu-id="ff657-107">Doing a test failover doesn't have any impact on the ongoing replication or on your production environment.</span></span> <span data-ttu-id="ff657-108">La conmutación por error de prueba puede hacerse en una máquina virtual o en un [plan de recuperación](site-recovery-create-recovery-plans.md).</span><span class="sxs-lookup"><span data-stu-id="ff657-108">Test failover can be done either on a virtual machine or a [recovery plan](site-recovery-create-recovery-plans.md).</span></span> <span data-ttu-id="ff657-109">Al activar una conmutación por error de prueba, debe especificar la red a la que deben conectarse las máquinas virtuales de prueba.</span><span class="sxs-lookup"><span data-stu-id="ff657-109">When triggering a test failover, you need to specify the network to which test virtual machines would connect to.</span></span> <span data-ttu-id="ff657-110">Una vez desencadenada la conmutación por error de prueba, puede seguir su progreso en la página **Trabajos**.</span><span class="sxs-lookup"><span data-stu-id="ff657-110">Once a test failover is triggered, you can track progress in the **Jobs** page.</span></span>  


## <a name="supported-scenarios"></a><span data-ttu-id="ff657-111">Escenarios admitidos</span><span class="sxs-lookup"><span data-stu-id="ff657-111">Supported scenarios</span></span>
<span data-ttu-id="ff657-112">La conmutación por error se admite en todos los escenarios de implementación que no sean desde [sitios de VMware heredados a Azure](site-recovery-vmware-to-azure-classic-legacy.md).</span><span class="sxs-lookup"><span data-stu-id="ff657-112">Test failover is supported in all deployment scenarios other than [legacy VMware site to Azure](site-recovery-vmware-to-azure-classic-legacy.md).</span></span> <span data-ttu-id="ff657-113">La conmutación por error de prueba tampoco se admite si la máquina virtual ha conmutado por error a Azure.</span><span class="sxs-lookup"><span data-stu-id="ff657-113">Test failover is also not supported when virtual machine has been failed over to Azure.</span></span>  


## <a name="run-a-test-failover"></a><span data-ttu-id="ff657-114">Ejecución de una conmutación por error de prueba</span><span class="sxs-lookup"><span data-stu-id="ff657-114">Run a test failover</span></span>
<span data-ttu-id="ff657-115">En este procedimiento se describe cómo ejecutar una conmutación por error de prueba para un plan de recuperación.</span><span class="sxs-lookup"><span data-stu-id="ff657-115">This procedure describes how to run a test failover for a recovery plan.</span></span> <span data-ttu-id="ff657-116">También puede ejecutar una conmutación por error de prueba para una sola máquina usando la opción adecuada en ella.</span><span class="sxs-lookup"><span data-stu-id="ff657-116">Alternatively you can also run test failover for a single machine by using the appropriate option on it.</span></span>

![Test Failover](./media/site-recovery-test-failover-to-azure/TestFailover.png)


1. <span data-ttu-id="ff657-118">Seleccione **Recovery Plans** > *nombreDePlanDeRecuperación*.</span><span class="sxs-lookup"><span data-stu-id="ff657-118">Select **Recovery Plans** > *recoveryplan_name*.</span></span> <span data-ttu-id="ff657-119">Haga clic en **Probar conmutación por error**.</span><span class="sxs-lookup"><span data-stu-id="ff657-119">Click **Test Failover**.</span></span>
1. <span data-ttu-id="ff657-120">Seleccione el **Punto de recuperación** al que se va a realizar la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="ff657-120">Select a **Recovery Point** to failover to.</span></span> <span data-ttu-id="ff657-121">Puede seleccionar una de las siguientes opciones:</span><span class="sxs-lookup"><span data-stu-id="ff657-121">You can use one of the following options:</span></span>
    1.  <span data-ttu-id="ff657-122">**Latest processed** (Último procesado): esta opción conmuta por error todas las máquinas virtuales del plan de recuperación al punto de recuperación más reciente que el servicio Site Recovery haya procesado.</span><span class="sxs-lookup"><span data-stu-id="ff657-122">**Latest processed**: This option fails over all virtual machines of the recovery plan to the latest recovery point that has already been processed by Site Recovery service.</span></span> <span data-ttu-id="ff657-123">Cuando se realiza una conmutación por error de prueba de una máquina virtual, también se muestra la marca de tiempo del último punto de recuperación procesado.</span><span class="sxs-lookup"><span data-stu-id="ff657-123">When you are doing test failover of a virtual machine, time stamp of the latest processed recovery point is also shown.</span></span> <span data-ttu-id="ff657-124">Si realiza una conmutación por error de un plan de recuperación, puede ir a cada máquina virtual y consultar el icono **Latest Recovery Points** (Puntos de recuperación más recientes) para obtener esta información.</span><span class="sxs-lookup"><span data-stu-id="ff657-124">If you are doing failover of a recovery plan, you can go to individual virtual machine and look at **Latest Recovery Points** tile to get this information.</span></span> <span data-ttu-id="ff657-125">Como no se emplea ningún tiempo en procesar los datos sin procesar, esta es una opción de conmutación por error con un objetivo de tiempo de recuperación bajo.</span><span class="sxs-lookup"><span data-stu-id="ff657-125">As no time is spent to process the unprocessed data, this option provides a low RTO (Recovery Time Objective) failover option.</span></span>
    1.  <span data-ttu-id="ff657-126">**Latest app-consistent** (Más reciente coherente con la aplicación): esta opción conmuta por error todas las máquinas virtuales del plan de recuperación al último punto de recuperación coherente con la aplicación que haya procesado el servicio Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="ff657-126">**Latest app-consistent**: This option fails over all virtual machines of the recovery plan to the latest application consistent recovery point that has already been processed by Site Recovery service.</span></span> <span data-ttu-id="ff657-127">Cuando se realiza una conmutación por error de prueba de una máquina virtual, también se muestra la marca de tiempo del último punto de recuperación coherente con la aplicación procesado.</span><span class="sxs-lookup"><span data-stu-id="ff657-127">When you are doing test failover of a virtual machine, time stamp of the latest app-consistent recovery point is also shown.</span></span> <span data-ttu-id="ff657-128">Si realiza una conmutación por error de un plan de recuperación, puede ir a cada máquina virtual y consultar el icono **Latest Recovery Points** (Puntos de recuperación más recientes) para obtener esta información.</span><span class="sxs-lookup"><span data-stu-id="ff657-128">If you are doing failover of a recovery plan, you can go to individual virtual machine and look at **Latest Recovery Points** tile to get this information.</span></span>
    1.  <span data-ttu-id="ff657-129">**Más reciente**: esta opción procesa primero todos los datos que se han enviado al servicio Site Recovery para crear un punto de recuperación para cada máquina virtual antes de conmutarla por error a dicho punto de recuperación.</span><span class="sxs-lookup"><span data-stu-id="ff657-129">**Latest**: This option first processes all the data that has been sent to Site Recovery service to create a recovery point for each virtual machine before failing them over to it.</span></span> <span data-ttu-id="ff657-130">Esta opción ofrece el objetivo de punto de recuperación (RPO) mínimo, ya que la máquina virtual creada después de la conmutación por error tiene todos los datos que se han replicado en el servicio Site Recovery cuando se desencadenó la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="ff657-130">This option provides the lowest RPO (Recovery Point Objective) as the virtual machine created after failover will have all the data that has been replicated to Site Recovery service when the failover was triggered.</span></span>
    1.  <span data-ttu-id="ff657-131">**Latest multi-VM processed** (Últimas máquinas virtuales procesadas): esta opción solo está disponible para planes de recuperación que tienen al menos una máquina virtual con la coherencia para varias máquinas virtuales activada.</span><span class="sxs-lookup"><span data-stu-id="ff657-131">**Latest multi-VM processed**: This option is only available for recovery plans that have at least one virtual machine with multi-VM consistency ON.</span></span> <span data-ttu-id="ff657-132">Las máquinas virtuales que forman parte de un grupo de replicación conmutan por error al último punto de recuperación común coherente con varias máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="ff657-132">Virtual machines that are part of a replication group failover to the latest common multi-VM consistent recovery point.</span></span> <span data-ttu-id="ff657-133">Otras máquinas virtuales conmutan por error a su punto de recuperación procesado más reciente.</span><span class="sxs-lookup"><span data-stu-id="ff657-133">Other virtual machines failover to their latest processed recovery point.</span></span>  
    1.  <span data-ttu-id="ff657-134">**Latest multi-VM app-consistent** (Últimas máquinas virtuales coherentes con la aplicación): esta opción solo está disponible para planes de recuperación que tienen al menos una máquina virtual con la coherencia para varias máquinas virtuales activada.</span><span class="sxs-lookup"><span data-stu-id="ff657-134">**Latest multi-VM app-consistent**: This option is only available for recovery plans that have at least one virtual machine with multi-VM consistency ON.</span></span> <span data-ttu-id="ff657-135">Las máquinas virtuales que forman parte de un grupo de replicación conmutan por error al último punto de recuperación común coherente con la aplicación de varias máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="ff657-135">Virtual machines that are part of a replication group failover to the latest common multi-VM application-consistent recovery point.</span></span> <span data-ttu-id="ff657-136">Otras máquinas virtuales conmutan por error a su punto de recuperación coherente con la aplicación más reciente.</span><span class="sxs-lookup"><span data-stu-id="ff657-136">Other virtual machines failover to their latest application-consistent recovery point.</span></span> 
    1.  <span data-ttu-id="ff657-137">**Custom** (Personalizado): si realiza una conmutación por error de prueba con una máquina virtual, puede usar esta opción para conmutar por error a un punto de recuperación determinado.</span><span class="sxs-lookup"><span data-stu-id="ff657-137">**Custom**: If you are doing test failover of a virtual machine, then you can use this option to failover to a particular recovery point.</span></span>
1. <span data-ttu-id="ff657-138">Seleccione una red virtual de Azure en **Azure virtual network**: indique la red virtual de Azure donde se deberían crear las máquinas virtuales de prueba.</span><span class="sxs-lookup"><span data-stu-id="ff657-138">Select an **Azure virtual network**: Provide an Azure virtual network where the test virtual machines would be created.</span></span> <span data-ttu-id="ff657-139">Site Recovery intenta crear máquinas virtuales de prueba en una subred del mismo nombre y con la misma dirección IP que se proporcionó en la opción **Proceso y red** de la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="ff657-139">Site Recovery attempts to create test virtual machines in a subnet of same name and using the same IP as that provided in **Compute and Network** settings of the virtual machine.</span></span> <span data-ttu-id="ff657-140">Si no hay disponible una subred del mismo nombre en la red virtual de Azure proporcionada para la conmutación por error de prueba, la máquina virtual de prueba se crea en la primera subred por orden alfabético.</span><span class="sxs-lookup"><span data-stu-id="ff657-140">If subnet of same name is not available in the Azure virtual network provided for test failover, then test virtual machine is created in the first subnet alphabetically.</span></span> <span data-ttu-id="ff657-141">Si la misma dirección IP no está disponible en la subred, la máquina virtual recibirá otra dirección IP que haya disponible en la subred.</span><span class="sxs-lookup"><span data-stu-id="ff657-141">If same IP is not available in the subnet, then virtual machine gets another IP address available in the subnet.</span></span> <span data-ttu-id="ff657-142">Consulte esta sección para obtener [más información](#creating-a-network-for-test-failover).</span><span class="sxs-lookup"><span data-stu-id="ff657-142">Read this section for [more details](#creating-a-network-for-test-failover)</span></span>
1. <span data-ttu-id="ff657-143">Si realiza la conmutación por error a Azure y el cifrado de datos está habilitado, en **Clave de cifrado** seleccione el certificado que se emitió cuando habilitó el cifrado de datos durante la instalación del proveedor.</span><span class="sxs-lookup"><span data-stu-id="ff657-143">If you're failing over to Azure and data encryption is enabled, in **Encryption Key** select the certificate that was issued when you enabled data encryption during Provider installation.</span></span> <span data-ttu-id="ff657-144">Puede omitir este paso si no se ha habilitado el cifrado en la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="ff657-144">You can ignore this step if you have not enabled encryption on the virtual machine.</span></span>
1. <span data-ttu-id="ff657-145">Realice el seguimiento del progreso de la conmutación por error en la pestaña **Trabajos** .</span><span class="sxs-lookup"><span data-stu-id="ff657-145">Track failover progress on the **Jobs** tab.</span></span> <span data-ttu-id="ff657-146">Debe poder ver la máquina de réplica de prueba en el Portal de Azure.</span><span class="sxs-lookup"><span data-stu-id="ff657-146">You should be able to see the test replica machine in the Azure portal.</span></span>
1. <span data-ttu-id="ff657-147">Para iniciar una conexión RDP en la máquina virtual, debe [agregar una dirección IP pública](site-recovery-monitoring-and-troubleshooting.md#adding-a-public-ip-on-a-resource-manager-virtual-machine) en la interfaz de red de la máquina virtual que se ha conmutado por error.</span><span class="sxs-lookup"><span data-stu-id="ff657-147">To initiate an RDP connection on the virtual machine, you will need to [add a public ip](site-recovery-monitoring-and-troubleshooting.md#adding-a-public-ip-on-a-resource-manager-virtual-machine) on the network interface of the failed over virtual machine.</span></span> <span data-ttu-id="ff657-148">Si conmuta por error a una máquina virtual en modo clásico, debe [agregar un punto de conexión](../virtual-machines/windows/classic/setup-endpoints.md) en el puerto 3389.</span><span class="sxs-lookup"><span data-stu-id="ff657-148">If you are failing over to a Classic virtual machine, then you need to [add an endpoint](../virtual-machines/windows/classic/setup-endpoints.md) on port 3389</span></span>
1. <span data-ttu-id="ff657-149">Una vez que haya terminado, haga clic en **Cleanup test failover** (Limpieza de conmutación por error de prueba) en el plan de recuperación.</span><span class="sxs-lookup"><span data-stu-id="ff657-149">Once you're done, click **Cleanup test failover** on the recovery plan.</span></span> <span data-ttu-id="ff657-150">En **Notas** , registre y guarde las observaciones asociadas a la conmutación por error de prueba.</span><span class="sxs-lookup"><span data-stu-id="ff657-150">In **Notes** record and save any observations associated with the test failover.</span></span> <span data-ttu-id="ff657-151">Así se eliminan las máquinas virtuales que se crearon durante la conmutación por error de prueba.</span><span class="sxs-lookup"><span data-stu-id="ff657-151">This deletes the virtual machines that were created during test failover.</span></span>


> [!TIP]
> <span data-ttu-id="ff657-152">Site Recovery intenta crear máquinas virtuales de prueba en una subred del mismo nombre y con la misma dirección IP que se proporcionó en la opción **Proceso y red** de la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="ff657-152">Site Recovery attempts to create test virtual machines in a subnet of same name and using the same IP as that provided in **Compute and Network** settings of the virtual machine.</span></span> <span data-ttu-id="ff657-153">Si no hay disponible una subred del mismo nombre en la red virtual de Azure proporcionada para la conmutación por error de prueba, la máquina virtual de prueba se crea en la primera subred por orden alfabético.</span><span class="sxs-lookup"><span data-stu-id="ff657-153">If subnet of same name is not available in the Azure virtual network provided for test failover, then test virtual machine is created in the first subnet alphabetically.</span></span> <span data-ttu-id="ff657-154">Si la dirección IP de destino forma parte de la subred seleccionada, Site Recovery trata de crear la máquina de virtual de conmutación por error de prueba mediante la dirección IP de destino.</span><span class="sxs-lookup"><span data-stu-id="ff657-154">If the target IP is part of the chosen subnet, then site recovery tries to create the test failover virtual machine using the target IP.</span></span> <span data-ttu-id="ff657-155">Si la dirección IP de destino no forma parte de la subred seleccionada, la máquina virtual de conmutación por error de prueba se creará con cualquier dirección IP disponible en la subred seleccionada.</span><span class="sxs-lookup"><span data-stu-id="ff657-155">If the target IP is not part of the chosen subnet then test failover virtual machine gets created using any available IP in the chosen subnet.</span></span>
>
>

## <a name="test-failover-job"></a><span data-ttu-id="ff657-156">Trabajo de conmutación por error de prueba</span><span class="sxs-lookup"><span data-stu-id="ff657-156">Test failover job</span></span>

![Test Failover](./media/site-recovery-test-failover-to-azure/TestFailoverJob.png)

<span data-ttu-id="ff657-158">Cuando se desencadena una conmutación por error de prueba, se realizan estos pasos:</span><span class="sxs-lookup"><span data-stu-id="ff657-158">When a test failover is triggered, it involves following steps:</span></span>

1. <span data-ttu-id="ff657-159">Comprobación de los requisitos previos: en este paso se garantiza que se cumplen todas las condiciones necesarias para la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="ff657-159">Prerequisites check: This step ensures that all conditions required for failover are met</span></span>
1. <span data-ttu-id="ff657-160">Conmutación por error: en este paso se procesan los datos y se preparan para que se pueda crear una máquina virtual de Azure a partir de ellos.</span><span class="sxs-lookup"><span data-stu-id="ff657-160">Failover: This step processes the data and makes it ready so that an Azure virtual machine can be created out of it.</span></span> <span data-ttu-id="ff657-161">Si ha elegido el punto de recuperación **más reciente**, en este paso se crea un punto de recuperación de los datos enviados al servicio.</span><span class="sxs-lookup"><span data-stu-id="ff657-161">If you have chosen **Latest** recovery point, this step creates a recovery point from the data that has been sent to the service.</span></span>
1. <span data-ttu-id="ff657-162">Inicio: en este paso se crea una máquina virtual de Azure con los datos procesados en el paso anterior.</span><span class="sxs-lookup"><span data-stu-id="ff657-162">Start: This step creates an Azure virtual machine using the data processed in the previous step.</span></span>

## <a name="time-taken-for-failover"></a><span data-ttu-id="ff657-163">Tiempo necesario para la conmutación por error</span><span class="sxs-lookup"><span data-stu-id="ff657-163">Time taken for failover</span></span>

<span data-ttu-id="ff657-164">En algunos casos, la conmutación por error de máquinas virtuales requiere un paso intermedio adicional que normalmente tarda aproximadamente de 8 a 10 minutos en completarse.</span><span class="sxs-lookup"><span data-stu-id="ff657-164">In certain cases, failover of virtual machines requires an extra intermediate step that usually takes around 8  to 10 minutes to complete.</span></span> <span data-ttu-id="ff657-165">Estos casos son los siguientes:</span><span class="sxs-lookup"><span data-stu-id="ff657-165">These cases are as following:</span></span>

* <span data-ttu-id="ff657-166">Máquinas virtuales de VMware que usan una versión del servicio Mobility anterior a la 9.8</span><span class="sxs-lookup"><span data-stu-id="ff657-166">VMware virtual machines using a version of the Mobility service older than 9.8</span></span>
* <span data-ttu-id="ff657-167">Servidores físicos</span><span class="sxs-lookup"><span data-stu-id="ff657-167">Physical servers</span></span>
* <span data-ttu-id="ff657-168">Máquinas virtuales de VMware Linux</span><span class="sxs-lookup"><span data-stu-id="ff657-168">VMware Linux virtual machines</span></span>
* <span data-ttu-id="ff657-169">Máquinas virtuales Hyper-V protegidas como servidores físicos</span><span class="sxs-lookup"><span data-stu-id="ff657-169">Hyper-V virtual machines protected as physical servers</span></span>
* <span data-ttu-id="ff657-170">Máquinas virtuales de VMware donde los siguientes controladores no están presentes como controladores de arranque</span><span class="sxs-lookup"><span data-stu-id="ff657-170">VMware virtual machines where following drivers are not present as boot drivers</span></span>
    * <span data-ttu-id="ff657-171">storvsc</span><span class="sxs-lookup"><span data-stu-id="ff657-171">storvsc</span></span>
    * <span data-ttu-id="ff657-172">vmbus</span><span class="sxs-lookup"><span data-stu-id="ff657-172">vmbus</span></span>
    * <span data-ttu-id="ff657-173">storflt</span><span class="sxs-lookup"><span data-stu-id="ff657-173">storflt</span></span>
    * <span data-ttu-id="ff657-174">intelide</span><span class="sxs-lookup"><span data-stu-id="ff657-174">intelide</span></span>
    * <span data-ttu-id="ff657-175">atapi</span><span class="sxs-lookup"><span data-stu-id="ff657-175">atapi</span></span>
* <span data-ttu-id="ff657-176">Máquinas virtuales de VMware que no tienen el servicio DHCP habilitado independientemente de si usan direcciones IP estáticas o DHCP</span><span class="sxs-lookup"><span data-stu-id="ff657-176">VMware virtual machines that don't have DHCP service enabled irrespective of whether they are using DHCP or static IP addresses</span></span>

<span data-ttu-id="ff657-177">En todos los demás casos, no es necesario este paso intermedio y el tiempo necesario para la conmutación por error es significativamente menor.</span><span class="sxs-lookup"><span data-stu-id="ff657-177">In all the other cases this intermediate step is not required and the time taken for the failover is significantly lower.</span></span>


## <a name="creating-a-network-for-test-failover"></a><span data-ttu-id="ff657-178">Creación de una red para conmutación por error de prueba</span><span class="sxs-lookup"><span data-stu-id="ff657-178">Creating a network for test failover</span></span>
<span data-ttu-id="ff657-179">Se recomienda que, cuando realice una conmutación por error de prueba, elija una red que esté aislada de la red del sitio de recuperación de producción que proporcionó en la configuración **Proceso y red** de la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="ff657-179">It is recommended that when you are doing a test failover you choose a network that is isolated from your production recovery site network that you provided in **Compute and Network** settings for the virtual machine.</span></span> <span data-ttu-id="ff657-180">De forma predeterminada, cualquier red virtual que se cree en Azure está aislada de otras redes.</span><span class="sxs-lookup"><span data-stu-id="ff657-180">By default when you create an Azure virtual network, it is isolated from other networks.</span></span> <span data-ttu-id="ff657-181">Esta red debe imitar la red de producción:</span><span class="sxs-lookup"><span data-stu-id="ff657-181">This network should mimic your production network:</span></span>

1. <span data-ttu-id="ff657-182">La red de prueba debe tener el mismo número de subredes que la red de producción y con el mismo nombre que las subredes de la red de producción.</span><span class="sxs-lookup"><span data-stu-id="ff657-182">Test network should have same number of subnets as that in your production network and with the same name as those of the subnets in your production network.</span></span>
1. <span data-ttu-id="ff657-183">La red de prueba debe usar el mismo intervalo de IP que la red de producción.</span><span class="sxs-lookup"><span data-stu-id="ff657-183">Test network should use the same IP range as that of your production network.</span></span>
1. <span data-ttu-id="ff657-184">Actualice el DNS de la red de prueba con la dirección IP que asignó como IP de destino para la máquina virtual de DNS en la configuración de **Proceso y red**.</span><span class="sxs-lookup"><span data-stu-id="ff657-184">Update the DNS of the Test Network as the IP that you gave as target IP for the DNS virtual machine under **Compute and Network** settings.</span></span> <span data-ttu-id="ff657-185">Examine la sección [Consideraciones sobre la conmutación por error de prueba para Active Directory](site-recovery-active-directory.md#test-failover-considerations) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="ff657-185">Go through [test failover considerations for active directory](site-recovery-active-directory.md#test-failover-considerations) section for more details.</span></span>


## <a name="test-failover-to-a-production-network-on-recovery-site"></a><span data-ttu-id="ff657-186">Conmutación por error de prueba a una red de producción en el sitio de recuperación</span><span class="sxs-lookup"><span data-stu-id="ff657-186">Test failover to a production network on recovery site</span></span>
<span data-ttu-id="ff657-187">Se recomienda que, cuando realice una conmutación por error de prueba, elija una red diferente de la red del sitio de recuperación de producción que proporcionó en la configuración **Proceso y red** de la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="ff657-187">It is recommended that when you are doing a test failover you choose a network that is different from your production recovery site network that you provided in **Compute and Network** settings for the virtual machine.</span></span> <span data-ttu-id="ff657-188">Sin embargo, si realmente desea validar la conectividad de un extremo a otro de la red en una máquina virtual que se ha conmutado por error, tenga en cuenta lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="ff657-188">But if you really want to validate end to end network connectivity in a failed over virtual machine, note the following points:</span></span>

1. <span data-ttu-id="ff657-189">Asegúrese de que la máquina virtual principal está apagada cuando se realice la conmutación por error de prueba.</span><span class="sxs-lookup"><span data-stu-id="ff657-189">Make sure that the primary virtual machine is shutdown when you are doing the test failover.</span></span> <span data-ttu-id="ff657-190">Si no lo está, habrá dos máquinas virtuales con la misma identidad en ejecución en la misma red y al mismo tiempo, lo que puede tener consecuencias no deseadas.</span><span class="sxs-lookup"><span data-stu-id="ff657-190">If you don't do so, there will be two virtual machines with the same identity running in the same network at the same time and that can lead to undesired consequences.</span></span>
1. <span data-ttu-id="ff657-191">Se perderán los cambios realizados en las máquinas virtuales de conmutación por error de prueba al limpiar las máquinas virtuales de conmutación por error de prueba.</span><span class="sxs-lookup"><span data-stu-id="ff657-191">Any changes that you make into the test failover virtual machines would be lost when you cleanup the test failover virtual machines.</span></span> <span data-ttu-id="ff657-192">Estos cambios no se replicarán de nuevo a la máquina virtual principal.</span><span class="sxs-lookup"><span data-stu-id="ff657-192">These changes will not be replicated back to the primary virtual machine.</span></span>
1. <span data-ttu-id="ff657-193">Esta forma de realizar pruebas provoca un tiempo de inactividad de la aplicación de producción.</span><span class="sxs-lookup"><span data-stu-id="ff657-193">This way of doing testing leads to a downtime of your production application.</span></span> <span data-ttu-id="ff657-194">Se debe solicitar a los usuarios de la aplicación que no la utilicen si la exploración de la recuperación ante desastres está en curso.</span><span class="sxs-lookup"><span data-stu-id="ff657-194">Users of the application should be asked to not use the application when the DR drill is in progress.</span></span>  



## <a name="prepare-active-directory-and-dns"></a><span data-ttu-id="ff657-195">Preparación de Active Directory y DNS</span><span class="sxs-lookup"><span data-stu-id="ff657-195">Prepare Active Directory and DNS</span></span>
<span data-ttu-id="ff657-196">Para ejecutar una conmutación por error de prueba con el fin de probar la aplicación, necesita una copia del entorno de Active Directory de producción en el entorno de prueba.</span><span class="sxs-lookup"><span data-stu-id="ff657-196">To run a test failover for application testing, you need a copy of the production Active Directory environment in your test environment.</span></span> <span data-ttu-id="ff657-197">Examine la sección [Consideraciones sobre la conmutación por error de prueba para Active Directory](site-recovery-active-directory.md#test-failover-considerations) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="ff657-197">Go through [test failover considerations for active directory](site-recovery-active-directory.md#test-failover-considerations) section for more details.</span></span>

## <a name="prepare-to-connect-to-azure-vms-after-failover"></a><span data-ttu-id="ff657-198">Preparación para la conexión a las máquinas virtuales de Azure después de la conmutación por error</span><span class="sxs-lookup"><span data-stu-id="ff657-198">Prepare to connect to Azure VMs after failover</span></span>

<span data-ttu-id="ff657-199">Si desea conectarse a máquinas virtuales de Azure mediante RDP después de la conmutación por error, asegúrese de realizar las acciones resumidas en la tabla.</span><span class="sxs-lookup"><span data-stu-id="ff657-199">If you want to connect to Azure VMs using RDP after failover, make sure you do the actions summarized in the table.</span></span>

<span data-ttu-id="ff657-200">**Conmutación por error**</span><span class="sxs-lookup"><span data-stu-id="ff657-200">**Failover**</span></span> | <span data-ttu-id="ff657-201">**Ubicación**</span><span class="sxs-lookup"><span data-stu-id="ff657-201">**Location**</span></span> | <span data-ttu-id="ff657-202">**Acciones**</span><span class="sxs-lookup"><span data-stu-id="ff657-202">**Actions**</span></span>
--- | --- | ---
<span data-ttu-id="ff657-203">**Máquina virtual de Azure que ejecuta Windows**</span><span class="sxs-lookup"><span data-stu-id="ff657-203">**Azure VM running Windows**</span></span> | <span data-ttu-id="ff657-204">En la máquina local antes de la conmutación por error</span><span class="sxs-lookup"><span data-stu-id="ff657-204">On on-premises machine before failover</span></span> | <span data-ttu-id="ff657-205">Para acceder a la máquina virtual de Azure a través de Internet, habilite RDP, asegúrese de que se hayan agregado las reglas de TCP y UDP para **Público**, y que RDP esté permitido en **Firewall de Windows** > **Aplicaciones permitidas**, para todos los perfiles.</span><span class="sxs-lookup"><span data-stu-id="ff657-205">To access the Azure VM over the internet, enable RDP, make sure TCP, and UDP rules are added for the **Public**, and that RDP is allowed in **Windows Firewall** > **Allowed Apps**, for all profiles.</span></span><br/><br/> <span data-ttu-id="ff657-206">Para obtener acceso a través de una conexión de sitio a sitio, habilite el protocolo RDP en la máquina y asegúrese de que este está permitido en **Firewall de Windows** -> **Aplicaciones y características permitidas** para redes **Dominio y Privadas**.</span><span class="sxs-lookup"><span data-stu-id="ff657-206">To access over a site-to-site connection, enable RDP on the machine, and ensure that RDP is allowed in the **Windows Firewall** -> **Allowed apps and features** for **Domain and Private** networks.</span></span><br/><br/>  <span data-ttu-id="ff657-207">Asegúrese de que la directiva SAN del sistema operativo está establecida en **OnlineAll**.</span><span class="sxs-lookup"><span data-stu-id="ff657-207">Make sure the operating system's SAN policy is set to **OnlineAll**.</span></span> <span data-ttu-id="ff657-208">[Más información](https://support.microsoft.com/kb/3031135).</span><span class="sxs-lookup"><span data-stu-id="ff657-208">[Learn more](https://support.microsoft.com/kb/3031135).</span></span><br/><br/> <span data-ttu-id="ff657-209">Asegúrese de que no haya actualizaciones de Windows pendientes en la máquina virtual cuando se desencadena una conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="ff657-209">Make sure there are no Windows updates pending on the virtual machine when you trigger a failover.</span></span> <span data-ttu-id="ff657-210">Una actualización de Windows podría iniciarse durante la conmutación por error, lo que impediría que pudiera iniciar sesión en la máquina virtual hasta que se completara la actualización.</span><span class="sxs-lookup"><span data-stu-id="ff657-210">Windows update might start when you failover and you will not be able to login to the virtual machine until the update completes.</span></span> <br/><br/>
<span data-ttu-id="ff657-211">**Máquina virtual de Azure que ejecuta Windows**</span><span class="sxs-lookup"><span data-stu-id="ff657-211">**Azure VM running Windows**</span></span> | <span data-ttu-id="ff657-212">En la máquina virtual de Azure después de la conmutación por error</span><span class="sxs-lookup"><span data-stu-id="ff657-212">On Azure VM after failover</span></span> | <span data-ttu-id="ff657-213">Para una máquina virtual clásica, [añada un punto de conexión público](../virtual-machines/windows/classic/setup-endpoints.md) para el protocolo RDP (puerto 3389).</span><span class="sxs-lookup"><span data-stu-id="ff657-213">For a classic virtual machine, [add a public endpoint](../virtual-machines/windows/classic/setup-endpoints.md) for the RDP protocol (port 3389)</span></span><br/><br/>  <span data-ttu-id="ff657-214">En el caso de una máquina virtual de Resource Manager, [añada una dirección IP pública](site-recovery-monitoring-and-troubleshooting.md#adding-a-public-ip-on-a-resource-manager-virtual-machine) a la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="ff657-214">For a Resource Manager virtual machine, [add a public IP](site-recovery-monitoring-and-troubleshooting.md#adding-a-public-ip-on-a-resource-manager-virtual-machine) on it.</span></span><br/><br/> <span data-ttu-id="ff657-215">Las reglas del grupo de seguridad de red de la máquina virtual conmutada por error y la subred de Azure a la que esta se conecta deben permitir las conexiones entrantes al puerto RDP.</span><span class="sxs-lookup"><span data-stu-id="ff657-215">The network security group rules on the failed over VM, and the Azure subnet to which it is connected, need to allow incoming connections to the RDP port.</span></span><br/><br/> <span data-ttu-id="ff657-216">Para una máquina virtual de Resource Manager, también puede consultar **Diagnósticos de arranque** para ver una captura de pantalla de la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="ff657-216">For a Resource Manager virtual machine, you can check **Boot diagnostics** to look at a screenshot of the virtual machine</span></span><br/><br/> <span data-ttu-id="ff657-217">Si no puede conectarse, compruebe que se está ejecutando la máquina virtual y, a continuación, consulte estas [sugerencias de solución de problemas](http://social.technet.microsoft.com/wiki/contents/articles/31666.troubleshooting-remote-desktop-connection-after-failover-using-asr.aspx).</span><span class="sxs-lookup"><span data-stu-id="ff657-217">If you can't connect, check that the VM is running and then look at these [troubleshooting tips](http://social.technet.microsoft.com/wiki/contents/articles/31666.troubleshooting-remote-desktop-connection-after-failover-using-asr.aspx).</span></span><br/><br/>
<span data-ttu-id="ff657-218">**Máquina virtual de Azure que ejecuta Linux**</span><span class="sxs-lookup"><span data-stu-id="ff657-218">**Azure VM running Linux**</span></span> | <span data-ttu-id="ff657-219">En la máquina local antes de la conmutación por error</span><span class="sxs-lookup"><span data-stu-id="ff657-219">On on-premises machine before failover</span></span> | <span data-ttu-id="ff657-220">Asegúrese de que el servicio de Secure Shell en la máquina virtual de Azure está configurado para iniciarse automáticamente en el arranque del sistema.</span><span class="sxs-lookup"><span data-stu-id="ff657-220">Ensure that the Secure Shell service on the Azure VM is set to start automatically on system boot.</span></span><br/><br/> <span data-ttu-id="ff657-221">Compruebe que las reglas de firewall permiten una conexión SSH.</span><span class="sxs-lookup"><span data-stu-id="ff657-221">Check that firewall rules allow an SSH connection to it.</span></span>
<span data-ttu-id="ff657-222">**Máquina virtual de Azure que ejecuta Linux**</span><span class="sxs-lookup"><span data-stu-id="ff657-222">**Azure VM running Linux**</span></span> | <span data-ttu-id="ff657-223">Máquina virtual de Azure después de la conmutación por error</span><span class="sxs-lookup"><span data-stu-id="ff657-223">Azure VM after failover</span></span> | <span data-ttu-id="ff657-224">Las reglas del grupo de seguridad de red de la máquina virtual conmutada por error y la subred de Azure a la que esta se conecta necesitan permitir las conexiones entrantes al puerto SSH.</span><span class="sxs-lookup"><span data-stu-id="ff657-224">The network security group rules on the failed over VM, and the Azure subnet to which it is connected, need to allow incoming connections to the SSH port.</span></span><br/><br/> <span data-ttu-id="ff657-225">Para una máquina virtual clásica, debe crearse un [punto de conexión público](../virtual-machines/windows/classic/setup-endpoints.md) para permitir las conexiones entrantes en el puerto SSH (de forma predeterminada, es el puerto TCP 22).</span><span class="sxs-lookup"><span data-stu-id="ff657-225">For  a classic virtual machine, [add a public endpoint](../virtual-machines/windows/classic/setup-endpoints.md) should be created, to allow incoming connections on the SSH port (TCP port 22 by default).</span></span><br/><br/> <span data-ttu-id="ff657-226">En el caso de una máquina virtual de Resource Manager, [añada una dirección IP pública](site-recovery-monitoring-and-troubleshooting.md#adding-a-public-ip-on-a-resource-manager-virtual-machine) a la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="ff657-226">For a Resource Manager virtual machine, [add a public IP](site-recovery-monitoring-and-troubleshooting.md#adding-a-public-ip-on-a-resource-manager-virtual-machine) on it.</span></span><br/><br/> <span data-ttu-id="ff657-227">Para una máquina virtual de Resource Manager, también puede consultar **Diagnósticos de arranque** para ver una captura de pantalla de la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="ff657-227">For a Resource Manager virtual machine, you can check **Boot diagnostics** to look at a screenshot of the virtual machine</span></span><br/><br/>



## <a name="next-steps"></a><span data-ttu-id="ff657-228">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="ff657-228">Next steps</span></span>
<span data-ttu-id="ff657-229">Después de ejecutar correctamente una conmutación por error de prueba, puede intentar realizar una [conmutación por error](site-recovery-failover.md).</span><span class="sxs-lookup"><span data-stu-id="ff657-229">Once you have successfully tried a test failover you can try doing a [failover](site-recovery-failover.md).</span></span>

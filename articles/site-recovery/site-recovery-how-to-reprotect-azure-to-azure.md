---
title: "Cómo volver a proteger máquinas virtuales de Azure conmutadas por error de vuelta en la región principal de Azure | Microsoft Docs"
description: "Después de la conmutación por error de máquinas virtuales de una región de Azure en otra, puede usar Azure Site Recovery para proteger las máquinas en dirección inversa. Conozca los pasos para volver a proteger antes de una nueva conmutación por error."
services: site-recovery
documentationcenter: 
author: ruturaj
manager: gauravd
editor: 
ms.assetid: 44813a48-c680-4581-a92e-cecc57cc3b1e
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 08/11/2017
ms.author: ruturajd
ms.openlocfilehash: 32f5d2d142940bc515849dcd0edb1bb1f152aa6d
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/18/2017
---
# <a name="reprotect-from-failed-over-azure-region-back-to-primary-region"></a><span data-ttu-id="9e9bf-104">Volver a proteger desde una región de Azure conmutada por error de nuevo en la región principal</span><span class="sxs-lookup"><span data-stu-id="9e9bf-104">Reprotect from failed over Azure region back to primary region</span></span>



>[!NOTE]
>
> <span data-ttu-id="9e9bf-105">La replicación de Site Recovery para máquinas virtuales de Azure está actualmente en vista previa.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-105">Site Recovery replication for Azure virtual machines is currently in preview.</span></span>


## <a name="overview"></a><span data-ttu-id="9e9bf-106">Información general</span><span class="sxs-lookup"><span data-stu-id="9e9bf-106">Overview</span></span>
<span data-ttu-id="9e9bf-107">Cuando se [conmutan por error](site-recovery-failover.md) las máquinas virtuales de una región de Azure en otra, las máquinas virtuales están en un estado desprotegido.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-107">When you [failover](site-recovery-failover.md) the virtual machines from one Azure region to another, the virtual machines are in an unprotected state.</span></span> <span data-ttu-id="9e9bf-108">Si quiere volver a llevarlas a la región principal, primero debe protegerlas y luego volver a conmutar por error.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-108">If you want to bring them back to the primary region, you need to first protect the virtual machines and then failover again.</span></span> <span data-ttu-id="9e9bf-109">No hay ninguna diferencia entre cómo se conmuta por error en una dirección u otra.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-109">There is no difference between how you failover in one direction or other.</span></span> <span data-ttu-id="9e9bf-110">Del mismo modo, para habilitar la protección de las máquinas virtuales posteriormente, no hay ninguna diferencia entre volver a proteger después de la conmutación por error o por recuperación.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-110">Similarly, post enable protection of the virtual machines, there is no difference between the reprotect post failover, or post failback.</span></span>
<span data-ttu-id="9e9bf-111">Para explicar los flujos de trabajo de reprotección y para evitar confusiones, se usará el sitio principal de las máquinas protegidas como región de Asia Oriental y el sitio de recuperación de las máquinas como región de Asia Suroriental.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-111">To explain the workflows of reprotect, and to avoid confusion, we will use the primary site of the protected machines as East Asia region, and the recovery site of the machines as South East Asia region.</span></span> <span data-ttu-id="9e9bf-112">Durante la conmutación por error, las máquinas virtuales se conmutan por error en la región de Asia Suroriental.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-112">During failover, you will failover the virtual machines to the South East Asia region.</span></span> <span data-ttu-id="9e9bf-113">Antes de la conmutación por recuperación, debe volver a proteger las máquinas virtuales de Asia Suroriental en Asia Oriental.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-113">Before you failback, you need to reprotect the virtual machines from South East Asia back to East Asia.</span></span> <span data-ttu-id="9e9bf-114">En este artículo se explican los pasos para volver a proteger.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-114">This article describes the steps on how to reprotect.</span></span>

> [!WARNING]
> <span data-ttu-id="9e9bf-115">Si ha [finalizado la migración](site-recovery-migrate-to-azure.md#what-do-we-mean-by-migration), ha trasladado la máquina virtual a otro grupo de recursos o ha eliminado la máquina virtual de Azure, no puede entonces realizar la conmutación por recuperación.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-115">If you have [completed migration](site-recovery-migrate-to-azure.md#what-do-we-mean-by-migration), moved the virtual machine to another resource group, or deleted the Azure virtual machine, you cannot failback after that.</span></span>

<span data-ttu-id="9e9bf-116">Una vez que la reprotección ha finalizado y las máquinas virtuales protegidas se están replicando, puede iniciar una conmutación por error en las máquinas virtuales para llevarlas de nuevo a la región de Asia Oriental.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-116">After reprotect finishes and the protected virtual machines are replicating, you can initiate a failover on the virtual machines to bring them back to East Asia region.</span></span>

<span data-ttu-id="9e9bf-117">Publique cualquier comentario o pregunta que tenga al final del artículo, o bien en el [foro de Azure Recovery Services](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="9e9bf-117">Post comments or questions at the end of this article or on the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>

## <a name="prerequisites"></a><span data-ttu-id="9e9bf-118">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="9e9bf-118">Prerequisites</span></span>
1. <span data-ttu-id="9e9bf-119">Las máquinas virtuales deben haberse confirmado.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-119">The virtual machines should have been committed.</span></span>
2. <span data-ttu-id="9e9bf-120">El sitio de destino, en este caso la región de Azure de Asia Oriental, debe estar disponible y debe poder acceder a nuevos recursos en dicha región o crearlos.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-120">The target site - in this case the East Asia Azure region should be available and should be able to access/create new resources in that region.</span></span>

## <a name="steps-to-reprotect"></a><span data-ttu-id="9e9bf-121">Pasos para la reprotección</span><span class="sxs-lookup"><span data-stu-id="9e9bf-121">Steps to reprotect</span></span>

<span data-ttu-id="9e9bf-122">A continuación se indican los pasos para volver a proteger una máquina virtual con los valores predeterminados.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-122">Following are the steps to reprotect a virtual machine using the defaults.</span></span>

1. <span data-ttu-id="9e9bf-123">En **Almacén** > **Elementos replicados**, haga clic con el botón derecho en la máquina virtual que ha sido objeto de la conmutación por error y seleccione **Reproteger**.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-123">In **Vault** > **Replicated items**, right-click the virtual machine that's been failed over, and then select **Re-Protect**.</span></span> <span data-ttu-id="9e9bf-124">También puede hacer clic en la máquina y seleccionar **Reproteger** con los botones de comando.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-124">You can also click the machine and select **Re-Protect** from the command buttons.</span></span>

![Haga clic con el botón derecho para volver a proteger](./media/site-recovery-how-to-reprotect-azure-to-azure/reprotect.png)

2. <span data-ttu-id="9e9bf-126">En la hoja, observe que la dirección de protección, **Asia Suroriental a Asia Oriental**, ya está seleccionada.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-126">In the blade, notice that the direction of protection, **Southeast Asia to East asia**, is already selected.</span></span>

![Volver a proteger la hoja](./media/site-recovery-how-to-reprotect-azure-to-azure/reprotectblade.png)

3. <span data-ttu-id="9e9bf-128">Revise la información de **Grupo de recursos, Red, Almacenamiento y Conjuntos de disponibilidad** y haga clic en Aceptar.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-128">Review the **Resource group, Network, Storage and Availability sets** information and click OK.</span></span> <span data-ttu-id="9e9bf-129">Si hay algún recurso marcado (nuevo), se creará como parte de la reprotección.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-129">If there are any resources marked (new), they will be created as part of the reprotect.</span></span>

<span data-ttu-id="9e9bf-130">Esto desencadenará un trabajo de reprotección que primero propagará el sitio de destino (región de Asia Suroriental en este caso) con los datos más recientes y, una vez hecho esto, replicará los valores delta antes de conmutar por error de nuevo en Asia Suroriental.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-130">This will trigger a job reprotect job that will first seed the target site (SEA in this case) with the latest data, and once that completes, will replicate the deltas before you failover back to Southeast Asia.</span></span>

### <a name="reprotect-customization"></a><span data-ttu-id="9e9bf-131">Volver a proteger la personalización</span><span class="sxs-lookup"><span data-stu-id="9e9bf-131">Reprotect customization</span></span>
<span data-ttu-id="9e9bf-132">Si quiere elegir la cuenta de almacenamiento de extracción o la red durante la reprotección, puede hacerlo mediante la opción de personalización proporcionada en la hoja de reprotección.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-132">If you want to choose the extract storage account or the network during reprotect, you can do so using the customize option provided on the reprotect blade.</span></span>

![Opción de personalización](./media/site-recovery-how-to-reprotect-azure-to-azure/customize.png)

<span data-ttu-id="9e9bf-134">Puede personalizar las siguientes propiedades de la máquina virtual de destino durante la reprotección.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-134">You can customize the following properties of he target virtual machine during reprotect.</span></span>

![Personalizar la hoja](./media/site-recovery-how-to-reprotect-azure-to-azure/customizeblade.png)

|<span data-ttu-id="9e9bf-136">Propiedad</span><span class="sxs-lookup"><span data-stu-id="9e9bf-136">Property</span></span> |<span data-ttu-id="9e9bf-137">Notas</span><span class="sxs-lookup"><span data-stu-id="9e9bf-137">Notes</span></span>  |
|---------|---------|
|<span data-ttu-id="9e9bf-138">Grupo de recursos de destino</span><span class="sxs-lookup"><span data-stu-id="9e9bf-138">Target resource group</span></span>     | <span data-ttu-id="9e9bf-139">Puede cambiar el grupo de recursos de destino en el que se va a crear la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-139">You can choose to change the target resource group in which th virtual machine will be created.</span></span> <span data-ttu-id="9e9bf-140">Como parte de la reprotección, se eliminará la máquina virtual de destino, así que puede elegir un nuevo grupo de recursos en el que crear la máquina virtual posterior a la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-140">As the part of reprotect, the target virtual machine will be deleted, hence you can choose a new resource group under which you can create the VM post failover</span></span>         |
|<span data-ttu-id="9e9bf-141">Red virtual de destino</span><span class="sxs-lookup"><span data-stu-id="9e9bf-141">Target Virtual Network</span></span>     | <span data-ttu-id="9e9bf-142">No se puede cambiar la red durante la reprotección.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-142">Network cannot be changed during the reprotect.</span></span> <span data-ttu-id="9e9bf-143">Para cambiar la red, vuelva a hacer la asignación de red.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-143">To change the network, redo the network mapping.</span></span>         |
|<span data-ttu-id="9e9bf-144">Almacenamiento de destino</span><span class="sxs-lookup"><span data-stu-id="9e9bf-144">Target Storage</span></span>     | <span data-ttu-id="9e9bf-145">Puede cambiar la cuenta de almacenamiento en la que se creará la máquina virtual después de la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-145">You can change the storage account to which the virtual machine will be created post failover.</span></span>         |
|<span data-ttu-id="9e9bf-146">Almacenamiento en caché</span><span class="sxs-lookup"><span data-stu-id="9e9bf-146">Cache Storage</span></span>     | <span data-ttu-id="9e9bf-147">Puede especificar una cuenta de almacenamiento en caché que se usará durante la replicación.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-147">You can specify a cache storage account which will be used during replication.</span></span> <span data-ttu-id="9e9bf-148">Si usa los valores predeterminados, se creará una nueva cuenta de almacenamiento en caché, si aún no existe.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-148">If you go with the defaults, a new cache storage account will be created, if it does not already exist.</span></span>         |
|<span data-ttu-id="9e9bf-149">Conjunto de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="9e9bf-149">Availability Set</span></span>     |<span data-ttu-id="9e9bf-150">Si la máquina virtual de Asia Oriental forma parte de un conjunto de disponibilidad, puede elegir un conjunto de disponibilidad para la máquina virtual de destino de Asia Suroriental.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-150">If the virtual machine in East Asia is part of an availability set, you can choose an availability set for the target virtual machine in Southeast Asia.</span></span> <span data-ttu-id="9e9bf-151">Los valores predeterminados buscarán el conjunto de disponibilidad de la región de Asia Suroriental existente e intentarán usarlo.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-151">Defaults will find the existing SEA availability set and try to use it.</span></span> <span data-ttu-id="9e9bf-152">Durante la personalización, puede especificar un conjunto de disponibilidad completamente nuevo.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-152">During customization, you can specify a completely new AV set.</span></span>         |


### <a name="what-happens-during-reprotect"></a><span data-ttu-id="9e9bf-153">¿Qué ocurre durante la reprotección?</span><span class="sxs-lookup"><span data-stu-id="9e9bf-153">What happens during reprotect?</span></span>

<span data-ttu-id="9e9bf-154">Igual que después de habilitar la protección por primera vez, estos son los artefactos que se crean si usa los valores predeterminados.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-154">Just like after the first enable protection, following are the artefacts that get created if you use the defaults.</span></span>
1. <span data-ttu-id="9e9bf-155">Se crea una cuenta de almacenamiento en caché en la región de Asia Oriental.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-155">A cache storage account gets created in the East Asia region.</span></span>
2. <span data-ttu-id="9e9bf-156">Si la cuenta de almacenamiento de destino (la cuenta de almacenamiento original de la máquina virtual de Asia Suroriental) no existe, se crea una nueva.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-156">If the target storage account (the original storage account of the Southeast Asia VM) does not exist, a new one is created.</span></span> <span data-ttu-id="9e9bf-157">El nombre es la cuenta de almacenamiento de la máquina virtual de Asia Oriental con el sufijo "asr".</span><span class="sxs-lookup"><span data-stu-id="9e9bf-157">The name is the East Asia virtual machine's storage account suffixed with "asr".</span></span>
3. <span data-ttu-id="9e9bf-158">Si no existe el conjunto de disponibilidad de destino y los valores predeterminados detectan que hay que crear un nuevo conjunto de disponibilidad, se crea como parte del trabajo de reprotección.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-158">If the target AV set does not exist, and the defaults detect that it needs to create a new AV set, then it will be created as part of the reprotect job.</span></span> <span data-ttu-id="9e9bf-159">Si ha personalizado la reprotección, se usa el conjunto de disponibilidad seleccionado.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-159">If you have customized the reprotect, then the selected AV set will be used.</span></span>
4.

<span data-ttu-id="9e9bf-160">A continuación se indican los pasos que se producen al desencadenar un trabajo de reprotección,</span><span class="sxs-lookup"><span data-stu-id="9e9bf-160">The following are the list of steps that happen when you trigger a reprotect job.</span></span> <span data-ttu-id="9e9bf-161">siempre que la máquina virtual de destino exista.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-161">This is in the case the target side virtual machine exists.</span></span>

1. <span data-ttu-id="9e9bf-162">Los artefactos necesarios se crean como parte de la reprotección.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-162">The required artefacts are created as part of reprotect.</span></span> <span data-ttu-id="9e9bf-163">Si ya existen, se vuelven a usar.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-163">If they already exist, then they are reused.</span></span>
2. <span data-ttu-id="9e9bf-164">Si se está ejecutando, primero se desactiva la máquina virtual de destino (Asia Suroriental).</span><span class="sxs-lookup"><span data-stu-id="9e9bf-164">The target side (Southeast Asia) virtual machine is first turned off, if it is running.</span></span>
3. <span data-ttu-id="9e9bf-165">Azure Site Recovery copia el disco de la máquina virtual de destino en un contenedor como un blob de inicialización.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-165">The target side virtual machine's disk is copied by Azure Site Recovery into a container as a seed blob.</span></span>
4. <span data-ttu-id="9e9bf-166">Luego se elimina la máquina virtual de destino.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-166">The target side virtual machine is then deleted.</span></span>
5. <span data-ttu-id="9e9bf-167">La máquina virtual de origen actual (Asia Oriental) usa el blob de inicialización para replicar.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-167">The seed blob is used by the current source side (East Asia) virtual machine to replicate.</span></span> <span data-ttu-id="9e9bf-168">Esto garantiza que solo se repliquen los valores delta.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-168">This ensures that only deltas are replicated.</span></span>
6. <span data-ttu-id="9e9bf-169">Se sincronizan los cambios más importantes entre el disco de origen y el blob de inicialización.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-169">The major changes between the source disk and the seed blob are synchronized.</span></span> <span data-ttu-id="9e9bf-170">Esta operación puede tardar un tiempo en finalizar.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-170">This can take some time to complete.</span></span>
7. <span data-ttu-id="9e9bf-171">Una vez que finaliza el trabajo de reprotección, comienza la replicación de valores delta que crea un punto de recuperación según la directiva.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-171">Once the reprotect job completes, the delta replication begins that creates a recovery point as per the policy.</span></span>

> [!NOTE]
> <span data-ttu-id="9e9bf-172">No se puede proteger en un nivel de plan de recuperación.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-172">You cannot protect at a recovery plan level.</span></span> <span data-ttu-id="9e9bf-173">Solo se puede volver a proteger en un nivel de máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-173">You can only reprotect at a per VM level.</span></span>

<span data-ttu-id="9e9bf-174">Una vez que la reprotección se haya completado correctamente, la máquina virtual entrará en un estado protegido.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-174">After the reprotect succeed, the virtual machine will enter a protected state.</span></span>

## <a name="next-steps"></a><span data-ttu-id="9e9bf-175">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="9e9bf-175">Next steps</span></span>

<span data-ttu-id="9e9bf-176">Una vez que la máquina virtual ha entrado en un estado protegido, puede iniciar una conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-176">After the virtual machine has entered a protected state, you can initiate a failover.</span></span> <span data-ttu-id="9e9bf-177">La conmutación por error apagará la máquina virtual de la región de Azure de Asia Oriental y luego creará e iniciará la máquina virtual de la región de Asia Suroriental.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-177">The failover will shut down the virtual machine in East Asia Azure region and then create and boot the Southeast Asia region virtual machine.</span></span> <span data-ttu-id="9e9bf-178">Por lo tanto, hay un breve tiempo de inactividad para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-178">Hence there is a small downtime for the application.</span></span> <span data-ttu-id="9e9bf-179">Así pues, elija para la conmutación por error un momento en que la aplicación pueda tolerar un tiempo de inactividad.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-179">So, choose the time for failover when your application can tolerate a downtime.</span></span> <span data-ttu-id="9e9bf-180">Se recomienda probar primero la conmutación por error de la máquina virtual para asegurarse de que se recupera correctamente antes de iniciar una conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="9e9bf-180">It is recommended that you first test failover the virtual machine to make sure it is coming up correctly, before initiating a failover.</span></span>

-   [<span data-ttu-id="9e9bf-181">Pasos para iniciar una conmutación por error de prueba de la máquina virtual</span><span class="sxs-lookup"><span data-stu-id="9e9bf-181">Steps to initiate test failover of the virtual machine</span></span>](site-recovery-test-failover-to-azure.md)

-   [<span data-ttu-id="9e9bf-182">Pasos para iniciar una conmutación por error de la máquina virtual</span><span class="sxs-lookup"><span data-stu-id="9e9bf-182">Steps to initiate failover of the virtual machine</span></span>](site-recovery-failover.md)

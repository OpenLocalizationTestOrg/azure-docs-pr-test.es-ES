---
title: aaaCreate varios modelos de un experimento | Documentos de Microsoft
description: "Usar PowerShell toocreate varios modelos de aprendizaje automático y extremos de servicio con hello web mismo algoritmo, pero los conjuntos de datos de entrenamiento diferentes."
services: machine-learning
documentationcenter: 
author: hning86
manager: jhubbard
editor: cgronlun
ms.assetid: 1076b8eb-5a0d-4ac5-8601-8654d9be229f
ms.service: machine-learning
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/04/2017
ms.author: garye;haining
ms.openlocfilehash: 4a258a8ab26395d4169a058520151c860e16e169
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="create-many-machine-learning-models-and-web-service-endpoints-from-one-experiment-using-powershell"></a><span data-ttu-id="6758d-103">Creación de varios modelos de aprendizaje automático y puntos de conexión de servicio web a partir de un experimento mediante PowerShell</span><span class="sxs-lookup"><span data-stu-id="6758d-103">Create many Machine Learning models and web service endpoints from one experiment using PowerShell</span></span>
<span data-ttu-id="6758d-104">Este es un problema común de aprendizaje de máquina: desea toocreate muchos modelos que tienen Hola mismo flujo de trabajo de aprendizaje y uso Hola mismo algoritmo, pero tienen conjuntos de datos de entrenamiento diferente como entrada.</span><span class="sxs-lookup"><span data-stu-id="6758d-104">Here's a common machine learning problem: You want toocreate many models that have hello same training workflow and use hello same algorithm, but have different training datasets as input.</span></span> <span data-ttu-id="6758d-105">Este artículo muestra cómo toodo esto a escala en estudio de aprendizaje automático de Azure con un experimento de único.</span><span class="sxs-lookup"><span data-stu-id="6758d-105">This article shows you how toodo this at scale in Azure Machine Learning Studio using just a single experiment.</span></span>

<span data-ttu-id="6758d-106">Por ejemplo, digamos que posee una empresa de franquicias de alquiler de bicicletas global.</span><span class="sxs-lookup"><span data-stu-id="6758d-106">For example, let's say you own a global bike rental franchise business.</span></span> <span data-ttu-id="6758d-107">Desea toobuild una petición de alquiler de regresión modelo toopredict Hola basada en datos históricos.</span><span class="sxs-lookup"><span data-stu-id="6758d-107">You want toobuild a regression model toopredict hello rental demand based on historic data.</span></span> <span data-ttu-id="6758d-108">Dispone de 1.000 ubicaciones de alquiler a través de Hola a todos y que ha recopilado un conjunto de datos para cada ubicación que incluye características importantes como fecha, hora, el tiempo y el tráfico que son específicos tooeach ubicación.</span><span class="sxs-lookup"><span data-stu-id="6758d-108">You have 1,000 rental locations across hello world and you've collected a dataset for each location that includes important features such as date, time, weather, and traffic that are specific tooeach location.</span></span>

<span data-ttu-id="6758d-109">Podría entrenar el modelo una vez usando una versión combinada de todos los conjuntos de datos de hello en todas las ubicaciones.</span><span class="sxs-lookup"><span data-stu-id="6758d-109">You could train your model once using a merged version of all hello datasets across all locations.</span></span> <span data-ttu-id="6758d-110">Pero dado que cada una de las ubicaciones tiene un entorno único, un mejor enfoque podría ser tootrain el modelo de regresión por separado con el conjunto de datos de Hola para cada ubicación.</span><span class="sxs-lookup"><span data-stu-id="6758d-110">But because each of your locations has a unique environment, a better approach would be tootrain your regression model separately using hello dataset for each location.</span></span> <span data-ttu-id="6758d-111">De este modo, cada modelo entrenado puede tardar en tamaños de almacén diferente de cuenta hello, volumen, geography, rellenado, entorno de tráfico de bicicleta sencillo, *etc.*.</span><span class="sxs-lookup"><span data-stu-id="6758d-111">That way, each trained model could take into account hello different store sizes, volume, geography, population, bike-friendly traffic environment, *etc.*.</span></span>

<span data-ttu-id="6758d-112">Que puede ser recomendable hello, pero no desea toocreate 1.000 experimentos de aprendizaje en aprendizaje automático de Azure con cada uno de ellos que representa una ubicación única.</span><span class="sxs-lookup"><span data-stu-id="6758d-112">That may be hello best approach, but you don't want toocreate 1,000 training experiments in Azure Machine Learning with each one representing a unique location.</span></span> <span data-ttu-id="6758d-113">Además de ser una tarea abrumadora, también es parece bastante ineficaz, ya que cada experimento todos deberá Hola los mismos componentes excepto para el conjunto de datos de entrenamiento de Hola.</span><span class="sxs-lookup"><span data-stu-id="6758d-113">Besides being an overwhelming task, it's also seems pretty inefficient since each experiment would have all hello same components except for hello training dataset.</span></span>

<span data-ttu-id="6758d-114">Afortunadamente, podemos realizar mediante el uso de hello [aprendizaje automático de Azure reciclaje API](machine-learning-retrain-models-programmatically.md) y automatizar tareas de hello con [Azure Machine Learning PowerShell](machine-learning-powershell-module.md).</span><span class="sxs-lookup"><span data-stu-id="6758d-114">Fortunately, we can accomplish this by using hello [Azure Machine Learning retraining API](machine-learning-retrain-models-programmatically.md) and automating hello task with [Azure Machine Learning PowerShell](machine-learning-powershell-module.md).</span></span>

> [!NOTE]
> <span data-ttu-id="6758d-115">toomake nuestro ejemplo ejecutarse con mayor rapidez, se reducirá el número de Hola de ubicaciones de 1.000 too10.</span><span class="sxs-lookup"><span data-stu-id="6758d-115">toomake our sample run faster, we'll reduce hello number of locations from 1,000 too10.</span></span> <span data-ttu-id="6758d-116">Pero hello mismos principios y procedimientos se aplican too1, 000 ubicaciones.</span><span class="sxs-lookup"><span data-stu-id="6758d-116">But hello same principles and procedures apply too1,000 locations.</span></span> <span data-ttu-id="6758d-117">Hola única diferencia es que si desea tootrain de conjuntos de datos de 1.000, seguramente quieras toothink de hello siguientes secuencias de comandos de PowerShell en paralelo en ejecución.</span><span class="sxs-lookup"><span data-stu-id="6758d-117">hello only difference is that if you want tootrain from 1,000 datasets you probably want toothink of running hello following PowerShell scripts in parallel.</span></span> <span data-ttu-id="6758d-118">¿Cómo toodo que está más allá del ámbito de Hola de este artículo, pero puede encontrar ejemplos de PowerShell multithreading en hello Internet.</span><span class="sxs-lookup"><span data-stu-id="6758d-118">How toodo that is beyond hello scope of this article, but you can find examples of PowerShell multi-threading on hello Internet.</span></span>  
> 
> 

## <a name="set-up-hello-training-experiment"></a><span data-ttu-id="6758d-119">Configurar el experimento de entrenamiento de Hola</span><span class="sxs-lookup"><span data-stu-id="6758d-119">Set up hello training experiment</span></span>
<span data-ttu-id="6758d-120">Vamos a toouse un ejemplo [experimento de entrenamiento](https://gallery.cortanaintelligence.com/Experiment/Bike-Rental-Training-Experiment-1) que ya hemos creado en hello [Cortana Intelligence galería](http://gallery.cortanaintelligence.com).</span><span class="sxs-lookup"><span data-stu-id="6758d-120">We're going toouse an example [training experiment](https://gallery.cortanaintelligence.com/Experiment/Bike-Rental-Training-Experiment-1) that we've already created in hello [Cortana Intelligence Gallery](http://gallery.cortanaintelligence.com).</span></span> <span data-ttu-id="6758d-121">Abra este experimento en su área de trabajo [Estudio de aprendizaje automático de Azure](https://studio.azureml.net) .</span><span class="sxs-lookup"><span data-stu-id="6758d-121">Open this experiment in your [Azure Machine Learning Studio](https://studio.azureml.net) workspace.</span></span>

> [!NOTE]
> <span data-ttu-id="6758d-122">En orden toofollow junto con este ejemplo, puede que desee toouse un área de trabajo estándar en lugar de un área de trabajo disponible.</span><span class="sxs-lookup"><span data-stu-id="6758d-122">In order toofollow along with this example, you may want toouse a standard workspace rather than a free workspace.</span></span> <span data-ttu-id="6758d-123">Se creará un punto de conexión para cada cliente - para un total de 10 puntos de conexión - y que requieren un área de trabajo estándar, puesto que un área de trabajo libre es limitado too3 extremos.</span><span class="sxs-lookup"><span data-stu-id="6758d-123">We'll be creating one endpoint for each customer - for a total of 10 endpoints - and that will require a standard workspace since a free workspace is limited too3 endpoints.</span></span> <span data-ttu-id="6758d-124">Si solo tiene un área de trabajo gratuita, simplemente modifique los scripts de hello debajo tooallow para solo 3 ubicaciones.</span><span class="sxs-lookup"><span data-stu-id="6758d-124">If you only have a free workspace, just modify hello scripts below tooallow for only 3 locations.</span></span>
> 
> 

<span data-ttu-id="6758d-125">experimento Hello usa un **importar datos** conjunto de datos de entrenamiento de módulo tooimport hello *customer001.csv* desde una cuenta de almacenamiento de Azure.</span><span class="sxs-lookup"><span data-stu-id="6758d-125">hello experiment uses an **Import Data** module tooimport hello training dataset *customer001.csv* from an Azure storage account.</span></span> <span data-ttu-id="6758d-126">Supongamos que hemos recopilado los conjuntos de datos de entrenamiento de todas las ubicaciones de alquiler de bicicletas y almacenado en hello misma ubicación de almacenamiento de blobs con nombres de archivo que van desde *rentalloc001.csv* demasiado*rentalloc10.csv* .</span><span class="sxs-lookup"><span data-stu-id="6758d-126">Let's assume we have collected training datasets from all bike rental locations and stored them in hello same blob storage location with file names ranging from *rentalloc001.csv* too*rentalloc10.csv*.</span></span>

![imagen](./media/machine-learning-create-models-and-endpoints-with-powershell/reader-module.png)

<span data-ttu-id="6758d-128">Tenga en cuenta que un **resultado del servicio Web** módulo se ha agregado toohello **entrenar modelo** módulo.</span><span class="sxs-lookup"><span data-stu-id="6758d-128">Note that a **Web Service Output** module has been added toohello **Train Model** module.</span></span>
<span data-ttu-id="6758d-129">Cuando este experimento se implementa como un servicio web, extremo de hello asociado a esa salida devolverá entrenado hello en formato de Hola de un archivo .ilearner.</span><span class="sxs-lookup"><span data-stu-id="6758d-129">When this experiment is deployed as a web service, hello endpoint associated with that output will return hello trained model in hello format of a .ilearner file.</span></span>

<span data-ttu-id="6758d-130">Tenga en cuenta también que configuramos un parámetro del servicio web para la dirección URL de Hola que hello **importar datos** utiliza el módulo.</span><span class="sxs-lookup"><span data-stu-id="6758d-130">Also note that we set up a web service parameter for hello URL that hello **Import Data** module uses.</span></span> <span data-ttu-id="6758d-131">Esto nos permite toouse Hola parámetro toospecify individuales conjuntos de datos tootrain Hola modelo de entrenamiento para cada ubicación.</span><span class="sxs-lookup"><span data-stu-id="6758d-131">This allows us toouse hello parameter toospecify individual training datasets tootrain hello model for each location.</span></span>
<span data-ttu-id="6758d-132">Hay otras maneras podríamos haber hecho esto, por ejemplo, mediante una consulta SQL con una web servicio parámetro tooget los datos de una base de datos de SQL Azure, o simplemente con una **proporcionados por el servicio Web** toopass de módulo en un conjunto de datos toohello de servicio web.</span><span class="sxs-lookup"><span data-stu-id="6758d-132">There are other ways we could have done this, such as using a SQL query with a web service parameter tooget data from a SQL Azure database, or simply using a  **Web Service Input** module toopass in a dataset toohello web service.</span></span>

![imagen](./media/machine-learning-create-models-and-endpoints-with-powershell/web-service-output.png)

<span data-ttu-id="6758d-134">Ahora, vamos a ejecutar este experimento de entrenamiento con el valor predeterminado de hello *rental001.csv* como Hola conjunto de datos de entrenamiento.</span><span class="sxs-lookup"><span data-stu-id="6758d-134">Now, let's run this training experiment using hello default value *rental001.csv* as hello training dataset.</span></span> <span data-ttu-id="6758d-135">Si ve la salida de hello de hello **Evaluate** módulo (haga clic en salida de hello y seleccione **visualizar**), puede ver que obtenemos un rendimiento aceptable de *AUC* = 0.91.</span><span class="sxs-lookup"><span data-stu-id="6758d-135">If you view hello output of hello **Evaluate** module (click hello output and select **Visualize**), you can see we get a decent performance of *AUC* = 0.91.</span></span> <span data-ttu-id="6758d-136">En este momento, estamos listo toodeploy un servicio web fuera de este experimento de entrenamiento.</span><span class="sxs-lookup"><span data-stu-id="6758d-136">At this point, we're ready toodeploy a web service out of this training experiment.</span></span>

## <a name="deploy-hello-training-and-scoring-web-services"></a><span data-ttu-id="6758d-137">Implementar el entrenamiento de Hola y de puntuación de servicios web</span><span class="sxs-lookup"><span data-stu-id="6758d-137">Deploy hello training and scoring web services</span></span>
<span data-ttu-id="6758d-138">Hola toodeploy entrenamiento servicio web, haga clic en hello **configurar el servicio de Web** situado por debajo del lienzo del experimento de Hola y seleccione **implementar servicio Web**.</span><span class="sxs-lookup"><span data-stu-id="6758d-138">toodeploy hello training web service, click hello **Set Up Web Service** button below hello experiment canvas and select **Deploy Web Service**.</span></span> <span data-ttu-id="6758d-139">Llame a este servicio web "Bike Rental Training" (Entrenamiento para alquiler de bicicletas).</span><span class="sxs-lookup"><span data-stu-id="6758d-139">Call this web service ""Bike Rental Training".</span></span>

<span data-ttu-id="6758d-140">Ahora necesitamos servicio toodeploy Hola de puntuación web.</span><span class="sxs-lookup"><span data-stu-id="6758d-140">Now we need toodeploy hello scoring web service.</span></span>
<span data-ttu-id="6758d-141">toodo, podemos hacer clic en **configurar el servicio de Web** por debajo de hello lienzo y seleccione **predictivo servicio Web**.</span><span class="sxs-lookup"><span data-stu-id="6758d-141">toodo this, we can click **Set Up Web Service** below hello canvas and select **Predictive Web Service**.</span></span> <span data-ttu-id="6758d-142">Esto crear un experimento de puntuación.</span><span class="sxs-lookup"><span data-stu-id="6758d-142">This creates a scoring experiment.</span></span>
<span data-ttu-id="6758d-143">Necesitaremos toomake unos toomake ajustes menores funciona como un servicio web, como datos de entrada de quitar la columna de etiqueta de Hola "cnt" de Hola y limitar el Id. de instancia de hello salida tooonly Hola y Hola correspondiente predice el valor.</span><span class="sxs-lookup"><span data-stu-id="6758d-143">We'll need toomake a few minor adjustments toomake it work as a web service, such as removing hello label column "cnt" from hello input data and limiting hello output tooonly hello instance id and hello corresponding predicted value.</span></span>

<span data-ttu-id="6758d-144">toosave usted mismo que el trabajo, podrá abrirlo hello [experimento predictivo](https://gallery.cortanaintelligence.com/Experiment/Bike-Rental-Predicative-Experiment-1) Hola galería que ya se ha preparado.</span><span class="sxs-lookup"><span data-stu-id="6758d-144">toosave yourself that work, you can simply open hello [predictive experiment](https://gallery.cortanaintelligence.com/Experiment/Bike-Rental-Predicative-Experiment-1) in hello Gallery that's already been prepared.</span></span>

<span data-ttu-id="6758d-145">servicio web de toodeploy hello, ejecute hello experimento predictivo, a continuación, haga clic en hello **implementar el servicio de Web** botón a continuación lienzo Hola.</span><span class="sxs-lookup"><span data-stu-id="6758d-145">toodeploy hello web service, run hello predictive experiment, then click hello **Deploy Web Service** button below hello canvas.</span></span> <span data-ttu-id="6758d-146">Hola de nombre la puntuación del servicio web "Puntuación de alquiler de bicicletas" ".</span><span class="sxs-lookup"><span data-stu-id="6758d-146">Name hello scoring web service "Bike Rental Scoring"".</span></span>

## <a name="create-10-identical-web-service-endpoints-with-powershell"></a><span data-ttu-id="6758d-147">Creación de 10 puntos de conexión de servicio web idénticos con PowerShell</span><span class="sxs-lookup"><span data-stu-id="6758d-147">Create 10 identical web service endpoints with PowerShell</span></span>
<span data-ttu-id="6758d-148">Este servicio web incluye un punto de conexión predeterminado.</span><span class="sxs-lookup"><span data-stu-id="6758d-148">This web service comes with a default endpoint.</span></span> <span data-ttu-id="6758d-149">Pero nos no interesa como punto de conexión de hello predeterminado porque no se puede actualizar.</span><span class="sxs-lookup"><span data-stu-id="6758d-149">But we're not as interested in hello default endpoint since it can't be updated.</span></span> <span data-ttu-id="6758d-150">Lo que necesitamos toodo es toocreate 10 extremos adicionales, uno para cada ubicación.</span><span class="sxs-lookup"><span data-stu-id="6758d-150">What we need toodo is toocreate 10 additional endpoints, one for each location.</span></span> <span data-ttu-id="6758d-151">Haremos esto con PowerShell.</span><span class="sxs-lookup"><span data-stu-id="6758d-151">We'll do this with PowerShell.</span></span>

<span data-ttu-id="6758d-152">En primer lugar, configure nuestro entorno de PowerShell:</span><span class="sxs-lookup"><span data-stu-id="6758d-152">First, we set up our PowerShell environment:</span></span>

    Import-Module .\AzureMLPS.dll
    # Assume hello default configuration file exists and is properly set toopoint toohello valid Workspace.
    $scoringSvc = Get-AmlWebService | where Name -eq 'Bike Rental Scoring'
    $trainingSvc = Get-AmlWebService | where Name -eq 'Bike Rental Training'

<span data-ttu-id="6758d-153">A continuación, ejecute el siguiente comando de PowerShell de hello:</span><span class="sxs-lookup"><span data-stu-id="6758d-153">Then, run hello following PowerShell command:</span></span>

    # Create 10 endpoints on hello scoring web service.
    For ($i = 1; $i -le 10; $i++){
        $seq = $i.ToString().PadLeft(3, '0');
        $endpointName = 'rentalloc' + $seq;
        Write-Host ('adding endpoint ' + $endpointName + '...')
        Add-AmlWebServiceEndpoint -WebServiceId $scoringSvc.Id -EndpointName $endpointName -Description $endpointName     
    }

<span data-ttu-id="6758d-154">Ahora que hemos creado 10 puntos de conexión y contienen Hola mismo modelo entrenado se entrenó en *customer001.csv*.</span><span class="sxs-lookup"><span data-stu-id="6758d-154">Now we've created 10 endpoints and they all contain hello same trained model trained on *customer001.csv*.</span></span> <span data-ttu-id="6758d-155">Puede verlos en hello Portal de administración de Azure.</span><span class="sxs-lookup"><span data-stu-id="6758d-155">You can view them in hello Azure Management Portal.</span></span>

![imagen](./media/machine-learning-create-models-and-endpoints-with-powershell/created-endpoints.png)

## <a name="update-hello-endpoints-toouse-separate-training-datasets-using-powershell"></a><span data-ttu-id="6758d-157">Actualizar Hola extremos toouse entrenamiento independiente conjuntos de datos mediante PowerShell</span><span class="sxs-lookup"><span data-stu-id="6758d-157">Update hello endpoints toouse separate training datasets using PowerShell</span></span>
<span data-ttu-id="6758d-158">Hola siguiente paso es extremos de hello tooupdate con modelos de que forma única se entrenó en datos individuales de cada cliente.</span><span class="sxs-lookup"><span data-stu-id="6758d-158">hello next step is tooupdate hello endpoints with models uniquely trained on each customer's individual data.</span></span> <span data-ttu-id="6758d-159">Pero primero necesitamos tooproduce estos modelos de hello **entrenamiento de alquiler de bicicletas** servicio web.</span><span class="sxs-lookup"><span data-stu-id="6758d-159">But first we need tooproduce these models from hello **Bike Rental Training** web service.</span></span> <span data-ttu-id="6758d-160">Volvamos atrás toohello **entrenamiento de alquiler de bicicletas** servicio web.</span><span class="sxs-lookup"><span data-stu-id="6758d-160">Let's go back toohello **Bike Rental Training** web service.</span></span> <span data-ttu-id="6758d-161">Necesitamos toocall su extremo BES 10 veces con 10 conjuntos de datos de entrenamiento diferentes en modelos diferentes de orden tooproduce 10.</span><span class="sxs-lookup"><span data-stu-id="6758d-161">We need toocall its BES endpoint 10 times with 10 different training datasets in order tooproduce 10 different models.</span></span> <span data-ttu-id="6758d-162">Vamos a usar hello **InovkeAmlWebServiceBESEndpoint** toodo de cmdlet de PowerShell esto.</span><span class="sxs-lookup"><span data-stu-id="6758d-162">We'll use hello **InovkeAmlWebServiceBESEndpoint** PowerShell cmdlet toodo this.</span></span>

<span data-ttu-id="6758d-163">También necesitará tooprovide credenciales para la cuenta de almacenamiento de blobs en `$configContent`, es decir, en los campos de hello `AccountName`, `AccountKey` y `RelativeLocation`.</span><span class="sxs-lookup"><span data-stu-id="6758d-163">You will also need tooprovide credentials for your blob storage account into `$configContent`, namely, at hello fields `AccountName`, `AccountKey` and `RelativeLocation`.</span></span> <span data-ttu-id="6758d-164">Hola `AccountName` puede ser uno de los nombres de cuenta, como se muestra en hello **Portal de administración de Azure clásico** (*almacenamiento* ficha).</span><span class="sxs-lookup"><span data-stu-id="6758d-164">hello `AccountName` can be one of your account names, as seen in hello **Classic Azure Management Portal** (*Storage* tab).</span></span> <span data-ttu-id="6758d-165">Cuando hace clic en una cuenta de almacenamiento, su `AccountKey` encontrará presionando hello **administrar claves de acceso** situado en la parte inferior de Hola y copiar hello *clave de acceso principal*.</span><span class="sxs-lookup"><span data-stu-id="6758d-165">Once you click on a storage account, its `AccountKey` can be found by pressing hello **Manage Access Keys** button at hello bottom and copying hello *Primary Access Key*.</span></span> <span data-ttu-id="6758d-166">Hola `RelativeLocation` es el almacenamiento de información de hello ruta de acceso relativa tooyour donde se almacenará un nuevo modelo.</span><span class="sxs-lookup"><span data-stu-id="6758d-166">hello `RelativeLocation` is hello path relative tooyour storage where a new model will be stored.</span></span> <span data-ttu-id="6758d-167">Por ejemplo, ruta de acceso de hello `hai/retrain/bike_rental/` en script de Hola puntos tooa contenedor denominado `hai`, y `/retrain/bike_rental/` son subcarpetas.</span><span class="sxs-lookup"><span data-stu-id="6758d-167">For instance, hello path `hai/retrain/bike_rental/` in hello script below points tooa container named `hai`, and `/retrain/bike_rental/` are subfolders.</span></span> <span data-ttu-id="6758d-168">Actualmente, no se puede crear subcarpetas a través de la interfaz de usuario del portal de hello, pero hay [varios exploradores de almacenamiento de Azure](../storage/common/storage-explorers.md) que le permiten toodo así.</span><span class="sxs-lookup"><span data-stu-id="6758d-168">Currently, you cannot create subfolders through hello portal UI, but there are [several Azure Storage Explorers](../storage/common/storage-explorers.md) that allow you toodo so.</span></span> <span data-ttu-id="6758d-169">Se recomienda crear un nuevo contenedor en el saludo de toostore de almacenamiento nuevos modelos entrenados (archivos .ilearner) como sigue: desde la página de almacenamiento, haga clic en hello **agregar** situado en la parte inferior de Hola y asígnele el nombre `retrain`.</span><span class="sxs-lookup"><span data-stu-id="6758d-169">It is recommended that you create a new container in your storage toostore hello new trained models (.ilearner files) as follows: from your storage page, click on hello **Add** button at hello bottom and name it `retrain`.</span></span> <span data-ttu-id="6758d-170">En resumen, Hola cambios necesarios toohello siguiente secuencia de comandos pertenecen demasiado`AccountName`, `AccountKey` y `RelativeLocation` (:`"retrain/model' + $seq + '.ilearner"`).</span><span class="sxs-lookup"><span data-stu-id="6758d-170">In summary, hello necassary changes toohello script below pertain too`AccountName`, `AccountKey` and `RelativeLocation` (:`"retrain/model' + $seq + '.ilearner"`).</span></span>

    # Invoke hello retraining API 10 times
    # This is hello default (and hello only) endpoint on hello training web service
    $trainingSvcEp = (Get-AmlWebServiceEndpoint -WebServiceId $trainingSvc.Id)[0];
    $submitJobRequestUrl = $trainingSvcEp.ApiLocation + '/jobs?api-version=2.0';
    $apiKey = $trainingSvcEp.PrimaryKey;
    For ($i = 1; $i -le 10; $i++){
        $seq = $i.ToString().PadLeft(3, '0');
        $inputFileName = 'https://bostonmtc.blob.core.windows.net/hai/retrain/bike_rental/BikeRental' + $seq + '.csv';
        $configContent = '{ "GlobalParameters": { "URI": "' + $inputFileName + '" }, "Outputs": { "output1": { "ConnectionString": "DefaultEndpointsProtocol=https;AccountName=<myaccount>;AccountKey=<mykey>", "RelativeLocation": "hai/retrain/bike_rental/model' + $seq + '.ilearner" } } }';
        Write-Host ('training regression model on ' + $inputFileName + ' for rental location ' + $seq + '...');
        Invoke-AmlWebServiceBESEndpoint -JobConfigString $configContent -SubmitJobRequestUrl $submitJobRequestUrl -ApiKey $apiKey
    }

> [!NOTE]
> <span data-ttu-id="6758d-171">Hola extremo BES es Hola solo admite el modo para esta operación.</span><span class="sxs-lookup"><span data-stu-id="6758d-171">hello BES endpoint is hello only supported mode for this operation.</span></span> <span data-ttu-id="6758d-172">RRS no se puede usar para generar modelos entrenados.</span><span class="sxs-lookup"><span data-stu-id="6758d-172">RRS cannot be used for producing trained models.</span></span>
> 
> 

<span data-ttu-id="6758d-173">Como puede ver más arriba, en lugar de construir 10 diferentes BES trabajo json archivos de configuración, creamos dinámicamente cadena_configuración hello en su lugar y fuente toohello *jobConfigString* parámetro de hello  **InvokeAmlWebServceBESEndpoint** cmdlet, puesto que no hay realmente ningún tookeep necesidad de una copia en el disco.</span><span class="sxs-lookup"><span data-stu-id="6758d-173">As you can see above, instead of constructing 10 different BES job configuration json files, we dynamically create hello config string instead and feed it toohello *jobConfigString* parameter of hello **InvokeAmlWebServceBESEndpoint** cmdlet, since there is really no need tookeep a copy on disk.</span></span>

<span data-ttu-id="6758d-174">Si todo va bien, después de un tiempo, debe ver 10 archivos .ilearner, de *model001.ilearner* demasiado*model010.ilearner*, en su cuenta de almacenamiento de Azure.</span><span class="sxs-lookup"><span data-stu-id="6758d-174">If everything goes well, after a while you should see 10 .ilearner files, from *model001.ilearner* too*model010.ilearner*, in your Azure storage account.</span></span> <span data-ttu-id="6758d-175">Ahora estamos listo tooupdate nuestro 10 puntuación web los extremos del servicio con estos modelos mediante hello **AmlWebServiceEndpoint revisión** cmdlet de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="6758d-175">Now we're ready tooupdate our 10 scoring web service endpoints with these models using hello **Patch-AmlWebServiceEndpoint** PowerShell cmdlet.</span></span> <span data-ttu-id="6758d-176">Nuevo, recuerde que sólo le podemos patch puntos de conexión de hello no predeterminada que se crea mediante programación anteriormente.</span><span class="sxs-lookup"><span data-stu-id="6758d-176">Remember again that we can only patch hello non-default endpoints we programmatically created earlier.</span></span>

    # Patch hello 10 endpoints with respective .ilearner models
    $baseLoc = 'http://bostonmtc.blob.core.windows.net/'
    $sasToken = '<my_blob_sas_token>'
    For ($i = 1; $i -le 10; $i++){
        $seq = $i.ToString().PadLeft(3, '0');
        $endpointName = 'rentalloc' + $seq;
        $relativeLoc = 'hai/retrain/bike_rental/model' + $seq + '.ilearner';
        Write-Host ('Patching endpoint ' + $endpointName + '...');
        Patch-AmlWebServiceEndpoint -WebServiceId $scoringSvc.Id -EndpointName $endpointName -ResourceName 'Bike Rental [trained model]' -BaseLocation $baseLoc -RelativeLocation $relativeLoc -SasBlobToken $sasToken
    }

<span data-ttu-id="6758d-177">Esto se debe ejecutar bastante rápido.</span><span class="sxs-lookup"><span data-stu-id="6758d-177">This should run fairly quickly.</span></span> <span data-ttu-id="6758d-178">Cuando concluya la ejecución de hello, se habrá creado correctamente 10 puntos de conexión de servicio de web de predicción, cada uno con un modelo entrenado entrenado forma única en la ubicación de alquiler de tooa específico de hello conjunto de datos, todo ello desde un experimento de entrenamiento único.</span><span class="sxs-lookup"><span data-stu-id="6758d-178">When hello execution finishes, we'll have successfully created 10 predictive web service endpoints, each containing a trained model uniquely trained on hello dataset specific tooa rental location, all from a single training experiment.</span></span> <span data-ttu-id="6758d-179">tooverify esto, puede intentar llamar a estos extremos con hello **InvokeAmlWebServiceRRSEndpoint** cmdlet, enviarles con hello los mismos datos de entrada, y debe esperar resultados de predicción diferentes toosee puesto que son modelos de Hola entrenado con conjuntos de entrenamiento diferentes.</span><span class="sxs-lookup"><span data-stu-id="6758d-179">tooverify this, you can try calling these endpoints using hello **InvokeAmlWebServiceRRSEndpoint** cmdlet, providing them with hello same input data, and you should expect toosee different prediction results since hello models are trained with different training sets.</span></span>

## <a name="full-powershell-script"></a><span data-ttu-id="6758d-180">Script de PowerShell completo</span><span class="sxs-lookup"><span data-stu-id="6758d-180">Full PowerShell script</span></span>
<span data-ttu-id="6758d-181">Este es el anuncio de Hola de código fuente completo de Hola:</span><span class="sxs-lookup"><span data-stu-id="6758d-181">Here's hello listing of hello full source code:</span></span>

    Import-Module .\AzureMLPS.dll
    # Assume hello default configuration file exists and properly set toopoint toohello valid workspace.
    $scoringSvc = Get-AmlWebService | where Name -eq 'Bike Rental Scoring'
    $trainingSvc = Get-AmlWebService | where Name -eq 'Bike Rental Training'

    # Create 10 endpoints on hello scoring web service
    For ($i = 1; $i -le 10; $i++){
        $seq = $i.ToString().PadLeft(3, '0');
        $endpointName = 'rentalloc' + $seq;
        Write-Host ('adding endpoint ' + $endpontName + '...')
        Add-AmlWebServiceEndpoint -WebServiceId $scoringSvc.Id -EndpointName $endpointName -Description $endpointName     
    }

    # Invoke hello retraining API 10 times tooproduce 10 regression models in .ilearner format
    $trainingSvcEp = (Get-AmlWebServiceEndpoint -WebServiceId $trainingSvc.Id)[0];
    $submitJobRequestUrl = $trainingSvcEp.ApiLocation + '/jobs?api-version=2.0';
    $apiKey = $trainingSvcEp.PrimaryKey;
    For ($i = 1; $i -le 10; $i++){
        $seq = $i.ToString().PadLeft(3, '0');
        $inputFileName = 'https://bostonmtc.blob.core.windows.net/hai/retrain/bike_rental/BikeRental' + $seq + '.csv';
        $configContent = '{ "GlobalParameters": { "URI": "' + $inputFileName + '" }, "Outputs": { "output1": { "ConnectionString": "DefaultEndpointsProtocol=https;AccountName=<myaccount>;AccountKey=<mykey>", "RelativeLocation": "hai/retrain/bike_rental/model' + $seq + '.ilearner" } } }';
        Write-Host ('training regression model on ' + $inputFileName + ' for rental location ' + $seq + '...');
        Invoke-AmlWebServiceBESEndpoint -JobConfigString $configContent -SubmitJobRequestUrl $submitJobRequestUrl -ApiKey $apiKey
    }

    # Patch hello 10 endpoints with respective .ilearner models
    $baseLoc = 'http://bostonmtc.blob.core.windows.net/'
    $sasToken = '?test'
    For ($i = 1; $i -le 10; $i++){
        $seq = $i.ToString().PadLeft(3, '0');
        $endpointName = 'rentalloc' + $seq;
        $relativeLoc = 'hai/retrain/bike_rental/model' + $seq + '.ilearner';
        Write-Host ('Patching endpoint ' + $endpointName + '...');
        Patch-AmlWebServiceEndpoint -WebServiceId $scoringSvc.Id -EndpointName $endpointName -ResourceName 'Bike Rental [trained model]' -BaseLocation $baseLoc -RelativeLocation $relativeLoc -SasBlobToken $sasToken
    }

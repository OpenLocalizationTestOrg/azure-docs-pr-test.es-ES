---
title: "características de aaaCreate para los datos en un clúster de Hadoop mediante consultas de Hive | Documentos de Microsoft"
description: "Ejemplos de consultas de Hive que generan características en datos almacenados en un clúster de Hadoop de HDInsight de Azure."
services: machine-learning
documentationcenter: 
author: bradsev
manager: jhubbard
editor: cgronlun
ms.assetid: e8a94c71-979b-4707-b8fd-85b47d309a30
ms.service: machine-learning
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/24/2017
ms.author: hangzh;bradsev
ms.openlocfilehash: 686282bf0fb84ea82758d3c5b7de2bd90f0cf159
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="create-features-for-data-in-an-hadoop-cluster-using-hive-queries"></a><span data-ttu-id="8520a-103">Crear características para datos en un clúster de Hadoop mediante consultas de Hive</span><span class="sxs-lookup"><span data-stu-id="8520a-103">Create features for data in an Hadoop cluster using Hive queries</span></span>
<span data-ttu-id="8520a-104">Este documento muestra cómo toocreate características para los datos almacenan en un clúster de Hadoop de HDInsight de Azure mediante consultas de Hive.</span><span class="sxs-lookup"><span data-stu-id="8520a-104">This document shows how toocreate features for data stored in an Azure HDInsight Hadoop cluster using Hive queries.</span></span> <span data-ttu-id="8520a-105">Estas consultas de Hive usan incrustado Hive User Defined Functions (UDF), scripts de hello para el que se proporcionan.</span><span class="sxs-lookup"><span data-stu-id="8520a-105">These Hive queries use embedded Hive User Defined Functions (UDFs), hello scripts for which are provided.</span></span>

<span data-ttu-id="8520a-106">Hola operaciones necesarias toocreate características pueden consumir mucha memoria.</span><span class="sxs-lookup"><span data-stu-id="8520a-106">hello operations needed toocreate features can be memory intensive.</span></span> <span data-ttu-id="8520a-107">rendimiento de Hola de consultas de Hive resulta más importante en estos casos y se puede mejorar con determinados parámetros de ajuste.</span><span class="sxs-lookup"><span data-stu-id="8520a-107">hello performance of Hive queries becomes more critical in such cases and can be improved by tuning certain parameters.</span></span> <span data-ttu-id="8520a-108">Hello para la optimización de estos parámetros se describe en la sección final Hola.</span><span class="sxs-lookup"><span data-stu-id="8520a-108">hello tuning of these parameters is discussed in hello final section.</span></span>

<span data-ttu-id="8520a-109">Ejemplos de consultas de Hola que se presentan son específico toohello [NYC Taxi recorridos datos](http://chriswhong.com/open-data/foil_nyc_taxi/) escenarios también se proporcionan en [repositorio de GitHub](https://github.com/Azure/Azure-MachineLearning-DataScience/tree/master/Misc/DataScienceProcess/DataScienceScripts).</span><span class="sxs-lookup"><span data-stu-id="8520a-109">Examples of hello queries that are presented are specific toohello [NYC Taxi Trip Data](http://chriswhong.com/open-data/foil_nyc_taxi/) scenarios are also provided in [GitHub repository](https://github.com/Azure/Azure-MachineLearning-DataScience/tree/master/Misc/DataScienceProcess/DataScienceScripts).</span></span> <span data-ttu-id="8520a-110">Estas consultas ya tiene el esquema de datos especificado y está listo toobe enviado toorun.</span><span class="sxs-lookup"><span data-stu-id="8520a-110">These queries already have data schema specified and are ready toobe submitted toorun.</span></span> <span data-ttu-id="8520a-111">En la sección final de hello, también se describen los parámetros que los usuarios pueden ajustar para que se puede mejorar el rendimiento de Hola de consultas de Hive.</span><span class="sxs-lookup"><span data-stu-id="8520a-111">In hello final section, parameters that users can tune so that hello performance of Hive queries can be improved are  also discussed.</span></span>

[!INCLUDE [cap-create-features-data-selector](../../includes/cap-create-features-selector.md)]

<span data-ttu-id="8520a-112">Esto **menú** vincula tootopics que describen cómo toocreate características para los datos en varios entornos.</span><span class="sxs-lookup"><span data-stu-id="8520a-112">This **menu** links tootopics that describe how toocreate features for data in various environments.</span></span> <span data-ttu-id="8520a-113">Esta tarea es un paso en hello [proceso de ciencia de datos de equipo (TDSP)](https://azure.microsoft.com/documentation/learning-paths/cortana-analytics-process/).</span><span class="sxs-lookup"><span data-stu-id="8520a-113">This task is a step in hello [Team Data Science Process (TDSP)](https://azure.microsoft.com/documentation/learning-paths/cortana-analytics-process/).</span></span>

## <a name="prerequisites"></a><span data-ttu-id="8520a-114">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="8520a-114">Prerequisites</span></span>
<span data-ttu-id="8520a-115">En este artículo se supone que ha:</span><span class="sxs-lookup"><span data-stu-id="8520a-115">This article assumes that you have:</span></span>

* <span data-ttu-id="8520a-116">Creado una cuenta de almacenamiento de Azure.</span><span class="sxs-lookup"><span data-stu-id="8520a-116">Created an Azure storage account.</span></span> <span data-ttu-id="8520a-117">Si necesita instrucciones, consulte [Creación de una cuenta de almacenamiento de Azure](../storage/common/storage-create-storage-account.md#create-a-storage-account)</span><span class="sxs-lookup"><span data-stu-id="8520a-117">If you need instructions, see [Create an Azure Storage account](../storage/common/storage-create-storage-account.md#create-a-storage-account)</span></span>
* <span data-ttu-id="8520a-118">Aprovisionar un clúster de Hadoop personalizado con hello servicio HDInsight.</span><span class="sxs-lookup"><span data-stu-id="8520a-118">Provisioned a customized Hadoop cluster with hello HDInsight service.</span></span>  <span data-ttu-id="8520a-119">Si necesita instrucciones, consulte [Personalización de clústeres de Hadoop de HDInsight de Azure para análisis avanzado](machine-learning-data-science-customize-hadoop-cluster.md).</span><span class="sxs-lookup"><span data-stu-id="8520a-119">If you need instructions, see [Customize Azure HDInsight Hadoop Clusters for Advanced Analytics](machine-learning-data-science-customize-hadoop-cluster.md).</span></span>
* <span data-ttu-id="8520a-120">datos de Hello ha sido cargado tooHive tablas en clústeres de HDInsight Hadoop de Azure.</span><span class="sxs-lookup"><span data-stu-id="8520a-120">hello data has been uploaded tooHive tables in Azure HDInsight Hadoop clusters.</span></span> <span data-ttu-id="8520a-121">Si no es así, siga [carga y crear tablas de tooHive datos](machine-learning-data-science-move-hive-tables.md) tooupload datos tooHive tablas en primer lugar.</span><span class="sxs-lookup"><span data-stu-id="8520a-121">If it has not, please follow [Create and load data tooHive tables](machine-learning-data-science-move-hive-tables.md) tooupload data tooHive tables first.</span></span>
* <span data-ttu-id="8520a-122">Clúster de toohello de acceso remoto habilitado.</span><span class="sxs-lookup"><span data-stu-id="8520a-122">Enabled remote access toohello cluster.</span></span> <span data-ttu-id="8520a-123">Si necesita instrucciones, consulte [Hola de acceso principal del nodo de clúster de Hadoop](machine-learning-data-science-customize-hadoop-cluster.md#headnode).</span><span class="sxs-lookup"><span data-stu-id="8520a-123">If you need instructions, see [Access hello Head Node of Hadoop Cluster](machine-learning-data-science-customize-hadoop-cluster.md#headnode).</span></span>

## <span data-ttu-id="8520a-124"><a name="hive-featureengineering"></a>Generación de características</span><span class="sxs-lookup"><span data-stu-id="8520a-124"><a name="hive-featureengineering"></a>Feature Generation</span></span>
<span data-ttu-id="8520a-125">En esta sección se describen varios ejemplos de formas de hello en el que se pueden generar características usan consultas de Hive.</span><span class="sxs-lookup"><span data-stu-id="8520a-125">In this section, several examples of hello ways in which features can be generating using Hive queries are described.</span></span> <span data-ttu-id="8520a-126">Una vez haya generado características adicionales, puede agregarlas como tabla de columnas toohello existente o crear una nueva tabla con características adicionales de Hola y la clave principal, que, a continuación, puede combinarse con la tabla original de Hola.</span><span class="sxs-lookup"><span data-stu-id="8520a-126">Once you have generated additional features, you can either add them as columns toohello existing table or create a new table with hello additional features and primary key, which can then be joined with hello original table.</span></span> <span data-ttu-id="8520a-127">Estos son ejemplos de hello presentados:</span><span class="sxs-lookup"><span data-stu-id="8520a-127">Here are hello examples presented:</span></span>

1. [<span data-ttu-id="8520a-128">Generación de características basada en frecuencia</span><span class="sxs-lookup"><span data-stu-id="8520a-128">Frequency based Feature Generation</span></span>](#hive-frequencyfeature)
2. [<span data-ttu-id="8520a-129">Riesgos de las variables de categorías en la clasificación binaria</span><span class="sxs-lookup"><span data-stu-id="8520a-129">Risks of Categorical Variables in Binary Classification</span></span>](#hive-riskfeature)
3. [<span data-ttu-id="8520a-130">Extraer características de campos de fecha y hora</span><span class="sxs-lookup"><span data-stu-id="8520a-130">Extract features from Datetime Field</span></span>](#hive-datefeatures)
4. [<span data-ttu-id="8520a-131">Extraer características del campo de texto</span><span class="sxs-lookup"><span data-stu-id="8520a-131">Extract features from Text Field</span></span>](#hive-textfeatures)
5. [<span data-ttu-id="8520a-132">Calcular distancia entre las coordenadas GPS</span><span class="sxs-lookup"><span data-stu-id="8520a-132">Calculate distance between GPS coordinates</span></span>](#hive-gpsdistance)

### <span data-ttu-id="8520a-133"><a name="hive-frequencyfeature"></a>Generación de características basada en frecuencia</span><span class="sxs-lookup"><span data-stu-id="8520a-133"><a name="hive-frequencyfeature"></a>Frequency based Feature Generation</span></span>
<span data-ttu-id="8520a-134">A menudo resulta útil toocalculate las frecuencias de Hola de hello niveles de una variable de categoría o las frecuencias de Hola de ciertas combinaciones de niveles de varias variables de categorías.</span><span class="sxs-lookup"><span data-stu-id="8520a-134">It is often useful toocalculate hello frequencies of hello levels of a categorical variable, or hello frequencies of certain combinations of levels from multiple categorical variables.</span></span> <span data-ttu-id="8520a-135">Los usuarios pueden usar Hola después de la secuencia de comandos toocalculate estas frecuencias:</span><span class="sxs-lookup"><span data-stu-id="8520a-135">Users can use hello following script toocalculate these frequencies:</span></span>

        select
            a.<column_name1>, a.<column_name2>, a.sub_count/sum(a.sub_count) over () as frequency
        from
        (
            select
                <column_name1>,<column_name2>, count(*) as sub_count
            from <databasename>.<tablename> group by <column_name1>, <column_name2>
        )a
        order by frequency desc;


### <span data-ttu-id="8520a-136"><a name="hive-riskfeature"></a>Riesgos de las variables de categorías en la clasificación binaria</span><span class="sxs-lookup"><span data-stu-id="8520a-136"><a name="hive-riskfeature"></a>Risks of Categorical Variables in Binary Classification</span></span>
<span data-ttu-id="8520a-137">En la clasificación binaria, necesitamos tooconvert las variables de categorías no numéricos en características numéricas cuando modelos Hola usándola solo tienen características numéricas.</span><span class="sxs-lookup"><span data-stu-id="8520a-137">In binary classification, we need tooconvert non-numeric categorical variables into numeric features when hello models being used only take numeric features.</span></span> <span data-ttu-id="8520a-138">Para ello, reemplace cada nivel no numérico por un riesgo numérico.</span><span class="sxs-lookup"><span data-stu-id="8520a-138">This is done by replacing each non-numeric level with a numeric risk.</span></span> <span data-ttu-id="8520a-139">En esta sección, se muestran algunas consultas de Hive genéricos que calculen los valores de riesgo de hello (logaritmos de posibilidades) de una variable de categoría.</span><span class="sxs-lookup"><span data-stu-id="8520a-139">In this section, we show some generic Hive queries that calculate hello risk values (log odds) of a categorical variable.</span></span>

        set smooth_param1=1;
        set smooth_param2=20;
        select
            <column_name1>,<column_name2>,
            ln((sum_target+${hiveconf:smooth_param1})/(record_count-sum_target+${hiveconf:smooth_param2}-${hiveconf:smooth_param1})) as risk
        from
            (
            select
                <column_nam1>, <column_name2>, sum(binary_target) as sum_target, sum(1) as record_count
            from
                (
                select
                    <column_name1>, <column_name2>, if(target_column>0,1,0) as binary_target
                from <databasename>.<tablename>
                )a
            group by <column_name1>, <column_name2>
            )b

<span data-ttu-id="8520a-140">En este ejemplo, las variables `smooth_param1` y `smooth_param2` se calculan valores de riesgo de conjunto toosmooth Hola de datos de Hola.</span><span class="sxs-lookup"><span data-stu-id="8520a-140">In this example, variables `smooth_param1` and `smooth_param2` are set toosmooth hello risk values calculated from hello data.</span></span> <span data-ttu-id="8520a-141">Los riesgos tienen un intervalo comprendido entre -Inf y Inf.</span><span class="sxs-lookup"><span data-stu-id="8520a-141">Risks have a range between -Inf and Inf.</span></span> <span data-ttu-id="8520a-142">Los riesgos > 0 indica que probabilidad de Hola que tienen como destino hello es igual too1 es mayor que 0.5.</span><span class="sxs-lookup"><span data-stu-id="8520a-142">A risks > 0 indicates that hello probability that hello target is equal too1 is greater than 0.5.</span></span>

<span data-ttu-id="8520a-143">Después de que se calcula la tabla de riesgo de hello, los usuarios pueden asignar tooa tabla de valores de riesgos mediante la combinación con la tabla de riesgo de Hola.</span><span class="sxs-lookup"><span data-stu-id="8520a-143">After hello risk table is calculated, users can assign risk values tooa table by joining it with hello risk table.</span></span> <span data-ttu-id="8520a-144">consulta de unión de Hive Hola se proporcionó en la sección anterior.</span><span class="sxs-lookup"><span data-stu-id="8520a-144">hello Hive joining query was provided in previous section.</span></span>

### <span data-ttu-id="8520a-145"><a name="hive-datefeatures"></a>Extraer características de campos de fecha y hora</span><span class="sxs-lookup"><span data-stu-id="8520a-145"><a name="hive-datefeatures"></a>Extract features from Datetime Fields</span></span>
<span data-ttu-id="8520a-146">El subárbol se incluye con un conjunto de UDF para el procesamiento de campos de fecha y hora.</span><span class="sxs-lookup"><span data-stu-id="8520a-146">Hive comes with a set of UDFs for processing datetime fields.</span></span> <span data-ttu-id="8520a-147">En el subárbol, formato de fecha y hora de hello predeterminado es ' aaaa-MM-dd 00:00:00 ' ('1970-01-01 12:21:32 ' por ejemplo).</span><span class="sxs-lookup"><span data-stu-id="8520a-147">In Hive, hello default datetime format is 'yyyy-MM-dd 00:00:00' ('1970-01-01 12:21:32' for example).</span></span> <span data-ttu-id="8520a-148">En esta sección, se muestran ejemplos que extraer Hola día de un mes, el mes de Hola de un campo de fecha y hora y otros ejemplos que convertir una cadena de fecha y hora en un formato de cadena de fecha y hora de tooa de formato de hello predeterminada en el formato predeterminado.</span><span class="sxs-lookup"><span data-stu-id="8520a-148">In this section, we show examples that extract hello day of a month, hello month from a datetime field, and other examples that convert a datetime string in a format other than hello default format tooa datetime string in default format.</span></span>

        select day(<datetime field>), month(<datetime field>)
        from <databasename>.<tablename>;

<span data-ttu-id="8520a-149">Esta consulta de Hive se da por supuesto que hello *&#60; campo de fecha y hora >* está en formato de fecha y hora de hello predeterminado.</span><span class="sxs-lookup"><span data-stu-id="8520a-149">This Hive query assumes that hello *&#60;datetime field>* is in hello default datetime format.</span></span>

<span data-ttu-id="8520a-150">Si no es un campo de fecha y hora en formato predeterminado de hello, necesita campo de fecha y hora de hello tooconvert en la marca de tiempo de Unix en primer lugar y, a continuación, hora de Unix de Hola de convert marca tooa datetime de cadena que se encuentra en valor predeterminado de Hola formato.</span><span class="sxs-lookup"><span data-stu-id="8520a-150">If a datetime field is not in hello default format, you need tooconvert hello datetime field into Unix time stamp first, and then convert hello Unix time stamp tooa datetime string that is in hello default format.</span></span> <span data-ttu-id="8520a-151">Una vez Hola fecha y hora de forma predeterminada en formato, los usuarios pueden aplicar Hola incrustado datetime UDF tooextract características.</span><span class="sxs-lookup"><span data-stu-id="8520a-151">When hello datetime is in default format, users can apply hello embedded datetime UDFs tooextract features.</span></span>

        select from_unixtime(unix_timestamp(<datetime field>,'<pattern of hello datetime field>'))
        from <databasename>.<tablename>;

<span data-ttu-id="8520a-152">En esta consulta, si hello *&#60; campo de fecha y hora >* tiene Hola patrón como *26/03/2015 12:04:39*, hello *' &#60; el patrón del campo de fecha y hora de hello >'* debería ser `'MM/dd/yyyy HH:mm:ss'`.</span><span class="sxs-lookup"><span data-stu-id="8520a-152">In this query, if hello *&#60;datetime field>* has hello pattern like *03/26/2015 12:04:39*, hello *'&#60;pattern of hello datetime field>'* should be `'MM/dd/yyyy HH:mm:ss'`.</span></span> <span data-ttu-id="8520a-153">tootest, los usuarios pueden ejecutar</span><span class="sxs-lookup"><span data-stu-id="8520a-153">tootest it, users can run</span></span>

        select from_unixtime(unix_timestamp('05/15/2015 09:32:10','MM/dd/yyyy HH:mm:ss'))
        from hivesampletable limit 1;

<span data-ttu-id="8520a-154">Hola *hivesampletable* en esta consulta viene preinstalado en todos los clústeres de Hadoop de HDInsight de Azure de forma predeterminada cuando se aprovisionan clústeres Hola.</span><span class="sxs-lookup"><span data-stu-id="8520a-154">hello *hivesampletable* in this query comes preinstalled on all Azure HDInsight Hadoop clusters by default when hello clusters are provisioned.</span></span>

### <span data-ttu-id="8520a-155"><a name="hive-textfeatures"></a>Extracción de características de campos de texto</span><span class="sxs-lookup"><span data-stu-id="8520a-155"><a name="hive-textfeatures"></a>Extract features from Text Fields</span></span>
<span data-ttu-id="8520a-156">Cuando la tabla de Hive hello tiene un campo de texto que contiene una cadena de palabras que están delimitados por espacios, hello siguiente consulta extrae longitud Hola de cadena de Hola y número de Hola de palabras en la cadena de Hola.</span><span class="sxs-lookup"><span data-stu-id="8520a-156">When hello Hive table has a text field that contains a string of words that are delimited by spaces, hello following query extracts hello length of hello string, and hello number of words in hello string.</span></span>

        select length(<text field>) as str_len, size(split(<text field>,' ')) as word_num
        from <databasename>.<tablename>;

### <span data-ttu-id="8520a-157"><a name="hive-gpsdistance"></a>Cálculo de la distancia entre conjuntos de coordenadas de GPS</span><span class="sxs-lookup"><span data-stu-id="8520a-157"><a name="hive-gpsdistance"></a>Calculate distances between sets of GPS coordinates</span></span>
<span data-ttu-id="8520a-158">consulta de Hello proporcionado en esta sección puede ser toohello directamente aplicado NYC Taxi recorridos datos.</span><span class="sxs-lookup"><span data-stu-id="8520a-158">hello query given in this section can be directly applied toohello NYC Taxi Trip Data.</span></span> <span data-ttu-id="8520a-159">Hola de esta consulta sirve tooshow cómo tooapply incrustada funciones matemáticas en las características de toogenerate de Hive.</span><span class="sxs-lookup"><span data-stu-id="8520a-159">hello purpose of this query is tooshow how tooapply an embedded mathematical functions in Hive toogenerate features.</span></span>

<span data-ttu-id="8520a-160">campos que se usan en esta consulta Hello son coordenadas GPS de Hola de ubicaciones de recogida y caída, denominados *recogida\_longitud*, *recogida\_latitud*,  *caída\_longitud*, y *caída\_latitud*.</span><span class="sxs-lookup"><span data-stu-id="8520a-160">hello fields that are used in this query are hello GPS coordinates of pickup and dropoff locations, named *pickup\_longitude*, *pickup\_latitude*, *dropoff\_longitude*, and *dropoff\_latitude*.</span></span> <span data-ttu-id="8520a-161">las consultas de Hola que calcular Hola distancia directa entre las coordenadas de recogida y caída de hello son:</span><span class="sxs-lookup"><span data-stu-id="8520a-161">hello queries that calculate hello direct distance between hello pickup and dropoff coordinates are:</span></span>

        set R=3959;
        set pi=radians(180);
        select pickup_longitude, pickup_latitude, dropoff_longitude, dropoff_latitude,
            ${hiveconf:R}*2*2*atan((1-sqrt(1-pow(sin((dropoff_latitude-pickup_latitude)
            *${hiveconf:pi}/180/2),2)-cos(pickup_latitude*${hiveconf:pi}/180)
            *cos(dropoff_latitude*${hiveconf:pi}/180)*pow(sin((dropoff_longitude-pickup_longitude)*${hiveconf:pi}/180/2),2)))
            /sqrt(pow(sin((dropoff_latitude-pickup_latitude)*${hiveconf:pi}/180/2),2)
            +cos(pickup_latitude*${hiveconf:pi}/180)*cos(dropoff_latitude*${hiveconf:pi}/180)*
            pow(sin((dropoff_longitude-pickup_longitude)*${hiveconf:pi}/180/2),2))) as direct_distance
        from nyctaxi.trip
        where pickup_longitude between -90 and 0
        and pickup_latitude between 30 and 90
        and dropoff_longitude between -90 and 0
        and dropoff_latitude between 30 and 90
        limit 10;

<span data-ttu-id="8520a-162">ecuaciones matemáticas Hola que calcular la distancia de hello entre dos coordenadas GPS pueden encontrarse en hello <a href="http://www.movable-type.co.uk/scripts/latlong.html" target="_blank">secuencias de comandos de tipo móvil</a> sitio, creado por Peter Lapisu.</span><span class="sxs-lookup"><span data-stu-id="8520a-162">hello mathematical equations that calculate hello distance between two GPS coordinates can be found on hello <a href="http://www.movable-type.co.uk/scripts/latlong.html" target="_blank">Movable Type Scripts</a> site, authored by Peter Lapisu.</span></span> <span data-ttu-id="8520a-163">En su Javascript Hola función `toRad()` es *lat_or_lon*180/pi *, que convierte grados tooradians.</span><span class="sxs-lookup"><span data-stu-id="8520a-163">In his Javascript, hello function `toRad()` is just *lat_or_lon*pi/180*, which converts degrees tooradians.</span></span> <span data-ttu-id="8520a-164">En este caso, *lat_or_lon* es Hola latitud o longitud.</span><span class="sxs-lookup"><span data-stu-id="8520a-164">Here, *lat_or_lon* is hello latitude or longitude.</span></span> <span data-ttu-id="8520a-165">Puesto que el subárbol no proporciona la función hello `atan2`, pero proporciona la función hello `atan`, hello `atan2` función se implementa mediante `atan` función Hola por encima de la consulta de Hive mediante definición de hello proporcionada en <a href="http://en.wikipedia.org/wiki/Atan2" target="_blank"> Wikipedia</a>.</span><span class="sxs-lookup"><span data-stu-id="8520a-165">Since Hive does not provide hello function `atan2`, but provides hello function `atan`, hello `atan2` function is implemented by `atan` function in hello above Hive query using hello definition provided in <a href="http://en.wikipedia.org/wiki/Atan2" target="_blank">Wikipedia</a>.</span></span>

![Creación del espacio de trabajo](./media/machine-learning-data-science-create-features-hive/atan2new.png)

<span data-ttu-id="8520a-167">Una lista completa de Hive UDF incrustadas pueden encontrarse en hello **funciones integradas** sección en hello <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF#LanguageManualUDF-MathematicalFunctions" target="_blank">Apache Hive wiki</a>).</span><span class="sxs-lookup"><span data-stu-id="8520a-167">A full list of Hive embedded UDFs can be found in hello **Built-in Functions** section on hello <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF#LanguageManualUDF-MathematicalFunctions" target="_blank">Apache Hive wiki</a>).</span></span>  

## <span data-ttu-id="8520a-168"><a name="tuning"></a>Temas avanzados: tooImprove de parámetros de Hive de optimizar la velocidad de consulta</span><span class="sxs-lookup"><span data-stu-id="8520a-168"><a name="tuning"></a> Advanced topics: Tune Hive Parameters tooImprove Query Speed</span></span>
<span data-ttu-id="8520a-169">Hola configuración de clúster de Hive podría no ser adecuados para consultas de Hive de Hola y los datos de Hola que se están procesando las consultas de hello un parámetro predeterminado.</span><span class="sxs-lookup"><span data-stu-id="8520a-169">hello default parameter settings of Hive cluster might not be suitable for hello Hive queries and hello data that hello queries are processing.</span></span> <span data-ttu-id="8520a-170">En esta sección se explican algunos parámetros que los usuarios pueden ajustar que mejoran el rendimiento de Hola de consultas de Hive.</span><span class="sxs-lookup"><span data-stu-id="8520a-170">In this section, we discuss some parameters that users can tune that improve hello performance of Hive queries.</span></span> <span data-ttu-id="8520a-171">Los usuarios necesitan el parámetro de hello tooadd optimizar consultas antes de las consultas de hello del procesamiento de datos.</span><span class="sxs-lookup"><span data-stu-id="8520a-171">Users need tooadd hello parameter tuning queries before hello queries of processing data.</span></span>

1. <span data-ttu-id="8520a-172">**Espacio de montón de Java**: para las consultas que implican combinar conjuntos de datos grandes o procesar registros largos, **quedando sin espacio en el montón** es uno de los errores comunes de Hola.</span><span class="sxs-lookup"><span data-stu-id="8520a-172">**Java heap space**: For queries involving joining large datasets, or processing long records, **running out of heap space** is one of hello common error.</span></span> <span data-ttu-id="8520a-173">Esto puede corregirse estableciendo parámetros *mapreduce.map.java.opts* y *mapreduce.task.io.sort.mb* toodesired valores.</span><span class="sxs-lookup"><span data-stu-id="8520a-173">This can be tuned by setting parameters *mapreduce.map.java.opts* and *mapreduce.task.io.sort.mb* toodesired values.</span></span> <span data-ttu-id="8520a-174">Aquí tiene un ejemplo:</span><span class="sxs-lookup"><span data-stu-id="8520a-174">Here is an example:</span></span>
   
        set mapreduce.map.java.opts=-Xmx4096m;
        set mapreduce.task.io.sort.mb=-Xmx1024m;

    <span data-ttu-id="8520a-175">Este parámetro asigna espacio de montón de tooJava de memoria de 4GB y también realiza la ordenación más eficaz asignando más memoria para él.</span><span class="sxs-lookup"><span data-stu-id="8520a-175">This parameter allocates 4GB memory tooJava heap space and also makes sorting more efficient by allocating more memory for it.</span></span> <span data-ttu-id="8520a-176">Es un tooplay buena idea con estas asignaciones si hay un espacio de trabajo error errores tooheap relacionados.</span><span class="sxs-lookup"><span data-stu-id="8520a-176">It is a good idea tooplay with these allocations if there are any job failure errors related tooheap space.</span></span>

1. <span data-ttu-id="8520a-177">**Tamaño de bloque de DFS** : este parámetro establece la unidad más pequeña de Hola de datos que Hola almacenes del sistema de archivos.</span><span class="sxs-lookup"><span data-stu-id="8520a-177">**DFS block size** : This parameter sets hello smallest unit of data that hello file system stores.</span></span> <span data-ttu-id="8520a-178">Por ejemplo, si el tamaño de bloque DFS de hello es 128MB, a continuación, ningún dato de tamaño inferior o superior too128MB se almacena en un único bloque, mientras que los datos que es mayores que 128MB se asigna a bloques adicionales.</span><span class="sxs-lookup"><span data-stu-id="8520a-178">As an example, if hello DFS block size is 128MB, then any data of size less than and up too128MB is stored in a single block, while data that is larger than 128MB is allotted extra blocks.</span></span> <span data-ttu-id="8520a-179">Elegir un tamaño de bloque muy pequeño hace grandes sobrecargas en Hadoop como nodo de nombre de hello tiene tooprocess muchas más solicitudes toofind Hola relevante bloque pertenecen toohello archivo.</span><span class="sxs-lookup"><span data-stu-id="8520a-179">Choosing a very small block size causes large overheads in Hadoop since hello name node has tooprocess many more requests toofind hello relevant block pertaining toohello file.</span></span> <span data-ttu-id="8520a-180">Una configuración recomendada al tratar con datos de gigabytes (o mayores) es:</span><span class="sxs-lookup"><span data-stu-id="8520a-180">A recommended setting when dealing with gigabytes (or larger) data is :</span></span>
   
        set dfs.block.size=128m;
2. <span data-ttu-id="8520a-181">**Optimizar la operación de combinación en el subárbol** : mientras las operaciones de combinación en el marco de trabajo de asignación/reducción de hello normalmente tienen lugar en hello reducir fase, a veces, una enorme puede mejorar mediante la programación de combinaciones en fase de asignación de hello (también denominada "mapjoins").</span><span class="sxs-lookup"><span data-stu-id="8520a-181">**Optimizing join operation in Hive** : While join operations in hello map/reduce framework typically take place in hello reduce phase, sometimes, enormous gains can be achieved by scheduling joins in hello map phase (also called "mapjoins").</span></span> <span data-ttu-id="8520a-182">toodirect subárbol toodo esto siempre que sea posible, podemos establecer:</span><span class="sxs-lookup"><span data-stu-id="8520a-182">toodirect Hive toodo this whenever possible, we can set :</span></span>
   
        set hive.auto.convert.join=true;
3. <span data-ttu-id="8520a-183">**Especifica el número de Hola de asignadores tooHive** : Hadoop mientras permite Hola usuario tooset Hola número de reductores, el número de Hola de asignadores es normalmente no se establece por usuario de Hola.</span><span class="sxs-lookup"><span data-stu-id="8520a-183">**Specifying hello number of mappers tooHive** : While Hadoop allows hello user tooset hello number of reducers, hello number of mappers is typically not be set by hello user.</span></span> <span data-ttu-id="8520a-184">Un truco que permite cierto grado de control en este número es una variable de Hadoop de hello toochoose, *mapred.min.split.size* y *mapred.max.split.size* como tamaño de Hola de cada asignación de tarea viene determinada por:</span><span class="sxs-lookup"><span data-stu-id="8520a-184">A trick that allows some degree of control on this number is toochoose hello Hadoop variables, *mapred.min.split.size* and *mapred.max.split.size* as hello size of each map task is determined by :</span></span>
   
        num_maps = max(mapred.min.split.size, min(mapred.max.split.size, dfs.block.size))
   
    <span data-ttu-id="8520a-185">Por lo general, Hola valor predeterminado de *mapred.min.split.size* es 0, que de *mapred.max.split.size* es **Long.MAX** y el de *dfs.block.size* es de 64MB.</span><span class="sxs-lookup"><span data-stu-id="8520a-185">Typically, hello default value of *mapred.min.split.size* is 0, that of *mapred.max.split.size* is **Long.MAX** and that of *dfs.block.size* is 64MB.</span></span> <span data-ttu-id="8520a-186">Como podemos ver, tamaño de los datos Hola determinado, estos parámetros "configuración" de ajuste les permite nos tootune Hola número de asignadores usa.</span><span class="sxs-lookup"><span data-stu-id="8520a-186">As we can see, given hello data size, tuning these parameters by "setting" them allows us tootune hello number of mappers used.</span></span>
4. <span data-ttu-id="8520a-187">A continuación se mencionan algunas otras **opciones avanzadas** más para optimizar el rendimiento de Hive.</span><span class="sxs-lookup"><span data-stu-id="8520a-187">A few other more **advanced options** for optimizing Hive performance are mentioned below.</span></span> <span data-ttu-id="8520a-188">Estos permiten tooset Hola memoria asignada toomap y reducen las tareas y pueden ser útiles para aumentar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="8520a-188">These allow you tooset hello memory allocated toomap and reduce tasks, and can be useful in tweaking performance.</span></span> <span data-ttu-id="8520a-189">Tenga en cuenta que hello *mapreduce.reduce.memory.mb* no puede ser mayor que el tamaño de memoria física de Hola de cada nodo de trabajo en clúster de Hadoop de Hola.</span><span class="sxs-lookup"><span data-stu-id="8520a-189">Please keep in mind that hello *mapreduce.reduce.memory.mb* cannot be greater than hello physical memory size of each worker node in hello Hadoop cluster.</span></span>
   
        set mapreduce.map.memory.mb = 2048;
        set mapreduce.reduce.memory.mb=6144;
        set mapreduce.reduce.java.opts=-Xmx8192m;
        set mapred.reduce.tasks=128;
        set mapred.tasktracker.reduce.tasks.maximum=128;


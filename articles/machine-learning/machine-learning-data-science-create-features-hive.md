---
title: "Crear características para datos en un clúster de Hadoop mediante consultas de Hive | Microsoft Docs"
description: "Ejemplos de consultas de Hive que generan características en datos almacenados en un clúster de Hadoop de HDInsight de Azure."
services: machine-learning
documentationcenter: 
author: bradsev
manager: jhubbard
editor: cgronlun
ms.assetid: e8a94c71-979b-4707-b8fd-85b47d309a30
ms.service: machine-learning
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/24/2017
ms.author: hangzh;bradsev
ms.openlocfilehash: e027a6ffcb63868be13432870e484c5cbf2eef4b
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/29/2017
---
# <a name="create-features-for-data-in-an-hadoop-cluster-using-hive-queries"></a><span data-ttu-id="4a48a-103">Crear características para datos en un clúster de Hadoop mediante consultas de Hive</span><span class="sxs-lookup"><span data-stu-id="4a48a-103">Create features for data in an Hadoop cluster using Hive queries</span></span>
<span data-ttu-id="4a48a-104">Este documento muestra cómo crear características para los datos almacenados en un clúster de Hadoop para HDInsight de Azure mediante consultas de Hive.</span><span class="sxs-lookup"><span data-stu-id="4a48a-104">This document shows how to create features for data stored in an Azure HDInsight Hadoop cluster using Hive queries.</span></span> <span data-ttu-id="4a48a-105">Estas consultas de Hive usan funciones definidas por el usuario (UDF), los scripts para los que se ofrecen.</span><span class="sxs-lookup"><span data-stu-id="4a48a-105">These Hive queries use embedded Hive User Defined Functions (UDFs), the scripts for which are provided.</span></span>

<span data-ttu-id="4a48a-106">Las operaciones necesarias para crear características pueden consumir mucha memoria.</span><span class="sxs-lookup"><span data-stu-id="4a48a-106">The operations needed to create features can be memory intensive.</span></span> <span data-ttu-id="4a48a-107">El rendimiento de las consultas de Hive resulta más importante en estos casos y se puede mejorar ajustando ciertos parámetros.</span><span class="sxs-lookup"><span data-stu-id="4a48a-107">The performance of Hive queries becomes more critical in such cases and can be improved by tuning certain parameters.</span></span> <span data-ttu-id="4a48a-108">El ajuste de estos parámetros se describe en la sección final.</span><span class="sxs-lookup"><span data-stu-id="4a48a-108">The tuning of these parameters is discussed in the final section.</span></span>

<span data-ttu-id="4a48a-109">También se ofrecen ejemplos de las consultas que son específicos de escenarios de [NYC Taxi Trip Data](http://chriswhong.com/open-data/foil_nyc_taxi/) en el [repositorio de GitHub](https://github.com/Azure/Azure-MachineLearning-DataScience/tree/master/Misc/DataScienceProcess/DataScienceScripts).</span><span class="sxs-lookup"><span data-stu-id="4a48a-109">Examples of the queries that are presented are specific to the [NYC Taxi Trip Data](http://chriswhong.com/open-data/foil_nyc_taxi/) scenarios are also provided in [GitHub repository](https://github.com/Azure/Azure-MachineLearning-DataScience/tree/master/Misc/DataScienceProcess/DataScienceScripts).</span></span> <span data-ttu-id="4a48a-110">Estas consultas ya tienen el esquema de datos especificado y están listas para enviarse para su ejecución.</span><span class="sxs-lookup"><span data-stu-id="4a48a-110">These queries already have data schema specified and are ready to be submitted to run.</span></span> <span data-ttu-id="4a48a-111">En la última sección, también se describen los parámetros que los usuarios pueden ajustar para que se pueda mejorar el rendimiento de las consultas de Hive.</span><span class="sxs-lookup"><span data-stu-id="4a48a-111">In the final section, parameters that users can tune so that the performance of Hive queries can be improved are  also discussed.</span></span>

[!INCLUDE [cap-create-features-data-selector](../../includes/cap-create-features-selector.md)]

<span data-ttu-id="4a48a-112">Este **menú** vincula a temas en los que se describe cómo crear características para datos en diversos entornos.</span><span class="sxs-lookup"><span data-stu-id="4a48a-112">This **menu** links to topics that describe how to create features for data in various environments.</span></span> <span data-ttu-id="4a48a-113">Esta tarea constituye un paso del [proceso de ciencia de datos en equipos (TDSP)](https://azure.microsoft.com/documentation/learning-paths/cortana-analytics-process/).</span><span class="sxs-lookup"><span data-stu-id="4a48a-113">This task is a step in the [Team Data Science Process (TDSP)](https://azure.microsoft.com/documentation/learning-paths/cortana-analytics-process/).</span></span>

## <a name="prerequisites"></a><span data-ttu-id="4a48a-114">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="4a48a-114">Prerequisites</span></span>
<span data-ttu-id="4a48a-115">En este artículo se supone que ha:</span><span class="sxs-lookup"><span data-stu-id="4a48a-115">This article assumes that you have:</span></span>

* <span data-ttu-id="4a48a-116">Creado una cuenta de almacenamiento de Azure.</span><span class="sxs-lookup"><span data-stu-id="4a48a-116">Created an Azure storage account.</span></span> <span data-ttu-id="4a48a-117">Si necesita instrucciones, consulte [Creación de una cuenta de almacenamiento de Azure](../storage/common/storage-create-storage-account.md#create-a-storage-account)</span><span class="sxs-lookup"><span data-stu-id="4a48a-117">If you need instructions, see [Create an Azure Storage account](../storage/common/storage-create-storage-account.md#create-a-storage-account)</span></span>
* <span data-ttu-id="4a48a-118">Aprovisionado un clúster de Hadoop personalizado con el servicio HDInsight.</span><span class="sxs-lookup"><span data-stu-id="4a48a-118">Provisioned a customized Hadoop cluster with the HDInsight service.</span></span>  <span data-ttu-id="4a48a-119">Si necesita instrucciones, consulte [Personalización de clústeres de Hadoop de HDInsight de Azure para análisis avanzado](machine-learning-data-science-customize-hadoop-cluster.md).</span><span class="sxs-lookup"><span data-stu-id="4a48a-119">If you need instructions, see [Customize Azure HDInsight Hadoop Clusters for Advanced Analytics](machine-learning-data-science-customize-hadoop-cluster.md).</span></span>
* <span data-ttu-id="4a48a-120">Se han cargado los datos en tablas de subárbol en clústeres de Hadoop de HDInsight de Azure.</span><span class="sxs-lookup"><span data-stu-id="4a48a-120">The data has been uploaded to Hive tables in Azure HDInsight Hadoop clusters.</span></span> <span data-ttu-id="4a48a-121">De no ser así, siga [Crear y cargar datos en tablas de Hive](machine-learning-data-science-move-hive-tables.md) para cargar los datos en tablas de Hive primero.</span><span class="sxs-lookup"><span data-stu-id="4a48a-121">If it has not, please follow [Create and load data to Hive tables](machine-learning-data-science-move-hive-tables.md) to upload data to Hive tables first.</span></span>
* <span data-ttu-id="4a48a-122">Habilitado el acceso remoto al clúster.</span><span class="sxs-lookup"><span data-stu-id="4a48a-122">Enabled remote access to the cluster.</span></span> <span data-ttu-id="4a48a-123">Si necesita instrucciones, consulte [Acceso al nodo principal del clúster de Hadoop](machine-learning-data-science-customize-hadoop-cluster.md#headnode).</span><span class="sxs-lookup"><span data-stu-id="4a48a-123">If you need instructions, see [Access the Head Node of Hadoop Cluster](machine-learning-data-science-customize-hadoop-cluster.md#headnode).</span></span>

## <span data-ttu-id="4a48a-124"><a name="hive-featureengineering"></a>Generación de características</span><span class="sxs-lookup"><span data-stu-id="4a48a-124"><a name="hive-featureengineering"></a>Feature Generation</span></span>
<span data-ttu-id="4a48a-125">En esta sección se describen varios ejemplos de las maneras en que se pueden generar características mediante consultas de Hive.</span><span class="sxs-lookup"><span data-stu-id="4a48a-125">In this section, several examples of the ways in which features can be generating using Hive queries are described.</span></span> <span data-ttu-id="4a48a-126">Una vez que haya generado características adicionales, puede agregarlas como columnas a la tabla existente o crear una nueva tabla con las características adicionales y la clave principal, que se pueden combinar a continuación con la tabla original.</span><span class="sxs-lookup"><span data-stu-id="4a48a-126">Once you have generated additional features, you can either add them as columns to the existing table or create a new table with the additional features and primary key, which can then be joined with the original table.</span></span> <span data-ttu-id="4a48a-127">Estos son los ejemplos presentados:</span><span class="sxs-lookup"><span data-stu-id="4a48a-127">Here are the examples presented:</span></span>

1. [<span data-ttu-id="4a48a-128">Generación de características basada en frecuencia</span><span class="sxs-lookup"><span data-stu-id="4a48a-128">Frequency based Feature Generation</span></span>](#hive-frequencyfeature)
2. [<span data-ttu-id="4a48a-129">Riesgos de las variables de categorías en la clasificación binaria</span><span class="sxs-lookup"><span data-stu-id="4a48a-129">Risks of Categorical Variables in Binary Classification</span></span>](#hive-riskfeature)
3. [<span data-ttu-id="4a48a-130">Extraer características de campos de fecha y hora</span><span class="sxs-lookup"><span data-stu-id="4a48a-130">Extract features from Datetime Field</span></span>](#hive-datefeatures)
4. [<span data-ttu-id="4a48a-131">Extraer características del campo de texto</span><span class="sxs-lookup"><span data-stu-id="4a48a-131">Extract features from Text Field</span></span>](#hive-textfeatures)
5. [<span data-ttu-id="4a48a-132">Calcular distancia entre las coordenadas GPS</span><span class="sxs-lookup"><span data-stu-id="4a48a-132">Calculate distance between GPS coordinates</span></span>](#hive-gpsdistance)

### <span data-ttu-id="4a48a-133"><a name="hive-frequencyfeature"></a>Generación de características basada en frecuencia</span><span class="sxs-lookup"><span data-stu-id="4a48a-133"><a name="hive-frequencyfeature"></a>Frequency based Feature Generation</span></span>
<span data-ttu-id="4a48a-134">A menudo resulta útil calcular las frecuencias de los niveles de una variable de categoría o las frecuencias de determinadas combinaciones de niveles desde varias variables de categorías.</span><span class="sxs-lookup"><span data-stu-id="4a48a-134">It is often useful to calculate the frequencies of the levels of a categorical variable, or the frequencies of certain combinations of levels from multiple categorical variables.</span></span> <span data-ttu-id="4a48a-135">Los usuarios pueden usar el siguiente script para calcular estas frecuencias:</span><span class="sxs-lookup"><span data-stu-id="4a48a-135">Users can use the following script to calculate these frequencies:</span></span>

        select
            a.<column_name1>, a.<column_name2>, a.sub_count/sum(a.sub_count) over () as frequency
        from
        (
            select
                <column_name1>,<column_name2>, count(*) as sub_count
            from <databasename>.<tablename> group by <column_name1>, <column_name2>
        )a
        order by frequency desc;


### <span data-ttu-id="4a48a-136"><a name="hive-riskfeature"></a>Riesgos de las variables de categorías en la clasificación binaria</span><span class="sxs-lookup"><span data-stu-id="4a48a-136"><a name="hive-riskfeature"></a>Risks of Categorical Variables in Binary Classification</span></span>
<span data-ttu-id="4a48a-137">En la clasificación binaria, necesitamos convertir las variables de categorías no numéricas en características numéricas cuando los modelos que se utilizan solo toman características numéricas.</span><span class="sxs-lookup"><span data-stu-id="4a48a-137">In binary classification, we need to convert non-numeric categorical variables into numeric features when the models being used only take numeric features.</span></span> <span data-ttu-id="4a48a-138">Para ello, reemplace cada nivel no numérico por un riesgo numérico.</span><span class="sxs-lookup"><span data-stu-id="4a48a-138">This is done by replacing each non-numeric level with a numeric risk.</span></span> <span data-ttu-id="4a48a-139">En esta sección mostramos algunas consultas de subárbol genéricas que calculan los valores de riesgo (probabilidades de registro) de una variable de categoría.</span><span class="sxs-lookup"><span data-stu-id="4a48a-139">In this section, we show some generic Hive queries that calculate the risk values (log odds) of a categorical variable.</span></span>

        set smooth_param1=1;
        set smooth_param2=20;
        select
            <column_name1>,<column_name2>,
            ln((sum_target+${hiveconf:smooth_param1})/(record_count-sum_target+${hiveconf:smooth_param2}-${hiveconf:smooth_param1})) as risk
        from
            (
            select
                <column_nam1>, <column_name2>, sum(binary_target) as sum_target, sum(1) as record_count
            from
                (
                select
                    <column_name1>, <column_name2>, if(target_column>0,1,0) as binary_target
                from <databasename>.<tablename>
                )a
            group by <column_name1>, <column_name2>
            )b

<span data-ttu-id="4a48a-140">En este ejemplo, las variables `smooth_param1` y `smooth_param2` se establecen para suavizar los valores de riesgo calculados a partir de los datos.</span><span class="sxs-lookup"><span data-stu-id="4a48a-140">In this example, variables `smooth_param1` and `smooth_param2` are set to smooth the risk values calculated from the data.</span></span> <span data-ttu-id="4a48a-141">Los riesgos tienen un intervalo comprendido entre -Inf y Inf.</span><span class="sxs-lookup"><span data-stu-id="4a48a-141">Risks have a range between -Inf and Inf.</span></span> <span data-ttu-id="4a48a-142">Un riesgo > 0 indica que la probabilidad de que el destino sea igual a 1 es mayor que 0,5.</span><span class="sxs-lookup"><span data-stu-id="4a48a-142">A risks > 0 indicates that the probability that the target is equal to 1 is greater than 0.5.</span></span>

<span data-ttu-id="4a48a-143">Después de calcularse la tabla de riesgos, los usuarios pueden asignar valores de riesgo a una tabla uniéndola a la tabla de riesgo.</span><span class="sxs-lookup"><span data-stu-id="4a48a-143">After the risk table is calculated, users can assign risk values to a table by joining it with the risk table.</span></span> <span data-ttu-id="4a48a-144">La consulta de combinación de subárbol se ha proporcionado en la sección anterior.</span><span class="sxs-lookup"><span data-stu-id="4a48a-144">The Hive joining query was provided in previous section.</span></span>

### <span data-ttu-id="4a48a-145"><a name="hive-datefeatures"></a>Extraer características de campos de fecha y hora</span><span class="sxs-lookup"><span data-stu-id="4a48a-145"><a name="hive-datefeatures"></a>Extract features from Datetime Fields</span></span>
<span data-ttu-id="4a48a-146">El subárbol se incluye con un conjunto de UDF para el procesamiento de campos de fecha y hora.</span><span class="sxs-lookup"><span data-stu-id="4a48a-146">Hive comes with a set of UDFs for processing datetime fields.</span></span> <span data-ttu-id="4a48a-147">En el subárbol, el formato de fecha y hora predeterminado es 'aaaa-MM-dd 00:00:00 ' ('1970-01-01 12:21:32' por ejemplo).</span><span class="sxs-lookup"><span data-stu-id="4a48a-147">In Hive, the default datetime format is 'yyyy-MM-dd 00:00:00' ('1970-01-01 12:21:32' for example).</span></span> <span data-ttu-id="4a48a-148">En esta sección mostramos ejemplos que extraen el día de un mes, el mes de un campo de fecha y hora, y otros ejemplos que convierten una cadena de fecha y hora en un formato distinto del predeterminado en una cadena de fecha y hora en el formato predeterminado.</span><span class="sxs-lookup"><span data-stu-id="4a48a-148">In this section, we show examples that extract the day of a month, the month from a datetime field, and other examples that convert a datetime string in a format other than the default format to a datetime string in default format.</span></span>

        select day(<datetime field>), month(<datetime field>)
        from <databasename>.<tablename>;

<span data-ttu-id="4a48a-149">Esta consulta de Hive asume que *&#60;datetime field>* está en el formato de fecha y hora predeterminado.</span><span class="sxs-lookup"><span data-stu-id="4a48a-149">This Hive query assumes that the *&#60;datetime field>* is in the default datetime format.</span></span>

<span data-ttu-id="4a48a-150">Si un campo de fecha y hora no se encuentra en el formato predeterminado, deberá convertir el campo de fecha y hora en la marca de tiempo de Unix primero y, a continuación, convertir la marca de tiempo de Unix a una cadena de fecha y hora que se encuentra en el formato predeterminado.</span><span class="sxs-lookup"><span data-stu-id="4a48a-150">If a datetime field is not in the default format, you need to convert the datetime field into Unix time stamp first, and then convert the Unix time stamp to a datetime string that is in the default format.</span></span> <span data-ttu-id="4a48a-151">Cuando la fecha y hora se encuentra en el formato predeterminado, los usuarios pueden aplicar los UDF de fecha y hora incrustado para extraer características.</span><span class="sxs-lookup"><span data-stu-id="4a48a-151">When the datetime is in default format, users can apply the embedded datetime UDFs to extract features.</span></span>

        select from_unixtime(unix_timestamp(<datetime field>,'<pattern of the datetime field>'))
        from <databasename>.<tablename>;

<span data-ttu-id="4a48a-152">En esta consulta, si *&#60;datetime field>* sigue un patrón de tipo *03/26/2015 12:04:39*, *'&#60;pattern of the datetime field>'* debe ser `'MM/dd/yyyy HH:mm:ss'`.</span><span class="sxs-lookup"><span data-stu-id="4a48a-152">In this query, if the *&#60;datetime field>* has the pattern like *03/26/2015 12:04:39*, the *'&#60;pattern of the datetime field>'* should be `'MM/dd/yyyy HH:mm:ss'`.</span></span> <span data-ttu-id="4a48a-153">Para probarlo, los usuarios pueden ejecutar</span><span class="sxs-lookup"><span data-stu-id="4a48a-153">To test it, users can run</span></span>

        select from_unixtime(unix_timestamp('05/15/2015 09:32:10','MM/dd/yyyy HH:mm:ss'))
        from hivesampletable limit 1;

<span data-ttu-id="4a48a-154">La tabla *hivesampletable* de esta consulta viene preinstalada en todos los clústeres de Hadoop de HDInsight de Azure de forma predeterminada cuando se aprovisionan los clústeres.</span><span class="sxs-lookup"><span data-stu-id="4a48a-154">The *hivesampletable* in this query comes preinstalled on all Azure HDInsight Hadoop clusters by default when the clusters are provisioned.</span></span>

### <span data-ttu-id="4a48a-155"><a name="hive-textfeatures"></a>Extracción de características de campos de texto</span><span class="sxs-lookup"><span data-stu-id="4a48a-155"><a name="hive-textfeatures"></a>Extract features from Text Fields</span></span>
<span data-ttu-id="4a48a-156">Cuando la tabla de subárbol tiene un campo de texto que contiene una cadena de palabras delimitadas por espacios, la consulta siguiente extrae la longitud de la cadena y el número de palabras de la cadena.</span><span class="sxs-lookup"><span data-stu-id="4a48a-156">When the Hive table has a text field that contains a string of words that are delimited by spaces, the following query extracts the length of the string, and the number of words in the string.</span></span>

        select length(<text field>) as str_len, size(split(<text field>,' ')) as word_num
        from <databasename>.<tablename>;

### <span data-ttu-id="4a48a-157"><a name="hive-gpsdistance"></a>Cálculo de la distancia entre conjuntos de coordenadas de GPS</span><span class="sxs-lookup"><span data-stu-id="4a48a-157"><a name="hive-gpsdistance"></a>Calculate distances between sets of GPS coordinates</span></span>
<span data-ttu-id="4a48a-158">La consulta proporcionada en esta sección puede aplicarse directamente a los datos de carreras de taxi de Nueva York.</span><span class="sxs-lookup"><span data-stu-id="4a48a-158">The query given in this section can be directly applied to the NYC Taxi Trip Data.</span></span> <span data-ttu-id="4a48a-159">El propósito de esta consulta es mostrar cómo aplicar una función matemática incrustada en el subárbol para generar características.</span><span class="sxs-lookup"><span data-stu-id="4a48a-159">The purpose of this query is to show how to apply an embedded mathematical functions in Hive to generate features.</span></span>

<span data-ttu-id="4a48a-160">Los campos que se usan en esta consulta son las coordenadas GPS de ubicaciones de recogida y entrega, denominadas *pickup\_longitude*, *pickup\_latitude*, *dropoff\_longitude* y *dropoff\_latitude*.</span><span class="sxs-lookup"><span data-stu-id="4a48a-160">The fields that are used in this query are the GPS coordinates of pickup and dropoff locations, named *pickup\_longitude*, *pickup\_latitude*, *dropoff\_longitude*, and *dropoff\_latitude*.</span></span> <span data-ttu-id="4a48a-161">Las consultas que calculan la distancia directa entre las coordenadas de recogida y entrega son:</span><span class="sxs-lookup"><span data-stu-id="4a48a-161">The queries that calculate the direct distance between the pickup and dropoff coordinates are:</span></span>

        set R=3959;
        set pi=radians(180);
        select pickup_longitude, pickup_latitude, dropoff_longitude, dropoff_latitude,
            ${hiveconf:R}*2*2*atan((1-sqrt(1-pow(sin((dropoff_latitude-pickup_latitude)
            *${hiveconf:pi}/180/2),2)-cos(pickup_latitude*${hiveconf:pi}/180)
            *cos(dropoff_latitude*${hiveconf:pi}/180)*pow(sin((dropoff_longitude-pickup_longitude)*${hiveconf:pi}/180/2),2)))
            /sqrt(pow(sin((dropoff_latitude-pickup_latitude)*${hiveconf:pi}/180/2),2)
            +cos(pickup_latitude*${hiveconf:pi}/180)*cos(dropoff_latitude*${hiveconf:pi}/180)*
            pow(sin((dropoff_longitude-pickup_longitude)*${hiveconf:pi}/180/2),2))) as direct_distance
        from nyctaxi.trip
        where pickup_longitude between -90 and 0
        and pickup_latitude between 30 and 90
        and dropoff_longitude between -90 and 0
        and dropoff_latitude between 30 and 90
        limit 10;

<span data-ttu-id="4a48a-162">Las ecuaciones matemáticas que calculan la distancia entre dos coordenadas GPS pueden encontrarse en el sitio <a href="http://www.movable-type.co.uk/scripts/latlong.html" target="_blank">Movable Type Scripts</a> (Scripts de tipo movibles), creado por Peter Lapisu.</span><span class="sxs-lookup"><span data-stu-id="4a48a-162">The mathematical equations that calculate the distance between two GPS coordinates can be found on the <a href="http://www.movable-type.co.uk/scripts/latlong.html" target="_blank">Movable Type Scripts</a> site, authored by Peter Lapisu.</span></span> <span data-ttu-id="4a48a-163">En su JavaScript, la función `toRad()` es simplemente *lat_or_lon*pi/180*, que convierte grados a radianes.</span><span class="sxs-lookup"><span data-stu-id="4a48a-163">In his Javascript, the function `toRad()` is just *lat_or_lon*pi/180*, which converts degrees to radians.</span></span> <span data-ttu-id="4a48a-164">Aquí, *lat_or_lon* es la latitud o la longitud.</span><span class="sxs-lookup"><span data-stu-id="4a48a-164">Here, *lat_or_lon* is the latitude or longitude.</span></span> <span data-ttu-id="4a48a-165">Debido a que Hive no proporciona la función `atan2`, pero sí la función `atan`, la función `atan2` se implementa en la función `atan` en la consulta de Hive anterior mediante la definición incluida en <a href="http://en.wikipedia.org/wiki/Atan2" target="_blank">Wikipedia</a>.</span><span class="sxs-lookup"><span data-stu-id="4a48a-165">Since Hive does not provide the function `atan2`, but provides the function `atan`, the `atan2` function is implemented by `atan` function in the above Hive query using the definition provided in <a href="http://en.wikipedia.org/wiki/Atan2" target="_blank">Wikipedia</a>.</span></span>

![Creación del espacio de trabajo](./media/machine-learning-data-science-create-features-hive/atan2new.png)

<span data-ttu-id="4a48a-167">Se puede encontrar una lista completa de las UDF incrustadas de Hive en la sección **Funciones integradas** de la wiki de <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF#LanguageManualUDF-MathematicalFunctions" target="_blank">Apache Hive</a>.</span><span class="sxs-lookup"><span data-stu-id="4a48a-167">A full list of Hive embedded UDFs can be found in the **Built-in Functions** section on the <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF#LanguageManualUDF-MathematicalFunctions" target="_blank">Apache Hive wiki</a>).</span></span>  

## <span data-ttu-id="4a48a-168"><a name="tuning"></a> Temas avanzados: Ajustar parámetros de Hive para mejorar la velocidad de consulta</span><span class="sxs-lookup"><span data-stu-id="4a48a-168"><a name="tuning"></a> Advanced topics: Tune Hive Parameters to Improve Query Speed</span></span>
<span data-ttu-id="4a48a-169">La configuración de parámetros predeterminados del clúster de subárbol podría no ser adecuada para las consultas de subárbol y los datos que estas consultas procesan.</span><span class="sxs-lookup"><span data-stu-id="4a48a-169">The default parameter settings of Hive cluster might not be suitable for the Hive queries and the data that the queries are processing.</span></span> <span data-ttu-id="4a48a-170">En esta sección se describen algunos parámetros que los usuarios pueden ajustar y que mejoran el rendimiento de las consultas de subárbol.</span><span class="sxs-lookup"><span data-stu-id="4a48a-170">In this section, we discuss some parameters that users can tune that improve the performance of Hive queries.</span></span> <span data-ttu-id="4a48a-171">Los usuarios necesitan agregar el parámetro que optimiza las consultas antes de las consultas de procesamiento de datos.</span><span class="sxs-lookup"><span data-stu-id="4a48a-171">Users need to add the parameter tuning queries before the queries of processing data.</span></span>

1. <span data-ttu-id="4a48a-172">**Espacio de montón de Java**: para las consultas que implican la combinación de grandes conjuntos de datos, o el procesamiento de largos registros, un error habitual es **quedarse sin espacio en el montón**.</span><span class="sxs-lookup"><span data-stu-id="4a48a-172">**Java heap space**: For queries involving joining large datasets, or processing long records, **running out of heap space** is one of the common error.</span></span> <span data-ttu-id="4a48a-173">Esto se puede ajustar estableciendo los parámetros *mapreduce.map.java.opts* y *mapreduce.task.io.sort.mb* en los valores deseados.</span><span class="sxs-lookup"><span data-stu-id="4a48a-173">This can be tuned by setting parameters *mapreduce.map.java.opts* and *mapreduce.task.io.sort.mb* to desired values.</span></span> <span data-ttu-id="4a48a-174">Aquí tiene un ejemplo:</span><span class="sxs-lookup"><span data-stu-id="4a48a-174">Here is an example:</span></span>
   
        set mapreduce.map.java.opts=-Xmx4096m;
        set mapreduce.task.io.sort.mb=-Xmx1024m;

    <span data-ttu-id="4a48a-175">Este parámetro asigna 4 GB de memoria al espacio de montón de Java y también hace que la ordenación sea más eficiente al asignar más memoria para él.</span><span class="sxs-lookup"><span data-stu-id="4a48a-175">This parameter allocates 4GB memory to Java heap space and also makes sorting more efficient by allocating more memory for it.</span></span> <span data-ttu-id="4a48a-176">Es buena idea jugar con estas asignaciones si no hay ningún error de trabajo relacionado con el espacio en el montón.</span><span class="sxs-lookup"><span data-stu-id="4a48a-176">It is a good idea to play with these allocations if there are any job failure errors related to heap space.</span></span>

1. <span data-ttu-id="4a48a-177">**Tamaño de bloque de DFS** : este parámetro establece la unidad más pequeña de datos que el sistema de archivos almacena.</span><span class="sxs-lookup"><span data-stu-id="4a48a-177">**DFS block size** : This parameter sets the smallest unit of data that the file system stores.</span></span> <span data-ttu-id="4a48a-178">Por ejemplo, si el tamaño de bloque DFS es 128 MB, a continuación, los datos de un tamaño menor que 128 MB, que también será el tamaño máximo, se almacenará en un solo bloque, mientras que a los datos mayores de 128 MB se les asignará bloques adicionales.</span><span class="sxs-lookup"><span data-stu-id="4a48a-178">As an example, if the DFS block size is 128MB, then any data of size less than and up to 128MB is stored in a single block, while data that is larger than 128MB is allotted extra blocks.</span></span> <span data-ttu-id="4a48a-179">Al elegir un tamaño de bloque muy pequeño se producirán grandes sobrecargas en Hadoop puesto que el nodo de nombre tiene que procesar muchas más solicitudes para buscar el bloque relevante relacionado con el archivo.</span><span class="sxs-lookup"><span data-stu-id="4a48a-179">Choosing a very small block size causes large overheads in Hadoop since the name node has to process many more requests to find the relevant block pertaining to the file.</span></span> <span data-ttu-id="4a48a-180">Una configuración recomendada al tratar con datos de gigabytes (o mayores) es:</span><span class="sxs-lookup"><span data-stu-id="4a48a-180">A recommended setting when dealing with gigabytes (or larger) data is :</span></span>
   
        set dfs.block.size=128m;
2. <span data-ttu-id="4a48a-181">**Optimización de la operación de unión en Hive** : Aunque las operaciones de unión en el marco de asignación/reducción suelen tener lugar en la fase de reducción, en ocasiones se pueden obtener ganancias enormes mediante la programación de uniones en la fase de asignación (también denominada "mapjoins").</span><span class="sxs-lookup"><span data-stu-id="4a48a-181">**Optimizing join operation in Hive** : While join operations in the map/reduce framework typically take place in the reduce phase, sometimes, enormous gains can be achieved by scheduling joins in the map phase (also called "mapjoins").</span></span> <span data-ttu-id="4a48a-182">Para indicar al subárbol que haga esto siempre que sea posible, podemos establecer:</span><span class="sxs-lookup"><span data-stu-id="4a48a-182">To direct Hive to do this whenever possible, we can set :</span></span>
   
        set hive.auto.convert.join=true;
3. <span data-ttu-id="4a48a-183">**Especificación del número de asignadores a Hive** : aunque Hadoop permite al usuario establecer el número de reductores, este no suele hacerlo.</span><span class="sxs-lookup"><span data-stu-id="4a48a-183">**Specifying the number of mappers to Hive** : While Hadoop allows the user to set the number of reducers, the number of mappers is typically not be set by the user.</span></span> <span data-ttu-id="4a48a-184">Un truco que permite cierto grado de control sobre este número es elegir las variables de Hadoop, *mapred.min.split.size* y *mapred.max.split.size*, puesto que el tamaño de cada tarea de asignación se determina mediante:</span><span class="sxs-lookup"><span data-stu-id="4a48a-184">A trick that allows some degree of control on this number is to choose the Hadoop variables, *mapred.min.split.size* and *mapred.max.split.size* as the size of each map task is determined by :</span></span>
   
        num_maps = max(mapred.min.split.size, min(mapred.max.split.size, dfs.block.size))
   
    <span data-ttu-id="4a48a-185">Normalmente, el valor predeterminado de *mapred.min.split.size* es 0, el de *mapred.max.split.size* es **Long.MAX** y de *dfs.block.size* es 64 MB.</span><span class="sxs-lookup"><span data-stu-id="4a48a-185">Typically, the default value of *mapred.min.split.size* is 0, that of *mapred.max.split.size* is **Long.MAX** and that of *dfs.block.size* is 64MB.</span></span> <span data-ttu-id="4a48a-186">Como podemos ver, dado el tamaño de los datos, el ajuste de estos parámetros mediante su "configuración" nos permite optimizar el número de asignadores que se usan.</span><span class="sxs-lookup"><span data-stu-id="4a48a-186">As we can see, given the data size, tuning these parameters by "setting" them allows us to tune the number of mappers used.</span></span>
4. <span data-ttu-id="4a48a-187">A continuación se mencionan algunas otras **opciones avanzadas** más para optimizar el rendimiento de Hive.</span><span class="sxs-lookup"><span data-stu-id="4a48a-187">A few other more **advanced options** for optimizing Hive performance are mentioned below.</span></span> <span data-ttu-id="4a48a-188">Estas permiten establecer la memoria asignada para asignar y reducir tareas, y pueden ser útiles para modificar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="4a48a-188">These allow you to set the memory allocated to map and reduce tasks, and can be useful in tweaking performance.</span></span> <span data-ttu-id="4a48a-189">Tenga en cuenta que el valor de *mapreduce.reduce.memory.mb* no puede ser mayor que el tamaño de la memoria física de cada nodo de trabajo del clúster de Hadoop.</span><span class="sxs-lookup"><span data-stu-id="4a48a-189">Please keep in mind that the *mapreduce.reduce.memory.mb* cannot be greater than the physical memory size of each worker node in the Hadoop cluster.</span></span>
   
        set mapreduce.map.memory.mb = 2048;
        set mapreduce.reduce.memory.mb=6144;
        set mapreduce.reduce.java.opts=-Xmx8192m;
        set mapred.reduce.tasks=128;
        set mapred.tasktracker.reduce.tasks.maximum=128;


---
title: "aaaHow toouse administración de API de Azure con redes virtuales"
description: "Obtenga información acerca de cómo toosetup una conexión tooa virtual en administración de API de Azure y acceso web de servicios de red a través de él."
services: api-management
documentationcenter: 
author: antonba
manager: erikre
editor: 
ms.assetid: 64b58f7b-ca22-47dc-89c0-f6bb0af27a48
ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/15/2016
ms.author: apimpm
ms.openlocfilehash: 426b3974e4fed7daffdb0c3f02381edbc326dc28
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="how-toouse-azure-api-management-with-virtual-networks"></a><span data-ttu-id="ac6c6-103">¿Cómo toouse administración de API de Azure con redes virtuales</span><span class="sxs-lookup"><span data-stu-id="ac6c6-103">How toouse Azure API Management with virtual networks</span></span>
<span data-ttu-id="ac6c6-104">Redes virtuales de Azure (Vnet) le permiten tooplace cualquiera de los recursos de Azure en una red de internet no enrutables que controle el acceso a.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-104">Azure Virtual Networks (VNETs) allow you tooplace any of your Azure resources in a non-internet routeable network that you control access to.</span></span> <span data-ttu-id="ac6c6-105">Estas redes se pueden redes locales de tooyour conectado con varias tecnologías VPN.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-105">These networks can then be connected tooyour on-premises networks using various VPN technologies.</span></span> <span data-ttu-id="ac6c6-106">toolearn más sobre las redes virtuales de Azure de inicio con información de hello aquí: [información general de red Virtual de Azure](../virtual-network/virtual-networks-overview.md).</span><span class="sxs-lookup"><span data-stu-id="ac6c6-106">toolearn more about Azure Virtual Networks start with hello information here: [Azure Virtual Network Overview](../virtual-network/virtual-networks-overview.md).</span></span>

<span data-ttu-id="ac6c6-107">Administración de API de Azure se puede implementar dentro de la red virtual de hello (VNET), por lo que pueden tener acceso a servicios de back-end en red de Hola.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-107">Azure API Management can be deployed inside hello virtual network (VNET), so it can access backend services within hello network.</span></span> <span data-ttu-id="ac6c6-108">Hola puerta de enlace de API y portal para desarrolladores, puede ser accesibles desde Internet de Hola o solo dentro de la red virtual de Hola a toobe configurado.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-108">hello developer portal and API gateway, can be configured toobe accessible either from hello Internet or only within hello virtual network.</span></span>

> [!NOTE]
> <span data-ttu-id="ac6c6-109">Azure API Management admite redes virtuales clásicas y de Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-109">Azure API Management supports both classic and Azure Resource Manager VNets.</span></span>
>
>

## <span data-ttu-id="ac6c6-110"><a name="enable-vpn"></a>Habilitar la conexión de VNET</span><span class="sxs-lookup"><span data-stu-id="ac6c6-110"><a name="enable-vpn"> </a>Enable VNET connection</span></span>
> [!NOTE]
> <span data-ttu-id="ac6c6-111">Conectividad de red virtual está disponible en hello **Premium** y **Developer** niveles.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-111">VNET connectivity is available in hello **Premium** and **Developer** tiers.</span></span> <span data-ttu-id="ac6c6-112">tooswitch entre las capas de hello, abra el servicio de administración de API en hello portal de Azure y luego hello **escala y precios** ficha. En hello **tarifa** sección, seleccione el nivel Premium o programador de Hola y haga clic en Guardar.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-112">tooswitch between hello tiers, open your API Management service in hello Azure portal and then open hello **Scale and pricing** tab. Under hello **Pricing tier** section, select hello Premium or Developer tier and click Save.</span></span>
>

<span data-ttu-id="ac6c6-113">conectividad de red virtual tooenable, abra el servicio de administración de API en hello portal de Azure y hello **red Virtual** página.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-113">tooenable VNET connectivity, open your API Management service in hello Azure portal and open hello **Virtual network** page.</span></span>

![Menú Red virtual de API Management][api-management-using-vnet-menu]

<span data-ttu-id="ac6c6-115">Seleccione el tipo de acceso de hello deseado:</span><span class="sxs-lookup"><span data-stu-id="ac6c6-115">Select hello desired access type:</span></span>

* <span data-ttu-id="ac6c6-116">**Externo**: portal de puerta de enlace y el desarrollador de la administración de API de hello son accesibles desde Hola red pública de internet a través de un equilibrador de carga externo.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-116">**External**: hello API Management gateway and developer portal are accessible from hello public internet via an external load balancer.</span></span> <span data-ttu-id="ac6c6-117">puerta de enlace de Hello puede tener acceso a recursos de red virtual de Hola.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-117">hello gateway can access resources within hello virtual network.</span></span>

![Emparejamiento público][api-management-vnet-public]

* <span data-ttu-id="ac6c6-119">**Interno**: portal de puerta de enlace y el desarrollador de la administración de API de hello son accesibles únicamente desde dentro de la red virtual de Hola a través de un equilibrador de carga interno.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-119">**Internal**: hello API Management gateway and developer portal are accessible only from within hello virtual network via an internal load balancer.</span></span> <span data-ttu-id="ac6c6-120">puerta de enlace de Hello puede tener acceso a recursos de red virtual de Hola.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-120">hello gateway can access resources within hello virtual network.</span></span>

![Emparejamiento privado][api-management-vnet-private]

<span data-ttu-id="ac6c6-122">Ahora verá una lista de todas las regiones donde se aprovisiona el servicio Administración de API.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-122">You will now see a list of all regions where your API Management service is provisioned.</span></span> <span data-ttu-id="ac6c6-123">Seleccione una VNET y la subred de cada región.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-123">Select a VNET and subnet for every region.</span></span> <span data-ttu-id="ac6c6-124">Hola lista se rellena con clásico y el Administrador de recursos de redes virtuales disponibles en las suscripciones de Azure que se configuran en la región de Hola que está configurando.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-124">hello list is populated with both classic and Resource Manager virtual networks available in your Azure subscriptions that are setup in hello region you are configuring.</span></span>

> [!NOTE]
> <span data-ttu-id="ac6c6-125">**Extremo de servicio** Hola diagrama anterior incluye puerta de enlace o Proxy, Portal para desarrolladores, Portal para desarrolladores, GIT y Hola punto de conexión de administración directa.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-125">**Service Endpoint** in hello above diagram includes Gateway/Proxy, Publisher Portal, Developer Portal, GIT, and hello Direct Management Endpoint.</span></span>
> <span data-ttu-id="ac6c6-126">**Extremo de administración** en hello diagrama anterior es el extremo de hello hospedada en la configuración del servicio toomanage de Hola a través del portal de Azure y Powershell.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-126">**Management Endpoint** in hello above diagram is hello endpoint hosted on hello service toomanage configuration via Azure portal and Powershell.</span></span>
> <span data-ttu-id="ac6c6-127">Además, tenga en cuenta que, aunque diagrama hello muestra las direcciones IP para sus diversos puntos de conexión, servicio de administración de API **sólo** responde en sus nombres de host configurado.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-127">Also, note, that, even though, hello diagram shows IP Addresses for its various endpoints, API Management service **only** responds on its configured Hostnames.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ac6c6-128">Al implementar un tooa de instancia de administración de API de Azure Resource Manager VNET, servicio de hello debe estar en una subred dedicada que no contiene ningún otro recurso excepto instancias de administración de API de Azure.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-128">When deploying an Azure API Management instance tooa Resource Manager VNET, hello service must be in a dedicated subnet that contains no other resources except for Azure API Management instances.</span></span> <span data-ttu-id="ac6c6-129">Si se realiza un intento de toodeploy un tooa de instancia de la administración de API de Azure subred VNET el Administrador de recursos que contiene otros recursos, la implementación de Hola se producirá un error.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-129">If an attempt is made toodeploy an Azure API Management instance tooa Resource Manager VNET subnet that contains other resources, hello deployment will fail.</span></span>
>
>

![Selección de una VPN][api-management-setup-vpn-select]

<span data-ttu-id="ac6c6-131">Haga clic en **guardar** en la parte superior de Hola de pantalla de bienvenida.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-131">Click **Save** at hello top of hello screen.</span></span>

> [!NOTE]
> <span data-ttu-id="ac6c6-132">Hola dirección VIP de la instancia de la administración de API de hello cambiará cada vez que red virtual está habilitada o deshabilitada.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-132">hello VIP address of hello API Management instance will change each time VNET is enabled or disabled.</span></span>  
> <span data-ttu-id="ac6c6-133">Hola dirección VIP también cambia cuando se mueve la administración de API de **externo** demasiado**interno** o viceversa</span><span class="sxs-lookup"><span data-stu-id="ac6c6-133">hello VIP address will also change when API Management is moved from **External** too**Internal** or vice-versa</span></span>
>


> [!IMPORTANT]
> <span data-ttu-id="ac6c6-134">Si quita API de administración de una red virtual o cambiar Hola uno se implementa en, Hola red virtual usada anteriormente puede permanecer bloqueado para too4 horas.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-134">If you remove API Management from a VNET or change hello one it is deployed in, hello previously used VNET can remain locked for up too4 hours.</span></span> <span data-ttu-id="ac6c6-135">Durante este periodo no se toodelete posibles Hola red virtual o implementar una nueva tooit de recursos.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-135">During this period it will not be possible toodelete hello VNET or deploy a new resource tooit.</span></span>

## <span data-ttu-id="ac6c6-136"><a name="enable-vnet-powershell"></a>Habilitar una conexión de VNET con cmdlets de PowerShell</span><span class="sxs-lookup"><span data-stu-id="ac6c6-136"><a name="enable-vnet-powershell"> </a>Enable VNET connection using PowerShell cmdlets</span></span>
<span data-ttu-id="ac6c6-137">También puede habilitar la conectividad de red virtual con los cmdlets de PowerShell de Hola</span><span class="sxs-lookup"><span data-stu-id="ac6c6-137">You can also enable VNET connectivity using hello PowerShell cmdlets</span></span>

* <span data-ttu-id="ac6c6-138">**Crear un servicio de administración de API dentro de una red virtual**: usar el cmdlet de hello [New-AzureRmApiManagement](/powershell/module/azurerm.apimanagement/new-azurermapimanagement) toocreate un servicio de administración de API de Azure dentro de una red virtual.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-138">**Create an API Management service inside a VNET**: Use hello cmdlet [New-AzureRmApiManagement](/powershell/module/azurerm.apimanagement/new-azurermapimanagement) toocreate an Azure API Management service inside a VNET.</span></span>

* <span data-ttu-id="ac6c6-139">**Implementar un servicio de administración de API existente dentro de una red virtual**: usar el cmdlet de hello [AzureRmApiManagementDeployment actualización](/powershell/module/azurerm.apimanagement/update-azurermapimanagementdeployment) toomove un servicio de administración de API de Azure existente dentro de una red Virtual.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-139">**Deploy an existing API Management service inside a VNET**: Use hello cmdlet [Update-AzureRmApiManagementDeployment](/powershell/module/azurerm.apimanagement/update-azurermapimanagementdeployment) toomove an existing Azure API Management service inside a Virtual Network.</span></span>

## <span data-ttu-id="ac6c6-140"><a name="connect-vnet"></a>Conectar tooa web servicio hospedado en una red virtual</span><span class="sxs-lookup"><span data-stu-id="ac6c6-140"><a name="connect-vnet"> </a>Connect tooa web service hosted within a virtual Network</span></span>
<span data-ttu-id="ac6c6-141">Después de que el servicio de administración de API es conectado toohello red virtual, acceso a los servicios back-end en él es similar a obtener acceso a servicios públicos.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-141">After your API Management service is connected toohello VNET, accessing backend services within it is no different than accessing public services.</span></span> <span data-ttu-id="ac6c6-142">Solo tiene que escribir la dirección IP local Hola o nombre de host de hello (si un servidor DNS está configurado para la red virtual de hello) del servicio web en hello **dirección URL del servicio Web** campo cuando se crea una nueva API o editar una existente.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-142">Just type in hello local IP address or hello host name (if a DNS server is configured for hello VNET) of your web service into hello **Web service URL** field when creating a new API or editing an existing one.</span></span>

![Agregar una API desde VPN][api-management-setup-vpn-add-api]

## <span data-ttu-id="ac6c6-144"><a name="network-configuration-issues"></a>Problemas comunes de configuración de red</span><span class="sxs-lookup"><span data-stu-id="ac6c6-144"><a name="network-configuration-issues"> </a>Common Network Configuration Issues</span></span>
<span data-ttu-id="ac6c6-145">A continuación se muestra una lista de problemas de errores de configuración comunes que pueden producirse al implementar el servicio de API Management en una red virtual.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-145">Following is a list of common misconfiguration issues that can occur while deploying API Management service into a Virtual Network.</span></span>

* <span data-ttu-id="ac6c6-146">**Configuración del servidor DNS personalizado**: Hola servicio de administración de API depende de varios servicios de Azure.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-146">**Custom DNS server setup**: hello API Management service depends on several Azure services.</span></span> <span data-ttu-id="ac6c6-147">Cuando Administración de API se hospeda en una red virtual con un servidor DNS personalizado, necesita los nombres de host hello tooresolve de los servicios de Azure.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-147">When API Management is hosted in a VNET with a custom DNS server, it needs tooresolve hello hostnames of those Azure services.</span></span> <span data-ttu-id="ac6c6-148">Siga [estas](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) instrucciones sobre la configuración de DNS personalizado.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-148">Please follow [this](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) guidance on custom DNS setup.</span></span> <span data-ttu-id="ac6c6-149">Consulte la siguiente tabla de puertos de Hola y otros requisitos de red para referencia.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-149">See hello ports table below and other network requirements for reference.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ac6c6-150">Se recomienda que, si usa un servidor de DNS personalizado para hello red virtual, configure que **antes de** la implementación de un servicio de administración de API en él.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-150">It is recommended that, if you are using a Custom DNS Server(s) for hello VNET, you set that up **before** deploying an API Management service into it.</span></span> <span data-ttu-id="ac6c6-151">De lo contrario se necesita demasiado Actualizar servicio de administración de API de Hola cada vez que cambie los servidores DNS hello (s) mediante la ejecución de hello [aplicar la operación de configuración de red](https://docs.microsoft.com/en-us/rest/api/apimanagement/apimanagementservice#ApiManagementService_ApplyNetworkConfigurationUpdates)</span><span class="sxs-lookup"><span data-stu-id="ac6c6-151">Otherwise you need too update hello API Management service each time you change hello DNS Servers(s) by running hello [Apply Network Configuration Operation](https://docs.microsoft.com/en-us/rest/api/apimanagement/apimanagementservice#ApiManagementService_ApplyNetworkConfigurationUpdates)</span></span>

* <span data-ttu-id="ac6c6-152">**Puertos necesarios para la administración de API**: tráfico entrante y saliente en la subred de hello en el que se implementa la administración de API puede controlarse mediante [grupo de seguridad de red][Network Security Group].</span><span class="sxs-lookup"><span data-stu-id="ac6c6-152">**Ports required for API Management**: Inbound and Outbound traffic into hello Subnet in which API Management is deployed can be controlled using [Network Security Group][Network Security Group].</span></span> <span data-ttu-id="ac6c6-153">Si alguno de estos puertos no está disponible, es posible que API Management no funcione correctamente y sea inaccesible.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-153">If any of these ports are unavailable, API Management may not operate properly and may become inaccessible.</span></span> <span data-ttu-id="ac6c6-154">Tener bloqueados uno o varios de estos puertos es otro problema común de una configuración incorrecta cuando se usa API Management con una red virtual.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-154">Having one or more of these ports blocked is another common misconfiguration issue when using API Management with a VNET.</span></span>

<span data-ttu-id="ac6c6-155">Cuando una instancia de servicio de administración de API se hospeda en una red virtual, se utilizan puertos de hello en hello en la tabla siguiente.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-155">When an API Management service instance is hosted in a VNET, hello ports in hello following table are used.</span></span>

| <span data-ttu-id="ac6c6-156">Puertos de origen/destino</span><span class="sxs-lookup"><span data-stu-id="ac6c6-156">Source / Destination Port(s)</span></span> | <span data-ttu-id="ac6c6-157">Dirección</span><span class="sxs-lookup"><span data-stu-id="ac6c6-157">Direction</span></span> | <span data-ttu-id="ac6c6-158">Protocolo de transporte</span><span class="sxs-lookup"><span data-stu-id="ac6c6-158">Transport protocol</span></span> | <span data-ttu-id="ac6c6-159">Propósito</span><span class="sxs-lookup"><span data-stu-id="ac6c6-159">Purpose</span></span> | <span data-ttu-id="ac6c6-160">Origen/destino</span><span class="sxs-lookup"><span data-stu-id="ac6c6-160">Source / Destination</span></span> | <span data-ttu-id="ac6c6-161">Tipo de acceso</span><span class="sxs-lookup"><span data-stu-id="ac6c6-161">Access type</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="ac6c6-162">* / 80, 443</span><span class="sxs-lookup"><span data-stu-id="ac6c6-162">* / 80, 443</span></span> |<span data-ttu-id="ac6c6-163">Entrada</span><span class="sxs-lookup"><span data-stu-id="ac6c6-163">Inbound</span></span> |<span data-ttu-id="ac6c6-164">TCP</span><span class="sxs-lookup"><span data-stu-id="ac6c6-164">TCP</span></span> |<span data-ttu-id="ac6c6-165">TooAPI de comunicación de cliente Administración</span><span class="sxs-lookup"><span data-stu-id="ac6c6-165">Client communication tooAPI Management</span></span> |<span data-ttu-id="ac6c6-166">INTERNET/VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="ac6c6-166">INTERNET / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="ac6c6-167">Externo</span><span class="sxs-lookup"><span data-stu-id="ac6c6-167">External</span></span> |
| <span data-ttu-id="ac6c6-168">* / 3443</span><span class="sxs-lookup"><span data-stu-id="ac6c6-168">* / 3443</span></span> |<span data-ttu-id="ac6c6-169">Entrada</span><span class="sxs-lookup"><span data-stu-id="ac6c6-169">Inbound</span></span> |<span data-ttu-id="ac6c6-170">TCP</span><span class="sxs-lookup"><span data-stu-id="ac6c6-170">TCP</span></span> |<span data-ttu-id="ac6c6-171">Punto de conexión de administración para Azure Portal y Powershell</span><span class="sxs-lookup"><span data-stu-id="ac6c6-171">Management endpoint for Azure portal and Powershell</span></span> |<span data-ttu-id="ac6c6-172">INTERNET/VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="ac6c6-172">INTERNET / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="ac6c6-173">Externa e interna</span><span class="sxs-lookup"><span data-stu-id="ac6c6-173">External & Internal</span></span> |
| <span data-ttu-id="ac6c6-174">* / 80, 443</span><span class="sxs-lookup"><span data-stu-id="ac6c6-174">* / 80, 443</span></span> |<span data-ttu-id="ac6c6-175">Salida</span><span class="sxs-lookup"><span data-stu-id="ac6c6-175">Outbound</span></span> |<span data-ttu-id="ac6c6-176">TCP</span><span class="sxs-lookup"><span data-stu-id="ac6c6-176">TCP</span></span> |<span data-ttu-id="ac6c6-177">Dependencia en Azure Storage y Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="ac6c6-177">Dependency on Azure Storage and Azure Service Bus</span></span> |<span data-ttu-id="ac6c6-178">VIRTUAL_NETWORK/INTERNET</span><span class="sxs-lookup"><span data-stu-id="ac6c6-178">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="ac6c6-179">Externa e interna</span><span class="sxs-lookup"><span data-stu-id="ac6c6-179">External & Internal</span></span> |
| <span data-ttu-id="ac6c6-180">* / 1433</span><span class="sxs-lookup"><span data-stu-id="ac6c6-180">* / 1433</span></span> |<span data-ttu-id="ac6c6-181">Salida</span><span class="sxs-lookup"><span data-stu-id="ac6c6-181">Outbound</span></span> |<span data-ttu-id="ac6c6-182">TCP</span><span class="sxs-lookup"><span data-stu-id="ac6c6-182">TCP</span></span> |<span data-ttu-id="ac6c6-183">Dependencia de Azure SQL</span><span class="sxs-lookup"><span data-stu-id="ac6c6-183">Dependency on Azure SQL</span></span> |<span data-ttu-id="ac6c6-184">VIRTUAL_NETWORK/INTERNET</span><span class="sxs-lookup"><span data-stu-id="ac6c6-184">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="ac6c6-185">Externa e interna</span><span class="sxs-lookup"><span data-stu-id="ac6c6-185">External & Internal</span></span> |
| <span data-ttu-id="ac6c6-186">* / 11000 - 11999</span><span class="sxs-lookup"><span data-stu-id="ac6c6-186">* / 11000 - 11999</span></span> |<span data-ttu-id="ac6c6-187">Salida</span><span class="sxs-lookup"><span data-stu-id="ac6c6-187">Outbound</span></span> |<span data-ttu-id="ac6c6-188">TCP</span><span class="sxs-lookup"><span data-stu-id="ac6c6-188">TCP</span></span> |<span data-ttu-id="ac6c6-189">Dependencia de Azure SQL V12</span><span class="sxs-lookup"><span data-stu-id="ac6c6-189">Dependency on Azure SQL V12</span></span> |<span data-ttu-id="ac6c6-190">VIRTUAL_NETWORK/INTERNET</span><span class="sxs-lookup"><span data-stu-id="ac6c6-190">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="ac6c6-191">Externa e interna</span><span class="sxs-lookup"><span data-stu-id="ac6c6-191">External & Internal</span></span> |
| <span data-ttu-id="ac6c6-192">* / 14000 - 14999</span><span class="sxs-lookup"><span data-stu-id="ac6c6-192">* / 14000 - 14999</span></span> |<span data-ttu-id="ac6c6-193">Salida</span><span class="sxs-lookup"><span data-stu-id="ac6c6-193">Outbound</span></span> |<span data-ttu-id="ac6c6-194">TCP</span><span class="sxs-lookup"><span data-stu-id="ac6c6-194">TCP</span></span> |<span data-ttu-id="ac6c6-195">Dependencia de Azure SQL V12</span><span class="sxs-lookup"><span data-stu-id="ac6c6-195">Dependency on Azure SQL V12</span></span> |<span data-ttu-id="ac6c6-196">VIRTUAL_NETWORK/INTERNET</span><span class="sxs-lookup"><span data-stu-id="ac6c6-196">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="ac6c6-197">Externa e interna</span><span class="sxs-lookup"><span data-stu-id="ac6c6-197">External & Internal</span></span> |
| <span data-ttu-id="ac6c6-198">* / 5671</span><span class="sxs-lookup"><span data-stu-id="ac6c6-198">* / 5671</span></span> |<span data-ttu-id="ac6c6-199">Salida</span><span class="sxs-lookup"><span data-stu-id="ac6c6-199">Outbound</span></span> |<span data-ttu-id="ac6c6-200">AMQP</span><span class="sxs-lookup"><span data-stu-id="ac6c6-200">AMQP</span></span> |<span data-ttu-id="ac6c6-201">Dependencia de directiva de base de datos central de registro tooEvent y agente de supervisión</span><span class="sxs-lookup"><span data-stu-id="ac6c6-201">Dependency for Log tooEvent Hub policy and monitoring agent</span></span> |<span data-ttu-id="ac6c6-202">VIRTUAL_NETWORK/INTERNET</span><span class="sxs-lookup"><span data-stu-id="ac6c6-202">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="ac6c6-203">Externa e interna</span><span class="sxs-lookup"><span data-stu-id="ac6c6-203">External & Internal</span></span> |
| <span data-ttu-id="ac6c6-204">6381 - 6383 / 6381 - 6383</span><span class="sxs-lookup"><span data-stu-id="ac6c6-204">6381 - 6383 / 6381 - 6383</span></span> |<span data-ttu-id="ac6c6-205">Entrada y salida</span><span class="sxs-lookup"><span data-stu-id="ac6c6-205">Inbound & Outbound</span></span> |<span data-ttu-id="ac6c6-206">UDP</span><span class="sxs-lookup"><span data-stu-id="ac6c6-206">UDP</span></span> |<span data-ttu-id="ac6c6-207">Dependencia de Redis Cache</span><span class="sxs-lookup"><span data-stu-id="ac6c6-207">Dependency on Redis Cache</span></span> |<span data-ttu-id="ac6c6-208">VIRTUAL_NETWORK/VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="ac6c6-208">VIRTUAL_NETWORK / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="ac6c6-209">Externa e interna</span><span class="sxs-lookup"><span data-stu-id="ac6c6-209">External & Internal</span></span> |-
| <span data-ttu-id="ac6c6-210">* / 445</span><span class="sxs-lookup"><span data-stu-id="ac6c6-210">* / 445</span></span> |<span data-ttu-id="ac6c6-211">Salida</span><span class="sxs-lookup"><span data-stu-id="ac6c6-211">Outbound</span></span> |<span data-ttu-id="ac6c6-212">TCP</span><span class="sxs-lookup"><span data-stu-id="ac6c6-212">TCP</span></span> |<span data-ttu-id="ac6c6-213">Dependencia del recurso compartido de archivos de Azure para Git</span><span class="sxs-lookup"><span data-stu-id="ac6c6-213">Dependency on Azure File Share for GIT</span></span> |<span data-ttu-id="ac6c6-214">VIRTUAL_NETWORK/INTERNET</span><span class="sxs-lookup"><span data-stu-id="ac6c6-214">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="ac6c6-215">Externa e interna</span><span class="sxs-lookup"><span data-stu-id="ac6c6-215">External & Internal</span></span> |
| <span data-ttu-id="ac6c6-216">* / *</span><span class="sxs-lookup"><span data-stu-id="ac6c6-216">* / *</span></span> | <span data-ttu-id="ac6c6-217">Entrada</span><span class="sxs-lookup"><span data-stu-id="ac6c6-217">Inbound</span></span> |<span data-ttu-id="ac6c6-218">TCP</span><span class="sxs-lookup"><span data-stu-id="ac6c6-218">TCP</span></span> |<span data-ttu-id="ac6c6-219">Equilibrador de carga de la infraestructura de Azure</span><span class="sxs-lookup"><span data-stu-id="ac6c6-219">Azure Infrastructure Load Balancer</span></span> | <span data-ttu-id="ac6c6-220">AZURE_LOAD_BALANCER / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="ac6c6-220">AZURE_LOAD_BALANCER / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="ac6c6-221">Externa e interna</span><span class="sxs-lookup"><span data-stu-id="ac6c6-221">External & Internal</span></span> |

* <span data-ttu-id="ac6c6-222">**Funcionalidad SSL**: certificado SSL de tooenable servicio de administración de API de Hola de generación y validación de cadena debe tooocsp.msocsp.com de conectividad de red saliente, mscrl.microsoft.com y crl.microsoft.com. Esta dependencia no es obligatoria, si cualquier certificado que cargue tooAPI administración contiene toohello entidad emisora de certificados raíz de hello cadena completa.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-222">**SSL functionality**: tooenable SSL certificate chain building and validation hello API Management service needs Outbound network connectivity tooocsp.msocsp.com, mscrl.microsoft.com and crl.microsoft.com. This dependency is not required, if any certificate you upload tooAPI Management contain hello full chain toohello CA root.</span></span>

* <span data-ttu-id="ac6c6-223">**Acceso de DNS**: se requiere acceso saliente en el puerto 53 para establecer la comunicación con los servidores DNS.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-223">**DNS Access**: Outbound access on port 53 is required for communication with DNS servers.</span></span> <span data-ttu-id="ac6c6-224">Si existe un servidor DNS personalizado en hello otro extremo de una puerta de enlace VPN, servidor DNS de hello debe ser accesible desde la subred de hello administración de API de hospedaje.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-224">If a custom DNS server exists on hello other end of a VPN gateway, hello DNS server must be reachable from hello subnet hosting API Management.</span></span>

* <span data-ttu-id="ac6c6-225">**Supervisión de estado y las métricas**: extremos supervisión de red saliente conectividad tooAzure, que resolver en hello después dominios: global.metrics.nsatc.net, shoebox2.metrics.nsatc.net, prod3.metrics.nsatc.net.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-225">**Metrics and Health Monitoring**: Outbound network connectivity tooAzure Monitoring endpoints, which resolve under hello following domains: global.metrics.nsatc.net, shoebox2.metrics.nsatc.net, prod3.metrics.nsatc.net.</span></span>

* <span data-ttu-id="ac6c6-226">**Configuración de ruta rápida**: una configuración de cliente común es toodefine su propia ruta predeterminada (0.0.0.0/0), que fuerza la salida Internet tráfico tooinstead flujo local.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-226">**Express Route Setup**: A common customer configuration is toodefine their own default route (0.0.0.0/0) which forces outbound Internet traffic tooinstead flow on-premises.</span></span> <span data-ttu-id="ac6c6-227">Este flujo de tráfico invariable, interrumpe la conectividad con la administración de API de Azure porque el tráfico saliente Hola está bloqueado de forma local o NAT con el conjunto irreconocible tooan de direcciones que ya no funcionan con varios extremos de Azure.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-227">This traffic flow invariably breaks connectivity with Azure API Management because hello outbound traffic is either blocked on-premises, or NAT'd tooan unrecognizable set of addresses that no longer work with various Azure endpoints.</span></span> <span data-ttu-id="ac6c6-228">solución Hello es toodefine uno (o más) definido por el usuario rutas ([UDRs][UDRs]) en la subred Hola que contiene Hola administración de API de Azure.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-228">hello solution is toodefine one (or more) user-defined routes ([UDRs][UDRs]) on hello subnet that contains hello Azure API Management.</span></span> <span data-ttu-id="ac6c6-229">Un UDR define las rutas de subred específica que se respetará en lugar de la ruta predeterminada de Hola.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-229">A UDR defines subnet-specific routes that will be honored instead of hello default route.</span></span>
  <span data-ttu-id="ac6c6-230">Si es posible, se recomienda hello toouse siguiente configuración:</span><span class="sxs-lookup"><span data-stu-id="ac6c6-230">If possible, it is recommended toouse hello following configuration:</span></span>
 * <span data-ttu-id="ac6c6-231">configuración de ExpressRoute de Hello anuncia 0.0.0.0/0 y de forma predeterminada force túneles todo el tráfico saliente en local.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-231">hello ExpressRoute configuration advertises 0.0.0.0/0 and by default force tunnels all outbound traffic on-premises.</span></span>
 * <span data-ttu-id="ac6c6-232">Hola UDR aplica toohello subred que contiene Hola administración de API de Azure define 0.0.0.0/0 con un tipo de próximo salto de Internet.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-232">hello UDR applied toohello subnet containing hello Azure API Management defines 0.0.0.0/0 with a next hop type of Internet.</span></span>
 <span data-ttu-id="ac6c6-233">Hola efecto combinado de estos pasos es que el nivel de subred de hello UDR tiene precedencia sobre hello ExpressRoute forzado túnel, lo que garantiza el acceso a Internet saliente desde Hola administración de API de Azure.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-233">hello combined effect of these steps is that hello subnet level UDR takes precedence over hello ExpressRoute forced tunneling, thus ensuring outbound Internet access from hello Azure API Management.</span></span>

>[!WARNING]  
><span data-ttu-id="ac6c6-234">Administración de API de Azure no es compatible con configuraciones de ExpressRoute que **incorrectamente entre-anunciar rutas de hello pública emparejamiento toohello privada emparejamiento ruta de acceso**.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-234">Azure API Management is not supported with ExpressRoute configurations that **incorrectly cross-advertise routes from hello public peering path toohello private peering path**.</span></span> <span data-ttu-id="ac6c6-235">Las configuraciones de ExpressRoute con el emparejamiento público configurado recibirán anuncios de ruta de Microsoft para un amplio conjunto de intervalos de direcciones IP de Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-235">ExpressRoute configurations that have public peering configured, will receive route advertisements from Microsoft for a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="ac6c6-236">Si estos intervalos de direcciones se publicita entre incorrectamente en la ruta de intercambio de tráfico privado hello, obteniéndose hello es que todos los paquetes de red saliente de la subred de la instancia de administración de API de Azure de hello son red de local del cliente tooa incorrectamente un túnel forzado infraestructura.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-236">If these address ranges are incorrectly cross-advertised on hello private peering path, hello end result is that all outbound network packets from hello Azure API Management instance's subnet are incorrectly force-tunneled tooa customer's on-premises network infrastructure.</span></span> <span data-ttu-id="ac6c6-237">Este flujo de red interrumpe Azure API Management.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-237">This network flow breaks Azure API Management.</span></span> <span data-ttu-id="ac6c6-238">problema de Hello solución toothis es toostop rutas de entre anuncios de Hola pública emparejamiento toohello privada emparejamiento ruta de acceso.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-238">hello solution toothis problem is toostop cross-advertising routes from hello public peering path toohello private peering path.</span></span>


## <span data-ttu-id="ac6c6-239"><a name="troubleshooting"></a>Solución de problemas</span><span class="sxs-lookup"><span data-stu-id="ac6c6-239"><a name="troubleshooting"> </a>Troubleshooting</span></span>
<span data-ttu-id="ac6c6-240">Al realizar la red de tooyour de cambios, consulte demasiado[NetworkStatus API](https://docs.microsoft.com/en-us/rest/api/apimanagement/networkstatus), toovalidate si Hola servicio de administración de API no ha perdido tooany de acceso del programa Hola a recursos críticos que depende de.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-240">When making changes tooyour network, refer too[NetworkStatus API](https://docs.microsoft.com/en-us/rest/api/apimanagement/networkstatus), toovalidate if hello API Management service has not lost access tooany of hello critical resources which it depends upon.</span></span> <span data-ttu-id="ac6c6-241">estado de conectividad de Hello debe actualizarse cada 15 minutos.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-241">hello connectivity status should be updated every 15 minutes.</span></span>

## <span data-ttu-id="ac6c6-242"><a name="limitations"></a>Limitaciones</span><span class="sxs-lookup"><span data-stu-id="ac6c6-242"><a name="limitations"> </a>Limitations</span></span>
* <span data-ttu-id="ac6c6-243">Una subred que contenga instancias de API Management no puede contener otros tipos de recursos de Azure.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-243">A subnet containing API Management instances cannot contain any other Azure resource types.</span></span>
* <span data-ttu-id="ac6c6-244">subred de Hola y Hola administración de API de servicio debe estar en Hola misma suscripción.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-244">hello subnet and hello API Management service must be in hello same subscription.</span></span>
* <span data-ttu-id="ac6c6-245">Una subred que contenga instancias de API Management no se puede mover a otras suscripciones.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-245">A subnet containing API Management instances cannot be moved across subscriptions.</span></span>
* <span data-ttu-id="ac6c6-246">Cuando se usa una red virtual interna, solo estará disponible en una dirección IP interna intervalo Hola estipulados en [RFC 1918](https://tools.ietf.org/html/rfc1918), no se puede proporcionar una dirección IP pública.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-246">When using an internal virtual network, only an internal IP address will be available from hello range stated in [RFC 1918](https://tools.ietf.org/html/rfc1918), a public IP address cannot be provided.</span></span>
* <span data-ttu-id="ac6c6-247">Para las implementaciones de administración de API de varias regiones, con las redes virtuales internas configuradas, los usuarios son responsables de administrar su propias como poseen Hola DNS de equilibrio de carga.</span><span class="sxs-lookup"><span data-stu-id="ac6c6-247">For multi-region API Management deployments, with Internal virtual networks configured, users are responsible for managing their own load balancing as they own hello DNS.</span></span>


## <span data-ttu-id="ac6c6-248"><a name="related-content"></a>Contenido relacionado</span><span class="sxs-lookup"><span data-stu-id="ac6c6-248"><a name="related-content"> </a>Related content</span></span>
* [<span data-ttu-id="ac6c6-249">Conectar un toobackend de red Virtual con la puerta de enlace Vpn</span><span class="sxs-lookup"><span data-stu-id="ac6c6-249">Connecting a Virtual Network toobackend using Vpn Gateway</span></span>](../vpn-gateway/vpn-gateway-about-vpngateways.md#s2smulti)
* [<span data-ttu-id="ac6c6-250">Conexión a una red virtual a partir de diferentes modelos de implementación</span><span class="sxs-lookup"><span data-stu-id="ac6c6-250">Connecting a Virtual Network from different deployment models</span></span>](../vpn-gateway/vpn-gateway-connect-different-deployment-models-powershell.md)
* [<span data-ttu-id="ac6c6-251">Cómo llama a toouse hello tootrace API Inspector de administración de API de Azure</span><span class="sxs-lookup"><span data-stu-id="ac6c6-251">How toouse hello API Inspector tootrace calls in Azure API Management</span></span>](api-management-howto-api-inspector.md)

[api-management-using-vnet-menu]: ./media/api-management-using-with-vnet/api-management-menu-vnet.png
[api-management-setup-vpn-select]: ./media/api-management-using-with-vnet/api-management-using-vnet-type.png
[api-management-setup-vpn-select]: ./media/api-management-using-with-vnet/api-management-using-vnet-select.png
[api-management-setup-vpn-add-api]: ./media/api-management-using-with-vnet/api-management-using-vnet-add-api.png
[api-management-vnet-private]: ./media/api-management-using-with-vnet/api-management-vnet-private.png
[api-management-vnet-public]: ./media/api-management-using-with-vnet/api-management-vnet-public.png

[Enable VPN connections]: #enable-vpn
[Connect tooa web service behind VPN]: #connect-vpn
[Related content]: #related-content

[UDRs]: ../virtual-network/virtual-networks-udr-overview.md
[Network Security Group]: ../virtual-network/virtual-networks-nsg.md

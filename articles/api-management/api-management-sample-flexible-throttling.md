---
title: "solicitud de aaaAdvanced limitación con administración de API de Azure"
description: "Obtenga información acerca de cómo toocreate y aplicar una cuota flexible y las directivas de administración de API de Azure de limitación de velocidad."
services: api-management
documentationcenter: 
author: darrelmiller
manager: erikre
editor: 
ms.assetid: fc813a65-7793-4c17-8bb9-e387838193ae
ms.service: api-management
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 12/15/2016
ms.author: apimpm
ms.openlocfilehash: ac87f83118a37bd587fddf044e5c2d6fc2af9031
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="advanced-request-throttling-with-azure-api-management"></a><span data-ttu-id="5cf4d-103">Limitación avanzada de solicitudes con Administración de API de Azure</span><span class="sxs-lookup"><span data-stu-id="5cf4d-103">Advanced request throttling with Azure API Management</span></span>
<span data-ttu-id="5cf4d-104">Ser capaz de toothrottle las solicitudes entrantes es una función clave de administración de API de Azure.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-104">Being able toothrottle incoming requests is a key role of Azure API Management.</span></span> <span data-ttu-id="5cf4d-105">Ya sea mediante la tasa de hello control de solicitudes u Hola total de solicitudes/datos transferidos, administración de API permite API proveedores tooprotect sus API de abuso y crear el valor de distintos niveles de producto de API.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-105">Either by controlling hello rate of requests or hello total requests/data transferred, API Management allows API providers tooprotect their APIs from abuse and create value for different API product tiers.</span></span>

## <a name="product-based-throttling"></a><span data-ttu-id="5cf4d-106">Limitación por producto</span><span class="sxs-lookup"><span data-stu-id="5cf4d-106">Product based throttling</span></span>
<span data-ttu-id="5cf4d-107">toodate, las capacidades de limitación de velocidad de hello ha sido limitado toobeing ámbito tooa determinado producto suscripción (básicamente una clave), se definen en hello portal para desarrolladores de administración de API.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-107">toodate, hello rate throttling capabilities have been limited toobeing scoped tooa particular Product subscription (essentially a key), defined in hello API Management publisher portal.</span></span> <span data-ttu-id="5cf4d-108">Esto es útil para los límites de tooapply de proveedor de API de hello en los programadores de Hola que se suscribieron toouse su API, sin embargo, no ayuda, por ejemplo, en el límite de usuarios finales individuales de hello API.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-108">This is useful for hello API provider tooapply limits on hello developers who have signed up toouse their API, however, it does not help, for example, in throttling individual end-users of hello API.</span></span> <span data-ttu-id="5cf4d-109">Es posible que el único usuario de tooconsume de aplicación del desarrollador de Hola Hola cuota todo y, a continuación, impedir que otros clientes de desarrollador de hello toouse capaz de aplicación de hello.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-109">It is possible that for single user of hello developer's application tooconsume hello entire quota and then prevent other customers of hello developer from being able toouse hello application.</span></span> <span data-ttu-id="5cf4d-110">Además, varios clientes que podrían generar un gran volumen de solicitudes pueden limitar a los usuarios de acceso toooccasional.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-110">Also, several customers who might generate a high volume of requests may limit access toooccasional users.</span></span>

## <a name="custom-key-based-throttling"></a><span data-ttu-id="5cf4d-111">Limitación por clave personalizada</span><span class="sxs-lookup"><span data-stu-id="5cf4d-111">Custom key based throttling</span></span>
<span data-ttu-id="5cf4d-112">Hola nueva [límite de velocidad por clave](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRateByKey) y [cuota por clave](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuotaByKey) las directivas proporcionan un control de tootraffic solución significativamente más flexible.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-112">hello new [rate-limit-by-key](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRateByKey) and [quota-by-key](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuotaByKey) policies provide a significantly more flexible solution tootraffic control.</span></span> <span data-ttu-id="5cf4d-113">Estas nuevas directivas le permiten toodefine expresiones tooidentify hello las claves que serán usado tootrack uso del tráfico.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-113">These new policies allow you toodefine expressions tooidentify hello keys that will be used tootrack traffic usage.</span></span> <span data-ttu-id="5cf4d-114">Hola funcionamiento Esto se ilustra lo más sencillo con un ejemplo.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-114">hello way this works is easiest illustrated with an example.</span></span> 

## <a name="ip-address-throttling"></a><span data-ttu-id="5cf4d-115">Limitación por dirección IP</span><span class="sxs-lookup"><span data-stu-id="5cf4d-115">IP Address throttling</span></span>
<span data-ttu-id="5cf4d-116">las siguientes directivas Hello restringen un único cliente IP dirección tooonly 10 llama a cada minuto, con un total de 1.000.000 llamadas y 10.000 kilobytes de ancho de banda al mes.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-116">hello following policies restrict a single client IP address tooonly 10 calls every minute, with a total of 1,000,000 calls and 10,000 kilobytes of bandwidth per month.</span></span> 

```xml
<rate-limit-by-key  calls="10"
          renewal-period="60"
          counter-key="@(context.Request.IpAddress)" />

<quota-by-key calls="1000000"
          bandwidth="10000"
          renewal-period="2629800"
          counter-key="@(context.Request.IpAddress)" />
```

<span data-ttu-id="5cf4d-117">Si todos los clientes en Internet de hello usan una dirección IP única, podría tratarse de una manera eficaz para limitar el uso por el usuario.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-117">If all clients on hello Internet used a unique IP address, this might be an effective way of limiting usage by user.</span></span> <span data-ttu-id="5cf4d-118">Sin embargo, es bastante probable que varios usuarios compartir una única dirección IP pública debido toothem Hola acceso a Internet a través de un dispositivo NAT.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-118">However, it is quite likely that multiple users will sharing a single public IP address due toothem accessing hello Internet via a NAT device.</span></span> <span data-ttu-id="5cf4d-119">A pesar de ello, para las API que permiten Hola de acceso no autenticado `IpAddress` podría ser mejor opción de Hola.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-119">Despite this, for APIs that allow unauthenticated access hello `IpAddress` might be hello best option.</span></span>

## <a name="user-identity-throttling"></a><span data-ttu-id="5cf4d-120">Limitación por identidad de usuario</span><span class="sxs-lookup"><span data-stu-id="5cf4d-120">User identity throttling</span></span>
<span data-ttu-id="5cf4d-121">Si se autentica un usuario final, puede generarse una clave de limitación basada en información que identifica de forma única a ese usuario.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-121">If an end user is authenticated then a throttling key can be generated based on information that uniquely identifies an that user.</span></span>

```xml
<rate-limit-by-key calls="10"
    renewal-period="60"
    counter-key="@(context.Request.Headers.GetValueOrDefault("Authorization","").AsJwt()?.Subject)" />
```

<span data-ttu-id="5cf4d-122">En este ejemplo se extraer el encabezado de autorización de hello, conviértala demasiado`JWT` objeto y usar asunto Hola del usuario de hello tooidentify token hello y usarla como clave de limitación de la tasa de Hola.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-122">In this example we extract hello Authorization header, convert it too`JWT` object and use hello subject of hello token tooidentify hello user and use that as hello rate limiting key.</span></span> <span data-ttu-id="5cf4d-123">Si la identidad de usuario de Hola se almacena en hello `JWT` como uno de hello otra notificaciones, a continuación, que el valor se podría usar en su lugar.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-123">If hello user identity is stored in hello `JWT` as one of hello other claims then that value could be used in its place.</span></span>

## <a name="combined-policies"></a><span data-ttu-id="5cf4d-124">Directivas de combinación</span><span class="sxs-lookup"><span data-stu-id="5cf4d-124">Combined policies</span></span>
<span data-ttu-id="5cf4d-125">Aunque Hola limitación nuevas directivas proporciona un control más que Hola existente de las directivas de limitación, sigue siendo valor combinar ambas capacidades.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-125">Although hello new throttling policies provide more control than hello existing throttling policies, there is still value combining both capabilities.</span></span> <span data-ttu-id="5cf4d-126">Limitación por clave de suscripción de producto ([limitar la tasa de llamadas por suscripción](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRate) y [establecer la cuota de uso por suscripción](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuota)) es una excelente manera de tooenable monetización de una API con cargo basándose en los niveles de uso.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-126">Throttling by product subscription key ([Limit call rate by subscription](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRate) and [Set usage quota by subscription](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuota)) is a great way tooenable monetizing of an API by charging based on usage levels.</span></span> <span data-ttu-id="5cf4d-127">Hello un control más preciso de ser capaz de toothrottle por el usuario es complementario e impide que uno del comportamiento del usuario degradar experiencia Hola de otro.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-127">hello finer grained control of being able toothrottle by user is complementary and prevents one user's behavior from degrading hello experience of another.</span></span> 

## <a name="client-driven-throttling"></a><span data-ttu-id="5cf4d-128">Limitación controlada por cliente</span><span class="sxs-lookup"><span data-stu-id="5cf4d-128">Client driven throttling</span></span>
<span data-ttu-id="5cf4d-129">Cuando Hola limitación clave se define mediante una [expresión de directiva](https://msdn.microsoft.com/library/azure/dn910913.aspx), es proveedor Hola API que está decidiendo si la limitación de hello está en el ámbito.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-129">When hello throttling key is defined using a [policy expression](https://msdn.microsoft.com/library/azure/dn910913.aspx), then it is hello API provider that is choosing how hello throttling is scoped.</span></span> <span data-ttu-id="5cf4d-130">Sin embargo, un desarrollador puede toocontrol cómo valoran limitar sus propios clientes.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-130">However, a developer might want toocontrol how they rate limit their own customers.</span></span> <span data-ttu-id="5cf4d-131">Esto podría habilitarse por el proveedor de la API de hello introduciendo cliente aplicación toocommunicate Hola clave toohello de un encabezado personalizado tooallow Hola desarrollador API.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-131">This could be enabled by hello API provider by introducing a custom header tooallow hello developer's client application toocommunicate hello key toohello API.</span></span>

```xml
<rate-limit-by-key calls="100"
          renewal-period="60"
          counter-key="@(request.Headers.GetValueOrDefault("Rate-Key",""))"/>
```

<span data-ttu-id="5cf4d-132">Esto permite toochoose de aplicación de cliente del desarrollador de hello cómo desean limitación clave de la tasa de toocreate Hola.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-132">This enables hello developer's client application toochoose how they want toocreate hello rate limiting key.</span></span> <span data-ttu-id="5cf4d-133">Con un poco de ingenio un programador del cliente podría crear sus propios niveles de velocidad asignando conjuntos de claves toousers y rotación de uso de claves de Hola.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-133">With a little bit of ingenuity a client developer could create their own rate tiers by allocating sets of keys toousers and rotating hello key usage.</span></span>

## <a name="summary"></a><span data-ttu-id="5cf4d-134">Resumen</span><span class="sxs-lookup"><span data-stu-id="5cf4d-134">Summary</span></span>
<span data-ttu-id="5cf4d-135">Administración de API de Azure proporciona velocidad y quote limitación tooboth protección y agregar servicio de API de tooyour de valor.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-135">Azure API Management provides rate and quote throttling tooboth protect and add value tooyour API service.</span></span> <span data-ttu-id="5cf4d-136">Hola limitación nuevas directivas con reglas de ámbito personalizadas permite que más precisa control sobre esos tooenable directivas las aplicaciones incluso mejores toobuild de los clientes.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-136">hello new throttling policies with custom scoping rules allow you finer grained control over those policies tooenable your customers toobuild even better applications.</span></span> <span data-ttu-id="5cf4d-137">ejemplos de Hello en este artículo muestran uso de Hola de estas nuevas directivas de claves con direcciones IP del cliente, identidad de usuario y valores de cliente generado de limitación de la tasa de fabricación.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-137">hello examples in this article demonstrate hello use of these new policies by manufacturing rate limiting keys with client IP addresses, user identity, and client generated values.</span></span> <span data-ttu-id="5cf4d-138">Sin embargo, hay muchas otras partes de mensaje de Hola que podría utilizarse como agente de usuario, fragmentos de ruta de acceso de dirección URL, tamaño del mensaje.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-138">However, there are many other parts of hello message that could be used such as user agent, URL path fragments, message size.</span></span>

## <a name="next-steps"></a><span data-ttu-id="5cf4d-139">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="5cf4d-139">Next steps</span></span>
<span data-ttu-id="5cf4d-140">Envíenos sus comentarios en el subproceso de Disqus Hola de este tema.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-140">Please give us your feedback in hello Disqus thread for this topic.</span></span> <span data-ttu-id="5cf4d-141">Sería excelente toohear sobre otros posibles valores de clave que han sido una elección lógica en los escenarios.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-141">It would be great toohear about other potential key values that have been a logical choice in your scenarios.</span></span>

## <a name="watch-a-video-overview-of-these-policies"></a><span data-ttu-id="5cf4d-142">Ver un vídeo de información general de estas directivas</span><span class="sxs-lookup"><span data-stu-id="5cf4d-142">Watch a video overview of these policies</span></span>
<span data-ttu-id="5cf4d-143">Para obtener más información sobre hello [límite de velocidad por clave](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRateByKey) y [cuota por clave](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuotaByKey) las directivas que se describen en este artículo, consulte Hola después de vídeo.</span><span class="sxs-lookup"><span data-stu-id="5cf4d-143">For more information on hello [rate-limit-by-key](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRateByKey) and [quota-by-key](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuotaByKey) policies covered in this article, please watch hello following video.</span></span>

> [!VIDEO https://channel9.msdn.com/Blogs/AzureApiMgmt/Advanced-Request-Throttling-with-Azure-API-Management/player]
> 
> 


---
title: "Control de errores en runbooks gráficos de Azure Automation | Microsoft Docs"
description: "En este artículo se describe cómo implementar la lógica de control de errores en runbooks gráficos de Azure Automation."
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: tysonn
ms.assetid: 
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 12/26/2016
ms.author: magoedte
ms.openlocfilehash: 12313f7f245d32c33882f1036f7d4b48bfb3ddc5
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="error-handling-in-azure-automation-graphical-runbooks"></a><span data-ttu-id="2b285-103">Control de errores en runbooks gráficos de Azure Automation</span><span class="sxs-lookup"><span data-stu-id="2b285-103">Error handling in Azure Automation graphical runbooks</span></span>

<span data-ttu-id="2b285-104">Una entidad de seguridad clave en el diseño de runbooks que se debe tener en cuenta es identificar los distintos problemas que puede tener un runbook.</span><span class="sxs-lookup"><span data-stu-id="2b285-104">A key runbook design principal to consider is identifying different issues that a runbook might experience.</span></span> <span data-ttu-id="2b285-105">Dichos problemas pueden incluir condiciones de correcto, estados de error esperado y condiciones de error inesperado.</span><span class="sxs-lookup"><span data-stu-id="2b285-105">These issues can include success, expected error states, and unexpected error conditions.</span></span>

<span data-ttu-id="2b285-106">Los runbooks deben incluir el control de errores.</span><span class="sxs-lookup"><span data-stu-id="2b285-106">Runbooks should include error handling.</span></span> <span data-ttu-id="2b285-107">Para validar el resultado de una actividad o controlar un error con runbooks gráficos, se puede usar una actividad de código de Windows PowerShell, definir una lógica condicional en el vínculo de salida de la actividad o aplicar otro método.</span><span class="sxs-lookup"><span data-stu-id="2b285-107">To validate the output of an activity or handle an error with graphical runbooks, you could use a Windows PowerShell code activity, define conditional logic on the output link of the activity, or apply another method.</span></span>          

<span data-ttu-id="2b285-108">A menudo, aunque se produzca un error de no terminación en una actividad de un runbook, se procesarán todas las actividades posteriores, independientemente del error.</span><span class="sxs-lookup"><span data-stu-id="2b285-108">Often, if there is a non-terminating error that occurs with a runbook activity, any activity that follows is processed regardless of the error.</span></span> <span data-ttu-id="2b285-109">Es probable que el error genere una excepción, pero se podrá ejecutar la siguiente actividad.</span><span class="sxs-lookup"><span data-stu-id="2b285-109">The error is likely to generate an exception, but the next activity is still allowed to run.</span></span> <span data-ttu-id="2b285-110">Esta es la forma en que se ha diseñado que PowerShell controle los errores.</span><span class="sxs-lookup"><span data-stu-id="2b285-110">This is the way that PowerShell is designed to handle errors.</span></span>    

<span data-ttu-id="2b285-111">Los tipos de errores de PowerShell que se pueden producir durante la ejecución provocan la terminación o no la provocan.</span><span class="sxs-lookup"><span data-stu-id="2b285-111">The types of PowerShell errors that can occur during execution are terminating or non-terminating.</span></span> <span data-ttu-id="2b285-112">Estas son las diferencias entre los errores de terminación y de no terminación:</span><span class="sxs-lookup"><span data-stu-id="2b285-112">The differences between terminating and non-terminating errors are as follows:</span></span>

* <span data-ttu-id="2b285-113">**Error de terminación**: error grave durante la ejecución que detiene el comando (o la ejecución del script) por completo.</span><span class="sxs-lookup"><span data-stu-id="2b285-113">**Terminating error**: A serious error during execution that halts the command (or script execution) completely.</span></span> <span data-ttu-id="2b285-114">Entre los ejemplos se incluyen cmdlets inexistentes, errores de sintaxis que impiden la ejecución de un cmdlet u otros errores irrecuperables.</span><span class="sxs-lookup"><span data-stu-id="2b285-114">Examples include non-existent cmdlets, syntax errors that prevent a cmdlet from running, or other fatal errors.</span></span>

* <span data-ttu-id="2b285-115">**Error de no terminación**: error que no es grave, lo que permite que la ejecución no se interrumpe.</span><span class="sxs-lookup"><span data-stu-id="2b285-115">**Non-terminating error**: A non-serious error that allows execution to continue despite the failure.</span></span> <span data-ttu-id="2b285-116">Entre los ejemplos se incluyen errores operativos, como los errores de archivos no encontrados y problemas de permisos.</span><span class="sxs-lookup"><span data-stu-id="2b285-116">Examples include operational errors such as file not found errors and permissions problems.</span></span>

<span data-ttu-id="2b285-117">Los runbooks gráficos de Azure Automation se han mejorado con la funcionalidad de inclusión del control de errores.</span><span class="sxs-lookup"><span data-stu-id="2b285-117">Azure Automation graphical runbooks have been improved with the capability to include error handling.</span></span> <span data-ttu-id="2b285-118">Ahora es posible convertir las excepciones en errores de no terminación y crear vínculos de error entre las actividades.</span><span class="sxs-lookup"><span data-stu-id="2b285-118">You can now turn exceptions into non-terminating errors and create error links between activities.</span></span> <span data-ttu-id="2b285-119">Este proceso permite a los autores de runbooks detectar errores y administrar cualquier condición realizada o inesperada.</span><span class="sxs-lookup"><span data-stu-id="2b285-119">This process allows a runbook author to catch errors and manage realized or unexpected conditions.</span></span>  

## <a name="when-to-use-error-handling"></a><span data-ttu-id="2b285-120">Cuándo se debe utilizar el control de errores</span><span class="sxs-lookup"><span data-stu-id="2b285-120">When to use error handling</span></span>

<span data-ttu-id="2b285-121">Siempre que haya una actividad crítica que genere un error o una excepción es importante que se procese la siguiente actividad del runbook y controlar el error adecuadamente.</span><span class="sxs-lookup"><span data-stu-id="2b285-121">Whenever there is a critical activity that throws an error or exception, it's important to prevent the next activity in your runbook from processing and to handle the error appropriately.</span></span> <span data-ttu-id="2b285-122">Esto es especialmente crítico cuando los runbooks dan soporte a un proceso de operaciones de un negocio o un servicio.</span><span class="sxs-lookup"><span data-stu-id="2b285-122">This is especially critical when your runbooks are supporting a business or service operations process.</span></span>

<span data-ttu-id="2b285-123">Por cada actividad que pueda generar un error, el autor del runbook puede agregar un vínculo de error que señale a cualquier otra actividad.</span><span class="sxs-lookup"><span data-stu-id="2b285-123">For each activity that can produce an error, the runbook author can add an error link pointing to any other activity.</span></span>  <span data-ttu-id="2b285-124">La actividad de destino puede ser de cualquier tipo, entre las que se incluyen actividades de código, la invocación de un cmdlet, la invocación de otro runbook, etc.</span><span class="sxs-lookup"><span data-stu-id="2b285-124">The destination activity can be of any type, including code activities, invoking a cmdlet, invoking another runbook, and so on.</span></span>

<span data-ttu-id="2b285-125">Además, la actividad de destino también puede tener vínculos salientes.</span><span class="sxs-lookup"><span data-stu-id="2b285-125">In addition, the destination activity can also have outgoing links.</span></span> <span data-ttu-id="2b285-126">Dichos vínculos pueden ser normales o de error,</span><span class="sxs-lookup"><span data-stu-id="2b285-126">These links can be regular links or error links.</span></span> <span data-ttu-id="2b285-127">lo que significa que el autor del runbook puede implementar una lógica de control de errores compleja sin tener que recurrir a una actividad de código.</span><span class="sxs-lookup"><span data-stu-id="2b285-127">This means the runbook author can implement complex error-handling logic without resorting to a code activity.</span></span> <span data-ttu-id="2b285-128">La práctica recomendada consiste en crear un runbook específico para el control de errores con una funcionalidad común, pero no es obligatorio.</span><span class="sxs-lookup"><span data-stu-id="2b285-128">The recommended practice is to create a dedicated error-handling runbook with common functionality, but it's not mandatory.</span></span> <span data-ttu-id="2b285-129">La lógica de control de errores en una actividad de código de PowerShell no es la única opción.</span><span class="sxs-lookup"><span data-stu-id="2b285-129">Error-handling logic in a PowerShell code activity it isn't the only option.</span></span>  

<span data-ttu-id="2b285-130">Por ejemplo, piense en un runbook que intenta iniciar una máquina virtual e instalar una aplicación en ella.</span><span class="sxs-lookup"><span data-stu-id="2b285-130">For example, consider a runbook that tries to start a VM and install an application on it.</span></span> <span data-ttu-id="2b285-131">Si la máquina virtual no se inicia correctamente, realiza dos acciones:</span><span class="sxs-lookup"><span data-stu-id="2b285-131">If the VM doesn't start correctly, it performs two actions:</span></span>

1. <span data-ttu-id="2b285-132">Envía una notificación acerca de este problema.</span><span class="sxs-lookup"><span data-stu-id="2b285-132">It sends a notification about this problem.</span></span>
2. <span data-ttu-id="2b285-133">Inicia otro runbook que aprovisiona automáticamente una nueva máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="2b285-133">It starts another runbook that automatically provisions a new VM instead.</span></span>

<span data-ttu-id="2b285-134">Una solución es en tener un vínculo de error que apunte a una actividad que controle el paso uno.</span><span class="sxs-lookup"><span data-stu-id="2b285-134">One solution is to have an error link pointing to an activity that handles step one.</span></span> <span data-ttu-id="2b285-135">Por ejemplo, puede conectar el cmdlet **Write-Warning** a una actividad para el paso dos, como el cmdlet **AzureRmAutomationRunbook inicio**.</span><span class="sxs-lookup"><span data-stu-id="2b285-135">For example, you could connect the **Write-Warning** cmdlet to an activity for step two, such as the **Start-AzureRmAutomationRunbook** cmdlet.</span></span>

<span data-ttu-id="2b285-136">Este comportamiento se puede generalizar para que se pueda usar en muchos runbooks. Solo es preciso colocar estas dos actividades en un runbook de control de errores independiente y seguir las instrucciones anteriores.</span><span class="sxs-lookup"><span data-stu-id="2b285-136">You could also generalize this behavior for use in many runbooks by putting these two activities in a separate error handling runbook and following the guidance suggested earlier.</span></span> <span data-ttu-id="2b285-137">Antes de llamar a este runbook de control de errores se puede construir un mensaje personalizado a partir de los datos del runbook original y, después, pasarlo como parámetro al runbook de control de errores.</span><span class="sxs-lookup"><span data-stu-id="2b285-137">Before calling this error-handling runbook, you could construct a custom message from the data in the original runbook, and then pass it as a parameter to the error-handling runbook.</span></span>

## <a name="how-to-use-error-handling"></a><span data-ttu-id="2b285-138">Uso del control de errores</span><span class="sxs-lookup"><span data-stu-id="2b285-138">How to use error handling</span></span>

<span data-ttu-id="2b285-139">Todas las actividades tienen una opción de configuración que convierte las excepciones en errores que no provocan la terminación.</span><span class="sxs-lookup"><span data-stu-id="2b285-139">Each activity has a configuration setting that turns exceptions into non-terminating errors.</span></span> <span data-ttu-id="2b285-140">De manera predeterminada esta opción está deshabilitada.</span><span class="sxs-lookup"><span data-stu-id="2b285-140">By default, this setting is disabled.</span></span> <span data-ttu-id="2b285-141">Se recomienda habilitar esta opción en todas aquellas actividades en las que se desee controlar los errores.</span><span class="sxs-lookup"><span data-stu-id="2b285-141">We recommend that you enable this setting on any activity where you want to handle errors.</span></span>  

<span data-ttu-id="2b285-142">Al habilitar esta configuración, se garantiza que tanto los errores de la actividad que provocan terminación como los que no la provocan se tratan como errores que no la provocan y se pueden controlar con un vínculo de error.</span><span class="sxs-lookup"><span data-stu-id="2b285-142">By enabling this configuration, you are assuring that both terminating and non-terminating errors in the activity are handled as non-terminating errors, and can be handled with an error link.</span></span>  

<span data-ttu-id="2b285-143">Tras configurar esta opción, cree una actividad que controle el error.</span><span class="sxs-lookup"><span data-stu-id="2b285-143">After configuring this setting, you create an activity that handles the error.</span></span> <span data-ttu-id="2b285-144">Si una actividad produce algún error, se siguen los vínculos de error de salida, no los vínculos normales, aunque la actividad genere también una salida normal.</span><span class="sxs-lookup"><span data-stu-id="2b285-144">If an activity produces any error, then the outgoing error links are followed, and the regular links are not, even if the activity produces regular output as well.</span></span><br><br> ![Ejemplo de vínculo de error de runbook de Automation](media/automation-runbook-graphical-error-handling/error-link-example.png)

<span data-ttu-id="2b285-146">En el ejemplo siguiente, un runbook recupera una variable que contiene el nombre del equipo de una máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="2b285-146">In the following example, a runbook retrieves a variable that contains the computer name of a virtual machine.</span></span> <span data-ttu-id="2b285-147">A continuación, intenta iniciar la máquina virtual con la siguiente actividad.</span><span class="sxs-lookup"><span data-stu-id="2b285-147">It then attempts to start the virtual machine with the next activity.</span></span><br><br> ![Ejemplo de control de errores de runbook de Automation](media/automation-runbook-graphical-error-handling/runbook-example-error-handling.png)<br><br>      

<span data-ttu-id="2b285-149">Las actividades **Get-AutomationVariable** y **Start-AzureRmVm** están configuradas para convertir excepciones en errores.</span><span class="sxs-lookup"><span data-stu-id="2b285-149">The **Get-AutomationVariable** activity and **Start-AzureRmVm** are configured to convert exceptions to errors.</span></span>  <span data-ttu-id="2b285-150">Si hay problemas para obtener la variable o para iniciar la máquina virtual, se generan errores.</span><span class="sxs-lookup"><span data-stu-id="2b285-150">If there are problems getting the variable or starting the VM, then errors are generated.</span></span><br><br> <span data-ttu-id="2b285-151">![Configuración de la actividad de control de errores de runbook de Automation](media/automation-runbook-graphical-error-handling/activity-blade-convertexception-option.png)</span><span class="sxs-lookup"><span data-stu-id="2b285-151">![Automation runbook error-handling activity settings](media/automation-runbook-graphical-error-handling/activity-blade-convertexception-option.png)</span></span>

<span data-ttu-id="2b285-152">Fluyen vínculos de errores de flujo de estas actividades a una única actividad de **administración de errores** (una actividad de código).</span><span class="sxs-lookup"><span data-stu-id="2b285-152">Error links flow from these activities to a single **error management** activity (a code activity).</span></span> <span data-ttu-id="2b285-153">Esta actividad se configura con una expresión simple de PowerShell que utiliza la palabra clave *Throw* para detener el procesamiento, junto con *$Error.Exception.Message* para obtener el mensaje que describe la excepción actual.</span><span class="sxs-lookup"><span data-stu-id="2b285-153">This activity is configured with a simple PowerShell expression that uses the *Throw* keyword to stop processing, along with *$Error.Exception.Message* to get the message that describes the current exception.</span></span><br><br> <span data-ttu-id="2b285-154">![Ejemplo de código de control de errores de runbook de Automation](media/automation-runbook-graphical-error-handling/runbook-example-error-handling-code.png)</span><span class="sxs-lookup"><span data-stu-id="2b285-154">![Automation runbook error-handling code example](media/automation-runbook-graphical-error-handling/runbook-example-error-handling-code.png)</span></span>


## <a name="next-steps"></a><span data-ttu-id="2b285-155">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="2b285-155">Next steps</span></span>

* <span data-ttu-id="2b285-156">Para más información acerca de los vínculos y tipos de vínculo de los runbooks gráficos, consulte [Creación gráfica en Azure Automation](automation-graphical-authoring-intro.md#links-and-workflow).</span><span class="sxs-lookup"><span data-stu-id="2b285-156">To learn more about links and link types in graphical runbooks, see [Graphical authoring in Azure Automation](automation-graphical-authoring-intro.md#links-and-workflow).</span></span>

* <span data-ttu-id="2b285-157">Para más información acerca de la ejecución de un runbook, cómo supervisar trabajos del runbook y otros detalles técnicos, consulte [Ejecución de un runbook en Automatización de Azure](automation-runbook-execution.md).</span><span class="sxs-lookup"><span data-stu-id="2b285-157">To learn more about runbook execution, how to monitor runbook jobs, and other technical details, see [Track a runbook job](automation-runbook-execution.md).</span></span>

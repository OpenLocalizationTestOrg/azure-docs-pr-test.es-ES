---
title: "aaaCalling un Runbook de automatización de Azure desde una alerta de análisis de registro | Documentos de Microsoft"
description: "Este artículo proporciona información general de cómo tooinvoke un runbook de automatización de una alerta de análisis de registros de OMS de Microsoft."
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: 
ms.assetid: 
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 01/31/2017
ms.author: magoedte
ms.openlocfilehash: 8b745d6e6c2b0294d676e010f52855cd51741cf9
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="calling-an-azure-automation-runbook-from-an-oms-log-analytics-alert"></a><span data-ttu-id="cb9b4-103">Llamada a un runbook de Azure Automation desde una alerta de Log Analytics de OMS</span><span class="sxs-lookup"><span data-stu-id="cb9b4-103">Calling an Azure Automation runbook from an OMS Log Analytics alert</span></span>

<span data-ttu-id="cb9b4-104">Cuando se configura una alerta de análisis de registros toocreate se produce un error en un registro de alertas si los resultados coinciden con un criterio determinado, como un aumento de la utilización del procesador o una funcionalidad de toohello críticos del proceso de aplicación concreta de una aplicación empresarial y escribe un evento correspondiente en el registro de eventos de Windows hello, esa alerta puede ejecutar automáticamente un runbook de automatización en un intento de tooauto-corregir el problema de Hola.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-104">When an alert is configured in Log Analytics toocreate an alert record if results match a particular criteria, such as a prolonged spike in processor utilization or a particular application process critical toohello functionality of a business application fails and writes a corresponding event in hello Windows event log, that alert can automatically run an Automation runbook in an attempt tooauto-remediate hello issue.</span></span>  

<span data-ttu-id="cb9b4-105">Hay dos toocall opciones un runbook al configurar la alerta de Hola.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-105">There are two options toocall a runbook when configuring hello alert.</span></span>  <span data-ttu-id="cb9b4-106">Concretamente, puede:</span><span class="sxs-lookup"><span data-stu-id="cb9b4-106">Specifically,</span></span>

1. <span data-ttu-id="cb9b4-107">Usar un webhook.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-107">Using a Webhook.</span></span>
   * <span data-ttu-id="cb9b4-108">Esto es Hola la única opción disponible si el área de trabajo OMS no está vinculado tooan cuenta de automatización.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-108">This is hello only option available if your OMS workspace is not linked tooan Automation account.</span></span>
   * <span data-ttu-id="cb9b4-109">Si ya tiene un área de trabajo OMS de automatización de la cuenta vinculada tooan, esta opción está disponible todavía.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-109">If you already have an Automation account linked tooan OMS workspace, this option is still available.</span></span>  

2. <span data-ttu-id="cb9b4-110">Seleccionar un runbook directamente.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-110">Select a runbook directly.</span></span>
   * <span data-ttu-id="cb9b4-111">Esta opción está disponible solo cuando el área de trabajo de hello OMS está vinculado tooan cuenta de automatización.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-111">This option is available only when hello OMS workspace is linked tooan Automation account.</span></span>  

## <a name="calling-a-runbook-using-a-webhook"></a><span data-ttu-id="cb9b4-112">Llamada a un runbook con un webhook</span><span class="sxs-lookup"><span data-stu-id="cb9b4-112">Calling a runbook using a webhook</span></span>

<span data-ttu-id="cb9b4-113">Un webhook permite toostart un runbook determinado en la automatización de Azure a través de una única solicitud HTTP.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-113">A webhook allows you toostart a particular runbook in Azure Automation through a single HTTP request.</span></span>  <span data-ttu-id="cb9b4-114">Antes de configurar hello [alerta de análisis de registros](../log-analytics/log-analytics-alerts.md#alert-rules) toocall Hola runbook mediante un webhook como una acción de alerta, deberá toofirst crear un webhook de runbook de Hola que se llamará con este método.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-114">Before configuring hello [Log Analytics alert](../log-analytics/log-analytics-alerts.md#alert-rules) toocall hello runbook using a webhook as an alert action, you will need toofirst create a webhook for hello runbook that will be called using this method.</span></span>  <span data-ttu-id="cb9b4-115">Revise y siga los pasos de Hola Hola [crear un webhook](automation-webhooks.md#creating-a-webhook) artículo y recordar la URL del webhook toorecord Hola para que pueda hacer referencia al configurar la regla de alerta de Hola.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-115">Review and follow hello steps in hello [create a webhook](automation-webhooks.md#creating-a-webhook) article and remember toorecord hello webhook URL so that you can reference it while configuring hello alert rule.</span></span>   

## <a name="calling-a-runbook-directly"></a><span data-ttu-id="cb9b4-116">Llamada a runbook directamente</span><span class="sxs-lookup"><span data-stu-id="cb9b4-116">Calling a runbook directly</span></span>

<span data-ttu-id="cb9b4-117">Si tienes Hola automatización & oferta Control instalado y configurado en el área de trabajo OMS, al configurar la opción de acciones de hello Runbook de alerta de hello, puede ver todos los runbooks de hello **seleccionar un runbook** lista desplegable y seleccione Hola runbook específico que desee toorun de alerta de toohello de respuesta.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-117">If you have hello Automation & Control offering installed and configured in your OMS workspace, when configuring hello Runbook actions option for hello alert, you can view all runbooks from hello **Select a runbook** dropdown list and select hello specific runbook you want toorun in response toohello alert.</span></span>  <span data-ttu-id="cb9b4-118">Hola seleccionado runbook puede ejecutarse en un área de trabajo en la nube de Azure de Hola o en un runbook worker híbrido.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-118">hello selected runbook can run in a workspace in hello Azure cloud or on a hybrid runbook worker.</span></span>  <span data-ttu-id="cb9b4-119">Cuando alerta Hola se crea mediante la opción del runbook hello, se creará un webhook de runbook de Hola.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-119">When hello alert is created using hello runbook option, a webhook will be created for hello runbook.</span></span>  <span data-ttu-id="cb9b4-120">Puede ver hello webhook si va toohello cuenta de automatización y navegue toohello webhook hoja de runbook de hello seleccionado.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-120">You can see hello webhook if you go toohello Automation account and navigate toohello webhook blade of hello selected runbook.</span></span>  <span data-ttu-id="cb9b4-121">Si elimina la alerta de hello, hello webhook no se elimina, pero usuario Hola puede eliminar el webhook Hola manualmente.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-121">If you delete hello alert, hello webhook is not deleted, but hello user can delete hello webhook manually.</span></span>  <span data-ttu-id="cb9b4-122">No es un problema si no se elimina el webhook hello, es simplemente un elemento huérfano que podría tener toobe elimina en orden toomaintain una cuenta de automatización organizada.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-122">It is not a problem if hello webhook is not deleted, it is just an orphaned item that will eventually need toobe deleted in order toomaintain an organized Automation account.</span></span>  

## <a name="characteristics-of-a-runbook-for-both-options"></a><span data-ttu-id="cb9b4-123">Características de un runbook (para ambas opciones)</span><span class="sxs-lookup"><span data-stu-id="cb9b4-123">Characteristics of a runbook (for both options)</span></span>

<span data-ttu-id="cb9b4-124">Ambos métodos para llamar a Hola runbook de alerta de análisis de registros de hello tienen características de un comportamiento diferente que necesitan toobe entiende antes de configurar las reglas de alertas.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-124">Both methods for calling hello runbook from hello Log Analytics alert have different behavior characteristics that need toobe understood before you configure your alert rules.</span></span>  

* <span data-ttu-id="cb9b4-125">Debe tener un parámetro de entrada de runbook denominado **WebhookData** del tipo **Objeto**.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-125">You must have a runbook input parameter called **WebhookData** that is **Object** type.</span></span>  <span data-ttu-id="cb9b4-126">Esto puede ser obligatorio u opcional.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-126">It can be mandatory or optional.</span></span>  <span data-ttu-id="cb9b4-127">alerta de Hello pasa los resultados de búsqueda de hello toohello runbook con este parámetro de entrada.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-127">hello alert passes hello search results toohello runbook using this input parameter.</span></span>

        param  
         (  
          [Parameter (Mandatory=$true)]  
          [object] $WebhookData  
         )

*  <span data-ttu-id="cb9b4-128">Debe tener el objeto de código tooconvert hello WebhookData tooa PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-128">You must have code tooconvert hello WebhookData tooa PowerShell object.</span></span>

    `$SearchResults = (ConvertFrom-Json $WebhookData.RequestBody).SearchResults.value`

    <span data-ttu-id="cb9b4-129">*$SearchResults* será una matriz de objetos; cada objeto contiene campos de hello con valores de un resultado de búsqueda</span><span class="sxs-lookup"><span data-stu-id="cb9b4-129">*$SearchResults* will be an array of objects; each object contains hello fields with values from one search result</span></span>

### <a name="webhookdata-inconsistencies-between-hello-webhook-option-and-runbook-option"></a><span data-ttu-id="cb9b4-130">WebhookData incoherencias entre la opción de webhook de Hola y opción de runbook</span><span class="sxs-lookup"><span data-stu-id="cb9b4-130">WebhookData inconsistencies between hello webhook option and runbook option</span></span>

* <span data-ttu-id="cb9b4-131">Al configurar una alerta toocall un Webhook, escriba una dirección URL del webhook que creó para un runbook y haga clic en hello **Webhook prueba** botón.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-131">When configuring an alert toocall a Webhook, enter a webhook URL you created for a runbook, and click hello **Test Webhook** button.</span></span>  <span data-ttu-id="cb9b4-132">Hello WebhookData resultante envía toohello runbook no contiene *. SearchResult* o *. SearchResults*.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-132">hello resulting WebhookData sent toohello runbook does not contain either *.SearchResult* or *.SearchResults*.</span></span>

*  <span data-ttu-id="cb9b4-133">Si guarda esa alerta cuando alerta Hola desencadena y llama a webhook hello, hello WebhookData envía runbook toohello contiene *. SearchResult*.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-133">If you save that alert, when hello alert triggers and calls hello webhook, hello WebhookData sent toohello runbook contains *.SearchResult*.</span></span>
* <span data-ttu-id="cb9b4-134">Si crea una alerta y configurar toocall un runbook (que también crea un webhook), cuando Hola desencadenadores alerta envía WebhookData toohello runbook que contiene *. SearchResults*.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-134">If you create an alert, and configure it toocall a runbook (which also creates a webhook), when hello alert triggers it sends WebhookData toohello runbook that contains *.SearchResults*.</span></span>

<span data-ttu-id="cb9b4-135">Por lo tanto en el ejemplo de código de hello anterior, será necesario tooget *. SearchResult* si alerta Hola llama a un webhook y deberá tooget *. SearchResults* si alerta Hola llama directamente a un runbook.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-135">Thus in hello code example above, you will need tooget *.SearchResult* if hello alert calls a webhook, and will need tooget *.SearchResults* if hello alert calls a runbook directly.</span></span>

## <a name="example-walkthrough"></a><span data-ttu-id="cb9b4-136">Tutorial de ejemplo</span><span class="sxs-lookup"><span data-stu-id="cb9b4-136">Example walkthrough</span></span>

<span data-ttu-id="cb9b4-137">Demostraremos cómo funciona mediante el uso de hello después runbook gráfico de ejemplo, que inicia un servicio de Windows.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-137">We will demonstrate how this works by using hello following example graphical runbook, which starts a Windows service.</span></span><br><br> ![Runbook gráfico de inicio de servicio de Windows](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice.png)<br>

<span data-ttu-id="cb9b4-139">Hola runbook tiene un parámetro de entrada de tipo **objeto** que se llama **WebhookData** e incluye datos de webhook Hola pasados de alerta que contiene de hello *. SearchResults*.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-139">hello runbook has one input parameter of type **Object** that is called **WebhookData** and includes hello webhook data passed from hello alert containing *.SearchResults*.</span></span><br><br> <span data-ttu-id="cb9b4-140">![Parámetros de entrada de Runbook](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice-inputparameter.png)</span><span class="sxs-lookup"><span data-stu-id="cb9b4-140">![Runbook input parameters](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice-inputparameter.png)</span></span><br>

<span data-ttu-id="cb9b4-141">En este ejemplo, en análisis de registros se crean dos campos personalizados, *SvcDisplayName_CF* y *SvcState_CF*, tooextract Hola mostrar hello y nombre del estado del servicio de servicio de hello (es decir, ejecución o detenido) desde el evento de hello escriben el registro de eventos del sistema de toohello.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-141">For this example, in Log Analytics we created two custom fields, *SvcDisplayName_CF* and *SvcState_CF*, tooextract hello service display name and hello state of hello service (i.e. running or stopped) from hello event written toohello System event log.</span></span>  <span data-ttu-id="cb9b4-142">A continuación, crearemos una regla de alerta con hello después de consulta de búsqueda: `Type=Event SvcDisplayName_CF="Print Spooler" SvcState_CF="stopped"` para que se puede detectar cuándo Hola servicio cola de impresión se detiene en el sistema de Windows hello.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-142">We then create an alert rule with hello following search query: `Type=Event SvcDisplayName_CF="Print Spooler" SvcState_CF="stopped"` so that we can detect when hello Print Spooler service is stopped on hello Windows system.</span></span>  <span data-ttu-id="cb9b4-143">Puede ser cualquier servicio en cuestión, pero en este ejemplo hacemos referencia a uno de los servicios preexistente Hola que se incluyen con el sistema operativo Windows hello.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-143">It can be any service of interest, but for this example we are referencing one of hello pre-existing services that are included with hello Windows OS.</span></span>  <span data-ttu-id="cb9b4-144">acción de alerta de Hello es tooexecute configurado nuestro runbook utilizado en este ejemplo y ejecutar en hello Hybrid Runbook Worker, cuáles están habilitadas en los sistemas de destino de Hola.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-144">hello alert action is configured tooexecute our runbook used in this example and run on hello Hybrid Runbook Worker, which are enabled on hello target systems.</span></span>   

<span data-ttu-id="cb9b4-145">Hola actividad de runbook código **obtener el nombre de servicio desde LA** convertirá la cadena con formato JSON de hello en un tipo de objeto y el filtro en el elemento de hello *SvcDisplayName_CF* tooextract nombre para mostrar hello de hello Servicio de Windows y pasar a la actividad siguiente hello que comprobará Hola servicio se detiene antes de intentar toorestart lo.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-145">hello runbook code activity **Get Service Name from LA** will convert hello JSON-formatted string into an object type and filter on hello item *SvcDisplayName_CF* tooextract hello display name of hello Windows service and pass this onto hello next activity which will verify hello service is stopped before attempting toorestart it.</span></span>  <span data-ttu-id="cb9b4-146">*SvcDisplayName_CF* es un [campo personalizado](../log-analytics/log-analytics-custom-fields.md) creado en el análisis de registros toodemonstrate en este ejemplo.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-146">*SvcDisplayName_CF* is a [custom field](../log-analytics/log-analytics-custom-fields.md) created in Log Analytics toodemonstrate this example.</span></span>

    $SearchResults = (ConvertFrom-Json $WebhookData.RequestBody).SearchResults.value
    $SearchResults.SvcDisplayName_CF  

<span data-ttu-id="cb9b4-147">Cuando se detiene el servicio de hello, regla de alerta de hello en análisis de registros detectará a una coincidencia y desencadenar runbook Hola y Hola contexto de alerta toohello runbook de envío.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-147">When hello service stops, hello alert rule in Log Analytics will detect a match and trigger hello runbook and send hello alert context toohello runbook.</span></span> <span data-ttu-id="cb9b4-148">Hola runbook llevará a cabo acción tooverify Hola servicio se detiene, y si lo intento toorestart Hola servicio y compruebe si se inició correctamente y da como resultado Hola de salida.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-148">hello runbook will take action tooverify hello service is stopped, and if so attempt toorestart hello service and verify it started correctly and output hello results.</span></span>     

<span data-ttu-id="cb9b4-149">O bien si no tiene el área de trabajo OMS de automatización de la cuenta vinculada tooyour, configurar la regla de alerta de Hola a un runbook de webhook acción tootrigger Hola y configurar la cadena con formato JSON de hello runbook tooconvert hello y filtro en *. SearchResult* instrucciones Hola se ha mencionado anteriormente.</span><span class="sxs-lookup"><span data-stu-id="cb9b4-149">Alternatively if you don't have your Automation account linked tooyour OMS workspace, you would configure hello alert rule with a webhook action tootrigger hello runbook and configure hello runbook tooconvert hello JSON-formatted string and filter on *.SearchResult* following hello guidance mentioned earlier.</span></span>    

## <a name="next-steps"></a><span data-ttu-id="cb9b4-150">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="cb9b4-150">Next steps</span></span>

* <span data-ttu-id="cb9b4-151">toolearn más información acerca de las alertas de análisis de registros y toocreate uno, vea [alertas en los análisis de registros](../log-analytics/log-analytics-alerts.md).</span><span class="sxs-lookup"><span data-stu-id="cb9b4-151">toolearn more about alerts in Log Analytics and how toocreate one, see [Alerts in Log Analytics](../log-analytics/log-analytics-alerts.md).</span></span>

* <span data-ttu-id="cb9b4-152">Cómo ver runbooks tootrigger mediante un webhook de toounderstand [webhook de automatización de Azure](automation-webhooks.md).</span><span class="sxs-lookup"><span data-stu-id="cb9b4-152">toounderstand how tootrigger runbooks using a webhook, see [Azure Automation webhooks](automation-webhooks.md).</span></span>

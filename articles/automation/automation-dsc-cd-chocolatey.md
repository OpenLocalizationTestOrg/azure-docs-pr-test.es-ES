---
title: "Implementación continua de DSC de Azure Automation con Chocolatey | Microsoft Docs"
description: "Implementación continua de DevOps mediante DSC de Automatización de Azure y el administrador de paquetes Chocolatey.  Ejemplo con plantilla de ARM JSON completa y código fuente de PowerShell."
services: automation
documentationcenter: 
author: eslesar
manager: carmonm
editor: tysonn
ms.assetid: c0baa411-eb76-4f91-8d14-68f68b4805b6
ms.service: automation
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: na
ms.date: 10/29/2016
ms.author: golive
ms.openlocfilehash: f23d7374a8954a0a95853fa9e00b54a8d9c468c4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="usage-example-continuous-deployment-to-virtual-machines-using-automation-dsc-and-chocolatey"></a><span data-ttu-id="4ea5f-104">Ejemplo de uso: implementación continua en máquinas virtuales DSC de Automatización y Chocolatey</span><span class="sxs-lookup"><span data-stu-id="4ea5f-104">Usage Example: Continuous deployment to Virtual Machines using Automation DSC and Chocolatey</span></span>
<span data-ttu-id="4ea5f-105">En el mundo del desarrollo de software con DevOps, existen muchas herramientas que ayudan en diversos puntos de la canalización de integración continua.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-105">In a DevOps world there are many tools to assist with various points in the Continuous Integration pipeline.</span></span>  <span data-ttu-id="4ea5f-106">Configuración de estado deseado (DSC) de Automatización de Azure es una opción nueva, y bienvenida, que puede ser de utilidad para los equipos de DevOps.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-106">Azure Automation Desired State Configuration (DSC) is a welcome new addition to the options that DevOps teams can employ.</span></span>  <span data-ttu-id="4ea5f-107">En este artículo, se muestra cómo configurar la implementación continua (CD) para un equipo de Windows.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-107">This article demonstrates setting up Continuous Deployment (CD) for a Windows computer.</span></span>  <span data-ttu-id="4ea5f-108">Puede ampliar fácilmente la técnica para incluir tantos equipos de Windows como sean necesarios en el rol (por ejemplo, un sitio web) y, a partir de ahí, también a los roles adicionales.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-108">You can easily extend the technique to include as many Windows computers as necessary in the role (a web site, for example), and from there to additional roles as well.</span></span>

![Implementación continua para máquinas virtuales IaaS](./media/automation-dsc-cd-chocolatey/cdforiaasvm.png)

## <a name="at-a-high-level"></a><span data-ttu-id="4ea5f-110">A nivel general</span><span class="sxs-lookup"><span data-stu-id="4ea5f-110">At a high level</span></span>
<span data-ttu-id="4ea5f-111">Aunque todo esto pueda parecer bastante complicado, afortunadamente puede dividirse en dos procesos principales:</span><span class="sxs-lookup"><span data-stu-id="4ea5f-111">There is quite a bit going on here, but fortunately it can be broken into two main processes:</span></span> 

* <span data-ttu-id="4ea5f-112">Escribir código y probarlo, y después crear y publicar paquetes de instalación para las versiones principales y secundarias del sistema;</span><span class="sxs-lookup"><span data-stu-id="4ea5f-112">Writing code and testing it, then creating and publishing installation packages for major and minor versions of the system.</span></span> 
* <span data-ttu-id="4ea5f-113">Crear y administrar las máquinas virtuales que instalarán y ejecutarán el código en los paquetes.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-113">Creating and managing VMs that will install and execute the code in the packages.</span></span>  

<span data-ttu-id="4ea5f-114">Una vez que estos dos procesos principales se hayan puesto en práctica, queda poco para actualizar automáticamente el paquete que se ejecuta en cualquier máquina virtual concreta a medida que se creen e implementen las nuevas versiones.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-114">Once both of these core processes are in place, it’s a short step to automatically update the package running on any particular VM as new versions are created and deployed.</span></span>

## <a name="component-overview"></a><span data-ttu-id="4ea5f-115">Información general sobre los componentes</span><span class="sxs-lookup"><span data-stu-id="4ea5f-115">Component overview</span></span>
<span data-ttu-id="4ea5f-116">Los administradores de paquetes como [apt-get](https://en.wikipedia.org/wiki/Advanced_Packaging_Tool) son muy conocidos en el mundo de Linux, pero no tanto en el de Windows.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-116">Package managers such as [apt-get](https://en.wikipedia.org/wiki/Advanced_Packaging_Tool) are pretty well known in the Linux world, but not so much in the Windows world.</span></span>  <span data-ttu-id="4ea5f-117">[Chocolatey](https://chocolatey.org/) es uno de ellos, y Scott Hanselman proporciona una estupenda introducción al tema en su [blog](http://www.hanselman.com/blog/IsTheWindowsUserReadyForAptget.aspx).</span><span class="sxs-lookup"><span data-stu-id="4ea5f-117">[Chocolatey](https://chocolatey.org/) is such a thing, and Scott Hanselman’s [blog](http://www.hanselman.com/blog/IsTheWindowsUserReadyForAptget.aspx) on the topic is a great intro.</span></span>  <span data-ttu-id="4ea5f-118">En pocas palabras, Chocolatey permite instalar paquetes desde un repositorio central de paquetes en un sistema de Windows mediante la línea de comandos.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-118">In a nutshell, Chocolatey allows you to install packages from a central repository of packages into a Windows system using the command line.</span></span>  <span data-ttu-id="4ea5f-119">Puede crear y administrar su propio repositorio y Chocolatey puede instalar paquetes desde cualquier número de repositorios que designe.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-119">You can create and manage your own repository, and Chocolatey can install packages from any number of repositories that you designate.</span></span>

<span data-ttu-id="4ea5f-120">Configuración de estado deseado (DSC) ([introducción](https://technet.microsoft.com/library/dn249912.aspx)) es una herramienta de PowerShell que permite declarar la configuración que desee para un equipo.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-120">Desired State Configuration (DSC) ([overview](https://technet.microsoft.com/library/dn249912.aspx)) is a PowerShell tool that allows you to declare the configuration that you want for a machine.</span></span>  <span data-ttu-id="4ea5f-121">Por ejemplo, puede indicar "Quiero instalar Chocolatey, quiero instalar IIS, necesito abrir el puerto 80, quiero instalar la versión 1.0.0 de mi sitio web".</span><span class="sxs-lookup"><span data-stu-id="4ea5f-121">For example, you can say, “I want Chocolatey installed, I want IIS installed, I want port 80 opened, I want version 1.0.0 of my website installed.”</span></span>  <span data-ttu-id="4ea5f-122">El Administrador de configuración local (LCM) de DSC implementa esa configuración.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-122">The DSC Local Configuration Manager (LCM) implements that configuration.</span></span> <span data-ttu-id="4ea5f-123">Un servidor de extracción de DSC contiene un repositorio de configuraciones para los equipos.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-123">A DSC Pull Server holds a repository of configurations for your machines.</span></span> <span data-ttu-id="4ea5f-124">El LCM de cada equipo comprueba periódicamente para ver si su configuración coincide con la almacenada.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-124">The LCM on each machine checks in periodically to see if its configuration matches the stored configuration.</span></span> <span data-ttu-id="4ea5f-125">Después, notifica el estado o intenta equiparar la configuración del equipo a la almacenada.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-125">It can either report status or attempt to bring the machine back into alignment with the stored configuration.</span></span> <span data-ttu-id="4ea5f-126">Puede editar la configuración almacenada en el servidor de extracción para hacer que un equipo o un conjunto de equipos se adapten a la configuración modificada.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-126">You can edit the stored configuration on the pull server to cause a machine or set of machines to come into alignment with the changed configuration.</span></span>

<span data-ttu-id="4ea5f-127">Automatización de Azure es un servicio administrado de Microsoft Azure que le permite automatizar diversas tareas con runbooks, nodos, credenciales, recursos y otros activos como programaciones y variables globales.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-127">Azure Automation is a managed service in Microsoft Azure that allows you to automate various tasks using runbooks, nodes, credentials, resources and assets such as schedules and global variables.</span></span> <span data-ttu-id="4ea5f-128">DSC de Automatización de Azure amplía esta capacidad de automatización para incluir las herramientas de DSC de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-128">Azure Automation DSC extends this automation capability to include PowerShell DSC tools.</span></span>  <span data-ttu-id="4ea5f-129">Aquí hay una [introducción](automation-dsc-overview.md)muy buena.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-129">Here’s a great [overview](automation-dsc-overview.md).</span></span>

<span data-ttu-id="4ea5f-130">Un recurso de DSC es un módulo de código con capacidades específicas, como la administración de redes, Active Directory o SQL Server.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-130">A DSC Resource is a module of code that has specific capabilities, such as managing networking, Active Directory, or SQL Server.</span></span>  <span data-ttu-id="4ea5f-131">El recurso de DSC de Chocolatey sabe cómo acceder a un servidor NuGet (entre otros), descargar paquetes, instalar paquetes, etc.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-131">The Chocolatey DSC Resource knows how to access a NuGet Server (among others), download packages, install packages, and so on.</span></span>  <span data-ttu-id="4ea5f-132">Existen muchos otros recursos de DSC en la [Galería de PowerShell](http://www.powershellgallery.com/packages?q=dsc+resources&prerelease=&sortOrder=package-title).</span><span class="sxs-lookup"><span data-stu-id="4ea5f-132">There are many other DSC Resources in the [PowerShell Gallery](http://www.powershellgallery.com/packages?q=dsc+resources&prerelease=&sortOrder=package-title).</span></span>  <span data-ttu-id="4ea5f-133">Estos módulos se instalan en el servidor de extracción de DSC de Automatización de Azure (manualmente) para que se puedan usar con sus configuraciones.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-133">These modules are installed into your Azure Automation DSC Pull Server (by you) so they can be used by your configurations.</span></span>

<span data-ttu-id="4ea5f-134">Las plantillas de Resource Manager proporcionan una forma declarativa de generar la infraestructura: como las redes, las subredes, la seguridad de red y el enrutamiento, los equilibradores de carga, las NIC, las máquinas virtuales, etc.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-134">Resource Manager templates provide a declarative way of generating your infrastructure - things like networks, subnets, network security and routing, load balancers, NICs, VMs, and so on.</span></span>  <span data-ttu-id="4ea5f-135">Este es un [artículo](../azure-resource-manager/resource-manager-deployment-model.md) que compara el modelo de implementación de Resource Manager (declarativo) con el modelo de implementación (imperativo) de Azure Service Management (ASM o clásico) y describe los proveedores de recursos principales, proceso, almacenamiento y red.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-135">Here’s an [article](../azure-resource-manager/resource-manager-deployment-model.md) that compares the Resource Manager deployment model (declarative) with the Azure Service Management (ASM, or classic) deployment model (imperative), and discusses the core resource providers, compute, storage and network.</span></span>

<span data-ttu-id="4ea5f-136">Una característica clave de una plantilla de Resource Manager es su capacidad para instalar una extensión de máquina virtual en la máquina virtual cuando se aprovisiona.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-136">One key feature of an Resource Manager template is its ability to install a VM extension into the VM as it’s provisioned.</span></span>  <span data-ttu-id="4ea5f-137">Una extensión de máquina virtual posee capacidades específicas, como ejecutar un script personalizado, instalar software antivirus o ejecutar un script de configuración de DSC.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-137">A VM extension has specific capabilities such as running a custom script, installing anti-virus software, or running a DSC configuration script.</span></span>  <span data-ttu-id="4ea5f-138">Existen muchos otros tipos de extensiones de máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-138">There are many other types of VM extensions.</span></span>

## <a name="quick-trip-around-the-diagram"></a><span data-ttu-id="4ea5f-139">Vista rápida al diagrama</span><span class="sxs-lookup"><span data-stu-id="4ea5f-139">Quick trip around the diagram</span></span>
<span data-ttu-id="4ea5f-140">Empezando desde arriba, se escribe el código, se compila y prueba, y después se crea un paquete de instalación.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-140">Starting at the top, you write your code, build and test, then create an installation package.</span></span>  <span data-ttu-id="4ea5f-141">Chocolatey admite diversos tipos de paquetes de instalación, como MSI, MSU o ZIP.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-141">Chocolatey can handle various types of installation packages, such as MSI, MSU, ZIP.</span></span>  <span data-ttu-id="4ea5f-142">Además, cuenta con toda la funcionalidad de PowerShell para realizar la instalación en sí si las capacidades nativas de Chocolatey no son suficientes.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-142">And you have the full power of PowerShell to do the actual installation if Chocolatey’s native capabilities aren’t quite up to it.</span></span>  <span data-ttu-id="4ea5f-143">Se coloca el paquete en un lugar accesible: un repositorio de paquetes.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-143">Put the package into someplace reachable – a package repository.</span></span>  <span data-ttu-id="4ea5f-144">En este ejemplo de uso se emplea una carpeta pública en una cuenta de almacenamiento de blobs de Azure, pero vale cualquier lugar.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-144">This usage example uses a public folder in an Azure blob storage account, but it can be anywhere.</span></span>  <span data-ttu-id="4ea5f-145">Chocolatey funciona de forma nativa con los servidores NuGet y otros para administrar los metadatos de los paquetes.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-145">Chocolatey works natively with NuGet servers and a few others for management of package metadata.</span></span>  <span data-ttu-id="4ea5f-146">[este artículo](https://github.com/chocolatey/choco/wiki/How-To-Host-Feed) se describen las opciones.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-146">[This article](https://github.com/chocolatey/choco/wiki/How-To-Host-Feed) describes the options.</span></span>  <span data-ttu-id="4ea5f-147">Este ejemplo de uso utiliza NuGet.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-147">This usage example uses NuGet.</span></span>  <span data-ttu-id="4ea5f-148">Nuspec son los metadatos de los paquetes.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-148">A Nuspec is metadata about your packages.</span></span>  <span data-ttu-id="4ea5f-149">Los nuspecs se "compilan" en forma de NuPkg y se almacenan en un servidor NuGet.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-149">The Nuspec’s are “compiled” into NuPkg’s and stored in a NuGet server.</span></span>  <span data-ttu-id="4ea5f-150">Cuando la configuración solicita un paquete por su nombre y hace referencia a un servidor NuGet, el recurso de DSC de Chocolatey (ahora en la máquina virtual) toma el paquete y lo instala automáticamente.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-150">When your configuration requests a package by name, and references a NuGet server, the Chocolatey DSC Resource (now on the VM) grabs the package and installs it for you.</span></span>  <span data-ttu-id="4ea5f-151">También se puede solicitar una versión específica de un paquete.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-151">You can also request a specific version of a package.</span></span>

<span data-ttu-id="4ea5f-152">En la parte inferior izquierda de la imagen, se ve una plantilla del Administrador de recursos de Azure (ARM).</span><span class="sxs-lookup"><span data-stu-id="4ea5f-152">In the bottom left portion of the picture, there is an Azure Resource Manager (ARM) template.</span></span>  <span data-ttu-id="4ea5f-153">En este ejemplo de uso, la extensión de máquina virtual registra la máquina virtual con el servidor de extracción de DSC de Automatización de Azure (es decir, un servidor de extracción) como nodo.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-153">In this usage example, the VM extension registers the VM with the Azure Automation DSC Pull Server (that is, a pull server) as a Node.</span></span>  <span data-ttu-id="4ea5f-154">La configuración se almacena en el servidor de extracción.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-154">The configuration is stored in the pull server.</span></span>  <span data-ttu-id="4ea5f-155">En realidad, se almacena dos veces: una vez como texto sin formato y otra como archivo MOF (para aquellos a quienes les interese).  En el portal, el MOF es una "configuración de nodo" (en lugar de simplemente una "configuración").</span><span class="sxs-lookup"><span data-stu-id="4ea5f-155">Actually, it’s stored twice: once as plain text and once compiled as an MOF file (for those that know about such things.)  In the portal, the MOF is a “node configuration” (as opposed to simply “configuration”).</span></span>  <span data-ttu-id="4ea5f-156">Es el artefacto que se asocia con un nodo para que el nodo conozca su configuración.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-156">It’s the artifact that’s associated with a Node so the node will know its configuration.</span></span>  <span data-ttu-id="4ea5f-157">Los siguientes detalles muestran cómo asignar la configuración de nodo al nodo.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-157">Details below show how to assign the node configuration to the node.</span></span>

<span data-ttu-id="4ea5f-158">Se supone que ya está haciendo lo de arriba, al menos en su mayor parte.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-158">Presumably you’re already doing the bit at the top, or most of it.</span></span>  <span data-ttu-id="4ea5f-159">Crear el nuspec, compilarlo y almacenarlo en un servidor NuGet no es muy complicado y, </span><span class="sxs-lookup"><span data-stu-id="4ea5f-159">Creating the nuspec, compiling and storing it in a NuGet server is a small thing.</span></span>  <span data-ttu-id="4ea5f-160">además, ya está administrando máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-160">And you’re already managing VMs.</span></span>  <span data-ttu-id="4ea5f-161">Para dar el siguiente paso en la implementación continua, se debe configurar el servidor de extracción (una vez), registrar los nodos con él (una vez) y crear y almacenar la configuración allí (inicialmente).</span><span class="sxs-lookup"><span data-stu-id="4ea5f-161">Taking the next step to continuous deployment requires setting up the pull server (once), registering your nodes with it (once), and creating and storing the configuration there (initially).</span></span>  <span data-ttu-id="4ea5f-162">Luego, como los paquetes se actualizan e implementan en el repositorio, actualice la configuración y la configuración de nodo en el servidor de extracción (repítalo si es necesario).</span><span class="sxs-lookup"><span data-stu-id="4ea5f-162">Then as packages are upgraded and deployed to the repository, refresh the Configuration and Node Configuration in the pull server (repeat as needed).</span></span>

<span data-ttu-id="4ea5f-163">No comenzar con una plantilla de ARM también es perfectamente válido.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-163">If you’re not starting with an ARM template, that’s also OK.</span></span>  <span data-ttu-id="4ea5f-164">Hay cmdlets de PowerShell diseñados para ayudarlo a registrar sus máquinas virtuales con el servidor de extracción y todo lo demás.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-164">There are PowerShell cmdlets designed to help you register your VMs with the pull server and all of the rest.</span></span> <span data-ttu-id="4ea5f-165">Para obtener más detalles, vea este artículo: [Incorporación de máquinas para administrarlas con DSC de Automatización de Azure](automation-dsc-onboarding.md)</span><span class="sxs-lookup"><span data-stu-id="4ea5f-165">For more details, see this article: [Onboarding machines for management by Azure Automation DSC](automation-dsc-onboarding.md)</span></span>

## <a name="step-1-setting-up-the-pull-server-and-automation-account"></a><span data-ttu-id="4ea5f-166">Paso 1: Configurar la cuenta de automatización y el servidor de extracción</span><span class="sxs-lookup"><span data-stu-id="4ea5f-166">Step 1: Setting up the pull server and automation account</span></span>
<span data-ttu-id="4ea5f-167">En una línea de comandos de PowerShell (Add-AzureRmAccount) autenticada: (puede tardar unos minutos mientras se configura el servidor de extracción)</span><span class="sxs-lookup"><span data-stu-id="4ea5f-167">At an authenticated (Add-AzureRmAccount) PowerShell command line:  (can take a few minutes while the pull server is set up)</span></span>

    New-AzureRmResourceGroup –Name MY-AUTOMATION-RG –Location MY-RG-LOCATION-IN-QUOTES
    New-AzureRmAutomationAccount –ResourceGroupName MY-AUTOMATION-RG –Location MY-RG-LOCATION-IN-QUOTES –Name MY-AUTOMATION-ACCOUNT 

<span data-ttu-id="4ea5f-168">Puede colocar su cuenta de Automation en cualquiera de las siguientes regiones (o ubicaciones): este de EE. UU. 2, centro-sur de EE. UU., Virginia Gob. EE. UU., Europa Occidental, Sudeste Asiático, Japón Oriental, centro de la India y sudeste de Australia, Canadá Central, Europa del Norte.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-168">You can put your automation account into any of the following regions (aka location):  East US 2, South Central US, US Gov Virginia, West Europe, Southeast Asia, Japan East, Central India and Australia Southeast, Canada Central, North Europe.</span></span>

## <a name="step-2-vm-extension-tweaks-to-the-arm-template"></a><span data-ttu-id="4ea5f-169">Paso 2: Ajustes de la extensión de máquina virtual en la plantilla de ARM</span><span class="sxs-lookup"><span data-stu-id="4ea5f-169">Step 2: VM extension tweaks to the ARM template</span></span>
<span data-ttu-id="4ea5f-170">Se proporcionan detalles sobre el registro de máquina virtual (con la extensión de máquina virtual de DSC de PowerShell) en esta [plantilla de inicio rápido de Azure](https://github.com/Azure/azure-quickstart-templates/tree/master/dsc-extension-azure-automation-pullserver).</span><span class="sxs-lookup"><span data-stu-id="4ea5f-170">Details for VM registration (using the PowerShell DSC VM extension) provided in this [Azure Quickstart Template](https://github.com/Azure/azure-quickstart-templates/tree/master/dsc-extension-azure-automation-pullserver).</span></span>  <span data-ttu-id="4ea5f-171">En este paso, se registra la nueva máquina virtual con el servidor de extracción en la lista de nodos de DSC.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-171">This step registers your new VM with the pull server in the list of DSC Nodes.</span></span>  <span data-ttu-id="4ea5f-172">Parte de este registro es especificar la configuración del nodo que se aplica al nodo.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-172">Part of this registration is specifying the node configuration to be applied to the node.</span></span>  <span data-ttu-id="4ea5f-173">Esta configuración de nodo no tiene que existir aún en el servidor de extracción, por lo que es correcto que sea el paso 4 en donde se realice esto por primera vez.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-173">This node configuration doesn't have to exist yet in the pull server, so it's OK that Step 4 is where this is done for the first time.</span></span>  <span data-ttu-id="4ea5f-174">Sin embargo, aquí en el paso 2 debe haber decidido el nombre del nodo y el nombre de la configuración.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-174">But here in Step 2 you do need to have decided the name of the node and the name of the configuration.</span></span>  <span data-ttu-id="4ea5f-175">En este ejemplo de uso, el nodo es "isvbox" y la configuración es "ISVBoxConfig".</span><span class="sxs-lookup"><span data-stu-id="4ea5f-175">In this usage example, the node is 'isvbox' and the configuration is 'ISVBoxConfig'.</span></span>  <span data-ttu-id="4ea5f-176">Por tanto, el nombre de configuración del nodo (que se especificará en DeploymentTemplate.json) es "ISVBoxConfig.isvbox".</span><span class="sxs-lookup"><span data-stu-id="4ea5f-176">So the node configuration name (to be specified in DeploymentTemplate.json) is 'ISVBoxConfig.isvbox'.</span></span>  

## <a name="step-3-adding-required-dsc-resources-to-the-pull-server"></a><span data-ttu-id="4ea5f-177">Paso 3: Agregar recursos de DSC necesarios al servidor de extracción</span><span class="sxs-lookup"><span data-stu-id="4ea5f-177">Step 3: Adding required DSC resources to the pull server</span></span>
<span data-ttu-id="4ea5f-178">La Galería de PowerShell está equipada para instalar recursos de DSC en su cuenta de Automatización de Azure.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-178">The PowerShell Gallery is instrumented to install DSC resources into your Azure Automation account.</span></span>  <span data-ttu-id="4ea5f-179">Desplácese hasta el recurso que desee y haga clic en el botón "Deploy to Azure Automation".</span><span class="sxs-lookup"><span data-stu-id="4ea5f-179">Navigate to the resource you want and click the “Deploy to Azure Automation” button.</span></span>

![Ejemplo de la Galería de PowerShell](./media/automation-dsc-cd-chocolatey/xNetworking.PNG)

<span data-ttu-id="4ea5f-181">Otra técnica agregada hace poco al Portal de Azure permite extraer módulos nuevos o actualizar los existentes.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-181">Another technique recently added to the Azure Portal allows you to pull in new modules or update existing modules.</span></span> <span data-ttu-id="4ea5f-182">Haga clic en el recurso Cuenta de automatización, el icono Activos y, por último, el icono Módulos.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-182">Click through the Automation Account resource, the Assets tile, and finally the Modules tile.</span></span>  <span data-ttu-id="4ea5f-183">El icono de examinar la galería permite ver la lista de módulos de la galería, profundizar en los detalles y, en última instancia, importarlos en su cuenta de automatización.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-183">The Browse Gallery icon allows you to see the list of modules in the gallery, drill down into details and ultimately import into your Automation Account.</span></span> <span data-ttu-id="4ea5f-184">Se trata de un modo excelente de actualizar los módulos de vez en cuando.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-184">This is a great way to keep your modules up to date from time to time.</span></span> <span data-ttu-id="4ea5f-185">Además, la característica de importación comprueba las dependencias con otros módulos para asegurarse de que nada se queda sin sincronizarse.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-185">And, the import feature checks dependencies with other modules to ensure nothing gets out of sync.</span></span>

<span data-ttu-id="4ea5f-186">También podemos aplicar el enfoque manual.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-186">Or, there’s the manual approach.</span></span>  <span data-ttu-id="4ea5f-187">La estructura de carpetas de un módulo de integración de PowerShell para un equipo de Windows es algo diferente de la estructura de carpetas que espera la Automatización de Azure.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-187">The folder structure of a PowerShell Integration Module for a Windows computer is a little different from the folder structure expected by the Azure Automation.</span></span>  <span data-ttu-id="4ea5f-188">Por tanto, es necesario hacer algunos ajustes.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-188">This requires a little tweaking on your part.</span></span>  <span data-ttu-id="4ea5f-189">Pero no es difícil y solo es necesario hacerlos una vez para cada recurso (a menos que desee actualizarlo en el futuro.)  Para más información sobre la creación de módulos de integración de PowerShell, consulte este artículo: [Creación de módulos de integración para Azure Automation](https://azure.microsoft.com/blog/authoring-integration-modules-for-azure-automation/).</span><span class="sxs-lookup"><span data-stu-id="4ea5f-189">But it’s not hard, and it’s done only once per resource (unless you want to upgrade it in future.)  For more information on authoring PowerShell Integration Modules, see this article: [Authoring Integration Modules for Azure Automation](https://azure.microsoft.com/blog/authoring-integration-modules-for-azure-automation/)</span></span>

* <span data-ttu-id="4ea5f-190">Instale el módulo que necesita en su estación de trabajo, como sigue:</span><span class="sxs-lookup"><span data-stu-id="4ea5f-190">Install the module that you need on your workstation, as follows:</span></span>
  * <span data-ttu-id="4ea5f-191">Instale [Windows Management Framework, v5](http://aka.ms/wmf5latest) (no es necesario para Windows 10).</span><span class="sxs-lookup"><span data-stu-id="4ea5f-191">Install [Windows Management Framework, v5](http://aka.ms/wmf5latest) (not needed for Windows 10)</span></span>
  * <span data-ttu-id="4ea5f-192">`Install-Module –Name MODULE-NAME` <—toma el módulo de la Galería de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-192">`Install-Module –Name MODULE-NAME`    <—grabs the module from the PowerShell Gallery</span></span> 
* <span data-ttu-id="4ea5f-193">Copie la carpeta del módulo de `c:\Program Files\WindowsPowerShell\Modules\MODULE-NAME` a una carpeta temporal.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-193">Copy the module folder from `c:\Program Files\WindowsPowerShell\Modules\MODULE-NAME` to a temp folder</span></span> 
* <span data-ttu-id="4ea5f-194">Elimine los ejemplos y la documentación de la carpeta principal.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-194">Delete samples and documentation from the main folder</span></span> 
* <span data-ttu-id="4ea5f-195">Comprima la carpeta principal y asigne al archivo comprimido el mismo nombre que la carpeta.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-195">Zip the main folder, naming the ZIP file exactly the same as the folder</span></span> 
* <span data-ttu-id="4ea5f-196">Coloque el archivo comprimido en una ubicación HTTP accesible, como Almacenamiento de blobs en una cuenta de Almacenamiento de Azure.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-196">Put the ZIP file into a reachable HTTP location, such as blob storage in an Azure Storage Account.</span></span>
* <span data-ttu-id="4ea5f-197">Ejecute este código de PowerShell:</span><span class="sxs-lookup"><span data-stu-id="4ea5f-197">Run this PowerShell:</span></span>
  
      New-AzureRmAutomationModule `
          -ResourceGroupName MY-AUTOMATION-RG -AutomationAccountName MY-AUTOMATION-ACCOUNT `
          -Name MODULE-NAME –ContentLink "https://STORAGE-URI/CONTAINERNAME/MODULE-NAME.zip"

<span data-ttu-id="4ea5f-198">El ejemplo incluido realiza estos pasos para cChoco y xNetworking.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-198">The included example performs these steps for cChoco and xNetworking.</span></span> <span data-ttu-id="4ea5f-199">Consulte las [Notas](#notes) del control especial para cChoco.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-199">See the [Notes](#notes) for special handling for cChoco.</span></span>

## <a name="step-4-adding-the-node-configuration-to-the-pull-server"></a><span data-ttu-id="4ea5f-200">Paso 4: Agregar la configuración de nodo al servidor de extracción</span><span class="sxs-lookup"><span data-stu-id="4ea5f-200">Step 4: Adding the node configuration to the pull server</span></span>
<span data-ttu-id="4ea5f-201">No hay nada especial que mencionar acerca de la primera vez que se importa la configuración al servidor de extracción y se compila.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-201">There’s nothing special about the first time you import your configuration into the pull server and compile.</span></span>  <span data-ttu-id="4ea5f-202">Todas las importaciones y compilaciones posteriores de la misma configuración tendrán exactamente el mismo aspecto.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-202">All subsequent import/compiles of the same configuration look exactly the same.</span></span>  <span data-ttu-id="4ea5f-203">Cada vez que actualice el paquete y deba enviarlo a producción, realice este paso después de asegurarse de que el archivo de configuración sea correcto, incluida la nueva versión del paquete.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-203">Each time you update your package and need to push it out to production you do this step after ensuring the configuration file is correct – including the new version of your package.</span></span>  <span data-ttu-id="4ea5f-204">Este es el archivo de configuración y el código de PowerShell:</span><span class="sxs-lookup"><span data-stu-id="4ea5f-204">Here’s the configuration file and PowerShell:</span></span>

<span data-ttu-id="4ea5f-205">ISVBoxConfig.ps1:</span><span class="sxs-lookup"><span data-stu-id="4ea5f-205">ISVBoxConfig.ps1:</span></span>

    Configuration ISVBoxConfig 
    { 
        Import-DscResource -ModuleName cChoco 
        Import-DscResource -ModuleName xNetworking

        Node "isvbox" {   

            cChocoInstaller installChoco 
            { 
                InstallDir = "C:\choco" 
            }

            WindowsFeature installIIS 
            { 
                Ensure="Present" 
                Name="Web-Server" 
            }

            xFirewall WebFirewallRule 
            { 
                Direction = "Inbound" 
                Name = "Web-Server-TCP-In" 
                DisplayName = "Web Server (TCP-In)" 
                Description = "IIS allow incoming web site traffic." 
                DisplayGroup = "IIS Incoming Traffic" 
                State = "Enabled" 
                Access = "Allow" 
                Protocol = "TCP" 
                LocalPort = "80" 
                Ensure = "Present" 
            }

            cChocoPackageInstaller trivialWeb 
            {            
                Name = "trivialweb" 
                Version = "1.0.0" 
                Source = “MY-NUGET-V2-SERVER-ADDRESS” 
                DependsOn = "[cChocoInstaller]installChoco", 
                "[WindowsFeature]installIIS" 
            } 
        }    
    }

<span data-ttu-id="4ea5f-206">New-ConfigurationScript.ps1:</span><span class="sxs-lookup"><span data-stu-id="4ea5f-206">New-ConfigurationScript.ps1:</span></span>

    Import-AzureRmAutomationDscConfiguration ` 
        -ResourceGroupName MY-AUTOMATION-RG –AutomationAccountName MY-AUTOMATION-ACCOUNT ` 
        -SourcePath C:\temp\AzureAutomationDsc\ISVBoxConfig.ps1 ` 
        -Published –Force

    $jobData = Start-AzureRmAutomationDscCompilationJob ` 
        -ResourceGroupName MY-AUTOMATION-RG –AutomationAccountName MY-AUTOMATION-ACCOUNT ` 
        -ConfigurationName ISVBoxConfig 

    $compilationJobId = $jobData.Id

    Get-AzureRmAutomationDscCompilationJob ` 
        -ResourceGroupName MY-AUTOMATION-RG –AutomationAccountName MY-AUTOMATION-ACCOUNT ` 
        -Id $compilationJobId

<span data-ttu-id="4ea5f-207">Estos pasos dan como resultado que se coloque una nueva configuración de nodo denominada "ISVBoxConfig.isvbox" en el servidor de extracción.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-207">These steps result in a new node configuration named “ISVBoxConfig.isvbox” being placed on the pull server.</span></span>  <span data-ttu-id="4ea5f-208">El nombre de configuración del nodo se crea como "configurationName.nodeName".</span><span class="sxs-lookup"><span data-stu-id="4ea5f-208">The node configuration name is built as “configurationName.nodeName”.</span></span>

## <a name="step-5-creating-and-maintaining-package-metadata"></a><span data-ttu-id="4ea5f-209">Paso 5: Crear y mantener los metadatos del paquete</span><span class="sxs-lookup"><span data-stu-id="4ea5f-209">Step 5: Creating and maintaining package metadata</span></span>
<span data-ttu-id="4ea5f-210">Cada paquete que incluya en el repositorio de paquetes necesita un nuspec que lo describa.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-210">For each package that you put into the package repository, you need a nuspec that describes it.</span></span>  <span data-ttu-id="4ea5f-211">Ese nuspec se debe compilar y almacenar en el servidor NuGet.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-211">That nuspec must be compiled and stored in your NuGet server.</span></span> <span data-ttu-id="4ea5f-212">Este proceso se describe [aquí](http://docs.nuget.org/create/creating-and-publishing-a-package).</span><span class="sxs-lookup"><span data-stu-id="4ea5f-212">This process is described [here](http://docs.nuget.org/create/creating-and-publishing-a-package).</span></span>  <span data-ttu-id="4ea5f-213">Puede usar MyGet.org como servidor NuGet.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-213">You can use MyGet.org as a NuGet server.</span></span>  <span data-ttu-id="4ea5f-214">Se vende este servicio, pero también se ofrece una SKU de inicio gratuita.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-214">They sell this service, but have a starter SKU that’s free.</span></span>  <span data-ttu-id="4ea5f-215">En NuGet.org encontrará instrucciones para instalar su propio servidor NuGet para los paquetes privados.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-215">At NuGet.org you’ll find instructions on installing your own NuGet server for your private packages.</span></span>

## <a name="step-6-tying-it-all-together"></a><span data-ttu-id="4ea5f-216">Paso 6: Unión de todos los elementos</span><span class="sxs-lookup"><span data-stu-id="4ea5f-216">Step 6: Tying it all together</span></span>
<span data-ttu-id="4ea5f-217">Cada vez que una versión pasa un control de calidad y se aprueba para implementación, se crea el paquete, se actualizan nuspec y nupkg, y se implementan en el servidor NuGet.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-217">Each time a version passes QA and is approved for deployment, the package is created, nuspec and nupkg updated and deployed to the NuGet server.</span></span>  <span data-ttu-id="4ea5f-218">Además, se debe actualizar la configuración (el paso 4 anterior) para que coincida con el nuevo número de versión.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-218">In addition, the configuration (Step 4 above) must be updated to agree with the new version number.</span></span>  <span data-ttu-id="4ea5f-219">Se debe enviar al servidor de extracción y se debe compilar.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-219">It must be sent to the pull server and compiled.</span></span>  <span data-ttu-id="4ea5f-220">Desde ese momento, corresponderá a las máquinas virtuales que dependen de esa configuración extraer la actualización e instalarla.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-220">From that point on, it's up to the VMs that depend on that configuration to pull the update and install it.</span></span>  <span data-ttu-id="4ea5f-221">Cada una de estas actualizaciones son sencillas: solo una línea o dos de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-221">Each of these updates are simple - just a line or two of PowerShell.</span></span>  <span data-ttu-id="4ea5f-222">En el caso de Visual Studio Team Services, algunas de ellas se encapsulan en tareas de compilación que se pueden encadenar de manera conjunta en una compilación.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-222">In the case of Visual Studio Team Services, some of them are encapsulated in build tasks that can be chained together in a build.</span></span>  <span data-ttu-id="4ea5f-223">En [este artículo](https://www.visualstudio.com/en-us/docs/alm-devops-feature-index#continuous-delivery) se ofrecen más detalles.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-223">This [article](https://www.visualstudio.com/en-us/docs/alm-devops-feature-index#continuous-delivery) provides more details.</span></span>  <span data-ttu-id="4ea5f-224">En este [repositorio de GitHub](https://github.com/Microsoft/vso-agent-tasks) se detallan las diversas tareas de compilación disponibles.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-224">This [GitHub repo](https://github.com/Microsoft/vso-agent-tasks) details the various available build tasks.</span></span>

## <a name="notes"></a><span data-ttu-id="4ea5f-225">Notas</span><span class="sxs-lookup"><span data-stu-id="4ea5f-225">Notes</span></span>
<span data-ttu-id="4ea5f-226">Este ejemplo de uso comienza con una máquina virtual de una imagen genérica de Windows Server 2012 R2 procedente de la galería de Azure.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-226">This usage example starts with a VM from a generic Windows Server 2012 R2 image from the Azure gallery.</span></span>  <span data-ttu-id="4ea5f-227">Puede iniciarla desde cualquier imagen almacenada y después ajustarla con la configuración de DSC.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-227">You can start from any stored image and then tweak from there with the DSC configuration.</span></span>  <span data-ttu-id="4ea5f-228">Sin embargo, cambiar la configuración que se incluye en una imagen es mucho más difícil que actualizar dinámicamente la configuración con DSC.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-228">However, changing configuration that is baked into an image is much harder than dynamically updating the configuration using DSC.</span></span>

<span data-ttu-id="4ea5f-229">No es necesario usar una plantilla de ARM ni la extensión de máquina virtual para emplear esta técnica con sus máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-229">You don’t have to use an ARM template and the VM extension to use this technique with your VMs.</span></span>  <span data-ttu-id="4ea5f-230">Además, sus máquinas virtuales tampoco tienen que estar en Azure para administrarlas mediante CD.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-230">And your VMs don’t have to be on Azure to be under CD management.</span></span>  <span data-ttu-id="4ea5f-231">Todo lo que se necesita es que Chocolatey esté instalado y LCM esté configurado en la máquina virtual para que conozca la ubicación del servidor de extracción.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-231">All that’s necessary is that Chocolatey be installed and the LCM configured on the VM so it knows where the pull server is.</span></span>  

<span data-ttu-id="4ea5f-232">Por supuesto, cuando se actualiza un paquete en una máquina virtual que se encuentra en producción, debe sacar esa máquina virtual de producción mientras se instala la actualización.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-232">Of course, when you update a package on a VM that’s in production, you need to take that VM out of rotation while the update is installed.</span></span>  <span data-ttu-id="4ea5f-233">Existen métodos muy diversos de hacerlo.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-233">How you do this varies widely.</span></span>  <span data-ttu-id="4ea5f-234">Por ejemplo, con una máquina virtual tras un equilibrador de carga de Azure, puede agregar un sondeo personalizado.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-234">For example, with a VM behind an Azure Load Balancer, you can add a Custom Probe.</span></span>  <span data-ttu-id="4ea5f-235">Al actualizar la máquina virtual, haga que el extremo de sondeo devuelva 400.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-235">While updating the VM, have the probe endpoint return a 400.</span></span>  <span data-ttu-id="4ea5f-236">El ajuste necesario para ocasionar este cambio puede estar dentro de la configuración, al igual que el ajuste para devolver de nuevo 200 una vez completada la actualización.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-236">The tweak necessary to cause this change can be inside your configuration, as can the tweak to switch it back to returning a 200 once the update is complete.</span></span>

<span data-ttu-id="4ea5f-237">El código fuente completo de este ejemplo de uso se encuentra en [este proyecto de Visual Studio](https://github.com/sebastus/ARM/tree/master/CDIaaSVM) en GitHub.</span><span class="sxs-lookup"><span data-stu-id="4ea5f-237">Full source for this usage example is in [this Visual Studio project](https://github.com/sebastus/ARM/tree/master/CDIaaSVM) on GitHub.</span></span>

## <a name="related-articles"></a><span data-ttu-id="4ea5f-238">Artículos relacionados</span><span class="sxs-lookup"><span data-stu-id="4ea5f-238">Related Articles</span></span>
* [<span data-ttu-id="4ea5f-239">Información general de DSC de Automatización de Azure</span><span class="sxs-lookup"><span data-stu-id="4ea5f-239">Azure Automation DSC Overview</span></span>](automation-dsc-overview.md)
* [<span data-ttu-id="4ea5f-240">Cmdlets de DSC de Automatización de Azure</span><span class="sxs-lookup"><span data-stu-id="4ea5f-240">Azure Automation DSC cmdlets</span></span>](https://msdn.microsoft.com/library/mt244122.aspx)
* [<span data-ttu-id="4ea5f-241">Incorporación de máquinas para administrarlas con DSC de Automatización de Azure</span><span class="sxs-lookup"><span data-stu-id="4ea5f-241">Onboarding machines for management by Azure Automation DSC</span></span>](automation-dsc-onboarding.md)


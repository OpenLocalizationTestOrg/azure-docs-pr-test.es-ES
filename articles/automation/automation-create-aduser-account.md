---
title: "Creación de una cuenta de usuario de Azure AD | Microsoft Docs"
description: "En este artículo se describe cómo crear credenciales de cuentas de usuario de Azure AD para runbooks en Azure Automation para autenticarse en Azure y en Azure clásico."
services: automation
documentationcenter: 
author: MGoedtel
manager: jwhit
editor: tysonn
keywords: "usuario de azure active directory, administración de servicios de azure, cuenta de usuario de azure ad"
ms.assetid: fcfe266d-b22e-4dfb-8272-adcab09fc0cf
ms.service: automation
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/13/2017
ms.author: magoedte
ms.openlocfilehash: 4eaa3e36ededddeb5268ec4f49b9daee2f824cee
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/18/2017
---
# <a name="authenticate-runbooks-with-azure-classic-deployment-and-resource-manager"></a><span data-ttu-id="2940e-104">Autenticación de runbooks con la implementación clásica de Azure y Resource Manager</span><span class="sxs-lookup"><span data-stu-id="2940e-104">Authenticate Runbooks with Azure classic deployment and Resource Manager</span></span>
<span data-ttu-id="2940e-105">En este artículo se describen los pasos que debe realizar para configurar una cuenta de usuario de Azure AD para runbooks de Azure Automation que se ejecutan en recursos del modelo de implementación clásica de Azure o en Azure Resource Manager (ARM).</span><span class="sxs-lookup"><span data-stu-id="2940e-105">This article describes the steps you must perform to configure an Azure AD User account for Azure Automation runbooks running against Azure classic deployment model or Azure Resource Manager resources.</span></span>  <span data-ttu-id="2940e-106">Aunque esta sigue siendo una identidad de autenticación admitida para sus runbooks basados en Azure Resource Manager, el método recomendado es usar una cuenta de ejecución de Azure.</span><span class="sxs-lookup"><span data-stu-id="2940e-106">While this continues to be a supported authentication identity for your Azure Resource Manager based runbooks, the recommended method is using an Azure Run As account.</span></span>       

## <a name="create-a-new-azure-active-directory-user"></a><span data-ttu-id="2940e-107">Creación de un usuario de Azure Active Directory nuevo</span><span class="sxs-lookup"><span data-stu-id="2940e-107">Create a new Azure Active Directory user</span></span>
1. <span data-ttu-id="2940e-108">Inicie sesión en el Portal de Azure clásico como administrador de servicios para la suscripción de Azure que desea administrar.</span><span class="sxs-lookup"><span data-stu-id="2940e-108">Log in to the Azure Classic portal as a service administrator for the Azure subscription you want to manage.</span></span>
2. <span data-ttu-id="2940e-109">Haga clic en **Active Directory**y seleccione el nombre del directorio de su organización.</span><span class="sxs-lookup"><span data-stu-id="2940e-109">Select **Active Directory**, and then select the name of your organization directory.</span></span>
3. <span data-ttu-id="2940e-110">Seleccione la pestaña **Usuarios** y, en el área de comandos, seleccione **Agregar usuario**.</span><span class="sxs-lookup"><span data-stu-id="2940e-110">Select the **Users** tab, and then, in the command area, select **Add User**.</span></span>
4. <span data-ttu-id="2940e-111">En la página **Proporcione información sobre este usuario**, en **Tipo de usuario**, seleccione **Nuevo usuario de la organización**.</span><span class="sxs-lookup"><span data-stu-id="2940e-111">On the **Tell us about this user** page, under **Type of user**, select **New user in your organization**.</span></span>
5. <span data-ttu-id="2940e-112">Escriba un nombre de usuario.</span><span class="sxs-lookup"><span data-stu-id="2940e-112">Enter a user name.</span></span>  
6. <span data-ttu-id="2940e-113">Seleccione el nombre del directorio asociado con su suscripción de Azure en la página Active Directory.</span><span class="sxs-lookup"><span data-stu-id="2940e-113">Select the directory name that is associated with your Azure subscription on the Active Directory page.</span></span>
7. <span data-ttu-id="2940e-114">En la página **Perfil de usuario**, especifique el nombre, los apellidos y un nombre descriptivo, así como un usuario de la lista **Roles**.</span><span class="sxs-lookup"><span data-stu-id="2940e-114">On the **user profile** page, provide a first and last name, a user-friendly name, and User from the **Roles** list.</span></span>  <span data-ttu-id="2940e-115">No seleccione **Habilitar Multi-Factor Authentication**.</span><span class="sxs-lookup"><span data-stu-id="2940e-115">Do not **Enable Multi-Factor Authentication**.</span></span>
8. <span data-ttu-id="2940e-116">Observe el nombre completo y la contraseña temporal del usuario.</span><span class="sxs-lookup"><span data-stu-id="2940e-116">Note the user’s full name and temporary password.</span></span>
9. <span data-ttu-id="2940e-117">Seleccione **Configuración > Administradores > Agregar**.</span><span class="sxs-lookup"><span data-stu-id="2940e-117">Select **Settings > Administrators > Add**.</span></span>
10. <span data-ttu-id="2940e-118">Escriba el nombre de usuario completo del usuario que creó.</span><span class="sxs-lookup"><span data-stu-id="2940e-118">Type the full user name of the user that you created.</span></span>
11. <span data-ttu-id="2940e-119">Seleccione la suscripción que desea que administre el usuario.</span><span class="sxs-lookup"><span data-stu-id="2940e-119">Select the subscription that you want the user to manage.</span></span>
12. <span data-ttu-id="2940e-120">Cierre sesión en Azure y vuelva a iniciarla con la cuenta que acaba de crear.</span><span class="sxs-lookup"><span data-stu-id="2940e-120">Log out of Azure and then log back in with the account you just created.</span></span> <span data-ttu-id="2940e-121">Se le pedirá que cambie la contraseña del usuario.</span><span class="sxs-lookup"><span data-stu-id="2940e-121">You will be prompted to change the user’s password.</span></span>

## <a name="create-an-automation-account-in-azure-classic-portal"></a><span data-ttu-id="2940e-122">Creación de una cuenta de Automation en el Portal de Azure clásico</span><span class="sxs-lookup"><span data-stu-id="2940e-122">Create an Automation account in Azure Classic portal</span></span>
<span data-ttu-id="2940e-123">En esta sección, llevará a cabo los pasos siguientes en Azure Portal para crear una cuenta de Azure Automation que se usará con sus recursos de administración de runbooks en la implementación clásica de Azure.</span><span class="sxs-lookup"><span data-stu-id="2940e-123">In this section, you perform the following steps to create an Azure Automation account in the Azure portal for use with your runbooks managing resources in Azure classic deployment.</span></span>  

> [!NOTE]
> <span data-ttu-id="2940e-124">Las cuentas de Automation que se crean con el Portal de Azure clásico se pueden administrar tanto con el Portal clásico como con Azure Portal, y con cualquiera de los conjuntos de cmdlets.</span><span class="sxs-lookup"><span data-stu-id="2940e-124">Automation accounts created with the Azure Classic portal can be managed by both the Azure Classic and Azure portal and either set of cmdlets.</span></span> <span data-ttu-id="2940e-125">Tras crear la cuenta da igual la forma en que cree y administre los recursos en la misma.</span><span class="sxs-lookup"><span data-stu-id="2940e-125">Once the account is created, it makes no difference how you create and manage resources within the account.</span></span> <span data-ttu-id="2940e-126">Si piensa seguir usando el Portal de Azure clásico, debe utilizarlo en lugar de Azure Portal para crear las cuentas de Automation.</span><span class="sxs-lookup"><span data-stu-id="2940e-126">If you are planning to continue to use the Azure Classic portal, then you should use it instead of the Azure portal to create any Automation accounts.</span></span>
> 
> 

1. <span data-ttu-id="2940e-127">Inicie sesión en el Portal de Azure clásico como administrador de servicios para la suscripción de Azure que desea administrar.</span><span class="sxs-lookup"><span data-stu-id="2940e-127">Log in to the Azure Classic portal as a service administrator for the Azure subscription you want to manage.</span></span>
2. <span data-ttu-id="2940e-128">Seleccione **Automation**.</span><span class="sxs-lookup"><span data-stu-id="2940e-128">Select **Automation**.</span></span>
3. <span data-ttu-id="2940e-129">En la página **Automation**, seleccione **Crear una cuenta de Automation**.</span><span class="sxs-lookup"><span data-stu-id="2940e-129">On the **Automation** page, select **Create an Automation Account**.</span></span>
4. <span data-ttu-id="2940e-130">En el cuadro **Crear una cuenta de Automation**, escriba un nombre para la nueva cuenta de Automation y seleccione una **Región** en la lista desplegable.</span><span class="sxs-lookup"><span data-stu-id="2940e-130">In the **Create an Automation Account** box, type in a name for your new Automation account and select a **Region** from the drop-down list.</span></span>  
5. <span data-ttu-id="2940e-131">Haga clic en **Aceptar** para aceptar la configuración y crear la cuenta.</span><span class="sxs-lookup"><span data-stu-id="2940e-131">Click **OK** to accept your settings and create the account.</span></span>
6. <span data-ttu-id="2940e-132">Después de crearla, se mostrará en la página **Automation** .</span><span class="sxs-lookup"><span data-stu-id="2940e-132">After it is created it will be listed on the **Automation** page.</span></span>
7. <span data-ttu-id="2940e-133">Haga clic en la cuenta y le llevará a la página Panel.</span><span class="sxs-lookup"><span data-stu-id="2940e-133">Click on the account and it will bring you to the Dashboard page.</span></span>  
8. <span data-ttu-id="2940e-134">En la página Automation Dashboard (Panel de Automation), seleccione **Recursos**.</span><span class="sxs-lookup"><span data-stu-id="2940e-134">On the Automation Dashboard page, select **Assets**.</span></span>
9. <span data-ttu-id="2940e-135">En la página **Recursos**, seleccione **Agregar configuración** que se encuentra en la parte inferior de la página.</span><span class="sxs-lookup"><span data-stu-id="2940e-135">On the **Assets** page, select **Add Settings** located at the bottom of the page.</span></span>
10. <span data-ttu-id="2940e-136">En la página **Agregar configuración**, seleccione **Agregar credencial**.</span><span class="sxs-lookup"><span data-stu-id="2940e-136">On the **Add Settings** page, select **Add Credential**.</span></span>
11. <span data-ttu-id="2940e-137">En la página **Definir credenciales**, seleccione **Credenciales de Windows PowerShell** de la lista desplegable **Tipo de credenciales** y escriba un nombre para las credenciales.</span><span class="sxs-lookup"><span data-stu-id="2940e-137">On the **Define Credential** page, select **Windows PowerShell Credential** from the **Credential Type** drop-down list and provide a name for the credential.</span></span>
12. <span data-ttu-id="2940e-138">En la página **Definir credenciales** siguiente, escriba el nombre de usuario de la cuenta de AD creada anteriormente en el campo **Nombre de usuario** y la contraseña en los campos **Contraseña** y **Confirmar contraseña**.</span><span class="sxs-lookup"><span data-stu-id="2940e-138">On the following **Define Credential** page type in the username of the AD user account created earlier in the **User Name** field and the password in the **Password** and **Confirm Password** fields.</span></span> <span data-ttu-id="2940e-139">Haga clic en **Aceptar** para guardar los cambios.</span><span class="sxs-lookup"><span data-stu-id="2940e-139">Click **OK** to save your changes.</span></span>

## <a name="create-an-automation-account-in-the-azure-portal"></a><span data-ttu-id="2940e-140">Creación de una cuenta de Automation en Azure Portal</span><span class="sxs-lookup"><span data-stu-id="2940e-140">Create an Automation account in the Azure portal</span></span>
<span data-ttu-id="2940e-141">En esta sección, realizará los pasos siguientes en Azure Portal para crear una cuenta de Azure Automation que se usará con sus recursos de administración de runbooks en el modo de Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="2940e-141">In this section, perform the following steps to create an Azure Automation account in the Azure portal for use with your runbooks managing resources in Azure Resource Manager mode.</span></span>  

1. <span data-ttu-id="2940e-142">Inicie sesión en Azure Portal como administrador de servicios para la suscripción de Azure que desea administrar.</span><span class="sxs-lookup"><span data-stu-id="2940e-142">Log in to the Azure portal as a service administrator for the Azure subscription you want to manage.</span></span>
2. <span data-ttu-id="2940e-143">Seleccione **Cuentas de Automation**.</span><span class="sxs-lookup"><span data-stu-id="2940e-143">Select **Automation Accounts**.</span></span>
3. <span data-ttu-id="2940e-144">En la hoja Cuentas de Automation, haga clic en **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="2940e-144">In the Automation Accounts blade, click **Add**.</span></span><br><br><span data-ttu-id="2940e-145">![Agregar cuenta de Automation](media/automation-create-aduser-account/add-automation-acct-properties.png)</span><span class="sxs-lookup"><span data-stu-id="2940e-145">![Add Automation Account](media/automation-create-aduser-account/add-automation-acct-properties.png)</span></span>
4. <span data-ttu-id="2940e-146">En la hoja **Agregar cuenta de Automation**, en el cuadro **Nombre**, especifique un nombre para la nueva cuenta de Automation.</span><span class="sxs-lookup"><span data-stu-id="2940e-146">In the **Add Automation Account** blade, in the **Name** box type in a name for your new Automation account.</span></span>
5. <span data-ttu-id="2940e-147">Si tiene más de una suscripción, especifique la de la cuenta nueva, así como un **grupo de recursos** nuevo o existente, y la **ubicación** de un centro de datos de Azure.</span><span class="sxs-lookup"><span data-stu-id="2940e-147">If you have more than one subscription, specify the one for the new account, as well as a new or existing **Resource group** and an Azure datacenter **Location**.</span></span>
6. <span data-ttu-id="2940e-148">Seleccione el valor **Sí** en la opción **Crear cuenta de ejecución de Azure** y haga clic en el botón **Crear**.</span><span class="sxs-lookup"><span data-stu-id="2940e-148">Select the value **Yes** for the **Create Azure Run As account** option, and click the **Create** button.</span></span>  
   
    > [!NOTE]
    > <span data-ttu-id="2940e-149">Si decide seleccionar la opción **No** porque no quiere crear la cuenta de ejecución, aparecerá un mensaje de advertencia en la hoja **Agregar cuenta de Automation**.</span><span class="sxs-lookup"><span data-stu-id="2940e-149">If you choose to not create the Run As account by selecting the option **No**, you will be presented with a warning message in the **Add Automation Account** blade.</span></span>  <span data-ttu-id="2940e-150">Aunque la cuenta se crea y se asigna al rol de **Colaborador** en la suscripción, esta no tendrá la identidad de autenticación correspondiente dentro del servicio de directorio de suscripciones y, por lo tanto, no tendrá acceso a los recursos de su suscripción.</span><span class="sxs-lookup"><span data-stu-id="2940e-150">While the account is created and assigned to the **Contributor** role in the subscription, it will not have a corresponding authentication identity within your subscriptions directory service and therefore, no access resources in your subscription.</span></span>  <span data-ttu-id="2940e-151">Esto impedirá que los Runbooks que hacen referencia a esta cuenta puedan autenticarse y realizar tareas en los recursos de Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="2940e-151">This will prevent any runbooks referencing this account from being able to authenticate and perform tasks against Azure Resource Manager resources.</span></span>
    > 
    >

    <br>![Advertencia para agregar cuenta de Automation](media/automation-create-aduser-account/add-automation-acct-properties-error.png)<br>  
7. <span data-ttu-id="2940e-153">Mientras Azure crea la cuenta de Automation, se puede seguir el progreso de **Notificaciones** desde el menú.</span><span class="sxs-lookup"><span data-stu-id="2940e-153">While Azure creates the Automation account, you can track the progress under **Notifications** from the menu.</span></span>

<span data-ttu-id="2940e-154">Después de completar la creación de las credenciales, necesitará crear un recurso de credenciales para asociar la cuenta de Automation con la cuenta de usuario de AD que creó anteriormente.</span><span class="sxs-lookup"><span data-stu-id="2940e-154">When the creation of the credential is completed, you need to create a Credential Asset to associate the Automation Account with the AD User account created earlier.</span></span>  <span data-ttu-id="2940e-155">Recuerde que solo creamos la cuenta de Automation y que no está asociada con una identidad de autenticación.</span><span class="sxs-lookup"><span data-stu-id="2940e-155">Remember, we only created the Automation account and it is not associated with an authentication identity.</span></span>  <span data-ttu-id="2940e-156">Siga los pasos descritos en el artículo [Recursos de credenciales en Azure Automation](automation-credentials.md#creating-a-new-credential-asset) y escriba el valor de **nombre de usuario** con el formato **dominio\usuario**.</span><span class="sxs-lookup"><span data-stu-id="2940e-156">Perform the steps outlined in the [Credential assets in Azure Automation article](automation-credentials.md#creating-a-new-credential-asset) and enter the value for **username** in the format **domain\user**.</span></span>

## <a name="use-the-credential-in-a-runbook"></a><span data-ttu-id="2940e-157">Uso de la credencial en un runbook</span><span class="sxs-lookup"><span data-stu-id="2940e-157">Use the credential in a runbook</span></span>
<span data-ttu-id="2940e-158">Puede recuperar la credencial en un runbook mediante el uso de la actividad [Get-AutomationPSCredential](http://msdn.microsoft.com/library/dn940015.aspx) y, a continuación, úsela con [Add-AzureAccount](http://msdn.microsoft.com/library/azure/dn722528.aspx) para conectarse a su suscripción de Azure.</span><span class="sxs-lookup"><span data-stu-id="2940e-158">You can retrieve the credential in a runbook using the [Get-AutomationPSCredential](http://msdn.microsoft.com/library/dn940015.aspx) activity and then use it with [Add-AzureAccount](http://msdn.microsoft.com/library/azure/dn722528.aspx) to connect to your Azure subscription.</span></span> <span data-ttu-id="2940e-159">Si credencial es un administrador de varias suscripciones de Azure, deberá usar también [Select-AzureSubscription](http://msdn.microsoft.com/library/dn495203.aspx) para especificar la suscripción correcta.</span><span class="sxs-lookup"><span data-stu-id="2940e-159">If the credential is an administrator of multiple Azure subscriptions, then you should also use [Select-AzureSubscription](http://msdn.microsoft.com/library/dn495203.aspx) to specify the correct one.</span></span> <span data-ttu-id="2940e-160">Esto se muestra en el ejemplo de Windows PowerShell que aparece a continuación, que normalmente aparecerá en la parte superior de la mayoría de los runbooks de Azure Automation.</span><span class="sxs-lookup"><span data-stu-id="2940e-160">This is shown in the sample Windows PowerShell below that will typically appear at the top of most Azure Automation runbooks.</span></span>

    $cred = Get-AutomationPSCredential –Name "myuseraccount.onmicrosoft.com"
    Add-AzureAccount –Credential $cred
    Select-AzureSubscription –SubscriptionName "My Subscription"

<span data-ttu-id="2940e-161">Deberá repetir estas líneas después de cada [punto de control](http://technet.microsoft.com/library/dn469257.aspx#bk_Checkpoints) de su runbook.</span><span class="sxs-lookup"><span data-stu-id="2940e-161">You should repeat these lines after any [checkpoints](http://technet.microsoft.com/library/dn469257.aspx#bk_Checkpoints) in your runbook.</span></span> <span data-ttu-id="2940e-162">Si el runbook se suspende y luego se reanuda en otro trabajo, se deberá volver a realizar la autenticación.</span><span class="sxs-lookup"><span data-stu-id="2940e-162">If the runbook is suspended and then resumes on another worker, then it will need to perform the authentication again.</span></span>

## <a name="next-steps"></a><span data-ttu-id="2940e-163">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="2940e-163">Next Steps</span></span>
* <span data-ttu-id="2940e-164">Revise los tipos de runbook diferentes y los pasos necesarios para crear sus propios runbooks en el siguiente artículo [Tipos de runbooks de Azure Automation](automation-runbook-types.md)</span><span class="sxs-lookup"><span data-stu-id="2940e-164">Review the different runbook types and steps for creating your own runbooks from the following article [Azure Automation runbook types](automation-runbook-types.md)</span></span>


---
title: "Diseño de un servicio de alta disponibilidad con Azure SQL Database | Microsoft Docs"
description: "Obtenga información sobre el diseño de aplicaciones para servicios de alta disponibilidad con Azure SQL Database."
keywords: "recuperación ante desastres en la nube, soluciones de recuperación ante desastres, copia de seguridad de datos de aplicación, planificación de continuidad del negocio"
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: e8a346ac-dd08-41e7-9685-46cebca04582
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 04/21/2017
ms.author: sashan
ms.openlocfilehash: 40fe0ae04eb94322356ed19773512e3bc383639c
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="designing-highly-available-services-using-azure-sql-database"></a><span data-ttu-id="eb73e-104">Diseño de servicios de alta disponibilidad con Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="eb73e-104">Designing highly available services using Azure SQL Database</span></span>

<span data-ttu-id="eb73e-105">Al compilar e implementar servicios de alta disponibilidad en Azure SQL Database, use los [grupos de conmutación por error y la replicación geográfica activa](sql-database-geo-replication-overview.md) para proporcionar resistencia frente a errores regionales e interrupciones graves, así como para habilitar la recuperación rápida en las bases de datos secundarias.</span><span class="sxs-lookup"><span data-stu-id="eb73e-105">When building and deploying highly available services on Azure SQL Database, you use [failover groups and active geo-replication](sql-database-geo-replication-overview.md) to provide resilience to regional failures and catastrophic outages and enable fast recovery to the secondary databases.</span></span> <span data-ttu-id="eb73e-106">Este artículo se centra en los patrones comunes de aplicaciones y trata las ventajas e inconvenientes de cada opción en función de los requisitos de implementación de las aplicaciones, el Acuerdo de Nivel de Servicio objetivo, la latencia de tráfico y los costos.</span><span class="sxs-lookup"><span data-stu-id="eb73e-106">This article focuses on common application patterns and discusses the benefits and trade-offs of each option depending on the application deployment requirements, the service level agreement you are targeting, traffic latency, and costs.</span></span> <span data-ttu-id="eb73e-107">Para saber cómo utilizar la replicación geográfica activa con los grupos elásticos, consulte [Estrategias de recuperación ante desastres para aplicaciones que usan el grupo elástico de Base de datos SQL](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="eb73e-107">For information about active geo-replication with Elastic Pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>

## <a name="design-pattern-1-active-passive-deployment-for-cloud-disaster-recovery-with-a-co-located-database"></a><span data-ttu-id="eb73e-108">Patrón de diseño 1: implementación activa-pasiva para la recuperación ante desastres en la nube con una base de datos colocada</span><span class="sxs-lookup"><span data-stu-id="eb73e-108">Design pattern 1: Active-passive deployment for cloud disaster recovery with a co-located database</span></span>
<span data-ttu-id="eb73e-109">Esta opción es mejor para las aplicaciones con las siguientes características:</span><span class="sxs-lookup"><span data-stu-id="eb73e-109">This option is best suited for applications with the following characteristics:</span></span>

* <span data-ttu-id="eb73e-110">Instancia activa de una única región de Azure.</span><span class="sxs-lookup"><span data-stu-id="eb73e-110">Active instance in a single Azure region</span></span>
* <span data-ttu-id="eb73e-111">Fuerte dependencia de acceso de lectura y escritura (RW) a los datos.</span><span class="sxs-lookup"><span data-stu-id="eb73e-111">Strong dependency on read-write (RW) access to data</span></span>
* <span data-ttu-id="eb73e-112">La conectividad entre regiones entre la aplicación web y la base de datos no es aceptable debido al costo del tráfico y la latencia.</span><span class="sxs-lookup"><span data-stu-id="eb73e-112">Cross-region connectivity between the web application and the database is not acceptable due to latency and traffic cost</span></span>    

<span data-ttu-id="eb73e-113">En este caso, la topología de implementación de la aplicación está optimizada para el tratamiento de desastres regionales cuando se ven afectados todos los componentes de aplicación y es necesario conmutar por error como una unidad.</span><span class="sxs-lookup"><span data-stu-id="eb73e-113">In this case, the application deployment topology is optimized for handling regional disasters when all application components are impacted and need to failover as a unit.</span></span> <span data-ttu-id="eb73e-114">En el caso de la redundancia geográfica, la lógica de aplicación y la base de datos se replican en otra región, pero no se usan para la carga de trabajo de la aplicación en las condiciones normales.</span><span class="sxs-lookup"><span data-stu-id="eb73e-114">For geographic redundancy, the application logic and the database are replicated to another region but they are not used for the application workload under the normal conditions.</span></span> <span data-ttu-id="eb73e-115">La aplicación en la región secundaria debe configurarse para usar una cadena de conexión SQL a la base de datos secundaria.</span><span class="sxs-lookup"><span data-stu-id="eb73e-115">The application in the secondary region should be configured to use a SQL connection string to the secondary database.</span></span> <span data-ttu-id="eb73e-116">El Administrador de tráfico se configura para usar [el método de enrutamiento de conmutación por error](../traffic-manager/traffic-manager-configure-failover-routing-method.md).</span><span class="sxs-lookup"><span data-stu-id="eb73e-116">Traffic manager is set up to use [failover routing method](../traffic-manager/traffic-manager-configure-failover-routing-method.md).</span></span>  

> [!NOTE]
> <span data-ttu-id="eb73e-117">[Azure Traffic Manager](../traffic-manager/traffic-manager-overview.md) se usa en este artículo únicamente con fines ilustrativos.</span><span class="sxs-lookup"><span data-stu-id="eb73e-117">[Azure traffic manager](../traffic-manager/traffic-manager-overview.md) is used throughout this article for illustration purposes only.</span></span> <span data-ttu-id="eb73e-118">Puede usar cualquier solución de equilibrio de carga que admita el método de enrutamiento de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="eb73e-118">You can use any load-balancing solution that supports failover routing method.</span></span>    
>

<span data-ttu-id="eb73e-119">El diagrama siguiente muestra esta configuración antes de una interrupción.</span><span class="sxs-lookup"><span data-stu-id="eb73e-119">The following diagram shows this configuration before an outage.</span></span>

![Configuración de replicación geográfica de SQL Database.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-1.png)

<span data-ttu-id="eb73e-122">Después de una interrupción en la región primaria, el servicio SQL Database detectará que no se puede acceder a la base de datos principal y desencadenará una conmutación por error a la base de datos secundaria en función de los parámetros de la directiva de conmutación por error automática.</span><span class="sxs-lookup"><span data-stu-id="eb73e-122">After an outage in the primary region, the SQL Database service detects that the primary database is not accessible and trigger a failover to the secondary database based on the parameters of the automatic failover policy.</span></span> <span data-ttu-id="eb73e-123">Dependiendo de su Acuerdo de Nivel de Servicio de aplicación, puede optar por configurar un período de gracia entre la detección de la interrupción y la propia conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="eb73e-123">Depending on your application SLA, you can decide to configure a grace period between the detection of the outage and the failover itself.</span></span> <span data-ttu-id="eb73e-124">Al configurar un período de gracia se reduce el riesgo de pérdida de datos a los casos donde la interrupción es grave y la disponibilidad en la región no se puede restaurar rápidamente.</span><span class="sxs-lookup"><span data-stu-id="eb73e-124">Configuring a grace period reduces the risk of data loss to the cases where the outage is catastrophic and availability in the region cannot be quickly restored.</span></span> <span data-ttu-id="eb73e-125">Si el administrador de tráfico inicia la conmutación por error del punto de conexión antes de que el grupo de conmutación por error active la conmutación por error de la base de datos, la aplicación web no podrá volverse a conectarse a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="eb73e-125">If the endpoint failover is initiated by the traffic manager before the failover group triggers the failover of the database, the web application is not able to reconnect to the database.</span></span> <span data-ttu-id="eb73e-126">El intento de la aplicación para volverse a conectar se realiza de forma correcta automáticamente en cuanto la conmutación por error de la base de datos se complete.</span><span class="sxs-lookup"><span data-stu-id="eb73e-126">The application’s attempt to reconnect automatically succeeds as soon as the database failover completes.</span></span> 

> [!NOTE]
> <span data-ttu-id="eb73e-127">Para lograr una conmutación por error de la aplicación y las bases de datos totalmente coordinada, debe diseñar su propio método de supervisión y usar la conmutación por error manual de los puntos de conexión de la aplicación web y las bases de datos.</span><span class="sxs-lookup"><span data-stu-id="eb73e-127">To achieve fully coordinated failover of the application and the databases, you should devise your own monitoring method and use manual failover of the web application endpoints and the databases.</span></span>
>

<span data-ttu-id="eb73e-128">Una vez completada la conmutación por error de la base de datos y los puntos de conexión de la aplicación, esta reiniciará el procesamiento de las solicitudes de usuario en la región B y permanecerá colocada con la base de datos porque la base de datos principal está ahora en la región de B. Este escenario se ilustra en el diagrama siguiente.</span><span class="sxs-lookup"><span data-stu-id="eb73e-128">After the failover of both the application’s endpoints and the database completes, the application will re-start processing the user requests in the region B and will remain co-located with the database because the primary database is now in region B. This scenario is illustrated in the following diagram.</span></span> <span data-ttu-id="eb73e-129">En todos los diagramas, las líneas continuas indican conexiones activas, las líneas de puntos indican conexiones suspendidas y las señales de detención indican desencadenadores de acción.</span><span class="sxs-lookup"><span data-stu-id="eb73e-129">In all diagrams, solid lines indicate active connections, dotted lines indicate suspended connections, and stop signs indicate action triggers.</span></span>

![Replicación geográfica: conmutación por error a la base de datos secundaria.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-2.png)

<span data-ttu-id="eb73e-132">Si se produce una interrupción en la región secundaria, se suspende el vínculo de replicación entre la base de datos principal y la secundaria pero la conmutación por error no se desencadena porque la base de datos principal no se ve afectada.</span><span class="sxs-lookup"><span data-stu-id="eb73e-132">If an outage happens in the secondary region, the replication link between the primary and the secondary database is suspended but the failover is not triggered because the primary database is not impacted.</span></span> <span data-ttu-id="eb73e-133">En este caso, la disponibilidad de la aplicación no cambia, pero la aplicación funciona expuesta y, por tanto, con un riesgo más alto en caso de que ambas regiones tengan un error en cadena.</span><span class="sxs-lookup"><span data-stu-id="eb73e-133">The application's availability is not changed in this case, but the application operates exposed and therefore at higher risk in case both regions fail in succession.</span></span>

> [!NOTE]
> <span data-ttu-id="eb73e-134">Para recuperación ante desastres, se recomienda la configuración con la implementación de aplicaciones limitada a dos regiones.</span><span class="sxs-lookup"><span data-stu-id="eb73e-134">For disaster recovery we recommend the configuration with application deployment limited to two regions.</span></span> <span data-ttu-id="eb73e-135">Esto es porque la mayoría de las ubicaciones geográficas de Azure tienen solo dos regiones.</span><span class="sxs-lookup"><span data-stu-id="eb73e-135">This is because most of the Azure geographies have only two regions.</span></span> <span data-ttu-id="eb73e-136">Esta configuración no protegerá la aplicación de un error grave simultáneo de ambas regiones.</span><span class="sxs-lookup"><span data-stu-id="eb73e-136">This configuration will not protect your application from a simultaneous catastrophic failure of both regions.</span></span>  <span data-ttu-id="eb73e-137">En el caso poco probable de que este error se produjese, podría recuperar sus bases de datos en una tercera región mediante una [operación de restauración geográfica](sql-database-disaster-recovery.md#recover-using-geo-restore).</span><span class="sxs-lookup"><span data-stu-id="eb73e-137">In an unlikely event of such a failure, you can recover your databases in a third region using [geo-restore operation](sql-database-disaster-recovery.md#recover-using-geo-restore).</span></span>
>

<span data-ttu-id="eb73e-138">Una vez que se reduce la interrupción, la base de datos secundaria se volverá a sincronizar automáticamente con la principal.</span><span class="sxs-lookup"><span data-stu-id="eb73e-138">Once the outage is mitigated, the secondary database will automatically re-synchronize with the primary.</span></span> <span data-ttu-id="eb73e-139">Durante la sincronización, el rendimiento de la principal podría verse afectado ligeramente dependiendo de la cantidad de datos que haya que sincronizar.</span><span class="sxs-lookup"><span data-stu-id="eb73e-139">During synchronization, performance of the primary could be slightly impacted depending on the amount of data that needs to be synchronized.</span></span> <span data-ttu-id="eb73e-140">El siguiente diagrama ilustra una interrupción en la región secundaria.</span><span class="sxs-lookup"><span data-stu-id="eb73e-140">The following diagram illustrates an outage in the secondary region.</span></span>

![Base de datos secundaria sincronizada con la primaria.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-3.png)

<span data-ttu-id="eb73e-143">Las **ventajas** clave de este patrón de diseño son:</span><span class="sxs-lookup"><span data-stu-id="eb73e-143">The key **advantages** of this design pattern are:</span></span>

* <span data-ttu-id="eb73e-144">La misma aplicación web se implementa en ambas regiones sin ninguna configuración específica de la región y sin lógica adicional para reaccionar ante la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="eb73e-144">The same web application is deployed to both regions without any region-specific configuration and no additional logic to react to the failover.</span></span> 
* <span data-ttu-id="eb73e-145">El rendimiento de la aplicación no se ve afectado por la conmutación por error, ya que la aplicación web y la base de datos siempre están colocadas.</span><span class="sxs-lookup"><span data-stu-id="eb73e-145">The application's performance is not impacted by failover as the web application and the database are always co-located.</span></span>

<span data-ttu-id="eb73e-146">El principal **inconveniente** es que la instancia de aplicación redundante en la región secundaria solo se usa para la recuperación ante desastres.</span><span class="sxs-lookup"><span data-stu-id="eb73e-146">The main **tradeoff** is that the redundant application instance in the secondary region is only used for disaster recovery.</span></span>

## <a name="design-pattern-2-active-active-deployment-for-application-load-balancing"></a><span data-ttu-id="eb73e-147">Patrón de diseño 2: implementación activa-activa para el equilibrio de carga de aplicación</span><span class="sxs-lookup"><span data-stu-id="eb73e-147">Design pattern 2: Active-active deployment for application load balancing</span></span>
<span data-ttu-id="eb73e-148">Esta opción de recuperación ante desastres en la nube es mejor para las aplicaciones con las siguientes características:</span><span class="sxs-lookup"><span data-stu-id="eb73e-148">This cloud disaster recovery option is best suited for applications with the following characteristics:</span></span>

* <span data-ttu-id="eb73e-149">Una proporción alta de lecturas en relación a las escrituras en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="eb73e-149">High ratio of database reads to writes</span></span>
* <span data-ttu-id="eb73e-150">La latencia de lectura de la base de datos es más importante para la experiencia del usuario final que la latencia de escritura.</span><span class="sxs-lookup"><span data-stu-id="eb73e-150">Database read latency is more critical for the end-user experience than the write latency</span></span> 
* <span data-ttu-id="eb73e-151">La lógica de solo lectura se puede separar de la lógica de lectura y escritura mediante el uso de una cadena de conexión distinta.</span><span class="sxs-lookup"><span data-stu-id="eb73e-151">Read-only logic can be separated from read-write logic by using a different connection string</span></span>
* <span data-ttu-id="eb73e-152">La lógica de solo lectura no depende de que los datos estén totalmente sincronizados con las actualizaciones más recientes.</span><span class="sxs-lookup"><span data-stu-id="eb73e-152">Read-only logic does not depend on data being fully synchronized with the latest updates</span></span>  

<span data-ttu-id="eb73e-153">Si sus aplicaciones tienen estas características, equilibrar la carga de las conexiones de usuario final entre varias instancias de la aplicación en diferentes regiones puede mejorar considerablemente la experiencia global del usuario final.</span><span class="sxs-lookup"><span data-stu-id="eb73e-153">If your applications have these characteristics, load balancing the end-user connections across multiple application instances in different regions can substantially improve the overall end-user experience.</span></span> <span data-ttu-id="eb73e-154">Dos de las regiones deben seleccionarse como el par de recuperación ante desastres y el grupo de conmutación por error debe incluir las bases de datos de estas regiones.</span><span class="sxs-lookup"><span data-stu-id="eb73e-154">Two of the regions should be selected as the DR pair and the failover group should include the databases in these regions.</span></span> <span data-ttu-id="eb73e-155">Para implementar el equilibrio de carga, cada región debe tener una instancia activa de la aplicación con la lógica de lectura y escritura (RW) conectada al punto de conexión del agente de escucha de lectura y escritura del grupo de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="eb73e-155">To implement load-balancing, each region should have an active instance of the application with the read-write (RW) logic connected to the read-write listener endpoint of the failover group.</span></span> <span data-ttu-id="eb73e-156">Esto garantizará que la conmutación por error se iniciará automáticamente si la base de datos principal se ve afectada por una interrupción del servicio.</span><span class="sxs-lookup"><span data-stu-id="eb73e-156">It will guarantee that the failover will be automatically initiated if the primary database is impacted by an outage.</span></span> <span data-ttu-id="eb73e-157">La lógica de solo lectura (RO) en la aplicación web debe conectarse directamente a la base de datos de dicha región.</span><span class="sxs-lookup"><span data-stu-id="eb73e-157">The read-only logic (RO) in the web application should connect directly to the database in that region.</span></span> <span data-ttu-id="eb73e-158">El administrador de tráfico debe configurarse para usar [enrutamiento del rendimiento](../traffic-manager/traffic-manager-configure-performance-routing-method.md) con la [supervisión de punto de conexión](../traffic-manager/traffic-manager-monitoring.md) habilitada para cada instancia de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="eb73e-158">Traffic manager should be set up to use [performance routing](../traffic-manager/traffic-manager-configure-performance-routing-method.md) with [end-point monitoring](../traffic-manager/traffic-manager-monitoring.md) enabled for each application instance.</span></span>

<span data-ttu-id="eb73e-159">Como en el patrón nº 1, debe considerar la posibilidad de implementar una aplicación de supervisión similar.</span><span class="sxs-lookup"><span data-stu-id="eb73e-159">As in pattern #1, you should consider deploying a similar monitoring application.</span></span> <span data-ttu-id="eb73e-160">Pero a diferencia del patrón n.º 1, la aplicación de supervisión no será la responsable de desencadenar la conmutación por error del extremo.</span><span class="sxs-lookup"><span data-stu-id="eb73e-160">But unlike pattern #1, the monitoring application will not be responsible for triggering the end-point failover.</span></span>

> [!NOTE]
> <span data-ttu-id="eb73e-161">Mientras que este patrón usa más de una base de datos secundaria, solo se usará la base de datos secundaria de la región B para la conmutación por error y debe formar parte del grupo de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="eb73e-161">While this pattern uses more than one secondary database, only the secondary in Region B  would be used for failover and should be part of the failover group.</span></span>
>

<span data-ttu-id="eb73e-162">El Administrador de tráfico tiene que configurarse para el enrutamiento de rendimiento para dirigir las conexiones de usuario a la instancia de aplicación que esté más cerca de la ubicación geográfica del usuario.</span><span class="sxs-lookup"><span data-stu-id="eb73e-162">Traffic manager should be configured for performance routing to direct the user connections to the application instance closest to the user's geographic location.</span></span> <span data-ttu-id="eb73e-163">El siguiente diagrama muestra esta configuración antes de una interrupción.</span><span class="sxs-lookup"><span data-stu-id="eb73e-163">The following diagram illustrates this configuration before an outage.</span></span>

![Sin interrupción: enrutamiento de rendimiento a la aplicación más cercana.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-1.png)

<span data-ttu-id="eb73e-166">Si se detecta una interrupción de la base de datos de la región A, el grupo de conmutación por error iniciará automáticamente la conmutación por error de la base de datos principal de la región A a la base de datos secundaria de la región de B. También se actualizará automáticamente el punto de conexión del agente de escucha de lectura y escritura a la región B para que las conexiones de lectura y escritura de la aplicación web no se vean afectadas.</span><span class="sxs-lookup"><span data-stu-id="eb73e-166">If a database outage is detected in the region A, the failover group will automatically initiate failover of the primary database in region A to the secondary in region B. It will also automatically update the read-write listener endpoint to region B so read-write connections in the web application will not be impacted.</span></span> <span data-ttu-id="eb73e-167">El administrador de tráfico excluirá el punto sin conexión de la tabla de enrutamiento, pero continuará enrutando el tráfico de usuario final a las instancias en línea restantes.</span><span class="sxs-lookup"><span data-stu-id="eb73e-167">The traffic manager will exclude the offline end-point from the routing table but will continue routing the end-user traffic to the remaining online instances.</span></span> <span data-ttu-id="eb73e-168">Las cadenas de conexión de SQL de solo lectura no se verán afectadas, ya que siempre señalan a la base de datos en la misma región.</span><span class="sxs-lookup"><span data-stu-id="eb73e-168">The read-only SQL connection strings will not be impacted as they always point to the database in the same region.</span></span> 

<span data-ttu-id="eb73e-169">El siguiente diagrama ilustra la nueva configuración después de la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="eb73e-169">The following diagram illustrates the new configuration after the failover.</span></span>

![Configuración después de la conmutación por error.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-2.png)

<span data-ttu-id="eb73e-172">En el caso de una interrupción en una de las regiones secundarias, el administrador de tráfico quitará automáticamente el punto sin conexión de esa región de la tabla de enrutamiento.</span><span class="sxs-lookup"><span data-stu-id="eb73e-172">In case of an outage in one of the secondary regions, the traffic manager will automatically remove the offline end-point in that region from the routing table.</span></span> <span data-ttu-id="eb73e-173">El canal de replicación se suspenderá para la base de datos secundaria en dicha región.</span><span class="sxs-lookup"><span data-stu-id="eb73e-173">The replication channel to the secondary database in that region will be suspended.</span></span> <span data-ttu-id="eb73e-174">Dado que el resto de las regiones reciben tráfico de usuario adicional en este escenario, el rendimiento de la aplicación resultará afectado durante la interrupción.</span><span class="sxs-lookup"><span data-stu-id="eb73e-174">Because the remaining regions get additional user traffic in this scenario, the application's performance will be impacted during the outage.</span></span> <span data-ttu-id="eb73e-175">Una vez que se reduce la interrupción, la base de datos secundaria de la región afectada se sincronizará automáticamente con la principal.</span><span class="sxs-lookup"><span data-stu-id="eb73e-175">Once the outage is mitigated, the secondary database in the impacted region will be immediately synchronized with the primary.</span></span> <span data-ttu-id="eb73e-176">Durante la sincronización, el rendimiento de la principal podría verse afectado ligeramente dependiendo de la cantidad de datos que haya que sincronizar.</span><span class="sxs-lookup"><span data-stu-id="eb73e-176">During the synchronization performance of the primary could be slightly impacted depending on the amount of data that needs to be synchronized.</span></span> <span data-ttu-id="eb73e-177">El siguiente diagrama ilustra una interrupción en la región B.</span><span class="sxs-lookup"><span data-stu-id="eb73e-177">The following diagram illustrates an outage in region B.</span></span>

![Interrupción en la región secundaria.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-3.png)

<span data-ttu-id="eb73e-180">La principal **ventaja** de este patrón de diseño es que la carga de trabajo de la aplicación se puede escalar a través de varios elementos secundarios para lograr el rendimiento óptimo del usuario final.</span><span class="sxs-lookup"><span data-stu-id="eb73e-180">The key **advantage** of this design pattern is that you can scale the application workload across multiple secondaries to achieve the optimal end-user performance.</span></span> <span data-ttu-id="eb73e-181">Los **inconvenientes** de esta opción son:</span><span class="sxs-lookup"><span data-stu-id="eb73e-181">The **tradeoffs** of this option are:</span></span>

* <span data-ttu-id="eb73e-182">las conexiones de lectura y escritura entre las instancias de la aplicación y la base de datos varían en latencia y costo.</span><span class="sxs-lookup"><span data-stu-id="eb73e-182">Read-write connections between the application instances and database have varying latency and cost</span></span>
* <span data-ttu-id="eb73e-183">El rendimiento de la aplicación se ve afectado durante la interrupción.</span><span class="sxs-lookup"><span data-stu-id="eb73e-183">Application performance is impacted during the outage</span></span>

> [!NOTE]
> <span data-ttu-id="eb73e-184">Un enfoque similar puede usarse para descargar las cargas de trabajo especializadas, como trabajos de elaboración de informes, herramientas de inteligencia empresarial o copias de seguridad.</span><span class="sxs-lookup"><span data-stu-id="eb73e-184">A similar approach can be used to offload specialized workloads such as reporting jobs, business intelligence tools, or backups.</span></span> <span data-ttu-id="eb73e-185">Normalmente estas cargas de trabajo consumen una cantidad de recursos importante de la base de datos. Por tanto, se recomienda designar una de las bases de datos secundarias para ellas que tenga un nivel de rendimiento que coincida con la carga de trabajo anticipada.</span><span class="sxs-lookup"><span data-stu-id="eb73e-185">Typically, these workloads consume significant database resources therefore it is recommended that you designate one of the secondary databases for them with the performance level matched to the anticipated workload.</span></span>
>

## <a name="design-pattern-3-active-passive-deployment-for-data-preservation"></a><span data-ttu-id="eb73e-186">Patrón de diseño 3: implementación activa-pasiva para la conservación de datos</span><span class="sxs-lookup"><span data-stu-id="eb73e-186">Design pattern 3: Active-passive deployment for data preservation</span></span>
<span data-ttu-id="eb73e-187">Esta opción es mejor para las aplicaciones con las siguientes características:</span><span class="sxs-lookup"><span data-stu-id="eb73e-187">This option is best suited for applications with the following characteristics:</span></span>

* <span data-ttu-id="eb73e-188">Cualquier pérdida de datos supone un alto riesgo para la empresa.</span><span class="sxs-lookup"><span data-stu-id="eb73e-188">Any data loss is high business risk.</span></span> <span data-ttu-id="eb73e-189">La conmutación por error de la base de datos solo puede usarse como último recurso si la interrupción es grave.</span><span class="sxs-lookup"><span data-stu-id="eb73e-189">The database failover can only be used as a last resort if the outage is catastrophic.</span></span>
* <span data-ttu-id="eb73e-190">La aplicación admite los modos de solo lectura y lectura y escritura de operaciones y puede funcionar en "modo de solo lectura" durante un período de tiempo.</span><span class="sxs-lookup"><span data-stu-id="eb73e-190">The application supports read-only and read-write modes of operations and can operate in "read-only mode" for a period of time.</span></span>

<span data-ttu-id="eb73e-191">En este modelo, la aplicación cambia al modo de solo lectura cuando las conexiones de lectura y escritura empiezan a tener errores de tiempo de espera agotado.</span><span class="sxs-lookup"><span data-stu-id="eb73e-191">In this pattern, the application switches to read-only mode when the read-write connections start getting time-out errors.</span></span> <span data-ttu-id="eb73e-192">La aplicación web se implementa en ambas regiones e incluyen una conexión con el punto de conexión del agente de escucha de lectura y escritura y otra conexión con el punto de conexión del agente de escucha de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="eb73e-192">The Web Application is deployed to both regions and include a connection to the read-write listener endpoint and different connection to the read-only listener endpoint.</span></span> <span data-ttu-id="eb73e-193">El administrador de tráfico debe configurarse para usar el [enrutamiento de conmutación por error](../traffic-manager/traffic-manager-configure-failover-routing-method.md) con la [supervisión de punto de conexión](../traffic-manager/traffic-manager-monitoring.md) habilitada para el punto de conexión de aplicación en cada región.</span><span class="sxs-lookup"><span data-stu-id="eb73e-193">The Traffic manager should be set up to use [failover routing](../traffic-manager/traffic-manager-configure-failover-routing-method.md) with [end-point monitoring](../traffic-manager/traffic-manager-monitoring.md) enabled for the application endpoint in each region.</span></span>

<span data-ttu-id="eb73e-194">El siguiente diagrama muestra esta configuración antes de una interrupción.</span><span class="sxs-lookup"><span data-stu-id="eb73e-194">The following diagram illustrates this configuration before an outage.</span></span>

![Implementación activa-pasiva antes de la conmutación por error.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-1.png)

<span data-ttu-id="eb73e-197">Cuando el administrador de tráfico detecta un error de conectividad con la región A, cambia automáticamente el tráfico de usuario a la instancia de aplicación de la región B. Con este modelo, es importante establecer el período de gracia con pérdida de datos en un valor suficientemente alto, por ejemplo, 24 horas.</span><span class="sxs-lookup"><span data-stu-id="eb73e-197">When the traffic manager detects a connectivity failure to region A, it automatically switches user traffic to the application instance in region B. With this pattern, it is important that you set the grace period with data loss to a sufficiently high value, e.g. 24 hours.</span></span> <span data-ttu-id="eb73e-198">Esto asegurará que se evita la pérdida de datos si la interrupción se mitiga durante ese período.</span><span class="sxs-lookup"><span data-stu-id="eb73e-198">It will ensure that data loss is prevented if the outage is mitigated within that time.</span></span> <span data-ttu-id="eb73e-199">Cuando la aplicación web de la región B se active, las operaciones de lectura y escritura comenzarán a generar errores.</span><span class="sxs-lookup"><span data-stu-id="eb73e-199">When the Web application in the region B is activated the read-write operations will start failing.</span></span> <span data-ttu-id="eb73e-200">En ese momento, debe cambiar al modo de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="eb73e-200">At that point, it should switch to the read-only mode.</span></span> <span data-ttu-id="eb73e-201">En este modo, las solicitudes se enrutarán automáticamente a la base de datos secundaria.</span><span class="sxs-lookup"><span data-stu-id="eb73e-201">In this mode the requests will be automatically routed to the secondary database.</span></span> <span data-ttu-id="eb73e-202">En el caso de que se produzca un error grave, la interrupción no se mitigará dentro del período de gracia y el grupo de conmutación por error activará la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="eb73e-202">In the case of a catastrophic failure the outage will not be mitigated within the grace period and the failover group will trigger the failover.</span></span> <span data-ttu-id="eb73e-203">Después de eso, el agente de escucha de lectura y escritura pasará a estar disponible y las llamadas a él dejarán de dar error.</span><span class="sxs-lookup"><span data-stu-id="eb73e-203">After that the read-write listener will become available and the calls to it will stop failing.</span></span> <span data-ttu-id="eb73e-204">Esto se ilustra en el diagrama siguiente</span><span class="sxs-lookup"><span data-stu-id="eb73e-204">This is illustrated by the following diagram.</span></span>

![Interrupción: aplicación en modo de sólo lectura.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-2.png)

<span data-ttu-id="eb73e-207">Si la interrupción de la región primaria se soluciona dentro del período de gracia, el administrador de tráfico detecta la restauración de la conectividad en la región principal y cambia el tráfico de usuario de nuevo a la instancia de aplicación de la región A. Esa instancia de aplicación se reanuda y funciona en modo de lectura y escritura utilizando la base de datos principal de la región A.</span><span class="sxs-lookup"><span data-stu-id="eb73e-207">If the outage in the primary region is mitigated within the grace period, traffic manager detects the restoration of connectivity in the primary region and switches user traffic back to the application instance in region A. That application instance resumes and operates in read-write mode using the primary database in region A.</span></span>

<span data-ttu-id="eb73e-208">En caso de una interrupción en la región B, el administrador de tráfico detecta el error del punto de conexión de la aplicación en la región B y grupo de conmutación por error cambia el agente de escucha de solo lectura a la región A. Esta interrupción no afecta a la experiencia del usuario final, pero la base de datos principal quedará expuesta durante la interrupción.</span><span class="sxs-lookup"><span data-stu-id="eb73e-208">In case of an outage in the region B, the traffic manager detects the failure of the application end-point in region B and the failover group switches the read-only listener to region A. This outage does not impact the end-user experience but the primary database will be exposed during the outage.</span></span> <span data-ttu-id="eb73e-209">Esto se ilustra en el diagrama siguiente</span><span class="sxs-lookup"><span data-stu-id="eb73e-209">This is illustrated by the following diagram.</span></span>

![Interrupción: base de datos secundaria.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-3.png)

<span data-ttu-id="eb73e-212">Una vez mitigada la interrupción, la base de datos secundaria se sincroniza inmediatamente con la principal y el agente de escucha de solo lectura se vuelve a cambiar a la base de datos secundaria de la región B. Durante la sincronización, el rendimiento de la principal podría verse ligeramente afectado dependiendo de la cantidad de datos que se necesite sincronizarse.</span><span class="sxs-lookup"><span data-stu-id="eb73e-212">Once the outage is mitigated, the secondary database is immediately synchronized with the primary and the read-only listener is switched back to the secondary database in region B. During synchronization performance of the primary could be slightly impacted depending on the amount of data that needs to be synchronized.</span></span>

<span data-ttu-id="eb73e-213">Este patrón de diseño tiene varias **ventajas**:</span><span class="sxs-lookup"><span data-stu-id="eb73e-213">This design pattern has several **advantages**:</span></span>

* <span data-ttu-id="eb73e-214">Evita la pérdida de datos durante las interrupciones temporales.</span><span class="sxs-lookup"><span data-stu-id="eb73e-214">It avoids data loss during the temporary outages.</span></span>
* <span data-ttu-id="eb73e-215">El tiempo de inactividad depende solo de la rapidez del Administrador de tráfico para detectar el error de conectividad, que se puede configurar.</span><span class="sxs-lookup"><span data-stu-id="eb73e-215">Downtime depends only on how quickly traffic manager detects the connectivity failure, which is configurable.</span></span>

<span data-ttu-id="eb73e-216">La **contrapartida** es:</span><span class="sxs-lookup"><span data-stu-id="eb73e-216">The **tradeoff** is:</span></span>

* <span data-ttu-id="eb73e-217">La aplicación tiene que poder operar en modo de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="eb73e-217">Application must be able to operate in read-only mode.</span></span>

> [!NOTE]
> <span data-ttu-id="eb73e-218">En el caso de una interrupción del servicio permanente en la región, tiene que activar manualmente la conmutación por error de base de datos y aceptar la pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="eb73e-218">In case of a permanent service outage in the region, you manually activate database failover and accept the data loss.</span></span> <span data-ttu-id="eb73e-219">La aplicación será funcional en la región secundaria con acceso de lectura y escritura a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="eb73e-219">The application will be functional in the secondary region with read-write access to the database.</span></span>
>

## <a name="business-continuity-planning-choose-an-application-design-for-cloud-disaster-recovery"></a><span data-ttu-id="eb73e-220">Planificación de continuidad del negocio: elección del diseño de una aplicación para la recuperación ante desastres en la nube</span><span class="sxs-lookup"><span data-stu-id="eb73e-220">Business continuity planning: Choose an application design for cloud disaster recovery</span></span>
<span data-ttu-id="eb73e-221">Su estrategia de recuperación ante desastres en la nube puede combinar o ampliar estos patrones para satisfacer mejor las necesidades de su aplicación.</span><span class="sxs-lookup"><span data-stu-id="eb73e-221">Your specific cloud disaster recovery strategy can combine or extend these design patterns to best meet the needs of your application.</span></span>  <span data-ttu-id="eb73e-222">Como se mencionó anteriormente, la estrategia que elija se basa en el acuerdo de nivel de servicio que desee ofrecer a sus clientes y en la topología de implementación de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="eb73e-222">As mentioned earlier, the strategy you choose is based on the SLA you want to offer to your customers and the application deployment topology.</span></span> <span data-ttu-id="eb73e-223">Para guiarle en su decisión, la siguiente tabla compara las opciones en función de la pérdida de datos estimada u objetivo de punto de recuperación (RPO) y el tiempo de recuperación calculado (ERT).</span><span class="sxs-lookup"><span data-stu-id="eb73e-223">To help guide your decision, the following table compares the choices based on the estimated data loss or recovery point objective (RPO) and estimated recovery time (ERT).</span></span>

| <span data-ttu-id="eb73e-224">Patrón</span><span class="sxs-lookup"><span data-stu-id="eb73e-224">Pattern</span></span> | <span data-ttu-id="eb73e-225">RPO</span><span class="sxs-lookup"><span data-stu-id="eb73e-225">RPO</span></span> | <span data-ttu-id="eb73e-226">ERT</span><span class="sxs-lookup"><span data-stu-id="eb73e-226">ERT</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="eb73e-227">Implementación activa-pasiva para la recuperación ante desastres con acceso a base de datos colocalizada</span><span class="sxs-lookup"><span data-stu-id="eb73e-227">Active-passive deployment for disaster recovery with co-located database access</span></span> |<span data-ttu-id="eb73e-228">Acceso de lectura y escritura < 5 s</span><span class="sxs-lookup"><span data-stu-id="eb73e-228">Read-write access < 5 sec</span></span> |<span data-ttu-id="eb73e-229">Tiempo de detección de errores + TTL de DNS</span><span class="sxs-lookup"><span data-stu-id="eb73e-229">Failure detection time + DNS TTL</span></span> |
| <span data-ttu-id="eb73e-230">Implementación activa-activa para el equilibrio de carga de aplicación</span><span class="sxs-lookup"><span data-stu-id="eb73e-230">Active-active deployment for application load balancing</span></span> |<span data-ttu-id="eb73e-231">Acceso de lectura y escritura < 5 s</span><span class="sxs-lookup"><span data-stu-id="eb73e-231">Read-write access < 5 sec</span></span> |<span data-ttu-id="eb73e-232">Tiempo de detección de errores + TTL de DNS</span><span class="sxs-lookup"><span data-stu-id="eb73e-232">Failure detection time + DNS TTL</span></span> |
| <span data-ttu-id="eb73e-233">Implementación activa-pasiva para la conservación de datos</span><span class="sxs-lookup"><span data-stu-id="eb73e-233">Active-passive deployment for data preservation</span></span> |<span data-ttu-id="eb73e-234">Acceso de solo lectura < 5 s</span><span class="sxs-lookup"><span data-stu-id="eb73e-234">Read-only access < 5 sec</span></span> | <span data-ttu-id="eb73e-235">Acceso de solo lectura = 0</span><span class="sxs-lookup"><span data-stu-id="eb73e-235">Read-only access = 0</span></span> |
||<span data-ttu-id="eb73e-236">Acceso de lectura y escritura = cero</span><span class="sxs-lookup"><span data-stu-id="eb73e-236">Read-write access = zero</span></span> | <span data-ttu-id="eb73e-237">Acceso de lectura y escritura = Tiempo de detección de errores + Período de gracia con pérdida de datos</span><span class="sxs-lookup"><span data-stu-id="eb73e-237">Read-write access = Failure detection time + grace period with data loss</span></span> |
|||

## <a name="next-steps"></a><span data-ttu-id="eb73e-238">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="eb73e-238">Next steps</span></span>
* <span data-ttu-id="eb73e-239">Para saber en qué consisten las copias de seguridad automatizadas de Base de datos SQL de Azure, consulte [Información general: copias de seguridad automatizadas de Base de datos SQL](sql-database-automated-backups.md)</span><span class="sxs-lookup"><span data-stu-id="eb73e-239">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span></span>
* <span data-ttu-id="eb73e-240">Para obtener una descripción general y los escenarios de la continuidad empresarial, consulte [Continuidad empresarial con Base de datos SQL de Azure](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="eb73e-240">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="eb73e-241">Si quiere saber cómo utilizar las copias de seguridad automatizadas para procesos de recuperación, consulte [Restore a database from the service-initiated backups](sql-database-recovery-using-backups.md)</span><span class="sxs-lookup"><span data-stu-id="eb73e-241">To learn about using automated backups for recovery, see [restore a database from the service-initiated backups](sql-database-recovery-using-backups.md)</span></span>
* <span data-ttu-id="eb73e-242">Para conocer las opciones de recuperación más rápidas, consulte [Replicación geográfica activa](sql-database-geo-replication-overview.md)</span><span class="sxs-lookup"><span data-stu-id="eb73e-242">To learn about faster recovery options, see [active geo-replication](sql-database-geo-replication-overview.md)</span></span>  
* <span data-ttu-id="eb73e-243">Si quiere aprender a utilizar las copias de seguridad automatizadas para procesos de archivado, consulte [Copiar una base de datos SQL de Azure](sql-database-copy.md)</span><span class="sxs-lookup"><span data-stu-id="eb73e-243">To learn about using automated backups for archiving, see [database copy](sql-database-copy.md)</span></span>
* <span data-ttu-id="eb73e-244">Para saber cómo utilizar la replicación geográfica activa con los grupos elásticos, consulte [Estrategias de recuperación ante desastres para aplicaciones que usan el grupo elástico de Base de datos SQL](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="eb73e-244">For information about active geo-replication with Elastic Pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>

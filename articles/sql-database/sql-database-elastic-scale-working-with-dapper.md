---
title: "bibliotecas de cliente de base de datos elástica aaaUsing con Dapper | Documentos de Microsoft"
description: "Uso de la biblioteca de cliente de bases de datos elásticas con Dapper."
services: sql-database
documentationcenter: 
manager: jhubbard
author: torsteng
ms.assetid: 463d2676-3b19-47c2-83df-f8c50492c9d2
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/27/2016
ms.author: torsteng
ms.openlocfilehash: c22ece2a977265e93850f0ad3f3ca48f0a8733ac
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="using-elastic-database-client-library-with-dapper"></a><span data-ttu-id="c9bd1-103">Uso de la biblioteca de cliente de bases de datos elásticas con Dapper</span><span class="sxs-lookup"><span data-stu-id="c9bd1-103">Using elastic database client library with Dapper</span></span>
<span data-ttu-id="c9bd1-104">Este documento va dirigido a desarrolladores que se basan en las aplicaciones de toobuild Dapper, pero también desea tooembrace [herramientas de base de datos elástica](sql-database-elastic-scale-introduction.md) toocreate aplicaciones que implementan el particionamiento horizontal tooscale su capa de datos.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-104">This document is for developers that rely on Dapper toobuild applications, but also want tooembrace [elastic database tooling](sql-database-elastic-scale-introduction.md) toocreate applications that implement sharding tooscale-out their data tier.</span></span>  <span data-ttu-id="c9bd1-105">Este documento ilustra cambios hello en aplicaciones basadas en Dapper que son necesario toointegrate con herramientas de base de datos elástica.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-105">This document illustrates hello changes in Dapper-based applications that are necessary toointegrate with elastic database tools.</span></span> <span data-ttu-id="c9bd1-106">Nuestro objetivo es en Redactar depende de los datos y de administración de particiones de bases de datos elásticas Hola enrutamiento con Dapper.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-106">Our focus is on composing hello elastic database shard management and data dependent routing with Dapper.</span></span> 

<span data-ttu-id="c9bd1-107">**Código de ejemplo**: [Herramientas de bases de datos elásticas para Base de datos SQL de Azure: integración con Dapper](https://code.msdn.microsoft.com/Elastic-Scale-with-Azure-e19fc77f).</span><span class="sxs-lookup"><span data-stu-id="c9bd1-107">**Sample Code**: [Elastic database tools for Azure SQL Database - Dapper integration](https://code.msdn.microsoft.com/Elastic-Scale-with-Azure-e19fc77f).</span></span>

<span data-ttu-id="c9bd1-108">Integración de **Dapper** y **DapperExtensions** con hello biblioteca de cliente de base de datos elástica para base de datos de SQL Azure es fácil.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-108">Integrating **Dapper** and **DapperExtensions** with hello elastic database client library for Azure SQL Database is easy.</span></span> <span data-ttu-id="c9bd1-109">Las aplicaciones pueden usar datos dependientes enrutamiento cambiando la creación de hello y abrir de nuevo [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) Hola de objetos toouse [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) llamar desde hello [cliente biblioteca](http://msdn.microsoft.com/library/azure/dn765902.aspx).</span><span class="sxs-lookup"><span data-stu-id="c9bd1-109">Your applications can use data dependent routing by changing hello creation and opening of new [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects toouse hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call from hello [client library](http://msdn.microsoft.com/library/azure/dn765902.aspx).</span></span> <span data-ttu-id="c9bd1-110">Esto limita los cambios en su tooonly de aplicación donde se crea y se abre nuevas conexiones.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-110">This limits changes in your application tooonly where new connections are created and opened.</span></span> 

## <a name="dapper-overview"></a><span data-ttu-id="c9bd1-111">Información general sobre Dapper</span><span class="sxs-lookup"><span data-stu-id="c9bd1-111">Dapper overview</span></span>
<span data-ttu-id="c9bd1-112">**Dapper** es un asignador relacional de objetos.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-112">**Dapper** is an object-relational mapper.</span></span> <span data-ttu-id="c9bd1-113">Se asigna a objetos de .NET desde la base de datos relacional tooa (y viceversa).</span><span class="sxs-lookup"><span data-stu-id="c9bd1-113">It maps .NET objects from your application tooa relational database (and vice versa).</span></span> <span data-ttu-id="c9bd1-114">primera parte de Hola Hola de código de ejemplo muestra cómo se puede integrar la biblioteca de cliente de base de datos elástica Hola con aplicaciones basadas en Dapper.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-114">hello first part of hello sample code illustrates how you can integrate hello elastic database client library with Dapper-based applications.</span></span> <span data-ttu-id="c9bd1-115">segunda parte del código de ejemplo de Hola de Hello ilustra cómo toointegrate al usar Dapper y DapperExtensions.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-115">hello second part of hello sample code illustrates how toointegrate when using both Dapper and DapperExtensions.</span></span>  

<span data-ttu-id="c9bd1-116">funcionalidad del asignador de Hello en Dapper proporciona métodos de extensión en las conexiones de base de datos que simplifican enviando instrucciones de T-SQL para la ejecución o la base de datos de consulta Hola.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-116">hello mapper functionality in Dapper provides extension methods on database connections that simplify submitting T-SQL statements for execution or querying hello database.</span></span> <span data-ttu-id="c9bd1-117">Por ejemplo, Dapper hace fácil toomap entre los objetos .NET y los parámetros de Hola de instrucciones SQL para **Execute** llamadas o los resultados de hello tooconsume de las consultas SQL en objetos de .NET mediante **consulta**llamadas desde Dapper.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-117">For instance, Dapper makes it easy toomap between your .NET objects and hello parameters of SQL statements for **Execute** calls, or tooconsume hello results of your SQL queries into .NET objects using **Query** calls from Dapper.</span></span> 

<span data-ttu-id="c9bd1-118">Al utilizar DapperExtensions, ya no necesita las instrucciones SQL de hello tooprovide.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-118">When using DapperExtensions, you no longer need tooprovide hello SQL statements.</span></span> <span data-ttu-id="c9bd1-119">Métodos de extensión como **GetList** o **insertar** a través de la conexión de base de datos de hello crear Hola instrucciones SQL entre bastidores de Hola.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-119">Extensions methods such as **GetList** or **Insert** over hello database connection create hello SQL statements behind hello scenes.</span></span>

<span data-ttu-id="c9bd1-120">Otra ventaja de Dapper y también DapperExtensions es que los controles de aplicación Hola Hola creación de conexión de base de datos de Hola.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-120">Another benefit of Dapper and also DapperExtensions is that hello application controls hello creation of hello database connection.</span></span> <span data-ttu-id="c9bd1-121">Esto ayuda a interactuar con la biblioteca de cliente de base de datos elástica Hola que las conexiones según la asignación de Hola de shardlets toodatabases de base de datos de agentes.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-121">This helps interact with hello elastic database client library which brokers database connections based on hello mapping of shardlets toodatabases.</span></span>

<span data-ttu-id="c9bd1-122">ensamblados de tooget hello Dapper, consulte [Dapper punto net](http://www.nuget.org/packages/Dapper/).</span><span class="sxs-lookup"><span data-stu-id="c9bd1-122">tooget hello Dapper assemblies, see [Dapper dot net](http://www.nuget.org/packages/Dapper/).</span></span> <span data-ttu-id="c9bd1-123">Hola Dapper de extensiones, vea [DapperExtensions](http://www.nuget.org/packages/DapperExtensions).</span><span class="sxs-lookup"><span data-stu-id="c9bd1-123">For hello Dapper extensions, see [DapperExtensions](http://www.nuget.org/packages/DapperExtensions).</span></span>

## <a name="a-quick-look-at-hello-elastic-database-client-library"></a><span data-ttu-id="c9bd1-124">Un vistazo rápido a la biblioteca de cliente de base de datos elástica Hola</span><span class="sxs-lookup"><span data-stu-id="c9bd1-124">A quick Look at hello elastic database client library</span></span>
<span data-ttu-id="c9bd1-125">Con la biblioteca de cliente de base de datos elástica hello, para definir las particiones de los datos de aplicación denominado *shardlets* , asignarlos toodatabases e identificar por *claves de particionamiento*.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-125">With hello elastic database client library, you define partitions of your application data called *shardlets* , map them toodatabases, and identify them by *sharding keys*.</span></span> <span data-ttu-id="c9bd1-126">Puede tener tantas bases de datos como necesite y distribuir los shardlets por dichas bases de datos.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-126">You can have as many databases as you need and distribute your shardlets across these databases.</span></span> <span data-ttu-id="c9bd1-127">asignación de Hola de bases de datos de toohello de valores de clave de particionamiento se almacena mediante un mapa de particiones proporcionado por las API de la biblioteca de Hola.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-127">hello mapping of sharding key values toohello databases is stored by a shard map provided by hello library’s APIs.</span></span> <span data-ttu-id="c9bd1-128">Esta funcionalidad se llama **administración de mapas de particiones**.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-128">This capability is called **shard map management**.</span></span> <span data-ttu-id="c9bd1-129">mapa de particiones de Hello también actúa como broker Hola de conexiones de base de datos para las solicitudes que llevar a cabo una clave de particionamiento.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-129">hello shard map also serves as hello broker of database connections for requests that carry a sharding key.</span></span> <span data-ttu-id="c9bd1-130">Esta funcionalidad es que se hace referencia tooas **enrutamiento dependiente de datos**.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-130">This capability is referred tooas **data dependent routing**.</span></span>

![Mapas de particiones y enrutamiento dependiente de los datos][1]

<span data-ttu-id="c9bd1-132">Administrador de mapa de particiones de Hello protege a los usuarios de vistas incoherentes en datos de shardlet que se pueden producir cuando se produzcan operaciones de administración de shardlet simultáneas en las bases de datos de Hola.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-132">hello shard map manager protects users from inconsistent views into shardlet data that can occur when concurrent shardlet management operations are happening on hello databases.</span></span> <span data-ttu-id="c9bd1-133">toodo Hola por lo tanto, conexiones de base de datos de partición mapas broker Hola para una aplicación compilada con la biblioteca de Hola.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-133">toodo so, hello shard maps broker hello database connections for an application built with hello library.</span></span> <span data-ttu-id="c9bd1-134">Cuando las operaciones de administración de particiones podrían afectar a hello shardlet, esto permite kill de hello particiones mapa funcionalidad tooautomatically una conexión de base de datos.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-134">When shard management operations could impact hello shardlet, this allows hello shard map functionality tooautomatically kill a database connection.</span></span> 

<span data-ttu-id="c9bd1-135">En lugar de utilizar las conexiones de toocreate de forma tradicional de Hola para Dapper, necesitamos hello toouse [OpenConnectionForKey método](http://msdn.microsoft.com/library/azure/dn824099.aspx).</span><span class="sxs-lookup"><span data-stu-id="c9bd1-135">Instead of using hello traditional way toocreate connections for Dapper, we need toouse hello [OpenConnectionForKey method](http://msdn.microsoft.com/library/azure/dn824099.aspx).</span></span> <span data-ttu-id="c9bd1-136">Esto garantiza que todas las validaciones de hello tiene lugar y las conexiones se administran correctamente cuando los datos se mueven entre las particiones.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-136">This ensures that all hello validation takes place and connections are managed properly when any data moves between shards.</span></span>

### <a name="requirements-for-dapper-integration"></a><span data-ttu-id="c9bd1-137">Requisitos para la integración de Dapper</span><span class="sxs-lookup"><span data-stu-id="c9bd1-137">Requirements for Dapper integration</span></span>
<span data-ttu-id="c9bd1-138">Cuando se trabaja con la biblioteca de cliente de bases de datos elásticas de Hola y Hola API Dapper, queremos hello tooretain propiedades siguientes:</span><span class="sxs-lookup"><span data-stu-id="c9bd1-138">When working with both hello elastic database client library and hello Dapper APIs, we want tooretain hello following properties:</span></span>

* <span data-ttu-id="c9bd1-139">**Ampliación**: se desea tooadd o quitar las bases de datos de capa de datos de Hola de aplicación particionada hello según sea necesario para las demandas de capacidad de Hola de aplicación hello.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-139">**Scaleout**: We want tooadd or remove databases from hello data tier of hello sharded application as necessary for hello capacity demands of hello application.</span></span> 
* <span data-ttu-id="c9bd1-140">**Coherencia**: puesto que nuestra aplicación es escalar horizontalmente mediante particionamiento, necesitamos enrutamiento dependiente de datos tooperform.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-140">**Consistency**: Since our application is scaled out using sharding, we need tooperform data dependent routing.</span></span> <span data-ttu-id="c9bd1-141">Por lo que queremos toouse Hola datos dependientes capacidades de enrutamiento de hello biblioteca toodo.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-141">We want toouse hello Data dependent routing capabilities of hello library toodo so.</span></span> <span data-ttu-id="c9bd1-142">En concreto, queremos tooretain validación de Hola y proporcionan conexiones asíncronas a través del Administrador de mapa de particiones de hello en los resultados de consulta incorrecto o daños en orden tooavoid garantías de coherencia.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-142">In particular, we want tooretain hello validation and consistency guarantees provided by connections that are brokered through hello shard map manager in order tooavoid corruption or wrong query results.</span></span> <span data-ttu-id="c9bd1-143">Esto garantiza que ese tooa conexiones dado shardlet se rechazan o se detiene si (por ejemplo) hello shardlet tooa actualmente movida partición diferente mediante las API de dividir y combinar.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-143">This ensures that connections tooa given shardlet are rejected or stopped if (for instance) hello shardlet is currently moved tooa different shard using Split/Merge APIs.</span></span>
* <span data-ttu-id="c9bd1-144">**Asignación de objetos**: queremos comodidad de hello tooretain de asignaciones de hello proporcionada por Dapper tootranslate entre las clases de aplicación Hola y Hola subyacente estructuras de base de datos.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-144">**Object Mapping**: We want tooretain hello convenience of hello mappings provided by Dapper tootranslate between classes in hello application and hello underlying database structures.</span></span> 

<span data-ttu-id="c9bd1-145">Hello siguiente sección proporcionan instrucciones para estos requisitos para las aplicaciones basadas en **Dapper** y **DapperExtensions**.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-145">hello following section provides guidance for these requirements for applications based on **Dapper** and **DapperExtensions**.</span></span>

## <a name="technical-guidance"></a><span data-ttu-id="c9bd1-146">Orientación técnica</span><span class="sxs-lookup"><span data-stu-id="c9bd1-146">Technical Guidance</span></span>
### <a name="data-dependent-routing-with-dapper"></a><span data-ttu-id="c9bd1-147">Enrutamiento dependiente de los datos con Dapper</span><span class="sxs-lookup"><span data-stu-id="c9bd1-147">Data dependent routing with Dapper</span></span>
<span data-ttu-id="c9bd1-148">Con Dapper, la aplicación hello es suele ser responsable de crear y abrir Hola conexiones toohello subyacente de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-148">With Dapper, hello application is typically responsible for creating and opening hello connections toohello underlying database.</span></span> <span data-ttu-id="c9bd1-149">Dado un tipo T por aplicación hello, Dapper devuelve resultados de la consulta como colecciones de .NET de tipo T. Dapper realiza la asignación de Hola de hello T-SQL resultado filas toohello objetos de tipo T. De forma similar, Dapper asigna objetos .NET a valores de SQL o los parámetros de instrucciones de lenguaje (DML) de manipulación de datos.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-149">Given a type T by hello application, Dapper returns query results as .NET collections of type T. Dapper performs hello mapping from hello T-SQL result rows toohello objects of type T. Similarly, Dapper maps .NET objects into SQL values or parameters for data manipulation language (DML) statements.</span></span> <span data-ttu-id="c9bd1-150">Dapper ofrece esta funcionalidad a través de métodos de extensión en hello regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objeto desde bibliotecas de cliente de SQL de ADO .NET Hola.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-150">Dapper offers this functionality via extension methods on hello regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) object from hello ADO .NET SQL Client libraries.</span></span> <span data-ttu-id="c9bd1-151">Hola conexión SQL devuelta por la API de escala elástica de Hola para DDR también son regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objetos.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-151">hello SQL connection returned by hello Elastic Scale APIs for DDR are also regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects.</span></span> <span data-ttu-id="c9bd1-152">Esto nos permite toodirectly utilizan Dapper extensiones sobre tipo hello devuelto por la API de DDR de la biblioteca de cliente de hello, ya que también es una simple conexión de cliente de SQL.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-152">This allows us toodirectly use Dapper extensions over hello type returned by hello client library’s DDR API, as it is also a simple SQL Client connection.</span></span>

<span data-ttu-id="c9bd1-153">Estas observaciones facilitan conexiones toouse sencilla asíncronas biblioteca de cliente de base de datos elástica Hola para Dapper.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-153">These observations make it straightforward toouse connections brokered by hello elastic database client library for Dapper.</span></span>

<span data-ttu-id="c9bd1-154">Este ejemplo de código (de Hola que acompaña a ejemplo) muestra enfoque de Hola donde proporciona clave de particionamiento de Hola Hola aplicación toohello biblioteca toobroker Hola conexión toohello derecho particiones.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-154">This code example (from hello accompanying sample) illustrates hello approach where hello sharding key is provided by hello application toohello library toobroker hello connection toohello right shard.</span></span>   

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                     key: tenantId1, 
                     connectionString: connStrBldr.ConnectionString, 
                     options: ConnectionOptions.Validate))
    {
        var blog = new Blog { Name = name };
        sqlconn.Execute(@"
                      INSERT INTO
                            Blog (Name)
                            VALUES (@name)", new { name = blog.Name }
                        );
    }

<span data-ttu-id="c9bd1-155">Hola llamada toohello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) API reemplaza creación predeterminada de Hola y apertura de una conexión de cliente de SQL.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-155">hello call toohello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) API replaces hello default creation and opening of a SQL Client connection.</span></span> <span data-ttu-id="c9bd1-156">Hola [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) llamada toma argumentos de Hola que son necesarios para el enrutamiento dependiente de datos:</span><span class="sxs-lookup"><span data-stu-id="c9bd1-156">hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call takes hello arguments that are required for data dependent routing:</span></span> 

* <span data-ttu-id="c9bd1-157">tooaccess de mapa de particiones de Hola Hola interfaces de enrutamiento dependiente de datos</span><span class="sxs-lookup"><span data-stu-id="c9bd1-157">hello shard map tooaccess hello data dependent routing interfaces</span></span>
* <span data-ttu-id="c9bd1-158">Hola particionamiento tooidentify clave hello shardlet</span><span class="sxs-lookup"><span data-stu-id="c9bd1-158">hello sharding key tooidentify hello shardlet</span></span>
* <span data-ttu-id="c9bd1-159">partición de toohello tooconnect de Hello credenciales (nombre de usuario y contraseña)</span><span class="sxs-lookup"><span data-stu-id="c9bd1-159">hello credentials (user name and password) tooconnect toohello shard</span></span>

<span data-ttu-id="c9bd1-160">objeto de mapa de particiones de Hello crea una partición de toohello de conexión que contiene shardlet Hola Hola clave de particionamiento dada.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-160">hello shard map object creates a connection toohello shard that holds hello shardlet for hello given sharding key.</span></span> <span data-ttu-id="c9bd1-161">las API de cliente de base de datos elástica Hello también etiquetar Hola conexión tooimplement garantiza su coherencia.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-161">hello elastic database client APIs also tag hello connection tooimplement its consistency guarantees.</span></span> <span data-ttu-id="c9bd1-162">Desde Hola llamar demasiado[OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) devuelve un objeto regular de conexión de cliente de SQL, Hola llamada subsiguiente toohello **Execute** método de extensión de sigue Dapper Hola Dapper estándar práctica.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-162">Since hello call too[OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) returns a regular SQL Client connection object, hello subsequent call toohello **Execute** extension method from Dapper follows hello standard Dapper practice.</span></span>

<span data-ttu-id="c9bd1-163">Consultas de trabajo muy Hola mismo forma - abrir por primera vez Hola conexión mediante [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) de API de cliente de Hola.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-163">Queries work very much hello same way - you first open hello connection using [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) from hello client API.</span></span> <span data-ttu-id="c9bd1-164">A continuación, utilice Hola regular extensión Dapper métodos toomap Hola resultados de la consulta SQL en objetos .NET:</span><span class="sxs-lookup"><span data-stu-id="c9bd1-164">Then you use hello regular Dapper extension methods toomap hello results of your SQL query into .NET objects:</span></span>

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId1, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate ))
    {    
           // Display all Blogs for tenant 1
           IEnumerable<Blog> result = sqlconn.Query<Blog>(@"
                                SELECT * 
                                FROM Blog
                                ORDER BY Name");

           Console.WriteLine("All blogs for tenant id {0}:", tenantId1);
           foreach (var item in result)
           {
                Console.WriteLine(item.Name);
            }
    }

<span data-ttu-id="c9bd1-165">Tenga en cuenta que hello **con** bloque con ámbitos de conexión de DDR de hello todas las operaciones de base de datos dentro de hello bloque toohello una partición que se conserva tenantId1.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-165">Note that hello **using** block with hello DDR connection scopes all database operations within hello block toohello one shard where tenantId1 is kept.</span></span> <span data-ttu-id="c9bd1-166">consulta de Hello solo devuelve blogs almacenados en la partición actual de hello, pero no Hola los almacenados en las otras particiones.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-166">hello query only returns blogs stored on hello current shard, but not hello ones stored on any other shards.</span></span> 

## <a name="data-dependent-routing-with-dapper-and-dapperextensions"></a><span data-ttu-id="c9bd1-167">Enrutamiento dependiente de datos con Dapper y DapperExtensions</span><span class="sxs-lookup"><span data-stu-id="c9bd1-167">Data dependent routing with Dapper and DapperExtensions</span></span>
<span data-ttu-id="c9bd1-168">Dapper incluye un ecosistema de extensiones adicionales que puede proporcionar más abstracción de base de datos de Hola y comodidad al desarrollar aplicaciones de base de datos.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-168">Dapper comes with an ecosystem of additional extensions that can provide further convenience and abstraction from hello database when developing database applications.</span></span> <span data-ttu-id="c9bd1-169">DapperExtensions es un ejemplo.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-169">DapperExtensions is an example.</span></span> 

<span data-ttu-id="c9bd1-170">El hecho de usar DapperExtensions en la aplicación no cambia la forma en que se crean y administran las conexiones de base de datos.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-170">Using DapperExtensions in your application does not change how database connections are created and managed.</span></span> <span data-ttu-id="c9bd1-171">Se esperan regulares objetos de conexión de cliente de SQL con métodos de extensión de Hola y sigue siendo tooopen conexiones de la aplicación hello responsabilidad.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-171">It is still hello application’s responsibility tooopen connections, and regular SQL Client connection objects are expected by hello extension methods.</span></span> <span data-ttu-id="c9bd1-172">Podemos confiamos en hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) tal y como se ha descrito anteriormente.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-172">We can rely on hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) as outlined above.</span></span> <span data-ttu-id="c9bd1-173">Hola ejemplos de código siguientes muestran, Hola único cambio es que ya no tenemos las instrucciones de T-SQL Hola toowrite:</span><span class="sxs-lookup"><span data-stu-id="c9bd1-173">As hello following code samples show, hello only change is that we do no longer have toowrite hello T-SQL statements:</span></span>

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId2, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate))
    {
           var blog = new Blog { Name = name2 };
           sqlconn.Insert(blog);
    }

<span data-ttu-id="c9bd1-174">Y este es el ejemplo de código de hello para consulta de hello:</span><span class="sxs-lookup"><span data-stu-id="c9bd1-174">And here is hello code sample for hello query:</span></span> 

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId2, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate))
    {
           // Display all Blogs for tenant 2
           IEnumerable<Blog> result = sqlconn.GetList<Blog>();
           Console.WriteLine("All blogs for tenant id {0}:", tenantId2);
           foreach (var item in result)
           {
               Console.WriteLine(item.Name);
           }
    }

### <a name="handling-transient-faults"></a><span data-ttu-id="c9bd1-175">Control de errores transitorios</span><span class="sxs-lookup"><span data-stu-id="c9bd1-175">Handling transient faults</span></span>
<span data-ttu-id="c9bd1-176">Hello Microsoft Patterns & Practices equipo Hola publicado [Transient Fault Handling Application Block](http://msdn.microsoft.com/library/hh680934.aspx) los desarrolladores de aplicaciones de toohelp mitigar condiciones comunes de errores transitorios encontradas cuando se ejecuta en la nube de Hola.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-176">hello Microsoft Patterns & Practices team published hello [Transient Fault Handling Application Block](http://msdn.microsoft.com/library/hh680934.aspx) toohelp application developers mitigate common transient fault conditions encountered when running in hello cloud.</span></span> <span data-ttu-id="c9bd1-177">Para obtener más información, consulte [su perseverancia, secreto de todos los logros: mediante Hola Transient Fault Handling Application Block](http://msdn.microsoft.com/library/dn440719.aspx).</span><span class="sxs-lookup"><span data-stu-id="c9bd1-177">For more information, see [Perseverance, Secret of All Triumphs: Using hello Transient Fault Handling Application Block](http://msdn.microsoft.com/library/dn440719.aspx).</span></span>

<span data-ttu-id="c9bd1-178">ejemplo de código de Hello se basa en hello errores transitorios biblioteca tooprotect frente a errores transitorios.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-178">hello code sample relies on hello transient fault library tooprotect against transient faults.</span></span> 

    SqlDatabaseUtils.SqlRetryPolicy.ExecuteAction(() =>
    {
       using (SqlConnection sqlconn = 
          shardingLayer.ShardMap.OpenConnectionForKey(tenantId2, connStrBldr.ConnectionString, ConnectionOptions.Validate))
          {
              var blog = new Blog { Name = name2 };
              sqlconn.Insert(blog);
          }
    });

<span data-ttu-id="c9bd1-179">**SqlDatabaseUtils.SqlRetryPolicy** en hello código anterior se define como un **SqlDatabaseTransientErrorDetectionStrategy** con un número de reintentos de 10 y 5 segundos de tiempo entre los reintentos de espera.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-179">**SqlDatabaseUtils.SqlRetryPolicy** in hello code above is defined as a **SqlDatabaseTransientErrorDetectionStrategy** with a retry count of 10, and 5 seconds wait time between retries.</span></span> <span data-ttu-id="c9bd1-180">Si está usando transacciones, asegúrese de que el ámbito de reintento vuelve toohello principio de la transacción de hello en caso de hello de un error transitorio.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-180">If you are using transactions, make sure that your retry scope goes back toohello beginning of hello transaction in hello case of a transient fault.</span></span>

## <a name="limitations"></a><span data-ttu-id="c9bd1-181">Limitaciones</span><span class="sxs-lookup"><span data-stu-id="c9bd1-181">Limitations</span></span>
<span data-ttu-id="c9bd1-182">enfoques de Hola que se describen en este documento implican un par de limitaciones:</span><span class="sxs-lookup"><span data-stu-id="c9bd1-182">hello approaches outlined in this document entail a couple of limitations:</span></span>

* <span data-ttu-id="c9bd1-183">código de ejemplo de Hola para este documento no se muestra cómo toomanage esquema entre las particiones.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-183">hello sample code for this document does not demonstrate how toomanage schema across shards.</span></span>
* <span data-ttu-id="c9bd1-184">Dada una solicitud, se asume que todo el procesamiento de su base de datos está contenido en una sola partición identificada por la clave de particionamiento de hello proporcionada por solicitud de saludo.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-184">Given a request, we assume that all its database processing is contained within a single shard as identified by hello sharding key provided by hello request.</span></span> <span data-ttu-id="c9bd1-185">Sin embargo, esta suposición no siempre contener, por ejemplo, cuando no es posible toomake una clave de particionamiento disponible.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-185">However, this assumption does not always hold, for example, when it is not possible toomake a sharding key available.</span></span> <span data-ttu-id="c9bd1-186">tooaddress, Hola biblioteca de cliente de base de datos elástico incluye hello [MultiShardQuery clase](http://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardexception.aspx).</span><span class="sxs-lookup"><span data-stu-id="c9bd1-186">tooaddress this, hello elastic database client library includes hello [MultiShardQuery class](http://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardexception.aspx).</span></span> <span data-ttu-id="c9bd1-187">clase Hello implementa una abstracción de conexión para las consultas en varias particiones.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-187">hello class implements a connection abstraction for querying over several shards.</span></span> <span data-ttu-id="c9bd1-188">Uso de MultiShardQuery en combinación con Dapper es más allá del ámbito de Hola de este documento.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-188">Using MultiShardQuery in combination with Dapper is beyond hello scope of this document.</span></span>

## <a name="conclusion"></a><span data-ttu-id="c9bd1-189">Conclusión</span><span class="sxs-lookup"><span data-stu-id="c9bd1-189">Conclusion</span></span>
<span data-ttu-id="c9bd1-190">Las aplicaciones que usan Dapper y DapperExtensions pueden beneficiarse fácilmente de las herramientas de bases de datos elásticas para Base de datos SQL de Azure.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-190">Applications using Dapper and DapperExtensions can easily benefit from elastic database tools for Azure SQL Database.</span></span> <span data-ttu-id="c9bd1-191">A través de hello pasos que se describen en este documento, esas aplicaciones pueden usar la capacidad de la herramienta de Hola para datos que dependen de enrutamiento cambiando la creación de hello y abrir de nuevo [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) hello toouse de objetos [ OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) llamada Hola elástico de base de datos de biblioteca de cliente.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-191">Through hello steps outlined in this document, those applications can use hello tool's capability for data dependent routing by changing hello creation and opening of new [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects toouse hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call of hello elastic database client library.</span></span> <span data-ttu-id="c9bd1-192">Esto limita toothose necesario lugares donde se crea y se abre nuevas conexiones de hello aplicación cambios.</span><span class="sxs-lookup"><span data-stu-id="c9bd1-192">This limits hello application changes required toothose places where new connections are created and opened.</span></span> 

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Image references-->
[1]: ./media/sql-database-elastic-scale-working-with-dapper/dapperimage1.png

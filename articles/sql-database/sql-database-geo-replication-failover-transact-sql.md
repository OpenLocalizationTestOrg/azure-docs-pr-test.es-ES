---
title: "TSQL: inicio de una conmutación por error para Azure SQL Database | Microsoft Docs"
description: "Inicio de una conmutación por error planeada o no planeada para Base de datos SQL de Azure con Transact-SQL"
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: 5eb2d256-025d-4f5a-99d4-17f702b37f14
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: 418953e044ba84ce758063d56a371af45d5cdfe1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="initiate-a-planned-or-unplanned-failover-for-azure-sql-database-with-transact-sql"></a><span data-ttu-id="c2225-103">Inicio de una conmutación por error planeada o no planeada para Base de datos SQL de Azure con Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="c2225-103">Initiate a planned or unplanned failover for Azure SQL Database with Transact-SQL</span></span>

<span data-ttu-id="c2225-104">Este artículo muestra cómo tooa de conmutación por error tooinitiate base de datos SQL secundaria mediante Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="c2225-104">This article shows you how tooinitiate failover tooa secondary SQL Database using Transact-SQL.</span></span> <span data-ttu-id="c2225-105">replicación geográfica tooconfigure, consulte [configurar la replicación geográfica para la base de datos de SQL Azure](sql-database-geo-replication-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="c2225-105">tooconfigure geo-replication, see [Configure geo-replication for Azure SQL Database](sql-database-geo-replication-transact-sql.md).</span></span>

<span data-ttu-id="c2225-106">conmutación por error tooinitiate, necesita siguiente de hello:</span><span class="sxs-lookup"><span data-stu-id="c2225-106">tooinitiate failover, you need hello following:</span></span>

* <span data-ttu-id="c2225-107">Un inicio de sesión es DBManager en hello principal</span><span class="sxs-lookup"><span data-stu-id="c2225-107">A login that is DBManager on hello primary</span></span>
* <span data-ttu-id="c2225-108">Tiene db_ownership de hello base de datos local que se va a replicar geográficamente</span><span class="sxs-lookup"><span data-stu-id="c2225-108">Have db_ownership of hello local database that you will geo-replicate</span></span>
* <span data-ttu-id="c2225-109">Estar DBManager en hello asociado servidores toowhich que va a configurar la replicación geográfica</span><span class="sxs-lookup"><span data-stu-id="c2225-109">Be DBManager on hello partner server(s) toowhich you will configure geo-replication</span></span>
* <span data-ttu-id="c2225-110">La versión más reciente de SQL Server Management Studio (SSMS).</span><span class="sxs-lookup"><span data-stu-id="c2225-110">Newest version of SQL Server Management Studio (SSMS)</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c2225-111">Se recomienda que siempre utilice Hola versión más reciente de Management Studio tooremain sincronizada con actualizaciones tooMicrosoft Azure y base de datos SQL.</span><span class="sxs-lookup"><span data-stu-id="c2225-111">It is recommended that you always use hello latest version of Management Studio tooremain synchronized with updates tooMicrosoft Azure and SQL Database.</span></span> <span data-ttu-id="c2225-112">[Actualice SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span><span class="sxs-lookup"><span data-stu-id="c2225-112">[Update SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span></span>
>  

## <a name="initiate-a-planned-failover-promoting-a-secondary-database-toobecome-hello-new-primary"></a><span data-ttu-id="c2225-113">Iniciar una conmutación por error planeada promover una base de datos secundaria toobecome Hola principal</span><span class="sxs-lookup"><span data-stu-id="c2225-113">Initiate a planned failover promoting a secondary database toobecome hello new primary</span></span>
<span data-ttu-id="c2225-114">Puede usar hello **ALTER DATABASE** instrucción toopromote una base de datos secundaria toobecome Hola principal de base de datos de un modo planeado, disminuir de nivel toobecome principal existente de hello una base de datos secundaria.</span><span class="sxs-lookup"><span data-stu-id="c2225-114">You can use hello **ALTER DATABASE** statement toopromote a secondary database toobecome hello new primary database in a planned fashion, demoting hello existing primary toobecome a secondary.</span></span> <span data-ttu-id="c2225-115">Esta instrucción se ejecuta en la base de datos maestra de hello en el servidor lógico en la base de datos de SQL Azure de hello en qué Hola reside georreplicadas base de datos secundaria que se está promocionando.</span><span class="sxs-lookup"><span data-stu-id="c2225-115">This statement is executed on hello master database on hello Azure SQL Database logical server in which hello geo-replicated secondary database that is being promoted resides.</span></span> <span data-ttu-id="c2225-116">Esta funcionalidad está diseñada para conmutación por error planeada, como durante los ejercicios de hello recuperación ante desastres y requiere que esa base de datos principal de hello esté disponible.</span><span class="sxs-lookup"><span data-stu-id="c2225-116">This functionality is designed for planned failover, such as during hello DR drills, and requires that hello primary database be available.</span></span>

<span data-ttu-id="c2225-117">comando de Hello realiza Hola siguiendo el flujo de trabajo:</span><span class="sxs-lookup"><span data-stu-id="c2225-117">hello command performs hello following workflow:</span></span>

1. <span data-ttu-id="c2225-118">Temporalmente modo de toosynchronous de replicación de conmutadores, provocando toobe de todas las transacciones pendientes vaciados toohello secundaria y bloqueo de todas las nuevas transacciones;</span><span class="sxs-lookup"><span data-stu-id="c2225-118">Temporarily switches replication toosynchronous mode, causing all outstanding transactions toobe flushed toohello secondary and blocking all new transactions;</span></span>
2. <span data-ttu-id="c2225-119">Conmutadores Hola roles de dos bases de datos hello en colaboración de replicación geográfica de Hola.</span><span class="sxs-lookup"><span data-stu-id="c2225-119">Switches hello roles of hello two databases in hello geo-replication partnership.</span></span>  

<span data-ttu-id="c2225-120">Esta secuencia garantiza que Hola dos bases de datos se sincronizan antes de cambiar los roles de hello y, por tanto, se producirá ninguna pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="c2225-120">This sequence guarantees that hello two databases are synchronized before hello roles switch and therefore no data loss will occur.</span></span> <span data-ttu-id="c2225-121">Hay un breve período durante el cual ambas bases de datos no están disponibles (en orden de Hola de 0 segundos too25) mientras conmutación de roles de Hola.</span><span class="sxs-lookup"><span data-stu-id="c2225-121">There is a short period during which both databases are unavailable (on hello order of 0 too25 seconds) while hello roles are switched.</span></span> <span data-ttu-id="c2225-122">Si la base de datos principal de hello tiene varias bases de datos secundarias, comando Hola se automáticamente reconfigure Hola otro secundarias tooconnect toohello nuevo elemento principal.</span><span class="sxs-lookup"><span data-stu-id="c2225-122">If hello primary database has multiple secondary databases, hello command will automatically reconfigure hello other secondaries tooconnect toohello new primary.</span></span>  <span data-ttu-id="c2225-123">toda operación de Hello tardará menos de un minuto toocomplete en circunstancias normales.</span><span class="sxs-lookup"><span data-stu-id="c2225-123">hello entire operation should take less than a minute toocomplete under normal circumstances.</span></span> <span data-ttu-id="c2225-124">Para más información, vea [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) y [Niveles de servicio](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="c2225-124">For more information, see [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) and [Service Tiers](sql-database-service-tiers.md).</span></span>

<span data-ttu-id="c2225-125">Usar hello siguiendo los pasos tooinitiate una conmutación por error planeada.</span><span class="sxs-lookup"><span data-stu-id="c2225-125">Use hello following steps tooinitiate a planned failover.</span></span>

1. <span data-ttu-id="c2225-126">En Management Studio, conecte el servidor lógico en la base de datos de SQL Azure de toohello en el que reside una base de datos secundaria de replicación geográfica.</span><span class="sxs-lookup"><span data-stu-id="c2225-126">In Management Studio, connect toohello Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="c2225-127">Abra la carpeta de bases de datos de hello, expanda hello **bases de datos de sistema** carpeta, el botón secundario en **maestro**y, a continuación, haga clic en **nueva consulta**.</span><span class="sxs-lookup"><span data-stu-id="c2225-127">Open hello Databases folder, expand hello **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="c2225-128">Utilice Hola siguiente **ALTER DATABASE** rol principal de toohello de base de datos secundaria tooswitch de Hola de instrucción.</span><span class="sxs-lookup"><span data-stu-id="c2225-128">Use hello following **ALTER DATABASE** statement tooswitch hello secondary database toohello primary role.</span></span>
   
        ALTER DATABASE <MyDB> FAILOVER;
4. <span data-ttu-id="c2225-129">Haga clic en **Execute** consulta de hello toorun.</span><span class="sxs-lookup"><span data-stu-id="c2225-129">Click **Execute** toorun hello query.</span></span>

> [!NOTE]
> <span data-ttu-id="c2225-130">En raras ocasiones, es posible que la operación de hello no se puede completar y puede aparecer bloqueada.</span><span class="sxs-lookup"><span data-stu-id="c2225-130">In rare cases, it is possible that hello operation cannot complete and may appear stuck.</span></span> <span data-ttu-id="c2225-131">En este caso, usuario Hola puede ejecutar el comando para forzar la conmutación por error hello y Aceptar pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="c2225-131">In this case, hello user can execute hello force failover command and accept data loss.</span></span>
> 
> 

## <a name="initiate-an-unplanned-failover-from-hello-primary-database-toohello-secondary-database"></a><span data-ttu-id="c2225-132">Iniciar una conmutación por error no planeada de base de datos secundaria de hello base de datos principal toohello</span><span class="sxs-lookup"><span data-stu-id="c2225-132">Initiate an unplanned failover from hello primary database toohello secondary database</span></span>
<span data-ttu-id="c2225-133">Puede usar hello **ALTER DATABASE** instrucción toopromote una base de datos secundaria toobecome Hola principal de base de datos de forma no planeada para forzar la degradación de Hola de toobecome principal existente de hello una base de datos secundaria a la vez cuando Hola base de datos principal ya no está disponible.</span><span class="sxs-lookup"><span data-stu-id="c2225-133">You can use hello **ALTER DATABASE** statement toopromote a secondary database toobecome hello new primary database in an unplanned fashion, forcing hello demotion of hello existing primary toobecome a secondary at a time when hello primary database is no longer available.</span></span> <span data-ttu-id="c2225-134">Esta instrucción se ejecuta en la base de datos maestra de hello en el servidor lógico en la base de datos de SQL Azure de hello en qué Hola reside georreplicadas base de datos secundaria que se está promocionando.</span><span class="sxs-lookup"><span data-stu-id="c2225-134">This statement is executed on hello master database on hello Azure SQL Database logical server in which hello geo-replicated secondary database that is being promoted resides.</span></span>

<span data-ttu-id="c2225-135">Esta funcionalidad está diseñada para la recuperación ante desastres cuando sea crucial la disponibilidad de restauración de base de datos de Hola y alguna pérdida de datos es aceptable.</span><span class="sxs-lookup"><span data-stu-id="c2225-135">This functionality is designed for disaster recovery when restoring availability of hello database is critical and some data loss is acceptable.</span></span> <span data-ttu-id="c2225-136">Cuando se invoca la conmutación por error forzada, Hola especifica la base de datos secundaria se convierte en la base de datos principal de hello inmediatamente y comienza a aceptar las transacciones de escritura.</span><span class="sxs-lookup"><span data-stu-id="c2225-136">When forced failover is invoked, hello specified secondary database immediately becomes hello primary database and begins accepting write transactions.</span></span> <span data-ttu-id="c2225-137">Tan pronto como base de datos principal Hola original es capaz de tooreconnect con esta nueva base de datos principal, se realiza una copia de seguridad incremental en la base de datos principal Hola original y base de datos principal Hola anterior se convierte en una base de datos secundaria para hello nueva base de datos principal; como consecuencia, es simplemente una réplica sincronizar de nuevo elemento principal Hola.</span><span class="sxs-lookup"><span data-stu-id="c2225-137">As soon as hello original primary database is able tooreconnect with this new primary database, an incremental backup is taken on hello original primary database and hello old primary database is made into a secondary database for hello new primary database; subsequently, it is merely a synchronizing replica of hello new primary.</span></span>

<span data-ttu-id="c2225-138">Sin embargo, porque el punto de restauración a un momento no se admite en bases de datos secundarias de hello, si desea que un usuario de hello datos toorecover confirmados toohello antigua base de datos principal que no se hubiera toohello nuevo principal base de datos replicada antes de hello forzada conmutación por error se ha producido, Hello usuario deberá tooengage compatibilidad toorecover se pierden datos.</span><span class="sxs-lookup"><span data-stu-id="c2225-138">However, because Point In Time Restore is not supported on hello secondary databases, if hello user wishes toorecover data committed toohello old primary database that had not been replicated toohello new primary database before hello forced failover occurred, hello user will need tooengage support toorecover this lost data.</span></span>

<span data-ttu-id="c2225-139">Si la base de datos principal de hello tiene varias bases de datos secundarias, comando Hola se automáticamente reconfigure Hola otro secundarias tooconnect toohello nuevo elemento principal.</span><span class="sxs-lookup"><span data-stu-id="c2225-139">If hello primary database has multiple secondary databases, hello command will automatically reconfigure hello other secondaries tooconnect toohello new primary.</span></span>

<span data-ttu-id="c2225-140">Usar hello siguiendo los pasos tooinitiate una conmutación por error no planeada.</span><span class="sxs-lookup"><span data-stu-id="c2225-140">Use hello following steps tooinitiate an unplanned failover.</span></span>

1. <span data-ttu-id="c2225-141">En Management Studio, conecte el servidor lógico en la base de datos de SQL Azure de toohello en el que reside una base de datos secundaria de replicación geográfica.</span><span class="sxs-lookup"><span data-stu-id="c2225-141">In Management Studio, connect toohello Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="c2225-142">Abra la carpeta de bases de datos de hello, expanda hello **bases de datos de sistema** carpeta, el botón secundario en **maestro**y, a continuación, haga clic en **nueva consulta**.</span><span class="sxs-lookup"><span data-stu-id="c2225-142">Open hello Databases folder, expand hello **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="c2225-143">Utilice Hola siguiente **ALTER DATABASE** rol principal de toohello de base de datos secundaria tooswitch de Hola de instrucción.</span><span class="sxs-lookup"><span data-stu-id="c2225-143">Use hello following **ALTER DATABASE** statement tooswitch hello secondary database toohello primary role.</span></span>
   
        ALTER DATABASE <MyDB>   FORCE_FAILOVER_ALLOW_DATA_LOSS;
4. <span data-ttu-id="c2225-144">Haga clic en **Execute** consulta de hello toorun.</span><span class="sxs-lookup"><span data-stu-id="c2225-144">Click **Execute** toorun hello query.</span></span>

> [!NOTE]
> <span data-ttu-id="c2225-145">Si se emite el comando de hello cuando principal y secundaria en línea se convertirá en el principal antiguo Hola Hola nueva base de datos secundaria inmediatamente sin necesidad de sincronización de datos.</span><span class="sxs-lookup"><span data-stu-id="c2225-145">If hello command is issued when both primary and secondary are online hello old primary will become hello new secondary immediately without data synchronization.</span></span> <span data-ttu-id="c2225-146">Si está de hello principal pueden producirse las transacciones de confirmación cuando se emite el comando de hello alguna pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="c2225-146">If hello primary is committing transactions when hello command is issued some data loss may occur.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="c2225-147">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="c2225-147">Next steps</span></span>
* <span data-ttu-id="c2225-148">Después de la conmutación por error, asegúrese de que los requisitos de autenticación de hello para el servidor y la base de datos se configuran en la nueva réplica principal de Hola.</span><span class="sxs-lookup"><span data-stu-id="c2225-148">After failover, ensure hello authentication requirements for your server and database are configured on hello new primary.</span></span> <span data-ttu-id="c2225-149">Para obtener más información, consulte [Administración de la seguridad de Base de datos SQL de Azure después de la recuperación ante desastres](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="c2225-149">For details, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>
* <span data-ttu-id="c2225-150">toolearn en la recuperación tras un desastre utilizando la replicación geográfica activa, incluidos los pasos de recuperación anteriores y posteriores a la recuperación y realizar una exploración de recuperación ante desastres, consulte [recuperación ante desastres](sql-database-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="c2225-150">toolearn recovering after a disaster using active geo-replication, including pre-recovery and post-recovery steps and performing a disaster recovery drill, see [Disaster Recovery](sql-database-disaster-recovery.md)</span></span>
* <span data-ttu-id="c2225-151">Para ver una entrada de blog de Sasha Nosov sobre la replicación geográfica activa, consulte [Spotlight on new Geo-Replication capabilities](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span><span class="sxs-lookup"><span data-stu-id="c2225-151">For a Sasha Nosov blog post about active geo-replication, see [Spotlight on new geo-replication capabilities](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span></span>
* <span data-ttu-id="c2225-152">Para obtener información acerca de cómo diseñar en la nube aplicaciones toouse replicación geográfica activa, consulte [diseño de aplicaciones de nube para la continuidad del negocio con la replicación geográfica](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="c2225-152">For information about designing cloud applications toouse active geo-replication, see [Designing cloud applications for business continuity using geo-replication](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span></span>
* <span data-ttu-id="c2225-153">Para saber cómo utilizar la replicación geográfica activa con los grupos elásticos, consulte [Estrategias de recuperación ante desastres para grupos elásticos](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="c2225-153">For information about using active geo-replication with elastic pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
* <span data-ttu-id="c2225-154">Para ver una descripción general de la continuidad empresarial, consulte el artículo de [introducción a la continuidad empresarial con Azure SQL Database](sql-database-business-continuity.md).</span><span class="sxs-lookup"><span data-stu-id="c2225-154">For an overview of business continuity, see [Business Continuity Overview](sql-database-business-continuity.md)</span></span>


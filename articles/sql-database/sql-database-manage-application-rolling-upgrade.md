---
title: 'Actualizaciones graduales de aplicaciones: Azure SQL Database | Microsoft Docs'
description: "Aprenda a usar la replicación geográfica en Base de datos SQL para admitir las actualizaciones en línea de la aplicación en la nube."
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 58f42859-1e37-463c-a3d8-a3ca2e867148
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 07/16/2016
ms.author: sashan
ms.openlocfilehash: 4b59c8aa3dea3e8fba692ab66420295a09210d3b
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="managing-rolling-upgrades-of-cloud-applications-using-sql-database-active-geo-replication"></a><span data-ttu-id="c22ed-103">Administración de actualizaciones graduales de aplicaciones en la nube mediante la replicación geográfica activa de SQL Database</span><span class="sxs-lookup"><span data-stu-id="c22ed-103">Managing rolling upgrades of cloud applications using SQL Database active geo-replication</span></span>
> [!NOTE]
> <span data-ttu-id="c22ed-104">La [replicación geográfica activa](sql-database-geo-replication-overview.md) ahora está disponible para todas las bases de datos en todos los niveles.</span><span class="sxs-lookup"><span data-stu-id="c22ed-104">[Active geo-replication](sql-database-geo-replication-overview.md) is now available for all databases in all tiers.</span></span>
> 

<span data-ttu-id="c22ed-105">Aprenda a usar la [replicación geográfica](sql-database-geo-replication-overview.md) en SQL Database para permitir actualizaciones graduales de la aplicación en la nube.</span><span class="sxs-lookup"><span data-stu-id="c22ed-105">Learn how to use [geo-replication](sql-database-geo-replication-overview.md) in SQL Database to enable rolling upgrades of your cloud application.</span></span> <span data-ttu-id="c22ed-106">Como la actualización es una operación problemática, pues debe ser parte del diseño y planeamiento de continuidad.</span><span class="sxs-lookup"><span data-stu-id="c22ed-106">Because upgrade is a disruptive operation, it should be part of your business continuity planning and design.</span></span> <span data-ttu-id="c22ed-107">En este artículo veremos dos métodos diferentes de organizar el proceso de actualización y comentaremos las ventajas y desventajas de cada opción.</span><span class="sxs-lookup"><span data-stu-id="c22ed-107">In this article we look at two different methods of orchestrating the upgrade process, and discuss the benefits and trade-offs of each option.</span></span> <span data-ttu-id="c22ed-108">Para este artículo, usaremos una aplicación simple que consta de un sitio web conectado a una base de datos única como su capa de datos.</span><span class="sxs-lookup"><span data-stu-id="c22ed-108">For the purposes of this article we will use a simple application that consists of a web site connected to a single database as its data tier.</span></span> <span data-ttu-id="c22ed-109">Nuestro objetivo consiste en actualizar la versión 1 de la aplicación a la versión 2 sin que se observe ningún impacto importante en la experiencia del usuario final.</span><span class="sxs-lookup"><span data-stu-id="c22ed-109">Our goal is to upgrade version 1 of the application to version 2 without any significant impact on the end-user experience.</span></span> 

<span data-ttu-id="c22ed-110">Al evaluar las opciones de actualización, se deben considerar los factores siguientes:</span><span class="sxs-lookup"><span data-stu-id="c22ed-110">When evaluating the upgrade options you should consider the following factors:</span></span>

* <span data-ttu-id="c22ed-111">El impacto sobre la disponibilidad de las aplicaciones durante las actualizaciones.</span><span class="sxs-lookup"><span data-stu-id="c22ed-111">Impact on application availability during upgrades.</span></span> <span data-ttu-id="c22ed-112">Durante cuánto tiempo la función de aplicación debe estar limitada o degradada.</span><span class="sxs-lookup"><span data-stu-id="c22ed-112">How long the application function may be limited or degraded.</span></span>
* <span data-ttu-id="c22ed-113">La capacidad para deshacer el proceso en caso de errores durante la actualización.</span><span class="sxs-lookup"><span data-stu-id="c22ed-113">Ability to roll back in case of an upgrade failure.</span></span>
* <span data-ttu-id="c22ed-114">La vulnerabilidad de la aplicación si se produce un error grave no relacionado durante la actualización.</span><span class="sxs-lookup"><span data-stu-id="c22ed-114">Vulnerability of the application if an unrelated catastrophic failure occurs during the upgrade.</span></span>
* <span data-ttu-id="c22ed-115">El costo total en dólares.</span><span class="sxs-lookup"><span data-stu-id="c22ed-115">Total dollar cost.</span></span>  <span data-ttu-id="c22ed-116">Incluye redundancia adicional y costos incrementales de los componentes temporales usados en el proceso de actualización.</span><span class="sxs-lookup"><span data-stu-id="c22ed-116">This includes additional redundancy and incremental costs of the temporary components  used by the upgrade process.</span></span> 

## <a name="upgrading-applications-that-rely-on-database-backups-for-disaster-recovery"></a><span data-ttu-id="c22ed-117">La actualización de las aplicaciones que dependen de las copias de seguridad de base de datos para recuperación ante desastres.</span><span class="sxs-lookup"><span data-stu-id="c22ed-117">Upgrading applications that rely on database backups for disaster recovery</span></span>
<span data-ttu-id="c22ed-118">Si la aplicación se basa en copias de seguridad automáticas y utiliza la restauración geográfica para la recuperación ante desastres, normalmente se implementa en una única región de Azure.</span><span class="sxs-lookup"><span data-stu-id="c22ed-118">If your application relies on automatic database backups and uses geo-restore for disaster recovery, it is usually deployed to a single Azure region.</span></span> <span data-ttu-id="c22ed-119">En este caso el proceso de actualización implica la creación de una implementación de copia de seguridad de todos los componentes de la aplicación implicados en la actualización.</span><span class="sxs-lookup"><span data-stu-id="c22ed-119">In this case the upgrade process involves creating a backup deployment of all application components involved in the upgrade.</span></span> <span data-ttu-id="c22ed-120">Para minimizar la interrupción para el usuario final, se aprovechará del Administrador de tráfico de Azure (WATM) con el perfil de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="c22ed-120">To minimize the end-user disruption you will leverage Azure Traffic Manager (WATM) with the failover profile.</span></span>  <span data-ttu-id="c22ed-121">En el siguiente diagrama se ilustra el entorno operativo antes del proceso de actualización.</span><span class="sxs-lookup"><span data-stu-id="c22ed-121">The following diagram illustrates the operational environment prior to the upgrade process.</span></span> <span data-ttu-id="c22ed-122">El punto de conexión <i>contoso-1.azurewebsites.net</i> representa una ranura de producción de la aplicación que debe actualizarse.</span><span class="sxs-lookup"><span data-stu-id="c22ed-122">The endpoint <i>contoso-1.azurewebsites.net</i> represents a production slot of the application that needs to be upgraded.</span></span> <span data-ttu-id="c22ed-123">Para habilitar la capacidad de revertir la actualización, necesita crear un espacio de almacenamiento provisional con una copia totalmente sincronizada de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c22ed-123">To enable the ability to roll back the upgrade, you need create a stage slot with a fully synchronized copy of the application.</span></span> <span data-ttu-id="c22ed-124">Los siguientes pasos son necesarios para preparar la aplicación para la actualización:</span><span class="sxs-lookup"><span data-stu-id="c22ed-124">The following steps are required to prepare the application for the upgrade:</span></span>

1. <span data-ttu-id="c22ed-125">Cree una ranura de almacenamiento provisional para la actualización.</span><span class="sxs-lookup"><span data-stu-id="c22ed-125">Create a stage slot for the upgrade.</span></span> <span data-ttu-id="c22ed-126">Para ello, cree una base de datos secundaria (1) e implemente un sitio web idéntico en la misma región de Azure.</span><span class="sxs-lookup"><span data-stu-id="c22ed-126">To do that create a secondary database (1) and deploy an identical web site in the same Azure region.</span></span> <span data-ttu-id="c22ed-127">Supervise la base de datos secundaria para ver si se completa el proceso de propagación.</span><span class="sxs-lookup"><span data-stu-id="c22ed-127">Monitor the secondary to see if the seeding process is completed.</span></span>
2. <span data-ttu-id="c22ed-128">Cree un perfil de conmutación por error en WATM con <i>contoso-1.azurewebsites.net</i> como punto de conexión en línea y <i>contoso 2.azurewebsites.net</i> como punto de conexión desconectado.</span><span class="sxs-lookup"><span data-stu-id="c22ed-128">Create a failover profile in WATM with <i>contoso-1.azurewebsites.net</i> as online endpoint and <i>contoso-2.azurewebsites.net</i> as offline.</span></span> 

> [!NOTE]
> <span data-ttu-id="c22ed-129">Tenga en cuenta los pasos preparatorios no afectarán a la aplicación de la ranura de producción y puede funcionar en modo de acceso completo.</span><span class="sxs-lookup"><span data-stu-id="c22ed-129">Note the preparation steps will not impact the application in the production slot and it can function in full access mode.</span></span>
>  

![Configuración de la replicación geográfica de la Base de datos SQL.](media/sql-database-manage-application-rolling-upgrade/Option1-1.png)

<span data-ttu-id="c22ed-132">Una vez completados los pasos preparatorios, la aplicación está preparada para la actualización real.</span><span class="sxs-lookup"><span data-stu-id="c22ed-132">Once the preparation steps are completed the application is ready for the actual upgrade.</span></span> <span data-ttu-id="c22ed-133">En el siguiente diagrama se ilustran los pasos implicados en el proceso de actualización.</span><span class="sxs-lookup"><span data-stu-id="c22ed-133">The following diagram illustrates the steps involved in the upgrade process.</span></span> 

1. <span data-ttu-id="c22ed-134">Establezca la base de datos principal en la ranura de producción en modo de solo lectura (3).</span><span class="sxs-lookup"><span data-stu-id="c22ed-134">Set the primary database in the production slot to read-only mode (3).</span></span> <span data-ttu-id="c22ed-135">Esto garantizará que la instancia de producción de la aplicación (V1) seguirá siendo de solo lectura durante la actualización, con lo que se impide la divergencia de datos entre las instancias de base de datos de V1 y V2.</span><span class="sxs-lookup"><span data-stu-id="c22ed-135">This will guarantee that the production instance of the application (V1) will remain read-only during the upgrade thus preventing the data divergence between the V1 and V2 database instances.</span></span>  
2. <span data-ttu-id="c22ed-136">Desconecte la base de datos secundaria con el modo de finalización planeada (4).</span><span class="sxs-lookup"><span data-stu-id="c22ed-136">Disconnect the secondary database using the planned termination mode (4).</span></span> <span data-ttu-id="c22ed-137">Se creará una copia independiente totalmente sincronizada de la base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="c22ed-137">It will create a fully synchronized independent copy of the primary database.</span></span> <span data-ttu-id="c22ed-138">Esta base de datos se actualizará.</span><span class="sxs-lookup"><span data-stu-id="c22ed-138">This database will be upgraded.</span></span>
3. <span data-ttu-id="c22ed-139">Cambie la base de datos principal al modo de lectura y escritura, y ejecute el script de actualización en la ranura de almacenamiento provisional (5).</span><span class="sxs-lookup"><span data-stu-id="c22ed-139">Turn the primary database to read-write mode and run the upgrade script in the stage slot  (5).</span></span>     

![Configuración de replicación geográfica de SQL Database.](media/sql-database-manage-application-rolling-upgrade/Option1-2.png)

<span data-ttu-id="c22ed-142">Si la actualización se completó correctamente, ya está listo para cambiar los usuarios finales a la copia almacenada provisionalmente.</span><span class="sxs-lookup"><span data-stu-id="c22ed-142">If the upgrade completed successfully you are now ready to switch the end users to the staged copy the application.</span></span> <span data-ttu-id="c22ed-143">Ahora se convertirá en la ranura de producción de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c22ed-143">It will now become the production slot of the application.</span></span>  <span data-ttu-id="c22ed-144">Esto implica unos pocos pasos más, tal como se muestra en el diagrama siguiente.</span><span class="sxs-lookup"><span data-stu-id="c22ed-144">This involves a few more steps as illustrated on the following diagram.</span></span>

1. <span data-ttu-id="c22ed-145">Cambie el punto de conexión en línea en el perfil de WATM a <i>contoso-2.azurewebsites.net</i>, que señala a la versión V2 del sitio web (6).</span><span class="sxs-lookup"><span data-stu-id="c22ed-145">Switch the online endpoint in the WATM profile to <i>contoso-2.azurewebsites.net</i>, which points to the V2 version of the web site (6).</span></span> <span data-ttu-id="c22ed-146">Ahora se convierte en el espacio de producción con la aplicación V2 y el tráfico de usuarios finales se dirige a él.</span><span class="sxs-lookup"><span data-stu-id="c22ed-146">It now becomes the production slot with the V2 application and the end-user traffic is directed to it.</span></span>  
2. <span data-ttu-id="c22ed-147">Si ya no necesita los componentes de la aplicación V1, puede quitarlos (7).</span><span class="sxs-lookup"><span data-stu-id="c22ed-147">If you no longer need the V1 application components so you can safely remove them (7).</span></span>   

![Configuración de replicación geográfica de SQL Database.](media/sql-database-manage-application-rolling-upgrade/Option1-3.png)

<span data-ttu-id="c22ed-150">Si el proceso de actualización es incorrecto, por ejemplo debido a un error en el script de actualización, la ranura de almacenamiento provisional debe considerarse en peligro.</span><span class="sxs-lookup"><span data-stu-id="c22ed-150">If the upgrade process is unsuccessful, for example due to an error in the upgrade script, the stage slot should be considered compromised.</span></span> <span data-ttu-id="c22ed-151">Para revertir la aplicación al estado previo a la actualización, simplemente revierta la aplicación en el espacio de producción al acceso completo.</span><span class="sxs-lookup"><span data-stu-id="c22ed-151">To roll back the application to the pre-upgrade state you simply revert the application in the production slot to full access.</span></span> <span data-ttu-id="c22ed-152">En el diagrama siguiente se muestran los pasos implicados.</span><span class="sxs-lookup"><span data-stu-id="c22ed-152">The steps involved are shown on the next diagram.</span></span>    

1. <span data-ttu-id="c22ed-153">Establezca la copia de la base de datos en modo de lectura y escritura (8).</span><span class="sxs-lookup"><span data-stu-id="c22ed-153">Set the database copy to read-write mode (8).</span></span> <span data-ttu-id="c22ed-154">Esto restaurará la funcionalidad de V1 completa en la ranura de producción.</span><span class="sxs-lookup"><span data-stu-id="c22ed-154">This will restore the full V1 functionally in the production slot.</span></span>
2. <span data-ttu-id="c22ed-155">Realice el análisis de causa raíz y quite los componentes en peligro de la ranura de almacenamiento provisional (9).</span><span class="sxs-lookup"><span data-stu-id="c22ed-155">Perform the root cause analysis and remove the compromised components in the stage slot (9).</span></span> 

<span data-ttu-id="c22ed-156">En este punto, la aplicación es totalmente funcional y se pueden repetir los pasos de actualización.</span><span class="sxs-lookup"><span data-stu-id="c22ed-156">At this point the application is fully functional and the upgrade steps can be repeated.</span></span>

> [!NOTE]
> <span data-ttu-id="c22ed-157">La reversión no requiere cambios en el perfil de WATM, ya que apunta a <i>contoso-1.azurewebsites.net</i> como el punto de conexión activo.</span><span class="sxs-lookup"><span data-stu-id="c22ed-157">The rollback does not require changes in WATM profile as it already points to <i>contoso-1.azurewebsites.net</i> as the active endpoint.</span></span>
> 
> 

![Configuración de replicación geográfica de SQL Database.](media/sql-database-manage-application-rolling-upgrade/Option1-4.png)

<span data-ttu-id="c22ed-160">La principal **ventaja** de esta opción es que se puede actualizar una aplicación en una sola región mediante un conjunto de pasos sencillos.</span><span class="sxs-lookup"><span data-stu-id="c22ed-160">The key **advantage** of this option is that you can upgrade an application in a single region using a set of simple steps.</span></span> <span data-ttu-id="c22ed-161">El costo de la actualización es relativamente bajo.</span><span class="sxs-lookup"><span data-stu-id="c22ed-161">The dollar cost of the upgrade is relatively low.</span></span> <span data-ttu-id="c22ed-162">La principal **contrapartida** es que si se produce un error grave durante la actualización, la recuperación al estado previo a la actualización implicará que haya que volver a implementar la aplicación en una región distinta y restaurar la base de datos desde la copia de seguridad mediante la restauración geográfica.</span><span class="sxs-lookup"><span data-stu-id="c22ed-162">The main **tradeoff** is that if a catastrophic failure occurs during the upgrade the recovery to the pre-upgrade state will involve re-deployment of the application in a different region and restoring the database from backup using geo-restore.</span></span> <span data-ttu-id="c22ed-163">Este proceso dará como resultado un tiempo de inactividad considerable.</span><span class="sxs-lookup"><span data-stu-id="c22ed-163">This process will result in significant downtime.</span></span>   

## <a name="upgrading-applications-that-rely-on-database-geo-replication-for-disaster-recovery"></a><span data-ttu-id="c22ed-164">Actualización de aplicaciones que dependen de la replicación geográfica para la recuperación ante desastres</span><span class="sxs-lookup"><span data-stu-id="c22ed-164">Upgrading applications that rely on database geo-replication for disaster recovery</span></span>
<span data-ttu-id="c22ed-165">Si la aplicación aprovecha la replicación geográfica para la continuidad empresarial, se implementa en al menos dos regiones diferentes con una implementación activa en la región primaria y una implementación en espera en la región de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="c22ed-165">If your application leverages geo-replication for business continuity, it is deployed  to at least two different regions with an active deployment in Primary region and a standby deployment in Backup region.</span></span> <span data-ttu-id="c22ed-166">Además de los factores mencionados anteriormente, el proceso de actualización debe garantizar que:</span><span class="sxs-lookup"><span data-stu-id="c22ed-166">In addition to the factors mentioned earlier, the upgrade process must guarantee that:</span></span>

* <span data-ttu-id="c22ed-167">La aplicación permanece protegida frente a errores catastróficos en todo momento durante el proceso de actualización.</span><span class="sxs-lookup"><span data-stu-id="c22ed-167">The application remains protected from catastrophic failures at all times during the upgrade process</span></span>
* <span data-ttu-id="c22ed-168">Los componentes con redundancia geográfica de la aplicación se actualizan en paralelo con los componentes activos.</span><span class="sxs-lookup"><span data-stu-id="c22ed-168">The geo-redundant components of the application are upgraded in parallel with the active components</span></span>

<span data-ttu-id="c22ed-169">Para lograr estos objetivos, aprovechará el Administrador de tráfico de Azure (WATM) con el perfil de conmutación por error con un punto de conexión activo y tres de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="c22ed-169">To achieve these goals you will leverage Azure Traffic Manager (WATM) using the failover profile with one active and three backup endpoints.</span></span>  <span data-ttu-id="c22ed-170">En el siguiente diagrama se ilustra el entorno operativo antes del proceso de actualización.</span><span class="sxs-lookup"><span data-stu-id="c22ed-170">The following diagram illustrates the operational environment prior to the upgrade process.</span></span> <span data-ttu-id="c22ed-171">Los sitios web <i>contoso-1.azurewebsites.net</i> y <i>contoso-dr.azurewebsites.net</i> representan una ranura de producción de la aplicación con redundancia geográfica completa.</span><span class="sxs-lookup"><span data-stu-id="c22ed-171">The web sites <i>contoso-1.azurewebsites.net</i> and <i>contoso-dr.azurewebsites.net</i> represent a production slot of the application with full geographic redundancy.</span></span> <span data-ttu-id="c22ed-172">Para habilitar la capacidad de revertir la actualización, necesita crear un espacio de almacenamiento provisional con una copia totalmente sincronizada de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c22ed-172">To enable the ability to roll back the upgrade, you need create a stage slot with a fully synchronized copy of the application.</span></span> <span data-ttu-id="c22ed-173">Dado que debe asegurarse de que la aplicación puede recuperarse rápidamente en caso de que se produzca un error grave durante el proceso de actualización, el espacio de almacenamiento provisional tiene que tener también redundancia geográfica.</span><span class="sxs-lookup"><span data-stu-id="c22ed-173">Because you need to ensure that the application can quickly recover in case a catastrophic failure occurs during the upgrade process, the stage slot needs to be geo-redundant as well.</span></span> <span data-ttu-id="c22ed-174">Los siguientes pasos son necesarios para preparar la aplicación para la actualización:</span><span class="sxs-lookup"><span data-stu-id="c22ed-174">The following steps are required to prepare the application for the upgrade:</span></span>

1. <span data-ttu-id="c22ed-175">Cree una ranura de almacenamiento provisional para la actualización.</span><span class="sxs-lookup"><span data-stu-id="c22ed-175">Create a stage slot for the upgrade.</span></span> <span data-ttu-id="c22ed-176">Para ello, cree una base de datos secundaria (1) e implemente una copia idéntica del sitio web en la misma región de Azure.</span><span class="sxs-lookup"><span data-stu-id="c22ed-176">To do that create a secondary database (1) and deploy an identical copy of the web site in the same Azure region.</span></span> <span data-ttu-id="c22ed-177">Supervise la base de datos secundaria para ver si se completa el proceso de propagación.</span><span class="sxs-lookup"><span data-stu-id="c22ed-177">Monitor the secondary to see if the seeding process is completed.</span></span>
2. <span data-ttu-id="c22ed-178">Cree una base de datos secundaria con redundancia geográfica en la ranura de almacenamiento provisional mediante la replicación geográfica de la base de datos secundaria a la región de copia de seguridad (esto se denomina "replicación geográfica encadenada").</span><span class="sxs-lookup"><span data-stu-id="c22ed-178">Create a geo-redundant secondary database in the stage slot by geo-replicating the secondary database to the backup region (this is called "chained geo-replication").</span></span> <span data-ttu-id="c22ed-179">Supervise la copia de seguridad secundaria para ver si se completa el proceso de propagación (3).</span><span class="sxs-lookup"><span data-stu-id="c22ed-179">Monitor the backup secondary to see if the seeding process is completed (3).</span></span>
3. <span data-ttu-id="c22ed-180">Cree una copia en espera del sitio web de la región de copia de seguridad y vincúlela a la base de datos secundaria con redundancia geográfica (4).</span><span class="sxs-lookup"><span data-stu-id="c22ed-180">Create a standby copy of the web site in the backup region and link it to the geo-redundant secondary (4).</span></span>  
4. <span data-ttu-id="c22ed-181">Agregue los puntos de conexión adicionales <i>contoso-2.azurewebsites.net</i> y <i>contoso-3.azurewebsites.net</i> al perfil de conmutación por error de WATM como puntos de conexión desconectados (5).</span><span class="sxs-lookup"><span data-stu-id="c22ed-181">Add the additional endpoints <i>contoso-2.azurewebsites.net</i> and <i>contoso-3.azurewebsites.net</i> to the failover profile in WATM as offline endpoints (5).</span></span> 

> [!NOTE]
> <span data-ttu-id="c22ed-182">Tenga en cuenta los pasos preparatorios no afectarán a la aplicación de la ranura de producción y puede funcionar en modo de acceso completo.</span><span class="sxs-lookup"><span data-stu-id="c22ed-182">Note the preparation steps will not impact the application in the production slot and it can function in full access mode.</span></span>
> 
> 

![Configuración de replicación geográfica de SQL Database.](media/sql-database-manage-application-rolling-upgrade/Option2-1.png)

<span data-ttu-id="c22ed-185">Una vez completados los pasos preparatorios, la ranura de almacenamiento provisional estará preparada para la actualización.</span><span class="sxs-lookup"><span data-stu-id="c22ed-185">Once the preparation steps are completed, the stage slot is ready for the upgrade.</span></span> <span data-ttu-id="c22ed-186">En el siguiente diagrama se ilustran los pasos de actualización:</span><span class="sxs-lookup"><span data-stu-id="c22ed-186">The following diagram illustrates the upgrade steps.</span></span>

1. <span data-ttu-id="c22ed-187">Establezca la base de datos principal en la ranura de producción en modo de solo lectura (6).</span><span class="sxs-lookup"><span data-stu-id="c22ed-187">Set the primary database in the production slot to read-only mode (6).</span></span> <span data-ttu-id="c22ed-188">Esto garantizará que la instancia de producción de la aplicación (V1) seguirá siendo de solo lectura durante la actualización, con lo que se impide la divergencia de datos entre las instancias de base de datos de V1 y V2.</span><span class="sxs-lookup"><span data-stu-id="c22ed-188">This will guarantee that the production instance of the application (V1) will remain read-only during the upgrade thus preventing the data divergence between the V1 and V2 database instances.</span></span>  
2. <span data-ttu-id="c22ed-189">Desconecte la base de datos secundaria de la misma región con el modo de finalización planeada (7).</span><span class="sxs-lookup"><span data-stu-id="c22ed-189">Disconnect the secondary database in the same region using the planned termination mode (7).</span></span> <span data-ttu-id="c22ed-190">Se creará una copia independiente totalmente sincronizada de la base de datos principal, que se convertirá automáticamente en principal después de la finalización.</span><span class="sxs-lookup"><span data-stu-id="c22ed-190">It will create a fully synchronized independent copy of the primary database, which will automatically become a primary after the termination.</span></span> <span data-ttu-id="c22ed-191">Esta base de datos se actualizará.</span><span class="sxs-lookup"><span data-stu-id="c22ed-191">This database will be upgraded.</span></span>
3. <span data-ttu-id="c22ed-192">Cambie la base de datos principal de la ranura de almacenamiento provisional en modo de lectura y escritura, y ejecute el script de actualización (8).</span><span class="sxs-lookup"><span data-stu-id="c22ed-192">Turn the primary database in the stage slot to read-write mode and run the upgrade script (8).</span></span>    

![Configuración de replicación geográfica de SQL Database.](media/sql-database-manage-application-rolling-upgrade/Option2-2.png)

<span data-ttu-id="c22ed-195">Si la actualización se completó correctamente, ya está listo para cambiar los usuarios finales a la versión V2 de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c22ed-195">If the upgrade completed successfully you are now ready to switch the end users to the V2 version of the application.</span></span> <span data-ttu-id="c22ed-196">En el siguiente diagrama se ilustran los pasos implicados.</span><span class="sxs-lookup"><span data-stu-id="c22ed-196">The following diagram illustrates the steps involved.</span></span>

1. <span data-ttu-id="c22ed-197">Cambie el punto de conexión activo en el perfil de WATM a <i>contoso-2.azurewebsites.net</i>, que ahora señala a la versión V2 del sitio web (9).</span><span class="sxs-lookup"><span data-stu-id="c22ed-197">Switch the active endpoint in the WATM profile to <i>contoso-2.azurewebsites.net</i>, which now points to the V2 version of the web site (9).</span></span> <span data-ttu-id="c22ed-198">Ahora se convierte en un espacio de producción con la aplicación V2 y el tráfico de usuarios finales se dirige a ella.</span><span class="sxs-lookup"><span data-stu-id="c22ed-198">It now becomes a production slot with the V2 application and end-user traffic is directed to it.</span></span> 
2. <span data-ttu-id="c22ed-199">Si ya no necesita la aplicación V1, puede quitarla con seguridad (10 y 11).</span><span class="sxs-lookup"><span data-stu-id="c22ed-199">If you no longer need the V1 application so you can safely remove it (10 and 11).</span></span>  

![Configuración de replicación geográfica de SQL Database.](media/sql-database-manage-application-rolling-upgrade/Option2-3.png)

<span data-ttu-id="c22ed-202">Si el proceso de actualización es incorrecto, por ejemplo debido a un error en el script de actualización, la ranura de almacenamiento provisional debe considerarse en peligro.</span><span class="sxs-lookup"><span data-stu-id="c22ed-202">If the upgrade process is unsuccessful, for example due to an error in the upgrade script, the stage slot should be considered compromised.</span></span> <span data-ttu-id="c22ed-203">Para revertir la aplicación al estado previo a la actualización, simplemente reviértala para usar la aplicación en el espacio de producción con acceso completo.</span><span class="sxs-lookup"><span data-stu-id="c22ed-203">To roll back the application to the pre-upgrade state you simply revert to using the application in the production slot with full access.</span></span> <span data-ttu-id="c22ed-204">En el diagrama siguiente se muestran los pasos implicados.</span><span class="sxs-lookup"><span data-stu-id="c22ed-204">The steps involved are shown on the next diagram.</span></span>    

1. <span data-ttu-id="c22ed-205">Establezca la base de datos principal en la ranura de producción en modo de lectura y escritura (12).</span><span class="sxs-lookup"><span data-stu-id="c22ed-205">Set the primary database copy in the production slot to read-write mode (12).</span></span> <span data-ttu-id="c22ed-206">Esto restaurará la funcionalidad de V1 completa en la ranura de producción.</span><span class="sxs-lookup"><span data-stu-id="c22ed-206">This will restore the full V1 functionally in the production slot.</span></span>
2. <span data-ttu-id="c22ed-207">Realice el análisis de causa raíz y quite los componentes en peligro de la ranura de almacenamiento provisional (13 y 14).</span><span class="sxs-lookup"><span data-stu-id="c22ed-207">Perform the root cause analysis and remove the compromised components in the stage slot (13 and 14).</span></span> 

<span data-ttu-id="c22ed-208">En este punto, la aplicación es totalmente funcional y se pueden repetir los pasos de actualización.</span><span class="sxs-lookup"><span data-stu-id="c22ed-208">At this point the application is fully functional and the upgrade steps can be repeated.</span></span>

> [!NOTE]
> <span data-ttu-id="c22ed-209">La reversión no requiere cambios en el perfil de WATM, ya que apunta a <i>contoso-1.azurewebsites.net</i> como el punto de conexión activo.</span><span class="sxs-lookup"><span data-stu-id="c22ed-209">The rollback does not require changes in WATM profile as it already points to  <i>contoso-1.azurewebsites.net</i> as the active endpoint.</span></span>
> 
> 

![Configuración de replicación geográfica de SQL Database.](media/sql-database-manage-application-rolling-upgrade/Option2-4.png)

<span data-ttu-id="c22ed-212">La principal **ventaja** de esta opción es que puede actualizar tanto la aplicación como su copia con redundancia geográfica en paralelo, sin poner en peligro la continuidad del negocio durante la actualización.</span><span class="sxs-lookup"><span data-stu-id="c22ed-212">The key **advantage** of this option is that you can upgrade both the application and its geo-redundant copy in parallel without compromising your business continuity during the upgrade.</span></span> <span data-ttu-id="c22ed-213">La principal **contrapartida** es que requiere redundancia doble de cada componente de aplicación y, por tanto, implica un mayor costo.</span><span class="sxs-lookup"><span data-stu-id="c22ed-213">The main **tradeoff** is that it requires double redundancy of each application component and therefore incurs higher dollar cost.</span></span> <span data-ttu-id="c22ed-214">También implica un flujo de trabajo más complicado.</span><span class="sxs-lookup"><span data-stu-id="c22ed-214">It also involves a more complicated workflow.</span></span> 

## <a name="summary"></a><span data-ttu-id="c22ed-215">Resumen</span><span class="sxs-lookup"><span data-stu-id="c22ed-215">Summary</span></span>
<span data-ttu-id="c22ed-216">Los dos métodos de actualización que se describen en el artículo difieren en complejidad y en costo, pero ambos se centran en minimizar el tiempo en que el usuario final está limitado a las operaciones de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="c22ed-216">The two upgrade methods described in the article differ in complexity and the dollar cost but they both focus on minimizing the time when the end user is limited to read-only operations.</span></span> <span data-ttu-id="c22ed-217">La duración del script de actualización define directamente ese tiempo.</span><span class="sxs-lookup"><span data-stu-id="c22ed-217">That time is directly defined by the duration of the upgrade script.</span></span> <span data-ttu-id="c22ed-218">No depende del tamaño de la base de datos, del nivel de servicio que haya seleccionado, de la configuración del sitio web y de otros factores que no se pueden controlar fácilmente.</span><span class="sxs-lookup"><span data-stu-id="c22ed-218">It does not depend on the database size, the service tier you chose, the web site configuration and other factors that you cannot easily control.</span></span> <span data-ttu-id="c22ed-219">Esto es porque todos los pasos preparatorios se desacoplan de los pasos de actualización y pueden realizarse sin que afecten a la aplicación de producción.</span><span class="sxs-lookup"><span data-stu-id="c22ed-219">This is because all the preparation steps are decoupled from the upgrade steps and can be done without impacting the production application.</span></span> <span data-ttu-id="c22ed-220">La eficacia del script de actualización es el factor clave que determina la experiencia del usuario final durante las actualizaciones.</span><span class="sxs-lookup"><span data-stu-id="c22ed-220">The efficiency of the upgrade script is the key factor that determines the end-user experience during upgrades.</span></span> <span data-ttu-id="c22ed-221">Por tanto, la mejor manera de que pueda mejorarlo es centrar sus esfuerzos en hacer que el script de actualización sea lo más eficiente posible.</span><span class="sxs-lookup"><span data-stu-id="c22ed-221">So the best way you can improve it is by focusing your efforts on making the upgrade script as efficient as possible.</span></span>  

## <a name="next-steps"></a><span data-ttu-id="c22ed-222">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="c22ed-222">Next steps</span></span>
* <span data-ttu-id="c22ed-223">Para obtener una descripción general y los escenarios de la continuidad empresarial, consulte [Información general sobre la continuidad empresarial](sql-database-business-continuity.md).</span><span class="sxs-lookup"><span data-stu-id="c22ed-223">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md).</span></span>
* <span data-ttu-id="c22ed-224">Para saber en qué consisten las copias de seguridad automatizadas de Base de datos SQL de Azure, consulte [Información general: copias de seguridad automatizadas de Base de datos SQL](sql-database-automated-backups.md).</span><span class="sxs-lookup"><span data-stu-id="c22ed-224">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md).</span></span>
* <span data-ttu-id="c22ed-225">Si quiere saber cómo utilizar las copias de seguridad automatizadas para procesos de recuperación, consulte cómo [restaurar una base de datos a partir de las copias de seguridad automatizadas](sql-database-recovery-using-backups.md).</span><span class="sxs-lookup"><span data-stu-id="c22ed-225">To learn about using automated backups for recovery, see [restore a database from automated backups](sql-database-recovery-using-backups.md).</span></span>
* <span data-ttu-id="c22ed-226">Para conocer las opciones de recuperación más rápidas, consulte [Replicación geográfica activa](sql-database-geo-replication-overview.md).</span><span class="sxs-lookup"><span data-stu-id="c22ed-226">To learn about faster recovery options, see [active geo-replication](sql-database-geo-replication-overview.md).</span></span>



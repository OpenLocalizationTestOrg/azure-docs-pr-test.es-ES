---
title: aaaMoving datos entre bases de datos de escala horizontal en la nube | Documentos de Microsoft
description: "Explica cómo toomanipulate particiones y mover datos a través de un servicio hospedado por sí mismo mediante elástico de base de datos API."
services: sql-database
documentationcenter: 
manager: jhubbard
author: ddove
ms.assetid: 204fd902-0397-4185-985a-dea3ed7c7d9f
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/24/2016
ms.author: ddove
ms.openlocfilehash: 629dee06e22609e9b61edf93ba5c38d997132d8c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="moving-data-between-scaled-out-cloud-databases"></a><span data-ttu-id="79721-103">Moving data between scaled-out cloud databases (Mover datos entre bases de datos en la nube escaladas horizontalmente)</span><span class="sxs-lookup"><span data-stu-id="79721-103">Moving data between scaled-out cloud databases</span></span>
<span data-ttu-id="79721-104">Si es un Software como un programador del servicio y, de repente la aplicación experimenta una enorme demanda, necesita el crecimiento de hello tooaccommodate.</span><span class="sxs-lookup"><span data-stu-id="79721-104">If you are a Software as a Service developer, and suddenly your app undergoes tremendous demand, you need tooaccommodate hello growth.</span></span> <span data-ttu-id="79721-105">De este modo, agrega más bases de datos (particiones).</span><span class="sxs-lookup"><span data-stu-id="79721-105">So you add more databases (shards).</span></span> <span data-ttu-id="79721-106">¿Cómo se redistribuye Hola datos toohello nuevas bases de datos sin interrumpir la integridad de los datos Hola?</span><span class="sxs-lookup"><span data-stu-id="79721-106">How do you redistribute hello data toohello new databases without disrupting hello data integrity?</span></span> <span data-ttu-id="79721-107">Hola de uso **herramienta Dividir-combinar** toomove datos restringida toohello nuevas bases de datos de bases de datos.</span><span class="sxs-lookup"><span data-stu-id="79721-107">Use hello **split-merge tool** toomove data from constrained databases toohello new databases.</span></span>  

<span data-ttu-id="79721-108">herramienta de combinación de la división de Hola se ejecuta como un servicio web de Azure.</span><span class="sxs-lookup"><span data-stu-id="79721-108">hello split-merge tool runs as an Azure web service.</span></span> <span data-ttu-id="79721-109">Un administrador o desarrollador usa Hola herramienta toomove shardlets (datos de una partición) entre distintas bases de datos (particiones).</span><span class="sxs-lookup"><span data-stu-id="79721-109">An administrator or developer uses hello tool toomove shardlets (data from a shard) between different databases (shards).</span></span> <span data-ttu-id="79721-110">herramienta de Hello usa particiones mapa toomaintain Hola servicio metadatos base de datos y asegúrese de asignaciones coherente.</span><span class="sxs-lookup"><span data-stu-id="79721-110">hello tool uses shard map management toomaintain hello service metadata database, and ensure consistent mappings.</span></span>

![Información general][1]

## <a name="download"></a><span data-ttu-id="79721-112">Descargar</span><span class="sxs-lookup"><span data-stu-id="79721-112">Download</span></span>
[<span data-ttu-id="79721-113">Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge</span><span class="sxs-lookup"><span data-stu-id="79721-113">Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge</span></span>](http://www.nuget.org/packages/Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge/)

## <a name="documentation"></a><span data-ttu-id="79721-114">Documentación</span><span class="sxs-lookup"><span data-stu-id="79721-114">Documentation</span></span>
1. [<span data-ttu-id="79721-115">Tutorial de la herramienta de división y combinación de Base de datos elástica</span><span class="sxs-lookup"><span data-stu-id="79721-115">Elastic database Split-Merge tool tutorial</span></span>](sql-database-elastic-scale-configure-deploy-split-and-merge.md)
2. [<span data-ttu-id="79721-116">Configuración de seguridad de división y combinación</span><span class="sxs-lookup"><span data-stu-id="79721-116">Split-Merge security configuration</span></span>](sql-database-elastic-scale-split-merge-security-configuration.md)
3. [<span data-ttu-id="79721-117">Split-merge security considerations</span><span class="sxs-lookup"><span data-stu-id="79721-117">Split-merge security considerations</span></span>](sql-database-elastic-scale-split-merge-security-configuration.md)
4. [<span data-ttu-id="79721-118">Administración de mapas de particiones.</span><span class="sxs-lookup"><span data-stu-id="79721-118">Shard map management</span></span>](sql-database-elastic-scale-shard-map-management.md)
5. [<span data-ttu-id="79721-119">Migrar tooscale-fuera de las bases de datos existente</span><span class="sxs-lookup"><span data-stu-id="79721-119">Migrate existing databases tooscale-out</span></span>](sql-database-elastic-convert-to-use-elastic-tools.md)
6. [<span data-ttu-id="79721-120">Elastic database tools</span><span class="sxs-lookup"><span data-stu-id="79721-120">Elastic database tools</span></span>](sql-database-elastic-scale-introduction.md)
7. [<span data-ttu-id="79721-121">Glosario de las herramientas de bases de datos elásticas</span><span class="sxs-lookup"><span data-stu-id="79721-121">Elastic Database tools glossary</span></span>](sql-database-elastic-scale-glossary.md)

## <a name="why-use-hello-split-merge-tool"></a><span data-ttu-id="79721-122">¿Por qué usar la herramienta de combinación de la división de hello?</span><span class="sxs-lookup"><span data-stu-id="79721-122">Why use hello split-merge tool?</span></span>
<span data-ttu-id="79721-123">**Flexibilidad**</span><span class="sxs-lookup"><span data-stu-id="79721-123">**Flexibility**</span></span>

<span data-ttu-id="79721-124">Las aplicaciones necesitan toostretch flexible más allá de los límites de Hola de una sola base de datos de la base de datos de SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="79721-124">Applications need toostretch flexibly beyond hello limits of a single Azure SQL DB database.</span></span> <span data-ttu-id="79721-125">Usar datos de toomove de herramienta de hello como bases de datos necesarias toonew conservando la integridad.</span><span class="sxs-lookup"><span data-stu-id="79721-125">Use hello tool toomove data as needed toonew databases while retaining integrity.</span></span>

<span data-ttu-id="79721-126">**División toogrow**</span><span class="sxs-lookup"><span data-stu-id="79721-126">**Split toogrow**</span></span> 

<span data-ttu-id="79721-127">Necesita tooincrease general toohandle drástico crecimiento de capacidad.</span><span class="sxs-lookup"><span data-stu-id="79721-127">You need tooincrease overall capacity toohandle explosive growth.</span></span> <span data-ttu-id="79721-128">toodo crear por lo tanto, una capacidad adicional particionamiento Hola datos y si se distribuye entre las bases de datos de forma incremental más hasta que se cumplen las necesidades de capacidad.</span><span class="sxs-lookup"><span data-stu-id="79721-128">toodo so, create additional capacity by sharding hello data and by distributing it across incrementally more databases until capacity needs are fulfilled.</span></span> <span data-ttu-id="79721-129">Se trata de un buen ejemplo de Hola 'split' característica.</span><span class="sxs-lookup"><span data-stu-id="79721-129">This is a prime example of hello ‘split’ feature.</span></span> 

<span data-ttu-id="79721-130">**Mezcla tooshrink**</span><span class="sxs-lookup"><span data-stu-id="79721-130">**Merge tooshrink**</span></span>

<span data-ttu-id="79721-131">Es necesario reducir capacidad debido toohello estacionales naturaleza de la empresa.</span><span class="sxs-lookup"><span data-stu-id="79721-131">Capacity needs shrink due toohello seasonal nature of a business.</span></span> <span data-ttu-id="79721-132">Hola herramienta permite que reducir toofewer unidades de escalado cuando se reduce el negocio.</span><span class="sxs-lookup"><span data-stu-id="79721-132">hello tool lets you scale down toofewer scale units when business slows.</span></span> <span data-ttu-id="79721-133">característica de 'merge' Hola Hola escala elástica dividir-combinar servicio cubre este requisito.</span><span class="sxs-lookup"><span data-stu-id="79721-133">hello ‘merge’ feature in hello Elastic Scale split-merge Service covers this requirement.</span></span> 

<span data-ttu-id="79721-134">**Administrar zonas activas moviendo shardlets**</span><span class="sxs-lookup"><span data-stu-id="79721-134">**Manage hotspots by moving shardlets**</span></span>

<span data-ttu-id="79721-135">Con varios inquilinos por base de datos, asignación de Hola de tooshards de shardlets puede reducir los cuellos de botella toocapacity en algunas particiones.</span><span class="sxs-lookup"><span data-stu-id="79721-135">With multiple tenants per database, hello allocation of shardlets tooshards can lead toocapacity bottlenecks on some shards.</span></span> <span data-ttu-id="79721-136">Esto requiere volver a asignar shardlets o mover shardlets ocupado toonew o menos particiones infrautilizados.</span><span class="sxs-lookup"><span data-stu-id="79721-136">This requires re-allocating shardlets or moving busy shardlets toonew or less utilized shards.</span></span> 

## <a name="concepts--key-features"></a><span data-ttu-id="79721-137">Conceptos y características clave</span><span class="sxs-lookup"><span data-stu-id="79721-137">Concepts & key features</span></span>
<span data-ttu-id="79721-138">**Servicios hospedados por el cliente**</span><span class="sxs-lookup"><span data-stu-id="79721-138">**Customer-hosted services**</span></span>

<span data-ttu-id="79721-139">Hola dividir-combinar se entrega como un servicio hospedado por el cliente.</span><span class="sxs-lookup"><span data-stu-id="79721-139">hello split-merge is delivered as a customer-hosted service.</span></span> <span data-ttu-id="79721-140">Debe implementar y hospedar el servicio de hello en su suscripción de Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="79721-140">You must deploy and host hello service in your Microsoft Azure subscription.</span></span> <span data-ttu-id="79721-141">paquete de Hello que descargar de NuGet contiene un toocomplete de plantilla de configuración con información de Hola para su implementación.</span><span class="sxs-lookup"><span data-stu-id="79721-141">hello package you download from NuGet contains a configuration template toocomplete with hello information for your specific deployment.</span></span> <span data-ttu-id="79721-142">Vea hello [dividir-combinar tutorial](sql-database-elastic-scale-configure-deploy-split-and-merge.md) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="79721-142">See hello [split-merge tutorial](sql-database-elastic-scale-configure-deploy-split-and-merge.md) for details.</span></span> <span data-ttu-id="79721-143">Puesto que el servicio de Hola se ejecuta en su suscripción de Azure, puede controlar y configurar la mayoría de aspectos de seguridad de servicio de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-143">Since hello service runs in your Azure subscription, you can control and configure most security aspects of hello service.</span></span> <span data-ttu-id="79721-144">plantilla predeterminada de Hello incluye Hola opciones tooconfigure SSL, la autenticación de cliente basada en certificados, cifrado para las credenciales almacenadas, DoS protegiendo y restricciones de IP.</span><span class="sxs-lookup"><span data-stu-id="79721-144">hello default template includes hello options tooconfigure SSL, certificate-based client authentication, encryption for stored credentials, DoS guarding and IP restrictions.</span></span> <span data-ttu-id="79721-145">Puede encontrar más información sobre Hola aspectos de seguridad en hello siguiente documento [configuración de seguridad de dividir-combinar](sql-database-elastic-scale-split-merge-security-configuration.md).</span><span class="sxs-lookup"><span data-stu-id="79721-145">You can find more information on hello security aspects in hello following document [split-merge security configuration](sql-database-elastic-scale-split-merge-security-configuration.md).</span></span>

<span data-ttu-id="79721-146">valor predeterminado de Hello implementado se ejecuta el servicio con un trabajo y un rol web.</span><span class="sxs-lookup"><span data-stu-id="79721-146">hello default deployed service runs with one worker and one web role.</span></span> <span data-ttu-id="79721-147">Cada uno de ellos usa el tamaño de VM A1 de hello en los servicios de nube de Azure.</span><span class="sxs-lookup"><span data-stu-id="79721-147">Each uses hello A1 VM size in Azure Cloud Services.</span></span> <span data-ttu-id="79721-148">Mientras no se puede modificar esta configuración al implementar el paquete de hello, se puede cambiar después de una implementación correcta en hello ejecutando el servicio en la nube, (a través del portal de Azure Hola).</span><span class="sxs-lookup"><span data-stu-id="79721-148">While you cannot modify these settings when deploying hello package, you could change them after a successful deployment in hello running cloud service, (through hello Azure portal).</span></span> <span data-ttu-id="79721-149">Tenga en cuenta que ese rol de trabajo hello no debe configurarse con más de una sola instancia por razones técnicas.</span><span class="sxs-lookup"><span data-stu-id="79721-149">Note that hello worker role must not be configured for more than a single instance for technical reasons.</span></span> 

<span data-ttu-id="79721-150">**Integración de mapas de particiones**</span><span class="sxs-lookup"><span data-stu-id="79721-150">**Shard map integration**</span></span>

<span data-ttu-id="79721-151">servicio de dividir-combinar Hola interactúa con mapa de particiones de Hola de aplicación hello.</span><span class="sxs-lookup"><span data-stu-id="79721-151">hello split-merge service interacts with hello shard map of hello application.</span></span> <span data-ttu-id="79721-152">Al utilizar toosplit de servicio de división y combinación de Hola o intervalos de mezcla o toomove shardlets entre las particiones, el servicio de hello mantiene automáticamente mapa de particiones de hello seguridad toodate.</span><span class="sxs-lookup"><span data-stu-id="79721-152">When using hello split-merge service toosplit or merge ranges or toomove shardlets between shards, hello service automatically keeps hello shard map up toodate.</span></span> <span data-ttu-id="79721-153">toodo por lo tanto, servicio Hola conecta toohello base de datos de administrador de mapa de particiones de aplicación hello y mantiene intervalos y asignaciones de progreso de las solicitudes de división o combinación/mover.</span><span class="sxs-lookup"><span data-stu-id="79721-153">toodo so, hello service connects toohello shard map manager database of hello application and maintains ranges and mappings as split/merge/move requests progress.</span></span> <span data-ttu-id="79721-154">Esto garantiza que Hola particiones se asignan siempre presenta una vista actualizada cuando las operaciones de combinación de división va.</span><span class="sxs-lookup"><span data-stu-id="79721-154">This ensures that hello shard map always presents an up-to-date view when split-merge operations are going on.</span></span> <span data-ttu-id="79721-155">Dividir, se implementan las operaciones de movimiento de mezcla y shardlet moviendo un lote de shardlets de partición de destino de hello origen particiones toohello.</span><span class="sxs-lookup"><span data-stu-id="79721-155">Split, merge and shardlet movement operations are implemented by moving a batch of shardlets from hello source shard toohello target shard.</span></span> <span data-ttu-id="79721-156">Durante la hello shardlet movimiento operación hello shardlets asunto toohello lote actual se marcan como sin conexión en el mapa de particiones de hello y no están disponibles para conexiones de enrutamiento dependiente de los datos mediante hello **OpenConnectionForKey** API.</span><span class="sxs-lookup"><span data-stu-id="79721-156">During hello shardlet movement operation hello shardlets subject toohello current batch are marked as offline in hello shard map and are unavailable for data-dependent routing connections using hello **OpenConnectionForKey** API.</span></span> 

<span data-ttu-id="79721-157">**Conexiones coherentes de shardlets**</span><span class="sxs-lookup"><span data-stu-id="79721-157">**Consistent shardlet connections**</span></span>

<span data-ttu-id="79721-158">Cuando se inicia el movimiento de datos para un nuevo lote de shardlets, cualquier mapa de particiones proporciona dependiente de los datos enrutamiento conexiones toohello particiones almacenar hello shardlet son conexiones eliminadas y posteriores de mapa de particiones de hello toohello API estos shardlets se bloquean mientras movimiento de datos de Hello está en curso en incoherencias de tooavoid de orden.</span><span class="sxs-lookup"><span data-stu-id="79721-158">When data movement starts for a new batch of shardlets, any shard-map provided data-dependent routing connections toohello shard storing hello shardlet are killed and subsequent connections from hello shard map APIs toohello these shardlets are blocked while hello data movement is in progress in order tooavoid inconsistencies.</span></span> <span data-ttu-id="79721-159">Las conexiones tooother shardlets en hello también obtener eliminará misma partición, pero se realizará correctamente nuevo inmediatamente al volver a intentarlo.</span><span class="sxs-lookup"><span data-stu-id="79721-159">Connections tooother shardlets on hello same shard will also get killed, but will succeed again immediately on retry.</span></span> <span data-ttu-id="79721-160">Una vez que se mueven por lotes de hello, hello shardlets se marcan en línea nuevo para la partición de destino de Hola y datos de origen de saludo se quitan de la partición de origen de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-160">Once hello batch is moved, hello shardlets are marked online again for hello target shard and hello source data is removed from hello source shard.</span></span> <span data-ttu-id="79721-161">servicio de Hola quede a través de estos pasos en todos los lotes hasta que todos los shardlets que se han movido.</span><span class="sxs-lookup"><span data-stu-id="79721-161">hello service goes through these steps for every batch until all shardlets have been moved.</span></span> <span data-ttu-id="79721-162">Esto daría lugar las operaciones de eliminación de conexión de tooseveral durante el curso de Hola de completar la operación split, merge, mover Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-162">This will lead tooseveral connection kill operations during hello course of hello complete split/merge/move operation.</span></span>  

<span data-ttu-id="79721-163">**Administración de la disponibilidad de shardlets**</span><span class="sxs-lookup"><span data-stu-id="79721-163">**Managing shardlet availability**</span></span>

<span data-ttu-id="79721-164">Limitar el lote actual de toohello de shardlets según se explicó anteriormente la terminación de conexión de Hola restringe el ámbito de Hola de lote de tooone de falta de disponibilidad de shardlets a la vez.</span><span class="sxs-lookup"><span data-stu-id="79721-164">Limiting hello connection killing toohello current batch of shardlets as discussed above restricts hello scope of unavailability tooone batch of shardlets at a time.</span></span> <span data-ttu-id="79721-165">Esto es preferible a un enfoque donde partición completa Hola se mantendría sin conexión para todos sus shardlets durante el transcurso de Hola de una operación de división o combinación.</span><span class="sxs-lookup"><span data-stu-id="79721-165">This is preferred over an approach where hello complete shard would remain offline for all its shardlets during hello course of a split or merge operation.</span></span> <span data-ttu-id="79721-166">tamaño de Hola de un lote, definido como número de Hola de toomove shardlets distintos a la vez, es un parámetro de configuración.</span><span class="sxs-lookup"><span data-stu-id="79721-166">hello size of a batch, defined as hello number of distinct shardlets toomove at a time, is a configuration parameter.</span></span> <span data-ttu-id="79721-167">Se puede definir para cada operación de división y combinación según las necesidades de disponibilidad y el rendimiento de la aplicación hello.</span><span class="sxs-lookup"><span data-stu-id="79721-167">It can be defined for each split and merge operation depending on hello application’s availability and performance needs.</span></span> <span data-ttu-id="79721-168">Tenga en cuenta que el intervalo de Hola que se está bloqueando en mapa de particiones de hello puede ser mayor que el tamaño de lote de hello especificado.</span><span class="sxs-lookup"><span data-stu-id="79721-168">Note that hello range that is being locked in hello shard map may be larger than hello batch size specified.</span></span> <span data-ttu-id="79721-169">Esto es porque el servicio de Hola toma el tamaño del intervalo de Hola tal que el número real de Hola de valores de clave de particionamiento de datos de hello aproximadamente coincide con el tamaño del lote de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-169">This is because hello service picks hello range size such that hello actual number of sharding key values in hello data approximately matches hello batch size.</span></span> <span data-ttu-id="79721-170">Esto es importante tooremember en particular para las claves de particionamiento apenas lleno.</span><span class="sxs-lookup"><span data-stu-id="79721-170">This is important tooremember in particular for sparsely populated sharding keys.</span></span> 

<span data-ttu-id="79721-171">**Almacenamiento de metadatos**</span><span class="sxs-lookup"><span data-stu-id="79721-171">**Metadata storage**</span></span>

<span data-ttu-id="79721-172">servicio de dividir-combinar Hello usa un toomaintain de base de datos su estado e tookeep inicia una sesión durante el procesamiento de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="79721-172">hello split-merge service uses a database toomaintain its status and tookeep logs during request processing.</span></span> <span data-ttu-id="79721-173">usuario de Hello crea esta base de datos en su suscripción y prevea la cadena de conexión de hello en archivo de configuración de hello para la implementación del servicio de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-173">hello user creates this database in their subscription and provides hello connection string for it in hello configuration file for hello service deployment.</span></span> <span data-ttu-id="79721-174">Los administradores de organización del usuario de hello también pueden conectarse toothis progreso de solicitud de base de datos tooreview y tooinvestigate detallan información relativa a posibles errores.</span><span class="sxs-lookup"><span data-stu-id="79721-174">Administrators from hello user’s organization can also connect toothis database tooreview request progress and tooinvestigate detailed information regarding potential failures.</span></span>

<span data-ttu-id="79721-175">**Reconocimiento de particionamiento**</span><span class="sxs-lookup"><span data-stu-id="79721-175">**Sharding-awareness**</span></span>

<span data-ttu-id="79721-176">servicio de dividir-combinar Hola marca la diferencia entre tablas particionadas (1), las tablas de referencia (2) y (3) normales tablas.</span><span class="sxs-lookup"><span data-stu-id="79721-176">hello split-merge service differentiates between (1) sharded tables, (2) reference tables, and (3) normal tables.</span></span> <span data-ttu-id="79721-177">semántica de Hola de una operación de división/combinación/movimiento depende Hola tipo de tabla de hello utilizada y se define como sigue:</span><span class="sxs-lookup"><span data-stu-id="79721-177">hello semantics of a split/merge/move operation depend on hello type of hello table used and are defined as follows:</span></span> 

* <span data-ttu-id="79721-178">**Tablas particionadas**: división y combinación, las operaciones de movimiento mover shardlets de partición de origen tootarget.</span><span class="sxs-lookup"><span data-stu-id="79721-178">**Sharded tables**: Split, merge, and move operations move shardlets from source tootarget shard.</span></span> <span data-ttu-id="79721-179">Tras finalizar correctamente Hola solicitar en general, los shardlets ya no están presentes en el origen de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-179">After successful completion of hello overall request, those shardlets are no longer present on hello source.</span></span> <span data-ttu-id="79721-180">Tenga en cuenta que las tablas de destino de hello necesitan tooexist en la partición de destino de hello y no deben contener datos en el intervalo de destino Hola anterior tooprocessing de operación de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-180">Note that hello target tables need tooexist on hello target shard and must not contain data in hello target range prior tooprocessing of hello operation.</span></span> 
* <span data-ttu-id="79721-181">**Hacer referencia a tablas**: para las tablas de referencia, división de hello, combinar y mover las operaciones de copien los datos de Hola de partición de destino de hello origen toohello.</span><span class="sxs-lookup"><span data-stu-id="79721-181">**Reference tables**: For reference tables, hello split, merge and move operations copy hello data from hello source toohello target shard.</span></span> <span data-ttu-id="79721-182">Sin embargo, tenga en cuenta que no se producen cambios en la partición de destino de Hola para una tabla dada si cualquier fila ya está presente en esta tabla de destino de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-182">Note, however, that no changes occur on hello target shard for a given table if any row is already present in this table on hello target.</span></span> <span data-ttu-id="79721-183">tabla de Hello tiene toobe vacía para cualquier tooget de operación de copia de tabla de referencia procesado.</span><span class="sxs-lookup"><span data-stu-id="79721-183">hello table has toobe empty for any reference table copy operation tooget processed.</span></span>
* <span data-ttu-id="79721-184">**Otras tablas**: otras tablas pueden estar presentes en el origen de Hola o de destino de Hola de una operación de división y combinación.</span><span class="sxs-lookup"><span data-stu-id="79721-184">**Other Tables**: Other tables can be present on either hello source or hello target of a split and merge operation.</span></span> <span data-ttu-id="79721-185">servicio de dividir-combinar Hello no tiene en cuenta estas tablas para cualquier movimiento de datos o las operaciones de copia.</span><span class="sxs-lookup"><span data-stu-id="79721-185">hello split-merge service disregards these tables for any data movement or copy operations.</span></span> <span data-ttu-id="79721-186">Sin embargo, observe que pueden interferir con estas operaciones en caso de restricciones.</span><span class="sxs-lookup"><span data-stu-id="79721-186">Note, however, that they can interfere with these operations in case of constraints.</span></span>

<span data-ttu-id="79721-187">se proporciona información Hola referencia frente a tablas particionadas hello **SchemaInfo** las API en el mapa de particiones de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-187">hello information on reference vs. sharded tables is provided by hello **SchemaInfo** APIs on hello shard map.</span></span> <span data-ttu-id="79721-188">Hola siguiente ejemplo muestra uso de Hola de estas API en un smm de objeto de partición determinado mapa manager:</span><span class="sxs-lookup"><span data-stu-id="79721-188">hello following example illustrates hello use of these APIs on a given shard map manager object smm:</span></span> 

    // Create hello schema annotations 
    SchemaInfo schemaInfo = new SchemaInfo(); 

    // Reference tables 
    schemaInfo.Add(new ReferenceTableInfo("dbo", "region")); 
    schemaInfo.Add(new ReferenceTableInfo("dbo", "nation")); 

    // Sharded tables 
    schemaInfo.Add(new ShardedTableInfo("dbo", "customer", "C_CUSTKEY")); 
    schemaInfo.Add(new ShardedTableInfo("dbo", "orders", "O_CUSTKEY")); 

    // Publish 
    smm.GetSchemaInfoCollection().Add(Configuration.ShardMapName, schemaInfo); 

<span data-ttu-id="79721-189">Hola tablas 'region' y 'nación' se definen como tablas de referencia y se copiará con las operaciones de división/combinación/movimiento.</span><span class="sxs-lookup"><span data-stu-id="79721-189">hello tables ‘region’ and ‘nation’ are defined as reference tables and will be copied with split/merge/move operations.</span></span> <span data-ttu-id="79721-190">A su vez, las tablas "customer" y "orders" se definen como tablas particionadas.</span><span class="sxs-lookup"><span data-stu-id="79721-190">‘customer’ and ‘orders’ in turn are defined as sharded tables.</span></span> <span data-ttu-id="79721-191">C_claveCliente y O_CUSTKEY actúan como clave de particionamiento de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-191">C_CUSTKEY and O_CUSTKEY serve as hello sharding key.</span></span> 

<span data-ttu-id="79721-192">**Integración referencial**</span><span class="sxs-lookup"><span data-stu-id="79721-192">**Referential Integrity**</span></span>

<span data-ttu-id="79721-193">servicio de dividir-combinar Hola analiza las dependencias entre las tablas y utiliza las operaciones de relaciones de clave principal y clave externa toostage Hola para mover las tablas de referencia y shardlets.</span><span class="sxs-lookup"><span data-stu-id="79721-193">hello split-merge service analyzes dependencies between tables and uses foreign key-primary key relationships toostage hello operations for moving reference tables and shardlets.</span></span> <span data-ttu-id="79721-194">En general, las tablas de referencia primero se copian en orden de dependencia, luego los shardlets se copia según el orden de sus dependencias dentro de cada lote.</span><span class="sxs-lookup"><span data-stu-id="79721-194">In general, reference tables are copied first in dependency order, then shardlets are copied in order of their dependencies within each batch.</span></span> <span data-ttu-id="79721-195">Esto es necesario para que se respetan las restricciones de PK-FK en particiones de destino de hello como llegan datos nuevos de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-195">This is necessary so that FK-PK constraints on hello target shard are honored as hello new data arrives.</span></span> 

<span data-ttu-id="79721-196">**Coherencia de mapa de particiones y eventual finalización**</span><span class="sxs-lookup"><span data-stu-id="79721-196">**Shard Map Consistency and Eventual Completion**</span></span>

<span data-ttu-id="79721-197">En presencia de Hola de errores, servicio de dividir-combinar Hola reanuda operaciones después de cualquier interrupción y tiene como objetivo toocomplete cualquiera de las peticiones de progreso.</span><span class="sxs-lookup"><span data-stu-id="79721-197">In hello presence of failures, hello split-merge service resumes operations after any outage and aims toocomplete any in progress requests.</span></span> <span data-ttu-id="79721-198">Sin embargo, puede haber situaciones irrecuperables, por ejemplo, cuando se pierde o puesto en peligro no se puede reparar particiones de destino de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-198">However, there may be unrecoverable situations, e.g., when hello target shard is lost or compromised beyond repair.</span></span> <span data-ttu-id="79721-199">En esas circunstancias, algunas shardlets que se debe mover toobe puede continuar tooreside en particiones de origen Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-199">Under those circumstances, some shardlets that were supposed toobe moved may continue tooreside on hello source shard.</span></span> <span data-ttu-id="79721-200">servicio Hola garantiza que las asignaciones de shardlet solo se actualizan después de los datos necesarios de hello destino toohello copió correctamente.</span><span class="sxs-lookup"><span data-stu-id="79721-200">hello service ensures that shardlet mappings are only updated after hello necessary data has been successfully copied toohello target.</span></span> <span data-ttu-id="79721-201">Shardlets sólo se eliminan en origen Hola una vez copiado todos sus datos de destino toohello y asignaciones correspondientes Hola se han actualizado correctamente.</span><span class="sxs-lookup"><span data-stu-id="79721-201">Shardlets are only deleted on hello source once all their data has been copied toohello target and hello corresponding mappings have been updated successfully.</span></span> <span data-ttu-id="79721-202">operación de eliminación de Hello sucede en segundo plano de hello mientras intervalo Hola ya está en línea en la partición de destino de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-202">hello deletion operation happens in hello background while hello range is already online on hello target shard.</span></span> <span data-ttu-id="79721-203">servicio de dividir-combinar Hola siempre garantiza correcto de asignaciones de hello almacenadas en mapa de particiones de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-203">hello split-merge service always ensures correctness of hello mappings stored in hello shard map.</span></span>

## <a name="hello-split-merge-user-interface"></a><span data-ttu-id="79721-204">interfaz de usuario de división y combinación de Hola</span><span class="sxs-lookup"><span data-stu-id="79721-204">hello split-merge user interface</span></span>
<span data-ttu-id="79721-205">paquete de servicio de dividir-combinar Hola incluye un rol de trabajo y un rol web.</span><span class="sxs-lookup"><span data-stu-id="79721-205">hello split-merge service package includes a worker role and a web role.</span></span> <span data-ttu-id="79721-206">rol web de Hello es toosubmit usado dividir-combinar solicitudes de forma interactiva.</span><span class="sxs-lookup"><span data-stu-id="79721-206">hello web role is used toosubmit split-merge requests in an interactive way.</span></span> <span data-ttu-id="79721-207">componentes principales de Hola de interfaz de usuario de hello son los siguientes:</span><span class="sxs-lookup"><span data-stu-id="79721-207">hello main components of hello user interface are as follows:</span></span>

* <span data-ttu-id="79721-208">Tipo de operación: el tipo de operación de hello es un botón de opción que controla Hola tipo de operación realizada por el servicio de Hola para esta solicitud.</span><span class="sxs-lookup"><span data-stu-id="79721-208">Operation Type: hello operation type is a radio button that controls hello kind of operation performed by hello service for this request.</span></span> <span data-ttu-id="79721-209">Puede elegir entre la división de hello, combinar y mover escenarios.</span><span class="sxs-lookup"><span data-stu-id="79721-209">You can choose between hello split, merge and move scenarios.</span></span> <span data-ttu-id="79721-210">También puede cancelar una operación anteriormente enviada.</span><span class="sxs-lookup"><span data-stu-id="79721-210">You can also cancel a previously submitted operation.</span></span> <span data-ttu-id="79721-211">Puede usar las solicitudes de división, combinación y movimiento para los mapas de particiones de intervalo.</span><span class="sxs-lookup"><span data-stu-id="79721-211">You can use split, merge and move requests for range shard maps.</span></span> <span data-ttu-id="79721-212">Los mapas de particiones de lista solo admiten operaciones de movimiento.</span><span class="sxs-lookup"><span data-stu-id="79721-212">List shard maps only support move operations.</span></span>
* <span data-ttu-id="79721-213">Mapa de particiones: Hola siguiente sección de información de portada de parámetros de solicitud sobre el mapa de particiones de Hola y aloja su mapa de particiones de base de datos de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-213">Shard Map: hello next section of request parameters cover information about hello shard map and hello database hosting your shard map.</span></span> <span data-ttu-id="79721-214">En concreto, necesita tooprovide Hola nombre del servidor de base de datos de SQL Azure de Hola y base de datos de hospedaje hello shardmap, particiones de credenciales tooconnect toohello base de datos se asignan y finalmente Hola nombre del mapa de particiones de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-214">In particular, you need tooprovide hello name of hello Azure SQL Database server and database hosting hello shardmap, credentials tooconnect toohello shard map database, and finally hello name of hello shard map.</span></span> <span data-ttu-id="79721-215">Actualmente, la operación de hello acepta solo un único conjunto de credenciales.</span><span class="sxs-lookup"><span data-stu-id="79721-215">Currently, hello operation only accepts a single set of credentials.</span></span> <span data-ttu-id="79721-216">Estas credenciales necesitan los permisos necesarios toohave tooperform cambia toohello mapa de particiones, así como datos de usuario de toohello en particiones de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-216">These credentials need toohave sufficient permissions tooperform changes toohello shard map as well as toohello user data on hello shards.</span></span>
* <span data-ttu-id="79721-217">Intervalo de origen (División y combinación): una operación de división y combinación procesa un intervalo con su clave superior e inferior.</span><span class="sxs-lookup"><span data-stu-id="79721-217">Source Range (split and merge): A split and merge operation processes a range using its low and high key.</span></span> <span data-ttu-id="79721-218">toospecify una operación con un unbounded valor de clave superior, verificación Hola "clave superior es max" casilla de verificación y deje el campo de clave alta de hello vacía.</span><span class="sxs-lookup"><span data-stu-id="79721-218">toospecify an operation with an unbounded high key value, check hello “High key is max” check box and leave hello high key field empty.</span></span> <span data-ttu-id="79721-219">Hola intervalo valores de clave que especifique no necesidad tooprecisely coinciden con una asignación y los límites en el mapa de particiones.</span><span class="sxs-lookup"><span data-stu-id="79721-219">hello range key values that you specify do not need tooprecisely match a mapping and its boundaries in your shard map.</span></span> <span data-ttu-id="79721-220">Si no especifica los límites de intervalo en absoluto servicio Hola deducirá intervalo más cercano de hello automáticamente.</span><span class="sxs-lookup"><span data-stu-id="79721-220">If you do not specify any range boundaries at all hello service will infer hello closest range for you automatically.</span></span> <span data-ttu-id="79721-221">Puede utilizar asignaciones actuales de hello GetMappings.ps1 PowerShell script tooretrieve hello en un mapa de particiones especificado.</span><span class="sxs-lookup"><span data-stu-id="79721-221">You can use hello GetMappings.ps1 PowerShell script tooretrieve hello current mappings in a given shard map.</span></span>
* <span data-ttu-id="79721-222">Comportamiento del origen de división (split): para las operaciones de división, definir el intervalo de origen de hello punto toosplit Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-222">Split Source Behavior (split): For split operations, define hello point toosplit hello source range.</span></span> <span data-ttu-id="79721-223">Para ello, proporcionando la clave de particionamiento de Hola donde desea Hola divide toooccur.</span><span class="sxs-lookup"><span data-stu-id="79721-223">You do this by providing hello sharding key where you want hello split toooccur.</span></span> <span data-ttu-id="79721-224">Botón de opción Usar Hola especifique si desea que la parte inferior de Hola de hello toomove de intervalo (excepto Hola dividir la clave), o si quiere toomove de la parte superior de hello (incluida la clave de la división de hello).</span><span class="sxs-lookup"><span data-stu-id="79721-224">Use hello radio button specify whether you want hello lower part of hello range (excluding hello split key) toomove, or whether you want hello upper part toomove (including hello split key).</span></span>
* <span data-ttu-id="79721-225">Shardlet (movimiento) de origen: mover operaciones son diferentes de dividir o combinar las operaciones que no requieren un origen de intervalo toodescribe Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-225">Source Shardlet (move): Move operations are different from split or merge operations as they do not require a range toodescribe hello source.</span></span> <span data-ttu-id="79721-226">Un origen para mover simplemente se identifica por el valor de clave de particionamiento de Hola que planea toomove.</span><span class="sxs-lookup"><span data-stu-id="79721-226">A source for move is simply identified by hello sharding key value that you plan toomove.</span></span>
* <span data-ttu-id="79721-227">Particiones (división) de destino: una vez que ha proporcionado información de hello en origen de saludo de la operación de división, necesita toodefine donde desea Hola datos toobe copia servidor de base de datos de SQL Azure Hola proporcionando tooby y nombre de base de datos de destino de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-227">Target Shard (split): Once you have provided hello information on hello source of your split operation, you need toodefine where you want hello data toobe copied tooby providing hello Azure SQL Db server and database name for hello target.</span></span>
* <span data-ttu-id="79721-228">Intervalo de destino (merge): las operaciones de combinación mover particiones de shardlets tooan existente.</span><span class="sxs-lookup"><span data-stu-id="79721-228">Target Range (merge): Merge operations move shardlets tooan existing shard.</span></span> <span data-ttu-id="79721-229">Identificar particiones existentes de hello proporcionando los límites del intervalo de rango existente de Hola que desee toomerge con Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-229">You identify hello existing shard by providing hello range boundaries of hello existing range that you want toomerge with.</span></span>
* <span data-ttu-id="79721-230">Tamaño de lote: controles de tamaño de lote de Hola Hola número de shardlets que irá sin conexión a la vez durante el movimiento de datos Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-230">Batch Size: hello batch size controls hello number of shardlets that will go offline at a time during hello data movement.</span></span> <span data-ttu-id="79721-231">Esto es un valor entero que puede usar valores más pequeños cuando haya toolong confidencial períodos de tiempo de inactividad de shardlets.</span><span class="sxs-lookup"><span data-stu-id="79721-231">This is an integer value where you can use smaller values when you are sensitive toolong periods of downtime for shardlets.</span></span> <span data-ttu-id="79721-232">Los valores mayores aumentará el tiempo de Hola que es un shardlet determinado sin conexión pero puede mejorar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="79721-232">Larger values will increase hello time that a given shardlet is offline but may improve performance.</span></span>
* <span data-ttu-id="79721-233">Id. de operación (cancelar): Si tiene una operación en curso que ya no es necesario, puede cancelar operación Hola proporcionando su Id. de operación en este campo.</span><span class="sxs-lookup"><span data-stu-id="79721-233">Operation Id (Cancel): If you have an ongoing operation that is no longer needed, you can cancel hello operation by providing its operation ID in this field.</span></span> <span data-ttu-id="79721-234">Puede recuperar el Id. de operación de Hola de tabla de estado de solicitud de hello (consulte la sección 8.1) o de salida de hello en el Explorador de web de Hola que envía la solicitud de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-234">You can retrieve hello operation ID from hello request status table (see Section 8.1) or from hello output in hello web browser where you submitted hello request.</span></span>

## <a name="requirements-and-limitations"></a><span data-ttu-id="79721-235">Requisitos y limitaciones</span><span class="sxs-lookup"><span data-stu-id="79721-235">Requirements and Limitations</span></span>
<span data-ttu-id="79721-236">Hola la implementación actual del servicio de dividir-combinar hello es asunto toohello siguiendo los requisitos y limitaciones:</span><span class="sxs-lookup"><span data-stu-id="79721-236">hello current implementation of hello split-merge service is subject toohello following requirements and limitations:</span></span> 

* <span data-ttu-id="79721-237">particiones de Hello necesitan tooexist y estar registrados en el mapa de particiones de Hola para poder realizar una operación de combinación de división en esas particiones.</span><span class="sxs-lookup"><span data-stu-id="79721-237">hello shards need tooexist and be registered in hello shard map before a split-merge operation on these shards can be performed.</span></span> 
* <span data-ttu-id="79721-238">servicio de Hello no crea tablas u otros objetos de base de datos automáticamente como parte de sus operaciones.</span><span class="sxs-lookup"><span data-stu-id="79721-238">hello service does not create tables or any other database objects automatically as part of its operations.</span></span> <span data-ttu-id="79721-239">Esto significa que Hola esquema de tablas particionadas todas las y hacer referencia a tablas necesita tooexist en la operación de división/combinación/movimiento de hello destino particiones tooany anterior.</span><span class="sxs-lookup"><span data-stu-id="79721-239">This means that hello schema for all sharded tables and reference tables need tooexist on hello target shard prior tooany split/merge/move operation.</span></span> <span data-ttu-id="79721-240">En concreto las tablas particionadas son necesario toobe vacía en el intervalo de Hola donde nuevos shardlets son toobe agregada por una operación de división/combinación/movimiento.</span><span class="sxs-lookup"><span data-stu-id="79721-240">Sharded tables in particular are required toobe empty in hello range where new shardlets are toobe added by a split/merge/move operation.</span></span> <span data-ttu-id="79721-241">En caso contrario, la operación de Hola se producirá un error comprobación de coherencia inicial de hello en particiones de destino de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-241">Otherwise, hello operation will fail hello initial consistency check on hello target shard.</span></span> <span data-ttu-id="79721-242">También tenga en cuenta que los datos de referencia se copian solo si la tabla de referencia de hello está vacía y que no hay ningún coherencia garantiza con operaciones de escritura simultáneas tooother de tener en cuenta en las tablas de referencia de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-242">Also note that reference data is only copied if hello reference table is empty and that there are no consistency guarantees with regard tooother concurrent write operations on hello reference tables.</span></span> <span data-ttu-id="79721-243">Se recomienda esto: al ejecutar las operaciones de división/combinación, ninguna otra operación de escritura realizar los cambios de las tablas de referencia toohello.</span><span class="sxs-lookup"><span data-stu-id="79721-243">We recommend this: when running split/merge operations, no other write operations make changes toohello reference tables.</span></span>
* <span data-ttu-id="79721-244">servicio de Hola se basa en la identidad de fila establecido por un índice único o la clave que incluye el rendimiento de tooimprove clave de particionamiento de Hola y la confiabilidad de shardlets grandes.</span><span class="sxs-lookup"><span data-stu-id="79721-244">hello service relies on row identity established by a unique index or key that includes hello sharding key tooimprove performance and reliability for large shardlets.</span></span> <span data-ttu-id="79721-245">Esto permite toomove datos del servicio de hello en una granularidad más fina incluso que simplemente Hola particionamiento valor de clave.</span><span class="sxs-lookup"><span data-stu-id="79721-245">This allows hello service toomove data at an even finer granularity than just hello sharding key value.</span></span> <span data-ttu-id="79721-246">Esto ayuda a la cantidad máxima de hello tooreduce de espacio en el registro y los bloqueos que son necesarios durante la operación de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-246">This helps tooreduce hello maximum amount of log space and locks that are required during hello operation.</span></span> <span data-ttu-id="79721-247">Considere la posibilidad de crear un índice único o una clave principal, incluida la clave de particionamiento de hello en una tabla dada si desea toouse esa tabla con las solicitudes de división o combinación/mover.</span><span class="sxs-lookup"><span data-stu-id="79721-247">Consider creating a unique index or a primary key including hello sharding key on a given table if you want toouse that table with split/merge/move requests.</span></span> <span data-ttu-id="79721-248">Por motivos de rendimiento clave de particionamiento de hello debe ser Hola iniciales columna clave Hola Hola índice o.</span><span class="sxs-lookup"><span data-stu-id="79721-248">For performance reasons, hello sharding key should be hello leading column in hello key or hello index.</span></span>
* <span data-ttu-id="79721-249">Durante el transcurso de Hola de procesamiento de solicitudes, algunos datos de shardlet pueden encontrarse tanto en el origen de Hola y partición de destino de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-249">During hello course of request processing, some shardlet data may be present both on hello source and hello target shard.</span></span> <span data-ttu-id="79721-250">Esto es necesario tooprotect frente a errores durante el movimiento de los shardlets Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-250">This is necessary tooprotect against failures during hello shardlet movement.</span></span> <span data-ttu-id="79721-251">Hello integración de dividir-combinar con el mapa de particiones de hello asegura que las conexiones a través de hello datos dependientes enrutamiento API mediante Hola **OpenConnectionForKey** método en el mapa de particiones de hello no ve los estados intermedios incoherentes.</span><span class="sxs-lookup"><span data-stu-id="79721-251">hello integration of split-merge with hello shard map ensures that connections through hello data dependent routing APIs using hello **OpenConnectionForKey** method on hello shard map do not see any inconsistent intermediate states.</span></span> <span data-ttu-id="79721-252">Sin embargo, si conecta origen toohello o hello el destino particiones sin usar hello **OpenConnectionForKey** método, pueden verse los estados intermedios incoherentes cuando las solicitudes de división/combinación/movimiento va.</span><span class="sxs-lookup"><span data-stu-id="79721-252">However, when connecting toohello source or hello target shards without using hello **OpenConnectionForKey** method, inconsistent intermediate states might be visible when split/merge/move requests are going on.</span></span> <span data-ttu-id="79721-253">Estas conexiones pueden aparecer los resultados parciales o duplicados según tiempo de Hola o conexión de Hola Hola partición subyacente.</span><span class="sxs-lookup"><span data-stu-id="79721-253">These connections may show partial or duplicate results depending on hello timing or hello shard underlying hello connection.</span></span> <span data-ttu-id="79721-254">Esta limitación incluye actualmente las conexiones de hello realizadas por Shard varios escala elástica-consultas.</span><span class="sxs-lookup"><span data-stu-id="79721-254">This limitation currently includes hello connections made by Elastic Scale Multi-Shard-Queries.</span></span>
* <span data-ttu-id="79721-255">base de datos de metadatos de Hola para servicio de dividir-combinar hello no debe compartirse entre distintos roles.</span><span class="sxs-lookup"><span data-stu-id="79721-255">hello metadata database for hello split-merge service must not be shared between different roles.</span></span> <span data-ttu-id="79721-256">Por ejemplo, un rol de servicio de dividir-combinar hello en ejecución en la base de datos de las necesidades toopoint tooa distintos metadatos que la función de la producción de hello provisional.</span><span class="sxs-lookup"><span data-stu-id="79721-256">For example, a role of hello split-merge service running in staging needs toopoint tooa different metadata database than hello production role.</span></span>

## <a name="billing"></a><span data-ttu-id="79721-257">Facturación</span><span class="sxs-lookup"><span data-stu-id="79721-257">Billing</span></span>
<span data-ttu-id="79721-258">servicio de dividir-combinar Hola se ejecuta como un servicio de nube en su suscripción de Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="79721-258">hello split-merge service runs as a cloud service in your Microsoft Azure subscription.</span></span> <span data-ttu-id="79721-259">Por lo tanto, los cargos de servicios en la nube aplicarán tooyour instancia del servicio de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-259">Therefore charges for cloud services apply tooyour instance of hello service.</span></span> <span data-ttu-id="79721-260">A menos que realice operaciones de división/combinación/desplazamiento de manera frecuente, le recomendamos eliminar el servicio en la nube División y combinación.</span><span class="sxs-lookup"><span data-stu-id="79721-260">Unless you frequently perform split/merge/move operations, we recommend you delete your split-merge cloud service.</span></span> <span data-ttu-id="79721-261">Esto ahorra costos relacionados con instancias de servicio en la nube en ejecución o implementadas.</span><span class="sxs-lookup"><span data-stu-id="79721-261">That saves costs for running or deployed cloud service instances.</span></span> <span data-ttu-id="79721-262">Puede volver a implementar e iniciar la configuración del ejecutable fácilmente cuando necesite tooperform dividir o combinar las operaciones.</span><span class="sxs-lookup"><span data-stu-id="79721-262">You can re-deploy and start your readily runnable configuration whenever you need tooperform split or merge operations.</span></span> 

## <a name="monitoring"></a><span data-ttu-id="79721-263">Supervisión</span><span class="sxs-lookup"><span data-stu-id="79721-263">Monitoring</span></span>
### <a name="status-tables"></a><span data-ttu-id="79721-264">Tablas de estado</span><span class="sxs-lookup"><span data-stu-id="79721-264">Status tables</span></span>
<span data-ttu-id="79721-265">Servicio de dividir-combinar Hello proporciona hello **RequestStatus** tabla de base de datos del almacén de metadatos de hello para la supervisión de las solicitudes en curso y completadas.</span><span class="sxs-lookup"><span data-stu-id="79721-265">hello split-merge Service provides hello **RequestStatus** table in hello metadata store database for monitoring of completed and ongoing requests.</span></span> <span data-ttu-id="79721-266">tabla de Hello muestra una fila para cada solicitud de dividir-combinar que se ha enviado toothis instancia del servicio de dividir-combinar Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-266">hello table lists a row for each split-merge request that has been submitted toothis instance of hello split-merge service.</span></span> <span data-ttu-id="79721-267">Se da la siguiente información para cada solicitud de Hola:</span><span class="sxs-lookup"><span data-stu-id="79721-267">It gives hello following information for each request:</span></span>

* <span data-ttu-id="79721-268">**Marca de tiempo**: Hola cuando se inició la solicitud de Hola de fecha y hora.</span><span class="sxs-lookup"><span data-stu-id="79721-268">**Timestamp**: hello time and date when hello request was started.</span></span>
* <span data-ttu-id="79721-269">**OperationId**: un GUID que identifica de forma única solicitud de saludo.</span><span class="sxs-lookup"><span data-stu-id="79721-269">**OperationId**: A GUID that uniquely identifies hello request.</span></span> <span data-ttu-id="79721-270">Esta solicitud también puede ser usado toocancel Hola operación mientras está aún en curso.</span><span class="sxs-lookup"><span data-stu-id="79721-270">This request can also be used toocancel hello operation while it is still ongoing.</span></span>
* <span data-ttu-id="79721-271">**Estado**: Hola estado actual de la solicitud de saludo.</span><span class="sxs-lookup"><span data-stu-id="79721-271">**Status**: hello current state of hello request.</span></span> <span data-ttu-id="79721-272">Para las solicitudes en curso, también se muestra Hola fase actual en qué hello es solicitud.</span><span class="sxs-lookup"><span data-stu-id="79721-272">For ongoing requests, it also lists hello current phase in which hello request is.</span></span>
* <span data-ttu-id="79721-273">**CancelRequest**: una marca que indica si se ha cancelado la solicitud de saludo.</span><span class="sxs-lookup"><span data-stu-id="79721-273">**CancelRequest**: A flag that indicates whether hello request has been cancelled.</span></span>
* <span data-ttu-id="79721-274">**Curso**: una estimación de porcentaje de finalización de la operación de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-274">**Progress**: A percentage estimate of completion for hello operation.</span></span> <span data-ttu-id="79721-275">Un valor de 50 indica que la operación de hello es aproximadamente un 50% completado.</span><span class="sxs-lookup"><span data-stu-id="79721-275">A value of 50 indicates that hello operation is approximately 50% complete.</span></span>
* <span data-ttu-id="79721-276">**Details**: un valor XML que proporciona un informe de progreso más detallado.</span><span class="sxs-lookup"><span data-stu-id="79721-276">**Details**: An XML value that provides a more detailed progress report.</span></span> <span data-ttu-id="79721-277">informe de progreso de Hola se actualiza periódicamente como conjuntos de filas se copian de tootarget de origen.</span><span class="sxs-lookup"><span data-stu-id="79721-277">hello progress report is periodically updated as sets of rows are copied from source tootarget.</span></span> <span data-ttu-id="79721-278">En caso de errores o excepciones, esta columna también incluye información más detallada sobre los errores de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-278">In case of failures or exceptions, this column also includes more detailed information about hello failure.</span></span>

### <a name="azure-diagnostics"></a><span data-ttu-id="79721-279">Diagnóstico de Azure</span><span class="sxs-lookup"><span data-stu-id="79721-279">Azure Diagnostics</span></span>
<span data-ttu-id="79721-280">servicio de dividir-combinar Hello usa diagnósticos de Azure basado en Azure SDK 2.5 para la supervisión y diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="79721-280">hello split-merge service uses Azure Diagnostics based on Azure SDK 2.5 for monitoring and diagnostics.</span></span> <span data-ttu-id="79721-281">Controlar la configuración de diagnóstico Hola tal como se describe aquí: [habilitar diagnósticos en servicios en la nube y máquinas virtuales](../cloud-services/cloud-services-dotnet-diagnostics.md).</span><span class="sxs-lookup"><span data-stu-id="79721-281">You control hello diagnostics configuration as explained here: [Enabling Diagnostics in Azure Cloud Services and Virtual Machines](../cloud-services/cloud-services-dotnet-diagnostics.md).</span></span> <span data-ttu-id="79721-282">paquete de descarga de Hello incluye dos configuraciones de diagnósticos: uno para el rol web de hello y otro para el rol de trabajo de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-282">hello download package includes two diagnostics configurations - one for hello web role and one for hello worker role.</span></span> <span data-ttu-id="79721-283">Estas configuraciones de diagnóstico para el servicio de hello seguir las instrucciones de Hola de [Fundamentos de servicio de nube de Microsoft Azure](https://code.msdn.microsoft.com/windowsazure/Cloud-Service-Fundamentals-4ca72649).</span><span class="sxs-lookup"><span data-stu-id="79721-283">These diagnostics configurations for hello service follow hello guidance from [Cloud Service Fundamentals in Microsoft Azure](https://code.msdn.microsoft.com/windowsazure/Cloud-Service-Fundamentals-4ca72649).</span></span> <span data-ttu-id="79721-284">Incluye definiciones de hello toolog contadores de rendimiento, registros de IIS, registros de eventos de Windows y registros de eventos de aplicación de mezcla de división.</span><span class="sxs-lookup"><span data-stu-id="79721-284">It includes hello definitions toolog Performance Counters, IIS logs, Windows Event Logs, and split-merge application event logs.</span></span> 

## <a name="deploy-diagnostics"></a><span data-ttu-id="79721-285">Implementar diagnósticos</span><span class="sxs-lookup"><span data-stu-id="79721-285">Deploy Diagnostics</span></span>
<span data-ttu-id="79721-286">tooenable la supervisión y diagnóstico mediante programación con la configuración de diagnóstico Hola para los roles de web y de trabajo de hello proporcionados por el paquete de NuGet hello, ejecute hello siga los comandos del uso de PowerShell de Azure:</span><span class="sxs-lookup"><span data-stu-id="79721-286">tooenable monitoring and diagnostics using hello diagnostic configuration for hello web and worker roles provided by hello NuGet package, run hello following commands using Azure PowerShell:</span></span> 

    $storage_name = "<YourAzureStorageAccount>" 

    $key = "<YourAzureStorageAccountKey" 

    $storageContext = New-AzureStorageContext -StorageAccountName $storage_name -StorageAccountKey $key  


    $config_path = "<YourFilePath>\SplitMergeWebContent.diagnostics.xml" 

    $service_name = "<YourCloudServiceName>" 

    Set-AzureServiceDiagnosticsExtension -StorageContext $storageContext -DiagnosticsConfigurationPath $config_path -ServiceName $service_name -Slot Production -Role "SplitMergeWeb" 


    $config_path = "<YourFilePath>\SplitMergeWorkerContent.diagnostics.xml" 

    $service_name = "<YourCloudServiceName>" 

    Set-AzureServiceDiagnosticsExtension -StorageContext $storageContext -DiagnosticsConfigurationPath $config_path -ServiceName $service_name -Slot Production -Role "SplitMergeWorker" 

<span data-ttu-id="79721-287">Puede encontrar más información sobre cómo tooconfigure e implementar la configuración de diagnóstico aquí: [habilitar diagnósticos en servicios en la nube y máquinas virtuales](../cloud-services/cloud-services-dotnet-diagnostics.md).</span><span class="sxs-lookup"><span data-stu-id="79721-287">You can find more information on how tooconfigure and deploy diagnostics settings here: [Enabling Diagnostics in Azure Cloud Services and Virtual Machines](../cloud-services/cloud-services-dotnet-diagnostics.md).</span></span> 

## <a name="retrieve-diagnostics"></a><span data-ttu-id="79721-288">Recuperar diagnósticos</span><span class="sxs-lookup"><span data-stu-id="79721-288">Retrieve diagnostics</span></span>
<span data-ttu-id="79721-289">Puede acceder fácilmente a los diagnósticos de hello Explorador de servidores de Visual Studio en Azure, parte del árbol del explorador de servidores de Hola Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-289">You can easily access your diagnostics from hello Visual Studio Server Explorer in hello Azure part of hello Server Explorer tree.</span></span> <span data-ttu-id="79721-290">Abra una instancia de Visual Studio y, en la barra de menús de hello, haga clic en vista y el Explorador de servidores.</span><span class="sxs-lookup"><span data-stu-id="79721-290">Open a Visual Studio instance, and in hello menu bar click View, and Server Explorer.</span></span> <span data-ttu-id="79721-291">Haga clic en hello icono de Azure tooconnect tooyour suscripción de Azure.</span><span class="sxs-lookup"><span data-stu-id="79721-291">Click hello Azure icon tooconnect tooyour Azure subscription.</span></span> <span data-ttu-id="79721-292">A continuación, desplácese tooAzure -> almacenamiento -> <your storage account> -> tablas -> WADLogsTable.</span><span class="sxs-lookup"><span data-stu-id="79721-292">Then navigate tooAzure -> Storage -> <your storage account> -> Tables -> WADLogsTable.</span></span> <span data-ttu-id="79721-293">Para obtener más información, consulte [Exploración de recursos de almacenamiento con el Explorador de servidores](http://msdn.microsoft.com/library/azure/ff683677.aspx).</span><span class="sxs-lookup"><span data-stu-id="79721-293">For more information, see [Browsing Storage Resources with Server Explorer](http://msdn.microsoft.com/library/azure/ff683677.aspx).</span></span> 

![WADLogsTable][2]

<span data-ttu-id="79721-295">Hola WADLogsTable resaltado en la siguiente figura hello contiene Hola detallada de eventos del registro de aplicación del servicio de hello dividir-combinar.</span><span class="sxs-lookup"><span data-stu-id="79721-295">hello WADLogsTable highlighted in hello figure above contains hello detailed events from hello split-merge service’s application log.</span></span> <span data-ttu-id="79721-296">Tenga en cuenta que Hola de forma predeterminada la configuración de hello Descargar paquete es dirigido hacia una implementación de producción.</span><span class="sxs-lookup"><span data-stu-id="79721-296">Note that hello default configuration of hello downloaded package is geared towards a production deployment.</span></span> <span data-ttu-id="79721-297">Por lo tanto, intervalo de saludo en el que se extraigan registros y contadores en instancias de servicio de hello es grandes (5 minutos).</span><span class="sxs-lookup"><span data-stu-id="79721-297">Therefore hello interval at which logs and counters are pulled from hello service instances is large (5 minutes).</span></span> <span data-ttu-id="79721-298">Para pruebas y desarrollo, intervalo de saludo menor ajustando los valores de diagnóstico de Hola de web de Hola o tooyour de rol de trabajo de hello necesita.</span><span class="sxs-lookup"><span data-stu-id="79721-298">For test and development, lower hello interval by adjusting hello diagnostics settings of hello web or hello worker role tooyour needs.</span></span> <span data-ttu-id="79721-299">Haga doble clic en el rol de Hola Hola Explorador de servidores de Visual Studio (véase más arriba) y, a continuación, ajustar hello período de transferencia en el cuadro de diálogo de Hola para opciones de configuración de diagnósticos de hello:</span><span class="sxs-lookup"><span data-stu-id="79721-299">Right-click on hello role in hello Visual Studio Server Explorer (see above) and then adjust hello Transfer Period in hello dialog for hello Diagnostics configuration settings:</span></span> 

![Configuración][3]

## <a name="performance"></a><span data-ttu-id="79721-301">Rendimiento</span><span class="sxs-lookup"><span data-stu-id="79721-301">Performance</span></span>
<span data-ttu-id="79721-302">En general, un mejor rendimiento es toobe esperado a partir de hello superior, más niveles de servicio de rendimiento en la base de datos de SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="79721-302">In general, better performance is toobe expected from hello higher, more performant service tiers in Azure SQL Database.</span></span> <span data-ttu-id="79721-303">Asignaciones de memoria, CPU y E/S mayor para los niveles de servicio superiores de Hola Hola de copia masiva benefician y eliminación operaciones que Hola dividir-combinar servicio utiliza.</span><span class="sxs-lookup"><span data-stu-id="79721-303">Higher IO, CPU and memory allocations for hello higher service tiers benefit hello bulk copy and delete operations that hello split-merge service uses.</span></span> <span data-ttu-id="79721-304">Por esta razón, aumente el nivel de servicio de hello solo para esas bases de datos durante un período definido, limitado de tiempo.</span><span class="sxs-lookup"><span data-stu-id="79721-304">For that reason, increase hello service tier just for those databases for a defined, limited period of time.</span></span>

<span data-ttu-id="79721-305">servicio de Hello también realiza consultas de validación como parte de sus operaciones normales.</span><span class="sxs-lookup"><span data-stu-id="79721-305">hello service also performs validation queries as part of its normal operations.</span></span> <span data-ttu-id="79721-306">Estas consultas de validación comprobación inesperado presencia de datos en el intervalo de destino de Hola y asegúrese de que cualquier operación de división/combinación/movimiento se inicia desde un estado coherente.</span><span class="sxs-lookup"><span data-stu-id="79721-306">These validation queries check for unexpected presence of data in hello target range and ensure that any split/merge/move operation starts from a consistent state.</span></span> <span data-ttu-id="79721-307">Estas consultas todos funcionan sobre intervalos de clave de particionamiento definidos por el ámbito de Hola de operación de Hola y el tamaño de lote de hello proporcionadas como parte de la definición de la solicitud de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-307">These queries all work over sharding key ranges defined by hello scope of hello operation and hello batch size provided as part of hello request definition.</span></span> <span data-ttu-id="79721-308">Estas consultas demostrar un mejor comportamiento cuando un índice está presente cuya clave de particionamiento de hello como Hola columna inicial.</span><span class="sxs-lookup"><span data-stu-id="79721-308">These queries perform best when an index is present that has hello sharding key as hello leading column.</span></span> 

<span data-ttu-id="79721-309">Además, una propiedad de unicidad con clave de particionamiento de hello como columna inicial Hola permitirá Hola servicio toouse un enfoque optimizado que limita el consumo de recursos en cuanto a memoria y espacio en el registro.</span><span class="sxs-lookup"><span data-stu-id="79721-309">In addition, a uniqueness property with hello sharding key as hello leading column will allow hello service toouse an optimized approach that limits resource consumption in terms of log space and memory.</span></span> <span data-ttu-id="79721-310">Esta propiedad de unicidad es necesario toomove tamaños de datos de gran tamaño (normalmente por encima de 1GB).</span><span class="sxs-lookup"><span data-stu-id="79721-310">This uniqueness property is required toomove large data sizes (typically above 1GB).</span></span> 

## <a name="how-tooupgrade"></a><span data-ttu-id="79721-311">Cómo tooupgrade</span><span class="sxs-lookup"><span data-stu-id="79721-311">How tooupgrade</span></span>
1. <span data-ttu-id="79721-312">Siga los pasos de hello en [implementar un servicio de dividir-combinar](sql-database-elastic-scale-configure-deploy-split-and-merge.md).</span><span class="sxs-lookup"><span data-stu-id="79721-312">Follow hello steps in [Deploy a split-merge service](sql-database-elastic-scale-configure-deploy-split-and-merge.md).</span></span>
2. <span data-ttu-id="79721-313">Cambiar el archivo de configuración de servicio de nube para sus implementación de dividir-combinar tooreflect Hola nuevos parámetros de configuración.</span><span class="sxs-lookup"><span data-stu-id="79721-313">Change your cloud service configuration file for your split-merge deployment tooreflect hello new configuration parameters.</span></span> <span data-ttu-id="79721-314">Un nuevo parámetro requerido es información de hello sobre certificado Hola usado para el cifrado.</span><span class="sxs-lookup"><span data-stu-id="79721-314">A new required parameter is hello information about hello certificate used for encryption.</span></span> <span data-ttu-id="79721-315">Una manera fácil toodo trata toocompare Hola nuevo plantilla archivo de configuración de descarga de hello en la configuración existente.</span><span class="sxs-lookup"><span data-stu-id="79721-315">An easy way toodo this is toocompare hello new configuration template file from hello download against your existing configuration.</span></span> <span data-ttu-id="79721-316">Asegúrese de que agregar configuración de Hola de "DataEncryptionPrimaryCertificateThumbprint" y "DataEncryptionPrimary" para web hello y rol de trabajo de Hola.</span><span class="sxs-lookup"><span data-stu-id="79721-316">Make sure you add hello settings for “DataEncryptionPrimaryCertificateThumbprint” and “DataEncryptionPrimary” for both hello web and hello worker role.</span></span>
3. <span data-ttu-id="79721-317">Antes de implementar hello tooAzure de actualización, asegúrese de que han terminado de todas las operaciones de mezcla de división actualmente en ejecución.</span><span class="sxs-lookup"><span data-stu-id="79721-317">Before deploying hello update tooAzure, ensure that all currently running split-merge operations have finished.</span></span> <span data-ttu-id="79721-318">Puede hacerlo fácilmente consultando las tablas de estado de la solicitud y PendingWorkflows de hello en base de datos de metadatos de mezcla de la división de Hola para las solicitudes en curso.</span><span class="sxs-lookup"><span data-stu-id="79721-318">You can easily do this by querying hello RequestStatus and PendingWorkflows tables in hello split-merge metadata database for ongoing requests.</span></span>
4. <span data-ttu-id="79721-319">Actualizar la implementación del servicio en la nube existente para dividir-combinar en la suscripción de Azure con el nuevo paquete de Hola y el archivo de configuración de servicio actualizada.</span><span class="sxs-lookup"><span data-stu-id="79721-319">Update your existing cloud service deployment for split-merge in your Azure subscription with hello new package and your updated service configuration file.</span></span>

<span data-ttu-id="79721-320">No es necesario tooprovision una nueva base de datos de metadatos para dividir-combinar tooupgrade.</span><span class="sxs-lookup"><span data-stu-id="79721-320">You do not need tooprovision a new metadata database for split-merge tooupgrade.</span></span> <span data-ttu-id="79721-321">nueva versión de Hello actualizará automáticamente la versión nueva de metadatos base de datos toohello existente.</span><span class="sxs-lookup"><span data-stu-id="79721-321">hello new version will automatically upgrade your existing metadata database toohello new version.</span></span> 

## <a name="best-practices--troubleshooting"></a><span data-ttu-id="79721-322">Prácticas recomendadas y solución de problemas</span><span class="sxs-lookup"><span data-stu-id="79721-322">Best practices & troubleshooting</span></span>
* <span data-ttu-id="79721-323">Definir a un inquilino de prueba y ejecutar las operaciones de división o combinación/mover más importantes con el inquilino de prueba de hello entre varias particiones.</span><span class="sxs-lookup"><span data-stu-id="79721-323">Define a test tenant and exercise your most important split/merge/move operations with hello test tenant across several shards.</span></span> <span data-ttu-id="79721-324">Asegúrese de que todos los metadatos se definen correctamente en el mapa de particiones y que las operaciones de hello no infringen las restricciones o las claves externas.</span><span class="sxs-lookup"><span data-stu-id="79721-324">Ensure that all metadata is defined correctly in your shard map and that hello operations do not violate constraints or foreign keys.</span></span>
* <span data-ttu-id="79721-325">Tamaño de datos del inquilino de mantener Hola prueba anteriormente Hola tamaño máximo de datos del inquilino más grande de problemas relacionados con el tooensure no se está produciendo tamaño de los datos.</span><span class="sxs-lookup"><span data-stu-id="79721-325">Keep hello test tenant data size above hello maximum data size of your largest tenant tooensure you are not encountering data size related issues.</span></span> <span data-ttu-id="79721-326">Esto ayuda a evaluar un límite superior de Hola que tarda toomove un solo inquilino alrededor.</span><span class="sxs-lookup"><span data-stu-id="79721-326">This helps you assess an upper bound on hello time it takes toomove a single tenant around.</span></span> 
* <span data-ttu-id="79721-327">Asegúrese de que el esquema permita las eliminaciones.</span><span class="sxs-lookup"><span data-stu-id="79721-327">Make sure that your schema allows deletions.</span></span> <span data-ttu-id="79721-328">servicio de dividir-combinar Hola requiere que los datos de tooremove Hola capacidad de partición de origen Hola vez datos Hola destino toohello copió correctamente.</span><span class="sxs-lookup"><span data-stu-id="79721-328">hello split-merge service requires hello ability tooremove data from hello source shard once hello data has been successfully copied toohello target.</span></span> <span data-ttu-id="79721-329">Por ejemplo, **eliminar desencadenadores** puede impedir que se eliminen datos de hello en el origen de hello servicio hello y puede provocar toofail de operaciones.</span><span class="sxs-lookup"><span data-stu-id="79721-329">For example, **delete triggers** can prevent hello service from deleting hello data on hello source and may cause operations toofail.</span></span>
* <span data-ttu-id="79721-330">clave de particionamiento de Hola debe ser la columna inicial de hello en la clave principal o la definición de índice único.</span><span class="sxs-lookup"><span data-stu-id="79721-330">hello sharding key should be hello leading column in your primary key or unique index definition.</span></span> <span data-ttu-id="79721-331">Que garantiza un rendimiento óptimo para Hola Hola dividir o combinar consultas de validación y para hello datos reales movimiento y la eliminación de las operaciones que siempre funcionan en intervalos de clave de particionamiento.</span><span class="sxs-lookup"><span data-stu-id="79721-331">That ensures hello best performance for hello split or merge validation queries, and for hello actual data movement and deletion operations which always operate on sharding key ranges.</span></span>
* <span data-ttu-id="79721-332">Colocar el servicio de dividir-combinar en el centro de datos y la región de Hola donde residen las bases de datos.</span><span class="sxs-lookup"><span data-stu-id="79721-332">Collocate your split-merge service in hello region and data center where your databases reside.</span></span> 

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Anchors-->
<!--Image references-->
[1]:./media/sql-database-elastic-scale-overview-split-and-merge/split-merge-overview.png
[2]:./media/sql-database-elastic-scale-overview-split-and-merge/diagnostics.png
[3]:./media/sql-database-elastic-scale-overview-split-and-merge/diagnostics-config.png


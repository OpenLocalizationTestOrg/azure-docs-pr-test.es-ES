---
title: "Recuperación ante desastres de SQL Database | Microsoft Docs"
description: "Obtenga información sobre cómo recuperar una base de datos tras un error o una interrupción de un centro de datos regional con las funcionalidades de replicación geográfica activa y restauración geográfica de Azure SQL Database."
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 4800960e-3f9d-40ce-9e55-fb7f2784c067
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/14/2017
ms.author: sashan
ms.openlocfilehash: e33f69bf04b32a31aae3c311c41aa44e4da5016a
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="restore-an-azure-sql-database-or-failover-to-a-secondary"></a><span data-ttu-id="45572-103">Restauración de una base de datos SQL de Azure o una conmutación por error en una secundaria</span><span class="sxs-lookup"><span data-stu-id="45572-103">Restore an Azure SQL Database or failover to a secondary</span></span>
<span data-ttu-id="45572-104">Base de datos SQL de Azure ofrece las siguientes capacidades para recuperarse de un corte en el suministro eléctrico:</span><span class="sxs-lookup"><span data-stu-id="45572-104">Azure SQL Database offers the following capabilities for recovering from an outage:</span></span>

* [<span data-ttu-id="45572-105">Replicación geográfica activa</span><span class="sxs-lookup"><span data-stu-id="45572-105">Active geo-replication</span></span>](sql-database-geo-replication-overview.md)
* [<span data-ttu-id="45572-106">Restauración geográfica</span><span class="sxs-lookup"><span data-stu-id="45572-106">Geo-restore</span></span>](sql-database-recovery-using-backups.md#point-in-time-restore)

<span data-ttu-id="45572-107">Para obtener información sobre los escenarios de continuidad empresarial y sus características, consulte el artículo sobre [continuidad empresarial](sql-database-business-continuity.md).</span><span class="sxs-lookup"><span data-stu-id="45572-107">To learn about business continuity scenarios and the features supporting these scenarios, see [Business continuity](sql-database-business-continuity.md).</span></span>

### <a name="prepare-for-the-event-of-an-outage"></a><span data-ttu-id="45572-108">Preparación ante interrupciones</span><span class="sxs-lookup"><span data-stu-id="45572-108">Prepare for the event of an outage</span></span>
<span data-ttu-id="45572-109">Para que el proceso de recuperación pueda realizarse sin problemas en otra región de datos mediante la replicación geográfica activa o las copias de seguridad con redundancia geográfica, debe preparar un servidor en otra interrupción de un centro de datos para convertirlo en el nuevo servidor principal si lo considera necesario. También hay que contar con pasos bien definidos que se hayan documentado y probado para garantizar que la recuperación se lleve a cabo correctamente.</span><span class="sxs-lookup"><span data-stu-id="45572-109">For success with recovery to another data region using either active geo-replication or geo-redundant backups, you need to prepare a server in another data center outage to become the new primary server should the need arise as well as have well-defined steps documented and tested to ensure a smooth recovery.</span></span> <span data-ttu-id="45572-110">Estos son algunos de los pasos correspondientes a la fase de preparación:</span><span class="sxs-lookup"><span data-stu-id="45572-110">These preparation steps include:</span></span>

* <span data-ttu-id="45572-111">Identificar el servidor lógico en otra región para convertirse en el nuevo servidor principal.</span><span class="sxs-lookup"><span data-stu-id="45572-111">Identify the logical server in another region to become the new primary server.</span></span> <span data-ttu-id="45572-112">Con la replicación geográfica activa, será, como mínimo, uno de los servidores secundarios (y probablemente todos).</span><span class="sxs-lookup"><span data-stu-id="45572-112">With active geo-replication, this will be at least one and perhaps each of the secondary servers.</span></span> <span data-ttu-id="45572-113">Para la restauración geográfica, normalmente suele ser un servidor de la [región asociada](../best-practices-availability-paired-regions.md) a aquella en donde se encuentre la base de datos.</span><span class="sxs-lookup"><span data-stu-id="45572-113">For geo-restore, this will generally be a server in the [paired region](../best-practices-availability-paired-regions.md) for the region in which your database is located.</span></span>
* <span data-ttu-id="45572-114">Identificar y, de manera opcional, definir las reglas de firewall de nivel de servidor que deben estar activas para que los usuarios accedan la nueva base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="45572-114">Identify, and optionally define, the server-level firewall rules needed on for users to access the new primary database.</span></span>
* <span data-ttu-id="45572-115">Determinar cómo va a redirigir a los usuarios al nuevo servidor principal; por ejemplo, cambiar las cadenas de conexión o las entradas DNS.</span><span class="sxs-lookup"><span data-stu-id="45572-115">Determine how you are going to redirect users to the new primary server, such as by changing connection strings or by changing DNS entries.</span></span>
* <span data-ttu-id="45572-116">Identificar y, de manera opcional, crear los inicios de sesión que deben estar presentes en la base de datos maestra del nuevo servidor principal, así como asegurarse de que tienen los permisos adecuados en la base de datos maestra, si procede.</span><span class="sxs-lookup"><span data-stu-id="45572-116">Identify, and optionally create, the logins that must be present in the master database on the new primary server, and ensure these logins have appropriate permissions in the master database, if any.</span></span> <span data-ttu-id="45572-117">Para obtener más información, consulte [Administración de la seguridad de Base de datos SQL de Azure después de la recuperación ante desastres](sql-database-geo-replication-security-config.md)</span><span class="sxs-lookup"><span data-stu-id="45572-117">For more information, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md)</span></span>
* <span data-ttu-id="45572-118">Identificar las reglas de alerta que deben actualizarse para que se asignen a la nueva base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="45572-118">Identify alert rules that will need to be updated to map to the new primary database.</span></span>
* <span data-ttu-id="45572-119">Documentar la configuración de auditoría de la base de datos principal actual.</span><span class="sxs-lookup"><span data-stu-id="45572-119">Document the auditing configuration on the current primary database</span></span>
* <span data-ttu-id="45572-120">Realice [maniobras de recuperación ante desastres](sql-database-disaster-recovery-drills.md).</span><span class="sxs-lookup"><span data-stu-id="45572-120">Perform a [disaster recovery drill](sql-database-disaster-recovery-drills.md).</span></span> <span data-ttu-id="45572-121">Para simular una interrupción con la restauración geográfica, puede eliminar o cambiar el nombre de la base de datos de origen para provocar el error de conectividad de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="45572-121">To simulate an outage for geo-restore, you can delete or rename the source database to cause application connectivity failure.</span></span> <span data-ttu-id="45572-122">Para realizar el mismo proceso con la replicación geográfica activa, puede deshabilitar la aplicación web o la máquina virtual conectadas a la base de datos, o bien llevar a cabo una conmutación por error en la base de datos para provocar errores de conectividad en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="45572-122">To simulate an outage for active geo-replication, you can disable the web application or virtual machine connected to the database or failover the database to cause application connectivity failures.</span></span>

## <a name="when-to-initiate-recovery"></a><span data-ttu-id="45572-123">Cuándo iniciar la recuperación</span><span class="sxs-lookup"><span data-stu-id="45572-123">When to initiate recovery</span></span>
<span data-ttu-id="45572-124">La operación de recuperación repercute en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="45572-124">The recovery operation impacts the application.</span></span> <span data-ttu-id="45572-125">Este proceso requiere cambiar el redireccionamiento o la cadena de conexión SQL mediante DNS, y podría provocar la pérdida de datos permanente.</span><span class="sxs-lookup"><span data-stu-id="45572-125">It requires changing the SQL connection string or redirection using DNS and could result in permanent data loss.</span></span> <span data-ttu-id="45572-126">Por lo tanto, debe realizarse solo cuando la duración de la interrupción pueda durar más que el objetivo de tiempo de recuperación de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="45572-126">Therefore, it should be done only when the outage is likely to last longer than your application's recovery time objective.</span></span> <span data-ttu-id="45572-127">Cuando se implementa la aplicación en producción, deberá supervisar con frecuencia el estado de la aplicación. Para ello, use los siguientes puntos de datos para garantizar la recuperación:</span><span class="sxs-lookup"><span data-stu-id="45572-127">When the application is deployed to production you should perform regular monitoring of the application health and use the following data points to assert that the recovery is warranted:</span></span>

1. <span data-ttu-id="45572-128">Error de conectividad permanente de la capa de aplicación en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="45572-128">Permanent connectivity failure from the application tier to the database.</span></span>
2. <span data-ttu-id="45572-129">El Portal de Azure muestra una alerta sobre una incidencia en una región con un gran impacto.</span><span class="sxs-lookup"><span data-stu-id="45572-129">The Azure portal shows an alert about an incident in the region with broad impact.</span></span>
3. <span data-ttu-id="45572-130">El servidor de Base de datos SQL de Azure está marcado como degradado.</span><span class="sxs-lookup"><span data-stu-id="45572-130">The Azure SQL Database server is marked as degraded.</span></span>

<span data-ttu-id="45572-131">En función de la tolerancia de la aplicación al tiempo de inactividad y de la posible responsabilidad civil, puede considerar las siguientes opciones de recuperación.</span><span class="sxs-lookup"><span data-stu-id="45572-131">Depending on your application tolerance to downtime and possible business liability you can consider the following recovery options.</span></span>

<span data-ttu-id="45572-132">Use la opción [Get Recoverable Database](https://msdn.microsoft.com/library/dn800985.aspx) (Obtener base de datos recuperable) (*LastAvailableBackupDate*) para obtener el último punto de restauración de replicación geográfica.</span><span class="sxs-lookup"><span data-stu-id="45572-132">Use the [Get Recoverable Database](https://msdn.microsoft.com/library/dn800985.aspx) (*LastAvailableBackupDate*) to get the latest Geo-replicated restore point.</span></span>

## <a name="wait-for-service-recovery"></a><span data-ttu-id="45572-133">Espera para la recuperación del servicio</span><span class="sxs-lookup"><span data-stu-id="45572-133">Wait for service recovery</span></span>
<span data-ttu-id="45572-134">Los equipos de Azure trabajan diligentemente para restaurar la disponibilidad del servicio lo antes posible, pero dependiendo de la causa principal pueden tardar horas, o incluso días.</span><span class="sxs-lookup"><span data-stu-id="45572-134">The Azure teams work diligently to restore service availability as quickly as possible but depending on the root cause it can take hours or days.</span></span>  <span data-ttu-id="45572-135">Si la aplicación puede tolerar un tiempo de inactividad considerable, puede esperar hasta que se complete la recuperación.</span><span class="sxs-lookup"><span data-stu-id="45572-135">If your application can tolerate significant downtime you can simply wait for the recovery to complete.</span></span> <span data-ttu-id="45572-136">En este caso, no se requieren acciones por su parte.</span><span class="sxs-lookup"><span data-stu-id="45572-136">In this case, no action on your part is required.</span></span> <span data-ttu-id="45572-137">El estado actual del servicio se puede ver en el [panel de estado de los servicios de Azure](https://azure.microsoft.com/status/).</span><span class="sxs-lookup"><span data-stu-id="45572-137">You can see the current service status on our [Azure Service Health Dashboard](https://azure.microsoft.com/status/).</span></span> <span data-ttu-id="45572-138">Después de la recuperación de la región se restaurará la disponibilidad de su aplicación.</span><span class="sxs-lookup"><span data-stu-id="45572-138">After the recovery of the region your application’s availability will be restored.</span></span>

## <a name="fail-over-to-geo-replicated-secondary-database"></a><span data-ttu-id="45572-139">Conmutación por error de la base de datos secundaria de replicación geográfica</span><span class="sxs-lookup"><span data-stu-id="45572-139">Fail over to geo-replicated secondary database</span></span>
<span data-ttu-id="45572-140">Si el tiempo de inactividad de la aplicación puede dar lugar a responsabilidades civiles, debería utilizar bases de datos con replicación geográfica en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="45572-140">If your application’s downtime can result in business liability you should be using geo-replicated database(s) in your application.</span></span> <span data-ttu-id="45572-141">Esto permitirá que la aplicación restaure rápidamente la disponibilidad en una región diferente en caso de interrupción.</span><span class="sxs-lookup"><span data-stu-id="45572-141">It will enable the application to quickly restore availability in a different region in case of an outage.</span></span> <span data-ttu-id="45572-142">Obtenga información sobre cómo [configurar la replicación geográfica](sql-database-geo-replication-portal.md).</span><span class="sxs-lookup"><span data-stu-id="45572-142">Learn how to [configure geo-replication](sql-database-geo-replication-portal.md).</span></span>

<span data-ttu-id="45572-143">Para restaurar la disponibilidad de las bases de datos, es preciso iniciar la conmutación por error en la secundaria con replicación geográfica mediante uno de los métodos admitidos.</span><span class="sxs-lookup"><span data-stu-id="45572-143">To restore availability of the database(s) you need to initiate the failover to the geo-replicated secondary using one of the supported methods.</span></span>

<span data-ttu-id="45572-144">Utilice una de las siguientes guías para realizar la conmutación por error en una base de datos secundaria con replicación geográfica:</span><span class="sxs-lookup"><span data-stu-id="45572-144">Use one of the following guides to fail over to a geo-replicated secondary database:</span></span>

* [<span data-ttu-id="45572-145">Configuración de replicación geográfica con Azure Portal</span><span class="sxs-lookup"><span data-stu-id="45572-145">Fail over to a geo-replicated secondary using Azure Portal</span></span>](sql-database-geo-replication-portal.md)
* [<span data-ttu-id="45572-146">Configuración de la replicación geográfica con PowerShell</span><span class="sxs-lookup"><span data-stu-id="45572-146">Fail over to a geo-replicated secondary using PowerShell</span></span>](scripts/sql-database-setup-geodr-and-failover-database-powershell.md)
* [<span data-ttu-id="45572-147">Conmutación por error a una base de datos secundaria con replicación geográfica mediante Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="45572-147">Fail over to a geo-replicated secondary using T-SQL</span></span>](sql-database-geo-replication-transact-sql.md)

## <a name="recover-using-geo-restore"></a><span data-ttu-id="45572-148">Recuperación mediante la restauración geográfica</span><span class="sxs-lookup"><span data-stu-id="45572-148">Recover using geo-restore</span></span>
<span data-ttu-id="45572-149">Si el tiempo de inactividad de la aplicación no da lugar a responsabilidades civiles, puede usar la [restauración geográfica](sql-database-recovery-using-backups.md) como método para recuperar las bases de datos de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="45572-149">If your application’s downtime does not result in business liability you can use [geo-restore](sql-database-recovery-using-backups.md) as a method to recover your application database(s).</span></span> <span data-ttu-id="45572-150">Dicho método crea una copia de la base de datos a partir de la última copia de seguridad con redundancia geográfica.</span><span class="sxs-lookup"><span data-stu-id="45572-150">It creates a copy of the database from its latest geo-redundant backup.</span></span>

## <a name="configure-your-database-after-recovery"></a><span data-ttu-id="45572-151">Configuración de la base de datos después de realizar la recuperación</span><span class="sxs-lookup"><span data-stu-id="45572-151">Configure your database after recovery</span></span>
<span data-ttu-id="45572-152">Si se usa la conmutación por error con replicación geográfica o la funcionalidad de restauración geográfica para recuperar la base de datos tras una interrupción, hay que asegurarse de que la conectividad con las bases de datos nuevas está configurada correctamente para que se pueda reanudar el funcionamiento normal de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="45572-152">If you are using either geo-replication failover or geo-restore to recover from an outage, you must make sure that the connectivity to the new databases is properly configured so that the normal application function can be resumed.</span></span> <span data-ttu-id="45572-153">Esta es una lista de comprobación de las tareas necesarias para que la producción de la base de datos recuperada esté lista.</span><span class="sxs-lookup"><span data-stu-id="45572-153">This is a checklist of tasks to get your recovered database production ready.</span></span>

### <a name="update-connection-strings"></a><span data-ttu-id="45572-154">Actualización de cadenas de conexión</span><span class="sxs-lookup"><span data-stu-id="45572-154">Update connection strings</span></span>
<span data-ttu-id="45572-155">Dado que la base de datos recuperada residirá en otro servidor, es preciso que actualice la cadena de conexión de la aplicación para que apunte a dicho servidor.</span><span class="sxs-lookup"><span data-stu-id="45572-155">Because your recovered database will reside in a different server, you need to update your application’s connection string to point to that server.</span></span>

<span data-ttu-id="45572-156">Para obtener más información sobre cómo cambiar las cadenas de conexión, consulte el lenguaje de desarrollo adecuado para la [biblioteca de conexiones](sql-database-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="45572-156">For more information about changing connection strings, see the appropriate development language for your [connection library](sql-database-libraries.md).</span></span>

### <a name="configure-firewall-rules"></a><span data-ttu-id="45572-157">Configuración de las reglas del firewall</span><span class="sxs-lookup"><span data-stu-id="45572-157">Configure Firewall Rules</span></span>
<span data-ttu-id="45572-158">Es preciso que se asegure de que las reglas del firewall configuradas tanto en el servidor como en la base de datos coinciden con las configuradas en el servidor principal y en la base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="45572-158">You need to make sure that the firewall rules configured on server and on the database match those that were configured on the primary server and primary database.</span></span> <span data-ttu-id="45572-159">Para obtener más información, consulte [Configuración del firewall (Base de datos SQL de Azure)](sql-database-configure-firewall-settings.md).</span><span class="sxs-lookup"><span data-stu-id="45572-159">For more information, see [How to: Configure Firewall Settings (Azure SQL Database)](sql-database-configure-firewall-settings.md).</span></span>

### <a name="configure-logins-and-database-users"></a><span data-ttu-id="45572-160">Configuración de inicios de sesión de y de usuarios de la base de datos</span><span class="sxs-lookup"><span data-stu-id="45572-160">Configure logins and database users</span></span>
<span data-ttu-id="45572-161">Es preciso asegurarse de que todos los inicios de sesión que usa la aplicación existen en el servidor que hospeda la base de datos recuperada.</span><span class="sxs-lookup"><span data-stu-id="45572-161">You need to make sure that all the logins used by your application exist on the server which is hosting your recovered database.</span></span> <span data-ttu-id="45572-162">Para obtener más información, consulte [Configuración de seguridad para Replicación geográfica activa o estándar](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="45572-162">For more information, see [Security Configuration for geo-replication](sql-database-geo-replication-security-config.md).</span></span>

> [!NOTE]
> <span data-ttu-id="45572-163">Debe configurar y probar las reglas de firewall del servidor y los inicios de sesión (y sus permisos) durante una maniobra de recuperación ante desastres.</span><span class="sxs-lookup"><span data-stu-id="45572-163">You should configure and test your server firewall rules and logins (and their permissions) during a disaster recovery drill.</span></span> <span data-ttu-id="45572-164">Es posible que estos objetos de nivel de servidor y su configuración no estén disponibles durante la interrupción.</span><span class="sxs-lookup"><span data-stu-id="45572-164">These server-level objects and their configuration may not be available during the outage.</span></span>
> 
> 

### <a name="setup-telemetry-alerts"></a><span data-ttu-id="45572-165">Configuración de alertas de telemetría</span><span class="sxs-lookup"><span data-stu-id="45572-165">Setup telemetry alerts</span></span>
<span data-ttu-id="45572-166">Debe asegurarse de que la configuración actual de la regla de alertas está actualizada para asignarla a la base de datos recuperada y al otro servidor.</span><span class="sxs-lookup"><span data-stu-id="45572-166">You need to make sure your existing alert rule settings are updated to map to the recovered database and the different server.</span></span>

<span data-ttu-id="45572-167">Para obtener más información sobre las reglas de alerta de las bases de datos, consulte [Recibir notificaciones de alerta](../monitoring-and-diagnostics/insights-receive-alert-notifications.md) y [Realización de seguimiento del estado](../monitoring-and-diagnostics/insights-service-health.md).</span><span class="sxs-lookup"><span data-stu-id="45572-167">For more information about database alert rules, see [Receive Alert Notifications](../monitoring-and-diagnostics/insights-receive-alert-notifications.md) and [Track Service Health](../monitoring-and-diagnostics/insights-service-health.md).</span></span>

### <a name="enable-auditing"></a><span data-ttu-id="45572-168">Habilitar auditoría</span><span class="sxs-lookup"><span data-stu-id="45572-168">Enable auditing</span></span>
<span data-ttu-id="45572-169">Si se requiere una auditoría para tener acceso a una base de datos, será preciso habilitar Auditoría tras la recuperación de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="45572-169">If auditing is required to access your database, you need to enable Auditing after the database recovery.</span></span> <span data-ttu-id="45572-170">Para obtener más información, consulte [este artículo sobre la realización de auditorías en las bases de datos](sql-database-auditing.md).</span><span class="sxs-lookup"><span data-stu-id="45572-170">For more information, see [Database auditing](sql-database-auditing.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="45572-171">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="45572-171">Next steps</span></span>
* <span data-ttu-id="45572-172">Para obtener información sobre las copias de seguridad automatizadas de Base de datos SQL de Azure, consulte [Información general: copias de seguridad automatizadas de Base de datos SQL](sql-database-automated-backups.md)</span><span class="sxs-lookup"><span data-stu-id="45572-172">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span></span>
* <span data-ttu-id="45572-173">Para obtener información sobre los escenarios de recuperación y diseño de la continuidad empresarial, consulte el artículo sobre [escenarios de continuidad](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="45572-173">To learn about business continuity design and recovery scenarios, see [Continuity scenarios](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="45572-174">Si quiere saber cómo utilizar las copias de seguridad automatizadas para procesos de recuperación, consulte [Recover an Azure SQL database using automated database backups](sql-database-recovery-using-backups.md)</span><span class="sxs-lookup"><span data-stu-id="45572-174">To learn about using automated backups for recovery, see [restore a database from the service-initiated backups](sql-database-recovery-using-backups.md)</span></span>


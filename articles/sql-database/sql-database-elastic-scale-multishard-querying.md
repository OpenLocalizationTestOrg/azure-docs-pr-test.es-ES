---
title: bases de datos de SQL Azure particionadas aaaQuery | Documentos de Microsoft
description: "Ejecutar consultas entre particiones mediante la biblioteca de cliente de base de datos elástica Hola."
services: sql-database
documentationcenter: 
manager: jhubbard
author: torsteng
editor: 
ms.assetid: a4379c15-f213-4026-ab6f-a450ee9d5758
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/12/2016
ms.author: torsteng
ms.openlocfilehash: a1f0763935a6807b74aa9dec477714e8d117417d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="multi-shard-querying"></a><span data-ttu-id="05c96-103">Consultas a través de particiones múltiples</span><span class="sxs-lookup"><span data-stu-id="05c96-103">Multi-shard querying</span></span>
## <a name="overview"></a><span data-ttu-id="05c96-104">Información general</span><span class="sxs-lookup"><span data-stu-id="05c96-104">Overview</span></span>
<span data-ttu-id="05c96-105">Con hello [herramientas de base de datos elástica](sql-database-elastic-scale-introduction.md), puede crear soluciones de base de datos particionada.</span><span class="sxs-lookup"><span data-stu-id="05c96-105">With hello [Elastic Database tools](sql-database-elastic-scale-introduction.md), you can create sharded database solutions.</span></span> <span data-ttu-id="05c96-106">**Consultas a través de particiones múltiples** se usa para tareas como informes y recopilación de datos que requieren ejecutar una consulta que abarca varias particiones.</span><span class="sxs-lookup"><span data-stu-id="05c96-106">**Multi-shard querying** is used for tasks such as data collection/reporting that require running a query that stretches across several shards.</span></span> <span data-ttu-id="05c96-107">(Esto contrasta demasiado[enrutamiento dependiente de los datos](sql-database-elastic-scale-data-dependent-routing.md), que realiza todo el trabajo en una sola partición.)</span><span class="sxs-lookup"><span data-stu-id="05c96-107">(Contrast this too[data-dependent routing](sql-database-elastic-scale-data-dependent-routing.md), which performs all work on a single shard.)</span></span> 

1. <span data-ttu-id="05c96-108">Obtener un [ **RangeShardMap** ](https://msdn.microsoft.com/library/azure/dn807318.aspx) o [ **ListShardMap** ](https://msdn.microsoft.com/library/azure/dn807370.aspx) con hello [ **TryGetRangeShardMap** ](https://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.shardmanagement.shardmapmanager.trygetrangeshardmap.aspx), hello [ **TryGetListShardMap**](https://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.shardmanagement.shardmapmanager.trygetlistshardmap.aspx), o hello [ **GetShardMap** ](https://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.shardmanagement.shardmapmanager.getshardmap.aspx) método.</span><span class="sxs-lookup"><span data-stu-id="05c96-108">Get a [**RangeShardMap**](https://msdn.microsoft.com/library/azure/dn807318.aspx) or [**ListShardMap**](https://msdn.microsoft.com/library/azure/dn807370.aspx) using hello [**TryGetRangeShardMap**](https://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.shardmanagement.shardmapmanager.trygetrangeshardmap.aspx), hello [**TryGetListShardMap**](https://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.shardmanagement.shardmapmanager.trygetlistshardmap.aspx), or hello [**GetShardMap**](https://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.shardmanagement.shardmapmanager.getshardmap.aspx) method.</span></span> <span data-ttu-id="05c96-109">Consulte [**Construcción de un ShardMapManager**](sql-database-elastic-scale-shard-map-management.md#constructing-a-shardmapmanager) y [**Obtención de las clases RangeShardMap o ListShardMap**](sql-database-elastic-scale-shard-map-management.md#get-a-rangeshardmap-or-listshardmap).</span><span class="sxs-lookup"><span data-stu-id="05c96-109">See [**Constructing a ShardMapManager**](sql-database-elastic-scale-shard-map-management.md#constructing-a-shardmapmanager) and [**Get a RangeShardMap or ListShardMap**](sql-database-elastic-scale-shard-map-management.md#get-a-rangeshardmap-or-listshardmap).</span></span>
2. <span data-ttu-id="05c96-110">Cree un objeto **[MultiShardConnection](https://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardconnection.aspx)**.</span><span class="sxs-lookup"><span data-stu-id="05c96-110">Create a **[MultiShardConnection](https://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardconnection.aspx)** object.</span></span>
3. <span data-ttu-id="05c96-111">Cree un objeto **[MultiShardCommand](https://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardcommand.aspx)**.</span><span class="sxs-lookup"><span data-stu-id="05c96-111">Create a **[MultiShardCommand](https://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardcommand.aspx)**.</span></span> 
4. <span data-ttu-id="05c96-112">Conjunto hello  **[propiedad CommandText](https://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardcommand.commandtext.aspx#P:Microsoft.Azure.SqlDatabase.ElasticScale.Query.MultiShardCommand.CommandText)**  tooa comando T-SQL.</span><span class="sxs-lookup"><span data-stu-id="05c96-112">Set hello **[CommandText property](https://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardcommand.commandtext.aspx#P:Microsoft.Azure.SqlDatabase.ElasticScale.Query.MultiShardCommand.CommandText)** tooa T-SQL command.</span></span>
5. <span data-ttu-id="05c96-113">Ejecutar comando de Hola Hola llamada  **[método ExecuteReader](https://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardcommand.executereader.aspx)**.</span><span class="sxs-lookup"><span data-stu-id="05c96-113">Execute hello command by calling hello **[ExecuteReader method](https://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardcommand.executereader.aspx)**.</span></span>
6. <span data-ttu-id="05c96-114">Ver los resultados de hello mediante hello  **[MultiShardDataReader clase](https://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multisharddatareader.aspx)**.</span><span class="sxs-lookup"><span data-stu-id="05c96-114">View hello results using hello **[MultiShardDataReader class](https://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multisharddatareader.aspx)**.</span></span> 

## <a name="example"></a><span data-ttu-id="05c96-115">Ejemplo</span><span class="sxs-lookup"><span data-stu-id="05c96-115">Example</span></span>
<span data-ttu-id="05c96-116">Hello código siguiente muestra el uso de Hola de varias particiones realizar consultas con un determinado **ShardMap** denominado *myShardMap*.</span><span class="sxs-lookup"><span data-stu-id="05c96-116">hello following code illustrates hello usage of multi-shard querying using a given **ShardMap** named *myShardMap*.</span></span> 

    using (MultiShardConnection conn = new MultiShardConnection( 
                                        myShardMap.GetShards(), 
                                        myShardConnectionString) 
          ) 
    { 
    using (MultiShardCommand cmd = conn.CreateCommand())
           { 
            cmd.CommandText = "SELECT c1, c2, c3 FROM ShardedTable"; 
            cmd.CommandType = CommandType.Text; 
            cmd.ExecutionOptions = MultiShardExecutionOptions.IncludeShardNameColumn; 
            cmd.ExecutionPolicy = MultiShardExecutionPolicy.PartialResults; 

            using (MultiShardDataReader sdr = cmd.ExecuteReader()) 
                { 
                    while (sdr.Read())
                        { 
                            var c1Field = sdr.GetString(0); 
                            var c2Field = sdr.GetFieldValue<int>(1); 
                            var c3Field = sdr.GetFieldValue<Int64>(2);
                        } 
                 } 
           } 
    } 


<span data-ttu-id="05c96-117">Una diferencia fundamental es la construcción de Hola de conexiones de varias particiones.</span><span class="sxs-lookup"><span data-stu-id="05c96-117">A key difference is hello construction of multi-shard connections.</span></span> <span data-ttu-id="05c96-118">Donde **SqlConnection** funciona en una sola base de datos, hello **MultiShardConnection** toma una ***colección de particiones*** como entrada.</span><span class="sxs-lookup"><span data-stu-id="05c96-118">Where **SqlConnection** operates on a single database, hello **MultiShardConnection** takes a ***collection of shards*** as its input.</span></span> <span data-ttu-id="05c96-119">Rellenar la colección de Hola de particiones de un mapa de particiones.</span><span class="sxs-lookup"><span data-stu-id="05c96-119">Populate hello collection of shards from a shard map.</span></span> <span data-ttu-id="05c96-120">a continuación, se ejecuta la consulta de Hello en la colección de Hola de particiones con **UNION ALL** semántica tooassemble un único resultado total.</span><span class="sxs-lookup"><span data-stu-id="05c96-120">hello query is then executed on hello collection of shards using **UNION ALL** semantics tooassemble a single overall result.</span></span> <span data-ttu-id="05c96-121">Si lo desea, puede agregarse a nombre Hola de particiones de Hola donde se origina la fila de hello toohello Hola de salida **ExecutionOptions** propiedad en el comando.</span><span class="sxs-lookup"><span data-stu-id="05c96-121">Optionally, hello name of hello shard where hello row originates from can be added toohello output using hello **ExecutionOptions** property on command.</span></span> 

<span data-ttu-id="05c96-122">Tenga en cuenta llamada Hola demasiado**myShardMap.GetShards()**.</span><span class="sxs-lookup"><span data-stu-id="05c96-122">Note hello call too**myShardMap.GetShards()**.</span></span> <span data-ttu-id="05c96-123">Este método recupera todas las particiones de mapa de particiones de Hola y proporciona una manera sencilla de toorun una consulta en todas las bases de datos relevantes.</span><span class="sxs-lookup"><span data-stu-id="05c96-123">This method retrieves all shards from hello shard map and provides an easy way toorun a query across all relevant databases.</span></span> <span data-ttu-id="05c96-124">Hello colección de particiones para una consulta de varias particiones se puede refinar aún más realizando una LINQ consultar sobre colección de hello devuelta de la llamada de hello demasiado**myShardMap.GetShards()**.</span><span class="sxs-lookup"><span data-stu-id="05c96-124">hello collection of shards for a multi-shard query can be refined further by performing a LINQ query over hello collection returned from hello call too**myShardMap.GetShards()**.</span></span> <span data-ttu-id="05c96-125">En combinación con la directiva de resultados parciales de hello, capacidad de corriente de hello en varias particiones consultar ha sido diseñada toowork bien para decenas seguridad toohundreds de particiones.</span><span class="sxs-lookup"><span data-stu-id="05c96-125">In combination with hello partial results policy, hello current capability in multi-shard querying has been designed toowork well for tens up toohundreds of shards.</span></span>

<span data-ttu-id="05c96-126">Una limitación con particiones múltiples consultas actualmente es falta de Hola de validación de particiones y shardlets que se consultan.</span><span class="sxs-lookup"><span data-stu-id="05c96-126">A limitation with multi-shard querying is currently hello lack of validation for shards and shardlets that are queried.</span></span> <span data-ttu-id="05c96-127">Mientras que enrutamiento dependiente de los datos, se comprueba que una partición determinada es parte del mapa de particiones de hello en tiempo de presentación de las consultas, las consultas de varias particiones no realizar esta comprobación.</span><span class="sxs-lookup"><span data-stu-id="05c96-127">While data-dependent routing verifies that a given shard is part of hello shard map at hello time of querying, multi-shard queries do not perform this check.</span></span> <span data-ttu-id="05c96-128">Esto puede provocar que las consultas de toomulti particiones que se ejecutan en bases de datos que se han quitado de mapa de particiones de Hola.</span><span class="sxs-lookup"><span data-stu-id="05c96-128">This can lead toomulti-shard queries running on databases that have  been removed from hello shard map.</span></span>

## <a name="multi-shard-queries-and-split-merge-operations"></a><span data-ttu-id="05c96-129">Consultas a través de particiones múltiples y operaciones de división y combinación</span><span class="sxs-lookup"><span data-stu-id="05c96-129">Multi-shard queries and split-merge operations</span></span>
<span data-ttu-id="05c96-130">Las consultas de varias particiones no comprueban si shardlets en la base de datos consultados de hello forman parte de las operaciones de división de combinación en curso.</span><span class="sxs-lookup"><span data-stu-id="05c96-130">Multi-shard queries do not verify whether shardlets on hello queried database are participating in ongoing split-merge operations.</span></span> <span data-ttu-id="05c96-131">(Consulte [escalado mediante la herramienta Hola bases de datos elásticas dividir-combinar](sql-database-elastic-scale-overview-split-and-merge.md).) Esto puede provocar tooinconsistencies donde filas de Hola misma presentación de shardlet para varias bases de datos en hello misma consulta de varias particiones.</span><span class="sxs-lookup"><span data-stu-id="05c96-131">(See [Scaling using hello Elastic Database split-merge tool](sql-database-elastic-scale-overview-split-and-merge.md).) This can lead tooinconsistencies where rows from hello same shardlet show for multiple databases in hello same multi-shard query.</span></span> <span data-ttu-id="05c96-132">Tenga en cuenta estas limitaciones y considere la posibilidad de purgar en curso dividir-combinar cambios y operaciones toohello mapa de particiones al realizar consultas de varias particiones.</span><span class="sxs-lookup"><span data-stu-id="05c96-132">Be aware of these limitations and consider draining ongoing split-merge operations and changes toohello shard map while performing multi-shard queries.</span></span>

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

## <a name="see-also"></a><span data-ttu-id="05c96-133">Otras referencias</span><span class="sxs-lookup"><span data-stu-id="05c96-133">See also</span></span>
<span data-ttu-id="05c96-134">Clases y métodos **[System.Data.SqlClient](http://msdn.microsoft.com/library/System.Data.SqlClient.aspx)**.</span><span class="sxs-lookup"><span data-stu-id="05c96-134">**[System.Data.SqlClient](http://msdn.microsoft.com/library/System.Data.SqlClient.aspx)** classes and methods.</span></span>

<span data-ttu-id="05c96-135">Administrar particiones con hello [biblioteca de cliente de base de datos elástica](sql-database-elastic-database-client-library.md).</span><span class="sxs-lookup"><span data-stu-id="05c96-135">Manage shards using hello [Elastic Database client library](sql-database-elastic-database-client-library.md).</span></span> <span data-ttu-id="05c96-136">Incluye un espacio de nombres denominado [Microsoft.Azure.SqlDatabase.ElasticScale.Query](https://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.aspx) que proporciona Hola capacidad tooquery varias particiones con una sola consulta y resultado.</span><span class="sxs-lookup"><span data-stu-id="05c96-136">Includes a  namespace called [Microsoft.Azure.SqlDatabase.ElasticScale.Query](https://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.aspx) that provides hello ability tooquery multiple shards using a single query and result.</span></span> <span data-ttu-id="05c96-137">Brinda una abstracción de consulta sobre una recopilación de particiones.</span><span class="sxs-lookup"><span data-stu-id="05c96-137">It provides a querying abstraction over a collection of shards.</span></span> <span data-ttu-id="05c96-138">También proporciona las directivas de ejecución alternativo, los resultados parciales en particular, toodeal con errores cuando las consultas en varias particiones.</span><span class="sxs-lookup"><span data-stu-id="05c96-138">It also provides alternative execution policies, in particular partial results, toodeal with failures when querying over many shards.</span></span>  


---
title: "las consultas de análisis de aaaRun ad-hoc a través de varias bases de datos SQL de Azure | Documentos de Microsoft"
description: "Ejecute las consultas de análisis ad hoc a través de varias bases de datos SQL en la aplicación de varios inquilinos de hello Wingtip SaaS."
keywords: tutorial de SQL Database
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/23/2017
ms.author: billgib; sstein
ms.openlocfilehash: 140cd51fdd03b5a548147282b51ceb0ad80c944d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="run-ad-hoc-analytics-queries-across-all-wingtip-saas-tenants"></a><span data-ttu-id="5756d-104">Ejecución de consultas de análisis ad hoc en todos los inquilinos SaaS de Wingtip</span><span class="sxs-lookup"><span data-stu-id="5756d-104">Run ad-hoc analytics queries across all Wingtip SaaS tenants</span></span>

<span data-ttu-id="5756d-105">En este tutorial, ejecutar consultas distribuidas en todo conjunto de bases de datos de inquilino de hello tooenable "ad-hoc" análisis.</span><span class="sxs-lookup"><span data-stu-id="5756d-105">In this tutorial, you run distributed queries across hello entire set of tenant databases tooenable ad-hoc analytics.</span></span> <span data-ttu-id="5756d-106">Consulta elástico es consultas tooenable usado distribuido, lo que requiere que se implementa una base de datos de análisis adicional (servidor de catálogo toohello).</span><span class="sxs-lookup"><span data-stu-id="5756d-106">Elastic Query is used tooenable distributed queries, which requires an additional analytics database is deployed (toohello catalog server).</span></span> <span data-ttu-id="5756d-107">Estas consultas pueden extraer información ocultos en hello cotidianas operacionales de datos de aplicación de SaaS Wingtip hello.</span><span class="sxs-lookup"><span data-stu-id="5756d-107">These queries can extract insights buried in hello day-to-day operational data of hello Wingtip SaaS app.</span></span>


<span data-ttu-id="5756d-108">En este tutorial, obtendrá información:</span><span class="sxs-lookup"><span data-stu-id="5756d-108">In this tutorial you learn:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="5756d-109">Acerca de las vistas globales de hello en cada base de datos, que permiten consultar eficaz entre los inquilinos</span><span class="sxs-lookup"><span data-stu-id="5756d-109">About hello global views in each database, that enable efficient querying across tenants</span></span>
> * <span data-ttu-id="5756d-110">¿Cómo toodeploy una base de datos de análisis ad hoc</span><span class="sxs-lookup"><span data-stu-id="5756d-110">How toodeploy an ad-hoc analytics database</span></span>
> * <span data-ttu-id="5756d-111">¿Cómo toorun consultas distribuidas en todas las bases de datos de inquilino</span><span class="sxs-lookup"><span data-stu-id="5756d-111">How toorun distributed queries across all tenant databases</span></span>



<span data-ttu-id="5756d-112">toocomplete se ha completado este tutorial, asegúrese de hello seguro después de requisitos previos:</span><span class="sxs-lookup"><span data-stu-id="5756d-112">toocomplete this tutorial, make sure hello following prerequisites are completed:</span></span>

* <span data-ttu-id="5756d-113">se implementa la aplicación de SaaS Wingtip Hello.</span><span class="sxs-lookup"><span data-stu-id="5756d-113">hello Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="5756d-114">vea toodeploy en menos de cinco minutos, [implementar y explorar la aplicación de SaaS Wingtip hello](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="5756d-114">toodeploy in less than five minutes, see [Deploy and explore hello Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="5756d-115">Azure PowerShell está instalado.</span><span class="sxs-lookup"><span data-stu-id="5756d-115">Azure PowerShell is installed.</span></span> <span data-ttu-id="5756d-116">Para más información, consulte [Introducción a Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps).</span><span class="sxs-lookup"><span data-stu-id="5756d-116">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>
* <span data-ttu-id="5756d-117">SQL Server Management Studio (SSMS) está instalado.</span><span class="sxs-lookup"><span data-stu-id="5756d-117">SQL Server Management Studio (SSMS) is installed.</span></span> <span data-ttu-id="5756d-118">toodownload e instale SSMS, vea [descargar SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms).</span><span class="sxs-lookup"><span data-stu-id="5756d-118">toodownload and install SSMS, see [Download SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms).</span></span>


## <a name="ad-hoc-analytics-pattern"></a><span data-ttu-id="5756d-119">Patrón de análisis ad hoc</span><span class="sxs-lookup"><span data-stu-id="5756d-119">Ad-hoc analytics pattern</span></span>

<span data-ttu-id="5756d-120">Una de las grandes oportunidades de hello con aplicaciones de SaaS es ingente cantidad de Hola de toouse de datos de inquilino que se almacenan de forma centralizada en la nube de Hola.</span><span class="sxs-lookup"><span data-stu-id="5756d-120">One of hello great opportunities with SaaS applications is toouse hello vast amount of tenant data stored centrally in hello cloud.</span></span> <span data-ttu-id="5756d-121">Utilice esta información sobre toogain los datos en la operación de Hola y el uso de la aplicación, los inquilinos, sus usuarios, las preferencias, comportamientos, etcetera. Esta información puede guiarle en el desarrollo de características, mejoras de facilidad de uso y otras inversiones en sus aplicaciones y servicios.</span><span class="sxs-lookup"><span data-stu-id="5756d-121">Use this data toogain insights into hello operation and usage of your application, your tenants, their users, preferences, behaviors, etc. These insights can guide feature development, usability improvements, and other investments in your apps and services.</span></span>

<span data-ttu-id="5756d-122">Es fácil obtener acceso a estos datos en una sola base de datos multiinquilino, pero no es tan fácil cuando se distribuyen a escala en miles de bases de datos.</span><span class="sxs-lookup"><span data-stu-id="5756d-122">Accessing this data in a single multi-tenant database is easy, but not so easy when distributed at scale across potentially thousands of databases.</span></span> <span data-ttu-id="5756d-123">Un enfoque es toouse [consulta elástico](sql-database-elastic-query-overview.md), lo que permite realizar consultas a través de un conjunto distribuido de bases de datos con el esquema común.</span><span class="sxs-lookup"><span data-stu-id="5756d-123">One approach is toouse [Elastic Query](sql-database-elastic-query-overview.md), which enables querying across a distributed set of databases with common schema.</span></span> <span data-ttu-id="5756d-124">Consulta flexible usa un único *head* base de datos en el que se definen las tablas externas que reflejado tablas o vistas en hello distribuyen las bases de datos (inquilino).</span><span class="sxs-lookup"><span data-stu-id="5756d-124">Elastic Query uses a single *head* database in which external tables are defined that mirror tables or views in hello distributed (tenant) databases.</span></span> <span data-ttu-id="5756d-125">Las consultas se envían toothis principal base de datos es tooproduce compilado un plan de consulta distribuida, con algunas partes de la consulta de hello Enviar hacia abajo en las bases de datos del inquilino de toohello según sea necesario.</span><span class="sxs-lookup"><span data-stu-id="5756d-125">Queries submitted toothis head database are compiled tooproduce a distributed query plan, with portions of hello query pushed down toohello tenant databases as needed.</span></span> <span data-ttu-id="5756d-126">Consulta flexible utiliza mapa de particiones de hello en ubicación hello tooprovide de base de datos de catálogo de Hola de bases de datos de inquilino de Hola.</span><span class="sxs-lookup"><span data-stu-id="5756d-126">Elastic Query uses hello shard map in hello catalog database tooprovide hello location of hello tenant databases.</span></span> <span data-ttu-id="5756d-127">La configuración y la consulta son sencillas y utilizan [Transact-SQL](https://docs.microsoft.com/sql/t-sql/language-reference) estándar; además, admiten consultas ad hoc desde herramientas como Power BI y Excel.</span><span class="sxs-lookup"><span data-stu-id="5756d-127">Setup and query are straightforward using standard [Transact-SQL](https://docs.microsoft.com/sql/t-sql/language-reference), and support ad-hoc querying from tools like Power BI and Excel.</span></span>

<span data-ttu-id="5756d-128">Al distribuir las consultas entre bases de datos de inquilino de hello, elástica consulta proporciona una visión inmediata en los datos de producción en vivo.</span><span class="sxs-lookup"><span data-stu-id="5756d-128">By distributing queries across hello tenant databases, Elastic Query provides immediate insight into live production data.</span></span> <span data-ttu-id="5756d-129">Sin embargo, cuando consulta elástico extrae datos de potencialmente muchas bases de datos, consultas latencia a veces puede ser superior de las consultas equivalentes envían única la base de datos de varios inquilinos tooa.</span><span class="sxs-lookup"><span data-stu-id="5756d-129">However, as Elastic Query pulls data from potentially many databases, query latency can sometimes be higher than for equivalent queries submitted tooa single multi-tenant database.</span></span> <span data-ttu-id="5756d-130">Se debe tener cuidado al diseñar consultas con datos de hello toominimize que se devuelven.</span><span class="sxs-lookup"><span data-stu-id="5756d-130">Care should be taken when designing queries toominimize hello data that is returned.</span></span> <span data-ttu-id="5756d-131">Consulta flexible es a menudo más apropiada para las consultas pequeñas cantidades de datos en tiempo real, como opuesto toobuilding utilizadas con frecuencia o las consultas de análisis complejos o informes.</span><span class="sxs-lookup"><span data-stu-id="5756d-131">Elastic Query is often best suited for querying small amounts of real-time data, as opposed toobuilding frequently used or complex analytics queries or reports.</span></span> <span data-ttu-id="5756d-132">Si las consultas no funcionan correctamente, examine hello [plan de ejecución](https://docs.microsoft.com/sql/relational-databases/performance/display-an-actual-execution-plan) toosee qué parte de la consulta de Hola se ha insertado hacia abajo de la base de datos remota toohello y se devuelve la cantidad de datos.</span><span class="sxs-lookup"><span data-stu-id="5756d-132">If queries don't perform well, look at hello [execution plan](https://docs.microsoft.com/sql/relational-databases/performance/display-an-actual-execution-plan) toosee what part of hello query has been pushed down toohello remote database and how much data is being returned.</span></span> <span data-ttu-id="5756d-133">Las consultas que requieren un procesamiento analítico complejo en algunos casos pueden ser mejor atendidas si se extraen los datos de inquilino en una base de datos dedicada o un almacenamiento de datos optimizado para las consultas de análisis.</span><span class="sxs-lookup"><span data-stu-id="5756d-133">Queries that require complex analytical processing may be better served in some cases by extracting tenant data into a dedicated database or data warehouse optimized for analytics queries.</span></span> <span data-ttu-id="5756d-134">Este patrón se explica en hello [tutorial de análisis de inquilino](sql-database-saas-tutorial-tenant-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="5756d-134">This pattern is explained in hello [tenant analytics tutorial](sql-database-saas-tutorial-tenant-analytics.md).</span></span> 

## <a name="get-hello-wingtip-application-scripts"></a><span data-ttu-id="5756d-135">Obtener scripts de la aplicación hello Wingtip</span><span class="sxs-lookup"><span data-stu-id="5756d-135">Get hello Wingtip application scripts</span></span>

<span data-ttu-id="5756d-136">Hello Wingtip SaaS scripts y código fuente de aplicación están disponibles en hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) repositorio de github.</span><span class="sxs-lookup"><span data-stu-id="5756d-136">hello Wingtip SaaS scripts and application source code are available in hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="5756d-137">[Pasos de secuencias de comandos de toodownload Hola Wingtip SaaS](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="5756d-137">[Steps toodownload hello Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>

## <a name="create-ticket-sales-data"></a><span data-ttu-id="5756d-138">Creación de datos de ventas de entradas</span><span class="sxs-lookup"><span data-stu-id="5756d-138">Create ticket sales data</span></span>

<span data-ttu-id="5756d-139">toorun consultas en un conjunto de datos más interesante, crear datos de ventas de vale ejecutando Hola vale generador.</span><span class="sxs-lookup"><span data-stu-id="5756d-139">toorun queries against a more interesting data set, create ticket sales data by running hello ticket-generator.</span></span>

1. <span data-ttu-id="5756d-140">Hola *PowerShell ISE*, abra Hola... \\Módulos de aprendizaje\\análisis operativos\\"ad hoc" análisis\\*AdhocAnalytics.ps1 demostración* de secuencias de comandos y establezca Hola siguientes valores:</span><span class="sxs-lookup"><span data-stu-id="5756d-140">In hello *PowerShell ISE*, open hello ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalytics.ps1* script and set hello following values:</span></span>
   * <span data-ttu-id="5756d-141">**$DemoScenario** = 1, **Purchase tickets for events at all venues** (comprar entradas para eventos de todas las ubicaciones).</span><span class="sxs-lookup"><span data-stu-id="5756d-141">**$DemoScenario** = 1, **Purchase tickets for events at all venues**.</span></span>
2. <span data-ttu-id="5756d-142">Presione **F5** para ejecutar el script de Hola y generar ventas de vale.</span><span class="sxs-lookup"><span data-stu-id="5756d-142">Press **F5** to run hello script and generate ticket sales.</span></span> <span data-ttu-id="5756d-143">Mientras se ejecuta el script de Hola, continúe con los pasos de hello en este tutorial.</span><span class="sxs-lookup"><span data-stu-id="5756d-143">While hello script is running, continue hello steps in this tutorial.</span></span> <span data-ttu-id="5756d-144">datos de vale de Hola se consultan en hello *ejecutar consultas distribuida ad hoc* sección, por lo que espere Hola vale generador toocomplete, si aún está en ejecución cuando se obtiene toothat ejercicio.</span><span class="sxs-lookup"><span data-stu-id="5756d-144">hello ticket data is queried in hello *Run ad-hoc distributed queries* section, so wait for hello ticket generator toocomplete if it's still running when you get toothat exercise.</span></span>

## <a name="explore-hello-global-views"></a><span data-ttu-id="5756d-145">Explorar vistas globales Hola</span><span class="sxs-lookup"><span data-stu-id="5756d-145">Explore hello global views</span></span>

<span data-ttu-id="5756d-146">Hola aplicación SaaS de Wingtip se basa en un modelo de inquilinos por base de datos, por lo que se define el esquema de base de datos de inquilino de Hola desde la perspectiva del inquilino único.</span><span class="sxs-lookup"><span data-stu-id="5756d-146">hello Wingtip SaaS application is built using a tenant-per-database model, so hello tenant database schema is defined from a single-tenant perspective.</span></span> <span data-ttu-id="5756d-147">Existe información específica del inquilino en una tabla, *Venue*, que siempre tiene una sola fila y, además, se ha diseñado como montón, sin clave principal.</span><span class="sxs-lookup"><span data-stu-id="5756d-147">Tenant-specific information exists in one table, *Venue*, which always has a single row, and is implemented as a heap, without a primary key.</span></span> <span data-ttu-id="5756d-148">No es necesario toobe relacionadas con otras tablas en el esquema de hello toohello *lugar* tabla, ya que en el uso normal, nunca hay alguna duda de qué datos de hello inquilino pertenecen.</span><span class="sxs-lookup"><span data-stu-id="5756d-148">Other tables in hello schema don't need toobe related toohello *Venue* table, because in normal use, there is never any doubt which tenant hello data belongs to.</span></span>

<span data-ttu-id="5756d-149">Sin embargo, al consultar a través de todas las bases de datos, es importante que elástico consulta puede tratar datos de hello como si forma parte de una base de datos lógica particionada por inquilino.</span><span class="sxs-lookup"><span data-stu-id="5756d-149">However, when querying across all databases, it's important that Elastic Query can treat hello data as if it is part of a single logical database sharded by tenant.</span></span> <span data-ttu-id="5756d-150">tooachieve esto, un conjunto de vistas 'globales' son la base de datos de inquilinos de toohello agregada que proyecte un Id. de inquilino en cada una de las tablas de Hola que se consultan globalmente.</span><span class="sxs-lookup"><span data-stu-id="5756d-150">tooachieve this, a set of 'global' views are added toohello tenant database that project a tenant id into each of hello tables that are queried globally.</span></span> <span data-ttu-id="5756d-151">Por ejemplo, hello *VenueEvents* vista agrega una calculada *VenueId* toohello columnas proyectan de hello *eventos* tabla.</span><span class="sxs-lookup"><span data-stu-id="5756d-151">For example, hello *VenueEvents* view adds a computed *VenueId* toohello columns projected from hello *Events* table.</span></span> <span data-ttu-id="5756d-152">Mediante la definición de tabla externa de hello en la base de datos principal de hello sobre *VenueEvents* (en lugar de hello subyacente *eventos* tabla), consulta flexible es capaz de toopush hacia abajo en función de las combinaciones *VenueId* para que se pueden ejecutar en paralelo en cada base de datos remoto (en lugar de en la base de datos principal de hello).</span><span class="sxs-lookup"><span data-stu-id="5756d-152">By defining hello external table in hello head database over *VenueEvents* (rather than hello underlying *Events* table), Elastic Query is able toopush down joins based on *VenueId* so they can be executed in parallel on each remote database (rather than on hello head database).</span></span> <span data-ttu-id="5756d-153">Esto reduce considerablemente Hola cantidad de datos que se devuelven, lo que da como resultado un aumento sustancial del rendimiento para muchas consultas.</span><span class="sxs-lookup"><span data-stu-id="5756d-153">This dramatically reduces hello amount of data that is returned, which results in a substantial increase in performance for many queries.</span></span> <span data-ttu-id="5756d-154">Estas vistas globales se han creado previamente en todas las bases de datos de inquilino (y en *basetenantdb*).</span><span class="sxs-lookup"><span data-stu-id="5756d-154">These global views have been pre-created in all tenant databases (and in *basetenantdb*).</span></span>

1. <span data-ttu-id="5756d-155">Abra SSMS y [conectar toohello tenants1 -&lt;usuario&gt; server](sql-database-wtp-overview.md#explore-database-schema-and-execute-sql-queries-using-ssms).</span><span class="sxs-lookup"><span data-stu-id="5756d-155">Open SSMS and [connect toohello tenants1-&lt;USER&gt; server](sql-database-wtp-overview.md#explore-database-schema-and-execute-sql-queries-using-ssms).</span></span>
2. <span data-ttu-id="5756d-156">Expanda **Bases de datos**, haga clic con el botón derecho en **contosoconcerthall** y seleccione **Nueva consulta**.</span><span class="sxs-lookup"><span data-stu-id="5756d-156">Expand **Databases**, right-click **contosoconcerthall**, and select **New Query**.</span></span>
3. <span data-ttu-id="5756d-157">Ejecute hello después de diferencia de hello tooexplore de consultas entre tablas de único inquilino de Hola y vistas globales hello:</span><span class="sxs-lookup"><span data-stu-id="5756d-157">Run hello following queries tooexplore hello difference between hello single-tenant tables and hello global views:</span></span>

   ```T-SQL
   -- hello base Venue table, that has no VenueId associated.
   SELECT * FROM Venue

   -- Notice hello plural name 'Venues'. This view projects a VenueId column.
   SELECT * FROM Venues

   -- hello base Events table, which has no VenueId column.
   SELECT * FROM Events

   -- This view projects hello VenueId retrieved from hello Venues table.
   SELECT * FROM VenueEvents
   ```

<span data-ttu-id="5756d-158">En estas vistas, Hola *VenueId* se calcula como un hash del nombre de la ubicación de hello, pero cualquier enfoque podría ser toointroduce usa un valor único.</span><span class="sxs-lookup"><span data-stu-id="5756d-158">In these views, hello *VenueId* is computed as a hash of hello Venue name, but any approach could be used toointroduce a unique value.</span></span> <span data-ttu-id="5756d-159">Este enfoque es similar toohello manera clave de inquilino de Hola se calcula para su uso en el catálogo de Hola.</span><span class="sxs-lookup"><span data-stu-id="5756d-159">This approach is similar toohello way hello tenant key is computed for use in hello catalog.</span></span>

<span data-ttu-id="5756d-160">definición de hello tooexamine de hello *recintos* vista:</span><span class="sxs-lookup"><span data-stu-id="5756d-160">tooexamine hello definition of hello *Venues* view:</span></span>

1. <span data-ttu-id="5756d-161">En **Explorador de objetos**, expanda **contosoconcerthall** > **Vistas**:</span><span class="sxs-lookup"><span data-stu-id="5756d-161">In **Object Explorer**, expand **contosoconcethall** > **Views**:</span></span>

   ![vistas](media/sql-database-saas-tutorial-adhoc-analytics/views.png)

2. <span data-ttu-id="5756d-163">Haga clic con el botón derecho en **dbo.Venues**.</span><span class="sxs-lookup"><span data-stu-id="5756d-163">Right-click **dbo.Venues**.</span></span>
3. <span data-ttu-id="5756d-164">Seleccione **Incluir vista como** > **CREATE To** > **Nueva ventana del Editor de consultas**.</span><span class="sxs-lookup"><span data-stu-id="5756d-164">Select **Script View as** > **CREATE To** > **New Query Editor Window**</span></span>

<span data-ttu-id="5756d-165">Script cualquiera de hello otro *lugar* vistas toosee cómo agregan hello *VenueId*.</span><span class="sxs-lookup"><span data-stu-id="5756d-165">Script any of hello other *Venue* views toosee how they add hello *VenueId*.</span></span>

## <a name="deploy-hello-database-used-for-ad-hoc-distributed-queries"></a><span data-ttu-id="5756d-166">Implementar base de datos de hello utilizada para consultas distribuida ad hoc</span><span class="sxs-lookup"><span data-stu-id="5756d-166">Deploy hello database used for ad-hoc distributed queries</span></span>

<span data-ttu-id="5756d-167">Este ejercicio implementa hello *adhocanalytics* base de datos.</span><span class="sxs-lookup"><span data-stu-id="5756d-167">This exercise deploys hello *adhocanalytics* database.</span></span> <span data-ttu-id="5756d-168">Se trata de hello base de datos principal que contendrá el esquema de hello usado para realizar consultas en varias bases de datos de todos los inquilinos.</span><span class="sxs-lookup"><span data-stu-id="5756d-168">This is hello head database that will contain hello schema used for querying across all tenant databases.</span></span> <span data-ttu-id="5756d-169">base de datos de Hello es toohello implementada existente de servidor de catálogo, que es el servidor de hello usado para todos los relacionados con la administración de bases de datos de aplicación de ejemplo de Hola.</span><span class="sxs-lookup"><span data-stu-id="5756d-169">hello database is deployed toohello existing catalog server, which is hello server used for all management-related databases in hello sample app.</span></span>

1. <span data-ttu-id="5756d-170">Abra... \\Módulos de aprendizaje\\análisis operativos\\"ad hoc" análisis\\*demostración AdhocAnalytics.ps1* en hello *PowerShell ISE* conjunto hello y valores siguientes:</span><span class="sxs-lookup"><span data-stu-id="5756d-170">Open ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalytics.ps1* in hello *PowerShell ISE* and set hello following values:</span></span>
   * <span data-ttu-id="5756d-171">**$DemoScenario** = 2, **Implementar una base de datos de análisis ad hoc**.</span><span class="sxs-lookup"><span data-stu-id="5756d-171">**$DemoScenario** = 2, **Deploy Ad-hoc analytics database**.</span></span>

2. <span data-ttu-id="5756d-172">Presione **F5** toorun Hola script y crear hello *adhocanalytics* base de datos.</span><span class="sxs-lookup"><span data-stu-id="5756d-172">Press **F5** toorun hello script and create hello *adhocanalytics* database.</span></span>

<span data-ttu-id="5756d-173">En la siguiente sección hello, Agregar base de datos de esquema toohello por lo que puede ser usado toorun distribuida consultas.</span><span class="sxs-lookup"><span data-stu-id="5756d-173">In hello next section, you add schema toohello database so it can be used toorun distributed queries.</span></span>

## <a name="configure-hello-database-for-running-distributed-queries"></a><span data-ttu-id="5756d-174">Configurar base de datos de Hola para ejecutar consultas distribuidas</span><span class="sxs-lookup"><span data-stu-id="5756d-174">Configure hello database for running distributed queries</span></span>

<span data-ttu-id="5756d-175">Este ejercicio agrega esquema (origen de datos externo de Hola y definiciones de tabla externa) toohello ad-hoc análisis base de datos que permite realizar consultas en varias bases de datos de todos los inquilinos.</span><span class="sxs-lookup"><span data-stu-id="5756d-175">This exercise adds schema (hello external data source and external table definitions) toohello ad-hoc analytics database that enables querying across all tenant databases.</span></span>

1. <span data-ttu-id="5756d-176">Abra SQL Server Management Studio y conéctese toohello creado en el paso anterior de Hola de base de datos de análisis ad hoc.</span><span class="sxs-lookup"><span data-stu-id="5756d-176">Open SQL Server Management Studio, and connect toohello Adhoc Analytics database you created in hello previous step.</span></span> <span data-ttu-id="5756d-177">nombre de Hola de base de datos de hello será adhocanalytics.</span><span class="sxs-lookup"><span data-stu-id="5756d-177">hello name of hello database will be adhocanalytics.</span></span>
2. <span data-ttu-id="5756d-178">Abra ...\Learning Modules\Operational Analytics\Adhoc Analytics\ *Initialize-AdhocAnalyticsDB.sql* en SSMS.</span><span class="sxs-lookup"><span data-stu-id="5756d-178">Open ...\Learning Modules\Operational Analytics\Adhoc Analytics\ *Initialize-AdhocAnalyticsDB.sql* in SSMS.</span></span>
3. <span data-ttu-id="5756d-179">Revisar la secuencia de comandos SQL de Hola y tenga en cuenta Hola siguiente:</span><span class="sxs-lookup"><span data-stu-id="5756d-179">Review hello SQL script and note hello following:</span></span>

   <span data-ttu-id="5756d-180">Consulta flexible utiliza una credencial de ámbito de base de datos tooaccess cada de bases de datos de inquilino de Hola.</span><span class="sxs-lookup"><span data-stu-id="5756d-180">Elastic Query uses a database-scoped credential tooaccess each of hello tenant databases.</span></span> <span data-ttu-id="5756d-181">Esta credencial debe toobe disponible en todas las bases de datos de Hola y normalmente se debe conceder los derechos mínimos de hello necesitan tooenable estas consultas ad hoc.</span><span class="sxs-lookup"><span data-stu-id="5756d-181">This credential needs toobe available in all hello databases and should normally be granted hello minimum rights required tooenable these ad-hoc queries.</span></span>

    ![crear credencial](media/sql-database-saas-tutorial-adhoc-analytics/create-credential.png)

   <span data-ttu-id="5756d-183">Hello origen de datos externo, que está había definido mapa de particiones de toouse Hola inquilino en la base de datos de catálogo de Hola.</span><span class="sxs-lookup"><span data-stu-id="5756d-183">hello external data source, that is defined toouse hello tenant shard map in hello catalog database.</span></span> <span data-ttu-id="5756d-184">Al utilizar esto como origen de datos externo de hello, las consultas son bases de datos de tooall distribuida registrados en el catálogo de hello cuando se ejecuta la consulta de Hola.</span><span class="sxs-lookup"><span data-stu-id="5756d-184">By using this as hello external data source, queries are distributed tooall databases registered in hello catalog when hello query is run.</span></span> <span data-ttu-id="5756d-185">Ya que los nombres de servidor son diferentes para cada implementación, este script de inicialización Obtiene la ubicación de Hola de base de datos de catálogo de hello mediante la recuperación de servidor actual de hello (@@servername) donde se ejecuta el script de Hola.</span><span class="sxs-lookup"><span data-stu-id="5756d-185">Because server names are different for each deployment, this initialization script gets hello location of hello catalog database by retrieving hello current server (@@servername) where hello script is executed.</span></span>

    ![crear origen de datos externos](media/sql-database-saas-tutorial-adhoc-analytics/create-external-data-source.png)

   <span data-ttu-id="5756d-187">Hola tablas externas que hacen referencia a vistas globales de Hola se describe en la sección anterior de Hola y definido con **distribución = SHARDED(VenueId)**.</span><span class="sxs-lookup"><span data-stu-id="5756d-187">hello external tables that reference hello global views described in hello previous section, and defined with **DISTRIBUTION = SHARDED(VenueId)**.</span></span> <span data-ttu-id="5756d-188">Dado que cada *VenueId* tooa única base de datos se asigna Esto mejora el rendimiento para muchos escenarios como se muestra en la siguiente sección de Hola.</span><span class="sxs-lookup"><span data-stu-id="5756d-188">Because each *VenueId* maps tooa single database, this improves performance for many scenarios as shown in hello next section.</span></span>

    ![crear tablas externas](media/sql-database-saas-tutorial-adhoc-analytics/external-tables.png)

   <span data-ttu-id="5756d-190">tabla local Hello *VenueTypes* que se crean y rellenan.</span><span class="sxs-lookup"><span data-stu-id="5756d-190">hello local table *VenueTypes* that is created and populated.</span></span> <span data-ttu-id="5756d-191">Esta tabla de datos de referencia es común en todas las bases de datos de inquilino, por lo que se puede representar como una tabla local y rellena con datos comunes de Hola.</span><span class="sxs-lookup"><span data-stu-id="5756d-191">This reference data table is common in all tenant databases, so it can be represented here as a local table and populated with hello common data.</span></span> <span data-ttu-id="5756d-192">Para algunas consultas que esto puede reducir Hola cantidad de datos movidos entre las bases de datos del inquilino de Hola y Hola *adhocanalytics* base de datos.</span><span class="sxs-lookup"><span data-stu-id="5756d-192">For some queries this may reduce hello amount of data moved between hello tenant databases and hello *adhocanalytics* database.</span></span>

    ![crear tabla](media/sql-database-saas-tutorial-adhoc-analytics/create-table.png)

   <span data-ttu-id="5756d-194">Si incluye tablas de referencia de esta manera, ser datos y el esquema de tabla de hello tooupdate seguro cada vez que actualice las bases de datos del inquilino de Hola.</span><span class="sxs-lookup"><span data-stu-id="5756d-194">If you include reference tables in this manner, be sure tooupdate hello table schema and data whenever you update hello tenant databases.</span></span>

4. <span data-ttu-id="5756d-195">Presione **F5** toorun Hola script e inicializar hello *adhocanalytics* base de datos.</span><span class="sxs-lookup"><span data-stu-id="5756d-195">Press **F5** toorun hello script and initialize hello *adhocanalytics* database.</span></span> 

<span data-ttu-id="5756d-196">Ahora puede ejecutar consultas distribuidas y recopilar información de todos los inquilinos.</span><span class="sxs-lookup"><span data-stu-id="5756d-196">Now you can run distributed queries, and gather insights across all tenants!</span></span>

## <a name="run-ad-hoc-distributed-queries"></a><span data-ttu-id="5756d-197">Ejecución de consultas distribuidas ad hoc</span><span class="sxs-lookup"><span data-stu-id="5756d-197">Run ad-hoc distributed queries</span></span>

<span data-ttu-id="5756d-198">Ahora que hello *adhocanalytics* base de datos está configurado, siga adelante y ejecute algunas consultas distribuidas.</span><span class="sxs-lookup"><span data-stu-id="5756d-198">Now that hello *adhocanalytics* database is set up, go ahead and run some distributed queries.</span></span> <span data-ttu-id="5756d-199">Incluir plan de ejecución de Hola para una mejor comprensión de donde sucede el procesamiento de consultas de Hola.</span><span class="sxs-lookup"><span data-stu-id="5756d-199">Include hello execution plan for a better understanding of where hello query processing is happening.</span></span> 

<span data-ttu-id="5756d-200">Al inspeccionar el plan de ejecución de hello, mantenga el mouse sobre los iconos del plan de Hola para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="5756d-200">When inspecting hello execution plan, hover over hello plan icons for details.</span></span> 

<span data-ttu-id="5756d-201">Toonote importante, es esa configuración **distribución = SHARDED(VenueId)** cuando se define el origen de datos externo de hello, mejora el rendimiento en muchos escenarios.</span><span class="sxs-lookup"><span data-stu-id="5756d-201">Important toonote, is that setting **DISTRIBUTION = SHARDED(VenueId)** when we defined hello external data source, improves performance for many scenarios.</span></span> <span data-ttu-id="5756d-202">Dado que cada *VenueId* asigna tooa única base de datos filtrado es datos fácilmente done remotamente, devolver Hola solo es necesario.</span><span class="sxs-lookup"><span data-stu-id="5756d-202">Because each *VenueId* maps tooa single database, filtering is easily done remotely, returning only hello data we need.</span></span>

1. <span data-ttu-id="5756d-203">Abra ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalyticsQueries.sql* en SSMS.</span><span class="sxs-lookup"><span data-stu-id="5756d-203">Open ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalyticsQueries.sql* in SSMS.</span></span>
2. <span data-ttu-id="5756d-204">Asegúrese de que está conectado toohello **adhocanalytics** base de datos.</span><span class="sxs-lookup"><span data-stu-id="5756d-204">Ensure you are connected toohello **adhocanalytics** database.</span></span>
3. <span data-ttu-id="5756d-205">Seleccione hello **consulta** menú y haga clic en **incluir Plan de ejecución real**</span><span class="sxs-lookup"><span data-stu-id="5756d-205">Select hello **Query** menu and click **Include Actual Execution Plan**</span></span>
4. <span data-ttu-id="5756d-206">Resaltar hello *qué lugares están registrados actualmente?* consulta y presione **F5**.</span><span class="sxs-lookup"><span data-stu-id="5756d-206">Highlight hello *Which venues are currently registered?* query, and press **F5**.</span></span>

   <span data-ttu-id="5756d-207">consulta Hola devuelve la lista de todo lugar de hello, que ilustra cómo rápido y fácil que es tooquery a través de todos los inquilinos y los datos devueltos desde cada inquilino.</span><span class="sxs-lookup"><span data-stu-id="5756d-207">hello query returns hello entire venue list, illustrating how quick and easy it is tooquery across all tenants and return data from each tenant.</span></span>

   <span data-ttu-id="5756d-208">Inspeccionar el plan de Hola y que coste íntegro de hello es consultas remotas Hola porque estamos simplemente base de datos de curso tooeach inquilinos y seleccionando información de ubicación de Hola.</span><span class="sxs-lookup"><span data-stu-id="5756d-208">Inspect hello plan and see that hello entire cost is hello remote query because we're simply going tooeach tenant database and selecting hello venue information.</span></span>

   ![SELECT * FROM dbo.Venues](media/sql-database-saas-tutorial-adhoc-analytics/query1-plan.png)

5. <span data-ttu-id="5756d-210">Consulta de hello seleccione siguiente y presione **F5**.</span><span class="sxs-lookup"><span data-stu-id="5756d-210">Select hello next query, and press **F5**.</span></span>

   <span data-ttu-id="5756d-211">Esta consulta combina datos de las bases de datos del inquilino de Hola y Hola local *VenueTypes* tabla (local, ya que es una tabla de hello *adhocanalytics* base de datos).</span><span class="sxs-lookup"><span data-stu-id="5756d-211">This query joins data from hello tenant databases and hello local *VenueTypes* table (local, as its a table in hello *adhocanalytics* database).</span></span>

   <span data-ttu-id="5756d-212">Inspeccionar el plan de Hola y ver ese Hola mayoría del costo es consultas remotas Hola ya que se consulta la información de ubicación de cada inquilino (dbo. Recintos), y, a continuación, realice una combinación rápida local con hello locales *VenueTypes* nombre descriptivo de tabla toodisplay Hola.</span><span class="sxs-lookup"><span data-stu-id="5756d-212">Inspect hello plan and see that hello majority of cost is hello remote query because we query each tenant's venue info (dbo.Venues), and then do a quick local join with hello local *VenueTypes* table toodisplay hello friendly name.</span></span>

   ![Combinación de datos remotos y locales](media/sql-database-saas-tutorial-adhoc-analytics/query2-plan.png)

6. <span data-ttu-id="5756d-214">Ahora seleccione hello *día en que fueron Hola mayoría vales vendidos?* consulta y presione **F5**.</span><span class="sxs-lookup"><span data-stu-id="5756d-214">Now select hello *On which day were hello most tickets sold?* query, and press **F5**.</span></span>

   <span data-ttu-id="5756d-215">Esta consulta hace una combinación y una agregación un poco más complejas.</span><span class="sxs-lookup"><span data-stu-id="5756d-215">This query does a bit more complex joining and aggregation.</span></span> <span data-ttu-id="5756d-216">¿Qué es toonote importante es que remotamente realiza la mayor parte del procesamiento de hello y, una vez más, se devolver solo las filas Hola de que necesitemos, devolver una única fila con el número de venta del cada lugar vale agregado por día.</span><span class="sxs-lookup"><span data-stu-id="5756d-216">What's important toonote is that most of hello processing is done remotely, and once again, we bring back only hello rows we need, returning just a single row for each venue's aggregate ticket sale count per day.</span></span>

   ![query](media/sql-database-saas-tutorial-adhoc-analytics/query3-plan.png)


## <a name="next-steps"></a><span data-ttu-id="5756d-218">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="5756d-218">Next steps</span></span>

<span data-ttu-id="5756d-219">En este tutorial, ha aprendido cómo:</span><span class="sxs-lookup"><span data-stu-id="5756d-219">In this tutorial you learned how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="5756d-220">Ejecutar consultas distribuidas en todas las bases de datos de inquilinos</span><span class="sxs-lookup"><span data-stu-id="5756d-220">Run distributed queries across all tenant databases</span></span>
> * <span data-ttu-id="5756d-221">Implementar una base de datos de análisis ad hoc y agregar consultas de esquema tooit toorun distribuida.</span><span class="sxs-lookup"><span data-stu-id="5756d-221">Deploy an ad-hoc analytics database and add schema tooit toorun distributed queries.</span></span>


<span data-ttu-id="5756d-222">Ahora, intente hello [tutorial de análisis de inquilino](sql-database-saas-tutorial-tenant-analytics.md) tooexplore tooa independiente análisis de datos para el procesamiento de análisis más complejo de extracción...</span><span class="sxs-lookup"><span data-stu-id="5756d-222">Now try hello [Tenant Analytics tutorial](sql-database-saas-tutorial-tenant-analytics.md) tooexplore extracting data tooa separate analytics database for more complex analytics processing...</span></span>

## <a name="additional-resources"></a><span data-ttu-id="5756d-223">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="5756d-223">Additional resources</span></span>

* <span data-ttu-id="5756d-224">Adicionales [tutoriales que parten Hola aplicación Wingtip SaaS](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="5756d-224">Additional [tutorials that build upon hello Wingtip SaaS application](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="5756d-225">Consulta elástica</span><span class="sxs-lookup"><span data-stu-id="5756d-225">Elastic Query</span></span>](sql-database-elastic-query-overview.md)

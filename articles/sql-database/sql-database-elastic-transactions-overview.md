---
title: "Introducción sobre las transacciones de base de datos elástica con Base de datos SQL de Azure"
description: "Introducción sobre las transacciones de base de datos elástica con Base de datos SQL de Azure"
services: sql-database
documentationcenter: 
author: torsteng
manager: jhubbard
editor: torsteng
ms.assetid: e14df7a3-7788-4cfb-bcd1-7ad6433ef1f9
ms.service: sql-database
ms.custom: scale out apps
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: sql-database
ms.date: 05/27/2016
ms.author: torsteng
ms.openlocfilehash: f7f1ad3f1933b39a0030a784cae40521254037d6
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="distributed-transactions-across-cloud-databases"></a><span data-ttu-id="0a91d-103">Introducción sobre las transacciones de base de datos elástica con Base de datos SQL de Azure</span><span class="sxs-lookup"><span data-stu-id="0a91d-103">Distributed transactions across cloud databases</span></span>
<span data-ttu-id="0a91d-104">Las transacciones de base de datos elástica para Base de datos SQL de Azure le permiten ejecutar transacciones que abarcan varias bases de datos de Base de datos SQL.</span><span class="sxs-lookup"><span data-stu-id="0a91d-104">Elastic database transactions for Azure SQL Database (SQL DB) allow you to run transactions that span several databases in SQL DB.</span></span> <span data-ttu-id="0a91d-105">Están disponibles para aplicaciones .NET mediante ADO .NET y se integran con la conocida experiencia de programación en la que se hace uso de las clases [System.Transaction](https://msdn.microsoft.com/library/system.transactions.aspx) .</span><span class="sxs-lookup"><span data-stu-id="0a91d-105">Elastic database transactions for SQL DB are available for .NET applications using ADO .NET and integrate with the familiar programming experience using the [System.Transaction](https://msdn.microsoft.com/library/system.transactions.aspx) classes.</span></span> <span data-ttu-id="0a91d-106">Para obtener la biblioteca, vea [.NET Framework 4.6.1 (instalador web)](https://www.microsoft.com/download/details.aspx?id=49981).</span><span class="sxs-lookup"><span data-stu-id="0a91d-106">To get the library, see [.NET Framework 4.6.1 (Web Installer)](https://www.microsoft.com/download/details.aspx?id=49981).</span></span>

<span data-ttu-id="0a91d-107">De forma local, este escenario requiere normalmente la ejecución del Coordinador de transacciones distribuidas de Microsoft (MSDTC).</span><span class="sxs-lookup"><span data-stu-id="0a91d-107">On premises, such a scenario usually required running Microsoft Distributed Transaction Coordinator (MSDTC).</span></span> <span data-ttu-id="0a91d-108">Puesto que MSDTC no está disponible en Azure para aplicaciones de plataforma como servicio, la posibilidad de coordinar transacciones distribuidas ahora se integra directamente en Base de datos SQL.</span><span class="sxs-lookup"><span data-stu-id="0a91d-108">Since MSDTC is not available for Platform-as-a-Service application in Azure, the ability to coordinate distributed transactions has now been directly integrated into SQL DB.</span></span> <span data-ttu-id="0a91d-109">Las aplicaciones pueden conectarse a cualquier base de datos SQL para iniciar transacciones distribuidas, y una de las bases de datos coordinará de forma transparente la transacción distribuida, como se muestra en la ilustración siguiente.</span><span class="sxs-lookup"><span data-stu-id="0a91d-109">Applications can connect to any SQL Database to launch distributed transactions, and one of the databases will transparently coordinate the distributed transaction, as shown in the following figure.</span></span> 

  ![<span data-ttu-id="0a91d-110">Transacciones distribuidas con Base de datos SQL de Azure mediante transacciones de base de datos elástica</span><span class="sxs-lookup"><span data-stu-id="0a91d-110">Distributed transactions with Azure SQL Database using elastic database transactions</span></span> ][1]

## <a name="common-scenarios"></a><span data-ttu-id="0a91d-111">Escenarios comunes</span><span class="sxs-lookup"><span data-stu-id="0a91d-111">Common scenarios</span></span>
<span data-ttu-id="0a91d-112">Las transacciones de base de datos elástica para Base de datos SQL permiten a las aplicaciones realizar cambios atómicos en los datos almacenados en varias bases de datos SQL diferentes.</span><span class="sxs-lookup"><span data-stu-id="0a91d-112">Elastic database transactions for SQL DB enable applications to make atomic changes to data stored in several different SQL Databases.</span></span> <span data-ttu-id="0a91d-113">La versión preliminar se centra en las experiencias de desarrollo del lado cliente en C# y. NET.</span><span class="sxs-lookup"><span data-stu-id="0a91d-113">The preview focuses on client-side development experiences in C# and .NET.</span></span> <span data-ttu-id="0a91d-114">Para más adelante está prevista una experiencia en el lado servidor mediante T-SQL.</span><span class="sxs-lookup"><span data-stu-id="0a91d-114">A server-side experience using T-SQL is planned for a later time.</span></span>  
<span data-ttu-id="0a91d-115">Las transacciones de base de datos elástica están orientadas a los siguientes escenarios:</span><span class="sxs-lookup"><span data-stu-id="0a91d-115">Elastic database transactions targets the following scenarios:</span></span>

* <span data-ttu-id="0a91d-116">Aplicaciones de varias bases de datos en Azure: con este escenario, los datos se particionan verticalmente entre varias bases de datos de Base de datos SQL de forma que diferentes clases de datos residen en diferentes bases de datos.</span><span class="sxs-lookup"><span data-stu-id="0a91d-116">Multi-database applications in Azure: With this scenario, data is vertically partitioned across several databases in SQL DB such that different kinds of data reside on different databases.</span></span> <span data-ttu-id="0a91d-117">Algunas operaciones requieren cambios en los datos que se mantienen en dos o más bases de datos.</span><span class="sxs-lookup"><span data-stu-id="0a91d-117">Some operations require changes to data which is kept in two or more databases.</span></span> <span data-ttu-id="0a91d-118">La aplicación emplea transacciones de base de datos elástica para coordinar los cambios entre las bases de datos y garantizar la atomicidad.</span><span class="sxs-lookup"><span data-stu-id="0a91d-118">The application uses elastic database transactions to coordinate the changes across databases and ensure atomicity.</span></span>
* <span data-ttu-id="0a91d-119">Aplicaciones de base de datos particionada en Azure: con este escenario, la capa de datos usa la [biblioteca de cliente de base de datos elástica](sql-database-elastic-database-client-library.md) o el particionamiento automático para particionar horizontalmente los datos entre muchas bases de datos en Base de datos SQL.</span><span class="sxs-lookup"><span data-stu-id="0a91d-119">Sharded database applications in Azure: With this scenario, the data tier uses the [Elastic Database client library](sql-database-elastic-database-client-library.md) or self-sharding to horizontally partition the data across many databases in SQL DB.</span></span> <span data-ttu-id="0a91d-120">Un caso destacado de uso es cuando existe la necesidad de realizar cambios atómicos en una aplicación particionada multiempresa cuando los cambios abarcan a los inquilinos.</span><span class="sxs-lookup"><span data-stu-id="0a91d-120">One prominent use case is the need to perform atomic changes for a sharded multi-tenant application when changes span tenants.</span></span> <span data-ttu-id="0a91d-121">Piense por ejemplo en una transferencia desde un inquilino a otro, donde cada uno reside en una base de datos diferente.</span><span class="sxs-lookup"><span data-stu-id="0a91d-121">Think for instance of a transfer from one tenant to another, both residing on different databases.</span></span> <span data-ttu-id="0a91d-122">Un segundo caso es el particionamiento específico para satisfacer las necesidades de capacidad de un inquilino de gran tamaño, lo que a su vez supone normalmente que algunas operaciones atómicas deban extenderse entre varias bases de datos usadas para el mismo inquilino.</span><span class="sxs-lookup"><span data-stu-id="0a91d-122">A second case is fine-grained sharding to accommodate capacity needs for a large tenant which in turn typically implies that some atomic operations needs to stretch across several databases used for the same tenant.</span></span> <span data-ttu-id="0a91d-123">Un tercer caso es el de las actualizaciones atómicas para hacer referencia a los datos que se replican entre bases de datos.</span><span class="sxs-lookup"><span data-stu-id="0a91d-123">A third case is atomic updates to reference data that are replicated across databases.</span></span> <span data-ttu-id="0a91d-124">Ahora se pueden coordinar operaciones de transacciones atómicas a lo largo de estas líneas entre varias bases de datos mediante la versión preliminar.</span><span class="sxs-lookup"><span data-stu-id="0a91d-124">Atomic, transacted, operations along these lines can now be coordinated across several databases using the preview.</span></span>
  <span data-ttu-id="0a91d-125">Las transacciones de base de datos elástica usan una confirmación en dos fases para garantizar la atomicidad de las transacciones entre las bases de datos.</span><span class="sxs-lookup"><span data-stu-id="0a91d-125">Elastic database transactions use two-phase commit to ensure transaction atomicity across databases.</span></span> <span data-ttu-id="0a91d-126">Esto resulta adecuado para transacciones que suponen menos de 100 bases de datos a la vez en una única transacción.</span><span class="sxs-lookup"><span data-stu-id="0a91d-126">It is a good fit for transactions that involve less than 100 databases at a time within a single transaction.</span></span> <span data-ttu-id="0a91d-127">Aunque estos límites no se aplican, se supone que las tasas de rendimiento y éxito de las transacciones de base de datos elástica se verán afectadas cuando se excedan estos límites.</span><span class="sxs-lookup"><span data-stu-id="0a91d-127">These limits are not enforced, but one should expect performance and success rates for elastic database transactions to suffer when exceeding these limits.</span></span>

## <a name="installation-and-migration"></a><span data-ttu-id="0a91d-128">Instalación y migración</span><span class="sxs-lookup"><span data-stu-id="0a91d-128">Installation and migration</span></span>
<span data-ttu-id="0a91d-129">Las funcionalidades de las transacciones de base de datos elástica en Base de datos SQL se proporcionan a través de actualizaciones de las bibliotecas .NET System.Data.dll y System.Transactions.dll.</span><span class="sxs-lookup"><span data-stu-id="0a91d-129">The capabilities for elastic database transactions in SQL DB are provided through updates to the .NET libraries System.Data.dll and System.Transactions.dll.</span></span> <span data-ttu-id="0a91d-130">Los archivos DLL garantizan que la confirmación en dos fases se usa cuando es necesario para asegurar la atomicidad.</span><span class="sxs-lookup"><span data-stu-id="0a91d-130">The DLLs ensure that two-phase commit is used where necessary to ensure atomicity.</span></span> <span data-ttu-id="0a91d-131">Para empezar a desarrollar aplicaciones mediante transacciones de base de datos elástica, instale [.NET Framework 4.6.1](https://www.microsoft.com/download/details.aspx?id=49981) o versión posterior.</span><span class="sxs-lookup"><span data-stu-id="0a91d-131">To start developing applications using elastic database transactions, install [.NET Framework 4.6.1](https://www.microsoft.com/download/details.aspx?id=49981) or a later version.</span></span> <span data-ttu-id="0a91d-132">Cuando se ejecutan en una versión anterior de .NET Framework, las transacciones no podrán promoverse a una transacción distribuida y se producirá una excepción.</span><span class="sxs-lookup"><span data-stu-id="0a91d-132">When running on an earlier version of the .NET framework, transactions will fail to promote to a distributed transaction and an exception will be raised.</span></span>

<span data-ttu-id="0a91d-133">Tras la instalación, puede usar las API de transacciones distribuidas de System.Transactions con conexiones a Base de datos SQL.</span><span class="sxs-lookup"><span data-stu-id="0a91d-133">After installation, you can use the distributed transaction APIs in System.Transactions with connections to SQL DB.</span></span> <span data-ttu-id="0a91d-134">Si tiene aplicaciones de MSDTC existentes que usan estas API, basta con que las regenere para .NET 4.6 después de instalar 4.6.1 Framework.</span><span class="sxs-lookup"><span data-stu-id="0a91d-134">If you have existing MSDTC applications using these APIs, simply rebuild your existing applications for .NET 4.6 after installing the 4.6.1 Framework.</span></span> <span data-ttu-id="0a91d-135">Si los proyectos se destinan a .NET 4.6, usarán automáticamente los archivos DLL actualizados de la nueva versión de Framework, y las llamadas a API de transacciones distribuidas en combinación con las conexiones a Base de datos SQL ahora se realizarán correctamente.</span><span class="sxs-lookup"><span data-stu-id="0a91d-135">If your projects target .NET 4.6, they will automatically use the updated DLLs from the new Framework version and distributed transaction API calls in combination with connections to SQL DB will now succeed.</span></span>

<span data-ttu-id="0a91d-136">Recuerde que las transacciones de base de datos elástica no precisan la instalación de MSDTC.</span><span class="sxs-lookup"><span data-stu-id="0a91d-136">Remember that elastic database transactions do not require installing MSDTC.</span></span> <span data-ttu-id="0a91d-137">Por el contrario, se administran directamente mediante y dentro de Base de datos SQL.</span><span class="sxs-lookup"><span data-stu-id="0a91d-137">Instead, elastic database transactions are directly managed by and within SQL DB.</span></span> <span data-ttu-id="0a91d-138">Con ello se simplifican enormemente los escenarios de nube, ya que no es necesario implementar MSDTC para usar transacciones distribuidas con Base de datos SQL.</span><span class="sxs-lookup"><span data-stu-id="0a91d-138">This significantly simplifies cloud scenarios since a deployment of MSDTC is not necessary to use distributed transactions with SQL DB.</span></span> <span data-ttu-id="0a91d-139">En la sección 4 se explica con más detalle cómo implementar transacciones de base de datos elástica y  la versión de .NET Framework necesaria junto con sus aplicaciones de nube en Azure.</span><span class="sxs-lookup"><span data-stu-id="0a91d-139">Section 4 explains in more detail how to deploy elastic database transactions and the required .NET framework together with your cloud applications to Azure.</span></span>

## <a name="development-experience"></a><span data-ttu-id="0a91d-140">Experiencia de desarrollo</span><span class="sxs-lookup"><span data-stu-id="0a91d-140">Development experience</span></span>
### <a name="multi-database-applications"></a><span data-ttu-id="0a91d-141">Aplicaciones de varias bases de datos</span><span class="sxs-lookup"><span data-stu-id="0a91d-141">Multi-database applications</span></span>
<span data-ttu-id="0a91d-142">En el ejemplo de código siguiente se usa la experiencia de programación conocida con System.Transactions de .NET.</span><span class="sxs-lookup"><span data-stu-id="0a91d-142">The following sample code uses the familiar programming experience with .NET System.Transactions.</span></span> <span data-ttu-id="0a91d-143">La clase TransactionScope establece una transacción de ambiente en. NET.</span><span class="sxs-lookup"><span data-stu-id="0a91d-143">The TransactionScope class establishes an ambient transaction in .NET.</span></span> <span data-ttu-id="0a91d-144">(Una "transacción de ambiente" es aquella que reside en el subproceso actual). Todas las conexiones abiertas dentro de TransactionScope intervienen en la transacción.</span><span class="sxs-lookup"><span data-stu-id="0a91d-144">(An “ambient transaction” is one that lives in the current thread.) All connections opened within the TransactionScope participate in the transaction.</span></span> <span data-ttu-id="0a91d-145">Si intervienen bases de datos diferentes, la transacción se eleva automáticamente a transacción distribuida.</span><span class="sxs-lookup"><span data-stu-id="0a91d-145">If different databases participate, the transaction is automatically elevated to a distributed transaction.</span></span> <span data-ttu-id="0a91d-146">El resultado de la transacción se controla mediante la configuración del ámbito como completo para indicar una confirmación.</span><span class="sxs-lookup"><span data-stu-id="0a91d-146">The outcome of the transaction is controlled by setting the scope to complete to indicate a commit.</span></span>

    using (var scope = new TransactionScope())
    {
        using (var conn1 = new SqlConnection(connStrDb1))
        {
            conn1.Open();
            SqlCommand cmd1 = conn1.CreateCommand();
            cmd1.CommandText = string.Format("insert into T1 values(1)");
            cmd1.ExecuteNonQuery();
        }

        using (var conn2 = new SqlConnection(connStrDb2))
        {
            conn2.Open();
            var cmd2 = conn2.CreateCommand();
            cmd2.CommandText = string.Format("insert into T2 values(2)");
            cmd2.ExecuteNonQuery();
        }

        scope.Complete();
    }

### <a name="sharded-database-applications"></a><span data-ttu-id="0a91d-147">Aplicaciones de base de datos particionada</span><span class="sxs-lookup"><span data-stu-id="0a91d-147">Sharded database applications</span></span>
<span data-ttu-id="0a91d-148">Las transacciones de base de datos elástica para Base de datos SQL también admiten la coordinación de transacciones distribuidas en las que se usa el método OpenConnectionForKey de la biblioteca de cliente de base de datos elástica para abrir conexiones para una capa de datos escalada horizontalmente.</span><span class="sxs-lookup"><span data-stu-id="0a91d-148">Elastic database transactions for SQL DB also support coordinating distributed transactions where you use the OpenConnectionForKey method of the elastic database client library to open connections for a scaled out data tier.</span></span> <span data-ttu-id="0a91d-149">Tenga en cuenta los casos en lo que deba garantizar la coherencia de las transacciones para los cambios entre varios valores diferentes de clave de particionamiento.</span><span class="sxs-lookup"><span data-stu-id="0a91d-149">Consider cases where you need to guarantee transactional consistency for changes across several different sharding key values.</span></span> <span data-ttu-id="0a91d-150">Las conexiones a las particiones que hospedan los diferentes valores de clave de particionamiento se interrumpen mediante OpenConnectionForKey.</span><span class="sxs-lookup"><span data-stu-id="0a91d-150">Connections to the shards hosting the different sharding key values are brokered using OpenConnectionForKey.</span></span> <span data-ttu-id="0a91d-151">Por lo general, las conexiones pueden ser a particiones diferentes de forma que, para garantizar las transacciones, se necesita una transacción distribuida.</span><span class="sxs-lookup"><span data-stu-id="0a91d-151">In the general case, the connections can be to different shards such that ensuring transactional guarantees requires a distributed transaction.</span></span> <span data-ttu-id="0a91d-152">En el ejemplo de código siguiente se muestra este método.</span><span class="sxs-lookup"><span data-stu-id="0a91d-152">The following code sample illustrates this approach.</span></span> <span data-ttu-id="0a91d-153">Se supone que una variable llamada shardmap se usa para representar un mapa de particiones de la biblioteca de cliente de base de datos elástica:</span><span class="sxs-lookup"><span data-stu-id="0a91d-153">It assumes that a variable called shardmap is used to represent a shard map from the elastic database client library:</span></span>

    using (var scope = new TransactionScope())
    {
        using (var conn1 = shardmap.OpenConnectionForKey(tenantId1, credentialsStr))
        {
            conn1.Open();
            SqlCommand cmd1 = conn1.CreateCommand();
            cmd1.CommandText = string.Format("insert into T1 values(1)");
            cmd1.ExecuteNonQuery();
        }

        using (var conn2 = shardmap.OpenConnectionForKey(tenantId2, credentialsStr))
        {
            conn2.Open();
            var cmd2 = conn2.CreateCommand();
            cmd2.CommandText = string.Format("insert into T1 values(2)");
            cmd2.ExecuteNonQuery();
        }

        scope.Complete();
    }


## <a name="net-installation-for-azure-cloud-services"></a><span data-ttu-id="0a91d-154">Instalación de .NET para servicios en la nube de Azure</span><span class="sxs-lookup"><span data-stu-id="0a91d-154">.NET installation for Azure Cloud Services</span></span>
<span data-ttu-id="0a91d-155">Azure proporciona varias ofertas para hospedar aplicaciones. NET.</span><span class="sxs-lookup"><span data-stu-id="0a91d-155">Azure provides several offerings to host .NET applications.</span></span> <span data-ttu-id="0a91d-156">Hay disponible una comparación de las diferentes ofertas en [Comparación de Azure App Service, Cloud Services y Virtual Machines](../app-service-web/choose-web-site-cloud-service-vm.md).</span><span class="sxs-lookup"><span data-stu-id="0a91d-156">A comparison of the different offerings is available in [Azure App Service, Cloud Services, and Virtual Machines comparison](../app-service-web/choose-web-site-cloud-service-vm.md).</span></span> <span data-ttu-id="0a91d-157">Si el SO invitado de la oferta es inferior a .NET 4.6.1, que es el que se requiere para las transacciones elásticas, debe actualizar el SO invitado a 4.6.1.</span><span class="sxs-lookup"><span data-stu-id="0a91d-157">If the guest OS of the offering is smaller than .NET 4.6.1 required for elastic transactions, you need to upgrade the guest OS to 4.6.1.</span></span> 

<span data-ttu-id="0a91d-158">Para los Servicios de aplicaciones de Azure, no se admiten las actualizaciones del SO invitado en estos momentos.</span><span class="sxs-lookup"><span data-stu-id="0a91d-158">For Azure App Services, upgrades to the guest OS are currently not supported.</span></span> <span data-ttu-id="0a91d-159">En el caso de las máquinas virtuales de Azure, solo tiene que iniciar sesión en la máquina virtual y ejecutar el instalador para la última versión de .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="0a91d-159">For Azure Virtual Machines, simply log into the VM and run the installer for the latest .NET framework.</span></span> <span data-ttu-id="0a91d-160">Para los Servicios en la nube de Azure, hay que incluir la instalación de una versión más reciente de .NET en las tareas de inicio de la implementación.</span><span class="sxs-lookup"><span data-stu-id="0a91d-160">For Azure Cloud Services, you need to include the installation of a newer .NET version into the startup tasks of your deployment.</span></span> <span data-ttu-id="0a91d-161">Los conceptos y los pasos se documentan en [Instalación de .NET en un rol de servicio en la nube](../cloud-services/cloud-services-dotnet-install-dotnet.md).</span><span class="sxs-lookup"><span data-stu-id="0a91d-161">The concepts and steps are documented in [Install .NET on a Cloud Service Role](../cloud-services/cloud-services-dotnet-install-dotnet.md).</span></span>  

<span data-ttu-id="0a91d-162">Tenga en cuenta que el instalador de .NET 4.6.1 puede requerir más espacio de almacenamiento temporal durante el proceso de arranque en los Servicios en la nube de Azure que el instalador de .NET 4.6.</span><span class="sxs-lookup"><span data-stu-id="0a91d-162">Note that the installer for .NET 4.6.1 may require more temporary storage during the bootstrapping process on Azure cloud services than the installer for .NET 4.6.</span></span> <span data-ttu-id="0a91d-163">Para garantizar una instalación correcta, debe aumentar el almacenamiento temporal para el servicio en la nube de Azure en el archivo ServiceDefinition.csdef en la sección LocalResources y en la configuración del entorno de la tarea de inicio, como se muestra en el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="0a91d-163">To ensure a successful installation, you need to increase temporary storage for your Azure cloud service in your ServiceDefinition.csdef file in the LocalResources section and the environment settings of your startup task, as shown in the following sample:</span></span>

    <LocalResources>
    ...
        <LocalStorage name="TEMP" sizeInMB="5000" cleanOnRoleRecycle="false" />
        <LocalStorage name="TMP" sizeInMB="5000" cleanOnRoleRecycle="false" />
    </LocalResources>
    <Startup>
        <Task commandLine="install.cmd" executionContext="elevated" taskType="simple">
            <Environment>
        ...
                <Variable name="TEMP">
                    <RoleInstanceValue xpath="/RoleEnvironment/CurrentInstance/LocalResources/LocalResource[@name='TEMP']/@path" />
                </Variable>
                <Variable name="TMP">
                    <RoleInstanceValue xpath="/RoleEnvironment/CurrentInstance/LocalResources/LocalResource[@name='TMP']/@path" />
                </Variable>
            </Environment>
        </Task>
    </Startup>

## <a name="transactions-across-multiple-servers"></a><span data-ttu-id="0a91d-164">Transacciones entre varios servidores</span><span class="sxs-lookup"><span data-stu-id="0a91d-164">Transactions across multiple servers</span></span>
<span data-ttu-id="0a91d-165">Se admiten transacciones de la base de datos elástica entre diferentes servidores lógicos en Base de datos SQL de Azure.</span><span class="sxs-lookup"><span data-stu-id="0a91d-165">Elastic database transactions are supported across different logical servers in Azure SQL Database.</span></span> <span data-ttu-id="0a91d-166">Cuando las transacciones cruzan los límites del servidor lógico, los servidores implicados en primer lugar deben involucrarse en una relación de comunicación mutua.</span><span class="sxs-lookup"><span data-stu-id="0a91d-166">When transactions cross logical server boundaries, the participating servers first need to be entered into a mutual communication relationship.</span></span> <span data-ttu-id="0a91d-167">Una vez que se ha establecido la relación de comunicación, cualquier base de datos ubicada en uno de los dos servidores puede participar en transacciones elásticas con bases de datos desde el otro servidor.</span><span class="sxs-lookup"><span data-stu-id="0a91d-167">Once the communication relationship has been established, any database in any of the two servers can participate in elastic transactions with databases from the other server.</span></span> <span data-ttu-id="0a91d-168">En el caso de las transacciones distribuidas en más de dos servidores lógicos, debe existir una relación de comunicación para cualquier par de servidores lógicos.</span><span class="sxs-lookup"><span data-stu-id="0a91d-168">With transactions spanning more than two logical servers, a communication relationship needs to be in place for any pair of logical servers.</span></span>

<span data-ttu-id="0a91d-169">Use los siguientes cmdlets de PowerShell para administrar las relaciones de comunicación entre los servidores para las transacciones de la base de datos elástica:</span><span class="sxs-lookup"><span data-stu-id="0a91d-169">Use the following PowerShell cmdlets to manage cross-server communication relationships for elastic database transactions:</span></span>

* <span data-ttu-id="0a91d-170">**New-AzureRmSqlServerCommunicationLink**: Este cmdlet se usa para crear una nueva relación de comunicación entre dos servidores lógicos en Base de datos SQL de Azure.</span><span class="sxs-lookup"><span data-stu-id="0a91d-170">**New-AzureRmSqlServerCommunicationLink**: Use this cmdlet to create a new communication relationship between two logical servers in Azure SQL DB.</span></span> <span data-ttu-id="0a91d-171">La relación es simétrica, lo que significa que ambos servidores pueden iniciar transacciones con el otro servidor.</span><span class="sxs-lookup"><span data-stu-id="0a91d-171">The relationship is symmetric which means both servers can initiate transactions with the other server.</span></span>
* <span data-ttu-id="0a91d-172">**Get-AzureRmSqlServerCommunicationLink**: Este cmdlet se usa para recuperar una relación de comunicación existente y sus propiedades.</span><span class="sxs-lookup"><span data-stu-id="0a91d-172">**Get-AzureRmSqlServerCommunicationLink**: Use this cmdlet to retrieve existing communication relationships and their properties.</span></span>
* <span data-ttu-id="0a91d-173">**Remove-AzureRmSqlServerCommunicationLink**: Este cmdlet se usa para eliminar una relación de comunicación existente.</span><span class="sxs-lookup"><span data-stu-id="0a91d-173">**Remove-AzureRmSqlServerCommunicationLink**: Use this cmdlet to remove an existing communication relationship.</span></span> 

## <a name="monitoring-transaction-status"></a><span data-ttu-id="0a91d-174">Supervisión del estado de la transacción</span><span class="sxs-lookup"><span data-stu-id="0a91d-174">Monitoring transaction status</span></span>
<span data-ttu-id="0a91d-175">Use vistas de administración dinámica (DMV) en Base de datos SQL para supervisar el estado y el progreso de las transacciones en curso de base de datos elástica.</span><span class="sxs-lookup"><span data-stu-id="0a91d-175">Use Dynamic Management Views (DMVs) in SQL DB to monitor status and progress of your ongoing elastic database transactions.</span></span> <span data-ttu-id="0a91d-176">Todas las DMV relacionadas con las transacciones son pertinentes para las transacciones distribuidas en Base de datos SQL.</span><span class="sxs-lookup"><span data-stu-id="0a91d-176">All DMVs related to transactions are relevant for distributed transactions in SQL DB.</span></span> <span data-ttu-id="0a91d-177">Puede encontrar la lista correspondiente de DMV aquí: [Funciones y vistas de administración dinámica relacionadas con transacciones (Transact-SQL)](https://msdn.microsoft.com/library/ms178621.aspx).</span><span class="sxs-lookup"><span data-stu-id="0a91d-177">You can find the corresponding list of DMVs here: [Transaction Related Dynamic Management Views and Functions (Transact-SQL)](https://msdn.microsoft.com/library/ms178621.aspx).</span></span>

<span data-ttu-id="0a91d-178">Estas DMV son especialmente útiles:</span><span class="sxs-lookup"><span data-stu-id="0a91d-178">These DMVs are particularly useful:</span></span>

* <span data-ttu-id="0a91d-179">**sys.dm\_tran\_active\_transactions**: enumera las transacciones actualmente activas y su estado.</span><span class="sxs-lookup"><span data-stu-id="0a91d-179">**sys.dm\_tran\_active\_transactions**: Lists currently active transactions and their status.</span></span> <span data-ttu-id="0a91d-180">La columna UOW (unidad de trabajo) puede identificar las distintas transacciones secundarias que pertenecen a la misma transacción distribuida.</span><span class="sxs-lookup"><span data-stu-id="0a91d-180">The UOW (Unit Of Work) column can identify the different child transactions that belong to the same distributed transaction.</span></span> <span data-ttu-id="0a91d-181">Todas las transacciones de la misma transacción distribuida llevan el mismo valor de UOW.</span><span class="sxs-lookup"><span data-stu-id="0a91d-181">All transactions within the same distributed transaction carry the same UOW value.</span></span> <span data-ttu-id="0a91d-182">Consulte la [documentación de DMV](https://msdn.microsoft.com/library/ms174302.aspx) para obtener más detalles.</span><span class="sxs-lookup"><span data-stu-id="0a91d-182">See the [DMV documentation](https://msdn.microsoft.com/library/ms174302.aspx) for more details.</span></span>
* <span data-ttu-id="0a91d-183">**sys.dm\_tran\_database\_transactions**: proporciona información adicional sobre las transacciones, como la colocación de la transacción en el registro.</span><span class="sxs-lookup"><span data-stu-id="0a91d-183">**sys.dm\_tran\_database\_transactions**: Provides additional information about transactions, such as placement of the transaction in the log.</span></span> <span data-ttu-id="0a91d-184">Consulte la [documentación de DMV](https://msdn.microsoft.com/library/ms186957.aspx) para obtener más detalles.</span><span class="sxs-lookup"><span data-stu-id="0a91d-184">See the [DMV documentation](https://msdn.microsoft.com/library/ms186957.aspx) for more details.</span></span>
* <span data-ttu-id="0a91d-185">**sys.dm\_tran\_locks**: ofrece información sobre los bloqueos actuales de las transacciones.</span><span class="sxs-lookup"><span data-stu-id="0a91d-185">**sys.dm\_tran\_locks**: Provides information about the locks that are currently held by ongoing transactions.</span></span> <span data-ttu-id="0a91d-186">Consulte la [documentación de DMV](https://msdn.microsoft.com/library/ms190345.aspx) para obtener más detalles.</span><span class="sxs-lookup"><span data-stu-id="0a91d-186">See the [DMV documentation](https://msdn.microsoft.com/library/ms190345.aspx) for more details.</span></span>

## <a name="limitations"></a><span data-ttu-id="0a91d-187">Limitaciones</span><span class="sxs-lookup"><span data-stu-id="0a91d-187">Limitations</span></span>
<span data-ttu-id="0a91d-188">Las siguientes limitaciones se aplican actualmente a transacciones de base de datos elástica en Base de datos SQL:</span><span class="sxs-lookup"><span data-stu-id="0a91d-188">The following limitations currently apply to elastic database transactions in SQL DB:</span></span>

* <span data-ttu-id="0a91d-189">Se admiten únicamente transacciones entre bases de datos en Base de datos SQL.</span><span class="sxs-lookup"><span data-stu-id="0a91d-189">Only transactions across databases in SQL DB are supported.</span></span> <span data-ttu-id="0a91d-190">Otros proveedores de recursos y bases de datos de [X/Open XA](https://en.wikipedia.org/wiki/X/Open_XA) externos a Base de datos SQL no podrán participar en transacciones de base de datos elástica.</span><span class="sxs-lookup"><span data-stu-id="0a91d-190">Other [X/Open XA](https://en.wikipedia.org/wiki/X/Open_XA) resource providers and databases outside of SQL DB cannot participate in elastic database transactions.</span></span> <span data-ttu-id="0a91d-191">Esto significa que dichas transacciones no pueden extenderse entre bases de datos locales de SQL Server y SQL de Azure.</span><span class="sxs-lookup"><span data-stu-id="0a91d-191">That means that elastic database transactions cannot stretch across on premises SQL Server and Azure SQL Databases.</span></span> <span data-ttu-id="0a91d-192">Para las transacciones distribuidas en el entorno local, siga usando MSDTC.</span><span class="sxs-lookup"><span data-stu-id="0a91d-192">For distributed transactions on premises, continue to use MSDTC.</span></span> 
* <span data-ttu-id="0a91d-193">Solo se admiten transacciones coordinadas por el cliente desde una aplicación .NET.</span><span class="sxs-lookup"><span data-stu-id="0a91d-193">Only client-coordinated transactions from a .NET application are supported.</span></span> <span data-ttu-id="0a91d-194">Está prevista la compatibilidad en el lado servidor con T-SQL, por ejemplo, INICIAR TRANSACCIÓN DISTRIBUIDA, pero aún no se encuentra disponible.</span><span class="sxs-lookup"><span data-stu-id="0a91d-194">Server-side support for T-SQL such as BEGIN DISTRIBUTED TRANSACTION is planned, but not yet available.</span></span> 
* <span data-ttu-id="0a91d-195">No se admiten las transacciones por los servicios de WCF.</span><span class="sxs-lookup"><span data-stu-id="0a91d-195">Transactions across WCF services are not supported.</span></span> <span data-ttu-id="0a91d-196">Por ejemplo, tiene un método de servicio de WCF que se ejecuta una transacción.</span><span class="sxs-lookup"><span data-stu-id="0a91d-196">For example, you have a WCF service method that executes a transaction.</span></span> <span data-ttu-id="0a91d-197">Si se encierra la llamada dentro de un ámbito de transacción, se producirá un error como [System.ServiceModel.ProtocolException](https://msdn.microsoft.com/library/system.servicemodel.protocolexception).</span><span class="sxs-lookup"><span data-stu-id="0a91d-197">Enclosing the call within a transaction scope will fail as a [System.ServiceModel.ProtocolException](https://msdn.microsoft.com/library/system.servicemodel.protocolexception).</span></span>

## <a name="next-steps"></a><span data-ttu-id="0a91d-198">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="0a91d-198">Next steps</span></span>
<span data-ttu-id="0a91d-199">Si tiene alguna pregunta, póngase en contacto con nosotros en el [foro de SQL Database](http://social.msdn.microsoft.com/forums/azure/home?forum=ssdsgetstarted). Para efectuar solicitudes de características, agréguelas en el [foro de comentarios sobre SQL Database](https://feedback.azure.com/forums/217321-sql-database/).</span><span class="sxs-lookup"><span data-stu-id="0a91d-199">For questions, please reach out to us on the [SQL Database forum](http://social.msdn.microsoft.com/forums/azure/home?forum=ssdsgetstarted) and for feature requests, please add them to the [SQL Database feedback forum](https://feedback.azure.com/forums/217321-sql-database/).</span></span>

<!--Image references-->
[1]: ./media/sql-database-elastic-transactions-overview/distributed-transactions.png




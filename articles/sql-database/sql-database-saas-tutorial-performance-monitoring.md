---
title: "Supervisión del rendimiento de muchas bases de datos SQL de Azure en una aplicación SaaS multiinquilino | Microsoft Docs"
description: "Supervisión y administración de bases de datos y grupos en la aplicación SaaS de Wingtip de Azure SQL Database"
keywords: tutorial de base de datos sql
services: sql-database
documentationcenter: 
author: stevestein
manager: craigg
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/26/2017
ms.author: sstein
ms.openlocfilehash: 42f727aa40e744916b1a8adf634c10d55880bef0
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/03/2017
---
# <a name="monitor-performance-of-the-wingtip-saas-application"></a><span data-ttu-id="1ab74-104">Supervisión del rendimiento de la aplicación SaaS de Wingtip</span><span class="sxs-lookup"><span data-stu-id="1ab74-104">Monitor performance of the Wingtip SaaS application</span></span>

<span data-ttu-id="1ab74-105">En este tutorial se describen varios escenarios clave de administración de rendimiento que se usan en aplicaciones de SaaS.</span><span class="sxs-lookup"><span data-stu-id="1ab74-105">In this tutorial, several key performance management scenarios used in SaaS applications are explored.</span></span> <span data-ttu-id="1ab74-106">Mediante un generador de carga para simular la actividad en todas las bases de datos de inquilino, se demuestran las características integradas de supervisión y alertas de SQL Database y los grupos elásticos.</span><span class="sxs-lookup"><span data-stu-id="1ab74-106">Using a load generator to simulate activity across all tenant databases, the built-in monitoring and alerting features of SQL Database and elastic pools are demonstrated.</span></span>

<span data-ttu-id="1ab74-107">La aplicación SaaS de Wingtip utiliza un modelo de datos de inquilino único, donde cada lugar (inquilino) tiene su propia base de datos.</span><span class="sxs-lookup"><span data-stu-id="1ab74-107">The Wingtip SaaS app uses a single-tenant data model, where each venue (tenant) has their own database.</span></span> <span data-ttu-id="1ab74-108">Al igual que en muchas aplicaciones SaaS, el patrón de carga de trabajo de inquilino previsto es imprevisible y esporádico.</span><span class="sxs-lookup"><span data-stu-id="1ab74-108">Like many SaaS applications, the anticipated tenant workload pattern is unpredictable and sporadic.</span></span> <span data-ttu-id="1ab74-109">En otras palabras, las ventas de entradas pueden producirse en cualquier momento.</span><span class="sxs-lookup"><span data-stu-id="1ab74-109">In other words, ticket sales may occur at any time.</span></span> <span data-ttu-id="1ab74-110">Para aprovechar las ventajas de este patrón de uso típico de base de datos, las bases de datos de inquilinos se implementan en grupos de bases de datos elásticas.</span><span class="sxs-lookup"><span data-stu-id="1ab74-110">To take advantage of this typical database usage pattern, tenant databases are deployed into elastic database pools.</span></span> <span data-ttu-id="1ab74-111">Los grupos elásticos optimizan el costo de las soluciones mediante el uso compartido de los recursos entre distintas bases de datos.</span><span class="sxs-lookup"><span data-stu-id="1ab74-111">Elastic pools optimize the cost of a solution by sharing resources across many databases.</span></span> <span data-ttu-id="1ab74-112">Con este tipo de patrón, es importante supervisar la base de datos y el uso de los recursos del grupo para asegurarse de que las cargas están razonablemente repartidas entre los grupos.</span><span class="sxs-lookup"><span data-stu-id="1ab74-112">With this type of pattern, it's important to monitor database and pool resource usage to ensure that loads are reasonably balanced across pools.</span></span> <span data-ttu-id="1ab74-113">También debe asegurarse de que las bases de datos individuales tienen los recursos suficientes y de que los grupos no están al límite de [unidades de transacción de bases de datos elásticas](sql-database-what-is-a-dtu.md).</span><span class="sxs-lookup"><span data-stu-id="1ab74-113">You also need to ensure that individual databases have adequate resources, and that pools are not hitting their [eDTU](sql-database-what-is-a-dtu.md) limits.</span></span> <span data-ttu-id="1ab74-114">En este tutorial se exploran métodos para supervisar y administrar las bases de datos y los grupos, y se explica cómo tomar medidas correctivas en respuesta a las variaciones en la carga de trabajo.</span><span class="sxs-lookup"><span data-stu-id="1ab74-114">This tutorial explores ways to monitor and manage databases and pools, and how to take corrective action in response to variations in workload.</span></span>

<span data-ttu-id="1ab74-115">En este tutorial, aprenderá a:</span><span class="sxs-lookup"><span data-stu-id="1ab74-115">In this tutorial you learn how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="1ab74-116">Simular el uso de las bases de datos de inquilinos mediante la ejecución de un generador de carga proporcionado</span><span class="sxs-lookup"><span data-stu-id="1ab74-116">Simulate usage on the tenant databases by running a provided load generator</span></span>
> * <span data-ttu-id="1ab74-117">Supervisar las bases de datos de inquilinos a medida que responden al aumento de carga</span><span class="sxs-lookup"><span data-stu-id="1ab74-117">Monitor the tenant databases as they respond to the increase in load</span></span>
> * <span data-ttu-id="1ab74-118">Escalar verticalmente el grupo elástico en respuesta al aumento de la carga en la base de datos</span><span class="sxs-lookup"><span data-stu-id="1ab74-118">Scale up the Elastic pool in response to the increased database load</span></span>
> * <span data-ttu-id="1ab74-119">Aprovisionar un segundo grupo elástico para equilibrar la actividad de la base de datos</span><span class="sxs-lookup"><span data-stu-id="1ab74-119">Provision a second Elastic pool to load balance database activity</span></span>


<span data-ttu-id="1ab74-120">Para completar este tutorial, asegúrese de cumplir los siguientes requisitos previos:</span><span class="sxs-lookup"><span data-stu-id="1ab74-120">To complete this tutorial, make sure the following prerequisites are completed:</span></span>

* <span data-ttu-id="1ab74-121">Se implementa la aplicación SaaS de Wingtip.</span><span class="sxs-lookup"><span data-stu-id="1ab74-121">The Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="1ab74-122">Para implementarla en menos de cinco minutos, consulte el artículo sobre la [implementación y exploración de la aplicación SaaS de Wingtip](sql-database-saas-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="1ab74-122">To deploy in less than five minutes, see [Deploy and explore the Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="1ab74-123">Azure PowerShell está instalado.</span><span class="sxs-lookup"><span data-stu-id="1ab74-123">Azure PowerShell is installed.</span></span> <span data-ttu-id="1ab74-124">Para más información, consulte [Introducción a Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps).</span><span class="sxs-lookup"><span data-stu-id="1ab74-124">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>

## <a name="introduction-to-saas-performance-management-patterns"></a><span data-ttu-id="1ab74-125">Introducción a los patrones de administración del rendimiento de SaaS</span><span class="sxs-lookup"><span data-stu-id="1ab74-125">Introduction to SaaS performance management patterns</span></span>

<span data-ttu-id="1ab74-126">La administración del rendimiento de la base de datos consiste en compilar y analizar los datos de rendimiento y, a continuación, reaccionar a estos datos mediante el ajuste de parámetros para mantener un tiempo de respuesta aceptable de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="1ab74-126">Managing database performance consists of compiling and analyzing performance data, and then reacting to this data by adjusting parameters to maintain an acceptable response time for your application.</span></span> <span data-ttu-id="1ab74-127">Cuando se hospedan a varios inquilinos, los grupos de bases de datos elásticas son una manera rentable de proporcionar y administrar los recursos para un grupo de bases de datos con cargas de trabajo impredecibles.</span><span class="sxs-lookup"><span data-stu-id="1ab74-127">When hosting multiple tenants, Elastic database pools are a cost-effective way to provide and manage resources for a group of databases with unpredictable workloads.</span></span> <span data-ttu-id="1ab74-128">Con ciertos patrones de carga de trabajo, se pueden beneficiar de la administración en grupo un mínimo de dos bases de datos S3.</span><span class="sxs-lookup"><span data-stu-id="1ab74-128">With certain workload patterns, as few as two S3 databases can benefit from being managed in a pool.</span></span>

![medios](./media/sql-database-saas-tutorial-performance-monitoring/app-diagram.png)

<span data-ttu-id="1ab74-130">Se deben supervisar los grupos y las bases de datos de estos para garantizar que permanecen dentro de intervalos de rendimiento aceptables.</span><span class="sxs-lookup"><span data-stu-id="1ab74-130">Pools, and the databases in pools, should be monitored to ensure they stay within acceptable ranges of performance.</span></span> <span data-ttu-id="1ab74-131">Ajuste la configuración del grupo para satisfacer las necesidades de la carga de trabajo agregada de todas las bases de datos, garantizando que las eDTU del grupo son adecuadas para la carga de trabajo global.</span><span class="sxs-lookup"><span data-stu-id="1ab74-131">Tune the pool configuration to meet the needs of the aggregate workload of all databases, ensuring that the pool eDTUs are appropriate for the overall workload.</span></span> <span data-ttu-id="1ab74-132">Ajuste los valores mínimo y máximo de unidades de transacción de bases de datos elásticas por base de datos adecuados para los requisitos de su aplicación.</span><span class="sxs-lookup"><span data-stu-id="1ab74-132">Adjust the per-database min and per-database max eDTU values to appropriate values for your specific application requirements.</span></span>

### <a name="performance-management-strategies"></a><span data-ttu-id="1ab74-133">Estrategias de administración del rendimiento</span><span class="sxs-lookup"><span data-stu-id="1ab74-133">Performance management strategies</span></span>

* <span data-ttu-id="1ab74-134">Para evitar tener que supervisar el rendimiento manualmente, resulta más eficaz **establecer alertas que se activan cuando las bases de datos o los grupos se alejan de los intervalos normales**.</span><span class="sxs-lookup"><span data-stu-id="1ab74-134">To avoid having to manually monitor performance, it’s most effective to **set alerts that trigger when databases or pools stray out of normal ranges**.</span></span>
* <span data-ttu-id="1ab74-135">Para responder a las fluctuaciones de rendimiento global de un grupo a corto plazo, **se puede escalar o reducir verticalmente el nivel de eDTU del grupo**.</span><span class="sxs-lookup"><span data-stu-id="1ab74-135">To respond to short-term fluctuations in the aggregate performance level of a pool, the **pool eDTU level can be scaled up or down**.</span></span> <span data-ttu-id="1ab74-136">Si esta fluctuación es habitual o previsible, **se puede programar el escalado automático del grupo**.</span><span class="sxs-lookup"><span data-stu-id="1ab74-136">If this fluctuation occurs on a regular or predictable basis, **scaling the pool can be scheduled to occur automatically**.</span></span> <span data-ttu-id="1ab74-137">Por ejemplo, cuando haya poca carga de trabajo (por la noche o durante el fin de semana), redúzcalo verticalmente.</span><span class="sxs-lookup"><span data-stu-id="1ab74-137">For example, scale down when you know your workload is light, maybe overnight, or during weekends.</span></span>
* <span data-ttu-id="1ab74-138">Para responder a las fluctuaciones a largo plazo o a cambios en el número de bases de datos, **las bases de datos se pueden mover a otros grupos**.</span><span class="sxs-lookup"><span data-stu-id="1ab74-138">To respond to longer-term fluctuations, or changes in the number of databases, **individual databases can be moved into other pools**.</span></span>
* <span data-ttu-id="1ab74-139">Para responder a aumentos breves en la carga *individual* de una base de datos, **se puede sacar de un grupo para asignarle un nivel de rendimiento individual**.</span><span class="sxs-lookup"><span data-stu-id="1ab74-139">To respond to short term increases in *individual* database load **individual databases can be taken out of a pool and assigned an individual performance level**.</span></span> <span data-ttu-id="1ab74-140">Una vez reducida la carga, la base de datos se puede devolver al grupo.</span><span class="sxs-lookup"><span data-stu-id="1ab74-140">Once the load is reduced, the database can then be returned to the pool.</span></span> <span data-ttu-id="1ab74-141">Cuando se sepa de antemano, las bases de datos se pueden mover con antelación para garantizar que siempre tienen los recursos necesarios y evitar que otras bases de datos del grupo resulten afectadas.</span><span class="sxs-lookup"><span data-stu-id="1ab74-141">When this is known in advance, databases can be moved pre-emptively to ensure the database always has the resources it needs, and to avoid impact on other databases in the pool.</span></span> <span data-ttu-id="1ab74-142">Si es predecible, como para un establecimiento, una avalancha de ventas de entradas para un evento popular, este comportamiento de administración puede integrarse en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="1ab74-142">If this requirement is predictable, such as a venue experiencing a rush of ticket sales for a popular event, then this management behavior can be integrated into the application.</span></span>

<span data-ttu-id="1ab74-143">[Azure Portal](https://portal.azure.com) proporciona supervisión y alertas integradas en la mayoría de recursos.</span><span class="sxs-lookup"><span data-stu-id="1ab74-143">The [Azure portal](https://portal.azure.com) provides built-in monitoring and alerting on most resources.</span></span> <span data-ttu-id="1ab74-144">Para SQL Database, la supervisión y las alertas están disponibles para las bases de datos y los grupos.</span><span class="sxs-lookup"><span data-stu-id="1ab74-144">For SQL Database, monitoring and alerting is available on databases and pools.</span></span> <span data-ttu-id="1ab74-145">La supervisión y las alertas integradas son específicas de los recursos, por lo que es conveniente usarlas con un número reducido de recursos, pero no cuando se trabaja con muchos recursos.</span><span class="sxs-lookup"><span data-stu-id="1ab74-145">This built-in monitoring and alerting is resource-specific, so it's convenient to use for small numbers of resources, but is not very convenient when working with many resources.</span></span>

<span data-ttu-id="1ab74-146">Para escenarios de alto volumen donde se trabaja con muchos recursos, se puede usar [Log Analytics (OMS)](sql-database-saas-tutorial-log-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="1ab74-146">For high-volume scenarios where you're working with many reources, [Log Analytics (OMS)](sql-database-saas-tutorial-log-analytics.md) can be used.</span></span> <span data-ttu-id="1ab74-147">Se trata de un servicio de Azure independiente que proporciona análisis de los registros de diagnóstico emitidos y de telemetría recopilados en un área de trabajo de Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="1ab74-147">This is a separate Azure service that provides analytics over emitted diagnostic logs and telemetry gathered in a log analytics workspace.</span></span> <span data-ttu-id="1ab74-148">Log Analytics puede recopilar la telemetría de muchos servicios y sirve para consultar y establecer alertas.</span><span class="sxs-lookup"><span data-stu-id="1ab74-148">Log Analytics can collect telemetry from many services and be used to query and set alerts.</span></span>

## <a name="get-the-wingtip-application-source-code-and-scripts"></a><span data-ttu-id="1ab74-149">Obtener el código fuente y los scripts de la aplicación Wingtip</span><span class="sxs-lookup"><span data-stu-id="1ab74-149">Get the Wingtip application source code and scripts</span></span>

<span data-ttu-id="1ab74-150">Los scripts SaaS de Wingtip y el código fuente de la aplicación están disponibles en el repositorio de GitHub [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS).</span><span class="sxs-lookup"><span data-stu-id="1ab74-150">The Wingtip SaaS scripts and application source code are available in the [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="1ab74-151">[Pasos para descargar los scripts SaaS de Wingtip](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="1ab74-151">[Steps to download the Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>

## <a name="provision-additional-tenants"></a><span data-ttu-id="1ab74-152">Aprovisionamiento de inquilinos adicionales</span><span class="sxs-lookup"><span data-stu-id="1ab74-152">Provision additional tenants</span></span>

<span data-ttu-id="1ab74-153">Aunque los grupos pueden ser rentables con solo dos bases de datos S3, cuantas más bases de datos en el grupo, más rentable será la media.</span><span class="sxs-lookup"><span data-stu-id="1ab74-153">While pools can be cost-effective with just two S3 databases, the more databases that are in the pool the more cost-effective the averaging effect becomes.</span></span> <span data-ttu-id="1ab74-154">Para una buena comprensión de cómo funciona la administración y la supervisión del rendimiento a escala, para este tutorial se necesitan al menos 20 bases de datos implementadas.</span><span class="sxs-lookup"><span data-stu-id="1ab74-154">For a good understanding of how performance monitoring and management works at scale, this tutorial requires you have at least 20 databases deployed.</span></span>

<span data-ttu-id="1ab74-155">Si ya aprovisionó un lote de inquilinos en un tutorial anterior, vaya directamente a la sección [Simulación de uso en todas las bases de datos de inquilinos](#simulate-usage-on-all-tenant-databases).</span><span class="sxs-lookup"><span data-stu-id="1ab74-155">If you already provisioned a batch of tenants in a prior tutorial, skip to the [Simulate usage on all tenant databases](#simulate-usage-on-all-tenant-databases) section.</span></span>

1. <span data-ttu-id="1ab74-156">Abra …\\Learning Modules\\Performance Monitoring and Management\\*Demo-PerformanceMonitoringAndManagement.ps1* en *PowerShell ISE*.</span><span class="sxs-lookup"><span data-stu-id="1ab74-156">Open …\\Learning Modules\\Performance Monitoring and Management\\*Demo-PerformanceMonitoringAndManagement.ps1* in the *PowerShell ISE*.</span></span> <span data-ttu-id="1ab74-157">Mantenga este script abierta, ya que se van a ejecutar varios escenarios en este tutorial.</span><span class="sxs-lookup"><span data-stu-id="1ab74-157">Keep this script open as you'll run several scenarios during this tutorial.</span></span>
1. <span data-ttu-id="1ab74-158">Establezca **$DemoScenario** = **1**, **Aprovisionamiento de un lote de inquilinos**</span><span class="sxs-lookup"><span data-stu-id="1ab74-158">Set **$DemoScenario** = **1**, **Provision a batch of tenants**</span></span>
1. <span data-ttu-id="1ab74-159">Presione **F5** para ejecutar el script.</span><span class="sxs-lookup"><span data-stu-id="1ab74-159">Press **F5** to run the script.</span></span>

<span data-ttu-id="1ab74-160">El script implementará 17 inquilinos en menos de cinco minutos.</span><span class="sxs-lookup"><span data-stu-id="1ab74-160">The script will deploy 17 tenants in less than five minutes.</span></span>

<span data-ttu-id="1ab74-161">El script *New-TenantBatch* usa un conjunto anidado o vinculado de plantillas de [Resource Manager](../azure-resource-manager/index.md) que crean un lote de inquilinos, que, de forma predeterminada, copia la base de datos **basetenantdb** en el servidor de catálogo para crear las bases de datos de inquilinos y las registra en el catálogo; finalmente, las inicializa con el nombre de inquilino y el tipo de lugar.</span><span class="sxs-lookup"><span data-stu-id="1ab74-161">The *New-TenantBatch* script uses a nested or linked set of [Resource Manager](../azure-resource-manager/index.md) templates that create a batch of tenants, which by default copies the database **basetenantdb** on the catalog server to create the new tenant databases, then registers these in the catalog, and finally initializes them with the tenant name and venue type.</span></span> <span data-ttu-id="1ab74-162">Esto es coherente con la manera en que la aplicación aprovisiona un nuevo inquilino.</span><span class="sxs-lookup"><span data-stu-id="1ab74-162">This is consistent with the way the app provisions a new tenant.</span></span> <span data-ttu-id="1ab74-163">Los cambios realizados en *basetenantdb* se aplican a los nuevos inquilinos que se aprovisionen a partir de ese momento.</span><span class="sxs-lookup"><span data-stu-id="1ab74-163">Any changes made to *basetenantdb* are applied to any new tenants provisioned thereafter.</span></span> <span data-ttu-id="1ab74-164">Vea el [tutorial de administración de esquemas](sql-database-saas-tutorial-schema-management.md) para ver cómo realizar cambios de esquema en bases de datos de inquilinos *existentes* (incluida la base de datos *basetenantdb*).</span><span class="sxs-lookup"><span data-stu-id="1ab74-164">See the [Schema Management tutorial](sql-database-saas-tutorial-schema-management.md) to see how to make schema changes to *existing* tenant databases (including the *basetenantdb* database).</span></span>

## <a name="simulate-usage-on-all-tenant-databases"></a><span data-ttu-id="1ab74-165">Simulación de uso en todas las bases de datos de inquilinos</span><span class="sxs-lookup"><span data-stu-id="1ab74-165">Simulate usage on all tenant databases</span></span>

<span data-ttu-id="1ab74-166">Se proporciona el script *Demo-PerformanceMonitoringAndManagement.ps1* que simula una carga de trabajo que se ejecuta en todas las bases de datos de los inquilinos.</span><span class="sxs-lookup"><span data-stu-id="1ab74-166">The *Demo-PerformanceMonitoringAndManagement.ps1* script is provided that simulates a workload running against all tenant databases.</span></span> <span data-ttu-id="1ab74-167">La carga se genera mediante uno de los escenarios de carga disponibles:</span><span class="sxs-lookup"><span data-stu-id="1ab74-167">The load is generated using one of the available load scenarios:</span></span>

| <span data-ttu-id="1ab74-168">Demostración</span><span class="sxs-lookup"><span data-stu-id="1ab74-168">Demo</span></span> | <span data-ttu-id="1ab74-169">Escenario</span><span class="sxs-lookup"><span data-stu-id="1ab74-169">Scenario</span></span> |
|:--|:--|
| <span data-ttu-id="1ab74-170">2</span><span class="sxs-lookup"><span data-stu-id="1ab74-170">2</span></span> | <span data-ttu-id="1ab74-171">Generación de una carga de intensidad normal (aprox. 40 DTU)</span><span class="sxs-lookup"><span data-stu-id="1ab74-171">Generate normal intensity load (approx. 40 DTU)</span></span> |
| <span data-ttu-id="1ab74-172">3</span><span class="sxs-lookup"><span data-stu-id="1ab74-172">3</span></span> | <span data-ttu-id="1ab74-173">Generación de una carga con ráfagas más prolongadas y frecuentes por base de datos</span><span class="sxs-lookup"><span data-stu-id="1ab74-173">Generate load with longer and more frequent bursts per database</span></span>|
| <span data-ttu-id="1ab74-174">4</span><span class="sxs-lookup"><span data-stu-id="1ab74-174">4</span></span> | <span data-ttu-id="1ab74-175">Generación de una carga con mayores ráfagas de DTU por base de datos (aprox. 80 DTU)</span><span class="sxs-lookup"><span data-stu-id="1ab74-175">Generate load with higher DTU bursts per database (approx. 80 DTU)</span></span>|
| <span data-ttu-id="1ab74-176">5</span><span class="sxs-lookup"><span data-stu-id="1ab74-176">5</span></span> | <span data-ttu-id="1ab74-177">Generación de una carga normal y una carga elevada en un solo inquilino (aprox. 95 DTU)</span><span class="sxs-lookup"><span data-stu-id="1ab74-177">Generate a normal load plus a high load on a single tenant (approx. 95 DTU)</span></span>|
| <span data-ttu-id="1ab74-178">6</span><span class="sxs-lookup"><span data-stu-id="1ab74-178">6</span></span> | <span data-ttu-id="1ab74-179">Generación de una carga desequilibrada en varios grupos</span><span class="sxs-lookup"><span data-stu-id="1ab74-179">Generate unbalanced load across multiple pools</span></span>|

<span data-ttu-id="1ab74-180">El generador de carga se aplica una carga *sintética* exclusiva de CPU para cada base de datos de inquilinos.</span><span class="sxs-lookup"><span data-stu-id="1ab74-180">The load generator applies a *synthetic* CPU-only load to every tenant database.</span></span> <span data-ttu-id="1ab74-181">El generador de inicia un trabajo para cada base de datos de inquilinos, que llama a un procedimiento almacenado periódicamente que genera la carga.</span><span class="sxs-lookup"><span data-stu-id="1ab74-181">The generator starts a job for each tenant database, which calls a stored procedure periodically that generates the load.</span></span> <span data-ttu-id="1ab74-182">Los niveles de carga (en eDTU), la duración y los intervalos varían en todas las bases de datos, lo cual simula una actividad de inquilinos imprevisible.</span><span class="sxs-lookup"><span data-stu-id="1ab74-182">The load levels (in eDTUs), duration, and intervals are varied across all databases, simulating unpredictable tenant activity.</span></span>

1. <span data-ttu-id="1ab74-183">Abra …\\Learning Modules\\Performance Monitoring and Management\\*Demo-PerformanceMonitoringAndManagement.ps1* en *PowerShell ISE*.</span><span class="sxs-lookup"><span data-stu-id="1ab74-183">Open …\\Learning Modules\\Performance Monitoring and Management\\*Demo-PerformanceMonitoringAndManagement.ps1* in the *PowerShell ISE*.</span></span> <span data-ttu-id="1ab74-184">Mantenga este script abierta, ya que se van a ejecutar varios escenarios en este tutorial.</span><span class="sxs-lookup"><span data-stu-id="1ab74-184">Keep this script open as you'll run several scenarios during this tutorial.</span></span>
1. <span data-ttu-id="1ab74-185">Establezca **$DemoScenario** = **2**, *Generación de una carga de intensidad normal*.</span><span class="sxs-lookup"><span data-stu-id="1ab74-185">Set **$DemoScenario** = **2**, *Generate normal intensity load*.</span></span>
1. <span data-ttu-id="1ab74-186">Presione **F5** para aplicar una carga de todas las bases de datos de inquilinos.</span><span class="sxs-lookup"><span data-stu-id="1ab74-186">Press **F5** to apply a load to all your tenant databases.</span></span>

<span data-ttu-id="1ab74-187">Wingtip es una aplicación SaaS y, en el mundo real, la carga que tiene una aplicación SaaS normalmente es esporádica e impredecible.</span><span class="sxs-lookup"><span data-stu-id="1ab74-187">Wingtip is a SaaS app, and the real-world load on a SaaS app is typically sporadic and unpredictable.</span></span> <span data-ttu-id="1ab74-188">Para realizar la simulación, el generador de carga crea una carga aleatoria que distribuye entre todos los inquilinos.</span><span class="sxs-lookup"><span data-stu-id="1ab74-188">To simulate this, the load generator produces a randomized load distributed across all tenants.</span></span> <span data-ttu-id="1ab74-189">El patrón de carga tarda varios minutos en crearse, por lo que se recomienda dejar que el generador de carga se ejecute durante unos 3-5 minutos antes de intentar supervisar la carga en las secciones siguientes.</span><span class="sxs-lookup"><span data-stu-id="1ab74-189">Several minutes are needed for the load pattern to emerge, so run the load generator for 3-5 minutes before attempting to monitor the load in the following sections.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="1ab74-190">El generador de carga se ejecuta como una serie de trabajos en la sesión local de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="1ab74-190">The load generator is running as a series of jobs in your local PowerShell session.</span></span> <span data-ttu-id="1ab74-191">Mantenga abierta la pestaña *Demo-PerformanceMonitoringAndManagement.ps1*.</span><span class="sxs-lookup"><span data-stu-id="1ab74-191">Keep the *Demo-PerformanceMonitoringAndManagement.ps1* tab open!</span></span> <span data-ttu-id="1ab74-192">Si la cierra o suspende la máquina, el generador de carga se detendrá.</span><span class="sxs-lookup"><span data-stu-id="1ab74-192">If you close the tab, or suspend your machine, the load generator stops.</span></span> <span data-ttu-id="1ab74-193">El generador de carga permanece en un estado *de invocación de trabajo* en el que genera carga en los nuevos inquilinos que se aprovisionaron después de iniciar el generador.</span><span class="sxs-lookup"><span data-stu-id="1ab74-193">The load generator remains in a *job-invoking* state where it generates load on any new tenants that are provisioned after the generator is started.</span></span> <span data-ttu-id="1ab74-194">Presione *Ctrl-C* para detener la invocación de nuevos trabajos y salir del script.</span><span class="sxs-lookup"><span data-stu-id="1ab74-194">Use *Ctrl-C* to stop invoking new jobs and exit the script.</span></span> <span data-ttu-id="1ab74-195">El generador de carga continuará ejecutándose, pero solo en los inquilinos existentes.</span><span class="sxs-lookup"><span data-stu-id="1ab74-195">The load generator will continue to run, but only on existing tenants.</span></span>

## <a name="monitor-resource-usage-using-the-azure-portal"></a><span data-ttu-id="1ab74-196">Supervisión del uso de los recursos mediante Azure Portal</span><span class="sxs-lookup"><span data-stu-id="1ab74-196">Monitor resource usage using the Azure portal</span></span>

<span data-ttu-id="1ab74-197">Para supervisar el uso de los recursos derivado de la carga que se aplica, abra el portal por el grupo que contiene las bases de datos de inquilinos:</span><span class="sxs-lookup"><span data-stu-id="1ab74-197">To monitor the resource usage that results from the load being applied, open the portal to the pool containing the tenant databases:</span></span>

1. <span data-ttu-id="1ab74-198">Abra [Azure Portal](https://portal.azure.com) y vaya al servidor *tenants1-&lt;USUARIO&gt;*.</span><span class="sxs-lookup"><span data-stu-id="1ab74-198">Open the [Azure portal](https://portal.azure.com) and browse to the *tenants1-&lt;USER&gt;* server.</span></span>
1. <span data-ttu-id="1ab74-199">Desplácese hacia abajo, busque los grupos elásticos y haga clic en **Pool1**.</span><span class="sxs-lookup"><span data-stu-id="1ab74-199">Scroll down and locate elastic pools and click **Pool1**.</span></span> <span data-ttu-id="1ab74-200">Este grupo contiene todas las bases de datos de inquilinos creadas hasta ahora.</span><span class="sxs-lookup"><span data-stu-id="1ab74-200">This pool contains all the tenant databases created so far.</span></span>

<span data-ttu-id="1ab74-201">Observe los gráficos **Supervisión de grupo elástico** y **Supervisión de base de datos elástica**.</span><span class="sxs-lookup"><span data-stu-id="1ab74-201">Observe the **Elastic pool monitoring** and **Elastic database monitoring** charts.</span></span>

<span data-ttu-id="1ab74-202">El uso de los recursos del grupo es la suma del uso de todas las bases de datos del grupo.</span><span class="sxs-lookup"><span data-stu-id="1ab74-202">The pool's resource utilization is the aggregate database utilization for all databases in the pool.</span></span> <span data-ttu-id="1ab74-203">El gráfico de base de datos muestra las cinco bases de datos más recientes:</span><span class="sxs-lookup"><span data-stu-id="1ab74-203">The database chart shows the five hottest databases:</span></span>

![](./media/sql-database-saas-tutorial-performance-monitoring/pool1.png)

<span data-ttu-id="1ab74-204">Como hay otras bases de datos en el grupo aparte de las cinco principales, el uso del grupo muestra la actividad que no se refleja en el gráfico de las cinco bases de datos principales.</span><span class="sxs-lookup"><span data-stu-id="1ab74-204">Because there are additional databases in the pool beyond the top five, the pool utilization shows activity that is not reflected in the top five databases chart.</span></span> <span data-ttu-id="1ab74-205">Para ver detalles adicionales, haga clic en **Uso de recursos de base de datos**:</span><span class="sxs-lookup"><span data-stu-id="1ab74-205">For additional details, click **Database Resource Utilization**:</span></span>

![](./media/sql-database-saas-tutorial-performance-monitoring/database-utilization.png)


## <a name="set-performance-alerts-on-the-pool"></a><span data-ttu-id="1ab74-206">Establecimiento de alertas de rendimiento en el grupo</span><span class="sxs-lookup"><span data-stu-id="1ab74-206">Set performance alerts on the pool</span></span>

<span data-ttu-id="1ab74-207">Establezca una alerta en el grupo que se desencadene cuando el uso sea de \>75 % como sigue:</span><span class="sxs-lookup"><span data-stu-id="1ab74-207">Set an alert on the pool that triggers on \>75% utilization as follows:</span></span>

1. <span data-ttu-id="1ab74-208">Abra *Pool1* (en el servidor *tenants1-\<user\>*) en [Azure Portal](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="1ab74-208">Open *Pool1* (on the *tenants1-\<user\>* server) in the [Azure portal](https://portal.azure.com).</span></span>
1. <span data-ttu-id="1ab74-209">Haga clic en **Reglas de alerta** y en **+ Agregar alerta**:</span><span class="sxs-lookup"><span data-stu-id="1ab74-209">Click **Alert Rules**, and then click **+ Add alert**:</span></span>

   ![agregar alerta](media/sql-database-saas-tutorial-performance-monitoring/add-alert.png)

1. <span data-ttu-id="1ab74-211">Proporcione un nombre, como **High DTU**,</span><span class="sxs-lookup"><span data-stu-id="1ab74-211">Provide a name, such as **High DTU**,</span></span>
1. <span data-ttu-id="1ab74-212">Establezca los valores siguientes:</span><span class="sxs-lookup"><span data-stu-id="1ab74-212">Set the following values:</span></span>
   * <span data-ttu-id="1ab74-213">**Métrica = eDTU percentage**</span><span class="sxs-lookup"><span data-stu-id="1ab74-213">**Metric = eDTU percentage**</span></span>
   * <span data-ttu-id="1ab74-214">**Condición = greater than**.</span><span class="sxs-lookup"><span data-stu-id="1ab74-214">**Condition = greater than**.</span></span>
   * <span data-ttu-id="1ab74-215">**Umbral = 75**.</span><span class="sxs-lookup"><span data-stu-id="1ab74-215">**Threshold = 75**.</span></span>
   * <span data-ttu-id="1ab74-216">**Período = Over the last 30 minutes**.</span><span class="sxs-lookup"><span data-stu-id="1ab74-216">**Period = Over the last 30 minutes**.</span></span>
1. <span data-ttu-id="1ab74-217">Agregue una dirección de correo al cuadro *Correos electrónicos adicionales del administrador* y haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="1ab74-217">Add an email address to the *Additional administrator email(s)* box and click **OK**.</span></span>

   ![Establecer alerta](media/sql-database-saas-tutorial-performance-monitoring/alert-rule.png)


## <a name="scale-up-a-busy-pool"></a><span data-ttu-id="1ab74-219">Escalado vertical de un grupo ocupado</span><span class="sxs-lookup"><span data-stu-id="1ab74-219">Scale up a busy pool</span></span>

<span data-ttu-id="1ab74-220">Si aumenta el nivel de carga global en un grupo hasta el punto de llegar al máximo del grupo y alcanza el 100 % del uso de eDTU, el rendimiento de las bases de datos se verá afectado, lo cual podría ralentizar los tiempos de respuesta de consulta para todas las bases de datos del grupo.</span><span class="sxs-lookup"><span data-stu-id="1ab74-220">If the aggregate load level increases on a pool to the point that it maxes out the pool and reaches 100% eDTU usage, then individual database performance is affected, potentially slowing query response times for all databases in the pool.</span></span>

<span data-ttu-id="1ab74-221">**A corto plazo**, considere la posibilidad de escalar verticalmente el grupo para proporcionar recursos adicionales o de quitar bases de datos del grupo (muévalas a otros grupos o fuera del grupo a un nivel de servicio independiente).</span><span class="sxs-lookup"><span data-stu-id="1ab74-221">**Short term**, consider scaling up the pool to provide additional resources, or removing databases from the pool (moving them to other pools, or out of the pool to a stand-alone service tier).</span></span>

<span data-ttu-id="1ab74-222">**A largo plazo**, considere la posibilidad de optimizar las consultas o el uso de índices para mejorar el rendimiento de las bases de datos.</span><span class="sxs-lookup"><span data-stu-id="1ab74-222">**Longer term**, consider optimizing queries or index usage to improve database performance.</span></span> <span data-ttu-id="1ab74-223">En función de la sensibilidad de la aplicación a los problemas de rendimiento, es un procedimiento recomendado el escalado vertical de un grupo antes de que llegue al 100 % del uso de eDTU.</span><span class="sxs-lookup"><span data-stu-id="1ab74-223">Depending on the application's sensitivity to performance issues its best practice to scale a pool up before it reaches 100% eDTU usage.</span></span> <span data-ttu-id="1ab74-224">Use una alerta para que le avise con antelación.</span><span class="sxs-lookup"><span data-stu-id="1ab74-224">Use an alert to warn you in advance.</span></span>

<span data-ttu-id="1ab74-225">Puede simular un grupo ocupado si aumenta la carga que produce el generador.</span><span class="sxs-lookup"><span data-stu-id="1ab74-225">You can simulate a busy pool by increasing the load produced by the generator.</span></span> <span data-ttu-id="1ab74-226">Hacer que las bases de datos generen ráfagas con más frecuencia y más prolongadas aumenta la carga global del grupo sin cambiar los requisitos de las bases de datos individualmente.</span><span class="sxs-lookup"><span data-stu-id="1ab74-226">Causing the databases to burst more frequently, and for longer, increasing the aggregate load on the pool without changing the requirements of the individual databases.</span></span> <span data-ttu-id="1ab74-227">El escalado vertical del grupo se realiza fácilmente en el portal o desde PowerShell.</span><span class="sxs-lookup"><span data-stu-id="1ab74-227">Scaling up the pool is easily done in the portal or from PowerShell.</span></span> <span data-ttu-id="1ab74-228">En este ejercicio se usa el portal.</span><span class="sxs-lookup"><span data-stu-id="1ab74-228">This exercise uses the portal.</span></span>

1. <span data-ttu-id="1ab74-229">Establezca *$DemoScenario* = **3**, _Generación de una carga con ráfagas más prolongadas y frecuentes por base de datos_ para aumentar la intensidad de la carga global del grupo sin cambiar la carga máxima necesaria para cada base de datos.</span><span class="sxs-lookup"><span data-stu-id="1ab74-229">Set *$DemoScenario* = **3**, _Generate load with longer and more frequent bursts per database_ to increase the intensity of the aggregate load on the pool without changing the peak load required by each database.</span></span>
1. <span data-ttu-id="1ab74-230">Presione **F5** para aplicar una carga de todas las bases de datos de inquilinos.</span><span class="sxs-lookup"><span data-stu-id="1ab74-230">Press **F5** to apply a load to all your tenant databases.</span></span>

1. <span data-ttu-id="1ab74-231">Vaya a **Pool1** en Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="1ab74-231">Go to **Pool1** in the Azure portal.</span></span>

<span data-ttu-id="1ab74-232">Supervise el aumento del uso de eDTU del grupo en el gráfico superior.</span><span class="sxs-lookup"><span data-stu-id="1ab74-232">Monitor the increased pool eDTU usage on the upper chart.</span></span> <span data-ttu-id="1ab74-233">La carga mayor tarda unos minutos en entrar en vigor, pero debería ver cómo rápidamente el grupo empieza a llegar al máximo uso y, según la carga se va estabilizando en el nuevo modelo, sobrecarga rápidamente el grupo.</span><span class="sxs-lookup"><span data-stu-id="1ab74-233">It takes a few minutes for the new higher load to kick in, but you should quickly see the pool start to hit max utilization, and as the load steadies into the new pattern, it rapidly overloads the pool.</span></span>

1. <span data-ttu-id="1ab74-234">Para escalar verticalmente el grupo, haga clic en **Configurar grupo** en la parte superior de la página **Pool1**.</span><span class="sxs-lookup"><span data-stu-id="1ab74-234">To scale up the pool, click **Configure pool** at the top of the **Pool1** page.</span></span>
1. <span data-ttu-id="1ab74-235">Ajuste el valor **eDTU del grupo** a **100**.</span><span class="sxs-lookup"><span data-stu-id="1ab74-235">Adjust the **Pool eDTU** setting to **100**.</span></span> <span data-ttu-id="1ab74-236">Cambiar la eDTU del grupo no cambia la configuración por base de datos (que sigue siendo 50 eDTU máx. por base de datos).</span><span class="sxs-lookup"><span data-stu-id="1ab74-236">Changing the pool eDTU does not change the per-database settings (which is still 50 eDTU max per database).</span></span> <span data-ttu-id="1ab74-237">Puede ver la configuración por base de datos en el lado derecho de la página **Configurar grupo**.</span><span class="sxs-lookup"><span data-stu-id="1ab74-237">You can see the per-database settings on the right side of the **Configure pool** page.</span></span>
1. <span data-ttu-id="1ab74-238">Haga clic en **Guardar** para enviar la solicitud de escala del grupo.</span><span class="sxs-lookup"><span data-stu-id="1ab74-238">Click **Save** to submit the request to scale the pool.</span></span>

<span data-ttu-id="1ab74-239">Vuelva a **Pool1** > **Introducción** para ver los gráficos de supervisión.</span><span class="sxs-lookup"><span data-stu-id="1ab74-239">Go back to **Pool1** > **Overview** to view the monitoring charts.</span></span> <span data-ttu-id="1ab74-240">Supervise el efecto de proporcionar más recursos al grupo (aunque con pocas bases de datos y una carga aleatoria no siempre es fácil verlo bien hasta que se ejecuta durante un tiempo).</span><span class="sxs-lookup"><span data-stu-id="1ab74-240">Monitor the effect of providing the pool with more resources (although with few databases and a randomized load it’s not always easy to see conclusively until you run for some time).</span></span> <span data-ttu-id="1ab74-241">Mientras observe los gráficos, tenga en cuenta que el 100 % del gráfico superior representa ahora 100 eDTU, mientras que en el gráfico inferior, el 100 % sigue siendo 50 eDTU, ya que el máximo por base de datos sigue siendo 50 eDTU.</span><span class="sxs-lookup"><span data-stu-id="1ab74-241">While you are looking at the charts bear in mind that 100% on the upper chart now represents 100 eDTUs, while on the lower chart 100% is still 50 eDTUs as the per-database max is still 50 eDTUs.</span></span>

<span data-ttu-id="1ab74-242">Las bases de datos permanecen en línea y están totalmente disponibles durante el proceso.</span><span class="sxs-lookup"><span data-stu-id="1ab74-242">Databases remain online and fully available throughout the process.</span></span> <span data-ttu-id="1ab74-243">En el último momento, como las bases de datos están preparadas para la habilitación con la nueva eDTU de grupo, todas las conexiones activas se interrumpen.</span><span class="sxs-lookup"><span data-stu-id="1ab74-243">At the last moment as each database is ready to be enabled with the new pool eDTU, any active connections are broken.</span></span> <span data-ttu-id="1ab74-244">El código de la aplicación debe escribirse para siempre reintente recuperar las conexiones interrumpidas, por lo tanto, se volverá a conectar a la base de datos del grupo escalado verticalmente.</span><span class="sxs-lookup"><span data-stu-id="1ab74-244">Application code should always be written to retry dropped connections, and so will reconnect to the database in the scaled-up pool.</span></span>

## <a name="load-balance-between-pools"></a><span data-ttu-id="1ab74-245">Equilibrio de carga entre grupos</span><span class="sxs-lookup"><span data-stu-id="1ab74-245">Load balance between pools</span></span>

<span data-ttu-id="1ab74-246">Como alternativa al escalado vertical del grupo, cree un segundo grupo y mueva bases de datos a este para equilibrar la carga entre los dos grupos.</span><span class="sxs-lookup"><span data-stu-id="1ab74-246">As an alternative to scaling up the pool, create a second pool and move databases into it to balance the load between the two pools.</span></span> <span data-ttu-id="1ab74-247">Para ello, el nuevo grupo debe crearse en el mismo servidor que el primero.</span><span class="sxs-lookup"><span data-stu-id="1ab74-247">To do this the new pool must be created on the same server as the first.</span></span>

1. <span data-ttu-id="1ab74-248">En [Azure Portal](https://portal.azure.com), abra el servidor **tenants1-&lt;USUARIO&gt;**.</span><span class="sxs-lookup"><span data-stu-id="1ab74-248">In the [Azure portal](https://portal.azure.com), open the **tenants1-&lt;USER&gt;** server.</span></span>
1. <span data-ttu-id="1ab74-249">Haga clic en **+ Grupo nuevo** para crear un grupo en el servidor actual.</span><span class="sxs-lookup"><span data-stu-id="1ab74-249">Click **+ New pool** to create a pool on the current server.</span></span>
1. <span data-ttu-id="1ab74-250">En la plantilla **Grupo de bases de datos elásticas**:</span><span class="sxs-lookup"><span data-stu-id="1ab74-250">On the **Elastic database pool** template:</span></span>

    1. <span data-ttu-id="1ab74-251">Establezca **Nombre** en *Pool2*.</span><span class="sxs-lookup"><span data-stu-id="1ab74-251">Set **Name** to *Pool2*.</span></span>
    1. <span data-ttu-id="1ab74-252">Deje el plan de tarifa como **Grupo Estándar**.</span><span class="sxs-lookup"><span data-stu-id="1ab74-252">Leave the pricing tier as **Standard Pool**.</span></span>
    1. <span data-ttu-id="1ab74-253">Haga clic en **Configurar grupo**.</span><span class="sxs-lookup"><span data-stu-id="1ab74-253">Click **Configure pool**,</span></span>
    1. <span data-ttu-id="1ab74-254">Establezca **eDTU del grupo** en *50 eDTU*.</span><span class="sxs-lookup"><span data-stu-id="1ab74-254">Set **Pool eDTU** to *50 eDTU*.</span></span>
    1. <span data-ttu-id="1ab74-255">Haga clic en **Agregar bases de datos** para ver una lista de bases de datos en el servidor que se pueden agregar a *Pool2*.</span><span class="sxs-lookup"><span data-stu-id="1ab74-255">Click **Add databases** to see a list of databases on the server that can be added to *Pool2*.</span></span>
    1. <span data-ttu-id="1ab74-256">Seleccione 10 bases de datos cualquiera para moverlas al nuevo grupo y, después, haga clic en **Seleccionar**.</span><span class="sxs-lookup"><span data-stu-id="1ab74-256">Select any 10 databases to move these to the new pool, and then click **Select**.</span></span> <span data-ttu-id="1ab74-257">Si ha estado ejecutando el generador de carga, el servicio ya sabe que el perfil de rendimiento requiere un grupo mayor que el tamaño predeterminado de 50 eDTU y recomienda empezar con una configuración de 100 eDTU.</span><span class="sxs-lookup"><span data-stu-id="1ab74-257">If you've been running the load generator, the service already knows that your performance profile requires a larger pool than the default 50 eDTU size and recommends starting with a 100 eDTU setting.</span></span>

    ![recomendación](media/sql-database-saas-tutorial-performance-monitoring/configure-pool.png)

    1. <span data-ttu-id="1ab74-259">Para este tutorial, deje el valor predeterminado en 50 eDTU y haga clic en **Seleccionar** de nuevo.</span><span class="sxs-lookup"><span data-stu-id="1ab74-259">For this tutorial, leave the default at 50 eDTUs, and click **Select** again.</span></span>
    1. <span data-ttu-id="1ab74-260">Haga clic en **Aceptar** para crear el grupo y para mover las bases de datos seleccionadas a este.</span><span class="sxs-lookup"><span data-stu-id="1ab74-260">Select **OK** to create the new pool and to move the selected databases into it.</span></span>

<span data-ttu-id="1ab74-261">Crear el grupo y mover las bases de datos tarda unos minutos.</span><span class="sxs-lookup"><span data-stu-id="1ab74-261">Creating the pool and moving the databases takes a few minutes.</span></span> <span data-ttu-id="1ab74-262">Al mover las bases de datos, permanecen en línea y totalmente accesibles hasta el último momento, cuando se cierran todas las conexiones abiertas.</span><span class="sxs-lookup"><span data-stu-id="1ab74-262">As databases are moved they remain online and fully accessible until the very last moment, at which point any open connections are closed.</span></span> <span data-ttu-id="1ab74-263">Siempre y cuando tenga alguna lógica de reintento, los clientes se conectarán a la base de datos en el nuevo grupo.</span><span class="sxs-lookup"><span data-stu-id="1ab74-263">As long as you have some retry logic, clients will then connect to the database in the new pool.</span></span>

<span data-ttu-id="1ab74-264">Vaya a **Pool2** (en el servidor *tenants1*) para abrir el grupo y supervisar su rendimiento.</span><span class="sxs-lookup"><span data-stu-id="1ab74-264">Browse to **Pool2** (on the *tenants1* server) to open the pool and monitor its performance.</span></span> <span data-ttu-id="1ab74-265">Si no lo ve, espere a que finalice el aprovisionamiento del nuevo grupo.</span><span class="sxs-lookup"><span data-stu-id="1ab74-265">If you don't see it, wait for provisioning of the new pool to complete.</span></span>

<span data-ttu-id="1ab74-266">Ahora verá que el uso de los recursos en *Pool1* ha disminuido y que *Pool2* tiene una carga similar.</span><span class="sxs-lookup"><span data-stu-id="1ab74-266">You now see that resource usage on *Pool1* has dropped and that *Pool2* is now similarly loaded.</span></span>

## <a name="manage-performance-of-a-single-database"></a><span data-ttu-id="1ab74-267">Administrar el rendimiento de una sola base de datos</span><span class="sxs-lookup"><span data-stu-id="1ab74-267">Manage performance of a single database</span></span>

<span data-ttu-id="1ab74-268">Si una base de datos de un grupo experimenta una carga elevada durante un tiempo prolongado, según la configuración de grupo, puede tender a dominar los recursos del grupo, lo cual puede afectar a otras bases de datos.</span><span class="sxs-lookup"><span data-stu-id="1ab74-268">If a single database in a pool experiences a sustained high load, depending on the pool configuration, it may tend to dominate the resources in the pool and impact other databases.</span></span> <span data-ttu-id="1ab74-269">Si es probable que la actividad continúe durante un tiempo, la base de datos se puede sacar temporalmente del grupo.</span><span class="sxs-lookup"><span data-stu-id="1ab74-269">If the activity is likely to continue for some time, the database can be temporarily moved out of the pool.</span></span> <span data-ttu-id="1ab74-270">Esto permite que la base de datos tenga los recursos adicionales necesarios y la aísla de las otras bases de datos.</span><span class="sxs-lookup"><span data-stu-id="1ab74-270">This allows the database to have the extra resources it needs, and isolates it from the other databases.</span></span>

<span data-ttu-id="1ab74-271">En este ejercicio se simula el efecto de una carga elevada en Contoso Concert Hall cuando se venden entradas para un concierto popular.</span><span class="sxs-lookup"><span data-stu-id="1ab74-271">This exercise simulates the effect of Contoso Concert Hall experiencing a high load when tickets go on sale for a popular concert.</span></span>

1. <span data-ttu-id="1ab74-272">Abra el script …\\*Demo-PerformanceMonitoringAndManagement.ps1*.</span><span class="sxs-lookup"><span data-stu-id="1ab74-272">Open the …\\*Demo-PerformanceMonitoringAndManagement.ps1* script.</span></span>
1. <span data-ttu-id="1ab74-273">Establezca **$DemoScenario = 5, Generación de una carga normal y una carga elevada en un solo inquilino (aprox. 95 DTU).**</span><span class="sxs-lookup"><span data-stu-id="1ab74-273">Set **$DemoScenario = 5, Generate a normal load plus a high load on a single tenant (approx. 95 DTU).**</span></span>
1. <span data-ttu-id="1ab74-274">Establezca **$SingleTenantDatabaseName = contosoconcerthall**</span><span class="sxs-lookup"><span data-stu-id="1ab74-274">Set **$SingleTenantDatabaseName = contosoconcerthall**</span></span>
1. <span data-ttu-id="1ab74-275">Ejecute el script con **F5**.</span><span class="sxs-lookup"><span data-stu-id="1ab74-275">Execute the script using **F5**.</span></span>


1. <span data-ttu-id="1ab74-276">En [Azure Portal](https://portal.azure.com) abra **Pool1**.</span><span class="sxs-lookup"><span data-stu-id="1ab74-276">In the [Azure portal](https://portal.azure.com) open **Pool1**.</span></span>
1. <span data-ttu-id="1ab74-277">Inspeccione el gráfico **Supervisión de grupo elástico** y busque el aumento de uso de eDTU en el grupo.</span><span class="sxs-lookup"><span data-stu-id="1ab74-277">Inspect the **Elastic pool monitoring** chart and look for the increased pool eDTU usage.</span></span> <span data-ttu-id="1ab74-278">Pasado un minuto o dos, la carga mayor entrará en vigor rápidamente y verá que el grupo alcanza el 100 % de uso.</span><span class="sxs-lookup"><span data-stu-id="1ab74-278">After a minute or two, the higher load should start to kick in, and you should quickly see that the pool hits 100% utilization.</span></span>
1. <span data-ttu-id="1ab74-279">Observe la pantalla **Supervisión de bases de datos elásticas** que muestra las bases de datos principales de la última hora.</span><span class="sxs-lookup"><span data-stu-id="1ab74-279">Inspect the **Elastic database monitoring** display which shows the hottest databases in the past hour.</span></span> <span data-ttu-id="1ab74-280">La base de datos *contosoconcerthall* pronto debería aparecer como una de las cinco bases de datos principales.</span><span class="sxs-lookup"><span data-stu-id="1ab74-280">The *contosoconcerthall* database should soon appear as one of the five hottest databases.</span></span>
1. <span data-ttu-id="1ab74-281">**Haga clic en el gráfico Supervisión de bases de datos elásticas** y se abre la **página** **Uso de recursos de base de datos** donde puede supervisar cualquier base de datos.</span><span class="sxs-lookup"><span data-stu-id="1ab74-281">**Click on the Elastic database monitoring** **chart** and it opens the **Database Resource Utilization** page where you can monitor any of the databases.</span></span> <span data-ttu-id="1ab74-282">Esto le permite aislar la presentación de la base de datos *contosoconcerthall*.</span><span class="sxs-lookup"><span data-stu-id="1ab74-282">This lets you isolate the display for the *contosoconcerthall* database.</span></span>
1. <span data-ttu-id="1ab74-283">En la lista de bases de datos, haga clic en **contosoconcerthall**.</span><span class="sxs-lookup"><span data-stu-id="1ab74-283">From the list of databases, click **contosoconcerthall**.</span></span>
1. <span data-ttu-id="1ab74-284">Haga clic en **Plan de tarifa (escalar DTU)** para abrir la página **Configurar rendimiento** donde puede establecer un nivel de rendimiento independiente para la base de datos.</span><span class="sxs-lookup"><span data-stu-id="1ab74-284">Click **Pricing Tier (scale DTUs)** to open the **Configure performance** page where you can set a stand-alone performance level for the database.</span></span>
1. <span data-ttu-id="1ab74-285">Haga clic en la pestaña **Estándar** para abrir las opciones de escalado del nivel Estándar.</span><span class="sxs-lookup"><span data-stu-id="1ab74-285">Click on the **Standard** tab to open the scale options in the Standard tier.</span></span>
1. <span data-ttu-id="1ab74-286">Deslice el **control deslizante de las DTU** a la derecha para seleccionar **100** DTU.</span><span class="sxs-lookup"><span data-stu-id="1ab74-286">Slide the **DTU slider** to right to select **100** DTUs.</span></span> <span data-ttu-id="1ab74-287">Tenga en cuenta que esto se corresponde con el objetivo de servicio, **S3**.</span><span class="sxs-lookup"><span data-stu-id="1ab74-287">Note this corresponds to the service objective, **S3**.</span></span>
1. <span data-ttu-id="1ab74-288">Haga clic en **Aplicar** para sacar la base de datos del grupo y convertirla en una base de datos *S3 Estándar*.</span><span class="sxs-lookup"><span data-stu-id="1ab74-288">Click **Apply** to move the database out of the pool and make it a *Standard S3* database.</span></span>
1. <span data-ttu-id="1ab74-289">Una vez completado el escalado, supervise el efecto sobre la base de datos contosoconcerthall y Pool1 en las hojas de base de datos y grupos elásticos.</span><span class="sxs-lookup"><span data-stu-id="1ab74-289">Once scaling is complete, monitor the effect on the contosoconcerthall database and Pool1 on the elastic pool and database blades.</span></span>

<span data-ttu-id="1ab74-290">Una vez que desaparezca el exceso de carga de la base de datos contosoconcerthall debe devolverla rápidamente al grupo para reducir el coste.</span><span class="sxs-lookup"><span data-stu-id="1ab74-290">Once the high load on the contosoconcerthall database subsides you should promptly return it to the pool to reduce its cost.</span></span> <span data-ttu-id="1ab74-291">Si no es evidente cuándo ocurrirá esto, podría establecer una alerta en la base de datos que se active cuando el uso de DTU descienda por debajo del máximo por base de datos establecido para el grupo.</span><span class="sxs-lookup"><span data-stu-id="1ab74-291">If it’s unclear when that will happen you could set an alert on the database that will trigger when its DTU usage drops below the per-database max on the pool.</span></span> <span data-ttu-id="1ab74-292">El movimiento de una base de datos a un grupo se describe en el ejercicio 5.</span><span class="sxs-lookup"><span data-stu-id="1ab74-292">Moving a database into a pool is described in exercise 5.</span></span>

## <a name="other-performance-management-patterns"></a><span data-ttu-id="1ab74-293">Otros modelos de administración del rendimiento</span><span class="sxs-lookup"><span data-stu-id="1ab74-293">Other Performance Management Patterns</span></span>

<span data-ttu-id="1ab74-294">**Escalado preventivo** En el ejercicio anterior donde exploramos cómo escalar una base de datos aislada, sabía la base de datos que buscaba.</span><span class="sxs-lookup"><span data-stu-id="1ab74-294">**Pre-emptive scaling** In the exercise above where you explored how to scale an isolated database, you knew which database to look for.</span></span> <span data-ttu-id="1ab74-295">Si la administración de Contoso Concert Hall había informado a Wingtip de la venta inminente de entradas, la base de datos podía haberse sacado del grupo de manera preventiva.</span><span class="sxs-lookup"><span data-stu-id="1ab74-295">If the management of Contoso Concert Hall had informed Wingtips of the impending ticket sale, the database could have been moved out of the pool pre-emptively.</span></span> <span data-ttu-id="1ab74-296">De lo contrario, probablemente se hubiera necesitado una alerta en el grupo o la base de datos permite detectar lo que estaba pasando.</span><span class="sxs-lookup"><span data-stu-id="1ab74-296">Otherwise, it would likely have required an alert on the pool or the database to spot what was happening.</span></span> <span data-ttu-id="1ab74-297">No le gustaría que le informaran de esto los otros inquilinos del grupo con quejas sobre el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="1ab74-297">You wouldn’t want to learn about this from the other tenants in the pool complaining of degraded performance.</span></span> <span data-ttu-id="1ab74-298">Y si el inquilino puede predecir durante cuánto tiempo necesita recursos adicionales, podrá configurar un runbook de Azure Automation para sacar la base de datos del grupo y volverla a meter según un programa determinado.</span><span class="sxs-lookup"><span data-stu-id="1ab74-298">And if the tenant can predict how long they will need additional resources you can set up an Azure Automation runbook to move the database out of the pool and then back in again on a defined schedule.</span></span>

<span data-ttu-id="1ab74-299">**Autoservicio de escalado de inquilinos**. Como el escalado es una tarea que se llama fácilmente a través de la API de administración, puede crear fácilmente la capacidad de escalar las bases de datos de inquilinos en la aplicación de inquilino y ofrecerla como característica del servicio SaaS.</span><span class="sxs-lookup"><span data-stu-id="1ab74-299">**Tenant self-service scaling** Because scaling is a task easily called via the management API, you can easily build the ability to scale tenant databases into your tenant-facing application, and offer it as a feature of your SaaS service.</span></span> <span data-ttu-id="1ab74-300">Por ejemplo, puede permitir que los inquilinos se autoadministren el escalado y la reducción vertical y quizá vincularlo directamente a su facturación.</span><span class="sxs-lookup"><span data-stu-id="1ab74-300">For example, let tenants self-administer scaling up and down, perhaps linked directly to their billing!</span></span>

<span data-ttu-id="1ab74-301">**Escalado y reducción vertical de un grupo según un programa para cumplir patrones de uso**</span><span class="sxs-lookup"><span data-stu-id="1ab74-301">**Scaling a pool up and down on a schedule to match usage patterns**</span></span>

<span data-ttu-id="1ab74-302">Cuando el uso global de los inquilinos siga patrones previsibles, puede utilizar Azure Automation para escalar y reducir verticalmente un grupo según un programa.</span><span class="sxs-lookup"><span data-stu-id="1ab74-302">Where aggregate tenant usage follows predictable usage patterns, you can use Azure Automation to scale a pool up and down on a schedule.</span></span> <span data-ttu-id="1ab74-303">Por ejemplo, puede reducir un grupo verticalmente después de las 6 p.m. y escalarlo de nuevo antes de las 6 a.m. entre semana porque sabe que se necesitan menos recursos.</span><span class="sxs-lookup"><span data-stu-id="1ab74-303">For example, scale a pool down after 6pm and up again before 6am on weekdays when you know there is a drop in resource requirements.</span></span>



## <a name="next-steps"></a><span data-ttu-id="1ab74-304">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="1ab74-304">Next steps</span></span>

<span data-ttu-id="1ab74-305">En este tutorial, aprenderá a:</span><span class="sxs-lookup"><span data-stu-id="1ab74-305">In this tutorial you learn how to:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="1ab74-306">Simular el uso de las bases de datos de inquilinos mediante la ejecución de un generador de carga proporcionado</span><span class="sxs-lookup"><span data-stu-id="1ab74-306">Simulate usage on the tenant databases by running a provided load generator</span></span>
> * <span data-ttu-id="1ab74-307">Supervisar las bases de datos de inquilinos a medida que responden al aumento de carga</span><span class="sxs-lookup"><span data-stu-id="1ab74-307">Monitor the tenant databases as they respond to the increase in load</span></span>
> * <span data-ttu-id="1ab74-308">Escalar verticalmente el grupo elástico en respuesta al aumento de la carga en la base de datos</span><span class="sxs-lookup"><span data-stu-id="1ab74-308">Scale up the Elastic pool in response to the increased database load</span></span>
> * <span data-ttu-id="1ab74-309">Aprovisionar un segundo grupo elástico para equilibrar la actividad de la base de datos</span><span class="sxs-lookup"><span data-stu-id="1ab74-309">Provision a second Elastic pool to load balance the database activity</span></span>

[<span data-ttu-id="1ab74-310">Tutorial sobre la restauración de un único inquilino</span><span class="sxs-lookup"><span data-stu-id="1ab74-310">Restore a single tenant tutorial</span></span>](sql-database-saas-tutorial-restore-single-tenant.md)


## <a name="additional-resources"></a><span data-ttu-id="1ab74-311">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="1ab74-311">Additional resources</span></span>

* <span data-ttu-id="1ab74-312">Otros [tutoriales basados en la implementación de la aplicación SaaS de Wingtip](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="1ab74-312">Additional [tutorials that build upon the Wingtip SaaS application deployment](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="1ab74-313">Grupos elásticos de SQL</span><span class="sxs-lookup"><span data-stu-id="1ab74-313">SQL Elastic pools</span></span>](sql-database-elastic-pool.md)
* [<span data-ttu-id="1ab74-314">Azure Automation</span><span class="sxs-lookup"><span data-stu-id="1ab74-314">Azure automation</span></span>](../automation/automation-intro.md)
* <span data-ttu-id="1ab74-315">[Log Analytics](sql-database-saas-tutorial-log-analytics.md): tutorial de configuración y uso de Log Analytics</span><span class="sxs-lookup"><span data-stu-id="1ab74-315">[Log Analytics](sql-database-saas-tutorial-log-analytics.md) - Setting up and using Log Analytics tutorial</span></span>

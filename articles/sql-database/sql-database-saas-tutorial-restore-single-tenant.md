---
title: "Restauración de una base de datos SQL de Azure en una aplicación multiinquilino | Microsoft Docs"
description: "Obtenga información sobre cómo restaurar una base de datos SQL Database de inquilino único después de la eliminación accidental de datos"
keywords: tutorial de base de datos sql
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/10/2017
ms.author: billgib;sstein
ms.openlocfilehash: 547851972f13ec69a8f65d01290874ad7d07f192
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="restore-a-wingtip-saas-tenants-sql-database"></a><span data-ttu-id="ece84-104">Restaurar una base de datos SQL de inquilinos de SaaS Wingtip</span><span class="sxs-lookup"><span data-stu-id="ece84-104">Restore a Wingtip SaaS tenants SQL database</span></span>

<span data-ttu-id="ece84-105">La aplicación SaaS Wingtip se compila con un modelo de base de datos por inquilino, donde cada inquilino tiene su propia base de datos.</span><span class="sxs-lookup"><span data-stu-id="ece84-105">The Wingtip SaaS app is built using a database-per-tenant model, where each tenant has their own database.</span></span> <span data-ttu-id="ece84-106">Una de las ventajas de este modelo es que resulta fácil restaurar los datos de un inquilino único de manera aislada sin afectar a otros inquilinos.</span><span class="sxs-lookup"><span data-stu-id="ece84-106">One of the benefits of this model is that it is easy to restore a single tenant’s data in isolation without impacting other tenants.</span></span>

<span data-ttu-id="ece84-107">En este tutorial, conocerá dos patrones de recuperación de datos:</span><span class="sxs-lookup"><span data-stu-id="ece84-107">In this tutorial you learn two data recovery patterns:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="ece84-108">Restauración de una base de datos en una base de datos en paralelo (lado a lado)</span><span class="sxs-lookup"><span data-stu-id="ece84-108">Restore a database into a parallel database (side-by-side)</span></span>
> * <span data-ttu-id="ece84-109">Restauración de una base de datos en contexto</span><span class="sxs-lookup"><span data-stu-id="ece84-109">Restore a database in place</span></span>


|||
|:--|:--|
| <span data-ttu-id="ece84-110">**Restauración de una base de datos a un momento dado anterior, en una base de datos en paralelo**</span><span class="sxs-lookup"><span data-stu-id="ece84-110">**Restore tenant to a prior point in time, into a parallel database**</span></span> | <span data-ttu-id="ece84-111">El inquilino puede usar este patrón para revisión, auditoría, cumplimiento, etc. La base de datos original sigue en línea y sin modificaciones.</span><span class="sxs-lookup"><span data-stu-id="ece84-111">This pattern can be used by the tenant for review, auditing, compliance, etc. The original database remains online and unchanged.</span></span> |
| <span data-ttu-id="ece84-112">**Restauración de inquilino en contexto**</span><span class="sxs-lookup"><span data-stu-id="ece84-112">**Restore tenant in-place**</span></span> | <span data-ttu-id="ece84-113">Este patrón se usa habitualmente para recuperar un inquilino a un momento dado anterior, después de que un inquilino elimina datos por accidente.</span><span class="sxs-lookup"><span data-stu-id="ece84-113">This pattern is typically used to recover a tenant to a prior point in time, after a tenant accidentally deletes data.</span></span> <span data-ttu-id="ece84-114">La base de datos original se deja sin conexión y se reemplaza por la base de datos restaurada.</span><span class="sxs-lookup"><span data-stu-id="ece84-114">The original database is taken offline, and replaced with the restored database.</span></span> |
|||

<span data-ttu-id="ece84-115">Para completar este tutorial, asegúrese de cumplir los siguientes requisitos previos:</span><span class="sxs-lookup"><span data-stu-id="ece84-115">To complete this tutorial, make sure the following prerequisites are completed:</span></span>

* <span data-ttu-id="ece84-116">Se implementa la aplicación SaaS de Wingtip.</span><span class="sxs-lookup"><span data-stu-id="ece84-116">The Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="ece84-117">Para implementarla en menos de cinco minutos, consulte el artículo sobre la [implementación y exploración de la aplicación SaaS de Wingtip](sql-database-saas-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="ece84-117">To deploy in less than five minutes, see [Deploy and explore the Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="ece84-118">Azure PowerShell está instalado.</span><span class="sxs-lookup"><span data-stu-id="ece84-118">Azure PowerShell is installed.</span></span> <span data-ttu-id="ece84-119">Para más información, consulte [Introducción a Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span><span class="sxs-lookup"><span data-stu-id="ece84-119">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>

## <a name="introduction-to-the-saas-tenant-restore-pattern"></a><span data-ttu-id="ece84-120">Introducción al patrón de restauración de inquilino de SaaS</span><span class="sxs-lookup"><span data-stu-id="ece84-120">Introduction to the SaaS tenant restore pattern</span></span>

<span data-ttu-id="ece84-121">Para el patrón de restauración del inquilino, hay dos patrones simples para restaurar los datos de un inquilino individual.</span><span class="sxs-lookup"><span data-stu-id="ece84-121">For the tenant restore pattern, there are two simple patterns for restoring an individual tenant's data.</span></span> <span data-ttu-id="ece84-122">Debido a que las bases de datos de inquilino están aisladas entre sí, restaurar un inquilino no afecta los datos de los demás inquilinos.</span><span class="sxs-lookup"><span data-stu-id="ece84-122">Because tenant databases are isolated from each other, restoring one tenant has no impact on any other tenant's data.</span></span>

<span data-ttu-id="ece84-123">En el primer patrón, los datos se restauran en una base de datos nueva.</span><span class="sxs-lookup"><span data-stu-id="ece84-123">In the first pattern, data is restored into a new database.</span></span> <span data-ttu-id="ece84-124">Luego, el inquilino recibe acceso a esta base de datos junto con sus datos de producción.</span><span class="sxs-lookup"><span data-stu-id="ece84-124">The tenant is then given access to this database alongside their production data.</span></span> <span data-ttu-id="ece84-125">Este patrón permite que un administrador de inquilino revise los datos restaurados y posiblemente los use para sobrescribir de forma selectiva los valores de datos actuales.</span><span class="sxs-lookup"><span data-stu-id="ece84-125">This pattern allows a tenant admin to review the restored data and potentially use it to selectively overwrite current data values.</span></span> <span data-ttu-id="ece84-126">Depende del diseñador de aplicaciones SaaS determinar qué tan sofisticadas deben ser las opciones de recuperación de datos.</span><span class="sxs-lookup"><span data-stu-id="ece84-126">It's up to the SaaS app designer to determine just how sophisticated the data recovery options should be.</span></span> <span data-ttu-id="ece84-127">En algunos escenarios, puede que solo sea necesario que puedan revisar los datos en el estado que tenían en algún momento determinado.</span><span class="sxs-lookup"><span data-stu-id="ece84-127">Simply being able to review data in the state it was in at a given point in time may be all that is required in some scenarios.</span></span> <span data-ttu-id="ece84-128">Si la base de datos usa la [replicación geográfica](sql-database-geo-replication-overview.md), se recomienda copiar los datos necesarios de la copia restaurada en la base de datos original.</span><span class="sxs-lookup"><span data-stu-id="ece84-128">If the database uses [geo-replication](sql-database-geo-replication-overview.md), we recommend copying the required data from the restored copy into the original database.</span></span> <span data-ttu-id="ece84-129">Si reemplaza la base de datos original por la restaurada, debe volver a configurar y sincronizar la replicación geográfica.</span><span class="sxs-lookup"><span data-stu-id="ece84-129">If you replace the original database with the restored database, you need to reconfigure and resynchronize geo-replication.</span></span>

<span data-ttu-id="ece84-130">En el segundo patrón, que supone que el inquilino sufrió una pérdida o daños en los datos, la base de datos de producción del inquilino se restaura a un momento dado anterior.</span><span class="sxs-lookup"><span data-stu-id="ece84-130">In the second pattern, which assumes that the tenant has suffered a loss or corruption of data, the tenant’s production database is restored to a prior point in time.</span></span> <span data-ttu-id="ece84-131">En el patrón de restauración en contexto, el inquilino se deja sin conexión durante un tiempo breve mientras la base de datos se restaura y se vuelve a poner en línea.</span><span class="sxs-lookup"><span data-stu-id="ece84-131">In the restore in place pattern, the tenant is taken offline for a brief time while the database is restored and brought back online.</span></span> <span data-ttu-id="ece84-132">La base de datos original se elimina, pero de todos modos se puede hacer la restauración a partir de ella si necesita volver a un momento dado incluso anterior.</span><span class="sxs-lookup"><span data-stu-id="ece84-132">The original database is deleted, but can still be restored from if you need to go back to an even earlier point in time.</span></span> <span data-ttu-id="ece84-133">Una variación de este patrón podría cambiar el nombre de la base de datos en lugar de eliminar, a pesar de que cambiar el nombre no ofrece ninguna ventaja adicional en términos de la seguridad de los datos.</span><span class="sxs-lookup"><span data-stu-id="ece84-133">A variation of this pattern could rename the database instead of deleting it, although renaming the database offers no additional advantage in terms of data security.</span></span>

## <a name="get-the-wingtip-application-scripts"></a><span data-ttu-id="ece84-134">Obtener scripts de la aplicación Wingtip</span><span class="sxs-lookup"><span data-stu-id="ece84-134">Get the Wingtip application scripts</span></span>

<span data-ttu-id="ece84-135">Los scripts SaaS de Wingtip y el código fuente de la aplicación están disponibles en el repositorio de GitHub [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS).</span><span class="sxs-lookup"><span data-stu-id="ece84-135">The Wingtip SaaS scripts and application source code are available in the [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="ece84-136">[Pasos para descargar los scripts SaaS de Wingtip](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="ece84-136">[Steps to download the Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>

## <a name="simulate-a-tenant-accidentally-deleting-data"></a><span data-ttu-id="ece84-137">Simulación de la eliminación accidental de los datos de un inquilino</span><span class="sxs-lookup"><span data-stu-id="ece84-137">Simulate a tenant accidentally deleting data</span></span>

<span data-ttu-id="ece84-138">Para mostrar estos escenarios de recuperación, es necesario eliminar *accidentalmente* algunos datos en una de las bases de datos del inquilino.</span><span class="sxs-lookup"><span data-stu-id="ece84-138">To demonstrate these recovery scenarios, we need to *accidentally* delete some data in one of the tenant databases.</span></span> <span data-ttu-id="ece84-139">Aunque puede eliminar cualquier registro, en el paso siguiente la demostración se configura para que no se bloquee por infracciones a la integridad referencial.</span><span class="sxs-lookup"><span data-stu-id="ece84-139">While you can delete any record, the next step sets up the demo to not get blocked by referential integrity violations!</span></span> <span data-ttu-id="ece84-140">También se agregan algunos datos de compra de entradas que puede usar más adelante en los *tutoriales de Analytics de SaaS Wingtip*.</span><span class="sxs-lookup"><span data-stu-id="ece84-140">It also adds some ticket purchase data you can use later in the *Wingtip SaaS Analytics tutorials*.</span></span>

<span data-ttu-id="ece84-141">Ejecute el script del generador de entradas y cree datos adicionales.</span><span class="sxs-lookup"><span data-stu-id="ece84-141">Run the ticket generator script and create additional data.</span></span> <span data-ttu-id="ece84-142">De manera intencional, el generador de entradas no compra entradas para el último evento de cada inquilino.</span><span class="sxs-lookup"><span data-stu-id="ece84-142">The ticket generator intentionally does not purchase tickets for each tenants last event.</span></span>

1. <span data-ttu-id="ece84-143">Abra ...\\Learning Modules\\Utilities\\*Demo-TicketGenerator.ps1* en *PowerShell ISE*</span><span class="sxs-lookup"><span data-stu-id="ece84-143">Open ...\\Learning Modules\\Utilities\\*Demo-TicketGenerator.ps1* in the *PowerShell ISE*</span></span>
1. <span data-ttu-id="ece84-144">Presione **F5** para ejecutar el script y generar datos de ventas de entradas y clientes.</span><span class="sxs-lookup"><span data-stu-id="ece84-144">Press **F5** to run the script and generate customers and ticket sales data.</span></span>


### <a name="open-the-events-app-to-review-the-current-events"></a><span data-ttu-id="ece84-145">Apertura de la aplicación Eventos para revisar los eventos actuales</span><span class="sxs-lookup"><span data-stu-id="ece84-145">Open the Events app to review the current events</span></span>

1. <span data-ttu-id="ece84-146">Abra *Events Hub* (http://events.wtp.&lt;user&gt;.trafficmanager.net) y haga clic en **Contoso Concert Hall**:</span><span class="sxs-lookup"><span data-stu-id="ece84-146">Open the *Events Hub* (http://events.wtp.&lt;user&gt;.trafficmanager.net) and click **Contoso Concert Hall**:</span></span>

   ![events hub](media/sql-database-saas-tutorial-restore-single-tenant/events-hub.png)

1. <span data-ttu-id="ece84-148">Desplace la lista de eventos y anote el último evento de la lista:</span><span class="sxs-lookup"><span data-stu-id="ece84-148">Scroll the list of events and make a note of the last event in the list:</span></span>

   ![último evento](media/sql-database-saas-tutorial-restore-single-tenant/last-event.png)


### <a name="run-the-demo-scenario-to-accidentally-delete-the-last-event"></a><span data-ttu-id="ece84-150">Ejecute el escenario de demostración para eliminar accidentalmente el último evento</span><span class="sxs-lookup"><span data-stu-id="ece84-150">Run the demo scenario to accidentally delete the last event</span></span>

1. <span data-ttu-id="ece84-151">Abra ...\\Learning Modules\\Business Continuity and Disaster Recovery\\RestoreTenant\\*Demo-RestoreTenant.ps1* en *PowerShell ISE* y establezca el valor siguiente:</span><span class="sxs-lookup"><span data-stu-id="ece84-151">Open ...\\Learning Modules\\Business Continuity and Disaster Recovery\\RestoreTenant\\*Demo-RestoreTenant.ps1* in the *PowerShell ISE*, and set the following value:</span></span>
   * <span data-ttu-id="ece84-152">**$DemoScenario** = **1**. Establezca el valor en **1** para eliminar eventos sin venta de entradas.</span><span class="sxs-lookup"><span data-stu-id="ece84-152">**$DemoScenario** = **1**, Set to **1** - Delete events with no ticket sales.</span></span>
1. <span data-ttu-id="ece84-153">Presione **F5** para ejecutar el script y eliminar el último evento.</span><span class="sxs-lookup"><span data-stu-id="ece84-153">Press **F5** to run the script and delete the last event.</span></span> <span data-ttu-id="ece84-154">Debe ver un mensaje de confirmación similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="ece84-154">You should see a confirmation message similar to the following:</span></span>

   ```Console
   Deleting unsold events from Contoso Concert Hall ...
   Deleted event 'Seriously Strauss' from Contoso Concert Hall venue.
   ```

1. <span data-ttu-id="ece84-155">Se abre la página de eventos de Contoso.</span><span class="sxs-lookup"><span data-stu-id="ece84-155">The Contoso events page opens.</span></span> <span data-ttu-id="ece84-156">Desplácese hacia abajo y compruebe que el evento desapareció.</span><span class="sxs-lookup"><span data-stu-id="ece84-156">Scroll down and verify the event is gone.</span></span> <span data-ttu-id="ece84-157">Si todavía está en la lista, haga clic para actualizar y compruebe que ya no aparece.</span><span class="sxs-lookup"><span data-stu-id="ece84-157">If the event is still in the list, click refresh and verify it is gone.</span></span>

   ![último evento](media/sql-database-saas-tutorial-restore-single-tenant/last-event-deleted.png)


## <a name="restore-a-tenant-database-in-parallel-with-the-production-database"></a><span data-ttu-id="ece84-159">Restauración de una base de datos de inquilino en paralelo con la base de datos de producción</span><span class="sxs-lookup"><span data-stu-id="ece84-159">Restore a tenant database in parallel with the production database</span></span>

<span data-ttu-id="ece84-160">En este ejercicio se restaura la base de datos de Contoso Concert Hall a un momento específico antes de que se eliminara el evento.</span><span class="sxs-lookup"><span data-stu-id="ece84-160">This exercise restores the Contoso Concert Hall database to a point in time before the event was deleted.</span></span> <span data-ttu-id="ece84-161">Una vez que el evento se eliminó en los pasos anteriores, desea recuperar y ver los datos eliminados.</span><span class="sxs-lookup"><span data-stu-id="ece84-161">After the event is deleted in the previous steps, you want to recover and see the deleted data.</span></span> <span data-ttu-id="ece84-162">No es necesario restaurar la base de datos de producción con el registro eliminado, pero sí tiene que recuperar la base de datos anterior para tener acceso a los datos antiguos por otros motivos de negocio.</span><span class="sxs-lookup"><span data-stu-id="ece84-162">You don't need to restore your production database with the deleted record, but you need to recover the old database to access the old data for other business reasons.</span></span>

 <span data-ttu-id="ece84-163">El script *Restore-TenantInParallel.ps1* crea una base de datos de inquilino en paralelo y una entrada de catálogo en paralelo, ambos denominados *ContosoConcertHall\_old*.</span><span class="sxs-lookup"><span data-stu-id="ece84-163">The *Restore-TenantInParallel.ps1* script creates a parallel tenant database, and a parallel catalog entry both named *ContosoConcertHall\_old*.</span></span> <span data-ttu-id="ece84-164">Este patrón de restauración es más adecuado para recuperarse de una pérdida de datos sin importancia o para escenarios de recuperación de cumplimiento y auditoría.</span><span class="sxs-lookup"><span data-stu-id="ece84-164">This pattern of restore is best suited for recovering from a minor data loss or for compliance and auditing recovery scenarios.</span></span> <span data-ttu-id="ece84-165">También es el enfoque que se recomienda cuando se usa la [replicación geográfica](sql-database-geo-replication-overview.md).</span><span class="sxs-lookup"><span data-stu-id="ece84-165">It is also the recommended approach when you are using [geo-replication](sql-database-geo-replication-overview.md).</span></span>

1. <span data-ttu-id="ece84-166">Complete la sección en que se [simula que un usuario elimina datos de forma accidental](#simulate-a-tenant-accidentally-deleting-data).</span><span class="sxs-lookup"><span data-stu-id="ece84-166">Complete the [simulate a user accidentally deleting data](#simulate-a-tenant-accidentally-deleting-data) section.</span></span>
1. <span data-ttu-id="ece84-167">Abra ...\\Learning Modules\\Business Continuity and Disaster Recovery\\RestoreTenant\\_Demo-RestoreTenant.ps1_ en *PowerShell ISE*.</span><span class="sxs-lookup"><span data-stu-id="ece84-167">Open ...\\Learning Modules\\Business Continuity and Disaster Recovery\\RestoreTenant\\_Demo-RestoreTenant.ps1_ in the *PowerShell ISE*.</span></span>
1. <span data-ttu-id="ece84-168">Establezca **$DemoScenario** = **2**; establezca este valor en **2** para *restaurar el inquilino en paralelo*.</span><span class="sxs-lookup"><span data-stu-id="ece84-168">Set **$DemoScenario** = **2**, Set this to **2** to *Restore tenant in parallel*.</span></span>
1. <span data-ttu-id="ece84-169">Presione **F5** para ejecutar el script.</span><span class="sxs-lookup"><span data-stu-id="ece84-169">Press **F5** to run the script.</span></span>

<span data-ttu-id="ece84-170">El script restaura la base de datos de inquilino (a una base de datos en paralelo) a un momento dado antes de la eliminación del evento que realizó en la sección anterior.</span><span class="sxs-lookup"><span data-stu-id="ece84-170">The script restores the tenant database (to a parallel database) to a point in time before you deleted the event in the previous section.</span></span> <span data-ttu-id="ece84-171">Crea una segunda base de datos, quita cualquier metadato de catálogo existente en esta base de datos y agrega la base de datos al catálogo en la entrada *ContosoConcertHall\_old*.</span><span class="sxs-lookup"><span data-stu-id="ece84-171">It creates a second database, removes any existing catalog metadata that exists in this database, and adds the database to the catalog under the *ContosoConcertHall\_old* entry.</span></span>

<span data-ttu-id="ece84-172">El script de demostración abre la página de eventos en el explorador.</span><span class="sxs-lookup"><span data-stu-id="ece84-172">The demo script opens the events page in your browser.</span></span> <span data-ttu-id="ece84-173">En la dirección URL: ```http://events.wtp.&lt;user&gt;.trafficmanager.net/contosoconcerthall_old```, tenga en cuenta que se muestran los datos de la base de datos restaurada, donde se agrega *_old* al nombre.</span><span class="sxs-lookup"><span data-stu-id="ece84-173">Note from the URL: ```http://events.wtp.&lt;user&gt;.trafficmanager.net/contosoconcerthall_old``` that this is showing data from the restored database where *_old* is added to the name.</span></span>

<span data-ttu-id="ece84-174">Desplace los eventos que aparecen en el explorador y confirmar que se restauró el evento que se eliminó en la sección anterior.</span><span class="sxs-lookup"><span data-stu-id="ece84-174">Scroll the events listed in the browser to confirm that the event deleted in the previous section has been restored.</span></span>

<span data-ttu-id="ece84-175">Tenga en cuenta que exponer al inquilino restaurado como un inquilino adicional, con su propia aplicación de eventos para examinar entradas, puede que no sea la forma en que proporcionaría acceso de inquilino a los datos restaurados, pero sí sirve para ilustrar fácilmente el patrón de restauración.</span><span class="sxs-lookup"><span data-stu-id="ece84-175">Note that exposing the restored tenant as an additional tenant, with its own Events app to browse tickets, is unlikely to be how you would provide a tenant access to restored data, but serves to easily illustrate the restore pattern.</span></span>

<span data-ttu-id="ece84-176">En realidad, es probable que solo debería retener esta base de datos restaurada durante un período definido.</span><span class="sxs-lookup"><span data-stu-id="ece84-176">In reality, you would probably only retain this restored database for a defined period.</span></span> <span data-ttu-id="ece84-177">Puede eliminar la entrada del inquilino restaurado una vez que finalice; para ello, debe llamar al script *Remove-RestoredTenant.ps1*.</span><span class="sxs-lookup"><span data-stu-id="ece84-177">You can delete the restored tenant entry once you are finished by calling the *Remove-RestoredTenant.ps1* script.</span></span>

1. <span data-ttu-id="ece84-178">Establezca **$DemoScenario** en **4** para seleccionar el escenario en que se *quita el inquilino restaurado*.</span><span class="sxs-lookup"><span data-stu-id="ece84-178">Set **$DemoScenario** to **4** to select the *remove restored tenant* scenario.</span></span>
1. <span data-ttu-id="ece84-179">**Ejecute** **con** **F5**</span><span class="sxs-lookup"><span data-stu-id="ece84-179">**Execute** **using** **F5**</span></span>
1. <span data-ttu-id="ece84-180">La entrada *ContosoConcertHall\_old* se eliminó del catálogo.</span><span class="sxs-lookup"><span data-stu-id="ece84-180">The *ContosoConcertHall\_old* entry is now deleted from the catalog.</span></span> <span data-ttu-id="ece84-181">Continúe y cierre la página de eventos de este inquilino en el explorador.</span><span class="sxs-lookup"><span data-stu-id="ece84-181">Go ahead and close the events page for this tenant in your browser.</span></span>


## <a name="restore-a-tenant-in-place-replacing-the-existing-tenant-database"></a><span data-ttu-id="ece84-182">Restauración de un inquilino en contexto, reemplazando la base de datos de inquilino existente</span><span class="sxs-lookup"><span data-stu-id="ece84-182">Restore a tenant in place, replacing the existing tenant database</span></span>

<span data-ttu-id="ece84-183">En este ejercicio se restaura el inquilino de Contoso Concert Hall a un momento específico antes de que se eliminara el evento.</span><span class="sxs-lookup"><span data-stu-id="ece84-183">This exercise restores the Contoso Concert Hall tenant to a point in time before the event was deleted.</span></span> <span data-ttu-id="ece84-184">El script *Restore-TenantInPlace* restaura la base de datos de inquilino actual a una base de datos nueva que señala un momento dado anterior y elimina la base de datos original.</span><span class="sxs-lookup"><span data-stu-id="ece84-184">The *Restore-TenantInPlace* script restores the current tenant database to a new database pointing to a previous point in time, and deletes the original database.</span></span> <span data-ttu-id="ece84-185">Este patrón de restauración es más adecuado para la recuperación después de daños graves en los datos, porque puede haber una mayor pérdida de datos a la que debe adecuarse el inquilino.</span><span class="sxs-lookup"><span data-stu-id="ece84-185">This pattern of restore is best suited for recovering from serious data corruption as there may be significant data loss that the tenant would have to accommodate.</span></span>

1. <span data-ttu-id="ece84-186">Abra el archivo **Demo-RestoreTenant.ps1** en PowerShell ISE</span><span class="sxs-lookup"><span data-stu-id="ece84-186">Open **Demo-RestoreTenant.ps1** file in PowerShell ISE</span></span>
1. <span data-ttu-id="ece84-187">Establezca **$DemoScenario** en **5** para seleccionar el *escenario de restauración de inquilino en contexto*.</span><span class="sxs-lookup"><span data-stu-id="ece84-187">Set **$DemoScenario** to **5** to select the *restore tenant in place scenario*.</span></span>
1. <span data-ttu-id="ece84-188">Ejecute con **F5**.</span><span class="sxs-lookup"><span data-stu-id="ece84-188">Execute using **F5**.</span></span>

<span data-ttu-id="ece84-189">El script restaura la base de datos de inquilino a un punto cinco minutos antes de que se eliminara el evento.</span><span class="sxs-lookup"><span data-stu-id="ece84-189">The script restores the tenant database to a point five minutes before the event was deleted.</span></span> <span data-ttu-id="ece84-190">Para ello, primero deja sin conexión al inquilino Contoso Concert Hall para que no haya actualizaciones adicionales a los datos.</span><span class="sxs-lookup"><span data-stu-id="ece84-190">It does this by first taking the Contoso Concert Hall tenant offline so there are no further updates to the data.</span></span> <span data-ttu-id="ece84-191">Luego se crea una base de datos en paralelo a partir de la restauración desde un punto de restauración, con una marca de tiempo como nombre para garantizar que el nombre de la base de datos no entre en conflicto con el nombre de la base de datos de inquilino existente.</span><span class="sxs-lookup"><span data-stu-id="ece84-191">Then, a parallel database is created by restoring from the restore point and named with a timestamp to ensure the database name does not conflict with the existing tenant database name.</span></span> <span data-ttu-id="ece84-192">A continuación, se elimina la base de datos de inquilino anterior y el nombre de la base de datos restaurada se cambia al nombre de la base de datos original.</span><span class="sxs-lookup"><span data-stu-id="ece84-192">Next, the old tenant database is deleted, and the restored database is renamed to the original database name.</span></span> <span data-ttu-id="ece84-193">Por último, Contoso Concert Hall se vuelve a conectar para permitir que la aplicación tenga acceso a la base de datos restaurada.</span><span class="sxs-lookup"><span data-stu-id="ece84-193">Finally, Contoso Concert Hall is brought online to allow the app access to the restored database.</span></span>

<span data-ttu-id="ece84-194">La base de datos se restauró correctamente a un momento dado antes de que se eliminara el evento.</span><span class="sxs-lookup"><span data-stu-id="ece84-194">You successfully restored the database to a point in time before the event was deleted.</span></span> <span data-ttu-id="ece84-195">Se abrirá la página de eventos, donde debe confirmar que se restauró el último evento.</span><span class="sxs-lookup"><span data-stu-id="ece84-195">The Events page opens, so confirm the last event has been restored.</span></span>


## <a name="next-steps"></a><span data-ttu-id="ece84-196">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="ece84-196">Next steps</span></span>

<span data-ttu-id="ece84-197">En este tutorial aprendió lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="ece84-197">In this tutorial, you learned how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="ece84-198">Restauración de una base de datos en una base de datos en paralelo (lado a lado)</span><span class="sxs-lookup"><span data-stu-id="ece84-198">Restore a database into a parallel database (side-by-side)</span></span>
> * <span data-ttu-id="ece84-199">Restauración de una base de datos en contexto</span><span class="sxs-lookup"><span data-stu-id="ece84-199">Restore a database in place</span></span>

[<span data-ttu-id="ece84-200">Administración de un esquema de base de datos de inquilino</span><span class="sxs-lookup"><span data-stu-id="ece84-200">Manage tenant database schema</span></span>](sql-database-saas-tutorial-schema-management.md)

## <a name="additional-resources"></a><span data-ttu-id="ece84-201">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="ece84-201">Additional resources</span></span>

* <span data-ttu-id="ece84-202">Otros [tutoriales basados en la aplicación SaaS de Wingtip](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="ece84-202">Additional [tutorials that build upon the Wingtip SaaS application](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="ece84-203">Introducción a la continuidad empresarial con Base de datos SQL de Azure</span><span class="sxs-lookup"><span data-stu-id="ece84-203">Overview of business continuity with Azure SQL Database</span></span>](sql-database-business-continuity.md)
* [<span data-ttu-id="ece84-204">Más información sobre las copias de seguridad de SQL Database</span><span class="sxs-lookup"><span data-stu-id="ece84-204">Learn about SQL Database backups</span></span>](sql-database-automated-backups.md)

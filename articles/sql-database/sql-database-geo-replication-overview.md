---
title: "Grupos de conmutación por error y replicación geográfica activa: Azure SQL Database | Microsoft Docs"
description: "Los grupos de conmutación por error automática con replicación geográfica activa le permiten configurar 4 réplicas de la base de datos en cualquiera de los centros de datos de Azure y realizar conmutación por error automática en caso de una interrupción."
services: sql-database
documentationcenter: na
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 2a29f657-82fb-4283-9a83-e14a144bfd93
ms.service: sql-database
ms.custom: business continuity
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: NA
ms.date: 07/10/2017
ms.author: sashan
ms.openlocfilehash: 9a2171f59c6192115dc1820e7f033fd783c9e077
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/29/2017
---
# <a name="overview-failover-groups-and-active-geo-replication"></a><span data-ttu-id="e915e-103">Introducción: grupos de conmutación por error y replicación geográfica activa</span><span class="sxs-lookup"><span data-stu-id="e915e-103">Overview: Failover groups and active geo-replication</span></span>
<span data-ttu-id="e915e-104">La replicación geográfica activa le permite configurar hasta cuatro bases de datos secundarias legibles en las mismas ubicaciones de centros de datos (regiones) o en otras.</span><span class="sxs-lookup"><span data-stu-id="e915e-104">Active geo-replication enables you to configure up to four readable secondary databases in the same or different data center locations (regions).</span></span> <span data-ttu-id="e915e-105">Las bases de datos secundarias están disponibles para la consulta y la conmutación por error en caso de una interrupción del centro de datos o de imposibilidad para conectarse a la base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="e915e-105">Secondary databases are available for querying and for failover in the case of a data center outage or the inability to connect to the primary database.</span></span> <span data-ttu-id="e915e-106">La aplicación del usuario debe iniciar manualmente la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="e915e-106">The failover must be initiated manually by the application of the user.</span></span> <span data-ttu-id="e915e-107">Después de la conmutación por error, el nuevo elemento principal tiene un punto de conexión diferente.</span><span class="sxs-lookup"><span data-stu-id="e915e-107">After failover, the new primary has a different connection end-point.</span></span> 

> [!NOTE]
> <span data-ttu-id="e915e-108">La replicación geográfica activa está disponible para todas las bases de datos en todos los niveles de servicio de todas las regiones.</span><span class="sxs-lookup"><span data-stu-id="e915e-108">Active geo-replication is available for all databases in all service tiers in all regions.</span></span>
>  

<span data-ttu-id="e915e-109">Los grupos de conmutación por error automática de Azure SQL Database (en versión preliminar) son una característica de SQL Database que está diseñada para administrar automáticamente las relaciones de replicación geográfica, la conectividad y la conmutación por error a escala.</span><span class="sxs-lookup"><span data-stu-id="e915e-109">Azure SQL Database auto-failover groups (in-preview) is a SQL Database feature designed to automatically manage geo-replication relationship, connectivity, and failover at scale.</span></span> <span data-ttu-id="e915e-110">Con esta característica, los clientes obtienen la capacidad de recuperar automáticamente varias bases de datos relacionadas en la región secundaria después de errores regionales catastróficos u otros eventos no planeados que generen una pérdida total o parcial de la disponibilidad del servicio de SQL Database en la región primaria.</span><span class="sxs-lookup"><span data-stu-id="e915e-110">With it, the customers gain the ability to automatically recover multiple related databases in the secondary region after catastrophic regional failures or other unplanned events that result in full or partial loss of the SQL Database service’s availability in the primary region.</span></span> <span data-ttu-id="e915e-111">Además, pueden usar las bases de datos secundarias legibles para descargar las cargas de trabajo de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="e915e-111">Additionally, they can use the readable secondary databases to offload read-only workloads.</span></span>  <span data-ttu-id="e915e-112">Debido a que los grupos de conmutación por error automática implican varias bases de datos, se deben configurar en el servidor principal.</span><span class="sxs-lookup"><span data-stu-id="e915e-112">Because auto-failover groups involve multiple databases they must be configured on the primary server.</span></span> <span data-ttu-id="e915e-113">El servidor principal y el servidor secundario deben estar en la misma suscripción.</span><span class="sxs-lookup"><span data-stu-id="e915e-113">Both primary and secondary servers must be in the same subscription.</span></span> <span data-ttu-id="e915e-114">Los grupos de conmutación por error automática admiten la replicación de todas las bases de datos en el grupo solo a un servidor secundario en otra región.</span><span class="sxs-lookup"><span data-stu-id="e915e-114">Auto-failover groups support replication of all databases in the group to only one secondary server in a different region.</span></span> <span data-ttu-id="e915e-115">La replicación geográfica activa, sin grupos de conmutación por error automática, permite hasta 4 bases de datos secundarias en cualquier región.</span><span class="sxs-lookup"><span data-stu-id="e915e-115">Active geo-replication, without auto-failover groups, allows up to 4 secondaries in any region.</span></span>

<span data-ttu-id="e915e-116">Si usa la replicación geográfica activa y, por cualquier motivo, se produce un error en la base de datos principal o, simplemente, debe desconectarse, puede iniciar la conmutación por error a cualquiera de las bases de datos secundarias.</span><span class="sxs-lookup"><span data-stu-id="e915e-116">If you are using active geo-replication and for any reason your primary database fails, or simply needs to be taken offline, you can initiate failover to any of your secondary databases.</span></span> <span data-ttu-id="e915e-117">Cuando se activa la conmutación por error a una de las bases de datos secundarias, las demás bases de datos secundarias se vinculan automáticamente a la nueva base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="e915e-117">When failover is activated to one of the secondary databases, all other secondaries are automatically linked to the new primary.</span></span> <span data-ttu-id="e915e-118">Si usa los grupos de conmutación por error automática (en versión preliminar) para administrar la recuperación de bases de datos y cualquier interrupción que afecte a una o varias de las bases de datos del grupo, se realizará la conmutación por error automática.</span><span class="sxs-lookup"><span data-stu-id="e915e-118">If you are using auto-failover groups (in-preview) to manage database recovery and any outage that impacts one or several of the databases in the group results in automatic failover.</span></span> <span data-ttu-id="e915e-119">Puede configurar la directiva de conmutación por error automática que mejor se adapte a las necesidades de la aplicación, o bien puede decidir no usarla y, en su lugar, usar la activación manual.</span><span class="sxs-lookup"><span data-stu-id="e915e-119">You can configure the auto-failover policy that best meets your application needs, or you can opt out and use manual activation.</span></span> <span data-ttu-id="e915e-120">Además, los grupos de conmutación por error automática (en versión preliminar) proporcionan puntos de conexión de agentes de escucha de lectura-escritura y de solo lectura que no se modifican durante las conmutaciones por error.</span><span class="sxs-lookup"><span data-stu-id="e915e-120">In addition, auto-failover groups (in-preview) provide read-write and read-only listener end-points that remain unchanged during failovers.</span></span> <span data-ttu-id="e915e-121">Ya sea que use la activación de conmutación por error automática o manual, la conmutación por error transforma todas las bases de datos secundarias del grupo en primarias.</span><span class="sxs-lookup"><span data-stu-id="e915e-121">Whether you use manual or automatic failover activation, failover switches all secondary databases in the group to primary.</span></span> <span data-ttu-id="e915e-122">Una vez que la conmutación por error de una base de datos se completa, el registro de DNS se actualiza automáticamente para redirigir los puntos de conexión a la región nueva.</span><span class="sxs-lookup"><span data-stu-id="e915e-122">After the database failover is completed, the DNS record is automatically updated to redirect the end-points to the new region.</span></span>

<span data-ttu-id="e915e-123">Con la replicación geográfica activa puede administrar la replicación y la conmutación por error de una base de datos individual o de un conjunto de bases de datos en un servidor o en un grupo elástico.</span><span class="sxs-lookup"><span data-stu-id="e915e-123">You can manage replication and failover of an individual database or a set of databases on a server or in an elastic pool using active geo-replication.</span></span> <span data-ttu-id="e915e-124">Puede hacerlo en [Azure Portal](sql-database-geo-replication-portal.md), [PowerShell](sql-database-geo-replication-powershell.md), [Transact-SQL](sql-database-geo-replication-transact-sql.md) o la [API de REST](https://msdn.microsoft.com/library/azure/mt163685.aspx).</span><span class="sxs-lookup"><span data-stu-id="e915e-124">You can do that using the [Azure portal](sql-database-geo-replication-portal.md), [PowerShell](sql-database-geo-replication-powershell.md), [Transact-SQL](sql-database-geo-replication-transact-sql.md), or the [REST API](https://msdn.microsoft.com/library/azure/mt163685.aspx).</span></span> <span data-ttu-id="e915e-125">Después de la conmutación por error, asegúrese de que los requisitos de autenticación para el servidor y la base de datos se configuran en el nuevo elemento principal.</span><span class="sxs-lookup"><span data-stu-id="e915e-125">After failover, ensure the authentication requirements for your server and database are configured on the new primary.</span></span> <span data-ttu-id="e915e-126">Para obtener más información, consulte [Administración de la seguridad de Base de datos SQL de Azure después de la recuperación ante desastres](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="e915e-126">For details, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span> <span data-ttu-id="e915e-127">Esto se aplica a la replicación geográfica activa y a los grupos de conmutación por error automática (en versión preliminar).</span><span class="sxs-lookup"><span data-stu-id="e915e-127">This applies both to active geo-replication and auto-failover groups (in-preview).</span></span>

<span data-ttu-id="e915e-128">La replicación geográfica activa aprovecha la tecnología [AlwaysOn](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server) de SQL Server para replicar de forma asincrónica las transacciones confirmadas en la base de datos principal a una base de datos secundaria mediante aislamiento instantáneo de lectura confirmada (RCSI).</span><span class="sxs-lookup"><span data-stu-id="e915e-128">Active geo-replication leverages the [Always On](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server) technology of SQL Server to asynchronously replicate committed transactions on the primary database to a secondary database using read committed snapshot isolation (RCSI).</span></span> <span data-ttu-id="e915e-129">Los grupos de conmutación por error automática proporcionan la semántica de grupo sobre la replicación geográfica activa, pero se usa el mismo mecanismo de replicación asincrónico.</span><span class="sxs-lookup"><span data-stu-id="e915e-129">Auto-failover groups provide the group semantics on top of active geo-replication but the same asynchronous replication mechanism is used.</span></span> <span data-ttu-id="e915e-130">Mientras que, en cualquier momento dado, la base de datos secundaria puede ir ligeramente por detrás de la base de datos principal, se garantiza que los datos secundarios nunca tengan transacciones parciales.</span><span class="sxs-lookup"><span data-stu-id="e915e-130">While at any given point, the secondary database might be slightly behind the primary database, the secondary data is guaranteed to never have partial transactions.</span></span> <span data-ttu-id="e915e-131">La redundancia entre regiones permite que las aplicaciones se recuperen rápidamente de la pérdida permanente de todo un centro de datos, o de partes de él, causada por desastres naturales, errores humanos catastróficos o actos malintencionados.</span><span class="sxs-lookup"><span data-stu-id="e915e-131">Cross-region redundancy enables applications to quickly recover from a permanent loss of an entire datacenter or parts of a datacenter caused by natural disasters, catastrophic human errors, or malicious acts.</span></span> <span data-ttu-id="e915e-132">Los datos específicos de RPO se encuentran en [Introducción a la continuidad empresarial](sql-database-business-continuity.md).</span><span class="sxs-lookup"><span data-stu-id="e915e-132">The specific RPO data can be found at [Overview of Business Continuity](sql-database-business-continuity.md).</span></span>

<span data-ttu-id="e915e-133">En la siguiente ilustración, se muestra un ejemplo de replicación geográfica activa configurada con una principal en la región centro-norte de EE. UU. y una secundaria en la región centro-sur de EE. UU.</span><span class="sxs-lookup"><span data-stu-id="e915e-133">The following figure shows an example of active geo-replication configured with a primary in the North Central US region and secondary in the South Central US region.</span></span>

![Relación de replicación geográfica](./media/sql-database-active-geo-replication/geo-replication-relationship.png)

<span data-ttu-id="e915e-135">Debido a que las bases de datos secundarias son legibles, se pueden usar para descargar cargas de trabajo de solo lectura como trabajos de informes.</span><span class="sxs-lookup"><span data-stu-id="e915e-135">Because the secondary databases are readable, they can be used to offload read-only workloads such as reporting jobs.</span></span> <span data-ttu-id="e915e-136">Si usa la replicación geográfica activa, la base de datos secundaria se puede crear en la misma región que la base de datos primaria; sin embargo, esto no aumenta la resistencia de la aplicación ante errores catastróficos.</span><span class="sxs-lookup"><span data-stu-id="e915e-136">If you are using active geo-replication, it is possible to create the secondary database in the same region with the primary, but it does not increase the application's resilience to catastrophic failures.</span></span> <span data-ttu-id="e915e-137">Si usa grupos de conmutación por error automática (en versión preliminar), las bases de datos secundarias siempre se crean en otra región.</span><span class="sxs-lookup"><span data-stu-id="e915e-137">If you are using auto-failover groups (in-preview), your secondary database is always created in a different region.</span></span>

<span data-ttu-id="e915e-138">Además de para la recuperación ante desastres, la replicación geográfica activa se puede usar en los escenarios siguientes:</span><span class="sxs-lookup"><span data-stu-id="e915e-138">In addition to disaster recovery active geo-replication can be used in the following scenarios:</span></span>

* <span data-ttu-id="e915e-139">**Migración de base de datos**: puede usar la replicación geográfica activa para migrar una base de datos de un servidor a otro en línea con un tiempo de inactividad mínimo.</span><span class="sxs-lookup"><span data-stu-id="e915e-139">**Database migration**: You can use active geo-replication to migrate a database from one server to another online with minimum downtime.</span></span>
* <span data-ttu-id="e915e-140">**Actualizaciones de aplicaciones**: puede crear una base de datos secundaria adicional como copia de conmutación por recuperación durante las actualizaciones de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="e915e-140">**Application upgrades**: You can create an extra secondary as a fail back copy during application upgrades.</span></span>

<span data-ttu-id="e915e-141">Para lograr una verdadera continuidad empresarial, agregar redundancia de base de datos entre centros de datos es solo parte de la solución.</span><span class="sxs-lookup"><span data-stu-id="e915e-141">To achieve real business continuity, adding database redundancy between datacenters is only part of the solution.</span></span> <span data-ttu-id="e915e-142">Para recuperar una aplicación (un servicio) de un extremo a otro tras un error catastrófico, es necesario recuperar todos los componentes que constituyen el servicio y cualquier servicio dependiente.</span><span class="sxs-lookup"><span data-stu-id="e915e-142">Recovering an application (service) end-to-end after a catastrophic failure requires recovery of all components that constitute the service and any dependent services.</span></span> <span data-ttu-id="e915e-143">Algunos ejemplos de estos componentes son el software cliente (por ejemplo, un explorador con JavaScript personalizado), los front-end web, el almacenamiento y DNS.</span><span class="sxs-lookup"><span data-stu-id="e915e-143">Examples of these components include the client software (for example, a browser with a custom JavaScript), web front ends, storage, and DNS.</span></span> <span data-ttu-id="e915e-144">Es fundamental que todos los componentes sean resistentes a los mismos errores y que estén disponibles en el plazo del objetivo de tiempo de recuperación (RTO) de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="e915e-144">It is critical that all components are resilient to the same failures and become available within the recovery time objective (RTO) of your application.</span></span> <span data-ttu-id="e915e-145">Por lo tanto, debe identificar todos los servicios dependientes y comprender las garantías y capacidades que ofrecen.</span><span class="sxs-lookup"><span data-stu-id="e915e-145">Therefore, you need to identify all dependent services and understand the guarantees and capabilities they provide.</span></span> <span data-ttu-id="e915e-146">A continuación, debe seguir los pasos adecuados para asegurarse de que el servicio funcione durante la conmutación por error de los servicios de los que depende.</span><span class="sxs-lookup"><span data-stu-id="e915e-146">Then, you must take adequate steps to ensure that your service functions during the failover of the services on which it depends.</span></span> <span data-ttu-id="e915e-147">Para más información sobre el diseño de soluciones para la recuperación ante desastres, consulte [Diseño de soluciones de nube para la continuidad empresarial mediante la replicación geográfica activa](sql-database-designing-cloud-solutions-for-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="e915e-147">For more information about designing solutions for disaster recovery, see [Designing Cloud Solutions for Disaster Recovery Using active geo-replication](sql-database-designing-cloud-solutions-for-disaster-recovery.md).</span></span>

## <a name="active-geo-replication-capabilities"></a><span data-ttu-id="e915e-148">Funcionalidades de replicación geográfica activa</span><span class="sxs-lookup"><span data-stu-id="e915e-148">Active geo-replication capabilities</span></span>
<span data-ttu-id="e915e-149">La característica de replicación geográfica activa ofrece las siguientes funcionalidades esenciales:</span><span class="sxs-lookup"><span data-stu-id="e915e-149">The active geo-replication feature provides the following essential capabilities:</span></span>
* <span data-ttu-id="e915e-150">**Replicación asincrónica automática**: solo se puede crear una base de datos secundaria mediante la adición a una existente.</span><span class="sxs-lookup"><span data-stu-id="e915e-150">**Automatic Asynchronous Replication**: You can only create a secondary database by adding to an existing database.</span></span> <span data-ttu-id="e915e-151">La base de datos secundaria se puede crear en cualquier servidor de Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="e915e-151">The secondary can be created in any Azure SQL Database server.</span></span> <span data-ttu-id="e915e-152">Una vez creada, la base de datos secundaria se rellena con los datos copiados de la base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="e915e-152">Once created, the secondary database is populated with the data copied from the primary database.</span></span> <span data-ttu-id="e915e-153">Este proceso se conoce como propagación.</span><span class="sxs-lookup"><span data-stu-id="e915e-153">This process is known as seeding.</span></span> <span data-ttu-id="e915e-154">Después de crear y propagar la base de datos secundaria, las actualizaciones de la base de datos principal se replican asincrónicamente en la base de datos secundaria de forma automática.</span><span class="sxs-lookup"><span data-stu-id="e915e-154">After secondary database has been created and seeded, updates to the primary database are asynchronously replicated to the secondary database automatically.</span></span> <span data-ttu-id="e915e-155">La replicación asincrónica significa que las transacciones se confirman en la base de datos principal antes de replicarse en la secundaria.</span><span class="sxs-lookup"><span data-stu-id="e915e-155">Asynchronous replication means that transactions are committed on the primary database before they are replicated to the secondary database.</span></span> 
* <span data-ttu-id="e915e-156">**Bases de datos secundarias legibles**: una aplicación puede acceder a una base de datos secundaria para operaciones de solo lectura con las mismas entidades de seguridad que las usadas para tener acceso a la base de datos principal u otras diferentes.</span><span class="sxs-lookup"><span data-stu-id="e915e-156">**Readable secondary databases**: An application can access a secondary database for read-only operations using the same or different security principals used for accessing the primary database.</span></span> <span data-ttu-id="e915e-157">Las bases de datos secundarias funcionan en el modo de aislamiento de instantánea para asegurarse de que no se retrasa la replicación de las actualizaciones de la base de datos principal (reproducción de registro) por las consultas ejecutadas en la secundaria.</span><span class="sxs-lookup"><span data-stu-id="e915e-157">The secondary databases operate in snapshot isolation mode to ensure replication of the updates of the primary (log replay) is not delayed by queries executed on the secondary.</span></span>

   > [!NOTE]
   > <span data-ttu-id="e915e-158">La reproducción de registros se retrasa en la base de datos secundaria si las actualizaciones de esquema que está recibiendo desde la principal requieren que se bloquee el esquema en la base de datos secundaria.</span><span class="sxs-lookup"><span data-stu-id="e915e-158">The log replay is delayed on the secondary database if there are schema updates that it is receiving from the Primary that require a schema lock on the secondary database.</span></span> 
   > 

* <span data-ttu-id="e915e-159">**Varias bases de datos secundarias legibles**: dos o más bases de usuarios secundarias aumentan la redundancia y el nivel de protección de la base de datos principal y la aplicación.</span><span class="sxs-lookup"><span data-stu-id="e915e-159">**Multiple readable secondaries**: Two or more secondary databases increase redundancy and level of protection for the primary database and application.</span></span> <span data-ttu-id="e915e-160">Si existen varias bases de datos secundarias, la aplicación sigue estando protegida incluso si se produce un error en una de ellas.</span><span class="sxs-lookup"><span data-stu-id="e915e-160">If multiple secondary databases exist, the application remains protected even if one of the secondary databases fails.</span></span> <span data-ttu-id="e915e-161">Si solo hay una base de datos secundaria y se produce un error, la aplicación está expuesta a un mayor riesgo hasta que se crea una nueva base de datos secundaria.</span><span class="sxs-lookup"><span data-stu-id="e915e-161">If there is only one secondary database, and it fails, the application is exposed to higher risk until a new secondary database is created.</span></span>

   > [!NOTE]
   > <span data-ttu-id="e915e-162">Si usa la replicación geográfica activa para compilar una aplicación distribuida globalmente y necesita proporcionar acceso de solo lectura a los datos en más de 4 regiones, puede crear una base de datos secundaria de una base de datos secundaria (un proceso que se conoce como encadenamiento).</span><span class="sxs-lookup"><span data-stu-id="e915e-162">If you are using active geo-replication to build a globally distributed application and need to provide read-only access to data in more than 4 regions, you can create secondary of a secondary (a process known as chaining).</span></span> <span data-ttu-id="e915e-163">De este modo, puede alcanzar una escala prácticamente ilimitada de replicación de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="e915e-163">This way you can achieve virtually unlimited scale of database replication.</span></span> <span data-ttu-id="e915e-164">Además, el encadenamiento disminuye la sobrecarga de la replicación desde la base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="e915e-164">In addition, chaining reduces the overhead of replication from the primary database.</span></span> <span data-ttu-id="e915e-165">El inconveniente es el mayor retraso de replicación en las últimas bases de datos secundarias.</span><span class="sxs-lookup"><span data-stu-id="e915e-165">The trade-off is the increased replication lag on the leaf-most secondary databases.</span></span> <span data-ttu-id="e915e-166">.</span><span class="sxs-lookup"><span data-stu-id="e915e-166">.</span></span> 
   >

* <span data-ttu-id="e915e-167">**Compatibilidad con bases de datos de grupos elásticos**: la replicación geográfica activa se puede configurar para cualquier base de datos en un grupo elástico.</span><span class="sxs-lookup"><span data-stu-id="e915e-167">**Support of elastic pool databases**: Active geo-replication can be configured for any database in any elastic pool.</span></span> <span data-ttu-id="e915e-168">La base de datos secundaria puede estar en otro grupo elástico.</span><span class="sxs-lookup"><span data-stu-id="e915e-168">The secondary database can be in another elastic pool.</span></span> <span data-ttu-id="e915e-169">Para las bases de datos normales, la base de datos secundaria puede ser un grupo elástico y viceversa, siempre que los niveles de servicio sean los mismos.</span><span class="sxs-lookup"><span data-stu-id="e915e-169">For regular databases, the secondary can be an elastic pool and vice versa as long as the service tiers are the same.</span></span> 
* <span data-ttu-id="e915e-170">**Nivel de rendimiento configurable de la base de datos secundaria**: se puede crear una base de datos secundaria con un nivel de rendimiento inferior al de la principal.</span><span class="sxs-lookup"><span data-stu-id="e915e-170">**Configurable performance level of the secondary database**: A secondary database can be created with lower performance level than the primary.</span></span> <span data-ttu-id="e915e-171">Es necesario que tanto la base de datos principal como las secundarias tengan el mismo nivel de servicio.</span><span class="sxs-lookup"><span data-stu-id="e915e-171">Both primary and secondary databases are required to have the same service tier.</span></span> <span data-ttu-id="e915e-172">No se recomienda esta opción para las aplicaciones con elevada actividad de escritura en la base de datos porque el mayor retraso de replicación aumenta el riesgo de perder una cantidad considerable de datos después de una conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="e915e-172">This option is not recommended for applications with high database write activity because the increased replication lag increases the risk of substantial data loss after a failover.</span></span> <span data-ttu-id="e915e-173">Además, después de la conmutación por error, el rendimiento de la aplicación se ve afectado hasta que la nueva base de datos principal se actualice a un nivel de rendimiento mayor.</span><span class="sxs-lookup"><span data-stu-id="e915e-173">In addition, after failover the application’s performance is impacted until the new primary is upgraded to a higher performance level.</span></span> <span data-ttu-id="e915e-174">El gráfico de porcentaje de E/S de registro en Azure Portal proporciona un buen método para estimar el nivel mínimo de rendimiento de la base de datos secundaria que es necesario para mantener la carga de replicación.</span><span class="sxs-lookup"><span data-stu-id="e915e-174">The log IO percentage chart on Azure portal provides a good way to estimate the minimal performance level of the secondary that is required to sustain the replication load.</span></span> <span data-ttu-id="e915e-175">Por ejemplo, si la base de datos principal es P6 (1000 DTU) y su porcentaje de E/S de registro es 50 %, la base de datos secundaria debe ser al menos P4 (500 DTU).</span><span class="sxs-lookup"><span data-stu-id="e915e-175">For example, if your Primary database is P6 (1000 DTU) and its log IO percent is 50% the secondary needs to be at least P4 (500 DTU).</span></span> <span data-ttu-id="e915e-176">También puede recuperar los datos de E/S de registro mediante las vistas de base de datos [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) o [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span><span class="sxs-lookup"><span data-stu-id="e915e-176">You can also retrieve the log IO data using [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) or [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) database views.</span></span>  <span data-ttu-id="e915e-177">Para más información sobre los niveles de rendimiento de Base de datos SQL, consulte [Opciones y rendimiento de Base de datos SQL: comprender lo que está disponible en cada nivel de servicio](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="e915e-177">For more information on the SQL Database performance levels, see [SQL Database options and performance](sql-database-service-tiers.md).</span></span> 
* <span data-ttu-id="e915e-178">**Conmutación por error y conmutación por recuperación controladas por el usuario**: la aplicación o el usuario puede cambiar explícitamente una base de datos secundaria al rol principal en cualquier momento.</span><span class="sxs-lookup"><span data-stu-id="e915e-178">**User-controlled failover and failback**: A secondary database can explicitly be switched to the primary role at any time by the application or the user.</span></span> <span data-ttu-id="e915e-179">Durante una interrupción real, debe utilizarse la opción "no planeada", que promueve inmediatamente una base de datos secundaria a principal.</span><span class="sxs-lookup"><span data-stu-id="e915e-179">During a real outage the “unplanned” option should be used, which immediately promotes a secondary to be the primary.</span></span> <span data-ttu-id="e915e-180">Cuando la base de datos principal que generó el error se recupera y vuelve a estar disponible, el sistema la marca automáticamente como secundaria y la pone al día con la nueva base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="e915e-180">When the failed primary recovers and is available again, the system automatically marks the recovered primary as a secondary and bring it up-to-date with the new primary.</span></span> <span data-ttu-id="e915e-181">Por la naturaleza asincrónica de la replicación, se puede perder una pequeña cantidad de datos durante las conmutaciones por error no planeadas antes de que se repliquen los cambios más recientes a la base de datos secundaria.</span><span class="sxs-lookup"><span data-stu-id="e915e-181">Due to the asynchronous nature of replication, a small amount of data can be lost during unplanned failovers if a primary fails before it replicates the most recent changes to the secondary.</span></span> <span data-ttu-id="e915e-182">Cuando una base de datos principal con varias secundarias conmuta por error, el sistema vuelve a configurar automáticamente las relaciones de replicación y vincula las bases de datos secundarias restantes a la principal recién promovida sin necesidad de que intervenga el usuario.</span><span class="sxs-lookup"><span data-stu-id="e915e-182">When a primary with multiple secondaries fails over, the system automatically reconfigures the replication relationships and links the remaining secondaries to the newly promoted primary without requiring any user intervention.</span></span> <span data-ttu-id="e915e-183">Una vez que se mitiga la interrupción que causó la conmutación por error, sería conveniente devolver la aplicación a la región primaria.</span><span class="sxs-lookup"><span data-stu-id="e915e-183">After the outage that caused the failover is mitigated, it may be desirable to return the application to the primary region.</span></span> <span data-ttu-id="e915e-184">Para hacer esto, se debe invocar el comando de conmutación por error con la opción "planeada".</span><span class="sxs-lookup"><span data-stu-id="e915e-184">To do that, the failover command should be invoked with the “planned” option.</span></span> 
* <span data-ttu-id="e915e-185">**Mantenimiento de las credenciales y las reglas de firewall sincronizadas**: se recomienda usar las [reglas de firewall de base de datos](sql-database-firewall-configure.md) para las bases de datos con replicación geográfica. Así, estas reglas se pueden replicar con la base de datos para asegurarse de que todas las bases de datos secundarias tengan las mismas reglas de firewall que la principal.</span><span class="sxs-lookup"><span data-stu-id="e915e-185">**Keeping credentials and firewall rules in sync**: We recommend using [database firewall rules](sql-database-firewall-configure.md) for geo-replicated databases so these rules can be replicated with the database to ensure all secondary databases have the same firewall rules as the primary.</span></span> <span data-ttu-id="e915e-186">Este enfoque elimina la necesidad de que los clientes configuren y mantengan manualmente las reglas de firewall en los servidores que hospedan tanto la base de datos principal como las secundarias.</span><span class="sxs-lookup"><span data-stu-id="e915e-186">This approach eliminates the need for customers to manually configure and maintain firewall rules on servers hosting both the primary and secondary databases.</span></span> <span data-ttu-id="e915e-187">Igualmente, la utilización de [usuarios de base de datos independiente](sql-database-manage-logins.md) para el acceso a los datos garantiza que la base de datos principal y las secundarias tengan siempre las mismas credenciales de usuario. Por tanto, durante una conmutación por error, no hay interrupciones debidas a discrepancias en los inicios de sesión y las contraseñas.</span><span class="sxs-lookup"><span data-stu-id="e915e-187">Similarly, using [contained database users](sql-database-manage-logins.md) for data access ensures both primary and secondary databases always have the same user credentials so during a failover, there is no disruptions due to mismatches with logins and passwords.</span></span> <span data-ttu-id="e915e-188">Con la adición de [Azure Active Directory](../active-directory/active-directory-whatis.md), los clientes pueden administrar el acceso de usuarios a la base de datos principal y a las secundarias, por lo que ya no es necesario administrar credenciales en las bases de datos.</span><span class="sxs-lookup"><span data-stu-id="e915e-188">With the addition of [Azure Active Directory](../active-directory/active-directory-whatis.md), customers can manage user access to both primary and secondary databases and eliminating the need for managing credentials in databases altogether.</span></span>

## <a name="auto-failover-group-capabilities"></a><span data-ttu-id="e915e-189">Funcionalidades de los grupos de conmutación por error automática</span><span class="sxs-lookup"><span data-stu-id="e915e-189">Auto-failover group capabilities</span></span>

<span data-ttu-id="e915e-190">La característica de grupos de conmutación por error automática proporciona una abstracción eficaz de la replicación geográfica activa mediante la compatibilidad de la conmutación por error automática y la replicación a nivel de grupo.</span><span class="sxs-lookup"><span data-stu-id="e915e-190">Auto-failover groups feature provides a powerful abstraction of active geo-replication by supporting group level replication and automatic failover.</span></span> <span data-ttu-id="e915e-191">Además, elimina la necesidad de cambiar la cadena de conexión de SQL después de la conmutación por error al proporcionar los puntos de conexión adicionales del agente de escucha.</span><span class="sxs-lookup"><span data-stu-id="e915e-191">In addition, it removes the necessity to change the SQL connection string after failover by providing the additional listener end-points.</span></span> 

* <span data-ttu-id="e915e-192">**Grupo de conmutación por error**: se pueden crear uno o más grupos de conmutación por error entre dos servidores en regiones distintas (servidor principal y servidor secundario).</span><span class="sxs-lookup"><span data-stu-id="e915e-192">**Failover group**: One or many failover groups can be created between two servers in different regions (primary and secondary servers).</span></span> <span data-ttu-id="e915e-193">Cada grupo puede incluir una o varias bases de datos que se recuperan como unidad en caso de que una o todas las bases de datos principales dejen de estar disponibles debido a una interrupción en la región primaria.</span><span class="sxs-lookup"><span data-stu-id="e915e-193">Each group can include one or several databases that are recovered as a unit in case all or some primary databases become unavailable due to an outage in the primary region.</span></span>  
* <span data-ttu-id="e915e-194">**Servidor principal**: un servidor que hospeda las bases de datos principales en el grupo de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="e915e-194">**Primary server**: A server that hosts the primary databases in the failover group.</span></span>
* <span data-ttu-id="e915e-195">**Servidor secundario**: un servidor que hospeda las bases de datos secundarias en el grupo de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="e915e-195">**Secondary server**: A server that hosts the secondary databases in the failover group.</span></span> <span data-ttu-id="e915e-196">El servidor secundario no puede estar en la misma región que el servidor principal.</span><span class="sxs-lookup"><span data-stu-id="e915e-196">The secondary server cannot be in the same region as the primary server.</span></span>
* <span data-ttu-id="e915e-197">**Incorporación de bases de datos a un grupo de conmutación por error**: puede colocar varias bases de datos dentro de un servidor o dentro de un grupo elástico en el mismo grupo de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="e915e-197">**Adding databases to failover group**: You can put several databases within a server or within an elastic pool into the same failover group.</span></span> <span data-ttu-id="e915e-198">Si agrega una base de datos independiente al grupo, se crea automáticamente una base de datos secundaria con la misma edición y el mismo nivel de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="e915e-198">If you add a standalone database to the group, it automatically creates a secondary database using the same edition and performance level.</span></span> <span data-ttu-id="e915e-199">Si la base de datos principal está en un grupo elástico, la base de datos secundaria se crea automáticamente en el grupo elástico con el mismo nombre.</span><span class="sxs-lookup"><span data-stu-id="e915e-199">If the primary database is in an elastic pool, the secondary is automatically created in the elastic pool with the same name.</span></span> <span data-ttu-id="e915e-200">Si agrega una base de datos que ya tenga una base de datos secundaria en el servidor secundario, el grupo hereda esa replicación geográfica.</span><span class="sxs-lookup"><span data-stu-id="e915e-200">If you add a database that already has a secondary database in the secondary server, that geo-replication is inherited by the group.</span></span>

   > [!NOTE]
   > <span data-ttu-id="e915e-201">Cuando se agrega una base de datos que ya tiene una base de datos secundaria en un servidor que no forma parte del grupo de conmutación por error, se crea una base de datos secundaria nueva en el servidor secundario.</span><span class="sxs-lookup"><span data-stu-id="e915e-201">When adding a database that already has a secondary database in a server that is not part of the failover group, a new secondary is created in the secondary server.</span></span> 
   >

* <span data-ttu-id="e915e-202">**Agente de escucha de lectura-escritura de grupo de conmutación por error**: un registro CNAME de DNS con el formato **&lt;nombre-grupo-conmutaciónPorError&gt;.baseDeDatos.windows.net** que apunta a la dirección URL del servidor principal actual.</span><span class="sxs-lookup"><span data-stu-id="e915e-202">**Failover group read-write listener**: A DNS CNAME record formed as **&lt;failover-group-name&gt;.database.windows.net** that points to the current primary server URL.</span></span> <span data-ttu-id="e915e-203">Permite que las aplicaciones SQL de lectura y escritura se reconecten sin problemas a la base de datos principal cuando cambia después de la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="e915e-203">It allows the read-write SQL applications to transparently reconnect to the primary database when the primary changes after failover.</span></span> 
* <span data-ttu-id="e915e-204">**Agente de escucha de solo lectura de grupo de conmutación por error**: un registro CNAME de DNS con el formato **&lt;nombre-grupo-conmutaciónPorError&gt;baseDeDatos.secundaria.windows.net** que apunta a la dirección URL del servidor secundario.</span><span class="sxs-lookup"><span data-stu-id="e915e-204">**Failover group read-only listener**: A DNS CNAME record formed as **&lt;failover-group-name&gt;.secondary.database.windows.net** that points to the secondary server’s URL.</span></span> <span data-ttu-id="e915e-205">Permite que las aplicaciones SQL de solo lectura se conecten sin problemas a la base de datos secundaria mediante las reglas especificadas de equilibrio de carga.</span><span class="sxs-lookup"><span data-stu-id="e915e-205">It allows the read-only SQL applications to transparently connect to the secondary database using the specified load-balancing rules.</span></span> <span data-ttu-id="e915e-206">De manera opcional, puede especificar si desea que el tráfico de solo lectura se redirija automáticamente al servidor principal si el servidor secundario no está disponible.</span><span class="sxs-lookup"><span data-stu-id="e915e-206">Optionally you can specify if you want the read-only traffic to be automatically re-directed to the primary server when the secondary server is not available.</span></span>
* <span data-ttu-id="e915e-207">**Directiva de conmutación por error automática**: de manera predeterminada, el grupo de conmutación por error se configura con una directiva de conmutación por error automática.</span><span class="sxs-lookup"><span data-stu-id="e915e-207">**Automatic failover policy**: By default, the failover group is configured with an automatic failover policy.</span></span> <span data-ttu-id="e915e-208">El sistema desencadena la conmutación por error en cuanto se detecta el error.</span><span class="sxs-lookup"><span data-stu-id="e915e-208">The system triggers failover as soon as the failure is detected.</span></span> <span data-ttu-id="e915e-209">Si desea controlar el flujo de trabajo de la conmutación por error desde la aplicación, puede desactivar la conmutación por error automática.</span><span class="sxs-lookup"><span data-stu-id="e915e-209">If you want to control the failover workflow from the application, you can turn off automatic failover.</span></span> 
* <span data-ttu-id="e915e-210">**Conmutación por error manual**: puede iniciar manualmente la conmutación por error en cualquier momento, independientemente de la configuración de la conmutación por error automática.</span><span class="sxs-lookup"><span data-stu-id="e915e-210">**Manual failover**: You can initiate failover manually at any time regardless of the automatic failover configuration.</span></span> <span data-ttu-id="e915e-211">Si la directiva de conmutación por error automática no está configurada, se requiere la conmutación por error manual para recuperar las bases de datos en el grupo de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="e915e-211">If automatic failover policy is not configured manual failover is required to recover databases in the failover group.</span></span> <span data-ttu-id="e915e-212">Puede iniciar una conmutación por error forzada o sencilla (con sincronización total de los datos).</span><span class="sxs-lookup"><span data-stu-id="e915e-212">You can initiate forced or friendly failover (with full data synchronization).</span></span> <span data-ttu-id="e915e-213">La última se podría usar para reubicar el servidor activo en la región primaria.</span><span class="sxs-lookup"><span data-stu-id="e915e-213">The latter could be used to relocate the active server to the primary region.</span></span> <span data-ttu-id="e915e-214">Cuando se completa la conmutación por error, los registros DNS se actualizan automáticamente para garantizar la conectividad con el servidor correcto.</span><span class="sxs-lookup"><span data-stu-id="e915e-214">When failover is completed the DNS records are automatically updated to ensure connectivity to the correct server.</span></span>
* <span data-ttu-id="e915e-215">**Período de gracia con pérdida de datos**: como las bases de datos principal y secundaria se sincronizan con la replicación asincrónica, la conmutación por error puede provocar pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="e915e-215">**Grace period with data loss**: Because the primary and secondary databases are synchronized using asynchronous replication the failover may result in data loss.</span></span> <span data-ttu-id="e915e-216">Puede personalizar la directiva de conmutación por error automática para que refleje la tolerancia de la aplicación a la pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="e915e-216">You can customize the automatic failover policy to reflect your application’s tolerance to data loss.</span></span> <span data-ttu-id="e915e-217">Si configura **GracePeriodWithDataLossHours**, puede controlar durante cuánto tiempo espera el sistema antes de iniciar la conmutación por error que es probable que genere una pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="e915e-217">By configuring **GracePeriodWithDataLossHours**, you can control how long the system waits before initiating the failover that is likely to result data loss.</span></span> 

   > [!NOTE]
   > <span data-ttu-id="e915e-218">Cuando el sistema detecta que las bases de datos del grupo siguen en línea (por ejemplo, si la interrupción solo afectó al plano de control del servicio), activa inmediatamente la conmutación por error con la sincronización total de los datos (conmutación por error sencilla) independientemente del valor establecido por **GracePeriodWithDataLossHours**.</span><span class="sxs-lookup"><span data-stu-id="e915e-218">When system detects that the databases in the group are still online (for example, the outage only impacted the service control plane), it immediately activates the failover with full data synchronization (friendly failover) regardless of the value set by **GracePeriodWithDataLossHours**.</span></span> <span data-ttu-id="e915e-219">Este comportamiento garantiza que no haya ninguna pérdida de datos durante la recuperación.</span><span class="sxs-lookup"><span data-stu-id="e915e-219">This behavior ensures that there is no data loss during the recovery.</span></span> <span data-ttu-id="e915e-220">El período de gracia solo entra en vigor cuando no se puede realizar una conmutación por error sencilla.</span><span class="sxs-lookup"><span data-stu-id="e915e-220">The grace period takes effect only when a friendly failover is not possible.</span></span> <span data-ttu-id="e915e-221">Si la interrupción se mitiga antes de que expire el período de gracia, no se activa la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="e915e-221">If the outage is mitigated before the grace period expires, the failover is not activated.</span></span>
   >

* <span data-ttu-id="e915e-222">**Varios grupos de conmutación por error**: puede configurar varios grupos de conmutación por error para el mismo par de servidores a fin de controlar la escala de conmutaciones por error.</span><span class="sxs-lookup"><span data-stu-id="e915e-222">**Multiple failover groups**: You can configure multiple failover groups for the same pair of servers to control the scale of failovers.</span></span> <span data-ttu-id="e915e-223">Cada grupo realiza la conmutación por error por separado.</span><span class="sxs-lookup"><span data-stu-id="e915e-223">Each group fails over independently.</span></span> <span data-ttu-id="e915e-224">Si la aplicación multiinquilino usa grupos elásticos, puede usar esta funcionalidad para combinar bases de datos principales y secundarias en cada grupo.</span><span class="sxs-lookup"><span data-stu-id="e915e-224">If your multi-tenant application uses elastic pools, you can use this capability to mix primary and secondary databases in each pool.</span></span> <span data-ttu-id="e915e-225">De este modo, puede reducir el impacto de una interrupción a solo la mitad de los inquilinos.</span><span class="sxs-lookup"><span data-stu-id="e915e-225">This way you can reduce the impact of an outage to only half of the tenants.</span></span>

## <a name="best-practices-of-building-highly-available-service"></a><span data-ttu-id="e915e-226">Procedimientos recomendados para la creación de servicios de alta disponibilidad</span><span class="sxs-lookup"><span data-stu-id="e915e-226">Best practices of building highly available service</span></span>

<span data-ttu-id="e915e-227">Para crear un servicio de alta disponibilidad que use Azure SQL Database, los clientes deben seguir estas directrices:</span><span class="sxs-lookup"><span data-stu-id="e915e-227">To build a highly available service that uses Azure SQL database the customers should follow these guidelines:</span></span>
- <span data-ttu-id="e915e-228">**Utilizar el grupo de conmutación por error**: se pueden crear uno o varios grupos de conmutación por error entre dos servidores en regiones distintas (servidor principal y servidor secundario).</span><span class="sxs-lookup"><span data-stu-id="e915e-228">**Use failover group**: One or many failover groups can be created between two servers in different regions (primary and secondary servers).</span></span> <span data-ttu-id="e915e-229">Cada grupo puede incluir una o varias bases de datos que se recuperan como unidad en caso de que una o todas las bases de datos principales dejen de estar disponibles debido a una interrupción en la región primaria.</span><span class="sxs-lookup"><span data-stu-id="e915e-229">Each group can include one or several databases that are recovered as a unit in case all or some primary databases become unavailable due to an outage in the primary region.</span></span> <span data-ttu-id="e915e-230">El grupo de conmutación por error crea la base de datos geográfica secundaria con el mismo objetivo de servicio que la principal.</span><span class="sxs-lookup"><span data-stu-id="e915e-230">The failover group creates geo-secondary database with the same service objective as the primary.</span></span> <span data-ttu-id="e915e-231">Si agrega una relación de replicación geográfica existente al grupo de conmutación por error, asegúrese de que la base de datos geográfica secundaria esté configurada con el mismo objetivo de nivel de servicio que la principal.</span><span class="sxs-lookup"><span data-stu-id="e915e-231">If you add an existing geo-replication relationship to the failover group make sure the geo-secondary is configured with the same service level objective as the primary.</span></span>
- <span data-ttu-id="e915e-232">**Utilizar el agente de escucha de lectura-escritura para la carga de trabajo de OLTP**: al realizar operaciones OLTP, use **&lt;nombre-grupo-conmutaciónPorError&gt;.baseDeDatos.windows.net** como la dirección URL del servidor y las conexiones se redirigirán automáticamente a la base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="e915e-232">**Use read-write listener for OLTP workload**: When performing OLTP operations use **&lt;failover-group-name&gt;.database.windows.net** as the server URL and the connections will be automatically directed to the primary.</span></span> <span data-ttu-id="e915e-233">Esta dirección URL no cambiará después de la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="e915e-233">This URL will not change after the failover.</span></span>  
<span data-ttu-id="e915e-234">Tenga en cuenta que la conmutación por error implica actualizar el registro DNS para que las conexiones de cliente se redirijan a la nueva base de datos principal cuando la caché DNS del cliente se haya actualizado.</span><span class="sxs-lookup"><span data-stu-id="e915e-234">Note the failover involves updating the DNS record so the client connections will be redirected to the new primary only after the client DNS cache is refreshed.</span></span>
- <span data-ttu-id="e915e-235">**Utilizar el agente de escucha de solo lectura para la carga de trabajo de solo lectura**: si tiene una carga de trabajo de solo lectura que es tolerante a una cierta obsolescencia de los datos, puede usar la base de datos secundaria en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="e915e-235">**Use read-only listener for read-only workload**: If you have a logically isolated read-only workload that is tolerant to certain staleness of data, you can use the secondary database in the application.</span></span> <span data-ttu-id="e915e-236">Para las sesiones de solo lectura, use **&lt;nombre-grupo-conmutaciónPorError&gt;baseDeDatos.secundaria.windows.net** como la dirección URL del servidor y la conexión se redirigirá automáticamente a la base de datos secundaria.</span><span class="sxs-lookup"><span data-stu-id="e915e-236">For read-only sessions use **&lt;failover-group-name&gt;.secondary.database.windows.net** as the server URL and the connection will be automatically directed to the secondary.</span></span> <span data-ttu-id="e915e-237">También se recomienda indicar en la cadena de conexión el intento de lectura mediante **ApplicationIntent=ReadOnly**.</span><span class="sxs-lookup"><span data-stu-id="e915e-237">It is also recommended that you indicate in connection string read intent by using **ApplicationIntent=ReadOnly**.</span></span> 
- <span data-ttu-id="e915e-238">**Prepárese para la degradación del rendimiento**: la decisión de la conmutación por error de SQL es independiente del resto de la aplicación o de otros servicios usados.</span><span class="sxs-lookup"><span data-stu-id="e915e-238">**Be prepared for perf degradation**: SQL failover decision is independent from the rest of the application or other services used.</span></span> <span data-ttu-id="e915e-239">La aplicación puede ser una mezcla de componentes de una región y componentes de otra.</span><span class="sxs-lookup"><span data-stu-id="e915e-239">The application may be “mixed” with some components in one region and some in another.</span></span> <span data-ttu-id="e915e-240">Para evitar la degradación, garantice la implementación redundante de la aplicación en la región de DR y siga las instrucciones de este artículo.</span><span class="sxs-lookup"><span data-stu-id="e915e-240">To avoid the degradation, ensure the redundant application deployment in the DR region and follow the guidelines in this article.</span></span>  
<span data-ttu-id="e915e-241">Tenga en cuenta que la aplicación de la región de DR no tiene que usar una cadena de conexión diferente.</span><span class="sxs-lookup"><span data-stu-id="e915e-241">Note the application in the DR region does not have to use a different connection string.</span></span>  
- <span data-ttu-id="e915e-242">**Prepararse para la pérdida de datos**: si se detecta una interrupción, SQL desencadena automáticamente la conmutación por error de lectura-escritura si nos consta que hay cero pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="e915e-242">**Prepare for data loss**: If an outage is detected, SQL automatically triggers read-write failover if there is zero data loss to the best of our knowledge.</span></span> <span data-ttu-id="e915e-243">De lo contrario, espera el período especificado por **GracePeriodWithDataLossHours**.</span><span class="sxs-lookup"><span data-stu-id="e915e-243">Otherwise, it waits for the period you specified by **GracePeriodWithDataLossHours**.</span></span> <span data-ttu-id="e915e-244">Si especificó **GracePeriodWithDataLossHours**, prepárese para la pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="e915e-244">If you specified **GracePeriodWithDataLossHours**, be prepared for data loss.</span></span> <span data-ttu-id="e915e-245">Por lo general, durante las interrupciones, Azure favorece la disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="e915e-245">In general, during outages, Azure favors availability.</span></span> <span data-ttu-id="e915e-246">Si no puede permitirse perder datos, asegúrese de establecer **GracePeriodWithDataLossHours** en un número lo suficientemente grande, por ejemplo, 24 horas.</span><span class="sxs-lookup"><span data-stu-id="e915e-246">If you cannot afford data loss, make sure to set **GracePeriodWithDataLossHours** to a sufficiently large number, such as 24 hours.</span></span> 


## <a name="upgrading-or-downgrading-a-primary-database"></a><span data-ttu-id="e915e-247">Actualización o degradación de una base de datos principal</span><span class="sxs-lookup"><span data-stu-id="e915e-247">Upgrading or downgrading a primary database</span></span>
<span data-ttu-id="e915e-248">Puede actualizar o degradar una base de datos principal a un nivel de rendimiento diferente (en el mismo nivel de servicio) sin desconectar las bases de datos secundarias.</span><span class="sxs-lookup"><span data-stu-id="e915e-248">You can upgrade or downgrade a primary database to a different performance level (within the same service tier) without disconnecting any secondary databases.</span></span> <span data-ttu-id="e915e-249">Al actualizar, se recomienda que actualice la base de datos secundaria en primer lugar y, a continuación, la principal.</span><span class="sxs-lookup"><span data-stu-id="e915e-249">When upgrading, we recommend that you upgrade the secondary database first, and then upgrade the primary.</span></span> <span data-ttu-id="e915e-250">Al degradar, invierta el orden: degrade primero la base de datos principal y, después, la secundaria.</span><span class="sxs-lookup"><span data-stu-id="e915e-250">When downgrading, reverse the order: downgrade the primary first, and then downgrade the secondary.</span></span> <span data-ttu-id="e915e-251">Cuando actualiza o degrada la base de datos a un nivel de servicio diferente, se aplica esta recomendación.</span><span class="sxs-lookup"><span data-stu-id="e915e-251">When you upgrade or downgrade the database to a different service tier this recommendation is enforced.</span></span> 

> [!NOTE]
> <span data-ttu-id="e915e-252">Si creó una base de datos secundaria como parte de la configuración del grupo de conmutación por error, no se recomienda que la degrade.</span><span class="sxs-lookup"><span data-stu-id="e915e-252">If you created secondary database as part of the failover group configuration it is not recommended to downgrade the secondary database.</span></span> <span data-ttu-id="e915e-253">De este modo, se garantiza que la capa de datos tiene la capacidad suficiente para procesar la carga de trabajo habitual una vez que se activa la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="e915e-253">This is to ensure your data tier has sufficient capacity to process your regular workload after failover is activated.</span></span> 
>

## <a name="preventing-the-loss-of-critical-data"></a><span data-ttu-id="e915e-254">Evitar la pérdida de datos críticos</span><span class="sxs-lookup"><span data-stu-id="e915e-254">Preventing the loss of critical data</span></span>
<span data-ttu-id="e915e-255">Debido a la elevada latencia de las redes de área extensa, la copia continua usa un mecanismo de replicación asincrónica.</span><span class="sxs-lookup"><span data-stu-id="e915e-255">Due to the high latency of wide area networks, continuous copy uses an asynchronous replication mechanism.</span></span> <span data-ttu-id="e915e-256">La replicación asincrónica hace inevitable la pérdida de cierta cantidad datos si se produce un error.</span><span class="sxs-lookup"><span data-stu-id="e915e-256">Asynchronous replication makes some data loss unavoidable if a failure occurs.</span></span> <span data-ttu-id="e915e-257">Sin embargo, es posible que algunas aplicaciones exijan que no se pierdan datos.</span><span class="sxs-lookup"><span data-stu-id="e915e-257">However, some applications may require no data loss.</span></span> <span data-ttu-id="e915e-258">Para proteger estas actualizaciones críticas, un desarrollador de aplicaciones puede llamar al procedimiento del sistema [sp_wait_for_database_copy_sync](https://msdn.microsoft.com/library/dn467644.aspx) inmediatamente después de confirmar la transacción.</span><span class="sxs-lookup"><span data-stu-id="e915e-258">To protect these critical updates, an application developer can call the [sp_wait_for_database_copy_sync](https://msdn.microsoft.com/library/dn467644.aspx) system procedure immediately after committing the transaction.</span></span> <span data-ttu-id="e915e-259">La llamada a **sp_wait_for_database_copy_sync** bloquea el subproceso de llamada hasta que se transmite la última transacción confirmada en la base de datos secundaria.</span><span class="sxs-lookup"><span data-stu-id="e915e-259">Calling **sp_wait_for_database_copy_sync** blocks the calling thread until the last committed transaction has been transmitted to the secondary database.</span></span> <span data-ttu-id="e915e-260">Sin embargo, no espera para que las transacciones transmitidas se reproduzcan y se confirmen en la base de datos secundaria.</span><span class="sxs-lookup"><span data-stu-id="e915e-260">However, it does not wait for the transmitted transactions to be replayed and committed on the secondary.</span></span> <span data-ttu-id="e915e-261">**sp_wait_for_database_copy_sync** está dirigida a un vínculo de copia continua específico.</span><span class="sxs-lookup"><span data-stu-id="e915e-261">**sp_wait_for_database_copy_sync** is scoped to a specific continuous copy link.</span></span> <span data-ttu-id="e915e-262">Cualquier usuario con derechos de conexión para la base de datos principal puede llamar a este procedimiento.</span><span class="sxs-lookup"><span data-stu-id="e915e-262">Any user with the connection rights to the primary database can call this procedure.</span></span>

> [!NOTE]
> <span data-ttu-id="e915e-263">**sp_wait_for_database_copy_sync** evitará la pérdida de datos después de la conmutación por error, pero no garantizará la sincronización completa para el acceso de lectura.</span><span class="sxs-lookup"><span data-stu-id="e915e-263">**sp_wait_for_database_copy_sync** will prevent data loss after failover, but it will not guarantee full synchronization for read access.</span></span> <span data-ttu-id="e915e-264">El retraso causado por una llamada al procedimiento **sp_wait_for_database_copy_sync** puede ser considerable y depende del tamaño del registro de transacciones en el momento de la llamada.</span><span class="sxs-lookup"><span data-stu-id="e915e-264">The delay caused by a **sp_wait_for_database_copy_sync** procedure call can be significant and depends on the size of the transaction log at the time of the call.</span></span> 
> 

## <a name="programmatically-managing-failover-groups-and-active-geo-replication"></a><span data-ttu-id="e915e-265">Administración mediante programación de los grupos de conmutación por error y de la replicación geográfica activa</span><span class="sxs-lookup"><span data-stu-id="e915e-265">Programmatically managing failover groups and active geo-replication</span></span>
<span data-ttu-id="e915e-266">Como se dijo antes, los grupos de conmutación por error automática (en versión preliminar) y la replicación geográfica activa también pueden administrarse mediante programación con Azure PowerShell y la API de REST.</span><span class="sxs-lookup"><span data-stu-id="e915e-266">As discussed previously, auto-failover groups (in-preview) and active geo-replication can also be managed programmatically using Azure PowerShell and the REST API.</span></span> <span data-ttu-id="e915e-267">En las tablas siguientes se describe el conjunto de comandos disponibles.</span><span class="sxs-lookup"><span data-stu-id="e915e-267">The following tables describe the set of commands available.</span></span>

<span data-ttu-id="e915e-268">**API de Azure Resource Manager y seguridad basada en roles**: la replicación geográfica activa incluye un conjunto de API de Azure Resource Manager para la administración, en el que se incluyen la [API de REST de Azure SQL Database](https://docs.microsoft.com/rest/api/sql/) y los [cmdlets de Azure PowerShell](https://docs.microsoft.com/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="e915e-268">**Azure Resource Manager API and role-based security**: Active geo-replication includes a set of Azure Resource Manager APIs for management, including the [Azure SQL Database REST API](https://docs.microsoft.com/rest/api/sql/) and [Azure PowerShell cmdlets](https://docs.microsoft.com/powershell/azure/overview).</span></span> <span data-ttu-id="e915e-269">Estas API requieren que se usen grupos de recursos y admiten la seguridad basada en roles (RBAC).</span><span class="sxs-lookup"><span data-stu-id="e915e-269">These APIs require the use of resource groups and support role-based security (RBAC).</span></span> <span data-ttu-id="e915e-270">Para más información sobre cómo implementar los roles de acceso, consulte [Control de acceso basado en roles de Azure](../active-directory/role-based-access-control-what-is.md).</span><span class="sxs-lookup"><span data-stu-id="e915e-270">For more information on how to implement access roles, see [Azure Role-Based Access Control](../active-directory/role-based-access-control-what-is.md).</span></span>

> [!NOTE]
> <span data-ttu-id="e915e-271">Muchas de las nuevas características de la replicación geográfica activa solo se admiten con [Azure Resource Manager](../azure-resource-manager/resource-group-overview.md), que se basa en la [API de REST de Azure SQL](https://msdn.microsoft.com/library/azure/mt163571.aspx) y los [cmdlets de PowerShell de Azure SQL Database](https://msdn.microsoft.com/library/azure/mt574084.aspx).</span><span class="sxs-lookup"><span data-stu-id="e915e-271">Many new features of active geo-replication are only supported using [Azure Resource Manager](../azure-resource-manager/resource-group-overview.md) based [Azure SQL REST API](https://msdn.microsoft.com/library/azure/mt163571.aspx) and [Azure SQL Database PowerShell cmdlets](https://msdn.microsoft.com/library/azure/mt574084.aspx).</span></span> <span data-ttu-id="e915e-272">La [API de REST (clásica)](https://msdn.microsoft.com/library/azure/dn505719.aspx) y los [cmdlets de Azure SQL Database (clásicos)](https://msdn.microsoft.com/library/azure/dn546723.aspx) se admiten por compatibilidad con versiones anteriores, por lo que se recomienda usar las API basadas en Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="e915e-272">The [(classic) REST API](https://msdn.microsoft.com/library/azure/dn505719.aspx) and [Azure SQL Database (classic) cmdlets](https://msdn.microsoft.com/library/azure/dn546723.aspx) are supported for backward compatibility so using the Azure Resource Manager-based APIs are recommended.</span></span> 
> 

## <a name="manage-sql-database-failover-using-using-transact-sql"></a><span data-ttu-id="e915e-273">Administrar SQL proceso de uso de conmutación por error de base de datos mediante Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="e915e-273">Manage SQL database failover using using Transact-SQL</span></span>

| <span data-ttu-id="e915e-274">Comando</span><span class="sxs-lookup"><span data-stu-id="e915e-274">Command</span></span> | <span data-ttu-id="e915e-275">Description</span><span class="sxs-lookup"><span data-stu-id="e915e-275">Description</span></span> |
| --- | --- |
| [<span data-ttu-id="e915e-276">ALTER DATABASE (Base de datos SQL de Azure)</span><span class="sxs-lookup"><span data-stu-id="e915e-276">ALTER DATABASE (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt574871.aspx) |<span data-ttu-id="e915e-277">Se utiliza el argumento ADD SECONDARY ON SERVER a fin de crear una base de datos secundaria para una base de datos existente e iniciar la replicación de datos</span><span class="sxs-lookup"><span data-stu-id="e915e-277">Use ADD SECONDARY ON SERVER argument to create a secondary database for an existing database and starts data replication</span></span> |
| [<span data-ttu-id="e915e-278">ALTER DATABASE (Base de datos SQL de Azure)</span><span class="sxs-lookup"><span data-stu-id="e915e-278">ALTER DATABASE (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt574871.aspx) |<span data-ttu-id="e915e-279">Se utiliza FAILOVER o FORCE_FAILOVER_ALLOW_DATA_LOSS para cambiar una base de datos de secundaria a principal e iniciar la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="e915e-279">Use FAILOVER or FORCE_FAILOVER_ALLOW_DATA_LOSS to switch a secondary database to be primary to initiate failover</span></span> |
| [<span data-ttu-id="e915e-280">ALTER DATABASE (Base de datos SQL de Azure)</span><span class="sxs-lookup"><span data-stu-id="e915e-280">ALTER DATABASE (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt574871.aspx) |<span data-ttu-id="e915e-281">Se utiliza REMOVE SECONDARY ON SERVER para finalizar una replicación de datos entre una Base de datos SQL y la base de datos secundaria especificada.</span><span class="sxs-lookup"><span data-stu-id="e915e-281">Use REMOVE SECONDARY ON SERVER to terminate a data replication between a SQL Database and the specified secondary database.</span></span> |
| [<span data-ttu-id="e915e-282">sys.geo_replication_links (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="e915e-282">sys.geo_replication_links (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt575501.aspx) |<span data-ttu-id="e915e-283">Devuelve información sobre todos los vínculos de replicación existentes para cada base de datos del servidor lógico de Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="e915e-283">Returns information about all existing replication links for each database on the Azure SQL Database logical server.</span></span> |
| [<span data-ttu-id="e915e-284">sys.dm_geo_replication_link_status (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="e915e-284">sys.dm_geo_replication_link_status (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt575504.aspx) |<span data-ttu-id="e915e-285">Obtiene la hora de la última replicación, el retraso de la última replicación y otro tipo de información sobre el vínculo de replicación para una base de datos SQL determinada.</span><span class="sxs-lookup"><span data-stu-id="e915e-285">Gets the last replication time, last replication lag, and other information about the replication link for a given SQL database.</span></span> |
| [<span data-ttu-id="e915e-286">sys.dm_operation_status (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="e915e-286">sys.dm_operation_status (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/dn270022.aspx) |<span data-ttu-id="e915e-287">Muestra el estado de todas las operaciones de base de datos, incluido el estado de los vínculos de replicación.</span><span class="sxs-lookup"><span data-stu-id="e915e-287">Shows the status for all database operations including the status of the replication links.</span></span> |
| [<span data-ttu-id="e915e-288">sp_wait_for_database_copy_sync (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="e915e-288">sp_wait_for_database_copy_sync (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/dn467644.aspx) |<span data-ttu-id="e915e-289">Hace que la aplicación espere a que se repliquen todas las transacciones confirmadas y a que las reconozca la base de datos secundaria activa.</span><span class="sxs-lookup"><span data-stu-id="e915e-289">causes the application to wait until all committed transactions are replicated and acknowledged by the active secondary database.</span></span> |
|  | |

## <a name="manage-sql-database-failover-using-using-powershell"></a><span data-ttu-id="e915e-290">Administrar SQL base de datos de conmutación por error utilizando PowerShell</span><span class="sxs-lookup"><span data-stu-id="e915e-290">Manage SQL database failover using using PowerShell</span></span>

| <span data-ttu-id="e915e-291">Cmdlet</span><span class="sxs-lookup"><span data-stu-id="e915e-291">Cmdlet</span></span> | <span data-ttu-id="e915e-292">Descripción</span><span class="sxs-lookup"><span data-stu-id="e915e-292">Description</span></span> |
| --- | --- |
| [<span data-ttu-id="e915e-293">Get-AzureRmSqlDatabase</span><span class="sxs-lookup"><span data-stu-id="e915e-293">Get-AzureRmSqlDatabase</span></span>](/powershell/module/azurerm.sql/get-azurermsqldatabase) |<span data-ttu-id="e915e-294">Obtiene una o más bases de datos.</span><span class="sxs-lookup"><span data-stu-id="e915e-294">Gets one or more databases.</span></span> |
| [<span data-ttu-id="e915e-295">New-AzureRmSqlDatabaseSecondary</span><span class="sxs-lookup"><span data-stu-id="e915e-295">New-AzureRmSqlDatabaseSecondary</span></span>](/powershell/module/azurerm.sql/new-azurermsqldatabasesecondary) |<span data-ttu-id="e915e-296">Crea una base de datos secundaria para una base de datos existente e inicia la replicación de datos.</span><span class="sxs-lookup"><span data-stu-id="e915e-296">Creates a secondary database for an existing database and starts data replication.</span></span> |
| [<span data-ttu-id="e915e-297">Set-AzureRmSqlDatabaseSecondary</span><span class="sxs-lookup"><span data-stu-id="e915e-297">Set-AzureRmSqlDatabaseSecondary</span></span>](/powershell/module/azurerm.sql/set-azurermsqldatabasesecondary) |<span data-ttu-id="e915e-298">Convierte una base de datos secundaria en principal para iniciar la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="e915e-298">Switches a secondary database to be primary to initiate failover.</span></span> |
| [<span data-ttu-id="e915e-299">Remove-AzureRmSqlDatabaseSecondary</span><span class="sxs-lookup"><span data-stu-id="e915e-299">Remove-AzureRmSqlDatabaseSecondary</span></span>](/powershell/module/azurerm.sql/remove-azurermsqldatabasesecondary) |<span data-ttu-id="e915e-300">Finaliza una replicación de datos entre una base de datos SQL y la base de datos secundaria especificada.</span><span class="sxs-lookup"><span data-stu-id="e915e-300">Terminates data replication between a SQL Database and the specified secondary database.</span></span> |
| [<span data-ttu-id="e915e-301">Get-AzureRmSqlDatabaseReplicationLink</span><span class="sxs-lookup"><span data-stu-id="e915e-301">Get-AzureRmSqlDatabaseReplicationLink</span></span>](/powershell/module/azurerm.sql/get-azurermsqldatabasereplicationlink) |<span data-ttu-id="e915e-302">Obtiene los vínculos de replicación geográfica entre una Base de datos SQL de Azure y un grupo de recursos o SQL Server.</span><span class="sxs-lookup"><span data-stu-id="e915e-302">Gets the geo-replication links between an Azure SQL Database and a resource group or SQL Server.</span></span> |
| [<span data-ttu-id="e915e-303">New-AzureRmSqlDatabaseFailoverGroup</span><span class="sxs-lookup"><span data-stu-id="e915e-303">New-AzureRmSqlDatabaseFailoverGroup</span></span>](/powershell/module/azurerm.sql/set-azurermsqldatabasefailovergroup) |   <span data-ttu-id="e915e-304">Este comando crea un grupo de conmutación por error y lo registra en el servidor principal y el servidor secundario</span><span class="sxs-lookup"><span data-stu-id="e915e-304">This command creates a failover group and registers it on both primary and secondary servers</span></span>|
| [<span data-ttu-id="e915e-305">Remove-AzureRmSqlDatabaseFailoverGroup</span><span class="sxs-lookup"><span data-stu-id="e915e-305">Remove-AzureRmSqlDatabaseFailoverGroup</span></span>](/powershell/module/azurerm.sql/remove-azurermsqldatabasefailovergroup) | <span data-ttu-id="e915e-306">Quita el grupo de conmutación por error del servidor y elimina todas las bases de datos secundarias incluidas en el grupo</span><span class="sxs-lookup"><span data-stu-id="e915e-306">Removes the failover group from the server and deletes all secondary databases included the group</span></span> |
| [<span data-ttu-id="e915e-307">Get-AzureRmSqlDatabaseFailoverGroup</span><span class="sxs-lookup"><span data-stu-id="e915e-307">Get-AzureRmSqlDatabaseFailoverGroup</span></span>](/powershell/module/azurerm.sql/get-azurermsqldatabasefailovergroup) | <span data-ttu-id="e915e-308">Recupera la configuración del grupo de conmutación por error</span><span class="sxs-lookup"><span data-stu-id="e915e-308">Retrieves the failover group configuration</span></span> |
| [<span data-ttu-id="e915e-309">Set-AzureRmSqlDatabaseFailoverGroup</span><span class="sxs-lookup"><span data-stu-id="e915e-309">Set-AzureRmSqlDatabaseFailoverGroup</span></span>](/powershell/module/azurerm.sql/set-azurermsqldatabasefailovergroup) |   <span data-ttu-id="e915e-310">Modifica la configuración del grupo de conmutación por error</span><span class="sxs-lookup"><span data-stu-id="e915e-310">Modifies the configuration of the failover group</span></span> |
| [<span data-ttu-id="e915e-311">Switch-AzureRMSqlDatabaseFailoverGroup</span><span class="sxs-lookup"><span data-stu-id="e915e-311">Switch-AzureRMSqlDatabaseFailoverGroup</span></span>](/powershell/module/azurerm.sql/switch-azurermsqldatabasefailovergroup) | <span data-ttu-id="e915e-312">Desencadena la conmutación por error del grupo de conmutación por error al servidor secundario</span><span class="sxs-lookup"><span data-stu-id="e915e-312">Triggers failover of the failover group to the secondary server</span></span> |
|  | |

> [!IMPORTANT]
> <span data-ttu-id="e915e-313">Para los scripts de ejemplo, vea [Configuración y conmutación por error de una única base de datos mediante la replicación geográfica activa](scripts/sql-database-setup-geodr-and-failover-database-powershell.md), [Configuración y conmutación por error de una base de datos agrupada mediante la replicación geográfica activa](scripts/sql-database-setup-geodr-and-failover-pool-powershell.md) y [Configuración y conmutación por error de un grupo de conmutación por error para una única base de datos (versión preliminar)](scripts/sql-database-setup-geodr-failover-database-failover-group-powershell.md.</span><span class="sxs-lookup"><span data-stu-id="e915e-313">For sample scripts, see [Configure and failover a single database using active geo-replication](scripts/sql-database-setup-geodr-and-failover-database-powershell.md), [Configure and failover a pooled database using active geo-replication](scripts/sql-database-setup-geodr-and-failover-pool-powershell.md), and  [Configure and failover a failover group for a single database (preview)](scripts/sql-database-setup-geodr-failover-database-failover-group-powershell.md.</span></span>
>

## <a name="manage-sql-database-failover-using-the-rest-api"></a><span data-ttu-id="e915e-314">Administración de la conmutación por error de SQL Database mediante API de REST</span><span class="sxs-lookup"><span data-stu-id="e915e-314">Manage SQL database failover using the REST API</span></span>
| <span data-ttu-id="e915e-315">API</span><span class="sxs-lookup"><span data-stu-id="e915e-315">API</span></span> | <span data-ttu-id="e915e-316">Description</span><span class="sxs-lookup"><span data-stu-id="e915e-316">Description</span></span> |
| --- | --- |
| [<span data-ttu-id="e915e-317">Crear o actualizar base de datos (createMode=Restore)</span><span class="sxs-lookup"><span data-stu-id="e915e-317">Create or Update Database (createMode=Restore)</span></span>](/rest/api/sql/Databases/CreateOrUpdate) |<span data-ttu-id="e915e-318">Crea, actualiza o restaura una base de datos principal o secundaria.</span><span class="sxs-lookup"><span data-stu-id="e915e-318">Creates, updates, or restores a primary or a secondary database.</span></span> |
| [<span data-ttu-id="e915e-319">Obtener el estado de creación o actualización de la base de datos</span><span class="sxs-lookup"><span data-stu-id="e915e-319">Get Create or Update Database Status</span></span>](/rest/api/sql/Databases/CreateOrUpdate) |<span data-ttu-id="e915e-320">Devuelve el estado durante una operación de creación.</span><span class="sxs-lookup"><span data-stu-id="e915e-320">Returns the status during a create operation.</span></span> |
| [<span data-ttu-id="e915e-321">Establecer la base de datos secundaria como principal (conmutación por error planeada)</span><span class="sxs-lookup"><span data-stu-id="e915e-321">Set Secondary Database as Primary (Planned Failover)</span></span>](https://docs.microsoft.com/rest/api/sql/replicationlinkss#ReplicationLinks_Failover) |<span data-ttu-id="e915e-322">Define qué base de datos de réplica es la principal mediante la conmutación por error desde la base de datos de réplica principal actual.</span><span class="sxs-lookup"><span data-stu-id="e915e-322">Sets which replica database is primary by failing over from the current primary replica database.</span></span> |
| [<span data-ttu-id="e915e-323">Establecer la base de datos secundaria como principal (conmutación por error no planeada)</span><span class="sxs-lookup"><span data-stu-id="e915e-323">Set Secondary Database as Primary (Unplanned Failover)</span></span>](https://docs.microsoft.com/rest/api/sql/replicationlinks#ReplicationLinks_FailoverAllowDataLoss) |<span data-ttu-id="e915e-324">Define qué base de datos de réplica es la principal mediante la conmutación por error desde la base de datos de réplica principal actual.</span><span class="sxs-lookup"><span data-stu-id="e915e-324">Sets which replica database is primary by failing over from the current primary replica database.</span></span> <span data-ttu-id="e915e-325">Esta operación puede ocasionar pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="e915e-325">This operation might result in data loss.</span></span> |
| [<span data-ttu-id="e915e-326">Obtener vínculo de replicación</span><span class="sxs-lookup"><span data-stu-id="e915e-326">Get Replication Link</span></span>](/rest/api/sql/replicationlinks/get) |<span data-ttu-id="e915e-327">Obtiene un vínculo de replicación específico para una Base de datos SQL determinada en una asociación de replicación geográfica.</span><span class="sxs-lookup"><span data-stu-id="e915e-327">Gets a specific replication link for a given SQL database in a geo-replication partnership.</span></span> <span data-ttu-id="e915e-328">Recupera la información visible en la vista de catálogo sys.geo_replication_links.</span><span class="sxs-lookup"><span data-stu-id="e915e-328">It retrieves the information visible in the sys.geo_replication_links catalog view.</span></span> |
| [<span data-ttu-id="e915e-329">Vínculos de replicación: lista por base de datos</span><span class="sxs-lookup"><span data-stu-id="e915e-329">Replication Links - List By Database</span></span>](/rest/api/sql/replicationlinks/listbydatabase) | <span data-ttu-id="e915e-330">Obtiene todos los vínculos de replicación para una Base de datos SQL determinada en una asociación de replicación geográfica.</span><span class="sxs-lookup"><span data-stu-id="e915e-330">Gets all replication links for a given SQL database in a geo-replication partnership.</span></span> <span data-ttu-id="e915e-331">Recupera la información visible en la vista de catálogo sys.geo_replication_links.</span><span class="sxs-lookup"><span data-stu-id="e915e-331">It retrieves the information visible in the sys.geo_replication_links catalog view.</span></span> |
| [<span data-ttu-id="e915e-332">Eliminar vínculo de replicación</span><span class="sxs-lookup"><span data-stu-id="e915e-332">Delete Replication Link</span></span>](/rest/api/sql/databases/delete) | <span data-ttu-id="e915e-333">Elimina un vínculo de replicación de base de datos.</span><span class="sxs-lookup"><span data-stu-id="e915e-333">Deletes a database replication link.</span></span> <span data-ttu-id="e915e-334">No se puede realizar durante la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="e915e-334">Cannot be done during failover.</span></span> |
| <span data-ttu-id="e915e-335">[Crear o actualizar un grupo de conmutación por error]/rest/api/sql/failovergroups/createorupdate)</span><span class="sxs-lookup"><span data-stu-id="e915e-335">[Create or Update Failover Group]/rest/api/sql/failovergroups/createorupdate)</span></span> | <span data-ttu-id="e915e-336">Crea o actualiza un grupo de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="e915e-336">Creates or updates a failover group</span></span> |
| [<span data-ttu-id="e915e-337">Eliminar grupo de conmutación por error</span><span class="sxs-lookup"><span data-stu-id="e915e-337">Delete Failover Group</span></span>](/rest/api/sql/failovergroups/delete) | <span data-ttu-id="e915e-338">Quita el grupo de conmutación por error del servidor.</span><span class="sxs-lookup"><span data-stu-id="e915e-338">Removes the failover group from the server</span></span> |
| [<span data-ttu-id="e915e-339">Conmutación por error (planeada)</span><span class="sxs-lookup"><span data-stu-id="e915e-339">Failover (Planned)</span></span>](/rest/api/sql/failovergroups/failover) | <span data-ttu-id="e915e-340">Conmuta por error desde el servidor principal actual en este servidor.</span><span class="sxs-lookup"><span data-stu-id="e915e-340">Fails over from the current primary server to this server.</span></span> |
| [<span data-ttu-id="e915e-341">Forzar la conmutación por error ocasiona la pérdida de datos</span><span class="sxs-lookup"><span data-stu-id="e915e-341">Force Failover Allow Data Loss</span></span>](/rest/api/sql/failovergroups/forcefailoverallowdataloss) |<span data-ttu-id="e915e-342">Conmuta por error desde el servidor principal actual en este servidor.</span><span class="sxs-lookup"><span data-stu-id="e915e-342">ails over from the current primary server to this server.</span></span> <span data-ttu-id="e915e-343">Esta operación puede ocasionar pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="e915e-343">This operation might result in data loss.</span></span> |
| [<span data-ttu-id="e915e-344">Obtener grupo de conmutación por error</span><span class="sxs-lookup"><span data-stu-id="e915e-344">Get Failover Group</span></span>](/rest/api/sql/failovergroups/get) | <span data-ttu-id="e915e-345">Obtiene un grupo de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="e915e-345">Gets a failover group.</span></span> |
| [<span data-ttu-id="e915e-346">Enumerar grupos de conmutación por error por servidor</span><span class="sxs-lookup"><span data-stu-id="e915e-346">List Failover Groups By Server</span></span>](/rest/api/sql/failovergroups/listbyserver) | <span data-ttu-id="e915e-347">Enumera los grupos de conmutación por error de un servidor.</span><span class="sxs-lookup"><span data-stu-id="e915e-347">Lists the failover groups in a server.</span></span> |
| [<span data-ttu-id="e915e-348">Actualizar grupo de conmutación por error</span><span class="sxs-lookup"><span data-stu-id="e915e-348">Update Failover Group</span></span>](/rest/api/sql/failovergroups/update) | <span data-ttu-id="e915e-349">Actualiza un grupo de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="e915e-349">Updates a failover group.</span></span> |
|  | |

## <a name="next-steps"></a><span data-ttu-id="e915e-350">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="e915e-350">Next steps</span></span>
* <span data-ttu-id="e915e-351">Para los scripts de ejemplo, vea:</span><span class="sxs-lookup"><span data-stu-id="e915e-351">For sample scripts, see:</span></span>
   - [<span data-ttu-id="e915e-352">Configuración y conmutación por error de una base de datos única mediante la replicación geográfica activa</span><span class="sxs-lookup"><span data-stu-id="e915e-352">Configure and failover a single database using active geo-replication</span></span>](scripts/sql-database-setup-geodr-and-failover-database-powershell.md)
   - [<span data-ttu-id="e915e-353">Configuración y conmutación por error de una base de datos agrupada mediante la replicación geográfica activa</span><span class="sxs-lookup"><span data-stu-id="e915e-353">Configure and failover a pooled database using active geo-replication</span></span>](scripts/sql-database-setup-geodr-and-failover-pool-powershell.md)
   - [<span data-ttu-id="e915e-354">Configurar y conmutar por error un grupo de conmutación por error para una sola base de datos (versión preliminar)</span><span class="sxs-lookup"><span data-stu-id="e915e-354">Configure and failover a failover group for a single database (preview)</span></span>](scripts/sql-database-setup-geodr-failover-database-failover-group-powershell.md)
* <span data-ttu-id="e915e-355">Para obtener una descripción general y los escenarios de la continuidad empresarial, consulte [Información general sobre la continuidad empresarial](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="e915e-355">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="e915e-356">Para saber en qué consisten las copias de seguridad automatizadas de Base de datos SQL de Azure, consulte [Información general: copias de seguridad automatizadas de Base de datos SQL](sql-database-automated-backups.md).</span><span class="sxs-lookup"><span data-stu-id="e915e-356">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md).</span></span>
* <span data-ttu-id="e915e-357">Si quiere saber cómo usar las copias de seguridad automatizadas para procesos de recuperación, consulte [Recuperación de una base de datos a partir de copias de seguridad iniciadas por un servicio](sql-database-recovery-using-backups.md).</span><span class="sxs-lookup"><span data-stu-id="e915e-357">To learn about using automated backups for recovery, see [Restore a database from the service-initiated backups](sql-database-recovery-using-backups.md).</span></span>
* <span data-ttu-id="e915e-358">Para obtener información acerca de los requisitos de autenticación para un nuevo servidor principal y la base de datos, consulte [Administración de la seguridad de Base de datos SQL de Azure después de la recuperación ante desastres](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="e915e-358">To learn about authentication requirements for a new primary server and database, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>


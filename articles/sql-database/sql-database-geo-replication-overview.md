---
title: "aaaFailover grupos y la replicación geográfica activa - base de datos de SQL de Azure | Documentos de Microsoft"
description: "Grupos de conmutación por error automática con la replicación geográfica activa permite toosetup 4 réplicas de la base de datos en cualquiera de los centros de datos de Azure de Hola y autoomatically conmutación por error en caso de hello de una interrupción."
services: sql-database
documentationcenter: na
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 2a29f657-82fb-4283-9a83-e14a144bfd93
ms.service: sql-database
ms.custom: business continuity
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: NA
ms.date: 07/10/2017
ms.author: sashan
ms.openlocfilehash: 7a39af8505624c0f19c5abccff051af836b1f9bc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="overview-failover-groups-and-active-geo-replication"></a>Introducción: grupos de conmutación por error y replicación geográfica activa
Replicación geográfica activa permite tooconfigure seguridad toofour legible bases de datos secundarias en hello ubicaciones (regiones) del centro de datos de la mismos o distintos. Bases de datos secundarias están disponibles para las consultas y de conmutación por error en caso de hello de datos center interrupción o hello incapacidad tooconnect toohello base de datos principal. Hola conmutación por error debe iniciar manualmente la aplicación hello del usuario de Hola. Después de la conmutación por error, la nueva réplica principal de hello tiene un extremo de una conexión distinta. 

> [!NOTE]
> La replicación geográfica activa está disponible para todas las bases de datos en todos los niveles de servicio de todas las regiones.
>  

Grupos de conmutación por error automática de base de datos de SQL Azure (en vista previa) es un tooautomatically de característica diseñada de base de datos SQL administrar la relación de replicación geográfica, la conectividad y conmutación por error a escala. Con él, Hola clientes ganancia Hola capacidad tooautomatically recuperar varias bases de datos relacionadas en la región secundaria Hola después de errores catastróficos regionales u otros eventos no planeadas que dan como resultado una pérdida completa o parcial de hello del servicio de base de datos SQL disponibilidad de la región principal de Hola. Además, puede usar Hola bases de datos secundarias legibles toooffload de solo lectura las cargas de trabajo.  Dado que los grupos de conmutación por error automática implican varias bases de datos que deben configurarse en el servidor principal de Hola. Los servidores principales y secundarios deben estar en hello misma suscripción. Grupos de conmutación por error automática admiten la replicación de todas las bases de datos en hello grupo tooonly un servidor secundario en una región distinta. Permite que la replicación geográfica activa, sin grupos de conmutación por error automática, un too4 secundarias en cualquier región.

Si usa replicación geográfica activa y de cualquier motivo que se produce un error en la base de datos principal, o simplemente se desconecta toobe de necesidades, puede iniciar tooany de conmutación por error de las bases de datos secundarias. Cuando conmutación por error es activado tooone de bases de datos secundarias de hello, todos los demás elementos secundarios son toohello automáticamente vinculado nuevo elemento principal. Si utilizas una conmutación por error automática agrupa cualquier interrupción que afecta a una o varias de las bases de datos de hello en los resultados del grupo de hello en conmutación automática por error y recuperación de la base de datos de toomanage (en vista previa). Puede configurar la directiva de conmutación por error automática de Hola que mejor se adapte a sus necesidades de aplicación, o puede dejar de participar y use la activación manual. Además, los grupos de conmutación por error automática (en versión preliminar) proporcionan puntos de conexión de agentes de escucha de lectura-escritura y de solo lectura que no se modifican durante las conmutaciones por error. Si se utiliza la activación de la conmutación por error manual o automática, conmutación por error cambia todas las bases de datos secundarias en hello tooprimary de grupo. Una vez completada la conmutación por error de base de datos de hello, registro DNS de hello es nueva región de tooredirect actualizan automáticamente Hola extremos toohello.

Con la replicación geográfica activa puede administrar la replicación y la conmutación por error de una base de datos individual o de un conjunto de bases de datos en un servidor o en un grupo elástico. Puede hacer que el uso de hello [portal de Azure](sql-database-geo-replication-portal.md), [PowerShell](sql-database-geo-replication-powershell.md), [Transact-SQL](sql-database-geo-replication-transact-sql.md), o hello [API de REST](https://msdn.microsoft.com/library/azure/mt163685.aspx). Después de la conmutación por error, asegúrese de que los requisitos de autenticación de hello para el servidor y la base de datos se configuran en la nueva réplica principal de Hola. Para obtener más información, consulte [Administración de la seguridad de Base de datos SQL de Azure después de la recuperación ante desastres](sql-database-geo-replication-security-config.md). Esto aplica tanto tooactive replicación geográfica y la conmutación por error automática grupos (en vista previa).

Hola de replicación geográfica activa aprovecha [Always On](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server) tecnología de SQL Server tooasynchronously replicar las transacciones confirmadas en hello principal de la base de datos tooa base de datos secundaria mediante el aislamiento de instantánea de lectura confirmada (RCSI). Grupos de conmutación por error automática proporcionan semántica de grupo de hello encima de replicación geográfica activa, pero se usa el mismo mecanismo de replicación asincrónica de Hola. Mientras que en un momento determinado, base de datos secundaria de Hola puede estar ligeramente por detrás de la base de datos principal de Hola, se garantiza que los datos secundarios de hello toonever tienen transacciones parciales. La redundancia entre regiones permite recuperar tooquickly de las aplicaciones de una pérdida permanente de un centro de datos completa o partes de un centro de datos causada por desastres naturales, errores humanos catastróficos o actos malintencionados. datos específicos de RPO de Hello pueden encontrarse en [información general de la continuidad del negocio](sql-database-business-continuity.md).

Hello en la ilustración siguiente se muestra un ejemplo de replicación geográfica activa configurado con un elemento principal en la región de hello Ee.uu. Central Norte y secundaria en la región de hello Ee.uu. Central sur.

![Relación de replicación geográfica](./media/sql-database-active-geo-replication/geo-replication-relationship.png)

Dado que las bases de datos secundaria de hello son legibles, pueden ser utilizados toooffload de solo lectura las cargas de trabajo como trabajos de informes. Si usa replicación geográfica activa, es base de datos secundaria de posibles toocreate Hola Hola misma región con hello principal, pero no aumenta toocatastrophic errores de la aplicación hello resistencia. Si usa grupos de conmutación por error automática (en versión preliminar), las bases de datos secundarias siempre se crean en otra región.

Además, toodisaster recuperación replicación geográfica activa puede usarse en hello los escenarios siguientes:

* **Migración de base de datos**: puede usar replicación geográfica activa toomigrate una base de datos desde un servidor tooanother en línea con el tiempo de inactividad mínimo.
* **Actualizaciones de aplicaciones**: puede crear una base de datos secundaria adicional como copia de conmutación por recuperación durante las actualizaciones de la aplicación.

continuidad del negocio real tooachieve, agregar redundancia de la base de datos entre centros de datos es solo una parte de la solución de Hola. Recuperación de una aplicación (servicio)-to-end después de un error catastrófico requiere la recuperación de todos los componentes que constituyen el servicio de Hola y todos los servicios dependientes. Ejemplos de estos componentes incluyen el software de cliente de hello (por ejemplo, un explorador con JavaScript personalizado), front-end web, almacenamiento y DNS. Es fundamental que todos los componentes son resistente toohello mismos errores y estén disponibles en el objetivo de tiempo de recuperación (RTO) de hello de la aplicación. Por lo tanto, es necesario tooidentify todos los servicios dependientes y comprender garantías de Hola y las capacidades que proporcionan. A continuación, debe tomar tooensure los pasos adecuados que el servicio funcione durante Hola conmutación por error de los servicios de Hola que depende. Para más información sobre el diseño de soluciones para la recuperación ante desastres, consulte [Diseño de soluciones de nube para la continuidad empresarial mediante la replicación geográfica activa](sql-database-designing-cloud-solutions-for-disaster-recovery.md).

## <a name="active-geo-replication-capabilities"></a>Funcionalidades de replicación geográfica activa
característica de replicación geográfica activa Hola proporciona Hola después capacidades esenciales:
* **Replicación asincrónica automática**: solo puede crear una base de datos secundaria mediante la adición de tooan la base de datos existente. Hola secundaria puede crearse en cualquier servidor de base de datos de SQL Azure. Una vez creado, base de datos secundaria de Hola se rellena con datos de hello copiados de la base de datos principal de Hola. Este proceso se conoce como propagación. Después de haber creado y propagado base de datos secundaria, las actualizaciones de base de datos principal de toohello son asincrónicamente replican automáticamente toohello base de datos secundaria. Replicación asincrónica significa que las transacciones se confirman en la base de datos principal de hello antes de que se toohello replicadas de base de datos secundaria. 
* **Bases de datos secundarias legibles**: una aplicación puede tener acceso a una base de datos secundaria para las operaciones de solo lectura usando Hola igual o entidades de seguridad diferente que se usan para tener acceso a la base de datos principal de Hola. Hello bases de datos secundarias funcionan en aislamiento de instantánea modo tooensure la replicación de las actualizaciones de Hola de hello principal (reproducción del registro) no se retrasa por las consultas ejecutadas en hello secundaria.

   > [!NOTE]
   > reproducción de registro de Hello se retrasa en base de datos secundaria de hello si hay actualizaciones del esquema que está recibiendo Hola principal que requieren un bloqueo de esquema de base de datos secundaria de Hola. 
   > 

* **Varias réplicas secundarias legibles**: dos o más bases de datos secundarias aumentan la redundancia y nivel de protección de la base de datos principal de Hola y de aplicación. Si existen varias bases de datos secundarias, aplicación hello permanece protegido incluso si se produce un error en una de las bases de datos secundaria de Hola. Si hay una base de datos secundaria, y se produce un error, se expone la aplicación hello toohigher riesgo hasta que se cree una nueva base de datos secundaria.

   > [!NOTE]
   > Si usa replicación geográfica activa toobuild una aplicación distribuida globalmente y necesita tooprovide de solo lectura, tener acceso a toodata en más de 4 regiones, puede crear secundaria de una base de datos secundaria (es decir, un proceso conocido como encadenamiento). De este modo, puede alcanzar una escala prácticamente ilimitada de replicación de la base de datos. Además, el encadenamiento de reduce la sobrecarga de Hola de replicación de base de datos principal de Hola. Hola aún retardo de aumento de la replicación de hello en bases de datos secundarias de hello más hoja. . 
   >

* **Compatibilidad con bases de datos de grupos elásticos**: la replicación geográfica activa se puede configurar para cualquier base de datos en un grupo elástico. base de datos secundaria de Hello puede estar en otro grupo elástico. Para bases de datos normales, Hola secundaria puede ser un grupo elástico y viceversa siempre que sean de niveles de servicio de Hola Hola igual. 
* **Nivel de rendimiento configurables de la base de datos secundaria de Hola**: puede crear una base de datos secundaria con el nivel de rendimiento inferior a Hola principal. Las bases de datos principales y secundarias son necesarios toohave Hola de mismo nivel de servicio. Esta opción no se recomienda para las aplicaciones con la actividad de escritura de base de datos alta debido a retrasos de replicación mayor de hello aumenta Hola riesgo considerable pérdida de datos después de una conmutación por error. Además, después de que se ve afectado el rendimiento de la aplicación de conmutación por error Hola hasta Hola nueva principal es tooa actualizado un rendimiento más alto nivel. gráfico de porcentaje de E/S de registro en el portal de Azure Hello proporciona una buena manera tooestimate Hola nivel mínimo en el rendimiento de hello secundaria que es necesario toosustain Hola replicación carga. Por ejemplo, si la base de datos principal es P6 (1000 DTU) y su porcentaje de E/S de registro es 50% Hola secundaria debe toobe al menos P4 (DTU 500). También puede recuperar los datos de E/S de registro de hello usando [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) o [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) vistas de base de datos.  Para obtener más información sobre los niveles de rendimiento de base de datos SQL de hello, consulte [opciones de base de datos SQL y el rendimiento](sql-database-service-tiers.md). 
* **Controlado por el usuario de conmutación por error y conmutación por recuperación**: una base de datos secundaria puede ser explícitamente rol principal toohello desactivados en cualquier momento mediante la aplicación hello o usuario Hola. Durante una Hola de interrupción reales se debería usar opción "no planeado", lo que promueve toobe secundaria Hola principal. Cuando Hola error principal recupera y está disponible de nuevo, sistema Hola automáticamente Hola marcas recuperar principal como una base de datos secundaria y ponerla al día con la nueva réplica principal de Hola. Pagar toohello naturaleza asincrónica de la replicación, una pequeña cantidad de datos se puede perder durante las conmutaciones por error no planeada si se produce un error en la principal antes de replicarse toohello de cambios más reciente de hello secundaria. Cuando un elemento principal con varias secundarias conmuta por error, sistema Hola vuelve a configurar automáticamente las relaciones de replicación de Hola y Hola vínculos restantes secundarias toohello recién promovido principal sin necesidad de intervención del usuario. Una vez se mitiga la interrupción de Hola que causó la conmutación por error de hello, puede ser deseable tooreturn región principal de hello aplicación toohello. toodo que, se debe invocar comando de conmutación por error de hello con hello "planeada" opción. 
* **Mantener las credenciales y las reglas de firewall sincronizados**: se recomienda usar [las reglas de firewall de base de datos](sql-database-firewall-configure.md) para bases de datos de replicación geográfica para estas reglas se pueden replicar con tooensure de base de datos de hello todas las bases de datos secundarias tienen Hola las mismas reglas de firewall que Hola principal. Este enfoque elimina la necesidad de Hola para los clientes toomanually configurar y mantener las reglas de firewall en servidores que hospedan las bases de datos principal y secundaria de Hola. De igual forma, mediante [usuarios de base de datos independiente](sql-database-manage-logins.md) para datos de acceso garantiza bases de datos principales y secundarias tienen siempre hello las credenciales de usuario mismo, por lo que durante una conmutación por error, no hay ningún interrupciones toomismatches debido a inicios de sesión y contraseñas. Con la adición de Hola de [Azure Active Directory](../active-directory/active-directory-whatis.md), los clientes pueden administrar usuario acceso tooboth principal y secundaria bases de datos y lo que elimina Hola necesita para administrar las credenciales en las bases de datos por completo.

## <a name="auto-failover-group-capabilities"></a>Funcionalidades de los grupos de conmutación por error automática

La característica de grupos de conmutación por error automática proporciona una abstracción eficaz de la replicación geográfica activa mediante la compatibilidad de la conmutación por error automática y la replicación a nivel de grupo. Además, quita cadena de conexión de SQL de Hola Hola necesidad toochange después de la conmutación por error al proporcionar extremos de agente de escucha adicional de Hola. 

* **Grupo de conmutación por error**: se pueden crear uno o más grupos de conmutación por error entre dos servidores en regiones distintas (servidor principal y servidor secundario). Cada grupo puede incluir una o varias bases de datos que se recuperen como una unidad en caso de algunas o todas las bases de datos principales de estar disponibles debido a una interrupción de tooan en la región principal de Hola.  
* **Servidor principal**: un servidor que hospeda las bases de datos principales de hello en el grupo de conmutación por error de Hola.
* **Servidor secundario**: un servidor que hospeda las bases de datos secundarias de hello en el grupo de conmutación por error de Hola. no puede ser el servidor secundario de Hola Hola misma región que el servidor principal de Hola.
* **Agregar grupo de toofailover de bases de datos**: puede colocar varias bases de datos dentro de un servidor o dentro de un flexible del grupo en hello mismo grupo de conmutación por error. Si agrega un grupo de toohello de base de datos independiente, crea automáticamente una base de datos secundaria utilizando Hola la mismo edición y nivel de rendimiento. Si la base de datos principal de hello está en un grupo elástico, Hola secundaria se crea automáticamente en grupo elástico Hola con hello mismo nombre. Si agrega una base de datos que ya tiene una base de datos secundaria en el servidor secundario de hello, que la replicación geográfica se hereda por grupo de Hola.

   > [!NOTE]
   > Al agregar una base de datos que ya tiene una base de datos secundaria en un servidor que no forma parte del grupo de conmutación por error de hello, se crea una nueva base de datos secundaria en el servidor secundario de Hola. 
   >

* **Agente de escucha de lectura y escritura de grupo de conmutación por error**: un registro DNS CNAME formado como  **&lt;nombre del grupo de conmutación por error&gt;. database.windows.net** que apunte toohello dirección URL del servidor principal actual. Permite hello las aplicaciones de SQL de lectura y escritura tootransparently conectar toohello base de datos principal cuando Hola principal cambia después de la conmutación por error. 
* **Escucha de solo lectura del grupo de conmutación por error**: un registro DNS CNAME formado como  **&lt;nombre del grupo de conmutación por error&gt;. secondary.database.windows.net** que señala la dirección URL del servidor secundario toohello. Hola permite que las aplicaciones de SQL de solo lectura que conectar tootransparently toohello base de datos secundaria con hello especifica las reglas de equilibrio de carga. También puede especificar si desea Hola de solo lectura toobe tráfico redirigir automáticamente toohello de servidor principal al servidor secundario de hello no está disponible.
* **Directiva de conmutación por error automática**: de forma predeterminada, el grupo de conmutación por error de hello está configurado con una directiva de conmutación por error automática. Hola conmutación por error de sistema desencadenadores en cuanto se detectó un error de Hola. Si desea que el flujo de trabajo de toocontrol Hola conmutación por error de la aplicación hello, puede desactivar la conmutación automática por error. 
* **Conmutación por error manual**: conmutación por error se puede iniciar manualmente en cualquier momento, independientemente de la configuración de conmutación automática por error de Hola. Si la directiva de conmutación por error automática no está configurada de conmutación por error manual es toorecover requiere las bases de datos en el grupo de conmutación por error de Hola. Puede iniciar una conmutación por error forzada o sencilla (con sincronización total de los datos). Hola este último podría ser región principal del toohello toorelocate usado Hola servidor activo. Cuando se completa la conmutación por error los registros DNS de hello son tooensure actualizan automáticamente conectividad toohello correcto del servidor.
* **Período de gracia con pérdida de datos**: debido a bases de datos principal y secundaria de Hola se sincronizan con conmutación por error de replicación asincrónica Hola puede producir pérdida de datos. Puede personalizar tooreflect de directiva de conmutación por error automática de hello pérdida de toodata de tolerancia de la aplicación. Mediante la configuración de **GracePeriodWithDataLossHours**, puede controlar cuánto tiempo espera el sistema Hola antes de iniciar la conmutación por error de hello tooresult probable pérdida de datos. 

   > [!NOTE]
   > Cuando el sistema detecta la que las bases de datos de hello en el grupo de hello aún están en línea (por ejemplo, interrupción de hello solo afectada plano de control de servicio de hello), activa inmediatamente Hola conmutación por error con la sincronización de datos completa (conmutación por error descriptivo), independientemente del valor de Hola establecer **GracePeriodWithDataLossHours**. Este comportamiento garantiza que no hay ninguna pérdida de datos durante la recuperación de Hola. período de gracia de Hello surte efecto cuando no es posible una conmutación por error descriptivo. Si la interrupción de Hola se mitiga antes de que expire el período de gracia de hello, Hola conmutación por error no está activado.
   >

* **Varios grupos de conmutación por error**: puede configurar varios grupos de conmutación por error para hello mismo par de escala de hello toocontrol de servidores de las conmutaciones por error. Cada grupo realiza la conmutación por error por separado. Si su aplicación multiempresa usa grupos elásticos, puede usar esta capacidad toomix principal y secundaria bases de datos de cada grupo. De esta forma puede reducir el Hola impacto de una interrupción tooonly la mitad de los inquilinos de Hola.

## <a name="best-practices-of-building-highly-available-service"></a>Procedimientos recomendados para la creación de servicios de alta disponibilidad

toobuild un servicio de alta disponibilidad que utiliza a los clientes Hola de base de datos SQL de Azure debe seguir estas directrices:
- **Utilizar el grupo de conmutación por error**: se pueden crear uno o varios grupos de conmutación por error entre dos servidores en regiones distintas (servidor principal y servidor secundario). Cada grupo puede incluir una o varias bases de datos que se recuperen como una unidad en caso de algunas o todas las bases de datos principales de estar disponibles debido a una interrupción de tooan en la región principal de Hola. grupo de conmutación por error de Hello crea la base de datos de replicación geográfica secundaria con hello mismo objetivo como Hola principal de servicio. Si agrega que una existente replicación geográfica relación toohello conmutación por error grupo Asegúrese seguro Hola geográfica-réplica secundaria está configurada con hello igual como objetivo de nivel de servicio Hola principal.
- **Utilizar el agente de escucha de lectura y escritura para la carga de trabajo OLTP**: al realizar el uso de las operaciones OLTP  **&lt;nombre del grupo de conmutación por error&gt;. database.windows.net** como dirección URL del servidor de Hola y conexiones de hello será toohello automáticamente dirigido principal. Esta dirección URL no cambiará después Hola conmutación por error.  
Conmutación por error de nota Hola implica la actualización Hola por lo que las conexiones de cliente de hello será redirigido toohello nuevo principal solo después de que el cliente de hello DNS actualiza la caché del registro DNS.
- **Utilizar el agente de escucha de solo lectura para la carga de trabajo de solo lectura**: Si tienes aislada lógicamente de solo lectura carga de trabajo con tolerancia a errores toocertain obsolescencia de los datos, puede usar la base de datos secundaria de hello en aplicación hello. Para utilizarán las sesiones de sólo lectura  **&lt;nombre del grupo de conmutación por error&gt;. secondary.database.windows.net** como dirección URL del servidor de Hola y conexión de hello será dirigido automáticamente toohello secundaria. También se recomienda indicar en la cadena de conexión el intento de lectura mediante **ApplicationIntent=ReadOnly**. 
- **Prepárese para la degradación del rendimiento**: decisión de conmutación por error SQL es independiente del resto de Hola de aplicación hello u otros servicios que se utiliza. aplicación Hello puede ser "mixto" con algunos componentes de una región y otras en otro. degradación de hello tooavoid, asegúrese de implementación de aplicaciones redundantes de hello en región Hola DR y siga las instrucciones de hello en este artículo.  
Aplicación de hello nota en la región de recuperación ante desastres de hello no tiene toouse una cadena de conexión diferentes.  
- **Preparar la pérdida de datos**: si se detecta una interrupción del servicio, SQL desencadena automáticamente la conmutación por error de lectura y escritura si hay cero toohello de pérdida de datos lo mejor de nuestro conocimiento. En caso contrario, se espera especificado por el período de hello **GracePeriodWithDataLossHours**. Si especificó **GracePeriodWithDataLossHours**, prepárese para la pérdida de datos. Por lo general, durante las interrupciones, Azure favorece la disponibilidad. Si no puede permitirse perder datos, asegúrese de seguro tooset **GracePeriodWithDataLossHours** número suficientemente grande de tooa, por ejemplo, 24 horas. 


## <a name="upgrading-or-downgrading-a-primary-database"></a>Actualización o degradación de una base de datos principal
Puede actualizar o degradar un nivel de rendimiento de base de datos principal tooa (dentro de hello mismo nivel de servicio) sin desconectar las bases de datos secundarias. Al actualizar, se recomienda que actualizar base de datos secundaria de hello en primer lugar y, a continuación, actualizar Hola principal. Al degradar, invierta el orden de hello: degradar Hola principal primero y, a continuación, baje Hola secundaria. Al actualizar o cambiar el nivel de servicio diferente de tooa de base de datos de hello esta recomendación se aplica. 

> [!NOTE]
> Si ha creado la base de datos secundaria como parte de la configuración de grupo de conmutación por error de hello no es base de datos secundaria de toodowngrade recomendada Hola. Se trata de tooensure el nivel de datos tiene suficiente tooprocess capacidad su carga de trabajo normal después de activa la conmutación por error. 
>

## <a name="preventing-hello-loss-of-critical-data"></a>Para evitar la pérdida de Hola de datos críticos
Pagar toohello alta latencia de redes de área extensa, copia continua usa un mecanismo de replicación asincrónica. La replicación asincrónica hace inevitable la pérdida de cierta cantidad datos si se produce un error. Sin embargo, es posible que algunas aplicaciones exijan que no se pierdan datos. tooprotect estas actualizaciones críticas, un desarrollador de aplicaciones pueden llamar a hello [sp_wait_for_database_copy_sync](https://msdn.microsoft.com/library/dn467644.aspx) procedimiento del sistema inmediatamente después de confirmar la transacción de Hola. Al llamar a **sp_wait_for_database_copy_sync** Hola bloques subproceso de llamada hasta que la última transacción confirmada de hello ha sido transmitida toohello base de datos secundaria. Sin embargo, no espere para hello transmitida transacciones toobe reproducir y se confirman en hello secundaria. **sp_wait_for_database_copy_sync** tooa ámbito vínculo de copia continua específico. Cualquier usuario con hello conexión derechos toohello base de datos principal puede llamar a este procedimiento.

> [!NOTE]
> **sp_wait_for_database_copy_sync** evitará la pérdida de datos después de la conmutación por error, pero no garantizará la sincronización completa para el acceso de lectura. Hola retraso causado por un **sp_wait_for_database_copy_sync** llamada a procedimiento puede ser considerable y depende de tamaño de Hola Hola del registro de transacciones en tiempo de Hola de llamada de Hola. 
> 

## <a name="programmatically-managing-failover-groups-and-active-geo-replication"></a>Administración mediante programación de los grupos de conmutación por error y de la replicación geográfica activa
Según lo descrito anteriormente, grupos de conmutación por error automática (en vista previa) y se activa la replicación geográfica también se puede administrar mediante programación con PowerShell de Azure y Hola API de REST. Hola las tablas siguientes describe los conjunto Hola de comandos disponibles.

**API de administrador de recursos de Azure y la seguridad basada en roles**: replicación geográfica activa incluye un conjunto de API de administrador de recursos de Azure para la administración, incluidos hello [API de REST de base de datos de SQL Azure](https://docs.microsoft.com/rest/api/sql/) y [Azure Cmdlets de PowerShell](https://docs.microsoft.com/powershell/azure/overview). Estas API requieren el uso de Hola de grupos de recursos y admiten la seguridad basada en roles (RBAC). Para obtener más información sobre cómo tooimplement tener acceso a los roles, consulte [Azure Role-Based el Control de acceso](../active-directory/role-based-access-control-what-is.md).

> [!NOTE]
> Muchas de las nuevas características de la replicación geográfica activa solo se admiten con [Azure Resource Manager](../azure-resource-manager/resource-group-overview.md), que se basa en la [API de REST de Azure SQL](https://msdn.microsoft.com/library/azure/mt163571.aspx) y los [cmdlets de PowerShell de Azure SQL Database](https://msdn.microsoft.com/library/azure/mt574084.aspx). Hola [API de REST (clásica)](https://msdn.microsoft.com/library/azure/dn505719.aspx) y [cmdlets de base de datos de SQL de Azure (clásica)](https://msdn.microsoft.com/library/azure/dn546723.aspx) se admiten por compatibilidad con versiones anteriores mediante Hola se recomiendan las API basadas en el Administrador de recursos de Azure. 
> 

## <a name="manage-sql-database-failover-using-using-transact-sql"></a>Administrar SQL proceso de uso de conmutación por error de base de datos mediante Transact-SQL

| Comando | Description |
| --- | --- |
| [ALTER DATABASE (Base de datos SQL de Azure)](https://msdn.microsoft.com/library/mt574871.aspx) |Usar Agregar secundario ON SERVER argumento toocreate una base de datos secundaria para una base de datos existente e inicia la replicación de datos |
| [ALTER DATABASE (Base de datos SQL de Azure)](https://msdn.microsoft.com/library/mt574871.aspx) |Utilizar la conmutación por error o FORCE_FAILOVER_ALLOW_DATA_LOSS tooswitch una conmutación por error de base de datos secundaria toobe tooinitiate principal |
| [ALTER DATABASE (Base de datos SQL de Azure)](https://msdn.microsoft.com/library/mt574871.aspx) |Utilice Quitar secundaria ON SERVER tooterminate una replicación de datos entre una base de datos SQL y la base de datos secundaria Hola especificado. |
| [sys.geo_replication_links (Azure SQL Database)](https://msdn.microsoft.com/library/mt575501.aspx) |Devuelve información acerca de todos los vínculos de replicación existente para cada base de datos en el servidor lógico de base de datos de SQL Azure Hola. |
| [sys.dm_geo_replication_link_status (Azure SQL Database)](https://msdn.microsoft.com/library/mt575504.aspx) |Obtiene Hola última hora de la replicación, último intervalo de replicación y otra información sobre el vínculo de replicación de Hola para una base de datos SQL. |
| [sys.dm_operation_status (Azure SQL Database)](https://msdn.microsoft.com/library/dn270022.aspx) |Muestra el estado de Hola de todas las operaciones de base de datos, incluido el estado de Hola Hola vínculos de replicación. |
| [sp_wait_for_database_copy_sync (Azure SQL Database)](https://msdn.microsoft.com/library/dn467644.aspx) |provoca Hola aplicación toowait hasta que todas las transacciones confirmadas se replica y confirma por base de datos secundaria Hola activa. |
|  | |

## <a name="manage-sql-database-failover-using-using-powershell"></a>Administrar SQL base de datos de conmutación por error utilizando PowerShell

| Cmdlet | Descripción |
| --- | --- |
| [Get-AzureRmSqlDatabase](/powershell/module/azurerm.sql/get-azurermsqldatabase) |Obtiene una o más bases de datos. |
| [New-AzureRmSqlDatabaseSecondary](/powershell/module/azurerm.sql/new-azurermsqldatabasesecondary) |Crea una base de datos secundaria para una base de datos existente e inicia la replicación de datos. |
| [Set-AzureRmSqlDatabaseSecondary](/powershell/module/azurerm.sql/set-azurermsqldatabasesecondary) |Se activa una conmutación por error de base de datos secundaria toobe tooinitiate principal. |
| [Remove-AzureRmSqlDatabaseSecondary](/powershell/module/azurerm.sql/remove-azurermsqldatabasesecondary) |Finaliza la replicación de datos entre una base de datos SQL y la base de datos secundaria Hola especificado. |
| [Get-AzureRmSqlDatabaseReplicationLink](/powershell/module/azurerm.sql/get-azurermsqldatabasereplicationlink) |Obtiene los vínculos de replicación geográfica de hello entre una base de datos de SQL Azure y un grupo de recursos o SQL Server. |
| [New-AzureRmSqlDatabaseFailoverGroup](/powershell/module/azurerm.sql/set-azurermsqldatabasefailovergroup) |   Este comando crea un grupo de conmutación por error y lo registra en el servidor principal y el servidor secundario|
| [Remove-AzureRmSqlDatabaseFailoverGroup](/powershell/module/azurerm.sql/remove-azurermsqldatabasefailovergroup) | Quita el grupo de conmutación por error de Hola de servidor hello y elimina todas las bases de datos secundarias incluidas hello grupo |
| [Get-AzureRmSqlDatabaseFailoverGroup](/powershell/module/azurerm.sql/get-azurermsqldatabasefailovergroup) | Recupera la configuración de grupo de conmutación por error de Hola |
| [Set-AzureRmSqlDatabaseFailoverGroup](/powershell/module/azurerm.sql/set-azurermsqldatabasefailovergroup) |   Modifica la configuración de Hola de grupo de conmutación por error de Hola |
| [Switch-AzureRMSqlDatabaseFailoverGroup](/powershell/module/azurerm.sql/switch-azurermsqldatabasefailovergroup) | Conmutación por error de desencadenadores de servidor secundario de la toohello del grupo de hello conmutación por error |
|  | |

> [!IMPORTANT]
> Para los scripts de ejemplo, vea [Configuración y conmutación por error de una única base de datos mediante la replicación geográfica activa](scripts/sql-database-setup-geodr-and-failover-database-powershell.md), [Configuración y conmutación por error de una base de datos agrupada mediante la replicación geográfica activa](scripts/sql-database-setup-geodr-and-failover-pool-powershell.md) y [Configuración y conmutación por error de un grupo de conmutación por error para una única base de datos (versión preliminar)](scripts/sql-database-setup-geodr-failover-database-failover-group-powershell.md.
>

## <a name="manage-sql-database-failover-using-hello-rest-api"></a>Administrar la conmutación por error de base de datos SQL con hello API de REST
| API | Description |
| --- | --- |
| [Crear o actualizar base de datos (createMode=Restore)](/rest/api/sql/Databases/CreateOrUpdate) |Crea, actualiza o restaura una base de datos principal o secundaria. |
| [Obtener el estado de creación o actualización de la base de datos](/rest/api/sql/Databases/CreateOrUpdate) |Devuelve el estado de Hola durante una operación de creación. |
| [Establecer la base de datos secundaria como principal (conmutación por error planeada)](https://docs.microsoft.com/rest/api/sql/replicationlinkss#ReplicationLinks_Failover) |Establece qué base de datos de réplica es principal con conmutación por error de base de datos de réplica principal actual Hola. |
| [Establecer la base de datos secundaria como principal (conmutación por error no planeada)](https://docs.microsoft.com/rest/api/sql/replicationlinks#ReplicationLinks_FailoverAllowDataLoss) |Establece qué base de datos de réplica es principal con conmutación por error de base de datos de réplica principal actual Hola. Esta operación puede ocasionar pérdida de datos. |
| [Obtener vínculo de replicación](/rest/api/sql/replicationlinks/get) |Obtiene un vínculo de replicación específico para una Base de datos SQL determinada en una asociación de replicación geográfica. Recupera información de hello visible en la vista de catálogo sys.geo_replication_links Hola. |
| [Vínculos de replicación: lista por base de datos](/rest/api/sql/replicationlinks/listbydatabase) | Obtiene todos los vínculos de replicación para una Base de datos SQL determinada en una asociación de replicación geográfica. Recupera información de hello visible en la vista de catálogo sys.geo_replication_links Hola. |
| [Eliminar vínculo de replicación](/rest/api/sql/databases/delete) | Elimina un vínculo de replicación de base de datos. No se puede realizar durante la conmutación por error. |
| [Crear o actualizar un grupo de conmutación por error]/rest/api/sql/failovergroups/createorupdate) | Crea o actualiza un grupo de conmutación por error. |
| [Eliminar grupo de conmutación por error](/rest/api/sql/failovergroups/delete) | Quita el grupo de conmutación por error de Hola de servidor hello |
| [Conmutación por error (planeada)](/rest/api/sql/failovergroups/failover) | Conmuta por error de seguridad del servidor de toothis de servidor principal actual de Hola. |
| [Forzar la conmutación por error ocasiona la pérdida de datos](/rest/api/sql/failovergroups/forcefailoverallowdataloss) |les a través del servidor de toothis de servidor principal actual de Hola. Esta operación puede ocasionar pérdida de datos. |
| [Obtener grupo de conmutación por error](/rest/api/sql/failovergroups/get) | Obtiene un grupo de conmutación por error. |
| [Enumerar grupos de conmutación por error por servidor](/rest/api/sql/failovergroups/listbyserver) | Enumera los grupos de conmutación por error de hello en un servidor. |
| [Actualizar grupo de conmutación por error](/rest/api/sql/failovergroups/update) | Actualiza un grupo de conmutación por error. |
|  | |

## <a name="next-steps"></a>Pasos siguientes
* Para los scripts de ejemplo, vea:
   - [Configuración y conmutación por error de una base de datos única mediante la replicación geográfica activa](scripts/sql-database-setup-geodr-and-failover-database-powershell.md)
   - [Configuración y conmutación por error de una base de datos agrupada mediante la replicación geográfica activa](scripts/sql-database-setup-geodr-and-failover-pool-powershell.md)
   - [Configurar y conmutar por error un grupo de conmutación por error para una sola base de datos (versión preliminar)](scripts/sql-database-setup-geodr-failover-database-failover-group-powershell.md)
* Para obtener una descripción general y los escenarios de la continuidad empresarial, consulte [Continuidad empresarial con Base de datos SQL de Azure](sql-database-business-continuity.md)
* toolearn acerca de las copias de seguridad automatizada de base de datos SQL Azure, consulte [copias de seguridad automáticas de base de datos SQL](sql-database-automated-backups.md).
* toolearn sobre el uso de copias de seguridad automatizadas para la recuperación, consulte [restaurar una base de datos de copias de seguridad de hello iniciadas por el servicio](sql-database-recovery-using-backups.md).
* toolearn acerca de los requisitos de autenticación para un nuevo servidor principal y la base de datos, vea [seguridad de base de datos de SQL después de la recuperación ante desastres](sql-database-geo-replication-security-config.md).


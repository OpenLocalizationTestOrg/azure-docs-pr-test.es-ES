---
title: Procedimientos recomendados de seguridad de la red de Azure | Microsoft Docs
description: "Obtenga información sobre las características clave disponibles en Azure para crear entornos de red seguros"
services: virtual-network
documentationcenter: na
author: tracsman
manager: rossort
editor: 
ms.assetid: d169387a-1243-4867-a602-01d6f2d8a2a1
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 01/03/2017
ms.author: jonor
ms.openlocfilehash: fb5e399d4ab02a7f2805cc280b213bf5b44f6993
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="microsoft-cloud-services-and-network-security"></a><span data-ttu-id="5747d-103">Servicios en la nube de Microsoft y seguridad de red</span><span class="sxs-lookup"><span data-stu-id="5747d-103">Microsoft cloud services and network security</span></span>
<span data-ttu-id="5747d-104">Servicios en la nube de Microsoft ofrece servicios e infraestructura a gran escala, funcionalidades de calidad empresarial y numerosas opciones de conectividad híbrida.</span><span class="sxs-lookup"><span data-stu-id="5747d-104">Microsoft cloud services deliver hyper-scale services and infrastructure, enterprise-grade capabilities, and many choices for hybrid connectivity.</span></span> <span data-ttu-id="5747d-105">Los clientes pueden elegir tener acceso a estos servicios a través de Internet o con Azure ExpressRoute, que proporciona conectividad de red privada.</span><span class="sxs-lookup"><span data-stu-id="5747d-105">Customers can choose to access these services either via the Internet or with Azure ExpressRoute, which provides private network connectivity.</span></span> <span data-ttu-id="5747d-106">La plataforma Microsoft Azure permite a los clientes ampliar su infraestructura en la nube sin problemas y crear arquitecturas de varios niveles.</span><span class="sxs-lookup"><span data-stu-id="5747d-106">The Microsoft Azure platform allows customers to seamlessly extend their infrastructure into the cloud and build multi-tier architectures.</span></span> <span data-ttu-id="5747d-107">Además, otros fabricantes pueden habilitar funcionalidades mejoradas mediante servicios de seguridad y dispositivos virtuales.</span><span class="sxs-lookup"><span data-stu-id="5747d-107">Additionally, third parties can enable enhanced capabilities by offering security services and virtual appliances.</span></span> <span data-ttu-id="5747d-108">En este documento se proporciona una visión general de los problemas de seguridad y de arquitectura que los clientes deben tener en cuenta al usar Servicios en la nube de Microsoft con acceso a través de ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="5747d-108">This white paper provides an overview of security and architectural issues that customers should consider when using Microsoft cloud services accessed via ExpressRoute.</span></span> <span data-ttu-id="5747d-109">También se describe la creación de servicios más seguros en redes virtuales de Azure.</span><span class="sxs-lookup"><span data-stu-id="5747d-109">It also covers creating more secure services in Azure virtual networks.</span></span>

## <a name="fast-start"></a><span data-ttu-id="5747d-110">Inicio rápido</span><span class="sxs-lookup"><span data-stu-id="5747d-110">Fast start</span></span>
<span data-ttu-id="5747d-111">El gráfico de lógica siguiente puede dirigirle a un ejemplo específico de las numerosas técnicas de seguridad disponibles con la plataforma Azure.</span><span class="sxs-lookup"><span data-stu-id="5747d-111">The following logic chart can direct you to a specific example of the many security techniques available with the Azure platform.</span></span> <span data-ttu-id="5747d-112">Para obtener una referencia rápida, busque el ejemplo que mejor se adapte a su caso.</span><span class="sxs-lookup"><span data-stu-id="5747d-112">For quick reference, find the example that best fits your case.</span></span> <span data-ttu-id="5747d-113">Si necesita una explicación más amplia, siga leyendo el documento.</span><span class="sxs-lookup"><span data-stu-id="5747d-113">For expanded explanations, continue reading through the paper.</span></span>
<span data-ttu-id="5747d-114">[![0]][0]</span><span class="sxs-lookup"><span data-stu-id="5747d-114">[![0]][0]</span></span>

[<span data-ttu-id="5747d-115">Ejemplo 1: Creación de una red perimetral (también conocida como subred filtrada) para proteger las aplicaciones con grupos de seguridad de red (NSG).</span><span class="sxs-lookup"><span data-stu-id="5747d-115">Example 1: Build a perimeter network (also known as DMZ, demilitarized zone, or screened subnet) to help protect applications with network security groups (NSGs).</span></span>](#example-1-build-a-perimeter-network-to-help-protect-applications-with-nsgs)</br><span data-ttu-id="5747d-116">
[Ejemplo 2: Creación de una red perimetral para proteger las aplicaciones con un firewall y grupos de seguridad de red.](#example-2-build-a-perimeter-network-to-help-protect-applications-with-a-firewall-and-nsgs)</span><span class="sxs-lookup"><span data-stu-id="5747d-116">
[Example 2: Build a perimeter network to help protect applications with a firewall and NSGs.](#example-2-build-a-perimeter-network-to-help-protect-applications-with-a-firewall-and-nsgs)</span></span></br><span data-ttu-id="5747d-117">
[Ejemplo 3: Creación de una red perimetral para proteger las redes con un firewall, enrutamiento definido por el usuario (UDR) y grupo de seguridad de red (NSG).](#example-3-build-a-perimeter-network-to-help-protect-networks-with-a-firewall-and-udr-and-nsg)</span><span class="sxs-lookup"><span data-stu-id="5747d-117">
[Example 3: Build a perimeter network to help protect networks with a firewall, user-defined route (UDR), and NSG.](#example-3-build-a-perimeter-network-to-help-protect-networks-with-a-firewall-and-udr-and-nsg)</span></span></br><span data-ttu-id="5747d-118">
[Ejemplo 4: Incorporación de una conexión híbrida con una red privada virtual (VPN) de dispositivo virtual de sitio a sitio.](#example-4-add-a-hybrid-connection-with-a-site-to-site-virtual-appliance-vpn)</span><span class="sxs-lookup"><span data-stu-id="5747d-118">
[Example 4: Add a hybrid connection with a site-to-site, virtual appliance virtual private network (VPN).](#example-4-add-a-hybrid-connection-with-a-site-to-site-virtual-appliance-vpn)</span></span></br><span data-ttu-id="5747d-119">
[Ejemplo 5: Incorporación de una conexión híbrida con una instancia de Azure VPN Gateway de sitio a sitio.](#example-5-add-a-hybrid-connection-with-a-site-to-site-azure-vpn-gateway)</span><span class="sxs-lookup"><span data-stu-id="5747d-119">
[Example 5: Add a hybrid connection with a site-to-site, Azure VPN gateway.](#example-5-add-a-hybrid-connection-with-a-site-to-site-azure-vpn-gateway)</span></span></br><span data-ttu-id="5747d-120">
[Ejemplo 6: Incorporación de una conexión híbrida con ExpressRoute.](#example-6-add-a-hybrid-connection-with-expressroute)</span><span class="sxs-lookup"><span data-stu-id="5747d-120">
[Example 6: Add a hybrid connection with ExpressRoute.](#example-6-add-a-hybrid-connection-with-expressroute)</span></span></br>
<span data-ttu-id="5747d-121">Durante los próximos meses se agregarán a este documento ejemplos para incorporar conexiones entre redes virtuales, alta disponibilidad y encadenamiento de servicios.</span><span class="sxs-lookup"><span data-stu-id="5747d-121">Examples for adding connections between virtual networks, high availability, and service chaining will be added to this document over the next few months.</span></span>

## <a name="microsoft-compliance-and-infrastructure-protection"></a><span data-ttu-id="5747d-122">Protección de infraestructura y cumplimiento normativo de Microsoft</span><span class="sxs-lookup"><span data-stu-id="5747d-122">Microsoft compliance and infrastructure protection</span></span>
<span data-ttu-id="5747d-123">Para ayudar a las organizaciones a cumplir los requisitos nacionales, regionales y específicos del sector que rigen la recopilación y el uso de los datos personales, Microsoft ofrece más de 40 certificaciones y atestaciones.</span><span class="sxs-lookup"><span data-stu-id="5747d-123">To help organizations comply with national, regional, and industry-specific requirements governing the collection and use of individuals’ data, Microsoft offers over 40 certifications and attestations.</span></span> <span data-ttu-id="5747d-124">El conjunto más completo de cualquier proveedor de servicios en la nube.</span><span class="sxs-lookup"><span data-stu-id="5747d-124">The most comprehensive set of any cloud service provider.</span></span>

<span data-ttu-id="5747d-125">Para obtener más información, consulte la información de cumplimiento normativo en el [Centro de confianza de Microsoft][TrustCenter].</span><span class="sxs-lookup"><span data-stu-id="5747d-125">For more information, see the compliance information on the [Microsoft Trust Center][TrustCenter].</span></span>

<span data-ttu-id="5747d-126">Microsoft tiene un enfoque integral para proteger la infraestructura en la nube necesaria para ejecutar servicios globales a gran escala.</span><span class="sxs-lookup"><span data-stu-id="5747d-126">Microsoft has a comprehensive approach to protect cloud infrastructure needed to run hyper-scale global services.</span></span> <span data-ttu-id="5747d-127">La infraestructura en la nube de Microsoft incluye hardware, software, redes y personal administrativo y operativo, así como centros de datos físicos.</span><span class="sxs-lookup"><span data-stu-id="5747d-127">Microsoft cloud infrastructure includes hardware, software, networks, and administrative and operations staff, in addition to the physical data centers.</span></span>

<span data-ttu-id="5747d-128">![2]</span><span class="sxs-lookup"><span data-stu-id="5747d-128">![2]</span></span>

<span data-ttu-id="5747d-129">Este enfoque proporciona una base más segura para que los clientes implementen los servicios en la nube de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="5747d-129">This approach provides a more secure foundation for customers to deploy their services in the Microsoft cloud.</span></span> <span data-ttu-id="5747d-130">El siguiente paso es que los clientes diseñen y creen una arquitectura de seguridad para proteger estos servicios.</span><span class="sxs-lookup"><span data-stu-id="5747d-130">The next step is for customers to design and create a security architecture to protect these services.</span></span>

## <a name="traditional-security-architectures-and-perimeter-networks"></a><span data-ttu-id="5747d-131">Arquitecturas de seguridad tradicionales y redes perimetrales</span><span class="sxs-lookup"><span data-stu-id="5747d-131">Traditional security architectures and perimeter networks</span></span>
<span data-ttu-id="5747d-132">Aunque Microsoft realiza importantes inversiones en la protección de la infraestructura en la nube, los clientes también deben proteger los servicios en la nube y los grupos de recursos.</span><span class="sxs-lookup"><span data-stu-id="5747d-132">Although Microsoft invests heavily in protecting the cloud infrastructure, customers must also protect their cloud services and resource groups.</span></span> <span data-ttu-id="5747d-133">Un enfoque de varios niveles de seguridad proporciona la mejor defensa.</span><span class="sxs-lookup"><span data-stu-id="5747d-133">A multilayered approach to security provides the best defense.</span></span> <span data-ttu-id="5747d-134">Una zona de seguridad de red perimetral protege los recursos de red internos de una red que no sea de confianza.</span><span class="sxs-lookup"><span data-stu-id="5747d-134">A perimeter network security zone protects internal network resources from an untrusted network.</span></span> <span data-ttu-id="5747d-135">Una red perimetral hace referencia a los bordes o partes de la red que se encuentran entre Internet y la infraestructura de TI protegida de la empresa.</span><span class="sxs-lookup"><span data-stu-id="5747d-135">A perimeter network refers to the edges or parts of the network that sit between the Internet and the protected enterprise IT infrastructure.</span></span>

<span data-ttu-id="5747d-136">En las redes de empresa típicas, la infraestructura principal está considerablemente fortalecida en los perímetros, con varios niveles de dispositivos de seguridad.</span><span class="sxs-lookup"><span data-stu-id="5747d-136">In typical enterprise networks, the core infrastructure is heavily fortified at the perimeters, with multiple layers of security devices.</span></span> <span data-ttu-id="5747d-137">El límite de cada nivel consta de dispositivos y puntos de aplicación de directivas.</span><span class="sxs-lookup"><span data-stu-id="5747d-137">The boundary of each layer consists of devices and policy enforcement points.</span></span> <span data-ttu-id="5747d-138">Cada nivel puede incluir una combinación de los siguientes dispositivos de seguridad de red: firewalls, prevención de denegación de servicio (DoS), sistemas de protección o detección de intrusiones (IDS/IPS) y dispositivos de VPN.</span><span class="sxs-lookup"><span data-stu-id="5747d-138">Each layer can include a combination of the following network security devices: firewalls, Denial of Service (DoS) prevention, Intrusion Detection or Protection Systems (IDS/IPS), and VPN devices.</span></span> <span data-ttu-id="5747d-139">La aplicación de directivas puede adoptar la forma de directivas de firewall, listas de control de acceso (ACL) o enrutamiento específico.</span><span class="sxs-lookup"><span data-stu-id="5747d-139">Policy enforcement can take the form of firewall policies, access control lists (ACLs), or specific routing.</span></span> <span data-ttu-id="5747d-140">La primera línea de defensa de la red, que acepta directamente el tráfico entrante desde Internet, consta de una combinación de estos mecanismos para bloquear los ataques y el tráfico perjudicial mientras permite que las solicitudes legítimas avancen por la red.</span><span class="sxs-lookup"><span data-stu-id="5747d-140">The first line of defense in the network, directly accepting incoming traffic from the Internet, is a combination of these mechanisms to block attacks and harmful traffic while allowing legitimate requests further into the network.</span></span> <span data-ttu-id="5747d-141">Este tráfico se enruta directamente a los recursos de la red perimetral.</span><span class="sxs-lookup"><span data-stu-id="5747d-141">This traffic routes directly to resources in the perimeter network.</span></span> <span data-ttu-id="5747d-142">A continuación, ese recurso puede "hablar" con recursos más profundos de la red, pasando primero el siguiente límite para la validación.</span><span class="sxs-lookup"><span data-stu-id="5747d-142">That resource may then “talk” to resources deeper in the network, transiting the next boundary for validation first.</span></span> <span data-ttu-id="5747d-143">El nivel exterior se denomina red perimetral porque esta parte de la red está expuesta a Internet, normalmente con algún tipo de protección a ambos lados.</span><span class="sxs-lookup"><span data-stu-id="5747d-143">The outermost layer is called the perimeter network because this part of the network is exposed to the Internet, usually with some form of protection on both sides.</span></span> <span data-ttu-id="5747d-144">En la siguiente ilustración se muestra un ejemplo de una sola red perimetral de subred en una red corporativa con dos límites de seguridad.</span><span class="sxs-lookup"><span data-stu-id="5747d-144">The following figure shows an example of a single subnet perimeter network in a corporate network, with two security boundaries.</span></span>

<span data-ttu-id="5747d-145">![3]</span><span class="sxs-lookup"><span data-stu-id="5747d-145">![3]</span></span>

<span data-ttu-id="5747d-146">Existen numerosas arquitecturas que se utilizan para implementar una red perimetral.</span><span class="sxs-lookup"><span data-stu-id="5747d-146">There are many architectures used to implement a perimeter network.</span></span> <span data-ttu-id="5747d-147">Estas arquitecturas pueden ir de un simple equilibrador de carga a una red perimetral de varias subredes con distintos mecanismos en cada límite para bloquear el tráfico y proteger los niveles inferiores de la red corporativa.</span><span class="sxs-lookup"><span data-stu-id="5747d-147">These architectures can range from a simple load balancer to a multiple-subnet perimeter network with varied mechanisms at each boundary to block traffic and protect the deeper layers of the corporate network.</span></span> <span data-ttu-id="5747d-148">El modo de crear la red perimetral depende de las necesidades específicas de la organización y de su tolerancia general al riesgo.</span><span class="sxs-lookup"><span data-stu-id="5747d-148">How the perimeter network is built depends on the specific needs of the organization and its overall risk tolerance.</span></span>

<span data-ttu-id="5747d-149">Al desplazar los clientes las cargas de trabajo a nubes públicas, es fundamental admitir capacidades similares para la arquitectura de la red perimetral en Azure a fin de cumplir los requisitos de seguridad y cumplimiento normativo.</span><span class="sxs-lookup"><span data-stu-id="5747d-149">As customers move their workloads to public clouds, it is critical to support similar capabilities for perimeter network architecture in Azure to meet compliance and security requirements.</span></span> <span data-ttu-id="5747d-150">En este documento se proporcionan instrucciones sobre cómo pueden crear los clientes un entorno de red seguro en Azure.</span><span class="sxs-lookup"><span data-stu-id="5747d-150">This document provides guidelines on how customers can build a secure network environment in Azure.</span></span> <span data-ttu-id="5747d-151">Se centra en la red perimetral, pero también incluye una explicación completa de muchos aspectos relativos a la seguridad de red.</span><span class="sxs-lookup"><span data-stu-id="5747d-151">It focuses on the perimeter network, but also includes a comprehensive discussion of many aspects of network security.</span></span> <span data-ttu-id="5747d-152">Esta explicación se basa en las siguientes preguntas:</span><span class="sxs-lookup"><span data-stu-id="5747d-152">The following questions inform this discussion:</span></span>

* <span data-ttu-id="5747d-153">¿Cómo se puede crear una red perimetral en Azure?</span><span class="sxs-lookup"><span data-stu-id="5747d-153">How can a perimeter network in Azure be built?</span></span>
* <span data-ttu-id="5747d-154">¿Cuáles son algunas de las características de Azure disponibles para crear la red perimetral?</span><span class="sxs-lookup"><span data-stu-id="5747d-154">What are some of the Azure features available to build the perimeter network?</span></span>
* <span data-ttu-id="5747d-155">¿Cómo se pueden proteger las cargas de trabajo back-end?</span><span class="sxs-lookup"><span data-stu-id="5747d-155">How can back-end workloads be protected?</span></span>
* <span data-ttu-id="5747d-156">¿Cómo se controlan las comunicaciones de Internet con las cargas de trabajo en Azure?</span><span class="sxs-lookup"><span data-stu-id="5747d-156">How are Internet communications controlled to the workloads in Azure?</span></span>
* <span data-ttu-id="5747d-157">¿Cómo se pueden proteger las redes locales de las implementaciones en Azure?</span><span class="sxs-lookup"><span data-stu-id="5747d-157">How can the on-premises networks be protected from deployments in Azure?</span></span>
* <span data-ttu-id="5747d-158">¿Cuándo se deben usar las características de seguridad de Azure nativas frente a dispositivos o servicios de terceros?</span><span class="sxs-lookup"><span data-stu-id="5747d-158">When should native Azure security features be used versus third-party appliances or services?</span></span>

<span data-ttu-id="5747d-159">En el diagrama siguiente se muestran los diferentes niveles de seguridad que Azure ofrece a los clientes.</span><span class="sxs-lookup"><span data-stu-id="5747d-159">The following diagram shows various layers of security Azure provides to customers.</span></span> <span data-ttu-id="5747d-160">Estos niveles son nativos en la plataforma de Azure y características definidas por el cliente:</span><span class="sxs-lookup"><span data-stu-id="5747d-160">These layers are both native in the Azure platform itself and customer-defined features:</span></span>

<span data-ttu-id="5747d-161">![4]</span><span class="sxs-lookup"><span data-stu-id="5747d-161">![4]</span></span>

<span data-ttu-id="5747d-162">DDoS de Azure, entrante desde Internet, protege frente a ataques a gran escala contra Azure.</span><span class="sxs-lookup"><span data-stu-id="5747d-162">Inbound from the Internet, Azure DDoS helps protect against large-scale attacks against Azure.</span></span> <span data-ttu-id="5747d-163">El nivel siguiente son las direcciones de IP (puntos de conexión) públicas definidas por el cliente, que se usan para determinar el tráfico que puede pasar a través del servicio en la nube a la red virtual.</span><span class="sxs-lookup"><span data-stu-id="5747d-163">The next layer is customer-defined public IP addresses (endpoints), which are used to determine which traffic can pass through the cloud service to the virtual network.</span></span> <span data-ttu-id="5747d-164">El aislamiento de la red virtual de Azure nativa garantiza un aislamiento completo de todas las demás redes y que el tráfico solo fluya a través de los métodos y las rutas de acceso configurados por el usuario.</span><span class="sxs-lookup"><span data-stu-id="5747d-164">Native Azure virtual network isolation ensures complete isolation from all other networks and that traffic only flows through user configured paths and methods.</span></span> <span data-ttu-id="5747d-165">Estas rutas de acceso y métodos son el siguiente nivel, en el que se pueden usar NSG, UDR y los dispositivos virtuales de red para crear límites de seguridad y así proteger las implementaciones de aplicaciones en la red protegida.</span><span class="sxs-lookup"><span data-stu-id="5747d-165">These paths and methods are the next layer, where NSGs, UDR, and network virtual appliances can be used to create security boundaries to protect the application deployments in the protected network.</span></span>

<span data-ttu-id="5747d-166">En la siguiente sección se proporciona información general sobre las redes virtuales de Azure.</span><span class="sxs-lookup"><span data-stu-id="5747d-166">The next section provides an overview of Azure virtual networks.</span></span> <span data-ttu-id="5747d-167">Los clientes crean estas redes virtuales, que son a las que están conectadas las cargas de trabajo implementadas.</span><span class="sxs-lookup"><span data-stu-id="5747d-167">These virtual networks are created by customers, and are what their deployed workloads are connected to.</span></span> <span data-ttu-id="5747d-168">Las redes virtuales constituyen la base de todas las características de seguridad de red necesarias para establecer una red perimetral con el fin de proteger las implementaciones de clientes en Azure.</span><span class="sxs-lookup"><span data-stu-id="5747d-168">Virtual networks are the basis of all the network security features required to establish a perimeter network to protect customer deployments in Azure.</span></span>

## <a name="overview-of-azure-virtual-networks"></a><span data-ttu-id="5747d-169">Información general sobre las redes virtuales de Azure</span><span class="sxs-lookup"><span data-stu-id="5747d-169">Overview of Azure virtual networks</span></span>
<span data-ttu-id="5747d-170">Antes de que el tráfico de Internet llegue a las redes virtuales de Azure, hay dos niveles de seguridad inherentes a la plataforma Azure:</span><span class="sxs-lookup"><span data-stu-id="5747d-170">Before Internet traffic can get to the Azure virtual networks, there are two layers of security inherent to the Azure platform:</span></span>

1.    <span data-ttu-id="5747d-171">**Protección de DDoS**: la protección de DDoS es un nivel de la red física de Azure que protege la plataforma Azure contra ataques a gran escala basados en Internet.</span><span class="sxs-lookup"><span data-stu-id="5747d-171">**DDoS protection**: DDoS protection is a layer of the Azure physical network that protects the Azure platform itself from large-scale Internet-based attacks.</span></span> <span data-ttu-id="5747d-172">Estos ataques usan varios nodos de "bot" en un intento de sobrecargar un servicio de Internet.</span><span class="sxs-lookup"><span data-stu-id="5747d-172">These attacks use multiple “bot” nodes in an attempt to overwhelm an Internet service.</span></span> <span data-ttu-id="5747d-173">Azure cuenta con una malla de protección frente a DDoS sólida en toda la conectividad de entrada, salida y entre regiones de Azure.</span><span class="sxs-lookup"><span data-stu-id="5747d-173">Azure has a robust DDoS protection mesh on all inbound, outbound, and cross-Azure region connectivity.</span></span> <span data-ttu-id="5747d-174">Este nivel de protección de DDoS no tiene ningún atributo que pueda configurar el usuario y no es accesible para el cliente.</span><span class="sxs-lookup"><span data-stu-id="5747d-174">This DDoS protection layer has no user configurable attributes and is not accessible to the customer.</span></span> <span data-ttu-id="5747d-175">El nivel de protección frente a DDoS protege a Azure, como plataforma, de ataques a gran escala. Además, supervisa el tráfico saliente y el que se produce entre las distintas regiones de Azure.</span><span class="sxs-lookup"><span data-stu-id="5747d-175">The DDoS protection layer protects Azure as a platform from large-scale attacks, it also monitors out-bound traffic and cross-Azure region traffic.</span></span> <span data-ttu-id="5747d-176">Al usar dispositivos virtuales de red en la red virtual, el cliente puede configurar niveles adicionales de resistencia contra un ataque a menor escala que no active la protección de nivel de plataforma.</span><span class="sxs-lookup"><span data-stu-id="5747d-176">Using network virtual appliances on the VNet, additional layers of resilience can be configured by the customer against a smaller scale attack that doesn't trip the platform level protection.</span></span> <span data-ttu-id="5747d-177">Un ejemplo de DDoS en acción: si se ataca una dirección IP conectada a Internet con una DDoS a gran escala, Azure detectaría los orígenes de los ataques y se desharía del tráfico infractor antes de que este llegara a su destino.</span><span class="sxs-lookup"><span data-stu-id="5747d-177">An example of DDoS in action; if an internet facing IP address was attacked by a large-scale DDoS attack, Azure would detect the sources of the attacks and scrub the offending traffic before it reached its intended destination.</span></span> <span data-ttu-id="5747d-178">En casi todos los casos, el punto de conexión atacado no se ve afectado por el ataque.</span><span class="sxs-lookup"><span data-stu-id="5747d-178">In almost all cases, the attacked endpoint isn't affected by the attack.</span></span> <span data-ttu-id="5747d-179">En los casos poco frecuentes en que un punto de conexión se ve afectado, el tráfico de los demás puntos de conexión no se vería afectado, únicamente el del punto de conexión objetivo del ataque.</span><span class="sxs-lookup"><span data-stu-id="5747d-179">In the rare cases that an endpoint is affected, no traffic is affected to other endpoints, only the attacked endpoint.</span></span> <span data-ttu-id="5747d-180">Por lo tanto, otros clientes y servicios no sufrirían impacto alguno de este ataque.</span><span class="sxs-lookup"><span data-stu-id="5747d-180">Thus other customers and services would see no impact from that attack.</span></span> <span data-ttu-id="5747d-181">Resulta esencial tener en cuenta que DDoS de Azure solo busca ataques a gran escala.</span><span class="sxs-lookup"><span data-stu-id="5747d-181">It's critical to note that Azure DDoS is only looking for large-scale attacks.</span></span> <span data-ttu-id="5747d-182">Es posible que su servicio específico se vea desbordado antes de que se superen los umbrales de protección de nivel de la plataforma.</span><span class="sxs-lookup"><span data-stu-id="5747d-182">It is possible that your specific service could be overwhelmed before the platform level protection thresholds are exceeded.</span></span> <span data-ttu-id="5747d-183">Por ejemplo, un ataque de DDoS podría desconectar un sitio web de un solo servidor IIS A0 antes de que la protección frente a DDoS de nivel de plataforma de Azure registrara una amenaza.</span><span class="sxs-lookup"><span data-stu-id="5747d-183">For example, a web site on a single A0 IIS server, could be taken offline by a DDoS attack before Azure platform level DDoS protection registered a threat.</span></span>

2.  <span data-ttu-id="5747d-184">**Direcciones IP públicas**: las direcciones IP públicas (habilitadas mediante los puntos de conexión de servicio, las direcciones IP públicas, Application Gateway y otras características de Azure que presenten una dirección IP pública conectada a Internet enrutada a su recurso) permiten a los servicios en la nube o grupos de recursos exponer los puertos y las direcciones IP de Internet públicas.</span><span class="sxs-lookup"><span data-stu-id="5747d-184">**Public IP Addresses**: Public IP addresses (enabled via service endpoints, Public IP addresses, Application Gateway, and other Azure features that present a public IP address to the internet routed to your resource) allow cloud services or resource groups to have public Internet IP addresses and ports exposed.</span></span> <span data-ttu-id="5747d-185">El punto de conexión usa la traducción de direcciones de red (NAT) para enrutar el tráfico a la dirección interna y el puerto de la red virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="5747d-185">The endpoint uses Network Address Translation (NAT) to route traffic to the internal address and port on the Azure virtual network.</span></span> <span data-ttu-id="5747d-186">Esta ruta es la vía principal para que el tráfico externo pase a la red virtual.</span><span class="sxs-lookup"><span data-stu-id="5747d-186">This path is the primary way for external traffic to pass into the virtual network.</span></span> <span data-ttu-id="5747d-187">Las direcciones IP públicas se pueden configurar para determinar qué tráfico se pasa, y cómo y dónde se traduce en la red virtual.</span><span class="sxs-lookup"><span data-stu-id="5747d-187">The Public IP addresses are configurable to determine which traffic is passed in, and how and where it's translated on to the virtual network.</span></span>

<span data-ttu-id="5747d-188">Una vez que el tráfico llega a la red virtual, entran en juego muchas características.</span><span class="sxs-lookup"><span data-stu-id="5747d-188">Once traffic reaches the virtual network, there are many features that come into play.</span></span> <span data-ttu-id="5747d-189">Las redes virtuales de Azure son la base para que los clientes conecten sus cargas de trabajo, y en ellas se aplica la seguridad de nivel de red básica.</span><span class="sxs-lookup"><span data-stu-id="5747d-189">Azure virtual networks are the foundation for customers to attach their workloads and where basic network-level security applies.</span></span> <span data-ttu-id="5747d-190">Es una red privada (una superposición de red virtual) en Azure para clientes con las funciones y características siguientes:</span><span class="sxs-lookup"><span data-stu-id="5747d-190">It is a private network (a virtual network overlay) in Azure for customers with the following features and characteristics:</span></span>

* <span data-ttu-id="5747d-191">**Aislamiento del tráfico**: una red virtual es el límite de aislamiento del tráfico en la plataforma Azure.</span><span class="sxs-lookup"><span data-stu-id="5747d-191">**Traffic isolation**: A virtual network is the traffic isolation boundary on the Azure platform.</span></span> <span data-ttu-id="5747d-192">Las máquinas virtuales de una red virtual no se pueden comunicar directamente con las máquinas virtuales de otra red virtual, incluso si las dos redes virtuales las creó el mismo cliente.</span><span class="sxs-lookup"><span data-stu-id="5747d-192">Virtual machines (VMs) in one virtual network cannot communicate directly to VMs in a different virtual network, even if both virtual networks are created by the same customer.</span></span> <span data-ttu-id="5747d-193">El aislamiento consiste en una propiedad fundamental que garantiza que las máquinas virtuales del cliente y la comunicación sigan siendo privadas en una red virtual.</span><span class="sxs-lookup"><span data-stu-id="5747d-193">Isolation is a critical property that ensures customer VMs and communication remains private within a virtual network.</span></span>

>[!NOTE]
><span data-ttu-id="5747d-194">El aislamiento del tráfico solo hace referencia al tráfico *entrante* en la red virtual.</span><span class="sxs-lookup"><span data-stu-id="5747d-194">Traffic isolation refers only to traffic *inbound* to the virtual network.</span></span> <span data-ttu-id="5747d-195">De forma predeterminada, se permite el tráfico saliente de la red virtual a Internet, pero puede evitarse mediante NSG, si así lo desea.</span><span class="sxs-lookup"><span data-stu-id="5747d-195">By default outbound traffic from the VNet to the internet is allowed, but can be prevented if desired by NSGs.</span></span>
>
>

* <span data-ttu-id="5747d-196">**Topología de múltiples niveles**: las redes virtuales permiten a los clientes definir una topología de múltiples niveles al asignar subredes y designar espacios de direcciones independientes para distintos elementos o "niveles" de las cargas de trabajo.</span><span class="sxs-lookup"><span data-stu-id="5747d-196">**Multi-tier topology**: Virtual networks allow customers to define multi-tier topology by allocating subnets and designating separate address spaces for different elements or “tiers” of their workloads.</span></span> <span data-ttu-id="5747d-197">Estas agrupaciones lógicas y topologías permiten a los clientes definir una directiva de acceso diferente en función de los tipos de cargas de trabajo y controlar igualmente los flujos de tráfico entre los niveles.</span><span class="sxs-lookup"><span data-stu-id="5747d-197">These logical groupings and topologies enable customers to define different access policy based on the workload types, and also control traffic flows between the tiers.</span></span>
* <span data-ttu-id="5747d-198">**Conectividad entre instalaciones locales**: los clientes pueden establecer conectividad entre instalaciones locales entre una red virtual y varios sitios locales u otras redes virtuales en Azure.</span><span class="sxs-lookup"><span data-stu-id="5747d-198">**Cross-premises connectivity**: Customers can establish cross-premises connectivity between a virtual network and multiple on-premises sites or other virtual networks in Azure.</span></span> <span data-ttu-id="5747d-199">Para crear una conexión, los clientes pueden usar el emparejamiento de red virtual, instancias de Azure VPN Gateway, dispositivos virtuales de red de terceros o ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="5747d-199">To construct a connection, customers can use VNet Peering, Azure VPN Gateways, third-party network virtual appliances, or ExpressRoute.</span></span> <span data-ttu-id="5747d-200">Azure es compatible con VPN de sitio a sitio (S2S) mediante los protocolos estándar IPsec/IKE y conectividad privada de ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="5747d-200">Azure supports site-to-site (S2S) VPNs using standard IPsec/IKE protocols and ExpressRoute private connectivity.</span></span>
* <span data-ttu-id="5747d-201">**NSG** permite a los clientes crear reglas (ACL) con el nivel de granularidad deseado: interfaces de red, máquinas virtuales individuales o subredes virtuales.</span><span class="sxs-lookup"><span data-stu-id="5747d-201">**NSG** allows customers to create rules (ACLs) at the desired level of granularity: network interfaces, individual VMs, or virtual subnets.</span></span> <span data-ttu-id="5747d-202">Los clientes pueden controlar el acceso al permitir o denegar la comunicación entre las cargas de trabajo dentro de una red virtual, desde sistemas de redes del cliente a través de conectividad entre locales o comunicación de Internet directa.</span><span class="sxs-lookup"><span data-stu-id="5747d-202">Customers can control access by permitting or denying communication between the workloads within a virtual network, from systems on customer’s networks via cross-premises connectivity, or direct Internet communication.</span></span>
* <span data-ttu-id="5747d-203">**UDR** y **Reenvío IP** permiten a los clientes definir las rutas de comunicación entre distintos niveles dentro de una red virtual.</span><span class="sxs-lookup"><span data-stu-id="5747d-203">**UDR** and **IP Forwarding** allow customers to define the communication paths between different tiers within a virtual network.</span></span> <span data-ttu-id="5747d-204">Los clientes pueden implementar un firewall, IDS/IPS y otros dispositivos virtuales y enrutar el tráfico de red a través de estos dispositivos de seguridad para la aplicación de directivas de límites de seguridad, auditoría e inspección.</span><span class="sxs-lookup"><span data-stu-id="5747d-204">Customers can deploy a firewall, IDS/IPS, and other virtual appliances, and route network traffic through these security appliances for security boundary policy enforcement, auditing, and inspection.</span></span>
* <span data-ttu-id="5747d-205">**Dispositivos virtuales de red** en Azure Marketplace: hay dispositivos de seguridad, como firewalls, equilibradores de carga e IDS/IPS disponibles en Azure Marketplace y la Galería de imágenes de máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="5747d-205">**Network virtual appliances** in the Azure Marketplace: Security appliances such as firewalls, load balancers, and IDS/IPS are available in the Azure Marketplace and the VM Image Gallery.</span></span> <span data-ttu-id="5747d-206">Los clientes pueden implementar estos dispositivos en sus redes virtuales y, en concreto, en los límites de seguridad (incluidas las subredes de la red perimetral) para completar un entorno de red segura en múltiples niveles.</span><span class="sxs-lookup"><span data-stu-id="5747d-206">Customers can deploy these appliances into their virtual networks, and specifically, at their security boundaries (including the perimeter network subnets) to complete a multi-tiered secure network environment.</span></span>

<span data-ttu-id="5747d-207">En el siguiente diagrama se muestra un ejemplo de cómo se puede construir una arquitectura de red perimetral en Azure con estas características y funcionalidades:</span><span class="sxs-lookup"><span data-stu-id="5747d-207">With these features and capabilities, one example of how a perimeter network architecture could be constructed in Azure is the following diagram:</span></span>

<span data-ttu-id="5747d-208">![5]</span><span class="sxs-lookup"><span data-stu-id="5747d-208">![5]</span></span>

## <a name="perimeter-network-characteristics-and-requirements"></a><span data-ttu-id="5747d-209">Características y requisitos de una red perimetral</span><span class="sxs-lookup"><span data-stu-id="5747d-209">Perimeter network characteristics and requirements</span></span>
<span data-ttu-id="5747d-210">La red perimetral es el front-end de la red y crea una interfaz directamente con la comunicación desde Internet.</span><span class="sxs-lookup"><span data-stu-id="5747d-210">The perimeter network is the front end of the network, directly interfacing communication from the Internet.</span></span> <span data-ttu-id="5747d-211">Los paquetes entrantes deben fluir a través de los dispositivos de seguridad, como el firewall, IDS e IPS, antes de llegar a los servidores back-end.</span><span class="sxs-lookup"><span data-stu-id="5747d-211">The incoming packets should flow through the security appliances, such as the firewall, IDS, and IPS, before reaching the back-end servers.</span></span> <span data-ttu-id="5747d-212">Los paquetes enlazados a Internet desde las cargas de trabajo también pueden fluir a través de los dispositivos de seguridad de la red perimetral para fines de auditoría, inspección y aplicación de directivas antes de salir de la red.</span><span class="sxs-lookup"><span data-stu-id="5747d-212">Internet-bound packets from the workloads can also flow through the security appliances in the perimeter network for policy enforcement, inspection, and auditing purposes, before leaving the network.</span></span> <span data-ttu-id="5747d-213">Además, la red perimetral puede hospedar puertas de enlace de VPN entre locales entre redes virtuales del cliente y redes locales.</span><span class="sxs-lookup"><span data-stu-id="5747d-213">Additionally, the perimeter network can host cross-premises VPN gateways between customer virtual networks and on-premises networks.</span></span>

### <a name="perimeter-network-characteristics"></a><span data-ttu-id="5747d-214">Características de una red perimetral</span><span class="sxs-lookup"><span data-stu-id="5747d-214">Perimeter network characteristics</span></span>
<span data-ttu-id="5747d-215">Haciendo referencia a la ilustración anterior, algunas de las características de una buena red perimetral son las siguientes:</span><span class="sxs-lookup"><span data-stu-id="5747d-215">Referencing the previous figure, some of the characteristics of a good perimeter network are as follows:</span></span>

* <span data-ttu-id="5747d-216">Accesible desde Internet:</span><span class="sxs-lookup"><span data-stu-id="5747d-216">Internet-facing:</span></span>
  * <span data-ttu-id="5747d-217">La propia subred de red perimetral es accesible desde Internet y se comunica directamente con Internet.</span><span class="sxs-lookup"><span data-stu-id="5747d-217">The perimeter network subnet itself is Internet-facing, directly communicating with the Internet.</span></span>
  * <span data-ttu-id="5747d-218">Las direcciones IP públicas, las direcciones IP virtuales (VIP) y los puntos de conexión de servicio pasan tráfico de Internet a la red y los dispositivos front-end.</span><span class="sxs-lookup"><span data-stu-id="5747d-218">Public IP addresses, VIPs, and/or service endpoints pass Internet traffic to the front-end network and devices.</span></span>
  * <span data-ttu-id="5747d-219">El tráfico entrante de Internet pasa a través de dispositivos de seguridad antes de otros recursos de la red front-end.</span><span class="sxs-lookup"><span data-stu-id="5747d-219">Inbound traffic from the Internet passes through security devices before other resources on the front-end network.</span></span>
  * <span data-ttu-id="5747d-220">Si está habilitada la seguridad saliente, el tráfico pasa a través de dispositivos de seguridad, como último paso, antes de pasar a Internet.</span><span class="sxs-lookup"><span data-stu-id="5747d-220">If outbound security is enabled, traffic passes through security devices, as the final step, before passing to the Internet.</span></span>
* <span data-ttu-id="5747d-221">Red protegida:</span><span class="sxs-lookup"><span data-stu-id="5747d-221">Protected network:</span></span>
  * <span data-ttu-id="5747d-222">No hay una ruta directa desde Internet a la infraestructura central.</span><span class="sxs-lookup"><span data-stu-id="5747d-222">There is no direct path from the Internet to the core infrastructure.</span></span>
  * <span data-ttu-id="5747d-223">Los canales hacia la infraestructura central deben atravesar dispositivos de seguridad, como NSG, firewalls o dispositivos VPN.</span><span class="sxs-lookup"><span data-stu-id="5747d-223">Channels to the core infrastructure must traverse through security devices such as NSGs, firewalls, or VPN devices.</span></span>
  * <span data-ttu-id="5747d-224">Otros dispositivos no deben tender puentes entre Internet y la infraestructura central.</span><span class="sxs-lookup"><span data-stu-id="5747d-224">Other devices must not bridge Internet and the core infrastructure.</span></span>
  * <span data-ttu-id="5747d-225">Los dispositivos de seguridad de los límites de la red perimetral accesibles tanto desde Internet como desde la red protegida (por ejemplo, los dos iconos de firewall que aparecen en la ilustración anterior) podrían ser en realidad un solo dispositivo virtual con reglas o interfaces diferenciadas para cada límite.</span><span class="sxs-lookup"><span data-stu-id="5747d-225">Security devices on both the Internet-facing and the protected network facing boundaries of the perimeter network (for example, the two firewall icons shown in the previous figure) may actually be a single virtual appliance with differentiated rules or interfaces for each boundary.</span></span> <span data-ttu-id="5747d-226">Por ejemplo, un dispositivo físico dividido de forma lógica que administra la carga de los dos límites de la red perimetral.</span><span class="sxs-lookup"><span data-stu-id="5747d-226">For example, one physical device, logically separated, handling the load for both boundaries of the perimeter network.</span></span>
* <span data-ttu-id="5747d-227">Otras prácticas y restricciones comunes:</span><span class="sxs-lookup"><span data-stu-id="5747d-227">Other common practices and constraints:</span></span>
  * <span data-ttu-id="5747d-228">Las cargas de trabajo no deben almacenar información crítica de la empresa.</span><span class="sxs-lookup"><span data-stu-id="5747d-228">Workloads must not store business critical information.</span></span>
  * <span data-ttu-id="5747d-229">El acceso y las actualizaciones de las configuraciones e implementaciones de red perimetral se limitan solo a los administradores autorizados.</span><span class="sxs-lookup"><span data-stu-id="5747d-229">Access and updates to perimeter network configurations and deployments are limited to only authorized administrators.</span></span>

### <a name="perimeter-network-requirements"></a><span data-ttu-id="5747d-230">Requisitos de red perimetral</span><span class="sxs-lookup"><span data-stu-id="5747d-230">Perimeter network requirements</span></span>
<span data-ttu-id="5747d-231">Para habilitar estas características, siga estas instrucciones relativas a los requisitos de red virtual para implementar una red perimetral correcta:</span><span class="sxs-lookup"><span data-stu-id="5747d-231">To enable these characteristics, follow these guidelines on virtual network requirements to implement a successful perimeter network:</span></span>

* <span data-ttu-id="5747d-232">**Arquitectura de subred:** especifique la red virtual de modo que se dedique una subred completa como red perimetral, separada de otras subredes en la misma red virtual.</span><span class="sxs-lookup"><span data-stu-id="5747d-232">**Subnet architecture:** Specify the virtual network such that an entire subnet is dedicated as the perimeter network, separated from other subnets in the same virtual network.</span></span> <span data-ttu-id="5747d-233">Esta separación garantiza que el tráfico entre la red perimetral y otros niveles de subred interna o privada fluya a través de un firewall o dispositivo virtual IDS/IPS.</span><span class="sxs-lookup"><span data-stu-id="5747d-233">This separation ensures the traffic between the perimeter network and other internal or private subnet tiers flows through a firewall or IDS/IPS virtual appliance.</span></span>  <span data-ttu-id="5747d-234">Se requieren rutas definidas por el usuario las subredes limítrofes para reenviar este tráfico al dispositivo virtual.</span><span class="sxs-lookup"><span data-stu-id="5747d-234">User-defined routes on the boundary subnets are required to forward this traffic to the virtual appliance.</span></span>
* <span data-ttu-id="5747d-235">**NSG:** la subred de la red perimetral debe estar abierta para permitir la comunicación con Internet, pero esto no significa que los clientes puedan omitir los grupos de seguridad de red.</span><span class="sxs-lookup"><span data-stu-id="5747d-235">**NSG:** The perimeter network subnet itself should be open to allow communication with the Internet, but that does not mean customers should be bypassing NSGs.</span></span> <span data-ttu-id="5747d-236">Siga las recomendaciones de seguridad habituales para minimizar las superficies de red expuestas a Internet.</span><span class="sxs-lookup"><span data-stu-id="5747d-236">Follow common security practices to minimize the network surfaces exposed to the Internet.</span></span> <span data-ttu-id="5747d-237">Bloquee los intervalos de direcciones remotas que pueden acceder a las implementaciones o los protocolos de aplicación específicos y los puertos que estén abiertos.</span><span class="sxs-lookup"><span data-stu-id="5747d-237">Lock down the remote address ranges allowed to access the deployments or the specific application protocols and ports that are open.</span></span> <span data-ttu-id="5747d-238">Sin embargo, es posible que se den circunstancias en las que no sea posible realizar un bloqueo completo.</span><span class="sxs-lookup"><span data-stu-id="5747d-238">There may be circumstances, however, in which a complete lock-down is not possible.</span></span> <span data-ttu-id="5747d-239">Por ejemplo, si los clientes tienen un sitio web externo en Azure, la red perimetral debe permitir las solicitudes web entrantes desde cualquier dirección IP pública, pero solo debe abrir los siguientes puertos de aplicación web: TCP en el puerto 80 y TCP en el puerto 443.</span><span class="sxs-lookup"><span data-stu-id="5747d-239">For example, if customers have an external website in Azure, the perimeter network should allow the incoming web requests from any public IP addresses, but should only open the web application ports: TCP on port 80 and/or TCP on port 443.</span></span>
* <span data-ttu-id="5747d-240">**Tabla de enrutamiento:** la subred de red perimetral en sí debe poder comunicarse directamente con Internet, pero no debe permitir la comunicación directa al back-end y desde él o en redes locales sin pasar por un firewall o dispositivo de seguridad.</span><span class="sxs-lookup"><span data-stu-id="5747d-240">**Routing table:** The perimeter network subnet itself should be able to communicate to the Internet directly, but should not allow direct communication to and from the back end or on-premises networks without going through a firewall or security appliance.</span></span>
* <span data-ttu-id="5747d-241">**Configuración del dispositivo de seguridad:** para enrutar e inspeccionar los paquetes entre la red perimetral y el resto de las redes protegidas, los dispositivos de seguridad, como dispositivos de firewall, IDS e IPS, pueden tener hosts múltiples.</span><span class="sxs-lookup"><span data-stu-id="5747d-241">**Security appliance configuration:** To route and inspect packets between the perimeter network and the rest of the protected networks, the security appliances such as firewall, IDS, and IPS devices may be multi-homed.</span></span> <span data-ttu-id="5747d-242">También pueden tener NIC independientes para la red perimetral y las subredes back-end.</span><span class="sxs-lookup"><span data-stu-id="5747d-242">They may have separate NICs for the perimeter network and the back-end subnets.</span></span> <span data-ttu-id="5747d-243">Las NIC de la red perimetral se comunican directamente desde y hacia Internet, con los correspondientes grupos de seguridad de red y tabla de enrutamiento de red perimetral.</span><span class="sxs-lookup"><span data-stu-id="5747d-243">The NICs in the perimeter network communicate directly to and from the Internet, with the corresponding NSGs and the perimeter network routing table.</span></span> <span data-ttu-id="5747d-244">Las NIC que se conectan a las subredes back-end tienen grupos de seguridad de red y tablas de enrutamiento de las correspondientes subredes back-end más restringidos.</span><span class="sxs-lookup"><span data-stu-id="5747d-244">The NICs connecting to the back-end subnets have more restricted NSGs and routing tables of the corresponding back-end subnets.</span></span>
* <span data-ttu-id="5747d-245">**Funciones del dispositivo de seguridad:** los dispositivos de seguridad implementados en la red perimetral suelen realizar las siguientes funcionalidades:</span><span class="sxs-lookup"><span data-stu-id="5747d-245">**Security appliance functionality:** The security appliances deployed in the perimeter network typically perform the following functionality:</span></span>
  * <span data-ttu-id="5747d-246">Firewall: aplicar reglas de firewall o directivas de control de acceso para las solicitudes entrantes.</span><span class="sxs-lookup"><span data-stu-id="5747d-246">Firewall: Enforcing firewall rules or access control policies for the incoming requests.</span></span>
  * <span data-ttu-id="5747d-247">Detección y prevención de amenazas: detectar y mitigar los ataques malintencionados desde Internet.</span><span class="sxs-lookup"><span data-stu-id="5747d-247">Threat detection and prevention: Detecting and mitigating malicious attacks from the Internet.</span></span>
  * <span data-ttu-id="5747d-248">Auditoría y registro: mantener registros detallados para auditoría y análisis.</span><span class="sxs-lookup"><span data-stu-id="5747d-248">Auditing and logging: Maintaining detailed logs for auditing and analysis.</span></span>
  * <span data-ttu-id="5747d-249">Proxy inverso: redirigir las solicitudes entrantes a los servidores back-end correspondientes.</span><span class="sxs-lookup"><span data-stu-id="5747d-249">Reverse proxy: Redirecting the incoming requests to the corresponding back-end servers.</span></span> <span data-ttu-id="5747d-250">Esta redirección implica asignar y traducir las direcciones de destino en los dispositivos front-end, normalmente firewalls, a las direcciones de servidor back-end.</span><span class="sxs-lookup"><span data-stu-id="5747d-250">This redirection involves mapping and translating the destination addresses on the front-end devices, typically firewalls, to the back-end server addresses.</span></span>
  * <span data-ttu-id="5747d-251">Proxy de reenvío: proporcionar NAT y realizar auditorías para comunicaciones iniciadas desde la red virtual hacia Internet.</span><span class="sxs-lookup"><span data-stu-id="5747d-251">Forward proxy: Providing NAT and performing auditing for communication initiated from within the virtual network to the Internet.</span></span>
  * <span data-ttu-id="5747d-252">Enrutador: reenviar tráfico entrante y entre subredes dentro de la red virtual.</span><span class="sxs-lookup"><span data-stu-id="5747d-252">Router: Forwarding incoming and cross-subnet traffic inside the virtual network.</span></span>
  * <span data-ttu-id="5747d-253">Dispositivo VPN: actuar como puertas de enlace de VPN entre locales para conectividad VPN entre locales entre las redes locales del cliente y las redes virtuales de Azure.</span><span class="sxs-lookup"><span data-stu-id="5747d-253">VPN device: Acting as the cross-premises VPN gateways for cross-premises VPN connectivity between customer on-premises networks and Azure virtual networks.</span></span>
  * <span data-ttu-id="5747d-254">Servidor VPN: aceptar clientes de VPN que se conectan a redes virtuales de Azure.</span><span class="sxs-lookup"><span data-stu-id="5747d-254">VPN server: Accepting VPN clients connecting to Azure virtual networks.</span></span>

> [!TIP]
> <span data-ttu-id="5747d-255">Mantener separados los dos grupos siguientes: las personas autorizadas a acceder al engranaje de seguridad de la red perimetral y las personas autorizadas como administradores de desarrollo, implementación u operaciones de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="5747d-255">Keep the following two groups separate: the individuals authorized to access the perimeter network security gear and the individuals authorized as application development, deployment, or operations administrators.</span></span> <span data-ttu-id="5747d-256">Mantener estos grupos separados permite una separación de funciones y evita que una sola persona omita la seguridad de las aplicaciones y los controles de seguridad de red.</span><span class="sxs-lookup"><span data-stu-id="5747d-256">Keeping these groups separate allows for a segregation of duties and prevents a single person from bypassing both applications security and network security controls.</span></span>
>
>

### <a name="questions-to-be-asked-when-building-network-boundaries"></a><span data-ttu-id="5747d-257">Preguntas que se deben plantear al crear límites de red</span><span class="sxs-lookup"><span data-stu-id="5747d-257">Questions to be asked when building network boundaries</span></span>
<span data-ttu-id="5747d-258">En esta sección, salvo que se especifique de otro modo, el término "redes" hace referencia a las redes virtuales privadas de Azure creadas por un administrador de la suscripción.</span><span class="sxs-lookup"><span data-stu-id="5747d-258">In this section, unless specifically mentioned, the term "networks" refers to private Azure virtual networks created by a subscription administrator.</span></span> <span data-ttu-id="5747d-259">El término no hace referencia a las redes físicas subyacentes dentro de Azure.</span><span class="sxs-lookup"><span data-stu-id="5747d-259">The term doesn't refer to the underlying physical networks within Azure.</span></span>

<span data-ttu-id="5747d-260">Además, las redes virtuales de Azure a menudo se usan para extender las redes locales tradicionales.</span><span class="sxs-lookup"><span data-stu-id="5747d-260">Also, Azure virtual networks are often used to extend traditional on-premises networks.</span></span> <span data-ttu-id="5747d-261">Es posible incorporar soluciones de redes híbridas de sitio a sitio o de ExpressRoute con arquitecturas de redes perimetrales.</span><span class="sxs-lookup"><span data-stu-id="5747d-261">It is possible to incorporate either site-to-site or ExpressRoute hybrid networking solutions with perimeter network architectures.</span></span> <span data-ttu-id="5747d-262">Este vínculo híbrido es una consideración importante a la hora de crear límites de seguridad de red.</span><span class="sxs-lookup"><span data-stu-id="5747d-262">This hybrid link is an important consideration in building network security boundaries.</span></span>

<span data-ttu-id="5747d-263">Es fundamental que conteste a las tres preguntas siguientes al crear una red con una red perimetral y varios límites de seguridad.</span><span class="sxs-lookup"><span data-stu-id="5747d-263">The following three questions are critical to answer when you're building a network with a perimeter network and multiple security boundaries.</span></span>

#### <a name="1-how-many-boundaries-are-needed"></a><span data-ttu-id="5747d-264">1) ¿Cuántos límites se necesitan?</span><span class="sxs-lookup"><span data-stu-id="5747d-264">1) How many boundaries are needed?</span></span>
<span data-ttu-id="5747d-265">La primera decisión consiste en decidir cuántos límites de seguridad son necesarios en un escenario determinado:</span><span class="sxs-lookup"><span data-stu-id="5747d-265">The first decision point is to decide how many security boundaries are needed in a given scenario:</span></span>

* <span data-ttu-id="5747d-266">Un solo límite: uno en la red perimetral front-end entre la red virtual e Internet.</span><span class="sxs-lookup"><span data-stu-id="5747d-266">A single boundary: One on the front-end perimeter network, between the virtual network and the Internet.</span></span>
* <span data-ttu-id="5747d-267">Dos límites: uno en el lado de Internet de la red perimetral y otro entre la subred de la red perimetral y las subredes back-end de las redes virtuales de Azure.</span><span class="sxs-lookup"><span data-stu-id="5747d-267">Two boundaries: One on the Internet side of the perimeter network, and another between the perimeter network subnet and the back-end subnets in the Azure virtual networks.</span></span>
* <span data-ttu-id="5747d-268">Tres límites: uno en el lado de Internet de la red perimetral, otro entre la red perimetral y las subredes back-end, y otro entre las subredes back-end y la red local.</span><span class="sxs-lookup"><span data-stu-id="5747d-268">Three boundaries: One on the Internet side of the perimeter network, one between the perimeter network and back-end subnets, and one between the back-end subnets and the on-premises network.</span></span>
* <span data-ttu-id="5747d-269">N límites: un número variable.</span><span class="sxs-lookup"><span data-stu-id="5747d-269">N boundaries: A variable number.</span></span> <span data-ttu-id="5747d-270">En función de los requisitos de seguridad, no hay ninguna restricción en lo relativo al número de límites de seguridad en una red determinada.</span><span class="sxs-lookup"><span data-stu-id="5747d-270">Depending on security requirements, there is no limit to the number of security boundaries that can be applied in a given network.</span></span>

<span data-ttu-id="5747d-271">El número y el tipo de límites necesarios varían en función de la tolerancia al riesgo de la empresa y el escenario concreto que se implementa.</span><span class="sxs-lookup"><span data-stu-id="5747d-271">The number and type of boundaries needed vary based on a company’s risk tolerance and the specific scenario being implemented.</span></span> <span data-ttu-id="5747d-272">Esta decisión suelen tomarla conjuntamente varios grupos de una organización, que a menudo incluye un equipo de riesgos y cumplimiento, un equipo de redes y plataformas, y un equipo de desarrollo de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="5747d-272">This decision is often made together with multiple groups within an organization, often including a risk and compliance team, a network and platform team, and an application development team.</span></span> <span data-ttu-id="5747d-273">Las personas con conocimientos sobre seguridad, los datos implicados y las tecnologías que se van a usar deben participar en esta toma de decisiones a fin de garantizar la posición de seguridad adecuada para cada implementación.</span><span class="sxs-lookup"><span data-stu-id="5747d-273">People with knowledge of security, the data involved, and the technologies being used should have a say in this decision to ensure the appropriate security stance for each implementation.</span></span>

> [!TIP]
> <span data-ttu-id="5747d-274">Use el menor número posible de límites que cumplan los requisitos de seguridad para una situación determinada.</span><span class="sxs-lookup"><span data-stu-id="5747d-274">Use the smallest number of boundaries that satisfy the security requirements for a given situation.</span></span> <span data-ttu-id="5747d-275">Cuanto mayor sea el número de límites, más difíciles pueden ser las operaciones y la solución de problemas, así como la sobrecarga de administración implicada en la administración de varias directivas de límites con el tiempo.</span><span class="sxs-lookup"><span data-stu-id="5747d-275">With more boundaries, operations and troubleshooting can be more difficult, as well as the management overhead involved with managing the multiple boundary policies over time.</span></span> <span data-ttu-id="5747d-276">Sin embargo, unos límites insuficientes aumentan el riesgo.</span><span class="sxs-lookup"><span data-stu-id="5747d-276">However, insufficient boundaries increase risk.</span></span> <span data-ttu-id="5747d-277">Encontrar el equilibrio es fundamental.</span><span class="sxs-lookup"><span data-stu-id="5747d-277">Finding the balance is critical.</span></span>
>
>

<span data-ttu-id="5747d-278">![6]</span><span class="sxs-lookup"><span data-stu-id="5747d-278">![6]</span></span>

<span data-ttu-id="5747d-279">En la ilustración anterior se muestra una vista de alto nivel de una red con tres límites de seguridad.</span><span class="sxs-lookup"><span data-stu-id="5747d-279">The preceding figure shows a high-level view of a three security boundary network.</span></span> <span data-ttu-id="5747d-280">Los límites se encuentran entre la red perimetral e Internet, las subredes privadas de front-end y back-end de Azure, y la subred de back-end de Azure y la red corporativa local.</span><span class="sxs-lookup"><span data-stu-id="5747d-280">The boundaries are between the perimeter network and the Internet, the Azure front-end and back-end private subnets, and the Azure back-end subnet and the on-premises corporate network.</span></span>

#### <a name="2-where-are-the-boundaries-located"></a><span data-ttu-id="5747d-281">2) ¿Dónde se encuentran los límites?</span><span class="sxs-lookup"><span data-stu-id="5747d-281">2) Where are the boundaries located?</span></span>
<span data-ttu-id="5747d-282">Una vez decidido el número de límites, la siguiente decisión es saber dónde se implementan.</span><span class="sxs-lookup"><span data-stu-id="5747d-282">Once the number of boundaries are decided, where to implement them is the next decision point.</span></span> <span data-ttu-id="5747d-283">Generalmente, hay tres opciones:</span><span class="sxs-lookup"><span data-stu-id="5747d-283">There are generally three choices:</span></span>

* <span data-ttu-id="5747d-284">Uso de un servicio intermedio basado en Internet (por ejemplo, un firewall de aplicaciones web basado en la nube, que no se trata en este documento).</span><span class="sxs-lookup"><span data-stu-id="5747d-284">Using an Internet-based intermediary service (for example, a cloud-based Web application firewall, which is not discussed in this document)</span></span>
* <span data-ttu-id="5747d-285">Uso de características nativas o dispositivos virtuales de red en Azure.</span><span class="sxs-lookup"><span data-stu-id="5747d-285">Using native features and/or network virtual appliances in Azure</span></span>
* <span data-ttu-id="5747d-286">Uso de dispositivos físicos de la red local.</span><span class="sxs-lookup"><span data-stu-id="5747d-286">Using physical devices on the on-premises network</span></span>

<span data-ttu-id="5747d-287">En redes únicamente de Azure, las opciones son características de Azure nativas (por ejemplo, equilibradores de carga de Azure) o dispositivos virtuales de red del ecosistema de socios enriquecido de Azure (por ejemplo, firewalls de punto de comprobación).</span><span class="sxs-lookup"><span data-stu-id="5747d-287">On purely Azure networks, the options are native Azure features (for example, Azure Load Balancers) or network virtual appliances from the rich partner ecosystem of Azure (for example, Check Point firewalls).</span></span>

<span data-ttu-id="5747d-288">Si se necesita un límite entre Azure y una red local, los dispositivos de seguridad pueden residir en cualquier lado de la conexión (o en ambos).</span><span class="sxs-lookup"><span data-stu-id="5747d-288">If a boundary is needed between Azure and an on-premises network, the security devices can reside on either side of the connection (or both sides).</span></span> <span data-ttu-id="5747d-289">Por lo tanto, se debe tomar una decisión sobre la ubicación en la que se va a colocar un engranaje de seguridad.</span><span class="sxs-lookup"><span data-stu-id="5747d-289">Thus a decision must be made on the location to place security gear.</span></span>

<span data-ttu-id="5747d-290">En la ilustración anterior, los límites entre Internet y red perimetral y entre front-end y back-end están totalmente incluidos en Azure y deben ser características nativas de Azure o dispositivos virtuales de red.</span><span class="sxs-lookup"><span data-stu-id="5747d-290">In the previous figure, the Internet-to-perimeter network and the front-to-back-end boundaries are entirely contained within Azure, and must be either native Azure features or network virtual appliances.</span></span> <span data-ttu-id="5747d-291">Los dispositivos de seguridad en el límite entre Azure (subred back-end) y la red corporativa pueden estar tanto en el lado de Azure como en el local o incluso una combinación de dispositivos en ambos lados.</span><span class="sxs-lookup"><span data-stu-id="5747d-291">Security devices on the boundary between Azure (back-end subnet) and the corporate network could be either on the Azure side or the on-premises side, or even a combination of devices on both sides.</span></span> <span data-ttu-id="5747d-292">Pueden existir importantes ventajas y desventajas en cualquiera de las opciones, que se deben tener muy en cuenta.</span><span class="sxs-lookup"><span data-stu-id="5747d-292">There can be significant advantages and disadvantages to either option that must be seriously considered.</span></span>

<span data-ttu-id="5747d-293">Por ejemplo, el uso del engranaje de seguridad físico existente en el lado de la red local tiene la ventaja de que no se necesita ningún engranaje nuevo.</span><span class="sxs-lookup"><span data-stu-id="5747d-293">For example, using existing physical security gear on the on-premises network side has the advantage that no new gear is needed.</span></span> <span data-ttu-id="5747d-294">Simplemente hay que volver a configurarlo.</span><span class="sxs-lookup"><span data-stu-id="5747d-294">It just needs reconfiguration.</span></span> <span data-ttu-id="5747d-295">La desventaja es que todo el tráfico debe ir desde Azure a la red local para que lo pueda ver el engranaje de seguridad.</span><span class="sxs-lookup"><span data-stu-id="5747d-295">The disadvantage, however, is that all traffic must come back from Azure to the on-premises network to be seen by the security gear.</span></span> <span data-ttu-id="5747d-296">Por lo tanto, el tráfico de Azure a Azure puede sufrir una latencia considerable y afectar a la experiencia de usuario y al rendimiento de las aplicaciones si se obligó a dirigirlo a la red local para la aplicación de directivas de seguridad.</span><span class="sxs-lookup"><span data-stu-id="5747d-296">Thus Azure-to-Azure traffic could incur significant latency, and affect application performance and user experience, if it was forced back to the on-premises network for security policy enforcement.</span></span>

#### <a name="3-how-are-the-boundaries-implemented"></a><span data-ttu-id="5747d-297">3) ¿Cómo se implementan los límites?</span><span class="sxs-lookup"><span data-stu-id="5747d-297">3) How are the boundaries implemented?</span></span>
<span data-ttu-id="5747d-298">Cada límite de seguridad probablemente tendrá requisitos de capacidad diferentes (por ejemplo, IDS y reglas de firewall en el lado de Internet de la red perimetral, pero solo listas de control de acceso entre la red perimetral y la subred back-end).</span><span class="sxs-lookup"><span data-stu-id="5747d-298">Each security boundary will likely have different capability requirements (for example, IDS and firewall rules on the Internet side of the perimeter network, but only ACLs between the perimeter network and back-end subnet).</span></span> <span data-ttu-id="5747d-299">La decisión sobre qué dispositivo (o qué número de dispositivos) se va a usar depende de los requisitos de seguridad y del escenario.</span><span class="sxs-lookup"><span data-stu-id="5747d-299">Deciding on which device (or how many devices) to use depends on the scenario and security requirements.</span></span> <span data-ttu-id="5747d-300">En la sección siguiente, los ejemplos 1, 2 y 3 describen algunas opciones que se podrían usar.</span><span class="sxs-lookup"><span data-stu-id="5747d-300">In the following section, examples 1, 2, and 3 discuss some options that could be used.</span></span> <span data-ttu-id="5747d-301">La revisión de las características de red nativa de Azure y los dispositivos disponibles en Azure en el ecosistema de socios muestra las innumerables opciones disponibles para resolver prácticamente cualquier escenario.</span><span class="sxs-lookup"><span data-stu-id="5747d-301">Reviewing the Azure native network features and the devices available in Azure from the partner ecosystem shows the myriad options available to solve virtually any scenario.</span></span>

<span data-ttu-id="5747d-302">Otro punto de decisión de implementación clave es cómo conectar la red local con Azure.</span><span class="sxs-lookup"><span data-stu-id="5747d-302">Another key implementation decision point is how to connect the on-premises network with Azure.</span></span> <span data-ttu-id="5747d-303">¿Debería usar la puerta de enlace virtual de Azure o un dispositivo virtual de red?</span><span class="sxs-lookup"><span data-stu-id="5747d-303">Should you use the Azure virtual gateway or a network virtual appliance?</span></span> <span data-ttu-id="5747d-304">Estas opciones se tratan con más detalle en la sección siguiente (ejemplos 4, 5 y 6).</span><span class="sxs-lookup"><span data-stu-id="5747d-304">These options are discussed in greater detail in the following section (examples 4, 5, and 6).</span></span>

<span data-ttu-id="5747d-305">Además, podría ser necesario el tráfico entre redes virtuales dentro de Azure.</span><span class="sxs-lookup"><span data-stu-id="5747d-305">Additionally, traffic between virtual networks within Azure may be needed.</span></span> <span data-ttu-id="5747d-306">Estos escenarios se agregarán en el futuro.</span><span class="sxs-lookup"><span data-stu-id="5747d-306">These scenarios will be added in the future.</span></span>

<span data-ttu-id="5747d-307">Cuando sepa las respuestas a las preguntas anteriores, la sección [Inicio rápido](#fast-start) le ayudará a identificar qué ejemplos son más adecuados para un escenario determinado.</span><span class="sxs-lookup"><span data-stu-id="5747d-307">Once you know the answers to the previous questions, the [Fast Start](#fast-start) section can help identify which examples are most appropriate for a given scenario.</span></span>

## <a name="examples-building-security-boundaries-with-azure-virtual-networks"></a><span data-ttu-id="5747d-308">Ejemplos: Creación de límites de seguridad con redes virtuales de Azure</span><span class="sxs-lookup"><span data-stu-id="5747d-308">Examples: Building security boundaries with Azure virtual networks</span></span>
### <a name="example-1-build-a-perimeter-network-to-help-protect-applications-with-nsgs"></a><span data-ttu-id="5747d-309">Ejemplo 1: Creación de una red perimetral para proteger las aplicaciones con grupos de seguridad de red</span><span class="sxs-lookup"><span data-stu-id="5747d-309">Example 1 Build a perimeter network to help protect applications with NSGs</span></span>
<span data-ttu-id="5747d-310">[Volver a inicio rápido](#fast-start) | [Instrucciones de compilación detalladas para este ejemplo][Example1]</span><span class="sxs-lookup"><span data-stu-id="5747d-310">[Back to Fast start](#fast-start) | [Detailed build instructions for this example][Example1]</span></span>

<span data-ttu-id="5747d-311">[![7]][7]</span><span class="sxs-lookup"><span data-stu-id="5747d-311">[![7]][7]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="5747d-312">Descripción del entorno</span><span class="sxs-lookup"><span data-stu-id="5747d-312">Environment description</span></span>
<span data-ttu-id="5747d-313">En este ejemplo hay una suscripción que contiene los siguientes recursos:</span><span class="sxs-lookup"><span data-stu-id="5747d-313">In this example, there is a subscription that contains the following resources:</span></span>

- <span data-ttu-id="5747d-314">Un único grupo de recursos</span><span class="sxs-lookup"><span data-stu-id="5747d-314">A single resource group</span></span>
- <span data-ttu-id="5747d-315">Una red virtual solo en la nube con dos subredes: "FrontEnd" y "BackEnd"</span><span class="sxs-lookup"><span data-stu-id="5747d-315">A virtual network with two subnets: “FrontEnd” and “BackEnd”</span></span>
- <span data-ttu-id="5747d-316">Un grupo de seguridad de red que se aplica a ambas subredes</span><span class="sxs-lookup"><span data-stu-id="5747d-316">A Network Security Group that is applied to both subnets</span></span>
- <span data-ttu-id="5747d-317">Un servidor Windows que representa un servidor de aplicaciones web ("IIS01")</span><span class="sxs-lookup"><span data-stu-id="5747d-317">A Windows server that represents an application web server (“IIS01”)</span></span>
- <span data-ttu-id="5747d-318">Dos servidores Windows que representan servidores back-end de aplicaciones ("AppVM01", "AppVM02")</span><span class="sxs-lookup"><span data-stu-id="5747d-318">Two Windows servers that represent application back-end servers (“AppVM01”, “AppVM02”)</span></span>
- <span data-ttu-id="5747d-319">Un servidor Windows que representa un servidor DNS ("DNS01")</span><span class="sxs-lookup"><span data-stu-id="5747d-319">A Windows server that represents a DNS server (“DNS01”)</span></span>
- <span data-ttu-id="5747d-320">Una dirección IP pública asociada al servidor de aplicaciones web</span><span class="sxs-lookup"><span data-stu-id="5747d-320">A public IP associated with the application web server</span></span>

<span data-ttu-id="5747d-321">Para ver los scripts y una plantilla de Azure Resource Manager, consulte las [instrucciones de compilación detalladas][Example1].</span><span class="sxs-lookup"><span data-stu-id="5747d-321">For scripts and an Azure Resource Manager template, see the [detailed build instructions][Example1].</span></span>

#### <a name="nsg-description"></a><span data-ttu-id="5747d-322">Descripción del grupo de seguridad de red</span><span class="sxs-lookup"><span data-stu-id="5747d-322">NSG description</span></span>
<span data-ttu-id="5747d-323">En este ejemplo, se crea un grupo de seguridad de red y se cargan después seis reglas.</span><span class="sxs-lookup"><span data-stu-id="5747d-323">In this example, an NSG group is built and then loaded with six rules.</span></span>

> [!TIP]
> <span data-ttu-id="5747d-324">Por lo general, debe crear primero las reglas específicas de "Permitir" y después las reglas de "Denegar" más genéricas.</span><span class="sxs-lookup"><span data-stu-id="5747d-324">Generally speaking, you should create your specific “Allow” rules first, followed by the more generic “Deny” rules.</span></span> <span data-ttu-id="5747d-325">La prioridad asignada indica qué reglas se evalúan primero.</span><span class="sxs-lookup"><span data-stu-id="5747d-325">The given priority dictates which rules are evaluated first.</span></span> <span data-ttu-id="5747d-326">Una vez que se encuentra el tráfico para aplicar a una regla específica, no se evalúa ninguna otra regla.</span><span class="sxs-lookup"><span data-stu-id="5747d-326">Once traffic is found to apply to a specific rule, no further rules are evaluated.</span></span> <span data-ttu-id="5747d-327">Se pueden aplicar reglas de grupo de seguridad de red en cualquier dirección, entrante o saliente (desde la perspectiva de la subred).</span><span class="sxs-lookup"><span data-stu-id="5747d-327">NSG rules can apply in either the inbound or outbound direction (from the perspective of the subnet).</span></span>
>
>

<span data-ttu-id="5747d-328">De forma declarativa, se compilan las reglas siguientes para el tráfico entrante:</span><span class="sxs-lookup"><span data-stu-id="5747d-328">Declaratively, the following rules are being built for inbound traffic:</span></span>

1. <span data-ttu-id="5747d-329">Se permite el tráfico DNS interno (puerto 53).</span><span class="sxs-lookup"><span data-stu-id="5747d-329">Internal DNS traffic (port 53) is allowed.</span></span>
2. <span data-ttu-id="5747d-330">Se permite el tráfico RDP (puerto 3389) desde Internet a cualquier máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="5747d-330">RDP traffic (port 3389) from the Internet to any Virtual Machine is allowed.</span></span>
3. <span data-ttu-id="5747d-331">Se permite el tráfico HTTP (puerto 80) desde Internet al servidor web (IIS01).</span><span class="sxs-lookup"><span data-stu-id="5747d-331">HTTP traffic (port 80) from the Internet to web server (IIS01) is allowed.</span></span>
4. <span data-ttu-id="5747d-332">Se permite cualquier tráfico (todos los puertos) desde IIS01 a AppVM1.</span><span class="sxs-lookup"><span data-stu-id="5747d-332">Any traffic (all ports) from IIS01 to AppVM1 is allowed.</span></span>
5. <span data-ttu-id="5747d-333">Se deniega todo el tráfico (todos los puertos) desde Internet a toda la red virtual (ambas subredes).</span><span class="sxs-lookup"><span data-stu-id="5747d-333">Any traffic (all ports) from the Internet to the entire virtual network (both subnets) is denied.</span></span>
6. <span data-ttu-id="5747d-334">Se deniega todo el tráfico (todos los puertos) desde la subred front-end a la subred back-end.</span><span class="sxs-lookup"><span data-stu-id="5747d-334">Any traffic (all ports) from the front-end subnet to the back-end subnet is denied.</span></span>

<span data-ttu-id="5747d-335">Con estas reglas enlazadas a cada subred, si entrase una solicitud HTTP desde Internet al servidor web, se aplicarían las reglas 3 (permitir) y 5 (denegar).</span><span class="sxs-lookup"><span data-stu-id="5747d-335">With these rules bound to each subnet, if an HTTP request was inbound from the Internet to the web server, both rules 3 (allow) and 5 (deny) would apply.</span></span> <span data-ttu-id="5747d-336">Sin embargo, dado que la regla 3 tiene una prioridad más alta, solo se aplicaría esta, y la regla 5 no entraría en juego.</span><span class="sxs-lookup"><span data-stu-id="5747d-336">But because rule 3 has a higher priority, only it would apply, and rule 5 would not come into play.</span></span> <span data-ttu-id="5747d-337">Por lo tanto, se permitiría la solicitud HTTP al servidor web.</span><span class="sxs-lookup"><span data-stu-id="5747d-337">Thus the HTTP request would be allowed to the web server.</span></span> <span data-ttu-id="5747d-338">Si ese mismo tráfico estaba intentando ponerse en contacto con el servidor DNS01, se aplicaría primero la regla 5 (denegar) y no se permitiría que el tráfico pasase al servidor.</span><span class="sxs-lookup"><span data-stu-id="5747d-338">If that same traffic was trying to reach the DNS01 server, rule 5 (deny) would be the first to apply, and the traffic would not be allowed to pass to the server.</span></span> <span data-ttu-id="5747d-339">La regla 6 (denegar) bloquea la subred front-end para impedirle comunicarse con la subred back-end (excepto en el caso del tráfico permitido en las reglas 1 y 4).</span><span class="sxs-lookup"><span data-stu-id="5747d-339">Rule 6 (deny) blocks the front-end subnet from talking to the back-end subnet (except for allowed traffic in rules 1 and 4).</span></span> <span data-ttu-id="5747d-340">Este conjunto de reglas protege la red back-end en caso de que un atacante ponga en peligro la aplicación web en el front-end.</span><span class="sxs-lookup"><span data-stu-id="5747d-340">This rule-set protects the back-end network in case an attacker compromises the web application on the front end.</span></span> <span data-ttu-id="5747d-341">El atacante tendría acceso limitado a la red back-end "protegida" (únicamente a los recursos expuestos en el servidor AppVM01).</span><span class="sxs-lookup"><span data-stu-id="5747d-341">The attacker would have limited access to the back-end “protected” network (only to resources exposed on the AppVM01 server).</span></span>

<span data-ttu-id="5747d-342">Hay una regla de salida predeterminada que permite el tráfico saliente a Internet.</span><span class="sxs-lookup"><span data-stu-id="5747d-342">There is a default outbound rule that allows traffic out to the Internet.</span></span> <span data-ttu-id="5747d-343">En este ejemplo, permitimos el tráfico saliente y no modificamos las reglas de salida.</span><span class="sxs-lookup"><span data-stu-id="5747d-343">For this example, we’re allowing outbound traffic and not modifying any outbound rules.</span></span> <span data-ttu-id="5747d-344">Para bloquear el tráfico en ambas direcciones, es necesario el enrutamiento definido por el usuario (vea el ejemplo 3).</span><span class="sxs-lookup"><span data-stu-id="5747d-344">To lock down traffic in both directions, user-defined routing is required (see example 3).</span></span>

#### <a name="conclusion"></a><span data-ttu-id="5747d-345">Conclusión</span><span class="sxs-lookup"><span data-stu-id="5747d-345">Conclusion</span></span>
<span data-ttu-id="5747d-346">Se trata de una manera relativamente sencilla y directa de aislar la subred back-end del tráfico entrante.</span><span class="sxs-lookup"><span data-stu-id="5747d-346">This example is a relatively simple and straightforward way of isolating the back-end subnet from inbound traffic.</span></span> <span data-ttu-id="5747d-347">Para obtener más información, consulte las [instrucciones de compilación detalladas][Example1].</span><span class="sxs-lookup"><span data-stu-id="5747d-347">For more information, see the [detailed build instructions][Example1].</span></span> <span data-ttu-id="5747d-348">Estas instrucciones incluyen lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="5747d-348">These instructions include:</span></span>

* <span data-ttu-id="5747d-349">Creación de esta red perimetral con scripts de PowerShell clásicos.</span><span class="sxs-lookup"><span data-stu-id="5747d-349">How to build this perimeter network with classic PowerShell scripts.</span></span>
* <span data-ttu-id="5747d-350">Creación de esta red perimetral con una plantilla de Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="5747d-350">How to build this perimeter network with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="5747d-351">Descripciones detalladas de cada comando de grupo de seguridad de red.</span><span class="sxs-lookup"><span data-stu-id="5747d-351">Detailed descriptions of each NSG command.</span></span>
* <span data-ttu-id="5747d-352">Escenarios de flujo de tráfico detallados, que muestran cómo se permite o se deniega el tráfico en cada nivel.</span><span class="sxs-lookup"><span data-stu-id="5747d-352">Detailed traffic flow scenarios, showing how traffic is allowed or denied in each layer.</span></span>


### <a name="example-2-build-a-perimeter-network-to-help-protect-applications-with-a-firewall-and-nsgs"></a><span data-ttu-id="5747d-353">Ejemplo 2: Creación de una red perimetral para proteger las aplicaciones con un firewall y grupos de seguridad de red.</span><span class="sxs-lookup"><span data-stu-id="5747d-353">Example 2 Build a perimeter network to help protect applications with a firewall and NSGs</span></span>
<span data-ttu-id="5747d-354">[Volver a inicio rápido](#fast-start) | [Instrucciones de compilación detalladas para este ejemplo][Example2]</span><span class="sxs-lookup"><span data-stu-id="5747d-354">[Back to Fast start](#fast-start) | [Detailed build instructions for this example][Example2]</span></span>

<span data-ttu-id="5747d-355">[![8]][8]</span><span class="sxs-lookup"><span data-stu-id="5747d-355">[![8]][8]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="5747d-356">Descripción del entorno</span><span class="sxs-lookup"><span data-stu-id="5747d-356">Environment description</span></span>
<span data-ttu-id="5747d-357">En este ejemplo hay una suscripción que contiene los siguientes recursos:</span><span class="sxs-lookup"><span data-stu-id="5747d-357">In this example, there is a subscription that contains the following resources:</span></span>

* <span data-ttu-id="5747d-358">Un único grupo de recursos</span><span class="sxs-lookup"><span data-stu-id="5747d-358">A single resource group</span></span>
* <span data-ttu-id="5747d-359">Una red virtual solo en la nube con dos subredes: "FrontEnd" y "BackEnd"</span><span class="sxs-lookup"><span data-stu-id="5747d-359">A virtual network with two subnets: “FrontEnd” and “BackEnd”</span></span>
* <span data-ttu-id="5747d-360">Un grupo de seguridad de red que se aplica a ambas subredes</span><span class="sxs-lookup"><span data-stu-id="5747d-360">A Network Security Group that is applied to both subnets</span></span>
* <span data-ttu-id="5747d-361">Un dispositivo virtual de red, en este caso un firewall, conectado a la subred front-end</span><span class="sxs-lookup"><span data-stu-id="5747d-361">A network virtual appliance, in this case a firewall, connected to the front-end subnet</span></span>
* <span data-ttu-id="5747d-362">Un servidor Windows que representa un servidor de aplicaciones web ("IIS01")</span><span class="sxs-lookup"><span data-stu-id="5747d-362">A Windows server that represents an application web server (“IIS01”)</span></span>
* <span data-ttu-id="5747d-363">Dos servidores Windows que representan servidores back-end de aplicaciones ("AppVM01", "AppVM02")</span><span class="sxs-lookup"><span data-stu-id="5747d-363">Two Windows servers that represent application back-end servers (“AppVM01”, “AppVM02”)</span></span>
* <span data-ttu-id="5747d-364">Un servidor Windows que representa un servidor DNS ("DNS01")</span><span class="sxs-lookup"><span data-stu-id="5747d-364">A Windows server that represents a DNS server (“DNS01”)</span></span>

<span data-ttu-id="5747d-365">Para ver los scripts y una plantilla de Azure Resource Manager, consulte las [instrucciones de compilación detalladas][Example2].</span><span class="sxs-lookup"><span data-stu-id="5747d-365">For scripts and an Azure Resource Manager template, see the [detailed build instructions][Example2].</span></span>

#### <a name="nsg-description"></a><span data-ttu-id="5747d-366">Descripción del grupo de seguridad de red</span><span class="sxs-lookup"><span data-stu-id="5747d-366">NSG description</span></span>
<span data-ttu-id="5747d-367">En este ejemplo, se crea un grupo de seguridad de red y se cargan después seis reglas.</span><span class="sxs-lookup"><span data-stu-id="5747d-367">In this example, an NSG group is built and then loaded with six rules.</span></span>

> [!TIP]
> <span data-ttu-id="5747d-368">Por lo general, debe crear primero las reglas específicas de "Permitir" y después las reglas de "Denegar" más genéricas.</span><span class="sxs-lookup"><span data-stu-id="5747d-368">Generally speaking, you should create your specific “Allow” rules first, followed by the more generic “Deny” rules.</span></span> <span data-ttu-id="5747d-369">La prioridad asignada indica qué reglas se evalúan primero.</span><span class="sxs-lookup"><span data-stu-id="5747d-369">The given priority dictates which rules are evaluated first.</span></span> <span data-ttu-id="5747d-370">Una vez que se encuentra el tráfico para aplicar a una regla específica, no se evalúa ninguna otra regla.</span><span class="sxs-lookup"><span data-stu-id="5747d-370">Once traffic is found to apply to a specific rule, no further rules are evaluated.</span></span> <span data-ttu-id="5747d-371">Se pueden aplicar reglas de grupo de seguridad de red en cualquier dirección, entrante o saliente (desde la perspectiva de la subred).</span><span class="sxs-lookup"><span data-stu-id="5747d-371">NSG rules can apply in either the inbound or outbound direction (from the perspective of the subnet).</span></span>
>
>

<span data-ttu-id="5747d-372">De forma declarativa, se compilan las reglas siguientes para el tráfico entrante:</span><span class="sxs-lookup"><span data-stu-id="5747d-372">Declaratively, the following rules are being built for inbound traffic:</span></span>

1. <span data-ttu-id="5747d-373">Se permite el tráfico DNS interno (puerto 53).</span><span class="sxs-lookup"><span data-stu-id="5747d-373">Internal DNS traffic (port 53) is allowed.</span></span>
2. <span data-ttu-id="5747d-374">Se permite el tráfico RDP (puerto 3389) desde Internet a cualquier máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="5747d-374">RDP traffic (port 3389) from the Internet to any Virtual Machine is allowed.</span></span>
3. <span data-ttu-id="5747d-375">Se permite cualquier tráfico de Internet (todos los puertos) al dispositivo de red virtual (firewall).</span><span class="sxs-lookup"><span data-stu-id="5747d-375">Any Internet traffic (all ports) to the network virtual appliance (firewall) is allowed.</span></span>
4. <span data-ttu-id="5747d-376">Se permite cualquier tráfico (todos los puertos) desde IIS01 a AppVM1.</span><span class="sxs-lookup"><span data-stu-id="5747d-376">Any traffic (all ports) from IIS01 to AppVM1 is allowed.</span></span>
5. <span data-ttu-id="5747d-377">Se deniega todo el tráfico (todos los puertos) desde Internet a toda la red virtual (ambas subredes).</span><span class="sxs-lookup"><span data-stu-id="5747d-377">Any traffic (all ports) from the Internet to the entire virtual network (both subnets) is denied.</span></span>
6. <span data-ttu-id="5747d-378">Se deniega todo el tráfico (todos los puertos) desde la subred front-end a la subred back-end.</span><span class="sxs-lookup"><span data-stu-id="5747d-378">Any traffic (all ports) from the front-end subnet to the back-end subnet is denied.</span></span>

<span data-ttu-id="5747d-379">Con estas reglas enlazadas a cada subred, si entrase una solicitud HTTP desde Internet al firewall, se aplicarían las reglas 3 (permitir) y 5 (denegar).</span><span class="sxs-lookup"><span data-stu-id="5747d-379">With these rules bound to each subnet, if an HTTP request was inbound from the Internet to the firewall, both rules 3 (allow) and 5 (deny) would apply.</span></span> <span data-ttu-id="5747d-380">Sin embargo, dado que la regla 3 tiene una prioridad más alta, solo se aplicaría esta, y la regla 5 no entraría en juego.</span><span class="sxs-lookup"><span data-stu-id="5747d-380">But because rule 3 has a higher priority, only it would apply, and rule 5 would not come into play.</span></span> <span data-ttu-id="5747d-381">Por lo tanto, se permitiría la solicitud HTTP al firewall.</span><span class="sxs-lookup"><span data-stu-id="5747d-381">Thus the HTTP request would be allowed to the firewall.</span></span> <span data-ttu-id="5747d-382">Si ese mismo tráfico intentase ponerse en contacto con el servidor IIS01, incluso aunque esté en la subred front-end, se aplicaría la regla 5 (denegar) y no se permitiría que el tráfico pasara al servidor.</span><span class="sxs-lookup"><span data-stu-id="5747d-382">If that same traffic was trying to reach the IIS01 server, even though it’s on the front-end subnet, rule 5 (deny) would apply, and the traffic would not be allowed to pass to the server.</span></span> <span data-ttu-id="5747d-383">La regla 6 (denegar) bloquea la subred front-end para impedirle comunicarse con la subred back-end (excepto en el caso del tráfico permitido en las reglas 1 y 4).</span><span class="sxs-lookup"><span data-stu-id="5747d-383">Rule 6 (deny) blocks the front-end subnet from talking to the back-end subnet (except for allowed traffic in rules 1 and 4).</span></span> <span data-ttu-id="5747d-384">Este conjunto de reglas protege la red back-end en caso de que un atacante ponga en peligro la aplicación web en el front-end.</span><span class="sxs-lookup"><span data-stu-id="5747d-384">This rule-set protects the back-end network in case an attacker compromises the web application on the front end.</span></span> <span data-ttu-id="5747d-385">El atacante tendría acceso limitado a la red back-end "protegida" (únicamente a los recursos expuestos en el servidor AppVM01).</span><span class="sxs-lookup"><span data-stu-id="5747d-385">The attacker would have limited access to the back-end “protected” network (only to resources exposed on the AppVM01 server).</span></span>

<span data-ttu-id="5747d-386">Hay una regla de salida predeterminada que permite el tráfico saliente a Internet.</span><span class="sxs-lookup"><span data-stu-id="5747d-386">There is a default outbound rule that allows traffic out to the Internet.</span></span> <span data-ttu-id="5747d-387">En este ejemplo, permitimos el tráfico saliente y no modificamos las reglas de salida.</span><span class="sxs-lookup"><span data-stu-id="5747d-387">For this example, we’re allowing outbound traffic and not modifying any outbound rules.</span></span> <span data-ttu-id="5747d-388">Para bloquear el tráfico en ambas direcciones, es necesario el enrutamiento definido por el usuario (vea el ejemplo 3).</span><span class="sxs-lookup"><span data-stu-id="5747d-388">To lock down traffic in both directions, user-defined routing is required (see example 3).</span></span>

#### <a name="firewall-rule-description"></a><span data-ttu-id="5747d-389">Descripción de reglas de firewall</span><span class="sxs-lookup"><span data-stu-id="5747d-389">Firewall rule description</span></span>
<span data-ttu-id="5747d-390">En el firewall, deben crearse reglas de reenvío.</span><span class="sxs-lookup"><span data-stu-id="5747d-390">On the firewall, forwarding rules should be created.</span></span> <span data-ttu-id="5747d-391">Como en este ejemplo solo se enruta el tráfico entrante de Internet al firewall y después al servidor web, únicamente se necesita un regla de traducción de direcciones de red (NAT) de reenvío.</span><span class="sxs-lookup"><span data-stu-id="5747d-391">Since this example only routes Internet traffic in-bound to the firewall and then to the web server, only one forwarding network address translation (NAT) rule is needed.</span></span>

<span data-ttu-id="5747d-392">La regla de enrutamiento acepta cualquier dirección de origen entrante que alcance el firewall al intentar llegar a HTTP (puerto 80 o 443 para HTTPS).</span><span class="sxs-lookup"><span data-stu-id="5747d-392">The forwarding rule accepts any inbound source address that hits the firewall trying to reach HTTP (port 80 or 443 for HTTPS).</span></span> <span data-ttu-id="5747d-393">Se envía fuera de la interfaz local del firewall y se redirige al servidor web con la dirección IP de 10.0.1.5.</span><span class="sxs-lookup"><span data-stu-id="5747d-393">It's sent out of the firewall’s local interface and redirected to the web server with the IP Address of 10.0.1.5.</span></span>

#### <a name="conclusion"></a><span data-ttu-id="5747d-394">Conclusión</span><span class="sxs-lookup"><span data-stu-id="5747d-394">Conclusion</span></span>
<span data-ttu-id="5747d-395">Este ejemplo es una manera relativamente sencilla de proteger la aplicación con un firewall y de aislar la subred back-end del tráfico entrante.</span><span class="sxs-lookup"><span data-stu-id="5747d-395">This example is a relatively straightforward way of protecting your application with a firewall and isolating the back-end subnet from inbound traffic.</span></span> <span data-ttu-id="5747d-396">Para obtener más información, consulte las [instrucciones de compilación detalladas][Example2].</span><span class="sxs-lookup"><span data-stu-id="5747d-396">For more information, see the [detailed build instructions][Example2].</span></span> <span data-ttu-id="5747d-397">Estas instrucciones incluyen lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="5747d-397">These instructions include:</span></span>

* <span data-ttu-id="5747d-398">Creación de esta red perimetral con scripts de PowerShell clásicos.</span><span class="sxs-lookup"><span data-stu-id="5747d-398">How to build this perimeter network with classic PowerShell scripts.</span></span>
* <span data-ttu-id="5747d-399">Creación de este ejemplo con una plantilla de Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="5747d-399">How to build this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="5747d-400">Descripciones detalladas de cada comando de grupo de seguridad de red y regla de firewall.</span><span class="sxs-lookup"><span data-stu-id="5747d-400">Detailed descriptions of each NSG command and firewall rule.</span></span>
* <span data-ttu-id="5747d-401">Escenarios de flujo de tráfico detallados, que muestran cómo se permite o se deniega el tráfico en cada nivel.</span><span class="sxs-lookup"><span data-stu-id="5747d-401">Detailed traffic flow scenarios, showing how traffic is allowed or denied in each layer.</span></span>

### <a name="example-3-build-a-perimeter-network-to-help-protect-networks-with-a-firewall-and-udr-and-nsg"></a><span data-ttu-id="5747d-402">Ejemplo 3: Creación de una red perimetral para proteger las redes con un firewall, UDR y NSG</span><span class="sxs-lookup"><span data-stu-id="5747d-402">Example 3 Build a perimeter network to help protect networks with a firewall and UDR and NSG</span></span>
<span data-ttu-id="5747d-403">[Volver a inicio rápido](#fast-start) | [Instrucciones de compilación detalladas para este ejemplo][Example3]</span><span class="sxs-lookup"><span data-stu-id="5747d-403">[Back to Fast start](#fast-start) | [Detailed build instructions for this example][Example3]</span></span>

<span data-ttu-id="5747d-404">[![9]][9]</span><span class="sxs-lookup"><span data-stu-id="5747d-404">[![9]][9]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="5747d-405">Descripción del entorno</span><span class="sxs-lookup"><span data-stu-id="5747d-405">Environment description</span></span>
<span data-ttu-id="5747d-406">En este ejemplo hay una suscripción que contiene los siguientes recursos:</span><span class="sxs-lookup"><span data-stu-id="5747d-406">In this example, there is a subscription that contains the following resources:</span></span>

* <span data-ttu-id="5747d-407">Un único grupo de recursos</span><span class="sxs-lookup"><span data-stu-id="5747d-407">A single resource group</span></span>
* <span data-ttu-id="5747d-408">Una red virtual con tres subredes: "SecNet", "FrontEnd" y "BackEnd"</span><span class="sxs-lookup"><span data-stu-id="5747d-408">A virtual network with three subnets: “SecNet”, “FrontEnd”, and “BackEnd”</span></span>
* <span data-ttu-id="5747d-409">Un dispositivo virtual de red, en este caso un firewall, conectado a la subred SecNet</span><span class="sxs-lookup"><span data-stu-id="5747d-409">A network virtual appliance, in this case a firewall, connected to the SecNet subnet</span></span>
* <span data-ttu-id="5747d-410">Un servidor Windows que representa un servidor de aplicaciones web ("IIS01")</span><span class="sxs-lookup"><span data-stu-id="5747d-410">A Windows server that represents an application web server (“IIS01”)</span></span>
* <span data-ttu-id="5747d-411">Dos servidores Windows que representan servidores back-end de aplicaciones ("AppVM01", "AppVM02")</span><span class="sxs-lookup"><span data-stu-id="5747d-411">Two Windows servers that represent application back-end servers (“AppVM01”, “AppVM02”)</span></span>
* <span data-ttu-id="5747d-412">Un servidor Windows que representa un servidor DNS ("DNS01")</span><span class="sxs-lookup"><span data-stu-id="5747d-412">A Windows server that represents a DNS server (“DNS01”)</span></span>

<span data-ttu-id="5747d-413">Para ver los scripts y una plantilla de Azure Resource Manager, consulte las [instrucciones de compilación detalladas][Example3].</span><span class="sxs-lookup"><span data-stu-id="5747d-413">For scripts and an Azure Resource Manager template, see the [detailed build instructions][Example3].</span></span>

#### <a name="udr-description"></a><span data-ttu-id="5747d-414">Descripción de UDR</span><span class="sxs-lookup"><span data-stu-id="5747d-414">UDR description</span></span>
<span data-ttu-id="5747d-415">De forma predeterminada, las siguientes rutas de sistema se definen como:</span><span class="sxs-lookup"><span data-stu-id="5747d-415">By default, the following system routes are defined as:</span></span>

        Effective routes :
         Address Prefix    Next hop type    Next hop IP address Status   Source     
         --------------    -------------    ------------------- ------   ------     
         {10.0.0.0/16}     VNETLocal                            Active   Default    
         {0.0.0.0/0}       Internet                             Active   Default    
         {10.0.0.0/8}      Null                                 Active   Default    
         {100.64.0.0/10}   Null                                 Active   Default    
         {172.16.0.0/12}   Null                                 Active   Default    
         {192.168.0.0/16}  Null                                 Active   Default

<span data-ttu-id="5747d-416">VNETLocal es siempre uno o varios prefijos de dirección definidos que conforman la red virtual para esa red específica (es decir, cambia de una red virtual a otra según cómo se defina cada red virtual específica).</span><span class="sxs-lookup"><span data-stu-id="5747d-416">The VNETLocal is always one or more defined address prefixes that make up the virtual network for that specific network (that is, it changes from virtual network to virtual network, depending on how each specific virtual network is defined).</span></span> <span data-ttu-id="5747d-417">Las rutas de sistema restantes son estáticas y tienen el valor predeterminado indicado en la tabla.</span><span class="sxs-lookup"><span data-stu-id="5747d-417">The remaining system routes are static and default as indicated in the table.</span></span>

<span data-ttu-id="5747d-418">En este ejemplo, se crean dos tablas de enrutamiento para las subredes front-end y back-end.</span><span class="sxs-lookup"><span data-stu-id="5747d-418">In this example, two routing tables are created, one each for the front-end and back-end subnets.</span></span> <span data-ttu-id="5747d-419">Cada tabla se carga con rutas estáticas adecuadas para la subred indicada.</span><span class="sxs-lookup"><span data-stu-id="5747d-419">Each table is loaded with static routes appropriate for the given subnet.</span></span> <span data-ttu-id="5747d-420">En este ejemplo, cada tabla tiene tres rutas que dirigen todo el tráfico (0.0.0.0/0) a través del firewall (salto siguiente = dirección IP del dispositivo virtual):</span><span class="sxs-lookup"><span data-stu-id="5747d-420">In this example, each table has three routes that direct all traffic (0.0.0.0/0) through the firewall (Next hop = Virtual Appliance IP address):</span></span>

1. <span data-ttu-id="5747d-421">Tráfico de subred local sin próximo salto definido para que el tráfico de la subred local pase por alto el firewall.</span><span class="sxs-lookup"><span data-stu-id="5747d-421">Local subnet traffic with no Next Hop defined to allow local subnet traffic to bypass the firewall.</span></span>
2. <span data-ttu-id="5747d-422">Tráfico de red virtual con un próximo salto definido como el firewall.</span><span class="sxs-lookup"><span data-stu-id="5747d-422">Virtual network traffic with a Next Hop defined as firewall.</span></span> <span data-ttu-id="5747d-423">Este próximo salto anula la regla predeterminada que permite al tráfico de la red virtual local enrutarse directamente.</span><span class="sxs-lookup"><span data-stu-id="5747d-423">This next hop overrides the default rule that allows local virtual network traffic to route directly.</span></span>
3. <span data-ttu-id="5747d-424">Todo el tráfico restante (0/0) con un próximo salto definido como firewall.</span><span class="sxs-lookup"><span data-stu-id="5747d-424">All remaining traffic (0/0) with a Next Hop defined as the firewall.</span></span>

> [!TIP]
> <span data-ttu-id="5747d-425">No disponer de la entrada de la subred local en el UDR hará que se interrumpan las comunicaciones de la subred local.</span><span class="sxs-lookup"><span data-stu-id="5747d-425">Not having the local subnet entry in the UDR breaks local subnet communications.</span></span>
>
> * <span data-ttu-id="5747d-426">En nuestro ejemplo, es crucial que 10.0.1.0/24 apunte a VNETLocal.</span><span class="sxs-lookup"><span data-stu-id="5747d-426">In our example, 10.0.1.0/24 pointing to VNETLocal is critical!</span></span> <span data-ttu-id="5747d-427">Sin ello, un paquete que salga del servidor web (10.0.1.4) cuyo destino sea otro servidor local (por ejemplo, 10.0.1.25) generará un error, ya que se enviará al dispositivo virtual de red.</span><span class="sxs-lookup"><span data-stu-id="5747d-427">Without it, packet leaving the Web Server (10.0.1.4) destined to another local server (for example) 10.0.1.25 will fail as they will be sent to the NVA.</span></span> <span data-ttu-id="5747d-428">Este último lo enviará a la subred y esta lo reenviará al dispositivo virtual de red en un bucle infinito.</span><span class="sxs-lookup"><span data-stu-id="5747d-428">The NVA will send it to the subnet, and the subnet will resend it to the NVA in an infinite loop.</span></span>
> * <span data-ttu-id="5747d-429">La probabilidad de que se produzca un bucle de enrutamiento suele ser mayor en aplicaciones con varias NIC conectadas a subredes independientes, que suele ser un rasgo habitual en dispositivos locales tradicionales.</span><span class="sxs-lookup"><span data-stu-id="5747d-429">The chances of a routing loop are typically higher on appliances with multiple NICs that are connected to separate subnets, which is often of traditional, on-premises appliances.</span></span>
>
>

<span data-ttu-id="5747d-430">Una vez creadas las tablas de enrutamiento, se deben enlazar a sus subredes.</span><span class="sxs-lookup"><span data-stu-id="5747d-430">Once the routing tables are created, they must be bound to their subnets.</span></span> <span data-ttu-id="5747d-431">Una vez creada la tabla de enrutamiento de la subred front-end y enlazada a la subred, debe tener el siguiente aspecto:</span><span class="sxs-lookup"><span data-stu-id="5747d-431">The front-end subnet routing table, once created and bound to the subnet, would look like this output:</span></span>

        Effective routes :
         Address Prefix    Next hop type    Next hop IP address Status   Source     
         --------------    -------------    ------------------- ------   ------     
         {10.0.1.0/24}     VNETLocal                            Active
         {10.0.0.0/16}     VirtualAppliance 10.0.0.4            Active    
         {0.0.0.0/0}       VirtualAppliance 10.0.0.4            Active

> [!NOTE]
> <span data-ttu-id="5747d-432">El enrutamiento definido por el usuario se puede aplicar ahora a la subred de puerta de enlace en la que está conectado el circuito de ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="5747d-432">UDR can now be applied to the gateway subnet on which the ExpressRoute circuit is connected.</span></span>
>
> <span data-ttu-id="5747d-433">En los ejemplos 3 y 4 se muestra cómo habilitar la red perimetral con ExpressRoute o redes de sitio a sitio.</span><span class="sxs-lookup"><span data-stu-id="5747d-433">Examples of how to enable your perimeter network with ExpressRoute or site-to-site networking are shown in examples 3 and 4.</span></span>
>
>

#### <a name="ip-forwarding-description"></a><span data-ttu-id="5747d-434">Descripción de reenvío IP</span><span class="sxs-lookup"><span data-stu-id="5747d-434">IP Forwarding description</span></span>
<span data-ttu-id="5747d-435">El reenvío IP es una característica complementaria del enrutamiento definido por el usuario.</span><span class="sxs-lookup"><span data-stu-id="5747d-435">IP Forwarding is a companion feature to UDR.</span></span> <span data-ttu-id="5747d-436">El reenvío IP es una opción de configuración de los dispositivos virtuales que les permite recibir tráfico no dirigido específicamente al dispositivo y, después, reenviar ese tráfico a su destino final.</span><span class="sxs-lookup"><span data-stu-id="5747d-436">IP Forwarding is a setting on a virtual appliance that allows it to receive traffic not specifically addressed to the appliance, and then forward that traffic to its ultimate destination.</span></span>

<span data-ttu-id="5747d-437">Por ejemplo, si AppVM01 realiza una solicitud al servidor DNS01, el enrutamiento definido por el usuario enrutará este tráfico al firewall.</span><span class="sxs-lookup"><span data-stu-id="5747d-437">For example, if AppVM01 makes a request to the DNS01 server, UDR would route this traffic to the firewall.</span></span> <span data-ttu-id="5747d-438">Con el reenvío IP habilitado, el dispositivo (10.0.0.4) acepta el tráfico dirigido a DNS01 (10.0.2.4) y, a continuación, se reenvía a su destino final (10.0.2.4).</span><span class="sxs-lookup"><span data-stu-id="5747d-438">With IP Forwarding enabled, the traffic for the DNS01 destination (10.0.2.4) is accepted by the appliance (10.0.0.4) and then forwarded to its ultimate destination (10.0.2.4).</span></span> <span data-ttu-id="5747d-439">Sin el reenvío IP habilitado en el firewall, el dispositivo no aceptaría el tráfico aunque la tabla de enrutamiento tuviese el firewall como próximo salto.</span><span class="sxs-lookup"><span data-stu-id="5747d-439">Without IP Forwarding enabled on the firewall, traffic would not be accepted by the appliance even though the route table has the firewall as the next hop.</span></span> <span data-ttu-id="5747d-440">Para usar un dispositivo virtual, es fundamental acordarse de habilitar el reenvío IP junto con el enrutamiento definido por el usuario.</span><span class="sxs-lookup"><span data-stu-id="5747d-440">To use a virtual appliance, it’s critical to remember to enable IP Forwarding along with UDR.</span></span>

#### <a name="nsg-description"></a><span data-ttu-id="5747d-441">Descripción del grupo de seguridad de red</span><span class="sxs-lookup"><span data-stu-id="5747d-441">NSG description</span></span>
<span data-ttu-id="5747d-442">En este ejemplo, se crea un grupo de seguridad de red y se carga después con una única regla.</span><span class="sxs-lookup"><span data-stu-id="5747d-442">In this example, an NSG group is built and then loaded with a single rule.</span></span> <span data-ttu-id="5747d-443">Este grupo se enlaza solo a las subredes front-end y back-end (no el SecNet).</span><span class="sxs-lookup"><span data-stu-id="5747d-443">This group is then bound only to the front-end and back-end subnets (not the SecNet).</span></span> <span data-ttu-id="5747d-444">Mediante declaración se genera la siguiente regla:</span><span class="sxs-lookup"><span data-stu-id="5747d-444">Declaratively the following rule is being built:</span></span>

* <span data-ttu-id="5747d-445">Se deniega todo el tráfico (todos los puertos) desde Internet a toda la red virtual (todas las subredes).</span><span class="sxs-lookup"><span data-stu-id="5747d-445">Any traffic (all ports) from the Internet to the entire virtual network (all subnets) is denied.</span></span>

<span data-ttu-id="5747d-446">Aunque en este ejemplo se usan grupos de seguridad de red, su principal objetivo es constituir un segundo nivel de defensa frente a errores de configuración manual.</span><span class="sxs-lookup"><span data-stu-id="5747d-446">Although NSGs are used in this example, its main purpose is as a secondary layer of defense against manual misconfiguration.</span></span> <span data-ttu-id="5747d-447">El objetivo es bloquear todo el tráfico entrante desde Internet a las subredes front-end o back-end.</span><span class="sxs-lookup"><span data-stu-id="5747d-447">The goal is to block all inbound traffic from the Internet to either the front-end or back-end subnets.</span></span> <span data-ttu-id="5747d-448">El tráfico solo debe fluir a través de la subred SecNet al firewall (y después, si procede, a las subredes front-end o back-end).</span><span class="sxs-lookup"><span data-stu-id="5747d-448">Traffic should only flow through the SecNet subnet to the firewall (and then, if appropriate, on to the front-end or back-end subnets).</span></span> <span data-ttu-id="5747d-449">Además, con las reglas de enrutamiento definido por el usuario vigentes, el tráfico que llegue a las subredes front-end o back-end se redirigirá al firewall (gracias al enrutamiento definido por el usuario).</span><span class="sxs-lookup"><span data-stu-id="5747d-449">Plus, with the UDR rules in place, any traffic that did make it into the front-end or back-end subnets would be directed out to the firewall (thanks to UDR).</span></span> <span data-ttu-id="5747d-450">El firewall consideraría este tráfico un flujo asimétrico y descartaría el tráfico saliente.</span><span class="sxs-lookup"><span data-stu-id="5747d-450">The firewall would see this traffic as an asymmetric flow and would drop the outbound traffic.</span></span> <span data-ttu-id="5747d-451">Por lo tanto, hay tres niveles de seguridad que protegen las subredes:</span><span class="sxs-lookup"><span data-stu-id="5747d-451">Thus there are three layers of security protecting the subnets:</span></span>

* <span data-ttu-id="5747d-452">No hay ninguna dirección IP pública en ningún NIC de FrontEnd o BackEnd.</span><span class="sxs-lookup"><span data-stu-id="5747d-452">No Public IP addresses on any FrontEnd or BackEnd NICs.</span></span>
* <span data-ttu-id="5747d-453">Grupos de seguridad de red que deniegan el tráfico de Internet.</span><span class="sxs-lookup"><span data-stu-id="5747d-453">NSGs denying traffic from the Internet.</span></span>
* <span data-ttu-id="5747d-454">El firewall que elimina el tráfico asimétrico.</span><span class="sxs-lookup"><span data-stu-id="5747d-454">The firewall dropping asymmetric traffic.</span></span>

<span data-ttu-id="5747d-455">Un punto interesante sobre el grupo de seguridad de red de este ejemplo es que contiene solo una regla, que consiste en denegar el tráfico de Internet a toda la red virtual, incluida la subred de seguridad.</span><span class="sxs-lookup"><span data-stu-id="5747d-455">One interesting point regarding the NSG in this example is that it contains only one rule, which is to deny Internet traffic to the entire virtual network, including the Security subnet.</span></span> <span data-ttu-id="5747d-456">Sin embargo, como el grupo de seguridad de red solo está enlazado a las subredes front-end y back-end, la regla no se procesa en el tráfico entrante a la subred de seguridad.</span><span class="sxs-lookup"><span data-stu-id="5747d-456">However, since the NSG is only bound to the front-end and back-end subnets, the rule isn’t processed on traffic inbound to the Security subnet.</span></span> <span data-ttu-id="5747d-457">Como resultado, el tráfico fluye a la subred de seguridad.</span><span class="sxs-lookup"><span data-stu-id="5747d-457">As a result, traffic flows to the Security subnet.</span></span>

#### <a name="firewall-rules"></a><span data-ttu-id="5747d-458">Reglas de firewall</span><span class="sxs-lookup"><span data-stu-id="5747d-458">Firewall rules</span></span>
<span data-ttu-id="5747d-459">En el firewall, deben crearse reglas de reenvío.</span><span class="sxs-lookup"><span data-stu-id="5747d-459">On the firewall, forwarding rules should be created.</span></span> <span data-ttu-id="5747d-460">Dado que el firewall bloquea o reenvía todo el tráfico entrante, saliente y entre redes virtuales, se necesitan muchas reglas de firewall.</span><span class="sxs-lookup"><span data-stu-id="5747d-460">Since the firewall is blocking or forwarding all inbound, outbound, and intra-virtual network traffic, many firewall rules are needed.</span></span> <span data-ttu-id="5747d-461">Además, todo el tráfico entrante llegará a la dirección IP pública del servicio de seguridad (en puertos diferentes) para ser procesado por el firewall.</span><span class="sxs-lookup"><span data-stu-id="5747d-461">Also, all inbound traffic hits the Security Service public IP address (on different ports), to be processed by the firewall.</span></span> <span data-ttu-id="5747d-462">El procedimiento recomendado es crear un diagrama de los flujos lógicos antes de configurar las subredes y las reglas de firewall para evitar las modificaciones más adelante.</span><span class="sxs-lookup"><span data-stu-id="5747d-462">A best practice is to diagram the logical flows before setting up the subnets and firewall rules, to avoid rework later.</span></span> <span data-ttu-id="5747d-463">La siguiente ilustración es una vista lógica de las reglas de firewall para este ejemplo:</span><span class="sxs-lookup"><span data-stu-id="5747d-463">The following figure is a logical view of the firewall rules for this example:</span></span>

<span data-ttu-id="5747d-464">![10]</span><span class="sxs-lookup"><span data-stu-id="5747d-464">![10]</span></span>

> [!NOTE]
> <span data-ttu-id="5747d-465">Según el dispositivo virtual de red usado, los puertos de administración varían.</span><span class="sxs-lookup"><span data-stu-id="5747d-465">Based on the Network Virtual Appliance used, the management ports vary.</span></span> <span data-ttu-id="5747d-466">En este ejemplo se hace referencia a un firewall Barracuda NextGen que usa los puertos 22, 801 y 807.</span><span class="sxs-lookup"><span data-stu-id="5747d-466">In this example, a Barracuda NextGen Firewall is referenced, which uses ports 22, 801, and 807.</span></span> <span data-ttu-id="5747d-467">Consulte la documentación del proveedor del dispositivo para buscar los puertos exactos usados para la administración del dispositivo que se va a usar.</span><span class="sxs-lookup"><span data-stu-id="5747d-467">Consult the appliance vendor documentation to find the exact ports used for management of the device being used.</span></span>
>
>

#### <a name="firewall-rules-description"></a><span data-ttu-id="5747d-468">Descripción de reglas de firewall</span><span class="sxs-lookup"><span data-stu-id="5747d-468">Firewall rules description</span></span>
<span data-ttu-id="5747d-469">En el diagrama lógico anterior, no se muestra la subred de seguridad porque el servidor de seguridad es el único recurso en esa subred.</span><span class="sxs-lookup"><span data-stu-id="5747d-469">In the preceding logical diagram, the security subnet is not shown because the firewall is the only resource on that subnet.</span></span> <span data-ttu-id="5747d-470">En el diagrama se muestran las reglas de firewall y cómo permitir o denegar de forma lógica flujos de tráfico, no la propia ruta de acceso enrutada.</span><span class="sxs-lookup"><span data-stu-id="5747d-470">The diagram is showing the firewall rules and how they logically allow or deny traffic flows, not the actual routed path.</span></span> <span data-ttu-id="5747d-471">Además, los puertos externos seleccionados para el tráfico RDP están en un intervalo más alto (8014-8026) y se han seleccionado para que se correspondan en cierto modo con los dos últimos octetos de la dirección IP local y facilitar así su legibilidad (por ejemplo, la dirección de servidor local 10.0.1.4 está asociada al puerto externo 8014).</span><span class="sxs-lookup"><span data-stu-id="5747d-471">Also, the external ports selected for the RDP traffic are higher ranged ports (8014 – 8026) and were selected to loosely align with the last two octets of the local IP address for easier readability (for example, local server address 10.0.1.4 is associated with external port 8014).</span></span> <span data-ttu-id="5747d-472">Sin embargo, podría usarse cualquier puerto superior que no planteara conflictos.</span><span class="sxs-lookup"><span data-stu-id="5747d-472">Any higher non-conflicting ports, however, could be used.</span></span>

<span data-ttu-id="5747d-473">En este ejemplo, necesitamos siete tipos de reglas:</span><span class="sxs-lookup"><span data-stu-id="5747d-473">For this example, we need seven types of rules:</span></span>

* <span data-ttu-id="5747d-474">Reglas externas (para el tráfico entrante):</span><span class="sxs-lookup"><span data-stu-id="5747d-474">External rules (for inbound traffic):</span></span>
  1. <span data-ttu-id="5747d-475">Regla de administración de firewall: esta regla de redirección de aplicación permite que el tráfico pase a los puertos de administración del dispositivo virtual de red.</span><span class="sxs-lookup"><span data-stu-id="5747d-475">Firewall management rule: This App Redirect rule allows traffic to pass to the management ports of the network virtual appliance.</span></span>
  2. <span data-ttu-id="5747d-476">Reglas de RDP (para cada servidor Windows): estas cuatro reglas (una para cada servidor) permiten la administración de los servidores individuales a través de RDP.</span><span class="sxs-lookup"><span data-stu-id="5747d-476">RDP rules (for each Windows server): These four rules (one for each server) allow management of the individual servers via RDP.</span></span> <span data-ttu-id="5747d-477">Las cuatro reglas de RDP también se pueden agrupar en una regla según las características del dispositivo virtual de red que se use.</span><span class="sxs-lookup"><span data-stu-id="5747d-477">The four RDP rules could also be collapsed into one rule, depending on the capabilities of the network virtual appliance being used.</span></span>
  3. <span data-ttu-id="5747d-478">Reglas de tráfico de aplicación: hay dos reglas de este tipo, la primera para el tráfico web front-end y la segunda para el tráfico back-end (por ejemplo, servidor web a capa de datos).</span><span class="sxs-lookup"><span data-stu-id="5747d-478">Application traffic rules: There are two of these rules, the first for the front-end web traffic, and the second for the back-end traffic (for example, web server to data tier).</span></span> <span data-ttu-id="5747d-479">La configuración de estas reglas depende de la arquitectura de red (donde están situados los servidores) y los flujos de tráfico (en qué dirección fluye el tráfico y qué puertos se usan).</span><span class="sxs-lookup"><span data-stu-id="5747d-479">The configuration of these rules depends on the network architecture (where your servers are placed) and traffic flows (which direction the traffic flows, and which ports are used).</span></span>
     * <span data-ttu-id="5747d-480">La primera regla permite que el tráfico de aplicación real llegue al servidor de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="5747d-480">The first rule allows the actual application traffic to reach the application server.</span></span> <span data-ttu-id="5747d-481">Mientras que las demás reglas permiten la seguridad y la administración, las reglas de tráfico de aplicación son las que permiten a los usuarios o servicios externos acceder a las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="5747d-481">While the other rules allow for security and management, application traffic rules are what allow external users or services to access the applications.</span></span> <span data-ttu-id="5747d-482">En este ejemplo, hay un solo servidor web en el puerto 80.</span><span class="sxs-lookup"><span data-stu-id="5747d-482">For this example, there is a single web server on port 80.</span></span> <span data-ttu-id="5747d-483">Por lo tanto, una sola regla de aplicación de firewall redirige el tráfico entrante a la dirección IP externa y a la dirección IP interna de los servidores web.</span><span class="sxs-lookup"><span data-stu-id="5747d-483">Thus a single firewall application rule redirects inbound traffic to the external IP, to the web servers internal IP address.</span></span> <span data-ttu-id="5747d-484">La sesión de tráfico redirigido se traduciría a través de NAT al servidor interno.</span><span class="sxs-lookup"><span data-stu-id="5747d-484">The redirected traffic session would be translated via NAT to the internal server.</span></span>
     * <span data-ttu-id="5747d-485">La segunda regla es la regla back-end que permite que el servidor web se comunique con el servidor AppVM01 (no AppVM02) a través de cualquier puerto.</span><span class="sxs-lookup"><span data-stu-id="5747d-485">The second rule is the back-end rule to allow the web server to talk to the AppVM01 server (but not AppVM02) via any port.</span></span>
* <span data-ttu-id="5747d-486">Reglas internas (para el tráfico entre redes virtuales)</span><span class="sxs-lookup"><span data-stu-id="5747d-486">Internal rules (for intra-virtual network traffic)</span></span>
  1. <span data-ttu-id="5747d-487">Regla de saliente a Internet: esta regla permite que el tráfico de cualquier red pase a las redes seleccionadas.</span><span class="sxs-lookup"><span data-stu-id="5747d-487">Outbound to Internet rule: This rule allows traffic from any network to pass to the selected networks.</span></span> <span data-ttu-id="5747d-488">Normalmente, esta es una regla predeterminada que ya existe en el firewall, pero en estado deshabilitado.</span><span class="sxs-lookup"><span data-stu-id="5747d-488">This rule is usually a default rule already on the firewall, but in a disabled state.</span></span> <span data-ttu-id="5747d-489">Esta regla debe habilitarse para este ejemplo.</span><span class="sxs-lookup"><span data-stu-id="5747d-489">This rule should be enabled for this example.</span></span>
  2. <span data-ttu-id="5747d-490">Regla DNS: esta regla permite que pase solo el tráfico DNS (puerto 53) al servidor DNS.</span><span class="sxs-lookup"><span data-stu-id="5747d-490">DNS rule: This rule allows only DNS (port 53) traffic to pass to the DNS server.</span></span> <span data-ttu-id="5747d-491">Para este entorno, se bloquea la mayor parte del tráfico de front-end a back-end.</span><span class="sxs-lookup"><span data-stu-id="5747d-491">For this environment, most traffic from the front end to the back end is blocked.</span></span> <span data-ttu-id="5747d-492">Esta regla permite específicamente DNS desde cualquier subred local.</span><span class="sxs-lookup"><span data-stu-id="5747d-492">This rule specifically allows DNS from any local subnet.</span></span>
  3. <span data-ttu-id="5747d-493">Regla de subred a subred: esta regla permite que cualquier servidor en la subred back-end conecte con cualquier servidor en la subred front-end (pero no a la inversa).</span><span class="sxs-lookup"><span data-stu-id="5747d-493">Subnet to subnet rule: This rule is to allow any server on the back-end subnet to connect to any server on the front-end subnet (but not the reverse).</span></span>
* <span data-ttu-id="5747d-494">Regla para notificaciones de error (para el tráfico que no cumple ninguna de las anteriores):</span><span class="sxs-lookup"><span data-stu-id="5747d-494">Fail-safe rule (for traffic that doesn’t meet any of the previous):</span></span>
  1. <span data-ttu-id="5747d-495">Denegar todas las reglas de tráfico: esta regla de denegación debe ser siempre la última regla (en términos de prioridad) y, como tal, si un flujo de tráfico no coincide con ninguna de las reglas anteriores, esta regla lo descartará.</span><span class="sxs-lookup"><span data-stu-id="5747d-495">Deny all traffic rule: This deny rule should always be the final rule (in terms of priority), and as such if a traffic flow fails to match any of the preceding rules it is dropped by this rule.</span></span> <span data-ttu-id="5747d-496">Esta regla es la predeterminada y, por lo general, está establecida y activa.</span><span class="sxs-lookup"><span data-stu-id="5747d-496">This rule is a default rule and usually in-place and active.</span></span> <span data-ttu-id="5747d-497">Normalmente, no se necesita ninguna modificación a esta regla.</span><span class="sxs-lookup"><span data-stu-id="5747d-497">No modifications are usually needed to this rule.</span></span>

> [!TIP]
> <span data-ttu-id="5747d-498">En la segunda regla de tráfico de aplicación, para simplificar el ejemplo, se permite cualquier puerto.</span><span class="sxs-lookup"><span data-stu-id="5747d-498">On the second application traffic rule, to simplify this example, any port is allowed.</span></span> <span data-ttu-id="5747d-499">En un escenario real, deben usarse el puerto y los intervalos de direcciones más específicos para reducir la superficie expuesta a ataques de esta regla.</span><span class="sxs-lookup"><span data-stu-id="5747d-499">In a real scenario, the most specific port and address ranges should be used to reduce the attack surface of this rule.</span></span>
>
>

<span data-ttu-id="5747d-500">Una vez creadas las reglas anteriores, es importante revisar la prioridad de cada una para asegurarse de que el tráfico se permitirá o se denegará según se desee.</span><span class="sxs-lookup"><span data-stu-id="5747d-500">Once the previous rules are created, it’s important to review the priority of each rule to ensure traffic is allowed or denied as desired.</span></span> <span data-ttu-id="5747d-501">En este ejemplo, las reglas están en orden de prioridad.</span><span class="sxs-lookup"><span data-stu-id="5747d-501">For this example, the rules are in priority order.</span></span>

#### <a name="conclusion"></a><span data-ttu-id="5747d-502">Conclusión</span><span class="sxs-lookup"><span data-stu-id="5747d-502">Conclusion</span></span>
<span data-ttu-id="5747d-503">Este ejemplo consiste en una manera más compleja pero más completa de proteger y aislar la red que los ejemplos anteriores.</span><span class="sxs-lookup"><span data-stu-id="5747d-503">This example is a more complex but complete way of protecting and isolating the network than the previous examples.</span></span> <span data-ttu-id="5747d-504">(En el ejemplo 2 solo se protege la aplicación y en el ejemplo 1 solo se aíslan las subredes).</span><span class="sxs-lookup"><span data-stu-id="5747d-504">(Example 2 protects just the application, and Example 1 just isolates subnets).</span></span> <span data-ttu-id="5747d-505">Este diseño permite supervisar el tráfico en ambas direcciones y protege no solo el servidor de aplicaciones de entrada, sino que aplica la directiva de seguridad de red a todos los servidores de esta red.</span><span class="sxs-lookup"><span data-stu-id="5747d-505">This design allows for monitoring traffic in both directions, and protects not just the inbound application server but enforces network security policy for all servers on this network.</span></span> <span data-ttu-id="5747d-506">Además, según el dispositivo que se usa, se pueden lograr el reconocimiento y la auditoría de todo el tráfico.</span><span class="sxs-lookup"><span data-stu-id="5747d-506">Also, depending on the appliance used, full traffic auditing and awareness can be achieved.</span></span> <span data-ttu-id="5747d-507">Para obtener más información, consulte las [instrucciones de compilación detalladas][Example3].</span><span class="sxs-lookup"><span data-stu-id="5747d-507">For more information, see the [detailed build instructions][Example3].</span></span> <span data-ttu-id="5747d-508">Estas instrucciones incluyen lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="5747d-508">These instructions include:</span></span>

* <span data-ttu-id="5747d-509">Creación de esta red perimetral de ejemplo con scripts de PowerShell clásicos.</span><span class="sxs-lookup"><span data-stu-id="5747d-509">How to build this example perimeter network with classic PowerShell scripts.</span></span>
* <span data-ttu-id="5747d-510">Creación de este ejemplo con una plantilla de Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="5747d-510">How to build this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="5747d-511">Descripciones detalladas de cada enrutamiento definido por el usuario, comando de grupo de seguridad de red y regla de firewall.</span><span class="sxs-lookup"><span data-stu-id="5747d-511">Detailed descriptions of each UDR, NSG command, and firewall rule.</span></span>
* <span data-ttu-id="5747d-512">Escenarios de flujo de tráfico detallados, que muestran cómo se permite o se deniega el tráfico en cada nivel.</span><span class="sxs-lookup"><span data-stu-id="5747d-512">Detailed traffic flow scenarios, showing how traffic is allowed or denied in each layer.</span></span>

### <a name="example-4-add-a-hybrid-connection-with-a-site-to-site-virtual-appliance-vpn"></a><span data-ttu-id="5747d-513">Ejemplo 4: Incorporación de una conexión híbrida con una VPN de dispositivo virtual de sitio a sitio</span><span class="sxs-lookup"><span data-stu-id="5747d-513">Example 4 Add a hybrid connection with a site-to-site, virtual appliance VPN</span></span>
<span data-ttu-id="5747d-514">[Volver a inicio rápido](#fast-start) | Instrucciones de compilación disponibles pronto</span><span class="sxs-lookup"><span data-stu-id="5747d-514">[Back to Fast start](#fast-start) | Detailed build instructions available soon</span></span>

<span data-ttu-id="5747d-515">[![11]][11]</span><span class="sxs-lookup"><span data-stu-id="5747d-515">[![11]][11]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="5747d-516">Descripción del entorno</span><span class="sxs-lookup"><span data-stu-id="5747d-516">Environment description</span></span>
<span data-ttu-id="5747d-517">Las redes híbridas que usan un dispositivo virtual de red (NVA) pueden agregarse a cualquiera de los tipos de red perimetral descritos en el ejemplo 1, 2 o 3.</span><span class="sxs-lookup"><span data-stu-id="5747d-517">Hybrid networking using a network virtual appliance (NVA) can be added to any of the perimeter network types described in examples 1, 2, or 3.</span></span>

<span data-ttu-id="5747d-518">Como se muestra en la ilustración anterior, se usa una conexión VPN a través de Internet (sitio a sitio) para conectar una red local a una red virtual de Azure a través de un dispositivo virtual de red.</span><span class="sxs-lookup"><span data-stu-id="5747d-518">As shown in the previous figure, a VPN connection over the Internet (site-to-site) is used to connect an on-premises network to an Azure virtual network via an NVA.</span></span>

> [!NOTE]
> <span data-ttu-id="5747d-519">Si usa ExpressRoute con la opción de configuración entre pares públicos de Azure habilitada, debe crear una ruta estática.</span><span class="sxs-lookup"><span data-stu-id="5747d-519">If you use ExpressRoute with the Azure Public Peering option enabled, a static route should be created.</span></span> <span data-ttu-id="5747d-520">Esta ruta estática debe enrutar a la dirección IP de VPN del dispositivo de red virtual con Internet corporativo, y no con la conexión de ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="5747d-520">This static route should route to the NVA VPN IP address out your corporate Internet and not via the ExpressRoute connection.</span></span> <span data-ttu-id="5747d-521">La NAT requerida en la opción de configuración entre pares públicos de ExpressRoute de Azure puede interrumpir la sesión de VPN.</span><span class="sxs-lookup"><span data-stu-id="5747d-521">The NAT required on the ExpressRoute Azure Public Peering option can break the VPN session.</span></span>
>
>

<span data-ttu-id="5747d-522">Una vez implementada la conexión VPN, el dispositivo virtual de red se convierte en el concentrador central para todas las redes y subredes.</span><span class="sxs-lookup"><span data-stu-id="5747d-522">Once the VPN is in place, the NVA becomes the central hub for all networks and subnets.</span></span> <span data-ttu-id="5747d-523">Las reglas de reenvío de firewall determinan qué flujos de tráfico se permiten, se traducen a través de NAT, se redirigen o se descartan (incluso para los flujos de tráfico entre la red local y Azure).</span><span class="sxs-lookup"><span data-stu-id="5747d-523">The firewall forwarding rules determine which traffic flows are allowed, are translated via NAT, are redirected, or are dropped (even for traffic flows between the on-premises network and Azure).</span></span>

<span data-ttu-id="5747d-524">Los flujos de tráfico deben tenerse en cuenta cuidadosamente, ya que se pueden optimizar o degradar mediante este patrón de diseño en función del caso de uso específico.</span><span class="sxs-lookup"><span data-stu-id="5747d-524">Traffic flows should be considered carefully, as they can be optimized or degraded by this design pattern, depending on the specific use case.</span></span>

<span data-ttu-id="5747d-525">Si usa el entorno creado en el ejemplo 3 e incorpora posteriormente una conexión de red híbrida de VPN de sitio a sitio, se producirá el siguiente diseño:</span><span class="sxs-lookup"><span data-stu-id="5747d-525">Using the environment built in example 3, and then adding a site-to-site VPN hybrid network connection, produces the following design:</span></span>

<span data-ttu-id="5747d-526">[![12]][12]</span><span class="sxs-lookup"><span data-stu-id="5747d-526">[![12]][12]</span></span>

<span data-ttu-id="5747d-527">El enrutador local, o cualquier otro dispositivo de red que sea compatible con el dispositivo virtual de red para VPN, sería el cliente VPN.</span><span class="sxs-lookup"><span data-stu-id="5747d-527">The on-premises router, or any other network device that is compatible with your NVA for VPN, would be the VPN client.</span></span> <span data-ttu-id="5747d-528">Este dispositivo físico sería responsable de iniciar y mantener la conexión VPN con el dispositivo virtual de red.</span><span class="sxs-lookup"><span data-stu-id="5747d-528">This physical device would be responsible for initiating and maintaining the VPN connection with your NVA.</span></span>

<span data-ttu-id="5747d-529">Según la lógica del dispositivo virtual de red, la red parece estar constituida por cuatro "zonas de seguridad" independientes con las reglas del dispositivo virtual de red como director principal del tráfico entre estas zonas:</span><span class="sxs-lookup"><span data-stu-id="5747d-529">Logically to the NVA, the network looks like four separate “security zones” with the rules on the NVA being the primary director of traffic between these zones:</span></span>

<span data-ttu-id="5747d-530">![13]</span><span class="sxs-lookup"><span data-stu-id="5747d-530">![13]</span></span>

#### <a name="conclusion"></a><span data-ttu-id="5747d-531">Conclusión</span><span class="sxs-lookup"><span data-stu-id="5747d-531">Conclusion</span></span>
<span data-ttu-id="5747d-532">La incorporación de una conexión de red híbrida VPN de sitio a sitio a una red virtual de Azure puede ampliar la red local a Azure de forma segura.</span><span class="sxs-lookup"><span data-stu-id="5747d-532">The addition of a site-to-site VPN hybrid network connection to an Azure virtual network can extend the on-premises network into Azure in a secure manner.</span></span> <span data-ttu-id="5747d-533">Al usar una conexión VPN, el tráfico se cifra y se enruta a través de Internet.</span><span class="sxs-lookup"><span data-stu-id="5747d-533">In using a VPN connection, your traffic is encrypted and routes via the Internet.</span></span> <span data-ttu-id="5747d-534">El dispositivo virtual de red de este ejemplo proporciona una ubicación central para aplicar y administrar la directiva de seguridad.</span><span class="sxs-lookup"><span data-stu-id="5747d-534">The NVA in this example provides a central location to enforce and manage the security policy.</span></span> <span data-ttu-id="5747d-535">Para obtener más información, consulte las instrucciones de compilación detalladas (próximamente).</span><span class="sxs-lookup"><span data-stu-id="5747d-535">For more information, see the detailed build instructions (forthcoming).</span></span> <span data-ttu-id="5747d-536">Estas instrucciones incluyen lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="5747d-536">These instructions include:</span></span>

* <span data-ttu-id="5747d-537">Creación de esta red perimetral de ejemplo con scripts de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5747d-537">How to build this example perimeter network with PowerShell scripts.</span></span>
* <span data-ttu-id="5747d-538">Creación de este ejemplo con una plantilla de Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="5747d-538">How to build this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="5747d-539">Escenarios de flujo de tráfico detallados, que muestran cómo fluye el tráfico en este diseño.</span><span class="sxs-lookup"><span data-stu-id="5747d-539">Detailed traffic flow scenarios, showing how traffic flows through this design.</span></span>

### <a name="example-5-add-a-hybrid-connection-with-a-site-to-site-azure-vpn-gateway"></a><span data-ttu-id="5747d-540">Ejemplo 5: Incorporación de una conexión híbrida con una VPN de puerta de enlace de Azure de sitio a sitio</span><span class="sxs-lookup"><span data-stu-id="5747d-540">Example 5 Add a hybrid connection with a site-to-site, Azure VPN gateway</span></span>
<span data-ttu-id="5747d-541">[Volver a inicio rápido](#fast-start) | Instrucciones de compilación disponibles pronto</span><span class="sxs-lookup"><span data-stu-id="5747d-541">[Back to Fast start](#fast-start) | Detailed build instructions available soon</span></span>

<span data-ttu-id="5747d-542">[![14]][14]</span><span class="sxs-lookup"><span data-stu-id="5747d-542">[![14]][14]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="5747d-543">Descripción del entorno</span><span class="sxs-lookup"><span data-stu-id="5747d-543">Environment description</span></span>
<span data-ttu-id="5747d-544">Las redes híbridas que usan una puerta de enlace de VPN de Azure se pueden agregar a cualquier tipo de red perimetral descrito en los ejemplos 1 y 2.</span><span class="sxs-lookup"><span data-stu-id="5747d-544">Hybrid networking using an Azure VPN gateway can be added to either perimeter network type described in examples 1 or 2.</span></span>

<span data-ttu-id="5747d-545">Como se muestra en la ilustración anterior, se usa una conexión VPN a través de Internet (de sitio a sitio) para conectar una red local a una red virtual de Azure a través de una puerta de enlace de VPN de Azure.</span><span class="sxs-lookup"><span data-stu-id="5747d-545">As shown in the preceding figure, a VPN connection over the Internet (site-to-site) is used to connect an on-premises network to an Azure virtual network via an Azure VPN gateway.</span></span>

> [!NOTE]
> <span data-ttu-id="5747d-546">Si usa ExpressRoute con la opción de configuración entre pares públicos de Azure habilitada, debe crear una ruta estática.</span><span class="sxs-lookup"><span data-stu-id="5747d-546">If you use ExpressRoute with the Azure Public Peering option enabled, a static route should be created.</span></span> <span data-ttu-id="5747d-547">Esta debe enrutar a la dirección IP de VPN del dispositivo de red virtual con Internet corporativo, y no con la conexión de ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="5747d-547">This  static route should route to the NVA VPN IP address out your corporate Internet and not via the ExpressRoute WAN.</span></span> <span data-ttu-id="5747d-548">La NAT requerida en la opción de configuración entre pares públicos de ExpressRoute de Azure puede interrumpir la sesión de VPN.</span><span class="sxs-lookup"><span data-stu-id="5747d-548">The NAT required on the ExpressRoute Azure Public Peering option can break the VPN session.</span></span>
>
>

<span data-ttu-id="5747d-549">En la siguiente ilustración se muestran los dos bordes de red de este ejemplo.</span><span class="sxs-lookup"><span data-stu-id="5747d-549">The following figure shows the two network edges in this example.</span></span> <span data-ttu-id="5747d-550">En el primer borde, el dispositivo virtual de red y los grupos de seguridad de red controlan los flujos de tráfico para redes internas de Azure y entre Azure e Internet.</span><span class="sxs-lookup"><span data-stu-id="5747d-550">On the first edge, the NVA and NSGs control traffic flows for intra-Azure networks and between Azure and the Internet.</span></span> <span data-ttu-id="5747d-551">El segundo borde es la puerta de enlace de VPN de Azure, que es un borde de red independiente y aislado entre la instalación local y Azure.</span><span class="sxs-lookup"><span data-stu-id="5747d-551">The second edge is the Azure VPN gateway, which is a separate and isolated network edge between on-premises and Azure.</span></span>

<span data-ttu-id="5747d-552">Los flujos de tráfico deben tenerse en cuenta cuidadosamente, ya que se pueden optimizar o degradar mediante este patrón de diseño en función del caso de uso específico.</span><span class="sxs-lookup"><span data-stu-id="5747d-552">Traffic flows should be considered carefully, as they can be optimized or degraded by this design pattern, depending on the specific use case.</span></span>

<span data-ttu-id="5747d-553">Si usa el entorno creado en el ejemplo 1 e incorpora posteriormente una conexión de red híbrida de VPN de sitio a sitio, se producirá el siguiente diseño:</span><span class="sxs-lookup"><span data-stu-id="5747d-553">Using the environment built in example 1, and then adding a site-to-site VPN hybrid network connection, produces the following design:</span></span>

<span data-ttu-id="5747d-554">[![15]][15]</span><span class="sxs-lookup"><span data-stu-id="5747d-554">[![15]][15]</span></span>

#### <a name="conclusion"></a><span data-ttu-id="5747d-555">Conclusión</span><span class="sxs-lookup"><span data-stu-id="5747d-555">Conclusion</span></span>
<span data-ttu-id="5747d-556">La incorporación de una conexión de red híbrida VPN de sitio a sitio a una red virtual de Azure puede ampliar la red local a Azure de forma segura.</span><span class="sxs-lookup"><span data-stu-id="5747d-556">The addition of a site-to-site VPN hybrid network connection to an Azure virtual network can extend the on-premises network into Azure in a secure manner.</span></span> <span data-ttu-id="5747d-557">Mediante una puerta de enlace nativa de VPN de Azure, el tráfico está cifrado con IPSec y se enruta a través de Internet.</span><span class="sxs-lookup"><span data-stu-id="5747d-557">Using the native Azure VPN gateway, your traffic is IPSec encrypted and routes via the Internet.</span></span> <span data-ttu-id="5747d-558">Asimismo, mediante la puerta de enlace de VPN de Azure, se proporciona una opción menos costosa (sin costos de licencias adicionales como ocurre con dispositivos virtuales de red de terceros).</span><span class="sxs-lookup"><span data-stu-id="5747d-558">Also, using the Azure VPN gateway can provide a lower-cost option (no additional licensing cost as with third-party NVAs).</span></span> <span data-ttu-id="5747d-559">Esta opción resulta más económica en el ejemplo 1, en el que no se usa ningún dispositivo virtual de red.</span><span class="sxs-lookup"><span data-stu-id="5747d-559">This option is most economical in example 1, where no NVA is used.</span></span> <span data-ttu-id="5747d-560">Para obtener más información, consulte las instrucciones de compilación detalladas (próximamente).</span><span class="sxs-lookup"><span data-stu-id="5747d-560">For more information, see the detailed build instructions (forthcoming).</span></span> <span data-ttu-id="5747d-561">Estas instrucciones incluyen lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="5747d-561">These instructions include:</span></span>

* <span data-ttu-id="5747d-562">Creación de esta red perimetral de ejemplo con scripts de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5747d-562">How to build this example perimeter network with PowerShell scripts.</span></span>
* <span data-ttu-id="5747d-563">Creación de este ejemplo con una plantilla de Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="5747d-563">How to build this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="5747d-564">Escenarios de flujo de tráfico detallados, que muestran cómo fluye el tráfico en este diseño.</span><span class="sxs-lookup"><span data-stu-id="5747d-564">Detailed traffic flow scenarios, showing how traffic flows through this design.</span></span>

### <a name="example-6-add-a-hybrid-connection-with-expressroute"></a><span data-ttu-id="5747d-565">Ejemplo 6: Incorporación de una conexión híbrida con ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="5747d-565">Example 6 Add a hybrid connection with ExpressRoute</span></span>
<span data-ttu-id="5747d-566">[Volver a inicio rápido](#fast-start) | Instrucciones de compilación disponibles pronto</span><span class="sxs-lookup"><span data-stu-id="5747d-566">[Back to Fast start](#fast-start) | Detailed build instructions available soon</span></span>

<span data-ttu-id="5747d-567">[![16]][16]</span><span class="sxs-lookup"><span data-stu-id="5747d-567">[![16]][16]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="5747d-568">Descripción del entorno</span><span class="sxs-lookup"><span data-stu-id="5747d-568">Environment description</span></span>
<span data-ttu-id="5747d-569">Las redes híbridas que usan una conexión de configuración entre pares privados de ExpressRoute se pueden agregar a cualquier tipo de red perimetral descrito en el ejemplo 1 o 2.</span><span class="sxs-lookup"><span data-stu-id="5747d-569">Hybrid networking using an ExpressRoute private peering connection can be added to either perimeter network type described in examples 1 or 2.</span></span>

<span data-ttu-id="5747d-570">Como se muestra en la ilustración anterior, la configuración entre pares privados de ExpressRoute proporciona una conexión directa entre la red local y la red virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="5747d-570">As shown in the preceding figure, ExpressRoute private peering provides a direct connection between your on-premises network and the Azure virtual network.</span></span> <span data-ttu-id="5747d-571">El tráfico transita solo por la red del proveedor de servicio y la red de Microsoft Azure sin tocar nunca Internet.</span><span class="sxs-lookup"><span data-stu-id="5747d-571">Traffic transits only the service provider network and the Microsoft Azure network, never touching the Internet.</span></span>

> [!TIP]
> <span data-ttu-id="5747d-572">Al usar ExpressRoute, se mantiene el tráfico de la red corporativa fuera de Internet.</span><span class="sxs-lookup"><span data-stu-id="5747d-572">Using ExpressRoute keeps corporate network traffic off the Internet.</span></span> <span data-ttu-id="5747d-573">Además, se permiten los contratos de nivel de servicio del proveedor de ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="5747d-573">It also allows for service level agreements from your ExpressRoute provider.</span></span> <span data-ttu-id="5747d-574">La puerta de enlace de Azure puede pasar a 10 Gbps con ExpressRoute, mientras que con la puerta de enlace de Azure de VPN de sitio a sitio, el rendimiento máximo es de 200 Mbps.</span><span class="sxs-lookup"><span data-stu-id="5747d-574">The Azure Gateway can pass up to 10 Gbps with ExpressRoute, whereas with site-to-site VPNs, the Azure Gateway maximum throughput is 200 Mbps.</span></span>
>
>

<span data-ttu-id="5747d-575">Como se muestra en el diagrama siguiente, con esta opción el entorno tiene ahora dos bordes de red.</span><span class="sxs-lookup"><span data-stu-id="5747d-575">As seen in the following diagram, with this option the environment now has two network edges.</span></span> <span data-ttu-id="5747d-576">El dispositivo virtual de red y el grupo de seguridad de red controlan los flujos de tráfico para redes internas de Azure y entre Azure e Internet, mientras que la puerta de enlace es un borde de red independiente y aislado entre la instalación local y Azure.</span><span class="sxs-lookup"><span data-stu-id="5747d-576">The NVA and NSG control traffic flows for intra-Azure networks and between Azure and the Internet, while the gateway is a separate and isolated network edge between on-premises and Azure.</span></span>

<span data-ttu-id="5747d-577">Los flujos de tráfico deben tenerse en cuenta cuidadosamente, ya que se pueden optimizar o degradar mediante este patrón de diseño en función del caso de uso específico.</span><span class="sxs-lookup"><span data-stu-id="5747d-577">Traffic flows should be considered carefully, as they can be optimized or degraded by this design pattern, depending on the specific use case.</span></span>

<span data-ttu-id="5747d-578">Si usa el entorno creado en el ejemplo 1 e incorpora posteriormente una conexión de red híbrida de ExpressRoute, se producirá el siguiente diseño:</span><span class="sxs-lookup"><span data-stu-id="5747d-578">Using the environment built in example 1, and then adding an ExpressRoute hybrid network connection, produces the following design:</span></span>

<span data-ttu-id="5747d-579">[![17]][17]</span><span class="sxs-lookup"><span data-stu-id="5747d-579">[![17]][17]</span></span>

#### <a name="conclusion"></a><span data-ttu-id="5747d-580">Conclusión</span><span class="sxs-lookup"><span data-stu-id="5747d-580">Conclusion</span></span>
<span data-ttu-id="5747d-581">La incorporación de una conexión de red de configuración entre pares privados de ExpressRoute puede ampliar la red local a Azure de un modo seguro, con una latencia inferior y con un rendimiento mayor.</span><span class="sxs-lookup"><span data-stu-id="5747d-581">The addition of an ExpressRoute Private Peering network connection can extend the on-premises network into Azure in a secure, lower latency, higher performing manner.</span></span> <span data-ttu-id="5747d-582">Asimismo, mediante la puerta de enlace nativa de Azure, como en este ejemplo, se proporciona una opción menos costosa (sin necesidad de licencias adicionales como ocurre con dispositivos virtuales de red de terceros).</span><span class="sxs-lookup"><span data-stu-id="5747d-582">Also, using the native Azure Gateway, as in this example, provides a lower-cost option (no additional licensing as with third-party NVAs).</span></span> <span data-ttu-id="5747d-583">Para obtener más información, consulte las instrucciones de compilación detalladas (próximamente).</span><span class="sxs-lookup"><span data-stu-id="5747d-583">For more information, see the detailed build instructions (forthcoming).</span></span> <span data-ttu-id="5747d-584">Estas instrucciones incluyen lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="5747d-584">These instructions include:</span></span>

* <span data-ttu-id="5747d-585">Creación de esta red perimetral de ejemplo con scripts de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5747d-585">How to build this example perimeter network with PowerShell scripts.</span></span>
* <span data-ttu-id="5747d-586">Creación de este ejemplo con una plantilla de Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="5747d-586">How to build this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="5747d-587">Escenarios de flujo de tráfico detallados, que muestran cómo fluye el tráfico en este diseño.</span><span class="sxs-lookup"><span data-stu-id="5747d-587">Detailed traffic flow scenarios, showing how traffic flows through this design.</span></span>

## <a name="references"></a><span data-ttu-id="5747d-588">Referencias</span><span class="sxs-lookup"><span data-stu-id="5747d-588">References</span></span>
### <a name="helpful-websites-and-documentation"></a><span data-ttu-id="5747d-589">Documentación y sitios web útiles</span><span class="sxs-lookup"><span data-stu-id="5747d-589">Helpful websites and documentation</span></span>
* <span data-ttu-id="5747d-590">Acceder a Azure con Azure Resource Manager:</span><span class="sxs-lookup"><span data-stu-id="5747d-590">Access Azure with Azure Resource Manager:</span></span>
* <span data-ttu-id="5747d-591">Acceder a Azure con PowerShell: [https://docs.microsoft.com/powershell/azureps-cmdlets-docs/](/powershell/azure/overview)</span><span class="sxs-lookup"><span data-stu-id="5747d-591">Accessing Azure with PowerShell: [https://docs.microsoft.com/powershell/azureps-cmdlets-docs/](/powershell/azure/overview)</span></span>
* <span data-ttu-id="5747d-592">Documentación de redes virtuales: [https://docs.microsoft.com/azure/virtual-network/](https://docs.microsoft.com/azure/virtual-network/)</span><span class="sxs-lookup"><span data-stu-id="5747d-592">Virtual networking documentation: [https://docs.microsoft.com/azure/virtual-network/](https://docs.microsoft.com/azure/virtual-network/)</span></span>
* <span data-ttu-id="5747d-593">Documentación del grupo de seguridad de red: [https://docs.microsoft.com/azure/virtual-network/virtual-networks-nsg](virtual-network/virtual-networks-nsg.md)</span><span class="sxs-lookup"><span data-stu-id="5747d-593">Network security group documentation: [https://docs.microsoft.com/azure/virtual-network/virtual-networks-nsg](virtual-network/virtual-networks-nsg.md)</span></span>
* <span data-ttu-id="5747d-594">Documentación del enrutamiento definido por el usuario: [https://docs.microsoft.com/azure/virtual-network/virtual-networks-udr-overview](virtual-network/virtual-networks-udr-overview.md)</span><span class="sxs-lookup"><span data-stu-id="5747d-594">User-defined routing documentation: [https://docs.microsoft.com/azure/virtual-network/virtual-networks-udr-overview](virtual-network/virtual-networks-udr-overview.md)</span></span>
* <span data-ttu-id="5747d-595">Puertas de enlace virtuales de Azure: [https://docs.microsoft.com/azure/vpn-gateway/](https://docs.microsoft.com/azure/vpn-gateway/)</span><span class="sxs-lookup"><span data-stu-id="5747d-595">Azure virtual gateways: [https://docs.microsoft.com/azure/vpn-gateway/](https://docs.microsoft.com/azure/vpn-gateway/)</span></span>
* <span data-ttu-id="5747d-596">Redes VPN de sitio a sitio: [https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell](vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell.md)</span><span class="sxs-lookup"><span data-stu-id="5747d-596">Site-to-Site VPNs: [https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell](vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell.md)</span></span>
* <span data-ttu-id="5747d-597">Documentación de ExpressRoute (asegúrese de consultar las secciones "Introducción" y "Procedimientos"): [https://docs.microsoft.com/azure/expressroute/](https://docs.microsoft.com/azure/expressroute/)</span><span class="sxs-lookup"><span data-stu-id="5747d-597">ExpressRoute documentation (be sure to check out the “Getting Started” and “How To” sections): [https://docs.microsoft.com/azure/expressroute/](https://docs.microsoft.com/azure/expressroute/)</span></span>

<!--Image References-->
<span data-ttu-id="5747d-598">[0]: ./media/best-practices-network-security/flowchart.png "Diagrama de flujo de opciones de seguridad"</span><span class="sxs-lookup"><span data-stu-id="5747d-598">[0]: ./media/best-practices-network-security/flowchart.png "Security Options Flowchart"</span></span>
<span data-ttu-id="5747d-599">[2]: ./media/best-practices-network-security/azuresecurityfeatures.png "Características de seguridad de Azure"</span><span class="sxs-lookup"><span data-stu-id="5747d-599">[2]: ./media/best-practices-network-security/azuresecurityfeatures.png "Azure Security Features"</span></span>
<span data-ttu-id="5747d-600">[3]: ./media/best-practices-network-security/dmzcorporate.png "Red perimetral en una red corporativa"</span><span class="sxs-lookup"><span data-stu-id="5747d-600">[3]: ./media/best-practices-network-security/dmzcorporate.png "A DMZ in a Corporate network"</span></span>
<span data-ttu-id="5747d-601">[4]: ./media/best-practices-network-security/azuresecurityarchitecture.png "Arquitectura de seguridad de Azure"</span><span class="sxs-lookup"><span data-stu-id="5747d-601">[4]: ./media/best-practices-network-security/azuresecurityarchitecture.png "Azure Security Architecture"</span></span>
<span data-ttu-id="5747d-602">[5]: ./media/best-practices-network-security/dmzazure.png "Red perimetral en una instancia de Azure Virtual Network"</span><span class="sxs-lookup"><span data-stu-id="5747d-602">[5]: ./media/best-practices-network-security/dmzazure.png "A DMZ in an Azure Virtual Network"</span></span>
<span data-ttu-id="5747d-603">[6]: ./media/best-practices-network-security/dmzhybrid.png "Red híbrida con tres límites de seguridad"</span><span class="sxs-lookup"><span data-stu-id="5747d-603">[6]: ./media/best-practices-network-security/dmzhybrid.png "Hybrid Network with Three Security Boundaries"</span></span>
<span data-ttu-id="5747d-604">[7]: ./media/best-practices-network-security/example1design.png "Red perimetral de entrada con grupo de seguridad de red"</span><span class="sxs-lookup"><span data-stu-id="5747d-604">[7]: ./media/best-practices-network-security/example1design.png "Inbound DMZ with NSG"</span></span>
<span data-ttu-id="5747d-605">[8]: ./media/best-practices-network-security/example2design.png "Red perimetral de entrada con dispositivo virtual de red y grupo de seguridad de red"</span><span class="sxs-lookup"><span data-stu-id="5747d-605">[8]: ./media/best-practices-network-security/example2design.png "Inbound DMZ with NVA and NSG"</span></span>
<span data-ttu-id="5747d-606">[9]: ./media/best-practices-network-security/example3design.png "Red perimetral bidireccional con un dispositivo de red virtual, grupos de seguridad de red y enrutamiento definido por el usuario"</span><span class="sxs-lookup"><span data-stu-id="5747d-606">[9]: ./media/best-practices-network-security/example3design.png "Bi-directional DMZ with NVA, NSG, and UDR"</span></span>
<span data-ttu-id="5747d-607">[10]: ./media/best-practices-network-security/example3firewalllogical.png "Vista lógica de las reglas de firewall"</span><span class="sxs-lookup"><span data-stu-id="5747d-607">[10]: ./media/best-practices-network-security/example3firewalllogical.png "Logical View of the Firewall Rules"</span></span>
<span data-ttu-id="5747d-608">[11]: ./media/best-practices-network-security/example3designoptions.png "Red perimetral con red híbrida conectada a un dispositivo virtual de red"</span><span class="sxs-lookup"><span data-stu-id="5747d-608">[11]: ./media/best-practices-network-security/example3designoptions.png "DMZ with NVA Connected Hybrid Network"</span></span>
<span data-ttu-id="5747d-609">[12]: ./media/best-practices-network-security/example4designs2s.png "Red perimetral con un dispositivo virtual de red conectada mediante una VPN de sitio a sitio"</span><span class="sxs-lookup"><span data-stu-id="5747d-609">[12]: ./media/best-practices-network-security/example4designs2s.png "DMZ with NVA Connected Using a Site-to-Site VPN"</span></span>
<span data-ttu-id="5747d-610">[13]: ./media/best-practices-network-security/example4networklogical.png "Red lógica desde la perspectiva del dispositivo virtual de red"</span><span class="sxs-lookup"><span data-stu-id="5747d-610">[13]: ./media/best-practices-network-security/example4networklogical.png "Logical Network from NVA Perspective"</span></span>
<span data-ttu-id="5747d-611">[14]: ./media/best-practices-network-security/example5designoptions.png "Red perimetral con puerta de enlace de Azure conectada a red híbrida de sitio a sitio"</span><span class="sxs-lookup"><span data-stu-id="5747d-611">[14]: ./media/best-practices-network-security/example5designoptions.png "DMZ with Azure Gateway Connected Site-to-Site Hybrid Network"</span></span>
<span data-ttu-id="5747d-612">[15]: ./media/best-practices-network-security/example5designs2s.png "Red perimetral con puerta de enlace de Azure mediante VPN de sitio a sitio"</span><span class="sxs-lookup"><span data-stu-id="5747d-612">[15]: ./media/best-practices-network-security/example5designs2s.png "DMZ with Azure Gateway Using Site-to-Site VPN"</span></span>
<span data-ttu-id="5747d-613">[16]: ./media/best-practices-network-security/example6designoptions.png "Red perimetral con puerta de enlace de Azure conectada a red híbrida de ExpressRoute"</span><span class="sxs-lookup"><span data-stu-id="5747d-613">[16]: ./media/best-practices-network-security/example6designoptions.png "DMZ with Azure Gateway Connected ExpressRoute Hybrid Network"</span></span>
<span data-ttu-id="5747d-614">[17]: ./media/best-practices-network-security/example6designexpressroute.png "Red perimetral con puerta de enlace de Azure mediante una conexión de ExpressRoute"</span><span class="sxs-lookup"><span data-stu-id="5747d-614">[17]: ./media/best-practices-network-security/example6designexpressroute.png "DMZ with Azure Gateway Using an ExpressRoute Connection"</span></span>

<!--Link References-->
[TrustCenter]: https://azure.microsoft.com/support/trust-center/compliance/
[Example1]: ./virtual-network/virtual-networks-dmz-nsg.md
[Example2]: ./virtual-network/virtual-networks-dmz-nsg-fw-asm.md
[Example3]: ./virtual-network/virtual-networks-dmz-nsg-fw-udr-asm.md
[Example4]: ./virtual-network/virtual-networks-hybrid-s2s-nva-asm.md
[Example5]: ./virtual-network/virtual-networks-hybrid-s2s-agw-asm.md
[Example6]: ./virtual-network/virtual-networks-hybrid-expressroute-asm.md
[Example7]: ./virtual-network/virtual-networks-vnet2vnet-direct-asm.md
[Example8]: ./virtual-network/virtual-networks-vnet2vnet-transit-asm.md

---
title: Servidor MFA con AD FS en Windows Server | Microsoft Docs
description: "En este artículo se describe cómo empezar a trabajar con Azure Multi-Factor Authentication y AD FS en Windows Server 2012 R2 y 2016."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
editor: yossib
ms.assetid: 57208068-1e55-45b6-840f-fdcd13723074
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 03/29/2017
ms.author: kgremban
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: f2481c18f12d74a90938ffb0353dd000fe73f440
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="configure-azure-multi-factor-authentication-server-to-work-with-ad-fs-in-windows-server"></a><span data-ttu-id="85c3f-103">Configuración del Servidor Azure Multi-Factor Authentication para trabajar con AD FS en Windows Server</span><span class="sxs-lookup"><span data-stu-id="85c3f-103">Configure Azure Multi-Factor Authentication Server to work with AD FS in Windows Server</span></span>
<span data-ttu-id="85c3f-104">Si usa los Servicios de federación de Active Directory (AD FS) y desea proteger los recursos en la nube y los locales, puede configurar Servidor Azure Multi-Factor Authentication con AD FS.</span><span class="sxs-lookup"><span data-stu-id="85c3f-104">If you use Active Directory Federation Services (AD FS) and want to secure cloud or on-premises resources, you can configure Azure Multi-Factor Authentication Server to work with AD FS.</span></span> <span data-ttu-id="85c3f-105">Esta configuración desencadena la verificación en dos pasos para los puntos de conexión de alto valor.</span><span class="sxs-lookup"><span data-stu-id="85c3f-105">This configuration triggers two-step verification for high-value endpoints.</span></span>

<span data-ttu-id="85c3f-106">En este artículo se describe el uso del Servidor Azure Multi-Factor Authentication con AD FS en Windows Server 2012 R2 y Windows Server 2016.</span><span class="sxs-lookup"><span data-stu-id="85c3f-106">In this article, we discuss using Azure Multi-Factor Authentication Server with AD FS in Windows Server 2012 R2 or Windows Server 2016.</span></span> <span data-ttu-id="85c3f-107">Para más información, lea sobre la [protección de recursos en la nube y locales mediante Servidor Azure Multi-Factor Authentication con AD FS 2.0](multi-factor-authentication-get-started-adfs-adfs2.md).</span><span class="sxs-lookup"><span data-stu-id="85c3f-107">For more information, read about how to [secure cloud and on-premises resources by using Azure Multi-Factor Authentication Server with AD FS 2.0](multi-factor-authentication-get-started-adfs-adfs2.md).</span></span>

## <a name="secure-windows-server-ad-fs-with-azure-multi-factor-authentication-server"></a><span data-ttu-id="85c3f-108">Protección de Windows Server AD FS con Servidor Azure Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="85c3f-108">Secure Windows Server AD FS with Azure Multi-Factor Authentication Server</span></span>
<span data-ttu-id="85c3f-109">Al instalar Servidor Azure Multi-Factor Authentication tiene las siguientes opciones:</span><span class="sxs-lookup"><span data-stu-id="85c3f-109">When you install Azure Multi-Factor Authentication Server, you have the following options:</span></span>

* <span data-ttu-id="85c3f-110">Instalar Servidor Azure Multi-Factor Authentication localmente en el mismo servidor que AD FS</span><span class="sxs-lookup"><span data-stu-id="85c3f-110">Install Azure Multi-Factor Authentication Server locally on the same server as AD FS</span></span>
* <span data-ttu-id="85c3f-111">Instalar el adaptador de Azure Multi-Factor Authentication localmente en el servidor AD FS e instalar Servidor Multi-Factor Authentication en un equipo diferente</span><span class="sxs-lookup"><span data-stu-id="85c3f-111">Install the Azure Multi-Factor Authentication adapter locally on the AD FS server, and then install Multi-Factor Authentication Server on a different computer</span></span>

<span data-ttu-id="85c3f-112">Antes de comenzar, tenga en cuenta lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="85c3f-112">Before you begin, be aware of the following information:</span></span>

* <span data-ttu-id="85c3f-113">No es necesario que instale Servidor Azure Multi-Factor Authentication en el servidor AD FS.</span><span class="sxs-lookup"><span data-stu-id="85c3f-113">You are not required to install Azure Multi-Factor Authentication Server on your AD FS server.</span></span> <span data-ttu-id="85c3f-114">Sin embargo, debe instalar el adaptador de Multi-Factor Authentication para AD FS en un equipo con Windows Server 2012 R2 o Windows Server 2016 en el que se ejecuta AD FS.</span><span class="sxs-lookup"><span data-stu-id="85c3f-114">However, you must install the Multi-Factor Authentication adapter for AD FS on a Windows Server 2012 R2 or Windows Server 2016 that is running AD FS.</span></span> <span data-ttu-id="85c3f-115">Puede instalar el servidor en un equipo diferente si es una versión compatible e instala el adaptador de AD FS por separado en el servidor de federación de AD FS.</span><span class="sxs-lookup"><span data-stu-id="85c3f-115">You can install the server on a different computer if it is a supported version and you install the AD FS adapter separately on your AD FS federation server.</span></span> <span data-ttu-id="85c3f-116">Consulte los procedimientos siguientes para aprender a instalar el adaptador por separado.</span><span class="sxs-lookup"><span data-stu-id="85c3f-116">See the following procedures to learn how to install the adapter separately.</span></span>
* <span data-ttu-id="85c3f-117">Si la organización usa métodos de verificación de aplicación móvil o mensaje de texto, las cadenas definidas en la configuración de la compañía contienen un marcador de posición "<$*application_name*$>".</span><span class="sxs-lookup"><span data-stu-id="85c3f-117">If your organization is using text message or mobile app verification methods, the strings defined in Company Settings contain a placeholder, <$*application_name*$>.</span></span> <span data-ttu-id="85c3f-118">En la versión 7.1 del Servidor MFA, puede especificar el nombre de aplicación que reemplazará este marcador de posición.</span><span class="sxs-lookup"><span data-stu-id="85c3f-118">In MFA Server v7.1, you can provide an application name that replaces this placeholder.</span></span> <span data-ttu-id="85c3f-119">En la versión 7.0 o anteriores, este marcador de posición no se reemplaza automáticamente cuando se usa el adaptador de AD FS.</span><span class="sxs-lookup"><span data-stu-id="85c3f-119">In v7.0 or older, this placeholder is not automatically replaced when you use the AD FS adapter.</span></span> <span data-ttu-id="85c3f-120">En esas versiones anteriores, quite el marcador de posición de las cadenas correspondientes cuando proteja AD FS.</span><span class="sxs-lookup"><span data-stu-id="85c3f-120">For those older versions, remove the placeholder from the appropriate strings when you secure AD FS.</span></span>
* <span data-ttu-id="85c3f-121">La cuenta que use para iniciar sesión debe tener derechos de usuario para crear grupos de seguridad en el servicio de Active Directory.</span><span class="sxs-lookup"><span data-stu-id="85c3f-121">The account that you use to sign in must have user rights to create security groups in your Active Directory service.</span></span>
* <span data-ttu-id="85c3f-122">El asistente para la instalación del adaptador de AD FS de Multi-Factor Authentication crea un grupo de seguridad denominado PhoneFactor Admins en la instancia de Active Directory.</span><span class="sxs-lookup"><span data-stu-id="85c3f-122">The Multi-Factor Authentication AD FS adapter installation wizard creates a security group called PhoneFactor Admins in your instance of Active Directory.</span></span> <span data-ttu-id="85c3f-123">A continuación, se agrega la cuenta de servicio de AD FS del servicio de federación a este grupo.</span><span class="sxs-lookup"><span data-stu-id="85c3f-123">It then adds the AD FS service account of your federation service to this group.</span></span> <span data-ttu-id="85c3f-124">Compruebe en el controlador de dominio que el grupo PhoneFactor Admins se ha creado realmente y que la cuenta de servicio de AD FS es miembro de este grupo.</span><span class="sxs-lookup"><span data-stu-id="85c3f-124">Verify on your domain controller that the PhoneFactor Admins group is indeed created and that the AD FS service account is a member of this group.</span></span> <span data-ttu-id="85c3f-125">Si es necesario, agregue la cuenta de servicio de AD FS manualmente al grupo PhoneFactor Admins en el controlador de dominio.</span><span class="sxs-lookup"><span data-stu-id="85c3f-125">If necessary, manually add the AD FS service account to the PhoneFactor Admins group on your domain controller.</span></span>
* <span data-ttu-id="85c3f-126">Para obtener información sobre cómo instalar el SDK del servicio web con el portal de usuarios, consulte [Implementación del Portal de usuarios para Servidor Azure Multi-Factor Authentication](multi-factor-authentication-get-started-portal.md)</span><span class="sxs-lookup"><span data-stu-id="85c3f-126">For information about installing the Web Service SDK with the user portal, read about [deploying the user portal for Azure Multi-Factor Authentication Server.](multi-factor-authentication-get-started-portal.md)</span></span>

### <a name="install-azure-multi-factor-authentication-server-locally-on-the-ad-fs-server"></a><span data-ttu-id="85c3f-127">Instalación de Servidor Azure Multi-Factor Authentication localmente en el servidor AD FS</span><span class="sxs-lookup"><span data-stu-id="85c3f-127">Install Azure Multi-Factor Authentication Server locally on the AD FS server</span></span>
1. <span data-ttu-id="85c3f-128">Descargue e instale Servidor Azure Multi-Factor Authentication en el servidor de AD FS.</span><span class="sxs-lookup"><span data-stu-id="85c3f-128">Download and install Azure Multi-Factor Authentication Server on your AD FS server.</span></span> <span data-ttu-id="85c3f-129">Para obtener información sobre la instalación, consulte la [introducción a Servidor Azure Multi-Factor Authentication](multi-factor-authentication-get-started-server.md).</span><span class="sxs-lookup"><span data-stu-id="85c3f-129">For installation information, read about [getting started with Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md).</span></span>
2. <span data-ttu-id="85c3f-130">En la consola de administración del Servidor Azure Multi-Factor Authentication, haga clic en el icono de **AD FS**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-130">In the Azure Multi-Factor Authentication Server management console, click the **AD FS** icon.</span></span> <span data-ttu-id="85c3f-131">Seleccione las opciones **Permitir inscripción de usuario** y  **Permitir a los usuarios seleccionar el método**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-131">Select the options **Allow user enrollment** and **Allow users to select method**.</span></span>
3. <span data-ttu-id="85c3f-132">Seleccione las opciones adicionales que desee especificar para su organización.</span><span class="sxs-lookup"><span data-stu-id="85c3f-132">Select any additional options you'd like to specify for your organization.</span></span>
4. <span data-ttu-id="85c3f-133">Haga clic en **Instalar adaptador de AD FS**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-133">Click **Install AD FS Adapter**.</span></span>
   
   <span data-ttu-id="85c3f-134"><center>![Nube](./media/multi-factor-authentication-get-started-adfs-w2k12/server.png)</center></span><span class="sxs-lookup"><span data-stu-id="85c3f-134"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/server.png)</center></span></span>

5. <span data-ttu-id="85c3f-135">Si se muestra la ventana de Active Directory, eso significa dos cosas.</span><span class="sxs-lookup"><span data-stu-id="85c3f-135">If the Active Directory window is displayed, that means two things.</span></span> <span data-ttu-id="85c3f-136">El equipo está unido a un dominio y la configuración de Active Directory para proteger la comunicación entre el adaptador de AD FS y el servicio Multi-Factor Authentication está incompleta.</span><span class="sxs-lookup"><span data-stu-id="85c3f-136">Your computer is joined to a domain, and the Active Directory configuration for securing communication between the AD FS adapter and the Multi-Factor Authentication service is incomplete.</span></span> <span data-ttu-id="85c3f-137">Haga clic en **Siguiente** para completar esta configuración automáticamente o marque la casilla **Omitir configuración automática de Active Directory y configurar los parámetros manualmente**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-137">Click **Next** to automatically complete this configuration, or select the **Skip automatic Active Directory configuration and configure settings manually** check box.</span></span> <span data-ttu-id="85c3f-138">Haga clic en **Siguiente**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-138">Click **Next**.</span></span>
6. <span data-ttu-id="85c3f-139">Si se muestran las ventanas de grupo local, eso significa dos cosas.</span><span class="sxs-lookup"><span data-stu-id="85c3f-139">If the Local Group windows is displayed, that means two things.</span></span> <span data-ttu-id="85c3f-140">El equipo no está unido a un dominio y la configuración del grupo local para proteger la comunicación entre el adaptador de AD FS y el servicio Multi-Factor Authentication está incompleta.</span><span class="sxs-lookup"><span data-stu-id="85c3f-140">Your computer is not joined to a domain, and the local group configuration for securing communication between the AD FS adapter and the Multi-Factor Authentication service is incomplete.</span></span> <span data-ttu-id="85c3f-141">Haga clic en **Siguiente** para completar esta configuración automáticamente o marque la casilla **Omitir configuración automática de grupo local y configurar los parámetros manualmente**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-141">Click **Next** to automatically complete this configuration, or select the **Skip automatic Local Group configuration and configure settings manually** check box.</span></span> <span data-ttu-id="85c3f-142">Haga clic en **Siguiente**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-142">Click **Next**.</span></span>
7. <span data-ttu-id="85c3f-143">En el asistente para la instalación, haga clic en **Siguiente**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-143">In the installation wizard, click **Next**.</span></span> <span data-ttu-id="85c3f-144">Servidor Azure Multi-Factor Authentication crea el grupo PhoneFactor Admins y agrega la cuenta de servicio de AD FS al grupo PhoneFactor Admins.</span><span class="sxs-lookup"><span data-stu-id="85c3f-144">Azure Multi-Factor Authentication Server creates the PhoneFactor Admins group and adds the AD FS service account to the PhoneFactor Admins group.</span></span>
   <span data-ttu-id="85c3f-145"><center>![Nube](./media/multi-factor-authentication-get-started-adfs-w2k12/adapter.png)</center></span><span class="sxs-lookup"><span data-stu-id="85c3f-145"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/adapter.png)</center></span></span>
8. <span data-ttu-id="85c3f-146">En la página **Iniciar instalador**, haga clic en **Siguiente**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-146">On the **Launch Installer** page, click **Next**.</span></span>
9. <span data-ttu-id="85c3f-147">En el instalador del adaptador de AD FS de Multi-Factor Authentication, haga clic en **Siguiente**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-147">In the Multi-Factor Authentication AD FS adapter installer, click **Next**.</span></span>
10. <span data-ttu-id="85c3f-148">Cuando se haya completado la instalación, haga clic en **Cerrar** .</span><span class="sxs-lookup"><span data-stu-id="85c3f-148">Click **Close** when the installation is finished.</span></span>
11. <span data-ttu-id="85c3f-149">Una vez instalado el adaptador, debe registrarlo con AD FS.</span><span class="sxs-lookup"><span data-stu-id="85c3f-149">When the adapter has been installed, you must register it with AD FS.</span></span> <span data-ttu-id="85c3f-150">Abra Windows PowerShell y ejecute el siguiente comando:</span><span class="sxs-lookup"><span data-stu-id="85c3f-150">Open Windows PowerShell and run the following command:</span></span><br><span data-ttu-id="85c3f-151">
    `C:\Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1`
    <center>![Nube](./media/multi-factor-authentication-get-started-adfs-w2k12/pshell.png)</center></span><span class="sxs-lookup"><span data-stu-id="85c3f-151">
`C:\Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1`
<center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/pshell.png)</center></span></span>
12. <span data-ttu-id="85c3f-152">Modifique la directiva de autenticación global en AD FS para usar el adaptador recién registrado.</span><span class="sxs-lookup"><span data-stu-id="85c3f-152">To use your newly registered adapter, edit the global authentication policy in AD FS.</span></span> <span data-ttu-id="85c3f-153">En la consola de administración de AD FS, vaya al nodo **Directivas de autenticación** .</span><span class="sxs-lookup"><span data-stu-id="85c3f-153">In the AD FS management console, go to the **Authentication Policies** node.</span></span> <span data-ttu-id="85c3f-154">En la sección **Multi-factor Authentication**, haga clic en el vínculo **Editar** situado junto a la sección **Configuración Global**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-154">In the **Multi-factor Authentication** section, click the **Edit** link next to the **Global Settings** section.</span></span> <span data-ttu-id="85c3f-155">En la ventana **Editar directiva de autenticación global**, seleccione **Multi-Factor Authentication** como método de autenticación adicional y haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-155">In the **Edit Global Authentication Policy** window, select **Multi-Factor Authentication** as an additional authentication method, and then click **OK**.</span></span> <span data-ttu-id="85c3f-156">El adaptador está registrado como WindowsAzureMultiFactorAuthentication.</span><span class="sxs-lookup"><span data-stu-id="85c3f-156">The adapter is registered as WindowsAzureMultiFactorAuthentication.</span></span> <span data-ttu-id="85c3f-157">Reinicie el servicio de AD FS para que surta efecto el registro.</span><span class="sxs-lookup"><span data-stu-id="85c3f-157">Restart the AD FS service for the registration to take effect.</span></span>

<span data-ttu-id="85c3f-158"><center>![Nube](./media/multi-factor-authentication-get-started-adfs-w2k12/global.png)</center></span><span class="sxs-lookup"><span data-stu-id="85c3f-158"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/global.png)</center></span></span>

<span data-ttu-id="85c3f-159">En este punto, Servidor Multi-Factor Authentication está configurado para ser un proveedor de autenticación adicional y utilizarlo con AD FS.</span><span class="sxs-lookup"><span data-stu-id="85c3f-159">At this point, Multi-Factor Authentication Server is set up to be an additional authentication provider to use with AD FS.</span></span>

## <a name="install-a-standalone-instance-of-the-ad-fs-adapter-by-using-the-web-service-sdk"></a><span data-ttu-id="85c3f-160">Instalación de una instancia independiente del adaptador de AD FS mediante el SDK del servicio web</span><span class="sxs-lookup"><span data-stu-id="85c3f-160">Install a standalone instance of the AD FS adapter by using the Web Service SDK</span></span>
1. <span data-ttu-id="85c3f-161">Instale el SDK del servicio web en el servidor que ejecuta Servidor Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="85c3f-161">Install the Web Service SDK on the server that is running Multi-Factor Authentication Server.</span></span>
2. <span data-ttu-id="85c3f-162">Copie los siguientes archivos del directorio \Archivos de programa\Multi-Factor Authentication Server en el servidor en el que planea instalar el adaptador de AD FS:</span><span class="sxs-lookup"><span data-stu-id="85c3f-162">Copy the following files from the \Program Files\Multi-Factor Authentication Server directory to the server on which you plan to install the AD FS adapter:</span></span>
   * <span data-ttu-id="85c3f-163">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span><span class="sxs-lookup"><span data-stu-id="85c3f-163">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span></span>
   * <span data-ttu-id="85c3f-164">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="85c3f-164">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
   * <span data-ttu-id="85c3f-165">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="85c3f-165">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
   * <span data-ttu-id="85c3f-166">MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="85c3f-166">MultiFactorAuthenticationAdfsAdapter.config</span></span>
3. <span data-ttu-id="85c3f-167">Ejecute el archivo de instalación MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span><span class="sxs-lookup"><span data-stu-id="85c3f-167">Run the MultiFactorAuthenticationAdfsAdapterSetup64.msi installation file.</span></span>
4. <span data-ttu-id="85c3f-168">En el instalador del adaptador de AD FS de Multi-Factor Authentication, haga clic en **Siguiente** para iniciar la instalación.</span><span class="sxs-lookup"><span data-stu-id="85c3f-168">In the Multi-Factor Authentication AD FS adapter installer, click **Next** to start the installation.</span></span>
5. <span data-ttu-id="85c3f-169">Cuando se haya completado la instalación, haga clic en **Cerrar** .</span><span class="sxs-lookup"><span data-stu-id="85c3f-169">Click **Close** when the installation is finished.</span></span>

## <a name="edit-the-multifactorauthenticationadfsadapterconfig-file"></a><span data-ttu-id="85c3f-170">Edite el archivo MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="85c3f-170">Edit the MultiFactorAuthenticationAdfsAdapter.config file</span></span>
<span data-ttu-id="85c3f-171">Siga estos pasos para editar el archivo MultiFactorAuthenticationAdfsAdapter.config:</span><span class="sxs-lookup"><span data-stu-id="85c3f-171">Follow these steps to edit the MultiFactorAuthenticationAdfsAdapter.config file:</span></span>

1. <span data-ttu-id="85c3f-172">Establezca el nodo **UseWebServiceSdk** en **true**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-172">Set the **UseWebServiceSdk** node to **true**.</span></span>  
2. <span data-ttu-id="85c3f-173">Establezca el valor de **WebServiceSdkUrl** en la dirección URL del SDK del Servicio web Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="85c3f-173">Set the value for **WebServiceSdkUrl** to the URL of the Multi-Factor Authentication Web Service SDK.</span></span> <span data-ttu-id="85c3f-174">Por ejemplo:  *https://contoso.com/&lt;NombreDelCertificado&gt;/MultiFactorAuthWebServicesSdk/PfWsSdk.asmx*, donde *NombreDelCertificado* es el nombre de su certificado.</span><span class="sxs-lookup"><span data-stu-id="85c3f-174">For example:  *https://contoso.com/&lt;certificatename&gt;/MultiFactorAuthWebServiceSdk/PfWsSdk.asmx*, Where *certificatename* is the name of your certificate.</span></span>  
3. <span data-ttu-id="85c3f-175">Edite el script Register-MultiFactorAuthenticationAdfsAdapter.ps1 agregando *-ConfigurationFilePath &lt;path&gt;* al final del comando `Register-AdfsAuthenticationProvider`, donde *&lt;path&gt;* es la ruta de acceso completa al archivo MultiFactorAuthenticationAdfsAdapter.config.</span><span class="sxs-lookup"><span data-stu-id="85c3f-175">Edit the Register-MultiFactorAuthenticationAdfsAdapter.ps1 script by adding *-ConfigurationFilePath &lt;path&gt;* to the end of the `Register-AdfsAuthenticationProvider` command, where *&lt;path&gt;* is the full path to the MultiFactorAuthenticationAdfsAdapter.config file.</span></span>

### <a name="configure-the-web-service-sdk-with-a-username-and-password"></a><span data-ttu-id="85c3f-176">Configuración del SDK del servicio web con nombre de usuario y contraseña</span><span class="sxs-lookup"><span data-stu-id="85c3f-176">Configure the Web Service SDK with a username and password</span></span>
<span data-ttu-id="85c3f-177">Hay dos opciones para configurar el SDK del servicio Web.</span><span class="sxs-lookup"><span data-stu-id="85c3f-177">There are two options for configuring the Web Service SDK.</span></span> <span data-ttu-id="85c3f-178">La primera es con un nombre de usuario y una contraseña, y la segunda es con un certificado de cliente.</span><span class="sxs-lookup"><span data-stu-id="85c3f-178">The first is with a username and password, the second is with a client certificate.</span></span> <span data-ttu-id="85c3f-179">Siga estos pasos para la primera opción o pase a la segunda.</span><span class="sxs-lookup"><span data-stu-id="85c3f-179">Follow these steps for the first option, or skip ahead for the second.</span></span>  

1. <span data-ttu-id="85c3f-180">Establezca el valor de **WebServiceSdkUsername** en una cuenta miembro del grupo de seguridad PhoneFactor Admins.</span><span class="sxs-lookup"><span data-stu-id="85c3f-180">Set the value for **WebServiceSdkUsername** to an account that is a member of the PhoneFactor Admins security group.</span></span> <span data-ttu-id="85c3f-181">Utilice el formato &lt;dominio&gt;&#92;&lt;nombre de usuario&gt;.</span><span class="sxs-lookup"><span data-stu-id="85c3f-181">Use the &lt;domain&gt;&#92;&lt;user name&gt; format.</span></span>  
2. <span data-ttu-id="85c3f-182">Establezca el valor de **WebServiceSdkPassword** en la contraseña de la cuenta apropiada.</span><span class="sxs-lookup"><span data-stu-id="85c3f-182">Set the value for **WebServiceSdkPassword** to the appropriate account password.</span></span>

### <a name="configure-the-web-service-sdk-with-a-client-certificate"></a><span data-ttu-id="85c3f-183">Configuración del SDK del servicio web con un certificado de cliente</span><span class="sxs-lookup"><span data-stu-id="85c3f-183">Configure the Web Service SDK with a client certificate</span></span>
<span data-ttu-id="85c3f-184">Si no desea usar un nombre de usuario y una contraseña, siga estos pasos para configurar el SDK del servicio web con un certificado de cliente.</span><span class="sxs-lookup"><span data-stu-id="85c3f-184">If you don't want to use a username and password, follow these steps to configure the Web Service SDK with a client certificate.</span></span>

1. <span data-ttu-id="85c3f-185">Obtenga un certificado de cliente de una entidad de certificación para el servidor que ejecuta el SDK del servicio web.</span><span class="sxs-lookup"><span data-stu-id="85c3f-185">Obtain a client certificate from a certificate authority for the server that is running the Web Service SDK.</span></span> <span data-ttu-id="85c3f-186">Aprenda a [obtener certificados de cliente](https://technet.microsoft.com/library/cc770328.aspx).</span><span class="sxs-lookup"><span data-stu-id="85c3f-186">Learn how to [obtain client certificates](https://technet.microsoft.com/library/cc770328.aspx).</span></span>  
2. <span data-ttu-id="85c3f-187">Importe el certificado de cliente en el almacén de certificados personales del equipo local en el servidor que ejecuta el SDK del servicio web.</span><span class="sxs-lookup"><span data-stu-id="85c3f-187">Import the client certificate to the local computer personal certificate store on the server that is running the Web Service SDK.</span></span> <span data-ttu-id="85c3f-188">Asegúrese de que el certificado público de la entidad de certificación está en el almacén de certificados de certificados raíz de confianza.</span><span class="sxs-lookup"><span data-stu-id="85c3f-188">Make sure that the certificate authority's public certificate is in Trusted Root Certificates certificate store.</span></span>  
3. <span data-ttu-id="85c3f-189">Exporte las claves pública y privadas del certificado de cliente a un archivo .pfx.</span><span class="sxs-lookup"><span data-stu-id="85c3f-189">Export the public and private keys of the client certificate to a .pfx file.</span></span>  
4. <span data-ttu-id="85c3f-190">Exporte la clave pública en formato Base64 a un archivo .cer.</span><span class="sxs-lookup"><span data-stu-id="85c3f-190">Export the public key in Base64 format to a .cer file.</span></span>  
5. <span data-ttu-id="85c3f-191">En el Administrador del servidor, compruebe que está instalada la característica de servidor web (IIS)\servidor web\seguridad\autenticación de asignaciones de certificado de cliente de IIS.</span><span class="sxs-lookup"><span data-stu-id="85c3f-191">In Server Manager, verify that the Web Server (IIS)\Web Server\Security\IIS Client Certificate Mapping Authentication feature is installed.</span></span> <span data-ttu-id="85c3f-192">Si no está instalada, seleccione **Agregar roles y características** para agregar esta característica.</span><span class="sxs-lookup"><span data-stu-id="85c3f-192">If it is not installed, select **Add Roles and Features** to add this feature.</span></span>  
6. <span data-ttu-id="85c3f-193">En Administrador de IIS, haga doble clic en **Editor de configuración** en el sitio web que contiene el directorio virtual del SDK del servicio web.</span><span class="sxs-lookup"><span data-stu-id="85c3f-193">In IIS Manager, double-click **Configuration Editor** in the website that contains the Web Service SDK virtual directory.</span></span> <span data-ttu-id="85c3f-194">Es importante seleccionar el sitio web, no el directorio virtual.</span><span class="sxs-lookup"><span data-stu-id="85c3f-194">It is important to select the website, not the virtual directory.</span></span>  
7. <span data-ttu-id="85c3f-195">Vaya a la sección **system.webServer/security/authentication/iisClientCertificateMappingAuthentication** .</span><span class="sxs-lookup"><span data-stu-id="85c3f-195">Go to the **system.webServer/security/authentication/iisClientCertificateMappingAuthentication** section.</span></span>  
8. <span data-ttu-id="85c3f-196">Establezca enabled en **true**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-196">Set enabled to **true**.</span></span>  
9. <span data-ttu-id="85c3f-197">Establezca oneToOneCertificateMappingsEnabled en **true**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-197">Set oneToOneCertificateMappingsEnabled to **true**.</span></span>  
10. <span data-ttu-id="85c3f-198">Haga clic en el botón **...** situado junto a oneToOneMappings y, después, haga clic en el vínculo **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-198">Click the **...** button next to oneToOneMappings, and then click the **Add** link.</span></span>  
11. <span data-ttu-id="85c3f-199">Abra el archivo .cer de Base64 que exportó anteriormente.</span><span class="sxs-lookup"><span data-stu-id="85c3f-199">Open the Base64 .cer file you exported earlier.</span></span> <span data-ttu-id="85c3f-200">Quite *-----BEGIN CERTIFICATE-----*, *-----END CERTIFICATE-----* y todos los saltos de línea.</span><span class="sxs-lookup"><span data-stu-id="85c3f-200">Remove *-----BEGIN CERTIFICATE-----*, *-----END CERTIFICATE-----*, and any line breaks.</span></span> <span data-ttu-id="85c3f-201">Copie la cadena resultante.</span><span class="sxs-lookup"><span data-stu-id="85c3f-201">Copy the resulting string.</span></span>  
12. <span data-ttu-id="85c3f-202">Establezca certificate en la cadena que se copió en el paso anterior.</span><span class="sxs-lookup"><span data-stu-id="85c3f-202">Set certificate to the string copied in the preceding step.</span></span>  
13. <span data-ttu-id="85c3f-203">Establezca enabled en **true**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-203">Set enabled to **true**.</span></span>  
14. <span data-ttu-id="85c3f-204">Establezca userName en una cuenta que sea miembro del grupo de seguridad PhoneFactor Admins.</span><span class="sxs-lookup"><span data-stu-id="85c3f-204">Set userName to an account that is a member of the PhoneFactor Admins security group.</span></span> <span data-ttu-id="85c3f-205">Utilice el formato &lt;dominio&gt;&#92;&lt;nombre de usuario&gt;.</span><span class="sxs-lookup"><span data-stu-id="85c3f-205">Use the &lt;domain&gt;&#92;&lt;user name&gt; format.</span></span>  
15. <span data-ttu-id="85c3f-206">Establezca la contraseña en la de la cuenta adecuada y, después, cierre el Editor de configuración.</span><span class="sxs-lookup"><span data-stu-id="85c3f-206">Set the password to the appropriate account password, and then close Configuration Editor.</span></span>  
16. <span data-ttu-id="85c3f-207">Haga clic en el vínculo **Aplicar** .</span><span class="sxs-lookup"><span data-stu-id="85c3f-207">Click the **Apply** link.</span></span>  
17. <span data-ttu-id="85c3f-208">En el directorio virtual del SDK del servicio web, haga doble clic en **Autenticación**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-208">In the Web Service SDK virtual directory, double-click **Authentication**.</span></span>  
18. <span data-ttu-id="85c3f-209">Compruebe que Suplantación de ASP.NET y Autenticación básica se establecen en **Habilitado** y los restantes elementos se establecen en **Deshabilitado**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-209">Verify that ASP.NET Impersonation and Basic Authentication are set to **Enabled**, and that all other items are set to **Disabled**.</span></span>  
19. <span data-ttu-id="85c3f-210">En el directorio virtual del SDK del servicio web, haga doble clic en **Configuración de SSL**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-210">In the Web Service SDK virtual directory, double-click **SSL Settings**.</span></span>  
20. <span data-ttu-id="85c3f-211">Establezca Certificados de cliente en **Aceptar** y, después, haga clic en **Aplicar**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-211">Set Client Certificates to **Accept**, and then click **Apply**.</span></span>  
21. <span data-ttu-id="85c3f-212">Copie el archivo .pfx que exportó anteriormente en el servidor que ejecuta el adaptador de AD FS.</span><span class="sxs-lookup"><span data-stu-id="85c3f-212">Copy the .pfx file you exported earlier to the server that is running the AD FS adapter.</span></span>  
22. <span data-ttu-id="85c3f-213">Importe el archivo .pfx en el almacén de certificados personales del equipo local.</span><span class="sxs-lookup"><span data-stu-id="85c3f-213">Import the .pfx file to the local computer personal certificate store.</span></span>  
23. <span data-ttu-id="85c3f-214">Haga clic con el botón derecho y seleccione **Administrar claves privadas**, y, a continuación, otorgue acceso de lectura a la cuenta usada para iniciar sesión en el servicio AD FS.</span><span class="sxs-lookup"><span data-stu-id="85c3f-214">Right-click and select **Manage Private Keys**, and then grant read access to the account you used to sign in to the AD FS service.</span></span>  
24. <span data-ttu-id="85c3f-215">Abra el certificado de cliente y copie la huella digital de la pestaña **Detalles** .</span><span class="sxs-lookup"><span data-stu-id="85c3f-215">Open the client certificate and copy the thumbprint from the **Details** tab.</span></span>  
25. <span data-ttu-id="85c3f-216">En el archivo MultiFactorAuthenticationAdfsAdapter.config, establezca **WebServiceSdkCertificateThumbprint** en la cadena que copió en el paso anterior.</span><span class="sxs-lookup"><span data-stu-id="85c3f-216">In the MultiFactorAuthenticationAdfsAdapter.config file, set **WebServiceSdkCertificateThumbprint** to the string copied in the previous step.</span></span>  

<span data-ttu-id="85c3f-217">Por último, para registrar el adaptador, ejecute el script \Archivos de programa\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1 en PowerShell.</span><span class="sxs-lookup"><span data-stu-id="85c3f-217">Finally, to register the adapter, run the \Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1 script in PowerShell.</span></span> <span data-ttu-id="85c3f-218">El adaptador está registrado como WindowsAzureMultiFactorAuthentication.</span><span class="sxs-lookup"><span data-stu-id="85c3f-218">The adapter is registered as WindowsAzureMultiFactorAuthentication.</span></span> <span data-ttu-id="85c3f-219">Reinicie el servicio de AD FS para que surta efecto el registro.</span><span class="sxs-lookup"><span data-stu-id="85c3f-219">Restart the AD FS service for the registration to take effect.</span></span>

## <a name="secure-azure-ad-resources-using-ad-fs"></a><span data-ttu-id="85c3f-220">Protección de los recursos de Azure AD mediante AD FS</span><span class="sxs-lookup"><span data-stu-id="85c3f-220">Secure Azure AD resources using AD FS</span></span>
<span data-ttu-id="85c3f-221">Para proteger los recursos de la nube, configure una regla de notificaciones para que los servicios de federación de Active Directory emitan la notificación multipleauthn cuando un usuario realice correctamente la verificación en dos pasos.</span><span class="sxs-lookup"><span data-stu-id="85c3f-221">To secure your cloud resource, set up a claims rule so that Active Directory Federation Services emits the multipleauthn claim when a user performs two-step verification successfully.</span></span> <span data-ttu-id="85c3f-222">Esta notificación se transmitirá a Azure AD.</span><span class="sxs-lookup"><span data-stu-id="85c3f-222">This claim is passed on to Azure AD.</span></span> <span data-ttu-id="85c3f-223">Siga este procedimiento para realizar los pasos:</span><span class="sxs-lookup"><span data-stu-id="85c3f-223">Follow this procedure to walk through the steps:</span></span>

1. <span data-ttu-id="85c3f-224">Abra Administración de AD FS.</span><span class="sxs-lookup"><span data-stu-id="85c3f-224">Open AD FS Management.</span></span>
2. <span data-ttu-id="85c3f-225">A la izquierda, seleccione **Relaciones de confianza para usuario autenticado**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-225">On the left, select **Relying Party Trusts**.</span></span>
3. <span data-ttu-id="85c3f-226">Haga clic con el botón derecho en **Plataforma de identidad de Microsoft Office 365** y seleccione **Editar reglas de notificaciones…**</span><span class="sxs-lookup"><span data-stu-id="85c3f-226">Right-click on **Microsoft Office 365 Identity Platform** and select **Edit Claim Rules…**</span></span>

   ![Nube](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip1.png)

4. <span data-ttu-id="85c3f-228">En Reglas de transformación de emisión, haga clic en **Agregar regla**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-228">On Issuance Transform Rules, click **Add Rule.**</span></span>

   ![Nube](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip2.png)

5. <span data-ttu-id="85c3f-230">En el Asistente para agregar regla de notificaciones de transformación, seleccione **Pasar por una notificación entrante o filtrarla** en la lista desplegable y haga clic en **Siguiente**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-230">On the Add Transform Claim Rule Wizard, select **Pass Through or Filter an Incoming Claim** from the drop-down and click **Next**.</span></span>

   ![Nube](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip3.png)

6. <span data-ttu-id="85c3f-232">Asigne un nombre a la regla.</span><span class="sxs-lookup"><span data-stu-id="85c3f-232">Give your rule a name.</span></span>
7. <span data-ttu-id="85c3f-233">Seleccione **Referencias de métodos de autenticación** como tipo de notificación entrante.</span><span class="sxs-lookup"><span data-stu-id="85c3f-233">Select **Authentication Methods References** as the Incoming claim type.</span></span>
8. <span data-ttu-id="85c3f-234">Seleccione **Pasar a través todos los valores de notificaciones**.</span><span class="sxs-lookup"><span data-stu-id="85c3f-234">Select **Pass through all claim values**.</span></span>
    <span data-ttu-id="85c3f-235">![Asistente para agregar regla de notificación de transformación](./media/multi-factor-authentication-get-started-adfs-cloud/configurewizard.png)</span><span class="sxs-lookup"><span data-stu-id="85c3f-235">![Add Transform Claim Rule Wizard](./media/multi-factor-authentication-get-started-adfs-cloud/configurewizard.png)</span></span>
9. <span data-ttu-id="85c3f-236">Haga clic en **Finalizar**</span><span class="sxs-lookup"><span data-stu-id="85c3f-236">Click **Finish**.</span></span> <span data-ttu-id="85c3f-237">Cierre la consola de administración de AD FS.</span><span class="sxs-lookup"><span data-stu-id="85c3f-237">Close the AD FS Management console.</span></span>

## <a name="related-topics"></a><span data-ttu-id="85c3f-238">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="85c3f-238">Related topics</span></span>
<span data-ttu-id="85c3f-239">Para obtener ayuda para solucionar problemas, consulte [P+F sobre Azure Multi-Factor Authentication](multi-factor-authentication-faq.md)</span><span class="sxs-lookup"><span data-stu-id="85c3f-239">For troubleshooting help, see the [Azure Multi-Factor Authentication FAQs](multi-factor-authentication-faq.md)</span></span>

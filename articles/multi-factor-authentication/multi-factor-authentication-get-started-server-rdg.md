---
title: RDG y Servidor Azure MFA mediante RADIUS | Microsoft Docs
description: "Se trata de la página de Azure Multi-Factor Authentication que le ayudará en la implementación de la puerta de enlace de escritorio remoto (RD) y el servidor Azure Multi-Factor Authentication mediante RADIUS."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: f2354ac4-a3a7-48e5-a86d-84a9e5682b42
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 06/27/2017
ms.author: kgremban
ms.reviewer: yossib
ms.custom: it-pro
ms.openlocfilehash: 3b4181701c5df03a3df7e0446b313eac201ad99e
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="remote-desktop-gateway-and-azure-multi-factor-authentication-server-using-radius"></a><span data-ttu-id="8dda9-103">Puerta de enlace de Escritorio remoto y Servidor Azure Multi-Factor Authentication con RADIUS</span><span class="sxs-lookup"><span data-stu-id="8dda9-103">Remote Desktop Gateway and Azure Multi-Factor Authentication Server using RADIUS</span></span>
<span data-ttu-id="8dda9-104">A menudo, Puerta de enlace de Escritorio remoto utiliza los servicios de directivas de red (NPS) local para autenticar a los usuarios.</span><span class="sxs-lookup"><span data-stu-id="8dda9-104">Often, Remote Desktop (RD) Gateway uses the local Network Policy Services (NPS) to authenticate users.</span></span> <span data-ttu-id="8dda9-105">En este artículo se describe cómo enrutar la solicitud RADIUS desde Puerta de enlace de Escritorio remoto (a través del NPS local) a Servidor Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="8dda9-105">This article describes how to route RADIUS requests out from the Remote Desktop Gateway (through the local NPS) to the Multi-Factor Authentication Server.</span></span> <span data-ttu-id="8dda9-106">La combinación de Azure MFA y Puerta de enlace de Escritorio remoto significa que los usuarios pueden tener acceso a sus entornos de trabajo desde cualquier lugar mientras realicen una autenticación segura.</span><span class="sxs-lookup"><span data-stu-id="8dda9-106">The combination of Azure MFA and RD Gateway means that your users can access their work environments from anywhere while performing strong authentication.</span></span> 

<span data-ttu-id="8dda9-107">Puesto que no se admite la autenticación de Windows para los servicios de terminal en Server 2012 R2, utilice Puerta de enlace de Escritorio remoto y RADIUS para integrar con el servidor MFA.</span><span class="sxs-lookup"><span data-stu-id="8dda9-107">Since Windows Authentication for terminal services is not supported for Server 2012 R2, use RD Gateway and RADIUS to integrate with MFA Server.</span></span> 

<span data-ttu-id="8dda9-108">Instale el servidor Azure Multi-Factor Authentication en un servidor independiente, que luego entrega la solicitud RADIUS a NPS en el servidor de Puerta de enlace de Escritorio remoto.</span><span class="sxs-lookup"><span data-stu-id="8dda9-108">Install the Azure Multi-Factor Authentication Server on a separate server, which proxies the RADIUS request back to the NPS on the Remote Desktop Gateway Server.</span></span> <span data-ttu-id="8dda9-109">Una vez que NPS valida el nombre de usuario y la contraseña, devuelve una respuesta al servidor Microsoft Azure Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="8dda9-109">After NPS validates the username and password, it returns a response to the Multi-Factor Authentication Server.</span></span> <span data-ttu-id="8dda9-110">Luego, el servidor MFA ejecuta el segundo factor de autenticación y devuelve un resultado a la puerta de enlace.</span><span class="sxs-lookup"><span data-stu-id="8dda9-110">Then, the MFA Server performs the second factor of authentication and returns a result to the gateway.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="8dda9-111">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="8dda9-111">Prerequisites</span></span>

- <span data-ttu-id="8dda9-112">Un servidor Azure MFA unido a un dominio.</span><span class="sxs-lookup"><span data-stu-id="8dda9-112">A domain-joined Azure MFA Server.</span></span> <span data-ttu-id="8dda9-113">Si no tiene uno ya instalado, siga los pasos de [Introducción a Servidor Azure Multi-factor Authentication](multi-factor-authentication-get-started-server.md).</span><span class="sxs-lookup"><span data-stu-id="8dda9-113">If you don't have one installed already, follow the steps in [Getting started with the Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md).</span></span>
- <span data-ttu-id="8dda9-114">Una Puerta de enlace de Escritorio remoto que se autentica con los servicios de la directiva de red.</span><span class="sxs-lookup"><span data-stu-id="8dda9-114">A Remote Desktop Gateway that authenticates with Network Policy Services.</span></span>

## <a name="configure-the-remote-desktop-gateway"></a><span data-ttu-id="8dda9-115">Configuración de Puerta de enlace de Escritorio remoto</span><span class="sxs-lookup"><span data-stu-id="8dda9-115">Configure the Remote Desktop Gateway</span></span>
<span data-ttu-id="8dda9-116">Configure Puerta de enlace de Escritorio remoto para enviar la autenticación RADIUS a una instancia de Servidor Azure Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="8dda9-116">Configure the RD Gateway to send RADIUS authentication to an Azure Multi-Factor Authentication Server.</span></span> 

1. <span data-ttu-id="8dda9-117">En Administrador de puerta de enlace de Escritorio remoto, haga clic en el nombre del servidor y seleccione **Propiedades**.</span><span class="sxs-lookup"><span data-stu-id="8dda9-117">In RD Gateway Manager, right-click the server name and select **Properties**.</span></span>
2. <span data-ttu-id="8dda9-118">Vaya a la pestaña **Almacén de CAP de RD** y seleccione **Servidor central que ejecuta NPS**.</span><span class="sxs-lookup"><span data-stu-id="8dda9-118">Go to the **RD CAP Store** tab and select **Central server running NPS**.</span></span> 
3. <span data-ttu-id="8dda9-119">Agregue una o más instancias de Servidor Azure Multi-Factor Authentication como servidores RADIUS al especificar una dirección IP en cada servidor.</span><span class="sxs-lookup"><span data-stu-id="8dda9-119">Add one or more Azure Multi-Factor Authentication Servers as RADIUS servers by entering the name or IP address of each server.</span></span> 
4. <span data-ttu-id="8dda9-120">Cree un secreto compartido para cada servidor.</span><span class="sxs-lookup"><span data-stu-id="8dda9-120">Create a shared secret for each server.</span></span>

## <a name="configure-nps"></a><span data-ttu-id="8dda9-121">Configuración de NPS</span><span class="sxs-lookup"><span data-stu-id="8dda9-121">Configure NPS</span></span>
<span data-ttu-id="8dda9-122">La puerta de enlace de escritorio remoto usa NPS para enviar la solicitud de RADIUS a la Azure Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="8dda9-122">The RD Gateway uses NPS to send the RADIUS request to Azure Multi-Factor Authentication.</span></span> <span data-ttu-id="8dda9-123">Para configurar NPS, primero cambie la configuración de tiempo de espera para evitar que Puerta de enlace de Escritorio remoto agote el tiempo de espera antes de que se complete la verificación en dos pasos.</span><span class="sxs-lookup"><span data-stu-id="8dda9-123">To configure NPS, first you change the timeout settings to prevent the RD Gateway from timing out before the two-step verification has completed.</span></span> <span data-ttu-id="8dda9-124">Después, actualice NPS para recibir autenticaciones RADIUS desde el servidor MFA.</span><span class="sxs-lookup"><span data-stu-id="8dda9-124">Then, you update NPS to receive RADIUS authentications from your MFA Server.</span></span> <span data-ttu-id="8dda9-125">Use el procedimiento siguiente para configurar NPS:</span><span class="sxs-lookup"><span data-stu-id="8dda9-125">Use the following procedure to configure NPS:</span></span>

### <a name="modify-the-timeout-policy"></a><span data-ttu-id="8dda9-126">Modificación de la directiva de tiempo de espera</span><span class="sxs-lookup"><span data-stu-id="8dda9-126">Modify the timeout policy</span></span>

1. <span data-ttu-id="8dda9-127">En NPS, abra el menú **Clientes y servidores RADIUS** de la columna izquierda y seleccione **Grupos de servidores RADIUS remotos**.</span><span class="sxs-lookup"><span data-stu-id="8dda9-127">In NPS, open the **RADIUS Clients and Server** menu in the left column and select **Remote RADIUS Server Groups**.</span></span> 
2. <span data-ttu-id="8dda9-128">Seleccione el **GRUPO DE SERVIDORES DE PUERTA DE ENLACE DE TS**.</span><span class="sxs-lookup"><span data-stu-id="8dda9-128">Select the **TS GATEWAY SERVER GROUP**.</span></span> 
3. <span data-ttu-id="8dda9-129">Vaya a la pestaña **Equilibrio de carga**.</span><span class="sxs-lookup"><span data-stu-id="8dda9-129">Go to the **Load Balancing** tab.</span></span> 
4. <span data-ttu-id="8dda9-130">Cambie tanto **Segundos transcurridos sin respuesta antes de que la solicitud se considere anulada** como **Segundos transcurridos entre solicitudes cuando el servidor se identifica como no disponible** a un valor que oscile entre 30 y 60 segundos.</span><span class="sxs-lookup"><span data-stu-id="8dda9-130">Change both the **Number of seconds without response before request is considered dropped** and the **Number of seconds between requests when server is identified as unavailable** to between 30 and 60 seconds.</span></span> <span data-ttu-id="8dda9-131">(Si encuentra que el servidor sigue agotando el tiempo de espera durante la autenticación, puede regresar a este punto y aumentar el número de segundos).</span><span class="sxs-lookup"><span data-stu-id="8dda9-131">(If you find that the server still times out during authentication, you can come back here and increase the number of seconds.)</span></span>
5. <span data-ttu-id="8dda9-132">Vaya a la pestaña **Autenticación/Cuenta** y compruebe de que los puertos RADIUS especificados coincidan con los puertos en los que está escuchando la instancia de Servidor Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="8dda9-132">Go to the **Authentication/Account** tab and check that the RADIUS ports specified match the ports that the Multi-Factor Authentication Server is listening on.</span></span>

### <a name="prepare-nps-to-receive-authentications-from-the-mfa-server"></a><span data-ttu-id="8dda9-133">Preparación de NPS para recibir autenticaciones del servidor MFA</span><span class="sxs-lookup"><span data-stu-id="8dda9-133">Prepare NPS to receive authentications from the MFA Server</span></span>

1. <span data-ttu-id="8dda9-134">Haga clic en **Clientes RADIUS** bajo Clientes y servidores RADIUS en la columna izquierda y seleccione **Nuevo**.</span><span class="sxs-lookup"><span data-stu-id="8dda9-134">Right-click **RADIUS Clients** under RADIUS Clients and Servers in the left column and select **New**.</span></span>
2. <span data-ttu-id="8dda9-135">Agregue el servidor de Azure Multi-Factor Authentication como cliente RADIUS.</span><span class="sxs-lookup"><span data-stu-id="8dda9-135">Add the Azure Multi-Factor Authentication Server as a RADIUS client.</span></span> <span data-ttu-id="8dda9-136">Elija un nombre descriptivo y especifique un secreto compartido.</span><span class="sxs-lookup"><span data-stu-id="8dda9-136">Choose a Friendly name and specify a shared secret.</span></span>
3. <span data-ttu-id="8dda9-137">Abra el menú **Directivas** en la columna izquierda y seleccione **Directivas de solicitud de conexión**.</span><span class="sxs-lookup"><span data-stu-id="8dda9-137">Open the **Policies** menu in the left column and select **Connection Request Policies**.</span></span> <span data-ttu-id="8dda9-138">Debe ver una directiva denominada DIRECTIVA DE AUTORIZACIÓN DE PUERTA DE ENLACE TS creada al configurar la puerta de enlace RD.</span><span class="sxs-lookup"><span data-stu-id="8dda9-138">You should see a policy called TS GATEWAY AUTHORIZATION POLICY that was created when RD Gateway was configured.</span></span> <span data-ttu-id="8dda9-139">Esta directiva reenvía las solicitudes RADIUS al servidor Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="8dda9-139">This policy forwards RADIUS requests to the Multi-Factor Authentication Server.</span></span>
4. <span data-ttu-id="8dda9-140">Haga clic en **DIRECTIVA DE AUTORIZACIÓN DE PUERTA DE ENLACE TS** y seleccione **Duplicar directiva**.</span><span class="sxs-lookup"><span data-stu-id="8dda9-140">Right-click **TS GATEWAY AUTHORIZATION POLICY** and select **Duplicate Policy**.</span></span> 
5. <span data-ttu-id="8dda9-141">Abra la nueva directiva y vaya a la pestaña **Condiciones**.</span><span class="sxs-lookup"><span data-stu-id="8dda9-141">Open the new policy and go to the **Conditions** tab.</span></span>
6. <span data-ttu-id="8dda9-142">Agregue una condición que haga coincidir el nombre descriptivo del cliente con el nombre descriptivo establecido en el paso 2 para el cliente RADIUS de Servidor Azure Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="8dda9-142">Add a condition that matches the Client Friendly Name with the Friendly name set in step 2 for the Azure Multi-Factor Authentication Server RADIUS client.</span></span> 
7. <span data-ttu-id="8dda9-143">Vaya a la pestaña **Configuración** y seleccione **Autenticación**.</span><span class="sxs-lookup"><span data-stu-id="8dda9-143">Go to the **Settings** tab and select **Authentication**.</span></span>
8. <span data-ttu-id="8dda9-144">Cambie el proveedor de autenticación a **Autenticar solicitudes en este servidor**.</span><span class="sxs-lookup"><span data-stu-id="8dda9-144">Change the Authentication Provider to **Authenticate requests on this server**.</span></span> <span data-ttu-id="8dda9-145">Esta directiva garantiza que cuando NPS recibe una solicitud RADIUS desde el servidor Azure MFA, la autenticación se produce localmente en lugar de enviar una solicitud RADIUS a Servidor Azure Multi-Factor Authentication que daría lugar a una condición de bucle.</span><span class="sxs-lookup"><span data-stu-id="8dda9-145">This policy ensures that when NPS receives a RADIUS request from the Azure MFA Server, the authentication occurs locally instead of sending a RADIUS request back to the Azure Multi-Factor Authentication Server, which would result in a loop condition.</span></span> 
9. <span data-ttu-id="8dda9-146">Para evitar una condición de bucle, asegúrese de que la nueva directiva se ordena encima de la directiva original, en el panel **Directivas de solicitud de conexión**.</span><span class="sxs-lookup"><span data-stu-id="8dda9-146">To prevent a loop condition, make sure that the new policy is ordered ABOVE the original policy in the **Connection Request Policies** pane.</span></span>

## <a name="configure-azure-multi-factor-authentication"></a><span data-ttu-id="8dda9-147">Configuración de Azure Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="8dda9-147">Configure Azure Multi-Factor Authentication</span></span>

<span data-ttu-id="8dda9-148">El servidor Azure Multi-Factor Authentication se configura como un proxy RADIUS entre la puerta de enlace de escritorio remoto y NPS.</span><span class="sxs-lookup"><span data-stu-id="8dda9-148">The Azure Multi-Factor Authentication Server is configured as a RADIUS proxy between RD Gateway and NPS.</span></span>  <span data-ttu-id="8dda9-149">Debe instalarse en un servidor unido a un dominio independiente del servidor de puerta de enlace de escritorio remoto.</span><span class="sxs-lookup"><span data-stu-id="8dda9-149">It should be installed on a domain-joined server that is separate from the RD Gateway server.</span></span> <span data-ttu-id="8dda9-150">Use el procedimiento siguiente para configurar el servidor Azure Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="8dda9-150">Use the following procedure to configure the Azure Multi-Factor Authentication Server.</span></span>

1. <span data-ttu-id="8dda9-151">Abra Servidor Azure Multi-Factor Authentication y seleccione el icono de autenticación RADIUS.</span><span class="sxs-lookup"><span data-stu-id="8dda9-151">Open the Azure Multi-Factor Authentication Server and select the RADIUS Authentication icon.</span></span> 
2. <span data-ttu-id="8dda9-152">Active la casilla **Habilitar autenticación RADIUS**.</span><span class="sxs-lookup"><span data-stu-id="8dda9-152">Check the **Enable RADIUS authentication** checkbox.</span></span>
3. <span data-ttu-id="8dda9-153">En la pestaña Clientes, asegúrese de que los puertos coincidan con lo que se configura en NPS y seleccione **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="8dda9-153">On the Clients tab, ensure the ports match what is configured in NPS then select **Add**.</span></span>
4. <span data-ttu-id="8dda9-154">Agregue la dirección IP del servidor de Puerta de enlace de Escritorio remoto, el nombre de la aplicación (opcional) y un secreto compartido.</span><span class="sxs-lookup"><span data-stu-id="8dda9-154">Add the RD Gateway server IP address, application name (optional), and a shared secret.</span></span> <span data-ttu-id="8dda9-155">El secreto compartido debe ser el mismo en Servidor Azure Multi-Factor Authentication y en Puerta de enlace de Escritorio remoto.</span><span class="sxs-lookup"><span data-stu-id="8dda9-155">The shared secret needs to be the same on both the Azure Multi-Factor Authentication Server and RD Gateway.</span></span>
3. <span data-ttu-id="8dda9-156">Vaya a la pestaña **Destino** y seleccione el botón de opción **Servidores RADIUS**.</span><span class="sxs-lookup"><span data-stu-id="8dda9-156">Go to the **Target** tab and select the **RADIUS server(s)** radio button.</span></span>
4. <span data-ttu-id="8dda9-157">Seleccione **Agregar** y escriba la dirección IP, el secreto compartido y los puertos del servidor NPS.</span><span class="sxs-lookup"><span data-stu-id="8dda9-157">Select **Add** and enter the IP address, shared secret, and ports of the NPS server.</span></span> <span data-ttu-id="8dda9-158">A menos que use un NPS central, el cliente RADIUS y el destino RADIUS coincidirán.</span><span class="sxs-lookup"><span data-stu-id="8dda9-158">Unless using a central NPS, the RADIUS client and RADIUS target are the same.</span></span> <span data-ttu-id="8dda9-159">El secreto compartido debe coincidir con el configurado en la sección de cliente RADIUS del servidor NPS.</span><span class="sxs-lookup"><span data-stu-id="8dda9-159">The shared secret must match the one setup in the RADIUS client section of the NPS server.</span></span>

![Autenticación Radius](./media/multi-factor-authentication-get-started-server-rdg/radius.png)

## <a name="next-steps"></a><span data-ttu-id="8dda9-161">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="8dda9-161">Next steps</span></span>

- <span data-ttu-id="8dda9-162">Integración de Azure MFA y [aplicaciones web de IIS](multi-factor-authentication-get-started-server-iis.md)</span><span class="sxs-lookup"><span data-stu-id="8dda9-162">Integrate Azure MFA and [IIS web apps](multi-factor-authentication-get-started-server-iis.md)</span></span>

- <span data-ttu-id="8dda9-163">Obtenga respuestas en las [P+F sobre Azure Multi-Factor Authentication](multi-factor-authentication-faq.md).</span><span class="sxs-lookup"><span data-stu-id="8dda9-163">Get answers in the [Azure Multi-Factor Authentication FAQ](multi-factor-authentication-faq.md)</span></span>

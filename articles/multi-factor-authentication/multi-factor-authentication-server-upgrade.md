---
title: "Actualización de Servidores Azure MFA | Microsoft Docs"
description: "Pasos e instrucciones para actualizar el Servidor Microsoft Azure Multi-Factor Authentication a una versión más reciente."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 50bb8ac3-5559-4d8b-a96a-799a74978b14
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/16/2017
ms.author: kgremban
ms.reviewer: yossib
ms.custom: it-pro
ms.openlocfilehash: 6e4e09f8539aad56f92ad9137f4a6b9eb0d82370
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="upgrade-to-the-latest-azure-multi-factor-authentication-server"></a><span data-ttu-id="c1775-103">Actualización a la versión más reciente del Servidor Microsoft Azure Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="c1775-103">Upgrade to the latest Azure Multi-Factor Authentication Server</span></span>

<span data-ttu-id="c1775-104">Este artículo lo guiará a través del proceso de actualización de la versión 6.0 o superior del Servidor Microsoft Azure Multi-Factor Authentication (MFA).</span><span class="sxs-lookup"><span data-stu-id="c1775-104">This article walks you through the process of upgrading Azure Multi-Factor Authentication (MFA) Server v6.0 or higher.</span></span> <span data-ttu-id="c1775-105">Si necesita actualizar una versión anterior de PhoneFactor Agent, consulte [Actualización de PhoneFactor Agent al Servidor Azure Multi-Factor Authentication](multi-factor-authentication-get-started-server-upgrade.md).</span><span class="sxs-lookup"><span data-stu-id="c1775-105">If you need to upgrade an old version of the PhoneFactor Agent, refer to [Upgrade the PhoneFactor Agent to Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server-upgrade.md).</span></span>

<span data-ttu-id="c1775-106">Si va a actualizar desde la versión 6.x o anterior a la 7.x o una más reciente, todos los componentes de .NET 2.0 a .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="c1775-106">If you're upgrading from v6.x or older to v7.x or newer, all components change from .NET 2.0 to .NET 4.5.</span></span> <span data-ttu-id="c1775-107">Todos los componentes también requieren Microsoft Visual C++ 2015 Redistributable Update 1 o una versión superior.</span><span class="sxs-lookup"><span data-stu-id="c1775-107">All components also require Microsoft Visual C++ 2015 Redistributable Update 1 or higher.</span></span> <span data-ttu-id="c1775-108">El programa de instalación del Servidor MFA instalará las versiones x86 y x64 de estos componentes si no están ya instalados.</span><span class="sxs-lookup"><span data-stu-id="c1775-108">The MFA Server installer installs both the x86 and x64 versions of these components if they aren't already installed.</span></span> <span data-ttu-id="c1775-109">Si el Portal de usuarios y el servicio web de aplicación móvil se ejecutan en servidores diferentes, debe instalar los paquetes antes de actualizar los componentes.</span><span class="sxs-lookup"><span data-stu-id="c1775-109">If the User Portal and Mobile App Web Service run on separate servers, you need to install those packages before upgrading those components.</span></span> <span data-ttu-id="c1775-110">También puede buscar la última actualización de Microsoft Visual C++ 2015 Redistributable en el [Centro de descarga de Microsoft](https://www.microsoft.com/en-us/download/).</span><span class="sxs-lookup"><span data-stu-id="c1775-110">You can search for the latest Microsoft Visual C++ 2015 Redistributable update on the [Microsoft Download Center](https://www.microsoft.com/en-us/download/).</span></span> 

## <a name="install-the-latest-version-of-azure-mfa-server"></a><span data-ttu-id="c1775-111">Instalación de la versión más reciente del Servidor Azure MFA</span><span class="sxs-lookup"><span data-stu-id="c1775-111">Install the latest version of Azure MFA Server</span></span>

1. <span data-ttu-id="c1775-112">Siga las instrucciones [Descarga de Servidor Azure Multi-Factor Authentication](multi-factor-authentication-get-started-server.md#download-the-azure-multi-factor-authentication-server) para obtener la versión más reciente del Servidor Azure MFA.</span><span class="sxs-lookup"><span data-stu-id="c1775-112">Use the instructions in [Download the Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md#download-the-azure-multi-factor-authentication-server) to get the latest version of the Azure MFA Server.</span></span>
2. <span data-ttu-id="c1775-113">Realice una copia de seguridad del archivo de datos de Servidor MFA ubicado en C:\Archivos de programa\Multi-Factor Authentication Server\Data\PhoneFactor.pfdata (se da por hecho que es la ubicación de instalación predeterminada) en la instancia principal de Servidor MFA.</span><span class="sxs-lookup"><span data-stu-id="c1775-113">Make a backup of the MFA Server data file located at C:\Program Files\Multi-Factor Authentication Server\Data\PhoneFactor.pfdata (assuming the default install location) on your master MFA Server.</span></span>
3. <span data-ttu-id="c1775-114">Si ejecuta varios servidores para lograr alta disponibilidad, cambie los sistemas cliente que se autentican en el Servidor MFA para que se deje de enviar tráfico a los servidores que va a actualizar.</span><span class="sxs-lookup"><span data-stu-id="c1775-114">If you run multiple servers for high availability, change the client systems that authenticate to the MFA Server so that they stop sending traffic to the servers that are upgrading.</span></span> <span data-ttu-id="c1775-115">Si usa un equilibrador de carga, quite un Servidor MFA del equilibrador de carga, realice la actualización y vuelva a agregarlo a la granja de servidores.</span><span class="sxs-lookup"><span data-stu-id="c1775-115">If you use a load balancer, remove a MFA Server from the load balancer, do the upgrade, and then add the server back into the farm.</span></span>
4. <span data-ttu-id="c1775-116">Ejecute el programa de instalación nuevo en cada Servidor MFA.</span><span class="sxs-lookup"><span data-stu-id="c1775-116">Run the new installer on each MFA Server.</span></span> <span data-ttu-id="c1775-117">Actualice primero los servidores subordinados porque pueden leer el archivo de datos antiguo que está replicando la instancia principal.</span><span class="sxs-lookup"><span data-stu-id="c1775-117">Upgrade subordinate servers first because they can read the old data file being replicated by the master.</span></span> 

  <span data-ttu-id="c1775-118">No hay que desinstalar el Servidor MFA actual antes de ejecutar el programa de instalación,</span><span class="sxs-lookup"><span data-stu-id="c1775-118">You do not need to uninstall your current MFA Server before running the installer.</span></span> <span data-ttu-id="c1775-119">ya que este realiza una actualización local.</span><span class="sxs-lookup"><span data-stu-id="c1775-119">The installer performs an in-place upgrade.</span></span> <span data-ttu-id="c1775-120">La ruta de instalación se selecciona del Registro de la instalación anterior, por lo que se instalará en la misma ubicación (por ejemplo, C:\Archivos de programa\Multi-Factor Authentication Server).</span><span class="sxs-lookup"><span data-stu-id="c1775-120">The installation path is picked up from the registry from the previous installation, so it installs in the same location (for example, C:\Program Files\Multi-Factor Authentication Server).</span></span> 
  
5. <span data-ttu-id="c1775-121">Si se le solicita que instale un paquete de actualización de Microsoft Visual C++ 2015 Redistributable, acepte.</span><span class="sxs-lookup"><span data-stu-id="c1775-121">If you're prompted to install a Microsoft Visual C++ 2015 Redistributable update package, accept the prompt.</span></span> <span data-ttu-id="c1775-122">Se instalan las versiones x86 y x64 del paquete.</span><span class="sxs-lookup"><span data-stu-id="c1775-122">Both the x86 and x64 versions of the package are installed.</span></span>
5. <span data-ttu-id="c1775-123">Si utiliza el SDK del servicio web, deberá instalar el SDK del servicio web nuevo.</span><span class="sxs-lookup"><span data-stu-id="c1775-123">If you use the Web Service SDK, you are prompted to install the new Web Service SDK.</span></span> <span data-ttu-id="c1775-124">Cuando se instala el nuevo SDK del servicio web, asegúrese de que el nombre del directorio virtual coincide con el que se instaló (por ejemplo, MultiFactorAuthWebServiceSdk).</span><span class="sxs-lookup"><span data-stu-id="c1775-124">When you install the new Web Service SDK, make sure that the virtual directory name matches the previously installed virtual directory (for example, MultiFactorAuthWebServiceSdk).</span></span>
6. <span data-ttu-id="c1775-125">Repita los pasos en todos los servidores subordinados.</span><span class="sxs-lookup"><span data-stu-id="c1775-125">Repeat the steps on all subordinate servers.</span></span> <span data-ttu-id="c1775-126">Elija uno de los subordinados como el nuevo servidor principal; después, actualice el servidor principal antiguo.</span><span class="sxs-lookup"><span data-stu-id="c1775-126">Promote one of the subordinates to be the new master, then upgrade the old master server.</span></span> 

## <a name="upgrade-the-user-portal"></a><span data-ttu-id="c1775-127">Actualización del Portal de usuarios</span><span class="sxs-lookup"><span data-stu-id="c1775-127">Upgrade the User Portal</span></span>

1. <span data-ttu-id="c1775-128">Realice una copia de seguridad del archivo web.config que se encuentra en el directorio virtual de la ubicación de instalación del Portal de usuarios (por ejemplo, C:\inetpub\wwwroot\MultiFactorAuth).</span><span class="sxs-lookup"><span data-stu-id="c1775-128">Make a backup of the web.config file that is in the virtual directory of the User Portal installation location (for example, C:\inetpub\wwwroot\MultiFactorAuth).</span></span> <span data-ttu-id="c1775-129">Si se realizaron cambios realizados en el tema predeterminado, realice también una copia de seguridad de la carpeta App_Themes\Default.</span><span class="sxs-lookup"><span data-stu-id="c1775-129">If any changes were made to the default theme, make a backup of the App_Themes\Default folder as well.</span></span> <span data-ttu-id="c1775-130">Se recomienda crear una copia en la carpeta predeterminada y un nuevo tema en lugar de cambiar el tema predeterminado.</span><span class="sxs-lookup"><span data-stu-id="c1775-130">It is better to create a copy of the Default folder and create a new theme than to change the Default theme.</span></span>
2. <span data-ttu-id="c1775-131">Si el Portal de usuarios se ejecuta en el mismo servidor que los demás componentes del Servidor MFA, durante la instalación se le pedirá que actualice el Portal de usuarios.</span><span class="sxs-lookup"><span data-stu-id="c1775-131">If the User Portal runs on the same server as the other MFA Server components, the MFA Server installation prompts you to update the User Portal.</span></span> <span data-ttu-id="c1775-132">Acepte el mensaje e instale la actualización del Portal de usuarios.</span><span class="sxs-lookup"><span data-stu-id="c1775-132">Accept the prompt and install the User Portal update.</span></span> <span data-ttu-id="c1775-133">Asegúrese de que el nombre del directorio virtual coincide con el que se instaló (por ejemplo, MultiFactorAuth).</span><span class="sxs-lookup"><span data-stu-id="c1775-133">Check that the virtual directory name matches the previously installed virtual directory (for example, MultiFactorAuth).</span></span>
3. <span data-ttu-id="c1775-134">Si el Portal de usuarios se encuentra en su propio servidor, copie el archivo MultiFactorAuthenticationUserPortalSetup64.msi de la ubicación de instalación de uno de los Servidores MFA y colóquelo en el servidor web del Portal de usuarios.</span><span class="sxs-lookup"><span data-stu-id="c1775-134">If the User Portal is on its own server, copy the MultiFactorAuthenticationUserPortalSetup64.msi file from the install location of one of the MFA Servers and put it onto the User Portal web server.</span></span> <span data-ttu-id="c1775-135">Ejecute al programa de instalación.</span><span class="sxs-lookup"><span data-stu-id="c1775-135">Run the installer.</span></span> 

  <span data-ttu-id="c1775-136">Si se produce un error que indica que se requiere Microsoft Visual C++ 2015 Redistributable Update 1 o posterior, descargue e instale el paquete de actualización más reciente del [Centro de descarga de Microsoft](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="c1775-136">If an error occurs stating, "Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required," download and install the latest update package from the [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="c1775-137">Instale las versiones x86 y x64.</span><span class="sxs-lookup"><span data-stu-id="c1775-137">Install both the x86 and x64 versions.</span></span>

4. <span data-ttu-id="c1775-138">Después de instala el software del Portal de usuarios actualizado, compare la copia de seguridad de web.config que realizó en el paso 1 con el nuevo archivo web.config.</span><span class="sxs-lookup"><span data-stu-id="c1775-138">After the updated User Portal software is installed, compare the web.config backup you made in step 1 with the new web.config file.</span></span> <span data-ttu-id="c1775-139">Si no hay ningún atributo nuevo en el archivo web.config nuevo, copie el archivo web.config de copia de seguridad en el directorio virtual para sobrescribir el nuevo.</span><span class="sxs-lookup"><span data-stu-id="c1775-139">If no new attributes exist in the new web.config, copy your backup web.config into the virtual directory to overwrite the new one.</span></span> <span data-ttu-id="c1775-140">Otra opción consiste en copiar y pegar los valores de appSettings y la URL del SDK del servicio web desde el archivo de copia de seguridad al archivo web.config nuevo.</span><span class="sxs-lookup"><span data-stu-id="c1775-140">Another option is to copy/paste the appSettings values and the Web Service SDK URL from the backup file into the new web.config.</span></span>

<span data-ttu-id="c1775-141">Si tiene el Portal de usuarios en varios servidores, repita la instalación en todos ellos.</span><span class="sxs-lookup"><span data-stu-id="c1775-141">If you have the User Portal on multiple servers, repeat the installation on all of them.</span></span> 


## <a name="upgrade-the-mobile-app-web-service"></a><span data-ttu-id="c1775-142">Actualización del servicio web de aplicación móvil</span><span class="sxs-lookup"><span data-stu-id="c1775-142">Upgrade the Mobile App Web Service</span></span>

1. <span data-ttu-id="c1775-143">Realice una copia de seguridad del archivo web.config que se encuentra en el directorio virtual de la ubicación de instalación del servicio web de aplicación móvil (por ejemplo, C:\inetpub\wwwroot\app o C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService).</span><span class="sxs-lookup"><span data-stu-id="c1775-143">Make a backup of the web.config file that is in the virtual directory of the Mobile App Web Service installation location (for example, C:\inetpub\wwwroot\app or C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService).</span></span>
2. <span data-ttu-id="c1775-144">Copie el archivo MultiFactorAuthenticationMobileAppWebServiceSetup64.msi de la ubicación de instalación de los Servidores MFA y colóquelo en el servidor web de registro de aplicación móvil.</span><span class="sxs-lookup"><span data-stu-id="c1775-144">Copy the MultiFactorAuthenticationMobileAppWebServiceSetup64.msi file from the install location of the MFA Servers and put it onto the Mobile App registration web server.</span></span>
3. <span data-ttu-id="c1775-145">Ejecute al programa de instalación.</span><span class="sxs-lookup"><span data-stu-id="c1775-145">Run the installer.</span></span> 

  <span data-ttu-id="c1775-146">Si se produce un error que indica que se requiere Microsoft Visual C++ 2015 Redistributable Update 1 o posterior, descargue e instale el paquete de actualización más reciente del [Centro de descarga de Microsoft](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="c1775-146">If an error occurs stating that Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required, download and install the latest update package from the [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="c1775-147">Instale las versiones x86 y x64.</span><span class="sxs-lookup"><span data-stu-id="c1775-147">Install both the x86 and x64 versions.</span></span>

4. <span data-ttu-id="c1775-148">Cuando se haya instalado el software del servicio web de aplicación móvil actualizado, compare el archivo web.config que se copió en el paso 1 con el archivo web.config nuevo.</span><span class="sxs-lookup"><span data-stu-id="c1775-148">After the updated Mobile App Web Service software installs, compare the web.config file that was backed up in step 1 with the new web.config file.</span></span> <span data-ttu-id="c1775-149">Si no hay ningún atributo nuevo en el archivo web.config nuevo, puede copiar el archivo web.config guardado en el directorio virtual y sobrescribir el nuevo.</span><span class="sxs-lookup"><span data-stu-id="c1775-149">If no new attributes exist in the new web.config, you can copy your saved web.config back into the virtual directory and overwrite the new one.</span></span> <span data-ttu-id="c1775-150">Otra opción consiste en copiar y pegar los valores de appSettings y la URL del SDK del servicio web desde el archivo de copia de seguridad al archivo web.config nuevo.</span><span class="sxs-lookup"><span data-stu-id="c1775-150">Another option is to copy/paste the appSettings values and the Web Service SDK URL from the backup file into the new web.config.</span></span>

<span data-ttu-id="c1775-151">Si tiene el servicio web de aplicación móvil en varios servidores, repita la instalación en todos ellos.</span><span class="sxs-lookup"><span data-stu-id="c1775-151">If you have the Mobile App Web Service on multiple servers, repeat the installation on all of them.</span></span> 

## <a name="upgrade-the-ad-fs-adapters"></a><span data-ttu-id="c1775-152">Actualización de los adaptadores de AD FS</span><span class="sxs-lookup"><span data-stu-id="c1775-152">Upgrade the AD FS Adapters</span></span>


### <a name="if-mfa-runs-on-different-servers-than-ad-fs"></a><span data-ttu-id="c1775-153">Si MFA se ejecuta en distintos servidores de AD FS</span><span class="sxs-lookup"><span data-stu-id="c1775-153">If MFA runs on different servers than AD FS</span></span>

<span data-ttu-id="c1775-154">Estas instrucciones solo se aplican si ejecuta el Servidor Multi-Factor Authentication por separado de los servidores de AD FS.</span><span class="sxs-lookup"><span data-stu-id="c1775-154">These instructions only apply if you run Multi-Factor Authentication Server separately from your AD FS servers.</span></span> <span data-ttu-id="c1775-155">Si los dos servicios se ejecutan en los mismos servidores, pase por alto esta sección y avance a los pasos de instalación.</span><span class="sxs-lookup"><span data-stu-id="c1775-155">If both services run on the same servers, skip this section and go to the installation steps.</span></span> 

1. <span data-ttu-id="c1775-156">Guarde una copia del archivo MultiFactorAuthenticationAdfsAdapter.config que se registró en AD FS o exporte la configuración con el siguiente comando de PowerShell: `Export-AdfsAuthenticationProviderConfigurationData -Name [adapter name] -FilePath [path to config file]`.</span><span class="sxs-lookup"><span data-stu-id="c1775-156">Save a copy of the MultiFactorAuthenticationAdfsAdapter.config file that was registered in AD FS, or export the configuration using the following PowerShell command: `Export-AdfsAuthenticationProviderConfigurationData -Name [adapter name] -FilePath [path to config file]`.</span></span> <span data-ttu-id="c1775-157">El nombre del adaptador es "WindowsAzureMultiFactorAuthentication" o "AzureMfaServerAuthentication", dependiendo de la versión instalada previamente.</span><span class="sxs-lookup"><span data-stu-id="c1775-157">The adapter name is either "WindowsAzureMultiFactorAuthentication" or "AzureMfaServerAuthentication" depending on the version previously installed.</span></span>
2. <span data-ttu-id="c1775-158">Copie los siguientes archivos desde la ubicación de instalación del Servidor MFA a los servidores de AD FS:</span><span class="sxs-lookup"><span data-stu-id="c1775-158">Copy the following files from the MFA Server installation location to the AD FS servers:</span></span>

  - <span data-ttu-id="c1775-159">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span><span class="sxs-lookup"><span data-stu-id="c1775-159">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span></span>
  - <span data-ttu-id="c1775-160">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="c1775-160">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
  - <span data-ttu-id="c1775-161">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="c1775-161">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
  - <span data-ttu-id="c1775-162">MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="c1775-162">MultiFactorAuthenticationAdfsAdapter.config</span></span>

3. <span data-ttu-id="c1775-163">Edite el script Register-MultiFactorAuthenticationAdfsAdapter.ps1; para ello, agregue `-ConfigurationFilePath [path]` al final del comando `Register-AdfsAuthenticationProvider`.</span><span class="sxs-lookup"><span data-stu-id="c1775-163">Edit the Register-MultiFactorAuthenticationAdfsAdapter.ps1 script by adding `-ConfigurationFilePath [path]` to the end of the `Register-AdfsAuthenticationProvider` command.</span></span> <span data-ttu-id="c1775-164">Reemplace *[path]* por la ruta de acceso completa al archivo MultiFactorAuthenticationAdfsAdapter.config o por el archivo de configuración exportado en el paso anterior.</span><span class="sxs-lookup"><span data-stu-id="c1775-164">Replace *[path]* with the full path to the MultiFactorAuthenticationAdfsAdapter.config file or the configuration file exported in the previous step.</span></span> 

  <span data-ttu-id="c1775-165">Compruebe los atributos del nuevo archivo MultiFactorAuthenticationAdfsAdapter.config para ver si coinciden con el archivo de configuración anterior.</span><span class="sxs-lookup"><span data-stu-id="c1775-165">Check the attributes in the new MultiFactorAuthenticationAdfsAdapter.config to see if they match the old config file.</span></span> <span data-ttu-id="c1775-166">Si se han agregado o quitado atributos en la nueva versión, copie los valores de atributo del archivo de configuración antiguo en el nuevo o modifique el archivo de configuración antiguo para que coincida.</span><span class="sxs-lookup"><span data-stu-id="c1775-166">If any attributes were added or removed in the new version, copy the attribute values from the old configuration file to the new one or modify the old configuration file to match.</span></span>

### <a name="install-new-ad-fs-adapters"></a><span data-ttu-id="c1775-167">Instalación de nuevos adaptadores de AD FS</span><span class="sxs-lookup"><span data-stu-id="c1775-167">Install new AD FS adapters</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="c1775-168">Los usuarios no tendrá que realizar verificación en dos pasos durante los pasos 3-8 de esta sección.</span><span class="sxs-lookup"><span data-stu-id="c1775-168">Your users will not be required to perform two-step verification during steps 3-8 of this section.</span></span> <span data-ttu-id="c1775-169">Si ha configurado AD FS en varios clústeres, puede quitar, actualizar y restaurar cada clúster de la granja de servidores, independientemente de los otros, para evitar tiempos de inactividad.</span><span class="sxs-lookup"><span data-stu-id="c1775-169">If you have AD FS configured in multiple clusters, you can remove, upgrade, and restore each cluster in the farm independently of the other clusters to avoid downtime.</span></span>

1. <span data-ttu-id="c1775-170">Quite algunos servidores de AD FS de la granja de servidores.</span><span class="sxs-lookup"><span data-stu-id="c1775-170">Remove some AD FS servers from the farm.</span></span> <span data-ttu-id="c1775-171">Actualice estos servidores mientras los otros sigan ejecutándose.</span><span class="sxs-lookup"><span data-stu-id="c1775-171">Update these servers while the others are still running.</span></span>
2. <span data-ttu-id="c1775-172">Instale al nuevo adaptador de AD FS en cada servidor quitado de la granja de servidores de AD FS.</span><span class="sxs-lookup"><span data-stu-id="c1775-172">Install the new AD FS adapter on each server removed from the AD FS farm.</span></span> <span data-ttu-id="c1775-173">Si el Servidor MFA está instalado en cada servidor de AD FS, puede actualizar con la experiencia de usuario de administrador del Servidor MFS.</span><span class="sxs-lookup"><span data-stu-id="c1775-173">If the MFA Server is installed on each AD FS server, you can update through the MFA Server admin UX.</span></span> <span data-ttu-id="c1775-174">En caso contrario, actualice ejecutando MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span><span class="sxs-lookup"><span data-stu-id="c1775-174">Otherwise, update by running MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span></span> 

  <span data-ttu-id="c1775-175">Si se produce un error que indica que se requiere Microsoft Visual C++ 2015 Redistributable Update 1 o posterior, descargue e instale el paquete de actualización más reciente del [Centro de descarga de Microsoft](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="c1775-175">If an error occurs stating, "Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required," download and install the latest update package from the [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="c1775-176">Instale las versiones x86 y x64.</span><span class="sxs-lookup"><span data-stu-id="c1775-176">Install both the x86 and x64 versions.</span></span>

3. <span data-ttu-id="c1775-177">Vaya a **AD FS** > **Directivas de autenticación** > **Editar directiva de autenticación multifactor global**.</span><span class="sxs-lookup"><span data-stu-id="c1775-177">Go to **AD FS** > **Authentication Policies** > **Edit Global MultiFactor Authentication Policy**.</span></span> <span data-ttu-id="c1775-178">Desactive **WindowsAzureMultiFactorAuthentication** o **AzureMFAServerAuthentication** (en función de la versión actual instalada).</span><span class="sxs-lookup"><span data-stu-id="c1775-178">Uncheck **WindowsAzureMultiFactorAuthentication** or **AzureMFAServerAuthentication** (depending on the current version installed).</span></span> 

  <span data-ttu-id="c1775-179">Una vez completado este paso, la verificación en dos pasos a través del Servidor MFA no estará disponible en este clúster de AD FS hasta que finalice el paso 8.</span><span class="sxs-lookup"><span data-stu-id="c1775-179">Once this step is complete, two-step verification through MFA Server is not available in this AD FS cluster until you complete step 8.</span></span>

4. <span data-ttu-id="c1775-180">Anule el registro de la versión anterior del adaptador de AD FS ejecutando el script de PowerShell Unregister-MultiFactorAuthenticationAdfsAdapter.ps1.</span><span class="sxs-lookup"><span data-stu-id="c1775-180">Unregister the older version of the AD FS adapter by running the Unregister-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell script.</span></span> <span data-ttu-id="c1775-181">Asegúrese de que el parámetro *-Name* ("WindowsAzureMultiFactorAuthentication" o "AzureMFAServerAuthentication") coincide con el nombre que aparecía en el paso 3.</span><span class="sxs-lookup"><span data-stu-id="c1775-181">Ensure that the *-Name* parameter (either “WindowsAzureMultiFactorAuthentication” or "AzureMFAServerAuthentication") matches the name that was displayed in step 3.</span></span> <span data-ttu-id="c1775-182">Esto se aplica a todos los servidores del mismo clúster de AD FS porque no hay una configuración central.</span><span class="sxs-lookup"><span data-stu-id="c1775-182">This applies to all servers in the same AD FS cluster since there is a central configuration.</span></span>
5. <span data-ttu-id="c1775-183">Registre el nuevo adaptador de AD FS ejecutando el script de PowerShell Register-MultiFactorAuthenticationAdfsAdapter.ps1 para registrar el nuevo adaptador de AD FS.</span><span class="sxs-lookup"><span data-stu-id="c1775-183">Register the new AD FS adapter by running the Register-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell script.</span></span> <span data-ttu-id="c1775-184">Esto se aplica a todos los servidores del mismo clúster de AD FS porque no hay una configuración central.</span><span class="sxs-lookup"><span data-stu-id="c1775-184">This applies to all servers in the same AD FS cluster since there is a central configuration.</span></span>
6. <span data-ttu-id="c1775-185">Reinicie el servicio de AD FS en cada servidor que se quitó de la granja de servidores de AD FS.</span><span class="sxs-lookup"><span data-stu-id="c1775-185">Restart the AD FS service on each server removed from the AD FS farm.</span></span>
7. <span data-ttu-id="c1775-186">Vuelva a agregar los servidores actualizados a la granja de servidores de AD FS y quite los otros.</span><span class="sxs-lookup"><span data-stu-id="c1775-186">Add the updated servers back to the AD FS farm and remove the other servers from the farm.</span></span>
8. <span data-ttu-id="c1775-187">Vaya a **AD FS** > **Directivas de autenticación** > **Editar directiva de autenticación multifactor global**.</span><span class="sxs-lookup"><span data-stu-id="c1775-187">Go to **AD FS** > **Authentication Policies** > **Edit Global MultiFactor Authentication Policy**.</span></span> <span data-ttu-id="c1775-188">Active **AzureMfaServerAuthentication**.</span><span class="sxs-lookup"><span data-stu-id="c1775-188">Check **AzureMfaServerAuthentication**.</span></span>
9. <span data-ttu-id="c1775-189">Repita el paso 2 para actualizar los servidores ya quitados de la granja de servidores de AD FS y reinicie el servicio de AD FS en esos servidores.</span><span class="sxs-lookup"><span data-stu-id="c1775-189">Repeat step 2 to update the servers now removed from the AD FS farm and restart the AD FS service on those servers.</span></span>
10. <span data-ttu-id="c1775-190">Vuelva a agregar los servidores a la granja de servidores de AD FS.</span><span class="sxs-lookup"><span data-stu-id="c1775-190">Add those servers back into the AD FS farm.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c1775-191">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="c1775-191">Next steps</span></span>

- <span data-ttu-id="c1775-192">Ejemplos de [escenarios avanzados con Azure Multi-Factor Authentication y VPN de terceros](multi-factor-authentication-advanced-vpn-configurations.md)</span><span class="sxs-lookup"><span data-stu-id="c1775-192">Get examples of [Advanced scenarios with Azure Multi-Factor Authentication and third-party VPNs](multi-factor-authentication-advanced-vpn-configurations.md)</span></span>

- [<span data-ttu-id="c1775-193">Sincronización de Servidores MFA con Windows Server Active Directory</span><span class="sxs-lookup"><span data-stu-id="c1775-193">Synchronize MFA Server with Windows Server Active Directory</span></span>](multi-factor-authentication-get-started-server-dirint.md)

- <span data-ttu-id="c1775-194">[Configuración de la autenticación de Windows](multi-factor-authentication-get-started-server-windows.md) para sus aplicaciones</span><span class="sxs-lookup"><span data-stu-id="c1775-194">[Configure Windows Authentication](multi-factor-authentication-get-started-server-windows.md) for your applications</span></span>

---
title: aaaConfigure servidor Azure MFA para lograr alta disponibilidad | Documentos de Microsoft
description: Implemente varias instancias del Servidor Microsoft Azure Multi-Factor Authentication en configuraciones que proporcionan alta disponibilidad.
services: multi-factor-authentication
keywords: Azure MFA
documentationcenter: 
author: MicrosoftGuyJFlo
manager: femila
ms.assetid: 
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/23/2017
ms.author: joflore
ms.reviewer: alexwe
ms.custom: it-pro
ms.openlocfilehash: 8c6b1921c734c7a7273e443b3591fbbb15cd5e6c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="configure-azure-multi-factor-authentication-server-for-high-availability"></a><span data-ttu-id="d0cc3-104">Configuración del Servidor Microsoft Azure Multi-Factor Authentication para la alta disponibilidad</span><span class="sxs-lookup"><span data-stu-id="d0cc3-104">Configure Azure Multi-Factor Authentication Server for high availability</span></span>

<span data-ttu-id="d0cc3-105">tooachieve alta disponibilidad con la implementación de servidor de Azure MFA, necesita toodeploy varios servidores MFA.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-105">tooachieve high-availability with your Azure Server MFA deployment, you need toodeploy multiple MFA servers.</span></span> <span data-ttu-id="d0cc3-106">Esta sección proporciona información sobre un diseño de equilibrio de carga tooachieve los objetivos de alta disponibilidad en el que la implementación de servidor de Azure MFS.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-106">This section provides information on a load-balanced design tooachieve your high availability targets in you Azure MFS Server deployment.</span></span>

## <a name="mfa-server-overview"></a><span data-ttu-id="d0cc3-107">Introducción al Servidor MFA</span><span class="sxs-lookup"><span data-stu-id="d0cc3-107">MFA Server overview</span></span>

<span data-ttu-id="d0cc3-108">Hola arquitectura del servicio servidor de MFA de Azure consta de varios componentes como se muestra en hello siguiente diagrama:</span><span class="sxs-lookup"><span data-stu-id="d0cc3-108">hello Azure MFA Server service architecture comprises several components as shown in hello following diagram:</span></span>

 ![Arquitectura del Servidor MFA](./media/mfa-server-high-availability/mfa-ha-architecture.png)

<span data-ttu-id="d0cc3-110">Un servidor de MFA es un servidor de Windows que tenga instalado el software de la autenticación multifactor Azure Hola.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-110">An MFA Server is a Windows Server that has hello Azure Multi-Factor Authentication software installed.</span></span> <span data-ttu-id="d0cc3-111">instancia del servidor de MFA de Hello debe activarse Hola servicio MFA en Azure toofunction.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-111">hello MFA Server instance must be activated by hello MFA Service in Azure toofunction.</span></span> <span data-ttu-id="d0cc3-112">Se puede instalar más de una instancia del Servidor MFA en el entorno local.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-112">More than one MFA Server can be installed on-premises.</span></span>

<span data-ttu-id="d0cc3-113">Hola es el primer servidor de MFA que se instala Hola servidor MFA principal tras la activación por hello servicio MFA de Azure de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-113">hello first MFA Server that is installed is hello master MFA Server upon activation by hello Azure MFA Service by default.</span></span> <span data-ttu-id="d0cc3-114">servidor MFA maestro de Hello tiene una copia de escritura de base de datos de hello PhoneFactor.pfdata.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-114">hello master MFA server has a writeable copy of hello PhoneFactor.pfdata database.</span></span> <span data-ttu-id="d0cc3-115">Las instalaciones posteriores de instancias del Servidor MFA se conocen como subordinadas.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-115">Subsequent installations of instances of MFA Server are known as slaves.</span></span> <span data-ttu-id="d0cc3-116">esclavos MFA de Hello tienen una copia replicada de solo lectura de base de datos de hello PhoneFactor.pfdata.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-116">hello MFA slaves have a replicated read-only copy of hello PhoneFactor.pfdata database.</span></span> <span data-ttu-id="d0cc3-117">Las instancias del Servidor MFA replican información mediante la llamada a procedimiento remoto (RPC).</span><span class="sxs-lookup"><span data-stu-id="d0cc3-117">MFA servers replicate information using Remote Procedure Call (RPC).</span></span> <span data-ttu-id="d0cc3-118">Todos los servidores de MFA deben colectivamente ser Unidos a un dominio o información de tooreplicate independiente.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-118">All MFA Severs must collectively either be domain joined or standalone tooreplicate information.</span></span>

<span data-ttu-id="d0cc3-119">MFA maestro y subordinado servidores MFA que comunican Hola servicio MFA cuando se requiere autenticación de dos factores.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-119">Both MFA master and slave MFA Servers communicate with hello MFA Service when two-factor authentication is required.</span></span> <span data-ttu-id="d0cc3-120">Por ejemplo, cuando un usuario intenta aplicación tooan de toogain access que requiere autenticación en dos fases, usuario Hola se autenticarán en primer lugar por un proveedor de identidad, como Active Directory (AD).</span><span class="sxs-lookup"><span data-stu-id="d0cc3-120">For example, when a user attempts toogain access tooan application that requires two-factor authentication, hello user will first be authenticated by an identity provider, such as Active Directory (AD).</span></span>

<span data-ttu-id="d0cc3-121">Tras la autenticación correcta con AD, Hola servidor MFA se comunicará con hello servicio MFA.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-121">After successful authentication with AD, hello MFA Server will communicate with hello MFA Service.</span></span> <span data-ttu-id="d0cc3-122">Hola servidor MFA espera para recibir la notificación Hola servicio MFA tooallow o denegar la aplicación de toohello de acceso de usuario de hello.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-122">hello MFA Server waits for notification from hello MFA Service tooallow or deny hello user access toohello application.</span></span>

<span data-ttu-id="d0cc3-123">Si el servidor maestro de hello MFA se queda sin conexión, las autenticaciones todavía pueden ser procesadas, pero no se puede procesar las operaciones que requieren la base de datos de cambios toohello MFA.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-123">If hello MFA master server goes offline, authentications can still be processed, but operations that require changes toohello MFA database cannot be processed.</span></span> <span data-ttu-id="d0cc3-124">(Algunos ejemplos son: Hola adición de usuarios, autoservicio cambios de PIN y cambiar la información de usuario)</span><span class="sxs-lookup"><span data-stu-id="d0cc3-124">(Examples include: hello addition of users, self-service PIN changes, and changing user information)</span></span>

## <a name="deployment"></a><span data-ttu-id="d0cc3-125">Implementación</span><span class="sxs-lookup"><span data-stu-id="d0cc3-125">Deployment</span></span>

<span data-ttu-id="d0cc3-126">Considere la posibilidad de hello siguientes puntos son importantes para el servidor de MFA de Azure y sus componentes relacionados de equilibrio de carga.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-126">Consider hello following important points for load balancing Azure MFA Server and its related components.</span></span>

* <span data-ttu-id="d0cc3-127">**Con alta disponibilidad RADIUS estándar tooachieve**.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-127">**Using RADIUS standard tooachieve high availability**.</span></span> <span data-ttu-id="d0cc3-128">Si usa instancias del Servidor Azure MFA como servidores RADIUS, puede configurar un Servidor MFA como un destino de autenticación de RADIUS principal y otras instancias del Servidor Azure MFA como destinos de autenticación secundarios.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-128">If you are using Azure MFA Servers as RADIUS servers, you can potentially configure one MFA Server as a primary RADIUS authentication target and other Azure MFA Servers as secondary authentication targets.</span></span> <span data-ttu-id="d0cc3-129">Sin embargo, esta disponibilidad alta de método tooachieve puede no resultar práctica porque debe esperar un toooccur de período de tiempo de espera si falla la autenticación en el destino de autenticación principal Hola antes de que se pueda autenticar con la autenticación secundaria Hola destino.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-129">However, this method tooachieve high availability may not be practical because you must wait for a time-out period toooccur when authentication fails on hello primary authentication target before you can be authenticated against hello secondary authentication target.</span></span> <span data-ttu-id="d0cc3-130">Resulta más eficaz tooload saldo Hola RADIUS del tráfico entre el cliente RADIUS de Hola y servidores RADIUS de hello (en este caso, hello Azure MFA servidores que actúan como servidores RADIUS) para que pueda configurar los clientes RADIUS de hello con una sola dirección URL que señalan a.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-130">It is more efficient tooload balance hello RADIUS traffic between hello RADIUS client and hello RADIUS Servers (in this case, hello Azure MFA Servers acting as RADIUS servers) so that you can configure hello RADIUS clients with a single URL that they can point to.</span></span>
* <span data-ttu-id="d0cc3-131">**Necesita toomanually promover esclavos MFA**.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-131">**Need toomanually promote MFA slaves**.</span></span> <span data-ttu-id="d0cc3-132">Si el servidor principal de Azure MFA de Hola se queda sin conexión, hello Azure MFA servidores secundarios continúan tooprocess MFA solicitudes.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-132">If hello master Azure MFA server goes offline, hello secondary Azure MFA Servers continue tooprocess MFA requests.</span></span> <span data-ttu-id="d0cc3-133">Sin embargo, hasta que un servidor maestro de MFA está disponible, administradores no pueden agregar usuarios o modificar la configuración de MFA, y los usuarios no pueden realizar cambios mediante el portal de usuarios de Hola.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-133">However, until a master MFA server is available, admins can not add users or modify MFA settings, and users can not make changes using hello user portal.</span></span> <span data-ttu-id="d0cc3-134">Promoción de una función de maestro de MFA esclavo toohello siempre es un proceso manual.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-134">Promoting an MFA slave toohello master role is always a manual process.</span></span>
* <span data-ttu-id="d0cc3-135">**Separación de los componentes**.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-135">**Separability of components**.</span></span> <span data-ttu-id="d0cc3-136">Hola servidor MFA de Azure consta de varios componentes que se pueden instalar en Hola misma instancia del servidor de Windows o en varias instancias.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-136">hello Azure MFA Server comprises several components that can be installed on hello same Windows Server instance or on different instances.</span></span> <span data-ttu-id="d0cc3-137">Estos componentes incluyen hello Portal de usuarios, el servicio Web de aplicación móvil y el adaptador de AD FS hello (agente).</span><span class="sxs-lookup"><span data-stu-id="d0cc3-137">These components include hello User Portal, Mobile App Web Service, and hello ADFS adapter (agent).</span></span> <span data-ttu-id="d0cc3-138">Esta cláusula de salvedad hace posible toouse Hola Proxy de aplicación Web toopublish Hola Portal de usuarios móviles servidor y aplicación Web desde la red perimetral de Hola.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-138">This separability makes it possible toouse hello Web Application Proxy toopublish hello User Portal and Mobile App Web Server from hello perimeter network.</span></span> <span data-ttu-id="d0cc3-139">Este tipo de configuración agrega toohello seguridad global del diseño, como se muestra en hello siguiente diagrama.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-139">Such a configuration adds toohello overall security of your design, as shown in hello following diagram.</span></span> <span data-ttu-id="d0cc3-140">Hola Portal de usuarios de MFA y el servidor de Web de aplicación móvil también pueden implementarse en configuraciones de alta disponibilidad con equilibrio de carga</span><span class="sxs-lookup"><span data-stu-id="d0cc3-140">hello MFA User Portal and Mobile App Web Server may also be deployed in HA load-balanced configurations.</span></span>

   ![Servidor MFA con una red perimetral](./media/mfa-server-high-availability/mfasecurity.png)

* <span data-ttu-id="d0cc3-142">**Contraseña temporal (OTP) a través de SMS (también conocido como SMS unidireccionales) requiere el uso de Hola de sesiones permanentes si es de tráfico con equilibrio de carga**.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-142">**One-time password (OTP) over SMS (aka one-way SMS) requires hello use of sticky sessions if traffic is load-balanced**.</span></span> <span data-ttu-id="d0cc3-143">SMS unidireccional es una opción de autenticación que provoca que los usuarios de Hola de hello servidor MFA toosend un mensaje de texto que contiene una OTP.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-143">One-way SMS is an authentication option that causes hello MFA Server toosend hello users a text message containing an OTP.</span></span> <span data-ttu-id="d0cc3-144">usuario de Hello escribe Hola OTP en un hello toocomplete de ventana de símbolo del sistema desafío MFA.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-144">hello user enters hello OTP in a prompt window toocomplete hello MFA challenge.</span></span> <span data-ttu-id="d0cc3-145">Si los servidores de MFA de Azure equilibra la carga, hello mismo servidor que atienden solicitudes de autenticación inicial de hello debe ser Hola servidor que recibe el mensaje de bienvenida de OTP de usuario Hola; Si otro servidor MFA recibe Hola respuesta OTP, se produce un error de desafío de autenticación de Hola.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-145">If you load balance Azure MFA Servers, hello same server that served hello initial authentication request must be hello server that receives hello OTP message from hello user; if another MFA Server receives hello OTP reply, hello authentication challenge fails.</span></span> <span data-ttu-id="d0cc3-146">Para obtener más información, consulte [contraseña temporal a través de SMS agrega tooAzure servidor MFA](https://blogs.technet.microsoft.com/enterprisemobility/2015/03/02/one-time-password-over-sms-added-to-azure-mfa-server).</span><span class="sxs-lookup"><span data-stu-id="d0cc3-146">For more information, see [One Time Password over SMS Added tooAzure MFA Server](https://blogs.technet.microsoft.com/enterprisemobility/2015/03/02/one-time-password-over-sms-added-to-azure-mfa-server).</span></span>
* <span data-ttu-id="d0cc3-147">**Las implementaciones de equilibrio de carga del Portal de usuarios de Hola y de servicio de la aplicación Web móvil requieren sesiones permanentes**.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-147">**Load-Balanced deployments of hello User Portal and Mobile App Web Service require sticky sessions**.</span></span> <span data-ttu-id="d0cc3-148">Si es el equilibrio de carga Hola Portal de usuarios de MFA y Hola servicio de Web de aplicación móvil, cada sesión debe toostay en hello mismo servidor.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-148">If you are load-balancing hello MFA User Portal and hello Mobile App Web Service, each session needs toostay on hello same server.</span></span>

## <a name="high-availability-deployment"></a><span data-ttu-id="d0cc3-149">Implementación de alta disponibilidad</span><span class="sxs-lookup"><span data-stu-id="d0cc3-149">High-availability deployment</span></span>

<span data-ttu-id="d0cc3-150">Hello siguiente diagrama muestra una implementación de equilibrio de carga de alta disponibilidad completa de MFA de Azure y sus componentes, junto con ADFS como referencia.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-150">hello following diagram shows a complete HA load-balanced implementation of Azure MFA and its components, along with ADFS for reference.</span></span>

 ![Implementación de alta disponibilidad del Servidor Azure MFA](./media/mfa-server-high-availability/mfa-ha-deployment.png)

<span data-ttu-id="d0cc3-152">Tenga en cuenta Hola siguientes elementos para el área de hello numerado según corresponda de hello anterior diagrama.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-152">Note hello following items for hello correspondingly numbered area of hello preceding diagram.</span></span>

1. <span data-ttu-id="d0cc3-153">Hola son dos servidores de MFA de Azure (MFA1 y MFA2) (mfaapp.contoso.com) con equilibrio de carga y está configurado toouse una base de datos de puerto estático (4443) tooreplicate hello PhoneFactor.pfdata.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-153">hello two Azure MFA Servers (MFA1 and MFA2) are load balanced (mfaapp.contoso.com) and are configured toouse a static port (4443) tooreplicate hello PhoneFactor.pfdata database.</span></span> <span data-ttu-id="d0cc3-154">Hola SDK del servicio Web está instalado en cada uno de comunicación de hello servidor MFA tooenable en el puerto TCP 443 con servidores ADFS de Hola.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-154">hello Web Service SDK is installed on each of hello MFA Server tooenable communication over TCP port 443 with hello ADFS servers.</span></span> <span data-ttu-id="d0cc3-155">servidores MFA de Hola se implementan en una configuración con equilibrio de carga sin estado.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-155">hello MFA servers are deployed in a stateless load-balanced configuration.</span></span> <span data-ttu-id="d0cc3-156">Sin embargo, si deseara toouse OTP a través de SMS, debe usar el equilibrio de carga con estado.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-156">However, if you wanted toouse OTP over SMS, you must use stateful load balancing.</span></span>
   <span data-ttu-id="d0cc3-157">![Servidor Azure MFA: alta disponibilidad del servidor de aplicaciones](./media/mfa-server-high-availability/mfaapp.png)</span><span class="sxs-lookup"><span data-stu-id="d0cc3-157">![Azure MFA Server - App server HA](./media/mfa-server-high-availability/mfaapp.png)</span></span>

   > [!NOTE]
   > <span data-ttu-id="d0cc3-158">Dado que utiliza puertos dinámicos de RPC, no se recomienda firewalls tooopen seguridad toohello intervalo de puertos dinámicos que potencialmente pueden usar RPC.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-158">Because RPC uses dynamic ports, it is not recommended tooopen firewalls up toohello range of dynamic ports that RPC can potentially use.</span></span> <span data-ttu-id="d0cc3-159">Si tiene un firewall **entre** los servidores de aplicaciones de MFA, debe configurar Hola servidor MFA toocommunicate en un puerto estático para el tráfico de replicación Hola entre servidores esclavo y maestro y abrir ese puerto en el firewall.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-159">If you have a firewall **between** your MFA application servers, you should configure hello MFA Server toocommunicate on a static port for hello replication traffic between slave and master servers and open that port on your firewall.</span></span> <span data-ttu-id="d0cc3-160">Puede forzar el puerto estático de hello mediante la creación de un valor de Registro DWORD en ```HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Positive Networks\PhoneFactor``` denominado ```Pfsvc_ncan_ip_tcp_port``` y establecer valor de hello tooan puerto disponible.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-160">You can force hello static port by creating a DWORD registry value at ```HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Positive Networks\PhoneFactor``` called ```Pfsvc_ncan_ip_tcp_port``` and setting hello value tooan available static port.</span></span> <span data-ttu-id="d0cc3-161">Las conexiones se inicien siempre maestro de hello esclavo servidores MFA toohello, puerto estático de hello solo es necesario en el patrón de hello, pero puesto que puede promocionar a un patrón de hello toobe esclavo en cualquier momento, debe establecer puerto estático de hello en todos los servidores de MFA.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-161">Connections are always initiated by hello slave MFA Servers toohello master, hello static port is only required on hello master, but since you can promote a slave toobe hello master at any time, you should set hello static port on all MFA Servers.</span></span>

2. <span data-ttu-id="d0cc3-162">Hola dos de los servidores de aplicación móvil MFA del Portal de usuario (MFA-UP-MAS1 y MFA-UP-MAS2) son equilibrada de carga en un **stateful** configuración (mfa.contoso.com).</span><span class="sxs-lookup"><span data-stu-id="d0cc3-162">hello two User Portal/MFA Mobile App servers (MFA-UP-MAS1 and MFA-UP-MAS2) are load balanced in a **stateful** configuration (mfa.contoso.com).</span></span> <span data-ttu-id="d0cc3-163">Recuerde que las sesiones permanentes son un requisito para equilibrio de carga Hola Portal de usuarios de MFA y el servicio de aplicación móvil.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-163">Recall that sticky sessions are a requirement for load balancing hello MFA User Portal and Mobile App Service.</span></span>
   <span data-ttu-id="d0cc3-164">![Servidor Azure MFA: alta disponibilidad del servicio de aplicación móvil y del Portal de usuarios](./media/mfa-server-high-availability/mfaportal.png)</span><span class="sxs-lookup"><span data-stu-id="d0cc3-164">![Azure MFA Server - User Portal and Mobile App Service HA](./media/mfa-server-high-availability/mfaportal.png)</span></span>
3. <span data-ttu-id="d0cc3-165">granja de servidores de AD FS de Hello es equilibrio de carga y publicado toohello Internet a través de servidores proxy ADFS con equilibrio de carga en la red perimetral de Hola.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-165">hello ADFS Server farm is load balanced and published toohello Internet through load-balanced ADFS proxies in hello perimeter network.</span></span> <span data-ttu-id="d0cc3-166">Cada servidor de AD FS usa Hola ADFS agente toocommunicate con hello servidores de MFA de Azure con una URL única con equilibrio de carga (mfaapp.contoso.com) en el puerto TCP 443.</span><span class="sxs-lookup"><span data-stu-id="d0cc3-166">Each ADFS Server uses hello ADFS agent toocommunicate with hello Azure MFA Servers using a single load-balanced URL (mfaapp.contoso.com) over TCP port 443.</span></span>

## <a name="next-steps"></a><span data-ttu-id="d0cc3-167">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="d0cc3-167">Next steps</span></span>

* [<span data-ttu-id="d0cc3-168">Instalación y configuración del Servidor Azure MFA</span><span class="sxs-lookup"><span data-stu-id="d0cc3-168">Install and configure Azure MFA Server</span></span>](multi-factor-authentication-get-started-server.md)

---
title: "Introducción a Azure Key Vault | Microsoft Docs"
description: "Use este tutorial para empezar a trabajar con el Almacén de claves de Azure para crear un contenedor reforzado en Azure en el que almacenar y administrar las claves criptográficas y los secretos en Azure."
services: key-vault
documentationcenter: 
author: cabailey
manager: mbaldwin
tags: azure-resource-manager
ms.assetid: 36721e1d-38b8-4a15-ba6f-14ed5be4de79
ms.service: key-vault
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: hero-article
ms.date: 07/19/2017
ms.author: cabailey
ms.openlocfilehash: 0299d931c5bf21775b68069afaa106279270226a
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/03/2017
---
# <a name="get-started-with-azure-key-vault"></a><span data-ttu-id="db509-103">Introducción al Almacén de claves de Azure</span><span class="sxs-lookup"><span data-stu-id="db509-103">Get started with Azure Key Vault</span></span>
<span data-ttu-id="db509-104">Almacén de claves de Azure está disponible en la mayoría de las regiones.</span><span class="sxs-lookup"><span data-stu-id="db509-104">Azure Key Vault is available in most regions.</span></span> <span data-ttu-id="db509-105">Para obtener más información, consulte la [página de precios del Almacén de claves](https://azure.microsoft.com/pricing/details/key-vault/).</span><span class="sxs-lookup"><span data-stu-id="db509-105">For more information, see the [Key Vault pricing page](https://azure.microsoft.com/pricing/details/key-vault/).</span></span>

## <a name="introduction"></a><span data-ttu-id="db509-106">Introducción</span><span class="sxs-lookup"><span data-stu-id="db509-106">Introduction</span></span>
<span data-ttu-id="db509-107">Use este tutorial para empezar a trabajar con el Almacén de claves de Azure para crear un contenedor (un almacén) reforzado en Azure en el que almacenar y administrar las claves criptográficas y los secretos en Azure.</span><span class="sxs-lookup"><span data-stu-id="db509-107">Use this tutorial to help you get started with Azure Key Vault to create a hardened container (a vault) in Azure, to store and manage cryptographic keys and secrets in Azure.</span></span> <span data-ttu-id="db509-108">Describe cómo usar Azure PowerShell para crear un almacén que contiene una clave o una contraseña que se puede usar con una aplicación de Azure.</span><span class="sxs-lookup"><span data-stu-id="db509-108">It walks you through the process of using Azure PowerShell to create a vault that contains a key or password that you can then use with an Azure application.</span></span> <span data-ttu-id="db509-109">A continuación, se explica cómo usa una aplicación esa clave o contraseña.</span><span class="sxs-lookup"><span data-stu-id="db509-109">It then shows you how an application can use that key or password.</span></span>

<span data-ttu-id="db509-110">**Tiempo estimado para completar el tutorial:** 20 minutos</span><span class="sxs-lookup"><span data-stu-id="db509-110">**Estimated time to complete:** 20 minutes</span></span>

> [!NOTE]
> <span data-ttu-id="db509-111">Este tutorial no incluye instrucciones sobre cómo escribir la aplicación de Azure incluida en uno de los pasos, concretamente cómo autorizar a una aplicación para que use una clave o un secreto de Key Vault.</span><span class="sxs-lookup"><span data-stu-id="db509-111">This tutorial does not include instructions for how to write the Azure application that one of the steps includes, namely how to authorize an application to use a key or secret in the key vault.</span></span>
>
> <span data-ttu-id="db509-112">En este tutorial se usa Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="db509-112">This tutorial uses Azure PowerShell.</span></span> <span data-ttu-id="db509-113">Para obtener instrucciones acerca de la interfaz de la línea de comandos para todas las plataformas, consulte [este tutorial equivalente](key-vault-manage-with-cli2.md).</span><span class="sxs-lookup"><span data-stu-id="db509-113">For Cross-Platform Command-Line Interface instructions, see [this equivalent tutorial](key-vault-manage-with-cli2.md).</span></span>
>
>

<span data-ttu-id="db509-114">Para obtener información general sobre el Almacén de claves de Azure, consulte [¿Qué es el Almacén de clave de Azure?](key-vault-whatis.md)</span><span class="sxs-lookup"><span data-stu-id="db509-114">For overview information about Azure Key Vault, see [What is Azure Key Vault?](key-vault-whatis.md)</span></span>

## <a name="prerequisites"></a><span data-ttu-id="db509-115">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="db509-115">Prerequisites</span></span>
<span data-ttu-id="db509-116">Para realizar este tutorial, necesitará lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="db509-116">To complete this tutorial, you must have the following:</span></span>

* <span data-ttu-id="db509-117">Una suscripción a Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="db509-117">A subscription to Microsoft Azure.</span></span> <span data-ttu-id="db509-118">Si no tiene, puede registrarse para obtener una [cuenta gratis](https://azure.microsoft.com/pricing/free-trial/).</span><span class="sxs-lookup"><span data-stu-id="db509-118">If you do not have one, you can sign up for a [free account](https://azure.microsoft.com/pricing/free-trial/).</span></span>
* <span data-ttu-id="db509-119">Azure PowerShell, **versión mínima: 1.1.0**.</span><span class="sxs-lookup"><span data-stu-id="db509-119">Azure PowerShell, **minimum version of 1.1.0**.</span></span> <span data-ttu-id="db509-120">Para instalar Azure PowerShell y asociarlo con una suscripción de Azure, consulte [Instalación y configuración de Azure PowerShell](/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="db509-120">To install Azure PowerShell and associate it with your Azure subscription, see [How to install and configure Azure PowerShell](/powershell/azure/overview).</span></span> <span data-ttu-id="db509-121">Si ya instaló Azure PowerShell y no sabe la versión, en la consola de Azure PowerShell, escriba `(Get-Module azure -ListAvailable).Version`.</span><span class="sxs-lookup"><span data-stu-id="db509-121">If you have already installed Azure PowerShell and do not know the version, from the Azure PowerShell console, type `(Get-Module azure -ListAvailable).Version`.</span></span> <span data-ttu-id="db509-122">Si tiene Azure PowerShell versiones 0.9.1 a 0.9.8 instalado, también puede usar este tutorial con algunos cambios menores.</span><span class="sxs-lookup"><span data-stu-id="db509-122">When you have Azure PowerShell version 0.9.1 through 0.9.8 installed, you can still use this tutorial with some minor changes.</span></span> <span data-ttu-id="db509-123">Por ejemplo, debe usar el comando `Switch-AzureMode AzureResourceManager` y algunos de los comandos de Almacén de claves de Azure que cambiaron.</span><span class="sxs-lookup"><span data-stu-id="db509-123">For example, you must use the `Switch-AzureMode AzureResourceManager` command and some of the Azure Key Vault commands have changed.</span></span> <span data-ttu-id="db509-124">Para ver una lista de los cmdlets de Key Vault para las versiones 0.9.1 a 0.9.8, consulte [Azure Key Vault Cmdlets](/powershell/module/azurerm.keyvault/#key_vault) (Cmdlets de Azure Key Vault).</span><span class="sxs-lookup"><span data-stu-id="db509-124">For a list of the Key Vault cmdlets for versions 0.9.1 through 0.9.8, see [Azure Key Vault Cmdlets](/powershell/module/azurerm.keyvault/#key_vault).</span></span>
* <span data-ttu-id="db509-125">Una aplicación que se configurará para utilizar la clave o contraseña creada en este tutorial.</span><span class="sxs-lookup"><span data-stu-id="db509-125">An application that will be configured to use the key or password that you create in this tutorial.</span></span> <span data-ttu-id="db509-126">Hay una aplicación de ejemplo disponible en el [Centro de descarga de Microsoft](http://www.microsoft.com/en-us/download/details.aspx?id=45343).</span><span class="sxs-lookup"><span data-stu-id="db509-126">A sample application is available from the [Microsoft Download Center](http://www.microsoft.com/en-us/download/details.aspx?id=45343).</span></span> <span data-ttu-id="db509-127">Para obtener instrucciones, consulte el archivo Léame adjunto.</span><span class="sxs-lookup"><span data-stu-id="db509-127">For instructions, see the accompanying Readme file.</span></span>

<span data-ttu-id="db509-128">Este tutorial está diseñado para usuarios principiantes de Azure PowerShell, pero se presupone que conocen conceptos básicos tales como módulos, cmdlets y sesiones.</span><span class="sxs-lookup"><span data-stu-id="db509-128">This tutorial is designed for Azure PowerShell beginners, but it assumes that you understand the basic concepts, such as modules, cmdlets, and sessions.</span></span> <span data-ttu-id="db509-129">Para obtener más información, consulte [Introducción a Windows PowerShell](https://technet.microsoft.com/library/hh857337.aspx).</span><span class="sxs-lookup"><span data-stu-id="db509-129">For more information, see [Getting started with Windows PowerShell](https://technet.microsoft.com/library/hh857337.aspx).</span></span>

<span data-ttu-id="db509-130">Para obtener ayuda detallada con cualquier cmdlet que aparezca en este tutorial, use el cmdlet **Get-Help** .</span><span class="sxs-lookup"><span data-stu-id="db509-130">To get detailed help for any cmdlet that you see in this tutorial, use the **Get-Help** cmdlet.</span></span>

    Get-Help <cmdlet-name> -Detailed

<span data-ttu-id="db509-131">Por ejemplo, para obtener ayuda para el cmdlet **Add-AzureRmAccount** , escriba:</span><span class="sxs-lookup"><span data-stu-id="db509-131">For example, to get help for the **Login-AzureRmAccount** cmdlet, type:</span></span>

    Get-Help Login-AzureRmAccount -Detailed

<span data-ttu-id="db509-132">Lea también los siguientes tutoriales para familiarizarse con el Administrador de recursos de Azure en Azure PowerShell:</span><span class="sxs-lookup"><span data-stu-id="db509-132">You can also read the following tutorials to get familiar with Azure Resource Manager in Azure PowerShell:</span></span>

* [<span data-ttu-id="db509-133">Instalación y configuración de Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="db509-133">How to install and configure Azure PowerShell</span></span>](/powershell/azure/overview)
* [<span data-ttu-id="db509-134">Uso de Azure PowerShell con el Administrador de recursos</span><span class="sxs-lookup"><span data-stu-id="db509-134">Using Azure PowerShell with Resource Manager</span></span>](../powershell-azure-resource-manager.md)

## <span data-ttu-id="db509-135"><a id="connect"></a>Conexión a las suscripciones</span><span class="sxs-lookup"><span data-stu-id="db509-135"><a id="connect"></a>Connect to your subscriptions</span></span>
<span data-ttu-id="db509-136">Inicie una sesión de PowerShell de Azure e inicie sesión en su cuenta de Azure con el siguiente comando:</span><span class="sxs-lookup"><span data-stu-id="db509-136">Start an Azure PowerShell session and sign in to your Azure account with the following command:</span></span>  

    Login-AzureRmAccount

<span data-ttu-id="db509-137">Tenga en cuenta que si usa una instancia específica de Azure, por ejemplo, Azure Government, use el parámetro -Environment con este comando.</span><span class="sxs-lookup"><span data-stu-id="db509-137">Note that if you are using a specific instance of Azure, for example, Azure Government, use the -Environment parameter with this command.</span></span> <span data-ttu-id="db509-138">Por ejemplo: `Login-AzureRmAccount –Environment (Get-AzureRmEnvironment –Name AzureUSGovernment)`</span><span class="sxs-lookup"><span data-stu-id="db509-138">For example: `Login-AzureRmAccount –Environment (Get-AzureRmEnvironment –Name AzureUSGovernment)`</span></span>

<span data-ttu-id="db509-139">En la ventana emergente del explorador, escriba el nombre de usuario y la contraseña de su cuenta de Azure.</span><span class="sxs-lookup"><span data-stu-id="db509-139">In the pop-up browser window, enter your Azure account user name and password.</span></span> <span data-ttu-id="db509-140">Azure PowerShell obtiene todas las suscripciones asociadas a esta cuenta y, de forma predeterminada, usa la primera.</span><span class="sxs-lookup"><span data-stu-id="db509-140">Azure PowerShell gets all the subscriptions that are associated with this account and by default, uses the first one.</span></span>

<span data-ttu-id="db509-141">Si hay varias suscripciones y desea especificar que una en concreto se use para Azure Key Vault, escriba lo siguiente para ver las suscripciones de la cuenta:</span><span class="sxs-lookup"><span data-stu-id="db509-141">If you have multiple subscriptions and want to specify a specific one to use for Azure Key Vault, type the following to see the subscriptions for your account:</span></span>

    Get-AzureRmSubscription

<span data-ttu-id="db509-142">A continuación, para especificar la suscripción que se va a usar, escriba:</span><span class="sxs-lookup"><span data-stu-id="db509-142">Then, to specify the subscription to use, type:</span></span>

    Set-AzureRmContext -SubscriptionId <subscription ID>

<span data-ttu-id="db509-143">Para obtener más información sobre cómo configurar PowerShell de Azure, consulte [Instalación y configuración de PowerShell de Azure](/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="db509-143">For more information about configuring Azure PowerShell, see [How to install and configure Azure PowerShell](/powershell/azure/overview).</span></span>

## <span data-ttu-id="db509-144"><a id="resource"></a>Creación de un nuevo grupo de recursos</span><span class="sxs-lookup"><span data-stu-id="db509-144"><a id="resource"></a>Create a new resource group</span></span>
<span data-ttu-id="db509-145">Cuando se utiliza el Administrador de recursos de Azure, todos los recursos relacionados se crean dentro de un grupo de recursos.</span><span class="sxs-lookup"><span data-stu-id="db509-145">When you use Azure Resource Manager, all related resources are created inside a resource group.</span></span> <span data-ttu-id="db509-146">Crearemos un nuevo grupo de recursos denominado **ContosoResourceGroup** para este tutorial:</span><span class="sxs-lookup"><span data-stu-id="db509-146">We will create a new resource group named **ContosoResourceGroup** for this tutorial:</span></span>

    New-AzureRmResourceGroup –Name 'ContosoResourceGroup' –Location 'East Asia'


## <span data-ttu-id="db509-147"><a id="vault"></a>Creación de un Almacén de claves</span><span class="sxs-lookup"><span data-stu-id="db509-147"><a id="vault"></a>Create a key vault</span></span>
<span data-ttu-id="db509-148">Use el cmdlet [New-AzureRmKeyVault](/powershell/module/azurerm.keyvault/new-azurermkeyvault) para crear una instancia de Key Vault.</span><span class="sxs-lookup"><span data-stu-id="db509-148">Use the [New-AzureRmKeyVault](/powershell/module/azurerm.keyvault/new-azurermkeyvault) cmdlet to create a key vault.</span></span> <span data-ttu-id="db509-149">Este cmdlet tiene tres parámetros obligatorios: el **nombre del grupo de recursos**, el **nombre del Almacén de claves** y la **ubicación geográfica**.</span><span class="sxs-lookup"><span data-stu-id="db509-149">This cmdlet has three mandatory parameters: a **resource group name**, a **key vault name**, and the **geographic location**.</span></span>

<span data-ttu-id="db509-150">Por ejemplo, si utiliza el nombre de almacén **ContosoKeyVault**, el nombre de grupo de recursos **ContosoResourceGroup** y la ubicación **Asia Oriental**, escriba:</span><span class="sxs-lookup"><span data-stu-id="db509-150">For example, if you use the vault name of **ContosoKeyVault**, the resource group name of **ContosoResourceGroup**, and the location of **East Asia**, type:</span></span>

    New-AzureRmKeyVault -VaultName 'ContosoKeyVault' -ResourceGroupName 'ContosoResourceGroup' -Location 'East Asia'

<span data-ttu-id="db509-151">El resultado de este cmdlet muestra las propiedades del Almacén de claves que acaba de crear.</span><span class="sxs-lookup"><span data-stu-id="db509-151">The output of this cmdlet shows properties of the key vault that you’ve just created.</span></span> <span data-ttu-id="db509-152">Las dos propiedades más importantes son:</span><span class="sxs-lookup"><span data-stu-id="db509-152">The two most important properties are:</span></span>

* <span data-ttu-id="db509-153">**Nombre de almacén**: en este ejemplo es **ContosoKeyVault**.</span><span class="sxs-lookup"><span data-stu-id="db509-153">**Vault Name**: In the example, this is **ContosoKeyVault**.</span></span> <span data-ttu-id="db509-154">Utilizará este nombre para otros cmdlets del Almacén de claves.</span><span class="sxs-lookup"><span data-stu-id="db509-154">You will use this name for other Key Vault cmdlets.</span></span>
* <span data-ttu-id="db509-155">**Identificador URI de almacén**: en este ejemplo es https://contosokeyvault.vault.azure.net/.</span><span class="sxs-lookup"><span data-stu-id="db509-155">**Vault URI**: In the example, this is https://contosokeyvault.vault.azure.net/.</span></span> <span data-ttu-id="db509-156">Las aplicaciones que utilizan el almacén a través de su API de REST deben usar este identificador URI.</span><span class="sxs-lookup"><span data-stu-id="db509-156">Applications that use your vault through its REST API must use this URI.</span></span>

<span data-ttu-id="db509-157">Su cuenta de Azure ahora está autorizada para realizar operaciones en este Almacén de claves.</span><span class="sxs-lookup"><span data-stu-id="db509-157">Your Azure account is now authorized to perform any operations on this key vault.</span></span> <span data-ttu-id="db509-158">Hasta el momento, nadie más lo está.</span><span class="sxs-lookup"><span data-stu-id="db509-158">As yet, nobody else is.</span></span>

> [!NOTE]
> <span data-ttu-id="db509-159">Si ve el error **La suscripción no está registrada para usar el espacio de nombres 'Microsoft.KeyVault'** al intentar crear una instancia nueva de Key Vault, ejecute `Register-AzureRmResourceProvider -ProviderNamespace "Microsoft.KeyVault"` y después vuelva a ejecutar el comando New-AzureRmKeyVault.</span><span class="sxs-lookup"><span data-stu-id="db509-159">If you see the error **The subscription is not registered to use namespace 'Microsoft.KeyVault'** when you try to create your new key vault, run `Register-AzureRmResourceProvider -ProviderNamespace "Microsoft.KeyVault"` and then rerun your New-AzureRmKeyVault command.</span></span> <span data-ttu-id="db509-160">Para más información, consulte [Register-AzureRmResourceProvider](/powershell/module/azurerm.resources/register-azurermresourceprovider).</span><span class="sxs-lookup"><span data-stu-id="db509-160">For more information, see [Register-AzureRmResourceProvider](/powershell/module/azurerm.resources/register-azurermresourceprovider).</span></span>
>
>

## <span data-ttu-id="db509-161"><a id="add"></a>Adición de una clave o un secreto al Almacén de claves</span><span class="sxs-lookup"><span data-stu-id="db509-161"><a id="add"></a>Add a key or secret to the key vault</span></span>
<span data-ttu-id="db509-162">Si desea que Azure Key Vault cree automáticamente una clave protegida mediante software, utilice el cmdlet [Add-AzureKeyVaultKey](/powershell/module/azurerm.keyvault/add-azurekeyvaultkey) y escriba lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="db509-162">If you want Azure Key Vault to create a software-protected key for you, use the [Add-AzureKeyVaultKey](/powershell/module/azurerm.keyvault/add-azurekeyvaultkey) cmdlet, and type the following:</span></span>

    $key = Add-AzureKeyVaultKey -VaultName 'ContosoKeyVault' -Name 'ContosoFirstKey' -Destination 'Software'

<span data-ttu-id="db509-163">Sin embargo, si ya tiene una clave protegida mediante software en un archivo .PFX guardada en la unidad C:\ en un archivo denominado softkey.pfx que desea cargar en Azure Key Vault, escriba lo siguiente para establecer la variable **securepfxpwd** para una contraseña de **123** para el archivo .PFX:</span><span class="sxs-lookup"><span data-stu-id="db509-163">However, if you have an existing software-protected key in a .PFX file saved to your C:\ drive in a file named softkey.pfx that you want to upload to Azure Key Vault, type the following to set the variable **securepfxpwd** for a password of **123** for the .PFX file:</span></span>

    $securepfxpwd = ConvertTo-SecureString –String '123' –AsPlainText –Force

<span data-ttu-id="db509-164">A continuación, escriba lo siguiente para importar la clave desde el archivo .PFX, que protege la clave mediante software en el servicio de almacén de claves:</span><span class="sxs-lookup"><span data-stu-id="db509-164">Then type the following to import the key from the .PFX file, which protects the key by software in the Key Vault service:</span></span>

    $key = Add-AzureKeyVaultKey -VaultName 'ContosoKeyVault' -Name 'ContosoFirstKey' -KeyFilePath 'c:\softkey.pfx' -KeyFilePassword $securepfxpwd


<span data-ttu-id="db509-165">Ahora puede utilizar el URI para hacer referencia a esta clave que creó o cargó en el Almacén de claves de Azure.</span><span class="sxs-lookup"><span data-stu-id="db509-165">You can now reference this key that you created or uploaded to Azure Key Vault, by using its URI.</span></span> <span data-ttu-id="db509-166">Utilice **https://ContosoKeyVault.vault.azure.net/keys/ContosoFirstKey** para obtener siempre la versión actual y **https://ContosoKeyVault.vault.azure.net/keys/ContosoFirstKey/cgacf4f763ar42ffb0a1gca546aygd87** para obtener esta versión concreta.</span><span class="sxs-lookup"><span data-stu-id="db509-166">Use **https://ContosoKeyVault.vault.azure.net/keys/ContosoFirstKey** to always get the current version, and use **https://ContosoKeyVault.vault.azure.net/keys/ContosoFirstKey/cgacf4f763ar42ffb0a1gca546aygd87** to get this specific version.</span></span>  

<span data-ttu-id="db509-167">Para mostrar el URI para esta clave, escriba:</span><span class="sxs-lookup"><span data-stu-id="db509-167">To display the URI for this key, type:</span></span>

    $Key.key.kid

<span data-ttu-id="db509-168">Para agregar un secreto, que es una contraseña denominada SQLPassword con el valor Pa$$w0rd, al Almacén de claves de Azure, convierta primero el valor Pa$$w0rd en una cadena segura escribiendo lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="db509-168">To add a secret to the vault, which is a password named SQLPassword and has the value of Pa$$w0rd to Azure Key Vault, first convert the value of Pa$$w0rd to a secure string by typing the following:</span></span>

    $secretvalue = ConvertTo-SecureString 'Pa$$w0rd' -AsPlainText -Force

<span data-ttu-id="db509-169">A continuación, escriba lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="db509-169">Then, type the following:</span></span>

    $secret = Set-AzureKeyVaultSecret -VaultName 'ContosoKeyVault' -Name 'SQLPassword' -SecretValue $secretvalue

<span data-ttu-id="db509-170">Ahora puede hacer referencia a esta clave que agregó al Almacén de claves de Azure utilizando su URI.</span><span class="sxs-lookup"><span data-stu-id="db509-170">You can now reference this password that you added to Azure Key Vault, by using its URI.</span></span> <span data-ttu-id="db509-171">Utilice **https://ContosoVault.vault.azure.net/secrets/SQLPassword** para obtener siempre la versión actual y **https://ContosoVault.vault.azure.net/secrets/SQLPassword/90018dbb96a84117a0d2847ef8e7189d** para obtener esta versión concreta.</span><span class="sxs-lookup"><span data-stu-id="db509-171">Use **https://ContosoVault.vault.azure.net/secrets/SQLPassword** to always get the current version, and use **https://ContosoVault.vault.azure.net/secrets/SQLPassword/90018dbb96a84117a0d2847ef8e7189d** to get this specific version.</span></span>

<span data-ttu-id="db509-172">Para mostrar el URI para este secreto, escriba:</span><span class="sxs-lookup"><span data-stu-id="db509-172">To display the URI for this secret, type:</span></span>

    $secret.Id

<span data-ttu-id="db509-173">Veamos la clave o el secreto que acaba de crear:</span><span class="sxs-lookup"><span data-stu-id="db509-173">Let’s view the key or secret that you just created:</span></span>

* <span data-ttu-id="db509-174">Para ver la clave, escriba: `Get-AzureKeyVaultKey –VaultName 'ContosoKeyVault'`</span><span class="sxs-lookup"><span data-stu-id="db509-174">To view your key, type: `Get-AzureKeyVaultKey –VaultName 'ContosoKeyVault'`</span></span>
* <span data-ttu-id="db509-175">Para ver el secreto, escriba: `Get-AzureKeyVaultSecret –VaultName 'ContosoKeyVault'`</span><span class="sxs-lookup"><span data-stu-id="db509-175">To view your secret, type: `Get-AzureKeyVaultSecret –VaultName 'ContosoKeyVault'`</span></span>

<span data-ttu-id="db509-176">Ahora, el Almacén de claves y la clave o el secreto están listos para que los usen las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="db509-176">Now, your key vault and key or secret is ready for applications to use.</span></span> <span data-ttu-id="db509-177">Las aplicaciones deben contar con autorización para poder usarlos.</span><span class="sxs-lookup"><span data-stu-id="db509-177">You must authorize applications to use them.</span></span>  

## <span data-ttu-id="db509-178"><a id="register"></a>Registro de una aplicación con Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="db509-178"><a id="register"></a>Register an application with Azure Active Directory</span></span>
<span data-ttu-id="db509-179">Este paso lo haría normalmente un programador en un equipo independiente.</span><span class="sxs-lookup"><span data-stu-id="db509-179">This step would usually be done by a developer, on a separate computer.</span></span> <span data-ttu-id="db509-180">No es específico del Almacén de claves de Azure, pero se incluye aquí a fin de que la información ofrecida sea lo más completa posible.</span><span class="sxs-lookup"><span data-stu-id="db509-180">It is not specific to Azure Key Vault, but is included here for completeness.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="db509-181">Para finalizar el tutorial, la cuenta, el almacén y la aplicación que vaya a registrar en este paso deben estar en el mismo directorio de Azure.</span><span class="sxs-lookup"><span data-stu-id="db509-181">To complete the tutorial, your account, the vault, and the application that you will register in this step must all be in the same Azure directory.</span></span>
>
>

<span data-ttu-id="db509-182">Las aplicaciones que utilizan un Almacén de claves deben autenticarse utilizando un token de Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="db509-182">Applications that use a key vault must authenticate by using a token from Azure Active Directory.</span></span> <span data-ttu-id="db509-183">Para ello, el propietario de la aplicación debe registrarla primero en su Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="db509-183">To do this, the owner of the application must first register the application in their Azure Active Directory.</span></span> <span data-ttu-id="db509-184">Al final del registro, el propietario de la aplicación obtiene los valores siguientes:</span><span class="sxs-lookup"><span data-stu-id="db509-184">At the end of registration, the application owner gets the following values:</span></span>

* <span data-ttu-id="db509-185">Un **identificador de la aplicación** (también conocido como un identificador de cliente) y una **clave de autenticación** (también conocida como secreto compartido).</span><span class="sxs-lookup"><span data-stu-id="db509-185">An **Application ID** (also known as a Client ID) and **authentication key** (also known as the shared secret).</span></span> <span data-ttu-id="db509-186">Para obtener un token, la aplicación debe presentar estos dos valores a Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="db509-186">The application must present both these values to Azure Active Directory, to get a token.</span></span> <span data-ttu-id="db509-187">La forma en que se configura la aplicación para ello depende de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="db509-187">How the application is configured to do this depends on the application.</span></span> <span data-ttu-id="db509-188">Para la aplicación de ejemplo del Almacén de claves, el propietario de la aplicación establece estos valores en el archivo app.config.</span><span class="sxs-lookup"><span data-stu-id="db509-188">For the Key Vault sample application, the application owner sets these values in the app.config file.</span></span>

<span data-ttu-id="db509-189">Para registrar la aplicación en Azure Active Directory:</span><span class="sxs-lookup"><span data-stu-id="db509-189">To register the application in Azure Active Directory:</span></span>

1. <span data-ttu-id="db509-190">Inicie sesión en el portal clásico de Azure.</span><span class="sxs-lookup"><span data-stu-id="db509-190">Sign in to the Azure classic portal.</span></span>
2. <span data-ttu-id="db509-191">A la izquierda, haga clic en **Active Directory** y, después, seleccione el directorio en el que va a registrar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="db509-191">On the left, click **Active Directory**, and then select the directory in which you will register your application.</span></span> <br> <br> <span data-ttu-id="db509-192">**Nota:** debe seleccionar el directorio que contenga la suscripción de Azure con la que creó la instancia de Key Vault.</span><span class="sxs-lookup"><span data-stu-id="db509-192">**Note:** You must select the same directory that contains the Azure subscription with which you created your key vault.</span></span> <span data-ttu-id="db509-193">Si no sabe qué directorio es, haga clic en **Configuración**, identifique la suscripción con la que creó la instancia de Key Vault y anote el nombre del directorio que se muestra en la última columna.</span><span class="sxs-lookup"><span data-stu-id="db509-193">If you do not know which directory this is, click **Settings**, identify the subscription with which you created your key vault, and note the name of the directory displayed in the last column.</span></span>
3. <span data-ttu-id="db509-194">Haga clic en **Aplicaciones**.</span><span class="sxs-lookup"><span data-stu-id="db509-194">Click **APPLICATIONS**.</span></span> <span data-ttu-id="db509-195">Si no se han agregado aplicaciones a su directorio, esta página muestra solo el vínculo **Agregar una aplicación** .</span><span class="sxs-lookup"><span data-stu-id="db509-195">If no apps have been added to your directory, this page shows only the **Add an App** link.</span></span> <span data-ttu-id="db509-196">Haga clic en el vínculo, o como alternativa, puede hacer clic en **AGREGAR** en la barra de comandos.</span><span class="sxs-lookup"><span data-stu-id="db509-196">Click the link, or alternatively, you can click **ADD** on the command bar.</span></span>
4. <span data-ttu-id="db509-197">En el Asistente para **agregar aplicaciones**, en la página **¿Qué desea hacer?**, haga clic en **Agregar una aplicación que mi organización está desarrollando**.</span><span class="sxs-lookup"><span data-stu-id="db509-197">In the **ADD APPLICATION** wizard, on the **What do you want to do?** page, click **Add an application my organization is developing**.</span></span>
5. <span data-ttu-id="db509-198">En la página **Proporcione información sobre su aplicación**, especifique un nombre para la aplicación y, después, elija **APLICACIÓN WEB Y/O API WEB** (valor predeterminado).</span><span class="sxs-lookup"><span data-stu-id="db509-198">On the **Tell us about your application** page, specify a name for your application, and then select **WEB APPLICATION AND/OR WEB API** (the default).</span></span> <span data-ttu-id="db509-199">Haga clic en el icono **Siguiente** .</span><span class="sxs-lookup"><span data-stu-id="db509-199">Click the **Next** icon.</span></span>
6. <span data-ttu-id="db509-200">En la página **Agregar propiedades**, especifique los valores de **URL de inicio de sesión** y **URI de id. de aplicación** para la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="db509-200">On the **App properties** page, specify the **SIGN-ON URL** and **APP ID URI** for your web application.</span></span> <span data-ttu-id="db509-201">Si la aplicación no tiene estos valores, puede inventárselos en este paso (por ejemplo, puede especificar http://test1.contoso.com en ambos cuadros).</span><span class="sxs-lookup"><span data-stu-id="db509-201">If your application does not have these values, you can make them up for this step (for example, you could specify http://test1.contoso.com for both boxes).</span></span> <span data-ttu-id="db509-202">No importa si los sitios existen.</span><span class="sxs-lookup"><span data-stu-id="db509-202">It does not matter if these sites exist.</span></span> <span data-ttu-id="db509-203">Lo importante es que el URI del identificador de la aplicación de cada aplicación sea diferente en cada una de las aplicaciones del directorio.</span><span class="sxs-lookup"><span data-stu-id="db509-203">What is important is that the app ID URI for each application is different for every application in your directory.</span></span> <span data-ttu-id="db509-204">El directorio utiliza esta cadena para identificar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="db509-204">The directory uses this string to identify your app.</span></span>
7. <span data-ttu-id="db509-205">Haga clic en el icono **Completar** para guardar los cambios en el Asistente.</span><span class="sxs-lookup"><span data-stu-id="db509-205">Click the **Complete** icon to save your changes in the wizard.</span></span>
8. <span data-ttu-id="db509-206">En la página **Inicio rápido**, haga clic en **Configurar**.</span><span class="sxs-lookup"><span data-stu-id="db509-206">On the **Quick Start** page, click **CONFIGURE**.</span></span>
9. <span data-ttu-id="db509-207">Desplácese hasta la sección de **claves**, seleccione la duración y haga clic en **Guardar**.</span><span class="sxs-lookup"><span data-stu-id="db509-207">Scroll to the **keys** section, select the duration, and then click **SAVE**.</span></span> <span data-ttu-id="db509-208">La página se actualiza y muestra ahora un valor de clave.</span><span class="sxs-lookup"><span data-stu-id="db509-208">The page refreshes and now shows a key value.</span></span> <span data-ttu-id="db509-209">Debe configurar la aplicación con este valor de clave y el valor del **identificador del cliente** .</span><span class="sxs-lookup"><span data-stu-id="db509-209">You must configure your application with this key value and the **CLIENT ID** value.</span></span> <span data-ttu-id="db509-210">(las instrucciones para realizar esta configuración son específicas para la aplicación).</span><span class="sxs-lookup"><span data-stu-id="db509-210">(Instructions for this configuration are application-specific.)</span></span>
10. <span data-ttu-id="db509-211">Copie el valor del identificador del cliente en esta página. Lo utilizará en el paso siguiente para definir los permisos del almacén.</span><span class="sxs-lookup"><span data-stu-id="db509-211">Copy the client ID value from this page, which you will use in the next step to set permissions on your vault.</span></span>

## <span data-ttu-id="db509-212"><a id="authorize"></a>Autorización de la aplicación para que use la clave o el secreto</span><span class="sxs-lookup"><span data-stu-id="db509-212"><a id="authorize"></a>Authorize the application to use the key or secret</span></span>
<span data-ttu-id="db509-213">Para autorizar a la aplicación a acceder a la clave o al secreto del almacén, use el cmdlet [Set-AzureRmKeyVaultAccessPolicy](/powershell/module/azurerm.keyvault/set-azurermkeyvaultaccesspolicy).</span><span class="sxs-lookup"><span data-stu-id="db509-213">To authorize the application to access the key or secret in the vault, use the [Set-AzureRmKeyVaultAccessPolicy](/powershell/module/azurerm.keyvault/set-azurermkeyvaultaccesspolicy) cmdlet.</span></span>

<span data-ttu-id="db509-214">Por ejemplo, si el nombre del almacén es **ContosoKeyVault** y la aplicación que desea autorizar tiene el identificador de cliente 8f8c4bbd-485b-45fd-98f7-ec6300b7b4ed y desea que la aplicación tenga autorización para descifrar y firmar con claves en el almacén, ejecute lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="db509-214">For example, if your vault name is **ContosoKeyVault** and the application you want to authorize has a client ID of 8f8c4bbd-485b-45fd-98f7-ec6300b7b4ed, and you want to authorize the application to decrypt and sign with keys in your vault, run the following:</span></span>

    Set-AzureRmKeyVaultAccessPolicy -VaultName 'ContosoKeyVault' -ServicePrincipalName 8f8c4bbd-485b-45fd-98f7-ec6300b7b4ed -PermissionsToKeys decrypt,sign

<span data-ttu-id="db509-215">Si desea autorizar a esa misma aplicación para leer los secretos en el almacén, ejecute lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="db509-215">If you want to authorize that same application to read secrets in your vault, run the following:</span></span>

    Set-AzureRmKeyVaultAccessPolicy -VaultName 'ContosoKeyVault' -ServicePrincipalName 8f8c4bbd-485b-45fd-98f7-ec6300b7b4ed -PermissionsToSecrets Get

## <span data-ttu-id="db509-216"><a id="HSM"></a>Si desea utilizar un módulo de seguridad de hardware (HSM)</span><span class="sxs-lookup"><span data-stu-id="db509-216"><a id="HSM"></a>If you want to use a hardware security module (HSM)</span></span>
<span data-ttu-id="db509-217">Para obtener seguridad adicional, puede importar o generar claves en módulos de seguridad de hardware (HSM) que no se salen nunca del límite de los HSM.</span><span class="sxs-lookup"><span data-stu-id="db509-217">For added assurance, you can import or generate keys in hardware security modules (HSMs) that never leave the HSM boundary.</span></span> <span data-ttu-id="db509-218">Los HSM tienen la validación FIPS 140-2 de nivel 2.</span><span class="sxs-lookup"><span data-stu-id="db509-218">The HSMs are FIPS 140-2 Level 2 validated.</span></span> <span data-ttu-id="db509-219">Si este requisito no es relevante para usted, omita esta sección y vaya al paso [Eliminación del Almacén de claves junto con las claves y secretos asociados](#delete).</span><span class="sxs-lookup"><span data-stu-id="db509-219">If this requirement doesn't apply to you, skip this section and go to [Delete the key vault and associated keys and secrets](#delete).</span></span>

<span data-ttu-id="db509-220">Para crear estas claves protegidas con HSM, debe utilizar el [nivel de servicio Premium de Azure Key Vault para admitir claves protegidas con HSM](https://azure.microsoft.com/pricing/free-trial/).</span><span class="sxs-lookup"><span data-stu-id="db509-220">To create these HSM-protected keys, you must use the [Azure Key Vault Premium service tier to support HSM-protected keys](https://azure.microsoft.com/pricing/free-trial/).</span></span> <span data-ttu-id="db509-221">Además, tenga en cuenta que esta funcionalidad no está disponible para Azure China.</span><span class="sxs-lookup"><span data-stu-id="db509-221">In addition, note that this functionality is not available for Azure China.</span></span>

<span data-ttu-id="db509-222">Cuando cree Key Vault, agregue el parámetro **-SKU**:</span><span class="sxs-lookup"><span data-stu-id="db509-222">When you create the key vault, add the **-SKU** parameter:</span></span>

    New-AzureRmKeyVault -VaultName 'ContosoKeyVaultHSM' -ResourceGroupName 'ContosoResourceGroup' -Location 'East Asia' -SKU 'Premium'



<span data-ttu-id="db509-223">Puede agregar claves protegidas mediante software (como se ha mostrado anteriormente) y claves protegidas con HSM a Key Vault.</span><span class="sxs-lookup"><span data-stu-id="db509-223">You can add software-protected keys (as shown earlier) and HSM-protected keys to this key vault.</span></span> <span data-ttu-id="db509-224">Para crear una clave protegida con HSM, establezca el parámetro **-Destination** en 'HSM':</span><span class="sxs-lookup"><span data-stu-id="db509-224">To create an HSM-protected key, set the **-Destination** parameter to 'HSM':</span></span>

    $key = Add-AzureKeyVaultKey -VaultName 'ContosoKeyVaultHSM' -Name 'ContosoFirstHSMKey' -Destination 'HSM'

<span data-ttu-id="db509-225">Puede utilizar el siguiente comando para importar una clave desde un archivo .PFX a su equipo.</span><span class="sxs-lookup"><span data-stu-id="db509-225">You can use the following command to import a key from a .PFX file on your computer.</span></span> <span data-ttu-id="db509-226">Este comando importa la clave a HSM en el servicio de Almacén de claves:</span><span class="sxs-lookup"><span data-stu-id="db509-226">This command imports the key into HSMs in the Key Vault service:</span></span>

    $key = Add-AzureKeyVaultKey -VaultName 'ContosoKeyVaultHSM' -Name 'ContosoFirstHSMKey' -KeyFilePath 'c:\softkey.pfx' -KeyFilePassword $securepfxpwd -Destination 'HSM'


<span data-ttu-id="db509-227">El comando siguiente importa un paquete BYOK ("traiga su propia clave").</span><span class="sxs-lookup"><span data-stu-id="db509-227">The next command imports a “bring your own key" (BYOK) package.</span></span> <span data-ttu-id="db509-228">Este escenario le permite generar la clave en el HSM local y transferirla a los HSM del servicio Key Vault, sin que la clave salga del límite del HSM:</span><span class="sxs-lookup"><span data-stu-id="db509-228">This scenario lets you generate your key in your local HSM, and transfer it to HSMs in the Key Vault service, without the key leaving the HSM boundary:</span></span>

    $key = Add-AzureKeyVaultKey -VaultName 'ContosoKeyVaultHSM' -Name 'ContosoFirstHSMKey' -KeyFilePath 'c:\ITByok.byok' -Destination 'HSM'

<span data-ttu-id="db509-229">Para obtener instrucciones detalladas sobre cómo generar el paquete BYOK, consulte [Generación y transferencia de claves protegidas con HSM para el Almacén de claves de Azure](key-vault-hsm-protected-keys.md).</span><span class="sxs-lookup"><span data-stu-id="db509-229">For more detailed instructions about how to generate this BYOK package, see [How to generate and transfer HSM-protected keys for Azure Key Vault](key-vault-hsm-protected-keys.md).</span></span>

## <span data-ttu-id="db509-230"><a id="delete"></a>Eliminación del Almacén de claves junto con las claves y secretos asociados</span><span class="sxs-lookup"><span data-stu-id="db509-230"><a id="delete"></a>Delete the key vault and associated keys and secrets</span></span>
<span data-ttu-id="db509-231">Si ya no necesita la instancia de Key Vault, ni la clave y el secreto que contiene, puede eliminarlo mediante el cmdlet [Remove-AzureRmKeyVault](/powershell/module/azurerm.keyvault/remove-azurermkeyvault):</span><span class="sxs-lookup"><span data-stu-id="db509-231">If you no longer need the key vault and the key or secret that it contains, you can delete the key vault by using the [Remove-AzureRmKeyVault](/powershell/module/azurerm.keyvault/remove-azurermkeyvault) cmdlet:</span></span>

    Remove-AzureRmKeyVault -VaultName 'ContosoKeyVault'

<span data-ttu-id="db509-232">O bien puede eliminar un grupo de recursos de Azure completo, que incluye el Almacén de claves y otros recursos incluidos en dicho grupo:</span><span class="sxs-lookup"><span data-stu-id="db509-232">Or, you can delete an entire Azure resource group, which includes the key vault and any other resources that you included in that group:</span></span>

    Remove-AzureRmResourceGroup -ResourceGroupName 'ContosoResourceGroup'


## <span data-ttu-id="db509-233"><a id="other"></a>Otros cmdlets de Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="db509-233"><a id="other"></a>Other Azure PowerShell Cmdlets</span></span>
<span data-ttu-id="db509-234">Estos son otros comandos que pueden resultar útiles para administrar el Almacén de claves de Azure.</span><span class="sxs-lookup"><span data-stu-id="db509-234">Other commands that you might find useful for managing Azure Key Vault:</span></span>

* <span data-ttu-id="db509-235">`$Keys = Get-AzureKeyVaultKey -VaultName 'ContosoKeyVault'`: este comando ofrece una presentación tabular de todas las claves y las propiedades seleccionadas.</span><span class="sxs-lookup"><span data-stu-id="db509-235">`$Keys = Get-AzureKeyVaultKey -VaultName 'ContosoKeyVault'`: This command gets a tabular display of all keys and selected properties.</span></span>
* <span data-ttu-id="db509-236">`$Keys[0]`: este comando muestra una lista completa de propiedades para la clave especificada.</span><span class="sxs-lookup"><span data-stu-id="db509-236">`$Keys[0]`: This command displays a full list of properties for the specified key</span></span>
* <span data-ttu-id="db509-237">`Get-AzureKeyVaultSecret`: este comando muestra una presentación tabular de todos nombres de secretos y las propiedades que se elijan.</span><span class="sxs-lookup"><span data-stu-id="db509-237">`Get-AzureKeyVaultSecret`: This command lists a tabular display of all secret names and selected properties.</span></span>
* <span data-ttu-id="db509-238">`Remove-AzureKeyVaultKey -VaultName 'ContosoKeyVault' -Name 'ContosoFirstKey'`: ejemplo de cómo eliminar una clave específica.</span><span class="sxs-lookup"><span data-stu-id="db509-238">`Remove-AzureKeyVaultKey -VaultName 'ContosoKeyVault' -Name 'ContosoFirstKey'`: Example how to remove a specific key.</span></span>
* <span data-ttu-id="db509-239">`Remove-AzureKeyVaultSecret -VaultName 'ContosoKeyVault' -Name 'SQLPassword'`: ejemplo de cómo eliminar un secreto específico.</span><span class="sxs-lookup"><span data-stu-id="db509-239">`Remove-AzureKeyVaultSecret -VaultName 'ContosoKeyVault' -Name 'SQLPassword'`: Example how to remove a specific secret.</span></span>

## <span data-ttu-id="db509-240"><a id="next"></a>Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="db509-240"><a id="next"></a>Next steps</span></span>
<span data-ttu-id="db509-241">Para obtener un tutorial de seguimiento que usa el Almacén de claves de Azure en una aplicación web, consulte [Uso del Almacén de claves de Azure desde una aplicación web](key-vault-use-from-web-application.md).</span><span class="sxs-lookup"><span data-stu-id="db509-241">For a follow-up tutorial that uses Azure Key Vault in a web application, see [Use Azure Key Vault from a Web Application](key-vault-use-from-web-application.md).</span></span>

<span data-ttu-id="db509-242">Para ver cómo se usa el almacén de claves, consulte [Registro del Almacén de claves de Azure](key-vault-logging.md).</span><span class="sxs-lookup"><span data-stu-id="db509-242">To see how your key vault is being used, see [Azure Key Vault Logging](key-vault-logging.md).</span></span>

<span data-ttu-id="db509-243">Para obtener una lista de los cmdlets de Azure PowerShell más recientes para Azure Key Vault, consulte [Azure Key Vault Cmdlets](/powershell/module/azurerm.keyvault/#key_vault) (Cmdlets de Azure Key Vault).</span><span class="sxs-lookup"><span data-stu-id="db509-243">For a list of the latest Azure PowerShell cmdlets for Azure Key Vault, see [Azure Key Vault Cmdlets](/powershell/module/azurerm.keyvault/#key_vault).</span></span>

<span data-ttu-id="db509-244">Para conocer las referencias de programación, consulte la [Guía del desarrollador del Almacén de claves de Azure](key-vault-developers-guide.md).</span><span class="sxs-lookup"><span data-stu-id="db509-244">For programming references, see [the Azure Key Vault developer's guide](key-vault-developers-guide.md).</span></span>

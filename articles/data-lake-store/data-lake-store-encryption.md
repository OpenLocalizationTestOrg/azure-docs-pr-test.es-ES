---
title: Cifrado en Azure Data Lake Store | Microsoft Docs
description: "Descripción del funcionamiento del cifrado y la rotación de claves en Azure Data Lake Store"
services: data-lake-store
documentationcenter: 
author: yagupta
manager: 
editor: 
ms.assetid: 
ms.service: data-lake-store
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 4/14/2017
ms.author: yagupta
ms.openlocfilehash: 20444d368c568ee716ff242e33323b91ffd198eb
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="encryption-of-data-in-azure-data-lake-store"></a><span data-ttu-id="3da63-103">Cifrado de datos en Azure Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="3da63-103">Encryption of data in Azure Data Lake Store</span></span>

<span data-ttu-id="3da63-104">El cifrado en Azure Data Lake Store le ayuda a proteger sus datos, implementar directivas de seguridad de empresa y satisfacer los requisitos de cumplimiento normativo.</span><span class="sxs-lookup"><span data-stu-id="3da63-104">Encryption in Azure Data Lake Store helps you protect your data, implement enterprise security policies, and meet regulatory compliance requirements.</span></span> <span data-ttu-id="3da63-105">En este artículo se proporciona información general sobre el diseño y se discuten algunos de los aspectos técnicos de la implementación.</span><span class="sxs-lookup"><span data-stu-id="3da63-105">This article provides an overview of the design, and discusses some of the technical aspects of implementation.</span></span>

<span data-ttu-id="3da63-106">Data Lake Store admite el cifrado de datos tanto en reposo como en tránsito.</span><span class="sxs-lookup"><span data-stu-id="3da63-106">Data Lake Store supports encryption of data both at rest and in transit.</span></span> <span data-ttu-id="3da63-107">En el caso de datos en reposo, Data Lake Store admite el cifrado transparente "activado de forma predeterminada".</span><span class="sxs-lookup"><span data-stu-id="3da63-107">For data at rest, Data Lake Store supports "on by default," transparent encryption.</span></span> <span data-ttu-id="3da63-108">Con más detalle, esto significa:</span><span class="sxs-lookup"><span data-stu-id="3da63-108">Here is what these terms mean in a bit more detail:</span></span>

* <span data-ttu-id="3da63-109">**Activado de forma predeterminada**: cuando se crea una cuenta de Data Lake Store, la configuración predeterminada habilita el cifrado.</span><span class="sxs-lookup"><span data-stu-id="3da63-109">**On by default**: When you create a new Data Lake Store account, the default setting enables encryption.</span></span> <span data-ttu-id="3da63-110">Por lo tanto, los datos que se almacenan en Data Lake Store siempre se cifran antes de almacenarlos en un medio persistente.</span><span class="sxs-lookup"><span data-stu-id="3da63-110">Thereafter, data that is stored in Data Lake Store is always encrypted prior to storing on persistent media.</span></span> <span data-ttu-id="3da63-111">Este es el comportamiento para todos los datos y no se puede cambiar después de crear una cuenta.</span><span class="sxs-lookup"><span data-stu-id="3da63-111">This is the behavior for all data, and it cannot be changed after an account is created.</span></span>
* <span data-ttu-id="3da63-112">**Transparente**: Data Lake Store cifra automáticamente los datos antes de guardarlos y los descifra antes de recuperarlos.</span><span class="sxs-lookup"><span data-stu-id="3da63-112">**Transparent**: Data Lake Store automatically encrypts data prior to persisting, and decrypts data prior to retrieval.</span></span> <span data-ttu-id="3da63-113">Un administrador configura y administra el cifrado de cada instancia de Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="3da63-113">The encryption is configured and managed at the Data Lake Store level by an administrator.</span></span> <span data-ttu-id="3da63-114">No se realizan cambios en las API de acceso a datos.</span><span class="sxs-lookup"><span data-stu-id="3da63-114">No changes are made to the data access APIs.</span></span> <span data-ttu-id="3da63-115">Por lo tanto, no se requiere ningún cambio en las aplicaciones y los servicios que interactúan con Data Lake Store a causa del cifrado.</span><span class="sxs-lookup"><span data-stu-id="3da63-115">Thus, no changes are required in applications and services that interact with Data Lake Store because of encryption.</span></span>

<span data-ttu-id="3da63-116">Los datos en tránsito (también conocidos como datos en movimiento) también se cifran siempre en Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="3da63-116">Data in transit (also known as data in motion) is also always encrypted in Data Lake Store.</span></span> <span data-ttu-id="3da63-117">Además de que los datos se cifran antes de almacenarse en un medio persistente, también se protegen cuando están en tránsito mediante HTTPS.</span><span class="sxs-lookup"><span data-stu-id="3da63-117">In addition to encrypting data prior to storing to persistent media, the data is also always secured in transit by using HTTPS.</span></span> <span data-ttu-id="3da63-118">HTTPS es el único protocolo admitido para las interfaces de REST de Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="3da63-118">HTTPS is the only protocol that is supported for the Data Lake Store REST interfaces.</span></span> <span data-ttu-id="3da63-119">En el diagrama siguiente se muestra cómo se cifran los datos en Data Lake Store:</span><span class="sxs-lookup"><span data-stu-id="3da63-119">The following diagram shows how data becomes encrypted in Data Lake Store:</span></span>

![Diagrama de cifrado de datos en Data Lake Store](./media/data-lake-store-encryption/fig1.png)


## <a name="set-up-encryption-with-data-lake-store"></a><span data-ttu-id="3da63-121">Configuración del cifrado con Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="3da63-121">Set up encryption with Data Lake Store</span></span>

<span data-ttu-id="3da63-122">El cifrado para Data Lake Store se configura durante la creación de la cuenta y siempre está habilitado de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="3da63-122">Encryption for Data Lake Store is set up during account creation, and it is always enabled by default.</span></span> <span data-ttu-id="3da63-123">Puede administrar las claves por su cuenta o dejar que Data Lake Store las administre en su nombre (esta es la opción predeterminada).</span><span class="sxs-lookup"><span data-stu-id="3da63-123">You can either manage the keys yourself, or allow Data Lake Store to manage them for you (this is the default).</span></span>

<span data-ttu-id="3da63-124">Para más información, consulte [Introducción](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-portal).</span><span class="sxs-lookup"><span data-stu-id="3da63-124">For more information, see [Getting started](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-portal).</span></span>

## <a name="how-encryption-works-in-data-lake-store"></a><span data-ttu-id="3da63-125">Funcionamiento del cifrado en Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="3da63-125">How encryption works in Data Lake Store</span></span>

<span data-ttu-id="3da63-126">A continuación se explica cómo administrar las claves de cifrado maestras y se describen los tres tipos diferentes de claves que puede usar en el cifrado de datos de Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="3da63-126">The following information covers how to manage master encryption keys, and it explains the three different types of keys you can use in data encryption for Data Lake Store.</span></span>

### <a name="master-encryption-keys"></a><span data-ttu-id="3da63-127">Claves de cifrado maestras</span><span class="sxs-lookup"><span data-stu-id="3da63-127">Master encryption keys</span></span>

<span data-ttu-id="3da63-128">Data Lake Store proporciona dos modos de administración de claves de cifrado maestras (MEK).</span><span class="sxs-lookup"><span data-stu-id="3da63-128">Data Lake Store provides two modes for management of master encryption keys (MEKs).</span></span> <span data-ttu-id="3da63-129">Por ahora, suponga que la clave de cifrado maestra es la clave de nivel superior.</span><span class="sxs-lookup"><span data-stu-id="3da63-129">For now, assume that the master encryption key is the top-level key.</span></span> <span data-ttu-id="3da63-130">Se necesita acceso a la clave de cifrado maestra para descifrar cualquier dato almacenado en Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="3da63-130">Access to the master encryption key is required to decrypt any data stored in Data Lake Store.</span></span>

<span data-ttu-id="3da63-131">Los dos modos para administrar la clave de cifrado maestra son los siguientes:</span><span class="sxs-lookup"><span data-stu-id="3da63-131">The two modes for managing the master encryption key are as follows:</span></span>

*   <span data-ttu-id="3da63-132">Claves administradas por el servicio</span><span class="sxs-lookup"><span data-stu-id="3da63-132">Service managed keys</span></span>
*   <span data-ttu-id="3da63-133">Claves administradas por el cliente</span><span class="sxs-lookup"><span data-stu-id="3da63-133">Customer managed keys</span></span>

<span data-ttu-id="3da63-134">En ambos modos, la clave de cifrado maestra está protegida al estar almacenada en Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="3da63-134">In both modes, the master encryption key is secured by storing it in Azure Key Vault.</span></span> <span data-ttu-id="3da63-135">Key Vault es un servicio de Azure totalmente administrado y enormemente seguro que se puede utilizar para proteger las claves criptográficas.</span><span class="sxs-lookup"><span data-stu-id="3da63-135">Key Vault is a fully managed, highly secure service on Azure that can be used to safeguard cryptographic keys.</span></span> <span data-ttu-id="3da63-136">Para más información, consulte [Key Vault](https://azure.microsoft.com/services/key-vault).</span><span class="sxs-lookup"><span data-stu-id="3da63-136">For more information, see [Key Vault](https://azure.microsoft.com/services/key-vault).</span></span>

<span data-ttu-id="3da63-137">Esta es una breve comparación de las funcionalidades que proporcionan ambos modos de administración de las MEK.</span><span class="sxs-lookup"><span data-stu-id="3da63-137">Here is a brief comparison of capabilities provided by the two modes of managing the MEKs.</span></span>

|  | <span data-ttu-id="3da63-138">Claves administradas por el servicio</span><span class="sxs-lookup"><span data-stu-id="3da63-138">Service managed keys</span></span> | <span data-ttu-id="3da63-139">Claves administradas por el cliente</span><span class="sxs-lookup"><span data-stu-id="3da63-139">Customer managed keys</span></span> |
| --- | --- | --- |
|<span data-ttu-id="3da63-140">¿Cómo se almacenan los datos?</span><span class="sxs-lookup"><span data-stu-id="3da63-140">How is data stored?</span></span>|<span data-ttu-id="3da63-141">Siempre se cifran antes de almacenarse.</span><span class="sxs-lookup"><span data-stu-id="3da63-141">Always encrypted prior to being stored.</span></span>|<span data-ttu-id="3da63-142">Siempre se cifran antes de almacenarse.</span><span class="sxs-lookup"><span data-stu-id="3da63-142">Always encrypted prior to being stored.</span></span>|
|<span data-ttu-id="3da63-143">¿Dónde se almacena la clave de cifrado maestra?</span><span class="sxs-lookup"><span data-stu-id="3da63-143">Where is the Master Encryption Key stored?</span></span>|<span data-ttu-id="3da63-144">Key Vault</span><span class="sxs-lookup"><span data-stu-id="3da63-144">Key Vault</span></span>|<span data-ttu-id="3da63-145">Key Vault</span><span class="sxs-lookup"><span data-stu-id="3da63-145">Key Vault</span></span>|
|<span data-ttu-id="3da63-146">¿Hay claves de cifrado almacenadas sin cifrar fuera de Key Vault?</span><span class="sxs-lookup"><span data-stu-id="3da63-146">Are any encryption keys stored in the clear outside of Key Vault?</span></span> |<span data-ttu-id="3da63-147">No</span><span class="sxs-lookup"><span data-stu-id="3da63-147">No</span></span>|<span data-ttu-id="3da63-148">No</span><span class="sxs-lookup"><span data-stu-id="3da63-148">No</span></span>|
|<span data-ttu-id="3da63-149">¿Se puede recuperar la clave de cifrado maestra mediante Key Vault?</span><span class="sxs-lookup"><span data-stu-id="3da63-149">Can the MEK be retrieved by Key Vault?</span></span>|<span data-ttu-id="3da63-150">No.</span><span class="sxs-lookup"><span data-stu-id="3da63-150">No.</span></span> <span data-ttu-id="3da63-151">Después de que la clave de cifrado maestra se almacena en Key Vault, solo se puede usar para el cifrado y el descifrado.</span><span class="sxs-lookup"><span data-stu-id="3da63-151">After the MEK is stored in Key Vault, it can only be used for encryption and decryption.</span></span>|<span data-ttu-id="3da63-152">No.</span><span class="sxs-lookup"><span data-stu-id="3da63-152">No.</span></span> <span data-ttu-id="3da63-153">Después de que la clave de cifrado maestra se almacena en Key Vault, solo se puede usar para el cifrado y el descifrado.</span><span class="sxs-lookup"><span data-stu-id="3da63-153">After the MEK is stored in Key Vault, it can only be used for encryption and decryption.</span></span>|
|<span data-ttu-id="3da63-154">¿Quién posee la instancia de Key Vault y la clave de cifrado maestra?</span><span class="sxs-lookup"><span data-stu-id="3da63-154">Who owns the Key Vault instance and the MEK?</span></span>|<span data-ttu-id="3da63-155">El servicio Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="3da63-155">The Data Lake Store service</span></span>|<span data-ttu-id="3da63-156">Usted es el propietario de la instancia de Key Vault, que pertenece a su propia suscripción de Azure.</span><span class="sxs-lookup"><span data-stu-id="3da63-156">You own the Key Vault instance, which belongs in your own Azure subscription.</span></span> <span data-ttu-id="3da63-157">La clave de cifrado maestra de Key Vault se puede administrar mediante software o hardware.</span><span class="sxs-lookup"><span data-stu-id="3da63-157">The MEK in Key Vault can be managed by software or hardware.</span></span>|
|<span data-ttu-id="3da63-158">¿Puede revocar el acceso a la clave de cifrado maestra para el servicio Data Lake Store?</span><span class="sxs-lookup"><span data-stu-id="3da63-158">Can you revoke access to the MEK for the Data Lake Store service?</span></span>|<span data-ttu-id="3da63-159">No</span><span class="sxs-lookup"><span data-stu-id="3da63-159">No</span></span>|<span data-ttu-id="3da63-160">Sí.</span><span class="sxs-lookup"><span data-stu-id="3da63-160">Yes.</span></span> <span data-ttu-id="3da63-161">Puede administrar listas de control de acceso en Key Vault y eliminar entradas de control de acceso a la identidad de servicio para el servicio Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="3da63-161">You can manage access control lists in Key Vault, and remove access control entries to the service identity for the Data Lake Store service.</span></span>|
|<span data-ttu-id="3da63-162">¿Puede eliminar permanentemente la clave de cifrado maestra?</span><span class="sxs-lookup"><span data-stu-id="3da63-162">Can you permanently delete the MEK?</span></span>|<span data-ttu-id="3da63-163">No</span><span class="sxs-lookup"><span data-stu-id="3da63-163">No</span></span>|<span data-ttu-id="3da63-164">Sí.</span><span class="sxs-lookup"><span data-stu-id="3da63-164">Yes.</span></span> <span data-ttu-id="3da63-165">Si elimina la clave de cifrado maestra de Key Vault, nadie podrá cifrar los datos de la cuenta de Data Lake Store, incluido el servicio Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="3da63-165">If you delete the MEK from Key Vault, the data in the Data Lake Store account cannot be decrypted by anyone, including the Data Lake Store service.</span></span> <br><br> <span data-ttu-id="3da63-166">Si ha realizado copia de seguridad explícita de la clave de cifrado maestra antes de eliminarla de Key Vault, se puede restaurar y entonces se pueden recuperar los datos.</span><span class="sxs-lookup"><span data-stu-id="3da63-166">If you have explicitly backed up the MEK prior to deleting it from Key Vault, the MEK can be restored, and the data can then be recovered.</span></span> <span data-ttu-id="3da63-167">Sin embargo, si no lo ha hecho, los datos de la cuenta de Data Lake Store nunca se podrán cifrar después.</span><span class="sxs-lookup"><span data-stu-id="3da63-167">However, if you have not backed up the MEK prior to deleting it from Key Vault, the data in the Data Lake Store account can never be decrypted thereafter.</span></span>|


<span data-ttu-id="3da63-168">Aparte de esta diferencia sobre quién administra la clave de cifrado maestra y la instancia de Key Vault en la que reside, el resto del diseño es igual en ambos modos.</span><span class="sxs-lookup"><span data-stu-id="3da63-168">Aside from this difference of who manages the MEK and the Key Vault instance in which it resides, the rest of the design is the same for both modes.</span></span>

<span data-ttu-id="3da63-169">Al elegir el modo de las claves de cifrado maestras, es importante recordar lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="3da63-169">It's important to remember the following when you choose the mode for the master encryption keys:</span></span>

*   <span data-ttu-id="3da63-170">Puede elegir si se usarán claves administradas por el cliente o claves administradas por el servicio al aprovisionar una cuenta de Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="3da63-170">You can choose whether to use customer managed keys or service managed keys when you provision a Data Lake Store account.</span></span>
*   <span data-ttu-id="3da63-171">Después de aprovisionar una cuenta de Data Lake Store, no se puede cambiar el modo.</span><span class="sxs-lookup"><span data-stu-id="3da63-171">After a Data Lake Store account is provisioned, the mode cannot be changed.</span></span>

### <a name="encryption-and-decryption-of-data"></a><span data-ttu-id="3da63-172">Cifrado y descifrado de datos</span><span class="sxs-lookup"><span data-stu-id="3da63-172">Encryption and decryption of data</span></span>

<span data-ttu-id="3da63-173">Son tres los tipos de claves que se usan en el diseño del cifrado de datos.</span><span class="sxs-lookup"><span data-stu-id="3da63-173">There are three types of keys that are used in the design of data encryption.</span></span> <span data-ttu-id="3da63-174">En la tabla siguiente se proporciona un resumen:</span><span class="sxs-lookup"><span data-stu-id="3da63-174">The following table provides a summary:</span></span>

| <span data-ttu-id="3da63-175">Clave</span><span class="sxs-lookup"><span data-stu-id="3da63-175">Key</span></span>                   | <span data-ttu-id="3da63-176">Abreviatura</span><span class="sxs-lookup"><span data-stu-id="3da63-176">Abbreviation</span></span> | <span data-ttu-id="3da63-177">Asociada a</span><span class="sxs-lookup"><span data-stu-id="3da63-177">Associated with</span></span> | <span data-ttu-id="3da63-178">Ubicación de almacenamiento</span><span class="sxs-lookup"><span data-stu-id="3da63-178">Storage location</span></span>                             | <span data-ttu-id="3da63-179">Escriba</span><span class="sxs-lookup"><span data-stu-id="3da63-179">Type</span></span>       | <span data-ttu-id="3da63-180">Notas</span><span class="sxs-lookup"><span data-stu-id="3da63-180">Notes</span></span>                                                                                                   |
|-----------------------|--------------|-----------------|----------------------------------------------|------------|---------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="3da63-181">Clave de cifrado maestra</span><span class="sxs-lookup"><span data-stu-id="3da63-181">Master Encryption Key</span></span> | <span data-ttu-id="3da63-182">MEK</span><span class="sxs-lookup"><span data-stu-id="3da63-182">MEK</span></span>          | <span data-ttu-id="3da63-183">Cuenta de Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="3da63-183">A Data Lake Store account</span></span> | <span data-ttu-id="3da63-184">Key Vault</span><span class="sxs-lookup"><span data-stu-id="3da63-184">Key Vault</span></span>                              | <span data-ttu-id="3da63-185">Asimétrica</span><span class="sxs-lookup"><span data-stu-id="3da63-185">Asymmetric</span></span> | <span data-ttu-id="3da63-186">Puede administrarla Data Lake Store o usted.</span><span class="sxs-lookup"><span data-stu-id="3da63-186">It can be managed by Data Lake Store or you.</span></span>                                                              |
| <span data-ttu-id="3da63-187">Clave de cifrado de datos</span><span class="sxs-lookup"><span data-stu-id="3da63-187">Data Encryption Key</span></span>   | <span data-ttu-id="3da63-188">DEK</span><span class="sxs-lookup"><span data-stu-id="3da63-188">DEK</span></span>          | <span data-ttu-id="3da63-189">Cuenta de Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="3da63-189">A Data Lake Store account</span></span> | <span data-ttu-id="3da63-190">Almacenamiento persistente, administrada por el servicio Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="3da63-190">Persistent storage, managed by Data Lake Store service</span></span> | <span data-ttu-id="3da63-191">Simétrica</span><span class="sxs-lookup"><span data-stu-id="3da63-191">Symmetric</span></span>  | <span data-ttu-id="3da63-192">La DEK se cifra mediante la clave de cifrado maestra.</span><span class="sxs-lookup"><span data-stu-id="3da63-192">The DEK is encrypted by the MEK.</span></span> <span data-ttu-id="3da63-193">La DEK cifrada es lo que se almacena en el medio persistente.</span><span class="sxs-lookup"><span data-stu-id="3da63-193">The encrypted DEK is what is stored on persistent media.</span></span> |
| <span data-ttu-id="3da63-194">Clave de cifrado de bloque</span><span class="sxs-lookup"><span data-stu-id="3da63-194">Block Encryption Key</span></span>  | <span data-ttu-id="3da63-195">BEK</span><span class="sxs-lookup"><span data-stu-id="3da63-195">BEK</span></span>          | <span data-ttu-id="3da63-196">Un bloque de datos</span><span class="sxs-lookup"><span data-stu-id="3da63-196">A block of data</span></span> | <span data-ttu-id="3da63-197">None</span><span class="sxs-lookup"><span data-stu-id="3da63-197">None</span></span>                                         | <span data-ttu-id="3da63-198">Simétrica</span><span class="sxs-lookup"><span data-stu-id="3da63-198">Symmetric</span></span>  | <span data-ttu-id="3da63-199">La clave BEK se obtiene de la clave de cifrado de datos y del bloque de datos.</span><span class="sxs-lookup"><span data-stu-id="3da63-199">The BEK is derived from the DEK and the data block.</span></span>                                                      |

<span data-ttu-id="3da63-200">En el siguiente diagrama, se ilustra este concepto:</span><span class="sxs-lookup"><span data-stu-id="3da63-200">The following diagram illustrates these concepts:</span></span>

![Claves de cifrado de datos](./media/data-lake-store-encryption/fig2.png)

#### <a name="pseudo-algorithm-when-a-file-is-to-be-decrypted"></a><span data-ttu-id="3da63-202">Pseudo-algoritmo para descifrar un archivo:</span><span class="sxs-lookup"><span data-stu-id="3da63-202">Pseudo algorithm when a file is to be decrypted:</span></span>
1.  <span data-ttu-id="3da63-203">Compruebe si la clave DEK de la cuenta de Data Lake Store está almacenada en caché y lista para su uso.</span><span class="sxs-lookup"><span data-stu-id="3da63-203">Check if the DEK for the Data Lake Store account is cached and ready for use.</span></span>
    - <span data-ttu-id="3da63-204">Si no es así, lea la clave DEK cifrada del almacenamiento persistente y envíela a Key Vault para descifrarla.</span><span class="sxs-lookup"><span data-stu-id="3da63-204">If not, then read the encrypted DEK from persistent storage, and send it to Key Vault to be decrypted.</span></span> <span data-ttu-id="3da63-205">Almacene en caché la clave DEK descifrada en memoria.</span><span class="sxs-lookup"><span data-stu-id="3da63-205">Cache the decrypted DEK in memory.</span></span> <span data-ttu-id="3da63-206">Ahora está lista para su uso.</span><span class="sxs-lookup"><span data-stu-id="3da63-206">It is now ready to use.</span></span>
2.  <span data-ttu-id="3da63-207">Para cada bloque de datos del archivo:</span><span class="sxs-lookup"><span data-stu-id="3da63-207">For every block of data in the file:</span></span>
    - <span data-ttu-id="3da63-208">Lea el bloque de datos cifrado del almacenamiento persistente.</span><span class="sxs-lookup"><span data-stu-id="3da63-208">Read the encrypted block of data from persistent storage.</span></span>
    - <span data-ttu-id="3da63-209">Genere la clave BEK con la clave DEK y el bloque de datos cifrado.</span><span class="sxs-lookup"><span data-stu-id="3da63-209">Generate the BEK from the DEK and the encrypted block of data.</span></span>
    - <span data-ttu-id="3da63-210">Use la clave BEK para descifrar los datos.</span><span class="sxs-lookup"><span data-stu-id="3da63-210">Use the BEK to decrypt data.</span></span>


#### <a name="pseudo-algorithm-when-a-block-of-data-is-to-be-encrypted"></a><span data-ttu-id="3da63-211">Pseudo-algoritmo para cifrar un archivo:</span><span class="sxs-lookup"><span data-stu-id="3da63-211">Pseudo algorithm when a block of data is to be encrypted:</span></span>
1.  <span data-ttu-id="3da63-212">Compruebe si la clave DEK de la cuenta de Data Lake Store está almacenada en caché y lista para su uso.</span><span class="sxs-lookup"><span data-stu-id="3da63-212">Check if the DEK for the Data Lake Store account is cached and ready for use.</span></span>
    - <span data-ttu-id="3da63-213">Si no es así, lea la clave DEK cifrada del almacenamiento persistente y envíela a Key Vault para descifrarla.</span><span class="sxs-lookup"><span data-stu-id="3da63-213">If not, then read the encrypted DEK from persistent storage, and send it to Key Vault to be decrypted.</span></span> <span data-ttu-id="3da63-214">Almacene en caché la clave DEK descifrada en memoria.</span><span class="sxs-lookup"><span data-stu-id="3da63-214">Cache the decrypted DEK in memory.</span></span> <span data-ttu-id="3da63-215">Ahora está lista para su uso.</span><span class="sxs-lookup"><span data-stu-id="3da63-215">It is now ready to use.</span></span>
2.  <span data-ttu-id="3da63-216">Generar una clave BEK única para el bloque de datos con la clave DEK.</span><span class="sxs-lookup"><span data-stu-id="3da63-216">Generate a unique BEK for the block of data from the DEK.</span></span>
3.  <span data-ttu-id="3da63-217">Cifre el bloque de datos con la clave BEK mediante el cifrado AES-256.</span><span class="sxs-lookup"><span data-stu-id="3da63-217">Encrypt the data block with the BEK, by using AES-256 encryption.</span></span>
4.  <span data-ttu-id="3da63-218">Almacene el bloque de datos cifrado en el almacenamiento persistente.</span><span class="sxs-lookup"><span data-stu-id="3da63-218">Store the encrypted data block of data on persistent storage.</span></span>

> [!NOTE] 
> <span data-ttu-id="3da63-219">Por motivos de rendimiento, la clave DEK sin cifrar se almacena en caché en memoria durante un corto período de tiempo, transcurrido el cual se borra inmediatamente.</span><span class="sxs-lookup"><span data-stu-id="3da63-219">For performance reasons, the DEK in the clear is cached in memory for a short time, and is immediately erased afterward.</span></span> <span data-ttu-id="3da63-220">En medios persistentes, siempre se almacena cifrada con la clave MEK.</span><span class="sxs-lookup"><span data-stu-id="3da63-220">On persistent media, it is always stored encrypted by the MEK.</span></span>

## <a name="key-rotation"></a><span data-ttu-id="3da63-221">Rotación de claves</span><span class="sxs-lookup"><span data-stu-id="3da63-221">Key rotation</span></span>

<span data-ttu-id="3da63-222">Cuando se usan claves administradas por el cliente, puede rotar la clave MEK.</span><span class="sxs-lookup"><span data-stu-id="3da63-222">When you are using customer-managed keys, you can rotate the MEK.</span></span> <span data-ttu-id="3da63-223">Para aprender a configurar una cuenta de Data Lake Store con claves administradas por el cliente, consulte [Introducción](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-portal).</span><span class="sxs-lookup"><span data-stu-id="3da63-223">To learn how to set up a Data Lake Store account with customer-managed keys, see [Getting started](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-portal).</span></span>

### <a name="prerequisites"></a><span data-ttu-id="3da63-224">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="3da63-224">Prerequisites</span></span>

<span data-ttu-id="3da63-225">Cuando configuró la cuenta de Data Lake Store, eligió usar sus propias claves.</span><span class="sxs-lookup"><span data-stu-id="3da63-225">When you set up the Data Lake Store account, you have chosen to use your own keys.</span></span> <span data-ttu-id="3da63-226">Esta opción no se puede cambiar una vez creada la cuenta.</span><span class="sxs-lookup"><span data-stu-id="3da63-226">This option cannot be changed after the account has been created.</span></span> <span data-ttu-id="3da63-227">En los siguientes pasos se supone que usa claves administradas por el cliente (es decir, ha elegido sus propias claves de Key Vault).</span><span class="sxs-lookup"><span data-stu-id="3da63-227">The following steps assume that you are using customer-managed keys (that is, you have chosen your own keys from Key Vault).</span></span>

<span data-ttu-id="3da63-228">Tenga en cuenta que si usa las opciones predeterminadas para el cifrado, los datos siempre se cifran mediante claves administradas con Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="3da63-228">Note that if you use the default options for encryption, your data is always encrypted by using keys managed by Data Lake Store.</span></span> <span data-ttu-id="3da63-229">En esta opción, no tiene la posibilidad de rotar claves, ya que se administran en Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="3da63-229">In this option, you don't have the ability to rotate keys, as they are managed by Data Lake Store.</span></span>

### <a name="how-to-rotate-the-mek-in-data-lake-store"></a><span data-ttu-id="3da63-230">Rotación de la clave MEK en Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="3da63-230">How to rotate the MEK in Data Lake Store</span></span>

1. <span data-ttu-id="3da63-231">Inicie sesión en el [Portal de Azure](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="3da63-231">Sign in to the [Azure portal](https://portal.azure.com/).</span></span>
2. <span data-ttu-id="3da63-232">Vaya a la instancia de Key Vault que almacena las claves asociadas con la cuenta de Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="3da63-232">Browse to the Key Vault instance that stores your keys associated with your Data Lake Store account.</span></span> <span data-ttu-id="3da63-233">Seleccione **Claves**.</span><span class="sxs-lookup"><span data-stu-id="3da63-233">Select **Keys**.</span></span>

    ![Captura de pantalla de Key Vault](./media/data-lake-store-encryption/keyvault.png)

3.  <span data-ttu-id="3da63-235">Seleccione la clave asociada con su cuenta de Data Lake Store y cree una nueva versión de esta clave.</span><span class="sxs-lookup"><span data-stu-id="3da63-235">Select the key associated with your Data Lake Store account, and create a new version of this key.</span></span> <span data-ttu-id="3da63-236">Tenga en cuenta que Data Lake Store solo admite actualmente la rotación de claves a una nueva versión de clave.</span><span class="sxs-lookup"><span data-stu-id="3da63-236">Note that Data Lake Store currently only supports key rotation to a new version of a key.</span></span> <span data-ttu-id="3da63-237">No admite la rotación a una clave diferente.</span><span class="sxs-lookup"><span data-stu-id="3da63-237">It doesn't support rotating to a different key.</span></span>

   ![Captura de pantalla de la ventana Claves, donde se resalta Nueva versión](./media/data-lake-store-encryption/keynewversion.png)

4.  <span data-ttu-id="3da63-239">Vaya a la cuenta de almacenamiento de Data Lake Store y seleccione **Cifrado**.</span><span class="sxs-lookup"><span data-stu-id="3da63-239">Browse to the Data Lake Store storage account, and select **Encryption**.</span></span>

    ![Captura de pantalla de la ventana de la cuenta de almacenamiento de Data Lake Store, con Cifrado resaltado](./media/data-lake-store-encryption/select-encryption.png)

5.  <span data-ttu-id="3da63-241">Un mensaje le notifica que hay una nueva versión de la clave.</span><span class="sxs-lookup"><span data-stu-id="3da63-241">A message notifies you that a new key version of the key is available.</span></span> <span data-ttu-id="3da63-242">Haga clic en **Rotar clave** para actualizar la clave a la nueva versión.</span><span class="sxs-lookup"><span data-stu-id="3da63-242">Click **Rotate Key** to update the key to the new version.</span></span>

    ![Captura de pantalla de la ventana Data Lake Store con el mensaje y Rotar clave resaltado](./media/data-lake-store-encryption/rotatekey.png)

<span data-ttu-id="3da63-244">Esta operación tardará menos de dos minutos y no hay ningún tiempo de inactividad previsto debido a la rotación de claves.</span><span class="sxs-lookup"><span data-stu-id="3da63-244">This operation should take less than two minutes, and there is no expected downtime due to key rotation.</span></span> <span data-ttu-id="3da63-245">Una vez completada la operación, la nueva versión de la clave está en uso.</span><span class="sxs-lookup"><span data-stu-id="3da63-245">After the operation is complete, the new version of the key is in use.</span></span>

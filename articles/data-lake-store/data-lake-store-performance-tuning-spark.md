---
title: "Directrices para la optimización del rendimiento de Spark en Azure Data Lake Store | Microsoft Docs"
description: "Directrices para la optimización del rendimiento de Spark en Azure Data Lake Store"
services: data-lake-store
documentationcenter: 
author: stewu
manager: amitkul
editor: stewu
ms.assetid: ebde7b9f-2e51-4d43-b7ab-566417221335
ms.service: data-lake-store
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 12/19/2016
ms.author: stewu
ms.openlocfilehash: 2109744fb7ffdfafb7a86bbea355e119718af099
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="performance-tuning-guidance-for-spark-on-hdinsight-and-azure-data-lake-store"></a><span data-ttu-id="fa22a-103">Guía para la optimización del rendimiento de Spark en HDInsight y Azure Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="fa22a-103">Performance tuning guidance for Spark on HDInsight and Azure Data Lake Store</span></span>

<span data-ttu-id="fa22a-104">Cuando ajuste el rendimiento de Spark, necesitará tener en cuenta el número de aplicaciones que se ejecutarán en su clúster.</span><span class="sxs-lookup"><span data-stu-id="fa22a-104">When tuning performance on Spark, you need to consider the number of apps that will be running on your cluster.</span></span>  <span data-ttu-id="fa22a-105">De forma predeterminada, puede ejecutar 4 aplicaciones simultáneamente en su clúster HDI. (Nota: la configuración predeterminada está sujeta a cambios).</span><span class="sxs-lookup"><span data-stu-id="fa22a-105">By default, you can run 4 apps concurrently on your HDI cluster (Note: the default setting is subject to change).</span></span>  <span data-ttu-id="fa22a-106">Puede decidir usar menos aplicaciones, por lo que puede sustituir la configuración predeterminada y utilizar más del clúster para esas aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="fa22a-106">You may decide to use fewer apps so you can override the default settings and use more of the cluster for those apps.</span></span>  

## <a name="prerequisites"></a><span data-ttu-id="fa22a-107">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="fa22a-107">Prerequisites</span></span>

* <span data-ttu-id="fa22a-108">**Una suscripción de Azure**.</span><span class="sxs-lookup"><span data-stu-id="fa22a-108">**An Azure subscription**.</span></span> <span data-ttu-id="fa22a-109">Vea [Obtener evaluación gratuita de Azure](https://azure.microsoft.com/pricing/free-trial/).</span><span class="sxs-lookup"><span data-stu-id="fa22a-109">See [Get Azure free trial](https://azure.microsoft.com/pricing/free-trial/).</span></span>
* <span data-ttu-id="fa22a-110">**Una cuenta de Almacén de Azure Data Lake**.</span><span class="sxs-lookup"><span data-stu-id="fa22a-110">**An Azure Data Lake Store account**.</span></span> <span data-ttu-id="fa22a-111">Para obtener instrucciones sobre cómo crear una, consulte la [introducción al Almacén de Azure Data Lake](data-lake-store-get-started-portal.md)</span><span class="sxs-lookup"><span data-stu-id="fa22a-111">For instructions on how to create one, see [Get started with Azure Data Lake Store](data-lake-store-get-started-portal.md)</span></span>
* <span data-ttu-id="fa22a-112">**Clúster de HDInsight de Azure** con acceso a una cuenta de Almacén de Data Lake.</span><span class="sxs-lookup"><span data-stu-id="fa22a-112">**Azure HDInsight cluster** with access to a Data Lake Store account.</span></span> <span data-ttu-id="fa22a-113">Consulte [Creación de un clúster de HDInsight con Data Lake Store mediante el Portal de Azure](data-lake-store-hdinsight-hadoop-use-portal.md).</span><span class="sxs-lookup"><span data-stu-id="fa22a-113">See [Create an HDInsight cluster with Data Lake Store](data-lake-store-hdinsight-hadoop-use-portal.md).</span></span> <span data-ttu-id="fa22a-114">Asegúrese de habilitar el Escritorio remoto para el clúster.</span><span class="sxs-lookup"><span data-stu-id="fa22a-114">Make sure you enable Remote Desktop for the cluster.</span></span>
* <span data-ttu-id="fa22a-115">**Ejecutar el clúster de Spark en Azure Data Lake Store**.</span><span class="sxs-lookup"><span data-stu-id="fa22a-115">**Running Spark cluster on Azure Data Lake Store**.</span></span>  <span data-ttu-id="fa22a-116">Para obtener más información, consulte [Use HDInsight Spark cluster to analyze data in Data Lake Store](https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-apache-spark-use-with-data-lake-store) (Uso de clúster Spark en HDInsight para analizar datos en Data Lake Store).</span><span class="sxs-lookup"><span data-stu-id="fa22a-116">For more information, see [Use HDInsight Spark cluster to analyze data in Data Lake Store](https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-apache-spark-use-with-data-lake-store)</span></span>
* <span data-ttu-id="fa22a-117">**Directrices para la optimización del rendimiento en ADLS**.</span><span class="sxs-lookup"><span data-stu-id="fa22a-117">**Performance tuning guidelines on ADLS**.</span></span>  <span data-ttu-id="fa22a-118">Para conocer los conceptos generales de rendimiento, consulte [Guía para la optimización del rendimiento de Azure Data Lake Store](https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-performance-tuning-guidance).</span><span class="sxs-lookup"><span data-stu-id="fa22a-118">For general performance concepts, see [Data Lake Store Performance Tuning Guidance](https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-performance-tuning-guidance)</span></span> 

## <a name="parameters"></a><span data-ttu-id="fa22a-119">parameters</span><span class="sxs-lookup"><span data-stu-id="fa22a-119">Parameters</span></span>

<span data-ttu-id="fa22a-120">Estos son los valores más importantes que se pueden optimizar para aumentar el rendimiento en ADLS cuando ejecute trabajos de Spark:</span><span class="sxs-lookup"><span data-stu-id="fa22a-120">When running Spark jobs, here are the most important settings that can be tuned to increase performance on ADLS:</span></span>

* <span data-ttu-id="fa22a-121">**num-executors**: número de tareas simultáneas que se pueden ejecutar.</span><span class="sxs-lookup"><span data-stu-id="fa22a-121">**Num-executors** - The number of concurrent tasks that can be executed.</span></span>

* <span data-ttu-id="fa22a-122">**executor-memory**: cantidad de memoria asignada a cada ejecutor.</span><span class="sxs-lookup"><span data-stu-id="fa22a-122">**Executor-memory** - The amount of memory allocated to each executor.</span></span>

* <span data-ttu-id="fa22a-123">**executor-cores**: número de núcleos asignados a cada ejecutor.</span><span class="sxs-lookup"><span data-stu-id="fa22a-123">**Executor-cores** - The number of cores allocated to each executor.</span></span>                     

<span data-ttu-id="fa22a-124">**num-executors**. En num-executors se define el número máximo de tareas que se pueden ejecutar en paralelo.</span><span class="sxs-lookup"><span data-stu-id="fa22a-124">**Num-executors** Num-executors will set the maximum number of tasks that can run in parallel.</span></span>  <span data-ttu-id="fa22a-125">El número real de tareas que se pueden ejecutar en paralelo está limitado por los recursos de CPU y memoria disponibles en el clúster.</span><span class="sxs-lookup"><span data-stu-id="fa22a-125">The actual number of tasks that can run in parallel is bounded by the memory and CPU resources available in your cluster.</span></span>

<span data-ttu-id="fa22a-126">**executor-memory**. Es la cantidad de memoria que se asigna a cada ejecutor.</span><span class="sxs-lookup"><span data-stu-id="fa22a-126">**Executor-memory** This is the amount of memory that is being allocated to each executor.</span></span>  <span data-ttu-id="fa22a-127">La memoria necesaria para cada ejecutor depende del trabajo.</span><span class="sxs-lookup"><span data-stu-id="fa22a-127">The memory needed for each executor is dependent on the job.</span></span>  <span data-ttu-id="fa22a-128">En las operaciones complejas, la memoria debe ser mayor.</span><span class="sxs-lookup"><span data-stu-id="fa22a-128">For complex operations, the memory needs to be higher.</span></span>  <span data-ttu-id="fa22a-129">En cambio, para las simples como la lectura y escritura, los requisitos de memoria serán menores.</span><span class="sxs-lookup"><span data-stu-id="fa22a-129">For simple operations like read and write, memory requirements will be lower.</span></span>  <span data-ttu-id="fa22a-130">La cantidad de memoria para cada ejecutor puede verse en Ambari.</span><span class="sxs-lookup"><span data-stu-id="fa22a-130">The amount of memory for each executor can be viewed in Ambari.</span></span>  <span data-ttu-id="fa22a-131">En Ambari, vaya a Spark y vea la pestaña Configs (Configuraciones).</span><span class="sxs-lookup"><span data-stu-id="fa22a-131">In Ambari, navigate to Spark and view the Configs tab.</span></span>  

<span data-ttu-id="fa22a-132">**executor-cores**. Establece la cantidad de núcleos que se usan por ejecutor, lo que determina el número de subprocesos paralelos que se pueden ejecutar por ejecutor.</span><span class="sxs-lookup"><span data-stu-id="fa22a-132">**Executor-cores** This sets the amount of cores used per executor, which determines the number of parallel threads that can be run per executor.</span></span>  <span data-ttu-id="fa22a-133">Por ejemplo, si executor-cores = 2, entonces cada ejecutor puede ejecutar 2 tareas en paralelo.</span><span class="sxs-lookup"><span data-stu-id="fa22a-133">For example, if executor-cores = 2, then each executor can run 2 parallel tasks in the executor.</span></span>  <span data-ttu-id="fa22a-134">Los núcleos de ejecutor necesarios dependerán del trabajo.</span><span class="sxs-lookup"><span data-stu-id="fa22a-134">The executor-cores needed will be dependent on the job.</span></span>  <span data-ttu-id="fa22a-135">Los trabajos con muchas E/S no requieren una gran cantidad de memoria por tarea, por lo que cada ejecutor puede administrar más tareas paralelas.</span><span class="sxs-lookup"><span data-stu-id="fa22a-135">I/O heavy jobs do not require a large amount of memory per task so each executor can handle more parallel tasks.</span></span>

<span data-ttu-id="fa22a-136">De forma predeterminada, se definen dos núcleos YARN virtuales para cada núcleo físico cuando se ejecuta Spark en HDInsight.</span><span class="sxs-lookup"><span data-stu-id="fa22a-136">By default, two virtual YARN cores are defined for each physical core when running Spark on HDInsight.</span></span>  <span data-ttu-id="fa22a-137">Este número proporciona un buen equilibrio entre simultaneidad y la cantidad de cambios de contexto desde varios subprocesos.</span><span class="sxs-lookup"><span data-stu-id="fa22a-137">This number provides a good balance of concurrecy and amount of context switching from multiple threads.</span></span>  

## <a name="guidance"></a><span data-ttu-id="fa22a-138">Guía</span><span class="sxs-lookup"><span data-stu-id="fa22a-138">Guidance</span></span>

<span data-ttu-id="fa22a-139">Si va a ejecute cargas de trabajo de análisis de Spark para trabajar con datos de Data Lake Store, se recomienda usar la versión más reciente de HDInsight para conseguir el mejor rendimiento con Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="fa22a-139">While running Spark analytic workloads to work with data in Data Lake Store, we recommend that you use the most recent HDInsight version to get the best performance with Data Lake Store.</span></span> <span data-ttu-id="fa22a-140">Si el trabajo tiene un uso intensivo de E/S, hay determinados parámetros que puede configurar para mejorar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="fa22a-140">When your job is more I/O intensive, then certain parameters can be configured to improve performance.</span></span>  <span data-ttu-id="fa22a-141">Azure Data Lake Store es una plataforma de almacenamiento altamente escalable que puede controlar un alto rendimiento.</span><span class="sxs-lookup"><span data-stu-id="fa22a-141">Azure Data Lake Store is a highly scalable storage platform that can handle high throughput.</span></span>  <span data-ttu-id="fa22a-142">Si el trabajo está compuesto principalmente por lecturas o escrituras, aumentar la simultaneidad de E/S hacia y desde Azure Data Lake Store podría aumentar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="fa22a-142">If the job mainly consists of read or writes, then increasing concurrency for I/O to and from Azure Data Lake Store could increase performance.</span></span>

<span data-ttu-id="fa22a-143">Hay varias formas de aumentar la simultaneidad de trabajos con uso intensivo de E/S.</span><span class="sxs-lookup"><span data-stu-id="fa22a-143">There are a few general ways to increase concurrency for I/O intensive jobs.</span></span>

<span data-ttu-id="fa22a-144">**Paso 1: determine cuántas aplicaciones se ejecutan en el clúster**. Debe conocer cuántas aplicaciones se están ejecutando en el clúster, incluida la actual.</span><span class="sxs-lookup"><span data-stu-id="fa22a-144">**Step 1: Determine how many apps are running on your cluster** – You should know how many apps are running on the cluster including the current one.</span></span>  <span data-ttu-id="fa22a-145">Los valores predeterminados para cada ajuste de Spark asume que hay 4 aplicaciones ejecutándose simultáneamente.</span><span class="sxs-lookup"><span data-stu-id="fa22a-145">The default values for each Spark setting assumes that there are 4 apps running concurrently.</span></span>  <span data-ttu-id="fa22a-146">Por lo tanto, solo habrá un 25 % del clúster disponible para cada aplicación.</span><span class="sxs-lookup"><span data-stu-id="fa22a-146">Therefore, you will only have 25% of the cluster available for each app.</span></span>  <span data-ttu-id="fa22a-147">Para obtener un mejor rendimiento, puede sustituir los valores predeterminados cambiando el número de ejecutores.</span><span class="sxs-lookup"><span data-stu-id="fa22a-147">To get better performance, you can override the defaults by changing the number of executors.</span></span>  

<span data-ttu-id="fa22a-148">**Paso 2: establezca executor-memory**. Lo primero que se debe establecer es executor-memory.</span><span class="sxs-lookup"><span data-stu-id="fa22a-148">**Step 2: Set executor-memory** – the first thing to set is the executor-memory.</span></span>  <span data-ttu-id="fa22a-149">La memoria dependerá el trabajo que va a ejecutar.</span><span class="sxs-lookup"><span data-stu-id="fa22a-149">The memory will be dependent on the job that you are going to run.</span></span>  <span data-ttu-id="fa22a-150">Puede aumentar la simultaneidad asignando menos memoria a cada ejecutor.</span><span class="sxs-lookup"><span data-stu-id="fa22a-150">You can increase concurrency by allocating less memory per executor.</span></span>  <span data-ttu-id="fa22a-151">Si ve excepciones por memoria insuficiente cuando ejecuta el trabajo, aumente el valor para este parámetro.</span><span class="sxs-lookup"><span data-stu-id="fa22a-151">If you see out of memory exceptions when you run your job, then you should increase the value for this parameter.</span></span>  <span data-ttu-id="fa22a-152">Otra alternativa consiste en obtener más memoria mediante un clúster que tenga mayor cantidad de la misma o aumentar el número de nodos en el clúster.</span><span class="sxs-lookup"><span data-stu-id="fa22a-152">One alternative is to get more memory by using a cluster that has higher amounts of memory or increasing the size of your cluster.</span></span>  <span data-ttu-id="fa22a-153">Mientras más memoria tenga, más ejecutores podrá utilizar, lo que se traduce en una mayor simultaneidad.</span><span class="sxs-lookup"><span data-stu-id="fa22a-153">More memory will enable more executors to be used, which means more concurrency.</span></span>

<span data-ttu-id="fa22a-154">**Paso 3: establezca executor-cores**. En cargas de trabajo con uso intensivo de E/S que no tengan operaciones complejas, es recomendable empezar con un gran número de núcleos de ejecutor para aumentar el número de tareas paralelas por cada ejecutor.</span><span class="sxs-lookup"><span data-stu-id="fa22a-154">**Step 3: Set executor-cores** – For I/O intensive workloads that do not have complex operations, it’s good to start with a high number of executor-cores to increase the number of parallel tasks per executor.</span></span>  <span data-ttu-id="fa22a-155">Un buen punto de partida sería establecer executor-cores en 4.</span><span class="sxs-lookup"><span data-stu-id="fa22a-155">Setting executor-cores to 4 is a good start.</span></span>   

    executor-cores = 4
<span data-ttu-id="fa22a-156">Si aumenta el número de núcleos de ejecutor podrá tener mayor paralelismo, con lo que puede experimentar con diferentes valores para executor-cores.</span><span class="sxs-lookup"><span data-stu-id="fa22a-156">Increasing the number of executor-cores will give you more parallelism so you can experiment with different executor-cores.</span></span>  <span data-ttu-id="fa22a-157">Para los trabajos que tengan operaciones más complejas, reduzca el número de núcleos por ejecutor.</span><span class="sxs-lookup"><span data-stu-id="fa22a-157">For jobs that have more complex operations, you should reduce the number of cores per executor.</span></span>  <span data-ttu-id="fa22a-158">Si executor-cores se ha establecido en un número mayor que 4, puede que la recolección de elementos no utilizados sea ineficaz y el rendimiento se vea degradado.</span><span class="sxs-lookup"><span data-stu-id="fa22a-158">If executor-cores is set higher than 4, then garbage collection may become inefficient and degrade performance.</span></span>

<span data-ttu-id="fa22a-159">**Paso 4: determine la cantidad de memoria YARN en el clúster**. Esta información está disponible en Ambari.</span><span class="sxs-lookup"><span data-stu-id="fa22a-159">**Step 4: Determine amount of YARN memory in cluster** – This information is available in Ambari.</span></span>  <span data-ttu-id="fa22a-160">Vaya a YARN y vea la pestaña Configs (Configuraciones).</span><span class="sxs-lookup"><span data-stu-id="fa22a-160">Navigate to YARN and view the Configs tab.</span></span>  <span data-ttu-id="fa22a-161">La memoria YARN se muestra en esta ventana.</span><span class="sxs-lookup"><span data-stu-id="fa22a-161">The YARN memory is displayed in this window.</span></span>  
<span data-ttu-id="fa22a-162">Nota: mientras está en la ventana puede ver también el tamaño predeterminado del contenedor YARN.</span><span class="sxs-lookup"><span data-stu-id="fa22a-162">Note: while you are in the window, you can also see the default YARN container size.</span></span>  <span data-ttu-id="fa22a-163">El tamaño del contenedor YARN es igual que la memoria por cada parámetro de ejecutor.</span><span class="sxs-lookup"><span data-stu-id="fa22a-163">The YARN container size is the same as memory per executor paramter.</span></span>

    Total YARN memory = nodes * YARN memory per node
<span data-ttu-id="fa22a-164">**Paso 5: calcule num-executors**</span><span class="sxs-lookup"><span data-stu-id="fa22a-164">**Step 5: Calculate num-executors**</span></span>

<span data-ttu-id="fa22a-165">**Calcule la restricción de memoria**: el parámetro num-executors está restringido por la memoria o por la CPU.</span><span class="sxs-lookup"><span data-stu-id="fa22a-165">**Calculate memory constraint** - The num-executors parameter is constrained either by memory or by CPU.</span></span>  <span data-ttu-id="fa22a-166">La restricción de memoria se determina por la cantidad de memoria YARN disponible para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="fa22a-166">The memory constraint is determined by the amount of available YARN memory for your application.</span></span>  <span data-ttu-id="fa22a-167">Tome la memoria total de YARN y divídala por la memoria del ejecutor.</span><span class="sxs-lookup"><span data-stu-id="fa22a-167">You should take total YARN memory and divide that by executor-memory.</span></span>  <span data-ttu-id="fa22a-168">La restricción debe adaptarse al número de aplicaciones, por lo que dividiremos entre dicho número.</span><span class="sxs-lookup"><span data-stu-id="fa22a-168">The constraint needs to be de-scaled for the number of apps so we divide by the number of apps.</span></span>

    Memory constraint = (total YARN memory / executor memory) / # of apps   
<span data-ttu-id="fa22a-169">**Calcule la restricción de CPU**: la restricción de la CPU se calcula como el total de núcleos virtuales divididos por el número de núcleos por ejecutor.</span><span class="sxs-lookup"><span data-stu-id="fa22a-169">**Calculate CPU constraint** - The CPU constraint is calculated as the total virtual cores divided by the number of cores per executor.</span></span>  <span data-ttu-id="fa22a-170">Hay 2 núcleos virtuales para cada núcleo físico.</span><span class="sxs-lookup"><span data-stu-id="fa22a-170">There are 2 virtual cores for each physical core.</span></span>  <span data-ttu-id="fa22a-171">Al igual que en la restricción de memoria, se divide por el número de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="fa22a-171">Similar to the memory constraint, we have divide by the number of apps.</span></span>

    virtual cores = (nodes in cluster * # of physical cores in node * 2)
    CPU constraint = (total virtual cores / # of cores per executor) / # of apps
<span data-ttu-id="fa22a-172">**Establezca num-executors**: el parámetro num-executors se determina con la restricción de memoria y la restricción de CPU mínimas.</span><span class="sxs-lookup"><span data-stu-id="fa22a-172">**Set num-executors** – The num-executors parameter is determined by taking the minimum of the memory constraint and the CPU constraint.</span></span> 

    num-executors = Min (total virtual Cores / # of cores per executor, available YARN memory / executor-memory)   
<span data-ttu-id="fa22a-173">El hecho de establecer un número mayor de ejecutores no tiene por qué aumentar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="fa22a-173">Setting a higher number of num-executors does not necessarily increase performance.</span></span>  <span data-ttu-id="fa22a-174">Debe tener en cuenta que al agregar más ejecutores pondrá una sobrecarga adicional a cada ejecutor que agregue, lo que podría reducir el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="fa22a-174">You should consider that adding more executors will add extra overhead for each additional executor, which can potentially degrade performance.</span></span>  <span data-ttu-id="fa22a-175">El valor de num-executors está limitado por los recursos del clúster.</span><span class="sxs-lookup"><span data-stu-id="fa22a-175">Num-executors is bounded by the cluster resources.</span></span>    

## <a name="example-calculation"></a><span data-ttu-id="fa22a-176">Cálculo de ejemplo</span><span class="sxs-lookup"><span data-stu-id="fa22a-176">Example Calculation</span></span>

<span data-ttu-id="fa22a-177">Supongamos que tiene actualmente un clúster compuesto de 8 nodos D4v2 que están ejecutando 2 aplicaciones, incluida la que se va a ejecutar.</span><span class="sxs-lookup"><span data-stu-id="fa22a-177">Let’s say you currently have a cluster composed of 8 D4v2 nodes that is running 2 apps including the one you are going to run.</span></span>  

<span data-ttu-id="fa22a-178">**Paso 1: determine las aplicaciones se ejecutan en el clúster**. Sabe que tiene 2 aplicaciones en el clúster, incluida la que se va a ejecutar.</span><span class="sxs-lookup"><span data-stu-id="fa22a-178">**Step 1: Determine how many apps are running on your cluster** – you know that you have 2 apps on your cluster, including the one you are going to run.</span></span>  

<span data-ttu-id="fa22a-179">**Paso 2: establezca executor-memory**. En este ejemplo, determinamos que 6 GB de memoria de ejecutor serán suficientes para trabajos con uso intensivo de E/S.</span><span class="sxs-lookup"><span data-stu-id="fa22a-179">**Step 2: Set executor-memory** – for this example, we determine that 6GB of executor-memory will be sufficient for I/O intensive job.</span></span>  

    executor-memory = 6GB
<span data-ttu-id="fa22a-180">**Paso 3: establezca executor-cores**. Puesto que se trata de un trabajo con uso intensivo de E/S, podemos establecer el número de núcleos para cada ejecutor a 4.</span><span class="sxs-lookup"><span data-stu-id="fa22a-180">**Step 3: Set executor-cores** – Since this is an I/O intensive job, we can set the number of cores for each executor to 4.</span></span>  <span data-ttu-id="fa22a-181">Si establece los núcleos por ejecutor en un número mayor que 4 puede causar problemas de colección de elementos no utilizados.</span><span class="sxs-lookup"><span data-stu-id="fa22a-181">Setting cores per executor to larger than 4 may cause garbage collection problems.</span></span>  

    executor-cores = 4
<span data-ttu-id="fa22a-182">**Paso 4: determine la cantidad de memoria YARN en clúster**. Navegamos a Ambari para averiguar que cada D4v2 tiene 25 GB de memoria YARN.</span><span class="sxs-lookup"><span data-stu-id="fa22a-182">**Step 4: Determine amount of YARN memory in cluster** – We navigate to Ambari to find out that each D4v2 has 25GB of YARN memory.</span></span>  <span data-ttu-id="fa22a-183">Dado que hay 8 nodos, la memoria YARN disponible se multiplica por 8.</span><span class="sxs-lookup"><span data-stu-id="fa22a-183">Since there are 8 nodes, the available YARN memory is multiplied by 8.</span></span>

    Total YARN memory = nodes * YARN memory* per node
    Total YARN memory = 8 nodes * 25GB = 200GB
<span data-ttu-id="fa22a-184">**Paso 5: calcule num-executors**. El parámetro num-executors se determina a partir de la restricción mínima de memoria y de CPU, dividida por el número de aplicaciones que están ejecutando en Spark.</span><span class="sxs-lookup"><span data-stu-id="fa22a-184">**Step 5: Calculate num-executors** – The num-executors parameter is determined by taking the minimum of the memory constraint and the CPU constraint divided by the # of apps running on Spark.</span></span>    

<span data-ttu-id="fa22a-185">**Calcule la restricción de memoria**. La restricción de memoria se calcula dividiendo la memoria YARN total entre la memoria por ejecutor.</span><span class="sxs-lookup"><span data-stu-id="fa22a-185">**Calculate memory constraint** – The memory constraint is calculated as the total YARN memory divided by the memory per executor.</span></span>

    Memory constraint = (total YARN memory / executor memory) / # of apps   
    Memory constraint = (200GB / 6GB) / 2   
    Memory constraint = 16 (rounded)
<span data-ttu-id="fa22a-186">**Calcule la restricción de CPU**. La restricción de la CPU se calcula dividiendo el total de núcleos YARN entre el número de núcleos por ejecutor.</span><span class="sxs-lookup"><span data-stu-id="fa22a-186">**Calculate CPU constraint** - The CPU constraint is calculated as the total yarn cores divided by the number of cores per executor.</span></span>
    
    YARN cores = nodes in cluster * # of cores per node * 2   
    YARN cores = 8 nodes * 8 cores per D14 * 2 = 128
    CPU constraint = (total YARN cores / # of cores per executor) / # of apps
    CPU constraint = (128 / 4) / 2
    CPU constraint = 16
<span data-ttu-id="fa22a-187">**Establezca num-executors**</span><span class="sxs-lookup"><span data-stu-id="fa22a-187">**Set num-executors**</span></span>

    num-executors = Min (memory constraint, CPU constraint)
    num-executors = Min (16, 16)
    num-executors = 16    


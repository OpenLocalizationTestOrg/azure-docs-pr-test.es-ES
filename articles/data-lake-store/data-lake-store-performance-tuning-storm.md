---
title: "Guía para la optimización del rendimiento de Azure Data Lake Store | Microsoft Docs"
description: "Guía para la optimización del rendimiento de Azure Data Lake Store"
services: data-lake-store
documentationcenter: 
author: stewu
manager: amitkul
editor: stewu
ms.assetid: ebde7b9f-2e51-4d43-b7ab-566417221335
ms.service: data-lake-store
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 12/19/2016
ms.author: stewu
ms.openlocfilehash: 1dfa93643f45a96ded3fd022aa8b1c71d487acb4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="performance-tuning-guidance-for-storm-on-hdinsight-and-azure-data-lake-store"></a><span data-ttu-id="15d6c-103">Guía para la optimización del rendimiento de Storm en HDInsight y Azure Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="15d6c-103">Performance tuning guidance for Storm on HDInsight and Azure Data Lake Store</span></span>

<span data-ttu-id="15d6c-104">Esta guía le ayuda a comprender los factores que se deben tener en cuenta al optimizar el rendimiento de una topología de Azure Storm.</span><span class="sxs-lookup"><span data-stu-id="15d6c-104">Understand the factors that should be considered when you tune the performance of an Azure Storm topology.</span></span> <span data-ttu-id="15d6c-105">Por ejemplo, es importante comprender las características del trabajo realizado por los spouts y los bolts (si el trabajo hace un uso intensivo de memoria o E/S).</span><span class="sxs-lookup"><span data-stu-id="15d6c-105">For example, it's important to understand the characteristics of the work done by the spouts and the bolts (whether the work is I/O or memory intensive).</span></span> <span data-ttu-id="15d6c-106">En este artículo se describen varias directrices de optimización del rendimiento y se incluyen soluciones a problemas comunes.</span><span class="sxs-lookup"><span data-stu-id="15d6c-106">This article covers a range of performance tuning guidelines, including troubleshooting common issues.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="15d6c-107">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="15d6c-107">Prerequisites</span></span>

* <span data-ttu-id="15d6c-108">**Una suscripción de Azure**.</span><span class="sxs-lookup"><span data-stu-id="15d6c-108">**An Azure subscription**.</span></span> <span data-ttu-id="15d6c-109">Vea [Obtener evaluación gratuita de Azure](https://azure.microsoft.com/pricing/free-trial/).</span><span class="sxs-lookup"><span data-stu-id="15d6c-109">See [Get Azure free trial](https://azure.microsoft.com/pricing/free-trial/).</span></span>
* <span data-ttu-id="15d6c-110">**Una cuenta de Almacén de Azure Data Lake**.</span><span class="sxs-lookup"><span data-stu-id="15d6c-110">**An Azure Data Lake Store account**.</span></span> <span data-ttu-id="15d6c-111">Para obtener instrucciones sobre cómo crear una, consulte la [introducción a Azure Data Lake Store](data-lake-store-get-started-portal.md).</span><span class="sxs-lookup"><span data-stu-id="15d6c-111">For instructions on how to create one, see [Get started with Azure Data Lake Store](data-lake-store-get-started-portal.md).</span></span>
* <span data-ttu-id="15d6c-112">**Clúster de Azure HDInsight** con acceso a una cuenta de Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="15d6c-112">**An Azure HDInsight cluster** with access to a Data Lake Store account.</span></span> <span data-ttu-id="15d6c-113">Consulte [Creación de un clúster de HDInsight con Data Lake Store mediante el Portal de Azure](data-lake-store-hdinsight-hadoop-use-portal.md).</span><span class="sxs-lookup"><span data-stu-id="15d6c-113">See [Create an HDInsight cluster with Data Lake Store](data-lake-store-hdinsight-hadoop-use-portal.md).</span></span> <span data-ttu-id="15d6c-114">Asegúrese de habilitar el Escritorio remoto para el clúster.</span><span class="sxs-lookup"><span data-stu-id="15d6c-114">Make sure you enable Remote Desktop for the cluster.</span></span>
* <span data-ttu-id="15d6c-115">**Ejecución de un clúster de Storm en Data Lake Store**.</span><span class="sxs-lookup"><span data-stu-id="15d6c-115">**Running a Storm cluster on Data Lake Store**.</span></span> <span data-ttu-id="15d6c-116">Para más información, consulte [Storm en HDInsight](https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-storm-overview).</span><span class="sxs-lookup"><span data-stu-id="15d6c-116">For more information, see [Storm on HDInsight](https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-storm-overview).</span></span>
* <span data-ttu-id="15d6c-117">**Guía para la optimización del rendimiento en Data Lake Store**.</span><span class="sxs-lookup"><span data-stu-id="15d6c-117">**Performance tuning guidelines on Data Lake Store**.</span></span>  <span data-ttu-id="15d6c-118">Para conocer los conceptos generales sobre rendimiento, consulte [Guía para la optimización del rendimiento de Data Lake Store](https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-performance-tuning-guidance).</span><span class="sxs-lookup"><span data-stu-id="15d6c-118">For general performance concepts, see [Data Lake Store Performance Tuning Guidance](https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-performance-tuning-guidance).</span></span>  

## <a name="tune-the-parallelism-of-the-topology"></a><span data-ttu-id="15d6c-119">Ajuste del paralelismo de la topología</span><span class="sxs-lookup"><span data-stu-id="15d6c-119">Tune the parallelism of the topology</span></span>

<span data-ttu-id="15d6c-120">Es posible que pueda mejorar el rendimiento si aumenta la simultaneidad de E/S hacia y desde Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="15d6c-120">You might be able to improve performance by increasing the concurrency of the I/O to and from Data Lake Store.</span></span> <span data-ttu-id="15d6c-121">Una topología de Storm tiene un conjunto de configuraciones que determinan el paralelismo:</span><span class="sxs-lookup"><span data-stu-id="15d6c-121">A Storm topology has a set of configurations that determine the parallelism:</span></span>
* <span data-ttu-id="15d6c-122">Número de procesos de trabajo: los trabajos se distribuyen uniformemente entre las máquinas virtuales</span><span class="sxs-lookup"><span data-stu-id="15d6c-122">Number of worker processes (the workers are evenly distributed across the VMs).</span></span>
* <span data-ttu-id="15d6c-123">Número de instancias de ejecutor de spout</span><span class="sxs-lookup"><span data-stu-id="15d6c-123">Number of spout executor instances.</span></span>
* <span data-ttu-id="15d6c-124">Número de instancias de ejecutor de bolt</span><span class="sxs-lookup"><span data-stu-id="15d6c-124">Number of bolt executor instances.</span></span>
* <span data-ttu-id="15d6c-125">Número de tareas de spout</span><span class="sxs-lookup"><span data-stu-id="15d6c-125">Number of spout tasks.</span></span>
* <span data-ttu-id="15d6c-126">Número de tareas de bolt</span><span class="sxs-lookup"><span data-stu-id="15d6c-126">Number of bolt tasks.</span></span>

<span data-ttu-id="15d6c-127">Por ejemplo, en un clúster con 4 máquinas virtuales y 4 procesos de trabajo, 32 ejecutores de spout, 32 tareas de spout, 256 ejecutores de bolt y 512 tareas de bolt, tenga en cuenta lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="15d6c-127">For example, on a cluster with 4 VMs and 4 worker processes, 32 spout executors and 32 spout tasks, and 256 bolt executors and 512 bolt tasks, consider the following:</span></span>

<span data-ttu-id="15d6c-128">Cada supervisor, que es un nodo de trabajo, tiene un solo proceso de trabajo de máquina virtual Java (JVM).</span><span class="sxs-lookup"><span data-stu-id="15d6c-128">Each supervisor, which is a worker node, has a single worker Java virtual machine (JVM) process.</span></span> <span data-ttu-id="15d6c-129">Este proceso de JVM administra 4 subprocesos de spout y 64 subprocesos de bolt.</span><span class="sxs-lookup"><span data-stu-id="15d6c-129">This JVM process manages 4 spout threads and 64 bolt threads.</span></span> <span data-ttu-id="15d6c-130">Dentro de cada subproceso, las tareas se ejecutan secuencialmente.</span><span class="sxs-lookup"><span data-stu-id="15d6c-130">Within each thread, tasks are run sequentially.</span></span> <span data-ttu-id="15d6c-131">Con la configuración anterior, cada subproceso de spout tiene 1 tarea y cada subproceso de bolt tiene 2 tareas.</span><span class="sxs-lookup"><span data-stu-id="15d6c-131">With the preceding configuration, each spout thread has 1 task, and each bolt thread has 2 tasks.</span></span>

<span data-ttu-id="15d6c-132">En Storm, estos son los diversos componentes implicados y así es cómo afectan al nivel de paralelismo que tiene:</span><span class="sxs-lookup"><span data-stu-id="15d6c-132">In Storm, here are the various components involved, and how they affect the level of parallelism you have:</span></span>
* <span data-ttu-id="15d6c-133">El nodo principal (denominado Nimbus en Storm) se utiliza para enviar y administrar los trabajos.</span><span class="sxs-lookup"><span data-stu-id="15d6c-133">The head node (called Nimbus in Storm) is used to submit and manage jobs.</span></span> <span data-ttu-id="15d6c-134">Estos nodos afectan al grado de paralelismo.</span><span class="sxs-lookup"><span data-stu-id="15d6c-134">These nodes have no impact on the degree of parallelism.</span></span>
* <span data-ttu-id="15d6c-135">Nodos de supervisor.</span><span class="sxs-lookup"><span data-stu-id="15d6c-135">The supervisor nodes.</span></span> <span data-ttu-id="15d6c-136">En HDInsight, corresponde a un nodo de trabajo de una máquina virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="15d6c-136">In HDInsight, this corresponds to a worker node Azure VM.</span></span>
* <span data-ttu-id="15d6c-137">Las tareas de trabajo son procesos de Storm que se ejecutan en las VM.</span><span class="sxs-lookup"><span data-stu-id="15d6c-137">The worker tasks are Storm processes running in the VMs.</span></span> <span data-ttu-id="15d6c-138">Cada tarea de trabajo corresponde a una instancia de JVM.</span><span class="sxs-lookup"><span data-stu-id="15d6c-138">Each worker task corresponds to a JVM instance.</span></span> <span data-ttu-id="15d6c-139">Storm distribuye el número de procesos de trabajo que especifique a los nodos de trabajo lo más uniformemente posible.</span><span class="sxs-lookup"><span data-stu-id="15d6c-139">Storm distributes the number of worker processes you specify to the worker nodes as evenly as possible.</span></span>
* <span data-ttu-id="15d6c-140">Instancias de ejecutor de bolt y spout.</span><span class="sxs-lookup"><span data-stu-id="15d6c-140">Spout and bolt executor instances.</span></span> <span data-ttu-id="15d6c-141">Cada instancia de ejecutor corresponde a un subproceso que se ejecuta dentro de los trabajos (máquinas virtuales Java).</span><span class="sxs-lookup"><span data-stu-id="15d6c-141">Each executor instance corresponds to a thread running within the workers (JVMs).</span></span>
* <span data-ttu-id="15d6c-142">Tareas de Storm.</span><span class="sxs-lookup"><span data-stu-id="15d6c-142">Storm tasks.</span></span> <span data-ttu-id="15d6c-143">Son tareas lógicas que ejecuta cada uno de estos subprocesos.</span><span class="sxs-lookup"><span data-stu-id="15d6c-143">These are logical tasks that each of these threads run.</span></span> <span data-ttu-id="15d6c-144">Esto no cambia el nivel de paralelismo, por lo que se debe evaluar si necesita o no varias tareas por ejecutor.</span><span class="sxs-lookup"><span data-stu-id="15d6c-144">This does not change the level of parallelism, so you should evaluate if you need multiple tasks per executor or not.</span></span>

### <a name="get-the-best-performance-from-data-lake-store"></a><span data-ttu-id="15d6c-145">Obtener el mejor rendimiento de Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="15d6c-145">Get the best performance from Data Lake Store</span></span>

<span data-ttu-id="15d6c-146">Cuando trabaje con Data Lake Store, obtendrá el mejor rendimiento con estas sugerencias:</span><span class="sxs-lookup"><span data-stu-id="15d6c-146">When working with Data Lake Store, you get the best performance if you do the following:</span></span>
* <span data-ttu-id="15d6c-147">Fusione sus anexos más pequeños en tamaños más grandes (lo ideal son 4 MB).</span><span class="sxs-lookup"><span data-stu-id="15d6c-147">Coalesce your small appends into larger sizes (ideally 4 MB).</span></span>
* <span data-ttu-id="15d6c-148">Realice tantas solicitudes simultáneas como pueda.</span><span class="sxs-lookup"><span data-stu-id="15d6c-148">Do as many concurrent requests as you can.</span></span> <span data-ttu-id="15d6c-149">Como cada subproceso de bolt realiza lecturas de bloqueo, querrá tener entre 8 y 12 subprocesos por núcleo.</span><span class="sxs-lookup"><span data-stu-id="15d6c-149">Because each bolt thread is doing blocking reads, you want to have somewhere in the range of 8-12 threads per core.</span></span> <span data-ttu-id="15d6c-150">De esta manera el nivel de utilización de la NIC y la CPU es adecuado.</span><span class="sxs-lookup"><span data-stu-id="15d6c-150">This keeps the NIC and the CPU well utilized.</span></span> <span data-ttu-id="15d6c-151">Una máquina virtual más grande permite más solicitudes simultáneas.</span><span class="sxs-lookup"><span data-stu-id="15d6c-151">A larger VM enables more concurrent requests.</span></span>  

### <a name="example-topology"></a><span data-ttu-id="15d6c-152">Topología de ejemplo</span><span class="sxs-lookup"><span data-stu-id="15d6c-152">Example topology</span></span>

<span data-ttu-id="15d6c-153">Supongamos que tiene un clúster de 8 nodos de trabajo con una máquina virtual de Azure D13v2.</span><span class="sxs-lookup"><span data-stu-id="15d6c-153">Let’s assume you have an 8 worker node cluster with a D13v2 Azure VM.</span></span> <span data-ttu-id="15d6c-154">Esta máquina virtual tiene 8 núcleos, así que entre los 8 nodos de trabajo, tiene un total de 64 núcleos.</span><span class="sxs-lookup"><span data-stu-id="15d6c-154">This VM has 8 cores, so among the 8 worker nodes, you have 64 total cores.</span></span>

<span data-ttu-id="15d6c-155">Digamos que hacemos 8 subprocesos de bolt por núcleo.</span><span class="sxs-lookup"><span data-stu-id="15d6c-155">Let’s say we do 8 bolt threads per core.</span></span> <span data-ttu-id="15d6c-156">Como hay 64 núcleos, significa que queremos 512 instancias de ejecutor de bolt (es decir, subprocesos) en total.</span><span class="sxs-lookup"><span data-stu-id="15d6c-156">Given 64 cores, that means we want 512 total bolt executor instances (that is, threads).</span></span> <span data-ttu-id="15d6c-157">En este caso, supongamos que empezamos con una JVM por máquina virtual y usamos principalmente la simultaneidad de subprocesos dentro de la JVM para conseguir simultaneidad.</span><span class="sxs-lookup"><span data-stu-id="15d6c-157">In this case, let’s say we start with one JVM per VM, and mainly use the thread concurrency within the JVM to achieve concurrency.</span></span> <span data-ttu-id="15d6c-158">Esto significa que necesitamos 8 tareas de trabajo (una por cada VM de Azure) y 512 ejecutores de bolt.</span><span class="sxs-lookup"><span data-stu-id="15d6c-158">That means we need 8 worker tasks (one per Azure VM), and 512 bolt executors.</span></span> <span data-ttu-id="15d6c-159">Dada esta configuración, Storm intenta distribuir los trabajos uniformemente entre los nodos de trabajo (también conocidos como nodos de supervisor), dando a cada nodo de trabajo 1 JVM.</span><span class="sxs-lookup"><span data-stu-id="15d6c-159">Given this configuration, Storm tries to distribute the workers evenly across worker nodes (also known as supervisor nodes), giving each worker node 1 JVM.</span></span> <span data-ttu-id="15d6c-160">Ahora, dentro de los supervisores, Storm intenta distribuir los ejecutores uniformemente entre los supervisores, dando a cada supervisor (es decir, JVM) 8 subprocesos.</span><span class="sxs-lookup"><span data-stu-id="15d6c-160">Now within the supervisors, Storm tries to distribute the executors evenly between supervisors, giving each supervisor (that is, JVM) 8 threads each.</span></span>

## <a name="tune-additional-parameters"></a><span data-ttu-id="15d6c-161">Ajuste de parámetros adicionales</span><span class="sxs-lookup"><span data-stu-id="15d6c-161">Tune additional parameters</span></span>
<span data-ttu-id="15d6c-162">Una vez que tenga la topología básica, puede valorar si desea modificar alguno de los parámetros:</span><span class="sxs-lookup"><span data-stu-id="15d6c-162">After you have the basic topology, you can consider whether you want to tweak any of the parameters:</span></span>
* <span data-ttu-id="15d6c-163">**Number of JVMs per worker node** (Número total de JVM por nodo de trabajo).</span><span class="sxs-lookup"><span data-stu-id="15d6c-163">**Number of JVMs per worker node.**</span></span> <span data-ttu-id="15d6c-164">Si tiene una estructura de datos de gran tamaño (por ejemplo, una tabla de búsqueda) que se hospeda en memoria, cada JVM requiere una copia independiente.</span><span class="sxs-lookup"><span data-stu-id="15d6c-164">If you have a large data structure (for example, a lookup table) that you host in memory, each JVM requires a separate copy.</span></span> <span data-ttu-id="15d6c-165">Como alternativa, puede usar la estructura de datos en muchos subprocesos si tiene menos JVM.</span><span class="sxs-lookup"><span data-stu-id="15d6c-165">Alternatively, you can use the data structure across many threads if you have fewer JVMs.</span></span> <span data-ttu-id="15d6c-166">Para la E/S del bolt, el número de JVM no supone una gran diferencia con respecto al número de subprocesos agregados en esas JVM.</span><span class="sxs-lookup"><span data-stu-id="15d6c-166">For the bolt’s I/O, the number of JVMs does not make as much of a difference as the number of threads added across those JVMs.</span></span> <span data-ttu-id="15d6c-167">Para simplificar, es una buena idea tener una JVM por trabajo.</span><span class="sxs-lookup"><span data-stu-id="15d6c-167">For simplicity, it's a good idea to have one JVM per worker.</span></span> <span data-ttu-id="15d6c-168">No obstante, dependiendo de lo que haga el bolt o del procesamiento de aplicaciones que requiera, puede que necesite cambiar este número.</span><span class="sxs-lookup"><span data-stu-id="15d6c-168">Depending on what your bolt is doing or what application processing you require, though, you may need to change this number.</span></span>
* <span data-ttu-id="15d6c-169">**Number of spout executors** (Número de ejecutores de spout)</span><span class="sxs-lookup"><span data-stu-id="15d6c-169">**Number of spout executors.**</span></span> <span data-ttu-id="15d6c-170">Como en el ejemplo anterior se usan bolts para escribir en Data Lake Store, el número de spouts no está relacionado directamente con el rendimiento del bolt.</span><span class="sxs-lookup"><span data-stu-id="15d6c-170">Because the preceding example uses bolts for writing to Data Lake Store, the number of spouts is not directly relevant to the bolt performance.</span></span> <span data-ttu-id="15d6c-171">Sin embargo, según la cantidad de procesamiento o E/S que se realice en el spout, es una buena idea ajustar los spouts para mejorar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="15d6c-171">However, depending on the amount of processing or I/O happening in the spout, it's a good idea to tune the spouts for best performance.</span></span> <span data-ttu-id="15d6c-172">Asegúrese de tener spouts suficientes para que los bolts se mantengan ocupados.</span><span class="sxs-lookup"><span data-stu-id="15d6c-172">Ensure that you have enough spouts to be able to keep the bolts busy.</span></span> <span data-ttu-id="15d6c-173">Las velocidades de salida de los spouts deben coincidir con el rendimiento de los bolts.</span><span class="sxs-lookup"><span data-stu-id="15d6c-173">The output rates of the spouts should match the throughput of the bolts.</span></span> <span data-ttu-id="15d6c-174">La configuración real depende del spout.</span><span class="sxs-lookup"><span data-stu-id="15d6c-174">The actual configuration depends on the spout.</span></span>
* <span data-ttu-id="15d6c-175">**Number of tasks** (Número de tareas)</span><span class="sxs-lookup"><span data-stu-id="15d6c-175">**Number of tasks.**</span></span> <span data-ttu-id="15d6c-176">Cada bolt se ejecuta como un único subproceso.</span><span class="sxs-lookup"><span data-stu-id="15d6c-176">Each bolt runs as a single thread.</span></span> <span data-ttu-id="15d6c-177">Las tareas adicionales por bolt no proporcionan ninguna simultaneidad adicional.</span><span class="sxs-lookup"><span data-stu-id="15d6c-177">Additional tasks per bolt don't provide any additional concurrency.</span></span> <span data-ttu-id="15d6c-178">La única vez que resultan útiles es cuando el proceso de confirmación de la tupla usa una gran proporción del tiempo de ejecución de los bolts.</span><span class="sxs-lookup"><span data-stu-id="15d6c-178">The only time they are of benefit is if your process of acknowledging the tuple takes a large proportion of your bolt execution time.</span></span> <span data-ttu-id="15d6c-179">Es una buena idea agrupar muchas tuplas en un anexo más grande antes de enviar una confirmación del bolt.</span><span class="sxs-lookup"><span data-stu-id="15d6c-179">It's a good idea to group many tuples into a larger append before you send an acknowledgement from the bolt.</span></span> <span data-ttu-id="15d6c-180">Por lo tanto, en la mayoría de los casos, varias tareas no proporcionan ninguna ventaja adicional.</span><span class="sxs-lookup"><span data-stu-id="15d6c-180">So, in most cases, multiple tasks provide no additional benefit.</span></span>
* <span data-ttu-id="15d6c-181">**Local or shuffle grouping** (Agrupación local o aleatoria)</span><span class="sxs-lookup"><span data-stu-id="15d6c-181">**Local or shuffle grouping.**</span></span> <span data-ttu-id="15d6c-182">Cuando esta opción está habilitada, las tuplas se envían a bolts dentro del mismo proceso de trabajo.</span><span class="sxs-lookup"><span data-stu-id="15d6c-182">When this setting is enabled, tuples are sent to bolts within the same worker process.</span></span> <span data-ttu-id="15d6c-183">Esta opción reduce las llamadas de red y la comunicación entre procesos.</span><span class="sxs-lookup"><span data-stu-id="15d6c-183">This reduces inter-process communication and network calls.</span></span> <span data-ttu-id="15d6c-184">Se recomienda su uso para la mayoría de las topologías.</span><span class="sxs-lookup"><span data-stu-id="15d6c-184">This is recommended for most topologies.</span></span>

<span data-ttu-id="15d6c-185">Este escenario básico es un buen punto de partida.</span><span class="sxs-lookup"><span data-stu-id="15d6c-185">This basic scenario is a good starting point.</span></span> <span data-ttu-id="15d6c-186">Pruebe con sus propios datos para ajustar los parámetros anteriores con el fin de alcanzar un rendimiento óptimo.</span><span class="sxs-lookup"><span data-stu-id="15d6c-186">Test with your own data to tweak the preceding parameters to achieve optimal performance.</span></span>

## <a name="tune-the-spout"></a><span data-ttu-id="15d6c-187">Optimización del spout</span><span class="sxs-lookup"><span data-stu-id="15d6c-187">Tune the spout</span></span>

<span data-ttu-id="15d6c-188">Puede modificar los valores de configuración siguientes para optimizar el spout.</span><span class="sxs-lookup"><span data-stu-id="15d6c-188">You can modify the following settings to tune the spout.</span></span>

- <span data-ttu-id="15d6c-189">**Tuple timeout (Tiempo de espera de tupla): topology.message.timeout.secs**.</span><span class="sxs-lookup"><span data-stu-id="15d6c-189">**Tuple timeout: topology.message.timeout.secs**.</span></span> <span data-ttu-id="15d6c-190">Este valor determina la cantidad de tiempo que un mensaje tarda en completarse, y en recibir una confirmación, antes de que se considere erróneo.</span><span class="sxs-lookup"><span data-stu-id="15d6c-190">This setting determines the amount of time a message takes to complete, and receive acknowledgement, before it is considered failed.</span></span>

- <span data-ttu-id="15d6c-191">**Max memory per worker process (Memoria máxima por proceso de trabajo): worker.childopts**.</span><span class="sxs-lookup"><span data-stu-id="15d6c-191">**Max memory per worker process: worker.childopts**.</span></span> <span data-ttu-id="15d6c-192">Este valor le permite especificar parámetros de línea de comandos adicionales para los trabajos de Java.</span><span class="sxs-lookup"><span data-stu-id="15d6c-192">This setting lets you specify additional command-line parameters to the Java workers.</span></span> <span data-ttu-id="15d6c-193">El ajuste usado más frecuentemente aquí es XmX, que determina la memoria máxima asignada al montón de una JVM.</span><span class="sxs-lookup"><span data-stu-id="15d6c-193">The most commonly used setting here is XmX, which determines the maximum memory allocated to a JVM’s heap.</span></span>

- <span data-ttu-id="15d6c-194">**Max spout pending (Spouts máximos pendientes): topology.max.spout.pending**.</span><span class="sxs-lookup"><span data-stu-id="15d6c-194">**Max spout pending: topology.max.spout.pending**.</span></span> <span data-ttu-id="15d6c-195">Este valor determina el número de tuplas que pueden estar en vuelo (que aún no se han confirmado en todos los nodos de la topología) por subproceso de spout en un momento concreto.</span><span class="sxs-lookup"><span data-stu-id="15d6c-195">This setting determines the number of tuples that can in be flight (not yet acknowledged at all nodes in the topology) per spout thread at any time.</span></span>

 <span data-ttu-id="15d6c-196">Un buen cálculo sería estimar el tamaño de cada una de sus tuplas.</span><span class="sxs-lookup"><span data-stu-id="15d6c-196">A good calculation to do is to estimate the size of each of your tuples.</span></span> <span data-ttu-id="15d6c-197">Después, averigüe cuánta memoria tiene un subproceso de spout.</span><span class="sxs-lookup"><span data-stu-id="15d6c-197">Then figure out how much memory one spout thread has.</span></span> <span data-ttu-id="15d6c-198">La memoria total asignada a un subproceso dividida por este valor debe proporcionarle el límite superior para el parámetro de spouts máximos pendientes.</span><span class="sxs-lookup"><span data-stu-id="15d6c-198">The total memory allocated to a thread, divided by this value, should give you the upper bound for the max spout pending parameter.</span></span>

## <a name="tune-the-bolt"></a><span data-ttu-id="15d6c-199">Optimización del bolt</span><span class="sxs-lookup"><span data-stu-id="15d6c-199">Tune the bolt</span></span>
<span data-ttu-id="15d6c-200">Al escribir en Data Lake Store, establezca una directiva de sincronización de tamaño (el búfer en el lado cliente) en 4 MB.</span><span class="sxs-lookup"><span data-stu-id="15d6c-200">When you're writing to Data Lake Store, set a size sync policy (buffer on the client side) to 4 MB.</span></span> <span data-ttu-id="15d6c-201">Así, se realizará un vaciado o hsync() solamente cuando el tamaño del búfer sea el valor anterior.</span><span class="sxs-lookup"><span data-stu-id="15d6c-201">A flushing or hsync() is then performed only when the buffer size is the at this value.</span></span> <span data-ttu-id="15d6c-202">El controlador de Data Lake Store en la máquina virtual de trabajo realiza automáticamente este almacenamiento en búfer, a menos que ejecute explícitamente hsync().</span><span class="sxs-lookup"><span data-stu-id="15d6c-202">The Data Lake Store driver on the worker VM automatically does this buffering, unless you explicitly perform an hsync().</span></span>

<span data-ttu-id="15d6c-203">El bolt predeterminado de Storm de Data Lake Store tiene un parámetro de directiva de sincronización de tamaño (fileBufferSize) que puede usarse para optimizar este parámetro.</span><span class="sxs-lookup"><span data-stu-id="15d6c-203">The default Data Lake Store Storm bolt has a size sync policy parameter (fileBufferSize) that can be used to tune this parameter.</span></span>

<span data-ttu-id="15d6c-204">En topologías con uso intensivo de E/S, se recomienda que cada subproceso de bolt escriba en su propio archivo y que establezca una directiva de rotación de archivos (fileRotationSize).</span><span class="sxs-lookup"><span data-stu-id="15d6c-204">In I/O-intensive topologies, it's a good idea to have each bolt thread write to its own file, and to set a file rotation policy (fileRotationSize).</span></span> <span data-ttu-id="15d6c-205">Cuando el archivo alcanza un determinado tamaño, la transmisión se vacía automáticamente y se escribe en un nuevo archivo.</span><span class="sxs-lookup"><span data-stu-id="15d6c-205">When the file reaches a certain size, the stream is automatically flushed and a new file is written to.</span></span> <span data-ttu-id="15d6c-206">El tamaño de archivo recomendado por rotación es de 1 GB.</span><span class="sxs-lookup"><span data-stu-id="15d6c-206">The recommended file size for rotation is 1 GB.</span></span>

### <a name="handle-tuple-data"></a><span data-ttu-id="15d6c-207">Administración de los datos de la tupla</span><span class="sxs-lookup"><span data-stu-id="15d6c-207">Handle tuple data</span></span>

<span data-ttu-id="15d6c-208">En Storm, un spout se mantiene en una tupla hasta que el bolt lo confirma de forma explícita.</span><span class="sxs-lookup"><span data-stu-id="15d6c-208">In Storm, a spout holds on to a tuple until it is explicitly acknowledged by the bolt.</span></span> <span data-ttu-id="15d6c-209">Si el bolt ha leído una tupla pero no la ha confirmado aún, es posible que el spout no se haya guardado en el back-end de Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="15d6c-209">If a tuple has been read by the bolt but has not been acknowledged yet, the spout might not have persisted into Data Lake Store back end.</span></span> <span data-ttu-id="15d6c-210">Cuando se confirma una tupla, el bolt garantiza la persistencia del spout, por lo que puede eliminar los datos de origen de cualquier origen que esté leyendo.</span><span class="sxs-lookup"><span data-stu-id="15d6c-210">After a tuple is acknowledged, the spout can be guaranteed persistence by the bolt, and can then delete the source data from whatever source it is reading from.</span></span>  

<span data-ttu-id="15d6c-211">Para obtener el mejor rendimiento en Data Lake Store, el búfer del bolt debe tener 4 MB de datos de tupla.</span><span class="sxs-lookup"><span data-stu-id="15d6c-211">For best performance on Data Lake Store, have the bolt buffer 4 MB of tuple data.</span></span> <span data-ttu-id="15d6c-212">Luego, escriba en el back-end de Data Lake Store como una escritura de 4 MB.</span><span class="sxs-lookup"><span data-stu-id="15d6c-212">Then write to the Data Lake Store back end as one 4-MB write.</span></span> <span data-ttu-id="15d6c-213">Cuando los datos se hayan escrito correctamente en el almacén (mediante la llamada a hflush()), el bolt puede confirmar los datos al spout.</span><span class="sxs-lookup"><span data-stu-id="15d6c-213">After the data has been successfully written to the store (by calling hflush()), the bolt can acknowledge the data back to the spout.</span></span> <span data-ttu-id="15d6c-214">Esto es lo que hace el bolt de ejemplo aquí indicado.</span><span class="sxs-lookup"><span data-stu-id="15d6c-214">This is what the example bolt supplied here does.</span></span> <span data-ttu-id="15d6c-215">También es aceptable conservar un mayor número de tuplas antes de realizar la llamada hflush() y de que se confirmen las tuplas.</span><span class="sxs-lookup"><span data-stu-id="15d6c-215">It is also acceptable to hold a larger number of tuples before the hflush() call is made and the tuples acknowledged.</span></span> <span data-ttu-id="15d6c-216">Sin embargo, esto aumenta el número de tuplas en vuelo que el spout debe conservar y, por lo tanto, aumenta la cantidad de memoria necesaria por cada JVM.</span><span class="sxs-lookup"><span data-stu-id="15d6c-216">However, this increases the number of tuples in flight that the spout needs to hold, and therefore increases the amount of memory required per JVM.</span></span>

> [!NOTE]
<span data-ttu-id="15d6c-217">Puede que las aplicaciones tengan la necesidad de confirmar tuplas más a menudo (con tamaños de datos inferiores a 4 MB) por otros motivos no relacionados con el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="15d6c-217">Applications might have a requirement to acknowledge tuples more frequently (at data sizes less than 4 MB) for other non-performance reasons.</span></span> <span data-ttu-id="15d6c-218">Sin embargo, eso podría afectar al rendimiento de E/S en el back-end de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="15d6c-218">However, that might affect the I/O throughput to the storage back end.</span></span> <span data-ttu-id="15d6c-219">Por lo tanto, sopese con cuidado este inconveniente con el rendimiento de E/S del bolt.</span><span class="sxs-lookup"><span data-stu-id="15d6c-219">Carefully weigh this tradeoff against the bolt’s I/O performance.</span></span>

<span data-ttu-id="15d6c-220">Si la velocidad de entrada de las tuplas no es alta, por lo que el búfer de 4 MB tarda mucho tiempo en llenarse, considere estas posibilidades para solucionarlo:</span><span class="sxs-lookup"><span data-stu-id="15d6c-220">If the incoming rate of tuples is not high, so the 4-MB buffer takes a long time to fill, consider mitigating this by:</span></span>
* <span data-ttu-id="15d6c-221">Reducir el número de bolts para que haya menos búferes que llenar.</span><span class="sxs-lookup"><span data-stu-id="15d6c-221">Reducing the number of bolts, so there are fewer buffers to fill.</span></span>
* <span data-ttu-id="15d6c-222">Tener una directiva basada en recuento o en tiempo, donde se desencadene un hflush() cada X vaciados o cada y milisegundos y se confirmen las tuplas acumuladas hasta entonces.</span><span class="sxs-lookup"><span data-stu-id="15d6c-222">Having a time-based or count-based policy, where an hflush() is triggered every x flushes or every y milliseconds, and the tuples accumulated so far are acknowledged back.</span></span>

<span data-ttu-id="15d6c-223">Tenga en cuenta que el rendimiento en este caso es menor, pero como la tasa de eventos es lenta, el objetivo principal tampoco es obtener un rendimiento máximo de todos modos.</span><span class="sxs-lookup"><span data-stu-id="15d6c-223">Note that the throughput in this case is lower, but with a slow rate of events, maximum throughput is not the biggest objective anyway.</span></span> <span data-ttu-id="15d6c-224">Estas soluciones le ayudan a reducir el tiempo total que tarda una tupla en atravesar el almacén.</span><span class="sxs-lookup"><span data-stu-id="15d6c-224">These mitigations help you reduce the total time that it takes for a tuple to flow through to the store.</span></span> <span data-ttu-id="15d6c-225">Esto podría ser importante si quiere una canalización en tiempo real incluso con una tasa baja de eventos.</span><span class="sxs-lookup"><span data-stu-id="15d6c-225">This might matter if you want a real-time pipeline even with a low event rate.</span></span> <span data-ttu-id="15d6c-226">Tenga en cuenta también que si la tasa de tuplas entrantes es baja, debe ajustar el parámetro topology.message.timeout_secs, de modo que el tiempo de espera de las tuplas no se agote mientras se estén almacenando en búfer o procesando.</span><span class="sxs-lookup"><span data-stu-id="15d6c-226">Also note that if your incoming tuple rate is low, you should adjust the topology.message.timeout_secs parameter, so the tuples don’t time out while they are getting buffered or processed.</span></span>

## <a name="monitor-your-topology-in-storm"></a><span data-ttu-id="15d6c-227">Supervisión de la topología en Storm</span><span class="sxs-lookup"><span data-stu-id="15d6c-227">Monitor your topology in Storm</span></span>  
<span data-ttu-id="15d6c-228">Mientras se ejecuta la topología, puede supervisarla en la interfaz de usuario de Storm.</span><span class="sxs-lookup"><span data-stu-id="15d6c-228">While your topology is running, you can monitor it in the Storm user interface.</span></span> <span data-ttu-id="15d6c-229">Estos son los principales parámetros que debe examinar:</span><span class="sxs-lookup"><span data-stu-id="15d6c-229">Here are the main parameters to look at:</span></span>

* <span data-ttu-id="15d6c-230">**Total process execution latency (Latencia total de ejecución de procesos).**</span><span class="sxs-lookup"><span data-stu-id="15d6c-230">**Total process execution latency.**</span></span> <span data-ttu-id="15d6c-231">Es el tiempo medio que una tupla tarda en que la emita el spout, la procese el bolt y se confirme.</span><span class="sxs-lookup"><span data-stu-id="15d6c-231">This is the average time one tuple takes to be emitted by the spout, processed by the bolt, and acknowledged.</span></span>

* <span data-ttu-id="15d6c-232">**Total bolt process latency (Latencia total de proceso del bolt).**</span><span class="sxs-lookup"><span data-stu-id="15d6c-232">**Total bolt process latency.**</span></span> <span data-ttu-id="15d6c-233">Es el tiempo medio que está la tupla en el bolt hasta que recibe una confirmación.</span><span class="sxs-lookup"><span data-stu-id="15d6c-233">This is the average time spent by the tuple at the bolt until it receives an acknowledgement.</span></span>

* <span data-ttu-id="15d6c-234">**Total bolt execute latency (Latencia total de ejecución del bolt).**</span><span class="sxs-lookup"><span data-stu-id="15d6c-234">**Total bolt execute latency.**</span></span> <span data-ttu-id="15d6c-235">Es el tiempo medio empleado por el bolt en el método de ejecución.</span><span class="sxs-lookup"><span data-stu-id="15d6c-235">This is the average time spent by the bolt in the execute method.</span></span>

* <span data-ttu-id="15d6c-236">**Number of failures (Número de errores).**</span><span class="sxs-lookup"><span data-stu-id="15d6c-236">**Number of failures.**</span></span> <span data-ttu-id="15d6c-237">Se refiere al número de tuplas que no se pudieron procesar por completo antes de que se agotara el tiempo de espera.</span><span class="sxs-lookup"><span data-stu-id="15d6c-237">This refers to the number of tuples that failed to be fully processed before they timed out.</span></span>

* <span data-ttu-id="15d6c-238">**Capacity (Capacidad).**</span><span class="sxs-lookup"><span data-stu-id="15d6c-238">**Capacity.**</span></span> <span data-ttu-id="15d6c-239">Se trata de una medida de lo ocupado que está su sistema.</span><span class="sxs-lookup"><span data-stu-id="15d6c-239">This is a measure of how busy your system is.</span></span> <span data-ttu-id="15d6c-240">Si este número es 1, los bolts trabajan tan rápido como pueden.</span><span class="sxs-lookup"><span data-stu-id="15d6c-240">If this number is 1, your bolts are working as fast as they can.</span></span> <span data-ttu-id="15d6c-241">Si es menor que 1, aumente el paralelismo.</span><span class="sxs-lookup"><span data-stu-id="15d6c-241">If it is less than 1, increase the parallelism.</span></span> <span data-ttu-id="15d6c-242">Si es mayor que 1, reduzca el paralelismo.</span><span class="sxs-lookup"><span data-stu-id="15d6c-242">If it is greater than 1, reduce the parallelism.</span></span>

## <a name="troubleshoot-common-problems"></a><span data-ttu-id="15d6c-243">Solución de problemas comunes</span><span class="sxs-lookup"><span data-stu-id="15d6c-243">Troubleshoot common problems</span></span>
<span data-ttu-id="15d6c-244">Estos son algunos escenarios comunes de solución de problemas.</span><span class="sxs-lookup"><span data-stu-id="15d6c-244">Here are a few common troubleshooting scenarios.</span></span>
* <span data-ttu-id="15d6c-245">**El tiempo de espera de muchas tuplas se está agotando.**</span><span class="sxs-lookup"><span data-stu-id="15d6c-245">**Many tuples are timing out.**</span></span> <span data-ttu-id="15d6c-246">Examine cada nodo de la topología para determinar dónde está el cuello de botella.</span><span class="sxs-lookup"><span data-stu-id="15d6c-246">Look at each node in the topology to determine where the bottleneck is.</span></span> <span data-ttu-id="15d6c-247">El motivo más habitual de ello es que los bolts no puedan seguir el ritmo de los spouts.</span><span class="sxs-lookup"><span data-stu-id="15d6c-247">The most common reason for this is that the bolts are not able to keep up with the spouts.</span></span> <span data-ttu-id="15d6c-248">Como consecuencia, las tuplas quedan atascadas en los búferes internos a la espera de ser procesadas.</span><span class="sxs-lookup"><span data-stu-id="15d6c-248">This leads to tuples clogging the internal buffers while waiting to be processed.</span></span> <span data-ttu-id="15d6c-249">Considere la posibilidad de aumentar el valor de tiempo de espera o de reducir el número máximo de spouts pendientes.</span><span class="sxs-lookup"><span data-stu-id="15d6c-249">Consider increasing the timeout value or decreasing the max spout pending.</span></span>

* <span data-ttu-id="15d6c-250">**Existe una latencia alta total en la ejecución de los procesos, pero una latencia baja en los procesos de bolt.**</span><span class="sxs-lookup"><span data-stu-id="15d6c-250">**There is a high total process execution latency, but a low bolt process latency.**</span></span> <span data-ttu-id="15d6c-251">En este caso, es posible que las tuplas no se reconozcan lo suficientemente rápido.</span><span class="sxs-lookup"><span data-stu-id="15d6c-251">In this case, it is possible that the tuples are not being acknowledged fast enough.</span></span> <span data-ttu-id="15d6c-252">Compruebe que hay un número suficiente de elementos de reconocimiento.</span><span class="sxs-lookup"><span data-stu-id="15d6c-252">Check that there are a sufficient number of acknowledgers.</span></span> <span data-ttu-id="15d6c-253">Otra posibilidad es que esperen en la cola demasiado tiempo hasta que los bolts empiezan a procesarlas.</span><span class="sxs-lookup"><span data-stu-id="15d6c-253">Another possibility is that they are waiting in the queue for too long before the bolts start processing them.</span></span> <span data-ttu-id="15d6c-254">Reduzca el máximo de spouts pendientes.</span><span class="sxs-lookup"><span data-stu-id="15d6c-254">Decrease the max spout pending.</span></span>

* <span data-ttu-id="15d6c-255">**Existe una latencia alta en la ejecución de bolts.**</span><span class="sxs-lookup"><span data-stu-id="15d6c-255">**There is a high bolt execute latency.**</span></span> <span data-ttu-id="15d6c-256">Esto significa que el método execute() de su bolt está tardando demasiado.</span><span class="sxs-lookup"><span data-stu-id="15d6c-256">This means that the execute() method of your bolt is taking too long.</span></span> <span data-ttu-id="15d6c-257">Optimice el código o examine el comportamiento de vaciado y los tamaños de escritura.</span><span class="sxs-lookup"><span data-stu-id="15d6c-257">Optimize the code, or look at write sizes and flush behavior.</span></span>

### <a name="data-lake-store-throttling"></a><span data-ttu-id="15d6c-258">Limitación de Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="15d6c-258">Data Lake Store throttling</span></span>
<span data-ttu-id="15d6c-259">Si se alcanzan los límites de ancho de banda proporcionados por Data Lake Store, podría experimentar errores en las tareas.</span><span class="sxs-lookup"><span data-stu-id="15d6c-259">If you hit the limits of bandwidth provided by Data Lake Store, you might see task failures.</span></span> <span data-ttu-id="15d6c-260">Compruebe los registros de la tarea para ver los errores de limitación.</span><span class="sxs-lookup"><span data-stu-id="15d6c-260">Check task logs for throttling errors.</span></span> <span data-ttu-id="15d6c-261">Puede reducir el paralelismo mediante un aumento del tamaño del contenedor.</span><span class="sxs-lookup"><span data-stu-id="15d6c-261">You can decrease the parallelism by increasing container size.</span></span>    

<span data-ttu-id="15d6c-262">Para comprobar si le están aplicando limitaciones, habilite el registro de depuración en el lado cliente:</span><span class="sxs-lookup"><span data-stu-id="15d6c-262">To check if you are getting throttled, enable the debug logging on the client side:</span></span>

1. <span data-ttu-id="15d6c-263">En **Ambari** > **Storm** > **Config** > **Advanced storm-worker-log4j**, cambie **&lt;nivel de raíz="info"&gt;** por **&lt;nivel de raíz=”debug”&gt;**.</span><span class="sxs-lookup"><span data-stu-id="15d6c-263">In **Ambari** > **Storm** > **Config** > **Advanced storm-worker-log4j**, change **&lt;root level="info"&gt;** to **&lt;root level=”debug”&gt;**.</span></span> <span data-ttu-id="15d6c-264">Reinicie todos los nodos/servicios para que la configuración surta efecto.</span><span class="sxs-lookup"><span data-stu-id="15d6c-264">Restart all the nodes/service for the configuration to take effect.</span></span>
2. <span data-ttu-id="15d6c-265">Supervise los registros de topología de Storm en los nodos de trabajo (en /var/log/storm/worker-artifacts/&lt;NombreTopología&gt;/&lt;puerto&gt;/worker.log) para controlar las excepciones de limitación de Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="15d6c-265">Monitor the Storm topology logs on worker nodes (under /var/log/storm/worker-artifacts/&lt;TopologyName&gt;/&lt;port&gt;/worker.log) for Data Lake Store throttling exceptions.</span></span>

## <a name="next-steps"></a><span data-ttu-id="15d6c-266">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="15d6c-266">Next steps</span></span>
<span data-ttu-id="15d6c-267">Puede consultar este [blog](https://blogs.msdn.microsoft.com/shanyu/2015/05/14/performance-tuning-for-hdinsight-storm-and-microsoft-azure-eventhubs/) para saber más sobre la optimización del rendimiento adicional de Storm.</span><span class="sxs-lookup"><span data-stu-id="15d6c-267">Additional performance tuning for Storm can be referenced in [this blog](https://blogs.msdn.microsoft.com/shanyu/2015/05/14/performance-tuning-for-hdinsight-storm-and-microsoft-azure-eventhubs/).</span></span>

<span data-ttu-id="15d6c-268">Para ejecutar un ejemplo adicional, consulte [este en GitHub](https://github.com/hdinsight/storm-performance-automation).</span><span class="sxs-lookup"><span data-stu-id="15d6c-268">For an additional example to run, see [this one on GitHub](https://github.com/hdinsight/storm-performance-automation).</span></span>

---
title: 'Tutorial: procesamiento de facturas de EDIFACT mediante Azure BizTalk Services | Microsoft Docs'
description: "Creación y configuración del conector de Box o la aplicación de API y su uso en una aplicación lógica en Servicio de aplicaciones de Azure"
services: biztalk-services
documentationcenter: .net,nodejs,java
author: msftman
manager: erikre
editor: 
ms.assetid: 7e0b93fa-3e2b-4a9c-89ef-abf1d3aa8fa9
ms.service: biztalk-services
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: integration
ms.date: 05/31/2016
ms.author: deonhe
ms.openlocfilehash: 4597ee28e4c3b797c0ab050b21a126a95d9e8191
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/03/2017
---
# <a name="tutorial-process-edifact-invoices-using-azure-biztalk-services"></a><span data-ttu-id="fcc41-103">Tutorial: procesamiento de facturas de EDIFACT mediante los Servicios de BizTalk de Azure</span><span class="sxs-lookup"><span data-stu-id="fcc41-103">Tutorial: Process EDIFACT invoices using Azure BizTalk Services</span></span>

> [!INCLUDE [BizTalk Services is being retired, and replaced with Azure Logic Apps](../../includes/biztalk-services-retirement.md)]

<span data-ttu-id="fcc41-104">Puede usar el Portal de Servicios de BizTalk para configurar e implementar los contratos X12 y EDIFACT.</span><span class="sxs-lookup"><span data-stu-id="fcc41-104">You can use the BizTalk Services Portal to configure and deploy X12 and EDIFACT agreements.</span></span> <span data-ttu-id="fcc41-105">En este tutorial, vemos cómo crear un contrato EDIFACT para intercambiar facturas entre socios comerciales.</span><span class="sxs-lookup"><span data-stu-id="fcc41-105">In this tutorial, we look at how to create an EDIFACT agreement for exchanging invoices between trading partners.</span></span> <span data-ttu-id="fcc41-106">Este tutorial se centra en una solución empresarial integral que involucra a dos socios comerciales, Northwind y Contoso, que intercambian mensajes EDIFACT.</span><span class="sxs-lookup"><span data-stu-id="fcc41-106">This tutorial is written around an end-to-end business solution involving two trading partners, Northwind and Contoso that exchange EDIFACT messages.</span></span>  

## <a name="sample-based-on-this-tutorial"></a><span data-ttu-id="fcc41-107">Ejemplo basado en este tutorial</span><span class="sxs-lookup"><span data-stu-id="fcc41-107">Sample based on this tutorial</span></span>
<span data-ttu-id="fcc41-108">Este tutorial se ha escrito en torno a un ejemplo **Envío de facturas EDIFACT a través de los servicios de BizTalk**, que está disponible en la [Galería de código de MSDN](http://go.microsoft.com/fwlink/?LinkId=401005).</span><span class="sxs-lookup"><span data-stu-id="fcc41-108">This tutorial is written around a sample, **Sending EDIFACT Invoices Using BizTalk Services**, which is available to download from the [MSDN Code Gallery](http://go.microsoft.com/fwlink/?LinkId=401005).</span></span> <span data-ttu-id="fcc41-109">Puede usar el ejemplo y seguir este tutorial para entender cómo se creó.</span><span class="sxs-lookup"><span data-stu-id="fcc41-109">You could use the sample and go through this tutorial to understand how the sample was built.</span></span> <span data-ttu-id="fcc41-110">O bien, puede usar este tutorial para crear su propia solución desde cero.</span><span class="sxs-lookup"><span data-stu-id="fcc41-110">Or, you could use this tutorial to create your own solution ground-up.</span></span> <span data-ttu-id="fcc41-111">Este tutorial está destinado al segundo enfoque, de modo que entienda cómo se compiló esta solución.</span><span class="sxs-lookup"><span data-stu-id="fcc41-111">This tutorial is targeted towards the second approach so that you understand how this solution was built.</span></span> <span data-ttu-id="fcc41-112">Además, en la medida de lo posible, el tutorial es coherente con el ejemplo y usa los mismos nombres para los artefactos (por ejemplo, esquemas, transformaciones) que se usan en el ejemplo.</span><span class="sxs-lookup"><span data-stu-id="fcc41-112">Also, as much as possible, the tutorial is consistent with the sample and uses the same names for artifacts (for example, schemas, transforms) as used in the sample.</span></span>  

> [!NOTE]
> <span data-ttu-id="fcc41-113">Dado que esta solución implica enviar un mensaje de un puente EAI a un puente EDI, se reutiliza el ejemplo de [BizTalk Services Bridge chaining sample](http://code.msdn.microsoft.com/BizTalk-Bridge-chaining-2246b104) .</span><span class="sxs-lookup"><span data-stu-id="fcc41-113">Because this solution involves sending a message from an EAI bridge to an EDI bridge, it reuses the [BizTalk Services Bridge chaining sample](http://code.msdn.microsoft.com/BizTalk-Bridge-chaining-2246b104) sample.</span></span>  
> 
> 

## <a name="what-does-the-solution-do"></a><span data-ttu-id="fcc41-114">¿Cómo funciona la solución?</span><span class="sxs-lookup"><span data-stu-id="fcc41-114">What does the solution do?</span></span>
<span data-ttu-id="fcc41-115">En esta solución, Northwind recibe facturas EDIFACT de Contoso.</span><span class="sxs-lookup"><span data-stu-id="fcc41-115">In this solution, Northwind receives EDIFACT invoices from Contoso.</span></span> <span data-ttu-id="fcc41-116">Estas facturas no están en un formato EDI estándar.</span><span class="sxs-lookup"><span data-stu-id="fcc41-116">These invoices are not in a standard EDI format.</span></span> <span data-ttu-id="fcc41-117">Por eso, antes de enviar la factura a Northwind, se debe transformar a una factura EDIFACT (también llamada INVOIC).</span><span class="sxs-lookup"><span data-stu-id="fcc41-117">So, before sending the invoice to Northwind, it must be transformed to an EDIFACT invoice (also called INVOIC) document.</span></span> <span data-ttu-id="fcc41-118">Al recibirla, Northwind debe procesar la factura EDIFACT y devolver un mensaje de control (también llamado CONTRL) a Contoso.</span><span class="sxs-lookup"><span data-stu-id="fcc41-118">On receipt, Northwind must process the EDIFACT invoice, and return a control message (also called CONTRL) to Contoso.</span></span>

![][1]  

<span data-ttu-id="fcc41-119">Para lograr este escenario empresarial, Contoso usa las funciones que se incluyen en Servicios de BizTalk de Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="fcc41-119">To achieve this business scenario, Contoso uses the features provided with Microsoft Azure BizTalk Services.</span></span>

* <span data-ttu-id="fcc41-120">Contoso usa puentes EAI para transformar la factura original en INVOIC EDIFACT.</span><span class="sxs-lookup"><span data-stu-id="fcc41-120">Contoso uses EAI bridges to transform the original invoice to EDIFACT INVOIC.</span></span>
* <span data-ttu-id="fcc41-121">El puente EAI envía luego el mensaje a un puente de envío de EDI implementado como parte de un contrato configurado en el Portal de Servicios de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="fcc41-121">The EAI bridge then sends the message to an EDI send bridge deployed as part of an agreement configured in the BizTalk Services Portal.</span></span>
* <span data-ttu-id="fcc41-122">El puente de envío EDI procesa la INVOIC EDIFACT y la redirige a Northwind.</span><span class="sxs-lookup"><span data-stu-id="fcc41-122">The EDI send bridge processes the EDIFACT INVOIC and routes it to Northwind.</span></span>
* <span data-ttu-id="fcc41-123">Después de recibir la factura, Northwind devuelve un mensaje CONTRL al puente de recepción EDI implementado como parte del contrato.</span><span class="sxs-lookup"><span data-stu-id="fcc41-123">After receiving the invoice, Northwind returns a CONTRL message to the EDI receive bridge deployed as part of the agreement.</span></span>  

> [!NOTE]
> <span data-ttu-id="fcc41-124">Como alternativa, esta solución también demuestra cómo usar lotes para enviar facturas en lotes, en lugar de enviar cada factura por separado.</span><span class="sxs-lookup"><span data-stu-id="fcc41-124">Optionally, this solution also demonstrates how to use batching to send the invoices in batches, instead of sending each invoice separately.</span></span>  
> 
> 

<span data-ttu-id="fcc41-125">Para completar el escenario, usamos colas de Bus de servicio para enviar la factura de Contoso a Northwind o para recibir la confirmación de Northwind.</span><span class="sxs-lookup"><span data-stu-id="fcc41-125">To complete the scenario, we use Service Bus queues to send invoice from Contoso to Northwind or receive acknowledgement from Northwind.</span></span> <span data-ttu-id="fcc41-126">Estas colas se pueden crear con una aplicación cliente, que está disponible para descarga y se incluye en el paquete de ejemplo disponible como parte de este tutorial.</span><span class="sxs-lookup"><span data-stu-id="fcc41-126">These queues can be created using a client application, which is available as a download and is included in the sample package that is available as part of this tutorial.</span></span>  

## <a name="prerequisites"></a><span data-ttu-id="fcc41-127">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="fcc41-127">Prerequisites</span></span>
* <span data-ttu-id="fcc41-128">Debe tener un espacio de nombres de Bus de servicio.</span><span class="sxs-lookup"><span data-stu-id="fcc41-128">You must have a Service Bus namespace.</span></span> <span data-ttu-id="fcc41-129">Para instrucciones sobre cómo crear un espacio de nombres, consulte [How To: Create or Modify a Service Bus Service Namespace](https://msdn.microsoft.com/library/azure/hh674478.aspx).</span><span class="sxs-lookup"><span data-stu-id="fcc41-129">For instructions on creating a namespace, see [How To: Create or Modify a Service Bus Service Namespace](https://msdn.microsoft.com/library/azure/hh674478.aspx).</span></span> <span data-ttu-id="fcc41-130">Supongamos que ya tiene un espacio de nombres del Bus de servicio aprovisionado, llamado **edifactbts**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-130">Let us assume that you already have a Service Bus namespace provisioned, called **edifactbts**.</span></span>
* <span data-ttu-id="fcc41-131">Debe tener una suscripción a Servicios de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="fcc41-131">You must have a BizTalk Services subscription.</span></span> <span data-ttu-id="fcc41-132">Para instrucciones, consulte [Creación de Servicios de BizTalk mediante el Portal de Azure clásico](http://go.microsoft.com/fwlink/?LinkID=302280).</span><span class="sxs-lookup"><span data-stu-id="fcc41-132">For instructions, see [Create a BizTalk Service using Azure classic portal](http://go.microsoft.com/fwlink/?LinkID=302280).</span></span> <span data-ttu-id="fcc41-133">En este tutorial, supongamos que tiene una suscripción a Servicios de BizTalk, llamada **contosowabs**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-133">For this tutorial, let us assume you have a BizTalk Services subscription, called **contosowabs**.</span></span>
* <span data-ttu-id="fcc41-134">Registre la suscripción de Servicios de BizTalk en el Portal de Servicios de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="fcc41-134">Register your BizTalk Services subscription on the BizTalk Services Portal.</span></span> <span data-ttu-id="fcc41-135">Para obtener instrucciones, consulte [Registro de una implementación de Servicios de BizTalk en el Portal de Servicios de BizTalk](https://msdn.microsoft.com/library/hh689837.aspx)</span><span class="sxs-lookup"><span data-stu-id="fcc41-135">For instructions, see [Registering a BizTalk Service Deployment on the BizTalk Services Portal](https://msdn.microsoft.com/library/hh689837.aspx)</span></span>
* <span data-ttu-id="fcc41-136">Debe tener instalado Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="fcc41-136">You must have Visual Studio installed.</span></span>
* <span data-ttu-id="fcc41-137">Debe tener instalado el SDK de Servicios de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="fcc41-137">You must have BizTalk Services SDK installed.</span></span> <span data-ttu-id="fcc41-138">Puede descargar el SDK de [http://go.microsoft.com/fwlink/?LinkId=235057](http://go.microsoft.com/fwlink/?LinkId=235057)</span><span class="sxs-lookup"><span data-stu-id="fcc41-138">You can download the SDK from [http://go.microsoft.com/fwlink/?LinkId=235057](http://go.microsoft.com/fwlink/?LinkId=235057)</span></span>  

## <a name="step-1-create-the-service-bus-queues"></a><span data-ttu-id="fcc41-139">Paso 1: Creación de las colas de Bus de servicio</span><span class="sxs-lookup"><span data-stu-id="fcc41-139">Step 1: Create the Service Bus queues</span></span>
<span data-ttu-id="fcc41-140">Esta solución usa colas de Bus de servicio para intercambiar mensajes entre socios comerciales.</span><span class="sxs-lookup"><span data-stu-id="fcc41-140">This solution uses Service Bus queues to exchange messages between trading partners.</span></span> <span data-ttu-id="fcc41-141">Contoso y Northwind envían mensajes a las colas desde donde los puentes EAI o EDI los consumen.</span><span class="sxs-lookup"><span data-stu-id="fcc41-141">Contoso and Northwind send messages to the queues from where the EAI and/or EDI bridges consume them.</span></span> <span data-ttu-id="fcc41-142">Para esta solución, necesita tres colas de Bus de servicio:</span><span class="sxs-lookup"><span data-stu-id="fcc41-142">For this solution, you need three Service Bus queues:</span></span>

* <span data-ttu-id="fcc41-143">**northwindreceive** : Northwind recibe la factura de Contoso por esta cola.</span><span class="sxs-lookup"><span data-stu-id="fcc41-143">**northwindreceive** – Northwind receives the invoice from Contoso over this queue.</span></span>
* <span data-ttu-id="fcc41-144">**contosoreceive** : Contoso recibe la confirmación de Northwind por esta cola.</span><span class="sxs-lookup"><span data-stu-id="fcc41-144">**contosoreceive** – Contoso receives the acknowledgement from Northwind over this queue.</span></span>
* <span data-ttu-id="fcc41-145">**suspended** : todos los mensajes suspendidos se enrutan a esta cola.</span><span class="sxs-lookup"><span data-stu-id="fcc41-145">**suspended** – All suspended messages are routed to this queue.</span></span> <span data-ttu-id="fcc41-146">Los mensajes se suspenden si tienen un error durante el procesamiento.</span><span class="sxs-lookup"><span data-stu-id="fcc41-146">Messages are suspended if they fail during processing.</span></span>

<span data-ttu-id="fcc41-147">Puede crear estas colas de Bus de servicio mediante una aplicación cliente que se incluye en el paquete de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="fcc41-147">You can create these Service Bus queues by using a client application included in the sample package.</span></span>  

1. <span data-ttu-id="fcc41-148">Desde la ubicación donde descargó el ejemplo, abra **Tutorial Sending Invoices Using BizTalk Services EDI Bridges.sln**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-148">From the location where you downloaded the sample, open **Tutorial Sending Invoices Using BizTalk Services EDI Bridges.sln**.</span></span>
2. <span data-ttu-id="fcc41-149">Presione **F5** para compilar e iniciar la aplicación **Tutorial Client**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-149">Press **F5** to build and start the **Tutorial Client** application.</span></span>
3. <span data-ttu-id="fcc41-150">En la pantalla, escriba el espacio de nombres ACS del Bus de servicio, el nombre del emisor y la clave del emisor.</span><span class="sxs-lookup"><span data-stu-id="fcc41-150">In the screen, enter the Service Bus ACS namespace, issuer name, and issuer key.</span></span>
   
   ![][2]  
4. <span data-ttu-id="fcc41-151">Aparece un mensaje que indica que se crearán las tres colas en el espacio de nombres del Bus de servicio.</span><span class="sxs-lookup"><span data-stu-id="fcc41-151">A message box prompts that three queues will be created in your Service Bus namespace.</span></span> <span data-ttu-id="fcc41-152">Haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-152">Click **OK**.</span></span>
5. <span data-ttu-id="fcc41-153">Deje Tutorial Client en ejecución.</span><span class="sxs-lookup"><span data-stu-id="fcc41-153">Leave the Tutorial Client running.</span></span> <span data-ttu-id="fcc41-154">Haga clic en **Service Bus** > ***el espacio de nombres de Service Bus*** > **Colas**, y compruebe que se hayan creado las tres colas.</span><span class="sxs-lookup"><span data-stu-id="fcc41-154">Open the , click **Service Bus** > ***your Service Bus namespace*** > **Queues**, and verify that the three queues are created.</span></span>  

## <a name="step-2-create-and-deploy-trading-partner-agreement"></a><span data-ttu-id="fcc41-155">Paso 2: Creación e implementación del contrato entre socios comerciales</span><span class="sxs-lookup"><span data-stu-id="fcc41-155">Step 2: Create and deploy trading partner agreement</span></span>
<span data-ttu-id="fcc41-156">Cree un contrato entre los socios comerciales Contoso y Northwind.</span><span class="sxs-lookup"><span data-stu-id="fcc41-156">Create a trading partner agreement between Contoso and Northwind.</span></span> <span data-ttu-id="fcc41-157">Un contrato entre socios comerciales define un contrato mercantil entre los dos socios empresariales, por ejemplo, qué esquema de mensajes se usará, qué protocolo de mensajería, etc. Un acuerdo entre socios comerciales incluye dos puentes EDI, uno para enviar mensajes a los socios comerciales (denominado el **puente de envío EDI**) y otro para recibir mensajes de los socios comerciales (denominado el **puente de recepción EDI**).</span><span class="sxs-lookup"><span data-stu-id="fcc41-157">A trading partner agreement defines a trade contract between the two business partners, such as which message schema to use, which messaging protocol to use, etc. A trading partner agreement includes two EDI bridges, one to send messages to trading partners (called the **EDI Send bridge**) and one to receive messages from trading partners (called the **EDI Receive bridge**).</span></span>

<span data-ttu-id="fcc41-158">En el contexto de esta solución, el puente de envío EDI corresponde al lado de envío del contrato y se usa para enviar la factura EDIFACT de Contoso a Northwind.</span><span class="sxs-lookup"><span data-stu-id="fcc41-158">In the context of this solution, the EDI send bridge corresponds to the send-side of the agreement and is used to send the EDIFACT invoice from Contoso to Northwind.</span></span> <span data-ttu-id="fcc41-159">De igual modo, el puente de recepción EDI corresponde al lado de recepción del contrato y se usa para recibir las confirmaciones de Northwind.</span><span class="sxs-lookup"><span data-stu-id="fcc41-159">Similarly, the EDI receive bridge corresponds to the receive-side of the agreement and is used to receive acknowledgements from Northwind.</span></span>  

### <a name="create-the-trading-partners"></a><span data-ttu-id="fcc41-160">Creación de los socios comerciales</span><span class="sxs-lookup"><span data-stu-id="fcc41-160">Create the trading partners</span></span>
<span data-ttu-id="fcc41-161">Para comenzar, cree los socios comerciales de Contoso y Northwind.</span><span class="sxs-lookup"><span data-stu-id="fcc41-161">To start with, create trading partners for Contoso and Northwind.</span></span>  

1. <span data-ttu-id="fcc41-162">En el Portal de BizTalk Services, en la pestaña **Socios**, haga clic en **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-162">In the BizTalk Services Portal, on the **Partners** tab, click **Add**.</span></span>
2. <span data-ttu-id="fcc41-163">En la página Nuevo socio comercial, escriba **Contoso** como nombre del socio y, después, haga clic en **Guardar**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-163">In the New partner page, enter **Contoso** as a partner name, and then click **Save**.</span></span>
3. <span data-ttu-id="fcc41-164">Repita el mismo paso para crear el segundo socio, **Northwind**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-164">Repeat the step to create the second partner, **Northwind**.</span></span>  

### <a name="create-the-agreement"></a><span data-ttu-id="fcc41-165">Creación del contrato</span><span class="sxs-lookup"><span data-stu-id="fcc41-165">Create the agreement</span></span>
<span data-ttu-id="fcc41-166">Los contratos entre socios comerciales se crean entre perfiles de negocio de socios comerciales.</span><span class="sxs-lookup"><span data-stu-id="fcc41-166">Trading partner agreements are created between business profiles of trading partners.</span></span> <span data-ttu-id="fcc41-167">Esta solución usa los perfiles de socio predeterminados que se crean automáticamente cuando se crean los socios.</span><span class="sxs-lookup"><span data-stu-id="fcc41-167">This solution uses the default partner profiles that are automatically created when we created the partners.</span></span>  

1. <span data-ttu-id="fcc41-168">En el Portal de BizTalk Services, haga clic en **Contratos** > **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-168">In the BizTalk Services Portal, click **Agreements** > **Add**.</span></span>
2. <span data-ttu-id="fcc41-169">En la página **Configuración general** del nuevo contrato, especifique los valores como se muestra en la imagen siguiente y, luego, haga clic en **Continuar**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-169">In the new agreement’s **General Settings** page, specify the values as shown in the image below, and then click **Continue**.</span></span>
   
   ![][3]  
   
   <span data-ttu-id="fcc41-170">Después de hacer clic en **Continuar**, dos pestañas, **Configuración de recepción** y **Configuración de envío** se vuelven disponibles.</span><span class="sxs-lookup"><span data-stu-id="fcc41-170">After you click **Continue**, two tabs, **Receive Settings** and **Send Settings** become available.</span></span>
3. <span data-ttu-id="fcc41-171">Cree el contrato de envío entre Contoso y Northwind.</span><span class="sxs-lookup"><span data-stu-id="fcc41-171">Create the send agreement between Contoso and Northwind.</span></span> <span data-ttu-id="fcc41-172">Este contrato rige la forma en que Contoso envía la factura EDIFACT a Northwind.</span><span class="sxs-lookup"><span data-stu-id="fcc41-172">This agreement governs how Contoso sends the EDIFACT invoice to Northwind.</span></span>
   
   1. <span data-ttu-id="fcc41-173">Haga clic en **Configuración de envío**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-173">Click **Send Settings**.</span></span>
   2. <span data-ttu-id="fcc41-174">Conserve los valores predeterminados de las pestañas **Dirección URL de entrada**, **Transformación** y **Procesamiento por lotes**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-174">Retain the default values on the **Inbound URL**, **Transform**, and **Batching** tabs.</span></span>
   3. <span data-ttu-id="fcc41-175">En la pestaña **Protocolo**, en la sección **Esquemas**, cargue el esquema **EFACT_D93A_INVOIC.xsd**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-175">On the **Protocol** tab, under the **Schemas** section, upload the **EFACT_D93A_INVOIC.xsd** schema.</span></span> <span data-ttu-id="fcc41-176">Este esquema está disponible con el paquete de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="fcc41-176">This schema is available with the sample package.</span></span>
      
      ![][4]  
   4. <span data-ttu-id="fcc41-177">En la pestaña **Transformación** , especifique los detalles de las colas de Bus de servicio.</span><span class="sxs-lookup"><span data-stu-id="fcc41-177">On the **Transport** tab, specify the details for the Service Bus queues.</span></span> <span data-ttu-id="fcc41-178">Para el contrato del lado de envío, usamos la cola **northwindreceive** para enviar la factura EDIFACT a Northwind y la cola **suspended** para enrutar los mensajes que se suspenden por tener errores durante el procesamiento.</span><span class="sxs-lookup"><span data-stu-id="fcc41-178">For the send-side agreement, we use the **northwindreceive** queue to send the EDIFACT invoice to Northwind, and the **suspended** queue to route any messages that fail during processing and are suspended.</span></span> <span data-ttu-id="fcc41-179">Estas colas se crean en **Paso 1: Creación de las colas de Bus de servicio** (en este tema).</span><span class="sxs-lookup"><span data-stu-id="fcc41-179">You created these queues in **Step 1: Create the Service Bus queues** (in this topic).</span></span>
      
      ![][5]  
      
      <span data-ttu-id="fcc41-180">En **Configuración de transporte > Tipo de transporte** y **Configuración de suspensión de mensaje > Tipo de transporte**, seleccione Azure Service Bus y proporcione los valores como se muestra en la imagen.</span><span class="sxs-lookup"><span data-stu-id="fcc41-180">Under **Transport Settings > Transport type** and **Message Suspension Settings > Transport type**, select Azure Service Bus and provide the values as shown in the image.</span></span>
4. <span data-ttu-id="fcc41-181">Cree el contrato de recepción entre Contoso y Northwind.</span><span class="sxs-lookup"><span data-stu-id="fcc41-181">Create the receive agreement between Contoso and Northwind.</span></span> <span data-ttu-id="fcc41-182">Este contrato rige la forma en que Contoso recibe la confirmación de Northwind.</span><span class="sxs-lookup"><span data-stu-id="fcc41-182">This agreement governs how Contoso receives the acknowledgement from Northwind.</span></span>
   
   1. <span data-ttu-id="fcc41-183">Haga clic en **Configuración de recepción**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-183">Click **Receive Settings**.</span></span>
   2. <span data-ttu-id="fcc41-184">Conserve los valores predeterminados de las pestañas **Transporte** y **Transformación**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-184">Retain the default values on the **Transport** and **Transform** tabs.</span></span>
   3. <span data-ttu-id="fcc41-185">En la pestaña **Protocolo**, en la sección **Esquemas**, cargue el esquema **EFACT_4.1_CONTRL.xsd**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-185">On the **Protocol** tab, under the **Schemas** section, upload the **EFACT_4.1_CONTRL.xsd** schema.</span></span> <span data-ttu-id="fcc41-186">Este esquema está disponible con el paquete de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="fcc41-186">This schema is available with the sample package.</span></span>
   4. <span data-ttu-id="fcc41-187">En la pestaña **Ruta** , cree un filtro para asegurarse de que solo las confirmaciones de Northwind se enruten a Contoso.</span><span class="sxs-lookup"><span data-stu-id="fcc41-187">On the **Route** tab, create a filter to ensure that only acknowledgements from Northwind are routed to Contoso.</span></span> <span data-ttu-id="fcc41-188">En **Configuración de ruta**, haga clic en **Agregar** para crear el filtro de enrutamiento.</span><span class="sxs-lookup"><span data-stu-id="fcc41-188">Under **Route Settings**, click **Add** to create the routing filter.</span></span>
      
      ![][6]  
      
      1. <span data-ttu-id="fcc41-189">Proporcione valores para **Nombre de regla**, **Regla de ruta** y **Destino de ruta**, como se muestra en la imagen.</span><span class="sxs-lookup"><span data-stu-id="fcc41-189">Provide values for **Rule Name**, **Route rule**, and **Route destination** as shown in the image.</span></span>
      2. <span data-ttu-id="fcc41-190">Haga clic en **Save**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-190">Click **Save**.</span></span>
   5. <span data-ttu-id="fcc41-191">De nuevo en la pestaña **Ruta** , especifique adónde se enrutan las confirmaciones suspendidas (confirmaciones con error durante el procesamiento).</span><span class="sxs-lookup"><span data-stu-id="fcc41-191">On the **Route** tab again, specify where suspended acknowledgements (acknowledgements that fail during processing) are routed to.</span></span> <span data-ttu-id="fcc41-192">Configure el tipo de transporte como Azure Service Bus, el tipo de destino de ruta como **Cola**, el tipo de autenticación como **Firma de acceso compartido** (SAS), proporcione la cadena de conexión de SAS para el espacio de nombres de Service Bus y, después, escriba el nombre de la cola como **suspended**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-192">Set the transport type to Azure Service Bus, route destination type to **Queue**, authentication type to **Shared Access Signature** (SAS), provide the SAS connection string for the Service Bus namespace, and then enter the queue name as **suspended**.</span></span>
5. <span data-ttu-id="fcc41-193">Por último, haga clic en **Implementar** para implementar el contrato.</span><span class="sxs-lookup"><span data-stu-id="fcc41-193">Finally, click **Deploy** to deploy the agreement.</span></span> <span data-ttu-id="fcc41-194">Anote los puntos de conexión donde se implementan los contratos de envío y recepción.</span><span class="sxs-lookup"><span data-stu-id="fcc41-194">Note the endpoints where the send and receive agreements get deployed.</span></span>
   
   * <span data-ttu-id="fcc41-195">En la pestaña **Configuración de envío**, en **Dirección URL de entrada**, anote el punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="fcc41-195">On the **Send Settings** tab, under **Inbound URL**, note the endpoint.</span></span> <span data-ttu-id="fcc41-196">Para enviar un mensaje de Contoso a Northwind con el puente de envío EDI, debe enviar un mensaje a este punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="fcc41-196">To send a message from Contoso to Northwind using the EDI send bridge, you must send a message to this endpoint.</span></span>
   * <span data-ttu-id="fcc41-197">En la pestaña **Configuración de recepción**, en **Transporte**, anote el punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="fcc41-197">On the **Receive Settings** tab, under **Transport**, note the endpoint.</span></span> <span data-ttu-id="fcc41-198">Para enviar un mensaje de Northwind a Contoso mediante el puente de envío EDI, debe enviar un mensaje a este punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="fcc41-198">To send a message from Northwind to Contoso using the EDI receive bridge, you must send a message to this endpoint.</span></span>  

## <a name="step-3-create-and-deploy-the-biztalk-services-project"></a><span data-ttu-id="fcc41-199">Paso 3: Creación e implementación del proyecto de Servicios de BizTalk</span><span class="sxs-lookup"><span data-stu-id="fcc41-199">Step 3: Create and deploy the BizTalk Services project</span></span>
<span data-ttu-id="fcc41-200">En el paso anterior, implementó los contratos de envío y recepción de EDI para procesar facturas y confirmaciones EDIFACT.</span><span class="sxs-lookup"><span data-stu-id="fcc41-200">In the previous step, you deployed the EDI send and receive agreements to process EDIFACT invoices and acknowledgements.</span></span> <span data-ttu-id="fcc41-201">Estos contratos solo pueden procesar mensajes que cumplan el esquema de mensaje EDIFACT estándar.</span><span class="sxs-lookup"><span data-stu-id="fcc41-201">These agreements can only process messages that conform to the standard EDIFACT message schema.</span></span> <span data-ttu-id="fcc41-202">Sin embargo, según el escenario de esta solución, Contoso envía una factura a Northwind en un esquema interno propio.</span><span class="sxs-lookup"><span data-stu-id="fcc41-202">However, per the scenario for this solution, Contoso sends an invoice to Northwind in an in-house proprietary schema.</span></span> <span data-ttu-id="fcc41-203">Por lo tanto, antes de enviar el mensaje al puente de envío EDI, se debe transformar del esquema interno al esquema de facturas EDIFACT estándar.</span><span class="sxs-lookup"><span data-stu-id="fcc41-203">So, before the message is sent to the EDI send bridge, it must be transformed from the in-house schema to the standard EDIFACT invoice schema.</span></span> <span data-ttu-id="fcc41-204">El proyecto de EAI de Servicios de BizTalk hace eso.</span><span class="sxs-lookup"><span data-stu-id="fcc41-204">The BizTalk Services EAI project does that.</span></span>

<span data-ttu-id="fcc41-205">El proyecto de Servicios de BizTalk, **InvoiceProcessingBridge**, que transforma el mensaje también se incluye como parte del ejemplo que descargó.</span><span class="sxs-lookup"><span data-stu-id="fcc41-205">The BizTalk Services project, **InvoiceProcessingBridge**, that transforms the message is also included as part of the sample you downloaded.</span></span> <span data-ttu-id="fcc41-206">El proyecto incluye los siguientes artefactos:</span><span class="sxs-lookup"><span data-stu-id="fcc41-206">The project includes the following artifacts:</span></span>

* <span data-ttu-id="fcc41-207">**INHOUSEINVOICE. XSD** : esquema de la factura interna que se envía a Northwind.</span><span class="sxs-lookup"><span data-stu-id="fcc41-207">**INHOUSEINVOICE.XSD** – Schema of the in-house invoice that is sent to Northwind.</span></span>
* <span data-ttu-id="fcc41-208">**EFACT_D93A_INVOIC.XSD**: esquema de la factura EDIFACT estándar.</span><span class="sxs-lookup"><span data-stu-id="fcc41-208">**EFACT_D93A_INVOIC.XSD** – Schema of the standard EDIFACT invoice.</span></span>
* <span data-ttu-id="fcc41-209">**EFACT_4.1_CONTRL.XSD**: esquema de la confirmación de EDIFACT que Northwind envía a Contoso.</span><span class="sxs-lookup"><span data-stu-id="fcc41-209">**EFACT_4.1_CONTRL.XSD** – Schema of the EDIFACT acknowledgement that Northwind sends to Contoso.</span></span>
* <span data-ttu-id="fcc41-210">**INHOUSEINVOICE_to_D93AINVOIC.TRFM**: la transformación que asigna el esquema de facturas interno al esquema de facturas EDIFACT estándar.</span><span class="sxs-lookup"><span data-stu-id="fcc41-210">**INHOUSEINVOICE_to_D93AINVOIC.TRFM** – The transform that maps the in-house invoice schema to the standard EDIFACT invoice schema.</span></span>  

### <a name="create-the-biztalk-services-project"></a><span data-ttu-id="fcc41-211">Creación del proyecto de Servicios de BizTalk</span><span class="sxs-lookup"><span data-stu-id="fcc41-211">Create the BizTalk Services project</span></span>
1. <span data-ttu-id="fcc41-212">En la solución de Visual Studio, expanda el proyecto InvoiceProcessingBridge y luego abra el archivo **MessageFlowItinerary.bcs** .</span><span class="sxs-lookup"><span data-stu-id="fcc41-212">In the Visual Studio solution, expand the InvoiceProcessingBridge project, and then open the **MessageFlowItinerary.bcs** file.</span></span>
2. <span data-ttu-id="fcc41-213">Haga clic en cualquier parte del lienzo y establezca la **dirección URL del servicio de BizTalk** en el cuadro de propiedad para especificar el nombre de la suscripción de Servicios de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="fcc41-213">Click anywhere on the canvas and set the **BizTalk Service URL** in the property box to specify your BizTalk Services subscription name.</span></span> <span data-ttu-id="fcc41-214">Por ejemplo: `https://contosowabs.biztalk.windows.net`.</span><span class="sxs-lookup"><span data-stu-id="fcc41-214">For example, `https://contosowabs.biztalk.windows.net`.</span></span>
   
   ![][7]  
3. <span data-ttu-id="fcc41-215">En el cuadro de herramientas, arrastre un **puente unidireccional Xml** al lienzo.</span><span class="sxs-lookup"><span data-stu-id="fcc41-215">From the toolbox, drag an **Xml One-Way Bridge** to the canvas.</span></span> <span data-ttu-id="fcc41-216">Establezca las propiedades del puente **Nombre de entidad** y **Dirección relativa** en **ProcessInvoiceBridge**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-216">Set the **Entity Name** and **Relative Address** properties of the bridge to **ProcessInvoiceBridge**.</span></span> <span data-ttu-id="fcc41-217">Haga doble clic en **ProcessInvoiceBridge** para abrir la superficie de configuración del puente.</span><span class="sxs-lookup"><span data-stu-id="fcc41-217">Double-click **ProcessInvoiceBridge** to open the bridge configuration surface.</span></span>
4. <span data-ttu-id="fcc41-218">En el cuadro **Tipos de mensaje**, haga clic en el botón del signo de la suma (**+**) para especificar el esquema del mensaje entrante.</span><span class="sxs-lookup"><span data-stu-id="fcc41-218">Within the **Message Types** box, click the plus (**+**) button to specify the schema of the incoming message.</span></span> <span data-ttu-id="fcc41-219">Como el mensaje entrante para el puente EAI es siempre la factura interna, configúrelo en **INHOUSEINVOICE**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-219">Because the incoming message for the EAI bridge is always the in-house invoice, set this to **INHOUSEINVOICE**.</span></span>
   
   ![][8]  
5. <span data-ttu-id="fcc41-220">Haga clic en la forma **Transformación XML** y, en el cuadro de propiedad, en la propiedad **Asignaciones**, haga clic en el botón de puntos suspensivos (**…**).</span><span class="sxs-lookup"><span data-stu-id="fcc41-220">Click the **Xml Transform** shape, and in the property box, for the **Maps** property, click the ellipsis (**...**) button.</span></span> <span data-ttu-id="fcc41-221">En el cuadro de diálogo **Selección de asignaciones**, seleccione el archivo de transformación **INHOUSEINVOICE_to_D93AINVOIC** y luego haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-221">In the **Maps Selection** dialog box, select the **INHOUSEINVOICE_to_D93AINVOIC** transform file, and then click **OK**.</span></span>
   
   ![][9]  
6. <span data-ttu-id="fcc41-222">Vuelva a **MessageFlowItinerary.bcs** y, en el cuadro de herramientas, arrastre un **punto de conexión de servicio externo bidireccional** a la derecha de **ProcessInvoiceBridge**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-222">Go back to **MessageFlowItinerary.bcs**, and from the toolbox, drag a **Two-Way External Service Endpoint** to the right of the **ProcessInvoiceBridge**.</span></span> <span data-ttu-id="fcc41-223">Establezca su propiedad **Nombre de entidad** en **EDIBridge**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-223">Set its **Entity Name** property to **EDIBridge**.</span></span>
7. <span data-ttu-id="fcc41-224">En el Explorador de soluciones, expanda **MessageFlowItinerary.bcs** y haga doble clic en el archivo **EDIBridge.config**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-224">In the Solution Explorer, expand the **MessageFlowItinerary.bcs** and double-click the **EDIBridge.config** file.</span></span> <span data-ttu-id="fcc41-225">Reemplace el contenido de **EDIBridge.config** por lo siguiente.</span><span class="sxs-lookup"><span data-stu-id="fcc41-225">Replace the content of the **EDIBridge.config** with the following.</span></span>
   
   > [!NOTE]
   > <span data-ttu-id="fcc41-226">¿Por qué es necesario editar el archivo .config?</span><span class="sxs-lookup"><span data-stu-id="fcc41-226">Why do I need to edit the .config file?</span></span> <span data-ttu-id="fcc41-227">El punto de conexión de servicio externo que agregamos al lienzo del diseñador de puentes representa los puentes EDI que implementamos antes.</span><span class="sxs-lookup"><span data-stu-id="fcc41-227">The external service endpoint that we added to the bridge designer canvas represents the EDI bridges that we deployed earlier.</span></span> <span data-ttu-id="fcc41-228">Los puentes EDI son puentes bidireccionales, con un lado de envío y otro de recepción.</span><span class="sxs-lookup"><span data-stu-id="fcc41-228">EDI bridges are two-way bridges, with a send and receive side.</span></span> <span data-ttu-id="fcc41-229">Sin embargo, el puente EAI que agregamos al diseñador de puentes es unidireccional.</span><span class="sxs-lookup"><span data-stu-id="fcc41-229">However, the EAI bridge that we added to the bridge designer is a one-way bridge.</span></span> <span data-ttu-id="fcc41-230">Por lo tanto, para controlar los distintos patrones de intercambio de mensajes de los dos puentes, usamos un comportamiento de puente personalizado e incluimos su configuración en el archivo .config.</span><span class="sxs-lookup"><span data-stu-id="fcc41-230">So, to handle the different message exchange patterns of the two bridges, we use a custom bridge behavior by including its configuration in the .config file.</span></span> <span data-ttu-id="fcc41-231">Además, el comportamiento personalizado también controla la autenticación en el punto de conexión del puente de envío EDI. Este comportamiento personalizado está disponible como un ejemplo independiente en [BizTalk Services Bridge chaining sample - EAI to EDI (Ejemplo de encadenamiento de puentes de BizTalk Services: de EAI a EDI)](http://code.msdn.microsoft.com/BizTalk-Bridge-chaining-2246b104).</span><span class="sxs-lookup"><span data-stu-id="fcc41-231">Additionally, the custom behavior also handles the authentication to the EDI send bridge endpoint.This custom behavior is available as a separate sample at [BizTalk Services Bridge chaining sample - EAI to EDI](http://code.msdn.microsoft.com/BizTalk-Bridge-chaining-2246b104).</span></span> <span data-ttu-id="fcc41-232">Esta solución reutiliza el ejemplo.</span><span class="sxs-lookup"><span data-stu-id="fcc41-232">This solution reuses the sample.</span></span>  
   > 
   > 
   
   ```
   <?xml version="1.0" encoding="utf-8"?>
   <configuration>
     <system.serviceModel>
       <extensions>
         <behaviorExtensions>
           <add name="BridgeAuthentication" 
                 type="Microsoft.BizTalk.Bridge.Behaviour.BridgeBehaviorElement, Microsoft.BizTalk.Bridge.Behaviour, Version=1.0.0.0, Culture=neutral, PublicKeyToken=ae58f69b69495c05" />
         </behaviorExtensions>
       </extensions>
       <behaviors>
         <endpointBehaviors>
           <behavior name="BridgeAuthenticationConfiguration">
             <!-- Enter the ACS namespace, issuer name and issuer secret of the BizTalk Services deployment -->
             <BridgeAuthentication acsnamespace="[YOUR ACS NAMESPACE]" 
                                   issuername="owner" 
                                   issuersecret="[YOUR ACS SECRET]" />
             <webHttp />
           </behavior>
         </endpointBehaviors>
       </behaviors>
       <bindings>
         <webHttpBinding>
           <binding name="BridgeBindingConfiguration">
             <security mode="Transport" />
           </binding>
         </webHttpBinding>
       </bindings>
       <client>
         <clear />
         <!--
           Go BizTalk Portal > Agreement > Send Settings > Inbound URL
           Copy the Endpoint URL and paste it in the below address field
         -->
         <endpoint name="TwoWayExternalServiceEndpointReference1" 
                   address="[YOUR EDI BRIDGE SEND URI]" 
                   behaviorConfiguration="BridgeAuthenticationConfiguration" 
                   binding="webHttpBinding" 
                   bindingConfiguration="BridgeBindingConfiguration" 
                   contract="System.ServiceModel.Routing.IRequestReplyRouter" />
       </client>
     </system.serviceModel>
   </configuration>
   
   ```
8. <span data-ttu-id="fcc41-233">Actualice el archivo EDIBridge.config para incluir detalles de configuración.</span><span class="sxs-lookup"><span data-stu-id="fcc41-233">Update the EDIBridge.config file to include configuration details</span></span>
   
   * <span data-ttu-id="fcc41-234">En *<behaviors>*, proporcione el espacio de nombres ACS y la clave asociada a la suscripción de BizTalk Services.</span><span class="sxs-lookup"><span data-stu-id="fcc41-234">Under *<behaviors>*, provide the ACS namespace and key associated with the BizTalk Services subscription.</span></span>
   * <span data-ttu-id="fcc41-235">En *<client>*, proporcione el punto de conexión donde se implementa el contrato de envío EDI.</span><span class="sxs-lookup"><span data-stu-id="fcc41-235">Under *<client>*, provide the endpoint where the EDI send agreement is deployed.</span></span>
   
   <span data-ttu-id="fcc41-236">Guarde los cambios y cierre el archivo de configuración.</span><span class="sxs-lookup"><span data-stu-id="fcc41-236">Save changes and close the configuration file.</span></span>
9. <span data-ttu-id="fcc41-237">En el cuadro de herramientas, haga clic en el **Conector** y una los componentes **ProcessInvoiceBridge** y **EDIBridge**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-237">From the Toolbox, click the **Connector** and join the **ProcessInvoiceBridge** and **EDIBridge** components.</span></span> <span data-ttu-id="fcc41-238">Seleccione el conector y, en el cuadro Propiedades, establezca **Condición de filtro** en **Coincidir todo**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-238">Select the connector, and in Properties box, set **Filter Condition** to **Match All**.</span></span> <span data-ttu-id="fcc41-239">Esto garantiza que todos los mensajes procesados por el puente EAI se enrutan al puente EDI.</span><span class="sxs-lookup"><span data-stu-id="fcc41-239">This ensures that all messages processed by the EAI bridge are routed to the EDI bridge.</span></span>
   
   ![][10]  
10. <span data-ttu-id="fcc41-240">Guarde los cambios en la solución.</span><span class="sxs-lookup"><span data-stu-id="fcc41-240">Save changes to the solution.</span></span>  

### <a name="deploy-the-project"></a><span data-ttu-id="fcc41-241">Implementación del proyecto</span><span class="sxs-lookup"><span data-stu-id="fcc41-241">Deploy the project</span></span>
1. <span data-ttu-id="fcc41-242">En el equipo donde creó el proyecto de Servicios de BizTalk, descargue e instale el certificado SSL para su suscripción de Servicios de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="fcc41-242">On the computer where you created the BizTalk Services project, download and install the SSL certificate for your BizTalk Services subscription.</span></span> <span data-ttu-id="fcc41-243">En BizTalk Services, haga clic en **Panel** y luego haga clic en **Descargar certificado SSL**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-243">From , under BizTalk Services, click **Dashboard**, and then click **Download SSL Certificate**.</span></span> <span data-ttu-id="fcc41-244">Haga doble clic en el certificado y siga las indicaciones para completar la instalación.</span><span class="sxs-lookup"><span data-stu-id="fcc41-244">Double-click the certificate and follow the prompt to complete the installation.</span></span> <span data-ttu-id="fcc41-245">Asegúrese de instalar el certificado en el almacén de certificados **Entidades de certificación raíz de confianza** .</span><span class="sxs-lookup"><span data-stu-id="fcc41-245">Make sure you install the certificate under **Trusted Root Certification Authorities** certificate store.</span></span>
2. <span data-ttu-id="fcc41-246">En el Explorador de soluciones de Visual Studio, haga clic con el botón derecho en el proyecto **InvoiceProcessingBridge** y luego haga clic en **Implementar**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-246">In Visual Studio Solution Explorer, right-click the **InvoiceProcessingBridge** project, and then click **Deploy**.</span></span>
3. <span data-ttu-id="fcc41-247">Proporcione los valores como se muestra en la imagen y luego haga clic en **Implementar**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-247">Provide the values as shown in the image, and then click **Deploy**.</span></span> <span data-ttu-id="fcc41-248">Para obtener las credenciales de ACS para Servicios de BizTalk, haga clic en **Información de conexión** en el panel de Servicios de BizTalk.</span><span class="sxs-lookup"><span data-stu-id="fcc41-248">You can get the ACS credentials for BizTalk Services by clicking **Connection Information** from the BizTalk Services dashboard.</span></span>
   
   ![][11]  
   
   <span data-ttu-id="fcc41-249">En el panel de resultados, copie el punto de conexión donde se implementa el puente EAI, por ejemplo, `https://contosowabs.biztalk.windows.net/default/ProcessInvoiceBridge`.</span><span class="sxs-lookup"><span data-stu-id="fcc41-249">From the output pane, copy the endpoint where the EAI bridge is deployed, for example, `https://contosowabs.biztalk.windows.net/default/ProcessInvoiceBridge`.</span></span> <span data-ttu-id="fcc41-250">Necesitará esta dirección URL del punto de conexión más adelante.</span><span class="sxs-lookup"><span data-stu-id="fcc41-250">You will need this endpoint URL later.</span></span>  

## <a name="step-4-test-the-solution"></a><span data-ttu-id="fcc41-251">Paso 4: Prueba de la solución</span><span class="sxs-lookup"><span data-stu-id="fcc41-251">Step 4: Test the solution</span></span>
<span data-ttu-id="fcc41-252">En este tema, examinaremos cómo probar la solución mediante la aplicación **Tutorial Client** proporcionada como parte del ejemplo.</span><span class="sxs-lookup"><span data-stu-id="fcc41-252">In this topic, we look at how to test the solution by using the **Tutorial Client** application provided as part of the sample.</span></span>  

1. <span data-ttu-id="fcc41-253">En Visual Studio, presione F5 para iniciar **Tutorial Client**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-253">In Visual Studio, press F5 to start the **Tutorial Client**.</span></span>
2. <span data-ttu-id="fcc41-254">La pantalla debe mostrar los valores completados en el paso donde creamos las colas de Bus de servicio.</span><span class="sxs-lookup"><span data-stu-id="fcc41-254">The screen must have the values prepopulated from the step where we created the Service Bus queues.</span></span> <span data-ttu-id="fcc41-255">Haga clic en **Siguiente**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-255">Click **Next**.</span></span>
3. <span data-ttu-id="fcc41-256">En la siguiente ventana, proporcione las credenciales de ACS para la suscripción de Servicios de BizTalk y los puntos de conexión donde se implementan los puentes EAI y EDI (recepción).</span><span class="sxs-lookup"><span data-stu-id="fcc41-256">In the next window, provide ACS credentials for BizTalk Services subscription, and the endpoints where EAI and EDI (receive) bridges are deployed.</span></span>
   
   <span data-ttu-id="fcc41-257">Ya copió el punto de conexión del puente EAI en el paso anterior.</span><span class="sxs-lookup"><span data-stu-id="fcc41-257">You had copied the EAI bridge endpoint in the previous step.</span></span> <span data-ttu-id="fcc41-258">Para el punto de conexión del puente de recepción EDI, en el Portal de Servicios de BizTalk, vaya al contrato > Configuración de recepción > Transporte > Punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="fcc41-258">For EDI receive bridge endpoint, in the BizTalk Services Portal, go to the agreement > Receive Settings > Transport > Endpoint.</span></span>
   
   ![][12]  
4. <span data-ttu-id="fcc41-259">En la ventana siguiente, en Contoso, haga clic en el botón **Enviar factura interna** .</span><span class="sxs-lookup"><span data-stu-id="fcc41-259">In the next window, under Contoso, click the **Send In-house Invoice** button.</span></span> <span data-ttu-id="fcc41-260">En el cuadro de diálogo Abrir, abra el archivo INHOUSEINVOICE.txt.</span><span class="sxs-lookup"><span data-stu-id="fcc41-260">In the File open dialog box, open the INHOUSEINVOICE.txt file.</span></span> <span data-ttu-id="fcc41-261">Examine el contenido del archivo y luego haga clic en **Aceptar** para enviar la factura.</span><span class="sxs-lookup"><span data-stu-id="fcc41-261">Examine the content of the file and then click **OK** to send the invoice.</span></span>
   
   ![][13]  
5. <span data-ttu-id="fcc41-262">En unos segundos, Northwind recibe la factura.</span><span class="sxs-lookup"><span data-stu-id="fcc41-262">In a few seconds the invoice is received at Northwind.</span></span> <span data-ttu-id="fcc41-263">Haga clic en el vínculo **Ver mensaje** para ver la factura recibida por Northwind.</span><span class="sxs-lookup"><span data-stu-id="fcc41-263">Click the **View Message** link to see the invoice received by Northwind.</span></span> <span data-ttu-id="fcc41-264">Observe cómo la factura que recibe Northwind está en formato EDIFACT estándar, mientras que la enviada por Contoso estaba en formato interno.</span><span class="sxs-lookup"><span data-stu-id="fcc41-264">Notice how the invoice received by Northwind is in standard EDIFACT schema while the one sent by Contoso was an in-house schema.</span></span>
   
   ![][14]  
6. <span data-ttu-id="fcc41-265">Seleccione la factura y luego haga clic en **Enviar confirmación**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-265">Select the invoice and then click **Send Acknowledgement**.</span></span> <span data-ttu-id="fcc41-266">En el cuadro de diálogo que aparece, observe que el identificador de intercambio es igual en la factura recibida y en la confirmación enviada.</span><span class="sxs-lookup"><span data-stu-id="fcc41-266">In the dialog box that pops up, notice that the interchange ID is same in the received invoice and the acknowledgement being sent.</span></span> <span data-ttu-id="fcc41-267">Haga clic en Aceptar en el cuadro de diálogo **Enviar confirmación** .</span><span class="sxs-lookup"><span data-stu-id="fcc41-267">Click OK in the **Send Acknowledgement** dialog box.</span></span>
   
   ![][15]  
7. <span data-ttu-id="fcc41-268">En unos segundos, Contoso recibe la confirmación correctamente.</span><span class="sxs-lookup"><span data-stu-id="fcc41-268">In a few seconds, the acknowledgement is successfully received at Contoso.</span></span>
   
   ![][16]  

## <a name="step-5-optional-send-edifact-invoice-in-batches"></a><span data-ttu-id="fcc41-269">Paso 5 (opcional): Envío de facturas EDIFACT en lotes</span><span class="sxs-lookup"><span data-stu-id="fcc41-269">Step 5 (optional): Send EDIFACT invoice in batches</span></span>
<span data-ttu-id="fcc41-270">Los puentes EDI de Servicios de BizTalk también admiten el procesamiento en lotes de los mensajes salientes.</span><span class="sxs-lookup"><span data-stu-id="fcc41-270">BizTalk Services EDI bridges also supports batching of outgoing messages.</span></span> <span data-ttu-id="fcc41-271">Esta función es útil para los socios receptores que prefieren recibir un lote de mensajes (que cumpla ciertos criterios), en lugar de mensajes individuales.</span><span class="sxs-lookup"><span data-stu-id="fcc41-271">This feature is useful for receiving partners that prefer to receive a batch of messages (meeting certain criterion) instead of individual messages.</span></span>

<span data-ttu-id="fcc41-272">El factor más importante al trabajar con lotes es la emisión real del lote, también llamado el criterio de liberación.</span><span class="sxs-lookup"><span data-stu-id="fcc41-272">The most important aspect when working with batches is the actual release of the batch, also called the release criteria.</span></span> <span data-ttu-id="fcc41-273">Este criterio de liberación se puede basar en cómo quiere recibir los mensajes el socio receptor.</span><span class="sxs-lookup"><span data-stu-id="fcc41-273">The release criteria can be based on how the receiving partner wants to receive messages.</span></span> <span data-ttu-id="fcc41-274">Si el procesamiento por lotes está habilitado, el puente EDI no envía el mensaje saliente al socio receptor hasta que se cumple el criterio de liberación.</span><span class="sxs-lookup"><span data-stu-id="fcc41-274">If batching is enabled, the EDI bridge does not send the outgoing message to the receiving partner until the release criteria is fulfilled.</span></span> <span data-ttu-id="fcc41-275">Por ejemplo, un criterio de procesamiento en lotes basado en el tamaño del mensaje libera un lote una vez que se procesan "n" mensajes en el lote.</span><span class="sxs-lookup"><span data-stu-id="fcc41-275">For example, a batching criteria based on message size dispatches a batch only when ‘n’ messages are batched.</span></span> <span data-ttu-id="fcc41-276">Un criterio de procesamiento por lotes también se puede basar en la hora, de modo que se envíe un lote a una hora fijada todos los días.</span><span class="sxs-lookup"><span data-stu-id="fcc41-276">A batch criteria can also be time-based, such that a batch is sent at a fixed time every day.</span></span> <span data-ttu-id="fcc41-277">En esta solución, analizamos los criterios basados en el tamaño del mensaje.</span><span class="sxs-lookup"><span data-stu-id="fcc41-277">In this solution, we try the message-size based criteria.</span></span>

1. <span data-ttu-id="fcc41-278">En el Portal de Servicios de BizTalk, haga clic en el contrato que creó antes.</span><span class="sxs-lookup"><span data-stu-id="fcc41-278">In the BizTalk Services Portal, click the agreement you created earlier.</span></span> <span data-ttu-id="fcc41-279">Haga clic en Configuración de envío > Procesamiento por lotes > Agregar lote.</span><span class="sxs-lookup"><span data-stu-id="fcc41-279">Click Send Settings > Batching > Add Batch.</span></span>
2. <span data-ttu-id="fcc41-280">Para el nombre del lote, escriba **InvoiceBatch**, proporcione una descripción y luego haga clic en **Siguiente**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-280">For batch name, enter **InvoiceBatch**, provide a description, and then click **Next**.</span></span>
3. <span data-ttu-id="fcc41-281">Especifique un criterio de procesamiento por lotes, que defina qué mensajes se deben procesar por lotes.</span><span class="sxs-lookup"><span data-stu-id="fcc41-281">Specify a batch criteria, that defines which messages must be batched.</span></span> <span data-ttu-id="fcc41-282">En esta solución, procesamos por lote todos los mensajes.</span><span class="sxs-lookup"><span data-stu-id="fcc41-282">In this solution, we batch all messages.</span></span> <span data-ttu-id="fcc41-283">Así que, seleccione la opción Usar definiciones avanzadas y escriba **1 = 1**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-283">So, select the Use advanced definitions option, and enter **1 = 1**.</span></span> <span data-ttu-id="fcc41-284">Esta es una condición que siempre será verdadera y, por eso, todos los mensajes se procesarán por lotes.</span><span class="sxs-lookup"><span data-stu-id="fcc41-284">This is a condition which will always be true, and hence all messages will be batched.</span></span> <span data-ttu-id="fcc41-285">Haga clic en **Siguiente**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-285">Click **Next**.</span></span>
   
   ![][17]  
4. <span data-ttu-id="fcc41-286">Especifique un criterio de liberación por lotes.</span><span class="sxs-lookup"><span data-stu-id="fcc41-286">Specify a batch release criteria.</span></span> <span data-ttu-id="fcc41-287">En la lista desplegable, seleccione **MessageCountBased** y, para **Recuento**, especifique **3**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-287">From the drop-box, select **MessageCountBased**, and for **Count**, specify **3**.</span></span> <span data-ttu-id="fcc41-288">Es decir, se enviará a Northwind un lote de tres mensajes.</span><span class="sxs-lookup"><span data-stu-id="fcc41-288">This means that a batch of three messages will be sent to Northwind.</span></span> <span data-ttu-id="fcc41-289">Haga clic en **Siguiente**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-289">Click **Next**.</span></span>
   
   ![][18]  
5. <span data-ttu-id="fcc41-290">Revise el resumen y luego haga clic en **Guardar**.</span><span class="sxs-lookup"><span data-stu-id="fcc41-290">Review the summary and then click **Save**.</span></span> <span data-ttu-id="fcc41-291">Haga clic en **Implementar** para volver a implementar el contrato.</span><span class="sxs-lookup"><span data-stu-id="fcc41-291">Click **Deploy** to redeploy the agreement.</span></span>
6. <span data-ttu-id="fcc41-292">Vuelva a **Tutorial Client**, haga clic en **Enviar factura interna** y siga las indicaciones para enviar la factura.</span><span class="sxs-lookup"><span data-stu-id="fcc41-292">Go back to the **Tutorial Client**, click **Send In-house Invoice**, and follow the prompts to send the invoice.</span></span> <span data-ttu-id="fcc41-293">Verá que Northwind no recibe ninguna factura porque no se cumple el tamaño del lote.</span><span class="sxs-lookup"><span data-stu-id="fcc41-293">You will notice that no invoice is received at Northwind because the batch size is not met.</span></span> <span data-ttu-id="fcc41-294">Repita este paso dos veces para tener tres mensajes de factura para enviar a Northwind.</span><span class="sxs-lookup"><span data-stu-id="fcc41-294">Repeat this step two more times, so that you have three invoice messages sent to Northwind.</span></span> <span data-ttu-id="fcc41-295">Con esto, se cumple el criterio de liberación del lote de tres mensajes, por lo que ahora se debería ver una factura en Northwind.</span><span class="sxs-lookup"><span data-stu-id="fcc41-295">This satisfies the batch release criteria of 3 messages and you should now see an invoice at Northwind.</span></span>

<!--Image references-->
[1]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-1.PNG  
[2]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-2.PNG  
[3]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-3.PNG
[4]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-4.PNG  
[5]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-5.PNG  
[6]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-6.PNG  
[7]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-7.PNG  
[8]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-8.PNG
[9]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-9.PNG  
[10]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-10.PNG  
[11]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-11.PNG  
[12]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-12.PNG  
[13]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-13.PNG
[14]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-14.PNG  
[15]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-15.PNG  
[16]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-16.PNG  
[17]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-17.PNG  
[18]: ./media/biztalk-process-edifact-invoice/process-edifact-invoices-with-auzure-bts-18.PNG


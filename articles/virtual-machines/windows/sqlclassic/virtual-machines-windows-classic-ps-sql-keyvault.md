---
title: "el almacén de claves con SQL Server en máquinas virtuales de Windows Azure (clásica) aaaIntegrate | Documentos de Microsoft"
description: "Obtenga información acerca de cómo tooautomate Hola configuración de cifrado de SQL Server para su uso con el almacén de claves de Azure. Este tema explica cómo se crean toouse integración del almacén de claves de Azure con máquinas virtuales de SQL Server en el modelo de implementación clásica de Hola."
services: virtual-machines-windows
documentationcenter: 
author: rothja
manager: jhubbard
editor: 
tags: azure-service-management
ms.assetid: ab8d41a7-1971-4032-ab71-eb435c455dc1
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 02/17/2017
ms.author: jroth
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 54664875b76dac7271d5a9f00b3f41fdc9c08491
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="configure-azure-key-vault-integration-for-sql-server-on-azure-virtual-machines-classic"></a><span data-ttu-id="fa34c-104">Configurar la integración de Azure Key Vault para SQL Server en máquinas virtuales de Azure (implementación clásica)</span><span class="sxs-lookup"><span data-stu-id="fa34c-104">Configure Azure Key Vault Integration for SQL Server on Azure Virtual Machines (Classic)</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="fa34c-105">Resource Manager</span><span class="sxs-lookup"><span data-stu-id="fa34c-105">Resource Manager</span></span>](../sql/virtual-machines-windows-ps-sql-keyvault.md)
> * [<span data-ttu-id="fa34c-106">Clásico</span><span class="sxs-lookup"><span data-stu-id="fa34c-106">Classic</span></span>](../classic/ps-sql-keyvault.md)
> 
> 

## <a name="overview"></a><span data-ttu-id="fa34c-107">Información general</span><span class="sxs-lookup"><span data-stu-id="fa34c-107">Overview</span></span>
<span data-ttu-id="fa34c-108">SQL Server tiene varias características de cifrado, como el [cifrado de datos transparente (TDE)](https://msdn.microsoft.com/library/bb934049.aspx), el [cifrado de nivel de columna (CLE)](https://msdn.microsoft.com/library/ms173744.aspx) y el [cifrado de copia de seguridad](https://msdn.microsoft.com/library/dn449489.aspx).</span><span class="sxs-lookup"><span data-stu-id="fa34c-108">There are multiple SQL Server encryption features, such as [transparent data encryption (TDE)](https://msdn.microsoft.com/library/bb934049.aspx), [column level encryption (CLE)](https://msdn.microsoft.com/library/ms173744.aspx), and [backup encryption](https://msdn.microsoft.com/library/dn449489.aspx).</span></span> <span data-ttu-id="fa34c-109">Estas formas de cifrado requieren toomanage y almacenan las claves criptográficas de Hola que utilice para el cifrado.</span><span class="sxs-lookup"><span data-stu-id="fa34c-109">These forms of encryption require you toomanage and store hello cryptographic keys you use for encryption.</span></span> <span data-ttu-id="fa34c-110">Hola servicio de almacén de claves de Azure (claves) está diseñado tooimprove Hola seguridad y la administración de estas claves en una ubicación segura y altamente disponible.</span><span class="sxs-lookup"><span data-stu-id="fa34c-110">hello Azure Key Vault (AKV) service is designed tooimprove hello security and management of these keys in a secure and highly available location.</span></span> <span data-ttu-id="fa34c-111">Hola [conector de SQL Server](http://www.microsoft.com/download/details.aspx?id=45344) permite a SQL Server toouse estas claves del almacén de claves de Azure.</span><span class="sxs-lookup"><span data-stu-id="fa34c-111">hello [SQL Server Connector](http://www.microsoft.com/download/details.aspx?id=45344) enables SQL Server toouse these keys from Azure Key Vault.</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="fa34c-112">Azure tiene dos modelos de implementación diferentes para crear recursos y trabajar con ellos: [Resource Manager y el clásico](../../../azure-resource-manager/resource-manager-deployment-model.md).</span><span class="sxs-lookup"><span data-stu-id="fa34c-112">Azure has two different deployment models for creating and working with resources: [Resource Manager and Classic](../../../azure-resource-manager/resource-manager-deployment-model.md).</span></span> <span data-ttu-id="fa34c-113">Este artículo tratan con modelo de implementación de hello clásico.</span><span class="sxs-lookup"><span data-stu-id="fa34c-113">This article covers using hello Classic deployment model.</span></span> <span data-ttu-id="fa34c-114">Microsoft recomienda que más nuevas implementaciones de usar el modelo del Administrador de recursos de Hola.</span><span class="sxs-lookup"><span data-stu-id="fa34c-114">Microsoft recommends that most new deployments use hello Resource Manager model.</span></span>

<span data-ttu-id="fa34c-115">Si está ejecutando SQL Server con equipos locales, hay [pasos que puede seguir tooaccess el almacén de claves de Azure desde el equipo de SQL Server local](https://msdn.microsoft.com/library/dn198405.aspx).</span><span class="sxs-lookup"><span data-stu-id="fa34c-115">If you are running SQL Server with on-premises machines, there are [steps you can follow tooaccess Azure Key Vault from your on-premises SQL Server machine](https://msdn.microsoft.com/library/dn198405.aspx).</span></span> <span data-ttu-id="fa34c-116">Pero para SQL Server en máquinas virtuales de Azure, puede ahorrar tiempo mediante el uso de hello *integración del almacén de claves de Azure* característica.</span><span class="sxs-lookup"><span data-stu-id="fa34c-116">But for SQL Server in Azure VMs, you can save time by using hello *Azure Key Vault Integration* feature.</span></span> <span data-ttu-id="fa34c-117">Con unos tooenable de cmdlets de PowerShell de Azure esta característica, puede automatizar Hola configuración necesaria para una VM de SQL tooaccess el almacén de claves.</span><span class="sxs-lookup"><span data-stu-id="fa34c-117">With a few Azure PowerShell cmdlets tooenable this feature, you can automate hello configuration necessary for a SQL VM tooaccess your key vault.</span></span>

<span data-ttu-id="fa34c-118">Cuando esta característica está habilitada, Hola conector de SQL Server se instala, configura Hola EKM proveedor tooaccess el almacén de claves de Azure y automáticamente crea Hola credencial tooallow se tooaccess el almacén.</span><span class="sxs-lookup"><span data-stu-id="fa34c-118">When this feature is enabled, it automatically installs hello SQL Server Connector, configures hello EKM provider tooaccess Azure Key Vault, and creates hello credential tooallow you tooaccess your vault.</span></span> <span data-ttu-id="fa34c-119">Si busca en pasos de Hola Hola se ha mencionado previamente documentación local, puede ver que esta característica automatiza los pasos 2 y 3.</span><span class="sxs-lookup"><span data-stu-id="fa34c-119">If you looked at hello steps in hello previously mentioned on-premises documentation, you can see that this feature automates steps 2 and 3.</span></span> <span data-ttu-id="fa34c-120">lo único que Hola todavía necesitaría toodo manualmente es claves y el almacén de claves de hello toocreate.</span><span class="sxs-lookup"><span data-stu-id="fa34c-120">hello only thing you would still need toodo manually is toocreate hello key vault and keys.</span></span> <span data-ttu-id="fa34c-121">Desde allí, se automatiza la instalación completa de hello de la VM de SQL.</span><span class="sxs-lookup"><span data-stu-id="fa34c-121">From there, hello entire setup of your SQL VM is automated.</span></span> <span data-ttu-id="fa34c-122">Una vez completada la instalación, esta característica puede ejecutar toobegin de instrucciones de T-SQL cifrar sus bases de datos o las copias de seguridad, tal y como lo haría normalmente.</span><span class="sxs-lookup"><span data-stu-id="fa34c-122">Once this feature has completed this setup, you can execute T-SQL statements toobegin encrypting your databases or backups as you normally would.</span></span>

[!INCLUDE [AKV Integration Prepare](../../../../includes/virtual-machines-sql-server-akv-prepare.md)]

## <a name="configure-akv-integration"></a><span data-ttu-id="fa34c-123">Configuración de la integración de AKV</span><span class="sxs-lookup"><span data-stu-id="fa34c-123">Configure AKV Integration</span></span>
<span data-ttu-id="fa34c-124">Usar PowerShell tooconfigure integración del almacén de claves de Azure.</span><span class="sxs-lookup"><span data-stu-id="fa34c-124">Use PowerShell tooconfigure Azure Key Vault Integration.</span></span> <span data-ttu-id="fa34c-125">Hello las secciones siguientes proporciona una introducción de los parámetros de hello necesario y, a continuación, un script de PowerShell de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="fa34c-125">hello following sections provide an overview of hello required parameters and then a sample PowerShell script.</span></span>

### <a name="install-hello-sql-server-iaas-extension"></a><span data-ttu-id="fa34c-126">Instalar Hola extensión de IaaS de SQL Server</span><span class="sxs-lookup"><span data-stu-id="fa34c-126">Install hello SQL Server IaaS Extension</span></span>
<span data-ttu-id="fa34c-127">En primer lugar, [instalar Hola extensión de IaaS de SQL Server](../classic/sql-server-agent-extension.md).</span><span class="sxs-lookup"><span data-stu-id="fa34c-127">First, [install hello SQL Server IaaS Extension](../classic/sql-server-agent-extension.md).</span></span>

### <a name="understand-hello-input-parameters"></a><span data-ttu-id="fa34c-128">Comprender los parámetros de entrada de Hola</span><span class="sxs-lookup"><span data-stu-id="fa34c-128">Understand hello input parameters</span></span>
<span data-ttu-id="fa34c-129">Hello siguiente tabla listas Hola requieren parámetros toorun script de PowerShell de hello en la sección siguiente Hola.</span><span class="sxs-lookup"><span data-stu-id="fa34c-129">hello following table lists hello parameters required toorun hello PowerShell script in hello next section.</span></span>

| <span data-ttu-id="fa34c-130">Parámetro</span><span class="sxs-lookup"><span data-stu-id="fa34c-130">Parameter</span></span> | <span data-ttu-id="fa34c-131">Description</span><span class="sxs-lookup"><span data-stu-id="fa34c-131">Description</span></span> | <span data-ttu-id="fa34c-132">Ejemplo</span><span class="sxs-lookup"><span data-stu-id="fa34c-132">Example</span></span> |
| --- | --- | --- |
| <span data-ttu-id="fa34c-133">**$akvURL**</span><span class="sxs-lookup"><span data-stu-id="fa34c-133">**$akvURL**</span></span> |<span data-ttu-id="fa34c-134">**dirección URL del almacén de claves de Hola**</span><span class="sxs-lookup"><span data-stu-id="fa34c-134">**hello key vault URL**</span></span> |<span data-ttu-id="fa34c-135">"https://contosokeyvault.vault.azure.net/"</span><span class="sxs-lookup"><span data-stu-id="fa34c-135">"https://contosokeyvault.vault.azure.net/"</span></span> |
| <span data-ttu-id="fa34c-136">**$spName**</span><span class="sxs-lookup"><span data-stu-id="fa34c-136">**$spName**</span></span> |<span data-ttu-id="fa34c-137">**Nombre de entidad de servicio**</span><span class="sxs-lookup"><span data-stu-id="fa34c-137">**Service Principal name**</span></span> |<span data-ttu-id="fa34c-138">"fde2b411-33d5-4e11-af04eb07b669ccf2"</span><span class="sxs-lookup"><span data-stu-id="fa34c-138">"fde2b411-33d5-4e11-af04eb07b669ccf2"</span></span> |
| <span data-ttu-id="fa34c-139">**$spSecret**</span><span class="sxs-lookup"><span data-stu-id="fa34c-139">**$spSecret**</span></span> |<span data-ttu-id="fa34c-140">**Secreto de entidad de servicio**</span><span class="sxs-lookup"><span data-stu-id="fa34c-140">**Service Principal secret**</span></span> |<span data-ttu-id="fa34c-141">"9VTJSQwzlFepD8XODnzy8n2V01Jd8dAjwm/azF1XDKM="</span><span class="sxs-lookup"><span data-stu-id="fa34c-141">"9VTJSQwzlFepD8XODnzy8n2V01Jd8dAjwm/azF1XDKM="</span></span> |
| <span data-ttu-id="fa34c-142">**$credName**</span><span class="sxs-lookup"><span data-stu-id="fa34c-142">**$credName**</span></span> |<span data-ttu-id="fa34c-143">**Nombre de la credencial**: integración de claves crea una credencial de SQL Server, lo que permite Hola VM toohave acceso toohello el almacén de claves.</span><span class="sxs-lookup"><span data-stu-id="fa34c-143">**Credential name**: AKV Integration creates a credential within SQL Server, allowing hello VM toohave access toohello key vault.</span></span> <span data-ttu-id="fa34c-144">Elija un nombre para esta credencial.</span><span class="sxs-lookup"><span data-stu-id="fa34c-144">Choose a name for this credential.</span></span> |<span data-ttu-id="fa34c-145">"mycred1"</span><span class="sxs-lookup"><span data-stu-id="fa34c-145">"mycred1"</span></span> |
| <span data-ttu-id="fa34c-146">**$vmName**</span><span class="sxs-lookup"><span data-stu-id="fa34c-146">**$vmName**</span></span> |<span data-ttu-id="fa34c-147">**Nombre de máquina virtual**: nombre de Hola de una VM de SQL creado anteriormente.</span><span class="sxs-lookup"><span data-stu-id="fa34c-147">**Virtual machine name**: hello name of a previously created SQL VM.</span></span> |<span data-ttu-id="fa34c-148">"myvmname"</span><span class="sxs-lookup"><span data-stu-id="fa34c-148">"myvmname"</span></span> |
| <span data-ttu-id="fa34c-149">**$serviceName**</span><span class="sxs-lookup"><span data-stu-id="fa34c-149">**$serviceName**</span></span> |<span data-ttu-id="fa34c-150">**Nombre del servicio**: nombre de servicio en la nube de Hola que está asociado con hello VM de SQL.</span><span class="sxs-lookup"><span data-stu-id="fa34c-150">**Service name**: hello Cloud Service name that is associated with hello SQL VM.</span></span> |<span data-ttu-id="fa34c-151">"mycloudservicename"</span><span class="sxs-lookup"><span data-stu-id="fa34c-151">"mycloudservicename"</span></span> |

### <a name="enable-akv-integration-with-powershell"></a><span data-ttu-id="fa34c-152">Habilitación de la integración de AKV con PowerShell</span><span class="sxs-lookup"><span data-stu-id="fa34c-152">Enable AKV Integration with PowerShell</span></span>
<span data-ttu-id="fa34c-153">Hola **AzureVMSqlServerKeyVaultCredentialConfig New** crea un objeto de configuración para la característica de integración del almacén de claves de Azure de Hola.</span><span class="sxs-lookup"><span data-stu-id="fa34c-153">hello **New-AzureVMSqlServerKeyVaultCredentialConfig** cmdlet creates a configuration object for hello Azure Key Vault Integration feature.</span></span> <span data-ttu-id="fa34c-154">Hola **conjunto AzureVMSqlServerExtension** configura esta integración con hello **KeyVaultCredentialSettings** parámetro.</span><span class="sxs-lookup"><span data-stu-id="fa34c-154">hello **Set-AzureVMSqlServerExtension** configures this integration with hello **KeyVaultCredentialSettings** parameter.</span></span> <span data-ttu-id="fa34c-155">Hola siguientes pasos muestran cómo toouse estos comandos.</span><span class="sxs-lookup"><span data-stu-id="fa34c-155">hello following steps show how toouse these commands.</span></span>

1. <span data-ttu-id="fa34c-156">En PowerShell de Azure, en primer lugar configurar parámetros de entrada de hello con los valores específicos como se describe en secciones anteriores de Hola de este tema.</span><span class="sxs-lookup"><span data-stu-id="fa34c-156">In Azure PowerShell, first configure hello input parameters with your specific values as described in hello previous sections of this topic.</span></span> <span data-ttu-id="fa34c-157">Hola siguiente secuencia de comandos es un ejemplo.</span><span class="sxs-lookup"><span data-stu-id="fa34c-157">hello following script is an example.</span></span>
   
        $akvURL = "https://contosokeyvault.vault.azure.net/"
        $spName = "fde2b411-33d5-4e11-af04eb07b669ccf2"
        $spSecret = "9VTJSQwzlFepD8XODnzy8n2V01Jd8dAjwm/azF1XDKM="
        $credName = "mycred1"
        $vmName = "myvmname"
        $serviceName = "mycloudservicename"
2. <span data-ttu-id="fa34c-158">A continuación, usar a continuación Hola script tooconfigure y habilitar la integración de claves.</span><span class="sxs-lookup"><span data-stu-id="fa34c-158">Then use hello following script tooconfigure and enable AKV Integration.</span></span>
   
        $secureakv =  $spSecret | ConvertTo-SecureString -AsPlainText -Force
        $akvs = New-AzureVMSqlServerKeyVaultCredentialConfig -Enable -CredentialName $credname -AzureKeyVaultUrl $akvURL -ServicePrincipalName $spName -ServicePrincipalSecret $secureakv
        Get-AzureVM -ServiceName $serviceName -Name $vmName | Set-AzureVMSqlServerExtension -KeyVaultCredentialSettings $akvs | Update-AzureVM

<span data-ttu-id="fa34c-159">Hola extensión del agente de IaaS de SQL actualizará Hola VM de SQL con esta nueva configuración.</span><span class="sxs-lookup"><span data-stu-id="fa34c-159">hello SQL IaaS Agent Extension will update hello SQL VM with this new configuration.</span></span>

[!INCLUDE [AKV Integration Next Steps](../../../../includes/virtual-machines-sql-server-akv-next-steps.md)]


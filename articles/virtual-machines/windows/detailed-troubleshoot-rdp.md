---
title: solucionar problemas de Azure de escritorio remoto aaaDetailed | Documentos de Microsoft
description: "Revise los pasos de solución de problemas detallados para los errores de escritorio remotos donde no máquinas virtuales de Windows tooa en Azure"
services: virtual-machines-windows
documentationcenter: 
author: genlin
manager: timlt
editor: 
tags: top-support-issue,azure-service-management,azure-resource-manager
keywords: "no se puede conectar tooremote escritorio, solucionar problemas de escritorio remoto, no se puede conectar a Escritorio remoto, los errores de escritorio remotos, la solución de problemas de escritorio de forma remota, problemas de escritorio remoto"
ms.assetid: 9da36f3d-30dd-44af-824b-8ce5ef07e5e0
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: support-article
ms.date: 07/25/2017
ms.author: genli
ms.openlocfilehash: fcb0d06aa66b748f3ebbbbe3431471d3cbe7c60d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="detailed-troubleshooting-steps-for-remote-desktop-connection-issues-toowindows-vms-in-azure"></a><span data-ttu-id="a4326-104">Pasos detallados de solución de problemas de conexión a Escritorio remoto emite tooWindows máquinas virtuales en Azure</span><span class="sxs-lookup"><span data-stu-id="a4326-104">Detailed troubleshooting steps for remote desktop connection issues tooWindows VMs in Azure</span></span>
<span data-ttu-id="a4326-105">Este artículo proporciona pasos de solución de problemas detalladas toodiagnose y corregir errores complejos de escritorio remoto para máquinas virtuales Azure basadas en Windows.</span><span class="sxs-lookup"><span data-stu-id="a4326-105">This article provides detailed troubleshooting steps toodiagnose and fix complex Remote Desktop errors for Windows-based Azure virtual machines.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a4326-106">tooeliminate Hola los errores más comunes de escritorio remoto, asegúrese de que tooread [artículo de solución de problemas básicos de Hola para escritorio remoto](troubleshoot-rdp-connection.md) antes de continuar.</span><span class="sxs-lookup"><span data-stu-id="a4326-106">tooeliminate hello more common Remote Desktop errors, make sure tooread [hello basic troubleshooting article for Remote Desktop](troubleshoot-rdp-connection.md) before proceeding.</span></span>

<span data-ttu-id="a4326-107">Puede encontrar un escritorio remoto trata el mensaje de error que no se parece a cualquiera de los mensajes de error específicos de Hola en [Hola guía para solucionar problemas de escritorio remoto básica](troubleshoot-rdp-connection.md).</span><span class="sxs-lookup"><span data-stu-id="a4326-107">You may encounter a Remote Desktop error message that does not resemble any of hello specific error messages covered in [hello basic Remote Desktop troubleshooting guide](troubleshoot-rdp-connection.md).</span></span> <span data-ttu-id="a4326-108">Siga estos toodetermine pasos ¿por qué cliente de escritorio remoto (RDP) de hello es servicio RDP de toohello de tooconnect no se puede en hello VM de Azure.</span><span class="sxs-lookup"><span data-stu-id="a4326-108">Follow these steps toodetermine why hello Remote Desktop (RDP) client is unable tooconnect toohello RDP service on hello Azure VM.</span></span>

[!INCLUDE [learn-about-deployment-models](../../../includes/learn-about-deployment-models-both-include.md)]

<span data-ttu-id="a4326-109">Si necesita más ayuda en cualquier momento en este artículo, puede ponerse en contacto con hello Azure expertos en [hello Azure de MSDN y Hola foros de desbordamiento de la pila](https://azure.microsoft.com/support/forums/).</span><span class="sxs-lookup"><span data-stu-id="a4326-109">If you need more help at any point in this article, you can contact hello Azure experts on [hello MSDN Azure and hello Stack Overflow forums](https://azure.microsoft.com/support/forums/).</span></span> <span data-ttu-id="a4326-110">Como alternativa, también puede registrar un incidente de soporte técnico de Azure.</span><span class="sxs-lookup"><span data-stu-id="a4326-110">Alternatively, you can also file an Azure support incident.</span></span> <span data-ttu-id="a4326-111">Vaya toohello [sitio de soporte técnico de Azure](https://azure.microsoft.com/support/options/) y haga clic en **Get Support**.</span><span class="sxs-lookup"><span data-stu-id="a4326-111">Go toohello [Azure Support site](https://azure.microsoft.com/support/options/) and click **Get Support**.</span></span> <span data-ttu-id="a4326-112">Para obtener información acerca del uso de soporte técnico de Azure, lea hello [P+F de soporte técnico de Microsoft Azure](https://azure.microsoft.com/support/faq/).</span><span class="sxs-lookup"><span data-stu-id="a4326-112">For information about using Azure Support, read hello [Microsoft Azure Support FAQ](https://azure.microsoft.com/support/faq/).</span></span>

## <a name="components-of-a-remote-desktop-connection"></a><span data-ttu-id="a4326-113">Componentes de una conexión de Escritorio remoto</span><span class="sxs-lookup"><span data-stu-id="a4326-113">Components of a Remote Desktop connection</span></span>
<span data-ttu-id="a4326-114">Hola de los componentes siguientes está implicado en una conexión RDP:</span><span class="sxs-lookup"><span data-stu-id="a4326-114">hello following components are involved in an RDP connection:</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_0.png)

<span data-ttu-id="a4326-115">Antes de continuar, puede ser útil toomentally revisar lo que ha cambiado desde Hola última correcta escritorio remoto conexión toohello máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="a4326-115">Before proceeding, it might help toomentally review what has changed since hello last successful Remote Desktop connection toohello VM.</span></span> <span data-ttu-id="a4326-116">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="a4326-116">For example:</span></span>

* <span data-ttu-id="a4326-117">Hola dirección IP pública de hello VM o hello servicio en la nube que contiene Hola VM (también denominado dirección IP virtual de hello [VIP](https://en.wikipedia.org/wiki/Virtual_IP_address)) ha cambiado.</span><span class="sxs-lookup"><span data-stu-id="a4326-117">hello public IP address of hello VM or hello cloud service containing hello VM (also called hello virtual IP address [VIP](https://en.wikipedia.org/wiki/Virtual_IP_address)) has changed.</span></span> <span data-ttu-id="a4326-118">Hola RDP error podría deberse a que la memoria caché del cliente DNS aún Hola *dirección IP antigua* registrado para el nombre DNS de Hola.</span><span class="sxs-lookup"><span data-stu-id="a4326-118">hello RDP failure could be because your DNS client cache still has hello *old IP address* registered for hello DNS name.</span></span> <span data-ttu-id="a4326-119">Vaciar la memoria caché del cliente DNS e intente conectarse Hola VM de nuevo.</span><span class="sxs-lookup"><span data-stu-id="a4326-119">Flush your DNS client cache and try connecting hello VM again.</span></span> <span data-ttu-id="a4326-120">O bien, intente conectarse directamente con hello nueva VIP.</span><span class="sxs-lookup"><span data-stu-id="a4326-120">Or try connecting directly with hello new VIP.</span></span>
* <span data-ttu-id="a4326-121">Está utilizando una aplicación de otro fabricante toomanage las conexiones de escritorio remoto en lugar de usar conexión de hello generado por hello portal de Azure.</span><span class="sxs-lookup"><span data-stu-id="a4326-121">You are using a third-party application toomanage your Remote Desktop connections instead of using hello connection generated by hello Azure portal.</span></span> <span data-ttu-id="a4326-122">Compruebe que configuración de la aplicación hello incluye Hola TCP por el puerto correcto Hola tráfico de escritorio remoto.</span><span class="sxs-lookup"><span data-stu-id="a4326-122">Verify that hello application configuration includes hello correct TCP port for hello Remote Desktop traffic.</span></span> <span data-ttu-id="a4326-123">Puede comprobar este puerto para una máquina virtual clásica en hello [portal de Azure](https://portal.azure.com), haciendo clic en configuración de la máquina virtual de hello > puntos de conexión.</span><span class="sxs-lookup"><span data-stu-id="a4326-123">You can check this port for a classic virtual machine in hello [Azure portal](https://portal.azure.com), by clicking hello VM's Settings > Endpoints.</span></span>

## <a name="preliminary-steps"></a><span data-ttu-id="a4326-124">Pasos previos</span><span class="sxs-lookup"><span data-stu-id="a4326-124">Preliminary steps</span></span>
<span data-ttu-id="a4326-125">Antes de continuar toohello solución de problemas detallada,</span><span class="sxs-lookup"><span data-stu-id="a4326-125">Before proceeding toohello detailed troubleshooting,</span></span>

* <span data-ttu-id="a4326-126">Comprobar estado de Hola de máquina virtual de Hola Hola portal de Azure para cualquier problema obvio.</span><span class="sxs-lookup"><span data-stu-id="a4326-126">Check hello status of hello virtual machine in hello Azure portal for any obvious issues.</span></span>
* <span data-ttu-id="a4326-127">Siga hello [pasos de corrección rápida para errores RDP comunes de solución de problemas básicos hello](troubleshoot-rdp-connection.md#quick-troubleshooting-steps).</span><span class="sxs-lookup"><span data-stu-id="a4326-127">Follow hello [quick fix steps for common RDP errors in hello basic troubleshooting guide](troubleshoot-rdp-connection.md#quick-troubleshooting-steps).</span></span>

<span data-ttu-id="a4326-128">Intente conectarse de nuevo toohello máquina virtual mediante Escritorio remoto después de realizar estos pasos.</span><span class="sxs-lookup"><span data-stu-id="a4326-128">Try reconnecting toohello VM via Remote Desktop after these steps.</span></span>

## <a name="detailed-troubleshooting-steps"></a><span data-ttu-id="a4326-129">Pasos de la solución de problemas detallada</span><span class="sxs-lookup"><span data-stu-id="a4326-129">Detailed troubleshooting steps</span></span>
<span data-ttu-id="a4326-130">cliente de escritorio remoto de Hello no puede ser capaz de tooreach de servicio de escritorio remoto de hello en hello Azure VM due tooissues en hello siguientes orígenes:</span><span class="sxs-lookup"><span data-stu-id="a4326-130">hello Remote Desktop client may not be able tooreach hello Remote Desktop service on hello Azure VM due tooissues at hello following sources:</span></span>

* [<span data-ttu-id="a4326-131">Equipo cliente de Escritorio remoto</span><span class="sxs-lookup"><span data-stu-id="a4326-131">Remote Desktop client computer</span></span>](#source-1-remote-desktop-client-computer)
* [<span data-ttu-id="a4326-132">Dispositivo perimetral de intranet de la organización</span><span class="sxs-lookup"><span data-stu-id="a4326-132">Organization intranet edge device</span></span>](#source-2-organization-intranet-edge-device)
* [<span data-ttu-id="a4326-133">Extremo de servicio en la nube y lista de control de acceso (ACL)</span><span class="sxs-lookup"><span data-stu-id="a4326-133">Cloud service endpoint and access control list (ACL)</span></span>](#source-3-cloud-service-endpoint-and-acl)
* [<span data-ttu-id="a4326-134">Grupos de seguridad de red</span><span class="sxs-lookup"><span data-stu-id="a4326-134">Network security groups</span></span>](#source-4-network-security-groups)
* [<span data-ttu-id="a4326-135">Máquina virtual de Azure basada en Windows</span><span class="sxs-lookup"><span data-stu-id="a4326-135">Windows-based Azure VM</span></span>](#source-5-windows-based-azure-vm)

## <a name="source-1-remote-desktop-client-computer"></a><span data-ttu-id="a4326-136">Causa 1: equipo cliente de Escritorio remoto</span><span class="sxs-lookup"><span data-stu-id="a4326-136">Source 1: Remote Desktop client computer</span></span>
<span data-ttu-id="a4326-137">Compruebe que el equipo puede crear el escritorio remoto conexiones tooanother local, el equipo basado en Windows.</span><span class="sxs-lookup"><span data-stu-id="a4326-137">Verify that your computer can make Remote Desktop connections tooanother on-premises, Windows-based computer.</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_1.png)

<span data-ttu-id="a4326-138">Si no es posible, busque Hola después de configuración en el equipo:</span><span class="sxs-lookup"><span data-stu-id="a4326-138">If you cannot, check for hello following settings on your computer:</span></span>

* <span data-ttu-id="a4326-139">Una configuración del firewall local que bloquea el tráfico de Escritorio remoto</span><span class="sxs-lookup"><span data-stu-id="a4326-139">A local firewall setting that is blocking Remote Desktop traffic.</span></span>
* <span data-ttu-id="a4326-140">Software de proxy de cliente instalado localmente que impide las conexiones a Escritorio remoto</span><span class="sxs-lookup"><span data-stu-id="a4326-140">Locally installed client proxy software that is preventing Remote Desktop connections.</span></span>
* <span data-ttu-id="a4326-141">Software de supervisión de red instalado localmente que impide las conexiones a Escritorio remoto</span><span class="sxs-lookup"><span data-stu-id="a4326-141">Locally installed network monitoring software that is preventing Remote Desktop connections.</span></span>
* <span data-ttu-id="a4326-142">Otro tipo de software de seguridad, por ejemplo, para supervisar el tráfico o para permitir o impedir ciertos tipos de tráfico, que imposibilita las conexiones a Escritorio remoto</span><span class="sxs-lookup"><span data-stu-id="a4326-142">Other types of security software that either monitor traffic or allow/disallow specific types of traffic that is preventing Remote Desktop connections.</span></span>

<span data-ttu-id="a4326-143">En todos estos casos, temporalmente deshabilite software Hola e intente tooconnect tooan equipo de local a través de escritorio remoto.</span><span class="sxs-lookup"><span data-stu-id="a4326-143">In all these cases, temporarily disable hello software and try tooconnect tooan on-premises computer via Remote Desktop.</span></span> <span data-ttu-id="a4326-144">Si puede averiguar causa real Hola de este modo, trabajar con las conexiones de escritorio remoto red administrador toocorrect Hola software configuración tooallow.</span><span class="sxs-lookup"><span data-stu-id="a4326-144">If you can find out hello actual cause this way, work with your network administrator toocorrect hello software settings tooallow Remote Desktop connections.</span></span>

## <a name="source-2-organization-intranet-edge-device"></a><span data-ttu-id="a4326-145">Causa 2: dispositivo perimetral de intranet de la organización</span><span class="sxs-lookup"><span data-stu-id="a4326-145">Source 2: Organization intranet edge device</span></span>
<span data-ttu-id="a4326-146">Compruebe que un equipo conectado directamente toohello que Internet puede hacer que las conexiones de escritorio remoto tooyour máquina virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="a4326-146">Verify that a computer directly connected toohello Internet can make Remote Desktop connections tooyour Azure virtual machine.</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_2.png)

<span data-ttu-id="a4326-147">Si no tiene un equipo que esté conectado directamente toohello Internet, cree y pruebe con una nueva máquina virtual de Azure en un servicio de nube o de grupo de recursos.</span><span class="sxs-lookup"><span data-stu-id="a4326-147">If you do not have a computer that is directly connected toohello Internet, create and test with a new Azure virtual machine in a resource group or cloud service.</span></span> <span data-ttu-id="a4326-148">Para más información, consulte [Creación de una máquina virtual Windows en Azure](../virtual-machines-windows-hero-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="a4326-148">For more information, see [Create a virtual machine running Windows in Azure](../virtual-machines-windows-hero-tutorial.md).</span></span> <span data-ttu-id="a4326-149">Puede eliminar la máquina virtual de Hola y grupo de recursos de Hola o servicio en la nube hello, después de probar Hola.</span><span class="sxs-lookup"><span data-stu-id="a4326-149">You can delete hello virtual machine and hello resource group or hello cloud service, after hello test.</span></span>

<span data-ttu-id="a4326-150">Si puede crear una conexión a Escritorio remoto con un equipo conectado directamente toohello Internet, compruebe si el dispositivo de borde de intranet de organización para:</span><span class="sxs-lookup"><span data-stu-id="a4326-150">If you can create a Remote Desktop connection with a computer directly attached toohello Internet, check your organization intranet edge device for:</span></span>

* <span data-ttu-id="a4326-151">Un firewall interno bloqueo toohello de las conexiones HTTPS Internet.</span><span class="sxs-lookup"><span data-stu-id="a4326-151">An internal firewall blocking HTTPS connections toohello Internet.</span></span>
* <span data-ttu-id="a4326-152">Un servidor proxy que impide las conexiones a Escritorio remoto</span><span class="sxs-lookup"><span data-stu-id="a4326-152">A proxy server preventing Remote Desktop connections.</span></span>
* <span data-ttu-id="a4326-153">Software de detección de intrusiones o supervisión de red en ejecución en los dispositivos de la red perimetral que impide las conexiones a Escritorio remoto</span><span class="sxs-lookup"><span data-stu-id="a4326-153">Intrusion detection or network monitoring software running on devices in your edge network that is preventing Remote Desktop connections.</span></span>

<span data-ttu-id="a4326-154">Trabajar con la configuración de Hola de toocorrect de administrador de red de su organización intranet borde dispositivo tooallow escritorio remoto basado en HTTPS conexiones toohello Internet.</span><span class="sxs-lookup"><span data-stu-id="a4326-154">Work with your network administrator toocorrect hello settings of your organization intranet edge device tooallow HTTPS-based Remote Desktop connections toohello Internet.</span></span>

## <a name="source-3-cloud-service-endpoint-and-acl"></a><span data-ttu-id="a4326-155">Causa 3: extremo de servicio en la nube y ACL</span><span class="sxs-lookup"><span data-stu-id="a4326-155">Source 3: Cloud service endpoint and ACL</span></span>
<span data-ttu-id="a4326-156">Para las máquinas virtuales que se crean mediante el modelo de implementación clásica de hello, compruebe que otra máquina virtual de Azure que está en hello mismo servicio en la nube o red virtual puede hacer que las conexiones de escritorio remoto tooyour máquina virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="a4326-156">For VMs created using hello Classic deployment model, verify that another Azure VM that is in hello same cloud service or virtual network can make Remote Desktop connections tooyour Azure VM.</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_3.png)

> [!NOTE]
> <span data-ttu-id="a4326-157">Para las máquinas virtuales creadas en el Administrador de recursos, omita demasiado[origen 4: grupos de seguridad de red](#source-4-network-security-groups).</span><span class="sxs-lookup"><span data-stu-id="a4326-157">For virtual machines created in Resource Manager, skip too[Source 4: Network Security Groups](#source-4-network-security-groups).</span></span>

<span data-ttu-id="a4326-158">Si no tiene otra máquina virtual en Hola mismo servicio en la nube o red virtual, cree uno.</span><span class="sxs-lookup"><span data-stu-id="a4326-158">If you do not have another virtual machine in hello same cloud service or virtual network, create one.</span></span> <span data-ttu-id="a4326-159">Siga los pasos de hello en [crear una máquina virtual ejecuta Windows en Azure](../virtual-machines-windows-hero-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="a4326-159">Follow hello steps in [Create a virtual machine running Windows in Azure](../virtual-machines-windows-hero-tutorial.md).</span></span> <span data-ttu-id="a4326-160">Eliminar la máquina virtual de prueba de hello una vez completada la prueba de Hola.</span><span class="sxs-lookup"><span data-stu-id="a4326-160">Delete hello test virtual machine after hello test is completed.</span></span>

<span data-ttu-id="a4326-161">Si se puede conectar a través de escritorio remoto tooa virtual machine Hola mismo nube de servicio o de red virtual, busque esta configuración:</span><span class="sxs-lookup"><span data-stu-id="a4326-161">If you can connect via Remote Desktop tooa virtual machine in hello same cloud service or virtual network, check for these settings:</span></span>

* <span data-ttu-id="a4326-162">configuración de extremo de Hello para el tráfico de escritorio remoto en el destino de hello VM: Hola privada el puerto TCP del extremo de hello debe coincidir con el puerto TCP de hello en qué Hola está escuchando el servicio de escritorio remoto de la máquina virtual (el valor predeterminado es 3389).</span><span class="sxs-lookup"><span data-stu-id="a4326-162">hello endpoint configuration for Remote Desktop traffic on hello target VM: hello private TCP port of hello endpoint must match hello TCP port on which hello VM's Remote Desktop service is listening (default is 3389).</span></span>
* <span data-ttu-id="a4326-163">Hola ACL para punto de conexión del tráfico de escritorio remoto de hello en destino Hola VM: las ACL permiten toospecify permitirá o denegará el tráfico entrante de hello basado en Internet de su dirección IP de origen.</span><span class="sxs-lookup"><span data-stu-id="a4326-163">hello ACL for hello Remote Desktop traffic endpoint on hello target VM: ACLs allow you toospecify allowed or denied incoming traffic from hello Internet based on its source IP address.</span></span> <span data-ttu-id="a4326-164">ACL mal configuradas pueden impedir que el punto de conexión de entrada escritorio remoto tráfico toohello.</span><span class="sxs-lookup"><span data-stu-id="a4326-164">Misconfigured ACLs can prevent incoming Remote Desktop traffic toohello endpoint.</span></span> <span data-ttu-id="a4326-165">Compruebe su tooensure de ACL que se permite el tráfico entrante desde las direcciones IP públicas de su servidor proxy u otro servidor de borde.</span><span class="sxs-lookup"><span data-stu-id="a4326-165">Check your ACLs tooensure that incoming traffic from your public IP addresses of your proxy or other edge server is allowed.</span></span> <span data-ttu-id="a4326-166">Para obtener más información, vea [qué es una lista de control de acceso (ACL) de red](../../virtual-network/virtual-networks-acl.md)</span><span class="sxs-lookup"><span data-stu-id="a4326-166">For more information, see [What is a Network Access Control List (ACL)?](../../virtual-network/virtual-networks-acl.md)</span></span>

<span data-ttu-id="a4326-167">Si el punto de conexión de hello es el origen de Hola de problema de hello, toocheck quitar punto de conexión actual de Hola y crear uno nuevo, elija un puerto aleatorio en hello intervalo 49152 – 65535 para el número de puerto externo Hola.</span><span class="sxs-lookup"><span data-stu-id="a4326-167">toocheck if hello endpoint is hello source of hello problem, remove hello current endpoint and create a new one, choosing a random port in hello range 49152–65535 for hello external port number.</span></span> <span data-ttu-id="a4326-168">Para obtener más información, consulte [cómo tooset la máquina virtual de los puntos de conexión tooa](classic/setup-endpoints.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="a4326-168">For more information, see [How tooset up endpoints tooa virtual machine](classic/setup-endpoints.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).</span></span>

## <a name="source-4-network-security-groups"></a><span data-ttu-id="a4326-169">Causa 4: grupos de seguridad de red</span><span class="sxs-lookup"><span data-stu-id="a4326-169">Source 4: Network Security Groups</span></span>
<span data-ttu-id="a4326-170">Los grupos de seguridad de red permiten un control pormenorizado del tráfico entrante y saliente permitido.</span><span class="sxs-lookup"><span data-stu-id="a4326-170">Network Security Groups allow more granular control of allowed inbound and outbound traffic.</span></span> <span data-ttu-id="a4326-171">Puede crear reglas que abarquen subredes y servicios en la nube en una red virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="a4326-171">You can create rules spanning subnets and cloud services in an Azure virtual network.</span></span>

<span data-ttu-id="a4326-172">Use [comprobar flujo IP](../../network-watcher/network-watcher-check-ip-flow-verify-portal.md) tooconfirm si una regla en un grupo de seguridad de red está bloqueando el tráfico tooor desde una máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="a4326-172">Use [IP flow verify](../../network-watcher/network-watcher-check-ip-flow-verify-portal.md) tooconfirm if a rule in a Network Security Group is blocking traffic tooor from a virtual machine.</span></span> <span data-ttu-id="a4326-173">También puede revisar el grupo de seguridad eficaz reglas tooensure de entrada "Permitir" NSG regla existe y se establece una prioridad para el puerto RDP (valor predeterminado 3389).</span><span class="sxs-lookup"><span data-stu-id="a4326-173">You can also review effective security group rules tooensure inbound "Allow" NSG rule exists and is prioritized for RDP port(default 3389).</span></span> <span data-ttu-id="a4326-174">Para obtener más información, consulte [flujo del tráfico con reglas de seguridad efectivo tootroubleshoot VM](../../virtual-network/virtual-network-nsg-troubleshoot-portal.md#using-effective-security-rules-to-troubleshoot-vm-traffic-flow).</span><span class="sxs-lookup"><span data-stu-id="a4326-174">For more information, see [Using Effective Security Rules tootroubleshoot VM traffic flow](../../virtual-network/virtual-network-nsg-troubleshoot-portal.md#using-effective-security-rules-to-troubleshoot-vm-traffic-flow).</span></span>

## <a name="source-5-windows-based-azure-vm"></a><span data-ttu-id="a4326-175">Causa 5: máquina virtual de Azure basada en Windows</span><span class="sxs-lookup"><span data-stu-id="a4326-175">Source 5: Windows-based Azure VM</span></span>
![](./media/detailed-troubleshoot-rdp/tshootrdp_5.png)

<span data-ttu-id="a4326-176">Siga las instrucciones de hello en [este artículo](reset-rdp.md).</span><span class="sxs-lookup"><span data-stu-id="a4326-176">Follow hello instructions in [this article](reset-rdp.md).</span></span> <span data-ttu-id="a4326-177">En este artículo se restablece servicios de escritorio remoto de hello en la máquina virtual de hello:</span><span class="sxs-lookup"><span data-stu-id="a4326-177">This article resets hello Remote Desktop service on hello virtual machine:</span></span>

* <span data-ttu-id="a4326-178">Habilitar la regla predeterminada de Firewall de Windows de "Escritorio remoto" hello (puerto TCP 3389).</span><span class="sxs-lookup"><span data-stu-id="a4326-178">Enable hello "Remote Desktop" Windows Firewall default rule (TCP port 3389).</span></span>
* <span data-ttu-id="a4326-179">Habilite las conexiones de escritorio remoto estableciendo hello HKLM\System\CurrentControlSet\Control\Terminal Server\fDenyTSConnections del Registro valor too0.</span><span class="sxs-lookup"><span data-stu-id="a4326-179">Enable Remote Desktop connections by setting hello HKLM\System\CurrentControlSet\Control\Terminal Server\fDenyTSConnections registry value too0.</span></span>

<span data-ttu-id="a4326-180">Vuelva a intentar la conexión de Hola desde su equipo nuevo.</span><span class="sxs-lookup"><span data-stu-id="a4326-180">Try hello connection from your computer again.</span></span> <span data-ttu-id="a4326-181">Si es que aún no se puede tooconnect a través de escritorio remoto, compruebe los siguientes posibles problemas de hello:</span><span class="sxs-lookup"><span data-stu-id="a4326-181">If you are still not able tooconnect via Remote Desktop, check for hello following possible problems:</span></span>

* <span data-ttu-id="a4326-182">Hola servicio Escritorio remoto no está ejecutando en el destino de hello máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="a4326-182">hello Remote Desktop service is not running on hello target VM.</span></span>
* <span data-ttu-id="a4326-183">Hola servicio Escritorio remoto no está escuchando en el puerto TCP 3389.</span><span class="sxs-lookup"><span data-stu-id="a4326-183">hello Remote Desktop service is not listening on TCP port 3389.</span></span>
* <span data-ttu-id="a4326-184">El firewall de Windows u otro firewall local tiene una regla de salida que impide el tráfico de Escritorio remoto.</span><span class="sxs-lookup"><span data-stu-id="a4326-184">Windows Firewall or another local firewall has an outbound rule that is preventing Remote Desktop traffic.</span></span>
* <span data-ttu-id="a4326-185">La detección de intrusiones o software que se ejecuta en la máquina virtual de Azure Hola de supervisión de red impide las conexiones de escritorio remoto.</span><span class="sxs-lookup"><span data-stu-id="a4326-185">Intrusion detection or network monitoring software running on hello Azure virtual machine is preventing Remote Desktop connections.</span></span>

<span data-ttu-id="a4326-186">Para las máquinas virtuales creadas con el modelo de implementación clásica de hello, puede usar un toohello de sesión de PowerShell de Azure remoto máquina virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="a4326-186">For VMs created using hello classic deployment model, you can use a remote Azure PowerShell session toohello Azure virtual machine.</span></span> <span data-ttu-id="a4326-187">En primer lugar, debe tooinstall un certificado de servicio de nube de hospedaje de la máquina virtual Hola.</span><span class="sxs-lookup"><span data-stu-id="a4326-187">First, you need tooinstall a certificate for hello virtual machine's hosting cloud service.</span></span> <span data-ttu-id="a4326-188">Vaya demasiado[tooAzure configurar Secure Remote PowerShell Access máquinas virtuales](http://gallery.technet.microsoft.com/scriptcenter/Configures-Secure-Remote-b137f2fe) y descargar hello **InstallWinRMCertAzureVM.ps1** equipo local de tooyour de archivo de script.</span><span class="sxs-lookup"><span data-stu-id="a4326-188">Go too[Configure Secure Remote PowerShell Access tooAzure Virtual Machines](http://gallery.technet.microsoft.com/scriptcenter/Configures-Secure-Remote-b137f2fe) and download hello **InstallWinRMCertAzureVM.ps1** script file tooyour local computer.</span></span>

<span data-ttu-id="a4326-189">A continuación, instale Azure PowerShell si todavía no lo ha hecho.</span><span class="sxs-lookup"><span data-stu-id="a4326-189">Next, install Azure PowerShell if you haven't already.</span></span> <span data-ttu-id="a4326-190">Vea [cómo tooinstall y configurar Azure PowerShell](/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="a4326-190">See [How tooinstall and configure Azure PowerShell](/powershell/azure/overview).</span></span>

<span data-ttu-id="a4326-191">A continuación, abra un símbolo del sistema de PowerShell de Azure y cambie Hola actual toohello ubicación de carpeta de hello **InstallWinRMCertAzureVM.ps1** archivo de script.</span><span class="sxs-lookup"><span data-stu-id="a4326-191">Next, open an Azure PowerShell command prompt and change hello current folder toohello location of hello **InstallWinRMCertAzureVM.ps1** script file.</span></span> <span data-ttu-id="a4326-192">toorun un script de PowerShell de Azure, debe establecer la directiva de ejecución correcta de Hola.</span><span class="sxs-lookup"><span data-stu-id="a4326-192">toorun an Azure PowerShell script, you must set hello correct execution policy.</span></span> <span data-ttu-id="a4326-193">Ejecute hello **Get-ExecutionPolicy** comando toodetermine su nivel actual de directiva.</span><span class="sxs-lookup"><span data-stu-id="a4326-193">Run hello **Get-ExecutionPolicy** command toodetermine your current policy level.</span></span> <span data-ttu-id="a4326-194">Para obtener información acerca de cómo establecer el nivel adecuado de hello, consulte [Set-ExecutionPolicy](https://technet.microsoft.com/library/hh849812.aspx).</span><span class="sxs-lookup"><span data-stu-id="a4326-194">For information about setting hello appropriate level, see [Set-ExecutionPolicy](https://technet.microsoft.com/library/hh849812.aspx).</span></span>

<span data-ttu-id="a4326-195">A continuación, rellene su nombre de suscripción de Azure, nombre del servicio de nube de Hola y el nombre de máquina virtual (quitando Hola < y > caracteres) y, a continuación, ejecute estos comandos.</span><span class="sxs-lookup"><span data-stu-id="a4326-195">Next, fill in your Azure subscription name, hello cloud service name, and your virtual machine name (removing hello < and > characters), and then run these commands.</span></span>

```powershell
$subscr="<Name of your Azure subscription>"
$serviceName="<Name of hello cloud service that contains hello target virtual machine>"
$vmName="<Name of hello target virtual machine>"
.\InstallWinRMCertAzureVM.ps1 -SubscriptionName $subscr -ServiceName $serviceName -Name $vmName
```

<span data-ttu-id="a4326-196">Puede obtener nombre de la suscripción correcta de Hola de hello *SubscriptionName* propiedad de pantalla de Hola de hello **Get-AzureSubscription** comando.</span><span class="sxs-lookup"><span data-stu-id="a4326-196">You can get hello correct subscription name from hello *SubscriptionName* property of hello display of hello **Get-AzureSubscription** command.</span></span> <span data-ttu-id="a4326-197">Puede obtener el nombre del servicio de nube de hello para la máquina virtual de Hola de hello *ServiceName* columna de presentación de Hola de hello **Get-AzureVM** comando.</span><span class="sxs-lookup"><span data-stu-id="a4326-197">You can get hello cloud service name for hello virtual machine from hello *ServiceName* column in hello display of hello **Get-AzureVM** command.</span></span>

<span data-ttu-id="a4326-198">Compruebe si tiene un nuevo certificado Hola.</span><span class="sxs-lookup"><span data-stu-id="a4326-198">Check if you have hello new certificate.</span></span> <span data-ttu-id="a4326-199">Abra un complemento de certificados para el usuario actual de Hola y mire en hello **Authorities\Certificates de certificación de raíz de confianza** carpeta.</span><span class="sxs-lookup"><span data-stu-id="a4326-199">Open a Certificates snap-in for hello current user and look in hello **Trusted Root Certification Authorities\Certificates** folder.</span></span> <span data-ttu-id="a4326-200">Debería ver un certificado con nombre DNS de hello del servicio en la nube en hello emitido toocolumn (ejemplo: cloudservice4testing.cloudapp.net).</span><span class="sxs-lookup"><span data-stu-id="a4326-200">You should see a certificate with hello DNS name of your cloud service in hello Issued toocolumn (example: cloudservice4testing.cloudapp.net).</span></span>

<span data-ttu-id="a4326-201">A continuación, inicie una sesión remota de Azure PowerShell mediante el uso de estos comandos.</span><span class="sxs-lookup"><span data-stu-id="a4326-201">Next, initiate a remote Azure PowerShell session by using these commands.</span></span>

```powershell
$uri = Get-AzureWinRMUri -ServiceName $serviceName -Name $vmName
$creds = Get-Credential
Enter-PSSession -ConnectionUri $uri -Credential $creds
```

<span data-ttu-id="a4326-202">Después de escribir las credenciales de administrador válida, debería ver algo similar toohello después de símbolo del sistema de PowerShell de Azure:</span><span class="sxs-lookup"><span data-stu-id="a4326-202">After entering valid administrator credentials, you should see something similar toohello following Azure PowerShell prompt:</span></span>

```powershell
[cloudservice4testing.cloudapp.net]: PS C:\Users\User1\Documents>
```

<span data-ttu-id="a4326-203">Hola primera parte de este mensaje es el nombre del servicio en la nube que contiene el destino de Hola de máquina virtual, que podría ser diferente de "cloudservice4testing.cloudapp.net".</span><span class="sxs-lookup"><span data-stu-id="a4326-203">hello first part of this prompt is your cloud service name that contains hello target VM, which could be different from "cloudservice4testing.cloudapp.net".</span></span> <span data-ttu-id="a4326-204">Ahora puede emitir comandos de PowerShell de Azure para esta nube problemas del servicio tooinvestigate Hola mencionados y corregir la configuración de Hola.</span><span class="sxs-lookup"><span data-stu-id="a4326-204">You can now issue Azure PowerShell commands for this cloud service tooinvestigate hello problems mentioned and correct hello configuration.</span></span>

### <a name="toomanually-correct-hello-remote-desktop-services-listening-tcp-port"></a><span data-ttu-id="a4326-205">toomanually corregir los servicios de escritorio remoto hello escucha el puerto TCP</span><span class="sxs-lookup"><span data-stu-id="a4326-205">toomanually correct hello Remote Desktop Services listening TCP port</span></span>
<span data-ttu-id="a4326-206">En el símbolo de sesión de PowerShell de Azure remoto hello, ejecute este comando.</span><span class="sxs-lookup"><span data-stu-id="a4326-206">At hello remote Azure PowerShell session prompt, run this command.</span></span>

```powershell
Get-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "PortNumber"
```

<span data-ttu-id="a4326-207">Hola propiedad PortNumber muestra el número de puerto actual de Hola.</span><span class="sxs-lookup"><span data-stu-id="a4326-207">hello PortNumber property shows hello current port number.</span></span> <span data-ttu-id="a4326-208">Si es necesario, cambie el valor de predeterminado tooits atrás de número de puerto de escritorio remoto del hello (3389) mediante este comando.</span><span class="sxs-lookup"><span data-stu-id="a4326-208">If needed, change hello Remote Desktop port number back tooits default value (3389) by using this command.</span></span>

```powershell
Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "PortNumber" -Value 3389
```

<span data-ttu-id="a4326-209">Comprobar si el puerto de Hola se ha too3389 modificadas mediante este comando.</span><span class="sxs-lookup"><span data-stu-id="a4326-209">Verify that hello port has been changed too3389 by using this command.</span></span>

```powershell
Get-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "PortNumber"
```

<span data-ttu-id="a4326-210">Salga de la sesión remota de PowerShell de Azure de hello mediante este comando.</span><span class="sxs-lookup"><span data-stu-id="a4326-210">Exit hello remote Azure PowerShell session by using this command.</span></span>

```powershell
Exit-PSSession
```

<span data-ttu-id="a4326-211">Comprobar que ese punto de conexión de escritorio remoto para máquina virtual de Azure hello hello también utiliza el puerto TCP 3398 como su puerto interno.</span><span class="sxs-lookup"><span data-stu-id="a4326-211">Verify that hello Remote Desktop endpoint for hello Azure VM is also using TCP port 3398 as its internal port.</span></span> <span data-ttu-id="a4326-212">Reinicie hello Azure VM e inténtelo de nuevo la conexión a Escritorio remoto hello.</span><span class="sxs-lookup"><span data-stu-id="a4326-212">Restart hello Azure VM and try hello Remote Desktop connection again.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="a4326-213">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="a4326-213">Additional resources</span></span>
[<span data-ttu-id="a4326-214">¿Cómo tooreset una contraseña u Hola escritorio remoto de servicios de máquinas virtuales de Windows</span><span class="sxs-lookup"><span data-stu-id="a4326-214">How tooreset a password or hello Remote Desktop service for Windows virtual machines</span></span>](reset-rdp.md)

[<span data-ttu-id="a4326-215">¿Cómo tooinstall y configurar Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="a4326-215">How tooinstall and configure Azure PowerShell</span></span>](/powershell/azure/overview)

[<span data-ttu-id="a4326-216">Solucionar problemas de Shell seguro (SSH) conexiones tooa basados en Linux máquina virtual de Azure</span><span class="sxs-lookup"><span data-stu-id="a4326-216">Troubleshoot Secure Shell (SSH) connections tooa Linux-based Azure virtual machine</span></span>](../linux/troubleshoot-ssh-connection.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

[<span data-ttu-id="a4326-217">Solucionar problemas de acceso tooan aplicación que se ejecuta en una máquina virtual de Azure</span><span class="sxs-lookup"><span data-stu-id="a4326-217">Troubleshoot access tooan application running on an Azure virtual machine</span></span>](../linux/troubleshoot-app-connection.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)


---
title: "aaaAdd diagnósticos y supervisión tooan máquina virtual de Azure | Documentos de Microsoft"
description: "Utilice un toocreate de plantilla del Administrador de recursos de Azure una nueva máquina virtual de Windows con la extensión de diagnósticos de Azure."
services: virtual-machines-windows
documentationcenter: 
author: sbtron
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 8cde8fe7-977b-43d2-be74-ad46dc946058
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: article
ms.date: 05/31/2017
ms.author: saurabh
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: d8a831421a0f9d38c09d51cf8c2e6dff913c77ff
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="use-monitoring-and-diagnostics-with-a-windows-vm-and-azure-resource-manager-templates"></a><span data-ttu-id="a646a-103">Uso de la supervisión y el diagnóstico con una máquina virtual Windows y plantillas de Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="a646a-103">Use monitoring and diagnostics with a Windows VM and Azure Resource Manager templates</span></span>
<span data-ttu-id="a646a-104">Hola extensión de diagnósticos de Azure proporciona supervisión de Hola y capacidades de diagnóstico en una ventana basada en máquina virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="a646a-104">hello Azure Diagnostics Extension provides hello monitoring and diagnostics capabilities on a Windows based Azure virtual machine.</span></span> <span data-ttu-id="a646a-105">Para habilitar estas capacidades en la máquina virtual de Hola, incluida la extensión de hello como parte de la plantilla de administrador de recursos de azure de Hola.</span><span class="sxs-lookup"><span data-stu-id="a646a-105">You can enable these capabilities on hello virtual machine by including hello extension as part of hello azure resource manager template.</span></span> <span data-ttu-id="a646a-106">Para obtener más información sobre cómo incluir cualquier extensión como parte de una plantilla de máquina virtual, consulte [Creación de plantillas del Administrador de recursos de Azure con extensiones de máquina virtual](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) .</span><span class="sxs-lookup"><span data-stu-id="a646a-106">See [Authoring Azure Resource Manager Templates with VM Extensions](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) for more information on including any extension as part of a virtual machine template.</span></span> <span data-ttu-id="a646a-107">Este artículo describe cómo puede agregar la plantilla de máquina virtual de windows de hello diagnósticos de Azure extensión tooa.</span><span class="sxs-lookup"><span data-stu-id="a646a-107">This article describes how you can add hello Azure Diagnostics extension tooa windows virtual machine template.</span></span>  

## <a name="add-hello-azure-diagnostics-extension-toohello-vm-resource-definition"></a><span data-ttu-id="a646a-108">Agregar definición de recursos de la extensión toohello Hola diagnósticos de Azure VM</span><span class="sxs-lookup"><span data-stu-id="a646a-108">Add hello Azure Diagnostics extension toohello VM resource definition</span></span>
<span data-ttu-id="a646a-109">extensión de diagnósticos de hello tooenable en una máquina Virtual de Windows, necesita la extensión de hello tooadd como un recurso de máquina virtual en Hola plantilla del Administrador de recursos.</span><span class="sxs-lookup"><span data-stu-id="a646a-109">tooenable hello diagnostics extension on a Windows Virtual Machine you need tooadd hello extension as a VM resource in hello Resource manager template.</span></span>

<span data-ttu-id="a646a-110">Para un administrador de recursos simple basado en Máquina Virtual agregar Hola extensión Configuración toohello *recursos* matriz para hello Máquina Virtual:</span><span class="sxs-lookup"><span data-stu-id="a646a-110">For a simple Resource Manager based Virtual Machine add hello extension configuration toohello *resources* array for hello Virtual Machine:</span></span> 

    "resources": [
                {
                    "name": "Microsoft.Insights.VMDiagnosticsSettings",
                    "type": "extensions",
                    "location": "[resourceGroup().location]",
                    "apiVersion": "2015-06-15",
                    "dependsOn": [
                        "[concat('Microsoft.Compute/virtualMachines/', variables('vmName'))]"
                    ],
                    "tags": {
                        "displayName": "AzureDiagnostics"
                    },
                    "properties": {
                        "publisher": "Microsoft.Azure.Diagnostics",
                        "type": "IaaSDiagnostics",
                        "typeHandlerVersion": "1.5",
                        "autoUpgradeMinorVersion": true,
                        "settings": {
                            "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), variables('vmName'), variables('wadcfgxend')))]",
                            "storageAccount": "[parameters('existingdiagnosticsStorageAccountName')]"
                        },
                        "protectedSettings": {
                            "storageAccountName": "[parameters('existingdiagnosticsStorageAccountName')]",
                            "storageAccountKey": "[listkeys(variables('accountid'), '2015-05-01-preview').key1]",
                            "storageAccountEndPoint": "https://core.windows.net"
                        }
                    }
                }
            ]


<span data-ttu-id="a646a-111">Otra convención común es agregar configuración de la extensión de hello en el nodo de recursos de raíz de Hola de plantilla de hello en lugar de definir en el nodo de recursos de la máquina virtual de Hola.</span><span class="sxs-lookup"><span data-stu-id="a646a-111">Another common convention is add hello extension configuration at hello root resources node of hello template instead of defining it under hello virtual machine's resources node.</span></span> <span data-ttu-id="a646a-112">Con este enfoque tiene tooexplicitly especificar una relación jerárquica entre la extensión de Hola y de máquina virtual de hello con hello *nombre* y *tipo* valores.</span><span class="sxs-lookup"><span data-stu-id="a646a-112">With this approach you have tooexplicitly specify a hierarchical relation between hello extension and hello virtual machine with hello *name* and *type* values.</span></span> <span data-ttu-id="a646a-113">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="a646a-113">For example:</span></span> 

    "name": "[concat(variables('vmName'),'Microsoft.Insights.VMDiagnosticsSettings')]",
    "type": "Microsoft.Compute/virtualMachines/extensions",

<span data-ttu-id="a646a-114">extensión de Hello siempre está asociado a la máquina virtual de Hola, puede ya sea directamente definirla directamente en el nodo de recurso de la máquina virtual Hola o definir en el nivel de base de Hola y usar tooassociate de convención de nomenclatura jerárquico de Hola con hello virtual máquina.</span><span class="sxs-lookup"><span data-stu-id="a646a-114">hello extension is always associated with hello virtual machine, you can either directly define it under hello virtual machine's resource node directly or define it at hello base level and use hello hierarchical naming convention tooassociate it with hello virtual machine.</span></span>

<span data-ttu-id="a646a-115">Para las extensiones de conjuntos de escalas de máquina Virtual Hola configuración se especifica en hello *extensionProfile* propiedad de hello *VirtualMachineProfile*.</span><span class="sxs-lookup"><span data-stu-id="a646a-115">For Virtual Machine Scale Sets hello extensions configuration is specified in hello *extensionProfile* property of hello *VirtualMachineProfile*.</span></span>

<span data-ttu-id="a646a-116">Hola *publisher* propiedad con el valor de Hola de **Microsoft.Azure.Diagnostics** hello y *tipo* propiedad con el valor de Hola de **IaaSDiagnostics** identificar de forma única extensión de diagnósticos de Azure Hola.</span><span class="sxs-lookup"><span data-stu-id="a646a-116">hello *publisher* property with hello value of **Microsoft.Azure.Diagnostics** and hello *type* property with hello value of **IaaSDiagnostics** uniquely identify hello Azure Diagnostics extension.</span></span>

<span data-ttu-id="a646a-117">Hola valo hello *nombre* propiedad puede ser usado toorefer toohello extensión en el grupo de recursos de Hola.</span><span class="sxs-lookup"><span data-stu-id="a646a-117">hello value of hello *name* property can be used toorefer toohello extension in hello resource group.</span></span> <span data-ttu-id="a646a-118">Si se establece específicamente demasiado**Microsoft.Insights.VMDiagnosticsSettings** permitirá toobe identificada con facilidad por hello asegurar portal de Azure que Hola supervisión gráficos aparecen correctamente en hello portal de Azure.</span><span class="sxs-lookup"><span data-stu-id="a646a-118">Setting it specifically too**Microsoft.Insights.VMDiagnosticsSettings** will enable it toobe easily identified by hello Azure portal ensuring that hello monitoring charts show up correctly in hello Azure portal.</span></span>

<span data-ttu-id="a646a-119">Hola *typeHandlerVersion* especifica la versión de Hola de extensión de hello le gustaría toouse.</span><span class="sxs-lookup"><span data-stu-id="a646a-119">hello *typeHandlerVersion* specifies hello version of hello extension you would like toouse.</span></span> <span data-ttu-id="a646a-120">Establecer *autoUpgradeMinorVersion* demasiado la versión secundaria**true** garantiza que obtendrá versión secundaria más reciente de Hola de extensión de Hola que está disponible.</span><span class="sxs-lookup"><span data-stu-id="a646a-120">Setting *autoUpgradeMinorVersion* minor version too**true** ensures that you will get hello latest Minor version of hello extension that is available.</span></span> <span data-ttu-id="a646a-121">Se recomienda establecer siempre *autoUpgradeMinorVersion* tooalways ser **true** para que siempre obtendrá extensión toouse Hola de diagnóstico disponible más reciente con todas las características nuevas de Hola y errores correcciones.</span><span class="sxs-lookup"><span data-stu-id="a646a-121">It is highly recommended that you always set *autoUpgradeMinorVersion* tooalways be **true** so that you always get toouse hello latest available diagnostics extension with all hello new features and bug fixes.</span></span> 

<span data-ttu-id="a646a-122">Hola *configuración* elemento contiene las propiedades de las configuraciones de extensión de Hola que se pueden establecer y leer desde la extensión de hello (en ocasiones denominado tooas configuración pública).</span><span class="sxs-lookup"><span data-stu-id="a646a-122">hello *settings* element contains configurations properties for hello extension that can be set and read back from hello extension (sometimes referred tooas public configuration).</span></span> <span data-ttu-id="a646a-123">Hola *xmlcfg* propiedad contiene configuración basada en xml para los registros de diagnóstico de hello, contadores de rendimiento etcetera que se van a recopilar por agente de diagnóstico de Hola.</span><span class="sxs-lookup"><span data-stu-id="a646a-123">hello *xmlcfg* property contains xml based configuration for hello diagnostics logs, performance counters etc that will be collected by hello diagnostics agent.</span></span> <span data-ttu-id="a646a-124">Vea [esquema de configuración de diagnósticos](https://msdn.microsoft.com/library/azure/dn782207.aspx) para obtener más información sobre el propio esquema de xml Hola.</span><span class="sxs-lookup"><span data-stu-id="a646a-124">See [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for more information about hello xml schema itself.</span></span> <span data-ttu-id="a646a-125">Una práctica común es la configuración de xml real de hello toostore como una variable de plantilla de Azure Resource Manager hello y, a continuación, concatenar y base64 codifican valor de hello tooset para *xmlcfg*.</span><span class="sxs-lookup"><span data-stu-id="a646a-125">A common practice is toostore hello actual xml configuration as a variable in hello Azure Resource Manager template and then concatenate and base64 encode them tooset hello value for *xmlcfg*.</span></span> <span data-ttu-id="a646a-126">Vea la sección de hello en [variables de configuración de diagnósticos](#diagnostics-configuration-variables) toounderstand más información acerca de cómo toostore Hola xml en variables.</span><span class="sxs-lookup"><span data-stu-id="a646a-126">See hello section on [diagnostics configuration variables](#diagnostics-configuration-variables) toounderstand more about how toostore hello xml in variables.</span></span> <span data-ttu-id="a646a-127">Hola *storageAccount* propiedad especifica el nombre de Hola Hola almacenamiento cuenta toowhich de datos de diagnóstico que se van a transferir.</span><span class="sxs-lookup"><span data-stu-id="a646a-127">hello *storageAccount* property specifies hello name of hello storage account toowhich diagnostics data will be transferred.</span></span> 

<span data-ttu-id="a646a-128">Hola propiedades en *protectedSettings* (en ocasiones denominado tooas configuración privada) se puede establecer pero no se puede leer después de que se va a establecer.</span><span class="sxs-lookup"><span data-stu-id="a646a-128">hello properties in *protectedSettings* (sometimes referred tooas private configuration) can be set but cannot be read back after being set.</span></span> <span data-ttu-id="a646a-129">Hola de solo escritura naturaleza de *protectedSettings* resulta útil para almacenar secretos como clave de cuenta de almacenamiento de Hola donde se escribirán los datos de diagnóstico de Hola.</span><span class="sxs-lookup"><span data-stu-id="a646a-129">hello write-only nature of *protectedSettings* makes it useful for storing secrets like hello storage account key where hello diagnostics data will be written.</span></span>    

## <a name="specifying-diagnostics-storage-account-as-parameters"></a><span data-ttu-id="a646a-130">Especificación de la cuenta de almacenamiento de diagnóstico como parámetro</span><span class="sxs-lookup"><span data-stu-id="a646a-130">Specifying diagnostics storage account as parameters</span></span>
<span data-ttu-id="a646a-131">fragmento de json de extensión de diagnósticos de Hello anterior supone dos parámetros *existingdiagnosticsStorageAccountName* y *existingdiagnosticsStorageResourceGroup* diagnósticos de hello toospecify cuenta de almacenamiento donde se almacenarán los datos de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="a646a-131">hello diagnostics extension json snippet above assumes two parameters *existingdiagnosticsStorageAccountName* and *existingdiagnosticsStorageResourceGroup* toospecify hello diagnostics storage account where diagnostics data will be stored.</span></span> <span data-ttu-id="a646a-132">Especificar la cuenta de almacenamiento de diagnósticos de Hola como un parámetro hace que esta cuenta de almacenamiento de diagnósticos de hello toochange fácil entre diferentes entornos, por ejemplo, puede que desee toouse una cuenta de almacenamiento de diagnóstico diferentes para las pruebas y otra diferente para el implementación de producción.</span><span class="sxs-lookup"><span data-stu-id="a646a-132">Specifying hello diagnostics storage account as a parameter makes it easy toochange hello diagnostics storage account across different environments e.g. you may want toouse a different diagnostics storage account for testing and a different one for your production deployment.</span></span>  

        "existingdiagnosticsStorageAccountName": {
            "type": "string",
            "metadata": {
        "description": "hello name of an existing storage account toowhich diagnostics data will be transfered."
            }        
        },
        "existingdiagnosticsStorageResourceGroup": {
            "type": "string",
            "metadata": {
        "description": "hello resource group for hello storage account specified in existingdiagnosticsStorageAccountName"
              }
        }

<span data-ttu-id="a646a-133">Es mejor práctica toospecify una cuenta de almacenamiento de diagnósticos en otro grupo de recursos de grupo de recursos de hello para la máquina virtual de Hola.</span><span class="sxs-lookup"><span data-stu-id="a646a-133">It is best practice toospecify a diagnostics storage account in a different resource group than hello resource group for hello virtual machine.</span></span> <span data-ttu-id="a646a-134">Un grupo de recursos puede considerarse como una unidad de implementación con su propia duración toobe, una máquina virtual se pueda implementar y volver a implementar según se realizan nuevas actualizaciones de las configuraciones tooit pero recomendable toocontinue almacenar datos de diagnóstico de Hola Hola misma cuenta de almacenamiento en las implementaciones de máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="a646a-134">A resource group can be considered toobe a deployment unit with its own lifetime, a virtual machine can be deployed and redeployed as new configurations updates are made it tooit but you may want toocontinue storing hello diagnostics data in hello same storage account across those virtual machine deployments.</span></span> <span data-ttu-id="a646a-135">Con la cuenta de almacenamiento de hello en diferentes recursos permite Hola almacenamiento cuenta tooaccept datos de varias implementaciones de máquina virtual para convertirla tootroubleshoot fácil Hola problemas a través de distintas versiones.</span><span class="sxs-lookup"><span data-stu-id="a646a-135">Having hello storage account in a different resource enables hello storage account tooaccept data from various virtual machine deployments making it easy tootroubleshoot issues across hello various versions.</span></span>

> [!NOTE]
> <span data-ttu-id="a646a-136">Si crea una plantilla de máquina virtual de windows desde Visual Studio que se puede establecer la cuenta de almacenamiento predeterminada de hello toouse Hola misma cuenta de almacenamiento donde se cargará el VHD de la máquina virtual Hola.</span><span class="sxs-lookup"><span data-stu-id="a646a-136">If you create a windows virtual machine template from Visual Studio hello default storage account might be set toouse hello same storage account where hello virtual machine VHD is uploaded.</span></span> <span data-ttu-id="a646a-137">Se trata de toosimplify la instalación inicial del programa Hola a máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="a646a-137">This is toosimplify initial setup of hello VM.</span></span> <span data-ttu-id="a646a-138">Debe refactorizar Hola plantilla toouse una cuenta de almacenamiento diferentes que puede pasar como un parámetro.</span><span class="sxs-lookup"><span data-stu-id="a646a-138">You should re-factor hello template toouse a different storage account that can be passed in as a parameter.</span></span> 
> 
> 

## <a name="diagnostics-configuration-variables"></a><span data-ttu-id="a646a-139">variables de configuración de diagnóstico</span><span class="sxs-lookup"><span data-stu-id="a646a-139">Diagnostics configuration variables</span></span>
<span data-ttu-id="a646a-140">fragmento de json de extensión de diagnósticos de Hello anterior define una *accountid* variable toosimplify obtener clave de cuenta de almacenamiento de hello para el almacenamiento de diagnósticos de hello:</span><span class="sxs-lookup"><span data-stu-id="a646a-140">hello diagnostics extension json snippet above defines an *accountid* variable toosimplify getting hello storage account key for hello diagnostics storage:</span></span>   

    "accountid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/',parameters('existingdiagnosticsStorageResourceGroup'), '/providers/','Microsoft.Storage/storageAccounts/', parameters('existingdiagnosticsStorageAccountName'))]"


<span data-ttu-id="a646a-141">Hola *xmlcfg* propiedad de extensión de diagnósticos de Hola se define mediante varias variables que se concatenan juntos.</span><span class="sxs-lookup"><span data-stu-id="a646a-141">hello *xmlcfg* property for hello diagnostics extension is defined using multiple variables that are concatenated together.</span></span> <span data-ttu-id="a646a-142">valores de Hello de estas variables están en xml, por lo que necesitan toobe escape correctamente al establecer las variables de json de Hola.</span><span class="sxs-lookup"><span data-stu-id="a646a-142">hello values of these variables are in xml so they need toobe escaped correctly when setting hello json variables.</span></span>

<span data-ttu-id="a646a-143">Hola a continuación describe xml de configuración de diagnósticos de Hola que recopila los contadores de rendimiento de nivel de sistema estándar junto con algunos registros de eventos de windows y los registros de infraestructura de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="a646a-143">hello following describes hello diagnostics configuration xml that collects standard system level performance counters along with some windows event logs and diagnostics infrastructure logs.</span></span> <span data-ttu-id="a646a-144">Se ha de escape y tiene el formato correcto para que hello configuración directamente se puede pegar en la sección de variables de saludo de la plantilla.</span><span class="sxs-lookup"><span data-stu-id="a646a-144">It has been escaped and formatted correctly so that hello configuration can directly be pasted into hello variables section of your template.</span></span> <span data-ttu-id="a646a-145">Vea hello [esquema de configuración de diagnósticos](https://msdn.microsoft.com/library/azure/dn782207.aspx) para obtener un ejemplo más usuario legible de xml de configuración de Hola.</span><span class="sxs-lookup"><span data-stu-id="a646a-145">See hello [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for a more human readable example of hello configuration xml.</span></span>

        "wadlogs": "<WadCfg> <DiagnosticMonitorConfiguration overallQuotaInMB=\"4096\" xmlns=\"http://schemas.microsoft.com/ServiceHosting/2010/10/DiagnosticsConfiguration\"> <DiagnosticInfrastructureLogs scheduledTransferLogLevelFilter=\"Error\"/> <WindowsEventLog scheduledTransferPeriod=\"PT1M\" > <DataSource name=\"Application!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"Security!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"System!*[System[(Level = 1 or Level = 2)]]\" /></WindowsEventLog>",
        "wadperfcounters1": "<PerformanceCounters scheduledTransferPeriod=\"PT1M\"><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Processor Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU utilization\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Privileged Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU privileged time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% User Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU user time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor Information(_Total)\\Processor Frequency\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"CPU frequency\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\System\\Processes\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Processes\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Thread Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Threads\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Handle Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Handles\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\% Committed Bytes In Use\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Memory usage\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Available Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory available\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Committed Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory committed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Commit Limit\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory commit limit\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active time\" locale=\"en-us\"/></PerformanceCounterConfiguration>",
        "wadperfcounters2": "<PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Read Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active read time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Write Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active write time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Transfers/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Reads/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk read operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Writes/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk write operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Read Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk read speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Write Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk write speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\LogicalDisk(_Total)\\% Free Space\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk free space (percentage)\" locale=\"en-us\"/></PerformanceCounterConfiguration></PerformanceCounters>",
        "wadcfgxstart": "[concat(variables('wadlogs'), variables('wadperfcounters1'), variables('wadperfcounters2'), '<Metrics resourceId=\"')]",
        "wadmetricsresourceid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name , '/providers/', 'Microsoft.Compute/virtualMachines/')]",
        "wadcfgxend": "\"><MetricAggregation scheduledTransferPeriod=\"PT1H\"/><MetricAggregation scheduledTransferPeriod=\"PT1M\"/></Metrics></DiagnosticMonitorConfiguration></WadCfg>"

<span data-ttu-id="a646a-146">nodo de xml de definición de métricas de Hola Hola por encima de la configuración es un elemento de configuración importantes, tal y como se define cómo los contadores de rendimiento de hello definieron anteriormente en el xml de hello en *PerformanceCounter* nodo se agregarán y almacena.</span><span class="sxs-lookup"><span data-stu-id="a646a-146">hello Metrics definition xml node in hello above configuration is an important configuration element as it defines how hello performance counters defined earlier in hello xml in *PerformanceCounter* node will be aggregated and stored.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="a646a-147">Estas métricas unidad Hola supervisión gráficos y alertas en hello portal de Azure.</span><span class="sxs-lookup"><span data-stu-id="a646a-147">These metrics drive hello monitoring charts and alerts in hello Azure portal.</span></span>  <span data-ttu-id="a646a-148">Hola **métricas** nodo con hello *resourceID* y **MetricAggregation** deben incluirse en la configuración de diagnóstico de hello para la máquina virtual si desea toosee Hola VM datos de supervisión en hello portal de Azure.</span><span class="sxs-lookup"><span data-stu-id="a646a-148">hello **Metrics** node with hello *resourceID* and **MetricAggregation** must be included in hello diagnostics configuration for your VM if you want toosee hello VM monitoring data in hello Azure portal.</span></span> 
> 
> 

<span data-ttu-id="a646a-149">Hola te mostramos un ejemplo de Hola xml para definiciones de métricas:</span><span class="sxs-lookup"><span data-stu-id="a646a-149">hello following is an example of hello xml for metrics definitions:</span></span> 

        <Metrics resourceId="/subscriptions/subscription().subscriptionId/resourceGroups/resourceGroup().name/providers/Microsoft.Compute/virtualMachines/vmName">
            <MetricAggregation scheduledTransferPeriod="PT1H"/>
            <MetricAggregation scheduledTransferPeriod="PT1M"/>
        </Metrics>

<span data-ttu-id="a646a-150">Hola *resourceID* atributo identifica singularmente la máquina virtual de hello en su suscripción.</span><span class="sxs-lookup"><span data-stu-id="a646a-150">hello *resourceID* attribute uniquely identifies hello virtual machine in your subscription.</span></span> <span data-ttu-id="a646a-151">Asegúrese de seguro toouse hello subscription() y resourceGroup() las funciones para que hello plantilla actualiza automáticamente los valores basados en grupos de suscripción y recursos de Hola que está implementando.</span><span class="sxs-lookup"><span data-stu-id="a646a-151">Make sure toouse hello subscription() and resourceGroup() functions so that hello template automatically updates those values based on hello subscription and resource group you are deploying to.</span></span>

<span data-ttu-id="a646a-152">Si va a crear varias máquinas virtuales en un bucle, tendrá hello toopopulate *resourceID* valor con un toocorrectly de función copyIndex() diferenciar cada máquina virtual individual.</span><span class="sxs-lookup"><span data-stu-id="a646a-152">If you are creating multiple Virtual Machines in a loop then you will have toopopulate hello *resourceID* value with an copyIndex() function toocorrectly differentiate each individual VM.</span></span> <span data-ttu-id="a646a-153">Hola *xmlCfg* valor puede ser actualizada toosupport esto como sigue:</span><span class="sxs-lookup"><span data-stu-id="a646a-153">hello *xmlCfg* value can be updated toosupport this as follows:</span></span>  

    "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), concat(parameters('vmNamePrefix'), copyindex()), variables('wadcfgxend')))]", 

<span data-ttu-id="a646a-154">Hola MetricAggregation valo *PT1H* y *PT1M* indicar una agregación por minuto y una agregación más de una hora.</span><span class="sxs-lookup"><span data-stu-id="a646a-154">hello MetricAggregation value of *PT1H* and *PT1M* signify an aggregation over a minute and an aggregation over an hour.</span></span>

## <a name="wadmetrics-tables-in-storage"></a><span data-ttu-id="a646a-155">Tablas de WADMetrics en almacenamiento</span><span class="sxs-lookup"><span data-stu-id="a646a-155">WADMetrics tables in storage</span></span>
<span data-ttu-id="a646a-156">configuración de métricas de Hello anterior generará tablas en la cuenta de almacenamiento de diagnósticos con hello sigue las convenciones de nomenclatura:</span><span class="sxs-lookup"><span data-stu-id="a646a-156">hello Metrics configuration above will generate tables in your diagnostics storage account with hello following naming conventions:</span></span>

* <span data-ttu-id="a646a-157">**WADMetrics** : prefijo estándar para todas las tablas WADMetrics.</span><span class="sxs-lookup"><span data-stu-id="a646a-157">**WADMetrics** : Standard prefix for all WADMetrics tables</span></span>
* <span data-ttu-id="a646a-158">**PT1H** o **PT1M** : significa que la tabla hello contiene datos agregados en 1 hora o minuto</span><span class="sxs-lookup"><span data-stu-id="a646a-158">**PT1H** or **PT1M** : Signifies that hello table contains aggregate data over 1 hour or 1 minute</span></span>
* <span data-ttu-id="a646a-159">**P10D** : indica la tabla de hello contendrá datos de 10 días a partir de cuando tabla Hola iniciado la recopilación de datos</span><span class="sxs-lookup"><span data-stu-id="a646a-159">**P10D** : Signifies hello table will contain data for 10 days from when hello table started collecting data</span></span>
* <span data-ttu-id="a646a-160">**V2S** : constante de cadena.</span><span class="sxs-lookup"><span data-stu-id="a646a-160">**V2S** : String constant</span></span>
* <span data-ttu-id="a646a-161">**AAAAMMDD** : fecha de hello en qué Hola tabla iniciado la recopilación de datos</span><span class="sxs-lookup"><span data-stu-id="a646a-161">**yyyymmdd** : hello date at which hello table started collecting data</span></span>

<span data-ttu-id="a646a-162">Ejemplo: *WADMetricsPT1HP10DV2S20151108* contendrá datos de métricas agregados durante una hora durante 10 días a partir del 11 de noviembre de 2015.</span><span class="sxs-lookup"><span data-stu-id="a646a-162">Example: *WADMetricsPT1HP10DV2S20151108* will contain metrics data aggregated over an hour for 10 days starting on 11-Nov-2015</span></span>    

<span data-ttu-id="a646a-163">Cada tabla WADMetrics contendrá Hola siguientes columnas:</span><span class="sxs-lookup"><span data-stu-id="a646a-163">Each WADMetrics table will contain hello following columns:</span></span>

* <span data-ttu-id="a646a-164">**PartitionKey**: Hola partitionkey se crea en función de hello *resourceID* valor toouniquely identificar el recurso de máquina virtual de Hola.</span><span class="sxs-lookup"><span data-stu-id="a646a-164">**PartitionKey**: hello partitionkey is constructed based on hello *resourceID* value toouniquely identify hello VM resource.</span></span> <span data-ttu-id="a646a-165">para, por ejemplo: 002Fsubscriptions:<subscriptionID>:002FresourceGroups:002F<ResourceGroupName>:002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span><span class="sxs-lookup"><span data-stu-id="a646a-165">for e.g. : 002Fsubscriptions:<subscriptionID>:002FresourceGroups:002F<ResourceGroupName>:002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span></span>  
* <span data-ttu-id="a646a-166">**RowKey** : formato de hello sigue <Descending time tick>:<Performance Counter Name>.</span><span class="sxs-lookup"><span data-stu-id="a646a-166">**RowKey** : Follows hello format <Descending time tick>:<Performance Counter Name>.</span></span> <span data-ttu-id="a646a-167">Hola descendente cálculo de marca de tiempo es marcas de tiempo máximo menos tiempo Hola del principio de hello del período de agregación de Hola.</span><span class="sxs-lookup"><span data-stu-id="a646a-167">hello descending time tick calculation is max time ticks minus hello time of hello beginning of hello aggregation period.</span></span> <span data-ttu-id="a646a-168">Por ejemplo,</span><span class="sxs-lookup"><span data-stu-id="a646a-168">E.g.</span></span> <span data-ttu-id="a646a-169">Si un período de muestreo Hola iniciado de 10-noviembre de 2015 y cálculo de UTC, a continuación, hello 00:00Hrs sería: DateTime.MaxValue.Ticks - (nuevo DateTime(2015,11,10,0,0,0,DateTimeKind.Utc). Tics).</span><span class="sxs-lookup"><span data-stu-id="a646a-169">if hello sample period started on 10-Nov-2015 and 00:00Hrs UTC then hello calculation would be: DateTime.MaxValue.Ticks - (new DateTime(2015,11,10,0,0,0,DateTimeKind.Utc).Ticks).</span></span> <span data-ttu-id="a646a-170">De clave de fila Hola contador de rendimiento de la bytes disponibles de memoria de hello tendrá un aspecto como: 2519551871999999999__:005CMemory:005CAvailable:0020 Bytes</span><span class="sxs-lookup"><span data-stu-id="a646a-170">For hello memory available bytes performance counter hello row key will look like: 2519551871999999999__:005CMemory:005CAvailable:0020Bytes</span></span>
* <span data-ttu-id="a646a-171">**CounterName** : es nombre Hola Hola del contador de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="a646a-171">**CounterName** : Is hello name of hello performance counter.</span></span> <span data-ttu-id="a646a-172">Esto coincide con hello *counterSpecifier* definido en el archivo de configuración xml Hola.</span><span class="sxs-lookup"><span data-stu-id="a646a-172">This matches hello *counterSpecifier* defined in hello xml config.</span></span>
* <span data-ttu-id="a646a-173">**Máximo** : Hola valor máximo del contador de rendimiento de hello en período de agregación de Hola.</span><span class="sxs-lookup"><span data-stu-id="a646a-173">**Maximum** : hello maximum value of hello performance counter over hello aggregation period.</span></span>
* <span data-ttu-id="a646a-174">**Mínimo** : Hola valor mínimo del contador de rendimiento de hello en período de agregación de Hola.</span><span class="sxs-lookup"><span data-stu-id="a646a-174">**Minimum** : hello minimum value of hello performance counter over hello aggregation period.</span></span>
* <span data-ttu-id="a646a-175">**Total** : Hola suma de todos los valores de contador de rendimiento de Hola que se expresa en período de agregación de Hola.</span><span class="sxs-lookup"><span data-stu-id="a646a-175">**Total** : hello sum of all values of hello performance counter reported over hello aggregation period.</span></span>
* <span data-ttu-id="a646a-176">**Recuento de** : número total de Hola de valores se notifica para el contador de rendimiento de Hola.</span><span class="sxs-lookup"><span data-stu-id="a646a-176">**Count** : hello total number of values reported for hello performance counter.</span></span>
* <span data-ttu-id="a646a-177">**Promedio** : Hola valor promedio (total/recuento) de contador de rendimiento de hello en período de agregación de Hola.</span><span class="sxs-lookup"><span data-stu-id="a646a-177">**Average** : hello average (total/count) value of hello performance counter over hello aggregation period.</span></span>

## <a name="next-steps"></a><span data-ttu-id="a646a-178">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="a646a-178">Next Steps</span></span>
* <span data-ttu-id="a646a-179">Para obtener una plantilla de ejemplo de una máquina virtual de Windows con la extensión de diagnósticos, consulte [201-vm-monitoring-diagnostics-extension](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span><span class="sxs-lookup"><span data-stu-id="a646a-179">For a complete sample template of a Windows virtual machine with diagnostics extension see [201-vm-monitoring-diagnostics-extension](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span></span>   
* <span data-ttu-id="a646a-180">Implementar la plantilla de administrador de recursos de hello mediante [Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) o [línea de comandos de Azure](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span><span class="sxs-lookup"><span data-stu-id="a646a-180">Deploy hello resource manager template using [Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) or [Azure Command Line](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="a646a-181">Obtenga más información sobre la [creación de plantillas del Administrador de recursos de Azure](../../resource-group-authoring-templates.md)</span><span class="sxs-lookup"><span data-stu-id="a646a-181">Learn more about [authoring Azure Resource Manager templates](../../resource-group-authoring-templates.md)</span></span>


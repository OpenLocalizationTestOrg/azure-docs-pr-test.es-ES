---
title: "Creación del agente de escucha de grupo de disponibilidad de SQL Server en Azure Virtual Machines | Microsoft Docs"
description: Instrucciones paso a paso para crear un agente de escucha en un grupo de disponibilidad AlwaysOn para SQL Server en Azure Virtual Machines
services: virtual-machines
documentationcenter: na
author: MikeRayMSFT
manager: jhubbard
editor: monicar
ms.assetid: d1f291e9-9af2-41ba-9d29-9541e3adcfcf
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 05/01/2017
ms.author: mikeray
ms.openlocfilehash: 09fed7e785708d4afe64905de973becc188181d7
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="configure-a-load-balancer-for-an-always-on-availability-group-in-azure"></a><span data-ttu-id="49279-103">Configuración de un equilibrador de carga para un grupo de disponibilidad AlwaysOn en Azure</span><span class="sxs-lookup"><span data-stu-id="49279-103">Configure a load balancer for an Always On availability group in Azure</span></span>
<span data-ttu-id="49279-104">En este artículo se explica cómo puede crear un equilibrador de carga para un grupo de disponibilidad de SQL Server AlwaysOn en instancias de Azure Virtual Machines que se ejecutan con Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="49279-104">This article explains how to create a load balancer for a SQL Server Always On availability group in Azure virtual machines that are running with Azure Resource Manager.</span></span> <span data-ttu-id="49279-105">Cuando las instancias de SQL Server están implementadas en máquinas virtuales de Azure, los grupos de disponibilidad necesitan un equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="49279-105">An availability group requires a load balancer when the SQL Server instances are on Azure virtual machines.</span></span> <span data-ttu-id="49279-106">El equilibrador de carga almacena la dirección IP del agente de escucha del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="49279-106">The load balancer stores the IP address for the availability group listener.</span></span> <span data-ttu-id="49279-107">Si un grupo de disponibilidad abarca varias regiones, cada región necesitará su propio equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="49279-107">If an availability group spans multiple regions, each region needs a load balancer.</span></span>

<span data-ttu-id="49279-108">Para completar esta tarea, debe tener un grupo de disponibilidad de SQL Server implementado en instancias de Azure Virtual Machines que se estén ejecutando con Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="49279-108">To complete this task, you need to have a SQL Server availability group deployed on Azure virtual machines that are running with Resource Manager.</span></span> <span data-ttu-id="49279-109">Las dos máquinas virtuales de SQL Server deben pertenecer al mismo conjunto de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="49279-109">Both SQL Server virtual machines must belong to the same availability set.</span></span> <span data-ttu-id="49279-110">Puede usar la [plantilla de Microsoft](virtual-machines-windows-portal-sql-alwayson-availability-groups.md) para crear automáticamente el grupo de disponibilidad en Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="49279-110">You can use the [Microsoft template](virtual-machines-windows-portal-sql-alwayson-availability-groups.md) to automatically create the availability group in Resource Manager.</span></span> <span data-ttu-id="49279-111">Esta plantilla crea automáticamente un equilibrador de carga interno.</span><span class="sxs-lookup"><span data-stu-id="49279-111">This template automatically creates an internal load balancer for you.</span></span> 

<span data-ttu-id="49279-112">Si lo prefiere, puede [configurar manualmente un grupo de disponibilidad](virtual-machines-windows-portal-sql-alwayson-availability-groups-manual.md).</span><span class="sxs-lookup"><span data-stu-id="49279-112">If you prefer, you can [manually configure an availability group](virtual-machines-windows-portal-sql-alwayson-availability-groups-manual.md).</span></span>

<span data-ttu-id="49279-113">En este artículo, es necesario que los grupos de disponibilidad ya estén configurados.</span><span class="sxs-lookup"><span data-stu-id="49279-113">This article requires that your availability groups are already configured.</span></span>  

<span data-ttu-id="49279-114">Temas relacionados:</span><span class="sxs-lookup"><span data-stu-id="49279-114">Related topics include:</span></span>

* [<span data-ttu-id="49279-115">Configuración de Grupos de disponibilidad AlwaysOn en la máquina virtual de Azure (GUI)</span><span class="sxs-lookup"><span data-stu-id="49279-115">Configure Always On availability groups in Azure VM (GUI)</span></span>](virtual-machines-windows-portal-sql-alwayson-availability-groups-manual.md)   
* [<span data-ttu-id="49279-116">Configuración de una conexión entre dos redes virtuales mediante Azure Resource Manager y PowerShell</span><span class="sxs-lookup"><span data-stu-id="49279-116">Configure a VNet-to-VNet connection by using Azure Resource Manager and PowerShell</span></span>](../../../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md)

<span data-ttu-id="49279-117">A lo largo de este artículo, va a crear y configurar un equilibrador de carga en Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="49279-117">By walking through this article, you create and configure a load balancer in the Azure portal.</span></span> <span data-ttu-id="49279-118">Una vez hecho esto, configurará el clúster para que utilice la dirección IP del equilibrador de carga para el agente de escucha del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="49279-118">After the process is complete, you configure the cluster to use the IP address from the load balancer for the availability group listener.</span></span>

## <a name="create-and-configure-the-load-balancer-in-the-azure-portal"></a><span data-ttu-id="49279-119">Creación y configuración del equilibrador de carga en el Portal de Azure</span><span class="sxs-lookup"><span data-stu-id="49279-119">Create and configure the load balancer in the Azure portal</span></span>
<span data-ttu-id="49279-120">En esta parte de la tarea, haga lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="49279-120">In this portion of the task, do the following:</span></span>

1. <span data-ttu-id="49279-121">En Azure Portal, cree el equilibrador de carga y configure la dirección IP.</span><span class="sxs-lookup"><span data-stu-id="49279-121">In the Azure portal, create the load balancer and configure the IP address.</span></span>
2. <span data-ttu-id="49279-122">Configure el grupo back-end.</span><span class="sxs-lookup"><span data-stu-id="49279-122">Configure the back-end pool.</span></span>
3. <span data-ttu-id="49279-123">Cree el sondeo.</span><span class="sxs-lookup"><span data-stu-id="49279-123">Create the probe.</span></span> 
4. <span data-ttu-id="49279-124">Configure las reglas de equilibrio de carga.</span><span class="sxs-lookup"><span data-stu-id="49279-124">Set the load balancing rules.</span></span>

> [!NOTE]
> <span data-ttu-id="49279-125">Si las instancias de SQL Server se encuentran en varios grupos de recursos y regiones, realice cada paso dos veces, una vez en cada grupo de recursos.</span><span class="sxs-lookup"><span data-stu-id="49279-125">If the SQL Server instances are in multiple resource groups and regions, perform each step twice, once in each resource group.</span></span>
> 
> 

### <a name="step-1-create-the-load-balancer-and-configure-the-ip-address"></a><span data-ttu-id="49279-126">Paso 1: Creación del equilibrador de carga y configuración de la dirección IP</span><span class="sxs-lookup"><span data-stu-id="49279-126">Step 1: Create the load balancer and configure the IP address</span></span>
<span data-ttu-id="49279-127">En primer lugar, cree el equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="49279-127">First, create the load balancer.</span></span> 

1. <span data-ttu-id="49279-128">En el Portal de Azure, abra el grupo de recursos que contiene las máquinas virtuales de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="49279-128">In the Azure portal, open the resource group that contains the SQL Server virtual machines.</span></span> 

2. <span data-ttu-id="49279-129">En el grupo de recursos, haga clic en **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="49279-129">In the resource group, click **Add**.</span></span>

3. <span data-ttu-id="49279-130">Busque el **equilibrador de carga** y, a continuación, en los resultados de la búsqueda, seleccione el **equilibrador de carga** publicado por **Microsoft**.</span><span class="sxs-lookup"><span data-stu-id="49279-130">Search for **load balancer** and then, in the search results, select **Load Balancer**, which is published by **Microsoft**.</span></span>

4. <span data-ttu-id="49279-131">En la hoja **Load Balancer**, haga clic en **Crear**.</span><span class="sxs-lookup"><span data-stu-id="49279-131">On the **Load Balancer** blade, click **Create**.</span></span>

5. <span data-ttu-id="49279-132">En el cuadro de diálogo **Crear equilibrador de carga**, configure el equilibrador de carga tal y como se explica a continuación:</span><span class="sxs-lookup"><span data-stu-id="49279-132">In the **Create load balancer** dialog box, configure the load balancer as follows:</span></span>

   | <span data-ttu-id="49279-133">Configuración</span><span class="sxs-lookup"><span data-stu-id="49279-133">Setting</span></span> | <span data-ttu-id="49279-134">Valor</span><span class="sxs-lookup"><span data-stu-id="49279-134">Value</span></span> |
   | --- | --- |
   | <span data-ttu-id="49279-135">**Name**</span><span class="sxs-lookup"><span data-stu-id="49279-135">**Name**</span></span> |<span data-ttu-id="49279-136">Nombre de texto que representa el equilibrador de carga;</span><span class="sxs-lookup"><span data-stu-id="49279-136">A text name representing the load balancer.</span></span> <span data-ttu-id="49279-137">Por ejemplo, **sqlLB**.</span><span class="sxs-lookup"><span data-stu-id="49279-137">For example, **sqlLB**.</span></span> |
   | <span data-ttu-id="49279-138">**Tipo**</span><span class="sxs-lookup"><span data-stu-id="49279-138">**Type**</span></span> |<span data-ttu-id="49279-139">**Interno**: la mayoría de las implementaciones usa un equilibrador de carga interno que permite a las aplicaciones dentro de la misma red virtual conectarse al grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="49279-139">**Internal**: Most implementations use an internal load balancer, which allows applications within the same virtual network to connect to the availability group.</span></span>  </br> <span data-ttu-id="49279-140">**Externo**: permite que las aplicaciones se conecten al grupo de disponibilidad a través de una conexión a Internet pública.</span><span class="sxs-lookup"><span data-stu-id="49279-140">**External**: Allows applications to connect to the availability group through a public Internet connection.</span></span> |
   | <span data-ttu-id="49279-141">**Red virtual**</span><span class="sxs-lookup"><span data-stu-id="49279-141">**Virtual network**</span></span> |<span data-ttu-id="49279-142">Seleccione la red virtual en la que se encuentran las instancias de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="49279-142">Select the virtual network that the SQL Server intances are in.</span></span> |
   | <span data-ttu-id="49279-143">**Subred**</span><span class="sxs-lookup"><span data-stu-id="49279-143">**Subnet**</span></span> |<span data-ttu-id="49279-144">Seleccione la subred en la que se encuentran las instancias de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="49279-144">Select the subnet that the SQL Server instances are in.</span></span> |
   | <span data-ttu-id="49279-145">**Asignación de dirección IP**</span><span class="sxs-lookup"><span data-stu-id="49279-145">**IP address assignment**</span></span> |<span data-ttu-id="49279-146">**Estática**</span><span class="sxs-lookup"><span data-stu-id="49279-146">**Static**</span></span> |
   | <span data-ttu-id="49279-147">**Dirección IP privada**</span><span class="sxs-lookup"><span data-stu-id="49279-147">**Private IP address**</span></span> |<span data-ttu-id="49279-148">Especifique una dirección IP disponible de la subred.</span><span class="sxs-lookup"><span data-stu-id="49279-148">Specify an available IP address from the subnet.</span></span> <span data-ttu-id="49279-149">Utilícela cuando cree un agente de escucha en el clúster.</span><span class="sxs-lookup"><span data-stu-id="49279-149">Use this IP address when you create a listener on the cluster.</span></span> <span data-ttu-id="49279-150">Más adelante en este mismo artículo, hay un script de PowerShell en el que tendrá que utilizar esta dirección para la variable `$ILBIP`.</span><span class="sxs-lookup"><span data-stu-id="49279-150">In a PowerShell script, later in this article, use this address for the `$ILBIP` variable.</span></span> |
   | <span data-ttu-id="49279-151">**Suscripción**</span><span class="sxs-lookup"><span data-stu-id="49279-151">**Subscription**</span></span> |<span data-ttu-id="49279-152">Si tiene varias suscripciones, puede aparecer este campo.</span><span class="sxs-lookup"><span data-stu-id="49279-152">If you have multiple subscriptions, this field might appear.</span></span> <span data-ttu-id="49279-153">Seleccione la suscripción que quiere asociar con este recurso.</span><span class="sxs-lookup"><span data-stu-id="49279-153">Select the subscription that you want to associate with this resource.</span></span> <span data-ttu-id="49279-154">Normalmente, será la misma suscripción que se utiliza con todos los recursos del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="49279-154">It is normally the same subscription as all the resources for the availability group.</span></span> |
   | <span data-ttu-id="49279-155">**Grupos de recursos**</span><span class="sxs-lookup"><span data-stu-id="49279-155">**Resource group**</span></span> |<span data-ttu-id="49279-156">Seleccione el grupo de recursos en el que se encuentran las instancias de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="49279-156">Select the resource group that the SQL Server instances are in.</span></span> |
   | <span data-ttu-id="49279-157">**Ubicación**</span><span class="sxs-lookup"><span data-stu-id="49279-157">**Location**</span></span> |<span data-ttu-id="49279-158">Seleccione la ubicación de Azure en la que se encuentran las instancias de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="49279-158">Select the Azure location that the SQL Server instances are in.</span></span> |

6. <span data-ttu-id="49279-159">Haga clic en **Crear**.</span><span class="sxs-lookup"><span data-stu-id="49279-159">Click **Create**.</span></span> 

<span data-ttu-id="49279-160">Azure crea el equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="49279-160">Azure creates the load balancer.</span></span> <span data-ttu-id="49279-161">El equilibrador de carga pertenece a una red, una subred, una ubicación y un grupo de recursos específicos.</span><span class="sxs-lookup"><span data-stu-id="49279-161">The load balancer belongs to a specific network, subnet, resource group, and location.</span></span> <span data-ttu-id="49279-162">Cuando Azure haya completado la tarea, compruebe la configuración del equilibrador de carga en Azure.</span><span class="sxs-lookup"><span data-stu-id="49279-162">After Azure completes the task, verify the load balancer settings in Azure.</span></span> 

### <a name="step-2-configure-the-back-end-pool"></a><span data-ttu-id="49279-163">Paso 2: Configuración del grupo back-end</span><span class="sxs-lookup"><span data-stu-id="49279-163">Step 2: Configure the back-end pool</span></span>
<span data-ttu-id="49279-164">En Azure, el grupo de direcciones de back-end se denomina *grupo de back-end*.</span><span class="sxs-lookup"><span data-stu-id="49279-164">Azure calls the back-end address pool *backend pool*.</span></span> <span data-ttu-id="49279-165">En este caso, el grupo de back-end contiene las direcciones de las dos instancias de SQL Server del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="49279-165">In this case, the back-end pool is the addresses of the two SQL Server instances in your availability group.</span></span> 

1. <span data-ttu-id="49279-166">En el grupo de recursos, haga clic en el equilibrador de carga que ha creado.</span><span class="sxs-lookup"><span data-stu-id="49279-166">In your resource group, click the load balancer that you created.</span></span> 

2. <span data-ttu-id="49279-167">En **Configuración**, haga clic en **Grupos de back-end**.</span><span class="sxs-lookup"><span data-stu-id="49279-167">On **Settings**, click **Backend pools**.</span></span>

3. <span data-ttu-id="49279-168">En **Grupos de back-end**, haga clic en **Agregar** para crear un grupo de direcciones de back-end.</span><span class="sxs-lookup"><span data-stu-id="49279-168">On **Backend pools**, click **Add** to create a back-end address pool.</span></span> 

4. <span data-ttu-id="49279-169">En **Agregar grupo back-end** en **Nombre**, especifique un nombre para el grupo de back-end.</span><span class="sxs-lookup"><span data-stu-id="49279-169">On **Add backend pool**, under **Name**, type a name for the back-end pool.</span></span>

5. <span data-ttu-id="49279-170">En **Máquinas virtuales**, haga clic en **+ Agregar una máquina virtual**.</span><span class="sxs-lookup"><span data-stu-id="49279-170">Under **Virtual machines**, click **Add a virtual machine**.</span></span> 

6. <span data-ttu-id="49279-171">En **Elegir máquinas virtuales**, haga clic en **Elegir un conjunto de disponibilidad** y especifique el conjunto de disponibilidad al que pertenecen las máquinas virtuales de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="49279-171">Under **Choose virtual machines**, click **Choose an availability set**, and then specify the availability set that the SQL Server virtual machines belong to.</span></span>

7. <span data-ttu-id="49279-172">Después de elegir el conjunto de disponibilidad, haga clic en **Elegir máquinas virtuales**, seleccione las dos máquinas virtuales que hospedan las instancias de SQL Server en el grupo de disponibilidad y, finalmente, haga clic en **Seleccionar**.</span><span class="sxs-lookup"><span data-stu-id="49279-172">After you have chosen the availability set, click **Choose the virtual machines**, select the two virtual machines that host the SQL Server instances in the availability group, and then click **Select**.</span></span> 

8. <span data-ttu-id="49279-173">Haga clic en **Aceptar** para cerrar las hojas **Elegir máquinas virtuales** y **Agregar grupo back-end**.</span><span class="sxs-lookup"><span data-stu-id="49279-173">Click **OK** to close the blades for **Choose virtual machines**, and **Add backend pool**.</span></span> 

<span data-ttu-id="49279-174">Azure actualiza la configuración del grupo de direcciones de back-end.</span><span class="sxs-lookup"><span data-stu-id="49279-174">Azure updates the settings for the back-end address pool.</span></span> <span data-ttu-id="49279-175">Ahora, el conjunto de disponibilidad tiene un grupo de dos instancias de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="49279-175">Now your availability set has a pool of two SQL Server instances.</span></span>

### <a name="step-3-create-a-probe"></a><span data-ttu-id="49279-176">Paso 3: Elaboración de un sondeo</span><span class="sxs-lookup"><span data-stu-id="49279-176">Step 3: Create a probe</span></span>
<span data-ttu-id="49279-177">Este sondeo establece el modo en que Azure va a comprobar cuál de las instancias de SQL Server es el propietario actual del agente de escucha del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="49279-177">The probe defines how Azure verifies which of the SQL Server instances currently owns the availability group listener.</span></span> <span data-ttu-id="49279-178">Azure analiza el servició con arreglo a la dirección IP de un puerto que estableció al crear el sondeo.</span><span class="sxs-lookup"><span data-stu-id="49279-178">Azure probes the service based on the IP address on a port that you define when you create the probe.</span></span>

1. <span data-ttu-id="49279-179">En la hoja **Configuración** del equilibrador de carga, haga clic en **Sondeos de estado**.</span><span class="sxs-lookup"><span data-stu-id="49279-179">On the load balancer **Settings** blade, click **Health probes**.</span></span> 

2. <span data-ttu-id="49279-180">En la hoja **Sondeos de estado**, haga clic en **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="49279-180">On the **Health probes** blade, click **Add**.</span></span>

3. <span data-ttu-id="49279-181">Configure el sondeo en la hoja **Agregar sondeo** .</span><span class="sxs-lookup"><span data-stu-id="49279-181">Configure the probe on the **Add probe** blade.</span></span> <span data-ttu-id="49279-182">Utilice los valores siguientes para configurar el sondeo.</span><span class="sxs-lookup"><span data-stu-id="49279-182">Use the following values to configure the probe:</span></span>

   | <span data-ttu-id="49279-183">Configuración</span><span class="sxs-lookup"><span data-stu-id="49279-183">Setting</span></span> | <span data-ttu-id="49279-184">Valor</span><span class="sxs-lookup"><span data-stu-id="49279-184">Value</span></span> |
   | --- | --- |
   | <span data-ttu-id="49279-185">**Name**</span><span class="sxs-lookup"><span data-stu-id="49279-185">**Name**</span></span> |<span data-ttu-id="49279-186">Nombre de texto que representa el sondeo.</span><span class="sxs-lookup"><span data-stu-id="49279-186">A text name representing the probe.</span></span> <span data-ttu-id="49279-187">Por ejemplo, **SQLAlwaysOnEndPointProbe**.</span><span class="sxs-lookup"><span data-stu-id="49279-187">For example, **SQLAlwaysOnEndPointProbe**.</span></span> |
   | <span data-ttu-id="49279-188">**Protocolo**</span><span class="sxs-lookup"><span data-stu-id="49279-188">**Protocol**</span></span> |<span data-ttu-id="49279-189">**TCP**</span><span class="sxs-lookup"><span data-stu-id="49279-189">**TCP**</span></span> |
   | <span data-ttu-id="49279-190">**Puerto**</span><span class="sxs-lookup"><span data-stu-id="49279-190">**Port**</span></span> |<span data-ttu-id="49279-191">Puede usar cualquier puerto que esté disponible.</span><span class="sxs-lookup"><span data-stu-id="49279-191">You can use any available port.</span></span> <span data-ttu-id="49279-192">Por ejemplo, *59999*.</span><span class="sxs-lookup"><span data-stu-id="49279-192">For example, *59999*.</span></span> |
   | <span data-ttu-id="49279-193">**Intervalo**</span><span class="sxs-lookup"><span data-stu-id="49279-193">**Interval**</span></span> |<span data-ttu-id="49279-194">*5*</span><span class="sxs-lookup"><span data-stu-id="49279-194">*5*</span></span> |
   | <span data-ttu-id="49279-195">**Umbral incorrecto**</span><span class="sxs-lookup"><span data-stu-id="49279-195">**Unhealthy threshold**</span></span> |<span data-ttu-id="49279-196">*2*</span><span class="sxs-lookup"><span data-stu-id="49279-196">*2*</span></span> |

4.  <span data-ttu-id="49279-197">Haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="49279-197">Click **OK**.</span></span> 

> [!NOTE]
> <span data-ttu-id="49279-198">Asegúrese de que el puerto especificado esté abierto en el firewall de las dos instancias de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="49279-198">Make sure that the port you specify is open on the firewall of both SQL Server instances.</span></span> <span data-ttu-id="49279-199">En estas dos instancias, es necesario definir una regla de entrada para el puerto TCP.</span><span class="sxs-lookup"><span data-stu-id="49279-199">Both instances require an inbound rule for the TCP port that you use.</span></span> <span data-ttu-id="49279-200">Consulte [Agregar o editar regla de firewall](http://technet.microsoft.com/library/cc753558.aspx) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="49279-200">For more information, see [Add or Edit Firewall Rule](http://technet.microsoft.com/library/cc753558.aspx).</span></span> 
> 
> 

<span data-ttu-id="49279-201">Azure crea el sondeo y, a continuación, lo usa para comprobar qué instancia de SQL Server tiene el agente de escucha del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="49279-201">Azure creates the probe and then uses it to test which SQL Server instance has the listener for the availability group.</span></span>

### <a name="step-4-set-the-load-balancing-rules"></a><span data-ttu-id="49279-202">Paso 4: Configuración de las reglas de equilibrio de carga</span><span class="sxs-lookup"><span data-stu-id="49279-202">Step 4: Set the load balancing rules</span></span>
<span data-ttu-id="49279-203">Las reglas de equilibrio de carga determinan cómo el equilibrador de carga enruta el tráfico a las instancias de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="49279-203">The load balancing rules configure how the load balancer routes traffic to the SQL Server instances.</span></span> <span data-ttu-id="49279-204">En este equilibrador de carga, habilite Direct Server Return, ya que solo una de las dos instancias de SQL Server puede ser el propietario del recurso del agente de escucha del grupo de disponibilidad simultáneamente.</span><span class="sxs-lookup"><span data-stu-id="49279-204">For this load balancer, you enable direct server return because only one of the two SQL Server instances owns the availability group listener resource at a time.</span></span>

1. <span data-ttu-id="49279-205">En la hoja **Configuración** del equilibrador de carga, haga clic en **Reglas de equilibrio de carga**.</span><span class="sxs-lookup"><span data-stu-id="49279-205">On the load balancer **Settings** blade, click **Load balancing rules**.</span></span> 

2. <span data-ttu-id="49279-206">En la hoja **Reglas de equilibrio de carga**, haga clic en **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="49279-206">On the **Load balancing rules** blade, click **Add**.</span></span>

3. <span data-ttu-id="49279-207">Utilice la hoja **Add load balancing rules** (Agregar reglas de equilibrio de carga) para configurar la regla de equilibrio de carga.</span><span class="sxs-lookup"><span data-stu-id="49279-207">On the **Add load balancing rules** blade, configure the load balancing rule.</span></span> <span data-ttu-id="49279-208">Use la configuración siguiente:</span><span class="sxs-lookup"><span data-stu-id="49279-208">Use the following settings:</span></span> 

   | <span data-ttu-id="49279-209">Configuración</span><span class="sxs-lookup"><span data-stu-id="49279-209">Setting</span></span> | <span data-ttu-id="49279-210">Valor</span><span class="sxs-lookup"><span data-stu-id="49279-210">Value</span></span> |
   | --- | --- |
   | <span data-ttu-id="49279-211">**Name**</span><span class="sxs-lookup"><span data-stu-id="49279-211">**Name**</span></span> |<span data-ttu-id="49279-212">Nombre de texto que representa las reglas de equilibrio de carga.</span><span class="sxs-lookup"><span data-stu-id="49279-212">A text name representing the load balancing rules.</span></span> <span data-ttu-id="49279-213">Por ejemplo, **SQLAlwaysOnEndPointListener**.</span><span class="sxs-lookup"><span data-stu-id="49279-213">For example, **SQLAlwaysOnEndPointListener**.</span></span> |
   | <span data-ttu-id="49279-214">**Protocolo**</span><span class="sxs-lookup"><span data-stu-id="49279-214">**Protocol**</span></span> |<span data-ttu-id="49279-215">**TCP**</span><span class="sxs-lookup"><span data-stu-id="49279-215">**TCP**</span></span> |
   | <span data-ttu-id="49279-216">**Puerto**</span><span class="sxs-lookup"><span data-stu-id="49279-216">**Port**</span></span> |<span data-ttu-id="49279-217">*1433*</span><span class="sxs-lookup"><span data-stu-id="49279-217">*1433*</span></span> |
   | <span data-ttu-id="49279-218">**Puerto back-end**</span><span class="sxs-lookup"><span data-stu-id="49279-218">**Backend Port**</span></span> |<span data-ttu-id="49279-219">*1433*. Este valor se ignorará porque la regla usa **IP flotante (Direct Server Return)**.</span><span class="sxs-lookup"><span data-stu-id="49279-219">*1433*. This value is ignored because this rule uses **Floating IP (direct server return)**.</span></span> |
   | <span data-ttu-id="49279-220">**Sondeo**</span><span class="sxs-lookup"><span data-stu-id="49279-220">**Probe**</span></span> |<span data-ttu-id="49279-221">Utilice el nombre del sondeo que creó para este equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="49279-221">Use the name of the probe that you created for this load balancer.</span></span> |
   | <span data-ttu-id="49279-222">**Persistencia de la sesión**</span><span class="sxs-lookup"><span data-stu-id="49279-222">**Session persistence**</span></span> |<span data-ttu-id="49279-223">**None**</span><span class="sxs-lookup"><span data-stu-id="49279-223">**None**</span></span> |
   | <span data-ttu-id="49279-224">**Tiempo de espera de inactividad (minutos)**</span><span class="sxs-lookup"><span data-stu-id="49279-224">**Idle timeout (minutes)**</span></span> |<span data-ttu-id="49279-225">*4*</span><span class="sxs-lookup"><span data-stu-id="49279-225">*4*</span></span> |
   | <span data-ttu-id="49279-226">**IP flotante (Direct Server Return)**</span><span class="sxs-lookup"><span data-stu-id="49279-226">**Floating IP (direct server return)**</span></span> |<span data-ttu-id="49279-227">**Enabled**</span><span class="sxs-lookup"><span data-stu-id="49279-227">**Enabled**</span></span> |

   > [!NOTE]
   > <span data-ttu-id="49279-228">Tal vez necesite desplazarse hacia abajo en la hoja para ver todas las opciones.</span><span class="sxs-lookup"><span data-stu-id="49279-228">You might have to scroll down the blade to view all the settings.</span></span>
   > 

4. <span data-ttu-id="49279-229">Haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="49279-229">Click **OK**.</span></span> 
5. <span data-ttu-id="49279-230">Azure configura la regla de equilibrio de carga.</span><span class="sxs-lookup"><span data-stu-id="49279-230">Azure configures the load balancing rule.</span></span> <span data-ttu-id="49279-231">Ahora, el equilibrador de carga está configurado para enrutar el tráfico a la instancia de SQL Server que hospeda el agente de escucha del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="49279-231">Now the load balancer is configured to route traffic to the SQL Server instance that hosts the listener for the availability group.</span></span> 

<span data-ttu-id="49279-232">En este punto, el grupo de recursos dispone de un equilibrador de carga que se conecta con las dos máquinas de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="49279-232">At this point, the resource group has a load balancer that connects to both SQL Server machines.</span></span> <span data-ttu-id="49279-233">El equilibrador de carga también contiene una dirección IP del agente de escucha del grupo de disponibilidad de SQL Server AlwaysOn, por lo que cualquier máquina puede responder a las solicitudes de los grupos de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="49279-233">The load balancer also contains an IP address for the SQL Server Always On availability group listener, so that either machine can respond to requests for the availability groups.</span></span>

> [!NOTE]
> <span data-ttu-id="49279-234">Si las instancias de SQL Server se encuentran en dos regiones diferentes, repita los pasos en la otra región.</span><span class="sxs-lookup"><span data-stu-id="49279-234">If your SQL Server instances are in two separate regions, repeat the steps in the other region.</span></span> <span data-ttu-id="49279-235">Cada una de las regiones necesita su propio equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="49279-235">Each region requires a load balancer.</span></span> 
> 
> 

## <a name="configure-the-cluster-to-use-the-load-balancer-ip-address"></a><span data-ttu-id="49279-236">Configure el clúster para que utilice la dirección IP del equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="49279-236">Configure the cluster to use the load balancer IP address</span></span>
<span data-ttu-id="49279-237">El siguiente paso consiste en configurar el agente de escucha del clúster y conectarlo.</span><span class="sxs-lookup"><span data-stu-id="49279-237">The next step is to configure the listener on the cluster, and bring the listener online.</span></span> <span data-ttu-id="49279-238">Haga lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="49279-238">Do the following:</span></span> 

1. <span data-ttu-id="49279-239">Cree el agente de escucha del grupo de disponibilidad en el clúster de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="49279-239">Create the availability group listener on the failover cluster.</span></span> 

2. <span data-ttu-id="49279-240">Conecte el agente de escucha.</span><span class="sxs-lookup"><span data-stu-id="49279-240">Bring the listener online.</span></span>

### <a name="step-5-create-the-availability-group-listener-on-the-failover-cluster"></a><span data-ttu-id="49279-241">Paso 5: Creación del agente de escucha del grupo de disponibilidad en el clúster de conmutación por error</span><span class="sxs-lookup"><span data-stu-id="49279-241">Step 5: Create the availability group listener on the failover cluster</span></span>
<span data-ttu-id="49279-242">En este paso, se crea manualmente el agente de escucha del grupo de disponibilidad en el Administrador de clústeres de conmutación por error y SQL Server Management Studio.</span><span class="sxs-lookup"><span data-stu-id="49279-242">In this step, you manually create the availability group listener in Failover Cluster Manager and SQL Server Management Studio.</span></span>

[!INCLUDE [ag-listener-configure](../../../../includes/virtual-machines-ag-listener-configure.md)]

### <a name="verify-the-configuration-of-the-listener"></a><span data-ttu-id="49279-243">Comprobación de la configuración del agente de escucha</span><span class="sxs-lookup"><span data-stu-id="49279-243">Verify the configuration of the listener</span></span>

<span data-ttu-id="49279-244">Si los recursos y las dependencias de clúster están configurados correctamente, tendría que ver el agente de escucha en SQL Server Management Studio.</span><span class="sxs-lookup"><span data-stu-id="49279-244">If the cluster resources and dependencies are correctly configured, you should be able to view the listener in SQL Server Management Studio.</span></span> <span data-ttu-id="49279-245">Haga lo siguiente para establecer el puerto de escucha:</span><span class="sxs-lookup"><span data-stu-id="49279-245">To set the listener port, do the following:</span></span>

1. <span data-ttu-id="49279-246">Abra SQL Server Management Studio y conéctese a la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="49279-246">Start SQL Server Management Studio, and then connect to the primary replica.</span></span>

2. <span data-ttu-id="49279-247">Vaya a **Alta disponibilidad de AlwaysOn** > **Grupos de disponibilidad** > **Agentes de escucha del grupo de disponibilidad**.</span><span class="sxs-lookup"><span data-stu-id="49279-247">Go to **AlwaysOn High Availability** > **Availability Groups** > **Availability Group Listeners**.</span></span>  
    <span data-ttu-id="49279-248">Ahora tienes que ver el nombre del agente de escucha que creaste en el Administrador de clústeres de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="49279-248">You should now see the listener name that you created in Failover Cluster Manager.</span></span> 

3. <span data-ttu-id="49279-249">Haga clic con el botón derecho en el nombre del agente de escucha y luego en **Propiedades**.</span><span class="sxs-lookup"><span data-stu-id="49279-249">Right-click the listener name, and then click **Properties**.</span></span>

4. <span data-ttu-id="49279-250">En el cuadro **Puerto**, especifique el número de puerto del agente de escucha del grupo de disponibilidad mediante el valor $EndpointPort que ha establecido antes (1433 era el valor predeterminado) y haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="49279-250">In the **Port** box, specify the port number for the availability group listener by using the $EndpointPort you used earlier (1433 was the default), and then click **OK**.</span></span>

<span data-ttu-id="49279-251">Ahora tiene un grupo de disponibilidad en máquinas virtuales de Azure que se ejecutan con el modelo de Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="49279-251">You now have an availability group in Azure virtual machines running in Resource Manager mode.</span></span> 

## <a name="test-the-connection-to-the-listener"></a><span data-ttu-id="49279-252">Comprobación de la conexión con el agente de escucha</span><span class="sxs-lookup"><span data-stu-id="49279-252">Test the connection to the listener</span></span>
<span data-ttu-id="49279-253">Pruebe la conexión haciendo lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="49279-253">Test the connection by doing the following:</span></span>

1. <span data-ttu-id="49279-254">Conéctese con RDP a una instancia de SQL Server que esté en la misma red virtual, pero que no sea la propietaria de la réplica.</span><span class="sxs-lookup"><span data-stu-id="49279-254">RDP to a SQL Server instance that is in the same virtual network, but does not own the replica.</span></span> <span data-ttu-id="49279-255">Este servidor puede ser otra instancia de SQL Server del clúster.</span><span class="sxs-lookup"><span data-stu-id="49279-255">This server can be the other SQL Server instance in the cluster.</span></span>

2. <span data-ttu-id="49279-256">Use la utilidad **sqlcmd** para probar la conexión.</span><span class="sxs-lookup"><span data-stu-id="49279-256">Use **sqlcmd** utility to test the connection.</span></span> <span data-ttu-id="49279-257">Por ejemplo, el siguiente script establece una conexión **sqlcmd** con la réplica principal a través del agente de escucha utilizando la autenticación de Windows:</span><span class="sxs-lookup"><span data-stu-id="49279-257">For example, the following script establishes a **sqlcmd** connection to the primary replica through the listener with Windows authentication:</span></span>
   
        sqlcmd -S <listenerName> -E

<span data-ttu-id="49279-258">La conexión SQLCMD se establece automáticamente con la instancia de SQL Server en la que se hospede la réplica principal.</span><span class="sxs-lookup"><span data-stu-id="49279-258">The SQLCMD connection automatically connects to the SQL Server instance that hosts the primary replica.</span></span> 

## <a name="create-an-ip-address-for-an-additional-availability-group"></a><span data-ttu-id="49279-259">Creación de una dirección IP para un grupo de disponibilidad adicional</span><span class="sxs-lookup"><span data-stu-id="49279-259">Create an IP address for an additional availability group</span></span>

<span data-ttu-id="49279-260">Cada grupo de disponibilidad usa un agente de escucha independiente.</span><span class="sxs-lookup"><span data-stu-id="49279-260">Each availability group uses a separate listener.</span></span> <span data-ttu-id="49279-261">Cada agente de escucha tiene su propia dirección IP.</span><span class="sxs-lookup"><span data-stu-id="49279-261">Each listener has its own IP address.</span></span> <span data-ttu-id="49279-262">Use el mismo equilibrador de carga para contener la dirección IP de los agentes de escucha adicionales.</span><span class="sxs-lookup"><span data-stu-id="49279-262">Use the same load balancer to hold the IP address for additional listeners.</span></span> <span data-ttu-id="49279-263">Después de crear un grupo de disponibilidad, agregue la dirección IP al equilibrador de carga y luego configure el agente de escucha.</span><span class="sxs-lookup"><span data-stu-id="49279-263">After you create an availability group, add the IP address to the load balancer, and then configure the listener.</span></span>

<span data-ttu-id="49279-264">Para agregar una dirección IP a un equilibrador de carga con el portal de Azure, haga lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="49279-264">To add an IP address to a load balancer with the Azure portal, do the following:</span></span>

1. <span data-ttu-id="49279-265">En Azure Portal, abra el grupo de recursos que contiene el equilibrador de carga y haga clic en él.</span><span class="sxs-lookup"><span data-stu-id="49279-265">In the Azure portal, open the resource group that contains the load balancer, and then click the load balancer.</span></span> 

2. <span data-ttu-id="49279-266">En **Configuración**, haga clic en **Grupo de direcciones IP de front-end** y, después, en **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="49279-266">Under **SETTINGS**, click **Frontend IP pool**, and then click **Add**.</span></span> 

3. <span data-ttu-id="49279-267">En **Agregar dirección IP de front-end**, asigne un nombre para el front-end.</span><span class="sxs-lookup"><span data-stu-id="49279-267">Under **Add frontend IP address**, assign a name for the front end.</span></span> 

4. <span data-ttu-id="49279-268">Compruebe que la **red Virtual** y la **subred** sean las mismas que en las instancias de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="49279-268">Verify that the **Virtual network** and the **Subnet** are the same as the SQL Server instances.</span></span>

5. <span data-ttu-id="49279-269">Establezca la dirección IP del agente de escucha.</span><span class="sxs-lookup"><span data-stu-id="49279-269">Set the IP address for the listener.</span></span> 
   
   >[!TIP]
   ><span data-ttu-id="49279-270">Puede configurar la dirección IP como estática y escribir una dirección que no se use actualmente en la subred.</span><span class="sxs-lookup"><span data-stu-id="49279-270">You can set the IP address to static and type an address that is not currently used in the subnet.</span></span> <span data-ttu-id="49279-271">También puede configurar la dirección IP como dinámica y guardar el nuevo grupo de direcciones IP de front-end.</span><span class="sxs-lookup"><span data-stu-id="49279-271">Alternatively, you can set the IP address to dynamic and save the new front-end IP pool.</span></span> <span data-ttu-id="49279-272">Al hacerlo, Azure Portal asigna automáticamente una dirección IP disponible al grupo.</span><span class="sxs-lookup"><span data-stu-id="49279-272">When you do so, the Azure portal automatically assigns an available IP address to the pool.</span></span> <span data-ttu-id="49279-273">Luego puede volver a abrir el grupo de direcciones IP de front-end y cambiar la asignación a estática.</span><span class="sxs-lookup"><span data-stu-id="49279-273">You can then reopen the front-end IP pool and change the assignment to static.</span></span> 

6. <span data-ttu-id="49279-274">Guarde la dirección IP del agente de escucha.</span><span class="sxs-lookup"><span data-stu-id="49279-274">Save the IP address for the listener.</span></span> 

7. <span data-ttu-id="49279-275">Agregue un sondeo de estado mediante las siguientes opciones:</span><span class="sxs-lookup"><span data-stu-id="49279-275">Add a health probe by using the following settings:</span></span>

   |<span data-ttu-id="49279-276">Configuración</span><span class="sxs-lookup"><span data-stu-id="49279-276">Setting</span></span> |<span data-ttu-id="49279-277">Valor</span><span class="sxs-lookup"><span data-stu-id="49279-277">Value</span></span>
   |:-----|:----
   |<span data-ttu-id="49279-278">**Name**</span><span class="sxs-lookup"><span data-stu-id="49279-278">**Name**</span></span> |<span data-ttu-id="49279-279">Un nombre para identificar el sondeo.</span><span class="sxs-lookup"><span data-stu-id="49279-279">A name to identify the probe.</span></span>
   |<span data-ttu-id="49279-280">**Protocolo**</span><span class="sxs-lookup"><span data-stu-id="49279-280">**Protocol**</span></span> |<span data-ttu-id="49279-281">TCP</span><span class="sxs-lookup"><span data-stu-id="49279-281">TCP</span></span>
   |<span data-ttu-id="49279-282">**Puerto**</span><span class="sxs-lookup"><span data-stu-id="49279-282">**Port**</span></span> |<span data-ttu-id="49279-283">Un puerto TCP sin usar, que debe estar disponible en todas las máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="49279-283">An unused TCP port, which must be available on all virtual machines.</span></span> <span data-ttu-id="49279-284">No se puede usar para ningún otro fin.</span><span class="sxs-lookup"><span data-stu-id="49279-284">It cannot be used for any other purpose.</span></span> <span data-ttu-id="49279-285">Dos agentes de escucha no pueden usar el mismo puerto de sondeo.</span><span class="sxs-lookup"><span data-stu-id="49279-285">No two listeners can use the same probe port.</span></span> 
   |<span data-ttu-id="49279-286">**Intervalo**</span><span class="sxs-lookup"><span data-stu-id="49279-286">**Interval**</span></span> |<span data-ttu-id="49279-287">Cantidad de tiempo entre los intentos de sondeo.</span><span class="sxs-lookup"><span data-stu-id="49279-287">The amount of time between probe attempts.</span></span> <span data-ttu-id="49279-288">Use el valor predeterminado (5).</span><span class="sxs-lookup"><span data-stu-id="49279-288">Use the default (5).</span></span>
   |<span data-ttu-id="49279-289">**Umbral incorrecto**</span><span class="sxs-lookup"><span data-stu-id="49279-289">**Unhealthy threshold**</span></span> |<span data-ttu-id="49279-290">El número de umbrales consecutivos que deben generar un error antes de que se considere que una máquina virtual tiene un estado incorrecto.</span><span class="sxs-lookup"><span data-stu-id="49279-290">The number of consecutive thresholds that should fail before a virtual machine is considered unhealthy.</span></span>

8. <span data-ttu-id="49279-291">Haga clic en **Aceptar** para guardar el sondeo.</span><span class="sxs-lookup"><span data-stu-id="49279-291">Click **OK** to save the probe.</span></span> 

9. <span data-ttu-id="49279-292">Cree una regla de equilibrio de carga.</span><span class="sxs-lookup"><span data-stu-id="49279-292">Create a load balancing rule.</span></span> <span data-ttu-id="49279-293">Haga clic en **Reglas de equilibrio de carga** y luego haga clic en **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="49279-293">Click **Load balancing rules**, and then click **Add**.</span></span>

10. <span data-ttu-id="49279-294">Configure la nueva regla de equilibrio de carga con los siguientes valores:</span><span class="sxs-lookup"><span data-stu-id="49279-294">Configure the new load balancing rule by using the following settings:</span></span>

   |<span data-ttu-id="49279-295">Configuración</span><span class="sxs-lookup"><span data-stu-id="49279-295">Setting</span></span> |<span data-ttu-id="49279-296">Valor</span><span class="sxs-lookup"><span data-stu-id="49279-296">Value</span></span>
   |:-----|:----
   |<span data-ttu-id="49279-297">**Name**</span><span class="sxs-lookup"><span data-stu-id="49279-297">**Name**</span></span> |<span data-ttu-id="49279-298">Un nombre para identificar la regla de equilibrio de carga.</span><span class="sxs-lookup"><span data-stu-id="49279-298">A name to identify the load balancing rule.</span></span> 
   |<span data-ttu-id="49279-299">**Frontend IP address** (Dirección IP de front-end)</span><span class="sxs-lookup"><span data-stu-id="49279-299">**Frontend IP address**</span></span> |<span data-ttu-id="49279-300">Seleccione la dirección IP que creó.</span><span class="sxs-lookup"><span data-stu-id="49279-300">Select the IP address you created.</span></span> 
   |<span data-ttu-id="49279-301">**Protocolo**</span><span class="sxs-lookup"><span data-stu-id="49279-301">**Protocol**</span></span> |<span data-ttu-id="49279-302">TCP</span><span class="sxs-lookup"><span data-stu-id="49279-302">TCP</span></span>
   |<span data-ttu-id="49279-303">**Puerto**</span><span class="sxs-lookup"><span data-stu-id="49279-303">**Port**</span></span> |<span data-ttu-id="49279-304">Use el puerto que usan las instancias de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="49279-304">Use the port that the SQL Server instances are using.</span></span> <span data-ttu-id="49279-305">Una instancia predeterminada usa el puerto 1433, a menos que lo haya modificado.</span><span class="sxs-lookup"><span data-stu-id="49279-305">A default instance uses port 1433, unless you changed it.</span></span> 
   |<span data-ttu-id="49279-306">**Puerto back-end**</span><span class="sxs-lookup"><span data-stu-id="49279-306">**Backend port**</span></span> |<span data-ttu-id="49279-307">Use el mismo valor que en **Puerto**.</span><span class="sxs-lookup"><span data-stu-id="49279-307">Use the same value as **Port**.</span></span>
   |<span data-ttu-id="49279-308">**Grupo de back-end**</span><span class="sxs-lookup"><span data-stu-id="49279-308">**Backend pool**</span></span> |<span data-ttu-id="49279-309">El grupo que contiene las máquinas virtuales con las instancias de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="49279-309">The pool that contains the virtual machines with the SQL Server instances.</span></span> 
   |<span data-ttu-id="49279-310">**Sondeo de estado**</span><span class="sxs-lookup"><span data-stu-id="49279-310">**Health probe**</span></span> |<span data-ttu-id="49279-311">Elija el sondeo que creó.</span><span class="sxs-lookup"><span data-stu-id="49279-311">Choose the probe you created.</span></span>
   |<span data-ttu-id="49279-312">**Persistencia de la sesión**</span><span class="sxs-lookup"><span data-stu-id="49279-312">**Session persistence**</span></span> |<span data-ttu-id="49279-313">None</span><span class="sxs-lookup"><span data-stu-id="49279-313">None</span></span>
   |<span data-ttu-id="49279-314">**Tiempo de espera de inactividad (minutos)**</span><span class="sxs-lookup"><span data-stu-id="49279-314">**Idle timeout (minutes)**</span></span> |<span data-ttu-id="49279-315">Valor predeterminado (4)</span><span class="sxs-lookup"><span data-stu-id="49279-315">Default (4)</span></span>
   |<span data-ttu-id="49279-316">**IP flotante (Direct Server Return)**</span><span class="sxs-lookup"><span data-stu-id="49279-316">**Floating IP (direct server return)**</span></span> | <span data-ttu-id="49279-317">habilitado</span><span class="sxs-lookup"><span data-stu-id="49279-317">Enabled</span></span>

### <a name="configure-the-availability-group-to-use-the-new-ip-address"></a><span data-ttu-id="49279-318">Configuración del grupo de disponibilidad para usar la nueva dirección IP</span><span class="sxs-lookup"><span data-stu-id="49279-318">Configure the availability group to use the new IP address</span></span>

<span data-ttu-id="49279-319">Para terminar de configurar el clúster, repita los pasos realizados cuando creó el primer grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="49279-319">To finish configuring the cluster, repeat the steps that you followed when you made the first availability group.</span></span> <span data-ttu-id="49279-320">Es decir, configure el [clúster para usar la nueva dirección IP](#configure-the-cluster-to-use-the-load-balancer-ip-address).</span><span class="sxs-lookup"><span data-stu-id="49279-320">That is, configure the [cluster to use the new IP address](#configure-the-cluster-to-use-the-load-balancer-ip-address).</span></span> 

<span data-ttu-id="49279-321">Después de haber agregado una dirección IP para el agente de escucha, configure el grupo de disponibilidad adicional. Para ello, haga lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="49279-321">After you have added an IP address for the listener, configure the additional availability group by doing the following:</span></span> 

1. <span data-ttu-id="49279-322">Compruebe que el puerto de sondeo de la nueva dirección IP esté abierto en ambas máquinas virtuales SQL Server.</span><span class="sxs-lookup"><span data-stu-id="49279-322">Verify that the probe port for the new IP address is open on both SQL Server virtual machines.</span></span> 

2. <span data-ttu-id="49279-323">[En el Administrador de clústeres, agregue el punto de acceso cliente](#addcap).</span><span class="sxs-lookup"><span data-stu-id="49279-323">[In Cluster Manager, add the client access point](#addcap).</span></span>

3. <span data-ttu-id="49279-324">[Configurar el recurso IP para el grupo de disponibilidad](#congroup).</span><span class="sxs-lookup"><span data-stu-id="49279-324">[Configure the IP resource for the availability group](#congroup).</span></span>

   >[!IMPORTANT]
   ><span data-ttu-id="49279-325">Cuando cree la dirección IP, use la dirección IP que agregó al equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="49279-325">When you create the IP address, use the IP address that you added to the load balancer.</span></span>  

4. <span data-ttu-id="49279-326">[Haga que el recurso del grupo de disponibilidad de SQL Server dependa del punto de acceso cliente](#dependencyGroup).</span><span class="sxs-lookup"><span data-stu-id="49279-326">[Make the SQL Server availability group resource dependent on the client access point](#dependencyGroup).</span></span>

5. <span data-ttu-id="49279-327">[Hacer que el recurso de punto de acceso cliente dependa de la dirección IP](#listname).</span><span class="sxs-lookup"><span data-stu-id="49279-327">[Make the client access point resource dependent on the IP address](#listname).</span></span>
 
6. <span data-ttu-id="49279-328">[Establezca los parámetros de clúster en PowerShell](#setparam).</span><span class="sxs-lookup"><span data-stu-id="49279-328">[Set the cluster parameters in PowerShell](#setparam).</span></span>

<span data-ttu-id="49279-329">Después de configurar el grupo de disponibilidad para usar la nueva dirección IP, configure la conexión al agente de escucha.</span><span class="sxs-lookup"><span data-stu-id="49279-329">After you configure the availability group to use the new IP address, configure the connection to the listener.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="49279-330">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="49279-330">Next steps</span></span>

- [<span data-ttu-id="49279-331">Configuración de un grupo de disponibilidad de SQL Server AlwaysOn en Azure Virtual Machines en regiones distintas</span><span class="sxs-lookup"><span data-stu-id="49279-331">Configure a SQL Server Always On availability group on Azure virtual machines in different regions</span></span>](virtual-machines-windows-portal-sql-availability-group-dr.md)

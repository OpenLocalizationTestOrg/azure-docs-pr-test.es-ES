---
title: "Recuperación ante desastres de grupos de disponibilidad de servidor - máquinas virtuales de Azure - aaaSQL | Documentos de Microsoft"
description: "Este artículo explica cómo agrupar tooconfigure una disponibilidad de SQL Server en máquinas virtuales de Azure con una réplica en una región distinta."
services: virtual-machines
documentationCenter: na
authors: MikeRayMSFT
manager: jhubbard
editor: monicar
tags: azure-service-management
ms.assetid: 388c464e-a16e-4c9d-a0d5-bb7cf5974689
ms.service: virtual-machines-sql
ms.devlang: na
ms.custom: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 05/02/2017
ms.author: mikeray
ms.openlocfilehash: df6238dc61c5a56879c75c9bf7314c618f43c0ce
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="configure-an-always-on-availability-group-on-azure-virtual-machines-in-different-regions"></a><span data-ttu-id="b4ec3-103">Configuración de un grupo de disponibilidad AlwaysOn en máquinas virtuales de Azure en distintas regiones</span><span class="sxs-lookup"><span data-stu-id="b4ec3-103">Configure an Always On availability group on Azure virtual machines in different regions</span></span>

<span data-ttu-id="b4ec3-104">Este artículo explica cómo tooconfigure una disponibilidad de SQL Server Always On grupo réplica en máquinas virtuales de Azure en una ubicación remota de Azure.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-104">This article explains how tooconfigure a SQL Server Always On availability group replica on Azure virtual machines in a remote Azure location.</span></span> <span data-ttu-id="b4ec3-105">Use esta recuperación ante desastres de toosupport de configuración.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-105">Use this configuration toosupport disaster recovery.</span></span>

<span data-ttu-id="b4ec3-106">En este artículo se aplica tooAzure máquinas virtuales en modo de administrador de recursos.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-106">This article applies tooAzure Virtual Machines in Resource Manager mode.</span></span>

<span data-ttu-id="b4ec3-107">Hello siguiente imagen muestra una implementación común de un grupo de disponibilidad en máquinas virtuales de Azure:</span><span class="sxs-lookup"><span data-stu-id="b4ec3-107">hello following image shows a common deployment of an availability group on Azure virtual machines:</span></span>

   ![Grupo de disponibilidad](./media/virtual-machines-windows-portal-sql-availability-group-dr/00-availability-group-basic.png)

<span data-ttu-id="b4ec3-109">En esta implementación, todas las máquinas virtuales se encuentran en una única región de Azure.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-109">In this deployment, all virtual machines are in one Azure region.</span></span> <span data-ttu-id="b4ec3-110">réplicas de grupo de disponibilidad de Hello pueden tener confirmación sincrónica con conmutación automática por error en SQL-1 y 2 de SQL.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-110">hello availability group replicas can have synchronous commit with automatic failover on SQL-1 and SQL-2.</span></span> <span data-ttu-id="b4ec3-111">toobuild esta arquitectura, consulte [plantilla de grupo de disponibilidad o tutorial](virtual-machines-windows-portal-sql-availability-group-overview.md).</span><span class="sxs-lookup"><span data-stu-id="b4ec3-111">toobuild this architecture, see [Availability Group template or tutorial](virtual-machines-windows-portal-sql-availability-group-overview.md).</span></span>

<span data-ttu-id="b4ec3-112">Esta arquitectura es vulnerable toodowntime si Hola región de Azure deja de estar accesible.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-112">This architecture is vulnerable toodowntime if hello Azure region becomes inaccessible.</span></span> <span data-ttu-id="b4ec3-113">tooovercome esta vulnerabilidad, agregar una réplica en una región distinta de Azure.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-113">tooovercome this vulnerability, add a replica in a different Azure region.</span></span> <span data-ttu-id="b4ec3-114">Hello diagrama siguiente muestra el aspecto que tendría nueva arquitectura de hello:</span><span class="sxs-lookup"><span data-stu-id="b4ec3-114">hello following diagram shows how hello new architecture would look:</span></span>

   ![Recuperación ante desastres de grupo de disponibilidad](./media/virtual-machines-windows-portal-sql-availability-group-dr/00-availability-group-basic-dr.png)

<span data-ttu-id="b4ec3-116">Hello diagrama anterior muestra una nueva máquina virtual denominada SQL-3.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-116">hello preceding diagram shows a new virtual machine called SQL-3.</span></span> <span data-ttu-id="b4ec3-117">SQL-3 está en una región distinta de Azure.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-117">SQL-3 is in a different Azure region.</span></span> <span data-ttu-id="b4ec3-118">SQL-3 se agrega toohello clúster de conmutación por error de Windows Server.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-118">SQL-3 is added toohello Windows Server Failover Cluster.</span></span> <span data-ttu-id="b4ec3-119">SQL-3 puede hospedar una réplica del grupo de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-119">SQL-3 can host an availability group replica.</span></span> <span data-ttu-id="b4ec3-120">Por último, tenga en cuenta que hello región de Azure para SQL-3 tiene un nuevo equilibrador de carga de Azure.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-120">Finally, notice that hello Azure region for SQL-3 has a new Azure load balancer.</span></span>

>[!NOTE]
> <span data-ttu-id="b4ec3-121">Un conjunto de disponibilidad de Azure es necesario cuando más de una máquina virtual se encuentra en Hola la misma región.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-121">An Azure availability set is required when more than one virtual machine is in hello same region.</span></span> <span data-ttu-id="b4ec3-122">Si sólo hay una máquina virtual en la región de hello, conjunto de disponibilidad de hello no es necesario.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-122">If only one virtual machine is in hello region, then hello availability set is not required.</span></span> <span data-ttu-id="b4ec3-123">Solo puede colocar una máquina virtual en un conjunto de disponibilidad en el momento de la creación.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-123">You can only place a virtual machine in an availability set at creation time.</span></span> <span data-ttu-id="b4ec3-124">Si la máquina virtual de hello ya está en un conjunto de disponibilidad, puede agregar una máquina virtual para una réplica adicional más adelante.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-124">If hello virtual machine is already in an availability set, you can add a virtual machine for an additional replica later.</span></span>

<span data-ttu-id="b4ec3-125">En esta arquitectura, réplica de hello en región remoto hello normalmente está configurada con el modo de disponibilidad de confirmación asincrónica y el modo de conmutación por error manual.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-125">In this architecture, hello replica in hello remote region is normally configured with asynchronous commit availability mode and manual failover mode.</span></span>

<span data-ttu-id="b4ec3-126">Una vez que las réplicas del grupo de disponibilidad están en Azure Virtual Machines en diferentes regiones de Azure, cada región necesita:</span><span class="sxs-lookup"><span data-stu-id="b4ec3-126">When availability group replicas are on Azure virtual machines in different Azure regions, each region requires:</span></span>

* <span data-ttu-id="b4ec3-127">Una puerta de enlace de red virtual</span><span class="sxs-lookup"><span data-stu-id="b4ec3-127">A virtual network gateway</span></span>
* <span data-ttu-id="b4ec3-128">Una conexión de una puerta de enlace de red virtual</span><span class="sxs-lookup"><span data-stu-id="b4ec3-128">A virtual network gateway connection</span></span>

<span data-ttu-id="b4ec3-129">Hello diagrama siguiente muestra cómo se comunican las redes Hola entre centros de datos.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-129">hello following diagram shows how hello networks communicate between data centers.</span></span>

   ![Grupo de disponibilidad](./media/virtual-machines-windows-portal-sql-availability-group-dr/01-vpngateway-example.png)

>[!IMPORTANT]
><span data-ttu-id="b4ec3-131">Esta arquitectura incurre en cargos por datos de salida para datos replicados entre regiones de Azure.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-131">This architecture incurs outbound data charges for data replicated between Azure regions.</span></span> <span data-ttu-id="b4ec3-132">Consulte [Detalles de precios de ancho de banda](http://azure.microsoft.com/pricing/details/bandwidth/).</span><span class="sxs-lookup"><span data-stu-id="b4ec3-132">See [Bandwidth Pricing](http://azure.microsoft.com/pricing/details/bandwidth/).</span></span>  

## <a name="create-remote-replica"></a><span data-ttu-id="b4ec3-133">Creación de réplica remota</span><span class="sxs-lookup"><span data-stu-id="b4ec3-133">Create remote replica</span></span>

<span data-ttu-id="b4ec3-134">Hola toocreate una réplica en un centro de datos remoto, lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="b4ec3-134">toocreate a replica in a remote data center, do hello following steps:</span></span>

1. <span data-ttu-id="b4ec3-135">[Crear una red virtual en la nueva región de hello](../../../virtual-network/virtual-networks-create-vnet-arm-pportal.md).</span><span class="sxs-lookup"><span data-stu-id="b4ec3-135">[Create a virtual network in hello new region](../../../virtual-network/virtual-networks-create-vnet-arm-pportal.md).</span></span>

1. <span data-ttu-id="b4ec3-136">[Configurar una conexión de red virtual a red virtual mediante Hola portal de Azure](../../../vpn-gateway/vpn-gateway-howto-vnet-vnet-resource-manager-portal.md).</span><span class="sxs-lookup"><span data-stu-id="b4ec3-136">[Configure a VNet-to-VNet connection using hello Azure portal](../../../vpn-gateway/vpn-gateway-howto-vnet-vnet-resource-manager-portal.md).</span></span>

   >[!NOTE]
   ><span data-ttu-id="b4ec3-137">En algunos casos, puede tener conexión de red virtual a red virtual de toouse PowerShell toocreate Hola.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-137">In some cases, you may have toouse PowerShell toocreate hello VNet-to-VNet connection.</span></span> <span data-ttu-id="b4ec3-138">Por ejemplo, si utiliza diferentes cuentas de Azure no puede configurar conexión de hello en el portal de Hola.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-138">For example, if you use different Azure accounts you cannot configure hello connection in hello portal.</span></span> <span data-ttu-id="b4ec3-139">Consulte en este caso, [configurar una red virtual a red de virtual de conexión mediante Hola portal de Azure](../../../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md).</span><span class="sxs-lookup"><span data-stu-id="b4ec3-139">In this case see, [Configure a VNet-to-VNet connection using hello Azure portal](../../../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md).</span></span>

1. <span data-ttu-id="b4ec3-140">[Crear un controlador de dominio en la nueva región de hello](../../../active-directory/active-directory-new-forest-virtual-machine.md).</span><span class="sxs-lookup"><span data-stu-id="b4ec3-140">[Create a domain controller in hello new region](../../../active-directory/active-directory-new-forest-virtual-machine.md).</span></span>

   <span data-ttu-id="b4ec3-141">Este controlador de dominio proporciona autenticación si el controlador de dominio de hello en el sitio primario de hello no está disponible.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-141">This domain controller provides authentication if hello domain controller in hello primary site is not available.</span></span>

1. <span data-ttu-id="b4ec3-142">[Crear una máquina virtual de SQL Server en la nueva región de hello](virtual-machines-windows-portal-sql-server-provision.md).</span><span class="sxs-lookup"><span data-stu-id="b4ec3-142">[Create a SQL Server virtual machine in hello new region](virtual-machines-windows-portal-sql-server-provision.md).</span></span>

1. <span data-ttu-id="b4ec3-143">[Cree un equilibrador de carga de Azure en red de hello en la nueva región de hello](virtual-machines-windows-portal-sql-availability-group-tutorial.md#configure-internal-load-balancer).</span><span class="sxs-lookup"><span data-stu-id="b4ec3-143">[Create an Azure load balancer in hello network on hello new region](virtual-machines-windows-portal-sql-availability-group-tutorial.md#configure-internal-load-balancer).</span></span>

   <span data-ttu-id="b4ec3-144">Este equilibrador de carga debe:</span><span class="sxs-lookup"><span data-stu-id="b4ec3-144">This load balancer must:</span></span>

   - <span data-ttu-id="b4ec3-145">Estar en Hola la misma red y subred como Hola nueva máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-145">Be in hello same network and subnet as hello new virtual machine.</span></span>
   - <span data-ttu-id="b4ec3-146">Tener una dirección IP estática para el agente de escucha del grupo de disponibilidad de Hola.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-146">Have a static IP address for hello availability group listener.</span></span>
   - <span data-ttu-id="b4ec3-147">Incluir un grupo back-end que consta de solo máquinas virtuales de hello en Hola misma región como Hola equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-147">Include a backend pool consisting of only hello virtual machines in hello same region as hello load balancer.</span></span>
   - <span data-ttu-id="b4ec3-148">Use una dirección IP de TCP puerto sondeo toohello específico.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-148">Use a TCP port probe specific toohello IP address.</span></span>
   - <span data-ttu-id="b4ec3-149">Tener una regla específica toohello SQL Server en Hola de equilibrio de carga misma región.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-149">Have a load balancing rule specific toohello SQL Server in hello same region.</span></span>  

1. <span data-ttu-id="b4ec3-150">[Agregar toohello de característica de agrupación en clústeres de conmutación por error nuevo SQL Server](virtual-machines-windows-portal-sql-availability-group-prereq.md#add-failover-clustering-features-to-both-sql-server-vms).</span><span class="sxs-lookup"><span data-stu-id="b4ec3-150">[Add Failover Clustering feature toohello new SQL Server](virtual-machines-windows-portal-sql-availability-group-prereq.md#add-failover-clustering-features-to-both-sql-server-vms).</span></span>

1. <span data-ttu-id="b4ec3-151">[Unirse a dominio de hello nuevo SQL Server toohello](virtual-machines-windows-portal-sql-availability-group-prereq.md#joinDomain).</span><span class="sxs-lookup"><span data-stu-id="b4ec3-151">[Join hello new SQL Server toohello domain](virtual-machines-windows-portal-sql-availability-group-prereq.md#joinDomain).</span></span>

1. <span data-ttu-id="b4ec3-152">[Establecer una cuenta de dominio de hello nuevo SQL Server service cuenta toouse](virtual-machines-windows-portal-sql-availability-group-prereq.md#setServiceAccount).</span><span class="sxs-lookup"><span data-stu-id="b4ec3-152">[Set hello new SQL Server service account toouse a domain account](virtual-machines-windows-portal-sql-availability-group-prereq.md#setServiceAccount).</span></span>

1. <span data-ttu-id="b4ec3-153">[Agregar toohello de SQL Server nuevo clúster de conmutación por error de Windows Server de hello](virtual-machines-windows-portal-sql-availability-group-tutorial.md#addNode).</span><span class="sxs-lookup"><span data-stu-id="b4ec3-153">[Add hello new SQL Server toohello Windows Server Failover Cluster](virtual-machines-windows-portal-sql-availability-group-tutorial.md#addNode).</span></span>

1. <span data-ttu-id="b4ec3-154">Crear un recurso de dirección IP en clúster de Hola.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-154">Create an IP address resource on hello cluster.</span></span>

   <span data-ttu-id="b4ec3-155">Puede crear el recurso de dirección IP de hello en el Administrador de clústeres de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-155">You can create hello IP address resource in Failover Cluster Manager.</span></span> <span data-ttu-id="b4ec3-156">Haga clic en función de grupo de disponibilidad de hello, haga clic en **Agregar recurso**, **más recursos**y haga clic en **dirección IP**.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-156">Right-click hello availability group role, click **Add Resource**, **More Resources**, and click **IP Address**.</span></span>

   ![Crear dirección IP](./media/virtual-machines-windows-portal-sql-availability-group-dr/20-add-ip-resource.png)

   <span data-ttu-id="b4ec3-158">Configure esta dirección IP de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="b4ec3-158">Configure this IP address as follows:</span></span>

   - <span data-ttu-id="b4ec3-159">Usar la red de Hola desde el centro de datos remotos de Hola.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-159">Use hello network from hello remote data center.</span></span>
   - <span data-ttu-id="b4ec3-160">Asignar dirección IP de Hola Hola nuevo Azure equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-160">Assign hello IP address from hello new Azure load balancer.</span></span> 

1. <span data-ttu-id="b4ec3-161">En Hola nuevo SQL Server en el Administrador de configuración de SQL Server, [habilitar grupos de disponibilidad AlwaysOn](http://msdn.microsoft.com/library/ff878259.aspx).</span><span class="sxs-lookup"><span data-stu-id="b4ec3-161">On hello new SQL Server in SQL Server Configuration Manager, [enable Always On Availability Groups](http://msdn.microsoft.com/library/ff878259.aspx).</span></span>

1. <span data-ttu-id="b4ec3-162">[Puertos de firewall abiertos en Hola nuevo SQL Server](virtual-machines-windows-portal-sql-availability-group-prereq.md#endpoint-firewall).</span><span class="sxs-lookup"><span data-stu-id="b4ec3-162">[Open firewall ports on hello new SQL Server](virtual-machines-windows-portal-sql-availability-group-prereq.md#endpoint-firewall).</span></span>

   <span data-ttu-id="b4ec3-163">números de puerto de Hello necesita tooopen dependerán del entorno.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-163">hello port numbers you need tooopen depend on your environment.</span></span> <span data-ttu-id="b4ec3-164">Puertos abiertos para hello Azure y punto de conexión de creación de reflejo de carga sondeo del equilibrador de mantenimiento.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-164">Open ports for hello mirroring endpoint and Azure load balancer health probe.</span></span>

1. <span data-ttu-id="b4ec3-165">[Agregar un grupo de disponibilidad de réplica toohello en hello nuevo SQL Server](http://msdn.microsoft.com/library/hh213239.aspx).</span><span class="sxs-lookup"><span data-stu-id="b4ec3-165">[Add a replica toohello availability group on hello new SQL Server](http://msdn.microsoft.com/library/hh213239.aspx).</span></span>

   <span data-ttu-id="b4ec3-166">Para una réplica en una región remota de Azure, establézcala en replicación asincrónica con conmutación por error manual.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-166">For a replica in a remote Azure region, set it for asynchronous replication with manual failover.</span></span>  

1. <span data-ttu-id="b4ec3-167">Agregar recurso de dirección IP de hello como dependencia para el clúster de hello escucha cliente acceso punto (nombre de red).</span><span class="sxs-lookup"><span data-stu-id="b4ec3-167">Add hello IP address resource as a dependency for hello listener client access point (network name) cluster.</span></span>

   <span data-ttu-id="b4ec3-168">Hello captura de pantalla siguiente muestra un recurso de clúster de dirección IP configurado correctamente:</span><span class="sxs-lookup"><span data-stu-id="b4ec3-168">hello following screenshot shows a properly configured IP address cluster resource:</span></span>

   ![Grupo de disponibilidad](./media/virtual-machines-windows-portal-sql-availability-group-dr/50-configure-dependency-multiple-ip.png)

   >[!IMPORTANT]
   ><span data-ttu-id="b4ec3-170">grupo de recursos de clúster de Hello incluye ambas direcciones IP.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-170">hello cluster resource group includes both IP addresses.</span></span> <span data-ttu-id="b4ec3-171">Ambas direcciones IP son las dependencias de punto de acceso de cliente de agente de escucha de Hola.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-171">Both IP addresses are dependencies for hello listener client access point.</span></span> <span data-ttu-id="b4ec3-172">Hola de uso **o** operador en la configuración de dependencia de clúster de Hola.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-172">Use hello **OR** operator in hello cluster dependency configuration.</span></span>

1. <span data-ttu-id="b4ec3-173">[Establecer parámetros de clúster de hello en PowerShell](virtual-machines-windows-portal-sql-availability-group-tutorial.md#setparam).</span><span class="sxs-lookup"><span data-stu-id="b4ec3-173">[Set hello cluster parameters in PowerShell](virtual-machines-windows-portal-sql-availability-group-tutorial.md#setparam).</span></span>

<span data-ttu-id="b4ec3-174">Ejecutar script de PowerShell de hello con el nombre de red del clúster de hello, dirección IP y puerto de sondeo que configuró en el equilibrador de carga de hello en nueva región de Hola.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-174">Run hello PowerShell script with hello cluster network name, IP address, and probe port that you configured on hello load balancer in hello new region.</span></span>

   ```PowerShell
   $ClusterNetworkName = "<MyClusterNetworkName>" # hello cluster name for hello network in hello new region (Use Get-ClusterNetwork on Windows Server 2012 of higher toofind hello name).
   $IPResourceName = "<IPResourceName>" # hello cluster name for hello new IP Address resource.
   $ILBIP = “<n.n.n.n>” # hello IP Address of hello Internal Load Balancer (ILB) in hello new region. This is hello static IP address for hello load balancer you configured in hello Azure portal.
   [int]$ProbePort = <nnnnn> # hello probe port you set on hello ILB.

   Import-Module FailoverClusters

   Get-ClusterResource $IPResourceName | Set-ClusterParameter -Multiple @{"Address"="$ILBIP";"ProbePort"=$ProbePort;"SubnetMask"="255.255.255.255";"Network"="$ClusterNetworkName";"EnableDhcp"=0}
   ```

## <a name="set-connection-for-multiple-subnets"></a><span data-ttu-id="b4ec3-175">Configuración de conexión para varias subredes</span><span class="sxs-lookup"><span data-stu-id="b4ec3-175">Set connection for multiple subnets</span></span>

<span data-ttu-id="b4ec3-176">réplica de Hello en el centro de datos remoto hello forma parte del grupo de disponibilidad de Hola pero está en una subred diferente.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-176">hello replica in hello remote data center is part of hello availability group but it is in a different subnet.</span></span> <span data-ttu-id="b4ec3-177">Si esta réplica se convierte en la réplica principal de hello, pueden producirse los tiempos de espera de conexión de aplicación.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-177">If this replica becomes hello primary replica, application connection time-outs may occur.</span></span> <span data-ttu-id="b4ec3-178">Este comportamiento es Hola igual que un grupo de disponibilidad local en una implementación de varias subredes.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-178">This behavior is hello same as an on-premises availability group in a multi-subnet deployment.</span></span> <span data-ttu-id="b4ec3-179">tooallow conexiones desde aplicaciones de cliente, actualice la conexión de cliente de Hola o configurar la resolución de nombres de almacenamiento en caché en el recurso de nombre de red de clústeres de Hola.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-179">tooallow connections from client applications, either update hello client connection or configure name resolution caching on hello cluster network name resource.</span></span>

<span data-ttu-id="b4ec3-180">Si es posible, actualice tooset de cadenas de conexión de cliente hello `MultiSubnetFailover=Yes`.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-180">Preferably, update hello client connection strings tooset `MultiSubnetFailover=Yes`.</span></span> <span data-ttu-id="b4ec3-181">Consulte [Conectarse a MultiSubnetFailover](http://msdn.microsoft.com/library/gg471494#Anchor_0).</span><span class="sxs-lookup"><span data-stu-id="b4ec3-181">See [Connecting With MultiSubnetFailover](http://msdn.microsoft.com/library/gg471494#Anchor_0).</span></span>

<span data-ttu-id="b4ec3-182">Si no se puede modificar las cadenas de conexión de hello, puede configurar la caché de resolución de nombres.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-182">If you cannot modify hello connection strings, you can configure name resolution caching.</span></span> <span data-ttu-id="b4ec3-183">Consulte [Connection Timeouts in Multi-subnet Availability Group](http://blogs.msdn.microsoft.com/alwaysonpro/2014/06/03/connection-timeouts-in-multi-subnet-availability-group/) (Tiempos de espera de conexión en un grupo de disponibilidad con varias subredes).</span><span class="sxs-lookup"><span data-stu-id="b4ec3-183">See [Connection Timeouts in Multi-subnet Availability Group](http://blogs.msdn.microsoft.com/alwaysonpro/2014/06/03/connection-timeouts-in-multi-subnet-availability-group/).</span></span>

## <a name="fail-over-tooremote-region"></a><span data-ttu-id="b4ec3-184">Conmutar por error tooremote región</span><span class="sxs-lookup"><span data-stu-id="b4ec3-184">Fail over tooremote region</span></span>

<span data-ttu-id="b4ec3-185">tootest del agente de escucha conectividad toohello remoto región puede conmutar por región remota de hello réplica toohello.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-185">tootest listener connectivity toohello remote region, you can fail over hello replica toohello remote region.</span></span> <span data-ttu-id="b4ec3-186">Aunque réplica hello es asincrónica, conmutación por error es vulnerable toopotential pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-186">While hello replica is asynchronous, failover is vulnerable toopotential data loss.</span></span> <span data-ttu-id="b4ec3-187">toofail sobre sin pérdida de datos, cambiar toosynchronous de modo de disponibilidad de Hola y establecer tooautomatic de modo de conmutación por error de Hola.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-187">toofail over without data loss, change hello availability mode toosynchronous and set hello failover mode tooautomatic.</span></span> <span data-ttu-id="b4ec3-188">Usar hello pasos:</span><span class="sxs-lookup"><span data-stu-id="b4ec3-188">Use hello following steps:</span></span>

1. <span data-ttu-id="b4ec3-189">En **Explorador de objetos**, conectar toohello instancia de SQL Server que hospeda la réplica principal de Hola.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-189">In **Object Explorer**, connect toohello instance of SQL Server that hosts hello primary replica.</span></span>
1. <span data-ttu-id="b4ec3-190">En **Grupos de disponibilidad de AlwaysOn**, **Grupos de disponibilidad**, haga clic con el botón derecho en el grupo de disponibilidad y haga clic en **Propiedades**.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-190">Under **AlwaysOn Availability Groups**, **Availability Groups**, right-click your availability group and click **Properties**.</span></span>
1. <span data-ttu-id="b4ec3-191">En hello **General** página, en **réplicas de disponibilidad**, conjunto Hola réplica secundaria en toouse de sitio de recuperación ante desastres de hello **confirmación sincrónica** modo de disponibilidad y **Automática** modo de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-191">On hello **General** page, under **Availability Replicas**, set hello secondary replica in hello DR site toouse **Synchronous Commit** availability mode and **Automatic** failover mode.</span></span>
1. <span data-ttu-id="b4ec3-192">Si tiene una réplica secundaria en el mismo sitio que la réplica principal para alta disponibilidad, establezca esta réplica demasiado**confirmación asincrónica** y **Manual**.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-192">If you have a secondary replica in same site as your primary replica for high availability, set this replica too**Asynchronous Commit** and **Manual**.</span></span>
1. <span data-ttu-id="b4ec3-193">Haga clic en Aceptar.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-193">Click OK.</span></span>
1. <span data-ttu-id="b4ec3-194">En **Explorador de objetos**, haga clic en grupo de disponibilidad de Hola y haga clic en **Mostrar panel**.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-194">In **Object Explorer**, right-click hello availability group, and click **Show Dashboard**.</span></span>
1. <span data-ttu-id="b4ec3-195">En el panel de hello, compruebe que Hola se sincronice la réplica en el sitio de recuperación ante desastres de Hola.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-195">On hello dashboard, verify that hello replica on hello DR site is synchronized.</span></span>
1. <span data-ttu-id="b4ec3-196">En **Explorador de objetos**, haga clic en grupo de disponibilidad de Hola y haga clic en **conmutación por error...** . Estudios de administración de SQL Server se abre un asistente toofail sobre SQL Server.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-196">In **Object Explorer**, right-click hello availability group, and click **Failover...**. SQL Server Management Studios opens a wizard toofail over SQL Server.</span></span>  
1. <span data-ttu-id="b4ec3-197">Haga clic en **siguiente**y seleccione Hola instancia de SQL Server en el sitio de recuperación ante desastres de Hola.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-197">Click **Next**, and select hello SQL Server instance in hello DR site.</span></span> <span data-ttu-id="b4ec3-198">Haga clic en **Siguiente** de nuevo.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-198">Click **Next** again.</span></span>
1. <span data-ttu-id="b4ec3-199">Conectar toohello de instancia de SQL Server en el sitio de recuperación ante desastres de Hola y haga clic en **siguiente**.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-199">Connect toohello SQL Server instance in hello DR site and click **Next**.</span></span>
1. <span data-ttu-id="b4ec3-200">En hello **resumen** página, compruebe la configuración de Hola y haga clic en **finalizar**.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-200">On hello **Summary** page, verify hello settings and click **Finish**.</span></span>

<span data-ttu-id="b4ec3-201">Después de probar la conectividad, mover los datos principal de tooyour atrás de réplica principal de hello del centro y establecer modo de disponibilidad hello tootheir back-configuración de funcionamiento normal.</span><span class="sxs-lookup"><span data-stu-id="b4ec3-201">After testing connectivity, move hello primary replica back tooyour primary data center and set hello availability mode back tootheir normal operating settings.</span></span> <span data-ttu-id="b4ec3-202">Hello tabla siguiente muestra valores operativa normal de Hola para arquitectura de hello descrita en este documento:</span><span class="sxs-lookup"><span data-stu-id="b4ec3-202">hello following table shows hello normal operational settings for hello architecture described in this document:</span></span>

| <span data-ttu-id="b4ec3-203">Ubicación</span><span class="sxs-lookup"><span data-stu-id="b4ec3-203">Location</span></span> | <span data-ttu-id="b4ec3-204">Instancia del servidor</span><span class="sxs-lookup"><span data-stu-id="b4ec3-204">Server Instance</span></span> | <span data-ttu-id="b4ec3-205">Rol</span><span class="sxs-lookup"><span data-stu-id="b4ec3-205">Role</span></span> | <span data-ttu-id="b4ec3-206">Modo de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="b4ec3-206">Availability Mode</span></span> | <span data-ttu-id="b4ec3-207">Modo de conmutación por error</span><span class="sxs-lookup"><span data-stu-id="b4ec3-207">Failover Mode</span></span>
| ----- | ----- | ----- | ----- | -----
| <span data-ttu-id="b4ec3-208">Centro de datos principal</span><span class="sxs-lookup"><span data-stu-id="b4ec3-208">Primary data center</span></span> | <span data-ttu-id="b4ec3-209">SQL-1</span><span class="sxs-lookup"><span data-stu-id="b4ec3-209">SQL-1</span></span> | <span data-ttu-id="b4ec3-210">Principal</span><span class="sxs-lookup"><span data-stu-id="b4ec3-210">Primary</span></span> | <span data-ttu-id="b4ec3-211">Sincrónico</span><span class="sxs-lookup"><span data-stu-id="b4ec3-211">Synchronous</span></span> | <span data-ttu-id="b4ec3-212">Automático</span><span class="sxs-lookup"><span data-stu-id="b4ec3-212">Automatic</span></span>
| <span data-ttu-id="b4ec3-213">Centro de datos principal</span><span class="sxs-lookup"><span data-stu-id="b4ec3-213">Primary data center</span></span> | <span data-ttu-id="b4ec3-214">SQL-2</span><span class="sxs-lookup"><span data-stu-id="b4ec3-214">SQL-2</span></span> | <span data-ttu-id="b4ec3-215">Secundario</span><span class="sxs-lookup"><span data-stu-id="b4ec3-215">Secondary</span></span> | <span data-ttu-id="b4ec3-216">Sincrónico</span><span class="sxs-lookup"><span data-stu-id="b4ec3-216">Synchronous</span></span> | <span data-ttu-id="b4ec3-217">Automático</span><span class="sxs-lookup"><span data-stu-id="b4ec3-217">Automatic</span></span>
| <span data-ttu-id="b4ec3-218">Centro de datos secundario o remoto</span><span class="sxs-lookup"><span data-stu-id="b4ec3-218">Secondary or remote data center</span></span> | <span data-ttu-id="b4ec3-219">SQL-3</span><span class="sxs-lookup"><span data-stu-id="b4ec3-219">SQL-3</span></span> | <span data-ttu-id="b4ec3-220">Secundario</span><span class="sxs-lookup"><span data-stu-id="b4ec3-220">Secondary</span></span> | <span data-ttu-id="b4ec3-221">Asincrónico</span><span class="sxs-lookup"><span data-stu-id="b4ec3-221">Asynchronous</span></span> | <span data-ttu-id="b4ec3-222">Manual</span><span class="sxs-lookup"><span data-stu-id="b4ec3-222">Manual</span></span>


### <a name="more-information-about-planned-and-forced-manual-failover"></a><span data-ttu-id="b4ec3-223">Más información acerca de la conmutación por error manual planeada y forzada</span><span class="sxs-lookup"><span data-stu-id="b4ec3-223">More information about planned and forced manual failover</span></span>

<span data-ttu-id="b4ec3-224">Para obtener más información, vea Hola temas siguientes:</span><span class="sxs-lookup"><span data-stu-id="b4ec3-224">For more information, see hello following topics:</span></span>

- [<span data-ttu-id="b4ec3-225">Realizar una conmutación por error manual planeada de un grupo de disponibilidad (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="b4ec3-225">Perform a Planned Manual Failover of an Availability Group (SQL Server)</span></span>](http://msdn.microsoft.com/library/hh231018.aspx)
- [<span data-ttu-id="b4ec3-226">Realizar una conmutación por error manual forzada de un grupo de disponibilidad (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="b4ec3-226">Perform a Forced Manual Failover of an Availability Group (SQL Server)</span></span>](http://msdn.microsoft.com/library/ff877957.aspx)

## <a name="additional-links"></a><span data-ttu-id="b4ec3-227">Vínculos adicionales</span><span class="sxs-lookup"><span data-stu-id="b4ec3-227">Additional Links</span></span>

* [<span data-ttu-id="b4ec3-228">Grupos de disponibilidad AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="b4ec3-228">Always On Availability Groups</span></span>](http://msdn.microsoft.com/library/hh510230.aspx)
* [<span data-ttu-id="b4ec3-229">Máquinas virtuales de Azure</span><span class="sxs-lookup"><span data-stu-id="b4ec3-229">Azure Virtual Machines</span></span>](http://docs.microsoft.com/azure/virtual-machines/windows/)
* [<span data-ttu-id="b4ec3-230">Equilibradores de carga de Azure</span><span class="sxs-lookup"><span data-stu-id="b4ec3-230">Azure Load Balancers</span></span>](virtual-machines-windows-portal-sql-availability-group-tutorial.md#configure-internal-load-balancer)
* [<span data-ttu-id="b4ec3-231">Conjuntos de disponibilidad de Azure</span><span class="sxs-lookup"><span data-stu-id="b4ec3-231">Azure Availability Sets</span></span>](../manage-availability.md)

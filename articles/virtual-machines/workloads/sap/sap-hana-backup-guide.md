---
title: "Guía de copia de seguridad de SAP HANA en Azure Virtual Machines | Microsoft Azure"
description: "Guía de copia de seguridad para SAP HANA proporciona dos posibilidades de copia de seguridad principales para SAP HANA en Azure Virtual Machines"
services: virtual-machines-linux
documentationcenter: 
author: hermanndms
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 3/13/2017
ms.author: rclaus
ms.openlocfilehash: 9e5b124643b753f404ba6012d3df998f567be59a
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/29/2017
---
# <a name="backup-guide-for-sap-hana-on-azure-virtual-machines"></a><span data-ttu-id="49c82-103">Guía de copia de seguridad de SAP HANA en Azure Virtual Machines</span><span class="sxs-lookup"><span data-stu-id="49c82-103">Backup guide for SAP HANA on Azure Virtual Machines</span></span>

## <a name="getting-started"></a><span data-ttu-id="49c82-104">Introducción</span><span class="sxs-lookup"><span data-stu-id="49c82-104">Getting Started</span></span>

<span data-ttu-id="49c82-105">La guía de copia de seguridad de SAP HANA en Azure Virtual Machines solo describirá temas específicos de Azure.</span><span class="sxs-lookup"><span data-stu-id="49c82-105">The backup guide for SAP HANA running on Azure virtual Machines will only describe Azure-specific topics.</span></span> <span data-ttu-id="49c82-106">Para elementos relacionados con la copia de seguridad de SAP HANA, consulte la documentación de SAP HANA (vea _Documentación de copia de seguridad de SAP HANA_ más adelante en este artículo).</span><span class="sxs-lookup"><span data-stu-id="49c82-106">For general SAP HANA backup related items, check the SAP HANA documentation (see _SAP HANA backup documentation_ later in this article).</span></span>

<span data-ttu-id="49c82-107">Este artículo se centra en las dos principales posibilidades de copia de seguridad para SAP HANA en Azure Virtual Machines:</span><span class="sxs-lookup"><span data-stu-id="49c82-107">The focus of this article is on two major backup possibilities for SAP HANA on Azure virtual machines:</span></span>

- <span data-ttu-id="49c82-108">Copia de seguridad de HANA en el sistema de archivos en Azure Linux Virtual Machine (vea [Azure Backup de SAP HANA en el nivel de archivo](sap-hana-backup-file-level.md))</span><span class="sxs-lookup"><span data-stu-id="49c82-108">HANA backup to the file system in an Azure Linux Virtual Machine (see [SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md))</span></span>
- <span data-ttu-id="49c82-109">Copia de seguridad de HANA basada en instantáneas de almacenamiento con la característica de instantáneas de Azure Storage Blob manualmente o el servicio Azure Backup (vea [Copia de seguridad de SAP HANA basada en instantáneas de almacenamiento](sap-hana-backup-storage-snapshots.md))</span><span class="sxs-lookup"><span data-stu-id="49c82-109">HANA backup based on storage snapshots using the Azure storage blob snapshot feature manually or Azure Backup Service (see [SAP HANA backup based on storage snapshots](sap-hana-backup-storage-snapshots.md))</span></span>

<span data-ttu-id="49c82-110">SAP HANA ofrece una API de copia de seguridad, que permite que las herramientas de copia de seguridad de terceros se integren directamente con SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="49c82-110">SAP HANA offers a backup API, which allows third-party backup tools to integrate directly with SAP HANA.</span></span> <span data-ttu-id="49c82-111">(Esto no está dentro del ámbito de esta guía). No hay ninguna integración directa de SAP HANA con el servicio Azure Backup disponible actualmente basada en esta API.</span><span class="sxs-lookup"><span data-stu-id="49c82-111">(That is not within the scope of this guide.) There is no direct integration of SAP HANA with Azure Backup service available right now based on this API.</span></span>

<span data-ttu-id="49c82-112">SAP HANA es compatible oficialmente con máquinas virtuales de Azure tipo GS5 como instancia única con una restricción adicional para las cargas de trabajo OLAP (vea [Buscar plataformas de IaaS certificadas](https://global.sap.com/community/ebook/2014-09-02-hana-hardware/enEN/iaas.html) en el sitio web de SAP).</span><span class="sxs-lookup"><span data-stu-id="49c82-112">SAP HANA is officially supported on Azure VM type GS5 as single instance with an additional restriction to OLAP workloads (see [Find Certified IaaS Platforms](https://global.sap.com/community/ebook/2014-09-02-hana-hardware/enEN/iaas.html) on the SAP website).</span></span> <span data-ttu-id="49c82-113">En este artículo se actualizará a medida que estén disponibles nuevas ofertas para SAP HANA en Azure.</span><span class="sxs-lookup"><span data-stu-id="49c82-113">This article will be updated as new offerings for SAP HANA on Azure become available.</span></span>

<span data-ttu-id="49c82-114">También hay una solución híbrida de SAP HANA en Azure, donde SAP HANA ejecuta elementos no virtualizados en servidores físicos.</span><span class="sxs-lookup"><span data-stu-id="49c82-114">There is also an SAP HANA hybrid solution available on Azure, where SAP HANA runs non-virtualized on physical servers.</span></span> <span data-ttu-id="49c82-115">Sin embargo, esta guía de Azure Backup para SAP HANA cubre un entorno puro de Azure donde se ejecuta SAP HANA en una máquina virtual de Azure, no SAP HANA en &quot;instancias de gran tamaño.&quot; Vea [Introducción y arquitectura de SAP HANA en Azure (instancias grandes)](hana-overview-architecture.md) para obtener más información sobre esta solución de copia de seguridad en &quot;instancias grandes&quot; basada en instantáneas de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="49c82-115">However, this SAP HANA Azure backup guide covers a pure Azure environment where SAP HANA runs in an Azure VM, not SAP HANA running on &quot;large instances.&quot; See [SAP HANA (large instances) overview and architecture on Azure](hana-overview-architecture.md) for more information about this backup solution on &quot;large instances&quot; based on storage snapshots.</span></span>

<span data-ttu-id="49c82-116">Puede obtener información general sobre productos SAP admitidos en Azure en la [nota 1928533 de SAP](https://launchpad.support.sap.com/#/notes/1928533).</span><span class="sxs-lookup"><span data-stu-id="49c82-116">General information about SAP products supported on Azure can be found in [SAP Note 1928533](https://launchpad.support.sap.com/#/notes/1928533).</span></span>

<span data-ttu-id="49c82-117">Las siguientes tres cifras ofrecen una visión general de las opciones de copia de seguridad de SAP HANA mediante las funcionalidades nativas de Azure actualmente, y también muestran tres escenarios posibles de copia de seguridad futuras.</span><span class="sxs-lookup"><span data-stu-id="49c82-117">The following three figures give an overview of the SAP HANA backup options using native Azure capabilities currently, and also show three potential future backup scenarios.</span></span> <span data-ttu-id="49c82-118">Los artículos relacionados [Copia de seguridad de SAP HANA basada en instantáneas de almacenamiento](sap-hana-backup-file-level.md) y [Azure Backup de SAP HANA en el nivel de archivo](sap-hana-backup-storage-snapshots.md) describen estas opciones con más detalle, incluidas las consideraciones de tamaño y rendimiento para copias de seguridad de SAP HANA con un tamaño de varios terabytes.</span><span class="sxs-lookup"><span data-stu-id="49c82-118">The related articles [SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md) and [SAP HANA backup based on storage snapshots](sap-hana-backup-storage-snapshots.md) describe these options in more detail, including size and performance considerations for SAP HANA backups that are multi-terabytes in size.</span></span>

![Esta ilustración muestra dos posibilidades para guardar el estado actual de la VM](media/sap-hana-backup-guide/image001.png)

<span data-ttu-id="49c82-120">Esta ilustración muestra la posibilidad de guardar el estado actual de la VM, ya sea a través del servicio Azure Backup o la instantánea manual de los discos de VM.</span><span class="sxs-lookup"><span data-stu-id="49c82-120">This figure shows the possibility of saving the current VM state, either via Azure Backup service or manual snapshot of VM disks.</span></span> <span data-ttu-id="49c82-121">Con este enfoque, no tiene que administrar las copias de seguridad de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="49c82-121">With this approach, one doesn&#39;t have to manage SAP HANA backups.</span></span> <span data-ttu-id="49c82-122">El desafío del escenario de instantáneas de disco es la coherencia del sistema de archivos y un estado del disco coherente con la aplicación.</span><span class="sxs-lookup"><span data-stu-id="49c82-122">The challenge of the disk snapshot scenario is file system consistency, and an application-consistent disk state.</span></span> <span data-ttu-id="49c82-123">El tema de la coherencia se describe en la sección _Coherencia de datos de SAP HANA al tomar instantáneas de almacenamiento_ más adelante en este artículo.</span><span class="sxs-lookup"><span data-stu-id="49c82-123">The consistency topic is discussed in the section _SAP HANA data consistency when taking storage snapshots_ later in this article.</span></span> <span data-ttu-id="49c82-124">Las funcionalidades y restricciones del servicio Azure Backup relacionadas con las copias de seguridad de SAP HANA también se tratarán más tarde en este artículo.</span><span class="sxs-lookup"><span data-stu-id="49c82-124">Capabilities and restrictions of Azure Backup service related to SAP HANA backups are also discussed later in this article.</span></span>

![Esta ilustración muestra opciones para realizar una copia de seguridad de archivos de SAP HANA dentro de la VM](media/sap-hana-backup-guide/image002.png)

<span data-ttu-id="49c82-126">Esta ilustración muestra opciones para realizar una copia de seguridad de archivos de SAP HANA dentro de la VM y luego almacenar los archivos de copia de seguridad de HANA en otro lugar mediante herramientas distintas.</span><span class="sxs-lookup"><span data-stu-id="49c82-126">This figure shows options for taking an SAP HANA file backup inside the VM, and then storing it HANA backup files somewhere else using different tools.</span></span> <span data-ttu-id="49c82-127">La realización de una copia de seguridad de HANA requiere más tiempo que una solución de copia de seguridad basada en instantáneas, pero tiene ventajas con respecto a la integridad y la coherencia.</span><span class="sxs-lookup"><span data-stu-id="49c82-127">Taking a HANA backup requires more time than a snapshot-based backup solution, but it has advantages regarding integrity and consistency.</span></span> <span data-ttu-id="49c82-128">Se proporcionarán más detalles más tarde en este artículo.</span><span class="sxs-lookup"><span data-stu-id="49c82-128">More details are provided later in this article.</span></span>

![Esta ilustración muestra un posible escenario futuro de copia de seguridad de SAP HANA](media/sap-hana-backup-guide/image003.png)

<span data-ttu-id="49c82-130">Esta ilustración muestra un posible escenario futuro de copia de seguridad de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="49c82-130">This figure shows a potential future SAP HANA backup scenario.</span></span> <span data-ttu-id="49c82-131">Si SAP HANA permitió realizar copias de seguridad desde una replicación secundaria, agregaría opciones adicionales para las estrategias de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="49c82-131">If SAP HANA allowed taking backups from a replication secondary, it would add additional options for backup strategies.</span></span> <span data-ttu-id="49c82-132">Actualmente no es posible según una entrada en el sitio wiki de SAP HANA:</span><span class="sxs-lookup"><span data-stu-id="49c82-132">Currently it isn't possible according to a post in the SAP HANA Wiki:</span></span>

<span data-ttu-id="49c82-133">_&quot;¿Es posible realizar copias de seguridad en el lado secundario?_</span><span class="sxs-lookup"><span data-stu-id="49c82-133">_&quot;Is it possible to take backups on the secondary side?_</span></span>

<span data-ttu-id="49c82-134">_No, actualmente solo puede tomar copias de seguridad de registros y datos en el lado principal. Si está habilitada la copia de seguridad de registro automática, después de la adquisición en el lado secundario, las copias de seguridad del registro se escribirán automáticamente ahí.&quot;_</span><span class="sxs-lookup"><span data-stu-id="49c82-134">_No, currently you can only take data and log backups on the primary side. If automatic log backup is enabled, after takeover to the secondary side, the log backups will automatically be written there.&quot;_</span></span>

## <a name="sap-resources-for-hana-backup"></a><span data-ttu-id="49c82-135">Recursos SAP para copia de seguridad de HANA</span><span class="sxs-lookup"><span data-stu-id="49c82-135">SAP resources for HANA backup</span></span>

### <a name="sap-hana-backup-documentation"></a><span data-ttu-id="49c82-136">Documentación de copia de seguridad de SAP HANA</span><span class="sxs-lookup"><span data-stu-id="49c82-136">SAP HANA backup documentation</span></span>

- [<span data-ttu-id="49c82-137">Introducción a la administración de SAP HANA</span><span class="sxs-lookup"><span data-stu-id="49c82-137">Introduction to SAP HANA Administration</span></span>](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.00/en-US)
- [<span data-ttu-id="49c82-138">Planeación de su estrategia de copia de seguridad y recuperación</span><span class="sxs-lookup"><span data-stu-id="49c82-138">Planning Your Backup and Recovery Strategy</span></span>](https://help.sap.com/saphelp_hanaplatform/helpdata/en/ef/085cd5949c40b788bba8fd3c65743e/content.htm)
- [<span data-ttu-id="49c82-139">Programación de la copia de seguridad de HANA mediante ABAP DBACOCKPIT</span><span class="sxs-lookup"><span data-stu-id="49c82-139">Schedule HANA Backup using ABAP DBACOCKPIT</span></span>](http://www.hanatutorials.com/p/schedule-hana-backup-using-abap.html)
- [<span data-ttu-id="49c82-140">Programación de copias de seguridad de datos (SAP HANA Cockpit)</span><span class="sxs-lookup"><span data-stu-id="49c82-140">Schedule Data Backups (SAP HANA Cockpit)</span></span>](http://help.sap.com/saphelp_hanaplatform/helpdata/en/6d/385fa14ef64a6bab2c97a3d3e40292/frameset.htm)
- <span data-ttu-id="49c82-141">Preguntas más frecuentes sobre la copia de seguridad de SAP HANA en la [nota 1642148 de SAP](https://launchpad.support.sap.com/#/notes/1642148)</span><span class="sxs-lookup"><span data-stu-id="49c82-141">FAQ about SAP HANA backup in [SAP Note 1642148](https://launchpad.support.sap.com/#/notes/1642148)</span></span>
- <span data-ttu-id="49c82-142">Preguntas más frecuentes sobre las instantáneas de base de datos y almacenamiento en la [nota 2039883 de SAP](https://launchpad.support.sap.com/#/notes/2039883)</span><span class="sxs-lookup"><span data-stu-id="49c82-142">FAQ about SAP HANA database and storage snapshots in [SAP Note 2039883](https://launchpad.support.sap.com/#/notes/2039883)</span></span>
- <span data-ttu-id="49c82-143">Sistemas de archivos de red no apropiados para la copia de seguridad y la recuperación en la [nota 1820529 de SAP](https://launchpad.support.sap.com/#/notes/1820529)</span><span class="sxs-lookup"><span data-stu-id="49c82-143">Unsuitable network file systems for backup and recovery in [SAP Note 1820529](https://launchpad.support.sap.com/#/notes/1820529)</span></span>

### <a name="why-sap-hana-backup"></a><span data-ttu-id="49c82-144">¿Por qué la copia de seguridad de SAP HANA?</span><span class="sxs-lookup"><span data-stu-id="49c82-144">Why SAP HANA backup?</span></span>

<span data-ttu-id="49c82-145">Azure Storage ofrece disponibilidad y fiabilidad desde el principio (vea [Introducción a Microsoft Azure Storage](../../../storage/common/storage-introduction.md) para obtener más información sobre Azure Storage).</span><span class="sxs-lookup"><span data-stu-id="49c82-145">Azure storage offers availability and reliability out of the box (see [Introduction to Microsoft Azure Storage](../../../storage/common/storage-introduction.md) for more information about Azure storage).</span></span>

<span data-ttu-id="49c82-146">Lo mínimo que puede hacer una &quot;copia de seguridad&quot; es confiar en los SLA de Azure y conservar los datos de SAP HANA y los archivos de registro en VHD de Azure asociados a la VM de servidor de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="49c82-146">The minimum for &quot;backup&quot; is to rely on the Azure SLAs, keeping the SAP HANA data and log files on Azure VHDs attached to the SAP HANA server VM.</span></span> <span data-ttu-id="49c82-147">Este enfoque trata los errores de VM, pero no los posibles daños en los archivos de registro y datos de SAP HANA, o errores lógicos como la eliminación de datos o archivos por accidente.</span><span class="sxs-lookup"><span data-stu-id="49c82-147">This approach covers VM failures, but not potential damage to the SAP HANA data and log files, or logical errors like deleting data or files by accident.</span></span> <span data-ttu-id="49c82-148">Las copias de seguridad también son necesarias para el cumplimiento o por motivos legales.</span><span class="sxs-lookup"><span data-stu-id="49c82-148">Backups are also required for compliance or legal reasons.</span></span> <span data-ttu-id="49c82-149">En resumen, las copias de seguridad de SAP HANA son siempre necesarias.</span><span class="sxs-lookup"><span data-stu-id="49c82-149">In short, there is always a need for SAP HANA backups.</span></span>

### <a name="how-to-verify-correctness-of-sap-hana-backup"></a><span data-ttu-id="49c82-150">Cómo comprobar la precisión de una copia de SAP HANA</span><span class="sxs-lookup"><span data-stu-id="49c82-150">How to verify correctness of SAP HANA backup</span></span>
<span data-ttu-id="49c82-151">Cuando se usan instantáneas de almacenamiento, se recomienda ejecutar una restauración de prueba en un sistema diferente.</span><span class="sxs-lookup"><span data-stu-id="49c82-151">When using storage snapshots, running a test restore on a different system is recommended.</span></span> <span data-ttu-id="49c82-152">Este enfoque proporciona una manera de asegurarse de que una copia de seguridad es correcta y de que los procesos internos de copia de seguridad y restauración funcionan según lo esperado.</span><span class="sxs-lookup"><span data-stu-id="49c82-152">This approach provides a way to ensure that a backup is correct, and internal processes for backup and restore work as expected.</span></span> <span data-ttu-id="49c82-153">Aunque esto es un importante obstáculo a nivel local, es mucho más fácil cumplirlo en la nube proporcionando recursos necesarios temporalmente para este fin.</span><span class="sxs-lookup"><span data-stu-id="49c82-153">While this is a significant hurdle on-premises, it is much easier to accomplish in the cloud by providing necessary resources temporarily for this purpose.</span></span>

<span data-ttu-id="49c82-154">Tenga en cuenta que realizar una restauración simple y comprobar si HANA está listo para empezar no es suficiente.</span><span class="sxs-lookup"><span data-stu-id="49c82-154">Keep in mind that doing a simple restore and checking if HANA is up and running is not sufficient.</span></span> <span data-ttu-id="49c82-155">Idealmente, debe ejecutar una comprobación de la coherencia de tabla para asegurarse de que la base de datos restaurada está bien.</span><span class="sxs-lookup"><span data-stu-id="49c82-155">Ideally, one should run a table consistency check to be sure that the restored database is fine.</span></span> <span data-ttu-id="49c82-156">SAP HANA ofrece varios tipos de comprobaciones de coherencia que se describen en la [nota 1977584 de SAP](https://launchpad.support.sap.com/#/notes/1977584).</span><span class="sxs-lookup"><span data-stu-id="49c82-156">SAP HANA offers several kinds of consistency checks described in [SAP Note 1977584](https://launchpad.support.sap.com/#/notes/1977584).</span></span>

<span data-ttu-id="49c82-157">También podrá encontrar información sobre la comprobación de coherencia de la tabla en el sitio web de SAP en [Comprobaciones de coherencia de tabla y catálogo](http://help.sap.com/saphelp_hanaplatform/helpdata/en/25/84ec2e324d44529edc8221956359ea/content.htm#loio9357bf52c7324bee9567dca417ad9f8b).</span><span class="sxs-lookup"><span data-stu-id="49c82-157">Information about the table consistency check can also be found on the SAP website at [Table and Catalog Consistency Checks](http://help.sap.com/saphelp_hanaplatform/helpdata/en/25/84ec2e324d44529edc8221956359ea/content.htm#loio9357bf52c7324bee9567dca417ad9f8b).</span></span>

<span data-ttu-id="49c82-158">Para las copias de seguridad de archivos estándar no es necesaria una restauración de prueba.</span><span class="sxs-lookup"><span data-stu-id="49c82-158">For standard file backups, a test restore is not necessary.</span></span> <span data-ttu-id="49c82-159">Existen dos herramientas de SAP HANA que ayudan a comprobar qué copia de seguridad se puede utilizar para la restauración: hdbbackupdiag y hdbbackupcheck.</span><span class="sxs-lookup"><span data-stu-id="49c82-159">There are two SAP HANA tools that help to check which backup can be used for restore: hdbbackupdiag and hdbbackupcheck.</span></span> <span data-ttu-id="49c82-160">Vea [Comprobación manual si una recuperación es posible](https://help.sap.com/saphelp_hanaplatform/helpdata/en/77/522ef1e3cb4d799bab33e0aeb9c93b/content.htm) para obtener más información sobre estas herramientas.</span><span class="sxs-lookup"><span data-stu-id="49c82-160">See [Manually Checking Whether a Recovery is Possible](https://help.sap.com/saphelp_hanaplatform/helpdata/en/77/522ef1e3cb4d799bab33e0aeb9c93b/content.htm) for more information about these tools.</span></span>

### <a name="pros-and-cons-of-hana-backup-versus-storage-snapshot"></a><span data-ttu-id="49c82-161">Ventajas y desventajas de la copia de seguridad de HANA frente a instantáneas de almacenamiento</span><span class="sxs-lookup"><span data-stu-id="49c82-161">Pros and cons of HANA backup versus storage snapshot</span></span>

<span data-ttu-id="49c82-162">SAP no da preferencia a las copias de seguridad de HANA frente a instantáneas de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="49c82-162">SAP doesn&#39;t give preference to either HANA backup versus storage snapshot.</span></span> <span data-ttu-id="49c82-163">Enumera sus ventajas y desventajas, por lo que puede determinar cuál usar según la situación y la tecnología de almacenamiento disponible (vea [Planeación de su estrategia de copia de seguridad y recuperación](https://help.sap.com/saphelp_hanaplatform/helpdata/en/ef/085cd5949c40b788bba8fd3c65743e/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="49c82-163">It lists their pros and cons, so one can determine which to use depending on the situation and available storage technology (see [Planning Your Backup and Recovery Strategy](https://help.sap.com/saphelp_hanaplatform/helpdata/en/ef/085cd5949c40b788bba8fd3c65743e/content.htm)).</span></span>

<span data-ttu-id="49c82-164">En Azure, tenga en cuenta el hecho de que la característica de instantáneas de blobs de Azure no garantiza la coherencia del sistema de archivos (vea [Uso de instantáneas con PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/)).</span><span class="sxs-lookup"><span data-stu-id="49c82-164">On Azure, be aware of the fact that the Azure blob snapshot feature doesn&#39;t guarantee file system consistency (see [Using blob snapshots with PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/)).</span></span> <span data-ttu-id="49c82-165">La siguiente sección _Coherencia de datos de SAP HANA al tomar instantáneas de almacenamiento_ describe algunas consideraciones relacionadas con esta característica.</span><span class="sxs-lookup"><span data-stu-id="49c82-165">The next section, _SAP HANA data consistency when taking storage snapshots_, discusses some considerations regarding this feature.</span></span>

<span data-ttu-id="49c82-166">Además, tiene que entender las implicaciones de facturación cuando se trabaja con frecuencia con instantáneas de blob, como se describe en este artículo: [Comprender cómo las instantáneas pueden incrementar los gastos](/rest/api/storageservices/understanding-how-snapshots-accrue-charges). No son tan obvias como cuando se usan discos virtuales de Azure.</span><span class="sxs-lookup"><span data-stu-id="49c82-166">In addition, one has to understand the billing implications when working frequently with blob snapshots as described in this article: [Understanding How Snapshots Accrue Charges](/rest/api/storageservices/understanding-how-snapshots-accrue-charges)—it isn&#39;t as obvious as using Azure virtual disks.</span></span>

### <a name="sap-hana-data-consistency-when-taking-storage-snapshots"></a><span data-ttu-id="49c82-167">Coherencia de datos de SAP HANA al tomar instantáneas de almacenamiento</span><span class="sxs-lookup"><span data-stu-id="49c82-167">SAP HANA data consistency when taking storage snapshots</span></span>

<span data-ttu-id="49c82-168">La coherencia del sistema de archivos y la aplicación es un problema complejo cuando se toman instantáneas de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="49c82-168">File system and application consistency is a complex issue when taking storage snapshots.</span></span> <span data-ttu-id="49c82-169">La manera más fácil de evitar problemas sería apagar SAP HANA, o quizás incluso la máquina virtual completa.</span><span class="sxs-lookup"><span data-stu-id="49c82-169">The easiest way to avoid problems would be to shut down SAP HANA, or maybe even the whole virtual machine.</span></span> <span data-ttu-id="49c82-170">El cierre puede ser factible con una demostración o prototipo, o incluso en un sistema de desarrollo, pero no es una opción para un sistema de producción.</span><span class="sxs-lookup"><span data-stu-id="49c82-170">A shutdown might be doable with a demo or prototype, or even a development system, but it is not an option for a production system.</span></span>

<span data-ttu-id="49c82-171">En Azure, debe tener en cuenta que la característica de instantáneas de blobs de Azure no garantiza la coherencia del sistema de archivos.</span><span class="sxs-lookup"><span data-stu-id="49c82-171">On Azure, one has to keep in mind that the Azure blob snapshot feature doesn&#39;t guarantee file system consistency.</span></span> <span data-ttu-id="49c82-172">Sin embargo, funciona correctamente mediante la característica de instantáneas de SAP HANA, siempre que haya solo un único disco virtual implicado.</span><span class="sxs-lookup"><span data-stu-id="49c82-172">It works fine however by using the SAP HANA snapshot feature, as long as there is only a single virtual disk involved.</span></span> <span data-ttu-id="49c82-173">Sin embargo, incluso con un solo disco, deben comprobarse los elementos adicionales.</span><span class="sxs-lookup"><span data-stu-id="49c82-173">But even with a single disk, additional items have to be checked.</span></span> <span data-ttu-id="49c82-174">La [nota 2039883 de SAP](https://launchpad.support.sap.com/#/notes/2039883) dispone de información importante sobre las copias de seguridad de SAP HANA a través de instantáneas de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="49c82-174">[SAP Note 2039883](https://launchpad.support.sap.com/#/notes/2039883) has important information about SAP HANA backups via storage snapshots.</span></span> <span data-ttu-id="49c82-175">Por ejemplo, menciona que, con el sistema de archivos XFS, es necesario ejecutar **xfs\_freeze** antes de iniciar una instantánea de almacenamiento para garantizar la coherencia (vea [xfs\_freeze(8) - Linux man page](https://linux.die.net/man/8/xfs_freeze) para obtener más información sobre **xfs\_freeze**).</span><span class="sxs-lookup"><span data-stu-id="49c82-175">For example, it mentions that, with the XFS file system, it is necessary to run **xfs\_freeze** before starting a storage snapshot to guarantee consistency (see [xfs\_freeze(8) - Linux man page](https://linux.die.net/man/8/xfs_freeze) for details on **xfs\_freeze**).</span></span>

<span data-ttu-id="49c82-176">El tema de coherencia pasa a ser incluso más complejo en un escenario donde un sistema de archivos único abarca varios discos o volúmenes.</span><span class="sxs-lookup"><span data-stu-id="49c82-176">The topic of consistency becomes even more challenging in a case where a single file system spans multiple disks/volumes.</span></span> <span data-ttu-id="49c82-177">Por ejemplo, si utiliza mdadm o LVM, y fragmentación.</span><span class="sxs-lookup"><span data-stu-id="49c82-177">For example, by using mdadm or LVM and striping.</span></span> <span data-ttu-id="49c82-178">La nota de SAP mencionada anteriormente indica:</span><span class="sxs-lookup"><span data-stu-id="49c82-178">The SAP Note mentioned above states:</span></span>

<span data-ttu-id="49c82-179">_&quot;Pero tenga en cuenta que el sistema de almacenamiento debe garantizar la coherencia de E/S al crear una instantánea de almacenamiento por volumen de datos de SAP HANA, es decir, la toma de instantáneas de un volumen de datos específicos del servicio de SAP HANA debe ser una operación atómica.&quot;_</span><span class="sxs-lookup"><span data-stu-id="49c82-179">_&quot;But keep in mind that the storage system has to guarantee I/O consistency while creating a storage snapshot per SAP HANA data volume, i.e. snapshotting of an SAP HANA service-specific data volume must be an atomic operation.&quot;_</span></span>

<span data-ttu-id="49c82-180">Suponiendo que exista un sistema de archivos XFS que abarque cuatro discos virtuales de Azure, los pasos siguientes proporcionan una instantánea coherente que representa el área de datos de HANA:</span><span class="sxs-lookup"><span data-stu-id="49c82-180">Assuming there is an XFS file system spanning four Azure virtual disks, the following steps provide a consistent snapshot that represents the HANA data area:</span></span>

- <span data-ttu-id="49c82-181">Preparación de la instantánea de HANA</span><span class="sxs-lookup"><span data-stu-id="49c82-181">HANA snapshot prepare</span></span>
- <span data-ttu-id="49c82-182">Inmovilización del sistema de archivos (por ejemplo, utilice **xfs\_freeze**)</span><span class="sxs-lookup"><span data-stu-id="49c82-182">Freeze the file system (for example, use **xfs\_freeze**)</span></span>
- <span data-ttu-id="49c82-183">Creación de todas las instantáneas de blob necesarias en Azure</span><span class="sxs-lookup"><span data-stu-id="49c82-183">Create all necessary blob snapshots on Azure</span></span>
- <span data-ttu-id="49c82-184">Cancelación de la inmovilización del sistema de archivos</span><span class="sxs-lookup"><span data-stu-id="49c82-184">Unfreeze the file system</span></span>
- <span data-ttu-id="49c82-185">Confirmación de la instantánea de HANA</span><span class="sxs-lookup"><span data-stu-id="49c82-185">Confirm the HANA snapshot</span></span>

<span data-ttu-id="49c82-186">La recomendación es utilizar el procedimiento anterior en todos los casos para estar seguro, con independencia del sistema de archivos.</span><span class="sxs-lookup"><span data-stu-id="49c82-186">Recommendation is to use the procedure above in all cases to be on the safe side, no matter which file system.</span></span> <span data-ttu-id="49c82-187">O bien, si es un solo disco o una fragmentación, a través de mdadm o LVM en varios discos.</span><span class="sxs-lookup"><span data-stu-id="49c82-187">Or if it is a single disk or striping, via mdadm or LVM across multiple disks.</span></span>

<span data-ttu-id="49c82-188">Es importante confirmar la instantánea de HANA.</span><span class="sxs-lookup"><span data-stu-id="49c82-188">It is important to confirm the HANA snapshot.</span></span> <span data-ttu-id="49c82-189">Debido a la &quot;copia en escritura&quot;, SAP HANA no debe requerir espacio en disco adicional mientras esté en este modo de preparación de la instantánea.</span><span class="sxs-lookup"><span data-stu-id="49c82-189">Due to the &quot;Copy-on-Write,&quot; SAP HANA might not require additional disk space while in this snapshot-prepare mode.</span></span> <span data-ttu-id="49c82-190">Además, no es posible iniciar nuevas copias de seguridad hasta que se confirme la instantánea de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="49c82-190">It&#39;s also not possible to start new backups until the SAP HANA snapshot is confirmed.</span></span>

<span data-ttu-id="49c82-191">El servicio Azure Backup usa las extensiones de máquina virtual de Azure para conservar la coherencia del sistema de archivos.</span><span class="sxs-lookup"><span data-stu-id="49c82-191">Azure Backup service uses Azure VM extensions to take care of the file system consistency.</span></span> <span data-ttu-id="49c82-192">Estas extensiones de VM no están disponibles para el uso independiente.</span><span class="sxs-lookup"><span data-stu-id="49c82-192">These VM extensions are not available for standalone usage.</span></span> <span data-ttu-id="49c82-193">Tiene aún que administrar la coherencia de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="49c82-193">One still has to manage SAP HANA consistency.</span></span> <span data-ttu-id="49c82-194">Vea el artículo relacionado [Azure Backup de SAP HANA en el nivel de archivo](sap-hana-backup-file-level.md) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="49c82-194">See the related article [SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md) for more information.</span></span>

### <a name="sap-hana-backup-scheduling-strategy"></a><span data-ttu-id="49c82-195">Estrategia de programación de copia de seguridad de SAP HANA</span><span class="sxs-lookup"><span data-stu-id="49c82-195">SAP HANA backup scheduling strategy</span></span>

<span data-ttu-id="49c82-196">El artículo de SAP HANA [Planeación de su estrategia de copia de seguridad y recuperación](https://help.sap.com/saphelp_hanaplatform/helpdata/en/ef/085cd5949c40b788bba8fd3c65743e/content.htm) indica un plan básico para realizar copias de seguridad:</span><span class="sxs-lookup"><span data-stu-id="49c82-196">The SAP HANA article [Planning Your Backup and Recovery Strategy](https://help.sap.com/saphelp_hanaplatform/helpdata/en/ef/085cd5949c40b788bba8fd3c65743e/content.htm) states a basic plan to do backups:</span></span>

- <span data-ttu-id="49c82-197">Instantánea del almacenamiento (diaria)</span><span class="sxs-lookup"><span data-stu-id="49c82-197">Storage snapshot (daily)</span></span>
- <span data-ttu-id="49c82-198">Copia de seguridad de datos completa con formato de archivo o backint (una vez a la semana)</span><span class="sxs-lookup"><span data-stu-id="49c82-198">Complete data backup using file or bacint format (once a week)</span></span>
- <span data-ttu-id="49c82-199">Copias de seguridad de registro automáticas</span><span class="sxs-lookup"><span data-stu-id="49c82-199">Automatic log backups</span></span>

<span data-ttu-id="49c82-200">Opcionalmente, puede realizar el proceso completo sin instantáneas de almacenamiento; se reemplazarán por copias de seguridad diferenciales de HANA, como copias de seguridad incrementales o diferenciales (vea [Copias de seguridad diferenciales](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/bb7e33bb571014a03eeabba4e37541/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="49c82-200">Optionally, one could go completely without storage snapshots; they could be replaced by HANA delta backups, like incremental or differential backups (see [Delta Backups](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/bb7e33bb571014a03eeabba4e37541/content.htm)).</span></span>

<span data-ttu-id="49c82-201">La guía de administración de HANA proporciona una lista de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="49c82-201">The HANA Administration guide provides an example list.</span></span> <span data-ttu-id="49c82-202">Sugiere que recupere SAP HANA en un momento específico en el tiempo mediante la siguiente secuencia de copias de seguridad:</span><span class="sxs-lookup"><span data-stu-id="49c82-202">It suggests that one recover SAP HANA to a specific point in time using the following sequence of backups:</span></span>

1. <span data-ttu-id="49c82-203">Copia de seguridad de datos completa</span><span class="sxs-lookup"><span data-stu-id="49c82-203">Full data backup</span></span>
2. <span data-ttu-id="49c82-204">Copia de seguridad diferencial</span><span class="sxs-lookup"><span data-stu-id="49c82-204">Differential backup</span></span>
3. <span data-ttu-id="49c82-205">Copia de seguridad incremental 1</span><span class="sxs-lookup"><span data-stu-id="49c82-205">Incremental backup 1</span></span>
4. <span data-ttu-id="49c82-206">Copia de seguridad incremental 2</span><span class="sxs-lookup"><span data-stu-id="49c82-206">Incremental backup 2</span></span>
5. <span data-ttu-id="49c82-207">Copias de seguridad de registro</span><span class="sxs-lookup"><span data-stu-id="49c82-207">Log backups</span></span>

<span data-ttu-id="49c82-208">No es posible proporcionar una directriz general respecto a una programación exacta de como cuándo y con qué frecuencia debe realizarse un tipo de copia de seguridad específica. Depende mucho del cliente y de la cantidad de cambios de datos que se realicen en el sistema.</span><span class="sxs-lookup"><span data-stu-id="49c82-208">Regarding an exact schedule as to when and how often a specific backup type should happen, it is not possible to give a general guideline—it is too customer-specific, and depends on how many data changes occur in the system.</span></span> <span data-ttu-id="49c82-209">Una recomendación básica del lado de SAP, que se puede ver como guía general, es realizar una copia de seguridad de HANA completa una vez a la semana.</span><span class="sxs-lookup"><span data-stu-id="49c82-209">One basic recommendation from SAP side, which can be seen as general guidance, is to make one full HANA backup once a week.</span></span>
<span data-ttu-id="49c82-210">Con respecto a las copias de seguridad de registro, vea la documentación de SAP HANA [Copias de seguridad de registro](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/bb7e33bb571014a03eeabba4e37541/content.htm).</span><span class="sxs-lookup"><span data-stu-id="49c82-210">Regarding log backups, see the SAP HANA documentation [Log Backups](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/bb7e33bb571014a03eeabba4e37541/content.htm).</span></span>

<span data-ttu-id="49c82-211">SAP también recomienda realizar algunas tareas de mantenimiento del catálogo de copia de seguridad para evitar que crezca de forma desmesurada (vea [Tareas de mantenimiento para el catálogo de copia de seguridad y el almacenamiento de copia de seguridad](http://help.sap.com/saphelp_hanaplatform/helpdata/en/ca/c903c28b0e4301b39814ef41dbf568/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="49c82-211">SAP also recommends doing some housekeeping of the backup catalog to keep it from growing infinitely (see [Housekeeping for Backup Catalog and Backup Storage](http://help.sap.com/saphelp_hanaplatform/helpdata/en/ca/c903c28b0e4301b39814ef41dbf568/content.htm)).</span></span>

### <a name="sap-hana-configuration-files"></a><span data-ttu-id="49c82-212">Archivos de configuración de SAP HANA</span><span class="sxs-lookup"><span data-stu-id="49c82-212">SAP HANA configuration files</span></span>

<span data-ttu-id="49c82-213">Como se indica en las preguntas más frecuentes en la [nota 1642148 de SAP](https://launchpad.support.sap.com/#/notes/1642148), los archivos de configuración de SAP HANA no forman parte de una copia de seguridad de HANA estándar.</span><span class="sxs-lookup"><span data-stu-id="49c82-213">As stated in the FAQ in [SAP Note 1642148](https://launchpad.support.sap.com/#/notes/1642148), the SAP HANA configuration files are not part of a standard HANA backup.</span></span> <span data-ttu-id="49c82-214">No son fundamentales para restaurar un sistema.</span><span class="sxs-lookup"><span data-stu-id="49c82-214">They are not essential to restore a system.</span></span> <span data-ttu-id="49c82-215">La configuración de HANA podría cambiarse manualmente después de la restauración.</span><span class="sxs-lookup"><span data-stu-id="49c82-215">The HANA configuration could be changed manually after the restore.</span></span> <span data-ttu-id="49c82-216">En caso de que desee obtener la misma configuración personalizada durante el proceso de restauración, es necesario realizar la copia de seguridad de los archivos de configuración de HANA por separado.</span><span class="sxs-lookup"><span data-stu-id="49c82-216">In case one would like to get the same custom configuration during the restore process, it is necessary to back up the HANA configuration files separately.</span></span>

<span data-ttu-id="49c82-217">Si las copias de seguridad de HANA estándar van a un sistema de archivos de copia de seguridad de HANA dedicado, puede copiar también los archivos de configuración en el mismo sistema de archivos de copia de seguridad y, a continuación, copiarlo todo junto en el destino final de almacenamiento como un almacenamiento de blobs esporádico.</span><span class="sxs-lookup"><span data-stu-id="49c82-217">If standard HANA backups are going to a dedicated HANA backup file system, one could also copy the configuration files to the same backup filesystem, and then copy everything together to the final storage destination like cool blob storage.</span></span>

### <a name="sap-hana-cockpit"></a><span data-ttu-id="49c82-218">SAP HANA Cockpit</span><span class="sxs-lookup"><span data-stu-id="49c82-218">SAP HANA Cockpit</span></span>

<span data-ttu-id="49c82-219">SAP HANA Cockpit ofrece la posibilidad de supervisar y administrar SAP HANA a través de un explorador.</span><span class="sxs-lookup"><span data-stu-id="49c82-219">SAP HANA Cockpit offers the possibility of monitoring and managing SAP HANA via a browser.</span></span> <span data-ttu-id="49c82-220">También permite administrar copias de seguridad de SAP HANA y, por lo tanto, puede utilizarse como alternativa a SAP HANA Studio y ABAP DBACOCKPIT (vea [SAP HANA Cockpit](https://help.sap.com/saphelp_hanaplatform/helpdata/en/73/c37822444344f3973e0e976b77958e/content.htm) para obtener más información).</span><span class="sxs-lookup"><span data-stu-id="49c82-220">It also allows handling of SAP HANA backups, and therefore can be used as an alternative to SAP HANA Studio and ABAP DBACOCKPIT (see [SAP HANA Cockpit](https://help.sap.com/saphelp_hanaplatform/helpdata/en/73/c37822444344f3973e0e976b77958e/content.htm) for more information).</span></span>

![Esta ilustración muestra la pantalla de administración de base de datos de SAP HANA Cockpit](media/sap-hana-backup-guide/image004.png)

<span data-ttu-id="49c82-222">Esta ilustración muestra la pantalla de administración de base de datos de SAP HANA Cockpit y el icono de copia de seguridad de la izquierda.</span><span class="sxs-lookup"><span data-stu-id="49c82-222">This figure shows the SAP HANA Cockpit Database Administration Screen, and the backup tile on the left.</span></span> <span data-ttu-id="49c82-223">La visualización del icono de copia de seguridad requiere permisos de usuario apropiados para la cuenta de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="49c82-223">Seeing the backup tile requires appropriate user permissions for login account.</span></span>

![Las copias de seguridad pueden supervisarse en SAP HANA Cockpit mientras están en curso](media/sap-hana-backup-guide/image005.png)

<span data-ttu-id="49c82-225">Las copias de seguridad pueden supervisarse en SAP HANA Cockpit mientras están en curso y, una vez que hayan finalizado, todos los detalles de la copia de seguridad están disponibles.</span><span class="sxs-lookup"><span data-stu-id="49c82-225">Backups can be monitored in SAP HANA Cockpit while they are ongoing and, once it is finished, all the backup details are available.</span></span>

![Un ejemplo de uso de Firefox en una VM de Azure SLES 12 con el escritorio de Gnome](media/sap-hana-backup-guide/image006.png)

<span data-ttu-id="49c82-227">Las capturas de pantalla anteriores se realizaron desde una máquina virtual Windows de Azure.</span><span class="sxs-lookup"><span data-stu-id="49c82-227">The previous screenshots were made from an Azure Windows VM.</span></span> <span data-ttu-id="49c82-228">Este es un ejemplo de uso de Firefox en una VM de Azure SLES 12 con el escritorio de Gnome</span><span class="sxs-lookup"><span data-stu-id="49c82-228">This one is an example using Firefox on an Azure SLES 12 VM with Gnome desktop.</span></span> <span data-ttu-id="49c82-229">Muestra la opción para definir programaciones de copia de seguridad de SAP HANA en SAP HANA Cockpit.</span><span class="sxs-lookup"><span data-stu-id="49c82-229">It shows the option to define SAP HANA backup schedules in SAP HANA Cockpit.</span></span> <span data-ttu-id="49c82-230">A medida que vea, sugiere una fecha y hora como prefijo para los archivos de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="49c82-230">As one can also see, it suggests date/time as a prefix for the backup files.</span></span> <span data-ttu-id="49c82-231">En SAP HANA Studio, el prefijo predeterminado es &quot;COMPLETE\_DATA\_BACKUP&quot; al realizar una copia de seguridad completa.</span><span class="sxs-lookup"><span data-stu-id="49c82-231">In SAP HANA Studio, the default prefix is &quot;COMPLETE\_DATA\_BACKUP&quot; when doing a full file backup.</span></span> <span data-ttu-id="49c82-232">Se recomienda usar un prefijo único.</span><span class="sxs-lookup"><span data-stu-id="49c82-232">Using a unique prefix is recommended.</span></span>

### <a name="sap-hana-backup-encryption"></a><span data-ttu-id="49c82-233">Cifrado de copia de seguridad de SAP HANA</span><span class="sxs-lookup"><span data-stu-id="49c82-233">SAP HANA backup encryption</span></span>

<span data-ttu-id="49c82-234">SAP HANA ofrece cifrado de datos y de registro.</span><span class="sxs-lookup"><span data-stu-id="49c82-234">SAP HANA offers encryption of data and log.</span></span> <span data-ttu-id="49c82-235">Si no se cifran los datos de SAP HANA y de registro, las copias de seguridad tampoco se cifran.</span><span class="sxs-lookup"><span data-stu-id="49c82-235">If SAP HANA data and log are not encrypted, then the backups are also not encrypted.</span></span> <span data-ttu-id="49c82-236">Es responsabilidad del cliente usar algún tipo de solución de terceros para cifrar las copias de seguridad de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="49c82-236">It is up to the customer to use some form of third-party solution to encrypt the SAP HANA backups.</span></span> <span data-ttu-id="49c82-237">Vea [Cifrado de datos y volumen de registro](https://help.sap.com/saphelp_hanaplatform/helpdata/en/dc/01f36fbb5710148b668201a6e95cf2/content.htm) para obtener más información sobre el cifrado de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="49c82-237">See [Data and Log Volume Encryption](https://help.sap.com/saphelp_hanaplatform/helpdata/en/dc/01f36fbb5710148b668201a6e95cf2/content.htm) to find out more about SAP HANA encryption.</span></span>

<span data-ttu-id="49c82-238">En Microsoft Azure, un cliente puede utilizar la característica de cifrado de VM IaaS para cifrar.</span><span class="sxs-lookup"><span data-stu-id="49c82-238">On Microsoft Azure, a customer could use the IaaS VM encryption feature to encrypt.</span></span> <span data-ttu-id="49c82-239">Por ejemplo, puede utilizar discos de datos dedicados asociados a la VM, que se usan para almacenar copias de seguridad de SAP HANA y luego realizar copias de estos discos.</span><span class="sxs-lookup"><span data-stu-id="49c82-239">For example, one could use dedicated data disks attached to the VM, which are used to store SAP HANA backups, then make copies of these disks.</span></span>

<span data-ttu-id="49c82-240">El servicio Azure Backup puede controlar las VM o los discos cifrados (consulte [Procedimiento de realización de copias de seguridad y restauración de máquinas virtuales cifradas con Azure Backup](../../../backup/backup-azure-vms-encryption.md)).</span><span class="sxs-lookup"><span data-stu-id="49c82-240">Azure Backup service can handle encrypted VMs/disks (see [How to back up and restore encrypted virtual machines with Azure Backup](../../../backup/backup-azure-vms-encryption.md)).</span></span>

<span data-ttu-id="49c82-241">Otra opción sería mantener la VM de SAP HANA y sus discos sin cifrado y almacenar los archivos de copia de seguridad de SAP HANA en una cuenta de almacenamiento para la que se ha habilitado el cifrado (vea [Cifrado del servicio Azure Storage para datos en reposo (versión preliminar)](../../../storage/common/storage-service-encryption.md)).</span><span class="sxs-lookup"><span data-stu-id="49c82-241">Another option would be to maintain the SAP HANA VM and its disks without encryption, and store the SAP HANA backup files in a storage account for which encryption was enabled (see [Azure Storage Service Encryption for Data at Rest](../../../storage/common/storage-service-encryption.md)).</span></span>

## <a name="test-setup"></a><span data-ttu-id="49c82-242">Prueba de configuración</span><span class="sxs-lookup"><span data-stu-id="49c82-242">Test setup</span></span>

### <a name="test-virtual-machine-on-azure"></a><span data-ttu-id="49c82-243">Prueba de la máquina virtual en Azure</span><span class="sxs-lookup"><span data-stu-id="49c82-243">Test Virtual Machine on Azure</span></span>

<span data-ttu-id="49c82-244">Se usó una instalación de SAP HANA en una máquina virtual Azure GS5 para las siguientes pruebas de copia de seguridad/restauración.</span><span class="sxs-lookup"><span data-stu-id="49c82-244">An SAP HANA installation in an Azure GS5 VM was used for the following backup/restore tests.</span></span>

![En esta ilustración se muestra parte de la información general de Azure Portal para la VM de prueba HANA](media/sap-hana-backup-guide/image007.png)

<span data-ttu-id="49c82-246">En esta ilustración se muestra parte de la información general de Azure Portal para la VM de prueba HANA.</span><span class="sxs-lookup"><span data-stu-id="49c82-246">This figure shows part of the Azure portal overview for the HANA test VM.</span></span>

### <a name="test-backup-size"></a><span data-ttu-id="49c82-247">Prueba de tamaño de copia de seguridad</span><span class="sxs-lookup"><span data-stu-id="49c82-247">Test backup size</span></span>

![Esta ilustración se realizó a partir de la consola de copia de seguridad en HANA Studio y muestra el tamaño del archivo de copia de seguridad de 229 GB para el servidor de indexación de HANA](media/sap-hana-backup-guide/image008.png)

<span data-ttu-id="49c82-249">Se completó una tabla ficticia con datos para obtener un tamaño de copia de seguridad total de más de 200 GB para obtener datos con un rendimiento realista.</span><span class="sxs-lookup"><span data-stu-id="49c82-249">A dummy table was filled up with data to get a total data backup size of over 200 GB to derive realistic performance data.</span></span> <span data-ttu-id="49c82-250">La ilustración se realizó a partir de la consola de copia de seguridad en HANA Studio y muestra el tamaño del archivo de copia de seguridad de 229 GB para el servidor de indexación de HANA.</span><span class="sxs-lookup"><span data-stu-id="49c82-250">The figure was taken from the backup console in HANA Studio and shows the backup file size of 229 GB for the HANA index server.</span></span> <span data-ttu-id="49c82-251">Para las pruebas, se utilizó el prefijo de copia de seguridad predeterminado "COMPLETE_DATA_BACKUP" en SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="49c82-251">For the tests, the default backup prefix "COMPLETE_DATA_BACKUP" in SAP HANA Studio was used.</span></span> <span data-ttu-id="49c82-252">En los sistemas de producción real, debe definirse un prefijo más útil.</span><span class="sxs-lookup"><span data-stu-id="49c82-252">In real production systems, a more useful prefix should be defined.</span></span> <span data-ttu-id="49c82-253">SAP HANA Cockpit sugiere la fecha/hora.</span><span class="sxs-lookup"><span data-stu-id="49c82-253">SAP HANA Cockpit suggests date/time.</span></span>

### <a name="test-tool-to-copy-files-directly-to-azure-storage"></a><span data-ttu-id="49c82-254">Prueba de la herramienta para copiar archivos directamente en Azure Storage</span><span class="sxs-lookup"><span data-stu-id="49c82-254">Test tool to copy files directly to Azure storage</span></span>

<span data-ttu-id="49c82-255">Para transferir archivos de copia de seguridad de SAP HANA directamente a Azure Blob Storage o recursos compartidos de archivos de Azure, se usó la herramienta blobxfer, ya que admite ambos destinos y se puede integrar fácilmente en los scripts de automatización debido a su interfaz de línea de comandos.</span><span class="sxs-lookup"><span data-stu-id="49c82-255">To transfer SAP HANA backup files directly to Azure blob storage, or Azure file shares, the blobxfer tool was used because it supports both targets and it can be easily integrated into automation scripts due to its command-line interface.</span></span> <span data-ttu-id="49c82-256">La herramienta blobxfer está disponible en [GitHub](https://github.com/Azure/blobxfer).</span><span class="sxs-lookup"><span data-stu-id="49c82-256">The blobxfer tool is available on [GitHub](https://github.com/Azure/blobxfer).</span></span>

### <a name="test-backup-size-estimation"></a><span data-ttu-id="49c82-257">Prueba de estimación del tamaño de la copia de seguridad</span><span class="sxs-lookup"><span data-stu-id="49c82-257">Test backup size estimation</span></span>

<span data-ttu-id="49c82-258">Es importante estimar el tamaño de la copia de seguridad de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="49c82-258">It is important to estimate the backup size of SAP HANA.</span></span> <span data-ttu-id="49c82-259">Esta estimación ayuda a mejorar el rendimiento al definir el tamaño máximo de archivo de copia de seguridad para un número de archivos de copia de seguridad, debido al paralelismo durante la copia de archivo.</span><span class="sxs-lookup"><span data-stu-id="49c82-259">This estimate helps to improve performance by defining the max backup file size for a number of backup files, due to parallelism during a file copy.</span></span> <span data-ttu-id="49c82-260">(Estos detalles se explican posteriormente en este artículo). Debe decidir también si se debe realizar una copia de seguridad completa o delta (incremental o diferencial).</span><span class="sxs-lookup"><span data-stu-id="49c82-260">(Those details are explained later in this article.) One must also decide whether to do a full backup or a delta backup (incremental or differential).</span></span>

<span data-ttu-id="49c82-261">Afortunadamente, hay una instrucción SQL que calcula el tamaño de los archivos de copia de seguridad: **seleccione \* a partir de M\_BACKUP\_SIZE\_ESTIMATIONS** (vea [Estimación del espacio necesario en el sistema de archivos para una copia de seguridad de datos](https://help.sap.com/saphelp_hanaplatform/helpdata/en/7d/46337b7a9c4c708d965b65bc0f343c/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="49c82-261">Fortunately, there is a simple SQL statement that estimates the size of the backup files: **select \* from M\_BACKUP\_SIZE\_ESTIMATIONS** (see [Estimate the Space Needed in the File System for a Data Backup](https://help.sap.com/saphelp_hanaplatform/helpdata/en/7d/46337b7a9c4c708d965b65bc0f343c/content.htm)).</span></span>

![El resultado de esta instrucción SQL coincide con casi exactamente el tamaño real de la copia de seguridad de datos completa en disco](media/sap-hana-backup-guide/image009.png)

<span data-ttu-id="49c82-263">Para el sistema de prueba, el resultado de esta instrucción SQL coincide con casi exactamente el tamaño real de la copia de seguridad de datos completa en disco.</span><span class="sxs-lookup"><span data-stu-id="49c82-263">For the test system, the output of this SQL statement matches almost exactly the real size of the full data backup on disk.</span></span>

### <a name="test-hana-backup-file-size"></a><span data-ttu-id="49c82-264">Prueba del tamaño del archivo de copia de seguridad de HANA</span><span class="sxs-lookup"><span data-stu-id="49c82-264">Test HANA backup file size</span></span>

![La consola de copia de seguridad de HANA Studio permite restringir el tamaño máximo de archivo de los archivos de copia de seguridad de HANA](media/sap-hana-backup-guide/image010.png)

<span data-ttu-id="49c82-266">La consola de copia de seguridad de HANA Studio permite restringir el tamaño máximo de archivo de los archivos de copia de seguridad de HANA.</span><span class="sxs-lookup"><span data-stu-id="49c82-266">The HANA Studio backup console allows one to restrict the max file size of HANA backup files.</span></span> <span data-ttu-id="49c82-267">En el entorno de ejemplo, esta característica permite obtener varios archivos de copia de seguridad más pequeños en lugar de un archivo de copia de seguridad de 230 GB.</span><span class="sxs-lookup"><span data-stu-id="49c82-267">In the sample environment, that feature makes it possible to get multiple smaller backup files instead of one 230-GB backup file.</span></span> <span data-ttu-id="49c82-268">El tamaño de archivo más pequeño un impacto significativo en el rendimiento (vea el artículo relacionado [Azure Backup de SAP HANA en el nivel de archivo](sap-hana-backup-file-level.md)).</span><span class="sxs-lookup"><span data-stu-id="49c82-268">Smaller file size has a significant impact on performance (see the related article [SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md)).</span></span>

## <a name="summary"></a><span data-ttu-id="49c82-269">Resumen</span><span class="sxs-lookup"><span data-stu-id="49c82-269">Summary</span></span>

<span data-ttu-id="49c82-270">Basándose en los resultados de prueba, las siguientes tablas muestran las ventajas y desventajas de las soluciones para realizar copias de seguridad de una base de datos de SAP HANA que se ejecuta en Azure Virtual Machines.</span><span class="sxs-lookup"><span data-stu-id="49c82-270">Based on the test results the following tables show pros and cons of solutions to back up an SAP HANA database running on Azure virtual machines.</span></span>

<span data-ttu-id="49c82-271">**Copia de seguridad de SAP HANA al sistema de archivos y copia de archivos de copia de seguridad posteriormente en el destino de copia de seguridad final**</span><span class="sxs-lookup"><span data-stu-id="49c82-271">**Back up SAP HANA to the file system and copy backup files afterwards to the final backup destination**</span></span>

|<span data-ttu-id="49c82-272">Solución</span><span class="sxs-lookup"><span data-stu-id="49c82-272">Solution</span></span>                                           |<span data-ttu-id="49c82-273">Ventajas</span><span class="sxs-lookup"><span data-stu-id="49c82-273">Pros</span></span>                                 |<span data-ttu-id="49c82-274">Desventajas</span><span class="sxs-lookup"><span data-stu-id="49c82-274">Cons</span></span>                                  |
|---------------------------------------------------|-------------------------------------|--------------------------------------|
|<span data-ttu-id="49c82-275">Conservación de copias de seguridad de HANA en discos de VM</span><span class="sxs-lookup"><span data-stu-id="49c82-275">Keep HANA backups on VM disks</span></span>                      |<span data-ttu-id="49c82-276">No hay esfuerzos de administración adicionales</span><span class="sxs-lookup"><span data-stu-id="49c82-276">No additional management efforts</span></span>     |<span data-ttu-id="49c82-277">Consume espacio en disco de VM local</span><span class="sxs-lookup"><span data-stu-id="49c82-277">Eats up local VM disk space</span></span>           |
|<span data-ttu-id="49c82-278">Herramienta Bloxfer para copiar archivos de copia de seguridad en almacenamiento de blobs</span><span class="sxs-lookup"><span data-stu-id="49c82-278">Blobxfer tool to copy backup files to blob storage</span></span> |<span data-ttu-id="49c82-279">Paralelismo para copiar varios archivos, opción de usar el almacenamiento de blobs esporádico</span><span class="sxs-lookup"><span data-stu-id="49c82-279">Parallelism to copy multiple files, choice to use cool blob storage</span></span> | <span data-ttu-id="49c82-280">Mantenimiento de la herramienta adicional y scripting personalizado</span><span class="sxs-lookup"><span data-stu-id="49c82-280">Additional tool maintenance and custom scripting</span></span> | 
|<span data-ttu-id="49c82-281">Copia de blobs a través de Powershell o CLI</span><span class="sxs-lookup"><span data-stu-id="49c82-281">Blob copy via Powershell or CLI</span></span>                    |<span data-ttu-id="49c82-282">No es necesaria ninguna herramienta adicional, puede realizarse a través de Azure Powershell o CLI</span><span class="sxs-lookup"><span data-stu-id="49c82-282">No additional tool necessary, can be accomplished via Azure Powershell or CLI</span></span> |<span data-ttu-id="49c82-283">proceso manual, el cliente tiene que realizar el scripting y la administración de blobs copiados para la restauración</span><span class="sxs-lookup"><span data-stu-id="49c82-283">manual process, customer has to take care of scripting and management of copied blobs for restore</span></span>|
|<span data-ttu-id="49c82-284">Copia del recurso compartido NFS</span><span class="sxs-lookup"><span data-stu-id="49c82-284">Copy to NFS share</span></span>                                  |<span data-ttu-id="49c82-285">Procesamiento posterior de archivos de copia de seguridad en otra VM sin afectar al servidor de HANA</span><span class="sxs-lookup"><span data-stu-id="49c82-285">Post-processing of backup files on other VM without impact on the HANA server</span></span>|<span data-ttu-id="49c82-286">Proceso de copia lento</span><span class="sxs-lookup"><span data-stu-id="49c82-286">Slow copy process</span></span>|
|<span data-ttu-id="49c82-287">Copia de Blobxfer al servicio de archivos de Azure</span><span class="sxs-lookup"><span data-stu-id="49c82-287">Blobxfer copy to Azure File Service</span></span>                |<span data-ttu-id="49c82-288">No consume espacio en discos de VM locales</span><span class="sxs-lookup"><span data-stu-id="49c82-288">Doesn't eat up space on local VM disks</span></span>|<span data-ttu-id="49c82-289">Escritura directa no compatible con copia de seguridad de HANA, restricción del tamaño del recurso compartido de archivo actual de 5 TB</span><span class="sxs-lookup"><span data-stu-id="49c82-289">No direct write support by HANA backup, size restriction of file share currently at 5 TB</span></span>|
|<span data-ttu-id="49c82-290">Azure Backup Agent</span><span class="sxs-lookup"><span data-stu-id="49c82-290">Azure Backup Agent</span></span>                                 | <span data-ttu-id="49c82-291">Sería la mejor solución</span><span class="sxs-lookup"><span data-stu-id="49c82-291">Would be preferred solution</span></span>         | <span data-ttu-id="49c82-292">No disponible actualmente en Linux</span><span class="sxs-lookup"><span data-stu-id="49c82-292">Currently not available on Linux</span></span>    |



<span data-ttu-id="49c82-293">**Copia de seguridad de SAP HANA basada en instantáneas de almacenamiento**</span><span class="sxs-lookup"><span data-stu-id="49c82-293">**Backup SAP HANA based on storage snapshots**</span></span>

|<span data-ttu-id="49c82-294">Solución</span><span class="sxs-lookup"><span data-stu-id="49c82-294">Solution</span></span>                                           |<span data-ttu-id="49c82-295">Ventajas</span><span class="sxs-lookup"><span data-stu-id="49c82-295">Pros</span></span>                                 |<span data-ttu-id="49c82-296">Desventajas</span><span class="sxs-lookup"><span data-stu-id="49c82-296">Cons</span></span>                                  |
|---------------------------------------------------|-------------------------------------|--------------------------------------|
|<span data-ttu-id="49c82-297">Servicio Azure Backup</span><span class="sxs-lookup"><span data-stu-id="49c82-297">Azure Backup Service</span></span>                               | <span data-ttu-id="49c82-298">Permite la copia de seguridad de VM basada en instantáneas de blobs</span><span class="sxs-lookup"><span data-stu-id="49c82-298">Allows VM backup based on blob snapshots</span></span> | <span data-ttu-id="49c82-299">Si no se usa la restauración a nivel de archivo, requiere la creación de una nueva VM para el proceso de restauración, lo que entonces implica que sea necesaria una nueva clave de licencia de SAP HANA</span><span class="sxs-lookup"><span data-stu-id="49c82-299">When not using file level restore, it requires the creation of a new VM for the restore process, which then implies the need of a new SAP HANA license key</span></span>|
|<span data-ttu-id="49c82-300">Instantáneas de blobs manuales</span><span class="sxs-lookup"><span data-stu-id="49c82-300">Manual blob snapshots</span></span>                              | <span data-ttu-id="49c82-301">Flexibilidad para crear y restaurar discos de VM específicos sin cambiar el identificador único de VM</span><span class="sxs-lookup"><span data-stu-id="49c82-301">Flexibility to create and restore specific VM disks without changing the unique VM ID</span></span>|<span data-ttu-id="49c82-302">Todo el trabajo es manual, tiene que hacerlo el cliente</span><span class="sxs-lookup"><span data-stu-id="49c82-302">All manual work, which has to be done by the customer</span></span>|

## <a name="next-steps"></a><span data-ttu-id="49c82-303">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="49c82-303">Next steps</span></span>
* <span data-ttu-id="49c82-304">[Azure Backup de SAP HANA en el nivel de archivo](sap-hana-backup-file-level.md) describe la opción de copia de seguridad basada en archivos.</span><span class="sxs-lookup"><span data-stu-id="49c82-304">[SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md) describes the file-based backup option.</span></span>
* <span data-ttu-id="49c82-305">[Copia de seguridad de SAP HANA basada en instantáneas de almacenamiento](sap-hana-backup-storage-snapshots.md) describe la opción de copia de seguridad basada en instantáneas de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="49c82-305">[SAP HANA backup based on storage snapshots](sap-hana-backup-storage-snapshots.md) describes the storage snapshot-based backup option.</span></span>
* <span data-ttu-id="49c82-306">Para obtener información sobre cómo establecer la alta disponibilidad y planear la recuperación ante desastres de SAP HANA en Azure (instancias grandes), vea [Alta disponibilidad y recuperación ante desastres de SAP HANA en Azure (instancias grandes)](hana-overview-high-availability-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="49c82-306">To learn how to establish high availability and plan for disaster recovery of SAP HANA on Azure (large instances), see [SAP HANA (large instances) high availability and disaster recovery on Azure](hana-overview-high-availability-disaster-recovery.md).</span></span>

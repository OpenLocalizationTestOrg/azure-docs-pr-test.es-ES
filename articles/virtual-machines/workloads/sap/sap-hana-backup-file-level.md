---
title: Azure Backup de SAP HANA en el nivel de archivo | Microsoft Docs
description: "Existen dos posibilidades de copia de seguridad principales para SAP HANA en Azure Virtual Machines. Este artículo trata sobre Azure Backup de SAP HANA en el nivel de archivo"
services: virtual-machines-linux
documentationcenter: 
author: hermanndms
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 3/13/2017
ms.author: rclaus
ms.openlocfilehash: 5db0ceb1648b5afa278e1cbe1c42fce8033bfdc1
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/29/2017
---
# <a name="sap-hana-azure-backup-on-file-level"></a><span data-ttu-id="10e50-103">Azure Backup de SAP HANA en el nivel de archivo</span><span class="sxs-lookup"><span data-stu-id="10e50-103">SAP HANA Azure Backup on file level</span></span>

## <a name="introduction"></a><span data-ttu-id="10e50-104">Introducción</span><span class="sxs-lookup"><span data-stu-id="10e50-104">Introduction</span></span>

<span data-ttu-id="10e50-105">Esto forma parte de una serie de tres partes de artículos relacionados sobre copia de seguridad de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="10e50-105">This is part of a three-part series of related articles on SAP HANA backup.</span></span> <span data-ttu-id="10e50-106">[Guía de copia de seguridad de SAP HANA en Azure Virtual Machines](./sap-hana-backup-guide.md) proporciona una introducción e información sobre los pasos iniciales, y [Copia de seguridad de SAP HANA basada en instantáneas de almacenamiento](./sap-hana-backup-storage-snapshots.md) trata la opción de copia de seguridad basada en instantáneas de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="10e50-106">[Backup guide for SAP HANA on Azure Virtual Machines](./sap-hana-backup-guide.md) provides an overview and information on getting started, and [SAP HANA backup based on storage snapshots](./sap-hana-backup-storage-snapshots.md) covers the storage snapshot-based backup option.</span></span>

<span data-ttu-id="10e50-107">Puede examinar los tamaños de máquina virtual de Azure para comprobar que GS5 permite 64 discos de datos asociados.</span><span class="sxs-lookup"><span data-stu-id="10e50-107">Looking at the Azure VM sizes, one can see that a GS5 allows 64 attached data disks.</span></span> <span data-ttu-id="10e50-108">Para los sistemas de SAP HANA de gran tamaño, puede haberse tomado ya un número significativo de discos para archivos de registro y datos, posiblemente junto con el RAID del software para ofrecer un rendimiento óptimo de E/S del disco.</span><span class="sxs-lookup"><span data-stu-id="10e50-108">For large SAP HANA systems, a significant number of disks might already be taken for data and log files, possibly in combination with software RAID for optimal disk IO throughput.</span></span> <span data-ttu-id="10e50-109">La pregunta es: ¿Cuándo almacenar archivos de copia de seguridad de SAP HANA que puedan llenar los discos de datos asociados con el paso del tiempo?</span><span class="sxs-lookup"><span data-stu-id="10e50-109">The question then is where to store SAP HANA backup files, which could fill up the attached data disks over time?</span></span> <span data-ttu-id="10e50-110">Vea [Tamaños de las máquinas virtuales Linux en Azure](../../linux/sizes.md) para las tablas de tamaño de máquina virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="10e50-110">See [Sizes for Linux virtual machines in Azure](../../linux/sizes.md) for the Azure VM size tables.</span></span>

<span data-ttu-id="10e50-111">En este momento no hay ninguna integración de copia de seguridad de SAP HANA disponible con el servicio Azure Backup.</span><span class="sxs-lookup"><span data-stu-id="10e50-111">There is no SAP HANA backup integration available with Azure Backup service at this time.</span></span> <span data-ttu-id="10e50-112">Es el método estándar de administración de la copia de seguridad/restauración en el nivel de archivo es con una copia de seguridad basada en archivos a través de SAP HANA Studio o a través de instrucciones SQL de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="10e50-112">The standard way to manage backup/restore at the file level is with a file-based backup via SAP HANA Studio or via SAP HANA SQL statements.</span></span> <span data-ttu-id="10e50-113">Vea [SAP HANA SQL y referencia de vistas del sistema](https://help.sap.com/hana/SAP_HANA_SQL_and_System_Views_Reference_en.pdf) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="10e50-113">See [SAP HANA SQL and System Views Reference](https://help.sap.com/hana/SAP_HANA_SQL_and_System_Views_Reference_en.pdf) for more information.</span></span>

![Esta ilustración muestra el cuadro de diálogo del elemento de menú de copia de seguridad en SAP HANA Studio](media/sap-hana-backup-file-level/image022.png)

<span data-ttu-id="10e50-115">Esta ilustración muestra el cuadro de diálogo del elemento de menú de copia de seguridad en SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="10e50-115">This figure shows the dialog of the backup menu item in SAP HANA Studio.</span></span> <span data-ttu-id="10e50-116">Al elegir el tipo &quot;archivo&quot;, tiene que especificar una ruta de acceso den el sistema de archivos donde SAP HANA escribe los archivos de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="10e50-116">When choosing type &quot;file,&quot; one has to specify a path in the file system where SAP HANA writes the backup files.</span></span> <span data-ttu-id="10e50-117">La restauración funciona del mismo modo.</span><span class="sxs-lookup"><span data-stu-id="10e50-117">Restore works the same way.</span></span>

<span data-ttu-id="10e50-118">Aunque esta opción suena simple y sencilla, existen algunas consideraciones.</span><span class="sxs-lookup"><span data-stu-id="10e50-118">While this choice sounds simple and straight forward, there are some considerations.</span></span> <span data-ttu-id="10e50-119">Como se mencionó antes, una máquina virtual de Azure tiene una limitación del número de discos de datos que se pueden asociar.</span><span class="sxs-lookup"><span data-stu-id="10e50-119">As mentioned before, an Azure VM has a limitation of number of data disks that can be attached.</span></span> <span data-ttu-id="10e50-120">No habrá capacidad para almacenar archivos de copia de seguridad de SAP HANA en los sistemas de archivos de la VM, según el tamaño de los requisitos de rendimiento del disco y la base de datos, que podría provocar que el RAID del software use la fragmentación en varios discos de datos.</span><span class="sxs-lookup"><span data-stu-id="10e50-120">There might not be capacity to store SAP HANA backup files on the file systems of the VM, depending on the size of the database and disk throughput requirements, which might involve software RAID using striping across multiple data disks.</span></span> <span data-ttu-id="10e50-121">Se proporcionan más opciones para mover estos archivos de copia de seguridad y administrar las restricciones de tamaño de archivo y el rendimiento cuando se administran terabytes de datos más adelante en este artículo.</span><span class="sxs-lookup"><span data-stu-id="10e50-121">Various options for moving these backup files, and managing file size restrictions and performance when handling terabytes of data, are provided later in this article.</span></span>

<span data-ttu-id="10e50-122">Otra opción, que ofrece más libertad con respecto a la capacidad total, es Azure Blob Storage.</span><span class="sxs-lookup"><span data-stu-id="10e50-122">Another option, which offers more freedom regarding total capacity, is Azure blob storage.</span></span> <span data-ttu-id="10e50-123">Aunque un único blob también se restringe a 1 TB, la capacidad total de un único contenedor de blobs es actualmente de 500 TB.</span><span class="sxs-lookup"><span data-stu-id="10e50-123">While a single blob is also restricted to 1 TB, the total capacity of a single blob container is currently 500 TB.</span></span> <span data-ttu-id="10e50-124">Además, ofrece a los clientes la opción de seleccionar el denominado almacenamiento de blobs en &quot;frío&quot;, que tiene un costo-beneficio.</span><span class="sxs-lookup"><span data-stu-id="10e50-124">Additionally, it gives customers the choice to select so-called &quot;cool&quot; blob storage, which has a cost benefit.</span></span> <span data-ttu-id="10e50-125">Vea [Azure Blob Storage: capas de almacenamiento de acceso frecuente y esporádico](../../../storage/blobs/storage-blob-storage-tiers.md) para obtener más información sobre el almacenamiento de blobs en frío.</span><span class="sxs-lookup"><span data-stu-id="10e50-125">See [Azure Blob Storage: Hot and cool storage tiers](../../../storage/blobs/storage-blob-storage-tiers.md) for details about cool blob storage.</span></span>

<span data-ttu-id="10e50-126">Para obtener una seguridad adicional, utilice una cuenta de almacenamiento con replicación geográfica para almacenar las copias de seguridad de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="10e50-126">For additional safety, use a geo-replicated storage account to store the SAP HANA backups.</span></span> <span data-ttu-id="10e50-127">Vea [Replicación de Azure Storage](../../../storage/common/storage-redundancy.md) para obtener más información sobre la replicación de la cuenta de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="10e50-127">See [Azure Storage replication](../../../storage/common/storage-redundancy.md) for details about storage account replication.</span></span>

<span data-ttu-id="10e50-128">Puede colocar VHD dedicados para copias de seguridad de SAP HANA en una cuenta de almacenamiento de copia de seguridad dedicada con replicación geográfica.</span><span class="sxs-lookup"><span data-stu-id="10e50-128">One could place dedicated VHDs for SAP HANA backups in a dedicated backup storage account that is geo-replicated.</span></span> <span data-ttu-id="10e50-129">También puede copiar los VHD que conserven las copias de seguridad de SAP HANA en una cuenta de almacenamiento de replicación geográfica o en una cuenta de almacenamiento que se encuentre en una región diferente.</span><span class="sxs-lookup"><span data-stu-id="10e50-129">Or else one could copy the VHDs that keep the SAP HANA backups to a geo-replicated storage account, or to a storage account that is in a different region.</span></span>

## <a name="azure-backup-agent"></a><span data-ttu-id="10e50-130">Azure Backup Agent</span><span class="sxs-lookup"><span data-stu-id="10e50-130">Azure backup agent</span></span>

<span data-ttu-id="10e50-131">Azure Backup Agent ofrece la opción de no solo realizar copias de seguridad de las VM completadas, sino también de archivos y directorios mediante el agente de copia de seguridad, que debe estar instalado en el sistema operativo invitado.</span><span class="sxs-lookup"><span data-stu-id="10e50-131">Azure backup offers the option to not only back up complete VMs, but also files and directories via the backup agent, which has to be installed on the guest OS.</span></span> <span data-ttu-id="10e50-132">Sin embargo, a partir de diciembre de 2016, este agente solo se admite en Windows (vea [Copia de seguridad desde Windows Server o un cliente de Windows en Azure mediante el modelo de implementación de Resource Manager](../../../backup/backup-configure-vault.md)).</span><span class="sxs-lookup"><span data-stu-id="10e50-132">But as of December 2016, this agent is only supported on Windows (see [Back up a Windows Server or client to Azure using the Resource Manager deployment model](../../../backup/backup-configure-vault.md)).</span></span>

<span data-ttu-id="10e50-133">Una solución alternativa es copiar primero archivos de copia de seguridad de SAP HANA en una VM Windows en Azure (por ejemplo, a través de recursos compartidos SAMBA) y, a continuación, usar Azure Backup Agent desde allí.</span><span class="sxs-lookup"><span data-stu-id="10e50-133">A workaround is to first copy SAP HANA backup files to a Windows VM on Azure (for example, via SAMBA share) and then use the Azure backup agent from there.</span></span> <span data-ttu-id="10e50-134">Aunque es técnicamente posible, podría agregar complejidad y ralentizar la copia de seguridad o restaurar el proceso un poco debido a la copia entre la VM Windows y Linux.</span><span class="sxs-lookup"><span data-stu-id="10e50-134">While it is technically possible, it would add complexity and slow down the backup or restore process quite a bit due to the copy between the Linux and the Windows VM.</span></span> <span data-ttu-id="10e50-135">No se recomienda seguir este enfoque.</span><span class="sxs-lookup"><span data-stu-id="10e50-135">It is not recommended to follow this approach.</span></span>

## <a name="azure-blobxfer-utility-details"></a><span data-ttu-id="10e50-136">Detalles de la utilidad bloxfer de Azure</span><span class="sxs-lookup"><span data-stu-id="10e50-136">Azure blobxfer utility details</span></span>

<span data-ttu-id="10e50-137">Para almacenar directorios y archivos en Azure Storage, puede usar CLI o PowerShell, o desarrollar una herramienta mediante uno de los [Azure SDK](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="10e50-137">To store directories and files on Azure storage, one could use CLI or PowerShell, or develop a tool using one of the [Azure SDKs](https://azure.microsoft.com/downloads/).</span></span> <span data-ttu-id="10e50-138">También hay una utilidad lista para usar, AzCopy, para copiar datos a Azure Storage, pero es solo para Windows (vea [Transferencia de datos con la utilidad en línea de comandos AzCopy](../../../storage/common/storage-use-azcopy.md)).</span><span class="sxs-lookup"><span data-stu-id="10e50-138">There is also a ready-to-use utility, AzCopy, for copying data to Azure storage, but it is Windows only (see [Transfer data with the AzCopy Command-Line Utility](../../../storage/common/storage-use-azcopy.md)).</span></span>

<span data-ttu-id="10e50-139">Por lo tanto, se usó blobxfer para copiar los archivos de copia de seguridad de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="10e50-139">Therefore blobxfer was used for copying SAP HANA backup files.</span></span> <span data-ttu-id="10e50-140">Se trata de código abierto, que usan muchos clientes en entornos de producción, y que está disponible en [GitHub](https://github.com/Azure/blobxfer).</span><span class="sxs-lookup"><span data-stu-id="10e50-140">It is open source, used by many customers in production environments, and available on [GitHub](https://github.com/Azure/blobxfer).</span></span> <span data-ttu-id="10e50-141">Esta herramienta permite copiar datos directamente a Azure Blob Storage o al recurso compartido de archivos de Azure.</span><span class="sxs-lookup"><span data-stu-id="10e50-141">This tool allows one to copy data directly to either Azure blob storage or Azure file share.</span></span> <span data-ttu-id="10e50-142">También ofrece una gama de características útiles, como hash md5 o paralelismo automático al copiar un directorio con varios archivos.</span><span class="sxs-lookup"><span data-stu-id="10e50-142">It also offers a range of useful features, like md5 hash or automatic parallelism when copying a directory with multiple files.</span></span>

## <a name="sap-hana-backup-performance"></a><span data-ttu-id="10e50-143">Rendimiento de copia de seguridad de SAP HANA</span><span class="sxs-lookup"><span data-stu-id="10e50-143">SAP HANA backup performance</span></span>

![Esta captura de pantalla es de la consola de copia de seguridad de SAP HANA en SAP HANA Studio](media/sap-hana-backup-file-level/image023.png)

<span data-ttu-id="10e50-145">Esta captura de pantalla es de la consola de copia de seguridad de SAP HANA en SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="10e50-145">This screenshot is of the SAP HANA backup console in SAP HANA Studio.</span></span> <span data-ttu-id="10e50-146">Se tardó 42 minutos en realizar la copia de seguridad de 230 GB en un único disco de almacenamiento estándar de Azure asociado a la VM de HANA con el sistema de archivos XFS.</span><span class="sxs-lookup"><span data-stu-id="10e50-146">It took about 42 minutes to do the backup of the 230 GB on a single Azure standard storage disk attached to the HANA VM using XFS file system.</span></span>

![Esta captura de pantalla es de YaST en la VM de prueba de SAP HANA](media/sap-hana-backup-file-level/image024.png)

<span data-ttu-id="10e50-148">Esta captura de pantalla es de YaST en la VM de prueba de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="10e50-148">This screenshot is of YaST on the SAP HANA test VM.</span></span> <span data-ttu-id="10e50-149">Puede ver el disco único de 1 TB para la copia de seguridad de SAP HANA como se mencionó antes.</span><span class="sxs-lookup"><span data-stu-id="10e50-149">One can see the 1-TB single disk for SAP HANA backup as mentioned before.</span></span> <span data-ttu-id="10e50-150">Se tardó 42 minutos en realizar la copia de seguridad de 230 GB.</span><span class="sxs-lookup"><span data-stu-id="10e50-150">It took about 42 minutes to backup 230 GB.</span></span> <span data-ttu-id="10e50-151">Además, se asocian cinco discos de 200 GB y software RAID md0 creado, con la fragmentación en la parte superior de estaos cinco discos de datos de Azure.</span><span class="sxs-lookup"><span data-stu-id="10e50-151">In addition, five 200-GB disks were attached and software RAID md0 created, with striping on top of these five Azure data disks.</span></span>

![La repetición de la misma copia de seguridad en software RAID con fragmentación en cinco discos de datos de Azure Standard Storage asociados](media/sap-hana-backup-file-level/image025.png)

<span data-ttu-id="10e50-153">La repetición de la misma copia de seguridad en software RAID con fragmentación en cinco discos de datos de Azure Standard Storage asociados provocó que el tiempo de copia de seguridad descendiera de 42 a 10 minutos.</span><span class="sxs-lookup"><span data-stu-id="10e50-153">Repeating the same backup on software RAID with striping across five attached Azure standard storage data disks brought the backup time from 42 minutes down to 10 minutes.</span></span> <span data-ttu-id="10e50-154">Los discos se asociaron sin el almacenamiento en caché en la VM.</span><span class="sxs-lookup"><span data-stu-id="10e50-154">The disks were attached without caching to the VM.</span></span> <span data-ttu-id="10e50-155">Por lo tanto, resulta evidente la importancia del rendimiento de la escritura en disco para el tiempo de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="10e50-155">So it is obvious how important disk write throughput is for the backup time.</span></span> <span data-ttu-id="10e50-156">Puede entonces cambiar a Azure Premium Storage para acelerar aún más el proceso para obtener un rendimiento óptimo.</span><span class="sxs-lookup"><span data-stu-id="10e50-156">One could then switch to Azure premium storage to further accelerate the process for optimal performance.</span></span> <span data-ttu-id="10e50-157">En general, debe usarse Azure Premium Storage para los sistemas de producción.</span><span class="sxs-lookup"><span data-stu-id="10e50-157">In general, Azure premium storage should be used for production systems.</span></span>

## <a name="copy-sap-hana-backup-files-to-azure-blob-storage"></a><span data-ttu-id="10e50-158">Copia de archivos de copia de seguridad de SAP HA en Azure Blob Storage</span><span class="sxs-lookup"><span data-stu-id="10e50-158">Copy SAP HANA backup files to Azure blob storage</span></span>

<span data-ttu-id="10e50-159">A partir de diciembre de 2016, la mejor opción para almacenar rápidamente archivos de copia de seguridad de SAP HANA es Azure Blob Storage.</span><span class="sxs-lookup"><span data-stu-id="10e50-159">As of December 2016, the best option to quickly store SAP HANA backup files is Azure blob storage.</span></span> <span data-ttu-id="10e50-160">Un contenedor de blob único tiene un límite de 500 TB, que es suficiente para la mayoría de los sistemas de SAP HANA que se ejecutan en una VM GS5 en Azure, para mantener bastantes copias de seguridad de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="10e50-160">One single blob container has a limit of 500 TB, enough for most SAP HANA systems, running in a GS5 VM on Azure, to keep sufficient SAP HANA backups.</span></span> <span data-ttu-id="10e50-161">Los clientes pueden elegir entre el almacenamiento de blobs en &quot;caliente&quot; y en &quot;frío&quot; (vea [Azure Blob Storage: capas de almacenamiento de acceso frecuente y esporádico](../../../storage/blobs/storage-blob-storage-tiers.md)).</span><span class="sxs-lookup"><span data-stu-id="10e50-161">Customers have the choice between &quot;hot&quot; and &quot;cold&quot; blob storage (see [Azure Blob Storage: Hot and cool storage tiers](../../../storage/blobs/storage-blob-storage-tiers.md)).</span></span>

<span data-ttu-id="10e50-162">Con la herramienta blobxfer, es fácil copiar los archivos de copia de seguridad de SAP HANA directamente en Azure Blob Storage.</span><span class="sxs-lookup"><span data-stu-id="10e50-162">With the blobxfer tool, it is easy to copy the SAP HANA backup files directly to Azure blob storage.</span></span>

![Aquí puede ver los archivos de una copia de seguridad completa de archivos de SAP HANA](media/sap-hana-backup-file-level/image026.png)

<span data-ttu-id="10e50-164">Aquí puede ver los archivos de una copia de seguridad completa de archivos de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="10e50-164">Here one can see the files of a full SAP HANA file backup.</span></span> <span data-ttu-id="10e50-165">Existen cuatro archivos y el mayor tiene aproximadamente 230 GB.</span><span class="sxs-lookup"><span data-stu-id="10e50-165">There are four files and the biggest one has roughly 230 GB.</span></span>

![Se tardó aproximadamente 3000 segundos en copiar 230 GB en un contenedor de blobs de la cuenta de Azure Standard Storage](media/sap-hana-backup-file-level/image027.png)

<span data-ttu-id="10e50-167">Sin usar el hash md5 en la prueba inicial, se tardó aproximadamente 3000 segundos en copiar 230 GB en un contenedor de blobs de la cuenta de Azure Standard Storage.</span><span class="sxs-lookup"><span data-stu-id="10e50-167">Not using md5 hash in the initial test, it took roughly 3000 seconds to copy the 230 GB to an Azure standard storage account blob container.</span></span>

![En esta captura de pantalla, puede ver el aspecto en Azure Portal](media/sap-hana-backup-file-level/image028.png)

<span data-ttu-id="10e50-169">En esta captura de pantalla, puede ver el aspecto en Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="10e50-169">In this screenshot, one can see how it looks on the Azure portal.</span></span> <span data-ttu-id="10e50-170">Se creó un contenedor de blobs denominado &quot;sap-hana-backups&quot; e incluye los cuatro blobs, que representan los archivos de copia de seguridad de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="10e50-170">A blob container named &quot;sap-hana-backups&quot; was created and includes the four blobs, which represent the SAP HANA backup files.</span></span> <span data-ttu-id="10e50-171">Uno de ellos tiene un tamaño de aproximadamente 230 GB.</span><span class="sxs-lookup"><span data-stu-id="10e50-171">One of them has a size of roughly 230 GB.</span></span>

<span data-ttu-id="10e50-172">La consola de copia de seguridad de HANA Studio permite restringir el tamaño máximo de archivo de los archivos de copia de seguridad de HANA.</span><span class="sxs-lookup"><span data-stu-id="10e50-172">The HANA Studio backup console allows one to restrict the max file size of HANA backup files.</span></span> <span data-ttu-id="10e50-173">En el entorno de ejemplo, mejoró el rendimiento haciendo posible disponer de varios archivos de copia de seguridad más pequeños, en lugar de un archivo grande de 230 GB.</span><span class="sxs-lookup"><span data-stu-id="10e50-173">In the sample environment, it improved performance by making it possible to have multiple smaller backup files, instead of one large 230-GB file.</span></span>

![El establecimiento del límite del tamaño del archivo de copia de seguridad en la parte de HANA no mejora el tiempo de copia de seguridad](media/sap-hana-backup-file-level/image029.png)

<span data-ttu-id="10e50-175">El establecimiento del límite del tamaño del archivo de copia de seguridad en la parte de HANA no mejora el tiempo de copia de seguridad porque los archivos se escriben secuencialmente como se muestra en esta figura.</span><span class="sxs-lookup"><span data-stu-id="10e50-175">Setting the backup file size limit on the HANA side doesn&#39;t improve the backup time, because the files are written sequentially as shown in this figure.</span></span> <span data-ttu-id="10e50-176">El límite de tamaño de archivo se estableció en 60 GB, por lo que la copia de seguridad creó cuatro archivos de datos de gran tamaño en lugar del archivo único de 230 GB.</span><span class="sxs-lookup"><span data-stu-id="10e50-176">The file size limit was set to 60 GB, so the backup created four large data files instead of the 230-GB single file.</span></span>

![Para probar el paralelismo de la herramienta blobxfer, el tamaño máximo de archivo para las copias de seguridad HANA se estableció en 15 GB](media/sap-hana-backup-file-level/image030.png)

<span data-ttu-id="10e50-178">Para probar el paralelismo de la herramienta blobxfer, el tamaño máximo de archivo para las copias de seguridad HANA se estableció en 15 GB, que generó 19 archivos de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="10e50-178">To test parallelism of the blobxfer tool, the max file size for HANA backups was then set to 15 GB, which resulted in 19 backup files.</span></span> <span data-ttu-id="10e50-179">Esta configuración provocó que el tiempo en el que blobxfer copió 230 GB en Azure Blob Storage descendiera de 3000 a 875 segundos.</span><span class="sxs-lookup"><span data-stu-id="10e50-179">This configuration brought the time for blobxfer to copy the 230 GB to Azure blob storage from 3000 seconds down to 875 seconds.</span></span>

<span data-ttu-id="10e50-180">Este resultado se debe al límite de 60 MB/s para la escritura de un blob de Azure.</span><span class="sxs-lookup"><span data-stu-id="10e50-180">This result is due to the limit of 60 MB/sec for writing an Azure blob.</span></span> <span data-ttu-id="10e50-181">El paralelismo a través de varios blobs resuelve el cuello de botella, pero tiene un inconveniente: el aumento del rendimiento de la herramienta blobxfer para copiar todos estos archivos de copia de seguridad de HANA en Azure Blob Storage supone una carga en la VM de HANA y la red.</span><span class="sxs-lookup"><span data-stu-id="10e50-181">Parallelism via multiple blobs solves the bottleneck, but there is a downside: increasing performance of the blobxfer tool to copy all these HANA backup files to Azure blob storage puts load on both the HANA VM and the network.</span></span> <span data-ttu-id="10e50-182">Afecta al funcionamiento del sistema de HANA.</span><span class="sxs-lookup"><span data-stu-id="10e50-182">Operation of HANA system becomes impacted.</span></span>

## <a name="blob-copy-of-dedicated-azure-data-disks-in-backup-software-raid"></a><span data-ttu-id="10e50-183">Copia de blob de discos de datos de Azure dedicados en el software RAID de copia de seguridad</span><span class="sxs-lookup"><span data-stu-id="10e50-183">Blob copy of dedicated Azure data disks in backup software RAID</span></span>

<span data-ttu-id="10e50-184">A diferencia de la copia de seguridad del disco de datos de VM, en este enfoque no se realizan copias de seguridad todos los discos de datos en una VM para guardar toda la instalación de SAP, incluidos los datos de HANA, los archivos de registro de HANA y los archivos de configuración.</span><span class="sxs-lookup"><span data-stu-id="10e50-184">Unlike the manual VM data disk backup, in this approach one does not back up all the data disks on a VM to save the whole SAP installation, including HANA data, HANA log files, and config files.</span></span> <span data-ttu-id="10e50-185">En su lugar, la idea es disponer del software RAID dedicado con fragmentación en varios VHD de datos de Azure para el almacenamiento de una copia de seguridad de archivos de SAP HANA completa.</span><span class="sxs-lookup"><span data-stu-id="10e50-185">Instead, the idea is to have dedicated software RAID with striping across multiple Azure data VHDs for storing a full SAP HANA file backup.</span></span> <span data-ttu-id="10e50-186">Copie solo estos discos, que tienen una copia de seguridad de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="10e50-186">One copies only these disks, which have the SAP HANA backup.</span></span> <span data-ttu-id="10e50-187">Pueden guardarse fácilmente en una cuenta de almacenamiento de copia de seguridad de HANA dedicada, o asociarse a una &quot;VM de administración de copia de seguridad&quot; dedicada para un procesamiento posterior.</span><span class="sxs-lookup"><span data-stu-id="10e50-187">They could easily be kept in a dedicated HANA backup storage account, or attached to a dedicated &quot;backup management VM&quot; for further processing.</span></span>

![Todos los VHD se copiaron con el comando de PowerShell **start-azurestorageblobcopy**](media/sap-hana-backup-file-level/image031.png)

<span data-ttu-id="10e50-189">Después de complementar el software RAID local, todos los VHD implicados se copiaron con el comando de PowerShell **start-azurestorageblobcopy** (vea [Start-AzureStorageBlobCopy](/powershell/module/azure.storage/start-azurestorageblobcopy)).</span><span class="sxs-lookup"><span data-stu-id="10e50-189">After the backup to the local software RAID was completed, all VHDs involved were copied using the **start-azurestorageblobcopy** PowerShell command (see [Start-AzureStorageBlobCopy](/powershell/module/azure.storage/start-azurestorageblobcopy)).</span></span> <span data-ttu-id="10e50-190">Como solo afecta al sistema de archivos dedicado para mantener archivos de copia de seguridad, no hay preocupaciones sobre la coherencia de los archivos de registro o de datos de SAP HANA en el disco.</span><span class="sxs-lookup"><span data-stu-id="10e50-190">As it only affects the dedicated file system for keeping the backup files, there are no concerns about SAP HANA data or log file consistency on the disk.</span></span> <span data-ttu-id="10e50-191">Una ventaja de este comando es que funciona mientras la VM se encuentra en línea.</span><span class="sxs-lookup"><span data-stu-id="10e50-191">A benefit of this command is that it works while the VM stays online.</span></span> <span data-ttu-id="10e50-192">Para estar seguro de que no se escribe ningún proceso en el conjunto de fragmentos de copia de seguridad, asegúrese de desmontarlo antes de la copia de blob y montarlo de nuevo posteriormente.</span><span class="sxs-lookup"><span data-stu-id="10e50-192">To be certain that no process writes to the backup stripe set, be sure to unmount it before the blob copy, and mount it again afterwards.</span></span> <span data-ttu-id="10e50-193">También puede usar una forma apropiada de &quot;inmovilizar&quot; el sistema de archivos.</span><span class="sxs-lookup"><span data-stu-id="10e50-193">Or one could use an appropriate way to &quot;freeze&quot; the file system.</span></span> <span data-ttu-id="10e50-194">Por ejemplo, a través de xfs\_freeze para el sistema de archivos XFS.</span><span class="sxs-lookup"><span data-stu-id="10e50-194">For example, via xfs\_freeze for the XFS file system.</span></span>

![Esta captura de pantalla muestra la lista de blobs en el contenedor de VHD en Azure Portal](media/sap-hana-backup-file-level/image032.png)

<span data-ttu-id="10e50-196">Esta captura de pantalla muestra la lista de blobs en el contenedor de &quot;vhd&quot; en Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="10e50-196">This screenshot shows the list of blobs in the &quot;vhds&quot; container on the Azure portal.</span></span> <span data-ttu-id="10e50-197">La captura de pantalla muestra los cinco VHD, que se han asociado a la VM del servidor de SAP HANA para que actúe como software RAID para mantener los archivos de copia de seguridad de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="10e50-197">The screenshot shows the five VHDs, which were attached to the SAP HANA server VM to serve as the software RAID to keep SAP HANA backup files.</span></span> <span data-ttu-id="10e50-198">También muestra las cinco copias, que se han realizado a través del comando de copia de blob.</span><span class="sxs-lookup"><span data-stu-id="10e50-198">It also shows the five copies, which were taken via the blob copy command.</span></span>

![Para fines de prueba, las copias de los discos del software RAID de copia de seguridad de SAP HANA se asociaron a la VM del servidor de aplicaciones](media/sap-hana-backup-file-level/image033.png)

<span data-ttu-id="10e50-200">Para fines de prueba, las copias de los discos del software RAID de copia de seguridad de SAP HANA se asociaron a la VM del servidor de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="10e50-200">For testing purposes, the copies of the SAP HANA backup software RAID disks were attached to the app server VM.</span></span>

![La VM del servidor de aplicaciones se apagó para asociar las copias de disco](media/sap-hana-backup-file-level/image034.png)

<span data-ttu-id="10e50-202">La VM del servidor de aplicaciones se apagó para asociar las copias de disco.</span><span class="sxs-lookup"><span data-stu-id="10e50-202">The app server VM was shut down to attach the disk copies.</span></span> <span data-ttu-id="10e50-203">Después de iniciar la VM, se detectaron correctamente los discos y RAID (montado a través de UUID).</span><span class="sxs-lookup"><span data-stu-id="10e50-203">After starting the VM, the disks and the RAID were discovered correctly (mounted via UUID).</span></span> <span data-ttu-id="10e50-204">Solo faltaba el punto de montaje, que se creó mediante el particionador YaST.</span><span class="sxs-lookup"><span data-stu-id="10e50-204">Only the mount point was missing, which was created via the YaST partitioner.</span></span> <span data-ttu-id="10e50-205">Después, las copias del archivo de copia de seguridad pasaron a estar visibles en el nivel de SO.</span><span class="sxs-lookup"><span data-stu-id="10e50-205">Afterwards the SAP HANA backup file copies became visible on OS level.</span></span>

## <a name="copy-sap-hana-backup-files-to-nfs-share"></a><span data-ttu-id="10e50-206">Copia de archivos de copia de seguridad de SAP HA en el recurso compartido NFS</span><span class="sxs-lookup"><span data-stu-id="10e50-206">Copy SAP HANA backup files to NFS share</span></span>

<span data-ttu-id="10e50-207">Para reducir el impacto potencial en el sistema SAP HANA desde una perspectiva de espacio o disco o rendimiento, puede considerar almacenar los archivos de copia de seguridad de SAP HANA en un recurso compartido NFS.</span><span class="sxs-lookup"><span data-stu-id="10e50-207">To lessen the potential impact on the SAP HANA system from a performance or disk space perspective, one might consider storing the SAP HANA backup files on an NFS share.</span></span> <span data-ttu-id="10e50-208">Técnicamente funciona, pero implica la utilización de una segunda máquina virtual de Azure como host del recurso compartido NFS.</span><span class="sxs-lookup"><span data-stu-id="10e50-208">Technically it works, but it means using a second Azure VM as the host of the NFS share.</span></span> <span data-ttu-id="10e50-209">No debe ser un tamaño de VM pequeño, debido al ancho de banda de red de VM.</span><span class="sxs-lookup"><span data-stu-id="10e50-209">It should not be a small VM size, due to the VM network bandwidth.</span></span> <span data-ttu-id="10e50-210">Tendría sentido cerrar esta &quot;VM de copia de seguridad&quot; y solo activarla para la ejecución de la copia de seguridad de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="10e50-210">It would make sense then to shut down this &quot;backup VM&quot; and only bring it up for executing the SAP HANA backup.</span></span> <span data-ttu-id="10e50-211">La escritura en un recurso NFS supone una carga en la red y afecta al sistema de SAP HANA, pero la simple administración de los archivos de copia de seguridad posterior en la &quot;VM de copia de seguridad&quot; no influiría en absoluto en el sistema de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="10e50-211">Writing on an NFS share puts load on the network and impacts the SAP HANA system, but merely managing the backup files afterwards on the &quot;backup VM&quot; would not influence the SAP HANA system at all.</span></span>

![Se montó un recurso compartido NFS desde otra máquina virtual de Azure en la VM de servidor de SAP HANA](media/sap-hana-backup-file-level/image035.png)

<span data-ttu-id="10e50-213">Para comprobar el caso de uso de NFS, se montó un recurso compartido NFS desde otra Azure VM en la VM de servidor de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="10e50-213">To verify the NFS use case, an NFS share from another Azure VM was mounted to the SAP HANA server VM.</span></span> <span data-ttu-id="10e50-214">No se ha aplicado ningún ajuste de NFS especial.</span><span class="sxs-lookup"><span data-stu-id="10e50-214">There was no special NFS tuning applied.</span></span>

![Se tardó 1 hora y 46 minutos en realizar la copia de seguridad directamente](media/sap-hana-backup-file-level/image036.png)

<span data-ttu-id="10e50-216">El recurso compartido NFS era un conjunto de fragmentación rápido, como el del servidor de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="10e50-216">The NFS share was a fast stripe set, like the one on the SAP HANA server.</span></span> <span data-ttu-id="10e50-217">No obstante, se tardó 1 hora y 46 minutos en realizar la copia de seguridad directamente en el recurso compartido de NFS en lugar de 10 minutos, cuando se escribía en una fragmentación local.</span><span class="sxs-lookup"><span data-stu-id="10e50-217">Nevertheless, it took 1 hour and 46 minutes to do the backup directly on the NFS share instead of 10 minutes, when writing to a local stripe set.</span></span>

![Alternativa no mucho más rápida que 1 hora y 43 minutos](media/sap-hana-backup-file-level/image037.png)

<span data-ttu-id="10e50-219">La alternativa de realizar una copia de seguridad en una fragmentación local y la copia del recurso compartido NFS en el nivel del SO (comando **cp -avr** simple) no fue mucho más rápida.</span><span class="sxs-lookup"><span data-stu-id="10e50-219">The alternative of doing a backup to a local stripe set and copying to the NFS share on OS level (a simple **cp -avr** command) wasn't much quicker.</span></span> <span data-ttu-id="10e50-220">Se tardó 1 hora y 43 minutos.</span><span class="sxs-lookup"><span data-stu-id="10e50-220">It took 1 hour and 43 minutes.</span></span>

<span data-ttu-id="10e50-221">Por lo tanto, funciona. Sin embargo, el rendimiento no fue bueno para la prueba de copia de seguridad de 230 GB.</span><span class="sxs-lookup"><span data-stu-id="10e50-221">So it works, but performance wasn't good for the 230-GB backup test.</span></span> <span data-ttu-id="10e50-222">Podría ser incluso peor para varios terabytes.</span><span class="sxs-lookup"><span data-stu-id="10e50-222">It would look even worse for multi terabytes.</span></span>

## <a name="copy-sap-hana-backup-files-to-azure-file-service"></a><span data-ttu-id="10e50-223">Copia de archivos de copia de seguridad de SAP HA en el servicio de archivos de Azure</span><span class="sxs-lookup"><span data-stu-id="10e50-223">Copy SAP HANA backup files to Azure file service</span></span>

<span data-ttu-id="10e50-224">Es posible montar un recurso compartido de archivos de Azure dentro de una VM Linux de Azure.</span><span class="sxs-lookup"><span data-stu-id="10e50-224">It is possible to mount an Azure file share inside an Azure Linux VM.</span></span> <span data-ttu-id="10e50-225">En el artículo [Uso de Azure File Storage con Linux](../../../storage/files/storage-how-to-use-files-linux.md) encontrará información sobre cómo hacerlo.</span><span class="sxs-lookup"><span data-stu-id="10e50-225">The article [How to use Azure File storage with Linux](../../../storage/files/storage-how-to-use-files-linux.md) provides details on how to do it.</span></span> <span data-ttu-id="10e50-226">Tenga en cuenta que actualmente hay un límite de cuota de 5 TB de un recurso compartido de archivos de Azure y un límite de tamaño de archivo de 1 TB por cada archivo.</span><span class="sxs-lookup"><span data-stu-id="10e50-226">Keep in mind that there is currently a 5-TB quota limit of one Azure file share, and a file size limit of 1 TB per file.</span></span> <span data-ttu-id="10e50-227">Vea [Objetivos de escalabilidad y rendimiento de Azure Storage](../../../storage/common/storage-scalability-targets.md) para obtener más información sobre los límites de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="10e50-227">See [Azure Storage Scalability and Performance Targets](../../../storage/common/storage-scalability-targets.md) for information on storage limits.</span></span>

<span data-ttu-id="10e50-228">Sin embargo, las pruebas demuestran que la copia de seguridad de SAP HANA no funciona hoy en día directamente con este tipo de montaje CIFS.</span><span class="sxs-lookup"><span data-stu-id="10e50-228">Tests have shown, however, that SAP HANA backup doesn&#39;t currently work directly with this kind of CIFS mount.</span></span> <span data-ttu-id="10e50-229">También se estableció en la [nota 1820529 de SAP](https://launchpad.support.sap.com/#/notes/1820529) que no se recomienda CIFS.</span><span class="sxs-lookup"><span data-stu-id="10e50-229">It is also stated in [SAP Note 1820529](https://launchpad.support.sap.com/#/notes/1820529) that CIFS is not recommended.</span></span>

![Esta ilustración muestra un error en el cuadro de diálogo de copia de seguridad en SAP HANA Studio](media/sap-hana-backup-file-level/image038.png)

<span data-ttu-id="10e50-231">Esta ilustración muestra un error en el cuadro de diálogo de copia de seguridad en SAP HANA Studio al intentar realizar una copia de seguridad directamente en un recurso compartido de archivos de Azure con CIFS montado.</span><span class="sxs-lookup"><span data-stu-id="10e50-231">This figure shows an error in the backup dialog in SAP HANA Studio, when trying to back up directly to a CIFS-mounted Azure file share.</span></span> <span data-ttu-id="10e50-232">Por lo tanto, tiene que realizar una copia de seguridad de SAP HANA estándar en un sistema de archivos de VM primero y, a continuación, copiar los archivos de copia de seguridad desde ahí al servicio de archivos de Azure.</span><span class="sxs-lookup"><span data-stu-id="10e50-232">So one has to do a standard SAP HANA backup into a VM file system first, and then copy the backup files from there to Azure file service.</span></span>

![Esta ilustración muestra que se tardó aproximadamente 929 segundos en copiar 19 archivos de copia de seguridad de SAP HANA](media/sap-hana-backup-file-level/image039.png)

<span data-ttu-id="10e50-234">Esta ilustración muestra que se tardó aproximadamente 929 segundos en copiar 19 archivos de copia de seguridad de SAP HANA con un tamaño total de aproximadamente 230 GB en el recurso de archivos de Azure.</span><span class="sxs-lookup"><span data-stu-id="10e50-234">This figure shows that it took about 929 seconds to copy 19 SAP HANA backup files with a total size of roughly 230 GB to the Azure file share.</span></span>

![La estructura de directorios de origen en la VM de SAP HANA se copió en el recurso compartido de archivos de Azure](media/sap-hana-backup-file-level/image040.png)

<span data-ttu-id="10e50-236">En esta captura de pantalla, puede ver que la estructura de directorios de origen en la VM de SAP HANA se copió en el recurso compartido de archivos de Azure: un directorio (hana\_backup\_fsl\_15gb) y 19 archivos de copia de seguridad individuales.</span><span class="sxs-lookup"><span data-stu-id="10e50-236">In this screenshot, one can see that the source directory structure on the SAP HANA VM was copied to the Azure file share: one directory (hana\_backup\_fsl\_15gb) and 19 individual backup files.</span></span>

<span data-ttu-id="10e50-237">El almacenamiento de los archivos de copia de seguridad de SAP HANA en archivos de Azure podría ser una opción interesante en el futuro cuando las copias de seguridad de archivos de SAP HANA lo admitan directamente,</span><span class="sxs-lookup"><span data-stu-id="10e50-237">Storing SAP HANA backup files on Azure files could be an interesting option in the future when SAP HANA file backups support it directly.</span></span> <span data-ttu-id="10e50-238">o cuando sea posible montar archivos de Azure a través de NFS y el límite de cuota máxima sea considerablemente superior a 5 TB.</span><span class="sxs-lookup"><span data-stu-id="10e50-238">Or when it becomes possible to mount Azure files via NFS and the maximum quota limit is considerably higher than 5 TB.</span></span>

## <a name="next-steps"></a><span data-ttu-id="10e50-239">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="10e50-239">Next steps</span></span>
* <span data-ttu-id="10e50-240">[Guía de copia de seguridad de SAP HANA en Azure Virtual Machines](sap-hana-backup-guide.md) ofrece una introducción e información sobre los pasos iniciales.</span><span class="sxs-lookup"><span data-stu-id="10e50-240">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) gives an overview and information on getting started.</span></span>
* <span data-ttu-id="10e50-241">[Copia de seguridad de SAP HANA basada en instantáneas de almacenamiento](sap-hana-backup-storage-snapshots.md) describe la opción de copia de seguridad basada en instantáneas de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="10e50-241">[SAP HANA backup based on storage snapshots](sap-hana-backup-storage-snapshots.md) describes the storage snapshot-based backup option.</span></span>
* <span data-ttu-id="10e50-242">Para obtener información sobre cómo establecer la alta disponibilidad y planear la recuperación ante desastres de SAP HANA en Azure (instancias grandes), vea [Alta disponibilidad y recuperación ante desastres de SAP HANA en Azure (instancias grandes)](hana-overview-high-availability-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="10e50-242">To learn how to establish high availability and plan for disaster recovery of SAP HANA on Azure (large instances), see [SAP HANA (large instances) high availability and disaster recovery on Azure](hana-overview-high-availability-disaster-recovery.md).</span></span>

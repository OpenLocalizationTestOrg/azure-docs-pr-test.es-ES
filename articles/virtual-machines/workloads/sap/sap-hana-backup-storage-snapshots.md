---
title: "copia de seguridad de Azure de HANA aaaSAP basándose en instantáneas de almacenamiento | Documentos de Microsoft"
description: "Existen dos posibilidades de copia de seguridad principales para SAP HANA en Azure Virtual Machines. Este artículo trata sobre la copia de seguridad de SAP HANA basada en instantáneas de almacenamiento"
services: virtual-machines-linux
documentationcenter: 
author: hermanndms
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 3/13/2017
ms.author: rclaus
ms.openlocfilehash: 32bb80f5a928a2cf63699bfe4f4cf5bbad81e6fe
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="sap-hana-backup-based-on-storage-snapshots"></a><span data-ttu-id="d60e3-103">Copia de seguridad de SAP HANA basada en instantáneas de almacenamiento</span><span class="sxs-lookup"><span data-stu-id="d60e3-103">SAP HANA backup based on storage snapshots</span></span>

## <a name="introduction"></a><span data-ttu-id="d60e3-104">Introducción</span><span class="sxs-lookup"><span data-stu-id="d60e3-104">Introduction</span></span>

<span data-ttu-id="d60e3-105">Esto forma parte de una serie de tres partes de artículos relacionados sobre copia de seguridad de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="d60e3-105">This is part of a three-part series of related articles on SAP HANA backup.</span></span> <span data-ttu-id="d60e3-106">[Guía de backup para SAP HANA en máquinas virtuales Azure](sap-hana-backup-guide.md) proporciona una introducción e información sobre los pasos iniciales, y [SAP HANA Azure copia de seguridad en el nivel de archivo](sap-hana-backup-file-level.md) portadas Hola opción de copia de seguridad basado en el archivo.</span><span class="sxs-lookup"><span data-stu-id="d60e3-106">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) provides an overview and information on getting started, and [SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md) covers hello file-based backup option.</span></span>

<span data-ttu-id="d60e3-107">Cuando se usa una característica de copia de seguridad de máquina virtual para un sistema de demostración de all-in-one de instancia única, uno debe considere la posibilidad de realizar una copia de seguridad de la máquina virtual en lugar de administrar las copias de seguridad HANA en hello nivel del sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="d60e3-107">When using a VM backup feature for a single-instance all-in-one demo system, one should consider doing a VM backup instead of managing HANA backups at hello OS level.</span></span> <span data-ttu-id="d60e3-108">Una alternativa es copias de toocreate de tootake blobs de Azure instantáneas de discos virtuales individuales, que son la máquina virtual de tooa adjunto y mantener los archivos de datos HANA Hola.</span><span class="sxs-lookup"><span data-stu-id="d60e3-108">An alternative is tootake Azure blob snapshots toocreate copies of individual virtual disks, which are attached tooa virtual machine, and keep hello HANA data files.</span></span> <span data-ttu-id="d60e3-109">Pero un punto crítico es coherencia de la aplicación al crear una instantánea de copia de seguridad o un disco de máquina virtual mientras Hola sistema está encendido y ejecuta.</span><span class="sxs-lookup"><span data-stu-id="d60e3-109">But a critical point is app consistency when creating a VM backup or disk snapshot while hello system is up and running.</span></span> <span data-ttu-id="d60e3-110">Vea _coherencia de datos de SAP HANA al tomar instantáneas de almacenamiento_ en el artículo relacionado de hello [Guía de copia de seguridad para SAP HANA en máquinas virtuales Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="d60e3-110">See _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span> <span data-ttu-id="d60e3-111">SAP HANA tiene una característica que admite estos tipos de instantáneas de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="d60e3-111">SAP HANA has a feature that supports these kinds of storage snapshots.</span></span>

## <a name="sap-hana-snapshots"></a><span data-ttu-id="d60e3-112">Instantáneas de SAP HANA</span><span class="sxs-lookup"><span data-stu-id="d60e3-112">SAP HANA snapshots</span></span>

<span data-ttu-id="d60e3-113">Existe una característica en SAP HANA que admite la toma de una instantánea de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="d60e3-113">There is a feature in SAP HANA that supports taking a storage snapshot.</span></span> <span data-ttu-id="d60e3-114">Sin embargo, a partir de 2016 de diciembre, hay una restricción de sistemas de toosingle-container.</span><span class="sxs-lookup"><span data-stu-id="d60e3-114">However, as of December 2016, there is a restriction toosingle-container systems.</span></span> <span data-ttu-id="d60e3-115">Las configuraciones de contenedor de varios inquilinos no son compatibles con este tipo de instantánea de base de datos (vea [Creación de una instantánea de almacenamiento (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="d60e3-115">Multitenant container configurations do not support this kind of database snapshot (see [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm)).</span></span>

<span data-ttu-id="d60e3-116">Funciona como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="d60e3-116">It works as follows:</span></span>

- <span data-ttu-id="d60e3-117">Preparar para una instantánea de almacenamiento mediante la realización de instantáneas de SAP HANA Hola</span><span class="sxs-lookup"><span data-stu-id="d60e3-117">Prepare for a storage snapshot by initiating hello SAP HANA snapshot</span></span>
- <span data-ttu-id="d60e3-118">Instantánea de ejecución Hola almacenamiento (blobs de Azure instantánea, por ejemplo)</span><span class="sxs-lookup"><span data-stu-id="d60e3-118">Run hello storage snapshot (Azure blob snapshot, for example)</span></span>
- <span data-ttu-id="d60e3-119">Confirmar la instantánea de SAP HANA Hola</span><span class="sxs-lookup"><span data-stu-id="d60e3-119">Confirm hello SAP HANA snapshot</span></span>

![Esta captura de pantalla muestra que se puede crear una instantánea de datos SAP HANA a través de una instrucción SQL](media/sap-hana-backup-storage-snapshots/image011.png)

<span data-ttu-id="d60e3-121">Esta captura de pantalla muestra que se puede crear una instantánea de datos SAP HANA a través de una instrucción SQL.</span><span class="sxs-lookup"><span data-stu-id="d60e3-121">This screenshot shows that an SAP HANA data snapshot can be created via a SQL statement.</span></span>

![Hola, a continuación, de instantáneas también aparece en el catálogo de copia de seguridad de hello en SAP HANA Studio](media/sap-hana-backup-storage-snapshots/image012.png)

<span data-ttu-id="d60e3-123">Hola de instantáneas, a continuación, también aparece en el catálogo de copia de seguridad de hello en SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="d60e3-123">hello snapshot then also appears in hello backup catalog in SAP HANA Studio.</span></span>

![En el disco, instantánea Hola aparece en el directorio de datos de SAP HANA Hola](media/sap-hana-backup-storage-snapshots/image013.png)

<span data-ttu-id="d60e3-125">En el disco, instantánea Hola aparece en el directorio de datos de SAP HANA Hola.</span><span class="sxs-lookup"><span data-stu-id="d60e3-125">On disk, hello snapshot shows up in hello SAP HANA data directory.</span></span>

<span data-ttu-id="d60e3-126">Uno tiene tooensure que también se garantiza la coherencia de sistema de archivos de hello antes de ejecutar la instantánea del almacenamiento de hello mientras SAP HANA está en modo de preparación de instantánea de Hola.</span><span class="sxs-lookup"><span data-stu-id="d60e3-126">One has tooensure that hello file system consistency is also guaranteed before running hello storage snapshot while SAP HANA is in hello snapshot preparation mode.</span></span> <span data-ttu-id="d60e3-127">Vea _coherencia de datos de SAP HANA al tomar instantáneas de almacenamiento_ en el artículo relacionado de hello [Guía de copia de seguridad para SAP HANA en máquinas virtuales Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="d60e3-127">See _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span>

<span data-ttu-id="d60e3-128">Una vez que se realiza la instantánea del almacenamiento de hello, es fundamental tooconfirm Hola SAP HANA instantánea.</span><span class="sxs-lookup"><span data-stu-id="d60e3-128">Once hello storage snapshot is done, it is critical tooconfirm hello SAP HANA snapshot.</span></span> <span data-ttu-id="d60e3-129">Hay un toorun de instrucción SQL correspondiente: instantánea de cierre de datos de copia de seguridad (consulte [copia de seguridad de datos de instantánea instrucción CLOSE (copia de seguridad y recuperación)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/9739966f7f4bd5818769ad4ce6a7f8/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="d60e3-129">There is a corresponding SQL statement toorun: BACKUP DATA CLOSE SNAPSHOT (see [BACKUP DATA CLOSE SNAPSHOT Statement (Backup and Recovery)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/9739966f7f4bd5818769ad4ce6a7f8/content.htm)).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d60e3-130">Confirme la instantánea HANA Hola.</span><span class="sxs-lookup"><span data-stu-id="d60e3-130">Confirm hello HANA snapshot.</span></span> <span data-ttu-id="d60e3-131">Vencimiento demasiado&quot;copia en escritura&quot; SAP HANA pueden requerir espacio en disco adicional en instantánea-modo de preparación y no es posible toostart nuevas copias de seguridad hasta que se confirma la instantánea de SAP HANA Hola.</span><span class="sxs-lookup"><span data-stu-id="d60e3-131">Due too&quot;Copy-on-Write,&quot; SAP HANA might require additional disk space in snapshot-prepare mode, and it is not possible toostart new backups until hello SAP HANA snapshot is confirmed.</span></span>

## <a name="hana-vm-backup-via-azure-backup-service"></a><span data-ttu-id="d60e3-132">Copia de seguridad de VM de HANA a través del servicio Azure Backup</span><span class="sxs-lookup"><span data-stu-id="d60e3-132">HANA VM backup via Azure Backup service</span></span>

<span data-ttu-id="d60e3-133">A partir de 2016 de diciembre, el agente de copia de seguridad de Hola de hello servicio copia de seguridad de Azure no está disponible para las máquinas virtuales de Linux.</span><span class="sxs-lookup"><span data-stu-id="d60e3-133">As of December 2016, hello backup agent of hello Azure Backup service is not available for Linux VMs.</span></span> <span data-ttu-id="d60e3-134">uso de toomake de copia de seguridad de Azure en el nivel de archivo o directorio de hello, uno copiar archivos de copia de seguridad de SAP HANA tooa máquina virtual de Windows y, a continuación, usar el agente de copia de seguridad de Hola.</span><span class="sxs-lookup"><span data-stu-id="d60e3-134">toomake use of Azure backup on hello file/directory level, one would copy SAP HANA backup files tooa Windows VM and then use hello backup agent.</span></span> <span data-ttu-id="d60e3-135">En caso contrario, solo una copia completa de VM de Linux es posible a través del servicio de copia de seguridad de Azure Hola.</span><span class="sxs-lookup"><span data-stu-id="d60e3-135">Otherwise, only a full Linux VM backup is possible via hello Azure Backup service.</span></span> <span data-ttu-id="d60e3-136">Vea [información general de hello las características de copia de seguridad de Azure](../../../backup/backup-introduction-to-azure-backup.md) toofind más.</span><span class="sxs-lookup"><span data-stu-id="d60e3-136">See [Overview of hello features in Azure Backup](../../../backup/backup-introduction-to-azure-backup.md) toofind out more.</span></span>

<span data-ttu-id="d60e3-137">Hola servicio de copia de seguridad de Azure ofrece una opción tooback y restaurar una máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="d60e3-137">hello Azure Backup service offers an option tooback up and restore a VM.</span></span> <span data-ttu-id="d60e3-138">Para obtener más información acerca de este servicio y cómo funciona puede encontrarse en el artículo hello [planear la infraestructura de copia de seguridad de máquina virtual en Azure](../../../backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="d60e3-138">More information about this service and how it works can be found in hello article [Plan your VM backup infrastructure in Azure](../../../backup/backup-azure-vms-introduction.md).</span></span>

<span data-ttu-id="d60e3-139">Hay dos consideraciones importantes según toothat artículo:</span><span class="sxs-lookup"><span data-stu-id="d60e3-139">There are two important considerations according toothat article:</span></span>

<span data-ttu-id="d60e3-140">_&quot;Para las máquinas virtuales de Linux, solo las copias de seguridad coherentes para el archivo son posibles, como Linux no tiene un tooVSS de plataforma equivalente.&quot;_</span><span class="sxs-lookup"><span data-stu-id="d60e3-140">_&quot;For Linux virtual machines, only file-consistent backups are possible, since Linux does not have an equivalent platform tooVSS.&quot;_</span></span>

<span data-ttu-id="d60e3-141">_&quot;Las aplicaciones necesitan tooimplement sus propios &quot;corrección&quot; mecanismo en hello datos restaurados.&quot;_</span><span class="sxs-lookup"><span data-stu-id="d60e3-141">_&quot;Applications need tooimplement their own &quot;fix-up&quot; mechanism on hello restored data.&quot;_</span></span>

<span data-ttu-id="d60e3-142">Por lo tanto, uno tiene toomake que SAP HANA esté en un estado coherente en el disco cuando se inicia la copia de seguridad de Hola.</span><span class="sxs-lookup"><span data-stu-id="d60e3-142">Therefore, one has toomake sure SAP HANA is in a consistent state on disk when hello backup starts.</span></span> <span data-ttu-id="d60e3-143">Vea _instantáneas de SAP HANA_ descrita anteriormente en el documento de Hola.</span><span class="sxs-lookup"><span data-stu-id="d60e3-143">See _SAP HANA snapshots_ described earlier in hello document.</span></span> <span data-ttu-id="d60e3-144">Sin embargo, hay un posible problema cuando SAP HANA permanece en este modo de preparación de la instantánea.</span><span class="sxs-lookup"><span data-stu-id="d60e3-144">But there is a potential issue when SAP HANA stays in this snapshot preparation mode.</span></span> <span data-ttu-id="d60e3-145">Vea [Creación de una instantánea de almacenamiento (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="d60e3-145">See [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) for more information.</span></span>

<span data-ttu-id="d60e3-146">El artículo establece lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="d60e3-146">That article states:</span></span>

<span data-ttu-id="d60e3-147">_&quot;Se recomienda encarecidamente tooconfirm o abandonar una instantánea de almacenamiento tan pronto como sea posible después de que se ha creado. Mientras instantánea del almacenamiento de saludo se está preparando o creado, Hola está inmovilizados datos relevantes para la instantánea. Mientras que los datos relevantes para la instantánea de hello permanecen inmovilizados, todavía pueden realizarse cambios en la base de datos de Hola. Tales cambios no provocarán Hola inmovilizada toobe relativas a la instantánea de datos cambia. En su lugar, se escriben cambios hello toopositions Hola área de datos que son independientes de la instantánea de almacenamiento de Hola. Los cambios también se escriben toohello registro. Sin embargo, hello más Hola relativas a la instantánea datos se mantienen inmovilizados, Hola Hola más puede aumentar el volumen de datos.&quot;_</span><span class="sxs-lookup"><span data-stu-id="d60e3-147">_&quot;It is strongly recommended tooconfirm or abandon a storage snapshot as soon as possible after it has been created. While hello storage snapshot is being prepared or created, hello snapshot-relevant data is frozen. While hello snapshot-relevant data remains frozen, changes can still be made in hello database. Such changes will not cause hello frozen snapshot-relevant data toobe changed. Instead, hello changes are written toopositions in hello data area that are separate from hello storage snapshot. Changes are also written toohello log. However, hello longer hello snapshot-relevant data is kept frozen, hello more hello data volume can grow.&quot;_</span></span>

<span data-ttu-id="d60e3-148">Copia de seguridad de Azure se encarga de coherencia del sistema de archivos Hola a través de las extensiones de VM de Azure.</span><span class="sxs-lookup"><span data-stu-id="d60e3-148">Azure Backup takes care of hello file system consistency via Azure VM extensions.</span></span> <span data-ttu-id="d60e3-149">Estas extensiones no están disponible de forma independiente y solo funcionan en combinación con el servicio Azure Backup.</span><span class="sxs-lookup"><span data-stu-id="d60e3-149">These extensions are not available standalone, and work only in combination with Azure Backup service.</span></span> <span data-ttu-id="d60e3-150">Sin embargo, sigue siendo un toomanage requisito una coherencia de aplicaciones de SAP HANA instantánea tooguarantee.</span><span class="sxs-lookup"><span data-stu-id="d60e3-150">Nevertheless, it is still a requirement toomanage an SAP HANA snapshot tooguarantee app consistency.</span></span>

<span data-ttu-id="d60e3-151">Azure Backup tiene dos fases principales:</span><span class="sxs-lookup"><span data-stu-id="d60e3-151">Azure Backup has two major phases:</span></span>

- <span data-ttu-id="d60e3-152">Tomar la instantánea</span><span class="sxs-lookup"><span data-stu-id="d60e3-152">Take Snapshot</span></span>
- <span data-ttu-id="d60e3-153">Transferencia de datos toovault</span><span class="sxs-lookup"><span data-stu-id="d60e3-153">Transfer data toovault</span></span>

<span data-ttu-id="d60e3-154">Una vez completada la fase de servicio de copia de seguridad de Azure Hola de tomar una instantánea de esta manera, una pudo confirmar instantáneas de SAP HANA Hola.</span><span class="sxs-lookup"><span data-stu-id="d60e3-154">So one could confirm hello SAP HANA snapshot once hello Azure Backup service phase of taking a snapshot is completed.</span></span> <span data-ttu-id="d60e3-155">Es posible que tarde varios toosee minutos en hello portal de Azure.</span><span class="sxs-lookup"><span data-stu-id="d60e3-155">It might take several minutes toosee in hello Azure portal.</span></span>

![En esta ilustración se muestra parte de la lista de trabajos de copia de seguridad de Hola de un servicio de copia de seguridad de Azure](media/sap-hana-backup-storage-snapshots/image014.png)

<span data-ttu-id="d60e3-157">Esta ilustración muestra parte de la lista de trabajos de copia de seguridad de Hola de un servicio de copia de seguridad de Azure, lo cual era tooback usa una máquina virtual de prueba HANA Hola.</span><span class="sxs-lookup"><span data-stu-id="d60e3-157">This figure shows part of hello backup job list of an Azure Backup service, which was used tooback up hello HANA test VM.</span></span>

![Detalles del trabajo de tooshow hello, haga clic en trabajo de copia de seguridad de Hola Hola portal de Azure](media/sap-hana-backup-storage-snapshots/image015.png)

<span data-ttu-id="d60e3-159">Detalles del trabajo de tooshow hello, haga clic en trabajo de copia de seguridad de Hola Hola portal de Azure.</span><span class="sxs-lookup"><span data-stu-id="d60e3-159">tooshow hello job details, click hello backup job in hello Azure portal.</span></span> <span data-ttu-id="d60e3-160">En este caso, se puede ver que el Hola dos fases.</span><span class="sxs-lookup"><span data-stu-id="d60e3-160">Here, one can see hello two phases.</span></span> <span data-ttu-id="d60e3-161">Es posible que tarde unos minutos hasta que se muestra la fase de la instantánea de hello como completada.</span><span class="sxs-lookup"><span data-stu-id="d60e3-161">It might take a few minutes until it shows hello snapshot phase as completed.</span></span> <span data-ttu-id="d60e3-162">La mayoría de las veces de Hola se invierte en la fase de transferencia de datos de Hola.</span><span class="sxs-lookup"><span data-stu-id="d60e3-162">Most of hello time is spent in hello data transfer phase.</span></span>

## <a name="hana-vm-backup-automation-via-azure-backup-service"></a><span data-ttu-id="d60e3-163">Automatización de la copia de seguridad de VM de HANA a través del servicio Azure Backup</span><span class="sxs-lookup"><span data-stu-id="d60e3-163">HANA VM backup automation via Azure Backup service</span></span>

<span data-ttu-id="d60e3-164">Instantánea de SAP HANA Hola uno podría confirmar manualmente una vez que se completa la fase de instantánea de copia de seguridad de Azure de hello, como se describió anteriormente, pero resulta útil tooconsider automatización porque un administrador no puede supervisar la lista de trabajos de copia de seguridad de Hola Hola portal de Azure.</span><span class="sxs-lookup"><span data-stu-id="d60e3-164">One could manually confirm hello SAP HANA snapshot once hello Azure Backup snapshot phase is completed, as described earlier, but it is helpful tooconsider automation because an admin might not monitor hello backup job list in hello Azure portal.</span></span>

<span data-ttu-id="d60e3-165">Aquí aparece una explicación de cómo puede realizarse mediante cmdlets de Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="d60e3-165">Here is an explanation how it could be accomplished via Azure PowerShell cmdlets.</span></span>

![Un servicio de copia de seguridad de Azure se creó con nombre hello hana-copia de seguridad-almacén](media/sap-hana-backup-storage-snapshots/image016.png)

<span data-ttu-id="d60e3-167">Un servicio de copia de seguridad de Azure se creó con el nombre de hello &quot;hana-copia de seguridad-almacén.&quot; Hola comando PS **AzureRmRecoveryServicesVault de Get-nombre de almacén de copia de seguridad de hana** recupera Hola objeto correspondiente.</span><span class="sxs-lookup"><span data-stu-id="d60e3-167">An Azure Backup service was created with hello name &quot;hana-backup-vault.&quot; hello PS command **Get-AzureRmRecoveryServicesVault -Name hana-backup-vault** retrieves hello corresponding object.</span></span> <span data-ttu-id="d60e3-168">Este objeto es tooset usado Hola contexto de copia de seguridad, tal como se muestra en la figura siguiente Hola.</span><span class="sxs-lookup"><span data-stu-id="d60e3-168">This object is then used tooset hello backup context as seen on hello next figure.</span></span>

![Se pueden comprobar para el trabajo de copia de seguridad de hello actualmente en curso](media/sap-hana-backup-storage-snapshots/image017.png)

<span data-ttu-id="d60e3-170">Después establece el contexto correcto hello, uno puede comprobar si el trabajo de copia de seguridad de hello actualmente en curso y, a continuación, busque los detalles del trabajo.</span><span class="sxs-lookup"><span data-stu-id="d60e3-170">After setting hello correct context, one can check for hello backup job currently in progress, and then look for its job details.</span></span> <span data-ttu-id="d60e3-171">lista de la subtarea de Hello muestra si ya se ha completado fase de la instantánea de Hola de hello trabajo de copia de seguridad de Azure:</span><span class="sxs-lookup"><span data-stu-id="d60e3-171">hello subtask list shows if hello snapshot phase of hello Azure backup job is already completed:</span></span>

```
$ars = Get-AzureRmRecoveryServicesVault -Name hana-backup-vault
Set-AzureRmRecoveryServicesVaultContext -Vault $ars
$jid = Get-AzureRmRecoveryServicesBackupJob -Status InProgress | select -ExpandProperty jobid
Get-AzureRmRecoveryServicesBackupJobDetails -Jobid $jid | select -ExpandProperty subtasks
```

![Valor de Hola de sondeo en un bucle hasta que se convierta tooCompleted](media/sap-hana-backup-storage-snapshots/image018.png)

<span data-ttu-id="d60e3-173">Una vez que los detalles del trabajo Hola se almacenan en una variable, es simplemente PS sintaxis tooget toohello primera entrada de la matriz y recuperar el valor de estado de Hola.</span><span class="sxs-lookup"><span data-stu-id="d60e3-173">Once hello job details are stored in a variable, it is simply PS syntax tooget toohello first array entry and retrieve hello status value.</span></span> <span data-ttu-id="d60e3-174">script de automatización de hello toocomplete, valor de Hola de sondeo en un bucle hasta que se activa demasiado&quot;completado.&quot;</span><span class="sxs-lookup"><span data-stu-id="d60e3-174">toocomplete hello automation script, poll hello value in a loop until it turns too&quot;Completed.&quot;</span></span>

```
$st = Get-AzureRmRecoveryServicesBackupJobDetails -Jobid $jid | select -ExpandProperty subtasks
$st[0] | select -ExpandProperty status
```

## <a name="hana-license-key-and-vm-restore-via-azure-backup-service"></a><span data-ttu-id="d60e3-175">Restauración de VM y de la clave de licencia de HANA a través del servicio Azure Backup</span><span class="sxs-lookup"><span data-stu-id="d60e3-175">HANA license key and VM restore via Azure Backup service</span></span>

<span data-ttu-id="d60e3-176">Hola servicio de copia de seguridad de Azure está diseñado toocreate una nueva máquina virtual durante la restauración.</span><span class="sxs-lookup"><span data-stu-id="d60e3-176">hello Azure Backup service is designed toocreate a new VM during restore.</span></span> <span data-ttu-id="d60e3-177">No hay ningún plan en este momento toodo una &quot;in situ&quot; restauración de una máquina virtual de Azure existente.</span><span class="sxs-lookup"><span data-stu-id="d60e3-177">There is no plan right now toodo an &quot;in-place&quot; restore of an existing Azure VM.</span></span>

![Esta ilustración muestra la opción de restauración de Hola de hello servicio de Azure en hello portal de Azure](media/sap-hana-backup-storage-snapshots/image019.png)

<span data-ttu-id="d60e3-179">Esta ilustración muestra la opción de restauración de Hola de hello servicio de Azure en hello portal de Azure.</span><span class="sxs-lookup"><span data-stu-id="d60e3-179">This figure shows hello restore option of hello Azure service in hello Azure portal.</span></span> <span data-ttu-id="d60e3-180">Se puede elegir entre crear una máquina virtual durante la restauración o restauración de discos de Hola.</span><span class="sxs-lookup"><span data-stu-id="d60e3-180">One can choose between creating a VM during restore or restoring hello disks.</span></span> <span data-ttu-id="d60e3-181">Después de restaurar discos hello, resulta toocreate siendo necesaria una nueva máquina virtual en la parte superior.</span><span class="sxs-lookup"><span data-stu-id="d60e3-181">After restoring hello disks, it is still necessary toocreate a new VM on top of it.</span></span> <span data-ttu-id="d60e3-182">Cada vez que se crea una nueva máquina virtual en los cambios de hello Azure únicos Id. de máquina virtual (vea [acceso y uso de Azure VM Id. único](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/)).</span><span class="sxs-lookup"><span data-stu-id="d60e3-182">Whenever a new VM gets created on Azure hello unique VM ID changes (see [Accessing and Using Azure VM Unique ID](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/)).</span></span>

![Esta ilustración muestra hello Id. único de máquina virtual de Azure antes y después de la restauración de Hola a través del servicio de copia de seguridad de Azure](media/sap-hana-backup-storage-snapshots/image020.png)

<span data-ttu-id="d60e3-184">Esta ilustración muestra el identificador único de máquina virtual de Azure de Hola antes y después de la restauración de Hola a través del servicio de copia de seguridad de Azure.</span><span class="sxs-lookup"><span data-stu-id="d60e3-184">This figure shows hello Azure VM unique ID before and after hello restore via Azure Backup service.</span></span> <span data-ttu-id="d60e3-185">clave de hardware SAP de Hello, que se utiliza para SAP licencias, usa este identificador único de máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="d60e3-185">hello SAP hardware key, which is used for SAP licensing, is using this unique VM ID.</span></span> <span data-ttu-id="d60e3-186">En consecuencia, una nueva licencia SAP tiene toobe instalado después de una restauración de la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="d60e3-186">As a consequence, a new SAP license has toobe installed after a VM restore.</span></span>

<span data-ttu-id="d60e3-187">Una nueva característica de copia de seguridad de Azure se presenta en modo de vista previa durante la creación de hello de esta guía de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="d60e3-187">A new Azure Backup feature was presented in preview mode during hello creation of this backup guide.</span></span> <span data-ttu-id="d60e3-188">Permite que una restauración de nivel de archivo basada en la instantánea de la VM de hello tomada de hello VM copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="d60e3-188">It allows a file level restore based on hello VM snapshot that was taken for hello VM backup.</span></span> <span data-ttu-id="d60e3-189">Esto evita la necesidad de hello toodeploy una nueva máquina virtual y, por tanto, permanece Id. de máquina virtual única de Hola Hola mismo y no se requiere ninguna nueva clave de licencia de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="d60e3-189">This avoids hello need toodeploy a new VM, and therefore hello unique VM ID stays hello same and no new SAP HANA license key is required.</span></span> <span data-ttu-id="d60e3-190">Una vez está probado completamente, se proporcionará más documentación sobre esta característica.</span><span class="sxs-lookup"><span data-stu-id="d60e3-190">More documentation on this feature will be provided after it is fully tested.</span></span>

<span data-ttu-id="d60e3-191">Copia de seguridad de Azure finalmente permitirá copia de seguridad de los discos virtuales de Azure individuales, además de archivos y directorios desde dentro de Hola máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="d60e3-191">Azure Backup will eventually allow backup of individual Azure virtual disks, plus files and directories from inside hello VM.</span></span> <span data-ttu-id="d60e3-192">Una ventaja fundamental de copia de seguridad de Azure es la administración de todas las copias de seguridad de hello, evita que los clientes de hello tenga toodo.</span><span class="sxs-lookup"><span data-stu-id="d60e3-192">A major advantage of Azure Backup is its management of all hello backups, saving hello customer from having toodo it.</span></span> <span data-ttu-id="d60e3-193">Si necesita una restauración, copia de seguridad de Azure seleccionará hello toouse de copia de seguridad correcta.</span><span class="sxs-lookup"><span data-stu-id="d60e3-193">If a restore becomes necessary, Azure Backup will select hello correct backup toouse.</span></span>

## <a name="sap-hana-vm-backup-via-manual-disk-snapshot"></a><span data-ttu-id="d60e3-194">Copia de seguridad de VM de SAP HANA a través de una instantánea de disco manual</span><span class="sxs-lookup"><span data-stu-id="d60e3-194">SAP HANA VM backup via manual disk snapshot</span></span>

<span data-ttu-id="d60e3-195">En lugar de usar el servicio de copia de seguridad de Azure de hello, uno podría configurar una solución de copia de seguridad individual mediante la creación de instantáneas de blob de discos duros virtuales de Azure manualmente a través de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="d60e3-195">Instead of using hello Azure Backup service, one could configure an individual backup solution by creating blob snapshots of Azure VHDs manually via PowerShell.</span></span> <span data-ttu-id="d60e3-196">Vea [mediante instantáneas de blob con PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) para obtener una descripción de los pasos de Hola.</span><span class="sxs-lookup"><span data-stu-id="d60e3-196">See [Using blob snapshots with PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) for a description of hello steps.</span></span>

<span data-ttu-id="d60e3-197">Proporciona mayor flexibilidad, pero no se resuelven los problemas de hello descritos anteriormente en este documento:</span><span class="sxs-lookup"><span data-stu-id="d60e3-197">It provides more flexibility but does not resolve hello issues explained earlier in this document:</span></span>

- <span data-ttu-id="d60e3-198">Puede que tenga que asegurarse de que SAP HANA tiene un estado coherente</span><span class="sxs-lookup"><span data-stu-id="d60e3-198">One still must make sure that SAP HANA is in a consistent state</span></span>
- <span data-ttu-id="d60e3-199">no se puede sobrescribir el disco del sistema operativo Hola aunque exista Hola que VM está desasignada debido a un error que indica que una concesión.</span><span class="sxs-lookup"><span data-stu-id="d60e3-199">hello OS disk cannot be overwritten even if hello VM is deallocated because of an error stating that a lease exists.</span></span> <span data-ttu-id="d60e3-200">Solo funciona después de eliminar Hola VM, Esto conduciría tooa nuevo único Id. de máquina virtual y Hola necesidad tooinstall una nueva licencia SAP.</span><span class="sxs-lookup"><span data-stu-id="d60e3-200">It only works after deleting hello VM, which would lead tooa new unique VM ID and hello need tooinstall a new SAP license.</span></span>

![Es posible toorestore discos de datos de solo Hola de una VM de Azure](media/sap-hana-backup-storage-snapshots/image021.png)

<span data-ttu-id="d60e3-202">Es posible toorestore solo discos de datos de Hola de una máquina virtual de Azure, evitar el problema de Hola de obtener un nuevo identificador único de máquina virtual y, por lo tanto, invalida la licencia SAP de hello:</span><span class="sxs-lookup"><span data-stu-id="d60e3-202">It is possible toorestore only hello data disks of an Azure VM, avoiding hello problem of getting a new unique VM ID and, therefore, invalidated hello SAP license:</span></span>

- <span data-ttu-id="d60e3-203">Para pruebas de hello, dos discos de datos de Azure se adjunta tooa VM y RAID de software se definieron encima de ellos</span><span class="sxs-lookup"><span data-stu-id="d60e3-203">For hello test, two Azure data disks were attached tooa VM and software RAID was defined on top of them</span></span> 
- <span data-ttu-id="d60e3-204">Se confirmó que SAP HANA se encontraba en un estado coherente mediante la característica de la instantánea de SAP HANA</span><span class="sxs-lookup"><span data-stu-id="d60e3-204">It was confirmed that SAP HANA was in a consistent state by SAP HANA snapshot feature</span></span>
- <span data-ttu-id="d60e3-205">Inmovilizar de sistema de archivos (vea _coherencia de datos de SAP HANA al tomar instantáneas de almacenamiento_ en el artículo relacionado de hello [Guía de copia de seguridad para SAP HANA en máquinas virtuales Azure](sap-hana-backup-guide.md))</span><span class="sxs-lookup"><span data-stu-id="d60e3-205">File system freeze (see _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md))</span></span>
- <span data-ttu-id="d60e3-206">Se toman instantáneas de blob desde ambos discos de datos</span><span class="sxs-lookup"><span data-stu-id="d60e3-206">Blob snapshots were taken from both data disks</span></span>
- <span data-ttu-id="d60e3-207">Cancelación de la inmovilización del sistema de archivos</span><span class="sxs-lookup"><span data-stu-id="d60e3-207">File system unfreeze</span></span>
- <span data-ttu-id="d60e3-208">Confirmación de la instantánea de SAP HANA</span><span class="sxs-lookup"><span data-stu-id="d60e3-208">SAP HANA snapshot confirmation</span></span>
- <span data-ttu-id="d60e3-209">discos de datos de toorestore hello, Hola VM se cerró y ambos discos desasociar</span><span class="sxs-lookup"><span data-stu-id="d60e3-209">toorestore hello data disks, hello VM was shut down and both disks detached</span></span>
- <span data-ttu-id="d60e3-210">Después de la separación discos hello, se sobrescribe con instantáneas de blob anterior de Hola</span><span class="sxs-lookup"><span data-stu-id="d60e3-210">After detaching hello disks, they were overwritten with hello former blob snapshots</span></span>
- <span data-ttu-id="d60e3-211">A continuación, se adjunta Hola restaurar los discos virtuales nuevo toohello VM</span><span class="sxs-lookup"><span data-stu-id="d60e3-211">Then hello restored virtual disks were attached again toohello VM</span></span>
- <span data-ttu-id="d60e3-212">Después de hora de la instantánea inicial Hola VM, todo el contenido de software de hello RAID funcionaba bien y se vuelve a establecer toohello blob</span><span class="sxs-lookup"><span data-stu-id="d60e3-212">After starting hello VM, everything on hello software RAID worked fine and was set back toohello blob snapshot time</span></span>
- <span data-ttu-id="d60e3-213">HANA se estableció instantánea HANA toohello</span><span class="sxs-lookup"><span data-stu-id="d60e3-213">HANA was set back toohello HANA snapshot</span></span>

<span data-ttu-id="d60e3-214">Si bien era posible tooshut hacia abajo de SAP HANA antes de las instantáneas de blob de Hola, procedimiento Hola sería menos compleja.</span><span class="sxs-lookup"><span data-stu-id="d60e3-214">If it was possible tooshut down SAP HANA before hello blob snapshots, hello procedure would be less complex.</span></span> <span data-ttu-id="d60e3-215">En ese caso, uno podría omitir la instantánea HANA hello y, si nada más está ocurriendo en sistema de hello, también omitir inmovilización de sistema de archivos de Hola.</span><span class="sxs-lookup"><span data-stu-id="d60e3-215">In that case, one could skip hello HANA snapshot and, if nothing else is going on in hello system, also skip hello file system freeze.</span></span> <span data-ttu-id="d60e3-216">Complejidad agregada entra en la imagen de hello cuando resulta necesario toodo instantáneas mientras todo lo que está en línea.</span><span class="sxs-lookup"><span data-stu-id="d60e3-216">Added complexity comes into hello picture when it is necessary toodo snapshots while everything is online.</span></span> <span data-ttu-id="d60e3-217">Vea _coherencia de datos de SAP HANA al tomar instantáneas de almacenamiento_ en el artículo relacionado de hello [Guía de copia de seguridad para SAP HANA en máquinas virtuales Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="d60e3-217">See _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="d60e3-218">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="d60e3-218">Next steps</span></span>
* <span data-ttu-id="d60e3-219">[Guía de copia de seguridad de SAP HANA en Azure Virtual Machines](sap-hana-backup-guide.md) ofrece una introducción e información sobre los pasos iniciales.</span><span class="sxs-lookup"><span data-stu-id="d60e3-219">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) gives an overview and information on getting started.</span></span>
* <span data-ttu-id="d60e3-220">[Copia de seguridad de SAP HANA en función de nivel de archivo](sap-hana-backup-file-level.md) portadas Hola opción de copia de seguridad basado en el archivo.</span><span class="sxs-lookup"><span data-stu-id="d60e3-220">[SAP HANA backup based on file level](sap-hana-backup-file-level.md) covers hello file-based backup option.</span></span>
* <span data-ttu-id="d60e3-221">toolearn tooestablish alta disponibilidad y el plan de recuperación ante desastres de SAP HANA en Azure (instancias grandes), vea [SAP HANA (instancias de gran tamaño) alta disponibilidad y recuperación ante desastres en Azure](hana-overview-high-availability-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="d60e3-221">toolearn how tooestablish high availability and plan for disaster recovery of SAP HANA on Azure (large instances), see [SAP HANA (large instances) high availability and disaster recovery on Azure](hana-overview-high-availability-disaster-recovery.md).</span></span>

---
title: "Ejecución de Cassandra con Linux en Azure | Microsoft Docs"
description: "Ejecución de un clúster de Cassandra en Linux en las máquinas virtuales Azure desde la aplicación Node.js."
services: virtual-machines-linux
documentationcenter: nodejs
author: tomarcher
manager: routlaw
editor: 
tags: azure-service-management
ms.assetid: 30de1f29-e97d-492f-ae34-41ec83488de0
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 08/17/2017
ms.author: tarcher
ms.openlocfilehash: 1ff3d77ced6c9d90029b251490c05e52d9b43515
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/29/2017
---
# <a name="running-cassandra-with-linux-on-azure-and-accessing-it-from-nodejs"></a><span data-ttu-id="71bf3-103">Ejecución de Cassandra con Linux en Azure y acceso desde Node.js</span><span class="sxs-lookup"><span data-stu-id="71bf3-103">Running Cassandra with Linux on Azure and Accessing it from Node.js</span></span>
> [!IMPORTANT] 
> <span data-ttu-id="71bf3-104">Azure tiene dos modelos de implementación diferentes para crear recursos y trabajar con ellos: [Resource Manager y el clásico](../../../resource-manager-deployment-model.md).</span><span class="sxs-lookup"><span data-stu-id="71bf3-104">Azure has two different deployment models for creating and working with resources: [Resource Manager and Classic](../../../resource-manager-deployment-model.md).</span></span> <span data-ttu-id="71bf3-105">En este artículo se trata el modelo de implementación clásico.</span><span class="sxs-lookup"><span data-stu-id="71bf3-105">This article covers using the Classic deployment model.</span></span> <span data-ttu-id="71bf3-106">Microsoft recomienda que las implementaciones más recientes usen el modelo del Administrador de recursos.</span><span class="sxs-lookup"><span data-stu-id="71bf3-106">Microsoft recommends that most new deployments use the Resource Manager model.</span></span> <span data-ttu-id="71bf3-107">Consulte las plantillas de Resource Manager para [Datastax Enterprise](https://azure.microsoft.com/documentation/templates/datastax) y el [clúster de Spark y Cassandra en CentOS](https://azure.microsoft.com/documentation/templates/spark-and-cassandra-on-centos/).</span><span class="sxs-lookup"><span data-stu-id="71bf3-107">See Resource Manager templates for [Datastax Enterprise](https://azure.microsoft.com/documentation/templates/datastax) and [Spark cluster and Cassandra on CentOS](https://azure.microsoft.com/documentation/templates/spark-and-cassandra-on-centos/).</span></span>

## <a name="overview"></a><span data-ttu-id="71bf3-108">Información general</span><span class="sxs-lookup"><span data-stu-id="71bf3-108">Overview</span></span>
<span data-ttu-id="71bf3-109">Microsoft Azure es una plataforma de nube abierta que ejecuta tanto software de Microsoft como ajeno a Microsoft que incluye sistemas operativos, servidores de aplicaciones, middleware de mensajería, así como bases de datos SQL y NoSQL tanto de modelos comerciales como de código abierto.</span><span class="sxs-lookup"><span data-stu-id="71bf3-109">Microsoft Azure is an open cloud platform that runs both Microsoft as well as non-Microsoft software which  includes operating systems, application servers, messaging middleware as well as SQL and NoSQL databases from both commercial and open source models.</span></span> <span data-ttu-id="71bf3-110">Crear servicios resistentes en nubes públicas, incluido Azure, requiere una cuidadosa planeación y una arquitectura deliberada para ambos servidores de aplicaciones, así como capas de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="71bf3-110">Building resilient services on public clouds including Azure requires careful planning and deliberate architecture for both applications servers as well storage layers.</span></span> <span data-ttu-id="71bf3-111">La arquitectura de almacenamiento distribuido de Cassandra ayuda naturalmente a crear sistemas de alta disponibilidad que son tolerantes a errores de clúster.</span><span class="sxs-lookup"><span data-stu-id="71bf3-111">Cassandra’s distributed storage architecture naturally helps in building highly available systems that are fault tolerant for cluster failures.</span></span> <span data-ttu-id="71bf3-112">Cassandra es una base de datos NoSQL de escala de nube mantenida por Apache Software Foundation en cassandra.apache.org; Cassandra está escrita en Java y, por tanto, se ejecuta tanto en plataformas Windows como Linux.</span><span class="sxs-lookup"><span data-stu-id="71bf3-112">Cassandra is a cloud scale NoSQL database maintained by Apache Software Foundation at cassandra.apache.org; Cassandra is written in Java and hence runs on both on Windows as well as Linux platforms.</span></span>

<span data-ttu-id="71bf3-113">El enfoque de este artículo es mostrar la implementación de Cassandra en Ubuntu como un clúster único y de centro de múltiples datos que aproveche las máquinas virtuales y las redes virtuales de Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="71bf3-113">The focus of this article is to show Cassandra deployment on Ubuntu as a single and multi-data center cluster leveraging Microsoft Azure Virtual Machines and Virtual Networks.</span></span> <span data-ttu-id="71bf3-114">La implementación del clúster para cargas de trabajo optimizadas de producción no se trata en este artículo, ya que requiere la configuración del nodo de múltiples discos, el diseño de la topología adecuada y el modelado de los datos para admitir la replicación, la coherencia de datos, el rendimiento y los requisitos de alta disponibilidad necesarios.</span><span class="sxs-lookup"><span data-stu-id="71bf3-114">The cluster deployment for production optimized workloads is out of scope of this article as it requires multi-disk node configuration, appropriate ring topology design and data modeling to support the needed replication, data consistency, throughput and high availability requirements.</span></span>

<span data-ttu-id="71bf3-115">Este artículo se centra fundamentalmente en mostrar lo relacionado con la compilación del clúster de Cassandra en comparación con Docker, Chef o Puppet, por lo que la implementación de la infraestructura se vuelve mucho más sencilla.</span><span class="sxs-lookup"><span data-stu-id="71bf3-115">This article takes a fundamental approach to show what is involved in building the Cassandra cluster compared Docker, Chef or Puppet which can make the infrastructure deployment a lot easier.</span></span>  

## <a name="the-deployment-models"></a><span data-ttu-id="71bf3-116">Los modelos de implementación</span><span class="sxs-lookup"><span data-stu-id="71bf3-116">The Deployment Models</span></span>
<span data-ttu-id="71bf3-117">Las redes de Microsoft Azure permiten la implementación de clústeres privados aislados, el acceso de los cuales puede restringirse para lograr una mejor seguridad de la red.</span><span class="sxs-lookup"><span data-stu-id="71bf3-117">Microsoft Azure networking allows the deployment of isolated private clusters, the access of which can be restricted to attain fine grained network security.</span></span>  <span data-ttu-id="71bf3-118">Dado que este artículo trata de mostrar la implementación de Cassandra en un nivel fundamental, no nos centraremos en el nivel de coherencia y el diseño de almacenamiento óptimo para el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="71bf3-118">Since this article is about showing the Cassandra deployment at a fundamental level, we will not focus on the consistency level and the optimal storage design for throughput.</span></span> <span data-ttu-id="71bf3-119">Esta es la lista de los requisitos de red de nuestro clúster hipotético:</span><span class="sxs-lookup"><span data-stu-id="71bf3-119">Here is the list of networking requirements for our hypothetical cluster:</span></span>

* <span data-ttu-id="71bf3-120">Los sistemas externos no tienen acceso a la base de datos Cassandra desde dentro o fuera de Azure</span><span class="sxs-lookup"><span data-stu-id="71bf3-120">External systems can’t access Cassandra database from within or outside Azure</span></span>
* <span data-ttu-id="71bf3-121">El clúster de Cassandra tiene que estar detrás de un equilibrador de carga para el tráfico</span><span class="sxs-lookup"><span data-stu-id="71bf3-121">Cassandra cluster has to be behind a load balancer for thrift traffic</span></span>
* <span data-ttu-id="71bf3-122">Implemente nodos de Cassandra en dos grupos en cada centro de datos para una disponibilidad mejorada</span><span class="sxs-lookup"><span data-stu-id="71bf3-122">Deploy Cassandra nodes in two groups in each data center for an enhanced cluster availability</span></span>
* <span data-ttu-id="71bf3-123">Bloquee el clúster para que solo la granja de servidores de aplicación tenga acceso a la base de datos directamente</span><span class="sxs-lookup"><span data-stu-id="71bf3-123">Lock down the cluster so that only application server farm has access to the database directly</span></span>
* <span data-ttu-id="71bf3-124">Ningún extremo de red pública distinto a SSH</span><span class="sxs-lookup"><span data-stu-id="71bf3-124">No public networking endpoints other than SSH</span></span>
* <span data-ttu-id="71bf3-125">Cada nodo de Cassandra necesita una dirección IP interna fija</span><span class="sxs-lookup"><span data-stu-id="71bf3-125">Each Cassandra node needs a fixed internal IP address</span></span>

<span data-ttu-id="71bf3-126">Cassandra puede implementarse en una sola región de Azure o para varias regiones, según la naturaleza distribuida de la carga de trabajo.</span><span class="sxs-lookup"><span data-stu-id="71bf3-126">Cassandra can be deployed to a single Azure region or to multiple regions based on the distributed nature of the workload.</span></span> <span data-ttu-id="71bf3-127">El modelo de implementación de varias regiones puede aprovecharse para dar servicio a los usuarios finales más cercanos a una geografía determinada a través de la misma infraestructura de Cassandra.</span><span class="sxs-lookup"><span data-stu-id="71bf3-127">Multi-region deployment model can be leveraged to serve end users closer to a particular geography through the same Cassandra infrastructure.</span></span> <span data-ttu-id="71bf3-128">La replicación de nodos integrada de Cassandra se encarga de la sincronización de escrituras de varios maestros procedentes de varios centros de datos y presenta una vista coherente de los datos a las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="71bf3-128">Cassandra’s built-in node replication takes care of the synchronization of multi-master writes originating from multiple data centers and presents a consistent view of the data to applications.</span></span> <span data-ttu-id="71bf3-129">La implementación de varias regiones también puede ayudar a mitigar el riesgo de las interrupciones de servicio de Azure más amplias.</span><span class="sxs-lookup"><span data-stu-id="71bf3-129">Multi-region deployment can also help with the risk mitigation of the broader Azure service outages.</span></span> <span data-ttu-id="71bf3-130">La coherencia ajustable de Cassandra y la topología de la replicación le ayudará a satisfacer distintas necesidades RPO de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="71bf3-130">Cassandra’s tunable consistency and replication topology will help in meeting diverse RPO needs of applications.</span></span>

### <a name="single-region-deployment"></a><span data-ttu-id="71bf3-131">Implementación de una sola región</span><span class="sxs-lookup"><span data-stu-id="71bf3-131">Single Region Deployment</span></span>
<span data-ttu-id="71bf3-132">Se iniciará con una implementación de una sola región y recopilará lo aprendido en la creación de un modelo de varias regiones.</span><span class="sxs-lookup"><span data-stu-id="71bf3-132">We will start with a single region deployment and harvest the learnings in creating a multi-region model.</span></span> <span data-ttu-id="71bf3-133">La red virtual de Azure se utilizará para crear subredes aisladas, de modo que se pueden cumplir los requisitos de seguridad de red mencionados anteriormente.</span><span class="sxs-lookup"><span data-stu-id="71bf3-133">Azure virtual networking will be used to create isolated subnets so that the network security requirements mentioned above can be met.</span></span>  <span data-ttu-id="71bf3-134">El proceso descrito en la creación de la implementación de región única usa Ubuntu 14.04 LTS y Cassandra 2.08; sin embargo, el proceso puede adoptar fácilmente las otras variantes de Linux.</span><span class="sxs-lookup"><span data-stu-id="71bf3-134">The process described in creating the single region deployment uses Ubuntu 14.04 LTS and Cassandra 2.08; however, the process can easily be adopted to the other Linux variants.</span></span> <span data-ttu-id="71bf3-135">Estas son algunas de las características sistémicas de la implementación de una sola región.</span><span class="sxs-lookup"><span data-stu-id="71bf3-135">The following are some of the systemic characteristics of the single region deployment.</span></span>  

<span data-ttu-id="71bf3-136">**Alta disponibilidad:** Los nodos de Cassandra que se muestran en la Ilustración 1 se implementan en dos conjuntos de disponibilidad para que los nodos se repartan entre varios dominios de error para una alta disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="71bf3-136">**High Availability:** The Cassandra nodes shown in the Figure 1 are deployed to two availability sets so that the nodes are spread between multiple fault domains for high availability.</span></span> <span data-ttu-id="71bf3-137">Las máquinas virtuales que se anotan con cada conjunto de disponibilidad se asignan a dos dominios de error.</span><span class="sxs-lookup"><span data-stu-id="71bf3-137">VMs annotated with each availability set is mapped to 2 fault domains.</span></span>  <span data-ttu-id="71bf3-138">Microsoft Azure utiliza el concepto de dominio de error para administrar el tiempo de inactividad no planeado (por ejemplo, errores de hardware o software) mientras que el concepto de dominio de actualización (por ejemplo, revisiones y actualizaciones del sistema operativo de host o invitado, actualizaciones de aplicaciones) se utiliza para administrar el tiempo de inactividad programado.</span><span class="sxs-lookup"><span data-stu-id="71bf3-138">Microsoft Azure uses the concept of fault domain to manage unplanned down time (e.g. hardware or software failures) while the concept of upgrade domain (e.g. host or guest OS patching/upgrades, application upgrades) is used for managing scheduled down time.</span></span> <span data-ttu-id="71bf3-139">Consulte [Recuperación ante desastres y alta disponibilidad para aplicaciones de Azure](http://msdn.microsoft.com/library/dn251004.aspx) para el rol de dominios de error y de actualización a fin de alcanzar alta disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="71bf3-139">Please see [Disaster Recovery and High Availability for Azure Applications](http://msdn.microsoft.com/library/dn251004.aspx) for the role of fault and upgrade domains in attaining high availability.</span></span>

![Implementación de una sola región](./media/cassandra-nodejs/cassandra-linux1.png)

<span data-ttu-id="71bf3-141">Ilustración 1: Implementación de una sola región</span><span class="sxs-lookup"><span data-stu-id="71bf3-141">Figure 1: Single region deployment</span></span>

<span data-ttu-id="71bf3-142">Tenga en cuenta que en el momento de redactar este artículo, Azure no permite la asignación explícita de un grupo de máquinas virtuales a un dominio de error concreto; por lo tanto, incluso con el modelo de implementación que se muestra en la Figura 1, es estadísticamente probable que todas las máquinas virtuales se puedan asignar a dos dominios de error en lugar de a cuatro.</span><span class="sxs-lookup"><span data-stu-id="71bf3-142">Note that at the time of this writing, Azure doesn’t allow the explicit mapping of a group of VMs to a specific fault domain; consequently, even with the deployment model shown in Figure 1, it is statistically probable that all the virtual machines may be mapped to two fault domains instead of four.</span></span>

<span data-ttu-id="71bf3-143">**Tráfico de Thrift de equilibrio de carga:** Las bibliotecas de cliente de Thrift en el servidor web se conectan al clúster a través de un equilibrador de carga interno.</span><span class="sxs-lookup"><span data-stu-id="71bf3-143">**Load Balancing Thrift Traffic:** Thrift client libraries inside the web server connect to the cluster through an internal load balancer.</span></span> <span data-ttu-id="71bf3-144">Esto requiere el proceso de agregar el equilibrador de carga interno a la subred "datos" (consulte la Ilustración 1) en el contexto del servicio en la nube que hospeda el clúster de Cassandra.</span><span class="sxs-lookup"><span data-stu-id="71bf3-144">This requires the process of adding the internal load balancer to the “data” subnet (refer Figure 1) in the context of the cloud service hosting the Cassandra cluster.</span></span> <span data-ttu-id="71bf3-145">Una vez definido el equilibrador de carga interno, cada nodo requiere agregar el extremo con equilibrio de carga con las anotaciones de un conjunto con equilibrio de carga con el nombre del equilibrador de carga previamente definido.</span><span class="sxs-lookup"><span data-stu-id="71bf3-145">Once the internal load balancer is defined, each node requires the load balanced endpoint to be added with the annotations of a load balanced set with previously defined load balancer name.</span></span> <span data-ttu-id="71bf3-146">Consulte [Equilibrio de carga interno de Azure ](../../../load-balancer/load-balancer-internal-overview.md)para obtener más detalles.</span><span class="sxs-lookup"><span data-stu-id="71bf3-146">See [Azure Internal Load Balancing ](../../../load-balancer/load-balancer-internal-overview.md)for more details.</span></span>

<span data-ttu-id="71bf3-147">**Valores de inicialización de clúster:** Es importante seleccionar los nodos más disponibles para los valores de inicialización, ya que los nuevos nodos se comunicarán con los nodos de valores de inicialización para detectar la topología del clúster.</span><span class="sxs-lookup"><span data-stu-id="71bf3-147">**Cluster Seeds:** It is important to select the most highly available nodes for seeds as the new nodes will communicate with seed nodes to discover the topology of the cluster.</span></span> <span data-ttu-id="71bf3-148">Un nodo de cada conjunto de disponibilidad se designa como nodos de valores de inicialización para evitar un punto único de error.</span><span class="sxs-lookup"><span data-stu-id="71bf3-148">One node from each availability set is designated as seed nodes to avoid single point of failure.</span></span>

<span data-ttu-id="71bf3-149">**Factor de replicación y nivel de coherencia:** La durabilidad de los datos y la alta disponibilidad de la integración de Cassandra se caracterizan por el factor de replicación (RF: número de copias de cada fila almacenada en el clúster) y el nivel de coherencia (número de réplicas para leer/escribir antes de devolver el resultado al autor de llamada).</span><span class="sxs-lookup"><span data-stu-id="71bf3-149">**Replication Factor and Consistency Level:** Cassandra’s build-in high-availability and data durability is characterized by the Replication Factor (RF - number of copies of each row stored on the cluster) and Consistency Level (number of replicas to be read/written before returning the result to the caller).</span></span> <span data-ttu-id="71bf3-150">El factor de replicación se especifica durante la creación del espacio de claves (similar a una base de datos relacional), mientras que el nivel de coherencia se especifica al emitir la consulta CRUD.</span><span class="sxs-lookup"><span data-stu-id="71bf3-150">Replication factor is specified during the KEYSPACE (similar to a relational database) creation whereas the consistency level is specified while issuing the CRUD query.</span></span> <span data-ttu-id="71bf3-151">Consulte la documentación de Cassandra en [Configuring for Consistency](http://www.datastax.com/documentation/cassandra/2.0/cassandra/dml/dml_config_consistency_c.html) (Configuración de coherencia) para obtener detalles de la coherencia y la fórmula de cálculo de quórum.</span><span class="sxs-lookup"><span data-stu-id="71bf3-151">See Cassandra documentation at [Configuring for Consistency](http://www.datastax.com/documentation/cassandra/2.0/cassandra/dml/dml_config_consistency_c.html) for consistency details and the formula for quorum computation.</span></span>

<span data-ttu-id="71bf3-152">Cassandra admite dos tipos de modelos de integridad de datos: coherencia y coherencia eventual; el factor de replicación y el nivel de coherencia juntos determinarán si los datos serán coherentes en cuanto se completa una operación de escritura o si será coherente con el tiempo.</span><span class="sxs-lookup"><span data-stu-id="71bf3-152">Cassandra supports two types of data integrity models – Consistency and Eventual Consistency; the Replication Factor and Consistency Level will together determine if the data will be consistent as soon as a write operation is complete or it will be eventually consistent.</span></span> <span data-ttu-id="71bf3-153">Por ejemplo, al especificar QUORUM como el nivel de coherencia asegura siempre la coherencia de los datos, mientras que cualquier nivel de coherencia por debajo del número de réplicas para escribir según sea necesario para mantener QUORUM (por ejemplo, uno) hará que los datos sean coherentes con el tiempo.</span><span class="sxs-lookup"><span data-stu-id="71bf3-153">For example, specifying QUORUM as the Consistency Level will always ensures data Consistency while any consistency level, below the number of replicas to be written as needed to attain QUORUM (e.g. ONE) results in data being eventually consistent.</span></span>

<span data-ttu-id="71bf3-154">El clúster de 8 nodos mostrado anteriormente, con un factor de replicación de 3 y un nivel de coherencia de lectura/escritura de QUÓRUM (2 nodos leídos o escritos para coherencia), puede superar la pérdida teórica de como máximo 1 nodo por grupo de replicación antes de que la aplicación advierta el error.</span><span class="sxs-lookup"><span data-stu-id="71bf3-154">The 8-node cluster shown above, with a replication factor of 3 and QUORUM (2 nodes are read or written for consistency) read/write consistency level, can survive the theoretical loss of at the most 1 node per replication group before the application start noticing the failure.</span></span> <span data-ttu-id="71bf3-155">Se supone que todos los espacios de clave tienen solicitudes de lectura/escritura equilibradas.</span><span class="sxs-lookup"><span data-stu-id="71bf3-155">This assumes that all the key spaces have well balanced read/write requests.</span></span>  <span data-ttu-id="71bf3-156">Los siguientes son los parámetros que se utilizarán en el clúster implementado:</span><span class="sxs-lookup"><span data-stu-id="71bf3-156">The following are the parameters we will use for the deployed cluster:</span></span>

<span data-ttu-id="71bf3-157">Configuración de clúster de Cassandra de una sola región:</span><span class="sxs-lookup"><span data-stu-id="71bf3-157">Single region Cassandra cluster configuration:</span></span>

| <span data-ttu-id="71bf3-158">Parámetro de clúster</span><span class="sxs-lookup"><span data-stu-id="71bf3-158">Cluster Parameter</span></span> | <span data-ttu-id="71bf3-159">Valor</span><span class="sxs-lookup"><span data-stu-id="71bf3-159">Value</span></span> | <span data-ttu-id="71bf3-160">Comentarios</span><span class="sxs-lookup"><span data-stu-id="71bf3-160">Remarks</span></span> |
| --- | --- | --- |
| <span data-ttu-id="71bf3-161">Número de nodos (N)</span><span class="sxs-lookup"><span data-stu-id="71bf3-161">Number of Nodes (N)</span></span> |<span data-ttu-id="71bf3-162">8</span><span class="sxs-lookup"><span data-stu-id="71bf3-162">8</span></span> |<span data-ttu-id="71bf3-163">Número total de nodos del clúster</span><span class="sxs-lookup"><span data-stu-id="71bf3-163">Total number of nodes in the cluster</span></span> |
| <span data-ttu-id="71bf3-164">Factor de replicación (RF)</span><span class="sxs-lookup"><span data-stu-id="71bf3-164">Replication Factor (RF)</span></span> |<span data-ttu-id="71bf3-165">3</span><span class="sxs-lookup"><span data-stu-id="71bf3-165">3</span></span> |<span data-ttu-id="71bf3-166">Número de réplicas de una fila determinada</span><span class="sxs-lookup"><span data-stu-id="71bf3-166">Number of replicas of a given row</span></span> |
| <span data-ttu-id="71bf3-167">Nivel de coherencia (escritura)</span><span class="sxs-lookup"><span data-stu-id="71bf3-167">Consistency Level (Write)</span></span> |<span data-ttu-id="71bf3-168">QUORUM[(RF/2) +1) = 2] Se redondea a la baja el resultado de la fórmula</span><span class="sxs-lookup"><span data-stu-id="71bf3-168">QUORUM[(RF/2) +1) = 2] The result of the formula is rounded down</span></span> |<span data-ttu-id="71bf3-169">Escribe como máximo 2 réplicas antes de enviar la respuesta al llamador; la 3.ª réplica se escribe de forma coherente finalmente.</span><span class="sxs-lookup"><span data-stu-id="71bf3-169">Writes at the most 2 replicas before the response is sent to the caller; 3rd replica is written in an eventually consistent manner.</span></span> |
| <span data-ttu-id="71bf3-170">Nivel de coherencia (lectura)</span><span class="sxs-lookup"><span data-stu-id="71bf3-170">Consistency Level (Read)</span></span> |<span data-ttu-id="71bf3-171">QUORUM[(RF/2) +1= 2] Se redondea a la baja el resultado de la fórmula</span><span class="sxs-lookup"><span data-stu-id="71bf3-171">QUORUM [(RF/2) +1= 2] The result of the formula is rounded down</span></span> |<span data-ttu-id="71bf3-172">Lee 2 réplicas antes de enviar la respuesta al llamador.</span><span class="sxs-lookup"><span data-stu-id="71bf3-172">Reads 2 replicas before sending response to the caller.</span></span> |
| <span data-ttu-id="71bf3-173">Estrategia de replicación</span><span class="sxs-lookup"><span data-stu-id="71bf3-173">Replication Strategy</span></span> |<span data-ttu-id="71bf3-174">NetworkTopologyStrategy vea la [replicación de datos](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) en la documentación de Cassandra para obtener más información</span><span class="sxs-lookup"><span data-stu-id="71bf3-174">NetworkTopologyStrategy see [Data Replication](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) in Cassandra documentation for more information</span></span> |<span data-ttu-id="71bf3-175">Comprende la topología de implementación y sitúa las réplicas en los nodos para que todas las réplicas no terminen en el mismo bastidor.</span><span class="sxs-lookup"><span data-stu-id="71bf3-175">Understands the deployment topology and places replicas on nodes so that all the replicas don’t end up on the same rack</span></span> |
| <span data-ttu-id="71bf3-176">Snitch</span><span class="sxs-lookup"><span data-stu-id="71bf3-176">Snitch</span></span> |<span data-ttu-id="71bf3-177">GossipingPropertyFileSnitch. Vea [Snitches](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) en la documentación de Cassandra para más información</span><span class="sxs-lookup"><span data-stu-id="71bf3-177">GossipingPropertyFileSnitch see [Snitches](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) in Cassandra documentation for more information</span></span> |<span data-ttu-id="71bf3-178">NetworkTopologyStrategy usa un concepto de snitch para entender la topología.</span><span class="sxs-lookup"><span data-stu-id="71bf3-178">NetworkTopologyStrategy uses a concept of snitch to understand the topology.</span></span> <span data-ttu-id="71bf3-179">GossipingPropertyFileSnitch proporciona un mejor control en la asignación de cada nodo al centro de datos y al bastidor.</span><span class="sxs-lookup"><span data-stu-id="71bf3-179">GossipingPropertyFileSnitch gives better control in mapping each node to data center and rack.</span></span> <span data-ttu-id="71bf3-180">El clúster utiliza gossip para propagar esta información.</span><span class="sxs-lookup"><span data-stu-id="71bf3-180">The cluster then uses gossip to propagate this information.</span></span> <span data-ttu-id="71bf3-181">Esto es mucho más sencillo en la configuración de IP dinámica en relación con PropertyFileSnitch</span><span class="sxs-lookup"><span data-stu-id="71bf3-181">This is much simpler in dynamic IP setting relative to PropertyFileSnitch</span></span> |

<span data-ttu-id="71bf3-182">**Consideraciones de Azure para el clúster de Cassandra**: La funcionalidad Microsoft Azure Virtual Machines usa Azure Blob Storage para la persistencia de disco; Azure Storage guarda tres réplicas de cada disco que proporcionan gran durabilidad.</span><span class="sxs-lookup"><span data-stu-id="71bf3-182">**Azure Considerations for Cassandra Cluster:** Microsoft Azure Virtual Machines capability uses Azure Blob storage for disk persistence; Azure Storage saves 3 replicas of each disk for high durability.</span></span> <span data-ttu-id="71bf3-183">Esto significa que cada fila de datos que se inserta en una tabla de Cassandra ya está almacenada en tres réplicas y, por tanto, la consistencia de los datos ya está controlada incluso si el Factor de replicación (RF) es 1.</span><span class="sxs-lookup"><span data-stu-id="71bf3-183">That means each row of data inserted into a Cassandra table is already stored in 3 replicas and hence data consistency is already taken care of even if the Replication Factor (RF) is 1.</span></span> <span data-ttu-id="71bf3-184">El principal problema con el Factor de replicación 1 es que la aplicación experimentará un tiempo de inactividad, incluso si se produce un error en un único nodo de Cassandra.</span><span class="sxs-lookup"><span data-stu-id="71bf3-184">The main problem with Replication Factor being 1 is that the application will experience downtime even if a single Cassandra node fails.</span></span> <span data-ttu-id="71bf3-185">Sin embargo, si un nodo está inactivo para los problemas (por ejemplo, errores de hardware y de software del sistema) reconocidos por el controlador de tejido de Azure, se proporcionará un nuevo nodo en su lugar utilizando las mismas unidades de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="71bf3-185">However, if a node is down for the problems (e.g. hardware, system software failures) recognized by Azure Fabric Controller, it will provision a new node in its place using the same storage drives.</span></span> <span data-ttu-id="71bf3-186">El aprovisionamiento de un nuevo nodo para reemplazar el antiguo puede tardar unos minutos.</span><span class="sxs-lookup"><span data-stu-id="71bf3-186">Provisioning a new node to replace the old one may take a few minutes.</span></span>  <span data-ttu-id="71bf3-187">De forma similar para las actividades de mantenimiento planeado, como los cambios en el SO invitado, Cassandra actualiza y la aplicación cambia. El controlador de tejido de Azure realiza actualizaciones sucesivas en los nodos del clúster.</span><span class="sxs-lookup"><span data-stu-id="71bf3-187">Similarly for planned maintenance activities like guest OS changes, Cassandra upgrades and application changes Azure Fabric Controller performs rolling upgrades of the nodes in the cluster.</span></span>  <span data-ttu-id="71bf3-188">Las actualizaciones sucesivas también pueden hacer que haya varios nodos inactivos a la vez y, por tanto, el clúster puede experimentar breves períodos de inactividad para algunas particiones.</span><span class="sxs-lookup"><span data-stu-id="71bf3-188">Rolling upgrades also may take down a few nodes at a time and hence the cluster may experience brief downtime for a few partitions.</span></span> <span data-ttu-id="71bf3-189">Sin embargo, los datos no se perderán debido a la redundancia integrada de Almacenamiento de Azure.</span><span class="sxs-lookup"><span data-stu-id="71bf3-189">However, the data will not be lost due to the built-in Azure Storage redundancy.</span></span>  

<span data-ttu-id="71bf3-190">Para los sistemas implementados en Azure que no requieren alta disponibilidad (por ejemplo, 99,9 aproximadamente, lo que equivale a 8,76 horas por año; consulte [Alta disponibilidad](http://en.wikipedia.org/wiki/High_availability) para obtener más detalles), es posible que puedan ejecutarse con RF = 1 y nivel de coherencia = uno.</span><span class="sxs-lookup"><span data-stu-id="71bf3-190">For systems deployed to Azure that doesn’t require high availability (e.g. around 99.9 which is equivalent to 8.76 hrs/year; see [High Availability](http://en.wikipedia.org/wiki/High_availability) for details) you may be able to run with RF=1 and Consistency Level=ONE.</span></span>  <span data-ttu-id="71bf3-191">Para las aplicaciones con requisitos de alta disponibilidad, RF = 3 y el nivel de coherencia = QUÓRUM tolerarán el tiempo de inactividad de uno de los nodos de las réplicas.</span><span class="sxs-lookup"><span data-stu-id="71bf3-191">For applications with high availability requirements, RF=3 and Consistency Level=QUORUM will tolerate the down time of one of the nodes one of the replicas.</span></span> <span data-ttu-id="71bf3-192">El RF = 1 en implementaciones tradicionales (por ejemplo, locales) no se puede utilizar debido a la posible pérdida de datos resultante de problemas como errores de disco.</span><span class="sxs-lookup"><span data-stu-id="71bf3-192">RF=1 in traditional deployments (e.g. on-premises) can’t be used due to the possible data loss resulting from problems like disk failures.</span></span>   

## <a name="multi-region-deployment"></a><span data-ttu-id="71bf3-193">Implementación en varias regiones</span><span class="sxs-lookup"><span data-stu-id="71bf3-193">Multi-region Deployment</span></span>
<span data-ttu-id="71bf3-194">La replicación compatible del centro de datos de Cassandra y el modelo de coherencia descrito anteriormente ayudan con la implementación de varias regiones sin la necesidad de las herramientas externas.</span><span class="sxs-lookup"><span data-stu-id="71bf3-194">Cassandra’s data-center-aware replication and consistency model described above helps with the multi-region deployment out of the box without the need for any external tooling.</span></span> <span data-ttu-id="71bf3-195">Esto es muy diferente de las bases de datos relacionales tradicionales, donde la escritura del programa de instalación para la creación de reflejo de base de datos de varios maestros puede ser bastante compleja.</span><span class="sxs-lookup"><span data-stu-id="71bf3-195">This is quite different from the traditional relational databases where the setup for database mirroring for multi-master writes can be quite complex.</span></span> <span data-ttu-id="71bf3-196">Cassandra en una configuración de varias regiones puede ayudar en los escenarios de uso, incluidos los siguientes:</span><span class="sxs-lookup"><span data-stu-id="71bf3-196">Cassandra in a multi-region set up can help with the usage scenarios including the following:</span></span>

<span data-ttu-id="71bf3-197">**Implementación basada en proximidad:** Las aplicaciones de varios inquilinos, con una asignación clara de los usuarios inquilino a la región, se pueden beneficiar de las bajas latencias del clúster de varias regiones.</span><span class="sxs-lookup"><span data-stu-id="71bf3-197">**Proximity based deployment:** Multi-tenant applications, with clear mapping of tenant users -to-region, can be benefited by the multi-region cluster’s low latencies.</span></span> <span data-ttu-id="71bf3-198">Por ejemplo, los sistemas de administración de aprendizaje para instituciones educativas pueden implementar un clúster distribuido en regiones del Este de EE. UU. y del Oeste de EE. UU. para servir a los campus correspondientes de forma transaccional, así como analítica.</span><span class="sxs-lookup"><span data-stu-id="71bf3-198">For example a learning management systems for educational institutions can deploy a distributed cluster in East US and West US regions to serve the respective campuses for transactional as well as analytics.</span></span> <span data-ttu-id="71bf3-199">Los datos pueden ser coherentes localmente en las lecturas y escrituras en el momento, y pueden ser coherentes con el tiempo entre ambas regiones.</span><span class="sxs-lookup"><span data-stu-id="71bf3-199">The data can be locally consistent at the time reads and writes and can be eventually consistent across both the regions.</span></span> <span data-ttu-id="71bf3-200">Hay otros ejemplos como la distribución de medios, el comercio electrónico y todo lo que sirva a una base de usuario concentrada geográficamente es un buen caso de uso para este modelo de implementación.</span><span class="sxs-lookup"><span data-stu-id="71bf3-200">There are other examples like media distribution, e-commerce and anything and everything that serves geo concentrated user base is a good use case for this deployment model.</span></span>

<span data-ttu-id="71bf3-201">**Alta disponibilidad:** La redundancia es un factor clave para lograr una alta disponibilidad de software y hardware; consulte Creación de sistemas en nube confiables en Microsoft Azure para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="71bf3-201">**High Availability:** Redundancy is a key factor in attaining high availability of software and hardware; see Building Reliable Cloud Systems on Microsoft Azure for details.</span></span> <span data-ttu-id="71bf3-202">En Microsoft Azure, la única manera confiable de lograr una verdadera redundancia es mediante la implementación de un clúster de varias regiones.</span><span class="sxs-lookup"><span data-stu-id="71bf3-202">On Microsoft Azure, the only reliable way of achieving true redundancy is by deploying a multi-region cluster.</span></span> <span data-ttu-id="71bf3-203">Se pueden implementar aplicaciones en modo activo-activo o activo-pasivo y si una de las regiones está inactiva, el Administrador de tráfico de Azure puede redirigir el tráfico a la región activa.</span><span class="sxs-lookup"><span data-stu-id="71bf3-203">Applications can be deployed in an active-active or active-passive mode and if one of the regions is down, Azure Traffic Manager can redirect traffic to the active region.</span></span>  <span data-ttu-id="71bf3-204">Con la implementación de una sola región, si la disponibilidad es de 99,9, una implementación de dos regiones puede alcanzar una disponibilidad de 99,9999 calculada mediante la fórmula: (1-(1-0,999) * (1-0,999))*100); consulte la nota anterior para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="71bf3-204">With the single region deployment, if the availability is 99.9, a two-region deployment can attain an availability of 99.9999 computed by the formula: (1-(1-0.999) * (1-0.999))*100); see the above paper for details.</span></span>

<span data-ttu-id="71bf3-205">**Recuperación ante desastres:** El clúster de Cassandra de varias regiones, si está correctamente diseñado, puede resistir interrupciones del centro de datos por catástrofes.</span><span class="sxs-lookup"><span data-stu-id="71bf3-205">**Disaster Recovery:** Multi-region Cassandra cluster, if properly designed, can withstand catastrophic data center outages.</span></span> <span data-ttu-id="71bf3-206">Si una región está inactiva, la aplicación implementada en otras regiones puede empezar a servir a los usuarios finales.</span><span class="sxs-lookup"><span data-stu-id="71bf3-206">If one region is down, the application deployed to other regions can start serving the end users.</span></span> <span data-ttu-id="71bf3-207">Al igual que cualquier otra implementación de continuidad empresarial, la aplicación tiene que ser tolerante a errores de pérdida de datos resultantes de los datos en la canalización asincrónica.</span><span class="sxs-lookup"><span data-stu-id="71bf3-207">Like any other business continuity implementations, the application has to be tolerant for some data loss resulting from the data in the asynchronous pipeline.</span></span> <span data-ttu-id="71bf3-208">Sin embargo, Cassandra hace que la recuperación sea mucho más rápida que el tiempo empleado por los procesos de recuperación de bases de datos tradicionales.</span><span class="sxs-lookup"><span data-stu-id="71bf3-208">However, Cassandra makes the recovery much swifter than the time taken by traditional database recovery processes.</span></span> <span data-ttu-id="71bf3-209">La Ilustración 2 muestra el modelo de implementación típica de varias regiones de ocho nodos en cada región.</span><span class="sxs-lookup"><span data-stu-id="71bf3-209">Figure 2 shows the typical multi-region deployment model with eight nodes in each region.</span></span> <span data-ttu-id="71bf3-210">Ambas regiones son imágenes reflejadas entre sí para la misma de simetría; los diseños reales dependen del tipo de carga de trabajo (por ejemplo, transaccional o analítico), el RPO, RTO, la coherencia de los datos y los requisitos de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="71bf3-210">Both regions are mirror images of each other for the same of symmetry; real world designs depend on the workload type (e.g. transactional or analytical), RPO, RTO, data consistency and availability requirements.</span></span>

![Implementación de varias regiones](./media/cassandra-nodejs/cassandra-linux2.png)

<span data-ttu-id="71bf3-212">Ilustración 2: Implementación de Cassandra en varias regiones</span><span class="sxs-lookup"><span data-stu-id="71bf3-212">Figure 2: Multi-region Cassandra deployment</span></span>

### <a name="network-integration"></a><span data-ttu-id="71bf3-213">Integración de red</span><span class="sxs-lookup"><span data-stu-id="71bf3-213">Network Integration</span></span>
<span data-ttu-id="71bf3-214">Los conjuntos de máquinas virtuales implementados en las redes privadas que se encuentran en dos regiones se comunican entre sí mediante un túnel VPN.</span><span class="sxs-lookup"><span data-stu-id="71bf3-214">Sets of virtual machines deployed to private networks located on two regions communicates with each other using a VPN tunnel.</span></span> <span data-ttu-id="71bf3-215">El túnel VPN conecta dos puertas de enlace software aprovisionados durante el proceso de implementación de la red.</span><span class="sxs-lookup"><span data-stu-id="71bf3-215">The VPN tunnel connects two software gateways provisioned during the network deployment process.</span></span> <span data-ttu-id="71bf3-216">Ambas regiones tienen una arquitectura de red similar en términos de subredes "web" y de "datos"; las redes de Azure permiten la creación de tantas subredes como sea necesario y aplican las ACL según sea necesario para la seguridad de la red.</span><span class="sxs-lookup"><span data-stu-id="71bf3-216">Both regions have similar network architecture in terms of “web” and “data” subnets; Azure networking allows the creation of as many subnets as needed and apply ACLs as needed by network security.</span></span> <span data-ttu-id="71bf3-217">Al diseñar la topología de clúster, debe tenerse en cuenta la latencia de comunicación entre centros de datos y el impacto económico del tráfico de red.</span><span class="sxs-lookup"><span data-stu-id="71bf3-217">While designing the cluster topology inter data center communication latency and the economic impact of the network traffic need to be considered.</span></span>

### <a name="data-consistency-for-multi-data-center-deployment"></a><span data-ttu-id="71bf3-218">Coherencia de los datos para la implementación de varios centros de datos</span><span class="sxs-lookup"><span data-stu-id="71bf3-218">Data Consistency for Multi-Data Center Deployment</span></span>
<span data-ttu-id="71bf3-219">Las implementaciones distribuidas deben tener en cuenta el impacto de la topología de clúster en el rendimiento y la alta disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="71bf3-219">Distributed deployments need to be aware of the cluster topology impact on throughput and high availability.</span></span> <span data-ttu-id="71bf3-220">El nivel de coherencia y el RF deben seleccionarse de manera que el quórum no dependa de la disponibilidad de los centros de datos.</span><span class="sxs-lookup"><span data-stu-id="71bf3-220">The RF and Consistency Level need to be selected in such way that the quorum doesn’t depend on the availability of all the data centers.</span></span>
<span data-ttu-id="71bf3-221">Para un sistema que necesita una coherencia alta, un LOCAL_QUORUM de nivel de coherencia (para lecturas y escrituras) se asegurará de que las lecturas y escrituras locales se atiendan desde los nodos locales mientras los datos se replican de forma asincrónica a los centros de datos remotos.</span><span class="sxs-lookup"><span data-stu-id="71bf3-221">For a system that needs high consistency, a LOCAL_QUORUM for consistency level (for reads and writes) will make sure that the local reads and writes are satisfied from the local nodes while data is replicated asynchronously to the remote data centers.</span></span>  <span data-ttu-id="71bf3-222">La tabla 2 resume los detalles de configuración para el clúster de varias regiones descritos más adelante.</span><span class="sxs-lookup"><span data-stu-id="71bf3-222">Table 2 summarizes the configuration details for the multi-region cluster outlined later in the write up.</span></span>

<span data-ttu-id="71bf3-223">**Configuración del clúster de Cassandra de dos regiones**</span><span class="sxs-lookup"><span data-stu-id="71bf3-223">**Two-region Cassandra cluster configuration**</span></span>

| <span data-ttu-id="71bf3-224">Parámetro de clúster</span><span class="sxs-lookup"><span data-stu-id="71bf3-224">Cluster Parameter</span></span> | <span data-ttu-id="71bf3-225">Valor</span><span class="sxs-lookup"><span data-stu-id="71bf3-225">Value</span></span> | <span data-ttu-id="71bf3-226">Comentarios</span><span class="sxs-lookup"><span data-stu-id="71bf3-226">Remarks</span></span> |
| --- | --- | --- |
| <span data-ttu-id="71bf3-227">Número de nodos (N)</span><span class="sxs-lookup"><span data-stu-id="71bf3-227">Number of Nodes (N)</span></span> |<span data-ttu-id="71bf3-228">8 + 8</span><span class="sxs-lookup"><span data-stu-id="71bf3-228">8 + 8</span></span> |<span data-ttu-id="71bf3-229">Número total de nodos del clúster</span><span class="sxs-lookup"><span data-stu-id="71bf3-229">Total number of nodes in the cluster</span></span> |
| <span data-ttu-id="71bf3-230">Factor de replicación (RF)</span><span class="sxs-lookup"><span data-stu-id="71bf3-230">Replication Factor (RF)</span></span> |<span data-ttu-id="71bf3-231">3</span><span class="sxs-lookup"><span data-stu-id="71bf3-231">3</span></span> |<span data-ttu-id="71bf3-232">Número de réplicas de una fila determinada</span><span class="sxs-lookup"><span data-stu-id="71bf3-232">Number of replicas of a given row</span></span> |
| <span data-ttu-id="71bf3-233">Nivel de coherencia (escritura)</span><span class="sxs-lookup"><span data-stu-id="71bf3-233">Consistency Level (Write)</span></span> |<span data-ttu-id="71bf3-234">LOCAL_QUORUM [(sum(RF)/2) +1) = 4] Se redondea a la baja el resultado de la fórmula</span><span class="sxs-lookup"><span data-stu-id="71bf3-234">LOCAL_QUORUM [(sum(RF)/2) +1) = 4] The result of the formula is rounded down</span></span> |<span data-ttu-id="71bf3-235">Se escribirán 2 nodos en el primer centro de datos de forma sincrónica; los 2 nodos adicionales necesarios para el quórum se escribirán de forma asincrónica en el segundo centro de datos.</span><span class="sxs-lookup"><span data-stu-id="71bf3-235">2 nodes will be written to the first data center synchronously; the additional 2 nodes needed for quorum will be written asynchronously to the 2nd data center.</span></span> |
| <span data-ttu-id="71bf3-236">Nivel de coherencia (lectura)</span><span class="sxs-lookup"><span data-stu-id="71bf3-236">Consistency Level (Read)</span></span> |<span data-ttu-id="71bf3-237">LOCAL_QUORUM ((RF/2) + 1) = 2Se redondea a la baja el resultado de la fórmula</span><span class="sxs-lookup"><span data-stu-id="71bf3-237">LOCAL_QUORUM ((RF/2) +1) = 2 The result of the formula is rounded down</span></span> |<span data-ttu-id="71bf3-238">Las solicitudes de lectura se atienden desde solo una región; 2 nodos se leen antes de enviar la respuesta al cliente.</span><span class="sxs-lookup"><span data-stu-id="71bf3-238">Read requests are satisfied from only one region; 2 nodes are read before the response is sent back to the client.</span></span> |
| <span data-ttu-id="71bf3-239">Estrategia de replicación</span><span class="sxs-lookup"><span data-stu-id="71bf3-239">Replication Strategy</span></span> |<span data-ttu-id="71bf3-240">NetworkTopologyStrategy vea la [replicación de datos](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) en la documentación de Cassandra para obtener más información</span><span class="sxs-lookup"><span data-stu-id="71bf3-240">NetworkTopologyStrategy see [Data Replication](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) in Cassandra documentation for more information</span></span> |<span data-ttu-id="71bf3-241">Comprende la topología de implementación y sitúa las réplicas en los nodos para que todas las réplicas no terminen en el mismo bastidor.</span><span class="sxs-lookup"><span data-stu-id="71bf3-241">Understands the deployment topology and places replicas on nodes so that all the replicas don’t end up on the same rack</span></span> |
| <span data-ttu-id="71bf3-242">Snitch</span><span class="sxs-lookup"><span data-stu-id="71bf3-242">Snitch</span></span> |<span data-ttu-id="71bf3-243">GossipingPropertyFileSnitch. Vea [Snitches](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) en la documentación de Cassandra para más información</span><span class="sxs-lookup"><span data-stu-id="71bf3-243">GossipingPropertyFileSnitch see [Snitches](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) in Cassandra documentation for more information</span></span> |<span data-ttu-id="71bf3-244">NetworkTopologyStrategy usa un concepto de snitch para entender la topología.</span><span class="sxs-lookup"><span data-stu-id="71bf3-244">NetworkTopologyStrategy uses a concept of snitch to understand the topology.</span></span> <span data-ttu-id="71bf3-245">GossipingPropertyFileSnitch proporciona un mejor control en la asignación de cada nodo al centro de datos y al bastidor.</span><span class="sxs-lookup"><span data-stu-id="71bf3-245">GossipingPropertyFileSnitch gives better control in mapping each node to data center and rack.</span></span> <span data-ttu-id="71bf3-246">El clúster utiliza gossip para propagar esta información.</span><span class="sxs-lookup"><span data-stu-id="71bf3-246">The cluster then uses gossip to propagate this information.</span></span> <span data-ttu-id="71bf3-247">Esto es mucho más sencillo en la configuración de IP dinámica en relación con PropertyFileSnitch</span><span class="sxs-lookup"><span data-stu-id="71bf3-247">This is much simpler in dynamic IP setting relative to PropertyFileSnitch</span></span> |

## <a name="the-software-configuration"></a><span data-ttu-id="71bf3-248">LA CONFIGURACIÓN DE SOFTWARE</span><span class="sxs-lookup"><span data-stu-id="71bf3-248">THE SOFTWARE CONFIGURATION</span></span>
<span data-ttu-id="71bf3-249">Las siguientes versiones de software se utilizan durante la implementación:</span><span class="sxs-lookup"><span data-stu-id="71bf3-249">The following software versions are used during the deployment:</span></span>

<table>
<tr><th><span data-ttu-id="71bf3-250">Software</span><span class="sxs-lookup"><span data-stu-id="71bf3-250">Software</span></span></th><th><span data-ttu-id="71bf3-251">Origen</span><span class="sxs-lookup"><span data-stu-id="71bf3-251">Source</span></span></th><th><span data-ttu-id="71bf3-252">Versión</span><span class="sxs-lookup"><span data-stu-id="71bf3-252">Version</span></span></th></tr>
<tr><td><span data-ttu-id="71bf3-253">JRE</span><span class="sxs-lookup"><span data-stu-id="71bf3-253">JRE</span></span>    </td><td><span data-ttu-id="71bf3-254">[JRE 8](http://www.oracle.com/technetwork/java/javase/downloads/server-jre8-downloads-2133154.html) </span><span class="sxs-lookup"><span data-stu-id="71bf3-254">[JRE 8](http://www.oracle.com/technetwork/java/javase/downloads/server-jre8-downloads-2133154.html) </span></span></td><td><span data-ttu-id="71bf3-255">8U5</span><span class="sxs-lookup"><span data-stu-id="71bf3-255">8U5</span></span></td></tr>
<tr><td><span data-ttu-id="71bf3-256">JNA</span><span class="sxs-lookup"><span data-stu-id="71bf3-256">JNA</span></span>    </td><td><span data-ttu-id="71bf3-257">[JNA](https://github.com/twall/jna) </span><span class="sxs-lookup"><span data-stu-id="71bf3-257">[JNA](https://github.com/twall/jna) </span></span></td><td> <span data-ttu-id="71bf3-258">3.2.7</span><span class="sxs-lookup"><span data-stu-id="71bf3-258">3.2.7</span></span></td></tr>
<tr><td><span data-ttu-id="71bf3-259">Cassandra</span><span class="sxs-lookup"><span data-stu-id="71bf3-259">Cassandra</span></span></td><td>[<span data-ttu-id="71bf3-260">Apache Cassandra 2.0.8</span><span class="sxs-lookup"><span data-stu-id="71bf3-260">Apache Cassandra 2.0.8</span></span>](http://www.apache.org/dist/cassandra/2.0.8/apache-cassandra-2.0.8-bin.tar.gz)</td><td> <span data-ttu-id="71bf3-261">2.0.8</span><span class="sxs-lookup"><span data-stu-id="71bf3-261">2.0.8</span></span></td></tr>
<tr><td><span data-ttu-id="71bf3-262">Ubuntu</span><span class="sxs-lookup"><span data-stu-id="71bf3-262">Ubuntu</span></span>    </td><td><span data-ttu-id="71bf3-263">[Microsoft Azure](https://azure.microsoft.com/) </span><span class="sxs-lookup"><span data-stu-id="71bf3-263">[Microsoft Azure](https://azure.microsoft.com/) </span></span></td><td><span data-ttu-id="71bf3-264">14.04 LTS</span><span class="sxs-lookup"><span data-stu-id="71bf3-264">14.04 LTS</span></span></td></tr>
</table>

<span data-ttu-id="71bf3-265">Puesto que la descarga de JRE requiere la aceptación manual de licencia de Oracle, para simplificar la implementación, descargue todo el software necesario en el escritorio para su carga más adelante en la imagen de plantilla Ubuntu que crearemos como paso previo a la implementación del clúster.</span><span class="sxs-lookup"><span data-stu-id="71bf3-265">Since downloading of JRE requires manual acceptance of Oracle license, to simplify the deployment, download all the required software to the desktop for later uploading into the Ubuntu template image we will be creating as a precursor to the cluster deployment.</span></span>

<span data-ttu-id="71bf3-266">Descargue el software anterior en un directorio conocido de descargas (por ejemplo, %TEMP%/downloads en Windows o ~/Downloads en la mayoría de distribuciones de Linux o Mac) en el escritorio local.</span><span class="sxs-lookup"><span data-stu-id="71bf3-266">Download the above software into a well-known download directory (e.g. %TEMP%/downloads on Windows or ~/Downloads on most Linux distributions or Mac) on the local computer.</span></span>

### <a name="create-ubuntu-vm"></a><span data-ttu-id="71bf3-267">CREAR LA MÁQUINA VIRTUAL DE UBUNTU</span><span class="sxs-lookup"><span data-stu-id="71bf3-267">CREATE UBUNTU VM</span></span>
<span data-ttu-id="71bf3-268">En este paso del proceso crearemos una imagen de Ubuntu con el software de requisito previo para que la imagen se pueda reutilizar para el aprovisionamiento de varios nodos de Cassandra.</span><span class="sxs-lookup"><span data-stu-id="71bf3-268">In this step of the process we will create Ubuntu image with the pre-requisite software so that the image can be reused for provisioning several Cassandra nodes.</span></span>  

#### <a name="step-1-generate-ssh-key-pair"></a><span data-ttu-id="71bf3-269">PASO 1: Generación de par de claves de SSH</span><span class="sxs-lookup"><span data-stu-id="71bf3-269">STEP 1: Generate SSH key pair</span></span>
<span data-ttu-id="71bf3-270">Azure necesita una clave pública X509 con codificación PEM o DER en el momento del aprovisionamiento.</span><span class="sxs-lookup"><span data-stu-id="71bf3-270">Azure needs an X509 public key that is either PEM or DER encoded at the provisioning time.</span></span> <span data-ttu-id="71bf3-271">Genere un par de claves públicas/privadas con las instrucciones ubicadas en Utilización de SSH con Linux en Azure.</span><span class="sxs-lookup"><span data-stu-id="71bf3-271">Generate a public/private key pair using the instructions located at How to Use SSH with Linux on Azure.</span></span> <span data-ttu-id="71bf3-272">Si planea utilizar putty.exe como un cliente SSH en Windows o Linux, debe convertir la clave privada RSA codificada del PEM a formato PPK mediante puttygen.exe; las instrucciones para esto pueden encontrarse en la página web anterior.</span><span class="sxs-lookup"><span data-stu-id="71bf3-272">If you plan to use putty.exe as an SSH client either on Windows or Linux, you have to convert the PEM encoded RSA private key to PPK format using puttygen.exe; the instructions for this can be found in the above web page.</span></span>

#### <a name="step-2-create-ubuntu-template-vm"></a><span data-ttu-id="71bf3-273">PASO 2: Creación de la máquina virtual de la plantilla de Ubuntu</span><span class="sxs-lookup"><span data-stu-id="71bf3-273">STEP 2: Create Ubuntu template VM</span></span>
<span data-ttu-id="71bf3-274">Para crear la máquina virtual de la plantilla, inicie sesión en el Portal de Azure clásico y use la siguiente secuencia: haga clic en NUEVO, PROCESO, MÁQUINA VIRTUAL, DESDE LA GALERÍA, UBUNTU, Ubuntu Server 14.04 LTS y, después, haga clic en la flecha derecha.</span><span class="sxs-lookup"><span data-stu-id="71bf3-274">To create the template VM, log into the Azure classic portal and use the following sequence: Click NEW, COMPUTE, VIRTUAL MACHINE, FROM GALLERY, UBUNTU, Ubuntu Server 14.04 LTS, and then click the right arrow.</span></span> <span data-ttu-id="71bf3-275">Si necesita un tutorial en que se describe cómo crear una máquina virtual de Linux, consulte Creación de una máquina virtual que ejecuta Linux.</span><span class="sxs-lookup"><span data-stu-id="71bf3-275">For a tutorial that describes how to create a Linux VM, see Create a Virtual Machine Running Linux.</span></span>

<span data-ttu-id="71bf3-276">En la pantalla "Configuración de la máquina virtual" #1, escriba la siguiente información:</span><span class="sxs-lookup"><span data-stu-id="71bf3-276">Enter the following information on the “Virtual machine configuration” screen #1:</span></span>

<table>
<tr><th><span data-ttu-id="71bf3-277">NOMBRE DEL CAMPO</span><span class="sxs-lookup"><span data-stu-id="71bf3-277">FIELD NAME</span></span>              </td><td>       <span data-ttu-id="71bf3-278">VALOR DEL CAMPO</span><span class="sxs-lookup"><span data-stu-id="71bf3-278">FIELD VALUE</span></span>               </td><td>         <span data-ttu-id="71bf3-279">COMENTARIOS</span><span class="sxs-lookup"><span data-stu-id="71bf3-279">REMARKS</span></span>                </td><tr>
<tr><td><span data-ttu-id="71bf3-280">FECHA DE LANZAMIENTO DE LA VERSIÓN</span><span class="sxs-lookup"><span data-stu-id="71bf3-280">VERSION RELEASE DATE</span></span>    </td><td> <span data-ttu-id="71bf3-281">Seleccione una fecha del menú desplegable.</span><span class="sxs-lookup"><span data-stu-id="71bf3-281">Select a date from the drop down</span></span></td><td></td><tr>
<tr><td><span data-ttu-id="71bf3-282">NOMBRE DE MÁQUINA VIRTUAL</span><span class="sxs-lookup"><span data-stu-id="71bf3-282">VIRTUAL MACHINE NAME</span></span>    </td><td> <span data-ttu-id="71bf3-283">cass-template</span><span class="sxs-lookup"><span data-stu-id="71bf3-283">cass-template</span></span>                   </td><td> <span data-ttu-id="71bf3-284">El nombre de host de la máquina virtual</span><span class="sxs-lookup"><span data-stu-id="71bf3-284">This is the hostname of the VM</span></span> </td><tr>
<tr><td><span data-ttu-id="71bf3-285">NIVEL</span><span class="sxs-lookup"><span data-stu-id="71bf3-285">TIER</span></span>                     </td><td> <span data-ttu-id="71bf3-286">ESTÁNDAR</span><span class="sxs-lookup"><span data-stu-id="71bf3-286">STANDARD</span></span>                           </td><td> <span data-ttu-id="71bf3-287">Deje el valor predeterminado</span><span class="sxs-lookup"><span data-stu-id="71bf3-287">Leave the default</span></span>              </td><tr>
<tr><td><span data-ttu-id="71bf3-288">TAMAÑO</span><span class="sxs-lookup"><span data-stu-id="71bf3-288">SIZE</span></span>                     </td><td> <span data-ttu-id="71bf3-289">A1</span><span class="sxs-lookup"><span data-stu-id="71bf3-289">A1</span></span>                              </td><td><span data-ttu-id="71bf3-290">Seleccione la máquina virtual en función de las necesidades de E/S; Para ello, deje el valor predeterminado</span><span class="sxs-lookup"><span data-stu-id="71bf3-290">Select the VM based on the IO needs; for this purpose leave the default</span></span> </td><tr>
<tr><td> <span data-ttu-id="71bf3-291">NOMBRE DE USUARIO NUEVO</span><span class="sxs-lookup"><span data-stu-id="71bf3-291">NEW USER NAME</span></span>             </td><td> <span data-ttu-id="71bf3-292">localadmin</span><span class="sxs-lookup"><span data-stu-id="71bf3-292">localadmin</span></span>                       </td><td> <span data-ttu-id="71bf3-293">"admin" es un nombre de usuario reservado en Ubuntu 12.xx y versiones posteriores</span><span class="sxs-lookup"><span data-stu-id="71bf3-293">"admin" is a reserved user name in Ubuntu 12.xx and after</span></span></td><tr>
<tr><td> <span data-ttu-id="71bf3-294">AUTENTICACIÓN</span><span class="sxs-lookup"><span data-stu-id="71bf3-294">AUTHENTICATION</span></span>         </td><td> <span data-ttu-id="71bf3-295">Haga clic en la casilla</span><span class="sxs-lookup"><span data-stu-id="71bf3-295">Click check box</span></span>                 </td><td><span data-ttu-id="71bf3-296">Seleccione la casilla si desea protección con una clave SSH</span><span class="sxs-lookup"><span data-stu-id="71bf3-296">Check if you want to secure with an SSH key</span></span> </td><tr>
<tr><td> <span data-ttu-id="71bf3-297">CERTIFICADO</span><span class="sxs-lookup"><span data-stu-id="71bf3-297">CERTIFICATE</span></span>             </td><td> <span data-ttu-id="71bf3-298">nombre de archivo del certificado de clave pública</span><span class="sxs-lookup"><span data-stu-id="71bf3-298">file name of the public key certificate</span></span> </td><td> <span data-ttu-id="71bf3-299">Use la clave pública generada previamente</span><span class="sxs-lookup"><span data-stu-id="71bf3-299">Use the public key generated previously</span></span></td><tr>
<tr><td> <span data-ttu-id="71bf3-300">New Password</span><span class="sxs-lookup"><span data-stu-id="71bf3-300">New Password</span></span>    </td><td> <span data-ttu-id="71bf3-301">contraseña segura</span><span class="sxs-lookup"><span data-stu-id="71bf3-301">strong password</span></span> </td><td> </td><tr>
<tr><td> <span data-ttu-id="71bf3-302">Confirm Password</span><span class="sxs-lookup"><span data-stu-id="71bf3-302">Confirm Password</span></span>    </td><td> <span data-ttu-id="71bf3-303">contraseña segura</span><span class="sxs-lookup"><span data-stu-id="71bf3-303">strong password</span></span> </td><td></td><tr>
</table>

<span data-ttu-id="71bf3-304">En la pantalla "Configuración de la máquina virtual" #2, escriba la siguiente información:</span><span class="sxs-lookup"><span data-stu-id="71bf3-304">Enter the following information on the “Virtual machine configuration” screen #2:</span></span>

<table>
<tr><th><span data-ttu-id="71bf3-305">NOMBRE DEL CAMPO</span><span class="sxs-lookup"><span data-stu-id="71bf3-305">FIELD NAME</span></span>             </th><th> <span data-ttu-id="71bf3-306">VALOR DEL CAMPO</span><span class="sxs-lookup"><span data-stu-id="71bf3-306">FIELD VALUE</span></span>                       </th><th> <span data-ttu-id="71bf3-307">COMENTARIOS</span><span class="sxs-lookup"><span data-stu-id="71bf3-307">REMARKS</span></span>                                 </th></tr>
<tr><td> <span data-ttu-id="71bf3-308">SERVICIO EN LA NUBE</span><span class="sxs-lookup"><span data-stu-id="71bf3-308">CLOUD SERVICE</span></span>    </td><td> <span data-ttu-id="71bf3-309">Crear un nuevo servicio en la nube</span><span class="sxs-lookup"><span data-stu-id="71bf3-309">Create a new cloud service</span></span>    </td><td><span data-ttu-id="71bf3-310">El servicio de nube es un recurso de proceso de contenedor como máquinas virtuales</span><span class="sxs-lookup"><span data-stu-id="71bf3-310">Cloud service is a container compute resources like virtual machines</span></span></td></tr>
<tr><td> <span data-ttu-id="71bf3-311">NOMBRE DE DNS DEL SERVICIO EN LA NUBE</span><span class="sxs-lookup"><span data-stu-id="71bf3-311">CLOUD SERVICE DNS NAME</span></span>    </td><td><span data-ttu-id="71bf3-312">ubuntu-template.cloudapp.net</span><span class="sxs-lookup"><span data-stu-id="71bf3-312">ubuntu-template.cloudapp.net</span></span>    </td><td><span data-ttu-id="71bf3-313">Defina un nombre de equilibrador de carga independiente de la máquina</span><span class="sxs-lookup"><span data-stu-id="71bf3-313">Give a machine agnostic load balancer name</span></span></td></tr>
<tr><td> <span data-ttu-id="71bf3-314">REGION/GRUPO DE AFINIDAD/RED VIRTUAL</span><span class="sxs-lookup"><span data-stu-id="71bf3-314">REGION/AFFINITY GROUP/VIRTUAL NETWORK</span></span> </td><td>    <span data-ttu-id="71bf3-315">Oeste de EE. UU.</span><span class="sxs-lookup"><span data-stu-id="71bf3-315">West US</span></span>    </td><td> <span data-ttu-id="71bf3-316">Seleccione una región desde donde las aplicaciones web tienen acceso al clúster de Cassandra</span><span class="sxs-lookup"><span data-stu-id="71bf3-316">Select a region from which your web applications access the Cassandra cluster</span></span></td></tr>
<tr><td><span data-ttu-id="71bf3-317">STORAGE ACCOUNT</span><span class="sxs-lookup"><span data-stu-id="71bf3-317">STORAGE ACCOUNT</span></span> </td><td>    <span data-ttu-id="71bf3-318">Use el valor predeterminado</span><span class="sxs-lookup"><span data-stu-id="71bf3-318">Use default</span></span>    </td><td><span data-ttu-id="71bf3-319">Use la cuenta de almacenamiento predeterminada o una cuenta de almacenamiento creada previamente en una región determinada</span><span class="sxs-lookup"><span data-stu-id="71bf3-319">Use the default storage account  or a pre-created storage account in a particular region</span></span></td></tr>
<tr><td><span data-ttu-id="71bf3-320">El conjunto de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="71bf3-320">AVAILABILITY SET</span></span> </td><td>    <span data-ttu-id="71bf3-321">None</span><span class="sxs-lookup"><span data-stu-id="71bf3-321">None</span></span> </td><td>    <span data-ttu-id="71bf3-322">Deje este parámetro en blanco</span><span class="sxs-lookup"><span data-stu-id="71bf3-322">Leave it blank</span></span></td></tr>
<tr><td><span data-ttu-id="71bf3-323">EXTREMOS</span><span class="sxs-lookup"><span data-stu-id="71bf3-323">ENDPOINTS</span></span>    </td><td><span data-ttu-id="71bf3-324">Use el valor predeterminado</span><span class="sxs-lookup"><span data-stu-id="71bf3-324">Use default</span></span> </td><td>    <span data-ttu-id="71bf3-325">Use la configuración predeterminada de SSH</span><span class="sxs-lookup"><span data-stu-id="71bf3-325">Use the default SSH configuration</span></span> </td></tr>
</table>

<span data-ttu-id="71bf3-326">Haga clic en la flecha a la derecha, deje los valores predeterminados en la pantalla #3 y haga clic en el botón "comprobar" para completar el proceso de aprovisionamiento de VM.</span><span class="sxs-lookup"><span data-stu-id="71bf3-326">Click right arrow, leave the defaults on the screen #3 and click the “check” button to complete the VM provisioning process.</span></span> <span data-ttu-id="71bf3-327">Después de unos minutos, la máquina virtual con el nombre "ubuntu-template" debe aparecer con el estado "en ejecución".</span><span class="sxs-lookup"><span data-stu-id="71bf3-327">After a few minutes, the VM with the name “ubuntu-template” should be in a “running” status.</span></span>

### <a name="install-the-necessary-software"></a><span data-ttu-id="71bf3-328">INSTALAR EL SOFTWARE NECESARIO</span><span class="sxs-lookup"><span data-stu-id="71bf3-328">INSTALL THE NECESSARY SOFTWARE</span></span>
#### <a name="step-1-upload-tarballs"></a><span data-ttu-id="71bf3-329">PASO 1: Carga de tarballs</span><span class="sxs-lookup"><span data-stu-id="71bf3-329">STEP 1: Upload tarballs</span></span>
<span data-ttu-id="71bf3-330">Mediante scp o pscp, copie el software descargado anteriormente en el directorio ~/downloads mediante el comando siguiente:</span><span class="sxs-lookup"><span data-stu-id="71bf3-330">Using scp or pscp, copy the previously downloaded software to ~/downloads directory using the following command format:</span></span>

##### <a name="pscp-server-jre-8u5-linux-x64targz-localadminhk-cas-templatecloudappnethomelocaladmindownloadsserver-jre-8u5-linux-x64targz"></a><span data-ttu-id="71bf3-331">pscp server-jre-8u5-linux-x64.tar.gz localadmin@hk-cas-template.cloudapp.net:/home/localadmin/downloads/server-jre-8u5-linux-x64.tar.gz</span><span class="sxs-lookup"><span data-stu-id="71bf3-331">pscp server-jre-8u5-linux-x64.tar.gz localadmin@hk-cas-template.cloudapp.net:/home/localadmin/downloads/server-jre-8u5-linux-x64.tar.gz</span></span>
<span data-ttu-id="71bf3-332">Repita el comando anterior para JRE, así como para los bits de Cassandra.</span><span class="sxs-lookup"><span data-stu-id="71bf3-332">Repeat the above command for JRE as well as for the Cassandra bits.</span></span>

#### <a name="step-2-prepare-the-directory-structure-and-extract-the-archives"></a><span data-ttu-id="71bf3-333">PASO 2: Preparación de la estructura de directorios y extracción de archivos</span><span class="sxs-lookup"><span data-stu-id="71bf3-333">STEP 2: Prepare the directory structure and extract the archives</span></span>
<span data-ttu-id="71bf3-334">Inicie sesión en la máquina virtual y cree la estructura de directorios y extraiga el software como un superusuario mediante la siguiente secuencia de comandos de bash:</span><span class="sxs-lookup"><span data-stu-id="71bf3-334">Log into the VM and create the directory structure and extract software as a super user using the bash script below:</span></span>

    #!/bin/bash
    CASS_INSTALL_DIR="/opt/cassandra"
    JRE_INSTALL_DIR="/opt/java"
    CASS_DATA_DIR="/var/lib/cassandra"
    CASS_LOG_DIR="/var/log/cassandra"
    DOWNLOADS_DIR="~/downloads"
    JRE_TARBALL="server-jre-8u5-linux-x64.tar.gz"
    CASS_TARBALL="apache-cassandra-2.0.8-bin.tar.gz"
    SVC_USER="localadmin"

    RESET_ERROR=1
    MKDIR_ERROR=2

    reset_installation ()
    {
       rm -rf $CASS_INSTALL_DIR 2> /dev/null
       rm -rf $JRE_INSTALL_DIR 2> /dev/null
       rm -rf $CASS_DATA_DIR 2> /dev/null
       rm -rf $CASS_LOG_DIR 2> /dev/null
    }
    make_dir ()
    {
       if [ -z "$1" ]
       then
          echo "make_dir: invalid directory name"
          exit $MKDIR_ERROR
       fi

       if [ -d "$1" ]
       then
          echo "make_dir: directory already exists"
          exit $MKDIR_ERROR
       fi

       mkdir $1 2>/dev/null
       if [ $? != 0 ]
       then
          echo "directory creation failed"
          exit $MKDIR_ERROR
       fi
    }

    unzip()
    {
       if [ $# == 2 ]
       then
          tar xzf $1 -C $2
       else
          echo "archive error"
       fi

    }

    if [ -n "$1" ]
    then
       SVC_USER=$1
    fi

    reset_installation
    make_dir $CASS_INSTALL_DIR
    make_dir $JRE_INSTALL_DIR
    make_dir $CASS_DATA_DIR
    make_dir $CASS_LOG_DIR

    #unzip JRE and Cassandra
    unzip $HOME/downloads/$JRE_TARBALL $JRE_INSTALL_DIR
    unzip $HOME/downloads/$CASS_TARBALL $CASS_INSTALL_DIR

    #Change the ownership to the service credentials

    chown -R $SVC_USER:$GROUP $CASS_DATA_DIR
    chown -R $SVC_USER:$GROUP $CASS_LOG_DIR
    echo "edit /etc/profile to add JRE to the PATH"
    echo "installation is complete"


<span data-ttu-id="71bf3-335">Si pega esta secuencia de comandos en la ventana de vim, asegúrese de quitar el retorno de carro ('\r ") mediante el comando siguiente:</span><span class="sxs-lookup"><span data-stu-id="71bf3-335">If you paste this script into vim window, make sure to remove the carriage return (‘\r”) using the following command:</span></span>

    tr -d '\r' <infile.sh >outfile.sh

#### <a name="step-3-edit-etcprofile"></a><span data-ttu-id="71bf3-336">Paso 3: Edición de perfil/etc.</span><span class="sxs-lookup"><span data-stu-id="71bf3-336">Step 3: Edit etc/profile</span></span>
<span data-ttu-id="71bf3-337">Agregue lo siguiente al final:</span><span class="sxs-lookup"><span data-stu-id="71bf3-337">Append the following at the end:</span></span>

    JAVA_HOME=/opt/java/jdk1.8.0_05
    CASS_HOME= /opt/cassandra/apache-cassandra-2.0.8
    PATH=$PATH:$HOME/bin:$JAVA_HOME/bin:$CASS_HOME/bin
    export JAVA_HOME
    export CASS_HOME
    export PATH

#### <a name="step-4-install-jna-for-production-systems"></a><span data-ttu-id="71bf3-338">Paso 4: Instalación de JNA para sistemas de producción</span><span class="sxs-lookup"><span data-stu-id="71bf3-338">Step 4: Install JNA for production systems</span></span>
<span data-ttu-id="71bf3-339">Utilice el siguiente script: El siguiente comando instalará jna 3.2.7.jar y jna-platform-3.2.7.jar en el directorio /usr/share.java sudo apt-get install libjna-java</span><span class="sxs-lookup"><span data-stu-id="71bf3-339">Use the following command sequence: The following command will install jna-3.2.7.jar and jna-platform-3.2.7.jar to /usr/share.java directory sudo apt-get install libjna-java</span></span>

<span data-ttu-id="71bf3-340">Cree vínculos simbólicos en el directorio de $CASS_HOME/lib para que el script de inicio de Cassandra pueda encontrar estos JAR:</span><span class="sxs-lookup"><span data-stu-id="71bf3-340">Create symbolic links in $CASS_HOME/lib directory so that Cassandra startup script can find these jars:</span></span>

    ln -s /usr/share/java/jna-3.2.7.jar $CASS_HOME/lib/jna.jar

    ln -s /usr/share/java/jna-platform-3.2.7.jar $CASS_HOME/lib/jna-platform.jar

#### <a name="step-5-configure-cassandrayaml"></a><span data-ttu-id="71bf3-341">Paso 5: Configuración de cassandra.yaml</span><span class="sxs-lookup"><span data-stu-id="71bf3-341">Step 5: Configure cassandra.yaml</span></span>
<span data-ttu-id="71bf3-342">Edite cassandra.yaml en cada máquina virtual para reflejar la configuración necesaria para todas las máquinas virtuales [ajustaremos esto durante el aprovisionamiento real]:</span><span class="sxs-lookup"><span data-stu-id="71bf3-342">Edit cassandra.yaml on each VM to reflect configuration needed by all the virtual machines [we will tweak this during the actual provisioning]:</span></span>

<table>
<tr><th><span data-ttu-id="71bf3-343">Nombre del campo</span><span class="sxs-lookup"><span data-stu-id="71bf3-343">Field Name</span></span>   </th><th> <span data-ttu-id="71bf3-344">Valor</span><span class="sxs-lookup"><span data-stu-id="71bf3-344">Value</span></span>  </th><th>    <span data-ttu-id="71bf3-345">Comentarios</span><span class="sxs-lookup"><span data-stu-id="71bf3-345">Remarks</span></span> </th></tr>
<tr><td><span data-ttu-id="71bf3-346">cluster_name</span><span class="sxs-lookup"><span data-stu-id="71bf3-346">cluster_name</span></span> </td><td>    <span data-ttu-id="71bf3-347">"CustomerService"</span><span class="sxs-lookup"><span data-stu-id="71bf3-347">“CustomerService”</span></span>    </td><td> <span data-ttu-id="71bf3-348">Utilice el nombre que refleje la implementación</span><span class="sxs-lookup"><span data-stu-id="71bf3-348">Use the name that reflects your deployment</span></span></td></tr>
<tr><td><span data-ttu-id="71bf3-349">listen_address</span><span class="sxs-lookup"><span data-stu-id="71bf3-349">listen_address</span></span>    </td><td><span data-ttu-id="71bf3-350">[deje este parámetro en blanco]</span><span class="sxs-lookup"><span data-stu-id="71bf3-350">[leave it blank]</span></span>    </td><td> <span data-ttu-id="71bf3-351">Elimine "localhost"</span><span class="sxs-lookup"><span data-stu-id="71bf3-351">Delete “localhost”</span></span> </td></tr>
<tr><td><span data-ttu-id="71bf3-352">rpc_addres</span><span class="sxs-lookup"><span data-stu-id="71bf3-352">rpc_addres</span></span>   </td><td><span data-ttu-id="71bf3-353">[deje este parámetro en blanco]</span><span class="sxs-lookup"><span data-stu-id="71bf3-353">[leave it blank]</span></span>    </td><td> <span data-ttu-id="71bf3-354">Elimine "localhost"</span><span class="sxs-lookup"><span data-stu-id="71bf3-354">Delete “localhost”</span></span> </td></tr>
<tr><td><span data-ttu-id="71bf3-355">seeds</span><span class="sxs-lookup"><span data-stu-id="71bf3-355">seeds</span></span>    </td><td><span data-ttu-id="71bf3-356">"10.1.2.4, 10.1.2.6, 10.1.2.8"</span><span class="sxs-lookup"><span data-stu-id="71bf3-356">"10.1.2.4, 10.1.2.6, 10.1.2.8"</span></span>    </td><td><span data-ttu-id="71bf3-357">Lista de todas las direcciones IP que están designadas como valores de inicialización.</span><span class="sxs-lookup"><span data-stu-id="71bf3-357">List of  all the IP addresses which are designated as seeds.</span></span></td></tr>
<tr><td><span data-ttu-id="71bf3-358">endpoint_snitch</span><span class="sxs-lookup"><span data-stu-id="71bf3-358">endpoint_snitch</span></span> </td><td> <span data-ttu-id="71bf3-359">org.apache.cassandra.locator.GossipingPropertyFileSnitch</span><span class="sxs-lookup"><span data-stu-id="71bf3-359">org.apache.cassandra.locator.GossipingPropertyFileSnitch</span></span> </td><td> <span data-ttu-id="71bf3-360">NetworkTopologyStrateg lo utiliza para deducir el centro de datos y el bastidor de la máquina virtual</span><span class="sxs-lookup"><span data-stu-id="71bf3-360">This is used by the NetworkTopologyStrateg for inferring the data center and the rack of the VM</span></span></td></tr>
</table>

#### <a name="step-6-capture-the-vm-image"></a><span data-ttu-id="71bf3-361">Paso 6: Captura de imagen de máquina virtual</span><span class="sxs-lookup"><span data-stu-id="71bf3-361">Step 6: Capture the VM image</span></span>
<span data-ttu-id="71bf3-362">Inicie sesión en la máquina virtual con el nombre de host (hk-cas-template.cloudapp.net) y la clave privada de SSH creada anteriormente.</span><span class="sxs-lookup"><span data-stu-id="71bf3-362">Log into the virtual machine using the hostname (hk-cas-template.cloudapp.net) and the SSH private key previously created.</span></span> <span data-ttu-id="71bf3-363">Vea cómo utilizar SSH con Linux en Azure para obtener más información sobre cómo iniciar sesión utilizando el comando ssh o putty.exe.</span><span class="sxs-lookup"><span data-stu-id="71bf3-363">See How to Use SSH with Linux on Azure for details on how to log in using the command ssh or putty.exe.</span></span>

<span data-ttu-id="71bf3-364">Ejecute la siguiente secuencia de acciones para capturar la imagen:</span><span class="sxs-lookup"><span data-stu-id="71bf3-364">Execute the following sequence of actions to capture the image:</span></span>

##### <a name="1-deprovision"></a><span data-ttu-id="71bf3-365">1. Desaprovisionamiento</span><span class="sxs-lookup"><span data-stu-id="71bf3-365">1. Deprovision</span></span>
<span data-ttu-id="71bf3-366">Use el comando “sudo waagent –deprovision+user” para quitar la información específica de la instancia de máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="71bf3-366">Use the command “sudo waagent –deprovision+user” to remove Virtual Machine instance specific information.</span></span> <span data-ttu-id="71bf3-367">Consulte [Captura de una máquina virtual de Linux](capture-image.md) para usar como plantilla. Encontrará más detalles en el proceso de captura de imagen.</span><span class="sxs-lookup"><span data-stu-id="71bf3-367">See for [How to Capture a Linux Virtual Machine](capture-image.md) to Use as a Template more details on the image capture process.</span></span>

##### <a name="2-shutdown-the-vm"></a><span data-ttu-id="71bf3-368">2: Apagado de la máquina virtual</span><span class="sxs-lookup"><span data-stu-id="71bf3-368">2: Shutdown the VM</span></span>
<span data-ttu-id="71bf3-369">Asegúrese de que la máquina virtual está resaltada y haga clic en el vínculo de cierre de la barra de comandos de la parte inferior.</span><span class="sxs-lookup"><span data-stu-id="71bf3-369">Make sure that the virtual machine is highlighted and click the SHUTDOWN link from the bottom command bar.</span></span>

##### <a name="3-capture-the-image"></a><span data-ttu-id="71bf3-370">3: Captura de la imagen</span><span class="sxs-lookup"><span data-stu-id="71bf3-370">3: Capture the image</span></span>
<span data-ttu-id="71bf3-371">Asegúrese de que la máquina virtual está resaltada y haga clic en el vínculo de captura de la barra de comandos de la parte inferior.</span><span class="sxs-lookup"><span data-stu-id="71bf3-371">Make sure that the virtual machine is highlighted and click the CAPTURE link from the bottom command bar.</span></span> <span data-ttu-id="71bf3-372">En la siguiente pantalla, asigne un nombre de imagen (por ejemplo, hk-cas-2-08-ub-14-04-2014071), una descripción de imagen apropiada, haga clic en la marca de verificación para finalizar el proceso de captura.</span><span class="sxs-lookup"><span data-stu-id="71bf3-372">In the next screen, give an IMAGE NAME (e.g. hk-cas-2-08-ub-14-04-2014071), appropriate IMAGE DESCRIPTION, and click the “check” mark to finish the CAPTURE process.</span></span>

<span data-ttu-id="71bf3-373">Esto tardará unos segundos. La imagen debe estar disponible en la sección Mis imágenes de la Galería de imágenes.</span><span class="sxs-lookup"><span data-stu-id="71bf3-373">This will take a few seconds and the image should be available in MY IMAGES section of the image gallery.</span></span> <span data-ttu-id="71bf3-374">La máquina virtual de origen se eliminará automáticamente después de que la imagen se capture correctamente.</span><span class="sxs-lookup"><span data-stu-id="71bf3-374">The source VM will be automatically deleted after the image is successfully captured.</span></span> 

## <a name="single-region-deployment-process"></a><span data-ttu-id="71bf3-375">Proceso de implementación en una sola región</span><span class="sxs-lookup"><span data-stu-id="71bf3-375">Single Region Deployment Process</span></span>
<span data-ttu-id="71bf3-376">**Paso 1: Creación de la red virtual** Inicie sesión en Azure Portal y cree una red virtual (clásica) con los atributos que se muestran en la tabla siguiente.</span><span class="sxs-lookup"><span data-stu-id="71bf3-376">**Step 1: Create the Virtual Network** Log into the Azure portal and create a virtual network (classic) with the attributes shown in the following table.</span></span> <span data-ttu-id="71bf3-377">Consulte [Creación de una red virtual (clásica) usando Azure Portal](../../../virtual-network/virtual-networks-create-vnet-classic-pportal.md) para obtener pasos detallados del proceso.</span><span class="sxs-lookup"><span data-stu-id="71bf3-377">See [Create a virtual network (classic) using the Azure portal](../../../virtual-network/virtual-networks-create-vnet-classic-pportal.md) for detailed steps of the process.</span></span>      

<table>
<tr><th><span data-ttu-id="71bf3-378">Nombre del atributo de VM</span><span class="sxs-lookup"><span data-stu-id="71bf3-378">VM Attribute Name</span></span></th><th><span data-ttu-id="71bf3-379">Valor</span><span class="sxs-lookup"><span data-stu-id="71bf3-379">Value</span></span></th><th><span data-ttu-id="71bf3-380">Comentarios</span><span class="sxs-lookup"><span data-stu-id="71bf3-380">Remarks</span></span></th></tr>
<tr><td><span data-ttu-id="71bf3-381">Nombre</span><span class="sxs-lookup"><span data-stu-id="71bf3-381">Name</span></span></td><td><span data-ttu-id="71bf3-382">vnet-cass-west-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-382">vnet-cass-west-us</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="71bf3-383">Region</span><span class="sxs-lookup"><span data-stu-id="71bf3-383">Region</span></span></td><td><span data-ttu-id="71bf3-384">Oeste de EE. UU.</span><span class="sxs-lookup"><span data-stu-id="71bf3-384">West US</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="71bf3-385">Servidores DNS</span><span class="sxs-lookup"><span data-stu-id="71bf3-385">DNS Servers</span></span></td><td><span data-ttu-id="71bf3-386">None</span><span class="sxs-lookup"><span data-stu-id="71bf3-386">None</span></span></td><td><span data-ttu-id="71bf3-387">Ignore esto, ya que no estamos usando un servidor DNS</span><span class="sxs-lookup"><span data-stu-id="71bf3-387">Ignore this as we are not using a DNS Server</span></span></td></tr>
<tr><td><span data-ttu-id="71bf3-388">Espacio de direcciones</span><span class="sxs-lookup"><span data-stu-id="71bf3-388">Address Space</span></span></td><td><span data-ttu-id="71bf3-389">10.1.0.0/16</span><span class="sxs-lookup"><span data-stu-id="71bf3-389">10.1.0.0/16</span></span></td><td></td></tr>    
<tr><td><span data-ttu-id="71bf3-390">IP inicial:</span><span class="sxs-lookup"><span data-stu-id="71bf3-390">Starting IP</span></span></td><td><span data-ttu-id="71bf3-391">10.1.0.0</span><span class="sxs-lookup"><span data-stu-id="71bf3-391">10.1.0.0</span></span></td><td></td></tr>    
<tr><td><span data-ttu-id="71bf3-392">CIDR</span><span class="sxs-lookup"><span data-stu-id="71bf3-392">CIDR</span></span> </td><td><span data-ttu-id="71bf3-393">/16 (65531)</span><span class="sxs-lookup"><span data-stu-id="71bf3-393">/16 (65531)</span></span></td><td></td></tr>
</table>

<span data-ttu-id="71bf3-394">Agregue las siguientes subredes:</span><span class="sxs-lookup"><span data-stu-id="71bf3-394">Add the following subnets:</span></span>

<table>
<tr><th><span data-ttu-id="71bf3-395">Nombre</span><span class="sxs-lookup"><span data-stu-id="71bf3-395">Name</span></span></th><th><span data-ttu-id="71bf3-396">IP inicial:</span><span class="sxs-lookup"><span data-stu-id="71bf3-396">Starting IP</span></span></th><th><span data-ttu-id="71bf3-397">CIDR</span><span class="sxs-lookup"><span data-stu-id="71bf3-397">CIDR</span></span></th><th><span data-ttu-id="71bf3-398">Comentarios</span><span class="sxs-lookup"><span data-stu-id="71bf3-398">Remarks</span></span></th></tr>
<tr><td><span data-ttu-id="71bf3-399">web</span><span class="sxs-lookup"><span data-stu-id="71bf3-399">web</span></span></td><td><span data-ttu-id="71bf3-400">10.1.1.0</span><span class="sxs-lookup"><span data-stu-id="71bf3-400">10.1.1.0</span></span></td><td><span data-ttu-id="71bf3-401">/24 (251)</span><span class="sxs-lookup"><span data-stu-id="71bf3-401">/24 (251)</span></span></td><td><span data-ttu-id="71bf3-402">Subred de la granja de servidores web</span><span class="sxs-lookup"><span data-stu-id="71bf3-402">Subnet for the web farm</span></span></td></tr>
<tr><td><span data-ttu-id="71bf3-403">data</span><span class="sxs-lookup"><span data-stu-id="71bf3-403">data</span></span></td><td><span data-ttu-id="71bf3-404">10.1.2.0</span><span class="sxs-lookup"><span data-stu-id="71bf3-404">10.1.2.0</span></span></td><td><span data-ttu-id="71bf3-405">/24 (251)</span><span class="sxs-lookup"><span data-stu-id="71bf3-405">/24 (251)</span></span></td><td><span data-ttu-id="71bf3-406">Subred para los nodos de la base de datos</span><span class="sxs-lookup"><span data-stu-id="71bf3-406">Subnet for the database nodes</span></span></td></tr>
</table>

<span data-ttu-id="71bf3-407">Las subredes web y de datos se pueden proteger mediante grupos de seguridad de red, cuya cobertura está fuera del ámbito de este artículo.</span><span class="sxs-lookup"><span data-stu-id="71bf3-407">Data and Web subnets can be protected through network security groups the coverage of which is out of scope for this article.</span></span>  

<span data-ttu-id="71bf3-408">**Paso 2: Aprovisionamiento de máquinas virtuales** Con la imagen creada anteriormente, se crearán las siguientes máquinas virtuales en el servidor de la nube “hk-c-svc-west” y se unirán a las subredes correspondientes, tal y como se muestra a continuación:</span><span class="sxs-lookup"><span data-stu-id="71bf3-408">**Step 2: Provision Virtual Machines** Using the image created previously, we will create the following virtual machines in the cloud server “hk-c-svc-west” and bind them to the respective subnets as shown below:</span></span>

<table>
<tr><th><span data-ttu-id="71bf3-409">Nombre de máquina</span><span class="sxs-lookup"><span data-stu-id="71bf3-409">Machine Name</span></span>    </th><th><span data-ttu-id="71bf3-410">Subred</span><span class="sxs-lookup"><span data-stu-id="71bf3-410">Subnet</span></span>    </th><th><span data-ttu-id="71bf3-411">Dirección IP</span><span class="sxs-lookup"><span data-stu-id="71bf3-411">IP Address</span></span>    </th><th><span data-ttu-id="71bf3-412">El conjunto de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="71bf3-412">Availability set</span></span></th><th><span data-ttu-id="71bf3-413">Controlador de dominio/bastidor</span><span class="sxs-lookup"><span data-stu-id="71bf3-413">DC/Rack</span></span></th><th><span data-ttu-id="71bf3-414">¿Valor de inicialización?</span><span class="sxs-lookup"><span data-stu-id="71bf3-414">Seed?</span></span></th></tr>
<tr><td><span data-ttu-id="71bf3-415">hk-c1-west-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-415">hk-c1-west-us</span></span>    </td><td><span data-ttu-id="71bf3-416">data</span><span class="sxs-lookup"><span data-stu-id="71bf3-416">data</span></span>    </td><td><span data-ttu-id="71bf3-417">10.1.2.4</span><span class="sxs-lookup"><span data-stu-id="71bf3-417">10.1.2.4</span></span>    </td><td><span data-ttu-id="71bf3-418">hk-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="71bf3-418">hk-c-aset-1</span></span>    </td><td><span data-ttu-id="71bf3-419">dc =WESTUS rack =rack1</span><span class="sxs-lookup"><span data-stu-id="71bf3-419">dc =WESTUS rack =rack1</span></span> </td><td><span data-ttu-id="71bf3-420">Sí</span><span class="sxs-lookup"><span data-stu-id="71bf3-420">Yes</span></span></td></tr>
<tr><td><span data-ttu-id="71bf3-421">hk-c2-west-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-421">hk-c2-west-us</span></span>    </td><td><span data-ttu-id="71bf3-422">data</span><span class="sxs-lookup"><span data-stu-id="71bf3-422">data</span></span>    </td><td><span data-ttu-id="71bf3-423">10.1.2.5</span><span class="sxs-lookup"><span data-stu-id="71bf3-423">10.1.2.5</span></span>    </td><td><span data-ttu-id="71bf3-424">hk-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="71bf3-424">hk-c-aset-1</span></span>    </td><td><span data-ttu-id="71bf3-425">dc =WESTUS rack =rack1</span><span class="sxs-lookup"><span data-stu-id="71bf3-425">dc =WESTUS rack =rack1</span></span>    </td><td><span data-ttu-id="71bf3-426">No</span><span class="sxs-lookup"><span data-stu-id="71bf3-426">No</span></span> </td></tr>
<tr><td><span data-ttu-id="71bf3-427">hk-c3-west-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-427">hk-c3-west-us</span></span>    </td><td><span data-ttu-id="71bf3-428">data</span><span class="sxs-lookup"><span data-stu-id="71bf3-428">data</span></span>    </td><td><span data-ttu-id="71bf3-429">10.1.2.6</span><span class="sxs-lookup"><span data-stu-id="71bf3-429">10.1.2.6</span></span>    </td><td><span data-ttu-id="71bf3-430">hk-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="71bf3-430">hk-c-aset-1</span></span>    </td><td><span data-ttu-id="71bf3-431">dc =WESTUS rack =rack2</span><span class="sxs-lookup"><span data-stu-id="71bf3-431">dc =WESTUS rack =rack2</span></span>    </td><td><span data-ttu-id="71bf3-432">Sí</span><span class="sxs-lookup"><span data-stu-id="71bf3-432">Yes</span></span></td></tr>
<tr><td><span data-ttu-id="71bf3-433">hk-c4-west-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-433">hk-c4-west-us</span></span>    </td><td><span data-ttu-id="71bf3-434">data</span><span class="sxs-lookup"><span data-stu-id="71bf3-434">data</span></span>    </td><td><span data-ttu-id="71bf3-435">10.1.2.7</span><span class="sxs-lookup"><span data-stu-id="71bf3-435">10.1.2.7</span></span>    </td><td><span data-ttu-id="71bf3-436">hk-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="71bf3-436">hk-c-aset-1</span></span>    </td><td><span data-ttu-id="71bf3-437">dc =WESTUS rack =rack2</span><span class="sxs-lookup"><span data-stu-id="71bf3-437">dc =WESTUS rack =rack2</span></span>    </td><td><span data-ttu-id="71bf3-438">No</span><span class="sxs-lookup"><span data-stu-id="71bf3-438">No</span></span> </td></tr>
<tr><td><span data-ttu-id="71bf3-439">hk-c5-west-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-439">hk-c5-west-us</span></span>    </td><td><span data-ttu-id="71bf3-440">data</span><span class="sxs-lookup"><span data-stu-id="71bf3-440">data</span></span>    </td><td><span data-ttu-id="71bf3-441">10.1.2.8</span><span class="sxs-lookup"><span data-stu-id="71bf3-441">10.1.2.8</span></span>    </td><td><span data-ttu-id="71bf3-442">hk-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="71bf3-442">hk-c-aset-2</span></span>    </td><td><span data-ttu-id="71bf3-443">dc =WESTUS rack =rack3</span><span class="sxs-lookup"><span data-stu-id="71bf3-443">dc =WESTUS rack =rack3</span></span>    </td><td><span data-ttu-id="71bf3-444">Sí</span><span class="sxs-lookup"><span data-stu-id="71bf3-444">Yes</span></span></td></tr>
<tr><td><span data-ttu-id="71bf3-445">hk-c6-west-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-445">hk-c6-west-us</span></span>    </td><td><span data-ttu-id="71bf3-446">data</span><span class="sxs-lookup"><span data-stu-id="71bf3-446">data</span></span>    </td><td><span data-ttu-id="71bf3-447">10.1.2.9</span><span class="sxs-lookup"><span data-stu-id="71bf3-447">10.1.2.9</span></span>    </td><td><span data-ttu-id="71bf3-448">hk-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="71bf3-448">hk-c-aset-2</span></span>    </td><td><span data-ttu-id="71bf3-449">dc =WESTUS rack =rack3</span><span class="sxs-lookup"><span data-stu-id="71bf3-449">dc =WESTUS rack =rack3</span></span>    </td><td><span data-ttu-id="71bf3-450">No</span><span class="sxs-lookup"><span data-stu-id="71bf3-450">No</span></span> </td></tr>
<tr><td><span data-ttu-id="71bf3-451">hk-c7-west-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-451">hk-c7-west-us</span></span>    </td><td><span data-ttu-id="71bf3-452">data</span><span class="sxs-lookup"><span data-stu-id="71bf3-452">data</span></span>    </td><td><span data-ttu-id="71bf3-453">10.1.2.10</span><span class="sxs-lookup"><span data-stu-id="71bf3-453">10.1.2.10</span></span>    </td><td><span data-ttu-id="71bf3-454">hk-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="71bf3-454">hk-c-aset-2</span></span>    </td><td><span data-ttu-id="71bf3-455">dc =WESTUS rack =rack4</span><span class="sxs-lookup"><span data-stu-id="71bf3-455">dc =WESTUS rack =rack4</span></span>    </td><td><span data-ttu-id="71bf3-456">Sí</span><span class="sxs-lookup"><span data-stu-id="71bf3-456">Yes</span></span></td></tr>
<tr><td><span data-ttu-id="71bf3-457">hk-c8-west-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-457">hk-c8-west-us</span></span>    </td><td><span data-ttu-id="71bf3-458">data</span><span class="sxs-lookup"><span data-stu-id="71bf3-458">data</span></span>    </td><td><span data-ttu-id="71bf3-459">10.1.2.11</span><span class="sxs-lookup"><span data-stu-id="71bf3-459">10.1.2.11</span></span>    </td><td><span data-ttu-id="71bf3-460">hk-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="71bf3-460">hk-c-aset-2</span></span>    </td><td><span data-ttu-id="71bf3-461">dc =WESTUS rack =rack4</span><span class="sxs-lookup"><span data-stu-id="71bf3-461">dc =WESTUS rack =rack4</span></span>    </td><td><span data-ttu-id="71bf3-462">No</span><span class="sxs-lookup"><span data-stu-id="71bf3-462">No</span></span> </td></tr>
<tr><td><span data-ttu-id="71bf3-463">hk-w1-west-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-463">hk-w1-west-us</span></span>    </td><td><span data-ttu-id="71bf3-464">web</span><span class="sxs-lookup"><span data-stu-id="71bf3-464">web</span></span>    </td><td><span data-ttu-id="71bf3-465">10.1.1.4</span><span class="sxs-lookup"><span data-stu-id="71bf3-465">10.1.1.4</span></span>    </td><td><span data-ttu-id="71bf3-466">hk-w-aset-1</span><span class="sxs-lookup"><span data-stu-id="71bf3-466">hk-w-aset-1</span></span>    </td><td>                       </td><td><span data-ttu-id="71bf3-467">N/D</span><span class="sxs-lookup"><span data-stu-id="71bf3-467">N/A</span></span></td></tr>
<tr><td><span data-ttu-id="71bf3-468">hk-w2-west-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-468">hk-w2-west-us</span></span>    </td><td><span data-ttu-id="71bf3-469">web</span><span class="sxs-lookup"><span data-stu-id="71bf3-469">web</span></span>    </td><td><span data-ttu-id="71bf3-470">10.1.1.5</span><span class="sxs-lookup"><span data-stu-id="71bf3-470">10.1.1.5</span></span>    </td><td><span data-ttu-id="71bf3-471">hk-w-aset-1</span><span class="sxs-lookup"><span data-stu-id="71bf3-471">hk-w-aset-1</span></span>    </td><td>                       </td><td><span data-ttu-id="71bf3-472">N/D</span><span class="sxs-lookup"><span data-stu-id="71bf3-472">N/A</span></span></td></tr>
</table>

<span data-ttu-id="71bf3-473">La creación de la lista anterior de máquinas virtuales requiere el siguiente proceso:</span><span class="sxs-lookup"><span data-stu-id="71bf3-473">Creation of the above list of VMs requires the following process:</span></span>

1. <span data-ttu-id="71bf3-474">Crear un servicio de nube vacía en una región determinada</span><span class="sxs-lookup"><span data-stu-id="71bf3-474">Create an empty cloud service in a particular region</span></span>
2. <span data-ttu-id="71bf3-475">Cree una máquina virtual desde la imagen capturada anteriormente y adjúntela a la red virtual creada anteriormente; repita este paso para todas las máquinas virtuales</span><span class="sxs-lookup"><span data-stu-id="71bf3-475">Create a VM from the previously captured image and attach it to the virtual network created previously; repeat this for all the VMs</span></span>
3. <span data-ttu-id="71bf3-476">Agregue un equilibrador de carga interno para el servicio de nube y adjúntelo a la subred "data"</span><span class="sxs-lookup"><span data-stu-id="71bf3-476">Add an internal load balancer to the cloud service and attach it to the “data” subnet</span></span>
4. <span data-ttu-id="71bf3-477">Para cada máquina virtual creada anteriormente, agregue un extremo con equilibrio de carga para tráfico de thrift a través de un conjunto con equilibrio de carga conectado al equilibrador de carga interno creado anteriormente</span><span class="sxs-lookup"><span data-stu-id="71bf3-477">For each VM created previously, add a load balanced endpoint for thrift traffic through a load balanced set connected to the previously created internal load balancer</span></span>

<span data-ttu-id="71bf3-478">Puede ejecutar el proceso anterior mediante el Portal de Azure clásico. Use una máquina de Windows (use una máquina virtual en Azure si no tiene acceso a un equipo de Windows) y use el siguiente script de PowerShell para aprovisionar automáticamente las ocho máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="71bf3-478">The above process can be executed using Azure classic portal; use a Windows machine (use a VM on Azure if you don't have access to a Windows machine), use the following PowerShell script to provision all 8 VMs automatically.</span></span>

<span data-ttu-id="71bf3-479">**Lista 1: script de PowerShell para el aprovisionamiento de máquinas virtuales**</span><span class="sxs-lookup"><span data-stu-id="71bf3-479">**List 1: PowerShell script for provisioning virtual machines**</span></span>

        #Tested with Azure Powershell - November 2014
        #This powershell script deployes a number of VMs from an existing image inside an Azure region
        #Import your Azure subscription into the current Powershell session before proceeding
        #The process: 1. create Azure Storage account, 2. create virtual network, 3.create the VM template, 2. crate a list of VMs from the template

        #fundamental variables - change these to reflect your subscription
        $country="us"; $region="west"; $vnetName = "your_vnet_name";$storageAccount="your_storage_account"
        $numVMs=8;$prefix = "hk-cass";$ilbIP="your_ilb_ip"
        $subscriptionName = "Azure_subscription_name";
        $vmSize="ExtraSmall"; $imageName="your_linux_image_name"
        $ilbName="ThriftInternalLB"; $thriftEndPoint="ThriftEndPoint"

        #generated variables
        $serviceName = "$prefix-svc-$region-$country"; $azureRegion = "$region $country"

        $vmNames = @()
        for ($i=0; $i -lt $numVMs; $i++)
        {
           $vmNames+=("$prefix-vm"+($i+1) + "-$region-$country" );
        }

        #select an Azure subscription already imported into Powershell session
        Select-AzureSubscription -SubscriptionName $subscriptionName -Current
        Set-AzureSubscription -SubscriptionName $subscriptionName -CurrentStorageAccountName $storageAccount

        #create an empty cloud service
        New-AzureService -ServiceName $serviceName -Label "hkcass$region" -Location $azureRegion
        Write-Host "Created $serviceName"

        $VMList= @()   # stores the list of azure vm configuration objects
        #create the list of VMs
        foreach($vmName in $vmNames)
        {
           $VMList += New-AzureVMConfig -Name $vmName -InstanceSize ExtraSmall -ImageName $imageName |
           Add-AzureProvisioningConfig -Linux -LinuxUser "localadmin" -Password "Local123" |
           Set-AzureSubnet "data"
        }

        New-AzureVM -ServiceName $serviceName -VNetName $vnetName -VMs $VMList

        #Create internal load balancer
        Add-AzureInternalLoadBalancer -ServiceName $serviceName -InternalLoadBalancerName $ilbName -SubnetName "data" -StaticVNetIPAddress "$ilbIP"
        Write-Host "Created $ilbName"
        #Add add the thrift endpoint to the internal load balancer for all the VMs
        foreach($vmName in $vmNames)
        {
            Get-AzureVM -ServiceName $serviceName -Name $vmName |
                Add-AzureEndpoint -Name $thriftEndPoint -LBSetName "ThriftLBSet" -Protocol tcp -LocalPort 9160 -PublicPort 9160 -ProbePort 9160 -ProbeProtocol tcp -ProbeIntervalInSeconds 10 -InternalLoadBalancerName $ilbName |
                Update-AzureVM

            Write-Host "created $vmName"     
        }

<span data-ttu-id="71bf3-480">**Paso 3: Configuración de Cassandra en cada máquina virtual**</span><span class="sxs-lookup"><span data-stu-id="71bf3-480">**Step 3: Configure Cassandra on each VM**</span></span>

<span data-ttu-id="71bf3-481">Inicie sesión en la máquina virtual y realice lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="71bf3-481">Log into the VM and perform the following:</span></span>

* <span data-ttu-id="71bf3-482">Edite $CASS_HOME/conf/cassandra-rackdc.properties para especificar las propiedades del bastidor y del centro de datos:</span><span class="sxs-lookup"><span data-stu-id="71bf3-482">Edit $CASS_HOME/conf/cassandra-rackdc.properties to specify the data center and rack properties:</span></span>
  
       dc =EASTUS, rack =rack1
* <span data-ttu-id="71bf3-483">Edite cassandra.yaml para configurar los nodos de inicialización de la forma siguiente:</span><span class="sxs-lookup"><span data-stu-id="71bf3-483">Edit cassandra.yaml to configure seed nodes as below:</span></span>
  
       Seeds: "10.1.2.4,10.1.2.6,10.1.2.8,10.1.2.10"

<span data-ttu-id="71bf3-484">**Paso 4: Inicio de las máquinas virtuales y prueba del clúster**</span><span class="sxs-lookup"><span data-stu-id="71bf3-484">**Step 4: Start the VMs and test the cluster**</span></span>

<span data-ttu-id="71bf3-485">Inicie sesión en uno de los nodos (como hk-c1-west-us) y ejecute el cmdlet siguiente para ver el estado del clúster:</span><span class="sxs-lookup"><span data-stu-id="71bf3-485">Log into one of the nodes (e.g. hk-c1-west-us) and run the following command to see the status of the cluster:</span></span>

       nodetool –h 10.1.2.4 –p 7199 status

<span data-ttu-id="71bf3-486">Debería ver la pantalla similar a la siguiente para un clúster de 8 nodos:</span><span class="sxs-lookup"><span data-stu-id="71bf3-486">You should see the display similar to the one below for an 8-node cluster:</span></span>

<table>
<tr><th><span data-ttu-id="71bf3-487">Estado</span><span class="sxs-lookup"><span data-stu-id="71bf3-487">Status</span></span></th><th><span data-ttu-id="71bf3-488">Dirección</span><span class="sxs-lookup"><span data-stu-id="71bf3-488">Address</span></span>    </th><th><span data-ttu-id="71bf3-489">Carga</span><span class="sxs-lookup"><span data-stu-id="71bf3-489">Load</span></span>    </th><th><span data-ttu-id="71bf3-490">Tokens</span><span class="sxs-lookup"><span data-stu-id="71bf3-490">Tokens</span></span>    </th><th><span data-ttu-id="71bf3-491">Propiedad</span><span class="sxs-lookup"><span data-stu-id="71bf3-491">Owns</span></span> </th><th><span data-ttu-id="71bf3-492">Identificador de host</span><span class="sxs-lookup"><span data-stu-id="71bf3-492">Host ID</span></span>    </th><th><span data-ttu-id="71bf3-493">Bastidor</span><span class="sxs-lookup"><span data-stu-id="71bf3-493">Rack</span></span></th></tr>
<tr><th><span data-ttu-id="71bf3-494">UN</span><span class="sxs-lookup"><span data-stu-id="71bf3-494">UN</span></span>    </td><td><span data-ttu-id="71bf3-495">10.1.2.4</span><span class="sxs-lookup"><span data-stu-id="71bf3-495">10.1.2.4</span></span>     </td><td><span data-ttu-id="71bf3-496">87,81 KB</span><span class="sxs-lookup"><span data-stu-id="71bf3-496">87.81 KB</span></span>    </td><td><span data-ttu-id="71bf3-497">256</span><span class="sxs-lookup"><span data-stu-id="71bf3-497">256</span></span>    </td><td><span data-ttu-id="71bf3-498">38,0 %</span><span class="sxs-lookup"><span data-stu-id="71bf3-498">38.0%</span></span>    </td><td><span data-ttu-id="71bf3-499">GUID (eliminado)</span><span class="sxs-lookup"><span data-stu-id="71bf3-499">Guid (removed)</span></span></td><td><span data-ttu-id="71bf3-500">rack1</span><span class="sxs-lookup"><span data-stu-id="71bf3-500">rack1</span></span></td></tr>
<tr><th><span data-ttu-id="71bf3-501">UN</span><span class="sxs-lookup"><span data-stu-id="71bf3-501">UN</span></span>    </td><td><span data-ttu-id="71bf3-502">10.1.2.5</span><span class="sxs-lookup"><span data-stu-id="71bf3-502">10.1.2.5</span></span>     </td><td><span data-ttu-id="71bf3-503">41,08 KB</span><span class="sxs-lookup"><span data-stu-id="71bf3-503">41.08 KB</span></span>    </td><td><span data-ttu-id="71bf3-504">256</span><span class="sxs-lookup"><span data-stu-id="71bf3-504">256</span></span>    </td><td><span data-ttu-id="71bf3-505">68,9 %</span><span class="sxs-lookup"><span data-stu-id="71bf3-505">68.9%</span></span>    </td><td><span data-ttu-id="71bf3-506">GUID (eliminado)</span><span class="sxs-lookup"><span data-stu-id="71bf3-506">Guid (removed)</span></span></td><td><span data-ttu-id="71bf3-507">rack1</span><span class="sxs-lookup"><span data-stu-id="71bf3-507">rack1</span></span></td></tr>
<tr><th><span data-ttu-id="71bf3-508">UN</span><span class="sxs-lookup"><span data-stu-id="71bf3-508">UN</span></span>    </td><td><span data-ttu-id="71bf3-509">10.1.2.6</span><span class="sxs-lookup"><span data-stu-id="71bf3-509">10.1.2.6</span></span>     </td><td><span data-ttu-id="71bf3-510">55,29 KB</span><span class="sxs-lookup"><span data-stu-id="71bf3-510">55.29 KB</span></span>    </td><td><span data-ttu-id="71bf3-511">256</span><span class="sxs-lookup"><span data-stu-id="71bf3-511">256</span></span>    </td><td><span data-ttu-id="71bf3-512">68,8 %</span><span class="sxs-lookup"><span data-stu-id="71bf3-512">68.8%</span></span>    </td><td><span data-ttu-id="71bf3-513">GUID (eliminado)</span><span class="sxs-lookup"><span data-stu-id="71bf3-513">Guid (removed)</span></span></td><td><span data-ttu-id="71bf3-514">rack2</span><span class="sxs-lookup"><span data-stu-id="71bf3-514">rack2</span></span></td></tr>
<tr><th><span data-ttu-id="71bf3-515">UN</span><span class="sxs-lookup"><span data-stu-id="71bf3-515">UN</span></span>    </td><td><span data-ttu-id="71bf3-516">10.1.2.7</span><span class="sxs-lookup"><span data-stu-id="71bf3-516">10.1.2.7</span></span>     </td><td><span data-ttu-id="71bf3-517">55,29 KB</span><span class="sxs-lookup"><span data-stu-id="71bf3-517">55.29 KB</span></span>    </td><td><span data-ttu-id="71bf3-518">256</span><span class="sxs-lookup"><span data-stu-id="71bf3-518">256</span></span>    </td><td><span data-ttu-id="71bf3-519">68,8 %</span><span class="sxs-lookup"><span data-stu-id="71bf3-519">68.8%</span></span>    </td><td><span data-ttu-id="71bf3-520">GUID (eliminado)</span><span class="sxs-lookup"><span data-stu-id="71bf3-520">Guid (removed)</span></span></td><td><span data-ttu-id="71bf3-521">rack2</span><span class="sxs-lookup"><span data-stu-id="71bf3-521">rack2</span></span></td></tr>
<tr><th><span data-ttu-id="71bf3-522">UN</span><span class="sxs-lookup"><span data-stu-id="71bf3-522">UN</span></span>    </td><td><span data-ttu-id="71bf3-523">10.1.2.8</span><span class="sxs-lookup"><span data-stu-id="71bf3-523">10.1.2.8</span></span>     </td><td><span data-ttu-id="71bf3-524">55,29 KB</span><span class="sxs-lookup"><span data-stu-id="71bf3-524">55.29 KB</span></span>    </td><td><span data-ttu-id="71bf3-525">256</span><span class="sxs-lookup"><span data-stu-id="71bf3-525">256</span></span>    </td><td><span data-ttu-id="71bf3-526">68,8 %</span><span class="sxs-lookup"><span data-stu-id="71bf3-526">68.8%</span></span>    </td><td><span data-ttu-id="71bf3-527">GUID (eliminado)</span><span class="sxs-lookup"><span data-stu-id="71bf3-527">Guid (removed)</span></span></td><td><span data-ttu-id="71bf3-528">rack3</span><span class="sxs-lookup"><span data-stu-id="71bf3-528">rack3</span></span></td></tr>
<tr><th><span data-ttu-id="71bf3-529">UN</span><span class="sxs-lookup"><span data-stu-id="71bf3-529">UN</span></span>    </td><td><span data-ttu-id="71bf3-530">10.1.2.9</span><span class="sxs-lookup"><span data-stu-id="71bf3-530">10.1.2.9</span></span>     </td><td><span data-ttu-id="71bf3-531">55,29 KB</span><span class="sxs-lookup"><span data-stu-id="71bf3-531">55.29 KB</span></span>    </td><td><span data-ttu-id="71bf3-532">256</span><span class="sxs-lookup"><span data-stu-id="71bf3-532">256</span></span>    </td><td><span data-ttu-id="71bf3-533">68,8 %</span><span class="sxs-lookup"><span data-stu-id="71bf3-533">68.8%</span></span>    </td><td><span data-ttu-id="71bf3-534">GUID (eliminado)</span><span class="sxs-lookup"><span data-stu-id="71bf3-534">Guid (removed)</span></span></td><td><span data-ttu-id="71bf3-535">rack3</span><span class="sxs-lookup"><span data-stu-id="71bf3-535">rack3</span></span></td></tr>
<tr><th><span data-ttu-id="71bf3-536">UN</span><span class="sxs-lookup"><span data-stu-id="71bf3-536">UN</span></span>    </td><td><span data-ttu-id="71bf3-537">10.1.2.10</span><span class="sxs-lookup"><span data-stu-id="71bf3-537">10.1.2.10</span></span>     </td><td><span data-ttu-id="71bf3-538">55,29 KB</span><span class="sxs-lookup"><span data-stu-id="71bf3-538">55.29 KB</span></span>    </td><td><span data-ttu-id="71bf3-539">256</span><span class="sxs-lookup"><span data-stu-id="71bf3-539">256</span></span>    </td><td><span data-ttu-id="71bf3-540">68,8 %</span><span class="sxs-lookup"><span data-stu-id="71bf3-540">68.8%</span></span>    </td><td><span data-ttu-id="71bf3-541">GUID (eliminado)</span><span class="sxs-lookup"><span data-stu-id="71bf3-541">Guid (removed)</span></span></td><td><span data-ttu-id="71bf3-542">rack4</span><span class="sxs-lookup"><span data-stu-id="71bf3-542">rack4</span></span></td></tr>
<tr><th><span data-ttu-id="71bf3-543">UN</span><span class="sxs-lookup"><span data-stu-id="71bf3-543">UN</span></span>    </td><td><span data-ttu-id="71bf3-544">10.1.2.11</span><span class="sxs-lookup"><span data-stu-id="71bf3-544">10.1.2.11</span></span>     </td><td><span data-ttu-id="71bf3-545">55,29 KB</span><span class="sxs-lookup"><span data-stu-id="71bf3-545">55.29 KB</span></span>    </td><td><span data-ttu-id="71bf3-546">256</span><span class="sxs-lookup"><span data-stu-id="71bf3-546">256</span></span>    </td><td><span data-ttu-id="71bf3-547">68,8 %</span><span class="sxs-lookup"><span data-stu-id="71bf3-547">68.8%</span></span>    </td><td><span data-ttu-id="71bf3-548">GUID (eliminado)</span><span class="sxs-lookup"><span data-stu-id="71bf3-548">Guid (removed)</span></span></td><td><span data-ttu-id="71bf3-549">rack4</span><span class="sxs-lookup"><span data-stu-id="71bf3-549">rack4</span></span></td></tr>
</table>

## <a name="test-the-single-region-cluster"></a><span data-ttu-id="71bf3-550">Probar el clúster de una sola región</span><span class="sxs-lookup"><span data-stu-id="71bf3-550">Test the Single Region Cluster</span></span>
<span data-ttu-id="71bf3-551">Para probar el clúster, siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="71bf3-551">Use the following steps to test the cluster:</span></span>

1. <span data-ttu-id="71bf3-552">Mediante el cmdlet Get-AzureInternalLoadbalancer de comando de Powershell, obtenga la dirección IP del equilibrador de carga interno (por ejemplo, 10.1.2.101).</span><span class="sxs-lookup"><span data-stu-id="71bf3-552">Using the Powershell command Get-AzureInternalLoadbalancer commandlet, obtain the IP address of the internal load balancer (e.g.  10.1.2.101).</span></span> <span data-ttu-id="71bf3-553">A continuación se muestra la sintaxis del comando: Get-AzureLoadbalancer –ServiceName "hk-c-svc-west-us” [muestra los detalles del equilibrador de carga interno junto con su dirección IP]</span><span class="sxs-lookup"><span data-stu-id="71bf3-553">The syntax of the command is shown below: Get-AzureLoadbalancer –ServiceName "hk-c-svc-west-us” [displays the details of the internal load balancer along with its IP address]</span></span>
2. <span data-ttu-id="71bf3-554">Inicie sesión en la VM de la granja de servidores web (por ejemplo, hk-w1-west-us) mediante Putty o ssh</span><span class="sxs-lookup"><span data-stu-id="71bf3-554">Log into the web farm VM (e.g. hk-w1-west-us) using Putty or ssh</span></span>
3. <span data-ttu-id="71bf3-555">Ejecute $CASS_HOME/bin/cqlsh 10.1.2.101 9160</span><span class="sxs-lookup"><span data-stu-id="71bf3-555">Execute $CASS_HOME/bin/cqlsh 10.1.2.101 9160</span></span>
4. <span data-ttu-id="71bf3-556">Utilice los siguientes comandos CQL para comprobar si funciona el clúster:</span><span class="sxs-lookup"><span data-stu-id="71bf3-556">Use the following CQL commands to verify if the cluster is working:</span></span>
   
     <span data-ttu-id="71bf3-557">CREATE KEYSPACE customers_ks WITH REPLICATION = { 'class' : 'SimpleStrategy', 'replication_factor' : 3 };   USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');</span><span class="sxs-lookup"><span data-stu-id="71bf3-557">CREATE KEYSPACE customers_ks WITH REPLICATION = { 'class' : 'SimpleStrategy', 'replication_factor' : 3 };   USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');</span></span>
   
     <span data-ttu-id="71bf3-558">SELECT * FROM Customers;</span><span class="sxs-lookup"><span data-stu-id="71bf3-558">SELECT * FROM Customers;</span></span>

<span data-ttu-id="71bf3-559">Verá una pantalla como la siguiente:</span><span class="sxs-lookup"><span data-stu-id="71bf3-559">You should see a display like the one below:</span></span>

<table>
  <tr><th> <span data-ttu-id="71bf3-560">customer_id</span><span class="sxs-lookup"><span data-stu-id="71bf3-560">customer_id</span></span> </th><th> <span data-ttu-id="71bf3-561">firstname</span><span class="sxs-lookup"><span data-stu-id="71bf3-561">firstname</span></span> </th><th> <span data-ttu-id="71bf3-562">Lastname</span><span class="sxs-lookup"><span data-stu-id="71bf3-562">lastname</span></span> </th></tr>
  <tr><td> <span data-ttu-id="71bf3-563">1</span><span class="sxs-lookup"><span data-stu-id="71bf3-563">1</span></span> </td><td> <span data-ttu-id="71bf3-564">John</span><span class="sxs-lookup"><span data-stu-id="71bf3-564">John</span></span> </td><td> <span data-ttu-id="71bf3-565">Doe</span><span class="sxs-lookup"><span data-stu-id="71bf3-565">Doe</span></span> </td></tr>
  <tr><td> <span data-ttu-id="71bf3-566">2</span><span class="sxs-lookup"><span data-stu-id="71bf3-566">2</span></span> </td><td> <span data-ttu-id="71bf3-567">Julia</span><span class="sxs-lookup"><span data-stu-id="71bf3-567">Jane</span></span> </td><td> <span data-ttu-id="71bf3-568">Doe</span><span class="sxs-lookup"><span data-stu-id="71bf3-568">Doe</span></span> </td></tr>
</table>

<span data-ttu-id="71bf3-569">Tenga en cuenta que el espacio de claves que creó en el paso 4 utiliza SimpleStrategy con un replication_factor de 3.</span><span class="sxs-lookup"><span data-stu-id="71bf3-569">Please note that the keyspace created in step 4 uses SimpleStrategy with a  replication_factor of 3.</span></span> <span data-ttu-id="71bf3-570">SimpleStrategy se recomienda para las implementaciones de un solo centro de datos, mientras que NetworkTopologyStrategy para implementaciones de varios centros de datos.</span><span class="sxs-lookup"><span data-stu-id="71bf3-570">SimpleStrategy is recommended for single data center deployments whereas NetworkTopologyStrategy for multi-data center deployments.</span></span> <span data-ttu-id="71bf3-571">Un replication_factor de 3 proporcionará tolerancia a errores de nodo.</span><span class="sxs-lookup"><span data-stu-id="71bf3-571">A replication_factor of 3 will give tolerance for node failures.</span></span>

## <span data-ttu-id="71bf3-572"><a id="tworegion"> </a>Proceso de implementación de varias regiones</span><span class="sxs-lookup"><span data-stu-id="71bf3-572"><a id="tworegion"> </a>Multi-Region Deployment Process</span></span>
<span data-ttu-id="71bf3-573">Aprovechará la implementación de región única completada y repetirá el mismo proceso para la instalación de la segunda región.</span><span class="sxs-lookup"><span data-stu-id="71bf3-573">Will leverage the single region deployment completed and repeat the same process for installing the second region.</span></span> <span data-ttu-id="71bf3-574">La diferencia clave entre la implementación de región única o múltiple es la configuración de túnel VPN para la comunicación entre regiones; empezaremos con la instalación de red, aprovisionamiento de las máquinas virtuales y configuración de Cassandra.</span><span class="sxs-lookup"><span data-stu-id="71bf3-574">The key difference between the single and multiple region deployment is the VPN tunnel setup for inter-region communication; we will start with the network installation, provision the VMs and configure Cassandra.</span></span>

### <a name="step-1-create-the-virtual-network-at-the-2nd-region"></a><span data-ttu-id="71bf3-575">Paso 1: Creación de la red virtual en la segunda región</span><span class="sxs-lookup"><span data-stu-id="71bf3-575">Step 1: Create the Virtual Network at the 2nd Region</span></span>
<span data-ttu-id="71bf3-576">Inicie sesión en el Portal de Azure clásico y cree una red virtual con los atributos que se muestran en la tabla.</span><span class="sxs-lookup"><span data-stu-id="71bf3-576">Log into the Azure classic portal and create a Virtual Network with the attributes show in the table.</span></span> <span data-ttu-id="71bf3-577">Consulte [Configurar una red virtual solo en la nube en el Portal de Azure clásico](../../../virtual-network/virtual-networks-create-vnet-classic-pportal.md) para obtener pasos detallados del proceso.</span><span class="sxs-lookup"><span data-stu-id="71bf3-577">See [Configure a Cloud-Only Virtual Network in the Azure classic portal](../../../virtual-network/virtual-networks-create-vnet-classic-pportal.md) for detailed steps of the process.</span></span>      

<table>
<tr><th><span data-ttu-id="71bf3-578">Nombre del atributo</span><span class="sxs-lookup"><span data-stu-id="71bf3-578">Attribute Name</span></span>    </th><th><span data-ttu-id="71bf3-579">Valor</span><span class="sxs-lookup"><span data-stu-id="71bf3-579">Value</span></span>    </th><th><span data-ttu-id="71bf3-580">Comentarios</span><span class="sxs-lookup"><span data-stu-id="71bf3-580">Remarks</span></span></th></tr>
<tr><td><span data-ttu-id="71bf3-581">Nombre</span><span class="sxs-lookup"><span data-stu-id="71bf3-581">Name</span></span>    </td><td><span data-ttu-id="71bf3-582">vnet-cass-east-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-582">vnet-cass-east-us</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="71bf3-583">Region</span><span class="sxs-lookup"><span data-stu-id="71bf3-583">Region</span></span>    </td><td><span data-ttu-id="71bf3-584">Este de EE. UU.</span><span class="sxs-lookup"><span data-stu-id="71bf3-584">East US</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="71bf3-585">Servidores DNS</span><span class="sxs-lookup"><span data-stu-id="71bf3-585">DNS Servers</span></span>        </td><td></td><td><span data-ttu-id="71bf3-586">Ignore esto, ya que no estamos usando un servidor DNS</span><span class="sxs-lookup"><span data-stu-id="71bf3-586">Ignore this as we are not using a DNS Server</span></span></td></tr>
<tr><td><span data-ttu-id="71bf3-587">Configurar una VPN de punto a sitio</span><span class="sxs-lookup"><span data-stu-id="71bf3-587">Configure a point-to-site VPN</span></span></td><td></td><td>        <span data-ttu-id="71bf3-588">Ignore esto</span><span class="sxs-lookup"><span data-stu-id="71bf3-588">Ignore this</span></span></td></tr>
<tr><td><span data-ttu-id="71bf3-589">Configurar una VPN de sitio a sitio</span><span class="sxs-lookup"><span data-stu-id="71bf3-589">Configure a site-to-site VPN</span></span></td><td></td><td>        <span data-ttu-id="71bf3-590">Ignore esto</span><span class="sxs-lookup"><span data-stu-id="71bf3-590">Ignore this</span></span></td></tr>
<tr><td><span data-ttu-id="71bf3-591">Espacio de direcciones</span><span class="sxs-lookup"><span data-stu-id="71bf3-591">Address Space</span></span>    </td><td><span data-ttu-id="71bf3-592">10.2.0.0/16</span><span class="sxs-lookup"><span data-stu-id="71bf3-592">10.2.0.0/16</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="71bf3-593">IP inicial:</span><span class="sxs-lookup"><span data-stu-id="71bf3-593">Starting IP</span></span>    </td><td><span data-ttu-id="71bf3-594">10.2.0.0</span><span class="sxs-lookup"><span data-stu-id="71bf3-594">10.2.0.0</span></span>    </td><td></td></tr>
<tr><td><span data-ttu-id="71bf3-595">CIDR</span><span class="sxs-lookup"><span data-stu-id="71bf3-595">CIDR</span></span>    </td><td><span data-ttu-id="71bf3-596">/16 (65531)</span><span class="sxs-lookup"><span data-stu-id="71bf3-596">/16 (65531)</span></span></td><td></td></tr>
</table>

<span data-ttu-id="71bf3-597">Agregue las siguientes subredes:</span><span class="sxs-lookup"><span data-stu-id="71bf3-597">Add the following subnets:</span></span>

<table>
<tr><th><span data-ttu-id="71bf3-598">Nombre</span><span class="sxs-lookup"><span data-stu-id="71bf3-598">Name</span></span>    </th><th><span data-ttu-id="71bf3-599">IP inicial:</span><span class="sxs-lookup"><span data-stu-id="71bf3-599">Starting IP</span></span>    </th><th><span data-ttu-id="71bf3-600">CIDR</span><span class="sxs-lookup"><span data-stu-id="71bf3-600">CIDR</span></span>    </th><th><span data-ttu-id="71bf3-601">Comentarios</span><span class="sxs-lookup"><span data-stu-id="71bf3-601">Remarks</span></span></th></tr>
<tr><td><span data-ttu-id="71bf3-602">web</span><span class="sxs-lookup"><span data-stu-id="71bf3-602">web</span></span>    </td><td><span data-ttu-id="71bf3-603">10.2.1.0</span><span class="sxs-lookup"><span data-stu-id="71bf3-603">10.2.1.0</span></span>    </td><td><span data-ttu-id="71bf3-604">/24 (251)</span><span class="sxs-lookup"><span data-stu-id="71bf3-604">/24 (251)</span></span>    </td><td><span data-ttu-id="71bf3-605">Subred de la granja de servidores web</span><span class="sxs-lookup"><span data-stu-id="71bf3-605">Subnet for the web farm</span></span></td></tr>
<tr><td><span data-ttu-id="71bf3-606">data</span><span class="sxs-lookup"><span data-stu-id="71bf3-606">data</span></span>    </td><td><span data-ttu-id="71bf3-607">10.2.2.0</span><span class="sxs-lookup"><span data-stu-id="71bf3-607">10.2.2.0</span></span>    </td><td><span data-ttu-id="71bf3-608">/24 (251)</span><span class="sxs-lookup"><span data-stu-id="71bf3-608">/24 (251)</span></span>    </td><td><span data-ttu-id="71bf3-609">Subred para los nodos de la base de datos</span><span class="sxs-lookup"><span data-stu-id="71bf3-609">Subnet for the database nodes</span></span></td></tr>
</table>


### <a name="step-2-create-local-networks"></a><span data-ttu-id="71bf3-610">Paso 2: Creación de redes locales</span><span class="sxs-lookup"><span data-stu-id="71bf3-610">Step 2: Create Local Networks</span></span>
<span data-ttu-id="71bf3-611">Una red local en la red virtual de Azure es un espacio de direcciones de proxy que se asigna a un sitio remoto como una nube privada u otra región de Azure.</span><span class="sxs-lookup"><span data-stu-id="71bf3-611">A Local Network in Azure virtual networking is a proxy address space that maps to a remote site including a private cloud or another Azure region.</span></span> <span data-ttu-id="71bf3-612">Este espacio de direcciones proxy se enlaza a una puerta de enlace remota para la red de enrutamiento a los destinos de redes adecuados.</span><span class="sxs-lookup"><span data-stu-id="71bf3-612">This proxy address space is bound to a remote gateway for routing network to the right networking destinations.</span></span> <span data-ttu-id="71bf3-613">Consulte [Configurar una conexión VNet a VNet](../../../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md) para obtener instrucciones acerca de cómo establecer la conexión de red virtual a red virtual.</span><span class="sxs-lookup"><span data-stu-id="71bf3-613">See [Configure a VNet to VNet Connection](../../../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md) for the instructions on establishing VNET-to-VNET connection.</span></span>

<span data-ttu-id="71bf3-614">Cree dos redes locales con los siguientes detalles:</span><span class="sxs-lookup"><span data-stu-id="71bf3-614">Create two local networks per the following details:</span></span>

| <span data-ttu-id="71bf3-615">Nombre de red</span><span class="sxs-lookup"><span data-stu-id="71bf3-615">Network Name</span></span> | <span data-ttu-id="71bf3-616">Dirección de puerta de enlace VPN</span><span class="sxs-lookup"><span data-stu-id="71bf3-616">VPN Gateway Address</span></span> | <span data-ttu-id="71bf3-617">Espacio de direcciones</span><span class="sxs-lookup"><span data-stu-id="71bf3-617">Address Space</span></span> | <span data-ttu-id="71bf3-618">Comentarios</span><span class="sxs-lookup"><span data-stu-id="71bf3-618">Remarks</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="71bf3-619">hk-lnet-map-to-east-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-619">hk-lnet-map-to-east-us</span></span> |<span data-ttu-id="71bf3-620">23.1.1.1</span><span class="sxs-lookup"><span data-stu-id="71bf3-620">23.1.1.1</span></span> |<span data-ttu-id="71bf3-621">10.2.0.0/16</span><span class="sxs-lookup"><span data-stu-id="71bf3-621">10.2.0.0/16</span></span> |<span data-ttu-id="71bf3-622">Al crear la red local, proporcione una dirección de puerta de enlace de marcador de posición.</span><span class="sxs-lookup"><span data-stu-id="71bf3-622">While creating the Local Network give a placeholder gateway address.</span></span> <span data-ttu-id="71bf3-623">La dirección de puerta de enlace real se completará una vez creada la puerta de enlace.</span><span class="sxs-lookup"><span data-stu-id="71bf3-623">The real gateway address is filled once the gateway is created.</span></span> <span data-ttu-id="71bf3-624">Asegúrese de que el espacio de direcciones coincide exactamente con la red virtual remota correspondiente; en este caso, la red virtual se ha creado en la región Este de EE. UU.</span><span class="sxs-lookup"><span data-stu-id="71bf3-624">Make sure the address space exactly matches the respective remote VNET; in this case the VNET created in the East US region.</span></span> |
| <span data-ttu-id="71bf3-625">hk-lnet-map-to-west-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-625">hk-lnet-map-to-west-us</span></span> |<span data-ttu-id="71bf3-626">23.2.2.2</span><span class="sxs-lookup"><span data-stu-id="71bf3-626">23.2.2.2</span></span> |<span data-ttu-id="71bf3-627">10.1.0.0/16</span><span class="sxs-lookup"><span data-stu-id="71bf3-627">10.1.0.0/16</span></span> |<span data-ttu-id="71bf3-628">Al crear la red local, proporcione una dirección de puerta de enlace de marcador de posición.</span><span class="sxs-lookup"><span data-stu-id="71bf3-628">While creating the Local Network give a placeholder gateway address.</span></span> <span data-ttu-id="71bf3-629">La dirección de puerta de enlace real se completará una vez creada la puerta de enlace.</span><span class="sxs-lookup"><span data-stu-id="71bf3-629">The real gateway address is filled once the gateway is created.</span></span> <span data-ttu-id="71bf3-630">Asegúrese de que el espacio de direcciones coincide exactamente con la red virtual remota correspondiente; en este caso, la red virtual se ha creado en la región Oeste de EE. UU.</span><span class="sxs-lookup"><span data-stu-id="71bf3-630">Make sure the address space exactly matches the respective remote VNET; in this case the VNET created in the West US region.</span></span> |

### <a name="step-3-map-local-network-to-the-respective-vnets"></a><span data-ttu-id="71bf3-631">Paso 3: Asignación de red "Local" a las redes virtuales respectivas</span><span class="sxs-lookup"><span data-stu-id="71bf3-631">Step 3: Map “Local” network to the respective VNETs</span></span>
<span data-ttu-id="71bf3-632">Desde el Portal de Azure clásico, seleccione cada red virtual, haga clic en "Configurar", consulte "Conectarse a la red local" y seleccione las redes locales con los siguientes detalles:</span><span class="sxs-lookup"><span data-stu-id="71bf3-632">From the Azure classic portal, select each vnet, click “Configure”, check “Connect to the local network”, and select the Local Networks per the following details:</span></span>

| <span data-ttu-id="71bf3-633">Red virtual</span><span class="sxs-lookup"><span data-stu-id="71bf3-633">Virtual Network</span></span> | <span data-ttu-id="71bf3-634">Red local</span><span class="sxs-lookup"><span data-stu-id="71bf3-634">Local Network</span></span> |
| --- | --- |
| <span data-ttu-id="71bf3-635">hk-vnet-west-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-635">hk-vnet-west-us</span></span> |<span data-ttu-id="71bf3-636">hk-lnet-map-to-east-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-636">hk-lnet-map-to-east-us</span></span> |
| <span data-ttu-id="71bf3-637">hk-vnet-east-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-637">hk-vnet-east-us</span></span> |<span data-ttu-id="71bf3-638">hk-lnet-map-to-west-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-638">hk-lnet-map-to-west-us</span></span> |

### <a name="step-4-create-gateways-on-vnet1-and-vnet2"></a><span data-ttu-id="71bf3-639">Paso 4: Creación de puertas de enlace en VNET1 y VNET2</span><span class="sxs-lookup"><span data-stu-id="71bf3-639">Step 4: Create Gateways on VNET1 and VNET2</span></span>
<span data-ttu-id="71bf3-640">En el panel de las dos redes virtuales, haga clic en Crear puerta de enlace, lo que desencadenará el proceso de aprovisionamiento de puerta de enlace VPN.</span><span class="sxs-lookup"><span data-stu-id="71bf3-640">From the dashboard of both the virtual networks, click CREATE GATEWAY which will trigger the VPN gateway provisioning process.</span></span> <span data-ttu-id="71bf3-641">Después de unos minutos, el panel de cada red virtual debe mostrar la dirección de puerta de enlace real.</span><span class="sxs-lookup"><span data-stu-id="71bf3-641">After a few minutes the dashboard of each virtual network should display the actual gateway address.</span></span>

### <a name="step-5-update-local-networks-with-the-respective-gateway-addresses"></a><span data-ttu-id="71bf3-642">Paso 5: Actualización de redes "Local" con las direcciones correspondientes de "Puerta de enlace"</span><span class="sxs-lookup"><span data-stu-id="71bf3-642">Step 5: Update “Local” networks with the respective “Gateway” addresses</span></span>
<span data-ttu-id="71bf3-643">Edite las redes locales para reemplazar la dirección IP de puerta de enlace de marcador de posición por la dirección IP real de las puertas de enlace que acaba de aprovisionar.</span><span class="sxs-lookup"><span data-stu-id="71bf3-643">Edit both the local networks to replace the placeholder gateway IP address with the real IP address of the just provisioned gateways.</span></span> <span data-ttu-id="71bf3-644">Utilice la asignación siguiente:</span><span class="sxs-lookup"><span data-stu-id="71bf3-644">Use the following mapping:</span></span>

<table>
<tr><th><span data-ttu-id="71bf3-645">Red local</span><span class="sxs-lookup"><span data-stu-id="71bf3-645">Local Network</span></span>    </th><th><span data-ttu-id="71bf3-646">Puerta de enlace de red virtual</span><span class="sxs-lookup"><span data-stu-id="71bf3-646">Virtual Network Gateway</span></span></th></tr>
<tr><td><span data-ttu-id="71bf3-647">hk-lnet-map-to-east-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-647">hk-lnet-map-to-east-us</span></span> </td><td><span data-ttu-id="71bf3-648">Puerta de enlace de hk-vnet-west-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-648">Gateway of hk-vnet-west-us</span></span></td></tr>
<tr><td><span data-ttu-id="71bf3-649">hk-lnet-map-to-west-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-649">hk-lnet-map-to-west-us</span></span> </td><td><span data-ttu-id="71bf3-650">Puerta de enlace de hk-vnet-east-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-650">Gateway of hk-vnet-east-us</span></span></td></tr>
</table>

### <a name="step-6-update-the-shared-key"></a><span data-ttu-id="71bf3-651">Paso 6: Actualización de la clave compartida</span><span class="sxs-lookup"><span data-stu-id="71bf3-651">Step 6: Update the shared key</span></span>
<span data-ttu-id="71bf3-652">Use el siguiente script de Powershell para actualizar la clave IPSec de cada puerta de enlace VPN [utilice la clave segura para ambas puertas de enlace]: Set-AzureVNetGatewayKey -VNetName hk-vnet-east-us -LocalNetworkSiteName hk-lnet-map-to-west-us -SharedKey D9E76BKK Set-AzureVNetGatewayKey -VNetName hk-vnet-west-us -LocalNetworkSiteName hk-lnet-map-to-east-us -SharedKey D9E76BKK</span><span class="sxs-lookup"><span data-stu-id="71bf3-652">Use the following Powershell script to update the IPSec key of each VPN gateway [use the sake key for both the gateways]: Set-AzureVNetGatewayKey -VNetName hk-vnet-east-us -LocalNetworkSiteName hk-lnet-map-to-west-us -SharedKey D9E76BKK Set-AzureVNetGatewayKey -VNetName hk-vnet-west-us -LocalNetworkSiteName hk-lnet-map-to-east-us -SharedKey D9E76BKK</span></span>

### <a name="step-7-establish-the-vnet-to-vnet-connection"></a><span data-ttu-id="71bf3-653">Paso 7: Establecimiento de la conexión de red virtual a la red virtual</span><span class="sxs-lookup"><span data-stu-id="71bf3-653">Step 7: Establish the VNET-to-VNET connection</span></span>
<span data-ttu-id="71bf3-654">Desde el Portal de Azure clásico, use el menú "Panel" de ambas redes virtuales para establecer conexiones de puerta de enlace a puerta de enlace.</span><span class="sxs-lookup"><span data-stu-id="71bf3-654">From the Azure classic portal, use the “DASHBOARD” menu of both the virtual networks to establish gateway-to-gateway connection.</span></span> <span data-ttu-id="71bf3-655">Utilice los elementos de menú "Conectar" en la barra de herramientas inferior.</span><span class="sxs-lookup"><span data-stu-id="71bf3-655">Use the “CONNECT” menu items in the bottom toolbar.</span></span> <span data-ttu-id="71bf3-656">Después de unos minutos, el panel debe mostrar gráficamente los detalles de conexión.</span><span class="sxs-lookup"><span data-stu-id="71bf3-656">After a few minutes the dashboard should display the connection details graphically.</span></span>

### <a name="step-8-create-the-virtual-machines-in-region-2"></a><span data-ttu-id="71bf3-657">Paso 8: Creación de las máquinas virtuales en la región 2</span><span class="sxs-lookup"><span data-stu-id="71bf3-657">Step 8: Create the virtual machines in region #2</span></span>
<span data-ttu-id="71bf3-658">Cree la imagen de Ubuntu, como se describe en la implementación de la región #1, siguiendo los mismos pasos, o bien copie el archivo de imagen VHD en la cuenta de almacenamiento de Azure ubicada en la región #2 y cree la imagen.</span><span class="sxs-lookup"><span data-stu-id="71bf3-658">Create the Ubuntu image as described in region #1 deployment by following the same steps or copy the image VHD file to the Azure storage account located in region #2 and create the image.</span></span> <span data-ttu-id="71bf3-659">Utilice esta imagen y cree la siguiente lista de máquinas virtuales en un nuevo servicio de nube hk-c-svc-east-us:</span><span class="sxs-lookup"><span data-stu-id="71bf3-659">Use this image and create the following list of virtual machines into a new cloud service hk-c-svc-east-us:</span></span>

| <span data-ttu-id="71bf3-660">Nombre de máquina</span><span class="sxs-lookup"><span data-stu-id="71bf3-660">Machine Name</span></span> | <span data-ttu-id="71bf3-661">Subred</span><span class="sxs-lookup"><span data-stu-id="71bf3-661">Subnet</span></span> | <span data-ttu-id="71bf3-662">Dirección IP</span><span class="sxs-lookup"><span data-stu-id="71bf3-662">IP Address</span></span> | <span data-ttu-id="71bf3-663">El conjunto de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="71bf3-663">Availability set</span></span> | <span data-ttu-id="71bf3-664">Controlador de dominio/bastidor</span><span class="sxs-lookup"><span data-stu-id="71bf3-664">DC/Rack</span></span> | <span data-ttu-id="71bf3-665">¿Valor de inicialización?</span><span class="sxs-lookup"><span data-stu-id="71bf3-665">Seed?</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="71bf3-666">hk-c1-east-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-666">hk-c1-east-us</span></span> |<span data-ttu-id="71bf3-667">data</span><span class="sxs-lookup"><span data-stu-id="71bf3-667">data</span></span> |<span data-ttu-id="71bf3-668">10.2.2.4</span><span class="sxs-lookup"><span data-stu-id="71bf3-668">10.2.2.4</span></span> |<span data-ttu-id="71bf3-669">hk-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="71bf3-669">hk-c-aset-1</span></span> |<span data-ttu-id="71bf3-670">dc =EASTUS rack =rack1</span><span class="sxs-lookup"><span data-stu-id="71bf3-670">dc =EASTUS rack =rack1</span></span> |<span data-ttu-id="71bf3-671">Sí</span><span class="sxs-lookup"><span data-stu-id="71bf3-671">Yes</span></span> |
| <span data-ttu-id="71bf3-672">hk-c2-east-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-672">hk-c2-east-us</span></span> |<span data-ttu-id="71bf3-673">data</span><span class="sxs-lookup"><span data-stu-id="71bf3-673">data</span></span> |<span data-ttu-id="71bf3-674">10.2.2.5</span><span class="sxs-lookup"><span data-stu-id="71bf3-674">10.2.2.5</span></span> |<span data-ttu-id="71bf3-675">hk-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="71bf3-675">hk-c-aset-1</span></span> |<span data-ttu-id="71bf3-676">dc =EASTUS rack =rack1</span><span class="sxs-lookup"><span data-stu-id="71bf3-676">dc =EASTUS rack =rack1</span></span> |<span data-ttu-id="71bf3-677">No</span><span class="sxs-lookup"><span data-stu-id="71bf3-677">No</span></span> |
| <span data-ttu-id="71bf3-678">hk-c3-east-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-678">hk-c3-east-us</span></span> |<span data-ttu-id="71bf3-679">data</span><span class="sxs-lookup"><span data-stu-id="71bf3-679">data</span></span> |<span data-ttu-id="71bf3-680">10.2.2.6</span><span class="sxs-lookup"><span data-stu-id="71bf3-680">10.2.2.6</span></span> |<span data-ttu-id="71bf3-681">hk-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="71bf3-681">hk-c-aset-1</span></span> |<span data-ttu-id="71bf3-682">dc =EASTUS rack =rack2</span><span class="sxs-lookup"><span data-stu-id="71bf3-682">dc =EASTUS rack =rack2</span></span> |<span data-ttu-id="71bf3-683">Sí</span><span class="sxs-lookup"><span data-stu-id="71bf3-683">Yes</span></span> |
| <span data-ttu-id="71bf3-684">hk-c5-east-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-684">hk-c5-east-us</span></span> |<span data-ttu-id="71bf3-685">data</span><span class="sxs-lookup"><span data-stu-id="71bf3-685">data</span></span> |<span data-ttu-id="71bf3-686">10.2.2.8</span><span class="sxs-lookup"><span data-stu-id="71bf3-686">10.2.2.8</span></span> |<span data-ttu-id="71bf3-687">hk-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="71bf3-687">hk-c-aset-2</span></span> |<span data-ttu-id="71bf3-688">dc =EASTUS rack =rack3</span><span class="sxs-lookup"><span data-stu-id="71bf3-688">dc =EASTUS rack =rack3</span></span> |<span data-ttu-id="71bf3-689">Sí</span><span class="sxs-lookup"><span data-stu-id="71bf3-689">Yes</span></span> |
| <span data-ttu-id="71bf3-690">hk-c6-east-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-690">hk-c6-east-us</span></span> |<span data-ttu-id="71bf3-691">data</span><span class="sxs-lookup"><span data-stu-id="71bf3-691">data</span></span> |<span data-ttu-id="71bf3-692">10.2.2.9</span><span class="sxs-lookup"><span data-stu-id="71bf3-692">10.2.2.9</span></span> |<span data-ttu-id="71bf3-693">hk-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="71bf3-693">hk-c-aset-2</span></span> |<span data-ttu-id="71bf3-694">dc =EASTUS rack =rack3</span><span class="sxs-lookup"><span data-stu-id="71bf3-694">dc =EASTUS rack =rack3</span></span> |<span data-ttu-id="71bf3-695">No</span><span class="sxs-lookup"><span data-stu-id="71bf3-695">No</span></span> |
| <span data-ttu-id="71bf3-696">hk-c7-east-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-696">hk-c7-east-us</span></span> |<span data-ttu-id="71bf3-697">data</span><span class="sxs-lookup"><span data-stu-id="71bf3-697">data</span></span> |<span data-ttu-id="71bf3-698">10.2.2.10</span><span class="sxs-lookup"><span data-stu-id="71bf3-698">10.2.2.10</span></span> |<span data-ttu-id="71bf3-699">hk-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="71bf3-699">hk-c-aset-2</span></span> |<span data-ttu-id="71bf3-700">dc =EASTUS rack =rack4</span><span class="sxs-lookup"><span data-stu-id="71bf3-700">dc =EASTUS rack =rack4</span></span> |<span data-ttu-id="71bf3-701">Sí</span><span class="sxs-lookup"><span data-stu-id="71bf3-701">Yes</span></span> |
| <span data-ttu-id="71bf3-702">hk-c8-east-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-702">hk-c8-east-us</span></span> |<span data-ttu-id="71bf3-703">data</span><span class="sxs-lookup"><span data-stu-id="71bf3-703">data</span></span> |<span data-ttu-id="71bf3-704">10.2.2.11</span><span class="sxs-lookup"><span data-stu-id="71bf3-704">10.2.2.11</span></span> |<span data-ttu-id="71bf3-705">hk-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="71bf3-705">hk-c-aset-2</span></span> |<span data-ttu-id="71bf3-706">dc =EASTUS rack =rack4</span><span class="sxs-lookup"><span data-stu-id="71bf3-706">dc =EASTUS rack =rack4</span></span> |<span data-ttu-id="71bf3-707">No</span><span class="sxs-lookup"><span data-stu-id="71bf3-707">No</span></span> |
| <span data-ttu-id="71bf3-708">hk-w1-east-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-708">hk-w1-east-us</span></span> |<span data-ttu-id="71bf3-709">web</span><span class="sxs-lookup"><span data-stu-id="71bf3-709">web</span></span> |<span data-ttu-id="71bf3-710">10.2.1.4</span><span class="sxs-lookup"><span data-stu-id="71bf3-710">10.2.1.4</span></span> |<span data-ttu-id="71bf3-711">hk-w-aset-1</span><span class="sxs-lookup"><span data-stu-id="71bf3-711">hk-w-aset-1</span></span> |<span data-ttu-id="71bf3-712">N/D</span><span class="sxs-lookup"><span data-stu-id="71bf3-712">N/A</span></span> |<span data-ttu-id="71bf3-713">N/D</span><span class="sxs-lookup"><span data-stu-id="71bf3-713">N/A</span></span> |
| <span data-ttu-id="71bf3-714">hk-w2-east-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-714">hk-w2-east-us</span></span> |<span data-ttu-id="71bf3-715">web</span><span class="sxs-lookup"><span data-stu-id="71bf3-715">web</span></span> |<span data-ttu-id="71bf3-716">10.2.1.5</span><span class="sxs-lookup"><span data-stu-id="71bf3-716">10.2.1.5</span></span> |<span data-ttu-id="71bf3-717">hk-w-aset-1</span><span class="sxs-lookup"><span data-stu-id="71bf3-717">hk-w-aset-1</span></span> |<span data-ttu-id="71bf3-718">N/D</span><span class="sxs-lookup"><span data-stu-id="71bf3-718">N/A</span></span> |<span data-ttu-id="71bf3-719">N/D</span><span class="sxs-lookup"><span data-stu-id="71bf3-719">N/A</span></span> |

<span data-ttu-id="71bf3-720">Siga las mismas instrucciones de la región #1, pero use el espacio de direcciones 10.2.xxx.xxx.</span><span class="sxs-lookup"><span data-stu-id="71bf3-720">Follow the same instructions as region #1 but use 10.2.xxx.xxx address space.</span></span>

### <a name="step-9-configure-cassandra-on-each-vm"></a><span data-ttu-id="71bf3-721">Paso 9: Configuración de Cassandra en cada máquina virtual</span><span class="sxs-lookup"><span data-stu-id="71bf3-721">Step 9: Configure Cassandra on each VM</span></span>
<span data-ttu-id="71bf3-722">Inicie sesión en la máquina virtual y realice lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="71bf3-722">Log into the VM and perform the following:</span></span>

1. <span data-ttu-id="71bf3-723">Edite $CASS_HOME/conf/cassandra-rackdc.properties para especificar las propiedades del bastidor y del centro de datos con el formato: dc =EASTUS rack =rack1</span><span class="sxs-lookup"><span data-stu-id="71bf3-723">Edit $CASS_HOME/conf/cassandra-rackdc.properties to specify the data center and rack properties in the format:  dc =EASTUS  rack =rack1</span></span>
2. <span data-ttu-id="71bf3-724">Edite cassandra.yaml para configurar los nodos de valores de inicialización: Valores de inicialización: "10.1.2.4,10.1.2.6,10.1.2.8,10.1.2.10,10.2.2.4,10.2.2.6,10.2.2.8,10.2.2.10"</span><span class="sxs-lookup"><span data-stu-id="71bf3-724">Edit cassandra.yaml to configure seed nodes:  Seeds: "10.1.2.4,10.1.2.6,10.1.2.8,10.1.2.10,10.2.2.4,10.2.2.6,10.2.2.8,10.2.2.10"</span></span>

### <a name="step-10-start-cassandra"></a><span data-ttu-id="71bf3-725">Paso 10: Inicio de Cassandra</span><span class="sxs-lookup"><span data-stu-id="71bf3-725">Step 10: Start Cassandra</span></span>
<span data-ttu-id="71bf3-726">Inicie sesión en cada máquina virtual e inicie Cassandra en segundo plano, ejecutando el comando siguiente: $CASS_HOME/bin/cassandra</span><span class="sxs-lookup"><span data-stu-id="71bf3-726">Log into each VM and start Cassandra in the background by running the following command: $CASS_HOME/bin/cassandra</span></span>

## <a name="test-the-multi-region-cluster"></a><span data-ttu-id="71bf3-727">Probar el clúster de varias regiones</span><span class="sxs-lookup"><span data-stu-id="71bf3-727">Test the Multi-Region Cluster</span></span>
<span data-ttu-id="71bf3-728">Ya ha implementado Cassandra en 16 nodos, con 8 nodos en cada región de Azure.</span><span class="sxs-lookup"><span data-stu-id="71bf3-728">By now Cassandra has been deployed to 16 nodes with 8 nodes in each Azure region.</span></span> <span data-ttu-id="71bf3-729">Estos nodos están en el mismo clúster con el nombre común del clúster y la configuración de nodo de valor de inicialización.</span><span class="sxs-lookup"><span data-stu-id="71bf3-729">These nodes are in the same cluster by virtue of the common cluster name and the seed node configuration.</span></span> <span data-ttu-id="71bf3-730">Utilice el siguiente proceso para probar el clúster:</span><span class="sxs-lookup"><span data-stu-id="71bf3-730">Use the following process to test the cluster:</span></span>

### <a name="step-1-get-the-internal-load-balancer-ip-for-both-the-regions-using-powershell"></a><span data-ttu-id="71bf3-731">Paso 1: Obtención de la dirección IP de equilibrador de carga interno para ambas regiones mediante PowerShell</span><span class="sxs-lookup"><span data-stu-id="71bf3-731">Step 1: Get the internal load balancer IP for both the regions using PowerShell</span></span>
* <span data-ttu-id="71bf3-732">Get-AzureInternalLoadbalancer -ServiceName "hk-c-svc-west-us"</span><span class="sxs-lookup"><span data-stu-id="71bf3-732">Get-AzureInternalLoadbalancer -ServiceName "hk-c-svc-west-us"</span></span>
* <span data-ttu-id="71bf3-733">Get-AzureInternalLoadbalancer -ServiceName "hk-c-svc-east-us"</span><span class="sxs-lookup"><span data-stu-id="71bf3-733">Get-AzureInternalLoadbalancer -ServiceName "hk-c-svc-east-us"</span></span>  
  
    <span data-ttu-id="71bf3-734">Tenga en cuenta que aparecerán las direcciones IP (por ejemplo, west - 10.1.2.101, east - 10.2.2.101).</span><span class="sxs-lookup"><span data-stu-id="71bf3-734">Note the IP addresses (e.g. west - 10.1.2.101, east - 10.2.2.101) displayed.</span></span>

### <a name="step-2-execute-the-following-in-the-west-region-after-logging-into-hk-w1-west-us"></a><span data-ttu-id="71bf3-735">Paso 2: Ejecución de lo siguiente en la región Oeste tras iniciar sesión en hk-w1-west-us</span><span class="sxs-lookup"><span data-stu-id="71bf3-735">Step 2: Execute the following in the west region after logging into hk-w1-west-us</span></span>
1. <span data-ttu-id="71bf3-736">Ejecute $CASS_HOME/bin/cqlsh 10.1.2.101 9160</span><span class="sxs-lookup"><span data-stu-id="71bf3-736">Execute $CASS_HOME/bin/cqlsh 10.1.2.101 9160</span></span>
2. <span data-ttu-id="71bf3-737">Ejecute los siguientes comandos CQL:</span><span class="sxs-lookup"><span data-stu-id="71bf3-737">Execute the following CQL commands:</span></span>
   
     <span data-ttu-id="71bf3-738">CREATE KEYSPACE customers_ks   WITH REPLICATION = { 'class' : 'NetworkToplogyStrategy', 'WESTUS' : 3, 'EASTUS' : 3};   USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');   SELECT * FROM Customers;</span><span class="sxs-lookup"><span data-stu-id="71bf3-738">CREATE KEYSPACE customers_ks   WITH REPLICATION = { 'class' : 'NetworkToplogyStrategy', 'WESTUS' : 3, 'EASTUS' : 3};   USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');   SELECT * FROM Customers;</span></span>

<span data-ttu-id="71bf3-739">Verá una pantalla como la siguiente:</span><span class="sxs-lookup"><span data-stu-id="71bf3-739">You should see a display like the one below:</span></span>

| <span data-ttu-id="71bf3-740">customer_id</span><span class="sxs-lookup"><span data-stu-id="71bf3-740">customer_id</span></span> | <span data-ttu-id="71bf3-741">firstname</span><span class="sxs-lookup"><span data-stu-id="71bf3-741">firstname</span></span> | <span data-ttu-id="71bf3-742">Lastname</span><span class="sxs-lookup"><span data-stu-id="71bf3-742">Lastname</span></span> |
| --- | --- | --- |
| <span data-ttu-id="71bf3-743">1</span><span class="sxs-lookup"><span data-stu-id="71bf3-743">1</span></span> |<span data-ttu-id="71bf3-744">John</span><span class="sxs-lookup"><span data-stu-id="71bf3-744">John</span></span> |<span data-ttu-id="71bf3-745">Doe</span><span class="sxs-lookup"><span data-stu-id="71bf3-745">Doe</span></span> |
| <span data-ttu-id="71bf3-746">2</span><span class="sxs-lookup"><span data-stu-id="71bf3-746">2</span></span> |<span data-ttu-id="71bf3-747">Julia</span><span class="sxs-lookup"><span data-stu-id="71bf3-747">Jane</span></span> |<span data-ttu-id="71bf3-748">Doe</span><span class="sxs-lookup"><span data-stu-id="71bf3-748">Doe</span></span> |

### <a name="step-3-execute-the-following-in-the-east-region-after-logging-into-hk-w1-east-us"></a><span data-ttu-id="71bf3-749">Paso 3: Ejecución de lo siguiente en la región Este tras iniciar sesión en hk-w1-east-us:</span><span class="sxs-lookup"><span data-stu-id="71bf3-749">Step 3: Execute the following in the east region after logging into hk-w1-east-us:</span></span>
1. <span data-ttu-id="71bf3-750">Ejecute $CASS_HOME/bin/cqlsh 10.2.2.101 9160</span><span class="sxs-lookup"><span data-stu-id="71bf3-750">Execute $CASS_HOME/bin/cqlsh 10.2.2.101 9160</span></span>
2. <span data-ttu-id="71bf3-751">Ejecute los siguientes comandos CQL:</span><span class="sxs-lookup"><span data-stu-id="71bf3-751">Execute the following CQL commands:</span></span>
   
     <span data-ttu-id="71bf3-752">USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');   SELECT * FROM Customers;</span><span class="sxs-lookup"><span data-stu-id="71bf3-752">USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');   SELECT * FROM Customers;</span></span>

<span data-ttu-id="71bf3-753">Debe ver la misma pantalla que la vista en la región Oeste:</span><span class="sxs-lookup"><span data-stu-id="71bf3-753">You should see the same display as seen for the West region:</span></span>

| <span data-ttu-id="71bf3-754">customer_id</span><span class="sxs-lookup"><span data-stu-id="71bf3-754">customer_id</span></span> | <span data-ttu-id="71bf3-755">firstname</span><span class="sxs-lookup"><span data-stu-id="71bf3-755">firstname</span></span> | <span data-ttu-id="71bf3-756">Lastname</span><span class="sxs-lookup"><span data-stu-id="71bf3-756">Lastname</span></span> |
| --- | --- | --- |
| <span data-ttu-id="71bf3-757">1</span><span class="sxs-lookup"><span data-stu-id="71bf3-757">1</span></span> |<span data-ttu-id="71bf3-758">John</span><span class="sxs-lookup"><span data-stu-id="71bf3-758">John</span></span> |<span data-ttu-id="71bf3-759">Doe</span><span class="sxs-lookup"><span data-stu-id="71bf3-759">Doe</span></span> |
| <span data-ttu-id="71bf3-760">2</span><span class="sxs-lookup"><span data-stu-id="71bf3-760">2</span></span> |<span data-ttu-id="71bf3-761">Julia</span><span class="sxs-lookup"><span data-stu-id="71bf3-761">Jane</span></span> |<span data-ttu-id="71bf3-762">Doe</span><span class="sxs-lookup"><span data-stu-id="71bf3-762">Doe</span></span> |

<span data-ttu-id="71bf3-763">Ejecute unas cuantas inserciones más y vea las replicadas en la parte west-us del clúster.</span><span class="sxs-lookup"><span data-stu-id="71bf3-763">Execute a few more inserts and see that those get replicated to west-us part of the cluster.</span></span>

## <a name="test-cassandra-cluster-from-nodejs"></a><span data-ttu-id="71bf3-764">Probar el clúster de Cassandra desde Node.js</span><span class="sxs-lookup"><span data-stu-id="71bf3-764">Test Cassandra Cluster from Node.js</span></span>
<span data-ttu-id="71bf3-765">Mediante una de las máquinas virtuales de Linux creadas en el nivel "web" previamente, se ejecutará una secuencia de comandos simple de Node.js para leer los datos insertados anteriormente</span><span class="sxs-lookup"><span data-stu-id="71bf3-765">Using one of the Linux VMs crated in the "web" tier previously, we will execute a simple Node.js script to read the previously inserted data</span></span>

<span data-ttu-id="71bf3-766">**Paso 1: Instalación de Node.js y del cliente de Cassandra**</span><span class="sxs-lookup"><span data-stu-id="71bf3-766">**Step 1: Install Node.js and Cassandra Client**</span></span>

1. <span data-ttu-id="71bf3-767">Instalar Node.js y NPM</span><span class="sxs-lookup"><span data-stu-id="71bf3-767">Install Node.js and npm</span></span>
2. <span data-ttu-id="71bf3-768">Instalar el paquete de nodo "cassandra-client" con NPM</span><span class="sxs-lookup"><span data-stu-id="71bf3-768">Install node package "cassandra-client" using npm</span></span>
3. <span data-ttu-id="71bf3-769">Ejecute el script siguiente en el símbolo del shell que muestra la cadena json de los datos recuperados:</span><span class="sxs-lookup"><span data-stu-id="71bf3-769">Execute the following script at the shell prompt which displays the json string of the retrieved data:</span></span>
   
        var pooledCon = require('cassandra-client').PooledConnection;
        var ksName = "custsupport_ks";
        var cfName = "customers_cf";
        var hostList = ['internal_loadbalancer_ip:9160'];
        var ksConOptions = { hosts: hostList,
                             keyspace: ksName, use_bigints: false };
   
        function createKeyspace(callback){
           var cql = 'CREATE KEYSPACE ' + ksName + ' WITH strategy_class=SimpleStrategy AND strategy_options:replication_factor=1';
           var sysConOptions = { hosts: hostList,  
                                 keyspace: 'system', use_bigints: false };
           var con = new pooledCon(sysConOptions);
           con.execute(cql,[],function(err) {
           if (err) {
             console.log("Failed to create Keyspace: " + ksName);
             console.log(err);
           }
           else {
             console.log("Created Keyspace: " + ksName);
             callback(ksConOptions, populateCustomerData);
           }
           });
           con.shutdown();
        }
   
        function createColumnFamily(ksConOptions, callback){
          var params = ['customers_cf','custid','varint','custname',
                        'text','custaddress','text'];
          var cql = 'CREATE COLUMNFAMILY ? (? ? PRIMARY KEY,? ?, ? ?)';
        var con =  new pooledCon(ksConOptions);
          con.execute(cql,params,function(err) {
              if (err) {
                 console.log("Failed to create column family: " + params[0]);
                 console.log(err);
              }
              else {
                 console.log("Created column family: " + params[0]);
                 callback();
              }
          });
          con.shutdown();
        }
   
        //populate Data
        function populateCustomerData() {
           var params = ['John','Infinity Dr, TX', 1];
           updateCustomer(ksConOptions,params);
   
           params = ['Tom','Fermat Ln, WA', 2];
           updateCustomer(ksConOptions,params);
        }
   
        //update will also insert the record if none exists
        function updateCustomer(ksConOptions,params)
        {
          var cql = 'UPDATE customers_cf SET custname=?,custaddress=? where custid=?';
          var con = new pooledCon(ksConOptions);
          con.execute(cql,params,function(err) {
              if (err) console.log(err);
              else console.log("Inserted customer : " + params[0]);
          });
          con.shutdown();
        }
   
        //read the two rows inserted above
        function readCustomer(ksConOptions)
        {
          var cql = 'SELECT * FROM customers_cf WHERE custid IN (1,2)';
          var con = new pooledCon(ksConOptions);
          con.execute(cql,[],function(err,rows) {
              if (err)
                 console.log(err);
              else
                 for (var i=0; i<rows.length; i++)
                    console.log(JSON.stringify(rows[i]));
            });
           con.shutdown();
        }
   
        //exectue the code
        createKeyspace(createColumnFamily);
        readCustomer(ksConOptions)

## <a name="conclusion"></a><span data-ttu-id="71bf3-770">Conclusión</span><span class="sxs-lookup"><span data-stu-id="71bf3-770">Conclusion</span></span>
<span data-ttu-id="71bf3-771">Microsoft Azure es una plataforma flexible que permite la ejecución de Microsoft, así como un software de código abierto, como se muestra en este ejercicio.</span><span class="sxs-lookup"><span data-stu-id="71bf3-771">Microsoft Azure is a flexible platform that allows the running of both Microsoft as well as open source software as demonstrated by this exercise.</span></span> <span data-ttu-id="71bf3-772">Los clústeres Cassandra de alta disponibilidad pueden implementarse en un solo centro de datos a través de la propagación de los nodos del clúster en varios dominios de error.</span><span class="sxs-lookup"><span data-stu-id="71bf3-772">Highly available Cassandra clusters can be deployed on a single data center through the spreading of the cluster nodes across multiple fault domains.</span></span> <span data-ttu-id="71bf3-773">También se pueden implementar clústeres Cassandra en varias regiones de Azure geográficamente distantes para sistemas de prueba ante desastres.</span><span class="sxs-lookup"><span data-stu-id="71bf3-773">Cassandra clusters can also be deployed across multiple geographically distant Azure regions for disaster proof systems.</span></span> <span data-ttu-id="71bf3-774">Azure y Cassandra juntos permiten la construcción de servicios en la nube de recuperación ante desastres, altamente disponibles y altamente escalables, necesarios para los servicios de Internet actuales.</span><span class="sxs-lookup"><span data-stu-id="71bf3-774">Azure and Cassandra together enables the construction of highly scalable, highly available and disaster recoverable cloud services needed by today's internet scale services.</span></span>  

## <a name="references"></a><span data-ttu-id="71bf3-775">Referencias</span><span class="sxs-lookup"><span data-stu-id="71bf3-775">References</span></span>
* [<span data-ttu-id="71bf3-776">http://cassandra.apache.org</span><span class="sxs-lookup"><span data-stu-id="71bf3-776">http://cassandra.apache.org</span></span>](http://cassandra.apache.org)
* [<span data-ttu-id="71bf3-777">http://www.datastax.com</span><span class="sxs-lookup"><span data-stu-id="71bf3-777">http://www.datastax.com</span></span>](http://www.datastax.com)
* [<span data-ttu-id="71bf3-778">http://www.nodejs.org</span><span class="sxs-lookup"><span data-stu-id="71bf3-778">http://www.nodejs.org</span></span>](http://www.nodejs.org)


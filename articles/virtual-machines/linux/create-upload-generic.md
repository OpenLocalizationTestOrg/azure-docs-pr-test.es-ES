---
title: "Creación y carga de un VHD de Linux en Azure"
description: Aprenda a crear y cargar un disco duro virtual de Azure (VHD) que contiene un sistema operativo Linux.
services: virtual-machines-linux
documentationcenter: 
author: szarkos
manager: timlt
editor: tysonn
tags: azure-resource-manager,azure-service-management
ms.assetid: d351396c-95a0-4092-b7bf-c6aae0bbd112
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 02/02/2017
ms.author: szark
ms.openlocfilehash: ccadf55c492c097ef96f25e469dbf36fc87b6102
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/03/2017
---
# <a name="information-for-non-endorsed-distributions"></a><span data-ttu-id="ee4eb-103">Información para las distribuciones no aprobadas</span><span class="sxs-lookup"><span data-stu-id="ee4eb-103">Information for Non-Endorsed Distributions</span></span>
[!INCLUDE [learn-about-deployment-models](../../../includes/learn-about-deployment-models-both-include.md)]

<span data-ttu-id="ee4eb-104">El Acuerdo de Nivel de Servicio de la plataforma Azure se aplica a máquinas virtuales que ejecutan el SO Linux solo cuando cuentan con una de las [distribuciones aprobadas](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="ee4eb-104">The Azure platform SLA applies to virtual machines running the Linux OS only when one of the [endorsed distributions](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) is used.</span></span> <span data-ttu-id="ee4eb-105">Todas las distribuciones de Linux que se ofrezcan en la galería de imágenes de Azure son distribuciones aprobadas con la configuración requerida.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-105">All Linux distributions that are provided in the Azure image gallery are endorsed distributions with the required configuration.</span></span>

* [<span data-ttu-id="ee4eb-106">Linux en distribuciones aprobadas por Azure</span><span class="sxs-lookup"><span data-stu-id="ee4eb-106">Linux on Azure - Endorsed Distributions</span></span>](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)
* [<span data-ttu-id="ee4eb-107">Compatibilidad con las imágenes de Linux en Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="ee4eb-107">Support for Linux images in Microsoft Azure</span></span>](https://support.microsoft.com/kb/2941892)

<span data-ttu-id="ee4eb-108">Todas las distribuciones que se ejecutan en Azure tendrán que cumplir varios requisitos previos para poder ejecutarse correctamente en la plataforma.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-108">All distributions running on Azure will need to meet a number of prerequisites to have a chance to properly run on the platform.</span></span>  <span data-ttu-id="ee4eb-109">Este artículo no pretende ser exhaustivo, ya que cada distribución es diferente y es bastante posible que, aunque cumpla todos los criterios siguientes, todavía tenga que ajustar significativamente el sistema Linux para asegurarse de que se ejecuta correctamente en la plataforma.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-109">This article is by no means comprehensive as every distribution is different; and it is quite possible that even if you meet all the criteria below you will still need to significantly tweak your Linux system to ensure that it properly runs on the platform.</span></span>

<span data-ttu-id="ee4eb-110">Por eso recomendamos que empiece con una de nuestras [distribuciones aprobadas de Linux en Azure](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) cuando sea posible.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-110">It is for this reason that we recommend that you start with one of our [Linux on Azure Endorsed Distributions](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) when possible.</span></span> <span data-ttu-id="ee4eb-111">Los artículos siguientes le guiarán a través del proceso de preparación de las distintas distribuciones de Linux aprobadas que se admiten en Azure:</span><span class="sxs-lookup"><span data-stu-id="ee4eb-111">The following articles will guide you through how to prepare the various endorsed Linux distributions that are supported on Azure:</span></span>

* <span data-ttu-id="ee4eb-112">**[Distribuciones basadas en CentOS](create-upload-centos.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="ee4eb-112">**[CentOS-based Distributions](create-upload-centos.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="ee4eb-113">**[Debian Linux](debian-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="ee4eb-113">**[Debian Linux](debian-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="ee4eb-114">**[Oracle Linux](oracle-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="ee4eb-114">**[Oracle Linux](oracle-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="ee4eb-115">**[Red Hat Enterprise Linux](redhat-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="ee4eb-115">**[Red Hat Enterprise Linux](redhat-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="ee4eb-116">**[SLES y openSUSE](suse-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="ee4eb-116">**[SLES & openSUSE](suse-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="ee4eb-117">**[Ubuntu](create-upload-ubuntu.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="ee4eb-117">**[Ubuntu](create-upload-ubuntu.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>

<span data-ttu-id="ee4eb-118">El resto de este artículo se centrará en ofrecer orientaciones generales para ejecutar su distribución de Linux en Azure.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-118">The rest of this article will focus on general guidance for running your Linux distribution on Azure.</span></span>

## <a name="general-linux-installation-notes"></a><span data-ttu-id="ee4eb-119">Notas generales sobre la instalación de Linux</span><span class="sxs-lookup"><span data-stu-id="ee4eb-119">General Linux Installation Notes</span></span>
* <span data-ttu-id="ee4eb-120">El formato VHDX no se admite en Azure, solo **VHD fijo**.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-120">The VHDX format is not supported in Azure, only **fixed VHD**.</span></span>  <span data-ttu-id="ee4eb-121">Puede convertir el disco al formato VHD con el Administrador de Hyper-V o el cmdlet Convert-VHD.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-121">You can convert the disk to VHD format using Hyper-V Manager or the convert-vhd cmdlet.</span></span> <span data-ttu-id="ee4eb-122">Si utiliza VirtualBox, deberá seleccionar **Tamaño fijo** en lugar del tamaño predeterminado asignado dinámicamente al crear el disco.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-122">If you are using VirtualBox this means selecting **Fixed size** as opposed to the default dynamically allocated when creating the disk.</span></span>
* <span data-ttu-id="ee4eb-123">Azure solo admite máquinas virtuales de la generación 1.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-123">Azure only supports generation 1 virtual machines.</span></span> <span data-ttu-id="ee4eb-124">Puede convertir una máquina virtual de generación 1 de VHDX para el formato de archivo de VHD desde un disco de expansión dinámica a otro de tamaño fijo.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-124">You can convert a generation 1 virtual machine from VHDX to the VHD file format and from dynamically expanding to a fixed sized disk.</span></span> <span data-ttu-id="ee4eb-125">Sin embargo, no puede cambiar la generación de una máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-125">But you can't change a virtual machine's generation.</span></span> <span data-ttu-id="ee4eb-126">Para obtener más información, vea [¿Debería crear una máquina virtual de generación 1 o 2 en Hyper-V?](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/plan/should-i-create-a-generation-1-or-2-virtual-machine-in-hyper-v)</span><span class="sxs-lookup"><span data-stu-id="ee4eb-126">For more information, see [Should I create a generation 1 or 2 virtual machine in Hyper-V?](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/plan/should-i-create-a-generation-1-or-2-virtual-machine-in-hyper-v)</span></span>
* <span data-ttu-id="ee4eb-127">El tamaño máximo permitido para los discos duros virtuales es de 1023 GB.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-127">The maximum size allowed for the VHD is 1,023 GB.</span></span>
* <span data-ttu-id="ee4eb-128">Al instalar el sistema Linux se *recomienda* utilizar las particiones estándar en lugar de un LVM (que a menudo viene de forma predeterminada en muchas instalaciones).</span><span class="sxs-lookup"><span data-stu-id="ee4eb-128">When installing the Linux system it is *recommended* that you use standard partitions rather than LVM (often the default for many installations).</span></span> <span data-ttu-id="ee4eb-129">De este modo se impedirá que el nombre del LVM entre en conflicto con las máquinas virtuales clonadas, especialmente si en algún momento hace falta adjuntar un disco de SO a otra máquina virtual idéntica para solucionar problemas.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-129">This will avoid LVM name conflicts with cloned VMs, particularly if an OS disk ever needs to be attached to another identical VM for troubleshooting.</span></span> <span data-ttu-id="ee4eb-130">[LVM](configure-lvm.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) o [RAID](configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) se pueden utilizar en discos de datos.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-130">[LVM](configure-lvm.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) or [RAID](configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) may be used on data disks.</span></span>
* <span data-ttu-id="ee4eb-131">Se requiere la compatibilidad de kernel para el montaje de sistemas de archivos UDF.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-131">Kernel support for mounting UDF file systems is required.</span></span> <span data-ttu-id="ee4eb-132">Al arrancar Azure la primera vez, la configuración de aprovisionamiento se pasa a la máquina virtual Linux a través de medios con formato UDF conectados al invitado.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-132">At first boot on Azure the provisioning configuration is passed to the Linux VM via UDF-formatted media that is attached to the guest.</span></span> <span data-ttu-id="ee4eb-133">El agente Linux de Azure debe poder montar el sistema de archivos UDF para leer su configuración y aprovisionar la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-133">The Azure Linux agent must be able to mount the UDF file system to read its configuration and provision the VM.</span></span>
* <span data-ttu-id="ee4eb-134">Las versiones de kernel de Linux inferiores a la versión 2.6.37 no admiten NUMA en Hyper-V con tamaños de VM más grandes.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-134">Linux kernel versions below 2.6.37 do not support NUMA on Hyper-V with larger VM sizes.</span></span> <span data-ttu-id="ee4eb-135">Este problema afecta principalmente a las distribuciones anteriores que usan el kernel Red Hat 2.6.32 de canal de subida y se ha corregido en RHEL 6.6 (kernel-2.6.32-504).</span><span class="sxs-lookup"><span data-stu-id="ee4eb-135">This issue primarily impacts older distributions using the upstream Red Hat 2.6.32 kernel, and was fixed in RHEL 6.6 (kernel-2.6.32-504).</span></span> <span data-ttu-id="ee4eb-136">Los sistemas que ejecutan kernels personalizados cuyas versiones son anteriores a la versión 2.6.37, o bien kernels basados en RHEL cuyas versiones son anteriores a la versión 2.6.32-504, deben establecer el parámetro de inicio `numa=off` en la línea de comandos de kernel en grub.conf.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-136">Systems running custom kernels older than 2.6.37, or RHEL-based kernels older than 2.6.32-504 must set the boot parameter `numa=off` on the kernel command-line in grub.conf.</span></span> <span data-ttu-id="ee4eb-137">Para obtener más información, consulte Red Hat [KB 436883](https://access.redhat.com/solutions/436883).</span><span class="sxs-lookup"><span data-stu-id="ee4eb-137">For more information see Red Hat [KB 436883](https://access.redhat.com/solutions/436883).</span></span>
* <span data-ttu-id="ee4eb-138">No cree una partición de intercambio en el disco del SO.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-138">Do not configure a swap partition on the OS disk.</span></span> <span data-ttu-id="ee4eb-139">El agente de Linux se puede configurar para crear un archivo de intercambio en el disco de recursos temporal.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-139">The Linux agent can be configured to create a swap file on the temporary resource disk.</span></span>  <span data-ttu-id="ee4eb-140">Puede encontrar más información al respecto en los pasos que vienen a continuación.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-140">More information about this can be found in the steps below.</span></span>
* <span data-ttu-id="ee4eb-141">El tamaño de todos los archivos VHD debe ser múltiplo de 1 MB.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-141">All of the VHDs must have sizes that are multiples of 1 MB.</span></span>

### <a name="installing-kernel-modules-without-hyper-v"></a><span data-ttu-id="ee4eb-142">Instalación de los módulos de kernel sin Hyper-V</span><span class="sxs-lookup"><span data-stu-id="ee4eb-142">Installing kernel modules without Hyper-V</span></span>
<span data-ttu-id="ee4eb-143">Azure se ejecuta en el hipervisor de Hyper-V, por lo que Linux requiere que ciertos módulos del kernel estén instalados para ejecutarse en Azure.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-143">Azure runs on the Hyper-V hypervisor, so Linux requires that certain kernel modules are installed in order to run in Azure.</span></span> <span data-ttu-id="ee4eb-144">Si tiene una máquina virtual que se ha creado fuera de Hyper-V, los instaladores de Linux pueden no incluir los controladores de Hyper-V en el disco RAM inicial (initrd o initramfs) a menos que detecte que está ejecutando un entorno de Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-144">If you have a VM that was created outside of Hyper-V, the Linux installers may not include the drivers for Hyper-V in the initial ramdisk (initrd or initramfs) unless it detects that it is running an a Hyper-V environment.</span></span> <span data-ttu-id="ee4eb-145">Cuando utilice un sistema de virtualización diferente (Virtualbox, KVM, etc.) para preparar su imagen de Linux, puede que necesite volver a generar el initrd para asegurarse de que al menos los módulos kernel `hv_vmbus` y `hv_storvsc` están disponibles en el disco RAM inicial.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-145">When using a different virtualization system (i.e. Virtualbox, KVM, etc.) to prepare your Linux image, you may need to rebuild the initrd to ensure that at least the `hv_vmbus` and `hv_storvsc` kernel modules are available on the initial ramdisk.</span></span>  <span data-ttu-id="ee4eb-146">Esto es un problema conocido al menos en sistemas basados en el nivel superior de distribución de Red Hat.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-146">This is a known issue at least on systems based on the upstream Red Hat distribution.</span></span>

<span data-ttu-id="ee4eb-147">El mecanismo para volver a generar la imagen initrd o initramfs puede variar dependiendo de la distribución.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-147">The mechanism for rebuilding the initrd or initramfs image may vary depending on the distribution.</span></span> <span data-ttu-id="ee4eb-148">Consulte la documentación de distribución o el soporte para conocer el procedimiento adecuado.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-148">Please consult your distribution's documentation or support for the proper procedure.</span></span>  <span data-ttu-id="ee4eb-149">Este es un ejemplo de cómo volver a generar initrd mediante la utilidad `mkinitrd` :</span><span class="sxs-lookup"><span data-stu-id="ee4eb-149">Here is one example for how to rebuild the initrd using the `mkinitrd` utility:</span></span>

<span data-ttu-id="ee4eb-150">En primer lugar, realice una copia de seguridad de la imagen initrd existente:</span><span class="sxs-lookup"><span data-stu-id="ee4eb-150">First, back up the existing initrd image:</span></span>

    # cd /boot
    # sudo cp initrd-`uname -r`.img  initrd-`uname -r`.img.bak

<span data-ttu-id="ee4eb-151">A continuación, vuelva a generar el initrd con los módulos kernel `hv_vmbus` y `hv_storvsc`:</span><span class="sxs-lookup"><span data-stu-id="ee4eb-151">Next, rebuild the initrd with the `hv_vmbus` and `hv_storvsc` kernel modules:</span></span>

    # sudo mkinitrd --preload=hv_storvsc --preload=hv_vmbus -v -f initrd-`uname -r`.img `uname -r`


### <a name="resizing-vhds"></a><span data-ttu-id="ee4eb-152">Cambio de tamaño de los discos duros virtuales</span><span class="sxs-lookup"><span data-stu-id="ee4eb-152">Resizing VHDs</span></span>
<span data-ttu-id="ee4eb-153">Las imágenes VHD en Azure deben tener un tamaño virtual alineado con 1 MB.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-153">VHD images on Azure must have a virtual size aligned to 1MB.</span></span>  <span data-ttu-id="ee4eb-154">Normalmente, los discos duros virtuales creados con Hyper-V ya deben alinearse correctamente.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-154">Typically, VHDs created using Hyper-V should already be aligned correctly.</span></span>  <span data-ttu-id="ee4eb-155">Si el disco duro virtual no está alineado correctamente, recibirá un mensaje de error similar al siguiente cuando intente crear una *imagen* desde el disco duro virtual:</span><span class="sxs-lookup"><span data-stu-id="ee4eb-155">If the VHD is not aligned correctly then you may receive an error message similar to the following when you attempt to create an *image* from your VHD:</span></span>

    "The VHD http://<mystorageaccount>.blob.core.windows.net/vhds/MyLinuxVM.vhd has an unsupported virtual size of 21475270656 bytes. The size must be a whole number (in MBs).”

<span data-ttu-id="ee4eb-156">Para solucionar este problema, puede cambiar el tamaño de la máquina virtual mediante la consola de administrador de Hyper-V o el del cmdlet de PowerShell [Resize-VHD](http://technet.microsoft.com/library/hh848535.aspx) .</span><span class="sxs-lookup"><span data-stu-id="ee4eb-156">To remedy this you can resize the VM using either the Hyper-V Manager console or the [Resize-VHD](http://technet.microsoft.com/library/hh848535.aspx) Powershell cmdlet.</span></span>  <span data-ttu-id="ee4eb-157">Si no está ejecutando en un entorno de Windows, se recomienda usar qemu-img para convertir (si es necesario) y cambiar el tamaño del disco duro virtual:</span><span class="sxs-lookup"><span data-stu-id="ee4eb-157">If you are not running in a Windows environment then it is recommended to use qemu-img to convert (if needed) and resize the VHD.</span></span>

> [!NOTE]
> <span data-ttu-id="ee4eb-158">Hay un problema conocido en versiones de qemu-img >= 2.2.1 que da como resultado un VHD con formato incorrecto.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-158">There is a known bug in qemu-img versions >=2.2.1 that results in an improperly formatted VHD.</span></span> <span data-ttu-id="ee4eb-159">El problema se corrigió en QEMU 2.6.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-159">The issue has been fixed in QEMU 2.6.</span></span> <span data-ttu-id="ee4eb-160">Se recomienda usar qemu-img 2.2.0 o anterior, o bien actualice a la versión 2.6 o posterior.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-160">It is recommended to use either qemu-img 2.2.0 or lower, or update to 2.6 or higher.</span></span> <span data-ttu-id="ee4eb-161">Referencia: https://bugs.launchpad.net/qemu/+bug/1490611.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-161">Reference: https://bugs.launchpad.net/qemu/+bug/1490611.</span></span>
> 
> 

1. <span data-ttu-id="ee4eb-162">Cambiar el tamaño del disco duro virtual directamente mediante herramientas como `qemu-img` o `vbox-manage` puede dar  como resultado un disco duro virtual que no puede arrancar.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-162">Resizing the VHD directly using tools such as `qemu-img` or `vbox-manage` may result in an unbootable VHD.</span></span>  <span data-ttu-id="ee4eb-163">Por tanto, se recomienda convertir primero el disco duro virtual a una imagen de disco sin procesar.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-163">So it is recommended to first convert the VHD to a RAW disk image.</span></span>  <span data-ttu-id="ee4eb-164">Si la imagen de VM ya se ha creado como imagen de disco sin procesar (el valor predeterminado para algunos hipervisores como KVM), puede omitir este paso:</span><span class="sxs-lookup"><span data-stu-id="ee4eb-164">If the VM image was already created as RAW disk image (the default for some Hypervisors such as KVM) then you may skip this step:</span></span>
   
       # qemu-img convert -f vpc -O raw MyLinuxVM.vhd MyLinuxVM.raw

2. <span data-ttu-id="ee4eb-165">Calcular el tamaño necesario de la imagen de disco para asegurarse de que el tamaño virtual está alineado con 1MB.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-165">Calculate the required size of the disk image to ensure that the virtual size is aligned to 1MB.</span></span>  <span data-ttu-id="ee4eb-166">La siguiente secuencia de comandos de shell bash puede ayudar con esto.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-166">The following bash shell script can assist with this.</span></span>  <span data-ttu-id="ee4eb-167">El script usa "`qemu-img info`" para determinar el tamaño virtual de la imagen de disco y, a continuación, calcula el tamaño con el bloque de 1 MB siguiente:</span><span class="sxs-lookup"><span data-stu-id="ee4eb-167">The script uses "`qemu-img info`" to determine the virtual size of the disk image and then calculates the size to the next 1MB:</span></span>
   
       rawdisk="MyLinuxVM.raw"
       vhddisk="MyLinuxVM.vhd"
   
       MB=$((1024*1024))
       size=$(qemu-img info -f raw --output json "$rawdisk" | \
              gawk 'match($0, /"virtual-size": ([0-9]+),/, val) {print val[1]}')
   
       rounded_size=$((($size/$MB + 1)*$MB))
       echo "Rounded Size = $rounded_size"

3. <span data-ttu-id="ee4eb-168">Cambie el tamaño del disco sin procesar con $rounded_size como se establece en la secuencia de comandos anterior:</span><span class="sxs-lookup"><span data-stu-id="ee4eb-168">Resize the raw disk using $rounded_size as set in the above script:</span></span>
   
       # qemu-img resize MyLinuxVM.raw $rounded_size

4. <span data-ttu-id="ee4eb-169">Ahora, convierta el disco sin procesar a un disco duro virtual de tamaño fijo:</span><span class="sxs-lookup"><span data-stu-id="ee4eb-169">Now, convert the RAW disk back to a fixed-size VHD:</span></span>
   
       # qemu-img convert -f raw -o subformat=fixed -O vpc MyLinuxVM.raw MyLinuxVM.vhd

   <span data-ttu-id="ee4eb-170">O bien, con la versión de qemu **2.6 o posterior**, incluya la opción `force_size`:</span><span class="sxs-lookup"><span data-stu-id="ee4eb-170">Or, with qemu version **2.6+** include the `force_size` option:</span></span>

       # qemu-img convert -f raw -o subformat=fixed,force_size -O vpc MyLinuxVM.raw MyLinuxVM.vhd

## <a name="linux-kernel-requirements"></a><span data-ttu-id="ee4eb-171">Requisitos para el kernel de Linux</span><span class="sxs-lookup"><span data-stu-id="ee4eb-171">Linux Kernel Requirements</span></span>
<span data-ttu-id="ee4eb-172">Los controladores de los Servicios de integración de Linux (LIS) para Hyper-V y Azure contribuyen directamente en el kernel de Linux del canal de subida.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-172">The Linux Integration Services (LIS) drivers for Hyper-V and Azure are contributed directly to the upstream Linux kernel.</span></span> <span data-ttu-id="ee4eb-173">Muchas de las distribuciones que incluyen una versión reciente del kernel de Linux (por ejemplo, 3.x) ya tendrán estos controladores disponibles, o de lo contrario ofrecerán versiones con modificaciones de versiones anteriores de estos controladores con sus kernel.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-173">Many distributions that include a recent Linux kernel version (i.e. 3.x) will have these drivers available already, or otherwise provide backported versions of these drivers with their kernels.</span></span>  <span data-ttu-id="ee4eb-174">Estos controladores se actualizan constantemente en el kernel del canal de subida con nuevas correcciones y características; por ello, se recomienda cuando sea posible la ejecución de una [distribución aprobada](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) que incluya estas correcciones y actualizaciones.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-174">These drivers are constantly being updated in the upstream kernel with new fixes and features, so when possible it is recommended to run an [endorsed distribution](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) that will include these fixes and updates.</span></span>

<span data-ttu-id="ee4eb-175">Si ejecuta una variante de las versiones **6.0-6.3**de Red Hat Enterprise de Linux, tendrá que instalar los controladores de LIS más recientes para Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-175">If you are running a variant of Red Hat Enterprise Linux versions **6.0-6.3**, then you will need to install the latest LIS drivers for Hyper-V.</span></span> <span data-ttu-id="ee4eb-176">Podrá encontrar los controladores [en esta ubicación](http://go.microsoft.com/fwlink/p/?LinkID=254263&clcid=0x409).</span><span class="sxs-lookup"><span data-stu-id="ee4eb-176">The drivers can be found [at this location](http://go.microsoft.com/fwlink/p/?LinkID=254263&clcid=0x409).</span></span> <span data-ttu-id="ee4eb-177">En cuanto a **RHEL 6.4+** (y derivados), los controladores de LIS ya se incluyen con el kernel; por tanto, no se necesitan paquetes de instalación adicionales para ejecutar esos sistemas en Azure.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-177">As of RHEL **6.4+** (and derivatives) the LIS drivers are already included with the kernel and so no additional installation packages are needed to run those systems on Azure.</span></span>

<span data-ttu-id="ee4eb-178">Si se requiere un kernel personalizado, es muy recomendable utilizar una versión de kernel más reciente (por ejemplo, **3.8+**).</span><span class="sxs-lookup"><span data-stu-id="ee4eb-178">If a custom kernel is required, it is recommended to use a more recent kernel version (i.e. **3.8+**).</span></span> <span data-ttu-id="ee4eb-179">En el caso de las distribuciones o los proveedores que mantienen su propio kernel, es necesario cierto esfuerzo para modificar los controladores de LIS con una versión más antigua del kernel del canal de subida al kernel personalizado.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-179">For those distributions or vendors who maintain their own kernel, some effort will be required to regularly backport the LIS drivers from the upstream kernel to your custom kernel.</span></span>  <span data-ttu-id="ee4eb-180">Incluso si ya está ejecutando una versión de kernel relativamente reciente, es altamente recomendable mantenerse al tanto de las correcciones ascendentes de los controladores de LIS y realizar modificaciones con versiones anteriores en estos cuando sea necesario.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-180">Even if you are already running a relatively recent kernel version, it is highly recommended to keep track of any upstream fixes in the LIS drivers and backport those as needed.</span></span> <span data-ttu-id="ee4eb-181">La ubicación de los archivos de origen de controladores de LIS está disponible en el archivo [MAINTAINERS](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/MAINTAINERS) del árbol de origen del kernel de Linux:</span><span class="sxs-lookup"><span data-stu-id="ee4eb-181">The location of the LIS driver source files is available in the [MAINTAINERS](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/MAINTAINERS) file in the Linux kernel source tree:</span></span>

    F:    arch/x86/include/asm/mshyperv.h
    F:    arch/x86/include/uapi/asm/hyperv.h
    F:    arch/x86/kernel/cpu/mshyperv.c
    F:    drivers/hid/hid-hyperv.c
    F:    drivers/hv/
    F:    drivers/input/serio/hyperv-keyboard.c
    F:    drivers/net/hyperv/
    F:    drivers/scsi/storvsc_drv.c
    F:    drivers/video/fbdev/hyperv_fb.c
    F:    include/linux/hyperv.h
    F:    tools/hv/

<span data-ttu-id="ee4eb-182">Como mínimo, se sabe que la ausencia de los siguientes parches provocan problemas en Azure y, por tanto, deben incluirse en el kernel.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-182">At a very minimum, the absence of the following patches have been known to cause problems on Azure and so these must be included in the kernel.</span></span> <span data-ttu-id="ee4eb-183">Esta lista no es exhaustiva ni está completa para todas las distribuciones:</span><span class="sxs-lookup"><span data-stu-id="ee4eb-183">This list is by no means exhaustive or complete for all distributions:</span></span>

* [<span data-ttu-id="ee4eb-184">ata_piix: Aplazar discos a los controladores de Hyper-V de manera predeterminada</span><span class="sxs-lookup"><span data-stu-id="ee4eb-184">ata_piix: defer disks to the Hyper-V drivers by default</span></span>](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/drivers/ata/ata_piix.c?id=cd006086fa5d91414d8ff9ff2b78fbb593878e3c)
* [<span data-ttu-id="ee4eb-185">storvsc: Cuenta para paquetes en tránsito en la ruta de RESET</span><span class="sxs-lookup"><span data-stu-id="ee4eb-185">storvsc: Account for in-transit packets in the RESET path</span></span>](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/drivers/scsi/storvsc_drv.c?id=5c1b10ab7f93d24f29b5630286e323d1c5802d5c)
* [<span data-ttu-id="ee4eb-186">storvsc: Evitar el uso de WRITE_SAME</span><span class="sxs-lookup"><span data-stu-id="ee4eb-186">storvsc: avoid usage of WRITE_SAME</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=3e8f4f4065901c8dfc51407e1984495e1748c090)
* [<span data-ttu-id="ee4eb-187">storvsc: Deshabilita WRITE SAME para RAID y controladores del adaptador de host virtual</span><span class="sxs-lookup"><span data-stu-id="ee4eb-187">storvsc: Disable WRITE SAME for RAID and virtual host adapter drivers</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=54b2b50c20a61b51199bedb6e5d2f8ec2568fb43)
* [<span data-ttu-id="ee4eb-188">storvsc: Corrección de desreferenciación del puntero NULL</span><span class="sxs-lookup"><span data-stu-id="ee4eb-188">storvsc: NULL pointer dereference fix</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=b12bb60d6c350b348a4e1460cd68f97ccae9822e)
* [<span data-ttu-id="ee4eb-189">storvsc: Los errores de búfer de anillo pueden dar lugar a una inmovilización de E/S</span><span class="sxs-lookup"><span data-stu-id="ee4eb-189">storvsc: ring buffer failures may result in I/O freeze</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=e86fb5e8ab95f10ec5f2e9430119d5d35020c951)
* [<span data-ttu-id="ee4eb-190">scsi_sysfs: Protección contra la ejecución doble de __scsi_remove_device</span><span class="sxs-lookup"><span data-stu-id="ee4eb-190">scsi_sysfs: protect against double execution of __scsi_remove_device</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/scsi_sysfs.c?id=be821fd8e62765de43cc4f0e2db363d0e30a7e9b)

## <a name="the-azure-linux-agent"></a><span data-ttu-id="ee4eb-191">el Agente de Linux de Azure</span><span class="sxs-lookup"><span data-stu-id="ee4eb-191">The Azure Linux Agent</span></span>
<span data-ttu-id="ee4eb-192">El [agente de Linux de Azure](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) (waagent) se requiere para aprovisionar correctamente una máquina virtual de Linux en Azure.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-192">The [Azure Linux Agent](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) (waagent) is required to properly provision a Linux virtual machine in Azure.</span></span> <span data-ttu-id="ee4eb-193">Puede obtener la versión más reciente, dejar constancia de problemas o enviar solicitudes de extracción en el [repositorio GitHub del agente de Linux](https://github.com/Azure/WALinuxAgent).</span><span class="sxs-lookup"><span data-stu-id="ee4eb-193">You can get the latest version, file issues or submit pull requests at the [Linux Agent GitHub repo](https://github.com/Azure/WALinuxAgent).</span></span>

* <span data-ttu-id="ee4eb-194">El agente de Linux se publica bajo licencia Apache 2.0.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-194">The Linux agent is released under the Apache 2.0 license.</span></span> <span data-ttu-id="ee4eb-195">Muchas distribuciones ya proporcionan paquetes RPM o deb para el agente, y en algunos casos se pueden instalar y actualizar con poco esfuerzo.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-195">Many distributions already provide RPM or deb packages for the agent, and so in some cases this can be installed and updated with little effort.</span></span>
* <span data-ttu-id="ee4eb-196">El agente de Linux de Azure requiere Python v2.6+.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-196">The Azure Linux Agent requires Python v2.6+.</span></span>
* <span data-ttu-id="ee4eb-197">El agente requiere también el módulo python-pyasn1.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-197">The agent also requires the python-pyasn1 module.</span></span> <span data-ttu-id="ee4eb-198">La mayoría de distribuciones lo proporcionan como un paquete independiente que se puede instalar.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-198">Most distributions provide this as a separate package that can be installed.</span></span>
* <span data-ttu-id="ee4eb-199">En algunos casos, el Agente de Linux de Azure puede no ser compatible con NetworkManager.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-199">In some cases the Azure Linux Agent may not be compatible with NetworkManager.</span></span> <span data-ttu-id="ee4eb-200">Muchos de los paquetes RPM/Deb proporcionados por las distribuciones configuran NetworkManager como conflicto con el paquete waagent y, por lo tanto, desinstalarán NetworkManager al instalar el paquete del agente de Linux.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-200">Many of the RPM/Deb packages provided by distributions configure NetworkManager as a conflict to the waagent package, and thus will uninstall NetworkManager when you install the Linux agent package.</span></span>

## <a name="general-linux-system-requirements"></a><span data-ttu-id="ee4eb-201">Requisitos generales del sistema Linux</span><span class="sxs-lookup"><span data-stu-id="ee4eb-201">General Linux System Requirements</span></span>

* <span data-ttu-id="ee4eb-202">Modifique la línea de arranque del kernel en GRUB o GRUB2 para incluir los parámetros siguientes.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-202">Modify the kernel boot line in GRUB or GRUB2 to include the following parameters.</span></span> <span data-ttu-id="ee4eb-203">Así también se asegurará de que todos los mensajes de la consola se envíen al primer puerto serie, lo que puede ayudar al soporte técnico de Azure con los problemas de depuración de errores:</span><span class="sxs-lookup"><span data-stu-id="ee4eb-203">This will also ensure all console messages are sent to the first serial port, which can assist Azure support with debugging issues:</span></span>
  
        console=ttyS0,115200n8 earlyprintk=ttyS0,115200 rootdelay=300
  
    <span data-ttu-id="ee4eb-204">Así también se asegurará de que todos los mensajes de la consola se envían al primer puerto serie, lo que puede ayudar al soporte técnico de Azure con los problemas de depuración de errores.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-204">This will also ensure all console messages are sent to the first serial port, which can assist Azure support with debugging issues.</span></span>
  
    <span data-ttu-id="ee4eb-205">Además de lo anterior, se recomienda *quitar* los parámetros siguientes (si existen):</span><span class="sxs-lookup"><span data-stu-id="ee4eb-205">In addition to the above, it is recommended to *remove* the following parameters if they exist:</span></span>
  
        rhgb quiet crashkernel=auto
  
    <span data-ttu-id="ee4eb-206">Los arranques gráfico y silencioso no resultan útiles en un entorno de nube, donde queremos que todos los registros se envíen al puerto serie.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-206">Graphical and quiet boot are not useful in a cloud environment where we want all the logs to be sent to the serial port.</span></span> <span data-ttu-id="ee4eb-207">Es posible dejar la opción `crashkernel` configurada si así se desea, pero tenga en cuenta que este parámetro reducirá la cantidad de memoria disponible en la máquina virtual en 128 MB o más, lo cual puede resultar problemático en tamaños de VM más reducidos.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-207">The `crashkernel` option may be left configured if desired, but note that this parameter will reduce the amount of available memory in the VM by 128MB or more, which may be problematic on the smaller VM sizes.</span></span>

* <span data-ttu-id="ee4eb-208">Instalación del agente de Linux de Azure</span><span class="sxs-lookup"><span data-stu-id="ee4eb-208">Installing the Azure Linux Agent</span></span>
  
    <span data-ttu-id="ee4eb-209">El agente de Linux de Azure se requiere para aprovisionar una imagen de Linux en Azure.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-209">The Azure Linux Agent is required for provisioning a Linux image on Azure.</span></span>  <span data-ttu-id="ee4eb-210">Muchas distribuciones proporcionan el agente como paquete RPM o Deb (el paquete suele llamarse "WALinuxAgent" o "walinuxagent").</span><span class="sxs-lookup"><span data-stu-id="ee4eb-210">Many distributions provide the agent as an RPM or Deb package (the package is typically called 'WALinuxAgent' or 'walinuxagent').</span></span>  <span data-ttu-id="ee4eb-211">El agente también se puede instalar manualmente siguiendo los pasos de la [Guía del agente de Linux](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="ee4eb-211">The agent can also be installed manually by following the steps in the [Linux Agent Guide](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span></span>

* <span data-ttu-id="ee4eb-212">Asegúrese de que el servidor SSH se haya instalado y configurado para iniciarse en el tiempo de arranque.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-212">Ensure that the SSH server is installed and configured to start at boot time.</span></span>  <span data-ttu-id="ee4eb-213">Este es normalmente el valor predeterminado.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-213">This is usually the default.</span></span>

* <span data-ttu-id="ee4eb-214">No cree un espacio de intercambio en el disco del sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-214">Do not create swap space on the OS disk</span></span>
  
    <span data-ttu-id="ee4eb-215">El Agente de Linux de Azure puede configurar automáticamente un espacio de intercambio utilizando el disco de recursos local que se adjunta a la máquina virtual después de aprovisionarse en Azure.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-215">The Azure Linux Agent can automatically configure swap space using the local resource disk that is attached to the VM after provisioning on Azure.</span></span> <span data-ttu-id="ee4eb-216">Tenga en cuenta que el disco de recursos local es un disco *temporal* que debe vaciarse cuando la máquina virtual se desaprovisiona.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-216">Note that the local resource disk is a *temporary* disk, and might be emptied when the VM is deprovisioned.</span></span> <span data-ttu-id="ee4eb-217">Después de instalar el Agente de Linux de Azure (consulte el paso anterior), modifique apropiadamente los parámetros siguientes en /etc/waagent.conf:</span><span class="sxs-lookup"><span data-stu-id="ee4eb-217">After installing the Azure Linux Agent (see previous step), modify the following parameters in /etc/waagent.conf appropriately:</span></span>
  
        ResourceDisk.Format=y
        ResourceDisk.Filesystem=ext4
        ResourceDisk.MountPoint=/mnt/resource
        ResourceDisk.EnableSwap=y
        ResourceDisk.SwapSizeMB=2048    ## NOTE: set this to whatever you need it to be.

* <span data-ttu-id="ee4eb-218">Como paso final, ejecute los comandos siguientes para desaprovisionar la máquina virtual:</span><span class="sxs-lookup"><span data-stu-id="ee4eb-218">As a final step, run the following commands to deprovision the virtual machine:</span></span>
  
        # sudo waagent -force -deprovision
        # export HISTSIZE=0
        # logout
  
  > [!NOTE]
  > <span data-ttu-id="ee4eb-219">Es posible que en VirtualBox aparezca el error siguiente después de ejecutar 'waagent-force - deprovision': `[Errno 5] Input/output error`.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-219">On Virtualbox you may see the following error after running 'waagent -force -deprovision': `[Errno 5] Input/output error`.</span></span> <span data-ttu-id="ee4eb-220">Este mensaje de error no es crítico, por lo que se puede omitir.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-220">This error message is not critical and can be ignored.</span></span>
  > 
  > 

* <span data-ttu-id="ee4eb-221">A continuación, tendrá que apagar la máquina virtual y cargar el VHD en Azure.</span><span class="sxs-lookup"><span data-stu-id="ee4eb-221">You will then need to shut down the virtual machine and upload the VHD to Azure.</span></span>


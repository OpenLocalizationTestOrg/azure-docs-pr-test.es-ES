---
title: Arquitectura Azure HDInsight unida a un dominio | Microsoft Docs
description: "Aprenda a planear clústeres de HDInsight unidos a un dominio."
services: hdinsight
documentationcenter: 
author: saurinsh
manager: jhubbard
editor: cgronlun
tags: azure-portal
ms.assetid: 7dc6847d-10d4-4b5c-9c83-cc513cf91965
ms.service: hdinsight
ms.custom: hdinsightactive
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 02/03/2017
ms.author: saurinsh
ms.openlocfilehash: 7e34f47f09466a40993b4cc797ff1cad2bdaeafe
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="plan-azure-domain-joined-hadoop-clusters-in-hdinsight"></a><span data-ttu-id="e9c41-103">Planeamiento de clústeres de Hadoop unidos a un dominio de Azure en HDInsight</span><span class="sxs-lookup"><span data-stu-id="e9c41-103">Plan Azure domain-joined Hadoop clusters in HDInsight</span></span>

<span data-ttu-id="e9c41-104">Tradicionalmente, Hadoop es un clúster de un solo usuario.</span><span class="sxs-lookup"><span data-stu-id="e9c41-104">The traditional Hadoop is a single-user cluster.</span></span> <span data-ttu-id="e9c41-105">Es apropiado para la mayor parte de las empresas que tienen equipos de aplicaciones pequeños que generan grandes cargas de trabajo de datos.</span><span class="sxs-lookup"><span data-stu-id="e9c41-105">It is suitable for most companies that have smaller application teams building large data workloads.</span></span> <span data-ttu-id="e9c41-106">A medida que aumenta la popularidad de Hadoop, muchas empresas empiezan a usar un modelo en el que los equipos de TI administran clústeres y varios equipos de aplicaciones comparten los clústeres.</span><span class="sxs-lookup"><span data-stu-id="e9c41-106">As Hadoop gains popularity, many enterprises are moving toward a model in which clusters are managed by IT teams and multiple application teams share clusters.</span></span> <span data-ttu-id="e9c41-107">Por consiguiente, las funcionalidades que implican a clústeres de varios usuarios se encuentran entre las más solicitadas en HDInsight de Azure.</span><span class="sxs-lookup"><span data-stu-id="e9c41-107">Thus, functionalities involving multiuser clusters are among the most requested functionalities in Azure HDInsight.</span></span>

<span data-ttu-id="e9c41-108">En lugar de generar su propia autenticación y autorización multiusuario, HDInsight usa el proveedor de identidades más popular: Active Directory (AD).</span><span class="sxs-lookup"><span data-stu-id="e9c41-108">Instead of building its own multiuser authentication and authorization, HDInsight relies on the most popular identity provider--Active Directory (AD).</span></span> <span data-ttu-id="e9c41-109">La eficaz funcionalidad de seguridad de AD se puede usar para administrar la autorización multiusuario en HDInsight.</span><span class="sxs-lookup"><span data-stu-id="e9c41-109">The powerful security functionality in AD can be used to manage multiuser authorization in HDInsight.</span></span> <span data-ttu-id="e9c41-110">Mediante la integración de HDInsight con AD, se puede comunicar con los clústeres mediante sus credenciales de AD.</span><span class="sxs-lookup"><span data-stu-id="e9c41-110">By integrating HDInsight with AD, you can communicate with the clusters by using your AD credentials.</span></span> <span data-ttu-id="e9c41-111">HDInsight asigna un usuario de AD a un usuario de Hadoop local, de modo que todos los servicios que se ejecutan en HDInsight (Ambari, servidor de Hive, Ranger, servidor Thrift de Spark, etc.) funcionan perfectamente para el usuario autenticado.</span><span class="sxs-lookup"><span data-stu-id="e9c41-111">HDInsight maps an AD user to a local Hadoop user, so all the services running on HDInsight (Ambari, Hive server, Ranger, Spark thrift server, and others) work seamlessly for the authenticated user.</span></span>

## <a name="integrate-hdinsight-with-ad-and-ad-on-iaas-vm"></a><span data-ttu-id="e9c41-112">Integración de HDInsight con AD y AD en la máquina virtual de IaaS</span><span class="sxs-lookup"><span data-stu-id="e9c41-112">Integrate HDInsight with AD and AD on IaaS VM</span></span>

<span data-ttu-id="e9c41-113">Al integrar HDInsight con Azure AD o AD, los nodos del clúster de HDInsight son unidos a un dominio para un dominio.</span><span class="sxs-lookup"><span data-stu-id="e9c41-113">By integrating HDInsight with Azure AD or AD on Iaas VM, the HDInsight cluster nodes are domain-joined to a domain.</span></span> <span data-ttu-id="e9c41-114">HDInsight crea entidades de servicio para los servicios de Hadoop que se ejecutan en el clúster y las coloca en una unidad organizativa (OU) especificada de Azure AD o AD en una máquina virtual de IaaS.</span><span class="sxs-lookup"><span data-stu-id="e9c41-114">HDInsight creates service principals for the Hadoop services running on the cluster and places them within a specified organizational unit (OU) in Azure AD or AD on IaaS VM.</span></span> <span data-ttu-id="e9c41-115">HDInsight también crea asignaciones de DNS inverso en el dominio para las direcciones IP de los nodos que se unen al dominio.</span><span class="sxs-lookup"><span data-stu-id="e9c41-115">HDInsight also creates reverse DNS mappings in the domain for the IP addresses of the nodes that are joined to the domain.</span></span>

<span data-ttu-id="e9c41-116">Esta configuración se puede lograr mediante el uso de varias arquitecturas.</span><span class="sxs-lookup"><span data-stu-id="e9c41-116">You can achieve this setup by using multiple architectures.</span></span> <span data-ttu-id="e9c41-117">Puede elegir entre las siguientes opciones.</span><span class="sxs-lookup"><span data-stu-id="e9c41-117">You can choose from the following architectures.</span></span>

<span data-ttu-id="e9c41-118">**HDInsight integrado con AD que se ejecuta en Azure IaaS**</span><span class="sxs-lookup"><span data-stu-id="e9c41-118">**HDInsight integrated with AD running on Azure IaaS**</span></span>

<span data-ttu-id="e9c41-119">Esta es la arquitectura más sencilla para la integración de HDInsight con Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e9c41-119">This is the simplest architecture for integrating HDInsight with Active Directory.</span></span> <span data-ttu-id="e9c41-120">El controlador de dominio de AD se ejecuta en una máquina virtual, o en varias, en Azure.</span><span class="sxs-lookup"><span data-stu-id="e9c41-120">The AD domain controller runs on one (or multiple) virtual machines (VMs) in Azure.</span></span> <span data-ttu-id="e9c41-121">Normalmente, estas máquinas virtuales se encuentran en una red virtual.</span><span class="sxs-lookup"><span data-stu-id="e9c41-121">These VMs are usually in a virtual network.</span></span> <span data-ttu-id="e9c41-122">Configure otra red virtual para el clúster de HDInsight.</span><span class="sxs-lookup"><span data-stu-id="e9c41-122">You set up another virtual network for the HDInsight cluster.</span></span> <span data-ttu-id="e9c41-123">Para que HDInsight tenga una línea de visión a Active Directory, es preciso emparejar estas redes virtuales mediante el uso del [emparejamiento de VNet a VNet](../virtual-network/virtual-network-create-peering.md).</span><span class="sxs-lookup"><span data-stu-id="e9c41-123">For HDInsight to have a line of sight to Active Directory, you need to peer these virtual networks by using [VNet-to-VNet peering](../virtual-network/virtual-network-create-peering.md).</span></span> <span data-ttu-id="e9c41-124">Si crea el Active Directory en ARM, a continuación, puede crear el Active Directory y HDInsight en la misma red virtual y no tiene que hacer el emparejamiento.</span><span class="sxs-lookup"><span data-stu-id="e9c41-124">If you create the Active Directory in ARM, then you can create the Active Directory and HDInsight in the same VNet and you don't need to do peering.</span></span> 

![Topología de clúster de HDInsight de unión a dominio](./media/hdinsight-domain-joined-architecture/hdinsight-domain-joined-architecture_1.png)

> [!NOTE]
> <span data-ttu-id="e9c41-126">En esta arquitectura, Azure Data Lake Store no se puede usar con el clúster de HDInsight.</span><span class="sxs-lookup"><span data-stu-id="e9c41-126">In this architecture, you cannot use Azure Data Lake Store with the HDInsight cluster.</span></span>


<span data-ttu-id="e9c41-127">Requisitos previos de Active Directory:</span><span class="sxs-lookup"><span data-stu-id="e9c41-127">Prerequisites for Active Directory:</span></span>

* <span data-ttu-id="e9c41-128">Se debe crear una [unidad organizativa](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md), en la que se colocan las máquinas virtuales del clúster de HDInsight y las entidades de servicio que usa el clúster.</span><span class="sxs-lookup"><span data-stu-id="e9c41-128">An [organizational unit](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md) must be created, within which you place the HDInsight cluster VMs and the service principals used by the cluster.</span></span>
* <span data-ttu-id="e9c41-129">[Protocolo ligero de acceso a directorios](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) (LDAP) debe configurarse para comunicarse con AD.</span><span class="sxs-lookup"><span data-stu-id="e9c41-129">[Lightweight Directory Access Protocols](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) (LDAPs) must be set up for communicating with AD.</span></span> <span data-ttu-id="e9c41-130">El certificado que se usa para instalar LDAPS debe ser un certificado real (no uno autofirmado).</span><span class="sxs-lookup"><span data-stu-id="e9c41-130">The certificate used to set up LDAPS must be a real certificate (not a self-signed certificate).</span></span>
* <span data-ttu-id="e9c41-131">Deben crearse zonas de DNS inverso en el dominio para el intervalo de direcciones IP de la subred de HDInsight (por ejemplo, 10.2.0.0/24 en la imagen anterior).</span><span class="sxs-lookup"><span data-stu-id="e9c41-131">Reverse DNS zones must be created on the domain for the IP address range of the HDInsight subnet (for example, 10.2.0.0/24 in the previous picture).</span></span>
* <span data-ttu-id="e9c41-132">Se necesita una cuenta de servicio o una cuenta de usuario.</span><span class="sxs-lookup"><span data-stu-id="e9c41-132">A service account or a user account is needed.</span></span> <span data-ttu-id="e9c41-133">Utilice esta cuenta para crear el clúster de HDInsight.</span><span class="sxs-lookup"><span data-stu-id="e9c41-133">Use this account to create the HDInsight cluster.</span></span> <span data-ttu-id="e9c41-134">Esta cuenta debe tener los siguientes permisos:</span><span class="sxs-lookup"><span data-stu-id="e9c41-134">This account must have the following permissions:</span></span>

    - <span data-ttu-id="e9c41-135">Permisos para crear objetos de entidad de servicio y objetos de equipo en la unidad organizativa</span><span class="sxs-lookup"><span data-stu-id="e9c41-135">Permissions to create service principal objects and machine objects within the organizational unit</span></span>
    - <span data-ttu-id="e9c41-136">Permisos para crear reglas de proxy de DNS inverso</span><span class="sxs-lookup"><span data-stu-id="e9c41-136">Permissions to create reverse DNS proxy rules</span></span>
    - <span data-ttu-id="e9c41-137">Permisos para unir equipos al dominio de Active Directory</span><span class="sxs-lookup"><span data-stu-id="e9c41-137">Permissions to join machines to the Active Directory domain</span></span>

<span data-ttu-id="e9c41-138">**HDInsight integrado con una instancia de Azure AD solo en la nube**</span><span class="sxs-lookup"><span data-stu-id="e9c41-138">**HDInsight integrated with cloud-only Azure AD**</span></span>

<span data-ttu-id="e9c41-139">Para una instancia de Azure AD solo en la nube, configure un controlador de dominio para que HDInsight se pueda integrar con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="e9c41-139">For cloud-only Azure AD, configure a domain controller so that HDInsight can be integrated with Azure AD.</span></span> <span data-ttu-id="e9c41-140">Esto se logra mediante el uso de [Azure Active Directory Domain Services](../active-directory-domain-services/active-directory-ds-overview.md) (Azure AD DS).</span><span class="sxs-lookup"><span data-stu-id="e9c41-140">This is achieved by using [Azure Active Directory Domain Services](../active-directory-domain-services/active-directory-ds-overview.md) (Azure AD DS).</span></span> <span data-ttu-id="e9c41-141">Azure AD DS crea equipos del controlador de dominio en la nube y les proporciona direcciones IP.</span><span class="sxs-lookup"><span data-stu-id="e9c41-141">Azure AD DS creates domain controller machines on the cloud and provides IP addresses for them.</span></span> <span data-ttu-id="e9c41-142">Crea dos controladores de dominio para lograr alta disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="e9c41-142">It creates two domain controllers for high availability.</span></span>

<span data-ttu-id="e9c41-143">Actualmente, Azure AD DS solo existe en redes virtuales clásicas.</span><span class="sxs-lookup"><span data-stu-id="e9c41-143">Currently, Azure AD DS exists only in classic virtual networks.</span></span> <span data-ttu-id="e9c41-144">Solo se puede acceder a él mediante el Portal de Azure clásico.</span><span class="sxs-lookup"><span data-stu-id="e9c41-144">It is only accessible by using the Azure classic portal.</span></span> <span data-ttu-id="e9c41-145">La red virtual de HDInsight existe en Azure Portal, que es preciso emparejar con la red virtual clásica mediante el emparejamiento entre redes virtuales.</span><span class="sxs-lookup"><span data-stu-id="e9c41-145">The HDInsight virtual network exists in the Azure portal, which needs to be peered with the classic virtual network by using VNet-to-VNet peering.</span></span>

> [!NOTE]
> <span data-ttu-id="e9c41-146">El emparejamiento entre una red virtual clásica y una red virtual de Azure Resource Manager requiere que las dos redes virtuales estén en la misma región y en la misma suscripción de Azure.</span><span class="sxs-lookup"><span data-stu-id="e9c41-146">Peering between a classic virtual network and an Azure Resource Manager virtual network requires that both virtual networks are in the same region and under the same Azure subscription.</span></span>

![Topología de clúster de HDInsight de unión a dominio](./media/hdinsight-domain-joined-architecture/hdinsight-domain-joined-architecture_2.png)

<span data-ttu-id="e9c41-148">Requisitos previos de Azure AD:</span><span class="sxs-lookup"><span data-stu-id="e9c41-148">Prerequisites for Azure AD:</span></span>

* <span data-ttu-id="e9c41-149">Se debe crear una [unidad organizativa](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md), en la que se colocan las máquinas virtuales del clúster de HDInsight y las entidades de servicio que usa el clúster.</span><span class="sxs-lookup"><span data-stu-id="e9c41-149">An [organizational unit](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md) must be created within which you place the HDInsight cluster VMs and the service principals used by the cluster.</span></span>
* <span data-ttu-id="e9c41-150">Al configurar Azure AD DS, se debe configurar [LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md).</span><span class="sxs-lookup"><span data-stu-id="e9c41-150">[LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) must be set up when you configure Azure AD DS.</span></span> <span data-ttu-id="e9c41-151">El certificado que se usa para instalar LDAPS debe ser un certificado real (no uno autofirmado).</span><span class="sxs-lookup"><span data-stu-id="e9c41-151">The certificate used to set up LDAPS must be a real certificate (not a self-signed certificate).</span></span>
* <span data-ttu-id="e9c41-152">Deben crearse zonas de DNS inverso en el dominio para el intervalo de direcciones IP de la subred de HDInsight (por ejemplo, 10.2.0.0/24 en la imagen anterior).</span><span class="sxs-lookup"><span data-stu-id="e9c41-152">Reverse DNS zones must be created on the domain for the IP address range of the HDInsight subnet (for example, 10.2.0.0/24 in the previous picture).</span></span>
* <span data-ttu-id="e9c41-153">Deben sincronizarse [hash de contraseña](../active-directory-domain-services/active-directory-ds-getting-started-password-sync.md) de Azure AD a Azure AD DS.</span><span class="sxs-lookup"><span data-stu-id="e9c41-153">[Password hashes](../active-directory-domain-services/active-directory-ds-getting-started-password-sync.md) must be synced from Azure AD to Azure AD DS.</span></span>
* <span data-ttu-id="e9c41-154">Se necesita una cuenta de servicio o una cuenta de usuario.</span><span class="sxs-lookup"><span data-stu-id="e9c41-154">A service account or a user account is needed.</span></span> <span data-ttu-id="e9c41-155">Utilice esta cuenta para crear el clúster de HDInsight.</span><span class="sxs-lookup"><span data-stu-id="e9c41-155">Use this account to create the HDInsight cluster.</span></span> <span data-ttu-id="e9c41-156">Esta cuenta debe tener los siguientes permisos:</span><span class="sxs-lookup"><span data-stu-id="e9c41-156">This account must have the following permissions:</span></span>

    - <span data-ttu-id="e9c41-157">Permisos para crear objetos de entidad de servicio y objetos de equipo en la unidad organizativa</span><span class="sxs-lookup"><span data-stu-id="e9c41-157">Permissions to create service principal objects and machine objects within the organizational unit</span></span>
    - <span data-ttu-id="e9c41-158">Permisos para crear reglas de proxy de DNS inverso</span><span class="sxs-lookup"><span data-stu-id="e9c41-158">Permissions to create reverse DNS proxy rules</span></span>
    - <span data-ttu-id="e9c41-159">Permisos para unir equipos al dominio de Azure AD</span><span class="sxs-lookup"><span data-stu-id="e9c41-159">Permissions to join machines to the Azure AD domain</span></span>

## <a name="next-steps"></a><span data-ttu-id="e9c41-160">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="e9c41-160">Next steps</span></span>
* <span data-ttu-id="e9c41-161">Para configurar un clúster de HDInsight unido a un dominio, consulte [Configuración de clústeres de HDInsight unidos a un dominio (versión preliminar)](hdinsight-domain-joined-configure.md).</span><span class="sxs-lookup"><span data-stu-id="e9c41-161">To configure a domain-joined HDInsight cluster, see [Configure domain-joined HDInsight clusters](hdinsight-domain-joined-configure.md).</span></span>
* <span data-ttu-id="e9c41-162">Para administrar clústeres de HDInsight unidos a un dominio, consulte [Administración de clústeres de HDInsight unidos a dominio (versión preliminar)](hdinsight-domain-joined-manage.md).</span><span class="sxs-lookup"><span data-stu-id="e9c41-162">To manage domain-joined HDInsight clusters, see [Manage domain-joined HDInsight clusters](hdinsight-domain-joined-manage.md).</span></span>
* <span data-ttu-id="e9c41-163">Para configurar directivas de Hive y ejecutar consultas de Hive, consulte [Administración de clústeres de HDInsight unidos a dominio (versión preliminar)](hdinsight-domain-joined-run-hive.md).</span><span class="sxs-lookup"><span data-stu-id="e9c41-163">To configure Hive policies and run Hive queries, see [Configure Hive policies for domain-joined HDInsight clusters](hdinsight-domain-joined-run-hive.md).</span></span>
* <span data-ttu-id="e9c41-164">Para ejecutar consultas de Hive mediante SSH en clústeres de HDInsight unidos a un dominio, consulte [Uso de SSH con HDInsight](hdinsight-hadoop-linux-use-ssh-unix.md).</span><span class="sxs-lookup"><span data-stu-id="e9c41-164">To run Hive queries by using SSH on domain-joined HDInsight clusters, see [Use SSH with HDInsight](hdinsight-hadoop-linux-use-ssh-unix.md).</span></span>

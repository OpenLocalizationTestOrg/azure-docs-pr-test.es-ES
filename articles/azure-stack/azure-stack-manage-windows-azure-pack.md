---
title: "Administrar máquinas virtuales de Windows Azure Pack desde Azure Stack | Microsoft Docs"
description: "Aprenda cómo administrar las máquinas virtuales de Windows Azure Pack (WAP) desde el portal de usuarios en Azure Stack."
services: azure-stack
documentationcenter: 
author: walterov
manager: byronr
editor: 
ms.assetid: 213c2792-d404-4b44-8340-235adf3f8f0b
ms.service: azure-stack
ms.workload: na
pms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/10/2017
ms.author: walterov
ms.openlocfilehash: e00cf1c3f3d74b98e84b3d3f862e3a7b1b5b65f4
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/03/2017
---
# <a name="manage-windows-azure-pack-virtual-machines-from-azure-stack"></a><span data-ttu-id="12aa5-103">Administrar máquinas virtuales de Windows Azure Pack desde Azure Stack</span><span class="sxs-lookup"><span data-stu-id="12aa5-103">Manage Windows Azure Pack virtual machines from Azure Stack</span></span>
<span data-ttu-id="12aa5-104">En Azure Stack Development Kit, puede habilitar el acceso desde el portal de usuarios de Azure Stack a las máquinas virtuales de inquilinos que se ejecutan en Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-104">In the Azure Stack Development Kit, you can enable access from the Azure Stack user portal to tenant virtual machines running on Windows Azure Pack.</span></span> <span data-ttu-id="12aa5-105">Los inquilinos pueden usar el portal de Azure Stack para administrar sus máquinas virtuales y redes virtuales IaaS existentes.</span><span class="sxs-lookup"><span data-stu-id="12aa5-105">Tenants can use the Azure Stack portal to manage their existing IaaS virtual machines and virtual networks.</span></span> <span data-ttu-id="12aa5-106">Estos recursos están disponibles en Windows Azure Pack a través de los componentes subyacentes Service Provider Foundation (SPF) y Virtual Machine Manager (VMM).</span><span class="sxs-lookup"><span data-stu-id="12aa5-106">These resources are made available on Windows Azure Pack through the underlying Service Provider Foundation (SPF) and Virtual Machine Manager (VMM) components.</span></span> <span data-ttu-id="12aa5-107">En concreto, los inquilinos pueden:</span><span class="sxs-lookup"><span data-stu-id="12aa5-107">Specifically, tenants can:</span></span>

* <span data-ttu-id="12aa5-108">Examinar los recursos.</span><span class="sxs-lookup"><span data-stu-id="12aa5-108">Browse resources</span></span>
* <span data-ttu-id="12aa5-109">Examinar los valores de configuración.</span><span class="sxs-lookup"><span data-stu-id="12aa5-109">Examine configuration values</span></span>
* <span data-ttu-id="12aa5-110">Detener o iniciar una máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="12aa5-110">Stop or start a virtual machine</span></span>
* <span data-ttu-id="12aa5-111">Conectarse a una máquina virtual a través del Protocolo de escritorio remoto (RDP).</span><span class="sxs-lookup"><span data-stu-id="12aa5-111">Connect to a virtual machine through Remote Desktop Protocol (RDP)</span></span>
* <span data-ttu-id="12aa5-112">Crear y administrar puntos de control.</span><span class="sxs-lookup"><span data-stu-id="12aa5-112">Create and manage checkpoints</span></span>
* <span data-ttu-id="12aa5-113">Eliminar máquinas virtuales y redes virtuales.</span><span class="sxs-lookup"><span data-stu-id="12aa5-113">Delete virtual machines and virtual networks</span></span>

<span data-ttu-id="12aa5-114">Esta funcionalidad se proporciona mediante el conector de Windows Azure Pack para Azure Stack (versión preliminar).</span><span class="sxs-lookup"><span data-stu-id="12aa5-114">This functionality is provided by the Windows Azure Pack Connector for Azure Stack (Preview).</span></span> <span data-ttu-id="12aa5-115">En este artículo se muestra cómo configurar el conector para un entorno de Azure Stack de nodo único.</span><span class="sxs-lookup"><span data-stu-id="12aa5-115">This article shows how to configure the connector for a single-node Azure Stack environment.</span></span>

<span data-ttu-id="12aa5-116">Para esta versión preliminar del conector, tenga en cuenta lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="12aa5-116">For this preview release of the connector, be aware of the following:</span></span>
* <span data-ttu-id="12aa5-117">Use el conector de Windows Azure Pack únicamente en entornos de prueba (de Azure Stack y Windows Azure Pack) y no en las implementaciones de producción.</span><span class="sxs-lookup"><span data-stu-id="12aa5-117">Use the Windows Azure Pack Connector only in test environments (for both Azure Stack and Windows Azure Pack), and not in production deployments.</span></span>
* <span data-ttu-id="12aa5-118">Debe tener Windows Azure Pack Update Rollup (UR) 9.1 o una versión posterior, SPF de System Center y VMM UR 9 o posterior.</span><span class="sxs-lookup"><span data-stu-id="12aa5-118">You must have Windows Azure Pack Update Rollup (UR) 9.1 or later and System Center SPF and VMM UR 9 or later.</span></span>
* <span data-ttu-id="12aa5-119">Los componentes VMM y SPF pueden ser System Center 2012 R2 o System Center 2016.</span><span class="sxs-lookup"><span data-stu-id="12aa5-119">The VMM and SPF components can be either System Center 2012 R2 or System Center 2016.</span></span>
* <span data-ttu-id="12aa5-120">Debe seguir los pasos de configuración tanto en Azure Stack como en Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-120">You must perform configuration steps on both Azure Stack and on Windows Azure Pack.</span></span>
* <span data-ttu-id="12aa5-121">Las instrucciones se aplican a los entornos distintos de Cloud Platform System (CPS).</span><span class="sxs-lookup"><span data-stu-id="12aa5-121">The instructions apply to non-Cloud Platform System (CPS) environments.</span></span>
* <span data-ttu-id="12aa5-122">Para revisar los problemas conocidos, consulte [Microsoft Azure Stack troubleshooting](azure-stack-troubleshooting.md) (Solución de problemas de Microsoft Azure Stack).</span><span class="sxs-lookup"><span data-stu-id="12aa5-122">To review the known issues, see [Microsoft Azure Stack troubleshooting](azure-stack-troubleshooting.md).</span></span>


## <a name="architecture"></a><span data-ttu-id="12aa5-123">Arquitectura</span><span class="sxs-lookup"><span data-stu-id="12aa5-123">Architecture</span></span>
<span data-ttu-id="12aa5-124">En el siguiente diagrama se muestran los componentes principales del conector de Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-124">The following diagram shows the main components of the Windows Azure Pack Connector.</span></span>

![Componentes del conector de Windows Azure Pack](media/azure-stack-manage-wap/image1.png)

<span data-ttu-id="12aa5-126">Tenga en cuenta los detalles siguientes:</span><span class="sxs-lookup"><span data-stu-id="12aa5-126">Notice the following details:</span></span>
* <span data-ttu-id="12aa5-127">El portal de usuarios de Azure Stack tiene acceso a la información de recursos de ambas nubes (Azure Stack y Windows Azure Pack).</span><span class="sxs-lookup"><span data-stu-id="12aa5-127">The Azure Stack user portal accesses the resource information from both clouds (Azure Stack and Windows Azure Pack).</span></span>
* <span data-ttu-id="12aa5-128">El usuario debe tener una cuenta que sea válida en ambos entornos.</span><span class="sxs-lookup"><span data-stu-id="12aa5-128">The user must have an account that is valid in both environments.</span></span>
* <span data-ttu-id="12aa5-129">El portal de usuarios de Azure Stack debe tener acceso de red a los componentes que se ejecutan en Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-129">The Azure Stack user portal must have network access to the components running on Windows Azure Pack.</span></span>
* <span data-ttu-id="12aa5-130">En la sección **WAP** del diagrama, puede ver los nuevos módulos del conector de Windows Azure Pack (WAP Extension y Connector) y la API de inquilino existente de Windows Azure Pack con los componentes SPF y VMM.</span><span class="sxs-lookup"><span data-stu-id="12aa5-130">In the **WAP** section of the diagram, you can see the new Windows Azure Pack Connector modules (WAP Extension and Connector) and the existing Windows Azure Pack Tenant API with SPF and VMM components.</span></span>


## <a name="identity-management"></a><span data-ttu-id="12aa5-131">Administración de identidades</span><span class="sxs-lookup"><span data-stu-id="12aa5-131">Identity management</span></span>
<span data-ttu-id="12aa5-132">La API de inquilino de Windows Azure Pack debe confiar en el servicio de token de seguridad (STS) de Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-132">The Windows Azure Pack Tenant API must trust the Azure Stack security token service (STS).</span></span>

<span data-ttu-id="12aa5-133">Cuando un usuario realiza una acción a través del portal de Azure Stack dirigida a los recursos de Windows Azure Pack, el portal usa la API de inquilino de Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-133">When a user performs an action through the Azure Stack portal that targets Windows Azure Pack resources, the portal uses the Windows Azure Pack Tenant API.</span></span> <span data-ttu-id="12aa5-134">Por lo tanto, el token de autenticación de usuario proporcionado debe proceder de un STS de confianza.</span><span class="sxs-lookup"><span data-stu-id="12aa5-134">Therefore, the provided user authentication token must come from a trusted STS.</span></span> <span data-ttu-id="12aa5-135">Observe el diagrama siguiente:</span><span class="sxs-lookup"><span data-stu-id="12aa5-135">See the following diagram:</span></span>

![Diagrama de autenticación del conector de Windows Azure Pack](media/azure-stack-manage-wap/image2.png)

<span data-ttu-id="12aa5-137">En el entorno del kit de desarrollo, Windows Azure Pack y Azure Stack tienen proveedores de identidad independientes.</span><span class="sxs-lookup"><span data-stu-id="12aa5-137">In the development kit environment, Windows Azure Pack and Azure Stack have independent identity providers.</span></span> <span data-ttu-id="12aa5-138">Los usuarios que tienen acceso a ambos entornos del portal de Azure Stack deben tener el mismo nombre principal de usuario (UPN) en ambos proveedores de identidades.</span><span class="sxs-lookup"><span data-stu-id="12aa5-138">Users who access both environments from the Azure Stack portal must have the same user principal name (UPN) name in both identity providers.</span></span> <span data-ttu-id="12aa5-139">Por ejemplo, la cuenta *azurestackadmin@azurestack.local* también debe existir en el STS de Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-139">For example, the account *azurestackadmin@azurestack.local* should also exist in the STS for Windows Azure Pack.</span></span> <span data-ttu-id="12aa5-140">Si AD FS no está configurado para admitir las relaciones de confianza saliente, se establecerá la confianza de los componentes de Windows Azure Pack (API de inquilino) a la instancia de Azure Stack de AD FS.</span><span class="sxs-lookup"><span data-stu-id="12aa5-140">Where AD FS is not set up to support outbound trust relationships, you will establish trust from the Windows Azure Pack components (Tenant API) to the Azure Stack instance of AD FS.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="12aa5-141">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="12aa5-141">Prerequisites</span></span>

### <a name="download-the-windows-azure-pack-connector"></a><span data-ttu-id="12aa5-142">Descargar el conector de Windows Azure Pack</span><span class="sxs-lookup"><span data-stu-id="12aa5-142">Download the Windows Azure Pack Connector</span></span>
<span data-ttu-id="12aa5-143">En el [Centro de descarga de Microsoft](https://aka.ms/wapconnectorazurestackdlc), descargue el archivo .exe y extráigalo en el equipo local.</span><span class="sxs-lookup"><span data-stu-id="12aa5-143">On the [Microsoft Download Center](https://aka.ms/wapconnectorazurestackdlc), download the .exe file and extract it to your local computer.</span></span> <span data-ttu-id="12aa5-144">Luego, copie el contenido en un equipo que pueda acceder a su entorno de Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-144">Later, you copy the contents to a computer that can access your Windows Azure Pack environment.</span></span>

### <a name="deployment-option-requirement"></a><span data-ttu-id="12aa5-145">Requisito de opción de implementación</span><span class="sxs-lookup"><span data-stu-id="12aa5-145">Deployment option requirement</span></span>
<span data-ttu-id="12aa5-146">Para integrar con Windows Azure Pack, puede implementar Azure Stack mediante la opción de AD FS o la opción de Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="12aa5-146">To integrate with Windows Azure Pack, you can deploy Azure Stack by using the AD FS option or the Azure Active Directory option.</span></span>

### <a name="connectivity-requirements"></a><span data-ttu-id="12aa5-147">Requisitos de conectividad</span><span class="sxs-lookup"><span data-stu-id="12aa5-147">Connectivity requirements</span></span>
1. <span data-ttu-id="12aa5-148">En el equipo en el que tiene acceso al portal de usuarios de Azure Stack, asegúrese de que puede acceder al portal de inquilinos de Windows Azure Pack a través del explorador web.</span><span class="sxs-lookup"><span data-stu-id="12aa5-148">From the computer on which you access the Azure Stack user portal, make sure that you can access the Windows Azure Pack tenant portal through the web browser.</span></span>
2. <span data-ttu-id="12aa5-149">La máquina virtual AzS-WASP01 en Azure Stack debe ser capaz de conectarse al equipo del portal de inquilinos de Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-149">The AzS-WASP01 virtual machine on Azure Stack must be able to connect to the Windows Azure Pack tenant portal computer.</span></span> <span data-ttu-id="12aa5-150">Use Ping.exe para comprobar la conectividad de red.</span><span class="sxs-lookup"><span data-stu-id="12aa5-150">Use Ping.exe to verify network connectivity.</span></span> 
3.  <span data-ttu-id="12aa5-151">Debe tener certificados válidos para los nuevos servicios del conector.</span><span class="sxs-lookup"><span data-stu-id="12aa5-151">You must have valid certificates for the new Connector services.</span></span> <span data-ttu-id="12aa5-152">Estos certificados SSL deben emitirlos una entidad de certificación (CA) de confianza.</span><span class="sxs-lookup"><span data-stu-id="12aa5-152">These SSL certificates must be issued by a trusted certification authority (CA).</span></span> <span data-ttu-id="12aa5-153">No puede usar certificados autofirmados.</span><span class="sxs-lookup"><span data-stu-id="12aa5-153">You can't use self-signed certificates.</span></span> <span data-ttu-id="12aa5-154">Los certificados SSL deben ser de confianza en Azure Stack (específicamente la máquina virtual de AzS-WASP01) y en cualquier otro equipo que el inquilino pueda usar para acceder al portal de usuarios de Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-154">The SSL certificates must be trusted by Azure Stack (specifically the AzS-WASP01 VM) and any other computer that the tenant may use to access the Azure Stack user portal.</span></span>
 
    >[!NOTE]
    <span data-ttu-id="12aa5-155">Dado que AzS-WASP01 ejecuta Windows Server con la opción de instalación Server Core, puede usar una herramienta de línea de comandos, como Certutil.ext, para importar el certificado.</span><span class="sxs-lookup"><span data-stu-id="12aa5-155">Because AzS-WASP01 runs Windows Server with the Server Core installation option, you can use a command-line tool such as Certutil.ext to import the certificate.</span></span> <span data-ttu-id="12aa5-156">Por ejemplo, podría copiar el archivo .cer en c:\temp en AzS-WASP01 y luego ejecutar el comando **certutil -addstore "CA" "c:\temp\certname.cer"**.</span><span class="sxs-lookup"><span data-stu-id="12aa5-156">For example, you could copy the .cer file to c:\temp on AzS-WASP01, and then run the command **certutil -addstore "CA" "c:\temp\certname.cer"**.</span></span>

4.  <span data-ttu-id="12aa5-157">Para establecer la conectividad RDP para máquinas virtuales de inquilino de Windows Azure Pack a través del portal de Azure Stack, el entorno de Windows Azure Pack debe permitir el tráfico de Escritorio remoto a las máquinas virtuales de inquilino.</span><span class="sxs-lookup"><span data-stu-id="12aa5-157">To establish RDP connectivity to Windows Azure Pack tenant virtual machines through the Azure Stack portal, the Windows Azure Pack environment must allow Remote Desktop traffic to the tenant VMs.</span></span>
5.  <span data-ttu-id="12aa5-158">Para la conectividad entre máquinas virtuales de inquilino de Azure Stack y máquinas virtuales de inquilino de Windows Azure Pack, sus direcciones IP externas deben poder enrutarse a través de los dos entornos.</span><span class="sxs-lookup"><span data-stu-id="12aa5-158">For connectivity between Azure Stack tenant virtual machines and Windows Azure Pack tenant virtual machines, their external IP addresses must be routable across the two environments.</span></span> <span data-ttu-id="12aa5-159">Esta conectividad podría incluir también la asociación de un servidor DNS para resolver los nombres de las máquinas virtuales entre los entornos.</span><span class="sxs-lookup"><span data-stu-id="12aa5-159">This connectivity could also include associating a DNS server to resolve virtual machine names between the environments.</span></span>

### <a name="iis-requirements"></a><span data-ttu-id="12aa5-160">Requisitos de IIS</span><span class="sxs-lookup"><span data-stu-id="12aa5-160">IIS requirements</span></span>
<span data-ttu-id="12aa5-161">El equipo que hospeda el portal de inquilino de Windows Azure Pack (que puede ser un host físico, una máquina virtual o varias máquinas virtuales) debe tener instalada la extensión de IIS URL Rewrite.</span><span class="sxs-lookup"><span data-stu-id="12aa5-161">The computer that hosts the Windows Azure Pack tenant portal (which may be a physical host, a virtual machine, or multiple virtual machines) must have the URL Rewrite IIS extension installed.</span></span> <span data-ttu-id="12aa5-162">Si aún no está instalada, puede descargarla [aquí](https://www.iis.net/downloads/microsoft/url-rewrite).</span><span class="sxs-lookup"><span data-stu-id="12aa5-162">If it is not already installed, you can download it from [here](https://www.iis.net/downloads/microsoft/url-rewrite).</span></span> <span data-ttu-id="12aa5-163">Si varias máquinas virtuales hospedan el portal de inquilinos, instale la extensión en cada máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="12aa5-163">If multiple virtual machines host the tenant portal, install the extension on each virtual machine.</span></span>

## <a name="configure-azure-stack"></a><span data-ttu-id="12aa5-164">Configurar Azure Stack</span><span class="sxs-lookup"><span data-stu-id="12aa5-164">Configure Azure Stack</span></span>
<span data-ttu-id="12aa5-165">Antes de configurar el conector de Windows Azure Pack, debe habilitar el modo de varias nubes en el portal de usuarios de Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-165">Before you configure the Windows Azure Pack Connector, you must enable multi-cloud mode in the Azure Stack user portal.</span></span> <span data-ttu-id="12aa5-166">Este modo permite a los usuarios seleccionar la nube desde la que se accederá a los recursos.</span><span class="sxs-lookup"><span data-stu-id="12aa5-166">This mode enables users to select from which cloud to access resources.</span></span>

<span data-ttu-id="12aa5-167">Para habilitar el modo de varias nubes, debe ejecutar el script Add-AzurePackConnector.ps1 después de la implementación de Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-167">To enable multi-cloud mode, you must run the Add-AzurePackConnector.ps1 script after Azure Stack deployment.</span></span> <span data-ttu-id="12aa5-168">En la siguiente tabla se describen los parámetros del script.</span><span class="sxs-lookup"><span data-stu-id="12aa5-168">The following table describes the script parameters.</span></span>


|  <span data-ttu-id="12aa5-169">Parámetro</span><span class="sxs-lookup"><span data-stu-id="12aa5-169">Parameter</span></span> | <span data-ttu-id="12aa5-170">Description</span><span class="sxs-lookup"><span data-stu-id="12aa5-170">Description</span></span> | <span data-ttu-id="12aa5-171">Ejemplo</span><span class="sxs-lookup"><span data-stu-id="12aa5-171">Example</span></span> |   
| -------- | ------------- | ------- |  
| <span data-ttu-id="12aa5-172">AzurePackClouds</span><span class="sxs-lookup"><span data-stu-id="12aa5-172">AzurePackClouds</span></span> | <span data-ttu-id="12aa5-173">Los URI de los conectores de Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-173">URIs of the Windows Azure Pack Connectors.</span></span> <span data-ttu-id="12aa5-174">Estos URI deben corresponder a los portales de inquilinos de Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-174">These URIs should correspond to the Windows Azure Pack tenant portals.</span></span> | <span data-ttu-id="12aa5-175">@{CloudName = "AzurePack1"; CloudEndpoint = "https://waptenantportal1:40005"},@{CloudName = "AzurePack2"; CloudEndpoint = "https://waptenantportal2:40005"}</span><span class="sxs-lookup"><span data-stu-id="12aa5-175">@{CloudName = "AzurePack1"; CloudEndpoint = "https://waptenantportal1:40005"},@{CloudName = "AzurePack2"; CloudEndpoint = "https://waptenantportal2:40005"}</span></span><br><br>  <span data-ttu-id="12aa5-176">(De manera predeterminada, el valor del puerto es 40005).</span><span class="sxs-lookup"><span data-stu-id="12aa5-176">(By default, the port value is 40005.)</span></span> |  
| <span data-ttu-id="12aa5-177">AzureStackCloudName</span><span class="sxs-lookup"><span data-stu-id="12aa5-177">AzureStackCloudName</span></span> | <span data-ttu-id="12aa5-178">Etiqueta para representar la nube local de Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-178">Label to represent the local Azure Stack cloud.</span></span>| <span data-ttu-id="12aa5-179">"AzureStack"</span><span class="sxs-lookup"><span data-stu-id="12aa5-179">"AzureStack"</span></span> |
| <span data-ttu-id="12aa5-180">DisableMultiCloud</span><span class="sxs-lookup"><span data-stu-id="12aa5-180">DisableMultiCloud</span></span> | <span data-ttu-id="12aa5-181">Un conmutador para deshabilitar el modo de varias nubes.</span><span class="sxs-lookup"><span data-stu-id="12aa5-181">A switch to disable multi-cloud mode.</span></span>| <span data-ttu-id="12aa5-182">N/D</span><span class="sxs-lookup"><span data-stu-id="12aa5-182">N/A</span></span> |
| | |

<span data-ttu-id="12aa5-183">Puede ejecutar el script Add-AzurePackConnector.ps1 inmediatamente después de la implementación o más adelante.</span><span class="sxs-lookup"><span data-stu-id="12aa5-183">You can run the Add-AzurePackConnector.ps1 script immediately after deployment, or later.</span></span> <span data-ttu-id="12aa5-184">Para ejecutar el script inmediatamente después de la implementación, use la misma sesión de Windows PowerShell donde se completó la implementación de Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-184">To run the script immediately after deployment, use the same Windows PowerShell session where Azure Stack deployment completed.</span></span> <span data-ttu-id="12aa5-185">En caso contrario, puede abrir una nueva sesión de Windows PowerShell como administrador (con la cuenta azurestackadmin).</span><span class="sxs-lookup"><span data-stu-id="12aa5-185">Otherwise, you can open a new Windows PowerShell session as an administrator (signed in as the azurestackadmin account).</span></span>

1. <span data-ttu-id="12aa5-186">Ejecute el script Add-AzurePackConnector.ps1 mediante los comandos siguientes (con los valores específicos de su entorno).</span><span class="sxs-lookup"><span data-stu-id="12aa5-186">Run the Add-AzurePackConnector.ps1 script by using the following commands (with values specific to your environment).</span></span> <span data-ttu-id="12aa5-187">Tenga en cuenta que el script Add-AzurePackConnector le permite agregar más de un punto de conexión del conector de Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-187">Notice that the Add-AzurePackConnector script enables you to add more than one Windows Azure Pack Connector endpoint.</span></span>
 
 ```powershell
    $cred = New-Object System.Management.Automation.PSCredential("cloudadmin@azurestack.local", `
    (ConvertTo-SecureString -String "<password>" -AsPlainText -Force))
    $session = New-PSSession -ComputerName 'azs-ercs01' `
     -Credential $cred `
     -ConfigurationName PrivilegedEndpoint `
     -Authentication Credssp

    # Enable Multicloud
    Invoke-Command -Session $session -ScriptBlock { Add-AzurePackConnector -AzurePackClouds `
    @{CloudName = "AzurePack_1"; CloudEndpoint = "https://waptenantportal1:40005"},`
    @{CloudName = "AzurePack_2"; CloudEndpoint = "https://waptenantportal2:40005" } `
    -AzureStackCloudName "AzureStack" }

 ```
> [!NOTE]
> <span data-ttu-id="12aa5-188">En la compilación actual hay un problema por el que, una vez que finaliza el script Add-AzurePackConnector, permanece en un bucle de sondeo durante un largo período (varios minutos) hasta que termina.</span><span class="sxs-lookup"><span data-stu-id="12aa5-188">In the current build there is an issue where after the Add-AzurePackConnector script ends, it remains in a polling loop for an extended period of time (several minutes) until it ends.</span></span> <span data-ttu-id="12aa5-189">Una vez que aparezca el mensaje **VERBOSE: Step 'Configure Azure Pack Connector' status: 'Success'**, puede detener el script o esperar hasta que se detenga por sí solo.</span><span class="sxs-lookup"><span data-stu-id="12aa5-189">After you see the message **VERBOSE: Step 'Configure Azure Pack Connector' status: 'Success'**, you can stop the script or wait until it stops by itself.</span></span> <span data-ttu-id="12aa5-190">Esto no supone ninguna diferencia, ya que la configuración ya se habrá completado correctamente.</span><span class="sxs-lookup"><span data-stu-id="12aa5-190">It won’t make a difference because the configuration has already succeeded.</span></span>

2. <span data-ttu-id="12aa5-191">Tome nota de los archivos de salida que genera este script, uno para cada entorno de Windows Azure Pack especificado.</span><span class="sxs-lookup"><span data-stu-id="12aa5-191">Make note of the output files that are produced by this script, one for each Windows Azure Pack environment that you specified.</span></span> <span data-ttu-id="12aa5-192">Los archivos se encuentran en: \\\su1fileserver\SU1_Infrastructure_1\AzurePackConnectorOutput.</span><span class="sxs-lookup"><span data-stu-id="12aa5-192">The files are located at:  \\\su1fileserver\SU1_Infrastructure_1\AzurePackConnectorOutput.</span></span> <span data-ttu-id="12aa5-193">Estos archivos contienen la información necesaria para configurar los entornos de Windows Azure Pack de destino.</span><span class="sxs-lookup"><span data-stu-id="12aa5-193">These files contain the information that is required to configure the target Windows Azure Pack environments.</span></span> <span data-ttu-id="12aa5-194">Este archivo se pasa como un parámetro a un script más adelante en estas instrucciones.</span><span class="sxs-lookup"><span data-stu-id="12aa5-194">You pass this file as a parameter to a script later in these instructions.</span></span> <span data-ttu-id="12aa5-195">Este archivo contiene la siguiente información:</span><span class="sxs-lookup"><span data-stu-id="12aa5-195">This file contains the following information:</span></span>

    * <span data-ttu-id="12aa5-196">**AzurePackConnectorEndpoint**: contiene el punto de conexión al servicio del conector de Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-196">**AzurePackConnectorEndpoint**: Contains the endpoint to the Windows Azure Pack Connector service.</span></span>
    * <span data-ttu-id="12aa5-197">**AuthenticationIdentityProviderPartner** contiene el siguiente par de valores:</span><span class="sxs-lookup"><span data-stu-id="12aa5-197">**AuthenticationIdentityProviderPartner**: Contains the following value pair:</span></span>
        * <span data-ttu-id="12aa5-198">Certificado de firma de token de autenticación en la que debe confiar la API de inquilino de Windows Azure Pack para aceptar las llamadas de la extensión del portal de Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-198">Authentication Token signing certificate that the Windows Azure Pack Tenant API needs to trust to accept calls from the Azure Stack portal extension.</span></span>

        * <span data-ttu-id="12aa5-199">El dominio "kerberos" asociado con el certificado de firma.</span><span class="sxs-lookup"><span data-stu-id="12aa5-199">The "Realm" associated with the signing certificate.</span></span> <span data-ttu-id="12aa5-200">Por ejemplo: https://adfs.local.azurestack.global.external/adfs/c1d72562-534e-4aa5-92aa-d65df289a107/.</span><span class="sxs-lookup"><span data-stu-id="12aa5-200">For example: https://adfs.local.azurestack.global.external/adfs/c1d72562-534e-4aa5-92aa-d65df289a107/.</span></span>

3.  <span data-ttu-id="12aa5-201">Vaya a la carpeta que contiene los archivos de salida (\\su1fileserver\SU1_Infrastructure_1\AzurePackConnectorOutput) y copie los archivos en el equipo local.</span><span class="sxs-lookup"><span data-stu-id="12aa5-201">Browse to the folder that contains the output files (\\su1fileserver\SU1_Infrastructure_1\AzurePackConnectorOutput), and copy the files to your local computer.</span></span> <span data-ttu-id="12aa5-202">Los archivos tendrán un aspecto similar al siguiente: AzurePack-06-27-15-50.txt.</span><span class="sxs-lookup"><span data-stu-id="12aa5-202">The files will look similar to this: AzurePack-06-27-15-50.txt.</span></span>

4.  <span data-ttu-id="12aa5-203">Pruebe la configuración.</span><span class="sxs-lookup"><span data-stu-id="12aa5-203">Test the configuration.</span></span>

    <span data-ttu-id="12aa5-204">a.</span><span class="sxs-lookup"><span data-stu-id="12aa5-204">a.</span></span> <span data-ttu-id="12aa5-205">Abra el explorador e inicie sesión en el portal de usuarios de Azure Stack (https://portal.local.azurestack.external/).</span><span class="sxs-lookup"><span data-stu-id="12aa5-205">Open your browser and sign in to the Azure Stack user portal (https://portal.local.azurestack.external/).</span></span>
    
    <span data-ttu-id="12aa5-206">b.</span><span class="sxs-lookup"><span data-stu-id="12aa5-206">b.</span></span> <span data-ttu-id="12aa5-207">Después de iniciar sesión como inquilino y de que se cargue el portal, verá errores sobre la imposibilidad de capturar las suscripciones o extensiones de la nube de Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-207">After you sign in as a tenant and the portal loads, you'll see errors about not being able to fetch subscriptions or extensions from the Azure Pack cloud.</span></span> <span data-ttu-id="12aa5-208">Haga clic en **Aceptar** para cerrar estos mensajes.</span><span class="sxs-lookup"><span data-stu-id="12aa5-208">Click **OK** to close these messages.</span></span> <span data-ttu-id="12aa5-209">(Estos mensajes de error desaparecerán después de configurar Windows Azure Pack).</span><span class="sxs-lookup"><span data-stu-id="12aa5-209">(These error messages will go away after you configure Windows Azure Pack.)</span></span>

    <span data-ttu-id="12aa5-210">c.</span><span class="sxs-lookup"><span data-stu-id="12aa5-210">c.</span></span> <span data-ttu-id="12aa5-211">Observe la lista desplegable **Nube** situada en la esquina superior izquierda del portal.</span><span class="sxs-lookup"><span data-stu-id="12aa5-211">Notice the **Cloud** drop-down list in the upper-left corner of the portal.</span></span>

    ![Selector de nube en la interfaz de usuario de Azure Stack](media/azure-stack-manage-wap/image3.png)

## <a name="configure-windows-azure-pack"></a><span data-ttu-id="12aa5-213">Configurar Windows Azure Pack</span><span class="sxs-lookup"><span data-stu-id="12aa5-213">Configure Windows Azure Pack</span></span>
<span data-ttu-id="12aa5-214">Solo para esta versión preliminar del conector, Windows Azure Pack se debe configurar manualmente.</span><span class="sxs-lookup"><span data-stu-id="12aa5-214">For this Connector preview release only, Windows Azure Pack requires manual configuration.</span></span>

>[!IMPORTANT]
<span data-ttu-id="12aa5-215">Para esta versión preliminar, use el conector de Windows Azure Pack únicamente en entornos de prueba y no en implementaciones de producción.</span><span class="sxs-lookup"><span data-stu-id="12aa5-215">For this preview release, use the Windows Azure Pack Connector only in test environments, and not in production deployments.</span></span>

1.  <span data-ttu-id="12aa5-216">Instale los archivos MSI del conector en la máquina virtual del portal de inquilinos de Windows Azure Pack e instale los certificados.</span><span class="sxs-lookup"><span data-stu-id="12aa5-216">Install Connector MSI files on the Windows Azure Pack tenant portal virtual machine, and install certificates.</span></span> <span data-ttu-id="12aa5-217">(Si tiene varias máquinas virtuales del portal de inquilinos, debe completar este paso en cada máquina virtual).</span><span class="sxs-lookup"><span data-stu-id="12aa5-217">(If you have multiple tenant portal virtual machines, you must complete this step on each virtual machine.)</span></span>

    <span data-ttu-id="12aa5-218">a.</span><span class="sxs-lookup"><span data-stu-id="12aa5-218">a.</span></span> <span data-ttu-id="12aa5-219">En el Explorador de archivos, copie la carpeta **WAPConnector** (que descargó anteriormente) en una carpeta denominada **c:\temp** en la máquina virtual del portal de inquilinos.</span><span class="sxs-lookup"><span data-stu-id="12aa5-219">In File Explorer, copy the **WAPConnector** folder (what you downloaded earlier) to a folder named **c:\temp** in the tenant portal virtual machine.</span></span>

    <span data-ttu-id="12aa5-220">b.</span><span class="sxs-lookup"><span data-stu-id="12aa5-220">b.</span></span> <span data-ttu-id="12aa5-221">Abra una conexión de consola o RDP a la máquina virtual del portal de inquilinos.</span><span class="sxs-lookup"><span data-stu-id="12aa5-221">Open a Console or RDP connection to the tenant portal virtual machine.</span></span>

    <span data-ttu-id="12aa5-222">c.</span><span class="sxs-lookup"><span data-stu-id="12aa5-222">c.</span></span> <span data-ttu-id="12aa5-223">Cambie los directorios a **c:\temp\wapconnector\setup\scripts** y ejecute el script **Install-Connector.ps1** para instalar tres archivos MSI.</span><span class="sxs-lookup"><span data-stu-id="12aa5-223">Change directories to **c:\temp\wapconnector\setup\scripts**, and run the **Install-Connector.ps1** script to install three MSI files.</span></span> <span data-ttu-id="12aa5-224">No hay ningún parámetro obligatorio.</span><span class="sxs-lookup"><span data-stu-id="12aa5-224">No parameters are required.</span></span>

     ```powershell
    cd C:\temp\wapconnector\setup\scripts\

    .\Install-Connector.ps1
    ```
     <span data-ttu-id="12aa5-225">d.</span><span class="sxs-lookup"><span data-stu-id="12aa5-225">d.</span></span> <span data-ttu-id="12aa5-226">Cambie los directorios a **c:\inetpub** y compruebe que se hayan instalado los tres nuevos sitios:</span><span class="sxs-lookup"><span data-stu-id="12aa5-226">Change directories to **c:\inetpub** and verify that the three new sites are installed:</span></span>

       * <span data-ttu-id="12aa5-227">MgmtSvc-Connector</span><span class="sxs-lookup"><span data-stu-id="12aa5-227">MgmtSvc-Connector</span></span>

       * <span data-ttu-id="12aa5-228">MgmtSvc-ConnectorExtension</span><span class="sxs-lookup"><span data-stu-id="12aa5-228">MgmtSvc-ConnectorExtension</span></span>

       * <span data-ttu-id="12aa5-229">MgmtSvc-ConnectorController</span><span class="sxs-lookup"><span data-stu-id="12aa5-229">MgmtSvc-ConnectorController</span></span>

    <span data-ttu-id="12aa5-230">e.</span><span class="sxs-lookup"><span data-stu-id="12aa5-230">e.</span></span> <span data-ttu-id="12aa5-231">Desde la misma carpeta **c:\temp\wapconnector\setup\scripts**, ejecute el script **Configure-Certificates.ps1** para instalar los certificados.</span><span class="sxs-lookup"><span data-stu-id="12aa5-231">From the same **c:\temp\wapconnector\setup\scripts** folder, run the **Configure-Certificates.ps1** script to install certificates.</span></span> <span data-ttu-id="12aa5-232">De manera predeterminada, usará el mismo certificado que está disponible para el sitio del portal de inquilinos en Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-232">By default, it will use the same certificate that is available for the Tenant Portal site in Windows Azure Pack.</span></span> <span data-ttu-id="12aa5-233">Asegúrese de que se trata de un certificado válido (de confianza de la máquina virtual AzS-WASP01 de Azure Stack y de todos los equipos cliente que tienen acceso al portal de Azure Stack).</span><span class="sxs-lookup"><span data-stu-id="12aa5-233">Make sure this is a valid certificate (trusted by the Azure Stack AzS-WASP01 virtual machine and any client computer that accesses the Azure Stack portal).</span></span> <span data-ttu-id="12aa5-234">En caso contrario, no funcionará la comunicación.</span><span class="sxs-lookup"><span data-stu-id="12aa5-234">Otherwise, communication won’t work.</span></span> <span data-ttu-id="12aa5-235">(También se puede pasar explícitamente una huella digital del certificado como parámetro mediante el parámetro -Thumbprint).</span><span class="sxs-lookup"><span data-stu-id="12aa5-235">(Alternatively, you can explicitly pass a certificate thumbprint as a parameter by using the -Thumbprint parameter.)</span></span>

     ```powershell
        cd C:\temp\wapconnector\setup\scripts\

        .\Configure-Certificates.ps1
    ```

    <span data-ttu-id="12aa5-236">f.</span><span class="sxs-lookup"><span data-stu-id="12aa5-236">f.</span></span> <span data-ttu-id="12aa5-237">Para finalizar la configuración de estos tres servicios, ejecute el script **Configure-WapConnector.ps1** para actualizar los parámetros del archivo Web.config.</span><span class="sxs-lookup"><span data-stu-id="12aa5-237">To finish the configuration of these three services, run the **Configure-WapConnector.ps1** script to update the Web.config file parameters.</span></span>

    |  <span data-ttu-id="12aa5-238">Parámetro</span><span class="sxs-lookup"><span data-stu-id="12aa5-238">Parameter</span></span> | <span data-ttu-id="12aa5-239">Description</span><span class="sxs-lookup"><span data-stu-id="12aa5-239">Description</span></span> | <span data-ttu-id="12aa5-240">Ejemplo</span><span class="sxs-lookup"><span data-stu-id="12aa5-240">Example</span></span> |   
    | -------- | ------------- | ------- |  
    | <span data-ttu-id="12aa5-241">TenantPortalFQDN</span><span class="sxs-lookup"><span data-stu-id="12aa5-241">TenantPortalFQDN</span></span> | <span data-ttu-id="12aa5-242">FQDN del portal de inquilinos de Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-242">The Windows Azure Pack tenant portal FQDN.</span></span> | <span data-ttu-id="12aa5-243">tenant.contoso.com</span><span class="sxs-lookup"><span data-stu-id="12aa5-243">tenant.contoso.com</span></span> | 
    | <span data-ttu-id="12aa5-244">TenantAPIFQDN</span><span class="sxs-lookup"><span data-stu-id="12aa5-244">TenantAPIFQDN</span></span> | <span data-ttu-id="12aa5-245">FQDN de la API de inquilino de Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-245">The Windows Azure Pack Tenant API FQDN.</span></span> | <span data-ttu-id="12aa5-246">tenantapi.contoso.com</span><span class="sxs-lookup"><span data-stu-id="12aa5-246">tenantapi.contoso.com</span></span>  |
    | <span data-ttu-id="12aa5-247">AzureStackPortalFQDN</span><span class="sxs-lookup"><span data-stu-id="12aa5-247">AzureStackPortalFQDN</span></span> | <span data-ttu-id="12aa5-248">FQDN del portal de usuarios de Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-248">The Azure Stack user portal FQDN.</span></span> | <span data-ttu-id="12aa5-249">portal.local.azurestack.external</span><span class="sxs-lookup"><span data-stu-id="12aa5-249">portal.local.azurestack.external</span></span> |
    | | |
    
     ```powershell
    .\Configure-WapConnector.ps1 -TenantPortalFQDN "tenant.contoso.com" `
         -TenantAPIFQDN "tenantapi.contoso.com" `
         -AzureStackPortalFQDN "portal.local.azurestack.external"
    ```
    <span data-ttu-id="12aa5-250">g.</span><span class="sxs-lookup"><span data-stu-id="12aa5-250">g.</span></span> <span data-ttu-id="12aa5-251">Si tiene varias máquinas virtuales del portal de inquilinos, repita el paso 1 para cada una de ellas.</span><span class="sxs-lookup"><span data-stu-id="12aa5-251">If you have multiple tenant portal virtual machines, repeat step 1 for each of these virtual machines.</span></span>

2. <span data-ttu-id="12aa5-252">Instale el nuevo MSI de la API de inquilino en cada máquina virtual de la API de inquilino de Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-252">Install the new Tenant API MSI on each Windows Azure Pack Tenant API virtual machine.</span></span>

    <span data-ttu-id="12aa5-253">a.</span><span class="sxs-lookup"><span data-stu-id="12aa5-253">a.</span></span> <span data-ttu-id="12aa5-254">Si está usando un equilibrador de carga, quizás quiera marcar la máquina virtual como sin conexión.</span><span class="sxs-lookup"><span data-stu-id="12aa5-254">If a load balancer is in use, you may want to mark the virtual machine as offline.</span></span>

    <span data-ttu-id="12aa5-255">b.</span><span class="sxs-lookup"><span data-stu-id="12aa5-255">b.</span></span> <span data-ttu-id="12aa5-256">En el Explorador de archivos, copie la carpeta **WAPConnector** a una carpeta denominada **c:\temp** en cada máquina de la API de inquilino.</span><span class="sxs-lookup"><span data-stu-id="12aa5-256">In File Explorer, copy the **WAPConnector** folder to a folder named **c:\temp** on each Tenant API machine.</span></span>

    <span data-ttu-id="12aa5-257">c.</span><span class="sxs-lookup"><span data-stu-id="12aa5-257">c.</span></span> <span data-ttu-id="12aa5-258">Copie el archivo AzurePackConnectorOutput.txt que guardó anteriormente en **c:\temp\WAPConnector**.</span><span class="sxs-lookup"><span data-stu-id="12aa5-258">Copy the AzurePackConnectorOutput.txt file that you saved earlier, to **c:\temp\WAPConnector**.</span></span>

    <span data-ttu-id="12aa5-259">d.</span><span class="sxs-lookup"><span data-stu-id="12aa5-259">d.</span></span> <span data-ttu-id="12aa5-260">Abra una conexión de consola o RDP a la máquina virtual de la API de inquilino en la que copió los archivos.</span><span class="sxs-lookup"><span data-stu-id="12aa5-260">Open a Console or RDP connection to the Tenant API VM you copied the files to.</span></span>
    
    <span data-ttu-id="12aa5-261">e.</span><span class="sxs-lookup"><span data-stu-id="12aa5-261">e.</span></span> <span data-ttu-id="12aa5-262">Cambie los directorios a **c:\temp\wapconnector\setup\scripts** y ejecute **Update-TenantAPI.ps1**.</span><span class="sxs-lookup"><span data-stu-id="12aa5-262">Change directories to **c:\temp\wapconnector\setup\scripts**, and run **Update-TenantAPI.ps1**.</span></span> <span data-ttu-id="12aa5-263">Esta nueva versión de la API de inquilino de WAP contiene un cambio para permitir una relación de confianza no solo con el STS actual, sino también con la instancia de AD FS en Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-263">This new version of the WAP Tenant API contains a change to enable a trust relationship not only with the current STS, but also with the instance of AD FS in Azure Stack.</span></span>

     ```powershell
    cd C:\temp\wapconnector\setup\packages\

    .\Update-TenantAPI.ps1
    ```

    <span data-ttu-id="12aa5-264">f.</span><span class="sxs-lookup"><span data-stu-id="12aa5-264">f.</span></span>  <span data-ttu-id="12aa5-265">Repita el paso 2 en todas las demás máquinas virtuales que ejecuten la API de inquilino.</span><span class="sxs-lookup"><span data-stu-id="12aa5-265">Repeat step 2 on any other virtual machine running the Tenant API.</span></span>
3. <span data-ttu-id="12aa5-266">Desde **sola una**  de las máquinas virtuales de la API de inquilino, ejecute el script Configure-TrustAzureStack.ps1 para agregar una relación de confianza entre la API de inquilino y la instancia de AD FS en Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-266">From **only one** of the Tenant API VMs, run the Configure-TrustAzureStack.ps1 script to add a trust relationship between the Tenant API and the AD FS instance on Azure Stack.</span></span> <span data-ttu-id="12aa5-267">Debe usar una cuenta con acceso de administrador del sistema a la base de datos Microsoft.MgmtSvc.Store.</span><span class="sxs-lookup"><span data-stu-id="12aa5-267">You must use an account with sysadmin access to the Microsoft.MgmtSvc.Store database.</span></span> <span data-ttu-id="12aa5-268">Este script tiene los parámetros siguientes:</span><span class="sxs-lookup"><span data-stu-id="12aa5-268">This script has the following parameters:</span></span>

    | <span data-ttu-id="12aa5-269">Parámetro</span><span class="sxs-lookup"><span data-stu-id="12aa5-269">Parameter</span></span> | <span data-ttu-id="12aa5-270">Description</span><span class="sxs-lookup"><span data-stu-id="12aa5-270">Description</span></span> | <span data-ttu-id="12aa5-271">Ejemplo</span><span class="sxs-lookup"><span data-stu-id="12aa5-271">Example</span></span> |
    | --------- | ------------| ------- |
   | <span data-ttu-id="12aa5-272">SqlServer</span><span class="sxs-lookup"><span data-stu-id="12aa5-272">SqlServer</span></span> | <span data-ttu-id="12aa5-273">Nombre de la instancia de SQL Server que contiene la base de datos Microsoft.MgmtSvc.Store.</span><span class="sxs-lookup"><span data-stu-id="12aa5-273">The name of the SQL Server that contains the Microsoft.MgmtSvc.Store database.</span></span> <span data-ttu-id="12aa5-274">Este parámetro es obligatorio.</span><span class="sxs-lookup"><span data-stu-id="12aa5-274">This parameter is required.</span></span> | <span data-ttu-id="12aa5-275">SQLServer</span><span class="sxs-lookup"><span data-stu-id="12aa5-275">SQLServer</span></span> | 
   | <span data-ttu-id="12aa5-276">DataFile</span><span class="sxs-lookup"><span data-stu-id="12aa5-276">DataFile</span></span> | <span data-ttu-id="12aa5-277">Archivo de salida que se generó durante la configuración del modo de varias nubes de Azure Stack con anterioridad.</span><span class="sxs-lookup"><span data-stu-id="12aa5-277">The output file that was generated during the configuration of the Azure Stack multi-cloud mode earlier.</span></span> <span data-ttu-id="12aa5-278">Este parámetro es obligatorio.</span><span class="sxs-lookup"><span data-stu-id="12aa5-278">This parameter is required.</span></span> | <span data-ttu-id="12aa5-279">AzurePack-06-27-15-50.txt</span><span class="sxs-lookup"><span data-stu-id="12aa5-279">AzurePack-06-27-15-50.txt</span></span> | 
   | <span data-ttu-id="12aa5-280">PromptForSqlCredential</span><span class="sxs-lookup"><span data-stu-id="12aa5-280">PromptForSqlCredential</span></span> | <span data-ttu-id="12aa5-281">Indica que el script debe solicitarle de manera interactiva una credencial de autenticación de SQL que se utilizará al conectarse a la instancia de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="12aa5-281">Indicates that the script should prompt you interactively for a SQL Authentication credential to use when connecting to the SQL Server instance.</span></span> <span data-ttu-id="12aa5-282">La credencial proporcionada debe tener los permisos suficientes para desinstalar bases de datos y esquemas, así como para eliminar inicios de sesión de usuario.</span><span class="sxs-lookup"><span data-stu-id="12aa5-282">The given credential must have sufficient permissions to uninstall databases, schemas, and delete user logins.</span></span> <span data-ttu-id="12aa5-283">Si no se proporciona ninguno, el script supone que el contexto de usuario actual tiene acceso.</span><span class="sxs-lookup"><span data-stu-id="12aa5-283">If none is provided, the script assumes that current user context has access.</span></span> | <span data-ttu-id="12aa5-284">No se necesita ningún valor.</span><span class="sxs-lookup"><span data-stu-id="12aa5-284">No value is needed.</span></span> |
   |  |  |

    <span data-ttu-id="12aa5-285">Si no conoce la instancia de SQL Server que se debe usar, puede averiguarla.</span><span class="sxs-lookup"><span data-stu-id="12aa5-285">If you don't know the SQL Server to use, you can discover it.</span></span> <span data-ttu-id="12aa5-286">Conéctese al equipo de la API de inquilino, use el comando Unprotect-MgmtSvc para desproteger el archivo Web.config de la API de inquilino, y busque el nombre del servidor en la cadena de conexión.</span><span class="sxs-lookup"><span data-stu-id="12aa5-286">Connect to the Tenant API computer, use the Unprotect-MgmtSvc command to unprotect the Tenant API Web.config file, and look for the server name in the connection string.</span></span> <span data-ttu-id="12aa5-287">No olvide ejecutar Protect-MgmtSvc nuevamente para proteger el archivo Web.config de la API de inquilino.</span><span class="sxs-lookup"><span data-stu-id="12aa5-287">Remember to run Protect-MgmtSvc again to protect the Tenant API Web.config file.</span></span>

  ```powershell
  cd C:\temp\wapconnector\setup\scripts\

 .\Configure-TrustAzureStack.ps1 -SqlServer "SQLServer" `
       -DataFile "C:\temp\wapconnector\AzurePackConnectorOutput.txt"
  ```

## <a name="example"></a><span data-ttu-id="12aa5-288">Ejemplo</span><span class="sxs-lookup"><span data-stu-id="12aa5-288">Example</span></span>
<span data-ttu-id="12aa5-289">En el ejemplo siguiente se muestra una implementación completa del conector de Windows Azure Pack en una configuración de Azure Stack de nodo único y dos instalaciones rápidas de Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-289">The following example shows a complete Windows Azure Pack Connector deployment on a single-node Azure Stack configuration and two Windows Azure Pack Express installations.</span></span> <span data-ttu-id="12aa5-290">(Cada instalación rápida se encuentra en un único equipo, con los nombres de ejemplo *wapcomputer1* y *wapcomputer2*).</span><span class="sxs-lookup"><span data-stu-id="12aa5-290">(Each Express installation is on a single computer, with the example names *wapcomputer1* and*wapcomputer2*.)</span></span>

```powershell
# Run the following script on the Azure Stack host
$cred = New-Object System.Management.Automation.PSCredential("cloudadmin@azurestack.local",`
     (ConvertTo-SecureString -String "p@ssw0rd" -AsPlainText -Force))
$session = New-PSSession -ComputerName 'azs-ercs01' -Credential $cred `
     -ConfigurationName PrivilegedEndpoint -Authentication Credssp
 
# Enable Multicloud
invoke-command -Session $session -ScriptBlock { Add-AzurePackConnector -AzurePackClouds `
     @{CloudName = "AzurePack_1"; CloudEndpoint = "https://wapcomputer1.contoso.com:40005"},`
     @{CloudName = "AzurePack_2"; CloudEndpoint = "https://wapcomputer2.contoso.com:40005"}`
     -AzureStackCloudName "AzureStack" }  

```
<span data-ttu-id="12aa5-291">Descargue el archivo .exe desde el [Centro de descarga de Microsoft](https://aka.ms/wapconnectorazurestackdlc), extráigalo y copie la carpeta WAPConnector a una carpeta **c:\temp** en el equipo de Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-291">Download the .exe file from the [Microsoft Download Center](https://aka.ms/wapconnectorazurestackdlc), extract it, and copy the WAPConnector folder to a **c:\temp** folder on the Windows Azure Pack computer.</span></span> <span data-ttu-id="12aa5-292">Copie los archivos que se generaron como salida en el script anterior (ubicado en \\\su1fileserver\SU1_Infrastructure_1\AzurePackConnectorOutput) a la carpeta **c:\temp\WAPConnector**.</span><span class="sxs-lookup"><span data-stu-id="12aa5-292">Copy the files that were generated as output in the previous script (located at \\\su1fileserver\SU1_Infrastructure_1\AzurePackConnectorOutput) to the **c:\temp\WAPConnector** folder.</span></span> <span data-ttu-id="12aa5-293">(Los archivos tendrán un aspecto similar al siguiente: AzurePack-06-27-15-50.txt). A continuación, ejecute el siguiente script, una vez por instancia de Windows Azure Pack:</span><span class="sxs-lookup"><span data-stu-id="12aa5-293">(The files will looks similar to this: AzurePack-06-27-15-50.txt.) Then, run the following script, once per instance of Windows Azure Pack:</span></span>

 ```powershell
# Install Connector components
cd C:\temp\WAPConnector\Setup\Scripts
.\Install-Connector.ps1

# Configure Certificates for the new Connector services
.\Configure-Certificates.ps1

# Configure the Connector services
.\Configure-WapConnector.ps1 -TenantPortalFQDN "wapcomputer1.contoso.com" `
     -TenantAPIFQDN "wapcomputer1.contoso.com" `
     -AzureStackPortalFQDN "portal.local.azurestack.external"

# Install the updated TenantAPI
.\Update-TenantAPI.ps1

# Establish trust with the Azure Stack AD FS
.\Configure-TrustAzureStack.ps1 -SqlServer "wapcomputer1" `
     -DataFile "C:\temp\wapconnector\AzurePack-06-27-15-50.txt" 

```
## <a name="troubleshooting-tips"></a><span data-ttu-id="12aa5-294">Sugerencias de solución de problemas</span><span class="sxs-lookup"><span data-stu-id="12aa5-294">Troubleshooting tips</span></span>
1.  <span data-ttu-id="12aa5-295">Asegúrese de que haya conectividad de red entre Azure Stack y Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-295">Ensure there is network connectivity between Azure Stack and Windows Azure Pack.</span></span> <span data-ttu-id="12aa5-296">Esta conectividad debe ser entre cualquier equipo de inquilino que tenga acceso al portal de Azure Stack y la máquina virtual del portal de inquilinos de Windows Azure Pack donde se ejecutan los nuevos servicios del conector.</span><span class="sxs-lookup"><span data-stu-id="12aa5-296">This connectivity should be between any tenant computer that accesses the Azure Stack portal and the Windows Azure Pack tenant portal virtual machine where the new Connector services are running.</span></span>
2.  <span data-ttu-id="12aa5-297">Asegúrese de que todos los FQDN especificados sean correctos.</span><span class="sxs-lookup"><span data-stu-id="12aa5-297">Ensure that all specified FQDNs are correct.</span></span>
3.  <span data-ttu-id="12aa5-298">Asegúrese de que los certificados SSL usados en los nuevos servicios del conector sean de confianza de Azure Stack (específicamente la máquina virtual AzS-WASP01) y de cualquier otro equipo que el inquilino pueda usar para acceder al portal de usuarios de Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="12aa5-298">Ensure that the SSL certificates used in the new Connector services are trusted by Azure Stack (specifically the AzS-WASP01 VM) and any other computer the tenant may use to access the Azure Stack user portal.</span></span>
4. <span data-ttu-id="12aa5-299">Para revisar los problemas conocidos, vea [Microsoft Azure Stack troubleshooting](azure-stack-troubleshooting.md) (Solución de problemas de Microsoft Azure Stack).</span><span class="sxs-lookup"><span data-stu-id="12aa5-299">For known issues, see [Microsoft Azure Stack troubleshooting](azure-stack-troubleshooting.md).</span></span>


## <a name="next-steps"></a><span data-ttu-id="12aa5-300">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="12aa5-300">Next steps</span></span>
[<span data-ttu-id="12aa5-301">Usar los portales de administración y de usuarios en Azure Stack</span><span class="sxs-lookup"><span data-stu-id="12aa5-301">Using the administrator and user portals in Azure Stack</span></span>](azure-stack-manage-portals.md)

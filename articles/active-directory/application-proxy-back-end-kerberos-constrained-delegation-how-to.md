---
title: "aaaHow tooconfigure una toouse de aplicación de Proxy de aplicación delegación limitada de Kerberos | Documentos de Microsoft"
description: "¿Cómo tooconfigure delegación limitada de Kerberos para una aplicación de Proxy de aplicación de Azure AD."
services: active-directory
documentationcenter: 
author: ajamess
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/11/2017
ms.author: asteen
ms.openlocfilehash: 93dac264ff1d3b99dead1d9c759c37c59373cbd4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="how-tooconfigure-an-application-proxy-application-toouse-kerberos-constrained-delegation"></a><span data-ttu-id="65566-103">¿Cómo tooconfigure una toouse de aplicación de Proxy de aplicación delegación limitada de Kerberos</span><span class="sxs-lookup"><span data-stu-id="65566-103">How tooconfigure an Application Proxy application toouse Kerberos Constrained Delegation</span></span>

<span data-ttu-id="65566-104">Hola métodos disponibles para lograr toopublished SSO las aplicaciones pueden variar un poco de tooapplication de aplicación y una de las opciones de Hola que el Proxy de aplicación de Azure ofrece desde el principio de hello, es la delegación limitada de Kerberos (KCD).</span><span class="sxs-lookup"><span data-stu-id="65566-104">hello methods available for achieving SSO toopublished applications can somewhat vary from application tooapplication and one of hello options that Azure Application Proxy offers right out of hello box, is Kerberos Constrained Delegation (KCD).</span></span> <span data-ttu-id="65566-105">Esto es que un host de conector configurado tooperform limitada kerberos authentication toobackend aplicaciones, en nombre de los usuarios.</span><span class="sxs-lookup"><span data-stu-id="65566-105">This is where a connector host is configured tooperform constrained kerberos authentication toobackend applications, on behalf of users.</span></span>

<span data-ttu-id="65566-106">procedimiento de Hello en Sí para habilitar KCD es relativamente sencillo y no requiere normalmente más de una descripción general del programa Hola a varios componentes y flujo de autenticación que facilita SSO.</span><span class="sxs-lookup"><span data-stu-id="65566-106">hello actual procedure for enabling KCD is relatively straightforward and typically requires no more than a general understanding of hello various components and authentication flow that facilitates SSO.</span></span> <span data-ttu-id="65566-107">Encontrar buenas fuentes de información toohelp solucionar problemas de escenarios donde KCD SSO no funcione según lo previsto, puede ser dispersas.</span><span class="sxs-lookup"><span data-stu-id="65566-107">Finding good sources of information toohelp troubleshoot scenarios where KCD SSO doesn’t function as expected, can be sparse.</span></span>

<span data-ttu-id="65566-108">Por lo tanto, este artículo intenta tooprovide un único punto de referencia que debe ayudar a solucionar problemas y corregir automáticamente algunos de los problemas más comunes de Hola que vemos.</span><span class="sxs-lookup"><span data-stu-id="65566-108">As such, this article attempts tooprovide a single point of reference that should help troubleshoot and self-remediate some of hello most common issues that we see.</span></span> <span data-ttu-id="65566-109">En hello mismas instrucciones adicionales de oferta de tiempo para diagnosticar Hola más compleja y con problemas de implementación.</span><span class="sxs-lookup"><span data-stu-id="65566-109">At hello same time offer additional guidance for diagnosing hello more complex and troubled of implementation.</span></span>

<span data-ttu-id="65566-110">Tenga en cuenta que este artículo hace Hola siguientes supuestos:</span><span class="sxs-lookup"><span data-stu-id="65566-110">note that this article makes hello following assumptions:</span></span>

-   <span data-ttu-id="65566-111">Proxy de aplicación de Azure se ha implementado según nuestro [documentación](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-enable) y las aplicaciones de acceso general toonon KCD funciona según lo previsto.</span><span class="sxs-lookup"><span data-stu-id="65566-111">Azure Application Proxy has been deployed as per our [documentation](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-enable) and general access toonon KCD applications is working as expected.</span></span>

-   <span data-ttu-id="65566-112">Hello destino publicado aplicación se basa en la implementación de IIS y de Microsoft de kerberos.</span><span class="sxs-lookup"><span data-stu-id="65566-112">hello published target application is based on IIS and Microsoft’s implementation of kerberos.</span></span>

-   <span data-ttu-id="65566-113">hosts de servidor y una aplicación Hola residen en un único dominio de Active Directory.</span><span class="sxs-lookup"><span data-stu-id="65566-113">hello server and application hosts reside in a single Active Directory domain.</span></span> <span data-ttu-id="65566-114">Encontrará información detallada sobre los escenarios de bosque y entre dominios en nuestras [notas del producto para KCD](http://aka.ms/KCDPaper).</span><span class="sxs-lookup"><span data-stu-id="65566-114">Detailed information on cross domain and forest scenarios can be found in our [KCD whitepaper](http://aka.ms/KCDPaper).</span></span>

-   <span data-ttu-id="65566-115">Hello aplicación en cuestión se publica en un Azure inquilino con autenticación previa está habilitada y los usuarios se esperan autenticación basada en tooauthenticate tooAzure a través de formularios.</span><span class="sxs-lookup"><span data-stu-id="65566-115">hello subject application is published in an Azure tenant with pre-authentication enabled, and users are expected tooauthenticate tooAzure via forms based authentication.</span></span> <span data-ttu-id="65566-116">Escenarios de autenticación de cliente enriquecido no están cubiertos por este artículo, pero agregará en algún momento futuro Hola.</span><span class="sxs-lookup"><span data-stu-id="65566-116">Rich client authentication scenarios are not covered by this article, but be added at some point in hello future.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="65566-117">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="65566-117">Prerequisites</span></span>

<span data-ttu-id="65566-118">Proxy de aplicación de Azure se pueden implementar en prácticamente cualquier tipo de infraestructura o arquitecturas hello y entorno sin duda varían con respecto a tooorganization de organización.</span><span class="sxs-lookup"><span data-stu-id="65566-118">Azure Application Proxy can be deployed into pretty much any type of infrastructure or environment and hello architectures no doubt vary from organization tooorganization.</span></span> <span data-ttu-id="65566-119">Uno de los motivos más comunes de Hola de KCD relacionados con problemas no son entornos Hola por sí mismos, pero bastante sencillas configuraciones mal o supervisión general.</span><span class="sxs-lookup"><span data-stu-id="65566-119">One of hello most common causes of KCD related issues are not hello environments themselves, but rather simple mis-configurations, or general oversight.</span></span>

<span data-ttu-id="65566-120">Por esta razón, nuestro Consejo es siempre toostart asegurándose de que se cumplen todos los requisitos previos de hello dispuestos en nuestro main [mediante KCD SSO con el artículo de Proxy de aplicación Hola](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd) antes de iniciar solución de problemas.</span><span class="sxs-lookup"><span data-stu-id="65566-120">For this reason, our advice is always toostart by making sure you have met all hello pre-requisites laid out in our main [Using KCD SSO with hello Application Proxy article](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd) before starting troubleshooting.</span></span>

<span data-ttu-id="65566-121">Sección sobre la configuración de KCD en 2012R2, tal y como se emplea un enfoque diferente tooconfiguring KCD en versiones anteriores de Windows, sino también al que se va a prestar atención a varias otras consideraciones se Hola especialmente:</span><span class="sxs-lookup"><span data-stu-id="65566-121">Particularly hello section on configuring KCD on 2012R2, as this employs a fundamentally different approach tooconfiguring KCD on previous versions of Windows, but also while being mindful of several other considerations:</span></span>

-   <span data-ttu-id="65566-122">No es raro que un servidor de miembro dominio tooopen un cuadro de diálogo de canal seguro con un controlador de dominio específico.</span><span class="sxs-lookup"><span data-stu-id="65566-122">It is not uncommon for a domain member server tooopen a secure channel dialog with a specific domain controller.</span></span> <span data-ttu-id="65566-123">A continuación, mueva tooanother diálogo en cualquier momento, para que hosts de conector generalmente no deben estar restringido toobeing toocommunicate capaz de controladores de dominio del sitio local solo específico.</span><span class="sxs-lookup"><span data-stu-id="65566-123">Then move tooanother dialog at any given time, so connector hosts should generally not be restricted toobeing able toocommunicate with only specific local site DCs.</span></span>

-   <span data-ttu-id="65566-124">Toohello similar por encima de punto, escenarios entre dominios se basan en las referencias a la que dirigir un tooDCs de host de conector que pueden residir fuera de perímetro de la red local de Hola.</span><span class="sxs-lookup"><span data-stu-id="65566-124">Similar toohello above point, cross domain scenarios rely on referrals that direct a connector host tooDCs that may reside outside of hello local network perimeter.</span></span> <span data-ttu-id="65566-125">En este escenario es igualmente importante toomake seguro también va a permitir tráfico en adelante tooDCs que representan otros dominios respectivos, o bien delegación producirá un error.</span><span class="sxs-lookup"><span data-stu-id="65566-125">In this scenario it is equally important toomake sure you are also allowing traffic onwards tooDCs that represent other respective domains, or else delegation fail.</span></span>

-   <span data-ttu-id="65566-126">Siempre que sea posible, debe evitar colocar dispositivos IPS/IDS activos entre los hosts de conector y los controladores de dominio, ya que en ocasiones son demasiado intrusivos e interfieren con el tráfico RPC central.</span><span class="sxs-lookup"><span data-stu-id="65566-126">Where possible, you should avoid placing any active IPS/IDS devices between connector hosts and DCs, as these are sometimes over intrusive and interfere with core RPC traffic</span></span>

<span data-ttu-id="65566-127">Nos gustaría tooresolve problemas rápidamente y de hecho, puede tardar tiempo, por lo que siempre que sea posible debe intente y probar la delegación en hello más sencilla de escenarios.</span><span class="sxs-lookup"><span data-stu-id="65566-127">As much as we’d like tooresolve issues quickly and effectively, it can take time, so where possible you should try and test delegation in hello simplest of scenarios.</span></span> <span data-ttu-id="65566-128">Hola más variables que se va a introducir, hello más tendrá toocontend con.</span><span class="sxs-lookup"><span data-stu-id="65566-128">hello more variables you introduce, hello more you may have toocontend with.</span></span> <span data-ttu-id="65566-129">Por ejemplo, limitar el prueba tooa único conector puede ahorrar tiempo valioso y conectores adicionales pueden agregarse una vez resueltos los problemas de Hola.</span><span class="sxs-lookup"><span data-stu-id="65566-129">For example, limiting your testing tooa single connector can save valuable time, and additional connectors can be added after hello issues has been resolved.</span></span>

<span data-ttu-id="65566-130">Algunos factores del entorno podrían también estar contribuyendo tooan problema, por lo que si es posible intente y minimizar Hola arquitectura tooa mínimo para realizar pruebas.</span><span class="sxs-lookup"><span data-stu-id="65566-130">Some environmental factors may also be contributing tooan issue, so again if possible try and minimize hello architecture tooa bare minimum for testing.</span></span> <span data-ttu-id="65566-131">Por ejemplo, el firewall interno mal configurada ACL no son habituales, por lo que si es posible tener todo el tráfico de un conector permite directamente a través de los controladores de dominio de toohello y aplicación back-end.</span><span class="sxs-lookup"><span data-stu-id="65566-131">For example, misconfigured internal firewall ACLs are not uncommon, so if possible have all traffic from a connector allowed straight through toohello DCs and backend application.</span></span> 

<span data-ttu-id="65566-132">En realidad Hola absoluta mejor lugar tooposition conectores es tan cerca de tootheir de destinos, como puede ser.</span><span class="sxs-lookup"><span data-stu-id="65566-132">Actually hello absolute best place tooposition connectors is as close tootheir targets as can be.</span></span> <span data-ttu-id="65566-133">Tener un firewall en línea durante las pruebas simplemente agrega complejidad innecesaria y podría prolongarlas.</span><span class="sxs-lookup"><span data-stu-id="65566-133">Having a firewall sat inline whilst testing simply adds unnecessary complexity, and could just prolong your investigations.</span></span>

<span data-ttu-id="65566-134">De todos modos, ¿qué constituye un problema de KCD?</span><span class="sxs-lookup"><span data-stu-id="65566-134">So, what constitutes a KCD problem anyway?</span></span> <span data-ttu-id="65566-135">Bueno, hay varias indicaciones clásicas de SSO de KCD hello y error primeros síntomas de un problema normalmente se manifiestan en Hola explorador.</span><span class="sxs-lookup"><span data-stu-id="65566-135">Well, there several classic indications of KCD SSO failing and hello first signs of an issue usually manifest themselves in hello browser.</span></span>

   ![Error de configuración de KCD incorrecta](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic1.png)

   ![Error debido a permisos toomissing de autorización](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic2.png)

<span data-ttu-id="65566-138">todos los que lleven Hola mismo síntoma del error tooperform SSO y, por consiguiente, denegar Hola aplicación toohello de acceso de usuario.</span><span class="sxs-lookup"><span data-stu-id="65566-138">all which bear hello same symptom of failing tooperform SSO, and consequently denying hello user access toohello application.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="65566-139">Solución de problemas</span><span class="sxs-lookup"><span data-stu-id="65566-139">Troubleshooting</span></span>

<span data-ttu-id="65566-140">Cómo solucionar, a continuación, dependen de problema de Hola y observa síntomas.</span><span class="sxs-lookup"><span data-stu-id="65566-140">How you then troubleshoot depend on hello issue and observed symptoms.</span></span> <span data-ttu-id="65566-141">Antes de pasar cualquier más se indicaría Hola siguientes vínculos, ya que contienen información útil que no ha incluido en:</span><span class="sxs-lookup"><span data-stu-id="65566-141">Before going any further we would suggest hello following links, as they contain useful information you may not yet have come across:</span></span>

-   [<span data-ttu-id="65566-142">Solución de problemas y mensajes de error de Proxy de aplicación</span><span class="sxs-lookup"><span data-stu-id="65566-142">Troubleshoot Application Proxy problems and error messages</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-troubleshoot)

-   [<span data-ttu-id="65566-143">Errores y síntomas de Kerberos</span><span class="sxs-lookup"><span data-stu-id="65566-143">Kerberos errors and symptoms</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-troubleshoot#kerberos-errors)

-   [<span data-ttu-id="65566-144">Trabajar con SSO cuando las identidades locales y en la nube no son idénticas</span><span class="sxs-lookup"><span data-stu-id="65566-144">Working with SSO when on-premises and cloud identities are not identical</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd#working-with-sso-when-on-premises-and-cloud-identities-are-not-identical)

<span data-ttu-id="65566-145">Si tiene este extremo, a continuación, hello principal problema definitivamente existe.</span><span class="sxs-lookup"><span data-stu-id="65566-145">If you’ve got this far, then hello main issue definitely exists.</span></span> <span data-ttu-id="65566-146">Necesita toodig más profundo, por lo que se inicie mediante la separación de flujo de hello en tres fases distintas que puede solucionar.</span><span class="sxs-lookup"><span data-stu-id="65566-146">You need toodig deeper, so start by separating hello flow into three distinct stages that you can troubleshoot.</span></span>

<span data-ttu-id="65566-147">**Autenticación previa del cliente** -usuario externo Hola autenticar tooAzure a través de un explorador.</span><span class="sxs-lookup"><span data-stu-id="65566-147">**Client pre-authentication** - hello external user authenticating tooAzure via a browser.</span></span>

<span data-ttu-id="65566-148">Que se va a toopre pueda-autenticar tooAzure es imprescindible toofunction KCD SSO.</span><span class="sxs-lookup"><span data-stu-id="65566-148">Being able toopre-authenticate tooAzure is imperative for KCD SSO toofunction.</span></span> <span data-ttu-id="65566-149">Esto es lo primero que se debe probar y solucionar, si hay algún problema.</span><span class="sxs-lookup"><span data-stu-id="65566-149">This should be tested and addressed first, if there are any issues.</span></span> <span data-ttu-id="65566-150">Tenga en cuenta que fase de autenticación previa de hello no tiene ninguna relación tooKCD o hello publicó la aplicación.</span><span class="sxs-lookup"><span data-stu-id="65566-150">Note that hello pre-authentication stage has no relation tooKCD or hello published application.</span></span> <span data-ttu-id="65566-151">Debería ser bastante fácil toocorrect cualquier discrepancia por integridad comprobando Hola sujeto cuenta existe en Azure y que no está deshabilitado o bloquean.</span><span class="sxs-lookup"><span data-stu-id="65566-151">It should be fairly easy toocorrect any discrepancies by sanity checking hello subject account exists in Azure, and that it is not disabled/blocked.</span></span> <span data-ttu-id="65566-152">respuesta de error de Hello en el Explorador de hello es normalmente lo suficientemente descriptivo toounderstand Hola.</span><span class="sxs-lookup"><span data-stu-id="65566-152">hello error response in hello browser is usually descriptive enough toounderstand hello cause.</span></span> <span data-ttu-id="65566-153">También puede comprobar nuestro otro tooverify de documentos de solución de problemas si no es seguro.</span><span class="sxs-lookup"><span data-stu-id="65566-153">You can also check our other Troubleshoot docs tooverify if you aren’t sure.</span></span>

<span data-ttu-id="65566-154">**Servicio de delegación** -Hola conector del Proxy de Azure de obtener un kerberos vale de servicio desde un KDC (centro de distribución de Kerberos), en nombre de los usuarios.</span><span class="sxs-lookup"><span data-stu-id="65566-154">**Delegation service** - hello Azure Proxy connector obtaining a kerberos service ticket from a KDC (Kerberos Distribution Center), on behalf of users.</span></span>

<span data-ttu-id="65566-155">Hola las comunicaciones externas entre el cliente de Hola y Hola Azure front-end no tienen ninguna relación en KCD sea, distinto de asegurarse de que funciona.</span><span class="sxs-lookup"><span data-stu-id="65566-155">hello external communications between hello client and hello Azure front end should have no bearing on KCD whatsoever, other than ensuring that it works.</span></span> <span data-ttu-id="65566-156">Se trata de modo que pueda validarse Hola servicio Proxy de Azure siempre con un Id. de usuario se va a tooobtain usa un vale de kerberos.</span><span class="sxs-lookup"><span data-stu-id="65566-156">This is so hello Azure Proxy service can be provided with a valid user ID that be used tooobtain a kerberos ticket.</span></span> <span data-ttu-id="65566-157">Sin este KCD, no es posible y se produciría un error.</span><span class="sxs-lookup"><span data-stu-id="65566-157">Without this KCD is not possible and would fail.</span></span>

<span data-ttu-id="65566-158">Tal y como se mencionó anteriormente, mensajes de error del explorador de Hola suelen proporcionan algunos buenos pistas sobre por qué se producen errores en acciones.</span><span class="sxs-lookup"><span data-stu-id="65566-158">As mentioned previously, hello browser error messages usually provide some good clues on why things are failing.</span></span> <span data-ttu-id="65566-159">Que seguro toonote hacia abajo el Id. de actividad de Hola y marca de tiempo de respuesta de hello como esto permitirá eventos tooactual de toocorrelate Hola comportamiento en el registro de eventos de Proxy de Azure de Hola.</span><span class="sxs-lookup"><span data-stu-id="65566-159">Make sure toonote down hello activity ID and timestamp in hello response as this allow you toocorrelate hello behavior tooactual events in hello Azure Proxy event log.</span></span>

   ![Error de configuración de KCD incorrecta](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic3.png)

<span data-ttu-id="65566-161">Y registro de eventos de las entradas correspondientes de Hola Hola encontrada podría verse como eventos 13019 o 12027.</span><span class="sxs-lookup"><span data-stu-id="65566-161">And hello corresponding entries seen hello event log would be seen as events 13019 or 12027.</span></span> <span data-ttu-id="65566-162">Puede encontrar registros de eventos del conector en hello **registros de aplicaciones y servicios** &gt; **Microsoft** &gt; **AadApplicationProxy** &gt; **Conector**&gt;**administración**.</span><span class="sxs-lookup"><span data-stu-id="65566-162">You can find hello connector event logs in **Applications and Services Logs** &gt; **Microsoft** &gt; **AadApplicationProxy** &gt; **Connector**&gt;**Admin**.</span></span>

   ![Evento 13019 del registro de eventos del proxy de aplicación](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic4.png)

   ![Evento 12027 del registro de eventos del proxy de aplicación](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic5.png)

-   <span data-ttu-id="65566-165">Usar un registro en su DNS interno para la dirección de la aplicación hello y no un CName</span><span class="sxs-lookup"><span data-stu-id="65566-165">Use an A record in your internal DNS for hello application’s address, and not a CName</span></span>

-   <span data-ttu-id="65566-166">Vuelvan a confirmar que hospedan de conector Hola concedió Hola derechos toodelegate toohello designado SPN de la cuenta de destino y que **usar cualquier protocolo de autenticación** está seleccionada.</span><span class="sxs-lookup"><span data-stu-id="65566-166">Re-confirm that hello connector host has been granted hello rights toodelegate toohello designated target account’s SPN, and that **Use any authentication protocol** is selected.</span></span> <span data-ttu-id="65566-167">Esto se trata en el artículo principal [sobre la configuración del SSO](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd).</span><span class="sxs-lookup"><span data-stu-id="65566-167">This is covered in our main [SSO configuration article](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd)</span></span>

-   <span data-ttu-id="65566-168">Compruebe que hay una sola instancia de hello SPN existente en AD mediante la emisión de un **setspn - x** desde un símbolo del sistema en cualquier host de miembro de dominio</span><span class="sxs-lookup"><span data-stu-id="65566-168">Verify that there is only a single instance of hello SPN in existence in AD by issuing a **setspn -x** from a cmd prompt on any domain member host</span></span>

-   <span data-ttu-id="65566-169">Comprobar toosee si se está configurando una directiva de dominio exige hello toolimit [tamaño máximo de tokens de kerberos emitido](https://blogs.technet.microsoft.com/askds/2012/09/12/maxtokensize-and-windows-8-and-windows-server-2012/), ya que este conector de hello impedir obtengan un token si encontró toobe excesivo</span><span class="sxs-lookup"><span data-stu-id="65566-169">Check toosee if a domain policy is being enforced toolimit hello [max size of issued kerberos tokens](https://blogs.technet.microsoft.com/askds/2012/09/12/maxtokensize-and-windows-8-and-windows-server-2012/), as this prevent hello connector from obtaining a token if found toobe excessive</span></span>

<span data-ttu-id="65566-170">Un seguimiento de red capturar intercambios de hello entre el host de conector de Hola y un dominio KDC, a continuación, sería el siguiente paso recomendado hello en la obtención de más bajo nivel obtener detalles sobre problemas de Hola.</span><span class="sxs-lookup"><span data-stu-id="65566-170">A network trace capturing hello exchanges between hello connector host and a domain KDC would then be hello next best step in obtaining more low level detail on hello issues.</span></span> <span data-ttu-id="65566-171">Puede encontrarlo en el [artículo que profundiza en la solución de problemas](https://aka.ms/proxytshootpaper).</span><span class="sxs-lookup"><span data-stu-id="65566-171">You can find this in [deep dive Troubleshoot paper](https://aka.ms/proxytshootpaper).</span></span>

<span data-ttu-id="65566-172">Si compra de vales aspecto atractivo, debería ver un evento en los registros de Hola que indica que la autenticación no se pudo debido aplicación toohello devuelve 401.</span><span class="sxs-lookup"><span data-stu-id="65566-172">If ticketing looks good, you should see an event in hello logs stating that authentication failed due toohello application returning a 401.</span></span> <span data-ttu-id="65566-173">Esto suele indicar que esa aplicación de destino de hello rechazando el vale, por lo que continúe con hello después de la siguiente fase.</span><span class="sxs-lookup"><span data-stu-id="65566-173">This typically indicates that hello target application rejecting your ticket, so proceed with hello following next stage.</span></span>

<span data-ttu-id="65566-174">**La aplicación de destino** -consumidor Hola de vale de kerberos de hello proporcionada por el conector de Hola</span><span class="sxs-lookup"><span data-stu-id="65566-174">**Target application** - hello consumer of hello kerberos ticket provided by hello connector</span></span>

<span data-ttu-id="65566-175">En este conector de hello fase ¿toohave esperado se envía un backend toohello de vale de servicio de kerberos, como un encabezado dentro de la primera solicitud de aplicación Hola.</span><span class="sxs-lookup"><span data-stu-id="65566-175">At this stage hello connector is expected toohave sent a kerberos service ticket toohello backend, as a header within hello first application request.</span></span>

-   <span data-ttu-id="65566-176">Mediante la aplicación hello URL interna definido en el portal de hello, validar que la aplicación hello es accesible directamente desde el Explorador de hello en el host de conector de Hola.</span><span class="sxs-lookup"><span data-stu-id="65566-176">Using hello application’s internal URL defined in hello portal, validate that hello application is accessible directly from hello browser on hello connector host.</span></span> <span data-ttu-id="65566-177">Entonces, puede iniciar sesión correctamente.</span><span class="sxs-lookup"><span data-stu-id="65566-177">Then you can login successfully.</span></span> <span data-ttu-id="65566-178">Encontrará detalles sobre cómo hacer esto en la página de solución de problemas del conector de Hola.</span><span class="sxs-lookup"><span data-stu-id="65566-178">Details on doing this can be found on hello connector Troubleshoot page.</span></span>

-   <span data-ttu-id="65566-179">Todavía en el host de conector de hello, confirme que la autenticación entre el Explorador de Hola Hola y aplicación hello está utilizando kerberos, llevando a cabo una de las siguientes de hello:</span><span class="sxs-lookup"><span data-stu-id="65566-179">Still on hello connector host, confirm that hello authentication between hello browser and hello application is using kerberos, by doing one of hello following:</span></span>

1.  <span data-ttu-id="65566-180">Ejecutar herramientas de desarrollo (**F12**) en Internet Explorer o utilice [Fiddler](https://blogs.msdn.microsoft.com/crminthefield/2012/10/10/using-fiddler-to-check-for-kerberos-auth/) de host de conector de Hola.</span><span class="sxs-lookup"><span data-stu-id="65566-180">Run Dev tools(**F12**) in Internet Explorer, or use [Fiddler](https://blogs.msdn.microsoft.com/crminthefield/2012/10/10/using-fiddler-to-check-for-kerberos-auth/) from hello connector host.</span></span> <span data-ttu-id="65566-181">Vaya aplicación toohello con la dirección URL interna de hello e inspeccionar Hola ofrecida encabezados de autorización de World Wide Web devueltos una respuesta Hola de aplicación hello, tooensure que cualquiera negotiate o kerberos está presente.</span><span class="sxs-lookup"><span data-stu-id="65566-181">Go toohello application using hello internal URL, and inspect hello offered WWW authorization headers returned in hello response from hello application, tooensure that either negotiate or kerberos is present.</span></span> <span data-ttu-id="65566-182">Un blob de kerberos posteriores se devuelve en respuesta de Hola de hello explorador toohello aplicación normalmente empieza con **YII**, por lo que se trata de una buena indicación de kerberos en play.</span><span class="sxs-lookup"><span data-stu-id="65566-182">A subsequent kerberos blob returned in hello response from hello browser toohello application typically start with **YII**, so this is a good indication of kerberos being in play.</span></span> <span data-ttu-id="65566-183">NTLM en hello otra parte siempre se inician con **TlRMTVNTUAAB**, que lee NTLMSSP al descodificar de Base64.</span><span class="sxs-lookup"><span data-stu-id="65566-183">NTLM on hello other hand always start with **TlRMTVNTUAAB**, which reads NTLMSSP when decoded from Base64.</span></span> <span data-ttu-id="65566-184">Si ve **TlRMTVNTUAAB** en un primer Hola de blob de hello, esto significa que es Kerberos **no** disponible.</span><span class="sxs-lookup"><span data-stu-id="65566-184">If you see **TlRMTVNTUAAB** at hello start of hello blob, this means that Kerberos is **not** available.</span></span> <span data-ttu-id="65566-185">Si no lo ve, es probable que Kerberos esté disponible.</span><span class="sxs-lookup"><span data-stu-id="65566-185">If you don’t see this, Kerberos is likely available.</span></span>

  * <span data-ttu-id="65566-186">Tenga en cuenta que si usa Fiddler, este método requiere deshabilitar temporalmente la protección ampliada en configuración de la aplicación hello en IIS.</span><span class="sxs-lookup"><span data-stu-id="65566-186">Note, if using Fiddler, this method would require temporarily disabling extended protection on hello application’s config in IIS.</span></span>

     ![Ventana de inspección de red del explorador](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic6.png)

    <span data-ttu-id="65566-188">*Ilustración:* como no empieza por TIRMTVNTUAAB, en este ejemplo, Kerberos está disponible.</span><span class="sxs-lookup"><span data-stu-id="65566-188">*Figure:* Since this does not start with TIRMTVNTUAAB, this is an example that Kerberos is available.</span></span> <span data-ttu-id="65566-189">Se trata de un ejemplo de blob de Kerberos que no empieza por YII.</span><span class="sxs-lookup"><span data-stu-id="65566-189">This is an example of a Kerberos Blob that doesn’t start with YII.</span></span>

2.  <span data-ttu-id="65566-190">Quitar temporalmente NTLM de la lista de proveedores de hello en el sitio y acceso aplicación IIS directamente desde Internet Explorer en el host de conector.</span><span class="sxs-lookup"><span data-stu-id="65566-190">Temporarily remove NTLM from hello providers list on IIS site and access app directly from IE on connector host.</span></span> <span data-ttu-id="65566-191">Con NTLM ya no está en la lista de proveedores de hello, debería tooaccess capaz de aplicación de hello sólo se utiliza Kerberos.</span><span class="sxs-lookup"><span data-stu-id="65566-191">With NTLM no longer in hello providers list, you should be able tooaccess hello application using Kerberos only.</span></span> <span data-ttu-id="65566-192">Si se produce un error, a continuación, que indica que hay un problema con la configuración de la aplicación hello y la autenticación Kerberos no está funcionando.</span><span class="sxs-lookup"><span data-stu-id="65566-192">If this fails, then that suggests that there is a problem with hello application’s configuration and Kerberos authentication is not functioning.</span></span>

<span data-ttu-id="65566-193">Si Kerberos no está disponible, negociar la configuración de IIS toomake seguro de autenticación de la aplicación de verificación Hola aparece superior, con NTLM justo debajo de él.</span><span class="sxs-lookup"><span data-stu-id="65566-193">If Kerberos is not available, then check hello application’s authentication settings in IIS toomake sure negotiate is listed topmost, with NTLM just beneath it.</span></span> <span data-ttu-id="65566-194">(No Negociar:Kerberos o Negociar:PKU2U).</span><span class="sxs-lookup"><span data-stu-id="65566-194">(Not Negotiate:kerberos or Negotiate:PKU2U).</span></span> <span data-ttu-id="65566-195">Continúe solamente si Kerberos es funcional.</span><span class="sxs-lookup"><span data-stu-id="65566-195">Only continue if Kerberos is functional.</span></span>

   ![Proveedores de autenticación de Windows](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic7.png)
   
-   <span data-ttu-id="65566-197">Con la autenticación Kerberos y NTLM en su lugar, permite ahora deshabilitar temporalmente la autenticación previa para la aplicación hello en el portal de Hola.</span><span class="sxs-lookup"><span data-stu-id="65566-197">With Kerberos and NTLM in place, lets now temporarily disable pre-authentication for hello application in hello portal.</span></span> <span data-ttu-id="65566-198">Si puede tener acceso desde Hola internet con la dirección URL externa de Hola.</span><span class="sxs-lookup"><span data-stu-id="65566-198">See if you can access it from hello internet using hello external URL.</span></span> <span data-ttu-id="65566-199">Debe ser tooauthenticate solicitada y debe ser capaz de toodo para que con hello misma cuenta Hola utilizado en un paso anterior.</span><span class="sxs-lookup"><span data-stu-id="65566-199">You should be prompted tooauthenticate and should be able toodo so with hello same account used in hello previous step.</span></span> <span data-ttu-id="65566-200">Si no es así, esto indica un problema con la aplicación de back-end de hello y no KCD en absoluto.</span><span class="sxs-lookup"><span data-stu-id="65566-200">If not, this indicates a problem with hello backend application and not KCD at all.</span></span>

-   <span data-ttu-id="65566-201">Ahora vuelva a habilitar la autenticación previa en el portal de Hola y autenticarse a través de Azure al intentar tooconnect toohello aplicación a través de su URL externa.</span><span class="sxs-lookup"><span data-stu-id="65566-201">Now re-enable pre-authentication in hello portal and authenticate through Azure by attempting tooconnect toohello application via it’s external URL.</span></span> <span data-ttu-id="65566-202">Si se produce un error de SSO, verá un mensaje de error prohibido en Explorador de hello, además de evento 13022 en el registro de hello:</span><span class="sxs-lookup"><span data-stu-id="65566-202">If SSO has failed, then you should see a forbidden error message in hello browser, plus event 13022 in hello log:</span></span>

    <span data-ttu-id="65566-203">*Conector del Proxy de aplicación de AAD de Microsoft no puede autenticar el usuario de hello porque el servidor back-end de hello responde tooKerberos los intentos de autenticación con un error HTTP 401.*</span><span class="sxs-lookup"><span data-stu-id="65566-203">*Microsoft AAD Application Proxy Connector cannot authenticate hello user because hello backend server responds tooKerberos authentication attempts with an HTTP 401 error.*</span></span>

    ![Error HTTTP 401: Prohibido](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic8.png)

-   <span data-ttu-id="65566-205">Comprobar grupo de aplicaciones de hello IIS aplicación tooensure Hola configurado es hello toouse configurado misma cuenta que Hola SPN se ha configurado con en AD, desplazándose en IIS, como se muestra a continuación</span><span class="sxs-lookup"><span data-stu-id="65566-205">Check hello IIS application tooensure hello configured application pool is configured toouse hello same account that hello SPN has been configured against in AD, by navigating in IIS as illustrated below</span></span>

    ![Ventana de configuración de la aplicación IIS](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic9.png)

    <span data-ttu-id="65566-207">Una vez que sepa identidad hello, emitir siguiente Hola de toomake de símbolo del sistema de cmd que esta cuenta definitivamente esté configurada con hello SPN en cuestión.</span><span class="sxs-lookup"><span data-stu-id="65566-207">Once you know hello identity, issue hello following from a cmd prompt toomake sure this account is definitely configured with hello SPN in question.</span></span> <span data-ttu-id="65566-208">Por ejemplo, **setspn – q http/spn.wacketywack.com**</span><span class="sxs-lookup"><span data-stu-id="65566-208">For example,  **setspn – q http/spn.wacketywack.com**</span></span>

    ![Ventana de comando SetSPN](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic10.png)

-   <span data-ttu-id="65566-210">Compruebe que Hola SPN definida en relación con la configuración de la aplicación hello en el portal de hello es Hola mismo SPN que se configura en la cuenta de AD de destino de hello en uso por grupo de aplicaciones de la aplicación hello</span><span class="sxs-lookup"><span data-stu-id="65566-210">Check that hello SPN defined against hello application’s settings in hello portal is hello same SPN that is configured against hello target AD account in use by hello application’s app pool</span></span>

   ![Configuración del SPN en Azure Portal](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic11.png)
   
-   <span data-ttu-id="65566-212">Vaya a IIS y seleccione hello **Editor de configuración de** opción aplicación hello y navegue demasiado**system.webServer/security/authentication/windowsAuthentication** toomake seguro de que **UseAppPoolCredentials** se establece tootrue</span><span class="sxs-lookup"><span data-stu-id="65566-212">Go into IIS and select hello **Configuration Editor** option for hello application, and navigate too**system.webServer/security/authentication/windowsAuthentication** toomake sure that **UseAppPoolCredentials** is set tootrue</span></span>

   ![Opción de credencial de grupos de aplicaciones en la configuración de IIS](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic12.png)

<span data-ttu-id="65566-214">Al ser útiles para mejorar el rendimiento de Hola de operaciones de Kerberos, también deja habilitado el modo de Kernel hace vale de Hola para hello solicitado toobe servicio descifrado usando la cuenta de equipo.</span><span class="sxs-lookup"><span data-stu-id="65566-214">While being useful in improving hello performance of Kerberos operations, leaving Kernel mode enabled also causes hello ticket for hello requested service toobe decrypted using machine account.</span></span> <span data-ttu-id="65566-215">También se conoce como sistema Local de hello, por lo que tiene este salto de tootrue conjunto KCD cuando se hospeda la aplicación hello en varios servidores en una granja de servidores.</span><span class="sxs-lookup"><span data-stu-id="65566-215">This is also called hello Local system, so having this set tootrue break KCD when hello application is hosted across multiple servers in a farm.</span></span>

-   <span data-ttu-id="65566-216">Como una comprobación adicional, puede que también desee hello toodisable **extendido** protección demasiado.</span><span class="sxs-lookup"><span data-stu-id="65566-216">As an additional check, you may also want toodisable hello **Extended** protection too.</span></span> <span data-ttu-id="65566-217">Se han encontrado escenarios donde esto ha demostrado toobreak KCD cuando haya habilitado en configuraciones muy específicas, donde se publica una aplicación como una subcarpeta del sitio Web predeterminado de Hola.</span><span class="sxs-lookup"><span data-stu-id="65566-217">There have been encountered scenarios where this has proved toobreak KCD when enabled in very specific configurations, where an application is published as a sub folder of hello Default Web site.</span></span> <span data-ttu-id="65566-218">Este propio está configurado para la autenticación anónima, dejando Hola todo los cuadros de diálogo sugerir objetos secundarios no se heredan cualquier configuración activa en gris.</span><span class="sxs-lookup"><span data-stu-id="65566-218">This itself is configured for Anonymous authentication only, leaving hello entire dialogs greyed out suggesting child objects would not be inheriting any active settings.</span></span> <span data-ttu-id="65566-219">Pero donde posibles siempre le recomendamos tener esta opción habilitada, por lo que en todo caso de prueba, pero no olvide toorestore esta tooenabled.</span><span class="sxs-lookup"><span data-stu-id="65566-219">But where possible we would always recommend having this enabled, so by all means test, but don’t forget toorestore this tooenabled.</span></span>

<span data-ttu-id="65566-220">Estas comprobaciones adicionales deben haber ponerte en toostart de seguimiento mediante la aplicación publicada.</span><span class="sxs-lookup"><span data-stu-id="65566-220">These additional checks should have put you on track toostart using your published application.</span></span> <span data-ttu-id="65566-221">Puede seguir adelante y acelerar conectores adicionales que también estén configurados toodelegate, pero si ningún otras las cosas son, a continuación, se indicaría una lectura de nuestro tutorial técnica más detallada [guía completa de Hola para solucionar problemas de Azure AD aplicación Proxy](https://aka.ms/proxytshootpaper)</span><span class="sxs-lookup"><span data-stu-id="65566-221">You can go ahead and spin up additional connectors that are also configured toodelegate, but if things are no further then we would suggest a read of our more in-depth technical walkthrough [hello complete guide for Troubleshoot Azure AD Application Proxy](https://aka.ms/proxytshootpaper)</span></span>

<span data-ttu-id="65566-222">Si está todavía no se puede tooprogress el problema, soporte técnico se puede superar los tooassist satisfecho y continuar desde aquí.</span><span class="sxs-lookup"><span data-stu-id="65566-222">If you’re still unable tooprogress your issue, support would be more than happy tooassist and continue from here.</span></span> <span data-ttu-id="65566-223">Cree una incidencia de soporte técnico directamente en el portal de Hola y nuestros ingenieros se dirigirá tooyou.</span><span class="sxs-lookup"><span data-stu-id="65566-223">Create a support ticket directly within hello portal and our engineers will reach out tooyou.</span></span>

## <a name="other-scenarios"></a><span data-ttu-id="65566-224">Otros escenarios</span><span class="sxs-lookup"><span data-stu-id="65566-224">Other scenarios</span></span>

-   <span data-ttu-id="65566-225">Proxy de aplicación de Azure, se solicita un vale de Kerberos antes de enviar su aplicación tooan de solicitud.</span><span class="sxs-lookup"><span data-stu-id="65566-225">Azure Application Proxy requests a Kerberos ticket before sending its request tooan application.</span></span> <span data-ttu-id="65566-226">Algunas aplicaciones de terceros 3rd como Tableau Server no le gusta este método de autenticación y en su lugar espera más convencional Hola negociaciones tootake lugar,.</span><span class="sxs-lookup"><span data-stu-id="65566-226">Some 3rd party applications such as Tableau Server do not like this method of authenticating, and rather expects hello more conventional negotiations tootake place,.</span></span> <span data-ttu-id="65566-227">Hola primera solicitud es anónimo, permitir Hola aplicación toorespond con los tipos de autenticación de Hola que admite a través de 401.</span><span class="sxs-lookup"><span data-stu-id="65566-227">hello first request is anonymous, allowing hello application toorespond with hello authentication types that it supports through a 401.</span></span>

-   <span data-ttu-id="65566-228">Autenticación de dos saltos: se utiliza normalmente en escenarios con una aplicación en niveles, con un back-end y un front-end, ambos de los cuales requieren autenticación, como SQL Reporting Services.</span><span class="sxs-lookup"><span data-stu-id="65566-228">Double hop authentication - Commonly used in scenarios where an application is tiered, with a backend and front end, both requiring authentication, such as SQL Reporting Services.</span></span>

## <a name="next-steps"></a><span data-ttu-id="65566-229">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="65566-229">Next steps</span></span>
[<span data-ttu-id="65566-230">Configuración de la delegación limitada de Kerberos (KCD) en un dominio administrado</span><span class="sxs-lookup"><span data-stu-id="65566-230">Configure kerberos constrained delegation (KCD) on a managed domain</span></span>](https://docs.microsoft.com/azure/active-directory-domain-services/active-directory-ds-enable-kcd)

---
title: "Inicio de sesión único con el proxy de aplicación | Microsoft Docs"
description: "Explica cómo proporcionar el inicio de sesión único mediante el proxy de aplicación de Azure AD."
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: ded0d9c9-45f6-47d7-bd0f-3f7fd99ab621
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/25/2017
ms.author: kgremban
ms.reviewer: harshja
ms.custom: H1Hack27Feb2017, it-pro
ms.openlocfilehash: 149af1f68e574f78127a9c2de8a0e79ed8774d29
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/18/2017
---
# <a name="kerberos-constrained-delegation-for-single-sign-on-to-your-apps-with-application-proxy"></a><span data-ttu-id="c0134-103">Delegación restringida de Kerberos para el inicio de sesión único para las aplicaciones con Proxy de aplicación</span><span class="sxs-lookup"><span data-stu-id="c0134-103">Kerberos Constrained Delegation for single sign-on to your apps with Application Proxy</span></span>

<span data-ttu-id="c0134-104">Puede proporcionar un inicio de sesión único para las aplicaciones locales publicadas a través de Proxy de aplicación que se protegen con la autenticación integrada de Windows.</span><span class="sxs-lookup"><span data-stu-id="c0134-104">You can provide single sign-on for on-premises applications published through Application Proxy that are secured with Integrated Windows Authentication.</span></span> <span data-ttu-id="c0134-105">Estas aplicaciones requieren un vale Kerberos para el acceso.</span><span class="sxs-lookup"><span data-stu-id="c0134-105">These applications require a Kerberos ticket for access.</span></span> <span data-ttu-id="c0134-106">Proxy de aplicación usa la Delegación restringida de Kerberos (KCD) para admitir estas aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="c0134-106">Application Proxy uses Kerberos Constrained Delegation (KCD) to support these applications.</span></span> 

<span data-ttu-id="c0134-107">Puede habilitar el inicio de sesión único a sus aplicaciones mediante la autenticación integrada de Windows (IWA) dando permiso a los conectores del proxy de aplicación en Active Directory para suplantar a los usuarios.</span><span class="sxs-lookup"><span data-stu-id="c0134-107">You can enable single sign-on to your applications using Integrated Windows Authentication (IWA) by giving Application Proxy connectors permission in Active Directory to impersonate users.</span></span> <span data-ttu-id="c0134-108">Los conectores usan este permiso para enviar y recibir tokens en su nombre.</span><span class="sxs-lookup"><span data-stu-id="c0134-108">The connectors use this permission to send and receive tokens on their behalf.</span></span>

## <a name="how-single-sign-on-with-kcd-works"></a><span data-ttu-id="c0134-109">Cómo funciona el inicio de sesión único con KCD</span><span class="sxs-lookup"><span data-stu-id="c0134-109">How single sign-on with KCD works</span></span>
<span data-ttu-id="c0134-110">En este diagrama se explica el flujo cuando un usuario intenta tener acceso a una aplicación local que usa IWA.</span><span class="sxs-lookup"><span data-stu-id="c0134-110">This diagram explains the flow when a user attempts to access an on-prem application that uses IWA.</span></span>

![Diagrama de flujos de autenticación de Microsoft AAD](./media/active-directory-application-proxy-sso-using-kcd/AuthDiagram.png)

1. <span data-ttu-id="c0134-112">El usuario escribe la dirección URL para tener acceso a la aplicación local a través de Proxy de aplicación.</span><span class="sxs-lookup"><span data-stu-id="c0134-112">The user enters the URL to access the on-prem application through Application Proxy.</span></span>
2. <span data-ttu-id="c0134-113">Proxy de aplicación redirige la solicitud a los servicios de autenticación de Azure AD para realizar la autenticación previa.</span><span class="sxs-lookup"><span data-stu-id="c0134-113">Application Proxy redirects the request to Azure AD authentication services to preauthenticate.</span></span> <span data-ttu-id="c0134-114">En este momento, Azure AD aplica cualquier autenticación correspondiente, así como directivas de autorización, como la autenticación multifactor.</span><span class="sxs-lookup"><span data-stu-id="c0134-114">At this point, Azure AD applies any applicable authentication and authorization policies, such as multifactor authentication.</span></span> <span data-ttu-id="c0134-115">Si se valida el usuario, Azure AD crea un token y lo envía al usuario.</span><span class="sxs-lookup"><span data-stu-id="c0134-115">If the user is validated, Azure AD creates a token and sends it to the user.</span></span>
3. <span data-ttu-id="c0134-116">El usuario pasa el token a Proxy de aplicación.</span><span class="sxs-lookup"><span data-stu-id="c0134-116">The user passes the token to Application Proxy.</span></span>
4. <span data-ttu-id="c0134-117">Proxy de aplicación valida el token y recupera del mismo el nombre principal del usuario (UPN), enviando a continuación la solicitud, el UPN y el nombre de entidad de seguridad de servicio (SPN) al conector a través de un canal seguro doblemente autenticado.</span><span class="sxs-lookup"><span data-stu-id="c0134-117">Application Proxy validates the token and retrieves the User Principal Name (UPN) from it, and then sends the request, the UPN, and the Service Principal Name (SPN) to the Connector through a dually authenticated secure channel.</span></span>
5. <span data-ttu-id="c0134-118">El conector realiza la negociación de la delegación limitada de Kerberos (KCD) con AD local, suplantando al usuario para obtener un token de Kerberos para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c0134-118">The Connector performs Kerberos Constrained Delegation (KCD) negotiation with the on-prem AD, impersonating the user to get a Kerberos token to the application.</span></span>
6. <span data-ttu-id="c0134-119">Active Directory envía el token de Kerberos para la aplicación al conector.</span><span class="sxs-lookup"><span data-stu-id="c0134-119">Active Directory sends the Kerberos token for the application to the Connector.</span></span>
7. <span data-ttu-id="c0134-120">El conector envía la solicitud original al servidor de aplicaciones, con el token de Kerberos que recibió de AD.</span><span class="sxs-lookup"><span data-stu-id="c0134-120">The Connector sends the original request to the application server, using the Kerberos token it received from AD.</span></span>
8. <span data-ttu-id="c0134-121">La aplicación envía la respuesta al conector y, después, se devuelve al servicio Application Proxy y, por último, al usuario.</span><span class="sxs-lookup"><span data-stu-id="c0134-121">The application sends the response to the Connector, which is then returned to the Application Proxy service and finally to the user.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="c0134-122">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="c0134-122">Prerequisites</span></span>
<span data-ttu-id="c0134-123">Antes de empezar a trabajar con el inicio de sesión único para aplicaciones con autenticación integrada de Windows, asegúrese de que el entorno está preparado con los siguientes ajustes y configuraciones:</span><span class="sxs-lookup"><span data-stu-id="c0134-123">Before you get started with single sign-on for IWA applications, make sure your environment is ready with the following settings and configurations:</span></span>

* <span data-ttu-id="c0134-124">Sus aplicaciones, como las aplicaciones web de SharePoint, están establecidas para usar la autenticación de Windows integrada.</span><span class="sxs-lookup"><span data-stu-id="c0134-124">Your apps, like SharePoint Web apps, are set to use Integrated Windows Authentication.</span></span> <span data-ttu-id="c0134-125">Para más información, consulte [Habilitar la compatibilidad con la autenticación Kerberos](https://technet.microsoft.com/library/dd759186.aspx) o, para SharePoint, consulte [Planear la autenticación Kerberos en SharePoint 2013](https://technet.microsoft.com/library/ee806870.aspx).</span><span class="sxs-lookup"><span data-stu-id="c0134-125">For more information, see [Enable Support for Kerberos Authentication](https://technet.microsoft.com/library/dd759186.aspx), or for SharePoint see [Plan for Kerberos authentication in SharePoint 2013](https://technet.microsoft.com/library/ee806870.aspx).</span></span>
* <span data-ttu-id="c0134-126">Todas las aplicaciones tienen [nombres de entidad de seguridad de servicio](https://social.technet.microsoft.com/wiki/contents/articles/717.service-principal-names-spns-setspn-syntax-setspn-exe.aspx).</span><span class="sxs-lookup"><span data-stu-id="c0134-126">All your apps have [Service Principal Names](https://social.technet.microsoft.com/wiki/contents/articles/717.service-principal-names-spns-setspn-syntax-setspn-exe.aspx).</span></span>
* <span data-ttu-id="c0134-127">El servidor que ejecuta el conector y el que ejecuta la aplicación están unidos a dominio y forman parte del mismo dominio o dominios de confianza.</span><span class="sxs-lookup"><span data-stu-id="c0134-127">The server running the Connector and the server running the app are domain joined and part of the same domain or trusting domains.</span></span> <span data-ttu-id="c0134-128">Para obtener más información sobre la unión a un dominio, consulte [Unir un equipo a un dominio](https://technet.microsoft.com/library/dd807102.aspx).</span><span class="sxs-lookup"><span data-stu-id="c0134-128">For more information on domain join, see [Join a Computer to a Domain](https://technet.microsoft.com/library/dd807102.aspx).</span></span>
* <span data-ttu-id="c0134-129">El servidor que ejecuta el conector tiene acceso para leer el atributo TokenGroupsGlobalAndUniversal de los usuarios.</span><span class="sxs-lookup"><span data-stu-id="c0134-129">The server running the Connector has access to read the TokenGroupsGlobalAndUniversal attribute for users.</span></span> <span data-ttu-id="c0134-130">Esta configuración predeterminada que podría verse afectada por la seguridad del entorno.</span><span class="sxs-lookup"><span data-stu-id="c0134-130">This default setting might have been impacted by security hardening the environment.</span></span>

### <a name="configure-active-directory"></a><span data-ttu-id="c0134-131">Configurar Active Directory</span><span class="sxs-lookup"><span data-stu-id="c0134-131">Configure Active Directory</span></span>
<span data-ttu-id="c0134-132">La configuración de Active Directory varía, en función de si el conector de Proxy de aplicación y el servidor de aplicaciones están en el mismo dominio o no.</span><span class="sxs-lookup"><span data-stu-id="c0134-132">The Active Directory configuration varies, depending on whether your Application Proxy connector and the application server are in the same domain or not.</span></span>

#### <a name="connector-and-application-server-in-the-same-domain"></a><span data-ttu-id="c0134-133">Conector y servidor de aplicaciones en el mismo dominio</span><span class="sxs-lookup"><span data-stu-id="c0134-133">Connector and application server in the same domain</span></span>
1. <span data-ttu-id="c0134-134">En Active Directory, vaya a **Herramientas** > **Usuarios y equipos**.</span><span class="sxs-lookup"><span data-stu-id="c0134-134">In Active Directory, go to **Tools** > **Users and Computers**.</span></span>
2. <span data-ttu-id="c0134-135">Seleccione el servidor que ejecuta el conector.</span><span class="sxs-lookup"><span data-stu-id="c0134-135">Select the server running the connector.</span></span>
3. <span data-ttu-id="c0134-136">Haga clic en el botón derecho y seleccione **Propiedades** > **Delegación**.</span><span class="sxs-lookup"><span data-stu-id="c0134-136">Right-click and select **Properties** > **Delegation**.</span></span>
4. <span data-ttu-id="c0134-137">Seleccione **Confiar en este equipo para la delegación solo a los servicios especificados**.</span><span class="sxs-lookup"><span data-stu-id="c0134-137">Select **Trust this computer for delegation to specified services only**.</span></span> 
5. <span data-ttu-id="c0134-138">En **Servicios a los que esta cuenta puede presentar credenciales delegadas**, agregue el valor de la identidad SPN del servidor de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="c0134-138">Under **Services to which this account can present delegated credentials** add the value for the SPN identity of the application server.</span></span> <span data-ttu-id="c0134-139">Esto permite al conector del proxy de aplicación suplantar a los usuarios en AD en las aplicaciones definidas en la lista.</span><span class="sxs-lookup"><span data-stu-id="c0134-139">This enables the Application Proxy Connector to impersonate users in AD against the applications defined in the list.</span></span>

   ![Captura de pantalla de ventana Conector-Propiedades SVR](./media/active-directory-application-proxy-sso-using-kcd/Properties.jpg)

#### <a name="connector-and-application-server-in-different-domains"></a><span data-ttu-id="c0134-141">Conector y servidor de aplicaciones en dominios diferentes</span><span class="sxs-lookup"><span data-stu-id="c0134-141">Connector and application server in different domains</span></span>
1. <span data-ttu-id="c0134-142">Para obtener una lista de requisitos previos para trabajar con KCD entre dominios, vea [Delegación limitada Kerberos entre dominios](https://technet.microsoft.com/library/hh831477.aspx).</span><span class="sxs-lookup"><span data-stu-id="c0134-142">For a list of prerequisites for working with KCD across domains, see [Kerberos Constrained Delegation across domains](https://technet.microsoft.com/library/hh831477.aspx).</span></span>
2. <span data-ttu-id="c0134-143">Use la propiedad `principalsallowedtodelegateto` en el servidor de conector para permitir que Proxy de aplicación delegue en el servidor de conector.</span><span class="sxs-lookup"><span data-stu-id="c0134-143">Use the `principalsallowedtodelegateto` property on the Connector server to enable the Application Proxy to delegate for the Connector server.</span></span> <span data-ttu-id="c0134-144">El servidor de aplicaciones es `sharepointserviceaccount` y el servidor de delegación es `connectormachineaccount`.</span><span class="sxs-lookup"><span data-stu-id="c0134-144">The application server is `sharepointserviceaccount` and the delegating server is `connectormachineaccount`.</span></span> <span data-ttu-id="c0134-145">Para Windows 2012 R2, use este código como un ejemplo:</span><span class="sxs-lookup"><span data-stu-id="c0134-145">For Windows 2012 R2, use this code as an example:</span></span>

        $connector= Get-ADComputer -Identity connectormachineaccount -server dc.connectordomain.com

        Set-ADComputer -Identity sharepointserviceaccount -PrincipalsAllowedToDelegateToAccount $connector

        Get-ADComputer sharepointserviceaccount -Properties PrincipalsAllowedToDelegateToAccount

<span data-ttu-id="c0134-146">Sharepointserviceaccount puede ser la cuenta del equipo SPS o una cuenta de servicio con la que se ejecuta el grupo de aplicaciones SPS.</span><span class="sxs-lookup"><span data-stu-id="c0134-146">Sharepointserviceaccount can be the SPS machine account or a service account under which the SPS app pool is running.</span></span>

## <a name="configure-single-sign-on"></a><span data-ttu-id="c0134-147">Configurar inicio de sesión único</span><span class="sxs-lookup"><span data-stu-id="c0134-147">Configure single sign-on</span></span> 
1. <span data-ttu-id="c0134-148">Publique la aplicación según las instrucciones de [Publicar aplicaciones con el proxy de aplicación](application-proxy-publish-azure-portal.md).</span><span class="sxs-lookup"><span data-stu-id="c0134-148">Publish your application according to the instructions described in [Publish applications with Application Proxy](application-proxy-publish-azure-portal.md).</span></span> <span data-ttu-id="c0134-149">Asegúrese de seleccionar **Azure Active Directory** como **Método de autenticación previa**.</span><span class="sxs-lookup"><span data-stu-id="c0134-149">Make sure to select **Azure Active Directory** as the **Preauthentication Method**.</span></span>
2. <span data-ttu-id="c0134-150">Cuando la aplicación aparezca en la lista de aplicaciones empresariales, selecciónela y haga clic en **Inicio de sesión único**.</span><span class="sxs-lookup"><span data-stu-id="c0134-150">After your application appears in the list of enterprise applications, select it and click **Single sign-on**.</span></span>
3. <span data-ttu-id="c0134-151">Establezca el modo de inicio de sesión único en **Autenticación integrada de Windows**.</span><span class="sxs-lookup"><span data-stu-id="c0134-151">Set the single sign-on mode to **Integrated Windows Authentication**.</span></span>  
4. <span data-ttu-id="c0134-152">Escriba el **SPN de la aplicación interno** del servidor de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="c0134-152">Enter the **Internal Application SPN** of the application server.</span></span> <span data-ttu-id="c0134-153">En este ejemplo, el SPN para nuestra aplicación publicada es http/www.contoso.com. Este SPN debe estar en la lista de servicios a los que el conector puede presentar credenciales delegadas.</span><span class="sxs-lookup"><span data-stu-id="c0134-153">In this example, the SPN for our published application is http/www.contoso.com. This SPN needs to be in the list of services to which the connector can present delegated credentials.</span></span> 
5. <span data-ttu-id="c0134-154">Elija la **Identidad de inicio de sesión delegada** que va a usar el conector en nombre de los usuarios.</span><span class="sxs-lookup"><span data-stu-id="c0134-154">Choose the **Delegated Login Identity** for the connector to use on behalf of your users.</span></span> <span data-ttu-id="c0134-155">Para más información, vea [Trabajar con identidades en la nube y locales diferentes](#Working-with-different-on-premises-and-cloud-identities)</span><span class="sxs-lookup"><span data-stu-id="c0134-155">For more information, see [Working with different on-premises and cloud identities](#Working-with-different-on-premises-and-cloud-identities)</span></span>

   ![Configuración avanzada de aplicaciones](./media/active-directory-application-proxy-sso-using-kcd/cwap_auth2.png)  


## <a name="sso-for-non-windows-apps"></a><span data-ttu-id="c0134-157">SSO para las aplicaciones no son de Windows</span><span class="sxs-lookup"><span data-stu-id="c0134-157">SSO for non-Windows apps</span></span>
<span data-ttu-id="c0134-158">El flujo de la delegación de Kerberos del Proxy de aplicación de Azure AD se inicia cuando Azure AD autentica al usuario en la nube.</span><span class="sxs-lookup"><span data-stu-id="c0134-158">The Kerberos delegation flow in Azure AD Application Proxy starts when Azure AD authenticates the user in the cloud.</span></span> <span data-ttu-id="c0134-159">Una vez que la solicitud se recibe en local, el conector de Proxy de aplicación de Azure AD emite un vale Kerberos en nombre del usuario mediante la interacción con Active Directory local.</span><span class="sxs-lookup"><span data-stu-id="c0134-159">Once the request arrives on-premises, the Azure AD Application Proxy connector issues a Kerberos ticket on behalf of the user by interacting with the local Active Directory.</span></span> <span data-ttu-id="c0134-160">Este proceso se conoce como Delegación limitada de Kerberos (KCD).</span><span class="sxs-lookup"><span data-stu-id="c0134-160">This process is referred to as Kerberos Constrained Delegation (KCD).</span></span> <span data-ttu-id="c0134-161">En la fase siguiente, se envía una solicitud a la aplicación back-end con este vale Kerberos.</span><span class="sxs-lookup"><span data-stu-id="c0134-161">In the next phase, a request is sent to the backend application with this Kerberos ticket.</span></span> <span data-ttu-id="c0134-162">Haya varios protocolos que definen cómo enviar dichas solicitudes.</span><span class="sxs-lookup"><span data-stu-id="c0134-162">There are several protocols that define how to send such requests.</span></span> <span data-ttu-id="c0134-163">La mayoría de los servidores que no son Windows esperan Negotiate/SPNego, que ahora se admite en el proxy de aplicación de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c0134-163">Most non-Windows servers expect Negotiate/SPNego that is now supported on Azure AD Application Proxy.</span></span>

<span data-ttu-id="c0134-164">Para obtener más información sobre Kerberos, consulte [All you want to know about Kerberos Constrained Delegation (KCD)](https://blogs.technet.microsoft.com/applicationproxyblog/2015/09/21/all-you-want-to-know-about-kerberos-constrained-delegation-kcd) (Todo lo que necesita saber sobre Delegación restringida de kerberos [KCD]).</span><span class="sxs-lookup"><span data-stu-id="c0134-164">For more information about Kerberos, see [All you want to know about Kerberos Constrained Delegation (KCD)](https://blogs.technet.microsoft.com/applicationproxyblog/2015/09/21/all-you-want-to-know-about-kerberos-constrained-delegation-kcd).</span></span>

<span data-ttu-id="c0134-165">Las aplicaciones que no son de Windows normalmente usan nombres de usuario o nombres de cuenta SAM en lugar de direcciones de correo electrónico de dominio.</span><span class="sxs-lookup"><span data-stu-id="c0134-165">Non-Windows apps typically user usernames or SAM account names instead of domain email addresses.</span></span> <span data-ttu-id="c0134-166">Si esta situación se aplica a sus aplicaciones, debe configurar el campo de identidad de inicio de sesión delegada para conectar las identidades de nube a las identidades de aplicación.</span><span class="sxs-lookup"><span data-stu-id="c0134-166">If that situation applies to your applications, you need to configure the delegated login identity field to connect your cloud identities to your application identities.</span></span> 

## <a name="working-with-different-on-premises-and-cloud-identities"></a><span data-ttu-id="c0134-167">Trabajar con diferentes identidades locales y de nube</span><span class="sxs-lookup"><span data-stu-id="c0134-167">Working with different on-premises and cloud identities</span></span>
<span data-ttu-id="c0134-168">Proxy de aplicación supone que los usuarios tienen exactamente la misma identidad en la nube y en local.</span><span class="sxs-lookup"><span data-stu-id="c0134-168">Application Proxy assumes that users have exactly the same identity in the cloud and on-premises.</span></span> <span data-ttu-id="c0134-169">Si no es el caso, puede seguir usando KCD para el inicio de sesión único.</span><span class="sxs-lookup"><span data-stu-id="c0134-169">If that's not the case, you can can still use KCD for single sign-on.</span></span> <span data-ttu-id="c0134-170">Configure una **Identidad de inicio de sesión delegada** para cada aplicación para especificar qué identidad se debe usar al realizar el inicio de sesión único.</span><span class="sxs-lookup"><span data-stu-id="c0134-170">Configure a **Delegated login identity** for each application to specify which identity should be used when performing single sign-on.</span></span>  

<span data-ttu-id="c0134-171">Esta funcionalidad permite a muchas organizaciones que tienen identidades locales y en la nube diferentes disponer de inicio de sesión único en aplicaciones locales desde aplicaciones en la nube sin que los usuarios tengan que escribir nombres de usuario y contraseñas diferentes.</span><span class="sxs-lookup"><span data-stu-id="c0134-171">This capability allows many organizations that have different on-premises and cloud identities to have SSO from the cloud to on-premises apps without requiring the users to enter different usernames and passwords.</span></span> <span data-ttu-id="c0134-172">Esto incluye las organizaciones que:</span><span class="sxs-lookup"><span data-stu-id="c0134-172">This includes organizations that:</span></span>

* <span data-ttu-id="c0134-173">Tienen varios dominios internamente (joe@us.contoso.com, joe@eu.contoso.com) y un único dominio en la nube (joe@contoso.com).</span><span class="sxs-lookup"><span data-stu-id="c0134-173">Have multiple domains internally (joe@us.contoso.com, joe@eu.contoso.com) and a single domain in the cloud (joe@contoso.com).</span></span>
* <span data-ttu-id="c0134-174">Tienen un nombre de dominio no enrutable internamente (joe@contoso.usa) y uno legal en la nube.</span><span class="sxs-lookup"><span data-stu-id="c0134-174">Have non-routable domain name internally (joe@contoso.usa) and a legal one in the cloud.</span></span>
* <span data-ttu-id="c0134-175">No utilizan nombres de dominio internamente (joe)</span><span class="sxs-lookup"><span data-stu-id="c0134-175">Do not use domain names internally (joe)</span></span>
* <span data-ttu-id="c0134-176">Usan distintos alias locales y en la nube.</span><span class="sxs-lookup"><span data-stu-id="c0134-176">Use different aliases on-prem and in the cloud.</span></span> <span data-ttu-id="c0134-177">Por ejemplo, joe-johns@contoso.com en comparación con joej@contoso.com</span><span class="sxs-lookup"><span data-stu-id="c0134-177">For example, joe-johns@contoso.com vs. joej@contoso.com</span></span>  

<span data-ttu-id="c0134-178">Con el proxy de aplicación, puede seleccionar qué identidad utilizar para obtener el vale de Kerberos.</span><span class="sxs-lookup"><span data-stu-id="c0134-178">With Application Proxy, you can select which identity to use to obtain the Kerberos ticket.</span></span> <span data-ttu-id="c0134-179">Esta configuración es por aplicación.</span><span class="sxs-lookup"><span data-stu-id="c0134-179">This setting is per application.</span></span> <span data-ttu-id="c0134-180">Algunas de estas opciones son adecuadas para los sistemas que no aceptan el formato de dirección de correo electrónico, otras están pensadas para el inicio de sesión alternativo.</span><span class="sxs-lookup"><span data-stu-id="c0134-180">Some of these options are suitable for systems that do not accept email address format, others are designed for alternative login.</span></span>

![Captura de pantalla de parámetro de identidad de inicio de sesión delegado](./media/active-directory-application-proxy-sso-using-kcd/app_proxy_sso_diff_id_upn.png)

<span data-ttu-id="c0134-182">Si se usa la identidad de inicio de sesión delegada, es posible que el valor no sea único para todos los dominios o bosques de la organización.</span><span class="sxs-lookup"><span data-stu-id="c0134-182">If delegated login identity is used, the value might not be unique across all the domains or forests in your organization.</span></span> <span data-ttu-id="c0134-183">Puede evitar este problema al publicar estas aplicaciones dos veces con dos grupos diferentes de conector.</span><span class="sxs-lookup"><span data-stu-id="c0134-183">You can avoid this issue by publishing these applications twice using two different Connector groups.</span></span> <span data-ttu-id="c0134-184">Puesto que cada aplicación tiene una audiencia de usuarios diferente, puede unir sus conectores a un dominio diferente.</span><span class="sxs-lookup"><span data-stu-id="c0134-184">Since each application has a different user audience, you can join its Connectors to a different domain.</span></span>

### <a name="configure-sso-for-different-identities"></a><span data-ttu-id="c0134-185">Configurar el inicio de sesión único para distintas identidades</span><span class="sxs-lookup"><span data-stu-id="c0134-185">Configure SSO for different identities</span></span>
1. <span data-ttu-id="c0134-186">Configure Azure AD Connect para que la identidad principal sea la dirección de correo electrónico (correo).</span><span class="sxs-lookup"><span data-stu-id="c0134-186">Configure Azure AD Connect settings so the main identity is the email address (mail).</span></span> <span data-ttu-id="c0134-187">Esto se realiza como parte del proceso de personalización, al cambiar el campo **Nombre principal de usuario** en la configuración de sincronización.</span><span class="sxs-lookup"><span data-stu-id="c0134-187">This is done as part of the customize process, by changing the **User Principal Name** field in the sync settings.</span></span> <span data-ttu-id="c0134-188">Esta configuración también determina la forma en que los usuarios inician sesión en dispositivos con Office 365 y Windows10, y otras aplicaciones que usan Azure AD como almacén de identidades.</span><span class="sxs-lookup"><span data-stu-id="c0134-188">These settings also determine how users log in to Office365, Windows10 devices, and other applications that use Azure AD as their identity store.</span></span>  
   <span data-ttu-id="c0134-189">![Captura de pantalla de la identificación de usuarios - lista desplegable de Nombre principal de usuario](./media/active-directory-application-proxy-sso-using-kcd/app_proxy_sso_diff_id_connect_settings.png)</span><span class="sxs-lookup"><span data-stu-id="c0134-189">![Identifying users screenshot - User Principal Name dropdown](./media/active-directory-application-proxy-sso-using-kcd/app_proxy_sso_diff_id_connect_settings.png)</span></span>  
2. <span data-ttu-id="c0134-190">En las opciones de Configuración de la aplicación correspondientes a la aplicación que quiere modificar, seleccione la información en **Identidad de inicio de sesión delegada** que quiere usar:</span><span class="sxs-lookup"><span data-stu-id="c0134-190">In the Application Configuration settings for the application you would like to modify, select the **Delegated Login Identity** to be used:</span></span>

   * <span data-ttu-id="c0134-191">Nombre principal de usuario (por ejemplo, joe@contoso.com).</span><span class="sxs-lookup"><span data-stu-id="c0134-191">User Principal Name (for example, joe@contoso.com)</span></span>
   * <span data-ttu-id="c0134-192">Nombre principal de usuario alternativo (por ejemplo, joed@contoso.local).</span><span class="sxs-lookup"><span data-stu-id="c0134-192">Alternate User Principal Name (for example, joed@contoso.local)</span></span>
   * <span data-ttu-id="c0134-193">Parte nombre de usuario del nombre principal de usuario (por ejemplo, joe).</span><span class="sxs-lookup"><span data-stu-id="c0134-193">Username part of User Principal Name (for example, joe)</span></span>
   * <span data-ttu-id="c0134-194">Parte nombre de usuario del nombre principal de usuario alternativo (por ejemplo, joed).</span><span class="sxs-lookup"><span data-stu-id="c0134-194">Username part of Alternate User Principal Name (for example, joed)</span></span>
   * <span data-ttu-id="c0134-195">Nombre de cuenta SAM local (depende de la configuración del controlador de dominio).</span><span class="sxs-lookup"><span data-stu-id="c0134-195">On-premises SAM account name (depends on the domain controller configuration)</span></span>

### <a name="troubleshooting-sso-for-different-identities"></a><span data-ttu-id="c0134-196">Solución de problemas de SSO para diferentes identidades</span><span class="sxs-lookup"><span data-stu-id="c0134-196">Troubleshooting SSO for different identities</span></span>
<span data-ttu-id="c0134-197">Si se produce un error en el proceso de inicio de sesión único, aparece en el registro de eventos del equipo de conexión, como se explica en [Solución de problemas](application-proxy-back-end-kerberos-constrained-delegation-how-to.md).</span><span class="sxs-lookup"><span data-stu-id="c0134-197">If there is an error in the SSO process, it appears in the connector machine event log as explained in [Troubleshooting](application-proxy-back-end-kerberos-constrained-delegation-how-to.md).</span></span>
<span data-ttu-id="c0134-198">Pero, en algunos casos, la solicitud se envía correctamente a la aplicación del back-end mientras que esta aplicación responde en otras respuestas HTTP.</span><span class="sxs-lookup"><span data-stu-id="c0134-198">But, in some cases, the request is successfully sent to the backend application while this application replies in various other HTTP responses.</span></span> <span data-ttu-id="c0134-199">La solución de problemas de estos casos debe empezar por examinar el número de evento 24029 en el equipo de conexión en el registro de eventos de sesión de Proxy de aplicación.</span><span class="sxs-lookup"><span data-stu-id="c0134-199">Troubleshooting these cases should start by examining event number 24029 on the connector machine in the Application Proxy session event log.</span></span> <span data-ttu-id="c0134-200">La identidad del usuario que se usó para la delegación aparece en el campo “usuario” de los detalles del evento.</span><span class="sxs-lookup"><span data-stu-id="c0134-200">The user identity that was used for delegation appears in the “user” field within the event details.</span></span> <span data-ttu-id="c0134-201">Para activar el registro de sesión, seleccione **Mostrar registros analíticos y de depuración** en el menú de vista del Visor de eventos.</span><span class="sxs-lookup"><span data-stu-id="c0134-201">To turn on session log, select **Show analytic and debug logs** in the event viewer view menu.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c0134-202">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="c0134-202">Next steps</span></span>

* [<span data-ttu-id="c0134-203">Configuración de una aplicación de proxy de aplicación para que use la delegación restringida de Kerberos</span><span class="sxs-lookup"><span data-stu-id="c0134-203">How to configure an Application Proxy application to use Kerberos Constrained Delegation</span></span>](application-proxy-back-end-kerberos-constrained-delegation-how-to.md)
* [<span data-ttu-id="c0134-204">Solucionar los problemas que tiene con el Proxy de aplicación</span><span class="sxs-lookup"><span data-stu-id="c0134-204">Troubleshoot issues you're having with Application Proxy</span></span>](active-directory-application-proxy-troubleshoot.md)


<span data-ttu-id="c0134-205">Para ver las últimas noticias y actualizaciones, consulte el [Application Proxy blog](http://blogs.technet.com/b/applicationproxyblog/)</span><span class="sxs-lookup"><span data-stu-id="c0134-205">For the latest news and updates, check out the [Application Proxy blog](http://blogs.technet.com/b/applicationproxyblog/)</span></span>


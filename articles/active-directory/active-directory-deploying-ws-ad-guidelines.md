---
title: Instrucciones para implementar Windows Server Active Directory en Azure Virtual Machines | Microsoft Azure
description: "Si sabe cómo implementar servicios de dominio de Active Directory y los servicios de federación de AD de forma local, aprenda cómo funcionan en máquinas virtuales de Azure."
services: active-directory
documentationcenter: 
author: femila
manager: femila
editor: 
ms.assetid: 04df4c46-e6b6-4754-960a-57b823d617fa
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 07/26/2017
ms.author: femila
ms.openlocfilehash: 342d9e2787add3d04f1b744152e135db98848179
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/03/2017
---
# <a name="guidelines-for-deploying-windows-server-active-directory-on-azure-virtual-machines"></a><span data-ttu-id="e044c-103">Directrices para implementar Windows Server Active Directory en máquinas virtuales de Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="e044c-103">Guidelines for deploying Windows Server Active Directory on Azure virtual machines</span></span>
<span data-ttu-id="e044c-104">Este artículo explica las importantes diferencias entre implementar Windows Server Active Directory Domain Services (ADDS) y Servicios de federación de Active Directory (ADFS) localmente en comparación con la implementación en máquinas virtuales de Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-104">This article explains the important differences between deploying Windows Server Active Directory Domain Services (AD DS) and Active Directory Federation Services (AD FS) on-premises versus deploying them on Microsoft Azure virtual machines.</span></span>

## <a name="scope-and-audience"></a><span data-ttu-id="e044c-105">Ámbito y audiencia</span><span class="sxs-lookup"><span data-stu-id="e044c-105">Scope and audience</span></span>
<span data-ttu-id="e044c-106">El artículo está destinado a los que ya tienen experiencia en la implementación de Active Directory de forma local.</span><span class="sxs-lookup"><span data-stu-id="e044c-106">The article is intended for those already experienced with deploying Active Directory on-premises.</span></span> <span data-ttu-id="e044c-107">Cubre las diferencias que hay entre la implementación de Active Directory en redes o máquinas virtuales de Microsoft Azure y las implementaciones de Active Directory locales tradicionales.</span><span class="sxs-lookup"><span data-stu-id="e044c-107">It covers the differences between deploying Active Directory on Microsoft Azure virtual machines/Azure virtual networks and traditional on-premises Active Directory deployments.</span></span> <span data-ttu-id="e044c-108">Las máquinas y redes virtuales de Azure forman parte de una oferta de infraestructura como servicio (IaaS) pensada para que las organizaciones aprovechen los recursos informáticos en la nube.</span><span class="sxs-lookup"><span data-stu-id="e044c-108">Azure virtual machines and Azure virtual networks are part of an Infrastructure-as-a-Service (IaaS) offering for organizations to leverage computing resources in the cloud.</span></span>

<span data-ttu-id="e044c-109">Si no está familiarizado con la implementación de AD, consulte la [Guía de implementación de AD DS](https://technet.microsoft.com/library/cc753963) o el artículo [Planear la implementación de AD FS según corresponda](https://technet.microsoft.com/library/dn151324.aspx).</span><span class="sxs-lookup"><span data-stu-id="e044c-109">For those that are not familiar with AD deployment, see the [AD DS Deployment Guide](https://technet.microsoft.com/library/cc753963) or [Plan your AD FS deployment](https://technet.microsoft.com/library/dn151324.aspx) as appropriate.</span></span>

<span data-ttu-id="e044c-110">En este artículo se supone que el lector está familiarizado con los conceptos siguientes:</span><span class="sxs-lookup"><span data-stu-id="e044c-110">This article assumes that the reader is familiar with the following concepts:</span></span>

* <span data-ttu-id="e044c-111">Implementación y administración de Windows Server AD DS</span><span class="sxs-lookup"><span data-stu-id="e044c-111">Windows Server AD DS deployment and management</span></span>
* <span data-ttu-id="e044c-112">Implementación y configuración de DNS para que admita una infraestructura de Windows Server AD DS</span><span class="sxs-lookup"><span data-stu-id="e044c-112">Deployment and configuration of DNS to support a Windows Server AD DS infrastructure</span></span>
* <span data-ttu-id="e044c-113">Implementación y administración de Windows Server AD FS</span><span class="sxs-lookup"><span data-stu-id="e044c-113">Windows Server AD FS deployment and management</span></span>
* <span data-ttu-id="e044c-114">Implementación, configuración y administración de aplicaciones de usuarios de confianza (sitios y servicios web) que pueden usar tokens de Windows Server AD FS</span><span class="sxs-lookup"><span data-stu-id="e044c-114">Deploying, configuring, and managing relying party applications (websites and web services) that can consume Windows Server AD FS tokens</span></span>
* <span data-ttu-id="e044c-115">Conceptos generales sobre las máquinas virtuales como, por ejemplo, cómo configurar una máquina virtual, discos virtuales y redes virtuales</span><span class="sxs-lookup"><span data-stu-id="e044c-115">General virtual machine concepts, such as how to configure a virtual machine, virtual disks, and virtual networks</span></span>

<span data-ttu-id="e044c-116">Este artículo resalta los requisitos necesarios para un escenario de implementación híbrido en el que Windows Server AD DS o AD FS se implementan en parte de forma local y en parte en máquinas virtuales de Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-116">This article highlights the requirements for a hybrid deployment scenario in which Windows Server AD DS or AD FS are partly deployed on-premises and partly deployed on Azure virtual machines.</span></span> <span data-ttu-id="e044c-117">En el documento se explican en primer lugar las diferencias más importantes entre ejecutar Windows Server AD DS y AD FS en máquinas virtuales de Azure en comparación con la implementación en el entorno local, y analiza también importantes elementos de decisión que afectan al diseño y la implementación.</span><span class="sxs-lookup"><span data-stu-id="e044c-117">The document first covers the critical differences between running Windows Server AD DS and AD FS on Azure virtual machines versus on-premises, and important decision points that affect design and deployment.</span></span> <span data-ttu-id="e044c-118">El resto del artículo ofrece instrucciones para cada uno de los puntos de decisión más detalladamente y explica cómo aplicarlas a diferentes escenarios de implementación.</span><span class="sxs-lookup"><span data-stu-id="e044c-118">The rest of the paper explains guidelines for each of the decision points in more detail, and how to apply the guidelines to various deployment scenarios.</span></span>

<span data-ttu-id="e044c-119">Este artículo no explica la configuración de [Azure Active Directory](http://azure.microsoft.com/services/active-directory/), un servicio basado en REST que ofrece funcionalidad de administración de identidades y control de acceso para las aplicaciones en la nube.</span><span class="sxs-lookup"><span data-stu-id="e044c-119">This article does not discuss the configuration of [Azure Active Directory](http://azure.microsoft.com/services/active-directory/), which is a REST-based service that provides identity management and access control capabilities for cloud applications.</span></span> <span data-ttu-id="e044c-120">Sin embargo, Azure Active Directory (Azure AD) y Windows Server AD DS están diseñados para trabajar conjuntamente para proporcionar una solución de administración de identidades y acceso para entornos híbridos de TI y aplicaciones modernas.</span><span class="sxs-lookup"><span data-stu-id="e044c-120">Azure Active Directory (Azure AD) and Windows Server AD DS are, however, designed to work together to provide an identity and access management solution for today’s hybrid IT environments and modern applications.</span></span> <span data-ttu-id="e044c-121">Para ayudar a comprender las diferencias y relaciones entre Windows Server AD DS y Azure AD, tenga en cuenta lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="e044c-121">To help understand the differences and relationships between Windows Server AD DS and Azure AD, consider the following:</span></span>

1. <span data-ttu-id="e044c-122">Puede ejecutar Windows Server AD DS en la nube en máquinas virtuales si utiliza Azure para extender el centro de datos local en la nube.</span><span class="sxs-lookup"><span data-stu-id="e044c-122">You might run Windows Server AD DS in the cloud on Azure virtual machines when you are using Azure to extend your on-premises datacenter into the cloud.</span></span>
2. <span data-ttu-id="e044c-123">Puede usar Azure Active Directory para proporcionar a los usuarios un inicio de sesión único en aplicaciones de software como servicio (SaaS).</span><span class="sxs-lookup"><span data-stu-id="e044c-123">You might use Azure AD to give your users single sign-on to Software-as-a-Service (SaaS) applications.</span></span> <span data-ttu-id="e044c-124">Por ejemplo, Microsoft Office 365 usa esta tecnología y las aplicaciones que se ejecutan en Azure u otras plataformas en la nube también pueden usarla.</span><span class="sxs-lookup"><span data-stu-id="e044c-124">Microsoft Office 365 uses this technology, for example, and applications running on Azure or other cloud platforms can also use it.</span></span>
3. <span data-ttu-id="e044c-125">Puede utilizar Azure AD (el Servicio de control de acceso) para permitir que los usuarios inicien sesión, mediante identidades de Facebook, Google, Microsoft y otros proveedores de identidades, en aplicaciones hospedadas en la nube o de forma local.</span><span class="sxs-lookup"><span data-stu-id="e044c-125">You might use Azure AD (its Access Control Service) to let users sign in using identities from Facebook, Google, Microsoft, and other identity providers to applications that are hosted in the cloud or on-premises.</span></span>

<span data-ttu-id="e044c-126">Para más información sobre estas diferencias, consulte el artículo [Aspectos básicos de la administración de identidades de Azure](fundamentals-identity.md).</span><span class="sxs-lookup"><span data-stu-id="e044c-126">For more information about these differences, see [Azure Identity](fundamentals-identity.md).</span></span>

## <a name="related-resources"></a><span data-ttu-id="e044c-127">Recursos relacionados</span><span class="sxs-lookup"><span data-stu-id="e044c-127">Related resources</span></span>
<span data-ttu-id="e044c-128">Puede descargar y ejecutar la herramienta de [evaluación de preparación de máquinas virtuales de Azure](https://www.microsoft.com/download/details.aspx?id=40898).</span><span class="sxs-lookup"><span data-stu-id="e044c-128">You may download and run the [Azure Virtual Machine Readiness Assessment](https://www.microsoft.com/download/details.aspx?id=40898).</span></span> <span data-ttu-id="e044c-129">La evaluación inspeccionará automáticamente el entorno local y generará un informe personalizado basado en las instrucciones que encontrará en este tema para ayudarle a migrar el entorno a Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-129">The assessment will automatically inspect your on-premises environment and generate a customized report based on the guidance found in this topic to help you migrate the environment to Azure.</span></span>

<span data-ttu-id="e044c-130">Se recomienda que revise también en primer lugar los tutoriales, guías y vídeos que tratan de los siguientes temas:</span><span class="sxs-lookup"><span data-stu-id="e044c-130">We recommend that you also first review the tutorials, guides, and videos that cover the following topics:</span></span>

* [<span data-ttu-id="e044c-131">Creación de una red virtual mediante el Portal de Azure</span><span class="sxs-lookup"><span data-stu-id="e044c-131">Configure a Cloud-Only Virtual Network in the Azure Portal</span></span>](../virtual-network/virtual-networks-create-vnet-arm-pportal.md)
* [<span data-ttu-id="e044c-132">Creación de una red virtual con una conexión VPN de sitio a sitio mediante el Portal de Azure clásico</span><span class="sxs-lookup"><span data-stu-id="e044c-132">Configure a Site-to-Site VPN in the Azure Portal</span></span>](../vpn-gateway/vpn-gateway-site-to-site-create.md)
* [<span data-ttu-id="e044c-133">Instalación de un bosque nuevo de Active Directory en una red virtual de Azure</span><span class="sxs-lookup"><span data-stu-id="e044c-133">Install a new Active Directory forest on an Azure virtual network</span></span>](active-directory-new-forest-virtual-machine.md)
* [<span data-ttu-id="e044c-134">Instalación de un controlador de dominio de Active Directory de réplica en una red virtual de Azure</span><span class="sxs-lookup"><span data-stu-id="e044c-134">Install a replica Active Directory domain controller on Azure</span></span>](active-directory-install-replica-active-directory-domain-controller.md)
* [<span data-ttu-id="e044c-135">Microsoft Azure IaaS para profesionales de TI: (01) Principios básicos sobre máquinas virtuales</span><span class="sxs-lookup"><span data-stu-id="e044c-135">Microsoft Azure IT Pro IaaS: (01) Virtual Machine Fundamentals</span></span>](https://channel9.msdn.com/Series/Windows-Azure-IT-Pro-IaaS/01)
* [<span data-ttu-id="e044c-136">Microsoft Azure IaaS para profesionales de TI: (05) Creación de redes virtuales y conectividad entre instalaciones</span><span class="sxs-lookup"><span data-stu-id="e044c-136">Microsoft Azure IT Pro IaaS: (05) Creating Virtual Networks and Cross-Premises Connectivity</span></span>](https://channel9.msdn.com/Series/Windows-Azure-IT-Pro-IaaS/05)

## <a name="introduction"></a><span data-ttu-id="e044c-137">Introducción</span><span class="sxs-lookup"><span data-stu-id="e044c-137">Introduction</span></span>
<span data-ttu-id="e044c-138">Los requisitos fundamentales para implementar Windows Server Active Directory en máquinas virtuales de Azure son similares, pero no idénticos, a los de implementarlo en máquinas virtuales (y, en cierta medida, en máquinas físicas) locales.</span><span class="sxs-lookup"><span data-stu-id="e044c-138">The fundamental requirements for deploying Windows Server Active Directory on Azure virtual machines differ very little from deploying it in on-premises virtual machines (and, to some extent, physical machines).</span></span> <span data-ttu-id="e044c-139">Por ejemplo, en el caso de Windows Server AD DS, si los controladores de dominio (DC) que implementa en las máquinas virtuales de Azure son réplicas en un bosque o dominio corporativo local existente, podrá tratar la implementación de Azure en gran medida de la misma manera que la de cualquier otro sitio adicional de Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e044c-139">For example, in the case of Windows Server AD DS, if the domain controllers (DCs) that you deploy on Azure virtual machines are replicas in an existing on-premises corporate domain/forest, then the Azure deployment can largely be treated in the same way as you might treat any other additional Windows Server Active Directory site.</span></span> <span data-ttu-id="e044c-140">Es decir, se deben definir subredes en Windows Server AD DS, crear un sitio, vincular las subredes a ese sitio y conectar a otros sitios con los vínculos adecuados.</span><span class="sxs-lookup"><span data-stu-id="e044c-140">That is, subnets must be defined in Windows Server AD DS, a site created, the subnets linked to that site, and connected to other sites using appropriate site-links.</span></span> <span data-ttu-id="e044c-141">Sin embargo, hay algunas diferencias que son comunes a todas las implementaciones de Azure y otras que varían según el escenario de implementación concreto.</span><span class="sxs-lookup"><span data-stu-id="e044c-141">There are, however, some differences that are common to all Azure deployments and some that vary according to the specific deployment scenario.</span></span> <span data-ttu-id="e044c-142">A continuación se presentan dos diferencias fundamentales:</span><span class="sxs-lookup"><span data-stu-id="e044c-142">Two fundamental differences are outlined below:</span></span>

### <a name="azure-virtual-machines-may-need-connectivity-to-the-on-premises-corporate-network"></a><span data-ttu-id="e044c-143">Puede que las máquinas virtuales de Azure necesiten conectividad con la red corporativa local.</span><span class="sxs-lookup"><span data-stu-id="e044c-143">Azure virtual machines may need connectivity to the on-premises corporate network.</span></span>
<span data-ttu-id="e044c-144">Conectar de nuevo máquinas virtuales de Azure a una red corporativa local requiere una red virtual que incluya un componente de red privada virtual (VPN) de sitio a sitio o de sitio a punto que pueda conectar sin ningún problema máquinas virtuales de Azure y equipos locales.</span><span class="sxs-lookup"><span data-stu-id="e044c-144">Connecting Azure virtual machines back to an on-premises corporate network requires Azure virtual network, which includes a site-to-site or site-to-point virtual private network (VPN) component able to seamlessly connect Azure virtual machines and on-premises machines.</span></span> <span data-ttu-id="e044c-145">Este componente de VPN también puede permitir a equipos miembros del dominio local acceder a un dominio de Windows Server Active Directory cuyos controladores de dominio estén hospedados exclusivamente en máquinas virtuales de Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-145">This VPN component could also enable on-premises domain member computers to access a Windows Server Active Directory domain whose domain controllers are hosted exclusively on Azure virtual machines.</span></span> <span data-ttu-id="e044c-146">No obstante, es importante que tenga en cuenta que si se produce un error en la VPN, la autenticación y otras operaciones que dependen de Windows Server Active Directory también darán error.</span><span class="sxs-lookup"><span data-stu-id="e044c-146">It is important to note, though, that if the VPN fails, authentication and other operations that depend on Windows Server Active Directory will also fail.</span></span> <span data-ttu-id="e044c-147">Aunque los usuarios podrán iniciar sesión con credenciales ya existentes almacenadas en caché, todos los intentos de autenticación de punto a punto o de cliente a servidor cuyos vales se tienen que emitir aún o se han quedado obsoletos, darán error.</span><span class="sxs-lookup"><span data-stu-id="e044c-147">While users may be able to sign in using existing cached credentials, all peer-to-peer or client-to-server authentication attempts for which tickets have yet to be issued or have become stale will fail.</span></span>

<span data-ttu-id="e044c-148">Consulte [Red virtual](http://azure.microsoft.com/documentation/services/virtual-network/) para ver una demostración en vídeo y una lista de tutoriales paso a paso, incluido [Creación de una red virtual con una conexión VPN de sitio a sitio mediante el Portal de Azure clásico](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span><span class="sxs-lookup"><span data-stu-id="e044c-148">See [Virtual Network](http://azure.microsoft.com/documentation/services/virtual-network/) for a demonstration video and a list of step-by-step tutorials, including [Configure a Site-to-Site VPN in the Azure portal](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span></span>

> [!NOTE]
> <span data-ttu-id="e044c-149">También puede implementar Windows Server Active Directory en una red virtual de Azure que no tenga conectividad con una red local.</span><span class="sxs-lookup"><span data-stu-id="e044c-149">You can also deploy Windows Server Active Directory on an Azure virtual network that does not have connectivity with an on-premises network.</span></span> <span data-ttu-id="e044c-150">Las instrucciones de este tema, sin embargo, dan por supuesto que se usa una red virtual de Azure, ya que esta proporciona funcionalidades de direccionamiento IP que son esenciales para Windows Server.</span><span class="sxs-lookup"><span data-stu-id="e044c-150">The guidelines in this topic, however, assume that an Azure virtual network is used because it provides IP addressing capabilities that are essential to Windows Server.</span></span>
> 
> 

### <a name="static-ip-addresses-must-be-configured-with-azure-powershell"></a><span data-ttu-id="e044c-151">Las direcciones IP estáticas se deben configurar con Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="e044c-151">Static IP addresses must be configured with Azure PowerShell.</span></span>
<span data-ttu-id="e044c-152">Las direcciones dinámicas se asignan de forma predeterminada, pero use el cmdlet Set-AzureStaticVNetIP para asignar una dirección IP estática en su lugar.</span><span class="sxs-lookup"><span data-stu-id="e044c-152">Dynamic addresses are allocated by default, but use the Set-AzureStaticVNetIP cmdlet to assign a static IP address instead.</span></span> <span data-ttu-id="e044c-153">Eso permitirá establecer una dirección IP estática que se mantendrá durante la recuperación del servicio y el cierre y reinicio de la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="e044c-153">That sets a static IP address that will persist through service healing and VM shutdown/restart.</span></span> <span data-ttu-id="e044c-154">Para más información, consulte [Static internal IP address for virtual machines (Dirección IP estática interna para máquinas virtuales)](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/).</span><span class="sxs-lookup"><span data-stu-id="e044c-154">For more information, see [Static internal IP address for virtual machines](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/).</span></span>

## <span data-ttu-id="e044c-155"><a name="BKMK_Glossary"></a>Términos y definiciones</span><span class="sxs-lookup"><span data-stu-id="e044c-155"><a name="BKMK_Glossary"></a>Terms and definitions</span></span>
<span data-ttu-id="e044c-156">La siguiente es una lista no exhaustiva de términos para diversas tecnologías de Azure a las que se hará referencia en este artículo.</span><span class="sxs-lookup"><span data-stu-id="e044c-156">The following is a non-exhaustive list of terms for various Azure technologies which will be referenced in this article.</span></span>

* <span data-ttu-id="e044c-157">**Máquinas virtuales de Azure**: la oferta de IaaS en Azure que permite a los clientes implementar máquinas virtuales que ejecutan casi cualquier carga de trabajo de servidor local tradicional.</span><span class="sxs-lookup"><span data-stu-id="e044c-157">**Azure virtual machines**: The IaaS offering in Azure that allows customers to deploy VMs running nearly any traditionally on-premises server workload.</span></span>
* <span data-ttu-id="e044c-158">**Red virtual de Azure**: servicio de red de Azure que permite a los clientes crear y administrar redes virtuales en Azure y vincularlas de forma segura a su propia infraestructura de red local mediante una red privada virtual (VPN).</span><span class="sxs-lookup"><span data-stu-id="e044c-158">**Azure virtual network**: The networking service in Azure that lets customers create and manage virtual networks in Azure and securely link them to their own on-premises networking infrastructure by using a virtual private network (VPN).</span></span>
* <span data-ttu-id="e044c-159">**Dirección IP virtual**: una dirección IP accesible desde Internet que no está enlazada a ninguna tarjeta de interfaz de red o equipo específicos.</span><span class="sxs-lookup"><span data-stu-id="e044c-159">**Virtual IP address**: An internet-facing IP address that is not bound to a specific computer or network interface card.</span></span> <span data-ttu-id="e044c-160">A los servicios en la nube se les asigna una dirección IP virtual para recibir el tráfico de red que se redirige a una máquina virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-160">Cloud services are assigned a virtual IP address for receiving network traffic which is redirected to an Azure VM.</span></span> <span data-ttu-id="e044c-161">Una dirección IP virtual es una propiedad de un servicio en la nube que puede contener una o más máquinas virtuales de Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-161">A virtual IP address is a property of a cloud-service which can contain one or more Azure virtual machines.</span></span> <span data-ttu-id="e044c-162">Tenga en cuenta que una red virtual de Azure puede contener uno o más servicios en la nube.</span><span class="sxs-lookup"><span data-stu-id="e044c-162">Also note that an Azure virtual network can contain one or more cloud-services.</span></span> <span data-ttu-id="e044c-163">Las direcciones IP virtuales proporcionan funcionalidades nativas de equilibrio de carga.</span><span class="sxs-lookup"><span data-stu-id="e044c-163">Virtual IP addresses provide native load-balancing capabilities.</span></span>
* <span data-ttu-id="e044c-164">**Dirección IP dinámica**: se trata de la dirección IP que solo es interna.</span><span class="sxs-lookup"><span data-stu-id="e044c-164">**Dynamic IP address**: This is the IP address that is internal only.</span></span> <span data-ttu-id="e044c-165">Se debe configurar como una dirección IP estática (mediante el cmdlet Set-AzureStaticVNetIP) para máquinas virtuales que hospedan los roles de servidor DC/DNS.</span><span class="sxs-lookup"><span data-stu-id="e044c-165">It should be configured as a static IP address (by using the Set-AzureStaticVNetIP cmdlet) for VMs that host the DC/DNS server roles.</span></span>
* <span data-ttu-id="e044c-166">**Recuperación del servicio**: proceso por el cual Azure devuelve automáticamente un servicio a un estado de ejecución después de detectar que tuvo errores.</span><span class="sxs-lookup"><span data-stu-id="e044c-166">**Service healing**: The process in which Azure automatically returns a service to a running state again after it detects that the service has failed.</span></span> <span data-ttu-id="e044c-167">La recuperación del servicio es uno de los aspectos de Azure que admite disponibilidad y resistencia.</span><span class="sxs-lookup"><span data-stu-id="e044c-167">Service healing is one of the aspects of Azure that supports availability and resiliency.</span></span> <span data-ttu-id="e044c-168">Aunque improbable, el resultado tras un incidente con recuperación del servicio para un controlador de dominio que se ejecuta en una máquina virtual es similar a un reinicio no planeado, pero tiene algunos efectos secundarios:</span><span class="sxs-lookup"><span data-stu-id="e044c-168">While unlikely, the result following a service healing incident for a DC running on a VM is similar to an unplanned reboot, but has a few side-effects:</span></span>
  
  * <span data-ttu-id="e044c-169">Cambiará el adaptador de red virtual en la máquina virtual cambiará</span><span class="sxs-lookup"><span data-stu-id="e044c-169">The virtual network adapter in the VM will change</span></span>
  * <span data-ttu-id="e044c-170">Cambiará la dirección MAC del adaptador de red virtual</span><span class="sxs-lookup"><span data-stu-id="e044c-170">The MAC address of the virtual network adapter will change</span></span>
  * <span data-ttu-id="e044c-171">Cambiará el identificador de procesador/CPU de la máquina virtual</span><span class="sxs-lookup"><span data-stu-id="e044c-171">The Processor/CPU ID of the VM will change</span></span>
  * <span data-ttu-id="e044c-172">La configuración de IP del adaptador de red virtual no cambiará siempre y cuando la máquina virtual esté conectada a una red virtual y la dirección IP de la máquina virtual sea estática.</span><span class="sxs-lookup"><span data-stu-id="e044c-172">The IP configuration of the virtual network adapter will not change as long as the VM is attached to a virtual network and the VM’s IP address is static.</span></span>
  
  <span data-ttu-id="e044c-173">Ninguno de estos comportamientos afecta a Windows Server Active Directory ya que no tiene ninguna dependencia de la dirección MAC ni del identificador de procesador/CPU, y es recomendable que todas las implementaciones de Windows Server Active Directory en Azure se ejecuten en una red virtual de Azure tal y como se ha descrito anteriormente.</span><span class="sxs-lookup"><span data-stu-id="e044c-173">None of these behaviors affect Windows Server Active Directory because it has no dependency on the MAC address or Processor/CPU ID, and all Windows Server Active Directory deployments on Azure are recommended to be run on an Azure virtual network as outlined above.</span></span>

## <a name="is-it-safe-to-virtualize-windows-server-active-directory-domain-controllers"></a><span data-ttu-id="e044c-174">¿Es seguro virtualizar los controladores de dominio de Windows Server Active Directory?</span><span class="sxs-lookup"><span data-stu-id="e044c-174">Is it safe to virtualize Windows Server Active Directory domain controllers?</span></span>
<span data-ttu-id="e044c-175">La implementación de controladores de dominio de Windows Server Active Directory en máquinas virtuales de Azure está sujeta a las mismas instrucciones que la ejecución de controladores de dominio locales en una máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="e044c-175">Deploying Windows Server Active Directory DCs on Azure virtual machines is subject to the same guidelines as running DCs on-premises in a virtual machine.</span></span> <span data-ttu-id="e044c-176">Ejecutar controladores de dominio virtualizados es una práctica segura siempre y cuando se sigan las instrucciones para realizar copias de seguridad y restaurar dichos controladores de dominio.</span><span class="sxs-lookup"><span data-stu-id="e044c-176">Running virtualized DCs is a safe practice as long as guidelines for backing up and restoring DCs are followed.</span></span> <span data-ttu-id="e044c-177">Para más información sobre las restricciones e instrucciones para ejecutar los controladores de dominio virtualizados, consulte [Controladores de dominio en ejecución en Hyper-V](https://technet.microsoft.com/library/dd363553).</span><span class="sxs-lookup"><span data-stu-id="e044c-177">For more information about constraints and guidelines for running virtualized DCs, see [Running Domain Controllers in Hyper-V](https://technet.microsoft.com/library/dd363553).</span></span>

<span data-ttu-id="e044c-178">Los hipervisores proporcionan o trivializan tecnologías que pueden causar problemas en muchos sistemas distribuidos, incluido Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e044c-178">Hypervisors provide or trivialize technologies that can cause problems for many distributed systems, including Windows Server Active Directory.</span></span> <span data-ttu-id="e044c-179">Por ejemplo, en un servidor físico, puede clonar un disco o usar métodos no admitidos para revertir el estado de un servidor, incluido el uso de varias SAN, etc, pero hacerlo en un servidor físico es mucho más difícil que restaurar una instantánea de máquina virtual en un hipervisor.</span><span class="sxs-lookup"><span data-stu-id="e044c-179">For example, on a physical server, you can clone a disk or use unsupported methods to roll back the state of a server, including using SANs and so on, but doing that on a physical server is much harder than restoring a virtual machine snapshot in a hypervisor.</span></span> <span data-ttu-id="e044c-180">Azure ofrece una funcionalidad que puede provocar la misma condición no deseada.</span><span class="sxs-lookup"><span data-stu-id="e044c-180">Azure offers functionality that can result in the same undesirable condition.</span></span> <span data-ttu-id="e044c-181">Por ejemplo, no debe copiar archivos VHD de controladores de dominio en lugar de realizar copias de seguridad periódicas ya que su restauración puede producir una situación similar al uso de características de restauración de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="e044c-181">For example, you should not copy VHD files of DCs instead of performing regular backups because restoring them can result in a similar situation to using snapshot restore features.</span></span>

<span data-ttu-id="e044c-182">Tales reversiones presentan burbujas de USN que pueden conducir a estados permanentemente divergentes entre controladores de dominio.</span><span class="sxs-lookup"><span data-stu-id="e044c-182">Such rollbacks introduce USN bubbles that can lead to permanently divergent states between DCs.</span></span> <span data-ttu-id="e044c-183">Esto puede provocar problemas como:</span><span class="sxs-lookup"><span data-stu-id="e044c-183">That can cause issues such as:</span></span>

* <span data-ttu-id="e044c-184">Objetos persistentes</span><span class="sxs-lookup"><span data-stu-id="e044c-184">Lingering objects</span></span>
* <span data-ttu-id="e044c-185">Contraseñas incoherentes</span><span class="sxs-lookup"><span data-stu-id="e044c-185">Inconsistent passwords</span></span>
* <span data-ttu-id="e044c-186">Valores de atributo incoherentes</span><span class="sxs-lookup"><span data-stu-id="e044c-186">Inconsistent attribute values</span></span>
* <span data-ttu-id="e044c-187">Discordancias de esquema si se revierte el maestro de esquema</span><span class="sxs-lookup"><span data-stu-id="e044c-187">Schema mismatches if the schema master is rolled back</span></span>

<span data-ttu-id="e044c-188">Para más información acerca de cómo afecta esto a los controladores de dominio, consulte [USN y reversión de USN](https://technet.microsoft.com/library/virtual_active_directory_domain_controller_virtualization_hyperv.aspx#usn_and_usn_rollback).</span><span class="sxs-lookup"><span data-stu-id="e044c-188">For more information about how DCs are impacted, see [USN and USN Rollback](https://technet.microsoft.com/library/virtual_active_directory_domain_controller_virtualization_hyperv.aspx#usn_and_usn_rollback).</span></span>

<span data-ttu-id="e044c-189">A partir de Windows Server 2012, [se han integrado medidas de seguridad adicionales en AD DS](https://technet.microsoft.com/library/hh831734.aspx).</span><span class="sxs-lookup"><span data-stu-id="e044c-189">Beginning with Windows Server 2012, [additional safeguards are built in to AD DS](https://technet.microsoft.com/library/hh831734.aspx).</span></span> <span data-ttu-id="e044c-190">Estas medidas de seguridad ayudan a proteger los controladores de dominio virtualizados frente a los problemas mencionados anteriormente, siempre y cuando la plataforma de hipervisor subyacente admita VM-GenerationID.</span><span class="sxs-lookup"><span data-stu-id="e044c-190">These safeguards help protect virtualized domain controllers against the aforementioned problems, as long as the underlying hypervisor platform supports VM-GenerationID.</span></span> <span data-ttu-id="e044c-191">Azure admite VM-GenerationID, lo que significa que los controladores de dominio que ejecutan Windows Server 2012 o posterior en máquinas virtuales disponen de las medidas de seguridad adicionales.</span><span class="sxs-lookup"><span data-stu-id="e044c-191">Azure supports VM-GenerationID, which means that domain controllers that run Windows Server 2012 or later on Azure virtual machines have the additional safeguards.</span></span>

> [!NOTE]
> <span data-ttu-id="e044c-192">Debe apagar y reiniciar la máquina virtual que ejecuta el rol de controlador de dominio en Azure dentro del sistema operativo invitado en lugar de utilizar la opción **Apagar** en Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="e044c-192">You should shut down and restart a VM that runs the domain controller role in Azure within the guest operating system instead of using the **Shut Down** option in the Azure porta.</span></span> <span data-ttu-id="e044c-193">Actualmente, el uso del portal para apagar una máquina virtual hace que la máquina virtual se desasigne.</span><span class="sxs-lookup"><span data-stu-id="e044c-193">Today, using the portal to shut down a VM causes the VM to be deallocated.</span></span> <span data-ttu-id="e044c-194">Una máquina virtual desasignada tiene la ventaja de no incurrir en gastos, pero también restablece el VM-GenerationID, lo cual es una situación no deseada para un controlador de dominio.</span><span class="sxs-lookup"><span data-stu-id="e044c-194">A deallocated VM has the advantage of not incurring charges, but it also resets the VM-GenerationID, which is undesirable for a DC.</span></span> <span data-ttu-id="e044c-195">Cuando se restablece el VM-GenerationID, también se restablece el invocationID de la base de datos de AD DS, se descarta el grupo RID y SYSVOL se marca como no autoritativo.</span><span class="sxs-lookup"><span data-stu-id="e044c-195">When the VM-GenerationID is reset, the invocationID of the AD DS database is also reset, the RID pool is discarded, and SYSVOL is marked as non-authoritative.</span></span> <span data-ttu-id="e044c-196">Para más información, consulte [Introducción a la virtualización de Active Directory Domain Services (AD DS)](https://technet.microsoft.com/library/hh831734.aspx) y [Safely Virtualizing DFSR](http://blogs.technet.com/b/filecab/archive/2013/04/05/safely-virtualizing-dfsr.aspx) (Virtualización segura de DFSR).</span><span class="sxs-lookup"><span data-stu-id="e044c-196">For more information, see [Introduction to Active Directory Domain Services (AD DS) Virtualization](https://technet.microsoft.com/library/hh831734.aspx) and [Safely Virtualizing DFSR](http://blogs.technet.com/b/filecab/archive/2013/04/05/safely-virtualizing-dfsr.aspx).</span></span>
> 
> 

## <a name="why-deploy-windows-server-ad-ds-on-azure-virtual-machines"></a><span data-ttu-id="e044c-197">¿Por qué implementar Windows Server AD DS en Máquinas virtuales de Azure?</span><span class="sxs-lookup"><span data-stu-id="e044c-197">Why deploy Windows Server AD DS on Azure Virtual Machines?</span></span>
<span data-ttu-id="e044c-198">Muchos escenarios de implementación de Windows Server AD DS son adecuados para la implementación como máquinas virtuales en Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-198">Many Windows Server AD DS deployment scenarios are well-suited for deployment as VMs on Azure.</span></span> <span data-ttu-id="e044c-199">Por ejemplo, suponga que tiene una compañía en Europa que necesita autenticar usuarios en una ubicación remota de Asia.</span><span class="sxs-lookup"><span data-stu-id="e044c-199">For example, suppose you have a company in Europe that needs to authenticate users in a remote location in Asia.</span></span> <span data-ttu-id="e044c-200">La compañía no ha implementado previamente controladores de dominio de Windows Server Active Directory en Asia debido al costo de implementación y a su poca experiencia para administrar el periodo posterior a la implementación de los servidores.</span><span class="sxs-lookup"><span data-stu-id="e044c-200">The company has not previously deployed Windows Server Active Directory DCs in Asia due to the cost to deploy them and limited expertise to manage the servers post-deployment.</span></span> <span data-ttu-id="e044c-201">Como resultado, los controladores de dominio en Europa atienden las solicitudes de autenticación de Asia con resultados poco óptimos.</span><span class="sxs-lookup"><span data-stu-id="e044c-201">As a result, authentication requests from Asia are serviced by DCs in Europe with suboptimal results.</span></span> <span data-ttu-id="e044c-202">En este caso, puede implementar un controlador de dominio en la máquina virtual que ha especificado que se debe ejecutar en el centro de datos de Azure en Asia.</span><span class="sxs-lookup"><span data-stu-id="e044c-202">In this case, you can deploy a DC on a VM that you have specified must be run within the Azure datacenter in Asia.</span></span> <span data-ttu-id="e044c-203">La asociación de ese controlador de dominio a una red virtual de Azure que esté conectada directamente a la ubicación remota mejorará el rendimiento de la autenticación.</span><span class="sxs-lookup"><span data-stu-id="e044c-203">Attaching that DC to an Azure virtual network that is connected directly to the remote location will improve authentication performance.</span></span>

<span data-ttu-id="e044c-204">Azure también resulta indicado como sustituto de sitios costosos de recuperación ante desastres (DR).</span><span class="sxs-lookup"><span data-stu-id="e044c-204">Azure is also well-suited as a substitute to otherwise costly disaster recovery (DR) sites.</span></span> <span data-ttu-id="e044c-205">El costo relativamente bajo de hospedar un número pequeño de controladores de dominio y una única red virtual en Azure constituye una alternativa atractiva.</span><span class="sxs-lookup"><span data-stu-id="e044c-205">The relatively low-cost of hosting a small number of domain controllers and a single virtual network on Azure represents an attractive alternative.</span></span>

<span data-ttu-id="e044c-206">Por último, puede que desee implementar una aplicación de red en Azure, como SharePoint, que requiere Windows Server Active Directory pero no tiene ninguna dependencia de la red local ni del Windows Server Active Directory corporativo.</span><span class="sxs-lookup"><span data-stu-id="e044c-206">Finally, you may want to deploy a network application on Azure, such as SharePoint, that requires Windows Server Active Directory but has no dependency on the on-premises network or the corporate Windows Server Active Directory.</span></span> <span data-ttu-id="e044c-207">En este caso, la implementación de un bosque aislado en Azure para cumplir los requisitos del servidor de SharePoint es óptima.</span><span class="sxs-lookup"><span data-stu-id="e044c-207">In this case, deploying an isolated forest on Azure to meet the SharePoint server’s requirements is optimal.</span></span> <span data-ttu-id="e044c-208">De nuevo, también se admite la implementación de aplicaciones de red que requieren conectividad con la red local y el Active Directory corporativo.</span><span class="sxs-lookup"><span data-stu-id="e044c-208">Again, deploying network applications that do require connectivity to the on-premises network and the corporate Active Directory is also supported.</span></span>

> [!NOTE]
> <span data-ttu-id="e044c-209">Como ofrece una conexión de nivel 3, el componente VPN que proporciona conectividad entre una red virtual de Azure y una red local también puede habilitar a los servidores miembro que se ejecutan de forma local para que aprovechen los controladores de dominio que se ejecutan como máquinas virtuales en la red virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-209">Since it provides a layer-3 connection, the VPN component that provides connectivity between an Azure virtual network and an on-premises network can also enable member servers that run on-premises to leverage DCs that run as Azure virtual machines on Azure virtual network.</span></span> <span data-ttu-id="e044c-210">Pero si la VPN no está disponible, la comunicación entre equipos locales y los controladores de dominio basados en Azure no funcionará, lo cual provocará errores de autenticación y otros varios.</span><span class="sxs-lookup"><span data-stu-id="e044c-210">But if the VPN is unavailable, communication between on-premises computers and Azure-based domain controllers will not function, resulting in authentication and various other errors.</span></span>  
> 
> 

## <a name="contrasts-between-deploying-windows-server-active-directory-domain-controllers-on-azure-virtual-machines-versus-on-premises"></a><span data-ttu-id="e044c-211">Diferencias entre implementar controladores de dominio de Windows Server Active Directory en máquinas virtuales de Azure o hacerlo de forma local</span><span class="sxs-lookup"><span data-stu-id="e044c-211">Contrasts between deploying Windows Server Active Directory domain controllers on Azure Virtual Machines versus on-premises</span></span>
* <span data-ttu-id="e044c-212">En cualquier escenario de implementación de Windows Server Active Directory que incluya más de una máquina virtual, es necesario utilizar una red virtual para que las direcciones IP sean coherentes.</span><span class="sxs-lookup"><span data-stu-id="e044c-212">For any Windows Server Active Directory deployment scenario that includes more than a single VM, it is necessary to use an Azure virtual network for IP address consistency.</span></span> <span data-ttu-id="e044c-213">Tenga en cuenta que en esta guía se supone que los controladores de dominio se ejecutan en una red virtual.</span><span class="sxs-lookup"><span data-stu-id="e044c-213">Note that this guide assumes that DCs are running on an Azure virtual network.</span></span>
* <span data-ttu-id="e044c-214">Al igual que con los controladores de dominio locales, se recomiendan direcciones IP estáticas.</span><span class="sxs-lookup"><span data-stu-id="e044c-214">As with on-premises DCs, static IP addresses are recommended.</span></span> <span data-ttu-id="e044c-215">Una dirección IP estática solo se puede configurar mediante Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="e044c-215">A static IP address can only be configured by using Azure PowerShell.</span></span> <span data-ttu-id="e044c-216">Para más detalles, consulte [Static internal IP address for VMs (Dirección IP estática interna para máquinas virtuales)](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/) .</span><span class="sxs-lookup"><span data-stu-id="e044c-216">See [Static internal IP address for VMs](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/) for more details.</span></span> <span data-ttu-id="e044c-217">Si tiene sistemas de supervisión u otras soluciones que comprueban la configuración de la dirección IP estática en el sistema operativo invitado, puede asignar la misma dirección IP estática a las propiedades del adaptador de red de la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="e044c-217">If you have monitoring systems or other solutions that check for static IP address configuration within the guest operating system, you can assign the same static IP address to the network adapter properties of the VM.</span></span> <span data-ttu-id="e044c-218">Pero tenga en cuenta que el adaptador de red se descartará si la máquina virtual se somete a recuperación del servicio o se cierra en el portal y se desasigna su dirección.</span><span class="sxs-lookup"><span data-stu-id="e044c-218">But be aware that the network adapter will be discarded if the VM undergoes service healing or is shut down in the portal and has its address deallocated.</span></span> <span data-ttu-id="e044c-219">En ese caso, tendrá que restablecer la dirección IP estática del sistema operativo invitado.</span><span class="sxs-lookup"><span data-stu-id="e044c-219">In that case, the static IP address within the guest will need to be reset.</span></span>
* <span data-ttu-id="e044c-220">La implementación de máquinas virtuales en una red virtual no implica (ni requiere) conectividad a una red local; la red virtual simplemente habilita esa posibilidad.</span><span class="sxs-lookup"><span data-stu-id="e044c-220">Deploying VMs on a virtual network does not imply (or require) connectivity back to an on-premises network; the virtual network merely enables that possibility.</span></span> <span data-ttu-id="e044c-221">Debe crear una red virtual para la comunicación privada entre Azure y la red local.</span><span class="sxs-lookup"><span data-stu-id="e044c-221">You must create a virtual network for private communication between Azure and your on-premises network.</span></span> <span data-ttu-id="e044c-222">Debe implementar un punto de conexión de VPN en la red local.</span><span class="sxs-lookup"><span data-stu-id="e044c-222">You need to deploy a VPN endpoint on the on-premises network.</span></span> <span data-ttu-id="e044c-223">La VPN está abierta desde Azure a la red local.</span><span class="sxs-lookup"><span data-stu-id="e044c-223">The VPN is opened from Azure to the on-premises network.</span></span> <span data-ttu-id="e044c-224">Para más información, consulte [Información general sobre redes virtuales](../virtual-network/virtual-networks-overview.md) y [Creación de una red virtual con una conexión VPN de sitio a sitio mediante el Portal de Azure clásico](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span><span class="sxs-lookup"><span data-stu-id="e044c-224">For more information, see [Virtual Network Overview](../virtual-network/virtual-networks-overview.md) and [Configure a Site-to-Site VPN in the Azure Portal](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span></span>

> [!NOTE]
> <span data-ttu-id="e044c-225">Hay una opción disponible para [crear una VPN de punto a sitio](../vpn-gateway/vpn-gateway-point-to-site-create.md) para conectar equipos individuales basados en Windows directamente a una red virtual.</span><span class="sxs-lookup"><span data-stu-id="e044c-225">An option to [create a point-to-site VPN](../vpn-gateway/vpn-gateway-point-to-site-create.md) is available to connect individual Windows-based computers directly to an Azure virtual network.</span></span>
> 
> 

* <span data-ttu-id="e044c-226">Independientemente de si crea una red virtual o no, Azure cobrará por el tráfico de salida, pero no por el de entrada.</span><span class="sxs-lookup"><span data-stu-id="e044c-226">Regardless of whether you create a virtual network or not, Azure charges for egress traffic but not ingress.</span></span> <span data-ttu-id="e044c-227">Varias opciones de diseño de Windows Server Active Directory pueden influir en cuánto tráfico de salida genera una implementación.</span><span class="sxs-lookup"><span data-stu-id="e044c-227">Various Windows Server Active Directory design choices can affect how much egress traffic is generated by a deployment.</span></span> <span data-ttu-id="e044c-228">Por ejemplo, la implementación de un controlador de dominio de solo lectura (RODC) limita el tráfico de salida ya que no replica datos de salida.</span><span class="sxs-lookup"><span data-stu-id="e044c-228">For example, deploying a read-only domain controller (RODC) limits egress traffic because it does not replicate outbound.</span></span> <span data-ttu-id="e044c-229">Pero la decisión de implementar un RODC se debe sopesar en comparación con la necesidad de realizar operaciones de escritura en el controlador de dominio y la [compatibilidad](https://technet.microsoft.com/library/cc755190) que las aplicaciones y servicios del sitio tienen con los RODC.</span><span class="sxs-lookup"><span data-stu-id="e044c-229">But the decision to deploy an RODC needs to be weighed against the need to perform write operations against the DC and the [compatibility](https://technet.microsoft.com/library/cc755190) that applications and services in the site have with RODCs.</span></span> <span data-ttu-id="e044c-230">Para más información acerca de los gastos por tráfico, consulte [Precios de Azure](http://azure.microsoft.com/pricing/).</span><span class="sxs-lookup"><span data-stu-id="e044c-230">For more information about traffic charges, see [Azure pricing at-a-glance](http://azure.microsoft.com/pricing/).</span></span>
* <span data-ttu-id="e044c-231">Aunque tiene un control completo sobre qué recursos del servidor utilizará para las máquinas virtuales de forma local, como la RAM, el tamaño de disco, etc., en Azure debe seleccionar de una lista de tamaños preconfigurados de servidor.</span><span class="sxs-lookup"><span data-stu-id="e044c-231">While you have complete control over what server resources to use for VMs on-premises, such as RAM, disk size, and so on, on Azure you must select from a list of preconfigured server sizes.</span></span> <span data-ttu-id="e044c-232">Para un controlador de dominio, se necesita un disco de datos además del disco de sistema operativo para almacenar la base de datos de Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e044c-232">For a DC, a data disk is needed in addition to the operating system disk in order to store the Windows Server Active Directory database.</span></span>

## <a name="can-you-deploy-windows-server-ad-fs-on-azure-virtual-machines"></a><span data-ttu-id="e044c-233">¿Se puede implementar Windows Server AD FS en Máquinas virtuales de Azure?</span><span class="sxs-lookup"><span data-stu-id="e044c-233">Can you deploy Windows Server AD FS on Azure virtual machines?</span></span>
<span data-ttu-id="e044c-234">Sí, puede implementar Windows Server AD FS en Máquinas virtuales de Azure y los [procedimientos recomendados para la implementación de AD FS](https://technet.microsoft.com/library/dn151324.aspx) de forma local son aplicables igualmente a la implementación de AD FS en Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-234">Yes, you can deploy Windows Server AD FS on Azure virtual machines, and the [best practices for AD FS deployment](https://technet.microsoft.com/library/dn151324.aspx) on-premises apply equally to AD FS deployment on Azure.</span></span> <span data-ttu-id="e044c-235">Pero algunos de los procedimientos recomendados, como el equilibrio de carga y la alta disponibilidad, requieren tecnologías que van más allá de lo que ofrece AD FS.</span><span class="sxs-lookup"><span data-stu-id="e044c-235">But some of the best practices such as load balancing and high availability require technologies beyond what AD FS offers itself.</span></span> <span data-ttu-id="e044c-236">Estas las debe proporcionar la infraestructura subyacente.</span><span class="sxs-lookup"><span data-stu-id="e044c-236">They must be provided by the underlying infrastructure.</span></span> <span data-ttu-id="e044c-237">Vamos a revisar algunos de los procedimientos recomendados y a ver cómo pueden lograrse mediante el uso de Máquinas virtuales de Azure y una red virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-237">Let’s review some of those best practices and see how they can be achieved by using Azure VMs and an Azure virtual network.</span></span>

1. <span data-ttu-id="e044c-238">**Nunca exponga los servidores del servicio de token de seguridad (STS) directamente a Internet.**</span><span class="sxs-lookup"><span data-stu-id="e044c-238">**Never expose security token service (STS) servers directly to the Internet.**</span></span>
   
    <span data-ttu-id="e044c-239">Esto es importante porque el STS emite tokens de seguridad.</span><span class="sxs-lookup"><span data-stu-id="e044c-239">This is important because the STS issues security tokens.</span></span> <span data-ttu-id="e044c-240">Como resultado, los servidores de STS como, por ejemplo, los servidores de AD FS se deben tratar con el mismo nivel de protección que un controlador de dominio.</span><span class="sxs-lookup"><span data-stu-id="e044c-240">As a result, STS servers such as AD FS servers should be treated with the same level of protection as a domain controller.</span></span> <span data-ttu-id="e044c-241">Si un STS está en peligro, los usuarios malintencionados tendrán la capacidad de emitir tokens de acceso que potencialmente contienen notificaciones de su elección para aplicaciones de usuario de confianza y servidores STS en organizaciones de confianza.</span><span class="sxs-lookup"><span data-stu-id="e044c-241">If an STS is compromised, malicious users have the ability to issue access tokens potentially containing claims of their choosing to relying party applications and other STS servers in trusting organizations.</span></span>
2. <span data-ttu-id="e044c-242">**Implemente controladores de dominio de Active Directory para todos los dominios de usuario en la misma red que los servidores de AD FS.**</span><span class="sxs-lookup"><span data-stu-id="e044c-242">**Deploy Active Directory domain controllers for all user domains in the same network as the AD FS servers.**</span></span>
   
    <span data-ttu-id="e044c-243">Los servidores de AD FS utilizan los servicios de Dominio de Active Directory para autenticar usuarios.</span><span class="sxs-lookup"><span data-stu-id="e044c-243">AD FS servers use Active Directory Domain Services to authenticate users.</span></span> <span data-ttu-id="e044c-244">Se recomienda implementar controladores de dominio en la misma red que los servidores de AD FS.</span><span class="sxs-lookup"><span data-stu-id="e044c-244">It is recommended to deploy domain controllers on the same network as the AD FS servers.</span></span> <span data-ttu-id="e044c-245">Esto garantiza la continuidad del negocio en caso de se rompa el vínculo entre la red de Azure y la red local y permite un mayor rendimiento y una menor latencia en los inicios de sesión.</span><span class="sxs-lookup"><span data-stu-id="e044c-245">This provides business continuity in case the link between the Azure network and your on-premises network is broken, and enables lower latency and increased performance for logins.</span></span>
3. <span data-ttu-id="e044c-246">**Implemente varios nodos de AD FS para obtener alta disponibilidad y equilibrar la carga.**</span><span class="sxs-lookup"><span data-stu-id="e044c-246">**Deploy multiple AD FS nodes for high availability and balancing the load.**</span></span>
   
    <span data-ttu-id="e044c-247">En la mayoría de los casos, no es aceptable un error de una aplicación que habilita AD FS ya que las aplicaciones que requieren tokens de seguridad son a menudo críticas.</span><span class="sxs-lookup"><span data-stu-id="e044c-247">In most cases, the failure of an application that AD FS enables is unacceptable because the applications that require security tokens are often mission critical.</span></span> <span data-ttu-id="e044c-248">Como consecuencia, y como AD FS ahora reside en la ruta crítica para tener acceso a aplicaciones críticas, el servicio AD FS debe tener alta disponibilidad a través de varios servidores proxy de AD FS y servidores de AD FS.</span><span class="sxs-lookup"><span data-stu-id="e044c-248">As a result, and because AD FS now resides in the critical path to accessing mission critical applications, the AD FS service must be highly available through multiple AD FS proxies and AD FS servers.</span></span> <span data-ttu-id="e044c-249">Para lograr la distribución de solicitudes, se implementan normalmente equilibradores de carga delante de los servidores proxy de AD FS y de los servidores de AD FS.</span><span class="sxs-lookup"><span data-stu-id="e044c-249">To achieve distribution of requests, load balancers are typically deployed in front of both the AD FS Proxies and the AD FS servers.</span></span>
4. <span data-ttu-id="e044c-250">**Implemente uno o más nodos de proxy de aplicación web para acceder a Internet.**</span><span class="sxs-lookup"><span data-stu-id="e044c-250">**Deploy one or more Web Application Proxy nodes for internet access.**</span></span>
   
    <span data-ttu-id="e044c-251">Cuando los usuarios necesitan tener acceso a aplicaciones protegidas por el servicio AD FS, este servicio debe estar disponible desde Internet.</span><span class="sxs-lookup"><span data-stu-id="e044c-251">When users need to access applications protected by the AD FS service, the AD FS service needs to be available from the internet.</span></span> <span data-ttu-id="e044c-252">Esto se consigue mediante la implementación del servicio de proxy de aplicación web.</span><span class="sxs-lookup"><span data-stu-id="e044c-252">This is achieved by deploying the Web Application Proxy service.</span></span> <span data-ttu-id="e044c-253">Se recomienda encarecidamente implementar más de un nodo para obtener una alta disponibilidad y el equilibrio de carga.</span><span class="sxs-lookup"><span data-stu-id="e044c-253">It is strongly recommended to deploy more than one node for the purposes of high availability and load balancing.</span></span>
5. <span data-ttu-id="e044c-254">**Restrinja el acceso de los nodos de proxy de aplicación web a los recursos internos de red.**</span><span class="sxs-lookup"><span data-stu-id="e044c-254">**Restrict access from the Web Application Proxy nodes to internal network resources.**</span></span>
   
    <span data-ttu-id="e044c-255">Para permitir que los usuarios externos accedan a AD FS desde internet, debe implementar nodos de proxy de aplicación web (o proxy de AD FS en versiones anteriores de Windows Server).</span><span class="sxs-lookup"><span data-stu-id="e044c-255">To allow external users to access AD FS from the internet, you need to deploy Web Application Proxy nodes (or AD FS Proxy in earlier versions of Windows Server).</span></span> <span data-ttu-id="e044c-256">Los nodos de proxy de aplicación web se exponen directamente a Internet.</span><span class="sxs-lookup"><span data-stu-id="e044c-256">The Web Application proxy nodes are directly exposed to the Internet.</span></span> <span data-ttu-id="e044c-257">No tienen que estar unidos al dominio y solo necesitan acceso a los servidores de AD FS a través de los puertos TCP 443 y 80.</span><span class="sxs-lookup"><span data-stu-id="e044c-257">They are not required to be domain-joined and they only need access to the AD FS servers over TCP ports 443 and 80.</span></span> <span data-ttu-id="e044c-258">Se recomienda encarecidamente que se bloquee la comunicación con cualquier otro equipo (especialmente los controladores de dominio).</span><span class="sxs-lookup"><span data-stu-id="e044c-258">It is strongly recommended that communication to all other computers (especially domain controllers) is blocked.</span></span>
   
    <span data-ttu-id="e044c-259">Este se consigue normalmente de forma local mediante una red perimetral.</span><span class="sxs-lookup"><span data-stu-id="e044c-259">This is typically achieved on-premises by means of a DMZ.</span></span> <span data-ttu-id="e044c-260">Los firewalls usan un modo de funcionamiento mediante lista blanca para restringir el tráfico desde la red perimetral a la red local (es decir, solo se permite el tráfico desde direcciones IP especificadas y a través de los puertos especificados y se bloquea el resto del tráfico).</span><span class="sxs-lookup"><span data-stu-id="e044c-260">Firewalls use a whitelist mode of operation to restrict traffic from the DMZ to the on-premises network (that is, only traffic from the specified IP addresses and over specified ports is allowed, and all other traffic is blocked).</span></span>

<span data-ttu-id="e044c-261">El siguiente diagrama muestra una implementación tradicional de AD FS de forma local.</span><span class="sxs-lookup"><span data-stu-id="e044c-261">The following diagram shows a traditional on-premises AD FS deployment.</span></span>

![Diagrama de una implementación tradicional de servicios de federación de Active Directory de forma local](media/active-directory-deploying-ws-ad-guidelines/ADFS_onprem.png)

<span data-ttu-id="e044c-263">Sin embargo, dado que Azure no proporciona una funcionalidad nativa de firewall completa, se deben utilizar otras opciones para restringir el tráfico.</span><span class="sxs-lookup"><span data-stu-id="e044c-263">However, because Azure does not provide native, full-featured firewall capability, other options need to be used to restrict traffic.</span></span> <span data-ttu-id="e044c-264">La siguiente tabla muestra cada opción y sus ventajas e inconvenientes.</span><span class="sxs-lookup"><span data-stu-id="e044c-264">The following table shows each option and its advantages and disadvantages.</span></span>

| <span data-ttu-id="e044c-265">Opción</span><span class="sxs-lookup"><span data-stu-id="e044c-265">Option</span></span> | <span data-ttu-id="e044c-266">Ventaja</span><span class="sxs-lookup"><span data-stu-id="e044c-266">Advantage</span></span> | <span data-ttu-id="e044c-267">Desventaja</span><span class="sxs-lookup"><span data-stu-id="e044c-267">Disadvantage</span></span> |
| --- | --- | --- |
| [<span data-ttu-id="e044c-268">ACL de red de Azure</span><span class="sxs-lookup"><span data-stu-id="e044c-268">Azure network ACLs</span></span>](../virtual-network/virtual-networks-acl.md) |<span data-ttu-id="e044c-269">Configuración inicial menos costosa y más sencilla</span><span class="sxs-lookup"><span data-stu-id="e044c-269">Less costly and simpler initial configuration</span></span> |<span data-ttu-id="e044c-270">Se necesita configuración adicional de ACL de red si se agregan nuevas máquinas virtuales a la implementación</span><span class="sxs-lookup"><span data-stu-id="e044c-270">Additional network ACL configuration required if any new VMs are added to the deployment</span></span> |
| [<span data-ttu-id="e044c-271">Barracuda NG Firewall</span><span class="sxs-lookup"><span data-stu-id="e044c-271">Barracuda NG firewall</span></span>](https://www.barracuda.com/products/ngfirewall) |<span data-ttu-id="e044c-272">Modo de funcionamiento mediante lista blanca y no requiere ninguna configuración de ACL de red</span><span class="sxs-lookup"><span data-stu-id="e044c-272">Whitelist mode of operation and it requires no network ACL configuration</span></span> |<span data-ttu-id="e044c-273">Aumento del costo y la complejidad de la instalación inicial</span><span class="sxs-lookup"><span data-stu-id="e044c-273">Increased cost and complexity for initial setup</span></span> |

<span data-ttu-id="e044c-274">En este caso, los pasos para implementar AD FS son los siguientes:</span><span class="sxs-lookup"><span data-stu-id="e044c-274">The high-level steps to deploy AD FS in this case are as follows:</span></span>

1. <span data-ttu-id="e044c-275">Crear una red virtual con conectividad entre locales, mediante una VPN o mediante [ExpressRoute](http://azure.microsoft.com/services/expressroute/).</span><span class="sxs-lookup"><span data-stu-id="e044c-275">Create a virtual network with cross-premises connectivity, using either a VPN or [ExpressRoute](http://azure.microsoft.com/services/expressroute/).</span></span>
2. <span data-ttu-id="e044c-276">Implementar controladores de dominio en la red virtual.</span><span class="sxs-lookup"><span data-stu-id="e044c-276">Deploy domain controllers on the virtual network.</span></span> <span data-ttu-id="e044c-277">Este paso es opcional pero recomendable.</span><span class="sxs-lookup"><span data-stu-id="e044c-277">This step is optional but recommended.</span></span>
3. <span data-ttu-id="e044c-278">Implementar servidores de AD FS unidos a dominio en la red virtual.</span><span class="sxs-lookup"><span data-stu-id="e044c-278">Deploy domain-joined AD FS servers on the virtual network.</span></span>
4. <span data-ttu-id="e044c-279">Crear un [conjunto con equilibrio de carga interno](http://azure.microsoft.com/blog/internal-load-balancing/) que incluya los servidores de AD FS y use una nueva dirección IP privada dentro de la red virtual (una dirección IP dinámica).</span><span class="sxs-lookup"><span data-stu-id="e044c-279">Create an [internal load balanced set](http://azure.microsoft.com/blog/internal-load-balancing/) that includes the AD FS servers and uses a new private IP address within the virtual network (a dynamic IP address).</span></span>
   
   1. <span data-ttu-id="e044c-280">Actualizar el DNS para crear el FQDN que señale a la dirección IP (dinámica) privada del conjunto con equilibrio de carga interno.</span><span class="sxs-lookup"><span data-stu-id="e044c-280">Update DNS to create the FQDN to point to the private (dynamic) IP address of the internal load balanced set.</span></span>
5. <span data-ttu-id="e044c-281">Crear un servicio en la nube (o una red virtual independiente) para los nodos de proxy de la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="e044c-281">Create a cloud service (or a separate virtual network) for the Web Application Proxy nodes.</span></span>
6. <span data-ttu-id="e044c-282">Implementar los nodos de proxy de la aplicación web en el servicio en la nube o en la red virtual</span><span class="sxs-lookup"><span data-stu-id="e044c-282">Deploy the Web Application Proxy nodes in the cloud service or virtual network</span></span>
   
   1. <span data-ttu-id="e044c-283">Crear un conjunto con equilibrio de carga externo que incluya los nodos de proxy de la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="e044c-283">Create an external load balanced set that includes the Web Application Proxy nodes.</span></span>
   2. <span data-ttu-id="e044c-284">Actualice el nombre DNS externo (FQDN) para que señale a la dirección IP pública del servicio en la nube (la dirección IP virtual).</span><span class="sxs-lookup"><span data-stu-id="e044c-284">Update the external DNS name (FQDN) to point to the cloud service public IP address (the virtual IP address).</span></span>
   3. <span data-ttu-id="e044c-285">Configurar los proxy de AD FS para que usen el FQDN que corresponde al conjunto con equilibrio de carga interno para los servidores de AD FS.</span><span class="sxs-lookup"><span data-stu-id="e044c-285">Configure AD FS proxies to use the FQDN that corresponds to the internal load balanced set for the AD FS servers.</span></span>
   4. <span data-ttu-id="e044c-286">Actualizar sitios web basados en notificaciones para utilizar el FQDN para su proveedor de notificaciones.</span><span class="sxs-lookup"><span data-stu-id="e044c-286">Update claims-based web sites to use the external FQDN for their claims provider.</span></span>
7. <span data-ttu-id="e044c-287">Restringir el acceso entre el proxy de la aplicación web y todos los equipos de la red virtual de AD FS.</span><span class="sxs-lookup"><span data-stu-id="e044c-287">Restrict access between Web Application Proxy to any machine in the AD FS virtual network.</span></span>

<span data-ttu-id="e044c-288">Para restringir el tráfico, el conjunto con equilibrio de carga establecido para el equilibrador de carga interno de Azure se debe configurar para el tráfico solo hacia los puertos TCP 80 y 443, y se elimina el resto del tráfico a la dirección IP dinámica interna del conjunto con equilibrio de carga.</span><span class="sxs-lookup"><span data-stu-id="e044c-288">To restrict traffic, the load-balanced set for the Azure internal load balancer needs to be configured for only traffic to TCP ports 80 and 443, and all other traffic to the internal dynamic IP address of the load balanced set is dropped.</span></span>

![Diagrama de las ACL de red de ADFS con TCP 443 + 80 permitido.](media/active-directory-deploying-ws-ad-guidelines/ADFS_ACLs.png)

<span data-ttu-id="e044c-290">El tráfico hacia los servidores de AD FS se le permite únicamente a través de los siguientes orígenes:</span><span class="sxs-lookup"><span data-stu-id="e044c-290">Traffic to the AD FS servers would be permitted only by the following sources:</span></span>

* <span data-ttu-id="e044c-291">El equilibrador de carga interno de Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-291">The Azure internal load balancer.</span></span>
* <span data-ttu-id="e044c-292">La dirección IP de un administrador de la red local.</span><span class="sxs-lookup"><span data-stu-id="e044c-292">The IP address of an administrator on the on-premises network.</span></span>

> [!WARNING]
> <span data-ttu-id="e044c-293">El diseño debe impedir que los nodos de proxy de la aplicación web lleguen a otras máquinas virtuales de la red virtual de Azure o a cualquier otra ubicación en la red local.</span><span class="sxs-lookup"><span data-stu-id="e044c-293">The design must prevent Web Application Proxy nodes from reaching any other VMs in the Azure virtual network or any locations on the on-premises network.</span></span> <span data-ttu-id="e044c-294">Esto se puede hacer mediante la configuración de reglas de firewall en la aplicación local para las conexiones de Express Route o en el dispositivo VPN para las conexiones VPN de sitio a sitio.</span><span class="sxs-lookup"><span data-stu-id="e044c-294">That can be done by configuring firewall rules in the on-premises appliance for Express Route connections or the VPN device for site-to-site VPN connections.</span></span>
> 
> 

<span data-ttu-id="e044c-295">Una desventaja de esta opción es la necesidad de configurar las ACL de red para varios dispositivos, incluidos el equilibrador de carga interno, los servidores de AD FS y cualquier otro servidor que se agregue a la red virtual.</span><span class="sxs-lookup"><span data-stu-id="e044c-295">A disadvantage to this option is the need to configure the network ACLs for multiple devices, including internal load balancer, the AD FS servers, and any other servers that get added to the virtual network.</span></span> <span data-ttu-id="e044c-296">Si se agrega cualquier dispositivo a la implementación sin configurar las ACL de red para restringir el tráfico hacia la misma, toda la implementación puede estar en peligro.</span><span class="sxs-lookup"><span data-stu-id="e044c-296">If any device is added to the deployment without configuring network ACLs to restrict traffic to it, the entire deployment can be at risk.</span></span> <span data-ttu-id="e044c-297">Si alguna vez cambian las direcciones IP de los nodos de proxy de aplicación web, se deben restablecer las ACL de red (lo que significa que los proxy se deben configurar para usar [direcciones IP dinámicas estáticas](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/)).</span><span class="sxs-lookup"><span data-stu-id="e044c-297">If the IP addresses of the Web Application Proxy nodes ever change, the network ACLs must be reset (which means the proxies should be configured to use [static dynamic IP addresses](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/)).</span></span>

![ADFS en Azure con ACL de red.](media/active-directory-deploying-ws-ad-guidelines/ADFS_Azure.png)

<span data-ttu-id="e044c-299">Otra opción consiste en utilizar la aplicación [Barracuda NG Firewall](https://www.barracuda.com/products/ngfirewall) para controlar el tráfico entre los servidores proxy de AD FS y los servidores de AD FS.</span><span class="sxs-lookup"><span data-stu-id="e044c-299">Another option is to use the [Barracuda NG Firewall](https://www.barracuda.com/products/ngfirewall) appliance to control traffic between AD FS proxy servers and the AD FS servers.</span></span> <span data-ttu-id="e044c-300">Esta opción cumple con los procedimientos recomendados de seguridad y alta disponibilidad y requiere menos administración después de la instalación inicial ya que la aplicación Barracuda NG Firewall proporciona un modo de administración del firewall mediante lista blanca y se puede instalar directamente en una red virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-300">This option complies with best practices for security and high availability, and requires less administration after the initial setup because the Barracuda NG Firewall appliance provides a whitelist mode of firewall administration and it can be installed directly on an Azure virtual network.</span></span> <span data-ttu-id="e044c-301">Esto elimina la necesidad de configurar las ACL de red siempre que se agrega un nuevo servidor a la implementación.</span><span class="sxs-lookup"><span data-stu-id="e044c-301">That eliminates the need to configure network ACLs any time a new server is added to the deployment.</span></span> <span data-ttu-id="e044c-302">Pero esta opción agrega complejidad y costo a la implementación inicial.</span><span class="sxs-lookup"><span data-stu-id="e044c-302">But this option adds initial deployment complexity and cost.</span></span>

<span data-ttu-id="e044c-303">En este caso, se implementan dos redes virtuales en lugar de una.</span><span class="sxs-lookup"><span data-stu-id="e044c-303">In this case, two virtual networks are deployed instead of one.</span></span> <span data-ttu-id="e044c-304">Las llamaremos VNet1 y VNet2.</span><span class="sxs-lookup"><span data-stu-id="e044c-304">We'll call them VNet1 and VNet2.</span></span> <span data-ttu-id="e044c-305">VNet1 contiene los proxy y VNet2 los STS y la conexión de red a la red corporativa.</span><span class="sxs-lookup"><span data-stu-id="e044c-305">VNet1 contains the proxies and VNet2 contains the STSs and the network connection back to the corporate network.</span></span> <span data-ttu-id="e044c-306">VNet1 está, por tanto, físicamente (o mejor dicho, virtualmente) aislada de VNet2 y, a su vez, de la red corporativa.</span><span class="sxs-lookup"><span data-stu-id="e044c-306">VNet1 is therefore physically (albeit virtually) isolated from VNet2 and, in turn, from the corporate network.</span></span> <span data-ttu-id="e044c-307">A continuación, VNet1 se conecta a VNet2 mediante una tecnología especial de tunelización conocida como arquitectura de red independiente de transporte (TINA).</span><span class="sxs-lookup"><span data-stu-id="e044c-307">VNet1 is then connected to VNet2 using a special tunneling technology known as Transport Independent Network Architecture (TINA).</span></span> <span data-ttu-id="e044c-308">La tunelización TINA se asocia a cada una de las redes virtuales mediante la aplicación Barracuda NG Firewall: una aplicación Barracuda en cada una de las redes virtuales.</span><span class="sxs-lookup"><span data-stu-id="e044c-308">The TINA tunnel is attached to each of the virtual networks using a Barracuda NG firewall—one Barracuda on each of the virtual networks.</span></span>  <span data-ttu-id="e044c-309">Para obtener una alta disponibilidad, se recomienda que implemente dos aplicaciones Barracuda en cada red virtual, una activa, la otra pasiva.</span><span class="sxs-lookup"><span data-stu-id="e044c-309">For high-availability, it is recommended that you deploy two Barracudas on each virtual network; one active, the other passive.</span></span> <span data-ttu-id="e044c-310">Ofrecen una funcionalidad de firewall muy potente que nos permite imitar el funcionamiento de una red perimetral local tradicional en Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-310">They offer extremely rich firewalling capabilities which allow us to mimic the operation of a traditional on-premises DMZ in Azure.</span></span>

![ADFS en Azure con firewall.](media/active-directory-deploying-ws-ad-guidelines/ADFS_Azure_firewall.png)

<span data-ttu-id="e044c-312">Para obtener más información, consulte [AD FS: expansión de una aplicación front-end local de notificaciones a Internet](#BKMK_CloudOnlyFed).</span><span class="sxs-lookup"><span data-stu-id="e044c-312">For more information, see [AD FS: Extend a claims-aware on-premises front-end application to the Internet](#BKMK_CloudOnlyFed).</span></span>

### <a name="an-alternative-to-ad-fs-deployment-if-the-goal-is-office-365-sso-alone"></a><span data-ttu-id="e044c-313">Alternativa a la implementación de AD FS si el objetivo es solo el inicio de sesión único para Office 365</span><span class="sxs-lookup"><span data-stu-id="e044c-313">An alternative to AD FS deployment if the goal is Office 365 SSO alone</span></span>
<span data-ttu-id="e044c-314">Hay otra alternativa a la implementación de AD FS si su objetivo es solo permitir el inicio de sesión único para Office 365.</span><span class="sxs-lookup"><span data-stu-id="e044c-314">There is another alternative to deploying AD FS altogether if your goal is only to enable sign-in for Office 365.</span></span> <span data-ttu-id="e044c-315">En ese caso, simplemente puede implementar DirSync con sincronización local de contraseña y lograr el mismo resultado final con una menor complejidad de implementación, dado que este enfoque no requiere AD FS ni Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-315">In that case, you can simply deploy DirSync with password sync on-premises and achieve the same end-result with minimal deployment complexity because this approach does not require AD FS or Azure.</span></span>

<span data-ttu-id="e044c-316">La tabla siguiente compara el funcionamiento de los procesos de inicio de sesión tanto si implementa AD FS como si no lo hace.</span><span class="sxs-lookup"><span data-stu-id="e044c-316">The following table compares how the sign-in processes work with and without deploying AD FS.</span></span>

| <span data-ttu-id="e044c-317">Inicio de sesión único de Office 365 mediante AD FS y DirSync</span><span class="sxs-lookup"><span data-stu-id="e044c-317">Office 365 single sign-on using AD FS and DirSync</span></span> | <span data-ttu-id="e044c-318">Mismo inicio de sesión único de Office 365 mediante DirSync + sincronización de contraseñas</span><span class="sxs-lookup"><span data-stu-id="e044c-318">Office 365 same sign-on using DirSync + Password Sync</span></span> |
| --- | --- |
| <span data-ttu-id="e044c-319">1. El usuario inicia sesión en una red corporativa y se autentica en Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e044c-319">1. The user logs on to a corporate network, and is authenticated to Windows Server Active Directory.</span></span> |<span data-ttu-id="e044c-320">1. El usuario inicia sesión en una red corporativa y se autentica en Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e044c-320">1. The user logs on to a corporate network, and is authenticated to Windows Server Active Directory.</span></span> |
| <span data-ttu-id="e044c-321">2. El usuario intenta obtener acceso a Office 365 (nombre @contoso.com).</span><span class="sxs-lookup"><span data-stu-id="e044c-321">2. The user tries to access Office 365 (I am @contoso.com).</span></span> |<span data-ttu-id="e044c-322">2. El usuario intenta obtener acceso a Office 365 (nombre @contoso.com).</span><span class="sxs-lookup"><span data-stu-id="e044c-322">2. The user tries to access Office 365 (I am @contoso.com).</span></span> |
| <span data-ttu-id="e044c-323">3. Office 365 redirige al usuario a Azure AD.</span><span class="sxs-lookup"><span data-stu-id="e044c-323">3. Office 365 redirects the user to Azure AD.</span></span> |<span data-ttu-id="e044c-324">3. Office 365 redirige al usuario a Azure AD.</span><span class="sxs-lookup"><span data-stu-id="e044c-324">3. Office 365 redirects the user to Azure AD.</span></span> |
| <span data-ttu-id="e044c-325">4. Como Azure AD no puede autenticar al usuario y entiende que hay una relación de confianza con AD FS local, redirige al usuario a AD FS.</span><span class="sxs-lookup"><span data-stu-id="e044c-325">4. Since Azure AD can’t authenticate the user and understands there is a trust with AD FS on-premises, it redirects the user to AD FS.</span></span> |<span data-ttu-id="e044c-326">4. Azure AD no puede aceptar vales de Kerberos directamente y no existe ninguna relación de confianza así que solicitará al usuario que especifique las credenciales.</span><span class="sxs-lookup"><span data-stu-id="e044c-326">4. Azure AD can’t accept Kerberos tickets directly and no trust relationship exists so it requests that the user enter credentials.</span></span> |
| <span data-ttu-id="e044c-327">5. El usuario envía un vale de Kerberos al STS de AD FS.</span><span class="sxs-lookup"><span data-stu-id="e044c-327">5. The user sends a Kerberos ticket to the AD FS STS.</span></span> |<span data-ttu-id="e044c-328">5. El usuario escribe la misma contraseña local y Azure AD la valida con el nombre de usuario y contraseña que se sincronizaron con DirSync.</span><span class="sxs-lookup"><span data-stu-id="e044c-328">5. The user enters the same on-premises password, and Azure AD validates them against the user name and password that was synchronized by DirSync.</span></span> |
| <span data-ttu-id="e044c-329">6. AD FS transforma el vale de Kerberos al formato o notificaciones de token necesarios y redirige al usuario a Azure AD.</span><span class="sxs-lookup"><span data-stu-id="e044c-329">6. AD FS transforms the Kerberos ticket to the required token format/claims and redirects the user to Azure AD.</span></span> |<span data-ttu-id="e044c-330">6. Azure AD redirige al usuario a Office 365.</span><span class="sxs-lookup"><span data-stu-id="e044c-330">6. Azure AD redirects the user to Office 365.</span></span> |
| <span data-ttu-id="e044c-331">7. El usuario se autentica en Azure AD (se produce otra transformación).</span><span class="sxs-lookup"><span data-stu-id="e044c-331">7. The user authenticates to Azure AD (another transformation occurs).</span></span> |<span data-ttu-id="e044c-332">7. El usuario puede iniciar sesión en Office 365 y OWA con el token de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="e044c-332">7. The user can sign in to Office 365 and OWA using the Azure AD token.</span></span> |
| <span data-ttu-id="e044c-333">8. Azure AD redirige al usuario a Office 365.</span><span class="sxs-lookup"><span data-stu-id="e044c-333">8. Azure AD redirects the user to Office 365.</span></span> | |
| <span data-ttu-id="e044c-334">9. El usuario se ha conectado en modo silencioso a Office 365.</span><span class="sxs-lookup"><span data-stu-id="e044c-334">9. The user is silently signed on to Office 365.</span></span> | |

<span data-ttu-id="e044c-335">En el escenario de Office 365 con DirSync con sincronización de contraseña (sin AD FS), el inicio de sesión único se reemplaza mediante el "mismo inicio de sesión" lo cual significa que los usuarios deben volver a escribir las mismas credenciales locales al acceder a Office 365.</span><span class="sxs-lookup"><span data-stu-id="e044c-335">In the Office 365 with DirSync with password sync scenario (no AD FS), single sign-on is replaced by “same sign-on” where “same” simply means that users must re-enter their same on-premises credentials when accessing Office 365.</span></span> <span data-ttu-id="e044c-336">Tenga en cuenta que estos datos se pueden guardar en el explorador del usuario para ayudar a reducir el número de solicitudes posteriores.</span><span class="sxs-lookup"><span data-stu-id="e044c-336">Note that this data can be remembered by the user’s browser to help reduce subsequent prompts.</span></span>

### <a name="additional-food-for-thought"></a><span data-ttu-id="e044c-337">Ideas adicionales para reflexionar</span><span class="sxs-lookup"><span data-stu-id="e044c-337">Additional food for thought</span></span>
* <span data-ttu-id="e044c-338">Si implementa un proxy de AD FS en una máquina virtual de Azure, se necesitará conectividad con los servidores de AD FS.</span><span class="sxs-lookup"><span data-stu-id="e044c-338">If you deploy an AD FS proxy on an Azure virtual machine, connectivity to the AD FS servers is needed.</span></span> <span data-ttu-id="e044c-339">Si son locales, se recomienda que aproveche la conectividad VPN de sitio a sitio proporcionada por la red virtual para permitir que los nodos de proxy de la aplicación web se comuniquen con los servidores de AD FS.</span><span class="sxs-lookup"><span data-stu-id="e044c-339">If they are on-premises, it is recommended that you leverage the site-to-site VPN connectivity provided by the virtual network to allow the Web Application Proxy nodes to communicate with their AD FS servers.</span></span>
* <span data-ttu-id="e044c-340">Si implementa un servidor de AD FS en una máquina virtual de Azure, necesitará conectividad con los controladores de dominio, almacenes de atributos y bases de datos de configuración de Windows Server Active Directory y puede requerir también una conexión de ExpressRoute o una conexión VPN de sitio a sitio entre la red virtual de Azure y la red local.</span><span class="sxs-lookup"><span data-stu-id="e044c-340">If you deploy an AD FS server on an Azure virtual machine, connectivity to Windows Server Active Directory domain controllers, Attribute Stores, and Configuration databases is necessary and may also require an ExpressRoute or a site-to-site VPN connection between the Azure virtual network and the on-premises network.</span></span>
* <span data-ttu-id="e044c-341">Se aplican cargos a todo el tráfico procedente de las máquinas virtuales de Azure (tráfico de salida).</span><span class="sxs-lookup"><span data-stu-id="e044c-341">Charges are applied to all traffic from Azure virtual machines (egress traffic).</span></span> <span data-ttu-id="e044c-342">Si el costo es un factor determinante, es conveniente implementar los nodos de proxy de la aplicación web en Azure, dejando los servidores de AD FS locales.</span><span class="sxs-lookup"><span data-stu-id="e044c-342">If cost is the driving factor, it is advisable to deploy the Web Application Proxy nodes on Azure, leaving the AD FS servers on-premises.</span></span> <span data-ttu-id="e044c-343">Si se implementan también los servidores de AD FS en máquinas virtuales de Azure, se aplicarán cargos adicionales para autenticar a los usuarios locales.</span><span class="sxs-lookup"><span data-stu-id="e044c-343">If the AD FS servers are deployed on Azure virtual machines as well, additional costs will be incurred to authenticate on-premises users.</span></span> <span data-ttu-id="e044c-344">El tráfico de salida supone siempre un costo independientemente de si está atravesando la conexión de ExpressRoute o la conexión VPN de sitio a sitio.</span><span class="sxs-lookup"><span data-stu-id="e044c-344">Egress traffic incurs a cost regardless of whether or not it is traversing the ExpressRoute or the VPN site-to-site connection.</span></span>
* <span data-ttu-id="e044c-345">Si decide utilizar la funcionalidad nativa de Azure de equilibrio de carga del servidor para lograr una alta disponibilidad de los servidores de AD FS, tenga en cuenta que el equilibrio de carga proporciona sondeos que se utilizan para determinar el estado de las máquinas virtuales dentro del servicio en la nube.</span><span class="sxs-lookup"><span data-stu-id="e044c-345">If you decide to use Azure’s native server load balancing capabilities for high availability of AD FS servers, note that load balancing provides probes that are used to determine the health of the virtual machines within the cloud service.</span></span> <span data-ttu-id="e044c-346">En el caso de máquinas virtuales (a diferencia de los roles de trabajo o web), debe usarse un sondeo personalizado ya que el agente que responde a los sondeos predeterminados no está presente en las máquinas virtuales de Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-346">In the case of Azure virtual machines (as opposed to web or worker roles), a custom probe must be used since the agent that responds to the default probes is not present on Azure virtual machines.</span></span> <span data-ttu-id="e044c-347">Para simplificar, puede usar un sondeo TCP personalizado: solo requiere que se establezca una conexión TCP correctamente (se envía un segmento TCP SYN y se responde con un segmento TCP SYN ACK) para determinar el estado de la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="e044c-347">For simplicity, you might use a custom TCP probe — this requires only that a TCP connection (a TCP SYN segment sent and responded to with a TCP SYN ACK segment) be successfully established to determine virtual machine health.</span></span> <span data-ttu-id="e044c-348">Puede configurar el sondeo personalizado para utilizar cualquier puerto TCP al que estén escuchando activamente las máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="e044c-348">You can configure the custom probe to use any TCP port to which your virtual machines are actively listening.</span></span>

> [!NOTE]
> <span data-ttu-id="e044c-349">Las máquinas que necesitan exponer el mismo conjunto de puertos directamente a Internet (por ejemplo, el puerto 80 y el 443) no pueden compartir el mismo servicio en la nube.</span><span class="sxs-lookup"><span data-stu-id="e044c-349">Machines that need to expose the same set of ports directly to the Internet (such as port 80 and 443) cannot share the same cloud service.</span></span> <span data-ttu-id="e044c-350">Por lo tanto, conviene crear un servicio dedicado en la nube para los servidores de Windows Server AD FS con el fin de evitar posibles superposiciones entre los requisitos de puerto para una aplicación y Windows Server AD FS.</span><span class="sxs-lookup"><span data-stu-id="e044c-350">It is, therefore, recommended that you create a dedicated cloud service for your Windows Server AD FS servers in order to avoid potential overlaps between port requirements for an application and Windows Server AD FS.</span></span>
> 
> 

## <a name="deployment-scenarios"></a><span data-ttu-id="e044c-351">Escenarios de implementación</span><span class="sxs-lookup"><span data-stu-id="e044c-351">Deployment scenarios</span></span>
<span data-ttu-id="e044c-352">La siguiente sección describe los escenarios de implementación comunes para llamar la atención sobre las consideraciones importantes que deben tenerse en cuenta.</span><span class="sxs-lookup"><span data-stu-id="e044c-352">The following section outlines commonplace deployment scenarios to draw attention to important considerations that must be taken into account.</span></span> <span data-ttu-id="e044c-353">Cada escenario contiene vínculos para obtener más detalles acerca de las decisiones y los factores a tener en cuenta.</span><span class="sxs-lookup"><span data-stu-id="e044c-353">Each scenario has links to more details about the decisions and factors to consider.</span></span>

1. [<span data-ttu-id="e044c-354">AD DS: Implementación de una aplicación compatible con AD DS sin necesidad de conectividad de red corporativa</span><span class="sxs-lookup"><span data-stu-id="e044c-354">AD DS: Deploy an AD DS-aware application with no requirement for corporate network connectivity</span></span>](#BKMK_CloudOnly)
   
    <span data-ttu-id="e044c-355">Por ejemplo, un servicio de SharePoint a través de Internet se implementa en una máquina virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-355">For example, an Internet-facing SharePoint service is deployed on an Azure virtual machine.</span></span> <span data-ttu-id="e044c-356">La aplicación no tiene dependencias de recursos de la red corporativa.</span><span class="sxs-lookup"><span data-stu-id="e044c-356">The application has no dependencies on corporate-network resources.</span></span> <span data-ttu-id="e044c-357">La aplicación requiere Windows Server AD DS pero no requiere Windows Server AD DS corporativo.</span><span class="sxs-lookup"><span data-stu-id="e044c-357">The application does require Windows Server AD DS but does NOT require the corporate Windows Server AD DS.</span></span>
2. [<span data-ttu-id="e044c-358">AD FS: expansión de una aplicación front-end local de notificaciones a Internet</span><span class="sxs-lookup"><span data-stu-id="e044c-358">AD FS: Extend a claims-aware on-premises front-end application to the Internet</span></span>](#BKMK_CloudOnlyFed)
   
    <span data-ttu-id="e044c-359">Por ejemplo, una aplicación de notificaciones que se ha implementado correctamente de forma local, utilizada por usuarios corporativos, y que debe ser accesible desde Internet.</span><span class="sxs-lookup"><span data-stu-id="e044c-359">For example, a claims-aware application that has been successfully deployed on-premises and used by corporate users needs to become accessible from the Internet.</span></span> <span data-ttu-id="e044c-360">Tanto los socios comerciales mediante sus propias identidades corporativas como los usuarios corporativos ya existentes necesitan acceder a la aplicación directamente a través de Internet.</span><span class="sxs-lookup"><span data-stu-id="e044c-360">The application needs to be accessed directly over the Internet both by business partners using their own corporate identities and by existing corporate users.</span></span>
3. [<span data-ttu-id="e044c-361">AD DS: Implementación de una aplicación compatible con Windows Server AD DS que requiere conectividad a la red corporativa</span><span class="sxs-lookup"><span data-stu-id="e044c-361">AD DS: Deploy a Windows Server AD DS-aware application that requires connectivity to the corporate network</span></span>](#BKMK_HybridExt)
   
    <span data-ttu-id="e044c-362">Por ejemplo, una aplicación compatible con LDAP que admite la autenticación integrada de Windows y usa Windows Server AD DS como repositorio de datos de configuración y de perfil de usuario se implementa en una máquina virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-362">For example, an LDAP-aware application that supports Windows-integrated authentication and uses Windows Server AD DS as a repository for configuration and user-profile data is deployed on an Azure virtual machine.</span></span> <span data-ttu-id="e044c-363">Es conveniente para la aplicación aprovechar la aplicación Windows Server AD DS corporativa ya existente y proporcionar un inicio de sesión único.</span><span class="sxs-lookup"><span data-stu-id="e044c-363">It is desirable for the application to leverage the existing corporate Windows Server AD DS and provide single sign-on.</span></span> <span data-ttu-id="e044c-364">La aplicación no es compatible con notificaciones.</span><span class="sxs-lookup"><span data-stu-id="e044c-364">The application is not claims-aware.</span></span>

### <span data-ttu-id="e044c-365"><a name="BKMK_CloudOnly"></a>1. AD DS: Implementación de una aplicación compatible con AD DS sin necesidad de conectividad de red corporativa</span><span class="sxs-lookup"><span data-stu-id="e044c-365"><a name="BKMK_CloudOnly"></a>1. AD DS: Deploy an AD DS-aware application with no requirement for corporate network connectivity</span></span>
<span data-ttu-id="e044c-366">![Implementación de AD DS solo en la nube](media/active-directory-deploying-ws-ad-guidelines/ADDS_cloud.png)
**Figura 1**</span><span class="sxs-lookup"><span data-stu-id="e044c-366">![Cloud-only AD DS deployment](media/active-directory-deploying-ws-ad-guidelines/ADDS_cloud.png)
**Figure 1**</span></span>

#### <a name="description"></a><span data-ttu-id="e044c-367">Descripción</span><span class="sxs-lookup"><span data-stu-id="e044c-367">Description</span></span>
<span data-ttu-id="e044c-368">SharePoint se implementa en una máquina virtual de Azure y la aplicación no tiene dependencias en recursos de la red corporativa.</span><span class="sxs-lookup"><span data-stu-id="e044c-368">SharePoint is deployed on an Azure virtual machine and the application has no dependencies on corporate-network resources.</span></span> <span data-ttu-id="e044c-369">La aplicación requiere Windows Server AD DS, pero *no* la versión corporativa.</span><span class="sxs-lookup"><span data-stu-id="e044c-369">The application does require Windows Server AD DS but does *not* require the corporate Windows Server AD DS.</span></span> <span data-ttu-id="e044c-370">No son necesarias relaciones de confianza de Kerberos ni federadas ya que los usuarios se aprovisionan automáticamente a través de la aplicación en el dominio de Windows Server AD DS que también se hospeda en la nube en las máquinas virtuales de Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-370">No Kerberos or federated trusts are required because users are self-provisioned through the application into the Windows Server AD DS domain that is also hosted in the cloud on Azure virtual machines.</span></span>

#### <a name="scenario-considerations-and-how-technology-areas-apply-to-the-scenario"></a><span data-ttu-id="e044c-371">Consideraciones sobre el escenario y cómo se aplican las áreas de tecnología al mismo</span><span class="sxs-lookup"><span data-stu-id="e044c-371">Scenario considerations and how technology areas apply to the scenario</span></span>
* <span data-ttu-id="e044c-372">[Topología de red](#BKMK_NetworkTopology): cree una red virtual de Azure sin conectividad entre locales (también conocida como "conectividad de sitio a sitio").</span><span class="sxs-lookup"><span data-stu-id="e044c-372">[Network topology](#BKMK_NetworkTopology): Create an Azure virtual network without cross-premises connectivity (also known as site-to-site connectivity).</span></span>
* <span data-ttu-id="e044c-373">[Configuración de la implementación del controlador de dominio](#BKMK_DeploymentConfig): implemente un nuevo controlador de dominio en un bosque nuevo de Windows Server Active Directory de dominio único.</span><span class="sxs-lookup"><span data-stu-id="e044c-373">[DC deployment configuration](#BKMK_DeploymentConfig): Deploy a new domain controller into a new, single-domain, Windows Server Active Directory forest.</span></span> <span data-ttu-id="e044c-374">Esto se debe implementar junto con el servidor DNS de Windows.</span><span class="sxs-lookup"><span data-stu-id="e044c-374">This should be deployed along with the Windows DNS server.</span></span>
* <span data-ttu-id="e044c-375">[Topología del sitio de Windows Server Active Directory](#BKMK_ADSiteTopology): use el sitio predeterminado de Windows Server Active Directory (todos los equipos estarán en Default-First-Site-Name).</span><span class="sxs-lookup"><span data-stu-id="e044c-375">[Windows Server Active Directory site topology](#BKMK_ADSiteTopology): Use the default Windows Server Active Directory site (all computers will be in Default-First-Site-Name).</span></span>
* <span data-ttu-id="e044c-376">[Direccionamiento IP y DNS](#BKMK_IPAddressDNS):</span><span class="sxs-lookup"><span data-stu-id="e044c-376">[IP addressing and DNS](#BKMK_IPAddressDNS):</span></span>
  
  * <span data-ttu-id="e044c-377">Establezca una dirección IP estática para el controlador de dominio mediante el cmdlet Set-AzureStaticVNetIP de Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="e044c-377">Set a static IP address for the DC by using the Set-AzureStaticVNetIP Azure PowerShell cmdlet.</span></span>
  * <span data-ttu-id="e044c-378">Instale y configure el DNS de Windows Server en los controladores de dominio en Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-378">Install and configure Windows Server DNS on the domain controller(s) on Azure.</span></span>
  * <span data-ttu-id="e044c-379">Configure las propiedades de la red virtual con el nombre y la dirección IP de la máquina virtual que hospeda los roles de servidor DC y DNS.</span><span class="sxs-lookup"><span data-stu-id="e044c-379">Configure the virtual network properties with the name and IP address of the VM that hosts the DC and DNS server roles.</span></span>
* <span data-ttu-id="e044c-380">[Catálogo global](#BKMK_GC): el primer controlador de dominio del bosque debe ser un servidor de catálogo global.</span><span class="sxs-lookup"><span data-stu-id="e044c-380">[Global Catalog](#BKMK_GC): The first DC in the forest must be a global catalog server.</span></span> <span data-ttu-id="e044c-381">También se deben configurar otros controladores de dominio como catálogos globales porque en un bosque de dominio único, el catálogo global no requiere ningún trabajo adicional desde el controlador de dominio.</span><span class="sxs-lookup"><span data-stu-id="e044c-381">Additional DCs should also be configured as GCs because in a single domain forest, the global catalog does not require any additional work from the DC.</span></span>
* <span data-ttu-id="e044c-382">[Selección de ubicación de la base de datos de Windows Server AD DS y SYSVOL](#BKMK_PlaceDB): agregue un disco de datos a los controladores de dominio que se ejecutan como máquinas virtuales de Azure para almacenar la base de datos, los registros y SYSVOL de Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e044c-382">[Placement of the Windows Server AD DS database and SYSVOL](#BKMK_PlaceDB): Add a data disk to DCs running as Azure VMs in order to store the Windows Server Active Directory database, logs, and SYSVOL.</span></span>
* <span data-ttu-id="e044c-383">[Copia de seguridad y restauración](#BKMK_BUR): determine dónde desea almacenar las copias de seguridad del estado de sistema.</span><span class="sxs-lookup"><span data-stu-id="e044c-383">[Backup and Restore](#BKMK_BUR): Determine where you want to store system state backups.</span></span> <span data-ttu-id="e044c-384">Si es necesario, agregue otro disco de datos a la máquina virtual del controlador de dominio para almacenar las copias de seguridad.</span><span class="sxs-lookup"><span data-stu-id="e044c-384">If necessary, add another data disk to the DC VM to store backups.</span></span>

### <span data-ttu-id="e044c-385"><a name="BKMK_CloudOnlyFed"></a>2 AD FS: expansión de una aplicación front-end local de notificaciones a Internet</span><span class="sxs-lookup"><span data-stu-id="e044c-385"><a name="BKMK_CloudOnlyFed"></a>2 AD FS: Extend a claims-aware on-premises front-end application to the Internet</span></span>
<span data-ttu-id="e044c-386">![Federación con conectividad entre locales](media/active-directory-deploying-ws-ad-guidelines/Federation_xprem.png)
**Figura 2**</span><span class="sxs-lookup"><span data-stu-id="e044c-386">![Federation with cross-premises connectivity](media/active-directory-deploying-ws-ad-guidelines/Federation_xprem.png)
**Figure 2**</span></span>

#### <a name="description"></a><span data-ttu-id="e044c-387">Descripción</span><span class="sxs-lookup"><span data-stu-id="e044c-387">Description</span></span>
<span data-ttu-id="e044c-388">Una aplicación de notificaciones que se ha implementado correctamente de forma local, utilizada por usuarios corporativos, y que debe ser accesible directamente desde Internet.</span><span class="sxs-lookup"><span data-stu-id="e044c-388">A claims-aware application that has been successfully deployed on-premises and used by corporate users needs to become accessible directly from the Internet.</span></span> <span data-ttu-id="e044c-389">La aplicación actúa como un front-end web para una Base de datos SQL en la que almacena los datos.</span><span class="sxs-lookup"><span data-stu-id="e044c-389">The application serves as a web frontend to a SQL database in which it stores data.</span></span> <span data-ttu-id="e044c-390">Los servidores de SQL Server utilizados por la aplicación también se encuentran en la red corporativa.</span><span class="sxs-lookup"><span data-stu-id="e044c-390">The SQL servers used by the application are also located on the corporate network.</span></span> <span data-ttu-id="e044c-391">Se han implementado dos STS de Windows Server AD FS y un equilibrador de carga de forma local para proporcionar acceso a los usuarios corporativos.</span><span class="sxs-lookup"><span data-stu-id="e044c-391">Two Windows Server AD FS STSs and a load-balancer have been deployed on-premises to provide access to the corporate users.</span></span> <span data-ttu-id="e044c-392">Ahora, tanto los socios comerciales mediante sus propias identidades corporativas como los usuarios corporativos ya existentes necesitan acceder adicionalmente a la aplicación directamente a través de Internet.</span><span class="sxs-lookup"><span data-stu-id="e044c-392">The application now needs to be additionally accessed directly over the Internet both by business partners using their own corporate identities and by existing corporate users.</span></span>

<span data-ttu-id="e044c-393">En un esfuerzo por simplificar y satisfacer las necesidades de implementación y configuración de este nuevo requisito, se decidió que se instalaran dos front-end web y dos servidores proxy de Windows Server AD FS en las máquinas virtuales de Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-393">In an effort to simplify and meet the deployment and configuration needs of this new requirement, it is decided that two additional web frontends and two Windows Server AD FS proxy servers be installed on Azure virtual machines.</span></span> <span data-ttu-id="e044c-394">Las cuatro máquinas virtuales se expondrán directamente a Internet y se proporcionará conectividad a la red local con la funcionalidad VPN de sitio a sitio de la red virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-394">All four VMs will be exposed directly to the Internet and will be provided connectivity to the on-premises network using Azure Virtual Network’s site-to-site VPN capability.</span></span>

#### <a name="scenario-considerations-and-how-technology-areas-apply-to-the-scenario"></a><span data-ttu-id="e044c-395">Consideraciones sobre el escenario y cómo se aplican las áreas de tecnología al mismo</span><span class="sxs-lookup"><span data-stu-id="e044c-395">Scenario considerations and how technology areas apply to the scenario</span></span>
* <span data-ttu-id="e044c-396">[Topología de red](#BKMK_NetworkTopology): cree una red virtual de Azure y [configure la conectividad entre locales](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span><span class="sxs-lookup"><span data-stu-id="e044c-396">[Network topology](#BKMK_NetworkTopology): Create an Azure virtual network and [configure cross-premises connectivity](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span></span>
  
  > [!NOTE]
  > <span data-ttu-id="e044c-397">Para cada uno de los certificados de Windows Server AD FS, asegúrese de que se pueda acceder a la dirección URL definida dentro de la plantilla de certificado y los certificados resultantes a través de las instancias de Windows Server AD FS que se ejecutan en Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-397">For each of the Windows Server AD FS certificates, ensure that the URL defined within the certificate template and the resulting certificates can be reached by the Windows Server AD FS instances running on Azure.</span></span> <span data-ttu-id="e044c-398">Esto puede requerir la conectividad entre locales a partes de la infraestructura PKI.</span><span class="sxs-lookup"><span data-stu-id="e044c-398">This may require cross-premises connectivity to parts of your PKI infrastructure.</span></span> <span data-ttu-id="e044c-399">Por ejemplo, si el punto de conexión de la CRL está basado en LDAP y se hospeda exclusivamente de forma local, entonces se necesitará conectividad entre locales.</span><span class="sxs-lookup"><span data-stu-id="e044c-399">For example if the CRL's endpoint is LDAP-based and hosted exclusively on-premises, then cross-premises connectivity will be required.</span></span> <span data-ttu-id="e044c-400">Si esto no es conveniente, puede que necesite utilizar certificados emitidos por una entidad de certificación cuya CRL sea accesible a través de Internet.</span><span class="sxs-lookup"><span data-stu-id="e044c-400">If this is not desirable, it may be necessary to use certificates issued by a CA whose CRL is accessible over the Internet.</span></span>
  > 
  > 
* <span data-ttu-id="e044c-401">[Configuración de servicios en la nube](#BKMK_CloudSvcConfig): asegúrese de que tiene dos servicios en la nube para proporcionar dos direcciones IP virtuales de carga equilibrada.</span><span class="sxs-lookup"><span data-stu-id="e044c-401">[Cloud services configuration](#BKMK_CloudSvcConfig): Ensure you have two cloud services in order provide two load-balanced virtual IP addresses.</span></span> <span data-ttu-id="e044c-402">La primera dirección IP virtual del servicio en la nube se dirigirá a las dos máquinas virtuales de proxy de Windows Server AD FS en los puertos 80 y 443.</span><span class="sxs-lookup"><span data-stu-id="e044c-402">The first cloud service’s virtual IP address will be directed to the two Windows Server AD FS proxy VMs on ports 80 and 443.</span></span> <span data-ttu-id="e044c-403">Las máquinas virtuales de proxy de Windows Server AD FS se configurarán para que señalen a la dirección IP del equilibrador de carga local que se sitúa frente a los STS de Windows Server AD FS.</span><span class="sxs-lookup"><span data-stu-id="e044c-403">The Windows Server AD FS proxy VMs will be configured to point to the IP address of the on-premises load-balancer that fronts the Windows Server AD FS STSs.</span></span> <span data-ttu-id="e044c-404">La segunda dirección IP virtual del servicio en la nube se dirigirá a las dos máquinas virtuales que están ejecutando de nuevo el front-end web en los puertos 80 y 443.</span><span class="sxs-lookup"><span data-stu-id="e044c-404">The second cloud service’s virtual IP address will be directed to the two VMs running the web frontend again on ports 80 and 443.</span></span> <span data-ttu-id="e044c-405">Configure un sondeo personalizado para asegurarse de que el equilibrador de carga solo dirige tráfico a máquinas virtuales de proxy y front-end web de Windows Server AD FS.</span><span class="sxs-lookup"><span data-stu-id="e044c-405">Configure a custom probe to ensure the load-balancer only directs traffic to functioning Windows Server AD FS proxy and web frontend VMs.</span></span>
* <span data-ttu-id="e044c-406">[Configuración del servidor de federación](#BKMK_FedSrvConfig): configure Windows Server AD FS como un servidor de federación (STS) para generar tokens de seguridad para el bosque de Windows Server Active Directory creado en la nube.</span><span class="sxs-lookup"><span data-stu-id="e044c-406">[Federation server configuration](#BKMK_FedSrvConfig): Configure Windows Server AD FS as a federation server (STS) to generate security tokens for the Windows Server Active Directory forest created in the cloud.</span></span> <span data-ttu-id="e044c-407">Establezca relaciones federadas de confianza de proveedor de notificaciones con los distintos asociados de los que desea aceptar identidades y configure relaciones con usuarios de confianza con las distintas aplicaciones para las que desea generar tokens.</span><span class="sxs-lookup"><span data-stu-id="e044c-407">Set federation claims provider trust relationships with the different partners you wish to accept identities from, and configure relying party trust relationships with the different applications you want to generate tokens to.</span></span>
  
    <span data-ttu-id="e044c-408">En la mayoría de los escenarios, los servidores proxy de Windows Server AD FS se implementan en una funcionalidad accesible desde Internet por motivos de seguridad mientras que sus homólogos de federación de Windows Server AD FS permanecen apartados de la conectividad directa a Internet.</span><span class="sxs-lookup"><span data-stu-id="e044c-408">In most scenarios, Windows Server AD FS proxy servers are deployed in an Internet-facing capacity for security purposes while their Windows Server AD FS federation counterparts remain isolated from direct Internet connectivity.</span></span> <span data-ttu-id="e044c-409">Independientemente del escenario de implementación, debe configurar el servicio en la nube con una dirección IP virtual que proporcionará una dirección IP y un puerto expuestos públicamente que son capaces de equilibrar la carga entre las dos instancias de STS de Windows Server AD FS o entre las instancias de proxy.</span><span class="sxs-lookup"><span data-stu-id="e044c-409">Regardless of your deployment scenario, you must configure your cloud service with a virtual IP address that will provide a publicly exposed IP address and port that is able to load-balance across either your two Windows Server AD FS STS instances or proxy instances.</span></span>
* <span data-ttu-id="e044c-410">[Configuración de alta disponibilidad de Windows Server AD FS](#BKMK_ADFSHighAvail): es conveniente implementar una granja de Windows Server AD FS con al menos dos servidores para la conmutación por error y el equilibrio de carga.</span><span class="sxs-lookup"><span data-stu-id="e044c-410">[Windows Server AD FS high availability configuration](#BKMK_ADFSHighAvail): It is advisable to deploy a Windows Server AD FS farm with at least two servers for failover and load balancing.</span></span> <span data-ttu-id="e044c-411">Podría considerar usar Windows Internal Database (WID) para los datos de configuración de Windows Server AD FS y utilizar la funcionalidad de equilibrio de carga interno de Azure para distribuir las solicitudes entrantes entre los servidores de la granja.</span><span class="sxs-lookup"><span data-stu-id="e044c-411">You might want to consider using the Windows Internal Database (WID) for Windows Server AD FS configuration data, and use the internal load balancing capability of Azure to distribute incoming requests across the servers in the farm.</span></span>

<span data-ttu-id="e044c-412">Para obtener más información, consulte la [guía de implementación de AD DS](https://technet.microsoft.com/library/cc753963).</span><span class="sxs-lookup"><span data-stu-id="e044c-412">For more information, see the [AD DS Deployment Guide](https://technet.microsoft.com/library/cc753963).</span></span>

### <span data-ttu-id="e044c-413"><a name="BKMK_HybridExt"></a>3. AD DS: Implementación de una aplicación compatible con Windows Server AD DS que requiere conectividad a la red corporativa</span><span class="sxs-lookup"><span data-stu-id="e044c-413"><a name="BKMK_HybridExt"></a>3. AD DS: Deploy a Windows Server AD DS-aware application that requires connectivity to the corporate network</span></span>
<span data-ttu-id="e044c-414">![Implementación de AD DS entre locales](media/active-directory-deploying-ws-ad-guidelines/ADDS_xprem.png)
**Figura 3**</span><span class="sxs-lookup"><span data-stu-id="e044c-414">![Cross-premises AD DS deployment](media/active-directory-deploying-ws-ad-guidelines/ADDS_xprem.png)
**Figure 3**</span></span>

#### <a name="description"></a><span data-ttu-id="e044c-415">Descripción</span><span class="sxs-lookup"><span data-stu-id="e044c-415">Description</span></span>
<span data-ttu-id="e044c-416">Una aplicación compatible con LDAP se implementa en una máquina virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-416">An LDAP-aware application is deployed on an Azure virtual machine.</span></span> <span data-ttu-id="e044c-417">Admite la autenticación integrada de Windows y usa Windows Server AD DS como repositorio para los datos de configuración y de perfil de usuario.</span><span class="sxs-lookup"><span data-stu-id="e044c-417">It supports Windows-integrated authentication and uses Windows Server AD DS as a repository for configuration and user profile data.</span></span> <span data-ttu-id="e044c-418">El objetivo para la aplicación es aprovechar la aplicación Windows Server AD DS corporativa ya existente y proporcionar un inicio de sesión único.</span><span class="sxs-lookup"><span data-stu-id="e044c-418">The goal is for the application to leverage the existing corporate Windows Server AD DS and provide single sign-on.</span></span> <span data-ttu-id="e044c-419">La aplicación no es compatible con notificaciones.</span><span class="sxs-lookup"><span data-stu-id="e044c-419">The application is not claims-aware.</span></span> <span data-ttu-id="e044c-420">Los usuarios también necesitan tener acceso a la aplicación directamente desde Internet.</span><span class="sxs-lookup"><span data-stu-id="e044c-420">Users also need to access the application directly from the Internet.</span></span> <span data-ttu-id="e044c-421">Para optimizar el rendimiento y el costo, se decide que dos controladores de dominio adicionales que forman parte del dominio corporativo se implementen junto con la aplicación en Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-421">To optimize for performance and cost, it is decided that two additional domain controllers that are part of the corporate domain be deployed alongside the application on Azure.</span></span>

#### <a name="scenario-considerations-and-how-technology-areas-apply-to-the-scenario"></a><span data-ttu-id="e044c-422">Consideraciones sobre el escenario y cómo se aplican las áreas de tecnología al mismo</span><span class="sxs-lookup"><span data-stu-id="e044c-422">Scenario considerations and how technology areas apply to the scenario</span></span>
* <span data-ttu-id="e044c-423">[Topología de red](#BKMK_NetworkTopology): cree una red virtual de Azure con [conectividad entre locales](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span><span class="sxs-lookup"><span data-stu-id="e044c-423">[Network topology](#BKMK_NetworkTopology): Create an Azure virtual network with [cross-premises connectivity](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span></span>
* <span data-ttu-id="e044c-424">[Método de instalación](#BKMK_InstallMethod): implemente controladores de dominio de réplica desde el dominio corporativo de Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e044c-424">[Installation method](#BKMK_InstallMethod): Deploy replica DCs from the corporate Windows Server Active Directory domain.</span></span> <span data-ttu-id="e044c-425">Para un controlador de dominio de réplica, puede instalar Windows Server AD DS en la máquina virtual y, opcionalmente, usar la característica de instalación desde medios (IFM) para reducir la cantidad de datos que deben replicarse en el nuevo controlador de dominio durante la instalación.</span><span class="sxs-lookup"><span data-stu-id="e044c-425">For a replica DC, you can install Windows Server AD DS on the VM, and optionally use the Install From Media (IFM) feature to reduce the amount of data that needs to be replicated to the new DC during installation.</span></span> <span data-ttu-id="e044c-426">Para ver un tutorial, consulte [Instalación de un controlador de dominio de Active Directory de réplica en una red virtual de Azure](active-directory-install-replica-active-directory-domain-controller.md).</span><span class="sxs-lookup"><span data-stu-id="e044c-426">For a tutorial, see [Install a replica Active Directory domain controller on Azure](active-directory-install-replica-active-directory-domain-controller.md).</span></span> <span data-ttu-id="e044c-427">Aunque utilice la característica IFM, puede resultar más eficaz generar el controlador de dominio virtual de forma local y mover todo el disco duro virtual (VHD) a la nube en lugar de replicar Windows Server AD DS durante la instalación.</span><span class="sxs-lookup"><span data-stu-id="e044c-427">Even if you use IFM, it may be more efficient to build the virtual DC on-premises and move the entire Virtual Hard Disk (VHD) to the cloud instead of replicating Windows Server AD DS during installation.</span></span> <span data-ttu-id="e044c-428">Por motivos de seguridad, se recomienda eliminar el VHD de la red local una vez que se ha copiado en Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-428">For safety, it is recommended that you delete the VHD from the on-premises network once it has been copied to Azure.</span></span>
* <span data-ttu-id="e044c-429">[Topología del sitio de Windows Server Active Directory](#BKMK_ADSiteTopology): cree un nuevo sitio de Azure en Sitios y servicios de Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e044c-429">[Windows Server Active Directory site topology](#BKMK_ADSiteTopology): Create a new Azure site in Active Directory Sites and Services.</span></span> <span data-ttu-id="e044c-430">Cree un objeto de subred de Windows Server Active Directory para representar la red virtual de Azure y agregue la subred al sitio.</span><span class="sxs-lookup"><span data-stu-id="e044c-430">Create a Windows Server Active Directory subnet object to represent the Azure virtual network and add the subnet to the site.</span></span> <span data-ttu-id="e044c-431">Cree un nuevo vínculo de sitio que incluya el nuevo sitio de Azure y el sitio en el que se encuentra el punto de conexión de la VPN de la red virtual de Azure para controlar y optimizar el tráfico de Windows Server Active Directory hacia y desde Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-431">Create a new site link that includes the new Azure site and the site in which the Azure virtual network VPN endpoint is located in order to control and optimize Windows Server Active Directory traffic to and from Azure.</span></span>
* <span data-ttu-id="e044c-432">[Direccionamiento IP y DNS](#BKMK_IPAddressDNS):</span><span class="sxs-lookup"><span data-stu-id="e044c-432">[IP addressing and DNS](#BKMK_IPAddressDNS):</span></span>
  
  * <span data-ttu-id="e044c-433">Establezca una dirección IP estática para el controlador de dominio mediante el cmdlet Set-AzureStaticVNetIP de Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="e044c-433">Set a static IP address for the DC by using the Set-AzureStaticVNetIP Azure PowerShell cmdlet.</span></span>
  * <span data-ttu-id="e044c-434">Instale y configure el DNS de Windows Server en los controladores de dominio en Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-434">Install and configure Windows Server DNS on the domain controller(s) on Azure.</span></span>
  * <span data-ttu-id="e044c-435">Configure las propiedades de la red virtual con el nombre y la dirección IP de la máquina virtual que hospeda los roles de servidor DC y DNS.</span><span class="sxs-lookup"><span data-stu-id="e044c-435">Configure the virtual network properties with the name and IP address of the VM that hosts the DC and DNS server roles.</span></span>
* <span data-ttu-id="e044c-436">[Controladores de dominio distribuidos geográficamente](#BKMK_DistributedDCs): configure tantas redes virtuales adicionales como sea necesario.</span><span class="sxs-lookup"><span data-stu-id="e044c-436">[Geo-distributed DCs](#BKMK_DistributedDCs): Configure additional virtual networks as needed.</span></span> <span data-ttu-id="e044c-437">Si la topología de sitio de Active Directory requiere controladores de dominio en ubicaciones geográficas que se corresponden con regiones de Azure, es recomendable crear sitios de Active Directory según corresponda.</span><span class="sxs-lookup"><span data-stu-id="e044c-437">If your Active Directory site topology requires DCs in geographies that correspond to different Azure regions, than you want to create Active Directory sites accordingly.</span></span>
* <span data-ttu-id="e044c-438">[Controladores de dominio de solo lectura](#BKMK_RODC): puede implementar un RODC en el sitio de Azure, dependiendo de los requisitos que se establezcan para realizar operaciones de escritura en el controlador de dominio y la compatibilidad de las aplicaciones y servicios del sitio con los RODC.</span><span class="sxs-lookup"><span data-stu-id="e044c-438">[Read-only DCs](#BKMK_RODC): You might deploy an RODC in the Azure site, depending on your requirements for performing write operations against the DC and the compatibility of applications and services in the site with RODCs.</span></span> <span data-ttu-id="e044c-439">Para obtener más información acerca de la compatibilidad de aplicaciones, consulte la [guía sobre compatibilidad de aplicaciones con controladores de dominio de solo lectura](https://technet.microsoft.com/library/cc755190).</span><span class="sxs-lookup"><span data-stu-id="e044c-439">For more information about application compatibility, see the [Read-Only domain controllers application compatibility guide](https://technet.microsoft.com/library/cc755190).</span></span>
* <span data-ttu-id="e044c-440">[Catálogo global](#BKMK_GC): se necesitan catálogos globales para atender las solicitudes de inicio de sesión en los bosques con varios dominios.</span><span class="sxs-lookup"><span data-stu-id="e044c-440">[Global Catalog](#BKMK_GC): GCs are needed to service logon requests in multidomain forests.</span></span> <span data-ttu-id="e044c-441">Si no implementa un catálogo global en el sitio de Azure, incurrirá en costos de tráfico de salida ya que las solicitudes de autenticación generan catálogos globales de consultas en otros sitios.</span><span class="sxs-lookup"><span data-stu-id="e044c-441">If you do not deploy a GC in the Azure site, you will incur egress traffic costs as authentication requests cause queries GCs in other sites.</span></span> <span data-ttu-id="e044c-442">Para minimizar ese tráfico, puede habilitar el almacenamiento en caché de pertenencia al grupo universal para el sitio de Azure en Sitios y servicios de Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e044c-442">To minimize that traffic, you can enable universal group membership caching for the Azure site in Active Directory Sites and Services.</span></span>
  
    <span data-ttu-id="e044c-443">Si implementa un catálogo global, configure los vínculos de sitios y los costos de los mismos para que el catálogo global del sitio de Azure no sea el controlador de dominio de origen preferido por otros catálogos globales que necesitan replicar las mismas particiones de dominio parciales.</span><span class="sxs-lookup"><span data-stu-id="e044c-443">If you deploy a GC, configure site links and site links costs so that the GC in the Azure site is not preferred as a source DC by other GCs that need to replicate the same partial domain partitions.</span></span>
* <span data-ttu-id="e044c-444">[Selección de ubicación de la base de datos de Windows Server AD DS y SYSVOL](#BKMK_PlaceDB): agregue un disco de datos a los controladores de dominio que se ejecutan en las máquinas virtuales de Azure para almacenar la base de datos, los registros y SYSVOL de Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e044c-444">[Placement of the Windows Server AD DS database and SYSVOL](#BKMK_PlaceDB): Add a data disk to DCs running on Azure VMs in order to store the Windows Server Active Directory database, logs, and SYSVOL.</span></span>
* <span data-ttu-id="e044c-445">[Copia de seguridad y restauración](#BKMK_BUR): determine dónde desea almacenar las copias de seguridad del estado de sistema.</span><span class="sxs-lookup"><span data-stu-id="e044c-445">[Backup and Restore](#BKMK_BUR): Determine where you want to store system state backups.</span></span> <span data-ttu-id="e044c-446">Si es necesario, agregue otro disco de datos a la máquina virtual del controlador de dominio para almacenar las copias de seguridad.</span><span class="sxs-lookup"><span data-stu-id="e044c-446">If necessary, add another data disk to the DC VM to store backups.</span></span>

## <a name="deployment-decisions-and-factors"></a><span data-ttu-id="e044c-447">Factores y decisiones de implementación</span><span class="sxs-lookup"><span data-stu-id="e044c-447">Deployment decisions and factors</span></span>
<span data-ttu-id="e044c-448">Esta tabla resume las áreas de tecnología de Windows Server Active Directory que se ven afectadas en los escenarios anteriores y las decisiones correspondientes a tener en cuenta, con vínculos a información más detallada a continuación.</span><span class="sxs-lookup"><span data-stu-id="e044c-448">This table summarizes the Windows Server Active Directory technology areas that are impacted in the preceding scenarios and the corresponding decisions to consider, with links to more detail below.</span></span> <span data-ttu-id="e044c-449">Algunas áreas de tecnología podrían no ser aplicables a todos los escenarios de implementación y algunas áreas de tecnología podrían ser más importantes para un escenario de implementación que otras.</span><span class="sxs-lookup"><span data-stu-id="e044c-449">Some technology areas might not be applicable to every deployment scenario, and some technology areas might be more critical to a deployment scenario than other technology areas.</span></span>

<span data-ttu-id="e044c-450">Por ejemplo, si implementa un controlador de dominio de réplica en una red virtual y el bosque tiene un solo dominio, la decisión de implementar un servidor de catálogo global no será crítica en ese caso para el escenario de implementación ya que no creará ningún requisito de replicación adicional.</span><span class="sxs-lookup"><span data-stu-id="e044c-450">For example, if you deploy a replica DC on a virtual network and your forest has only a single domain, then choosing to deploy a global catalog server in that case will not be critical to the deployment scenario because it will not create any additional replication requirements.</span></span> <span data-ttu-id="e044c-451">Sin embargo, si el bosque tiene varios dominios, la decisión de implementar un catálogo global en una red virtual podría afectar al ancho de banda disponible, al rendimiento, a la autenticación, a las búsquedas de directorio, etc.</span><span class="sxs-lookup"><span data-stu-id="e044c-451">On the other hand, if the forest has several domains, then the decision to deploy a global catalog on a virtual network could affect available bandwidth, performance, authentication, directory lookups, and so on.</span></span>

| <span data-ttu-id="e044c-452">Área de tecnología en Windows Server Active Directory</span><span class="sxs-lookup"><span data-stu-id="e044c-452">Windows Server Active Directory technology area</span></span> | <span data-ttu-id="e044c-453">Decisiones</span><span class="sxs-lookup"><span data-stu-id="e044c-453">Decisions</span></span> | <span data-ttu-id="e044c-454">Factores</span><span class="sxs-lookup"><span data-stu-id="e044c-454">Factors</span></span> |
| --- | --- | --- |
| [<span data-ttu-id="e044c-455">Topología de red</span><span class="sxs-lookup"><span data-stu-id="e044c-455">Network topology</span></span>](#BKMK_NetworkTopology) |<span data-ttu-id="e044c-456">¿Crear una red virtual?</span><span class="sxs-lookup"><span data-stu-id="e044c-456">Do you create a virtual network?</span></span> |<li><span data-ttu-id="e044c-457">Requisitos de acceso a recursos corporativos</span><span class="sxs-lookup"><span data-stu-id="e044c-457">Requirements to access Corp resources</span></span></li> <li><span data-ttu-id="e044c-458">Autenticación</span><span class="sxs-lookup"><span data-stu-id="e044c-458">Authentication</span></span></li> <li><span data-ttu-id="e044c-459">Administración de cuentas</span><span class="sxs-lookup"><span data-stu-id="e044c-459">Account management</span></span></li> |
| [<span data-ttu-id="e044c-460">Configuración de la implementación del controlador de dominio</span><span class="sxs-lookup"><span data-stu-id="e044c-460">DC deployment configuration</span></span>](#BKMK_DeploymentConfig) |<li><span data-ttu-id="e044c-461">¿Implementar un bosque independiente sin ninguna relación de confianza?</span><span class="sxs-lookup"><span data-stu-id="e044c-461">Deploy a separate forest without any trusts?</span></span></li> <li><span data-ttu-id="e044c-462">¿Implementar un nuevo bosque con federación?</span><span class="sxs-lookup"><span data-stu-id="e044c-462">Deploy a new forest with federation?</span></span></li> <li><span data-ttu-id="e044c-463">¿Implementar un nuevo bosque con confianza de bosque de Windows Server Active Directory o Kerberos?</span><span class="sxs-lookup"><span data-stu-id="e044c-463">Deploy a new forest with Windows Server Active Directory forest trust or Kerberos?</span></span></li> <li><span data-ttu-id="e044c-464">¿Extender el bosque corporativo implementando un controlador de dominio de réplica?</span><span class="sxs-lookup"><span data-stu-id="e044c-464">Extend Corp forest by deploying a replica DC?</span></span></li> <li><span data-ttu-id="e044c-465">¿Extender el bosque corporativo implementando un nuevo dominio secundario o árbol de dominios?</span><span class="sxs-lookup"><span data-stu-id="e044c-465">Extend Corp forest by deploying a new child domain or domain tree?</span></span></li> |<li><span data-ttu-id="e044c-466">Seguridad</span><span class="sxs-lookup"><span data-stu-id="e044c-466">Security</span></span></li> <li><span data-ttu-id="e044c-467">Cumplimiento normativo</span><span class="sxs-lookup"><span data-stu-id="e044c-467">Compliance</span></span></li> <li><span data-ttu-id="e044c-468">Coste</span><span class="sxs-lookup"><span data-stu-id="e044c-468">Cost</span></span></li> <li><span data-ttu-id="e044c-469">Resistencia y tolerancia a errores</span><span class="sxs-lookup"><span data-stu-id="e044c-469">Resiliency and fault-tolerance</span></span></li> <li><span data-ttu-id="e044c-470">Compatibilidad de aplicación</span><span class="sxs-lookup"><span data-stu-id="e044c-470">Application compatibility</span></span></li> |
| [<span data-ttu-id="e044c-471">Topología del sitio en Windows Server Active Directory</span><span class="sxs-lookup"><span data-stu-id="e044c-471">Windows Server Active Directory site topology</span></span>](#BKMK_ADSiteTopology) |<span data-ttu-id="e044c-472">¿Cómo configurar subredes, sitios y vínculos de sitio con Red virtual de Azure para optimizar el tráfico y minimizar los costos?</span><span class="sxs-lookup"><span data-stu-id="e044c-472">How do you configure subnets, sites, and site links with Azure Virtual Network to optimize traffic and minimize cost?</span></span> |<li><span data-ttu-id="e044c-473">Definiciones de sitio y de subred</span><span class="sxs-lookup"><span data-stu-id="e044c-473">Subnet and site definitions</span></span></li> <li><span data-ttu-id="e044c-474">Propiedades de vínculo de sitio y notificación de cambio</span><span class="sxs-lookup"><span data-stu-id="e044c-474">Site link properties and change notification</span></span></li> <li><span data-ttu-id="e044c-475">Compresión de replicación</span><span class="sxs-lookup"><span data-stu-id="e044c-475">Replication compression</span></span></li> |
| [<span data-ttu-id="e044c-476">Direccionamiento IP y DNS</span><span class="sxs-lookup"><span data-stu-id="e044c-476">IP addressing and DNS</span></span>](#BKMK_IPAddressDNS) |<span data-ttu-id="e044c-477">¿Cómo configurar la resolución de nombres y direcciones IP?</span><span class="sxs-lookup"><span data-stu-id="e044c-477">How to configure IP addresses and name resolution?</span></span> |<li><span data-ttu-id="e044c-478">Usar el cmdlet Set-AzureStaticVNetIP para asignar una dirección IP estática</span><span class="sxs-lookup"><span data-stu-id="e044c-478">Use the Use the Set-AzureStaticVNetIP cmdlet to assign a static IP address</span></span></li> <li><span data-ttu-id="e044c-479">Instalar el servidor DNS de Windows Server y configurar las propiedades de la red virtual con el nombre y la dirección IP de la máquina virtual que hospeda los roles de servidor DC y DNS</span><span class="sxs-lookup"><span data-stu-id="e044c-479">Install Windows Server DNS server and configure the virtual network properties with the name and IP address of the VM that hosts the DC and DNS server roles</span></span></li> |
| [<span data-ttu-id="e044c-480">Controladores de dominio distribuidos geográficamente</span><span class="sxs-lookup"><span data-stu-id="e044c-480">Geo-distributed DCs</span></span>](#BKMK_DistributedDCs) |<span data-ttu-id="e044c-481">¿Cómo replicar en controladores de dominio de redes virtuales independientes?</span><span class="sxs-lookup"><span data-stu-id="e044c-481">How to replicate to DCs on separate virtual networks?</span></span> |<span data-ttu-id="e044c-482">Si la topología de sitio de Active Directory requiere controladores de dominio en ubicaciones geográficas que se corresponden con regiones de Azure, es recomendable crear sitios de Active Directory según corresponda.</span><span class="sxs-lookup"><span data-stu-id="e044c-482">If your Active Directory site topology requires DCs in geographies that corresponds to different Azure regions, than you want to create Active Directory sites accordingly.</span></span> <span data-ttu-id="e044c-483">[Configure una conexión de red virtual a red virtual](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md) para efectuar la replicación entre controladores de dominio de redes virtuales independientes.</span><span class="sxs-lookup"><span data-stu-id="e044c-483">[Configure virtual network to virtual network Connectivity](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md) to replicate between domain controllers on separate virtual networks.</span></span> |
| [<span data-ttu-id="e044c-484">Controladores de dominio de solo lectura</span><span class="sxs-lookup"><span data-stu-id="e044c-484">Read-only DCs</span></span>](#BKMK_RODC) |<span data-ttu-id="e044c-485">¿Usar controladores de dominio de solo lectura o de escritura?</span><span class="sxs-lookup"><span data-stu-id="e044c-485">Use read-only or writeable DCs?</span></span> |<li><span data-ttu-id="e044c-486">Filtrar atributos HBI/PII</span><span class="sxs-lookup"><span data-stu-id="e044c-486">Filter HBI/PII attributes</span></span></li> <li><span data-ttu-id="e044c-487">Filtrar secretos</span><span class="sxs-lookup"><span data-stu-id="e044c-487">Filter secrets</span></span></li> <li><span data-ttu-id="e044c-488">Limitar tráfico de salida</span><span class="sxs-lookup"><span data-stu-id="e044c-488">Limit outbound traffic</span></span></li> |
| [<span data-ttu-id="e044c-489">Catálogo global</span><span class="sxs-lookup"><span data-stu-id="e044c-489">Global catalog</span></span>](#BKMK_GC) |<span data-ttu-id="e044c-490">¿Instalar un catálogo global?</span><span class="sxs-lookup"><span data-stu-id="e044c-490">Install global catalog?</span></span> |<li><span data-ttu-id="e044c-491">Para el bosque de dominio único, convertir todos los catálogos globales en controladores de dominio</span><span class="sxs-lookup"><span data-stu-id="e044c-491">For single-domain forest, make all DCs GCs</span></span></li> <li><span data-ttu-id="e044c-492">Para un bosque con varios dominios, se requieren catálogos globales para la autenticación.</span><span class="sxs-lookup"><span data-stu-id="e044c-492">For multidomain forest, GCs are required for authentication</span></span></li> |
| [<span data-ttu-id="e044c-493">Método de instalación</span><span class="sxs-lookup"><span data-stu-id="e044c-493">Installation method</span></span>](#BKMK_InstallMethod) |<span data-ttu-id="e044c-494">¿Cómo instalar el controlador de dominio en Azure?</span><span class="sxs-lookup"><span data-stu-id="e044c-494">How to install DC in Azure?</span></span> |<span data-ttu-id="e044c-495">Opciones: </span><span class="sxs-lookup"><span data-stu-id="e044c-495">Either:</span></span> <li><span data-ttu-id="e044c-496">Instalar AD DS mediante Windows PowerShell o Dcpromo</span><span class="sxs-lookup"><span data-stu-id="e044c-496">Install AD DS using Windows PowerShell or Dcpromo</span></span></li> <li><span data-ttu-id="e044c-497">Trasladar VHD de un controlador de dominio virtual local a la nube</span><span class="sxs-lookup"><span data-stu-id="e044c-497">Move VHD of an on-premises virtual DC</span></span></li> |
| [<span data-ttu-id="e044c-498">Selección de ubicación de la base de datos y SYSVOL de Windows Server AD DS</span><span class="sxs-lookup"><span data-stu-id="e044c-498">Placement of the Windows Server AD DS database and SYSVOL</span></span>](#BKMK_PlaceDB) |<span data-ttu-id="e044c-499">¿Dónde almacenar la base de datos, los registros y SYSVOL de Windows Server AD DS?</span><span class="sxs-lookup"><span data-stu-id="e044c-499">Where to store Windows Server AD DS database, logs, and SYSVOL?</span></span> |<span data-ttu-id="e044c-500">Cambie los valores predeterminados de Dcpromo.exe.</span><span class="sxs-lookup"><span data-stu-id="e044c-500">Change Dcpromo.exe default values.</span></span> <span data-ttu-id="e044c-501">Estos archivos críticos de Active Directory *deben* colocarse en discos de datos de Azure en lugar de en discos del sistema operativo que implementan almacenamiento en caché de escritura.</span><span class="sxs-lookup"><span data-stu-id="e044c-501">These critical Active Directory files *must* be placed on Azure Data Disks instead of Operating System disks that implement write caching.</span></span> |
| [<span data-ttu-id="e044c-502">Copia de seguridad y restauración</span><span class="sxs-lookup"><span data-stu-id="e044c-502">Backup and Restore</span></span>](#BKMK_BUR) |<span data-ttu-id="e044c-503">¿Cómo proteger y recuperar datos?</span><span class="sxs-lookup"><span data-stu-id="e044c-503">How to safeguard and recover data?</span></span> |<span data-ttu-id="e044c-504">Creación de copias de seguridad del estado del sistema</span><span class="sxs-lookup"><span data-stu-id="e044c-504">Create system state backups</span></span> |
| [<span data-ttu-id="e044c-505">Configuración del servidor de federación</span><span class="sxs-lookup"><span data-stu-id="e044c-505">Federation server configuration</span></span>](#BKMK_FedSrvConfig) |<li><span data-ttu-id="e044c-506">¿Implementar un nuevo bosque con federación en la nube?</span><span class="sxs-lookup"><span data-stu-id="e044c-506">Deploy a new forest with federation in the cloud?</span></span></li> <li><span data-ttu-id="e044c-507">¿Implementar AD FS local y exponer un proxy en la nube?</span><span class="sxs-lookup"><span data-stu-id="e044c-507">Deploy AD FS on-premises and expose a proxy in the cloud?</span></span></li> |<li><span data-ttu-id="e044c-508">Seguridad</span><span class="sxs-lookup"><span data-stu-id="e044c-508">Security</span></span></li> <li><span data-ttu-id="e044c-509">Cumplimiento normativo</span><span class="sxs-lookup"><span data-stu-id="e044c-509">Compliance</span></span></li> <li><span data-ttu-id="e044c-510">Coste</span><span class="sxs-lookup"><span data-stu-id="e044c-510">Cost</span></span></li> <li><span data-ttu-id="e044c-511">Acceder a las aplicaciones por parte de asociados comerciales</span><span class="sxs-lookup"><span data-stu-id="e044c-511">Access to applications by business partners</span></span></li> |
| [<span data-ttu-id="e044c-512">Configuración de servicios en la nube</span><span class="sxs-lookup"><span data-stu-id="e044c-512">Cloud services configuration</span></span>](#BKMK_CloudSvcConfig) |<span data-ttu-id="e044c-513">Un servicio en la nube se implementa de forma implícita la primera vez que crea una máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="e044c-513">A cloud service is implicitly deployed the first time you create a virtual machine.</span></span> <span data-ttu-id="e044c-514">¿Necesita implementar servicios en la nube adicionales?</span><span class="sxs-lookup"><span data-stu-id="e044c-514">Do you need to deploy additional cloud services?</span></span> |<li><span data-ttu-id="e044c-515">¿Una o varias máquinas virtuales requieren exposición directa a Internet?</span><span class="sxs-lookup"><span data-stu-id="e044c-515">Does a VM or VMs require direct exposure to the Internet?</span></span></li> <li> <span data-ttu-id="e044c-516">¿El servicio necesita equilibrio de carga?</span><span class="sxs-lookup"><span data-stu-id="e044c-516">Does the service require load-balancing?</span></span></li> |
| [<span data-ttu-id="e044c-517">Requisitos del servidor de federación para el direccionamiento IP público y privado (IP dinámica frente a IP virtual)</span><span class="sxs-lookup"><span data-stu-id="e044c-517">Federation server requirements for public and private IP addressing (dynamic IP vs. virtual IP)</span></span>](#BKMK_FedReqVIPDIP) |<li><span data-ttu-id="e044c-518">¿Necesita la instancia de Windows Server AD FS ser accesible directamente desde Internet?</span><span class="sxs-lookup"><span data-stu-id="e044c-518">Does the Windows Server AD FS instance need to be reached directly from the Internet?</span></span></li> <li><span data-ttu-id="e044c-519">¿Necesita la aplicación que se va a implementar en la nube su propia dirección IP y puerto accesibles desde Internet?</span><span class="sxs-lookup"><span data-stu-id="e044c-519">Does the application being deployed in the cloud require its own Internet-facing IP address and port?</span></span></li> |<span data-ttu-id="e044c-520">Creación de un servicio en la nube para cada dirección IP virtual que necesite la implementación</span><span class="sxs-lookup"><span data-stu-id="e044c-520">Create one cloud-service for each virtual IP address that is required by your deployment</span></span> |
| [<span data-ttu-id="e044c-521">Configuración de alta disponibilidad de Windows Server AD FS</span><span class="sxs-lookup"><span data-stu-id="e044c-521">Windows Server AD FS high availability configuration</span></span>](#BKMK_ADFSHighAvail) |<li><span data-ttu-id="e044c-522">¿Cuántos nodos debe tener la granja de servidores de Windows Server AD FS?</span><span class="sxs-lookup"><span data-stu-id="e044c-522">How many nodes in my Windows Server AD FS server farm?</span></span></li> <li><span data-ttu-id="e044c-523">¿Cuántos nodos se deben implementar en la granja de servidores proxy de Windows Server AD FS?</span><span class="sxs-lookup"><span data-stu-id="e044c-523">How many nodes to deploy in my Windows Server AD FS proxy farm?</span></span></li> |<span data-ttu-id="e044c-524">Resistencia y tolerancia a errores</span><span class="sxs-lookup"><span data-stu-id="e044c-524">Resiliency and fault tolerance</span></span> |

### <span data-ttu-id="e044c-525"><a name="BKMK_NetworkTopology"></a>Topología de red</span><span class="sxs-lookup"><span data-stu-id="e044c-525"><a name="BKMK_NetworkTopology"></a>Network topology</span></span>
<span data-ttu-id="e044c-526">Para cumplir con los requisitos de coherencia de direcciones IP y de DNS de Windows Server AD DS, es necesario crear primero una [red virtual de Azure](../virtual-network/virtual-networks-overview.md) y conectar las máquinas virtuales a ella.</span><span class="sxs-lookup"><span data-stu-id="e044c-526">In order to meet the IP address consistency and DNS requirements of Windows Server AD DS, it is necessary to first create an [Azure virtual network](../virtual-network/virtual-networks-overview.md) and attach your virtual machines to it.</span></span> <span data-ttu-id="e044c-527">Durante su creación, debe decidir si desea ampliar la conectividad a la red corporativa local, que conecta de forma transparente máquinas virtuales de Azure a máquinas locales. Esto se logra mediante tecnologías tradicionales de VPN y requiere exponer un punto de conexión de VPN en el borde de la red corporativa.</span><span class="sxs-lookup"><span data-stu-id="e044c-527">During its creation, you must decide whether to optionally extend connectivity to your on-premises corporate network, which transparently connects Azure virtual machines to on-premises machines — this is achieved using traditional VPN technologies and requires that a VPN endpoint be exposed on the edge of the corporate network.</span></span> <span data-ttu-id="e044c-528">Es decir, la VPN se inicia desde Azure a la red corporativa, no a la inversa.</span><span class="sxs-lookup"><span data-stu-id="e044c-528">That is, the VPN is initiated from Azure to the corporate network, not vice-versa.</span></span>

<span data-ttu-id="e044c-529">Tenga en cuenta que se aplican cargos adicionales al extender una red virtual a la red local además de los cargos estándar que se aplican a cada máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="e044c-529">Note that additional charges apply when extending a virtual network to your on-premises network beyond the standard charges that apply to each VM.</span></span> <span data-ttu-id="e044c-530">En concreto, se aplican cargos para el tiempo de CPU de la puerta de enlace de la Red virtual de Azure y para el tráfico de salida generado por cada máquina virtual que se comunica con máquinas locales a través de la VPN.</span><span class="sxs-lookup"><span data-stu-id="e044c-530">Specifically, there are charges for CPU time of the Azure Virtual Network gateway and for the egress traffic generated by each VM that communicates with on-premises machines across the VPN.</span></span> <span data-ttu-id="e044c-531">Para obtener más información acerca de los gastos por tráfico de red, consulte [Precios de Azure](http://azure.microsoft.com/pricing/).</span><span class="sxs-lookup"><span data-stu-id="e044c-531">For more information about network traffic charges, see [Azure pricing at-a-glance](http://azure.microsoft.com/pricing/).</span></span>

### <span data-ttu-id="e044c-532"><a name="BKMK_DeploymentConfig"></a>Configuración de la implementación del controlador de dominio</span><span class="sxs-lookup"><span data-stu-id="e044c-532"><a name="BKMK_DeploymentConfig"></a>DC deployment configuration</span></span>
<span data-ttu-id="e044c-533">La forma de configurar el controlador de dominio depende de los requisitos del servicio que desee ejecutar en Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-533">The way you configure the DC depends on the requirements for the service you want to run on Azure.</span></span> <span data-ttu-id="e044c-534">Por ejemplo, podría implementar un nuevo bosque, aislado de su propio bosque corporativo, para comprobar una prueba de concepto, una nueva aplicación o algún otro proyecto a corto plazo que requiera servicios de directorio pero no acceso específico a recursos internos corporativos.</span><span class="sxs-lookup"><span data-stu-id="e044c-534">For example, you might deploy a new forest, isolated from your own corporate forest, for testing a proof-of-concept, a new application, or some other short term project that requires directory services but not specific access to internal corporate resources.</span></span>

<span data-ttu-id="e044c-535">Como ventaja, un controlador de dominio de bosque aislado no se replica en controladores de dominio locales, lo cual resulta en menos tráfico de red de salida generado por el propio sistema, reduciendo así directamente los costos.</span><span class="sxs-lookup"><span data-stu-id="e044c-535">As a benefit, an isolated forest DC does not replicate with on-premises DCs, resulting in less outbound network traffic generated by the system itself, directly reducing costs.</span></span> <span data-ttu-id="e044c-536">Para obtener más información acerca de los gastos por tráfico de red, consulte [Precios de Azure](http://azure.microsoft.com/pricing/).</span><span class="sxs-lookup"><span data-stu-id="e044c-536">For more information about network traffic charges, see [Azure pricing at-a-glance](http://azure.microsoft.com/pricing/).</span></span>

<span data-ttu-id="e044c-537">Otro ejemplo. Supongamos que tiene requisitos de privacidad para un servicio, pero el servicio depende del acceso a su Windows Server Active Directory interno.</span><span class="sxs-lookup"><span data-stu-id="e044c-537">As another example, suppose you have privacy requirements for a service, but the service depends on access to your internal Windows Server Active Directory.</span></span> <span data-ttu-id="e044c-538">Si se le permite hospedar datos para el servicio en la nube, podría implementar un nuevo dominio secundario en el bosque interno en Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-538">If you are allowed to host data for the service in the cloud, you might deploy a new child domain for your internal forest on Azure.</span></span> <span data-ttu-id="e044c-539">En este caso, puede implementar un controlador de dominio para el nuevo dominio secundario (sin el catálogo global para ayudar a solucionar problemas de privacidad).</span><span class="sxs-lookup"><span data-stu-id="e044c-539">In this case, you can deploy a DC for the new child domain (without the global catalog in order to help address privacy concerns).</span></span> <span data-ttu-id="e044c-540">Este escenario, junto con una implementación de controlador de dominio de réplica, requiere una red virtual para la conectividad con los controladores de dominio locales.</span><span class="sxs-lookup"><span data-stu-id="e044c-540">This scenario, along with a replica DC deployment, requires a virtual network for connectivity with your on-premises DCs.</span></span>

<span data-ttu-id="e044c-541">Si crea un nuevo bosque, elija si desea usar [confianzas de Active Directory](https://technet.microsoft.com/library/cc771397) o [confianzas de federación](https://technet.microsoft.com/library/dd807036).</span><span class="sxs-lookup"><span data-stu-id="e044c-541">If you create a new forest, choose whether to use [Active Directory trusts](https://technet.microsoft.com/library/cc771397) or [Federation trusts](https://technet.microsoft.com/library/dd807036).</span></span> <span data-ttu-id="e044c-542">Equilibre los requisitos según los criterios de compatibilidad, seguridad, cumplimiento, costo y resistencia.</span><span class="sxs-lookup"><span data-stu-id="e044c-542">Balance the requirements dictated by compatibility, security, compliance, cost, and resiliency.</span></span> <span data-ttu-id="e044c-543">Por ejemplo, para aprovechar las ventajas de la [autenticación selectiva](https://technet.microsoft.com/library/cc755844) , puede optar por implementar un nuevo bosque en Azure y crear una relación de confianza de Windows Server Active Directory entre el bosque local y el de la nube.</span><span class="sxs-lookup"><span data-stu-id="e044c-543">For example, to take advantage of [selective authentication](https://technet.microsoft.com/library/cc755844) you might choose to deploy a new forest on Azure and create a Windows Server Active Directory trust between the on-premises forest and the cloud forest.</span></span> <span data-ttu-id="e044c-544">Sin embargo, si la aplicación es compatible con notificaciones, puede implementar confianzas de federación en lugar de confianzas de bosque de Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e044c-544">If the application is claims-aware, however, you might deploy federation trusts instead of Active Directory forest trusts.</span></span> <span data-ttu-id="e044c-545">Otro factor será el costo por replicar más datos extendiendo Windows Server Active Directory local a la nube o por generar más tráfico de salida como resultado de la carga de autenticación y consultas.</span><span class="sxs-lookup"><span data-stu-id="e044c-545">Another factor will be the cost to either replicate more data by extending your on-premises Windows Server Active Directory to the cloud or generate more outbound traffic as a result of authentication and query load.</span></span>

<span data-ttu-id="e044c-546">Los requisitos de disponibilidad y tolerancia a errores también influyen en su elección.</span><span class="sxs-lookup"><span data-stu-id="e044c-546">Requirements for availability and fault tolerance also affect your choice.</span></span> <span data-ttu-id="e044c-547">Por ejemplo, si se interrumpe el vínculo, aquellas aplicaciones que aprovechan una confianza de Kerberos o una de federación probablemente dejen de funcionar a no ser que haya implementado una infraestructura suficiente en Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-547">For example, if the link is interrupted, applications leveraging either a Kerberos trust or a federation trust are all likely entirely broken unless you have deployed sufficient infrastructure on Azure.</span></span> <span data-ttu-id="e044c-548">Las configuraciones de implementación alternativas como las de controladores de dominio de réplica (grabable o RODC) aumentan la probabilidad de que puedan tolerar interrupciones del vínculo.</span><span class="sxs-lookup"><span data-stu-id="e044c-548">Alternative deployment configurations such as replica DCs (writeable or RODCs) increase the likelihood of being able to tolerate link outages.</span></span>

### <span data-ttu-id="e044c-549"><a name="BKMK_ADSiteTopology"></a>Topología del sitio en Windows Server Active Directory</span><span class="sxs-lookup"><span data-stu-id="e044c-549"><a name="BKMK_ADSiteTopology"></a>Windows Server Active Directory site topology</span></span>
<span data-ttu-id="e044c-550">Debe definir correctamente los sitios y los vínculos de sitios para optimizar el tráfico y minimizar el costo.</span><span class="sxs-lookup"><span data-stu-id="e044c-550">You need to correctly define sites and site links in order to optimize traffic and minimize cost.</span></span> <span data-ttu-id="e044c-551">Los sitios, los vínculos de sitios y las subredes afectan a la topología de replicación entre controladores de dominio y el flujo de tráfico de autenticación.</span><span class="sxs-lookup"><span data-stu-id="e044c-551">Sites, site-links, and subnets affect the replication topology between DCs and the flow of authentication traffic.</span></span> <span data-ttu-id="e044c-552">Tenga en cuenta los siguientes gastos por tráfico y, a continuación, implemente y configure los controladores de dominio según los requisitos del escenario de implementación:</span><span class="sxs-lookup"><span data-stu-id="e044c-552">Consider the following traffic charges and then deploy and configure DCs according to the requirements of your deployment scenario:</span></span>

* <span data-ttu-id="e044c-553">Hay un precio nominal por hora para la puerta de enlace:</span><span class="sxs-lookup"><span data-stu-id="e044c-553">There is a nominal fee per hour for the gateway itself:</span></span>
  
  * <span data-ttu-id="e044c-554">Se puede iniciar y detener como considere oportuno</span><span class="sxs-lookup"><span data-stu-id="e044c-554">It can be started and stopped as you see fit</span></span>
  * <span data-ttu-id="e044c-555">Si se detiene, las máquinas virtuales de Azure estarán aisladas de la red corporativa</span><span class="sxs-lookup"><span data-stu-id="e044c-555">If stopped, Azure VMs are isolated from the corporate network</span></span>
* <span data-ttu-id="e044c-556">El tráfico de entrada es gratis</span><span class="sxs-lookup"><span data-stu-id="e044c-556">Inbound traffic is free</span></span>
* <span data-ttu-id="e044c-557">Se cobra por el tráfico saliente, según la lista de [Precios de Azure](http://azure.microsoft.com/pricing/).</span><span class="sxs-lookup"><span data-stu-id="e044c-557">Outbound traffic is charged, according to [Azure pricing at-a-glance](http://azure.microsoft.com/pricing/).</span></span> <span data-ttu-id="e044c-558">Puede optimizar las propiedades de vínculos de sitios entre sitios locales y sitios en la nube como sigue:</span><span class="sxs-lookup"><span data-stu-id="e044c-558">You can optimize site link properties between on-premises sites and the cloud sites as follows:</span></span>
  
  * <span data-ttu-id="e044c-559">Si usa varias redes virtuales, configure los vínculos de sitios y sus costos correctamente para evitar que Windows Server AD DS dé prioridad al sitio de Azure sobre uno que puede proporcionar los mismos niveles de servicio de forma gratuita.</span><span class="sxs-lookup"><span data-stu-id="e044c-559">If you are using multiple virtual networks, configure the site-links and their costs appropriately to prevent Windows Server AD DS from prioritizing the Azure site over one that can provide the same levels of service at no charge.</span></span> <span data-ttu-id="e044c-560">También puede deshabilitar la opción Enlazar todos los vínculos de sitios (BASL) (que está habilitada de forma predeterminada).</span><span class="sxs-lookup"><span data-stu-id="e044c-560">You might also consider disabling the Bridge all site link (BASL) option (which is enabled by default).</span></span> <span data-ttu-id="e044c-561">Esto garantiza que solo sitios con conexión directa se replican entre sí.</span><span class="sxs-lookup"><span data-stu-id="e044c-561">This ensures that only directly-connected sites replicate with one another.</span></span> <span data-ttu-id="e044c-562">Los controladores de dominio en sitios conectados de forma transitiva ya no se pueden replicar directamente entre sí, sino que se deben replicar a través de sitios comunes.</span><span class="sxs-lookup"><span data-stu-id="e044c-562">DCs in transitively connected sites are no longer able to replicate directly with each other, but must replicate through a common site or sites.</span></span> <span data-ttu-id="e044c-563">Si los sitios intermedios no están disponibles por algún motivo, no se producirá la replicación entre controladores de dominio en sitios conectados de forma transitiva incluso aunque haya conectividad disponible entre los sitios.</span><span class="sxs-lookup"><span data-stu-id="e044c-563">If the intermediary sites become unavailable for some reason, replication between DCs in transitively connected sites will not occur even if connectivity between the sites is available.</span></span> <span data-ttu-id="e044c-564">Por último, en las secciones en las que aún se desee un comportamiento de replicación transitivo, cree puentes de vínculos de sitios que contengan los sitios y vínculos de sitios adecuados, como los sitios locales o los de la red corporativa.</span><span class="sxs-lookup"><span data-stu-id="e044c-564">Finally, where sections of transitive replication behavior remain desirable, create site link bridges that contain the appropriate site-links and sites, such as on-premises, corporate network sites.</span></span>
  * <span data-ttu-id="e044c-565">[Configure los costos del vínculo de sitio](https://technet.microsoft.com/library/cc794882) adecuadamente para evitar el tráfico no intencionado.</span><span class="sxs-lookup"><span data-stu-id="e044c-565">[Configure site link costs](https://technet.microsoft.com/library/cc794882) appropriately to avoid unintended traffic.</span></span> <span data-ttu-id="e044c-566">Por ejemplo, si la opción **Intentar siguiente sitio más cercano** está habilitada, asegúrese de que los sitios de red virtual no sean los siguientes sitios más cercanos mediante el aumento del costo asociado del objeto de vínculo de sitio que vuelve a conectar el sitio de Azure a la red corporativa.</span><span class="sxs-lookup"><span data-stu-id="e044c-566">For example, if **Try Next Closest Site** setting is enabled, make sure the virtual network sites are not the next closest by increasing the cost associated of the site-link object that connects the Azure site back to the corporate network.</span></span>
  * <span data-ttu-id="e044c-567">Configure los [intervalos](https://technet.microsoft.com/library/cc794878) y las [programaciones](https://technet.microsoft.com/library/cc816906) de vínculos de sitios según los requisitos de coherencia y la tasa de cambios de objeto.</span><span class="sxs-lookup"><span data-stu-id="e044c-567">Configure site link [intervals](https://technet.microsoft.com/library/cc794878) and [schedules](https://technet.microsoft.com/library/cc816906) according to consistency requirements and rate of object changes.</span></span> <span data-ttu-id="e044c-568">Alinee la programación de replicación con la tolerancia de latencia.</span><span class="sxs-lookup"><span data-stu-id="e044c-568">Align replication schedule with latency tolerance.</span></span> <span data-ttu-id="e044c-569">Los controladores de dominio replican solo el último estado de un valor, por lo que disminuir el intervalo de replicación puede ahorrar costos si hay una frecuencia de cambio de objetos suficiente.</span><span class="sxs-lookup"><span data-stu-id="e044c-569">DCs replicate only the last state of a value, so decreasing the replication interval can save costs if there is a sufficient object change rate.</span></span>
* <span data-ttu-id="e044c-570">Si la reducción de costos es una prioridad, asegúrese de que se programa la replicación y que no está habilitada la notificación de cambios.</span><span class="sxs-lookup"><span data-stu-id="e044c-570">If minimizing costs is a priority, ensure replication is scheduled and change notification is not enabled.</span></span> <span data-ttu-id="e044c-571">Esta es la configuración predeterminada cuando se replica entre sitios.</span><span class="sxs-lookup"><span data-stu-id="e044c-571">This is the default configuration when replicating between sites.</span></span> <span data-ttu-id="e044c-572">Esto no es importante si va a implementar un RODC en una red virtual ya que el RODC no replicará ningún cambio de salida.</span><span class="sxs-lookup"><span data-stu-id="e044c-572">This is not important if you are deploying an RODC on a virtual network because the RODC will not replicate any changes outbound.</span></span> <span data-ttu-id="e044c-573">Pero si implementa un controlador de dominio de escritura, debe asegurarse de que no esté configurado el vínculo de sitio para replicar actualizaciones con una frecuencia innecesaria.</span><span class="sxs-lookup"><span data-stu-id="e044c-573">But if you deploy a writable DC, you should make sure the site link is not configured to replicate updates with unnecessary frequency.</span></span> <span data-ttu-id="e044c-574">Si implementa un servidor de catálogo global (GC), asegúrese de que todos los sitios que contienen un catálogo global replican las particiones de dominio desde un controlador de dominio de origen en un sitio que está conectado con uno o varios vínculos de sitios que tienen un costo menor que el del catálogo global del sitio de Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-574">If you deploy a global catalog server (GC), make sure that every other site that contains a GC replicates domain partitions from a source DC in a site that is connected with a site-link or site-links that have a lower cost than the GC in the Azure site.</span></span>
* <span data-ttu-id="e044c-575">Es posible reducir aún más el tráfico de red generado por la replicación entre sitios mediante el cambio del algoritmo de compresión de replicación.</span><span class="sxs-lookup"><span data-stu-id="e044c-575">It is possible to further still reduce network traffic generated by replication between sites by changing the replication compression algorithm.</span></span> <span data-ttu-id="e044c-576">El algoritmo de compresión se controla mediante la entrada de registro REG_DWORD HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NTDS\Parameters\Replicator compression algorithm.</span><span class="sxs-lookup"><span data-stu-id="e044c-576">The compression algorithm is controlled by the REG_DWORD registry entry HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NTDS\Parameters\Replicator compression algorithm.</span></span> <span data-ttu-id="e044c-577">El valor predeterminado es 3, que corresponde al algoritmo de compresión Xpress.</span><span class="sxs-lookup"><span data-stu-id="e044c-577">The default value is 3, which correlates to the Xpress Compress algorithm.</span></span> <span data-ttu-id="e044c-578">Puede cambiar el valor a 2, lo cual cambia el algoritmo a MSZip.</span><span class="sxs-lookup"><span data-stu-id="e044c-578">You can change the value to 2, which changes the algorithm to MSZip.</span></span> <span data-ttu-id="e044c-579">En la mayoría de los casos, esto aumentará la compresión, pero a costa de la utilización de la CPU.</span><span class="sxs-lookup"><span data-stu-id="e044c-579">In most cases, this will increase the compression, but it does so at the expense of CPU utilization.</span></span> <span data-ttu-id="e044c-580">Para obtener más información, consulte [How Active Directory replication topology works](https://technet.microsoft.com/library/cc755994)(Funcionamiento de la topología de replicación de Active Directory).</span><span class="sxs-lookup"><span data-stu-id="e044c-580">For more information, see [How Active Directory replication topology works](https://technet.microsoft.com/library/cc755994).</span></span>

### <span data-ttu-id="e044c-581"><a name="BKMK_IPAddressDNS"></a>Direccionamiento IP y DNS</span><span class="sxs-lookup"><span data-stu-id="e044c-581"><a name="BKMK_IPAddressDNS"></a>IP addressing and DNS</span></span>
<span data-ttu-id="e044c-582">A las máquinas virtuales se les asignan "direcciones concedidas por DHCP" de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="e044c-582">Azure virtual machines are allocated “DHCP-leased addresses” by default.</span></span> <span data-ttu-id="e044c-583">Puesto que las direcciones dinámicas de la red virtual se conservan mediante una máquina virtual durante la vigencia de la misma, se cumplen los requisitos de Windows Server AD DS.</span><span class="sxs-lookup"><span data-stu-id="e044c-583">Because Azure virtual network dynamic addresses persist with a virtual machine for the lifetime of the virtual machine, the requirements of Windows Server AD DS are met.</span></span>

<span data-ttu-id="e044c-584">Como resultado, cuando utiliza una dirección dinámica en Azure, está utilizando en efecto una dirección IP estática porque es enrutable durante el período de la concesión y el período de la concesión es igual a la duración del servicio en la nube.</span><span class="sxs-lookup"><span data-stu-id="e044c-584">As a result, when you use a dynamic address on Azure, you are in effect using a static IP address because it is routable for the period of the lease, and the period of the lease is equal to the lifetime of the cloud service.</span></span>

<span data-ttu-id="e044c-585">Sin embargo, la dirección dinámica se desasigna si la máquina virtual se cierra.</span><span class="sxs-lookup"><span data-stu-id="e044c-585">However, the dynamic address is deallocated if the VM is shutdown.</span></span> <span data-ttu-id="e044c-586">Para evitar que la dirección IP se desasigne, puede [usar Set-AzureStaticVNetIP para asignar una dirección IP estática](http://social.technet.microsoft.com/wiki/contents/articles/23447.how-to-assign-a-private-static-ip-to-an-azure-vm.aspx).</span><span class="sxs-lookup"><span data-stu-id="e044c-586">To prevent the IP address from being deallocated, you can [use Set-AzureStaticVNetIP to assign a static IP address](http://social.technet.microsoft.com/wiki/contents/articles/23447.how-to-assign-a-private-static-ip-to-an-azure-vm.aspx).</span></span>

<span data-ttu-id="e044c-587">Para la resolución de nombres, implemente su propia infraestructura de servidor DNS (o aproveche la existente). El DNS proporcionado por Azure no satisface las necesidades de resolución de nombres avanzada de Windows Server AD DS.</span><span class="sxs-lookup"><span data-stu-id="e044c-587">For name resolution, deploy your own (or leverage your existing) DNS server infrastructure; Azure-provided DNS does not meet the advanced name resolution needs of Windows Server AD DS.</span></span> <span data-ttu-id="e044c-588">Por ejemplo, no admite registros SRV dinámicos, etc.</span><span class="sxs-lookup"><span data-stu-id="e044c-588">For example, it does not support dynamic SRV records, and so on.</span></span> <span data-ttu-id="e044c-589">La resolución de nombres es un elemento de configuración crítico para los controladores de dominio y los clientes unidos a un dominio.</span><span class="sxs-lookup"><span data-stu-id="e044c-589">Name resolution is a critical configuration item for DCs and domain-joined clients.</span></span> <span data-ttu-id="e044c-590">Los controladores de dominio deben ser capaces de registrar los registros de recursos y resolver los registros de recursos de otros controladores de dominio.</span><span class="sxs-lookup"><span data-stu-id="e044c-590">DCs must be capable of registering resource records and resolving other DC’s resource records.</span></span>
<span data-ttu-id="e044c-591">Por razones de rendimiento y tolerancia a errores, lo ideal es instalar el servicio DNS de Windows Server en los controladores de dominio que se ejecutan en Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-591">For fault tolerance and performance reasons, it is optimal to install the Windows Server DNS service on the DCs running on Azure.</span></span> <span data-ttu-id="e044c-592">Configure las propiedades de la red virtual de Azure con el nombre y la dirección IP del servidor DNS.</span><span class="sxs-lookup"><span data-stu-id="e044c-592">Then configure the Azure virtual network properties with the name and IP address of the DNS server.</span></span> <span data-ttu-id="e044c-593">Cuando se inician otras máquinas virtuales en la red virtual, las opciones del solucionador de cliente DNS se configurarán con el servidor DNS como parte de la asignación de direcciones IP dinámicas.</span><span class="sxs-lookup"><span data-stu-id="e044c-593">When other VMs on the virtual network start, their DNS client resolver settings will be configured with DNS server as part of the dynamic IP address allocation.</span></span>

> [!NOTE]
> <span data-ttu-id="e044c-594">No puede unir equipos locales a un dominio de Active Directory de Windows Server AD DS que se hospeda en Azure directamente a través de Internet.</span><span class="sxs-lookup"><span data-stu-id="e044c-594">You cannot join on-premises computers to a Windows Server AD DS Active Directory domain that is hosted on Azure directly over the Internet.</span></span> <span data-ttu-id="e044c-595">Los requisitos de puerto para Active Directory y para la operación de unión al dominio hacen que no sea práctico exponer directamente los puertos necesarios ni un controlador de dominio completo a Internet.</span><span class="sxs-lookup"><span data-stu-id="e044c-595">The port requirements for Active Directory and the domain-join operation render it impractical to directly expose the necessary ports and in effect, an entire DC to the Internet.</span></span>
> 
> 

<span data-ttu-id="e044c-596">Las máquinas virtuales registran su nombre DNS automáticamente al iniciarse o cuando hay un cambio de nombre.</span><span class="sxs-lookup"><span data-stu-id="e044c-596">VMs register their DNS name automatically on startup or when there is a name change.</span></span>

<span data-ttu-id="e044c-597">Para obtener más información acerca de este ejemplo y otro ejemplo que muestra cómo aprovisionar la primera máquina virtual e instalar AD DS en ella, consulte [Instalación de un bosque nuevo de Active Directory en una red virtual de Azure](active-directory-new-forest-virtual-machine.md).</span><span class="sxs-lookup"><span data-stu-id="e044c-597">For more information about this example and another example that shows how to provision the first VM and install AD DS on it, see [Install a new Active Directory forest on Microsoft Azure](active-directory-new-forest-virtual-machine.md).</span></span> <span data-ttu-id="e044c-598">Si desea conocer más detalles sobre el uso de Windows PowerShell, consulte [Cómo instalar y configurar Azure PowerShell](/powershell/azureps-cmdlets-docs) y [Azure Management Cmdlets](/powershell/module/azurerm.compute/#virtual_machines) (Cmdlets de administración de Azure).</span><span class="sxs-lookup"><span data-stu-id="e044c-598">For more information about using Windows PowerShell, see [Install Azure PowerShell](/powershell/azureps-cmdlets-docs) and [Azure Management Cmdlets](/powershell/module/azurerm.compute/#virtual_machines).</span></span>

### <span data-ttu-id="e044c-599"><a name="BKMK_DistributedDCs"></a>Controladores de dominio distribuidos geográficamente</span><span class="sxs-lookup"><span data-stu-id="e044c-599"><a name="BKMK_DistributedDCs"></a>Geo-distributed DCs</span></span>
<span data-ttu-id="e044c-600">Azure ofrece diversas ventajas cuando se hospedan varios controladores de dominio en redes virtuales diferentes:</span><span class="sxs-lookup"><span data-stu-id="e044c-600">Azure offers advantages when hosting multiple DCs on different virtual networks:</span></span>

* <span data-ttu-id="e044c-601">Tolerancia a errores de varios sitios</span><span class="sxs-lookup"><span data-stu-id="e044c-601">Multi-site fault-tolerance</span></span>
* <span data-ttu-id="e044c-602">Proximidad física a sucursales (menor latencia)</span><span class="sxs-lookup"><span data-stu-id="e044c-602">Physical proximity to branch offices (lower latency)</span></span>

<span data-ttu-id="e044c-603">Para obtener más información acerca de cómo configurar la comunicación directa entre redes virtuales, consulte [Configuración de una conexión de red virtual a red virtual para el modelo de implementación clásico](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span><span class="sxs-lookup"><span data-stu-id="e044c-603">For information about configuring direct communication between virtual networks, see [Configure virtual network to virtual network connectivity](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span></span>

### <span data-ttu-id="e044c-604"><a name="BKMK_RODC"></a>Controladores de dominio de solo lectura</span><span class="sxs-lookup"><span data-stu-id="e044c-604"><a name="BKMK_RODC"></a>Read-only DCs</span></span>
<span data-ttu-id="e044c-605">Debe decidir si desea implementar controladores de dominio de solo lectura o de escritura.</span><span class="sxs-lookup"><span data-stu-id="e044c-605">You need to choose whether to deploy read-only or writeable DCs.</span></span> <span data-ttu-id="e044c-606">Puede que se incline por implementar RODC porque no tendrá control físico sobre ellos, pero los RODC están diseñados para su implementación en ubicaciones donde la seguridad física es un riesgo, como las sucursales.</span><span class="sxs-lookup"><span data-stu-id="e044c-606">You might be inclined to deploy RODCs because you will not have physical control over them, but RODCs are designed to be deployed in locations where their physical security is at risk, such as branch offices.</span></span>

<span data-ttu-id="e044c-607">Azure no presenta el riesgo de la seguridad física de una sucursal, pero los RODC siguen siendo más rentables ya que las características que proporcionan son adecuadas para estos entornos aunque por motivos muy diferentes.</span><span class="sxs-lookup"><span data-stu-id="e044c-607">Azure does not present the physical security risk of a branch office, but RODCs might still prove to be more cost effective because the features they provide are well-suited to these environments albeit for very different reasons.</span></span> <span data-ttu-id="e044c-608">Por ejemplo, los RODC no generan ninguna replicación de salida y podrá rellenar selectivamente secretos (contraseñas).</span><span class="sxs-lookup"><span data-stu-id="e044c-608">For example, RODCs have no outbound replication and are able to selectively populate secrets (passwords).</span></span> <span data-ttu-id="e044c-609">Como inconveniente, la falta de estos secretos puede requerir un tráfico de salida a petición para validarlos cuando un usuario o equipo se autentica.</span><span class="sxs-lookup"><span data-stu-id="e044c-609">On the downside, the lack of these secrets might require on-demand outbound traffic to validate them as a user or computer authenticates.</span></span> <span data-ttu-id="e044c-610">Pero los secretos se pueden rellenar previamente de forma selectiva y almacenarlos en caché.</span><span class="sxs-lookup"><span data-stu-id="e044c-610">But secrets can be selectively prepopulated and cached.</span></span>

<span data-ttu-id="e044c-611">Los RODC proporcionan una ventaja adicional en relación con los datos de alto impacto de negocio (HBI) y los de información de identificación personal (PII) porque se pueden agregar atributos que contengan datos confidenciales al conjunto de atributos filtrados (FAS) de RODC.</span><span class="sxs-lookup"><span data-stu-id="e044c-611">RODCs provide an additional advantage in and around HBI and PII concerns because you can add attributes that contain sensitive data to the RODC filtered attribute set (FAS).</span></span> <span data-ttu-id="e044c-612">Este conjunto es un conjunto personalizable de atributos que no se replican en los RODC.</span><span class="sxs-lookup"><span data-stu-id="e044c-612">The FAS is a customizable set of attributes that are not replicated to RODCs.</span></span> <span data-ttu-id="e044c-613">Puede utilizar este conjunto como medida de seguridad en caso de que no se le permita o no desee almacenar datos de alto impacto de negocio o información de identificación personal en Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-613">You can use the FAS as a safeguard in case you are not permitted or do not want to store PII or HBI on Azure.</span></span> <span data-ttu-id="e044c-614">Para más información, consulte [RODC filtered attribute set (Conjunto de atributos filtrados de RODC) en [(https://technet.microsoft.com/library/cc753459)]</span><span class="sxs-lookup"><span data-stu-id="e044c-614">For more information, see [RODC filtered attribute set[(https://technet.microsoft.com/library/cc753459)].</span></span>

<span data-ttu-id="e044c-615">Asegúrese de que las aplicaciones sean compatibles con los RODC que planea utilizar.</span><span class="sxs-lookup"><span data-stu-id="e044c-615">Make sure that applications will be compatible with RODCs you plan to use.</span></span> <span data-ttu-id="e044c-616">Muchas aplicaciones habilitadas para Windows Server Active Directory funcionan bien con los RODC, pero algunas de ellas pueden realizar su función de forma ineficaz o se pueden producir errores si no tiene acceso a un controlador de dominio de escritura.</span><span class="sxs-lookup"><span data-stu-id="e044c-616">Many Windows Server Active Directory-enabled applications work well with RODCs, but some applications can perform inefficiently or fail if they do not have access to a writable DC.</span></span> <span data-ttu-id="e044c-617">Para obtener más información, consulte la [guía de compatibilidad de aplicaciones con controladores de dominio de solo lectura](https://technet.microsoft.com/library/cc755190).</span><span class="sxs-lookup"><span data-stu-id="e044c-617">For more information, see [Read-Only DCs application compatibility guide](https://technet.microsoft.com/library/cc755190).</span></span>

### <span data-ttu-id="e044c-618"><a name="BKMK_GC"></a>Catálogo global</span><span class="sxs-lookup"><span data-stu-id="e044c-618"><a name="BKMK_GC"></a>Global catalog</span></span>
<span data-ttu-id="e044c-619">Debe elegir si desea instalar un catálogo global (GC).</span><span class="sxs-lookup"><span data-stu-id="e044c-619">You need to choose whether to install a global catalog (GC).</span></span> <span data-ttu-id="e044c-620">En un bosque de dominio único, debe configurar todos los controladores de dominio como servidores de catálogo global.</span><span class="sxs-lookup"><span data-stu-id="e044c-620">In a single domain forest, you should configure all DCs as global catalog servers.</span></span> <span data-ttu-id="e044c-621">Esto no aumentará los costos porque no habrá ningún tráfico de replicación adicional.</span><span class="sxs-lookup"><span data-stu-id="e044c-621">It will not increase costs because there will be no additional replication traffic.</span></span>

<span data-ttu-id="e044c-622">En un bosque con varios dominios, los catálogos globales son necesarios para expandir la pertenencia al grupo universal durante el proceso de autenticación.</span><span class="sxs-lookup"><span data-stu-id="e044c-622">In a multidomain forest, GCs are necessary to expand Universal Group memberships during the authentication process.</span></span> <span data-ttu-id="e044c-623">Si no implementa un catálogo global, las cargas de trabajo en la red virtual que se autentican en un controlador de dominio en Azure generarán indirectamente un tráfico de autenticación de salida para consultar los catálogos globales locales durante cada intento de autenticación.</span><span class="sxs-lookup"><span data-stu-id="e044c-623">If you do not deploy a GC, workloads on the virtual network that authenticate against a DC on Azure will indirectly generate outbound authentication traffic to query GCs on-premises during each authentication attempt.</span></span>

<span data-ttu-id="e044c-624">Los costos asociados con los catálogos globales son menos predecibles porque hospedan todos los dominios (en parte).</span><span class="sxs-lookup"><span data-stu-id="e044c-624">The costs associated with GCs are less-predictable because they host every domain (in-part).</span></span> <span data-ttu-id="e044c-625">Si la carga de trabajo hospeda un servicio accesible desde Internet y autentica usuarios en Windows Server AD DS, los costos podrían ser completamente imprevisibles.</span><span class="sxs-lookup"><span data-stu-id="e044c-625">If the workload hosts an Internet-facing service and authenticates users against Windows Server AD DS, the costs could be completely unpredictable.</span></span> <span data-ttu-id="e044c-626">Para ayudar a reducir las consultas de catálogo global fuera del sitio en la nube durante la autenticación, puede [habilitar el almacenamiento en caché de pertenencia al grupo universal](https://technet.microsoft.com/library/cc816928).</span><span class="sxs-lookup"><span data-stu-id="e044c-626">To help reduce GC queries outside of the cloud site during authentication, you can [enable Universal Group Membership Caching](https://technet.microsoft.com/library/cc816928).</span></span>

### <span data-ttu-id="e044c-627"><a name="BKMK_InstallMethod"></a>Método de instalación</span><span class="sxs-lookup"><span data-stu-id="e044c-627"><a name="BKMK_InstallMethod"></a>Installation method</span></span>
<span data-ttu-id="e044c-628">Debe elegir cómo instalar los controladores de dominio en la red virtual:</span><span class="sxs-lookup"><span data-stu-id="e044c-628">You need to choose how to install the DCs on the virtual network:</span></span>

* <span data-ttu-id="e044c-629">Promoción de nuevos controladores de dominio.</span><span class="sxs-lookup"><span data-stu-id="e044c-629">Promote new DCs.</span></span> <span data-ttu-id="e044c-630">Para obtener más información, consulte [Instalación de un bosque nuevo de Active Directory en una red virtual de Azure](active-directory-new-forest-virtual-machine.md).</span><span class="sxs-lookup"><span data-stu-id="e044c-630">For more information, see [Install a new Active Directory forest on an Azure virtual network](active-directory-new-forest-virtual-machine.md).</span></span>
* <span data-ttu-id="e044c-631">Traslado del VHD de un controlador de dominio virtual local a la nube.</span><span class="sxs-lookup"><span data-stu-id="e044c-631">Move the VHD of an on-premises virtual DC to the cloud.</span></span> <span data-ttu-id="e044c-632">En este caso, debe asegurarse de que el controlador de dominio virtual local se "mueva" y no se "copie" o "clone" simplemente.</span><span class="sxs-lookup"><span data-stu-id="e044c-632">In this case, you must ensure that the on-premises virtual DC is “moved,” not “copied” or “cloned.”</span></span>

<span data-ttu-id="e044c-633">Utilice solo máquinas virtuales de Azure para los controladores de dominio (en lugar de máquinas virtuales con roles "web" o de "trabajo").</span><span class="sxs-lookup"><span data-stu-id="e044c-633">Use only Azure virtual machines for DCs (as opposed to Azure “web” or “worker” role VMs).</span></span> <span data-ttu-id="e044c-634">Son duraderas y la durabilidad de estado es un requisito para un controlador de dominio.</span><span class="sxs-lookup"><span data-stu-id="e044c-634">They are durable and durability of state for a DC is required.</span></span> <span data-ttu-id="e044c-635">Las máquinas virtuales de Azure están diseñadas para cargas de trabajo como controladores de dominio.</span><span class="sxs-lookup"><span data-stu-id="e044c-635">Azure virtual machines are designed for workloads such as DCs.</span></span>

<span data-ttu-id="e044c-636">No utilice SYSPREP para implementar o clonar controladores de dominio.</span><span class="sxs-lookup"><span data-stu-id="e044c-636">Do not use SYSPREP to deploy or clone DCs.</span></span> <span data-ttu-id="e044c-637">La capacidad para clonar controladores de dominio solo está disponible a partir de Windows Server 2012.</span><span class="sxs-lookup"><span data-stu-id="e044c-637">The ability to clone DCs is only available beginning in Windows Server 2012.</span></span> <span data-ttu-id="e044c-638">La característica de clonación requiere compatibilidad con VMGenerationID en el hipervisor subyacente.</span><span class="sxs-lookup"><span data-stu-id="e044c-638">The cloning feature requires support for VMGenerationID in the underlying hypervisor.</span></span> <span data-ttu-id="e044c-639">Tanto Hyper-V en Windows Server 2012 como Redes virtuales de Azure son compatibles con VMGenerationID, al igual que otros proveedores de software de virtualización de terceros.</span><span class="sxs-lookup"><span data-stu-id="e044c-639">Hyper-V in Windows Server 2012 and Azure virtual networks both support VMGenerationID, as do third-party virtualization software vendors.</span></span>

### <span data-ttu-id="e044c-640"><a name="BKMK_PlaceDB"></a>Selección de ubicación de la base de datos y SYSVOL de Windows Server AD DS</span><span class="sxs-lookup"><span data-stu-id="e044c-640"><a name="BKMK_PlaceDB"></a>Placement of the Windows Server AD DS database and SYSVOL</span></span>
<span data-ttu-id="e044c-641">Seleccione dónde desea almacenar la base de datos, los registros y SYSVOL de Windows Server AD DS.</span><span class="sxs-lookup"><span data-stu-id="e044c-641">Select where to locate the Windows Server AD DS database, logs, and SYSVOL.</span></span> <span data-ttu-id="e044c-642">Se deben implementar en discos de datos de Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-642">They must be deployed on Azure Data disks.</span></span>

> [!NOTE]
> <span data-ttu-id="e044c-643">Los discos de datos de Azure están limitados a 1 TB.</span><span class="sxs-lookup"><span data-stu-id="e044c-643">Azure Data disks are constrained to 1 TB.</span></span>
> 
> 

<span data-ttu-id="e044c-644">Las unidades de disco de datos no tienen cachés de escritura de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="e044c-644">Data disk drives do not cache writes by default.</span></span> <span data-ttu-id="e044c-645">Las unidades de disco de datos que están conectadas a una máquina virtual usan una caché de escritura a través.</span><span class="sxs-lookup"><span data-stu-id="e044c-645">Data disk drives that are attached to a VM use write-through caching.</span></span> <span data-ttu-id="e044c-646">La caché de escritura a través garantiza que la escritura se confirma en un Almacenamiento de Azure duradero antes de que la transacción se complete desde la perspectiva del sistema operativo de la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="e044c-646">Write-through caching makes sure the write is committed to durable Azure storage before the transaction is complete from the perspective of the VM’s operating system.</span></span> <span data-ttu-id="e044c-647">Proporciona durabilidad, a costa de escrituras ligeramente más lentas.</span><span class="sxs-lookup"><span data-stu-id="e044c-647">It provides durability, at the expense of slightly slower writes.</span></span>

<span data-ttu-id="e044c-648">Esto es importante para Windows Server AD DS porque la caché de disco de escritura por detrás invalida los supuestos realizados por el controlador de dominio.</span><span class="sxs-lookup"><span data-stu-id="e044c-648">This is important for Windows Server AD DS because write-behind disk-caching invalidates assumptions made by the DC.</span></span> <span data-ttu-id="e044c-649">Windows Server AD DS intenta deshabilitar la caché de escritura, pero depende del sistema de E/S de disco el admitirlo.</span><span class="sxs-lookup"><span data-stu-id="e044c-649">Windows Server AD DS attempts to disable write caching but it is up to the disk IO system to honor it.</span></span> <span data-ttu-id="e044c-650">El error al deshabilitar la caché de escritura puede, en determinadas circunstancias, introducir una reversión de USN que resulte en objetos persistentes y otros problemas.</span><span class="sxs-lookup"><span data-stu-id="e044c-650">Failure to disable write caching may, under certain circumstances, introduce USN rollback resulting in lingering objects and other problems.</span></span>

<span data-ttu-id="e044c-651">Como procedimiento recomendado para controladores de dominio virtuales, realice lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="e044c-651">As a best practice for virtual DCs, do the following:</span></span>

* <span data-ttu-id="e044c-652">Establezca la preferencia de caché de host en el disco de datos de Azure en NINGUNA.</span><span class="sxs-lookup"><span data-stu-id="e044c-652">Set the Host Cache Preference setting on the Azure data disk for NONE.</span></span> <span data-ttu-id="e044c-653">Esto evita problemas con la caché de escritura para las operaciones de AD DS.</span><span class="sxs-lookup"><span data-stu-id="e044c-653">This prevents issues with write caching for AD DS operations.</span></span>
* <span data-ttu-id="e044c-654">Almacene la base de datos, los registros y SYSVOL en el mismo disco de datos o bien en discos de datos independientes.</span><span class="sxs-lookup"><span data-stu-id="e044c-654">Store the database, logs, and SYSVOL on the either same data disk or separate data disks.</span></span> <span data-ttu-id="e044c-655">Normalmente, se trata de un disco independiente del disco utilizado por el propio sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="e044c-655">Typically, this is a separate disk from the disk used for the operating system itself.</span></span> <span data-ttu-id="e044c-656">El punto clave es que la base de datos y SYSVOL de Windows Server AD DS no deben almacenarse en un tipo de disco de sistema operativo de Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-656">The key takeaway is that the Windows Server AD DS database and SYSVOL must not be stored on an Azure Operating System disk type.</span></span> <span data-ttu-id="e044c-657">De forma predeterminada, el proceso de instalación de AD DS instala estos componentes en la carpeta %systemroot%, lo cual NO es recomendable para Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-657">By default, the AD DS installation process installs these components in %systemroot% folder, which is NOT recommended for Azure.</span></span>

### <span data-ttu-id="e044c-658"><a name="BKMK_BUR"></a>Copia de seguridad y restauración</span><span class="sxs-lookup"><span data-stu-id="e044c-658"><a name="BKMK_BUR"></a>Backup and restore</span></span>
<span data-ttu-id="e044c-659">Tenga en cuenta lo que es compatible y lo que no a la hora de realizar una copia de seguridad y restauración de un controlador de dominio en general y, más concretamente, de aquellos que se ejecutan en una máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="e044c-659">Be aware of what is and is not supported for backup and restore of a DC in general, and more specifically, those running in a VM.</span></span> <span data-ttu-id="e044c-660">Consulte la sección de [consideraciones relacionadas con la copia de seguridad y la restauración para controladores de dominio virtualizados](https://technet.microsoft.com/library/virtual_active_directory_domain_controller_virtualization_hyperv#backup_and_restore_considerations_for_virtualized_domain_controllers).</span><span class="sxs-lookup"><span data-stu-id="e044c-660">See [Backup and Restore Considerations for Virtualized DCs](https://technet.microsoft.com/library/virtual_active_directory_domain_controller_virtualization_hyperv#backup_and_restore_considerations_for_virtualized_domain_controllers).</span></span>

<span data-ttu-id="e044c-661">Cree copias de seguridad del estado del sistema solo mediante software que sea compatible específicamente con los requisitos de copia de seguridad para Windows Server AD DS como, por ejemplo, Copias de seguridad de Windows Server.</span><span class="sxs-lookup"><span data-stu-id="e044c-661">Create system state backups by using only backup software that is specifically aware of backup requirements for Windows Server AD DS, such as Windows Server Backup.</span></span>

<span data-ttu-id="e044c-662">No copie ni clone archivos VHD de los controladores de dominio en lugar de realizar copias de seguridad periódicas.</span><span class="sxs-lookup"><span data-stu-id="e044c-662">Do not copy or clone VHD files of DCs instead of performing regular backups.</span></span> <span data-ttu-id="e044c-663">Si en alguna ocasión se necesita una restauración, hacerlo con VHD clonados o copiados sin Windows Server 2012 y un hipervisor compatible hará que se incluyan burbujas de USN.</span><span class="sxs-lookup"><span data-stu-id="e044c-663">Should a restore ever be required, doing so using cloned or copied VHDs without Windows Server 2012 and a supported hypervisor will introduce USN bubbles.</span></span>

### <span data-ttu-id="e044c-664"><a name="BKMK_FedSrvConfig"></a>Configuración del servidor de federación</span><span class="sxs-lookup"><span data-stu-id="e044c-664"><a name="BKMK_FedSrvConfig"></a>Federation server configuration</span></span>
<span data-ttu-id="e044c-665">La configuración de servidores de federación (STS) de Windows Server AD FS depende en parte de si las aplicaciones que desea implementar en Azure necesitan tener acceso a recursos de la red local.</span><span class="sxs-lookup"><span data-stu-id="e044c-665">The configuration of Windows Server AD FS federation servers (STSs) depends in part on whether the applications that you want to deploy on Azure need to access resources on your on-premises network.</span></span>

<span data-ttu-id="e044c-666">Si las aplicaciones cumplen los criterios siguientes, podría implementarlas de forma aislada desde la red local.</span><span class="sxs-lookup"><span data-stu-id="e044c-666">If the applications meet the following criteria, you could deploy the applications in isolation from your on-premises network.</span></span>

* <span data-ttu-id="e044c-667">Aceptan tokens de seguridad SAML</span><span class="sxs-lookup"><span data-stu-id="e044c-667">They accept SAML security tokens</span></span>
* <span data-ttu-id="e044c-668">Se pueden exponer en Internet</span><span class="sxs-lookup"><span data-stu-id="e044c-668">They are exposable to the Internet</span></span>
* <span data-ttu-id="e044c-669">No acceden a los recursos locales</span><span class="sxs-lookup"><span data-stu-id="e044c-669">They do not access on-premises resources</span></span>

<span data-ttu-id="e044c-670">En este caso, configure los STS de Windows Server AD FS como sigue:</span><span class="sxs-lookup"><span data-stu-id="e044c-670">In this case, configure Windows Server AD FS STSs as follows:</span></span>

1. <span data-ttu-id="e044c-671">Configure un bosque de dominio único aislado en Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-671">Configure an isolated single-domain forest on Azure.</span></span>
2. <span data-ttu-id="e044c-672">Proporcione acceso federado al bosque mediante la configuración de una granja de servidores de federación de Windows Server AD FS.</span><span class="sxs-lookup"><span data-stu-id="e044c-672">Provide federated access to the forest by configuring a Windows Server AD FS federation server farm.</span></span>
3. <span data-ttu-id="e044c-673">Configure Windows Server AD FS (la granja de servidores de federación y la granja proxy de servidores de federación) en el bosque local.</span><span class="sxs-lookup"><span data-stu-id="e044c-673">Configure Windows Server AD FS (federation server farm and federation server proxy farm) in the on-premises forest.</span></span>
4. <span data-ttu-id="e044c-674">Establezca una relación de confianza de federación entre las instancias locales y de Azure de Windows Server AD FS.</span><span class="sxs-lookup"><span data-stu-id="e044c-674">Establish a federation trust relationship between the on-premises and Azure instances of Windows Server AD FS.</span></span>

<span data-ttu-id="e044c-675">Por otro lado, si las aplicaciones requieren acceso a recursos locales, puede configurar Windows Server AD FS con la aplicación en Azure como sigue:</span><span class="sxs-lookup"><span data-stu-id="e044c-675">On the other hand, if the applications require access to on-premises resources, you could configure Windows Server AD FS with the application on Azure as follows:</span></span>

1. <span data-ttu-id="e044c-676">Configure la conectividad entre redes locales y Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-676">Configure connectivity between on-premises networks and Azure.</span></span>
2. <span data-ttu-id="e044c-677">Configure una granja de servidores de federación de Windows Server AD FS en el bosque local.</span><span class="sxs-lookup"><span data-stu-id="e044c-677">Configure a Windows Server AD FS federation server farm in the on-premises forest.</span></span>
3. <span data-ttu-id="e044c-678">Configure una granja proxy de servidores de federación de Windows Server AD FS en Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-678">Configure a Windows Server AD FS federation server proxy farm on Azure.</span></span>

<span data-ttu-id="e044c-679">Esta configuración tiene la ventaja de reducir la exposición de recursos locales, ventaja similar a la de la configuración de Windows Server AD FS con aplicaciones en una red perimetral.</span><span class="sxs-lookup"><span data-stu-id="e044c-679">This configuration has the advantage of reducing the exposure of on-premises resources, similar to configuring Windows Server AD FS with applications in a perimeter network.</span></span>

<span data-ttu-id="e044c-680">Tenga en cuenta que en ambos escenarios, puede establecer relaciones de confianza con varios proveedores de identidades, si es necesaria la colaboración de negocio a negocio.</span><span class="sxs-lookup"><span data-stu-id="e044c-680">Note that in either scenario, you can establish trusts relationships with more identity providers, if business-to-business collaboration is needed.</span></span>

### <span data-ttu-id="e044c-681"><a name="BKMK_CloudSvcConfig"></a>Configuración de servicios en la nube</span><span class="sxs-lookup"><span data-stu-id="e044c-681"><a name="BKMK_CloudSvcConfig"></a>Cloud services configuration</span></span>
<span data-ttu-id="e044c-682">Los servicios en la nube son necesarios si desea exponer una máquina virtual directamente a Internet o una aplicación de equilibrio de carga accesible a través de Internet.</span><span class="sxs-lookup"><span data-stu-id="e044c-682">Cloud services are necessary if you want to expose a VM directly to the Internet or to expose an Internet-facing load-balanced application.</span></span> <span data-ttu-id="e044c-683">Esto es posible porque cada servicio en la nube ofrece una única dirección IP virtual configurable.</span><span class="sxs-lookup"><span data-stu-id="e044c-683">This is possible because each cloud service offers a single configurable virtual IP address.</span></span>

### <span data-ttu-id="e044c-684"><a name="BKMK_FedReqVIPDIP"></a>Requisitos del servidor de federación para el direccionamiento IP público y privado (IP dinámica frente a IP virtual)</span><span class="sxs-lookup"><span data-stu-id="e044c-684"><a name="BKMK_FedReqVIPDIP"></a>Federation server requirements for public and private IP addressing (dynamic IP vs. virtual IP)</span></span>
<span data-ttu-id="e044c-685">Cada máquina virtual de Azure recibe una dirección IP dinámica.</span><span class="sxs-lookup"><span data-stu-id="e044c-685">Each Azure virtual machine receives a dynamic IP address.</span></span> <span data-ttu-id="e044c-686">Una dirección IP dinámica es una dirección privada accesible únicamente desde dentro de Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-686">A dynamic IP address is a private address accessible only within Azure.</span></span> <span data-ttu-id="e044c-687">En la mayoría de los casos, sin embargo, será necesario configurar una dirección IP virtual para las implementaciones de Windows Server AD FS.</span><span class="sxs-lookup"><span data-stu-id="e044c-687">In most cases, however, it will be necessary to configure a virtual IP address for your Windows Server AD FS deployments.</span></span> <span data-ttu-id="e044c-688">La dirección IP virtual es necesaria para exponer los puntos de conexión de Windows Server AD FS a Internet y la utilizarán los socios y clientes federados para la autenticación y la administración continua.</span><span class="sxs-lookup"><span data-stu-id="e044c-688">The virtual IP is necessary to expose Windows Server AD FS endpoints to the Internet, and will be used by federated partners and clients for authentication and ongoing management.</span></span> <span data-ttu-id="e044c-689">Una dirección IP virtual es una propiedad de un servicio en la nube que contiene una o más máquinas virtuales de Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-689">A virtual IP address is a property of a cloud service which contains one or more Azure virtual machines.</span></span> <span data-ttu-id="e044c-690">Si las aplicaciones compatibles con notificaciones implementadas en Azure y en Windows Server AD FS son accesibles desde Internet y comparten puertos comunes, cada una necesitará una dirección IP virtual propia y, por tanto, será necesario crear un servicio en la nube para la aplicación y otro para Windows Server AD FS.</span><span class="sxs-lookup"><span data-stu-id="e044c-690">If the claims-aware application deployed on Azure and Windows Server AD FS are both Internet-facing and share common ports, each will require a virtual IP address of its own and it will therefore be necessary to create one cloud service for the application and a second for Windows Server AD FS.</span></span>

<span data-ttu-id="e044c-691">Para obtener definiciones de los términos "dirección IP virtual" y "dirección IP dinámica", consulte la sección [Términos y definiciones](#BKMK_Glossary).</span><span class="sxs-lookup"><span data-stu-id="e044c-691">For definitions of the terms virtual IP address and dynamic IP address, see [Terms and definitions](#BKMK_Glossary).</span></span>

### <span data-ttu-id="e044c-692"><a name="BKMK_ADFSHighAvail"></a>Configuración de alta disponibilidad de Windows Server AD FS</span><span class="sxs-lookup"><span data-stu-id="e044c-692"><a name="BKMK_ADFSHighAvail"></a>Windows Server AD FS high availability configuration</span></span>
<span data-ttu-id="e044c-693">Aunque es posible implementar servicios de federación de Windows Server AD FS independientes, se recomienda implementar una granja con al menos dos nodos para el STS de AD FS y para los servidores proxy para entornos de producción.</span><span class="sxs-lookup"><span data-stu-id="e044c-693">While it is possible to deploy standalone Windows Server AD FS federation services, it is recommended to deploy a farm with at least two nodes for both AD FS STS and proxies for production environments.</span></span>

<span data-ttu-id="e044c-694">Consulte [Consideraciones sobre la topología de implementación de AD FS 2.0](https://technet.microsoft.com/library/gg982489) en la [Guía de diseño de AD FS 2.0](https://technet.microsoft.com/library/dd807036) para decidir qué opciones de configuración de implementación satisfacen mejor sus necesidades específicas.</span><span class="sxs-lookup"><span data-stu-id="e044c-694">See [AD FS 2.0 deployment topology considerations](https://technet.microsoft.com/library/gg982489) in the [AD FS 2.0 Design Guide](https://technet.microsoft.com/library/dd807036) to decide which deployment configuration options best suit your particular needs.</span></span>

> [!NOTE]
> <span data-ttu-id="e044c-695">Para obtener el equilibrio de carga de los puntos de conexión de Windows Server AD FS en Azure, configure todos los miembros de la granja de Windows Server AD FS en el mismo servicio en la nube y utilice la funcionalidad de equilibrio de carga de Azure para los puertos HTTP (el 80 de forma predeterminada) y HTTPS (el 443 de forma predeterminada).</span><span class="sxs-lookup"><span data-stu-id="e044c-695">In order to get load balancing for Windows Server AD FS endpoints on Azure, configure all members of the Windows Server AD FS farm in the same cloud service, and use the load balancing capability of Azure for HTTP (default 80) and HTTPS ports (default 443).</span></span> <span data-ttu-id="e044c-696">Para obtener más información, consulte [Azure load-balancer probe](https://msdn.microsoft.com/library/azure/jj151530)(Sondeo de equilibrador de carga de Azure).</span><span class="sxs-lookup"><span data-stu-id="e044c-696">For more information, see [Azure load-balancer probe](https://msdn.microsoft.com/library/azure/jj151530).</span></span>
> <span data-ttu-id="e044c-697">No se admite el equilibrio de carga de red (NLB) de Windows Server en Azure.</span><span class="sxs-lookup"><span data-stu-id="e044c-697">Windows Server Network Load Balancing (NLB) is not supported on Azure.</span></span>
> 
> 


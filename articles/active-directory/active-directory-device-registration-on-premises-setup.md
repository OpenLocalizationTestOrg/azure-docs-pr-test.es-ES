---
title: "Configuración del acceso condicional local mediante el registro de dispositivos de Azure Active Directory | Microsoft Docs"
description: "Guía paso a paso para habilitar el acceso condicional a aplicaciones locales mediante Servicios de federación de Active Directory (AD FS) en Windows Server 2012 R2."
services: active-directory
documentationcenter: 
author: MarkusVi
manager: femila
editor: 
ms.assetid: 6ae9df8b-31fe-4d72-9181-cf50cfebbf05
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/31/2017
ms.author: markvi
ms.reviewer: jairoc
ms.openlocfilehash: 1a6f1c6566468188daa71939db8345280b7a529f
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/03/2017
---
# <a name="setting-up-on-premises-conditional-access-by-using-azure-active-directory-device-registration"></a><span data-ttu-id="516bc-103">Configuración del acceso condicional local mediante el registro de dispositivos de Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="516bc-103">Setting up on-premises conditional access by using Azure Active Directory device registration</span></span>
<span data-ttu-id="516bc-104">Cuando se requiera que los usuarios unan sus dispositivos personales al área de trabajo en el servicio de registro de dispositivos de Azure Active Directory (Azure AD), los dispositivos deben estar marcados como conocidos para la organización.</span><span class="sxs-lookup"><span data-stu-id="516bc-104">When you require users to workplace-join their personal devices to the Azure Active Directory (Azure AD) device registration service, their devices can be marked as known to your organization.</span></span> <span data-ttu-id="516bc-105">A continuación aparece una guía paso a paso para habilitar el acceso condicional a aplicaciones locales mediante Servicios de federación de Active Directory (AD FS) en Windows Server 2012 R2.</span><span class="sxs-lookup"><span data-stu-id="516bc-105">Following is a step-by-step guide for enabling conditional access to on-premises applications by using Active Directory Federation Services (AD FS) in Windows Server 2012 R2.</span></span>

> [!NOTE]
> <span data-ttu-id="516bc-106">Se requiere una licencia de Azure AD Premium o de Office 365 al usar dispositivos que están registrados en directivas de acceso condicional del servicio de registros de dispositivos de Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="516bc-106">An Office 365 license or Azure AD Premium license is required when using devices that are registered in Azure Active Directory device registration service conditional access policies.</span></span> <span data-ttu-id="516bc-107">Estas incluyen directivas que AD FS aplica en recursos locales.</span><span class="sxs-lookup"><span data-stu-id="516bc-107">These include policies that are enforced by AD FS in on-premises resources.</span></span>
> 
> <span data-ttu-id="516bc-108">Para más información sobre los escenarios de acceso condicional para recursos locales, consulte [Unión al área de trabajo desde cualquier dispositivo para SSO y autenticación de segundo factor sin problemas entre las aplicaciones de la empresa](https://technet.microsoft.com/library/dn280945.aspx).</span><span class="sxs-lookup"><span data-stu-id="516bc-108">For more information about the conditional access scenarios for on-premises resources, see [Join to workplace from any device for SSO and seamless second-factor authentication across company applications](https://technet.microsoft.com/library/dn280945.aspx).</span></span>

<span data-ttu-id="516bc-109">Estas funcionalidades están disponibles para los clientes que compren una licencia de Azure Active Directory Premium.</span><span class="sxs-lookup"><span data-stu-id="516bc-109">These capabilities are available to customers who purchase an Azure Active Directory Premium license.</span></span>

## <a name="supported-devices"></a><span data-ttu-id="516bc-110">Dispositivos compatibles</span><span class="sxs-lookup"><span data-stu-id="516bc-110">Supported devices</span></span>
* <span data-ttu-id="516bc-111">Dispositivos Windows 7 unidos a un dominio</span><span class="sxs-lookup"><span data-stu-id="516bc-111">Windows 7 domain-joined devices</span></span>
* <span data-ttu-id="516bc-112">Dispositivos Windows 8.1 personales y unidos a un dominio</span><span class="sxs-lookup"><span data-stu-id="516bc-112">Windows 8.1 personal and domain-joined devices</span></span>
* <span data-ttu-id="516bc-113">iOS 6 y versiones posteriores para el explorador Safari</span><span class="sxs-lookup"><span data-stu-id="516bc-113">iOS 6 and later for the Safari browser</span></span>
* <span data-ttu-id="516bc-114">Android 4.0 o versiones posteriores, teléfonos Samsung GS3 o versiones posteriores, tabletas Samsung Galaxy Note 2 o versiones posteriores</span><span class="sxs-lookup"><span data-stu-id="516bc-114">Android 4.0 or later, Samsung GS3 or later phones, Samsung Galaxy Note 2 or later tablets</span></span>

## <a name="scenario-prerequisites"></a><span data-ttu-id="516bc-115">Requisitos previos de escenario</span><span class="sxs-lookup"><span data-stu-id="516bc-115">Scenario prerequisites</span></span>
* <span data-ttu-id="516bc-116">Suscripción a Office 365 o a Azure Active Directory Premium</span><span class="sxs-lookup"><span data-stu-id="516bc-116">Subscription to Office 365 or Azure Active Directory Premium</span></span>
* <span data-ttu-id="516bc-117">Un inquilino de Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="516bc-117">An Azure Active Directory tenant</span></span>
* <span data-ttu-id="516bc-118">Windows Server Active Directory (Windows Server 2008 o versiones posteriores)</span><span class="sxs-lookup"><span data-stu-id="516bc-118">Windows Server Active Directory (Windows Server 2008 or later)</span></span>
* <span data-ttu-id="516bc-119">Esquema actualizado en Windows Server 2012 R2</span><span class="sxs-lookup"><span data-stu-id="516bc-119">Updated schema in Windows Server 2012 R2</span></span>
* <span data-ttu-id="516bc-120">Licencia de Azure Active Directory Premium</span><span class="sxs-lookup"><span data-stu-id="516bc-120">License for Azure Active Directory Premium</span></span>
* <span data-ttu-id="516bc-121">Servicios de federación con Windows Server 2012 R2, configurados para SSO en Azure AD</span><span class="sxs-lookup"><span data-stu-id="516bc-121">Windows Server 2012 R2 Federation Services, configured for SSO to Azure AD</span></span>
* <span data-ttu-id="516bc-122">Proxy de aplicación web de Windows Server 2012 R2</span><span class="sxs-lookup"><span data-stu-id="516bc-122">Windows Server 2012 R2 Web Application Proxy</span></span> 
* <span data-ttu-id="516bc-123">Microsoft Azure Active Directory Connect (Azure AD Connect) [(descargue Azure AD Connect)](http://www.microsoft.com/en-us/download/details.aspx?id=47594)</span><span class="sxs-lookup"><span data-stu-id="516bc-123">Microsoft Azure Active Directory Connect (Azure AD Connect) [(Download Azure AD Connect)](http://www.microsoft.com/en-us/download/details.aspx?id=47594)</span></span>
* <span data-ttu-id="516bc-124">Dominio comprobado</span><span class="sxs-lookup"><span data-stu-id="516bc-124">Verified domain</span></span>

## <a name="known-issues-in-this-release"></a><span data-ttu-id="516bc-125">Problemas conocidos en esta versión</span><span class="sxs-lookup"><span data-stu-id="516bc-125">Known issues in this release</span></span>
* <span data-ttu-id="516bc-126">Las directivas de acceso condicional basado en dispositivos requieren la escritura diferida de objetos de dispositivo en Active Directory de Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="516bc-126">Device-based conditional access policies require device object writeback to Active Directory from Azure Active Directory.</span></span> <span data-ttu-id="516bc-127">Los objetos de dispositivo pueden tardar hasta tres horas en realizar la escritura diferida en Active Directory.</span><span class="sxs-lookup"><span data-stu-id="516bc-127">It can take up to three hours for device objects to be written back to Active Directory.</span></span>
* <span data-ttu-id="516bc-128">Los dispositivos iOS 7 siempre solicitan al usuario que seleccione un certificado de cliente durante la autenticación de certificados de cliente.</span><span class="sxs-lookup"><span data-stu-id="516bc-128">iOS 7 devices  always prompt the user to select a certificate during client certificate authentication.</span></span>
* <span data-ttu-id="516bc-129">Algunas versiones de iOS 8 anteriores a iOS 8.3 no funcionan.</span><span class="sxs-lookup"><span data-stu-id="516bc-129">Some versions of iOS 8 before iOS 8.3 do not work.</span></span>

## <a name="scenario-assumptions"></a><span data-ttu-id="516bc-130">Escenarios hipotéticos</span><span class="sxs-lookup"><span data-stu-id="516bc-130">Scenario assumptions</span></span>
<span data-ttu-id="516bc-131">En este escenario se asume que tiene un entorno híbrido que consta de un inquilino de Azure AD y una versión local de Active Directory.</span><span class="sxs-lookup"><span data-stu-id="516bc-131">This scenario assumes that you have a hybrid environment consisting of an Azure AD tenant and an on-premises Active Directory.</span></span> <span data-ttu-id="516bc-132">Estos inquilinos deben conectarse mediante Azure AD Connect, con un dominio comprobado, y con AD FS para SSO.</span><span class="sxs-lookup"><span data-stu-id="516bc-132">These tenants should be connected with Azure AD Connect, with a verified domain, and with AD FS for SSO.</span></span> <span data-ttu-id="516bc-133">Use la lista de comprobación siguiente para configurar el entorno según los requisitos.</span><span class="sxs-lookup"><span data-stu-id="516bc-133">Use the following checklist to help you configure your environment according to the requirements.</span></span>

## <a name="checklist-prerequisites-for-conditional-access-scenario"></a><span data-ttu-id="516bc-134">Lista de comprobación: requisitos previos para un escenario de acceso condicional</span><span class="sxs-lookup"><span data-stu-id="516bc-134">Checklist: Prerequisites for conditional access scenario</span></span>
<span data-ttu-id="516bc-135">Conecte su inquilino de Azure AD a la instancia local de Active Directory.</span><span class="sxs-lookup"><span data-stu-id="516bc-135">Connect your Azure AD tenant with your on-premises Active Directory instance.</span></span>

## <a name="configure-azure-active-directory-device-registration-service"></a><span data-ttu-id="516bc-136">Configuración del servicio de registro de dispositivos de Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="516bc-136">Configure Azure Active Directory device registration service</span></span>
<span data-ttu-id="516bc-137">Use esta guía para implementar y configurar el servicio de registro de dispositivos de Azure Active Directory para su organización.</span><span class="sxs-lookup"><span data-stu-id="516bc-137">Use this guide to deploy and configure the Azure Active Directory device registration service for your organization.</span></span>

<span data-ttu-id="516bc-138">En esta guía se asume que ya configuró Windows Server Active Directory y se suscribió a Microsoft Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="516bc-138">This guide assumes that you've configured Windows Server Active Directory and have subscribed to Microsoft Azure Active Directory.</span></span> <span data-ttu-id="516bc-139">Consulte los requisitos previos que se describieron anteriormente.</span><span class="sxs-lookup"><span data-stu-id="516bc-139">See the prerequisites described earlier.</span></span>

<span data-ttu-id="516bc-140">Para implementar el servicio de registro de dispositivos de Azure Active Directory con su inquilino de Azure Active Directory, complete por orden las tareas de la lista de comprobación siguiente.</span><span class="sxs-lookup"><span data-stu-id="516bc-140">To deploy the Azure Active Directory device registration service with your Azure Active Directory tenant, complete the tasks in the following checklist in order.</span></span> <span data-ttu-id="516bc-141">Cuando un vínculo de referencia lleve a un tema conceptual, vuelva a esta lista de comprobación para que pueda continuar con las tareas restantes.</span><span class="sxs-lookup"><span data-stu-id="516bc-141">When a reference link takes you to a conceptual topic, return to this checklist afterward, so that you can proceed with the remaining tasks.</span></span> <span data-ttu-id="516bc-142">Algunas tareas incluyen un paso de validación del escenario que puede ayudarle a confirmar si el paso se completó correctamente.</span><span class="sxs-lookup"><span data-stu-id="516bc-142">Some tasks include a scenario validation step that can help you confirm whether the step was completed successfully.</span></span>

## <a name="part-1-enable-azure-active-directory-device-registration"></a><span data-ttu-id="516bc-143">Paso 1: habilitación del registro de dispositivos de Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="516bc-143">Part 1: Enable Azure Active Directory device registration</span></span>
<span data-ttu-id="516bc-144">Siga los pasos que aparecen en la lista de comprobación para habilitar y configurar el servicio de registro de dispositivos de Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="516bc-144">Follow the steps in the checklist to enable and configure the Azure Active Directory device registration service.</span></span>

| <span data-ttu-id="516bc-145">Tarea</span><span class="sxs-lookup"><span data-stu-id="516bc-145">Task</span></span> | <span data-ttu-id="516bc-146">Referencia</span><span class="sxs-lookup"><span data-stu-id="516bc-146">Reference</span></span> | 
| --- | --- |
| <span data-ttu-id="516bc-147">Habilite el registro de dispositivos en el inquilino de Azure Active Directory para permitir que los dispositivos se unan al área de trabajo.</span><span class="sxs-lookup"><span data-stu-id="516bc-147">Enable device registration in your Azure Active Directory tenant to allow devices to join the workplace.</span></span> <span data-ttu-id="516bc-148">De manera predeterminada, Azure Multi-Factor Authentication no está habilitado para el servicio.</span><span class="sxs-lookup"><span data-stu-id="516bc-148">By default, Azure Multi-Factor Authentication is not enabled for the service.</span></span> <span data-ttu-id="516bc-149">Sin embargo, se recomienda que lo uso cuando registre un dispositivo.</span><span class="sxs-lookup"><span data-stu-id="516bc-149">However, we recommend that you use Multi-Factor Authentication when you register a device.</span></span> <span data-ttu-id="516bc-150">Antes de habilitar Multi-Factor Authentication en el servicio de registro de Active Directory, asegúrese de que AD FS está configurado para un proveedor de Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="516bc-150">Before enabling Multi-Factor Authentication in Active Directory registration service, ensure that AD FS is configured for a Multi-Factor Authentication  provider.</span></span> |[<span data-ttu-id="516bc-151">Habilitación del registro de dispositivos de Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="516bc-151">Enable Azure Active Directory device registration</span></span>](active-directory-device-registration-get-started.md)| 
|<span data-ttu-id="516bc-152">Los dispositivos detectan el servicio de registro de dispositivos de Azure Active Directory buscando registros DNS conocidos.</span><span class="sxs-lookup"><span data-stu-id="516bc-152">Devices discover your Azure Active Directory device registration service by looking for well-known DNS records.</span></span> <span data-ttu-id="516bc-153">Configure el DNS de la empresa para que los dispositivos puedan detectar el servicio de registro de dispositivos de Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="516bc-153">Configure your company DNS so that devices can discover your Azure Active Directory device registration service.</span></span> |[<span data-ttu-id="516bc-154">Configuración de la detección del registro de dispositivos de Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="516bc-154">Configure Azure Active Directory device registration discovery</span></span>](active-directory-device-registration-get-started.md)| 


## <a name="part-2-deploy-and-configure-windows-server-2012-r2-active-directory-federation-services-and-set-up-a-federation-relationship-with-azure-ad"></a><span data-ttu-id="516bc-155">Parte 2: implementación de Servicios de federación de Active Directory Windows Server 2012 R2 y configuración de una relación de federación con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="516bc-155">Part 2: Deploy and configure Windows Server 2012 R2 Active Directory Federation Services and set up a federation relationship with Azure AD</span></span>

| <span data-ttu-id="516bc-156">Tarea</span><span class="sxs-lookup"><span data-stu-id="516bc-156">Task</span></span> | <span data-ttu-id="516bc-157">Referencia</span><span class="sxs-lookup"><span data-stu-id="516bc-157">Reference</span></span> |
| --- | --- |
| <span data-ttu-id="516bc-158">Implemente Active Directory Domain Services con las extensiones de esquema de Windows Server 2012 R2.</span><span class="sxs-lookup"><span data-stu-id="516bc-158">Deploy Active Directory Domain Services with the Windows Server 2012 R2 schema extensions.</span></span> <span data-ttu-id="516bc-159">No es preciso actualizar los controladores de dominio a Windows Server 2012 R2.</span><span class="sxs-lookup"><span data-stu-id="516bc-159">You do not need to upgrade any of your domain controllers to Windows Server 2012 R2.</span></span> <span data-ttu-id="516bc-160">El único requisito es la actualización del esquema.</span><span class="sxs-lookup"><span data-stu-id="516bc-160">The schema upgrade is the only requirement.</span></span> |[<span data-ttu-id="516bc-161">Actualización del esquema de Active Directory Domain Services</span><span class="sxs-lookup"><span data-stu-id="516bc-161">Upgrade your Active Directory Domain Services schema</span></span>](#upgrade-your-active-directory-domain-services-schema) |
| <span data-ttu-id="516bc-162">Los dispositivos detectan el servicio de registro de dispositivos de Azure Active Directory buscando registros DNS conocidos.</span><span class="sxs-lookup"><span data-stu-id="516bc-162">Devices discover your Azure Active Directory device registration service by looking for well-known DNS records.</span></span> <span data-ttu-id="516bc-163">Configure el DNS de la empresa para que los dispositivos puedan detectar el servicio de registro de dispositivos de Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="516bc-163">Configure your company DNS so that devices can discover your Azure Active Directory device registration service.</span></span> |[<span data-ttu-id="516bc-164">Preparación de los dispositivos para la compatibilidad con Active Directory</span><span class="sxs-lookup"><span data-stu-id="516bc-164">Prepare your Active Directory support devices</span></span>](#prepare-your-active-directory-to-support-devices) |

## <a name="part-3-enable-device-writeback-in-azure-ad"></a><span data-ttu-id="516bc-165">Parte 3: habilitación de reescritura de dispositivos en Azure AD</span><span class="sxs-lookup"><span data-stu-id="516bc-165">Part 3: Enable device writeback in Azure AD</span></span>
| <span data-ttu-id="516bc-166">Tarea</span><span class="sxs-lookup"><span data-stu-id="516bc-166">Task</span></span> | <span data-ttu-id="516bc-167">Referencia</span><span class="sxs-lookup"><span data-stu-id="516bc-167">Reference</span></span> |
| --- | --- |
| <span data-ttu-id="516bc-168">Complete la parte 2 de "Habilitación de escritura diferida de dispositivos en Azure AD Connect".</span><span class="sxs-lookup"><span data-stu-id="516bc-168">Complete part two of "Enabling device writeback in Azure AD Connect."</span></span> <span data-ttu-id="516bc-169">Cuando lo haga, vuelva a esta guía.</span><span class="sxs-lookup"><span data-stu-id="516bc-169">After you finish it, return to this guide.</span></span> |[<span data-ttu-id="516bc-170">Habilitación de escritura diferida de dispositivos en Azure AD Connect</span><span class="sxs-lookup"><span data-stu-id="516bc-170">Enabling device writeback in Azure AD Connect</span></span>](#upgrade-your-active-directory-domain-services-schema) |

## <a name="optional-part-4-enable-multi-factor-authentication"></a><span data-ttu-id="516bc-171">[Opcional] Parte 4: habilitación de Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="516bc-171">[Optional] Part 4: Enable Multi-Factor Authentication</span></span>
<span data-ttu-id="516bc-172">Se recomienda encarecidamente configurar una de las distintas opciones de Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="516bc-172">We strongly recommended that you configure one of the several options for Multi-Factor Authentication.</span></span> <span data-ttu-id="516bc-173">Si desea exigir Multi-Factor Authentication, consulte [Elección de la solución de seguridad Multi-Factor Authentication más adecuada](../multi-factor-authentication/multi-factor-authentication-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="516bc-173">If you want to require Multi-Factor Authentication, see [Choose the Multi-Factor Authentication security solution for you](../multi-factor-authentication/multi-factor-authentication-get-started.md).</span></span> <span data-ttu-id="516bc-174">Incluye una descripción de cada solución y vínculos para ayudarle a configurar la solución que haya elegido.</span><span class="sxs-lookup"><span data-stu-id="516bc-174">It includes a description of each solution, and links to help you configure the solution of your choice.</span></span>

## <a name="part-5-verification"></a><span data-ttu-id="516bc-175">Parte 5: verificación</span><span class="sxs-lookup"><span data-stu-id="516bc-175">Part 5: Verification</span></span>
<span data-ttu-id="516bc-176">La implementación se completó y puede probar algunos escenarios.</span><span class="sxs-lookup"><span data-stu-id="516bc-176">The deployment is now complete, and you can try out some scenarios.</span></span> <span data-ttu-id="516bc-177">Siga los vínculos siguientes para probar con el servicio y familiarizarse con sus características.</span><span class="sxs-lookup"><span data-stu-id="516bc-177">Use the following links to experiment with the service and become familiar with its features.</span></span>

| <span data-ttu-id="516bc-178">Tarea</span><span class="sxs-lookup"><span data-stu-id="516bc-178">Task</span></span> | <span data-ttu-id="516bc-179">Referencia</span><span class="sxs-lookup"><span data-stu-id="516bc-179">Reference</span></span> |
| --- | --- |
| <span data-ttu-id="516bc-180">Conecte varios dispositivos al área de trabajo con el servicio de registro de dispositivos de Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="516bc-180">Join some devices to your workplace by using Azure Active Directory device registration service.</span></span> <span data-ttu-id="516bc-181">Puede conectar dispositivos iOS, Windows y Android.</span><span class="sxs-lookup"><span data-stu-id="516bc-181">You can join iOS, Windows, and Android devices.</span></span> |[<span data-ttu-id="516bc-182">Unión de dispositivos al área de trabajo mediante el servicio de registro de dispositivos de Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="516bc-182">Join devices to your workplace using Azure Active Directory device registration service</span></span>](#join-devices-to-your-workplace-using-azure-active-directory-device-registration) |
| <span data-ttu-id="516bc-183">Vea y habilite o deshabilite los dispositivos registrados desde el portal de administrador.</span><span class="sxs-lookup"><span data-stu-id="516bc-183">View and enable or disable registered devices by using the administrator portal.</span></span> <span data-ttu-id="516bc-184">En esta tarea, usará el portal de administrador para ver algunos dispositivos registrados.</span><span class="sxs-lookup"><span data-stu-id="516bc-184">In this task, you view some registered devices by using the administrator portal.</span></span> |[<span data-ttu-id="516bc-185">Introducción al servicio de registro de dispositivos de Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="516bc-185">Azure Active Directory device registration service overview</span></span>](active-directory-device-registration-get-started.md) |
| <span data-ttu-id="516bc-186">Compruebe que los objetos de dispositivo se reescriben desde Azure Active Directory a Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="516bc-186">Verify that device objects are written back from Azure Active Directory to Windows Server Active Directory.</span></span> |[<span data-ttu-id="516bc-187">Comprobación de que los dispositivos registrados se escriben de manera diferida en Active Directory</span><span class="sxs-lookup"><span data-stu-id="516bc-187">Verify registered devices are written back to Active Directory</span></span>](#verify-registered-devices-are-written-back-to-active-directory) |
| <span data-ttu-id="516bc-188">Ahora que los usuarios pueden registrar sus dispositivos, puede crear en AD FS directivas de acceso a la aplicación que solo permitan dispositivos registrados.</span><span class="sxs-lookup"><span data-stu-id="516bc-188">Now that users can register their devices, you can create application access polices in AD FS that allow only registered devices.</span></span> <span data-ttu-id="516bc-189">En esta tarea, creará una regla de acceso a la aplicación y un mensaje de acceso denegado personalizado.</span><span class="sxs-lookup"><span data-stu-id="516bc-189">In this task, you create an application access rule and a custom access-denied message.</span></span> |[<span data-ttu-id="516bc-190">Creación de una directiva de acceso a aplicaciones y un mensaje personalizado de acceso denegado</span><span class="sxs-lookup"><span data-stu-id="516bc-190">Create an application access policy and custom access-denied message</span></span>](#create-an-application-access-policy-and-custom-access-denied-message) |

## <a name="integrate-azure-active-directory-with-on-premises-active-directory"></a><span data-ttu-id="516bc-191">Integración de Azure Active Directory con una versión local de Active Directory</span><span class="sxs-lookup"><span data-stu-id="516bc-191">Integrate Azure Active Directory with on-premises Active Directory</span></span>
<span data-ttu-id="516bc-192">Este paso le ayuda a integrar el inquilino de Azure AD con la instancia local de Active Directory mediante Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="516bc-192">This step helps you integrate your Azure AD tenant with your on-premises Active Directory by using Azure AD Connect.</span></span> <span data-ttu-id="516bc-193">Aunque los pasos están disponibles en el Portal de Azure clásico, anote las instrucciones especiales que se enumeran en esta sección.</span><span class="sxs-lookup"><span data-stu-id="516bc-193">Although the steps are available in the Azure classic portal, make note of any special instructions that are listed in this section.</span></span>

1. <span data-ttu-id="516bc-194">Inicie sesión en el Portal de Azure clásico con una cuenta que sea un administrador global en Azure AD.</span><span class="sxs-lookup"><span data-stu-id="516bc-194">Sign in to the Azure classic portal by using an account that is a global administrator in Azure AD.</span></span>
2. <span data-ttu-id="516bc-195">En el panel izquierdo, seleccione **Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="516bc-195">On the left pane, select **Active Directory**.</span></span>
3. <span data-ttu-id="516bc-196">En la pestaña **Directorio** , seleccione su directorio.</span><span class="sxs-lookup"><span data-stu-id="516bc-196">On the **Directory** tab, select your directory.</span></span>
4. <span data-ttu-id="516bc-197">Seleccione la pestaña **Integración de directorios** .</span><span class="sxs-lookup"><span data-stu-id="516bc-197">Select the **Directory Integration** tab.</span></span>
5. <span data-ttu-id="516bc-198">En la sección acerca de **implementación y administración**, siga los pasos 1 a 3 para integrar Azure Active Directory en su directorio local.</span><span class="sxs-lookup"><span data-stu-id="516bc-198">Under the **deploy and manage** section, follow steps 1 through 3 to integrate Azure Active Directory with your on-premises directory.</span></span>
   
   1. <span data-ttu-id="516bc-199">Adición de dominios.</span><span class="sxs-lookup"><span data-stu-id="516bc-199">Add domains.</span></span>
   2. <span data-ttu-id="516bc-200">Para instalar y ejecutar Azure AD Connect, use las instrucciones que aparecen en [Instalación personalizada de Azure AD Connect](connect/active-directory-aadconnect-get-started-custom.md).</span><span class="sxs-lookup"><span data-stu-id="516bc-200">Install and run Azure AD Connect by using the instructions at [Custom installation of Azure AD Connect](connect/active-directory-aadconnect-get-started-custom.md).</span></span>
   3. <span data-ttu-id="516bc-201">Comprobación y administración de la sincronización de directorios.</span><span class="sxs-lookup"><span data-stu-id="516bc-201">Verify and manage directory sync.</span></span> <span data-ttu-id="516bc-202">Las instrucciones de inicio de sesión único están disponibles en este paso.</span><span class="sxs-lookup"><span data-stu-id="516bc-202">Single sign-on instructions are available within this step.</span></span>
   
   <span data-ttu-id="516bc-203">Además, configure la federación con AD FS tal como se describe en [Instalación personalizada de Azure AD Connect](connect/active-directory-aadconnect-get-started-custom.md).</span><span class="sxs-lookup"><span data-stu-id="516bc-203">In addition, configure federation with AD FS as outlined in [Custom installation of Azure AD Connect](connect/active-directory-aadconnect-get-started-custom.md).</span></span>

## <a name="upgrade-your-active-directory-domain-services-schema"></a><span data-ttu-id="516bc-204">Actualización del esquema de Servicios de dominio de Active Directory</span><span class="sxs-lookup"><span data-stu-id="516bc-204">Upgrade your Active Directory Domain Services schema</span></span>
> [!NOTE]
> <span data-ttu-id="516bc-205">Una vez que actualice el esquema de Active Directory, no es posible revertir el proceso.</span><span class="sxs-lookup"><span data-stu-id="516bc-205">After you upgrade your Active Directory schema, the process cannot be reversed.</span></span> <span data-ttu-id="516bc-206">Se recomienda realizar la actualización primero en un entorno de prueba.</span><span class="sxs-lookup"><span data-stu-id="516bc-206">We recommend that you first perform the upgrade in a test environment.</span></span>
> 

1. <span data-ttu-id="516bc-207">Inicie sesión en el controlador de dominio con una cuenta que tenga derechos de administrador de organización y de administrador de esquema.</span><span class="sxs-lookup"><span data-stu-id="516bc-207">Sign in to your domain controller with an account that has both enterprise administrator and schema administrator rights.</span></span>
2. <span data-ttu-id="516bc-208">Copie el directorio **[media]\support\adprep** y los subdirectorios en uno de los controladores de dominio de Active Directory (donde **[media]** es la ruta de acceso a los medios de instalación de Windows Server 2012 R2).</span><span class="sxs-lookup"><span data-stu-id="516bc-208">Copy the **[media]\support\adprep** directory and subdirectories to one of your Active Directory domain controllers (where **[media]** is the path to the Windows Server 2012 R2 installation media).</span></span>
4. <span data-ttu-id="516bc-209">En un símbolo del sistema, vaya al directorio **adprep** y ejecute **adprep.exe /forestprep**.</span><span class="sxs-lookup"><span data-stu-id="516bc-209">From a command prompt, go to the **adprep** directory and run **adprep.exe /forestprep**.</span></span> <span data-ttu-id="516bc-210">Siga las instrucciones en pantalla para completar la actualización del esquema.</span><span class="sxs-lookup"><span data-stu-id="516bc-210">Follow the onscreen instructions to complete the schema upgrade.</span></span>

## <a name="prepare-your-active-directory-to-support-devices"></a><span data-ttu-id="516bc-211">Preparación de Active Directory para que admita los dispositivos</span><span class="sxs-lookup"><span data-stu-id="516bc-211">Prepare your Active Directory to support devices</span></span>
> [!NOTE]
> <span data-ttu-id="516bc-212">Se trata de una operación que se realiza una sola vez que debe ejecutar para preparar el bosque de Active Directory para admitir los dispositivos.</span><span class="sxs-lookup"><span data-stu-id="516bc-212">This is a one-time operation that you must run to prepare your Active Directory forest to support devices.</span></span> <span data-ttu-id="516bc-213">Para completar este procedimiento, debe iniciar sesión con permisos de administrador de organización y el bosque de Active Directory debe tener el esquema de Windows Server 2012 R2.</span><span class="sxs-lookup"><span data-stu-id="516bc-213">To complete this procedure, you must be signed in with enterprise administrator permissions and your Active Directory forest must have the Windows Server 2012 R2 schema.</span></span>
> 


### <a name="prepare-your-active-directory-forest"></a><span data-ttu-id="516bc-214">Preparación del bosque de Active Directory</span><span class="sxs-lookup"><span data-stu-id="516bc-214">Prepare your Active Directory forest</span></span>
1. <span data-ttu-id="516bc-215">En el servidor de federación, abra una ventana Comandos de Windows PowerShell y escriba **Initialize-ADDeviceRegistration**.</span><span class="sxs-lookup"><span data-stu-id="516bc-215">On your federation server, open a Windows PowerShell command window, and then type **Initialize-ADDeviceRegistration**.</span></span> 
2. <span data-ttu-id="516bc-216">Cuando le pidan el valor de **ServiceAccountName**, escriba el nombre de la cuenta de servicio que seleccionó como cuenta de servicio de AD FS.</span><span class="sxs-lookup"><span data-stu-id="516bc-216">When prompted for **ServiceAccountName**, enter the name of the service account you selected as the service account for AD FS.</span></span> <span data-ttu-id="516bc-217">Si es una cuenta de gMSA, escríbala con el formato **dominio\nombreDeCuenta$**.</span><span class="sxs-lookup"><span data-stu-id="516bc-217">If it's a gMSA account, enter the account in the **domain\accountname$** format.</span></span> <span data-ttu-id="516bc-218">En el caso de una cuenta de dominio, use el formato **dominio\nombreDeCuenta**.</span><span class="sxs-lookup"><span data-stu-id="516bc-218">For a domain account, use the format **domain\accountname**.</span></span>

### <a name="enable-device-authentication-in-ad-fs"></a><span data-ttu-id="516bc-219">Habilitación de la autenticación del dispositivo en AD FS</span><span class="sxs-lookup"><span data-stu-id="516bc-219">Enable device authentication in AD FS</span></span>
1. <span data-ttu-id="516bc-220">En el servidor de federación, abra la consola de administración de AD FS y vaya a **AD FS** > **Directivas de autenticación**.</span><span class="sxs-lookup"><span data-stu-id="516bc-220">On your federation server, open the AD FS management console and go to **AD FS** > **Authentication Policies**.</span></span>
2. <span data-ttu-id="516bc-221">En el panel **Acciones**, seleccione **Editar autenticación principal global**.</span><span class="sxs-lookup"><span data-stu-id="516bc-221">On the **Actions** pane, select **Edit Global Primary Authentication**.</span></span>
3. <span data-ttu-id="516bc-222">Active **Habilitar autenticación de dispositivo** y, luego, seleccione **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="516bc-222">Check **Enable device authentication**, and then select **OK**.</span></span>
4. <span data-ttu-id="516bc-223">De manera predeterminada, AD FS quitará periódicamente los dispositivos no usados de Active Directory.</span><span class="sxs-lookup"><span data-stu-id="516bc-223">By default, AD FS periodically removes unused devices from Active Directory.</span></span> <span data-ttu-id="516bc-224">Deshabilite esta tarea cuando use el servicio de registro de dispositivos de Azure Active Directory para que los dispositivos se puedan administrar en Azure.</span><span class="sxs-lookup"><span data-stu-id="516bc-224">Disable this task when you're using Azure Active Directory device registration service so that devices can be managed in Azure.</span></span>

### <a name="disable-unused-device-cleanup"></a><span data-ttu-id="516bc-225">Deshabilitación de la limpieza de dispositivos no usados</span><span class="sxs-lookup"><span data-stu-id="516bc-225">Disable unused device cleanup</span></span>
<span data-ttu-id="516bc-226">En el servidor de federación, abra una ventana Comandos de Windows PowerShell y, luego, escriba **Set-AdfsDeviceRegistration -MaximumInactiveDays 0**.</span><span class="sxs-lookup"><span data-stu-id="516bc-226">On your federation server, open a Windows PowerShell command window, and then type **Set-AdfsDeviceRegistration -MaximumInactiveDays 0**.</span></span>

### <a name="prepare-azure-ad-connect-for-device-writeback"></a><span data-ttu-id="516bc-227">Preparación de Azure AD Connect para la reescritura de dispositivos</span><span class="sxs-lookup"><span data-stu-id="516bc-227">Prepare Azure AD Connect for device writeback</span></span>
<span data-ttu-id="516bc-228">Complete la parte 1: preparación de Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="516bc-228">Complete part 1: Prepare Azure AD Connect.</span></span>

## <a name="join-devices-to-your-workplace-by-using-azure-active-directory-device-registration-service"></a><span data-ttu-id="516bc-229">Unión de dispositivos al área de trabajo mediante el servicio de registro de dispositivos de Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="516bc-229">Join devices to your workplace by using Azure Active Directory device registration service</span></span>

### <a name="join-an-ios-device-by-using-azure-active-directory-device-registration"></a><span data-ttu-id="516bc-230">Unión de un dispositivo iOS mediante el registro de dispositivos de Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="516bc-230">Join an iOS device by using Azure Active Directory device registration</span></span>
<span data-ttu-id="516bc-231">El registro de dispositivos de Azure Active Directory usa el proceso de inscripción de perfil móvil para dispositivos iOS.</span><span class="sxs-lookup"><span data-stu-id="516bc-231">Azure Active Directory device registration uses the Over-the-Air Profile enrollment process for iOS devices.</span></span> <span data-ttu-id="516bc-232">Este proceso comienza cuando el usuario se conecta a la dirección URL de inscripción de perfil con Safari.</span><span class="sxs-lookup"><span data-stu-id="516bc-232">This process begins when the user connects to the profile enrollment URL with Safari.</span></span> <span data-ttu-id="516bc-233">El formato de la dirección URL es el siguiente:</span><span class="sxs-lookup"><span data-stu-id="516bc-233">The URL format is as follows:</span></span>

    https://enterpriseregistration.windows.net/enrollmentserver/otaprofile/"yourdomainname"

<span data-ttu-id="516bc-234">En este caso, `yourdomainname` es el nombre de dominio que se configuró con Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="516bc-234">In this case, `yourdomainname` is the domain name that you configured with Azure Active Directory.</span></span> <span data-ttu-id="516bc-235">Por ejemplo, si el nombre de dominio es contoso.com, la dirección URL es la siguiente:</span><span class="sxs-lookup"><span data-stu-id="516bc-235">For example, if your domain name is contoso.com, the URL is as follows:</span></span>

    https://enterpriseregistration.windows.net/enrollmentserver/otaprofile/contoso.com

<span data-ttu-id="516bc-236">Existen varias formas de comunicar la URL a los usuarios.</span><span class="sxs-lookup"><span data-stu-id="516bc-236">There are many different ways to communicate this URL to your users.</span></span> <span data-ttu-id="516bc-237">Por ejemplo, un método que se recomienda es publicar esta dirección URL en un mensaje de acceso denegado a la aplicación personalizado en AD FS.</span><span class="sxs-lookup"><span data-stu-id="516bc-237">For example, one method we recommend is publishing this URL in a custom application access-denied message in AD FS.</span></span> <span data-ttu-id="516bc-238">Esta información se trata en la siguiente sección [Creación de una directiva de acceso a aplicaciones y un mensaje personalizado de acceso denegado](#create-an-application-access-policy-and-custom-access-denied-message).</span><span class="sxs-lookup"><span data-stu-id="516bc-238">This information is covered in the upcoming section [Create an application access policy and custom access-denied message](#create-an-application-access-policy-and-custom-access-denied-message).</span></span>

### <a name="join-a-windows-81-device-by-using-azure-active-directory-device-registration"></a><span data-ttu-id="516bc-239">Unión de un dispositivo Windows 8.1 mediante el registro de dispositivos de Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="516bc-239">Join a Windows 8.1 device by using Azure Active Directory device registration</span></span>
1. <span data-ttu-id="516bc-240">En el dispositivo Windows 8.1, seleccione **Configuración de PC** > **Red** > **Área de trabajo**.</span><span class="sxs-lookup"><span data-stu-id="516bc-240">On your Windows 8.1 device, select **PC Settings** > **Network** > **Workplace**.</span></span>
2. <span data-ttu-id="516bc-241">Escriba el nombre de usuario en formato UPN, por ejemplo, **dan@contoso.com**.</span><span class="sxs-lookup"><span data-stu-id="516bc-241">Enter your user name in UPN format; for example, **dan@contoso.com**.</span></span>
3. <span data-ttu-id="516bc-242">Seleccione **Combinar**.</span><span class="sxs-lookup"><span data-stu-id="516bc-242">Select **Join**.</span></span>
4. <span data-ttu-id="516bc-243">Cuando se lo pidan, inicie sesión con sus credenciales.</span><span class="sxs-lookup"><span data-stu-id="516bc-243">When prompted, sign in with your credentials.</span></span> <span data-ttu-id="516bc-244">El dispositivo ahora está unido.</span><span class="sxs-lookup"><span data-stu-id="516bc-244">The device is now joined.</span></span>

### <a name="join-a-windows-7-device-by-using-azure-active-directory-device-registration"></a><span data-ttu-id="516bc-245">Unión de un dispositivo Windows 7 mediante el registro de dispositivos de Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="516bc-245">Join a Windows 7 device by using Azure Active Directory device registration</span></span>
<span data-ttu-id="516bc-246">Para registrar los dispositivos Windows 7 unidos a un dominio debe implementar el paquete de software de registro del dispositivo.</span><span class="sxs-lookup"><span data-stu-id="516bc-246">To register Windows 7 domain-joined devices, you need to deploy the device registration software package.</span></span> <span data-ttu-id="516bc-247">El paquete de software se llama Workplace Join for Windows 7 y está disponible para su descarga en el [sitio web de Microsoft Connect](https://connect.microsoft.com/site1164).</span><span class="sxs-lookup"><span data-stu-id="516bc-247">The software package is called Workplace Join for Windows 7, and it's available for download at the [Microsoft Connect website](https://connect.microsoft.com/site1164).</span></span> 

<span data-ttu-id="516bc-248">Las instrucciones sobre cómo usar el paquete están disponibles en [Configuración del registro automático de dispositivos unidos a un dominio de Windows con Azure Active Directory](active-directory-conditional-access-automatic-device-registration-setup.md).</span><span class="sxs-lookup"><span data-stu-id="516bc-248">Instructions about how to use the package are available in [How to configure automatic registration of Windows domain-joined devices with Azure Active Directory](active-directory-conditional-access-automatic-device-registration-setup.md).</span></span>

## <a name="verify-that-registered-devices-are-written-back-to-active-directory"></a><span data-ttu-id="516bc-249">Comprobación de que los dispositivos registrados se escriben de manera diferida en Active Directory</span><span class="sxs-lookup"><span data-stu-id="516bc-249">Verify that registered devices are written back to Active Directory</span></span>
<span data-ttu-id="516bc-250">Puede ver y comprobar que los objetos de dispositivo se escribieron de manera diferida en Active Directory con LDP.exe o con el Editor ADSI.</span><span class="sxs-lookup"><span data-stu-id="516bc-250">You can view and verify that your device objects have been written back to your Active Directory by using LDP.exe or ADSI Edit.</span></span> <span data-ttu-id="516bc-251">Ambos están disponibles con las herramientas del administrador de Active Directory.</span><span class="sxs-lookup"><span data-stu-id="516bc-251">Both are available with the Active Directory administrator tools.</span></span>

<span data-ttu-id="516bc-252">De manera predeterminada, los objetos de dispositivo que se escriben de manera diferida desde Azure Active Directory se colocan en el mismo dominio que la granja de AD FS.</span><span class="sxs-lookup"><span data-stu-id="516bc-252">By default, device objects that are written back from Azure Active Directory are placed in the same domain as your AD FS farm.</span></span>

    CN=RegisteredDevices,defaultNamingContext

## <a name="create-an-application-access-policy-and-custom-access-denied-message"></a><span data-ttu-id="516bc-253">Creación de una directiva de acceso a aplicaciones y un mensaje personalizado de acceso denegado</span><span class="sxs-lookup"><span data-stu-id="516bc-253">Create an application access policy and custom access-denied message</span></span>
<span data-ttu-id="516bc-254">Considere el siguiente escenario: se crea una aplicación de confianza para usuario autenticado en AD FS y se configura una regla de autorización de emisión que solo permite dispositivos registrados.</span><span class="sxs-lookup"><span data-stu-id="516bc-254">Consider the following scenario: You create an application Relying Party Trust in AD FS and configure an Issuance Authorization Rule that allows only registered devices.</span></span> <span data-ttu-id="516bc-255">Ahora solo los dispositivos que están registrados pueden tener acceso a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="516bc-255">Now only devices that are registered are allowed to access the application.</span></span> 

<span data-ttu-id="516bc-256">Para que a los usuarios les resulte más fácil obtener acceso a la aplicación, configure un mensaje personalizado de acceso denegado que incluya instrucciones sobre cómo deben unir el dispositivo.</span><span class="sxs-lookup"><span data-stu-id="516bc-256">To make it easy for your users to gain access to the application, you configure a custom access-denied message that includes instructions for how to join their device.</span></span> <span data-ttu-id="516bc-257">Ahora los usuarios disponen de una manera directa de registrar sus dispositivos para que puedan tener acceso a una aplicación.</span><span class="sxs-lookup"><span data-stu-id="516bc-257">Now your users have a seamless way to register their devices so they can access an application.</span></span>

<span data-ttu-id="516bc-258">Los pasos siguientes indican cómo implementar este escenario.</span><span class="sxs-lookup"><span data-stu-id="516bc-258">The following steps show you how to implement this scenario.</span></span>

> [!NOTE]
> <span data-ttu-id="516bc-259">En esta sección se supone que ya configuró una relación de confianza para usuario autenticado para la aplicación en AD FS.</span><span class="sxs-lookup"><span data-stu-id="516bc-259">This section assumes that you have already configured a Relying Party Trust for your application in AD FS.</span></span>
> 

1. <span data-ttu-id="516bc-260">Abra la herramienta MMC de AD FS y, luego, seleccione **AD FS** > **Relaciones de confianza** > **Relación de confianza para usuario autenticado**.</span><span class="sxs-lookup"><span data-stu-id="516bc-260">Open the AD FS MMC tool, and then select **AD FS** > **Trust Relationships** > **Relying Party Trusts**.</span></span>
2. <span data-ttu-id="516bc-261">Busque la aplicación a la que se aplica la nueva regla de acceso.</span><span class="sxs-lookup"><span data-stu-id="516bc-261">Locate the application to which this new access rule applies.</span></span> <span data-ttu-id="516bc-262">Haga clic con el botón derecho en la aplicación y, luego, seleccione **Editar reglas de notificación**.</span><span class="sxs-lookup"><span data-stu-id="516bc-262">Right-click the application, and then select **Edit Claim Rules**.</span></span>
3. <span data-ttu-id="516bc-263">Seleccione la pestaña **Reglas de autorización de emisión** y, luego, **Agregar regla**.</span><span class="sxs-lookup"><span data-stu-id="516bc-263">Select the **Issuance Authorization Rules** tab, and then select **Add Rule**.</span></span>
4. <span data-ttu-id="516bc-264">En la lista desplegable de plantillas **Regla de notificaciones**, seleccione **Permitir o denegar usuarios según notificación entrante**.</span><span class="sxs-lookup"><span data-stu-id="516bc-264">From the **Claim rule** template drop-down list, select **Permit or Deny Users Based on an Incoming Claim**.</span></span> <span data-ttu-id="516bc-265">Luego, seleccione **Siguiente**.</span><span class="sxs-lookup"><span data-stu-id="516bc-265">Then select **Next**.</span></span>
5. <span data-ttu-id="516bc-266">En el campo **Nombre de regla de notificaciones**, escriba **Permitir acceso desde dispositivos registrados**.</span><span class="sxs-lookup"><span data-stu-id="516bc-266">In the **Claim rule name** field, type **Permit access from registered devices**.</span></span>
6. <span data-ttu-id="516bc-267">En la lista desplegable **Tipo de notificación entrante**, seleccione **Es usuario registrado**.</span><span class="sxs-lookup"><span data-stu-id="516bc-267">From the **Incoming claim type** drop-down list, select **Is Registered User**.</span></span>
7. <span data-ttu-id="516bc-268">En el campo **Valor de notificación entrante**, escriba **true**.</span><span class="sxs-lookup"><span data-stu-id="516bc-268">In the **Incoming claim value** field, type **true**.</span></span>
8. <span data-ttu-id="516bc-269">Seleccione el botón de radio **Permitir acceso a usuarios con esta notificación entrante** .</span><span class="sxs-lookup"><span data-stu-id="516bc-269">Select the **Permit access to users with this incoming claim** radio button.</span></span>
9. <span data-ttu-id="516bc-270">Seleccione **Finalizar** y, luego, **Aplicar**.</span><span class="sxs-lookup"><span data-stu-id="516bc-270">Select **Finish**, and then select **Apply**.</span></span>
10. <span data-ttu-id="516bc-271">Quite todas las reglas que sean más permisivas que la regla que creó.</span><span class="sxs-lookup"><span data-stu-id="516bc-271">Remove any rules that are more permissive than the rule you created.</span></span> <span data-ttu-id="516bc-272">Por ejemplo, quite la regla predeterminada **Permitir acceso a todos los usuarios**.</span><span class="sxs-lookup"><span data-stu-id="516bc-272">For example, remove the default rule **Permit Access to all Users**.</span></span>

<span data-ttu-id="516bc-273">Ahora, la aplicación está configurada para permitir el acceso solo cuando el usuario procede de un dispositivo registrado y unido al área de trabajo.</span><span class="sxs-lookup"><span data-stu-id="516bc-273">Your application is now configured to allow access only when the user is coming from a device that they registered and joined to the workplace.</span></span> <span data-ttu-id="516bc-274">Para ver directivas de acceso más avanzadas, consulte [Administrar el riesgo con la autenticación multifactor adicional para aplicaciones con información confidencial](https://technet.microsoft.com/library/dn280949.aspx).</span><span class="sxs-lookup"><span data-stu-id="516bc-274">For more advanced access polices, see [Manage Risk with Additional Multi-Factor Authentication for Sensitive Applications](https://technet.microsoft.com/library/dn280949.aspx).</span></span>

<span data-ttu-id="516bc-275">A continuación, se configura un mensaje de error personalizado para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="516bc-275">Next, you configure a custom error message for your application.</span></span> <span data-ttu-id="516bc-276">El mensaje de error notifica a los usuarios que deben unir el dispositivo al área de trabajo antes de que puedan tener acceso a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="516bc-276">The error message lets users know that they must join their device to the workplace before they can access the application.</span></span> <span data-ttu-id="516bc-277">Puede usar PowerShell y HTML personalizado para crear un mensaje personalizado de acceso denegado a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="516bc-277">You can create a custom application access-denied message by using custom HTML and PowerShell.</span></span>

<span data-ttu-id="516bc-278">En el servidor de federación, abra una ventana Comandos de PowerShell y, luego, escriba el comando siguiente.</span><span class="sxs-lookup"><span data-stu-id="516bc-278">On your federation server, open a PowerShell command window, and then type the following command.</span></span> <span data-ttu-id="516bc-279">Reemplazar partes del comando con elementos específicos de su sistema:</span><span class="sxs-lookup"><span data-stu-id="516bc-279">Replace portions of the command with items that are specific to your system:</span></span>

    Set-AdfsRelyingPartyWebContent -Name "relying party trust name" -ErrorPageAuthorizationErrorMessage
<span data-ttu-id="516bc-280">Para poder acceder a esta aplicación, debe registrar el dispositivo.</span><span class="sxs-lookup"><span data-stu-id="516bc-280">You must register your device before you can access this application.</span></span>

<span data-ttu-id="516bc-281">**Si usa un dispositivo iOS, seleccione este vínculo para conectarlo**:</span><span class="sxs-lookup"><span data-stu-id="516bc-281">**If you are using an iOS device, select this link to join your device**:</span></span>

    a href='https://enterpriseregistration.windows.net/enrollmentserver/otaprofile/yourdomain.com

<span data-ttu-id="516bc-282">Una el dispositivo iOS al área de trabajo.</span><span class="sxs-lookup"><span data-stu-id="516bc-282">Join this iOS device to your workplace.</span></span>

<span data-ttu-id="516bc-283">Si usa un dispositivo Windows 8.1, puede conectarlo si selecciona **Configuración de PC**> **Red** > **Área de trabajo**.</span><span class="sxs-lookup"><span data-stu-id="516bc-283">If you are using a Windows 8.1 device, you can join your device by selecting **PC Settings**> **Network** > **Workplace**.</span></span>

<span data-ttu-id="516bc-284">En los comandos anteriores, el **nombre de relación de confianza para usuario autenticado** es el nombre del objeto Relación de confianza para usuario autenticado de la aplicación en AD FS.</span><span class="sxs-lookup"><span data-stu-id="516bc-284">In the preceding commands, **relying party trust name** is the name of your application's Relying Party Trust object in AD FS.</span></span>
<span data-ttu-id="516bc-285">Y **yourdomain.com** es el nombre de dominio que configuró con Azure Active Directory (por ejemplo, contoso.com).</span><span class="sxs-lookup"><span data-stu-id="516bc-285">And **yourdomain.com** is the domain name that you have configured with Azure Active Directory (for example, contoso.com).</span></span>
<span data-ttu-id="516bc-286">Asegúrese de quitar los saltos de línea (si existen) del contenido HTML que se pasa al cmdlet **Set-AdfsRelyingPartyWebContent**.</span><span class="sxs-lookup"><span data-stu-id="516bc-286">Be sure to remove any line breaks (if any) from the HTML content that you pass to the **Set-AdfsRelyingPartyWebContent** cmdlet.</span></span>

<span data-ttu-id="516bc-287">Ahora, cuando los usuarios accedan a la aplicación desde un dispositivo que no esté registrado con el servicio de registro de dispositivos de Azure Active Directory, verán una página similar a la captura de pantalla siguiente.</span><span class="sxs-lookup"><span data-stu-id="516bc-287">Now when users access your application from a device that's not registered with the Azure Active Directory device registration service, they see a page that looks similar to the following screenshot.</span></span>

![Captura de pantalla de un error cuando los usuarios no han registrado su dispositivo con Azure AD](./media/active-directory-conditional-access/error-azureDRS-device-not-registered.gif)



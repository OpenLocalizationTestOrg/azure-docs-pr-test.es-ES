---
title: "Azure AD Connect: Recuperación del problema que supone el límite de 10 GB en LocalDB| Microsoft Docs"
description: "En este tema se explica cómo recuperar el servicio Azure AD Connect Synchronization cuando se alcanza el límite de 10 GB en LocalDB."
services: active-directory
documentationcenter: 
author: cychua
manager: femila
editor: 
ms.assetid: 41d081af-ed89-4e17-be34-14f7e80ae358
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/17/2017
ms.author: billmath
ms.openlocfilehash: 08e682c51b12d4506019d2f6b68e1eae0798b990
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/03/2017
---
# <a name="azure-ad-connect-how-to-recover-from-localdb-10-gb-limit"></a><span data-ttu-id="c34cc-103">Azure AD Connect: Recuperación del límite de 10 GB de LocalDB</span><span class="sxs-lookup"><span data-stu-id="c34cc-103">Azure AD Connect: How to recover from LocalDB 10-GB limit</span></span>
<span data-ttu-id="c34cc-104">Azure AD Connect requiere una base de datos de SQL Server para almacenar datos de identidad.</span><span class="sxs-lookup"><span data-stu-id="c34cc-104">Azure AD Connect requires a SQL Server database to store identity data.</span></span> <span data-ttu-id="c34cc-105">Puede usar la instancia predeterminada de Local DB incluida en SQL Server 2012 Express que se instala con Azure AD Connect o utilizar la versión completa de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="c34cc-105">You can either use the default SQL Server 2012 Express LocalDB installed with Azure AD Connect or use your own full SQL.</span></span> <span data-ttu-id="c34cc-106">SQL Server Express impone un límite en el tamaño de 10 GB.</span><span class="sxs-lookup"><span data-stu-id="c34cc-106">SQL Server Express imposes a 10-GB size limit.</span></span> <span data-ttu-id="c34cc-107">Si usa LocalDB y se alcanza este límite, el servicio Azure AD Connect Synchronization no podrá iniciarse ni sincronizarse correctamente.</span><span class="sxs-lookup"><span data-stu-id="c34cc-107">When using LocalDB and this limit is reached, Azure AD Connect Synchronization Service can no longer start or synchronize properly.</span></span> <span data-ttu-id="c34cc-108">En este artículo se detallan los pasos de recuperación.</span><span class="sxs-lookup"><span data-stu-id="c34cc-108">This article provides the recovery steps.</span></span>

## <a name="symptoms"></a><span data-ttu-id="c34cc-109">Síntomas</span><span class="sxs-lookup"><span data-stu-id="c34cc-109">Symptoms</span></span>
<span data-ttu-id="c34cc-110">Hay dos síntomas comunes:</span><span class="sxs-lookup"><span data-stu-id="c34cc-110">There are two common symptoms:</span></span>

* <span data-ttu-id="c34cc-111">El servicio Azure AD Connect Synchronization **puede ejecutarse**, pero no es capaz de sincronizarse y se produce el error *“stopped-database-disk-full”*.</span><span class="sxs-lookup"><span data-stu-id="c34cc-111">Azure AD Connect Synchronization Service **is running** but fails to synchronize with *“stopped-database-disk-full”* error.</span></span>

* <span data-ttu-id="c34cc-112">El servicio Azure AD Connect Synchronization **no puede iniciarse**.</span><span class="sxs-lookup"><span data-stu-id="c34cc-112">Azure AD Connect Synchronization Service **is unable to start**.</span></span> <span data-ttu-id="c34cc-113">Cuando se intenta iniciar el servicio, se produce el evento 6323 y aparece el mensaje de error *"El servidor encontró un error porque SQL Server no tiene espacio en disco".*</span><span class="sxs-lookup"><span data-stu-id="c34cc-113">When you attempt to start the service, it fails with event 6323 and error message *"The server encountered an error because SQL Server is out of disk space."*</span></span>

## <a name="short-term-recovery-steps"></a><span data-ttu-id="c34cc-114">Pasos para una recuperación a corto plazo</span><span class="sxs-lookup"><span data-stu-id="c34cc-114">Short-term recovery steps</span></span>
<span data-ttu-id="c34cc-115">En esta sección se explican los pasos que deben seguirse a fin de reclamar el espacio de base de datos necesario para que el servicio Azure AD Connect Synchronization pueda reanudarse.</span><span class="sxs-lookup"><span data-stu-id="c34cc-115">This section provides the steps to reclaim DB space required for Azure AD Connect Synchronization Service to resume operation.</span></span> <span data-ttu-id="c34cc-116">Entre los pasos se incluyen:</span><span class="sxs-lookup"><span data-stu-id="c34cc-116">The steps include:</span></span>
1. [<span data-ttu-id="c34cc-117">Determinación del estado del servicio de sincronización</span><span class="sxs-lookup"><span data-stu-id="c34cc-117">Determine the Synchronization Service status</span></span>](#determine-the-synchronization-service-status)
2. [<span data-ttu-id="c34cc-118">Reducción de la base de datos</span><span class="sxs-lookup"><span data-stu-id="c34cc-118">Shrink the database</span></span>](#shrink-the-database)
3. [<span data-ttu-id="c34cc-119">Eliminación de los datos del historial de ejecución</span><span class="sxs-lookup"><span data-stu-id="c34cc-119">Delete run history data</span></span>](#delete-run-history-data)
4. [<span data-ttu-id="c34cc-120">Reducción del período de retención de los datos del historial de ejecución</span><span class="sxs-lookup"><span data-stu-id="c34cc-120">Shorten retention period for run history data</span></span>](#shorten-retention-period-for-run-history-data)

### <a name="determine-the-synchronization-service-status"></a><span data-ttu-id="c34cc-121">Determinación del estado del servicio de sincronización</span><span class="sxs-lookup"><span data-stu-id="c34cc-121">Determine the Synchronization Service status</span></span>
<span data-ttu-id="c34cc-122">En primer lugar, deberá determinar si el servicio de sincronización sigue en ejecución o no:</span><span class="sxs-lookup"><span data-stu-id="c34cc-122">First, determine whether the Synchronization Service is still running or not:</span></span>

1. <span data-ttu-id="c34cc-123">Inicie sesión como administrador en el servidor de Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="c34cc-123">Log in to your Azure AD Connect server as administrator.</span></span>

2. <span data-ttu-id="c34cc-124">Vaya a **Administrador de control de servicios**.</span><span class="sxs-lookup"><span data-stu-id="c34cc-124">Go to **Service Control Manager**.</span></span>

3. <span data-ttu-id="c34cc-125">Compruebe el estado de **Microsoft Azure AD Sync**.</span><span class="sxs-lookup"><span data-stu-id="c34cc-125">Check the status of **Microsoft Azure AD Sync**.</span></span>


4. <span data-ttu-id="c34cc-126">Si el servicio está en ejecución, no lo detenga ni lo reinicie.</span><span class="sxs-lookup"><span data-stu-id="c34cc-126">If it is running, do not stop or restart the service.</span></span> <span data-ttu-id="c34cc-127">Omita el paso [Reducción de la base de datos](#shrink-the-database) y salte directamente a [Eliminación de los datos del historial de ejecución](#delete-run-history-data).</span><span class="sxs-lookup"><span data-stu-id="c34cc-127">Skip [Shrink the database](#shrink-the-database) step and go to [Delete run history data](#delete-run-history-data) step.</span></span>

5. <span data-ttu-id="c34cc-128">Si el servicio no está en ejecución, intente iniciarlo.</span><span class="sxs-lookup"><span data-stu-id="c34cc-128">If it is not running, try to start the service.</span></span> <span data-ttu-id="c34cc-129">Si se inicia correctamente, omita el paso [Reducción de la base de datos](#shrink-the-database) y salte directamente a [Eliminación de los datos del historial de ejecución](#delete-run-history-data).</span><span class="sxs-lookup"><span data-stu-id="c34cc-129">If the service starts successfully, skip [Shrink the database](#shrink-the-database) step and go to [Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="c34cc-130">De lo contrario, continúe en el paso [Reducción de la base de datos](#shrink-the-database).</span><span class="sxs-lookup"><span data-stu-id="c34cc-130">Otherwise, continue with [Shrink the database](#shrink-the-database) step.</span></span>

### <a name="shrink-the-database"></a><span data-ttu-id="c34cc-131">Reducción de la base de datos</span><span class="sxs-lookup"><span data-stu-id="c34cc-131">Shrink the database</span></span>
<span data-ttu-id="c34cc-132">Utilice la operación de reducción para liberar el suficiente espacio en la base de datos como para iniciar el servicio de sincronización.</span><span class="sxs-lookup"><span data-stu-id="c34cc-132">Use the Shrink operation to free up enough DB space to start the Synchronization Service.</span></span> <span data-ttu-id="c34cc-133">Esto se consigue eliminando espacios en blanco de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c34cc-133">It frees up DB space by removing whitespaces in the database.</span></span> <span data-ttu-id="c34cc-134">Aunque este paso es el más indicado, no garantiza que se pueda recuperar espacio en todos los casos.</span><span class="sxs-lookup"><span data-stu-id="c34cc-134">This step is best-effort as it is not guaranteed that you can always recover space.</span></span> <span data-ttu-id="c34cc-135">Para más información sobre esta operación, consulte el artículo [Reducir una base de datos](https://msdn.microsoft.com/library/ms189035.aspx).</span><span class="sxs-lookup"><span data-stu-id="c34cc-135">To learn more about Shrink operation, read this article [Shrink a database](https://msdn.microsoft.com/library/ms189035.aspx).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c34cc-136">Omita este paso si consigue ejecutar el servicio de sincronización.</span><span class="sxs-lookup"><span data-stu-id="c34cc-136">Skip this step if you can get the Synchronization Service to run.</span></span> <span data-ttu-id="c34cc-137">No resulta recomendable reducir la base de datos SQL, ya que, al aumentar la fragmentación, el rendimiento podría verse afectado.</span><span class="sxs-lookup"><span data-stu-id="c34cc-137">It is not recommended to shrink the SQL DB as it can lead to poor performance due to increased fragmentation.</span></span>

<span data-ttu-id="c34cc-138">El nombre de la base de datos creada para Azure AD Connect es **ADSync**.</span><span class="sxs-lookup"><span data-stu-id="c34cc-138">The name of the database created for Azure AD Connect is **ADSync**.</span></span> <span data-ttu-id="c34cc-139">Para realizar la operación de reducción, debe iniciar sesión como administrador del sistema o como DBO de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c34cc-139">To perform a Shrink operation, you must log in either as the sysadmin or DBO of the database.</span></span> <span data-ttu-id="c34cc-140">Durante la instalación de Azure AD Connect, se concederán privilegios de administrador del sistema a las cuentas siguientes:</span><span class="sxs-lookup"><span data-stu-id="c34cc-140">During Azure AD Connect installation, the following accounts are granted sysadmin rights:</span></span>
* <span data-ttu-id="c34cc-141">Administradores locales</span><span class="sxs-lookup"><span data-stu-id="c34cc-141">Local Administrators</span></span>
* <span data-ttu-id="c34cc-142">La cuenta de usuario utilizada para ejecutar la instalación de Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="c34cc-142">The user account that was used to run Azure AD Connect installation.</span></span>
* <span data-ttu-id="c34cc-143">La cuenta del servicio de sincronización que se utilizó como contexto operativo del servicio Azure AD Connect Synchronization.</span><span class="sxs-lookup"><span data-stu-id="c34cc-143">The Sync Service account that is used as the operating context of Azure AD Connect Synchronization Service.</span></span>
* <span data-ttu-id="c34cc-144">El grupo local ADSyncAdmins que se creó durante la instalación.</span><span class="sxs-lookup"><span data-stu-id="c34cc-144">The local group ADSyncAdmins that was created during installation.</span></span>

1. <span data-ttu-id="c34cc-145">Realice una copia de seguridad de la base de datos. Para ello, copie en una ubicación segura los archivos **ADSync.mdf** y **ADSync_log.ldf** que se encuentran en `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data`.</span><span class="sxs-lookup"><span data-stu-id="c34cc-145">Back up the database by copying **ADSync.mdf** and **ADSync_log.ldf** files located under `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` to a safe location.</span></span>

2. <span data-ttu-id="c34cc-146">Inicie una nueva sesión de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="c34cc-146">Start a new PowerShell session.</span></span>

3. <span data-ttu-id="c34cc-147">Acceda a la carpeta `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span><span class="sxs-lookup"><span data-stu-id="c34cc-147">Navigate to folder `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span></span>

4. <span data-ttu-id="c34cc-148">Inicie la utilidad **sqlcmd** ejecutando el comando `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>` con las credenciales del administrador del sistema o DBO de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c34cc-148">Start **sqlcmd** utility by running the command `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, using the credential of a sysadmin or the database DBO.</span></span>

5. <span data-ttu-id="c34cc-149">Para reducir la base de datos, en el símbolo del sistema de sqlcmd (1>), escriba `DBCC Shrinkdatabase(ADSync,1);` y, en la siguiente línea, `GO`.</span><span class="sxs-lookup"><span data-stu-id="c34cc-149">To shrink the database, at the sqlcmd prompt (1>), enter `DBCC Shrinkdatabase(ADSync,1);`, followed by `GO` in the next line.</span></span>

6. <span data-ttu-id="c34cc-150">Si la operación se realiza correctamente, intente iniciar de nuevo el servicio de sincronización.</span><span class="sxs-lookup"><span data-stu-id="c34cc-150">If the operation is successful, try to start the Synchronization Service again.</span></span> <span data-ttu-id="c34cc-151">Si consigue iniciarlo, vaya al paso [Eliminación de los datos del historial de ejecución](#delete-run-history-data).</span><span class="sxs-lookup"><span data-stu-id="c34cc-151">If you can start the Synchronization Service, go to [Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="c34cc-152">De lo contrario, póngase en contacto con el servicio de soporte técnico.</span><span class="sxs-lookup"><span data-stu-id="c34cc-152">If not, contact Support.</span></span>

### <a name="delete-run-history-data"></a><span data-ttu-id="c34cc-153">Eliminación de los datos del historial de ejecución</span><span class="sxs-lookup"><span data-stu-id="c34cc-153">Delete run history data</span></span>
<span data-ttu-id="c34cc-154">De forma predeterminada, Azure AD Connect mantiene durante un máximo de siete días los datos del historial de ejecución.</span><span class="sxs-lookup"><span data-stu-id="c34cc-154">By default, Azure AD Connect retains up to seven days’ worth of run history data.</span></span> <span data-ttu-id="c34cc-155">En este paso, eliminaremos los datos del historial de ejecución para tratar de ampliar el espacio de la base de datos y, de este modo, conseguir que el servicio Azure AD Connect Synchronization consiga sincronizarse de nuevo.</span><span class="sxs-lookup"><span data-stu-id="c34cc-155">In this step, we delete the run history data to reclaim DB space so that Azure AD Connect Synchronization Service can start syncing again.</span></span>

1.  <span data-ttu-id="c34cc-156">Inicie **Synchronization Service Manager**. Para ello, vaya a INICIO → Synchronization Service (Servicio de sincronización).</span><span class="sxs-lookup"><span data-stu-id="c34cc-156">Start **Synchronization Service Manager** by going to START → Synchronization Service.</span></span>

2.  <span data-ttu-id="c34cc-157">Vaya a la pestaña **Operations** (Operaciones).</span><span class="sxs-lookup"><span data-stu-id="c34cc-157">Go to the **Operations** tab.</span></span>

3.  <span data-ttu-id="c34cc-158">En **Actions** (Acciones), seleccione **Clear Runs...** (Borrar ejecuciones...).</span><span class="sxs-lookup"><span data-stu-id="c34cc-158">Under **Actions**, select **Clear Runs**…</span></span>

4.  <span data-ttu-id="c34cc-159">Puede seleccionar una de estas dos opciones: **Clear all runs** (Borrar todas las ejecuciones) o **Clear runs before… <date>** (Borrar todas las ejecuciones anteriores a...).</span><span class="sxs-lookup"><span data-stu-id="c34cc-159">You can either choose **Clear all runs** or **Clear runs before… <date>** option.</span></span> <span data-ttu-id="c34cc-160">Es conveniente que empiece borrando los datos del historial de ejecución que tienen más de dos días.</span><span class="sxs-lookup"><span data-stu-id="c34cc-160">It is recommended that you start by clearing run history data that are older than two days.</span></span> <span data-ttu-id="c34cc-161">Si el tamaño de la base de datos sigue siendo un problema, elija la opción **Clear all runs** (Borrar todas las ejecuciones).</span><span class="sxs-lookup"><span data-stu-id="c34cc-161">If you continue to run into DB size issue, then choose the **Clear all runs** option.</span></span>

### <a name="shorten-retention-period-for-run-history-data"></a><span data-ttu-id="c34cc-162">Reducción del período de retención de los datos del historial de ejecución</span><span class="sxs-lookup"><span data-stu-id="c34cc-162">Shorten retention period for run history data</span></span>
<span data-ttu-id="c34cc-163">Este paso está diseñado para reducir la probabilidad de que el límite de 10 GB resulte un problema después de ejecutar varios ciclos de sincronización.</span><span class="sxs-lookup"><span data-stu-id="c34cc-163">This step is to reduce the likelihood of running into the 10-GB limit issue after multiple sync cycles.</span></span>

1. <span data-ttu-id="c34cc-164">Abra una nueva sesión de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="c34cc-164">Open a new PowerShell session.</span></span>

2. <span data-ttu-id="c34cc-165">Ejecute `Get-ADSyncScheduler` y anote la propiedad PurgeRunHistoryInterval, donde se especifica el período de retención actual.</span><span class="sxs-lookup"><span data-stu-id="c34cc-165">Run `Get-ADSyncScheduler` and take note of the PurgeRunHistoryInterval property, which specifies the current retention period.</span></span>

3. <span data-ttu-id="c34cc-166">Ejecute `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` para establecer el período de retención en dos días.</span><span class="sxs-lookup"><span data-stu-id="c34cc-166">Run `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` to set the retention period to two days.</span></span> <span data-ttu-id="c34cc-167">Ajuste este período según corresponda.</span><span class="sxs-lookup"><span data-stu-id="c34cc-167">Adjust the retention period as appropriate.</span></span>

## <a name="long-term-solution--migrate-to-full-sql"></a><span data-ttu-id="c34cc-168">Solución a largo plazo: migración a la versión completa de SQL Server</span><span class="sxs-lookup"><span data-stu-id="c34cc-168">Long-term solution – Migrate to full SQL</span></span>
<span data-ttu-id="c34cc-169">En líneas generales, este problema indica que los 10 GB de tamaño de la base de datos ya no resultan suficientes para que Azure AD Connect pueda sincronizar la instancia local de Active Directory con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c34cc-169">In general, the issue is indicative that 10-GB database size is no longer sufficient for Azure AD Connect to synchronize your on-premises Active Directory to Azure AD.</span></span> <span data-ttu-id="c34cc-170">Por tanto, se recomienda utilizar la versión completa de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="c34cc-170">It is recommended that you switch to using the full version of SQL server.</span></span> <span data-ttu-id="c34cc-171">La instancia de LocalDB de una implementación existente de Azure AD Connect no se puede sustituir directamente por la base de datos de la versión completa de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="c34cc-171">You cannot directly replace the LocalDB of an existing Azure AD Connect deployment with the database of the full version of SQL.</span></span> <span data-ttu-id="c34cc-172">En su lugar, es necesario implementar un nuevo servidor de Azure AD Connect con la versión completa de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="c34cc-172">Instead, you must deploy a new Azure AD Connect server with the full version of SQL.</span></span> <span data-ttu-id="c34cc-173">Le recomendamos que realice una migración alterna en la que el nuevo servidor de Azure AD Connect (con la base de datos SQL) se implemente como servidor provisional, junto con el servidor existente de Azure AD Connect (con la instancia de LocalDB).</span><span class="sxs-lookup"><span data-stu-id="c34cc-173">It is recommended that you do a swing migration where the new Azure AD Connect server (with SQL DB) is deployed as a staging server, next to the existing Azure AD Connect server (with LocalDB).</span></span> 
* <span data-ttu-id="c34cc-174">Para obtener instrucciones acerca de cómo configurar una instancia remota de SQL con Azure AD Connect, consulte el artículo [Instalación personalizada de Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span><span class="sxs-lookup"><span data-stu-id="c34cc-174">For instruction on how to configure remote SQL with Azure AD Connect, refer to article [Custom installation of Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span></span>
* <span data-ttu-id="c34cc-175">Para obtener instrucciones relacionadas con la migración alterna de una actualización de Azure AD Connect, consulte el artículo [Azure AD Connect: actualización de una versión anterior a la versión más reciente](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration).</span><span class="sxs-lookup"><span data-stu-id="c34cc-175">For instructions on swing migration for Azure AD Connect upgrade, refer to article [Azure AD Connect: Upgrade from a previous version to the latest](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration).</span></span>

## <a name="next-steps"></a><span data-ttu-id="c34cc-176">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="c34cc-176">Next steps</span></span>
<span data-ttu-id="c34cc-177">Obtenga más información sobre la [Integración de las identidades locales con Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="c34cc-177">Learn more about [Integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>

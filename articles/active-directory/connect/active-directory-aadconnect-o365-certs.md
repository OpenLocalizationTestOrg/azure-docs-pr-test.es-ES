---
title: "renovación de aaaCertificate para los usuarios de Office 365 y Azure AD | Documentos de Microsoft"
description: "Este artículo explica tooOffice 365 a los usuarios cómo tooresolve problemas con mensajes de correo electrónico que notificarán sobre cómo renovar un certificado."
services: active-directory
documentationcenter: 
author: billmath
manager: femila
editor: curtand
ms.assetid: 543b7dc1-ccc9-407f-85a1-a9944c0ba1be
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/12/2017
ms.author: billmath
ms.openlocfilehash: b9b309e06949dc5488cd628650be413f366ed347
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="renew-federation-certificates-for-office-365-and-azure-active-directory"></a><span data-ttu-id="9c8de-103">Renovación de certificados de federación para Office 365 y Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="9c8de-103">Renew federation certificates for Office 365 and Azure Active Directory</span></span>
## <a name="overview"></a><span data-ttu-id="9c8de-104">Información general</span><span class="sxs-lookup"><span data-stu-id="9c8de-104">Overview</span></span>
<span data-ttu-id="9c8de-105">Para la federación correcta entre Azure Active Directory (Azure AD) y los servicios de federación de Active Directory (AD FS), certificados de hello utilizados por tooAzure de tokens de seguridad de AD FS toosign AD deben coincidir con lo que está configurado en Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9c8de-105">For successful federation between Azure Active Directory (Azure AD) and Active Directory Federation Services (AD FS), hello certificates used by AD FS toosign security tokens tooAzure AD should match what is configured in Azure AD.</span></span> <span data-ttu-id="9c8de-106">Si hay alguna incoherencia puede provocar toobroken confianza.</span><span class="sxs-lookup"><span data-stu-id="9c8de-106">Any mismatch can lead toobroken trust.</span></span> <span data-ttu-id="9c8de-107">Azure AD garantiza que esta información se mantiene sincronizada cuando se implementa AD FS y Proxy de aplicación web (para el acceso de extranet).</span><span class="sxs-lookup"><span data-stu-id="9c8de-107">Azure AD ensures that this information is kept in sync when you deploy AD FS and Web Application Proxy (for extranet access).</span></span>

<span data-ttu-id="9c8de-108">Este artículo proporciona toomanage de información adicional los certificados de firma de tokens y mantenerlos sincronizados con Azure AD, en hello casos siguientes:</span><span class="sxs-lookup"><span data-stu-id="9c8de-108">This article provides you additional information toomanage your token signing certificates and keep them in sync with Azure AD, in hello following cases:</span></span>

* <span data-ttu-id="9c8de-109">Va a implementar Hola Proxy de aplicación Web y, por tanto, no están disponible en hello extranet Hola metadatos de federación.</span><span class="sxs-lookup"><span data-stu-id="9c8de-109">You are not deploying hello Web Application Proxy, and therefore hello federation metadata is not available in hello extranet.</span></span>
* <span data-ttu-id="9c8de-110">No se usa la configuración predeterminada de Hola de AD FS para certificados de firma de tokens.</span><span class="sxs-lookup"><span data-stu-id="9c8de-110">You are not using hello default configuration of AD FS for token signing certificates.</span></span>
* <span data-ttu-id="9c8de-111">Utiliza un proveedor de identidades de terceros.</span><span class="sxs-lookup"><span data-stu-id="9c8de-111">You are using a third-party identity provider.</span></span>

## <a name="default-configuration-of-ad-fs-for-token-signing-certificates"></a><span data-ttu-id="9c8de-112">Configuración predeterminada de AD FS para los certificados de firma de tokens</span><span class="sxs-lookup"><span data-stu-id="9c8de-112">Default configuration of AD FS for token signing certificates</span></span>
<span data-ttu-id="9c8de-113">firma de tokens de Hola y el token de descifrado de certificados son normalmente los certificados autofirmados y son buenos para un año.</span><span class="sxs-lookup"><span data-stu-id="9c8de-113">hello token signing and token decrypting certificates are usually self-signed certificates, and are good for one year.</span></span> <span data-ttu-id="9c8de-114">De forma predeterminada, AD FS incluye un proceso de renovación automática llamado **AutoCertificateRollover**.</span><span class="sxs-lookup"><span data-stu-id="9c8de-114">By default, AD FS includes an auto-renewal process called **AutoCertificateRollover**.</span></span> <span data-ttu-id="9c8de-115">Si utiliza AD FS 2.0 o versiones posteriores, Office 365 y Azure AD actualizan automáticamente el certificado antes de que expire.</span><span class="sxs-lookup"><span data-stu-id="9c8de-115">If you are using AD FS 2.0 or later, Office 365 and Azure AD automatically update your certificate before it expires.</span></span>

### <a name="renewal-notification-from-hello-office-365-portal-or-an-email"></a><span data-ttu-id="9c8de-116">Notificaciones de renovación de portal de Office 365 Hola o un correo electrónico</span><span class="sxs-lookup"><span data-stu-id="9c8de-116">Renewal notification from hello Office 365 portal or an email</span></span>
> [!NOTE]
> <span data-ttu-id="9c8de-117">Si ha recibido un correo electrónico o una notificación de portal que le pide que toorenew el certificado para Office, consulte [cambia de administrar certificados de firma de tootoken](#managecerts) toocheck si necesita tootake ninguna acción.</span><span class="sxs-lookup"><span data-stu-id="9c8de-117">If you received an email or a portal notification asking you toorenew your certificate for Office, see [Managing changes tootoken signing certificates](#managecerts) toocheck if you need tootake any action.</span></span> <span data-ttu-id="9c8de-118">Microsoft es consciente de un posible problema que puede provocar toonotifications para la renovación de certificados que se envió, incluso cuando no se requiere ninguna acción.</span><span class="sxs-lookup"><span data-stu-id="9c8de-118">Microsoft is aware of a possible issue that can lead toonotifications for certificate renewal being sent, even when no action is required.</span></span>
>
>

<span data-ttu-id="9c8de-119">Azure AD intentos de metadatos de federación de hello toomonitor y símbolo (token) de Hola de actualización de certificados de firma, como se indica en estos metadatos.</span><span class="sxs-lookup"><span data-stu-id="9c8de-119">Azure AD attempts toomonitor hello federation metadata, and update hello token signing certificates as indicated by this metadata.</span></span> <span data-ttu-id="9c8de-120">30 días antes de que caduque Hola de certificados de firma de tokens de hello Azure AD comprueba si nuevos certificados están disponibles por sondeo en los metadatos de federación de Hola.</span><span class="sxs-lookup"><span data-stu-id="9c8de-120">30 days before hello expiration of hello token signing certificates, Azure AD checks if new certificates are available by polling hello federation metadata.</span></span>

* <span data-ttu-id="9c8de-121">Si puede sondear los metadatos de federación de Hola y recuperar nuevos certificados de hello correctamente, ninguna notificación por correo electrónico o una advertencia en el portal de Office 365 Hola se emite toohello usuario.</span><span class="sxs-lookup"><span data-stu-id="9c8de-121">If it can successfully poll hello federation metadata and retrieve hello new certificates, no email notification or warning in hello Office 365 portal is issued toohello user.</span></span>
* <span data-ttu-id="9c8de-122">Si no se puede recuperar los certificados de firma de token nuevo de Hola, ya sea porque los metadatos de federación de hello no están accesible o no está habilitada la sustitución automática de certificados, Azure AD emite una notificación por correo electrónico y una advertencia en el portal de Office 365 Hola.</span><span class="sxs-lookup"><span data-stu-id="9c8de-122">If it cannot retrieve hello new token signing certificates, either because hello federation metadata is not reachable or automatic certificate rollover is not enabled, Azure AD issues an email notification and a warning in hello Office 365 portal.</span></span>

![Notificación del portal de Office 365](./media/active-directory-aadconnect-o365-certs/notification.png)

> [!IMPORTANT]
> <span data-ttu-id="9c8de-124">Si utilizas AD FS, continuidad del negocio tooensure, compruebe que los servidores tienen Hola después de las actualizaciones de modo que no se producen errores de autenticación para los problemas conocidos.</span><span class="sxs-lookup"><span data-stu-id="9c8de-124">If you are using AD FS, tooensure business continuity, please verify that your servers have hello following updates so that authentication failures for known issues do not occur.</span></span> <span data-ttu-id="9c8de-125">Esta acción mitiga los problemas conocidos del servidor de proxy de AD FS para esta renovación y períodos de renovación futuros:</span><span class="sxs-lookup"><span data-stu-id="9c8de-125">This mitigates known AD FS proxy server issues for this renewal and future renewal periods:</span></span>
>
> <span data-ttu-id="9c8de-126">Server 2012 R2: [paquete acumulativo de mayo de 2014 de Windows Server](http://support.microsoft.com/kb/2955164)</span><span class="sxs-lookup"><span data-stu-id="9c8de-126">Server 2012 R2 - [Windows Server May 2014 rollup](http://support.microsoft.com/kb/2955164)</span></span>
>
> <span data-ttu-id="9c8de-127">Server 2008 R2 y 2012: [Se produce un error en la autenticación a través de proxy en Windows Server 2012 o Windows Server 2008 R2 SP1](http://support.microsoft.com/kb/3094446)</span><span class="sxs-lookup"><span data-stu-id="9c8de-127">Server 2008 R2 and 2012 - [Authentication through proxy fails in Windows Server 2012 or Windows 2008 R2 SP1](http://support.microsoft.com/kb/3094446)</span></span>
>
>

## <span data-ttu-id="9c8de-128">Comprobar si los certificados de hello necesitan toobe actualizado<a name="managecerts"></a></span><span class="sxs-lookup"><span data-stu-id="9c8de-128">Check if hello certificates need toobe updated <a name="managecerts"></a></span></span>
### <a name="step-1-check-hello-autocertificaterollover-state"></a><span data-ttu-id="9c8de-129">Paso 1: Comprobar el estado de AutoCertificateRollover Hola</span><span class="sxs-lookup"><span data-stu-id="9c8de-129">Step 1: Check hello AutoCertificateRollover state</span></span>
<span data-ttu-id="9c8de-130">En el servidor de AD FS, abra Powershell.</span><span class="sxs-lookup"><span data-stu-id="9c8de-130">On your AD FS server, open PowerShell.</span></span> <span data-ttu-id="9c8de-131">Compruebe que el valor de AutoCertificateRollover de hello está establecido tooTrue.</span><span class="sxs-lookup"><span data-stu-id="9c8de-131">Check that hello AutoCertificateRollover value is set tooTrue.</span></span>

    Get-Adfsproperties

![AutoCertificateRollover](./media/active-directory-aadconnect-o365-certs/autocertrollover.png)

>[!NOTE] 
><span data-ttu-id="9c8de-133">Si usa AD FS 2.0, ejecute primero Add-Pssnapin Microsoft.Adfs.Powershell.</span><span class="sxs-lookup"><span data-stu-id="9c8de-133">If you are using AD FS 2.0, first run Add-Pssnapin Microsoft.Adfs.Powershell.</span></span>

### <a name="step-2-confirm-that-ad-fs-and-azure-ad-are-in-sync"></a><span data-ttu-id="9c8de-134">Paso 2: Confirmar que AD FS y Azure AD están sincronizados</span><span class="sxs-lookup"><span data-stu-id="9c8de-134">Step 2: Confirm that AD FS and Azure AD are in sync</span></span>
<span data-ttu-id="9c8de-135">En el servidor de AD FS, abra el símbolo del sistema de hello Azure AD PowerShell y conectar tooAzure AD.</span><span class="sxs-lookup"><span data-stu-id="9c8de-135">On your AD FS server, open hello Azure AD PowerShell prompt, and connect tooAzure AD.</span></span>

> [!NOTE]
> <span data-ttu-id="9c8de-136">Puede descargar Azure AD PowerShell [aquí](https://technet.microsoft.com/library/jj151815.aspx).</span><span class="sxs-lookup"><span data-stu-id="9c8de-136">You can download Azure AD PowerShell [here](https://technet.microsoft.com/library/jj151815.aspx).</span></span>
>
>

    Connect-MsolService

<span data-ttu-id="9c8de-137">Comprobar certificados Hola configuran en AD FS y especifica las propiedades de confianza de Azure AD para hello dominio.</span><span class="sxs-lookup"><span data-stu-id="9c8de-137">Check hello certificates configured in AD FS and Azure AD trust properties for hello specified domain.</span></span>

    Get-MsolFederationProperty -DomainName <domain.name> | FL Source, TokenSigningCertificate

![Get-MsolFederationProperty](./media/active-directory-aadconnect-o365-certs/certsync.png)

<span data-ttu-id="9c8de-139">Si las huellas digitales de hello en ambas Hola salidas coincidencia, los certificados estén sincronizados con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9c8de-139">If hello thumbprints in both hello outputs match, your certificates are in sync with Azure AD.</span></span>

### <a name="step-3-check-if-your-certificate-is-about-tooexpire"></a><span data-ttu-id="9c8de-140">Paso 3: Comprobar si el certificado es sobre tooexpire</span><span class="sxs-lookup"><span data-stu-id="9c8de-140">Step 3: Check if your certificate is about tooexpire</span></span>
<span data-ttu-id="9c8de-141">En la salida de hello de Get-MsolFederationProperty o Get-AdfsCertificate, busque la fecha de hello en "No After".</span><span class="sxs-lookup"><span data-stu-id="9c8de-141">In hello output of either Get-MsolFederationProperty or Get-AdfsCertificate, check for hello date under "Not After."</span></span> <span data-ttu-id="9c8de-142">Si la fecha de hello es inferior a 30 días, que debería adoptar medidas.</span><span class="sxs-lookup"><span data-stu-id="9c8de-142">If hello date is less than 30 days away, you should take action.</span></span>

| <span data-ttu-id="9c8de-143">AutoCertificateRollover</span><span class="sxs-lookup"><span data-stu-id="9c8de-143">AutoCertificateRollover</span></span> | <span data-ttu-id="9c8de-144">Certificados sincronizados con Azure AD</span><span class="sxs-lookup"><span data-stu-id="9c8de-144">Certificates in sync with Azure AD</span></span> | <span data-ttu-id="9c8de-145">Los metadatos de federación están disponibles públicamente</span><span class="sxs-lookup"><span data-stu-id="9c8de-145">Federation metadata is publicly accessible</span></span> | <span data-ttu-id="9c8de-146">Validez</span><span class="sxs-lookup"><span data-stu-id="9c8de-146">Validity</span></span> | <span data-ttu-id="9c8de-147">Acción</span><span class="sxs-lookup"><span data-stu-id="9c8de-147">Action</span></span> |
|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="9c8de-148">Sí</span><span class="sxs-lookup"><span data-stu-id="9c8de-148">Yes</span></span> |<span data-ttu-id="9c8de-149">Sí</span><span class="sxs-lookup"><span data-stu-id="9c8de-149">Yes</span></span> |<span data-ttu-id="9c8de-150">Sí</span><span class="sxs-lookup"><span data-stu-id="9c8de-150">Yes</span></span> |- |<span data-ttu-id="9c8de-151">No se requiere ninguna acción.</span><span class="sxs-lookup"><span data-stu-id="9c8de-151">No action needed.</span></span> <span data-ttu-id="9c8de-152">Consulte [Renovación automática de certificados de firma de tokens](#autorenew).</span><span class="sxs-lookup"><span data-stu-id="9c8de-152">See [Renew token signing certificate automatically](#autorenew).</span></span> |
| <span data-ttu-id="9c8de-153">Sí</span><span class="sxs-lookup"><span data-stu-id="9c8de-153">Yes</span></span> |<span data-ttu-id="9c8de-154">No</span><span class="sxs-lookup"><span data-stu-id="9c8de-154">No</span></span> |- |<span data-ttu-id="9c8de-155">Menos de 15 días</span><span class="sxs-lookup"><span data-stu-id="9c8de-155">Less than 15 days</span></span> |<span data-ttu-id="9c8de-156">Renovar inmediatamente.</span><span class="sxs-lookup"><span data-stu-id="9c8de-156">Renew immediately.</span></span> <span data-ttu-id="9c8de-157">Consulte [Renovación manual de certificados de firma de tokens](#manualrenew).</span><span class="sxs-lookup"><span data-stu-id="9c8de-157">See [Renew token signing certificate manually](#manualrenew).</span></span> |
| <span data-ttu-id="9c8de-158">No</span><span class="sxs-lookup"><span data-stu-id="9c8de-158">No</span></span> |- |- |<span data-ttu-id="9c8de-159">Menos de 30 días</span><span class="sxs-lookup"><span data-stu-id="9c8de-159">Less than 30 days</span></span> |<span data-ttu-id="9c8de-160">Renovar inmediatamente.</span><span class="sxs-lookup"><span data-stu-id="9c8de-160">Renew immediately.</span></span> <span data-ttu-id="9c8de-161">Consulte [Renovación manual de certificados de firma de tokens](#manualrenew).</span><span class="sxs-lookup"><span data-stu-id="9c8de-161">See [Renew token signing certificate manually](#manualrenew).</span></span> |

<span data-ttu-id="9c8de-162">\[-] No importa</span><span class="sxs-lookup"><span data-stu-id="9c8de-162">\[-]  Does not matter</span></span>

## <span data-ttu-id="9c8de-163">Renovar automáticamente los certificados de firma de tokens de hello (recomendado)<a name="autorenew"></a></span><span class="sxs-lookup"><span data-stu-id="9c8de-163">Renew hello token signing certificate automatically (recommended) <a name="autorenew"></a></span></span>
<span data-ttu-id="9c8de-164">No es necesario tooperform ningún paso manual si se cumplen los siguientes hello:</span><span class="sxs-lookup"><span data-stu-id="9c8de-164">You don't need tooperform any manual steps if both of hello following are true:</span></span>

* <span data-ttu-id="9c8de-165">Ha implementado el Proxy de aplicación Web, lo que hace posible el acceso a metadatos de federación toohello de hello extranet.</span><span class="sxs-lookup"><span data-stu-id="9c8de-165">You have deployed Web Application Proxy, which can enable access toohello federation metadata from hello extranet.</span></span>
* <span data-ttu-id="9c8de-166">Usa la configuración predeterminada de hello AD FS (AutoCertificateRollover está habilitado).</span><span class="sxs-lookup"><span data-stu-id="9c8de-166">You are using hello AD FS default configuration (AutoCertificateRollover is enabled).</span></span>

<span data-ttu-id="9c8de-167">Hola de comprobación siguientes tooconfirm que Hola certificado puede actualizarse automáticamente.</span><span class="sxs-lookup"><span data-stu-id="9c8de-167">Check hello following tooconfirm that hello certificate can be automatically updated.</span></span>

<span data-ttu-id="9c8de-168">**1. Hola propiedad AutoCertificateRollover de AD FS se debe establecer tooTrue.**</span><span class="sxs-lookup"><span data-stu-id="9c8de-168">**1. hello AD FS property AutoCertificateRollover must be set tooTrue.**</span></span> <span data-ttu-id="9c8de-169">Esto indica que AD FS generará automáticamente nuevos certificados de firma y descifrado de tokens, antes de hello antiguo los punto de expirar.</span><span class="sxs-lookup"><span data-stu-id="9c8de-169">This indicates that AD FS will automatically generate new token signing and token decryption certificates, before hello old ones expire.</span></span>

<span data-ttu-id="9c8de-170">**2. metadatos de federación de Hola AD FS están accesible públicamente.**</span><span class="sxs-lookup"><span data-stu-id="9c8de-170">**2. hello AD FS federation metadata is publicly accessible.**</span></span> <span data-ttu-id="9c8de-171">Compruebe que los metadatos de federación están accesible públicamente desplazándose toohello siguiente dirección URL desde un equipo de Hola internet pública (fuera de la red corporativa de hello):</span><span class="sxs-lookup"><span data-stu-id="9c8de-171">Check that your federation metadata is publicly accessible by navigating toohello following URL from a computer on hello public internet (off of hello corporate network):</span></span>

<span data-ttu-id="9c8de-172">https://(your_FS_name)/federationmetadata/2007-06/federationmetadata.xml</span><span class="sxs-lookup"><span data-stu-id="9c8de-172">https://(your_FS_name)/federationmetadata/2007-06/federationmetadata.xml</span></span>

<span data-ttu-id="9c8de-173">donde `(your_FS_name) `se sustituye por el nombre de host del servicio de federación de hello usa su organización, por ejemplo, fs.contoso.com.  Si es capaz de tooverify ambos de estos valores correctamente, no tiene toodo cualquier otra cosa.</span><span class="sxs-lookup"><span data-stu-id="9c8de-173">where `(your_FS_name) `is replaced with hello federation service host name your organization uses, such as fs.contoso.com.  If you are able tooverify both of these settings successfully, you do not have toodo anything else.</span></span>  

<span data-ttu-id="9c8de-174">Ejemplo: https://fs.contoso.com/federationmetadata/2007-06/federationmetadata.xml</span><span class="sxs-lookup"><span data-stu-id="9c8de-174">Example: https://fs.contoso.com/federationmetadata/2007-06/federationmetadata.xml</span></span>

## <span data-ttu-id="9c8de-175">Renovar manualmente los certificados de firma de tokens de Hola<a name="manualrenew"></a></span><span class="sxs-lookup"><span data-stu-id="9c8de-175">Renew hello token signing certificate manually <a name="manualrenew"></a></span></span>
<span data-ttu-id="9c8de-176">Puede elegir toorenew certificados de firma de tokens de hello manualmente.</span><span class="sxs-lookup"><span data-stu-id="9c8de-176">You may choose toorenew hello token signing certificates manually.</span></span> <span data-ttu-id="9c8de-177">Por ejemplo, hello escenarios siguientes podrían funcionar mejor para la renovación manual:</span><span class="sxs-lookup"><span data-stu-id="9c8de-177">For example, hello following scenarios might work better for manual renewal:</span></span>

* <span data-ttu-id="9c8de-178">Los certificados de firma de tokens no son certificados autofirmados.</span><span class="sxs-lookup"><span data-stu-id="9c8de-178">Token signing certificates are not self-signed certificates.</span></span> <span data-ttu-id="9c8de-179">Hola más comunes motivo es que su organización administra los certificados de AD FS inscritos desde una entidad de certificación de organización.</span><span class="sxs-lookup"><span data-stu-id="9c8de-179">hello most common reason for this is that your organization manages AD FS certificates enrolled from an organizational certificate authority.</span></span>
* <span data-ttu-id="9c8de-180">Seguridad de red no permite toobe de metadatos de federación de hello disponible públicamente.</span><span class="sxs-lookup"><span data-stu-id="9c8de-180">Network security does not allow hello federation metadata toobe publicly available.</span></span>

<span data-ttu-id="9c8de-181">En estos casos, cada vez que actualice los certificados de firma de tokens de hello también debe actualizar el dominio de Office 365 mediante el uso de comandos de PowerShell de hello, Update-MsolFederatedDomain.</span><span class="sxs-lookup"><span data-stu-id="9c8de-181">In these scenarios, every time you update hello token signing certificates, you must also update your Office 365 domain by using hello PowerShell command, Update-MsolFederatedDomain.</span></span>

### <a name="step-1-ensure-that-ad-fs-has-new-token-signing-certificates"></a><span data-ttu-id="9c8de-182">Paso 1: Asegurarse de que AD FS tiene nuevos certificados de firma de tokens</span><span class="sxs-lookup"><span data-stu-id="9c8de-182">Step 1: Ensure that AD FS has new token signing certificates</span></span>
<span data-ttu-id="9c8de-183">**Configuración no predeterminada**</span><span class="sxs-lookup"><span data-stu-id="9c8de-183">**Non-default configuration**</span></span>

<span data-ttu-id="9c8de-184">Si está utilizando una configuración no predeterminada de AD FS (donde **AutoCertificateRollover** se establece demasiado**False**), probablemente esté utilizando certificados personalizados (no autofirmados).</span><span class="sxs-lookup"><span data-stu-id="9c8de-184">If you are using a non-default configuration of AD FS (where **AutoCertificateRollover** is set too**False**), you are probably using custom certificates (not self-signed).</span></span> <span data-ttu-id="9c8de-185">Para obtener más información acerca de cómo toorenew Hola AD FS firma de tokens de certificados, consulte [certificados autofirmados de orientación para los clientes que no usan AD FS](https://msdn.microsoft.com/library/azure/JJ933264.aspx#BKMK_NotADFSCert).</span><span class="sxs-lookup"><span data-stu-id="9c8de-185">For more information about how toorenew hello AD FS token signing certificates, see [Guidance for customers not using AD FS self-signed certificates](https://msdn.microsoft.com/library/azure/JJ933264.aspx#BKMK_NotADFSCert).</span></span>

<span data-ttu-id="9c8de-186">**Los metadatos de federación no están disponibles públicamente**</span><span class="sxs-lookup"><span data-stu-id="9c8de-186">**Federation metadata is not publicly available**</span></span>

<span data-ttu-id="9c8de-187">Hola en otra parte, si **AutoCertificateRollover** se establece demasiado**True**, pero los metadatos de federación no están accesible públicamente, asegúrese de que los certificados de firma de token nuevo que haya generado en AD FS.</span><span class="sxs-lookup"><span data-stu-id="9c8de-187">On hello other hand, if **AutoCertificateRollover** is set too**True**, but your federation metadata is not publicly accessible, first make sure that new token signing certificates have been generated by AD FS.</span></span> <span data-ttu-id="9c8de-188">Confirme que tiene nuevo token de firma de certificados por hello realizar pasos:</span><span class="sxs-lookup"><span data-stu-id="9c8de-188">Confirm you have new token signing certificates by taking hello following steps:</span></span>

1. <span data-ttu-id="9c8de-189">Compruebe que se registran en el servidor de toohello principal de AD FS.</span><span class="sxs-lookup"><span data-stu-id="9c8de-189">Verify that you are logged on toohello primary AD FS server.</span></span>
2. <span data-ttu-id="9c8de-190">Comprobar los certificados de firma actual de hello en AD FS, abra una ventana de comandos de PowerShell y ejecutando el siguiente comando de Hola:</span><span class="sxs-lookup"><span data-stu-id="9c8de-190">Check hello current signing certificates in AD FS by opening a PowerShell command window, and running hello following command:</span></span>

    <span data-ttu-id="9c8de-191">PS C:\>Get-ADFSCertificate –CertificateType token-signing</span><span class="sxs-lookup"><span data-stu-id="9c8de-191">PS C:\>Get-ADFSCertificate –CertificateType token-signing</span></span>

   > [!NOTE]
   > <span data-ttu-id="9c8de-192">Si usa AD FS 2.0, tendrá que ejecutar Add-Pssnapin Microsoft.Adfs.Powershell primero.</span><span class="sxs-lookup"><span data-stu-id="9c8de-192">If you are using AD FS 2.0, you should run Add-Pssnapin Microsoft.Adfs.Powershell first.</span></span>
   >
   >
3. <span data-ttu-id="9c8de-193">Mire el resultado del comando hello en los certificados que se muestran.</span><span class="sxs-lookup"><span data-stu-id="9c8de-193">Look at hello command output at any certificates listed.</span></span> <span data-ttu-id="9c8de-194">Si AD FS ha generado un nuevo certificado, debería ver dos certificados en la salida de hello: uno para qué hello **IsPrimary** valor es **True** hello y **NotAfter** fecha es dentro de 5 días y uno para el que **IsPrimary** es **False** y **NotAfter** es aproximadamente un año en hello futuras.</span><span class="sxs-lookup"><span data-stu-id="9c8de-194">If AD FS has generated a new certificate, you should see two certificates in hello output: one for which hello **IsPrimary** value is **True** and hello **NotAfter** date is within 5 days, and one for which **IsPrimary** is **False** and **NotAfter** is about a year in hello future.</span></span>
4. <span data-ttu-id="9c8de-195">Si solo ve un certificado y Hola **NotAfter** fecha está dentro de 5 días, deberá toogenerate un nuevo certificado.</span><span class="sxs-lookup"><span data-stu-id="9c8de-195">If you only see one certificate, and hello **NotAfter** date is within 5 days, you need toogenerate a new certificate.</span></span>
5. <span data-ttu-id="9c8de-196">toogenerate un nuevo certificado, ejecutar el siguiente comando en un símbolo del sistema de PowerShell de hello: `PS C:\>Update-ADFSCertificate –CertificateType token-signing`.</span><span class="sxs-lookup"><span data-stu-id="9c8de-196">toogenerate a new certificate, execute hello following command at a PowerShell command prompt: `PS C:\>Update-ADFSCertificate –CertificateType token-signing`.</span></span>
6. <span data-ttu-id="9c8de-197">Comprobar Hola actualización ejecutando Hola siguiente nuevo comando: PS C:\>firma de tokens de Get-ADFSCertificate – CertificateType</span><span class="sxs-lookup"><span data-stu-id="9c8de-197">Verify hello update by running hello following command again: PS C:\>Get-ADFSCertificate –CertificateType token-signing</span></span>

<span data-ttu-id="9c8de-198">Ahora deben aparecer dos certificados, uno de los cuales tiene un **NotAfter** fecha de aproximadamente un año en hello futura y para qué hello **IsPrimary** valor es **False**.</span><span class="sxs-lookup"><span data-stu-id="9c8de-198">Two certificates should be listed now, one of which has a **NotAfter** date of approximately one year in hello future, and for which hello **IsPrimary** value is **False**.</span></span>

### <a name="step-2-update-hello-new-token-signing-certificates-for-hello-office-365-trust"></a><span data-ttu-id="9c8de-199">Paso 2: Actualizar el token nuevo de hello firmar los certificados de confianza de hello Office 365</span><span class="sxs-lookup"><span data-stu-id="9c8de-199">Step 2: Update hello new token signing certificates for hello Office 365 trust</span></span>
<span data-ttu-id="9c8de-200">Actualizar Office 365 con hello nuevo token firma certificados toobe destinada confianza hello, como se indica a continuación.</span><span class="sxs-lookup"><span data-stu-id="9c8de-200">Update Office 365 with hello new token signing certificates toobe used for hello trust, as follows.</span></span>

1. <span data-ttu-id="9c8de-201">Abra Hola Microsoft Azure módulo Active Directory para Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="9c8de-201">Open hello Microsoft Azure Active Directory Module for Windows PowerShell.</span></span>
2. <span data-ttu-id="9c8de-202">Ejecute $cred=Get-Credential.</span><span class="sxs-lookup"><span data-stu-id="9c8de-202">Run $cred=Get-Credential.</span></span> <span data-ttu-id="9c8de-203">Cuando este cmdlet le solicite las credenciales, escriba sus credenciales de cuenta de administrador de servicios en la nube.</span><span class="sxs-lookup"><span data-stu-id="9c8de-203">When this cmdlet prompts you for credentials, type your cloud service administrator account credentials.</span></span>
3. <span data-ttu-id="9c8de-204">Ejecute Connect-MsolService –Credential $cred. Este cmdlet conecta toohello servicio en la nube.</span><span class="sxs-lookup"><span data-stu-id="9c8de-204">Run Connect-MsolService –Credential $cred. This cmdlet connects you toohello cloud service.</span></span> <span data-ttu-id="9c8de-205">Crear un contexto que le conecta toohello servicio en la nube es necesario antes de ejecutar cualquiera de hello cmdlets adicionales instalados por la herramienta de Hola.</span><span class="sxs-lookup"><span data-stu-id="9c8de-205">Creating a context that connects you toohello cloud service is required before running any of hello additional cmdlets installed by hello tool.</span></span>
4. <span data-ttu-id="9c8de-206">Si se ejecutan estos comandos en un equipo que no sea servidor de federación principal de hello AD FS, ejecute Set-MSOLAdfscontext-equipo <AD FS primary server>, donde <AD FS primary server> es Hola de nombre de dominio completo interno del servidor de hello principal de AD FS.</span><span class="sxs-lookup"><span data-stu-id="9c8de-206">If you are running these commands on a computer that is not hello AD FS primary federation server, run Set-MSOLAdfscontext -Computer <AD FS primary server>, where <AD FS primary server> is hello internal FQDN name of hello primary AD FS server.</span></span> <span data-ttu-id="9c8de-207">Este cmdlet crea un contexto que le conecta tooAD FS.</span><span class="sxs-lookup"><span data-stu-id="9c8de-207">This cmdlet creates a context that connects you tooAD FS.</span></span>
5. <span data-ttu-id="9c8de-208">Ejecute Update-MSOLFederatedDomain –DomainName <domain>.</span><span class="sxs-lookup"><span data-stu-id="9c8de-208">Run Update-MSOLFederatedDomain –DomainName <domain>.</span></span> <span data-ttu-id="9c8de-209">Este cmdlet actualiza la configuración de Hola de AD FS en servicio de nube de Hola y configura la relación de confianza de hello entre Hola dos.</span><span class="sxs-lookup"><span data-stu-id="9c8de-209">This cmdlet updates hello settings from AD FS into hello cloud service, and configures hello trust relationship between hello two.</span></span>

> [!NOTE]
> <span data-ttu-id="9c8de-210">Si necesita toosupport varios dominios de nivel superior, como contoso.com y fabrikam.com, debe usar hello **SupportMultipleDomain** cambiar con cualquier cmdlet.</span><span class="sxs-lookup"><span data-stu-id="9c8de-210">If you need toosupport multiple top-level domains, such as contoso.com and fabrikam.com, you must use hello **SupportMultipleDomain** switch with any cmdlets.</span></span> <span data-ttu-id="9c8de-211">Para más información, consulte [Support for Multiple Top Level Domains](active-directory-aadconnect-multiple-domains.md)(Compatibilidad con varios dominios de nivel superior).</span><span class="sxs-lookup"><span data-stu-id="9c8de-211">For more information, see [Support for Multiple Top Level Domains](active-directory-aadconnect-multiple-domains.md).</span></span>
>
>

## <span data-ttu-id="9c8de-212">Reparar la relación de confianza de Azure AD con Azure AD Connect <a name="connectrenew"></a></span><span class="sxs-lookup"><span data-stu-id="9c8de-212">Repair Azure AD trust by using Azure AD Connect <a name="connectrenew"></a></span></span>
<span data-ttu-id="9c8de-213">Si configuró la granja de servidores de AD FS y la confianza de Azure AD mediante el uso de Azure AD Connect, puede usar Azure AD Connect toodetect si necesita tootake ninguna acción para los certificados de firma de tokens.</span><span class="sxs-lookup"><span data-stu-id="9c8de-213">If you configured your AD FS farm and Azure AD trust by using Azure AD Connect, you can use Azure AD Connect toodetect if you need tootake any action for your token signing certificates.</span></span> <span data-ttu-id="9c8de-214">Si necesita certificados de hello toorenew, puede usar por lo que toodo de Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="9c8de-214">If you need toorenew hello certificates, you can use Azure AD Connect toodo so.</span></span>

<span data-ttu-id="9c8de-215">Para obtener más información, consulte [reparar confianza hello](active-directory-aadconnect-federation-management.md).</span><span class="sxs-lookup"><span data-stu-id="9c8de-215">For more information, see [Repairing hello trust](active-directory-aadconnect-federation-management.md).</span></span>

---
title: "Renovación de certificados para los usuarios de Office 365 y Azure AD | Microsoft Docs"
description: "Este artículo explica a los usuarios de Office 365 cómo solucionar problemas con mensajes de correo electrónico que informan sobre la renovación de un certificado."
services: active-directory
documentationcenter: 
author: billmath
manager: femila
editor: curtand
ms.assetid: 543b7dc1-ccc9-407f-85a1-a9944c0ba1be
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/12/2017
ms.author: billmath
ms.openlocfilehash: 7f1a3303eff9c413602e745b702baa659343eba6
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/03/2017
---
# <a name="renew-federation-certificates-for-office-365-and-azure-active-directory"></a><span data-ttu-id="ae2b1-103">Renovación de certificados de federación para Office 365 y Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="ae2b1-103">Renew federation certificates for Office 365 and Azure Active Directory</span></span>
## <a name="overview"></a><span data-ttu-id="ae2b1-104">Información general</span><span class="sxs-lookup"><span data-stu-id="ae2b1-104">Overview</span></span>
<span data-ttu-id="ae2b1-105">Para una federación correcta entre Azure Active Directory (Azure AD) y Active Directory Federation Services (AD FS), los certificados usados por AD FS para firmar los tokens de seguridad en Azure AD deben coincidir con lo que está configurado en Azure AD.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-105">For successful federation between Azure Active Directory (Azure AD) and Active Directory Federation Services (AD FS), the certificates used by AD FS to sign security tokens to Azure AD should match what is configured in Azure AD.</span></span> <span data-ttu-id="ae2b1-106">Cualquier error de coincidencia puede provocar la falta de confianza.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-106">Any mismatch can lead to broken trust.</span></span> <span data-ttu-id="ae2b1-107">Azure AD garantiza que esta información se mantiene sincronizada cuando se implementa AD FS y Proxy de aplicación web (para el acceso de extranet).</span><span class="sxs-lookup"><span data-stu-id="ae2b1-107">Azure AD ensures that this information is kept in sync when you deploy AD FS and Web Application Proxy (for extranet access).</span></span>

<span data-ttu-id="ae2b1-108">En este artículo se proporciona información adicional para administrar los certificados de firma de tokens y mantenerlos sincronizados con Azure AD en los casos siguientes:</span><span class="sxs-lookup"><span data-stu-id="ae2b1-108">This article provides you additional information to manage your token signing certificates and keep them in sync with Azure AD, in the following cases:</span></span>

* <span data-ttu-id="ae2b1-109">No implementa el Proxy de aplicación web y, por tanto, los metadatos de federación no están disponibles en la extranet.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-109">You are not deploying the Web Application Proxy, and therefore the federation metadata is not available in the extranet.</span></span>
* <span data-ttu-id="ae2b1-110">No utiliza la configuración predeterminada de AD FS para los certificados de firma de tokens.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-110">You are not using the default configuration of AD FS for token signing certificates.</span></span>
* <span data-ttu-id="ae2b1-111">Utiliza un proveedor de identidades de terceros.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-111">You are using a third-party identity provider.</span></span>

## <a name="default-configuration-of-ad-fs-for-token-signing-certificates"></a><span data-ttu-id="ae2b1-112">Configuración predeterminada de AD FS para los certificados de firma de tokens</span><span class="sxs-lookup"><span data-stu-id="ae2b1-112">Default configuration of AD FS for token signing certificates</span></span>
<span data-ttu-id="ae2b1-113">La firma de tokens y los certificados de descifrado de tokens son normalmente certificados autofirmados y son válidos durante un año.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-113">The token signing and token decrypting certificates are usually self-signed certificates, and are good for one year.</span></span> <span data-ttu-id="ae2b1-114">De forma predeterminada, AD FS incluye un proceso de renovación automática llamado **AutoCertificateRollover**.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-114">By default, AD FS includes an auto-renewal process called **AutoCertificateRollover**.</span></span> <span data-ttu-id="ae2b1-115">Si utiliza AD FS 2.0 o versiones posteriores, Office 365 y Azure AD actualizan automáticamente el certificado antes de que expire.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-115">If you are using AD FS 2.0 or later, Office 365 and Azure AD automatically update your certificate before it expires.</span></span>

### <a name="renewal-notification-from-the-office-365-portal-or-an-email"></a><span data-ttu-id="ae2b1-116">Notificación de renovación desde el portal de Office 365 o por correo electrónico</span><span class="sxs-lookup"><span data-stu-id="ae2b1-116">Renewal notification from the Office 365 portal or an email</span></span>
> [!NOTE]
> <span data-ttu-id="ae2b1-117">Si recibe un correo electrónico o una notificación del portal que le solicita renovar el certificado de Office, consulte la sección de [administración de cambios en los certificados de firma de tokens](#managecerts) para comprobar si es necesario realizar alguna acción.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-117">If you received an email or a portal notification asking you to renew your certificate for Office, see [Managing changes to token signing certificates](#managecerts) to check if you need to take any action.</span></span> <span data-ttu-id="ae2b1-118">Microsoft tiene constancia de un posible problema que puede dar lugar a notificaciones enviadas para la renovación de certificados, incluso cuando no se requiere ninguna acción.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-118">Microsoft is aware of a possible issue that can lead to notifications for certificate renewal being sent, even when no action is required.</span></span>
>
>

<span data-ttu-id="ae2b1-119">Azure AD intenta supervisar los metadatos de federación y actualizar el token de firma de certificados, tal como indican sus metadatos.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-119">Azure AD attempts to monitor the federation metadata, and update the token signing certificates as indicated by this metadata.</span></span> <span data-ttu-id="ae2b1-120">30 días antes de la expiración de los certificados de firma de tokens, Azure AD comprobará si los certificados nuevos están disponibles mediante el sondeo de los metadatos de federación.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-120">30 days before the expiration of the token signing certificates, Azure AD checks if new certificates are available by polling the federation metadata.</span></span>

* <span data-ttu-id="ae2b1-121">Si puede sondear los metadatos de federación y recuperar los nuevos certificados correctamente, no se enviará al usuario ninguna notificación por correo electrónico ni ninguna advertencia de portal de Office 365.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-121">If it can successfully poll the federation metadata and retrieve the new certificates, no email notification or warning in the Office 365 portal is issued to the user.</span></span>
* <span data-ttu-id="ae2b1-122">Si no se pueden recuperar los nuevos certificados de firma de tokens, ya sea porque los metadatos de federación no son accesibles o porque no está habilitada la sustitución automática de certificados, Azure AD emitirá una notificación de correo electrónico y una advertencia en el portal de Office 365.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-122">If it cannot retrieve the new token signing certificates, either because the federation metadata is not reachable or automatic certificate rollover is not enabled, Azure AD issues an email notification and a warning in the Office 365 portal.</span></span>

![Notificación del portal de Office 365](./media/active-directory-aadconnect-o365-certs/notification.png)

> [!IMPORTANT]
> <span data-ttu-id="ae2b1-124">Si utiliza AD FS, para garantizar la continuidad del negocio, compruebe que los servidores tienen las actualizaciones siguientes para que no se produzcan errores de autenticación de los problemas conocidos.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-124">If you are using AD FS, to ensure business continuity, please verify that your servers have the following updates so that authentication failures for known issues do not occur.</span></span> <span data-ttu-id="ae2b1-125">Esta acción mitiga los problemas conocidos del servidor de proxy de AD FS para esta renovación y períodos de renovación futuros:</span><span class="sxs-lookup"><span data-stu-id="ae2b1-125">This mitigates known AD FS proxy server issues for this renewal and future renewal periods:</span></span>
>
> <span data-ttu-id="ae2b1-126">Server 2012 R2: [paquete acumulativo de mayo de 2014 de Windows Server](http://support.microsoft.com/kb/2955164)</span><span class="sxs-lookup"><span data-stu-id="ae2b1-126">Server 2012 R2 - [Windows Server May 2014 rollup](http://support.microsoft.com/kb/2955164)</span></span>
>
> <span data-ttu-id="ae2b1-127">Server 2008 R2 y 2012: [Se produce un error en la autenticación a través de proxy en Windows Server 2012 o Windows Server 2008 R2 SP1](http://support.microsoft.com/kb/3094446)</span><span class="sxs-lookup"><span data-stu-id="ae2b1-127">Server 2008 R2 and 2012 - [Authentication through proxy fails in Windows Server 2012 or Windows 2008 R2 SP1](http://support.microsoft.com/kb/3094446)</span></span>
>
>

## <span data-ttu-id="ae2b1-128">Compruebe si los certificados necesitan actualización <a name="managecerts"></a></span><span class="sxs-lookup"><span data-stu-id="ae2b1-128">Check if the certificates need to be updated <a name="managecerts"></a></span></span>
### <a name="step-1-check-the-autocertificaterollover-state"></a><span data-ttu-id="ae2b1-129">Paso 1: Comprobar el estado del proceso AutoCertificateRollover</span><span class="sxs-lookup"><span data-stu-id="ae2b1-129">Step 1: Check the AutoCertificateRollover state</span></span>
<span data-ttu-id="ae2b1-130">En el servidor de AD FS, abra Powershell.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-130">On your AD FS server, open PowerShell.</span></span> <span data-ttu-id="ae2b1-131">Compruebe que el valor AutoCertRollover está establecido en True.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-131">Check that the AutoCertificateRollover value is set to True.</span></span>

    Get-Adfsproperties

![AutoCertificateRollover](./media/active-directory-aadconnect-o365-certs/autocertrollover.png)

>[!NOTE] 
><span data-ttu-id="ae2b1-133">Si usa AD FS 2.0, ejecute primero Add-Pssnapin Microsoft.Adfs.Powershell.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-133">If you are using AD FS 2.0, first run Add-Pssnapin Microsoft.Adfs.Powershell.</span></span>

### <a name="step-2-confirm-that-ad-fs-and-azure-ad-are-in-sync"></a><span data-ttu-id="ae2b1-134">Paso 2: Confirmar que AD FS y Azure AD están sincronizados</span><span class="sxs-lookup"><span data-stu-id="ae2b1-134">Step 2: Confirm that AD FS and Azure AD are in sync</span></span>
<span data-ttu-id="ae2b1-135">En el servidor de AD FS, abra el símbolo del sistema de Azure AD Powershell y conéctese a Azure AD.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-135">On your AD FS server, open the Azure AD PowerShell prompt, and connect to Azure AD.</span></span>

> [!NOTE]
> <span data-ttu-id="ae2b1-136">Puede descargar Azure AD PowerShell [aquí](https://technet.microsoft.com/library/jj151815.aspx).</span><span class="sxs-lookup"><span data-stu-id="ae2b1-136">You can download Azure AD PowerShell [here](https://technet.microsoft.com/library/jj151815.aspx).</span></span>
>
>

    Connect-MsolService

<span data-ttu-id="ae2b1-137">Compruebe que los certificados configurados en AD FS y Azure AD confían en las propiedades para el dominio especificado.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-137">Check the certificates configured in AD FS and Azure AD trust properties for the specified domain.</span></span>

    Get-MsolFederationProperty -DomainName <domain.name> | FL Source, TokenSigningCertificate

![Get-MsolFederationProperty](./media/active-directory-aadconnect-o365-certs/certsync.png)

<span data-ttu-id="ae2b1-139">Si las huellas digitales en ambas salidas coinciden, los certificados están sincronizados con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-139">If the thumbprints in both the outputs match, your certificates are in sync with Azure AD.</span></span>

### <a name="step-3-check-if-your-certificate-is-about-to-expire"></a><span data-ttu-id="ae2b1-140">Paso 3: Comprobar si el certificado está a punto de expirar</span><span class="sxs-lookup"><span data-stu-id="ae2b1-140">Step 3: Check if your certificate is about to expire</span></span>
<span data-ttu-id="ae2b1-141">En la salida de Get-MsolFederationProperty o Get-AdfsCertificate compruebe la fecha en "Not After".</span><span class="sxs-lookup"><span data-stu-id="ae2b1-141">In the output of either Get-MsolFederationProperty or Get-AdfsCertificate, check for the date under "Not After."</span></span> <span data-ttu-id="ae2b1-142">Si la fecha es inferior a 30 días, debe tomar medidas.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-142">If the date is less than 30 days away, you should take action.</span></span>

| <span data-ttu-id="ae2b1-143">AutoCertificateRollover</span><span class="sxs-lookup"><span data-stu-id="ae2b1-143">AutoCertificateRollover</span></span> | <span data-ttu-id="ae2b1-144">Certificados sincronizados con Azure AD</span><span class="sxs-lookup"><span data-stu-id="ae2b1-144">Certificates in sync with Azure AD</span></span> | <span data-ttu-id="ae2b1-145">Los metadatos de federación están disponibles públicamente</span><span class="sxs-lookup"><span data-stu-id="ae2b1-145">Federation metadata is publicly accessible</span></span> | <span data-ttu-id="ae2b1-146">Validez</span><span class="sxs-lookup"><span data-stu-id="ae2b1-146">Validity</span></span> | <span data-ttu-id="ae2b1-147">Acción</span><span class="sxs-lookup"><span data-stu-id="ae2b1-147">Action</span></span> |
|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="ae2b1-148">Sí</span><span class="sxs-lookup"><span data-stu-id="ae2b1-148">Yes</span></span> |<span data-ttu-id="ae2b1-149">Sí</span><span class="sxs-lookup"><span data-stu-id="ae2b1-149">Yes</span></span> |<span data-ttu-id="ae2b1-150">Sí</span><span class="sxs-lookup"><span data-stu-id="ae2b1-150">Yes</span></span> |- |<span data-ttu-id="ae2b1-151">No se requiere ninguna acción.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-151">No action needed.</span></span> <span data-ttu-id="ae2b1-152">Consulte [Renovación automática de certificados de firma de tokens](#autorenew).</span><span class="sxs-lookup"><span data-stu-id="ae2b1-152">See [Renew token signing certificate automatically](#autorenew).</span></span> |
| <span data-ttu-id="ae2b1-153">Sí</span><span class="sxs-lookup"><span data-stu-id="ae2b1-153">Yes</span></span> |<span data-ttu-id="ae2b1-154">No</span><span class="sxs-lookup"><span data-stu-id="ae2b1-154">No</span></span> |- |<span data-ttu-id="ae2b1-155">Menos de 15 días</span><span class="sxs-lookup"><span data-stu-id="ae2b1-155">Less than 15 days</span></span> |<span data-ttu-id="ae2b1-156">Renovar inmediatamente.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-156">Renew immediately.</span></span> <span data-ttu-id="ae2b1-157">Consulte [Renovación manual de certificados de firma de tokens](#manualrenew).</span><span class="sxs-lookup"><span data-stu-id="ae2b1-157">See [Renew token signing certificate manually](#manualrenew).</span></span> |
| <span data-ttu-id="ae2b1-158">No</span><span class="sxs-lookup"><span data-stu-id="ae2b1-158">No</span></span> |- |- |<span data-ttu-id="ae2b1-159">Menos de 30 días</span><span class="sxs-lookup"><span data-stu-id="ae2b1-159">Less than 30 days</span></span> |<span data-ttu-id="ae2b1-160">Renovar inmediatamente.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-160">Renew immediately.</span></span> <span data-ttu-id="ae2b1-161">Consulte [Renovación manual de certificados de firma de tokens](#manualrenew).</span><span class="sxs-lookup"><span data-stu-id="ae2b1-161">See [Renew token signing certificate manually](#manualrenew).</span></span> |

<span data-ttu-id="ae2b1-162">\[-] No importa</span><span class="sxs-lookup"><span data-stu-id="ae2b1-162">\[-]  Does not matter</span></span>

## <span data-ttu-id="ae2b1-163">Renovación automática de certificados de firma de tokens (recomendado) <a name="autorenew"></a></span><span class="sxs-lookup"><span data-stu-id="ae2b1-163">Renew the token signing certificate automatically (recommended) <a name="autorenew"></a></span></span>
<span data-ttu-id="ae2b1-164">No es necesario realizar ningún paso manual si se cumplen las dos acciones siguientes:</span><span class="sxs-lookup"><span data-stu-id="ae2b1-164">You don't need to perform any manual steps if both of the following are true:</span></span>

* <span data-ttu-id="ae2b1-165">Se ha implementado el proxy de aplicación web, que puede habilitar el acceso a los metadatos de federación desde la extranet.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-165">You have deployed Web Application Proxy, which can enable access to the federation metadata from the extranet.</span></span>
* <span data-ttu-id="ae2b1-166">Utiliza la configuración predeterminada de AD FS (AutoCertificateRollover está habilitado).</span><span class="sxs-lookup"><span data-stu-id="ae2b1-166">You are using the AD FS default configuration (AutoCertificateRollover is enabled).</span></span>

<span data-ttu-id="ae2b1-167">Compruebe lo siguiente para confirmar que se puede actualizar el certificado automáticamente:</span><span class="sxs-lookup"><span data-stu-id="ae2b1-167">Check the following to confirm that the certificate can be automatically updated.</span></span>

<span data-ttu-id="ae2b1-168">**1. La propiedad AutoCertificateRollover de AD FS debe establecerse en True.**</span><span class="sxs-lookup"><span data-stu-id="ae2b1-168">**1. The AD FS property AutoCertificateRollover must be set to True.**</span></span> <span data-ttu-id="ae2b1-169">Esto indica que AD FS generará automáticamente nuevos certificados de descifrado de tokens y de firma de tokens antes de que expiren los antiguos.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-169">This indicates that AD FS will automatically generate new token signing and token decryption certificates, before the old ones expire.</span></span>

<span data-ttu-id="ae2b1-170">**2. Los metadatos de federación de AD FS están disponibles públicamente.**</span><span class="sxs-lookup"><span data-stu-id="ae2b1-170">**2. The AD FS federation metadata is publicly accessible.**</span></span> <span data-ttu-id="ae2b1-171">Compruebe que se puede obtener acceso públicamente a los metadatos de federación, desplácese hasta la siguiente dirección URL desde un equipo de la red de Internet pública (fuera de la red corporativa):</span><span class="sxs-lookup"><span data-stu-id="ae2b1-171">Check that your federation metadata is publicly accessible by navigating to the following URL from a computer on the public internet (off of the corporate network):</span></span>

<span data-ttu-id="ae2b1-172">https://(your_FS_name)/federationmetadata/2007-06/federationmetadata.xml</span><span class="sxs-lookup"><span data-stu-id="ae2b1-172">https://(your_FS_name)/federationmetadata/2007-06/federationmetadata.xml</span></span>

<span data-ttu-id="ae2b1-173">donde `(your_FS_name) `se reemplaza por el nombre de host de servicio de federación que usa su organización, por ejemplo, fs.contoso.com.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-173">where `(your_FS_name) `is replaced with the federation service host name your organization uses, such as fs.contoso.com.</span></span>  <span data-ttu-id="ae2b1-174">Si es capaz de comprobar ambos de estos valores correctamente, no tiene que hacer nada más.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-174">If you are able to verify both of these settings successfully, you do not have to do anything else.</span></span>  

<span data-ttu-id="ae2b1-175">Ejemplo: https://fs.contoso.com/federationmetadata/2007-06/federationmetadata.xml</span><span class="sxs-lookup"><span data-stu-id="ae2b1-175">Example: https://fs.contoso.com/federationmetadata/2007-06/federationmetadata.xml</span></span>

## <span data-ttu-id="ae2b1-176">Renovación manual de certificados de firma de tokens <a name="manualrenew"></a></span><span class="sxs-lookup"><span data-stu-id="ae2b1-176">Renew the token signing certificate manually <a name="manualrenew"></a></span></span>
<span data-ttu-id="ae2b1-177">Puede optar por renovar manualmente los certificados de firma de tokens.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-177">You may choose to renew the token signing certificates manually.</span></span> <span data-ttu-id="ae2b1-178">Por ejemplo, los siguientes escenarios podrían funcionar mejor para la renovación manual:</span><span class="sxs-lookup"><span data-stu-id="ae2b1-178">For example, the following scenarios might work better for manual renewal:</span></span>

* <span data-ttu-id="ae2b1-179">Los certificados de firma de tokens no son certificados autofirmados.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-179">Token signing certificates are not self-signed certificates.</span></span> <span data-ttu-id="ae2b1-180">La razón más común es que su organización administra certificados de AD FS inscritos de una entidad de certificación profesional.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-180">The most common reason for this is that your organization manages AD FS certificates enrolled from an organizational certificate authority.</span></span>
* <span data-ttu-id="ae2b1-181">La seguridad de red no permite que los metadatos de federación estén disponibles públicamente.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-181">Network security does not allow the federation metadata to be publicly available.</span></span>

<span data-ttu-id="ae2b1-182">En estos escenarios, cada vez que actualice los certificados de firma de tokens, debe actualizar también el dominio de Office 365 con el comando de PowerShell Update-MsolFederatedDomain.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-182">In these scenarios, every time you update the token signing certificates, you must also update your Office 365 domain by using the PowerShell command, Update-MsolFederatedDomain.</span></span>

### <a name="step-1-ensure-that-ad-fs-has-new-token-signing-certificates"></a><span data-ttu-id="ae2b1-183">Paso 1: Asegurarse de que AD FS tiene nuevos certificados de firma de tokens</span><span class="sxs-lookup"><span data-stu-id="ae2b1-183">Step 1: Ensure that AD FS has new token signing certificates</span></span>
<span data-ttu-id="ae2b1-184">**Configuración no predeterminada**</span><span class="sxs-lookup"><span data-stu-id="ae2b1-184">**Non-default configuration**</span></span>

<span data-ttu-id="ae2b1-185">Si está en una configuración no predeterminada de AD FS donde la propiedad **AutoCertificateRollover** está establecida en **False**, probablemente esté utilizando certificados personalizados (no autofirmados).</span><span class="sxs-lookup"><span data-stu-id="ae2b1-185">If you are using a non-default configuration of AD FS (where **AutoCertificateRollover** is set to **False**), you are probably using custom certificates (not self-signed).</span></span> <span data-ttu-id="ae2b1-186">Para más información sobre cómo renovar los certificados de firma de tokens de AD FS, consulte la [guía para clientes que no usan certificados autofirmados AD FS](https://msdn.microsoft.com/library/azure/JJ933264.aspx#BKMK_NotADFSCert).</span><span class="sxs-lookup"><span data-stu-id="ae2b1-186">For more information about how to renew the AD FS token signing certificates, see [Guidance for customers not using AD FS self-signed certificates](https://msdn.microsoft.com/library/azure/JJ933264.aspx#BKMK_NotADFSCert).</span></span>

<span data-ttu-id="ae2b1-187">**Los metadatos de federación no están disponibles públicamente**</span><span class="sxs-lookup"><span data-stu-id="ae2b1-187">**Federation metadata is not publicly available**</span></span>

<span data-ttu-id="ae2b1-188">Por otro lado si la propiedad **AutoCertificateRollover** está establecida en **True** pero los metadatos de federación no están disponibles públicamente, asegúrese primero de que los certificados de firma de tokens nuevos los ha generado AD FS.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-188">On the other hand, if **AutoCertificateRollover** is set to **True**, but your federation metadata is not publicly accessible, first make sure that new token signing certificates have been generated by AD FS.</span></span> <span data-ttu-id="ae2b1-189">Siga los pasos siguientes para confirmar que dispone de nuevos certificados de firma de tokens.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-189">Confirm you have new token signing certificates by taking the following steps:</span></span>

1. <span data-ttu-id="ae2b1-190">Compruebe que la sesión en el servidor de AD FS principal está iniciada.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-190">Verify that you are logged on to the primary AD FS server.</span></span>
2. <span data-ttu-id="ae2b1-191">Compruebe los certificados de firma actuales en AD FS abriendo una ventana de comandos de PowerShell y ejecutando el siguiente comando:</span><span class="sxs-lookup"><span data-stu-id="ae2b1-191">Check the current signing certificates in AD FS by opening a PowerShell command window, and running the following command:</span></span>

    <span data-ttu-id="ae2b1-192">PS C:\>Get-ADFSCertificate –CertificateType token-signing</span><span class="sxs-lookup"><span data-stu-id="ae2b1-192">PS C:\>Get-ADFSCertificate –CertificateType token-signing</span></span>

   > [!NOTE]
   > <span data-ttu-id="ae2b1-193">Si usa AD FS 2.0, tendrá que ejecutar Add-Pssnapin Microsoft.Adfs.Powershell primero.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-193">If you are using AD FS 2.0, you should run Add-Pssnapin Microsoft.Adfs.Powershell first.</span></span>
   >
   >
3. <span data-ttu-id="ae2b1-194">Examine la salida del comando en los certificados que se muestran.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-194">Look at the command output at any certificates listed.</span></span> <span data-ttu-id="ae2b1-195">Si AD FS ha generado un nuevo certificado, debería ver dos certificados en la salida: uno para el que el valor de **IsPrimary** es **True** y la fecha de **NotAfter** está dentro de 5 días y uno para el que **IsPrimary** es **False** y **NotAfter** es aproximadamente un año en el futuro.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-195">If AD FS has generated a new certificate, you should see two certificates in the output: one for which the **IsPrimary** value is **True** and the **NotAfter** date is within 5 days, and one for which **IsPrimary** is **False** and **NotAfter** is about a year in the future.</span></span>
4. <span data-ttu-id="ae2b1-196">Si solo ve un certificado y la fecha de **NotAfter** está dentro de 5 días, deberá generar un nuevo certificado.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-196">If you only see one certificate, and the **NotAfter** date is within 5 days, you need to generate a new certificate.</span></span>
5. <span data-ttu-id="ae2b1-197">Para generar un nuevo certificado, ejecute el siguiente comando en un símbolo del sistema de PowerShell: `PS C:\>Update-ADFSCertificate –CertificateType token-signing`.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-197">To generate a new certificate, execute the following command at a PowerShell command prompt: `PS C:\>Update-ADFSCertificate –CertificateType token-signing`.</span></span>
6. <span data-ttu-id="ae2b1-198">Compruebe la actualización ejecutando de nuevo el comando siguiente: PS C:\>Get-ADFSCertificate –CertificateType token-signing</span><span class="sxs-lookup"><span data-stu-id="ae2b1-198">Verify the update by running the following command again: PS C:\>Get-ADFSCertificate –CertificateType token-signing</span></span>

<span data-ttu-id="ae2b1-199">Ahora deben aparecer dos certificados, uno de los cuales tiene una fecha de **NotAfter** de aproximadamente un año en el futuro y para el que el valor de **IsPrimary** es **False**.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-199">Two certificates should be listed now, one of which has a **NotAfter** date of approximately one year in the future, and for which the **IsPrimary** value is **False**.</span></span>

### <a name="step-2-update-the-new-token-signing-certificates-for-the-office-365-trust"></a><span data-ttu-id="ae2b1-200">Paso 2: Actualizar los nuevos certificados de firma de tokens para la relación de confianza de Office 365</span><span class="sxs-lookup"><span data-stu-id="ae2b1-200">Step 2: Update the new token signing certificates for the Office 365 trust</span></span>
<span data-ttu-id="ae2b1-201">Actualice Office 365 con los nuevos certificados de firma de token que se utilizarán para la relación de confianza, tal como se indica a continuación.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-201">Update Office 365 with the new token signing certificates to be used for the trust, as follows.</span></span>

1. <span data-ttu-id="ae2b1-202">Abra el módulo Microsoft Azure Active Directory para Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-202">Open the Microsoft Azure Active Directory Module for Windows PowerShell.</span></span>
2. <span data-ttu-id="ae2b1-203">Ejecute $cred=Get-Credential.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-203">Run $cred=Get-Credential.</span></span> <span data-ttu-id="ae2b1-204">Cuando este cmdlet le solicite las credenciales, escriba sus credenciales de cuenta de administrador de servicios en la nube.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-204">When this cmdlet prompts you for credentials, type your cloud service administrator account credentials.</span></span>
3. <span data-ttu-id="ae2b1-205">Ejecute Connect-MsolService –Credential $cred.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-205">Run Connect-MsolService –Credential $cred.</span></span> <span data-ttu-id="ae2b1-206">Este cmdlet le permite conectarse al servicio en la nube.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-206">This cmdlet connects you to the cloud service.</span></span> <span data-ttu-id="ae2b1-207">Es necesario crear un contexto que le permita conectarse con el servicio en la nube antes de ejecutar cualquiera de los cmdlets adicionales que instala la herramienta.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-207">Creating a context that connects you to the cloud service is required before running any of the additional cmdlets installed by the tool.</span></span>
4. <span data-ttu-id="ae2b1-208">Si ejecuta estos comandos en un equipo que no sea el servidor de federación principal de AD FS, ejecute Set-MSOLAdfscontext -Computer <AD FS primary server>, donde <AD FS primary server> es el nombre de dominio completo interno del servidor de AD FS principal.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-208">If you are running these commands on a computer that is not the AD FS primary federation server, run Set-MSOLAdfscontext -Computer <AD FS primary server>, where <AD FS primary server> is the internal FQDN name of the primary AD FS server.</span></span> <span data-ttu-id="ae2b1-209">Este cmdlet crea un contexto que le permite conectarse a AD FS.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-209">This cmdlet creates a context that connects you to AD FS.</span></span>
5. <span data-ttu-id="ae2b1-210">Ejecute Update-MSOLFederatedDomain –DomainName <domain>.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-210">Run Update-MSOLFederatedDomain –DomainName <domain>.</span></span> <span data-ttu-id="ae2b1-211">Este cmdlet actualiza la configuración de AD FS en el servicio en la nube y configura la relación de confianza entre los dos.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-211">This cmdlet updates the settings from AD FS into the cloud service, and configures the trust relationship between the two.</span></span>

> [!NOTE]
> <span data-ttu-id="ae2b1-212">Si necesita admitir varios dominios de nivel superior, por ejemplo, contoso.com y fabrikam.com, debe utilizar el modificador **SupportMultipleDomain** con cualquier cmdlet.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-212">If you need to support multiple top-level domains, such as contoso.com and fabrikam.com, you must use the **SupportMultipleDomain** switch with any cmdlets.</span></span> <span data-ttu-id="ae2b1-213">Para más información, consulte [Support for Multiple Top Level Domains](active-directory-aadconnect-multiple-domains.md)(Compatibilidad con varios dominios de nivel superior).</span><span class="sxs-lookup"><span data-stu-id="ae2b1-213">For more information, see [Support for Multiple Top Level Domains](active-directory-aadconnect-multiple-domains.md).</span></span>
>
>

## <span data-ttu-id="ae2b1-214">Reparar la relación de confianza de Azure AD con Azure AD Connect <a name="connectrenew"></a></span><span class="sxs-lookup"><span data-stu-id="ae2b1-214">Repair Azure AD trust by using Azure AD Connect <a name="connectrenew"></a></span></span>
<span data-ttu-id="ae2b1-215">Si ha configurado la granja de servidores de AD FS o la relación de confianza de Azure AD con Azure AD Connect, puede usar Azure AD Connect para detectar si es necesario tomar alguna medida para los certificados de firma de tokens.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-215">If you configured your AD FS farm and Azure AD trust by using Azure AD Connect, you can use Azure AD Connect to detect if you need to take any action for your token signing certificates.</span></span> <span data-ttu-id="ae2b1-216">Si necesita renovar los certificados, puede utilizar Azure AD Connect para hacerlo.</span><span class="sxs-lookup"><span data-stu-id="ae2b1-216">If you need to renew the certificates, you can use Azure AD Connect to do so.</span></span>

<span data-ttu-id="ae2b1-217">Para más información, consulte la sección [Reparación de la confianza](active-directory-aadconnect-federation-management.md).</span><span class="sxs-lookup"><span data-stu-id="ae2b1-217">For more information, see [Repairing the trust](active-directory-aadconnect-federation-management.md).</span></span>

---
title: "Azure AD Connect: uso de un proveedor de identidades de SAML 2.0 para el inicio de sesión único | Microsoft Docs"
description: "En este tema se describe el uso de un IdP compatible con SAML 2.0 para el inicio de sesión único."
services: active-directory
author: billmath
manager: femila
ms.custom: it-pro
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/13/2017
ms.author: billmath
ms.openlocfilehash: 048697f87383662506fb851bb3ea510c2cddf043
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/03/2017
---
#  <a name="use-a-saml-20-identity-provider-idp-for-single-sign-on"></a><span data-ttu-id="b9303-103">Uso de un proveedor de identidades (IdP) de SAML 2.0 para el inicio de sesión único</span><span class="sxs-lookup"><span data-stu-id="b9303-103">Use a SAML 2.0 Identity Provider (IdP) for Single Sign On</span></span>

<span data-ttu-id="b9303-104">Este tema contiene información sobre el uso de un proveedor de identidades basado en un perfil de SP-Lite y compatible con SAML 2.0 como proveedor de identidades o servicio de token de seguridad (STS) preferido.</span><span class="sxs-lookup"><span data-stu-id="b9303-104">This topic contains information on using a SAML 2.0 compliant SP-Lite profile based Identity Provider as the preferred Security Token Service (STS) / identity provider.</span></span> <span data-ttu-id="b9303-105">Esta solución resulta útil si ya tiene un directorio de usuario y un almacén de contraseñas local a los que se puede acceder mediante SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="b9303-105">This is useful where you already have a user directory and password store on-premises that can be accessed using SAML 2.0.</span></span> <span data-ttu-id="b9303-106">Este directorio de usuario existente se puede usar para iniciar sesión en Office 365 y otros recursos protegidos por Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b9303-106">This existing user directory can be used for sign-on to Office 365 and other Azure AD-secured resources.</span></span> <span data-ttu-id="b9303-107">El perfil SP-Lite de SAML 2.0 se basa en el estándar de identidad federada del lenguaje de marcado de aserción de seguridad (SAML) de uso generalizado y proporciona un marco de inicio de sesión e intercambio de atributos.</span><span class="sxs-lookup"><span data-stu-id="b9303-107">The SAML 2.0 SP-Lite profile is based on the widely used Security Assertion Markup Language (SAML) federated identity standard to provide a sign-on and attribute exchange framework.</span></span>

>[!NOTE]
><span data-ttu-id="b9303-108">Para obtener una lista de Idp de terceros cuyo uso se ha probado con Azure AD, consulte la [lista de compatibilidad de federación de Azure AD](active-directory-aadconnect-federation-compatibility.md).</span><span class="sxs-lookup"><span data-stu-id="b9303-108">For a list of 3rd party Idps that have been tested for use with Azure AD see the [Azure AD federation compatibility list](active-directory-aadconnect-federation-compatibility.md)</span></span>

<span data-ttu-id="b9303-109">Microsoft admite esta experiencia de inicio de sesión único como la integración de un servicio en la nube de Microsoft, como Office 365, con el Idp basado en el perfil de SAML 2.0 configurado.</span><span class="sxs-lookup"><span data-stu-id="b9303-109">Microsoft supports this sign-on experience as the integration of a Microsoft cloud service, such as Office 365, with your properly configured SAML 2.0 profile based IdP.</span></span> <span data-ttu-id="b9303-110">Dado que los proveedores de identidades de SAML 2.0 son productos de terceros, Microsoft no proporciona soporte técnico con la implementación, la configuración y los procedimientos recomendados de solución de problemas en relación a ellos.</span><span class="sxs-lookup"><span data-stu-id="b9303-110">SAML 2.0 identity providers are third-party products and therefore Microsoft does not provide support for the deployment, configuration, troubleshooting best practices regarding them.</span></span> <span data-ttu-id="b9303-111">Una vez configurada adecuadamente, se puede probar la integración con el proveedor de identidades de SAML 2.0 para ver si es correcta mediante la herramienta Analizador de conectividad de Microsoft que se describe con más detalle a continuación.</span><span class="sxs-lookup"><span data-stu-id="b9303-111">Once properly configured, the integration with the SAML 2.0 identity provider can be tested for proper configuration by using the Microsoft Connectivity Analyzer Tool which is described in more detail below.</span></span> <span data-ttu-id="b9303-112">Para más información sobre el proveedor de identidades basado en un perfil SP-Lite de SAML 2.0, consulte con la organización que lo suministra.</span><span class="sxs-lookup"><span data-stu-id="b9303-112">For more information about your SAML 2.0 SP-Lite profile based identity provider, ask the organization that supplied it.</span></span>

>[!IMPORTANT]
><span data-ttu-id="b9303-113">Solo un conjunto limitado de clientes están disponibles en este escenario de inicio de sesión con proveedores de identidades de SAML 2.0, entre los que se incluyen:</span><span class="sxs-lookup"><span data-stu-id="b9303-113">Only a limited set of clients are available in this sign-on scenario with SAML 2.0 identity providers, this includes:</span></span>

>- <span data-ttu-id="b9303-114">Clientes basados en web como Outlook Web Access y SharePoint Online</span><span class="sxs-lookup"><span data-stu-id="b9303-114">Web-based clients such as Outlook Web Access and SharePoint Online</span></span>
- <span data-ttu-id="b9303-115">Clientes enriquecidos para el correo electrónico que usan autenticación básica y un método de acceso de Exchange compatible, como IMAP, POP, Active Sync, MAPI, etc. (es necesario implementar el protocolo de cliente mejorado), entre los que se incluyen:</span><span class="sxs-lookup"><span data-stu-id="b9303-115">Email-rich clients that use basic authentication and a supported Exchange access method such as IMAP, POP, Active Sync, MAPI, etc. (the Enhanced Client Protocol end point is required to be deployed), including:</span></span>
    - <span data-ttu-id="b9303-116">Microsoft Outlook 2010, Outlook 2013, Outlook 2016, iPhone de Apple (distintas versiones de iOS)</span><span class="sxs-lookup"><span data-stu-id="b9303-116">Microsoft Outlook 2010/Outlook 2013/Outlook 2016, Apple iPhone (various iOS versions)</span></span>
    - <span data-ttu-id="b9303-117">Varios dispositivos de Android de Google</span><span class="sxs-lookup"><span data-stu-id="b9303-117">Various Google Android Devices</span></span>
    - <span data-ttu-id="b9303-118">Windows Phone 7, Windows Phone 7.8 y Windows Phone 8.0</span><span class="sxs-lookup"><span data-stu-id="b9303-118">Windows Phone 7, Windows Phone 7.8, and Windows Phone 8.0</span></span>
    - <span data-ttu-id="b9303-119">Cliente de correo de Windows 8 y Windows 8.1</span><span class="sxs-lookup"><span data-stu-id="b9303-119">Windows 8 Mail Client and Windows 8.1 Mail Client</span></span>
    - <span data-ttu-id="b9303-120">Cliente de correo de Windows 10</span><span class="sxs-lookup"><span data-stu-id="b9303-120">Windows 10 Mail Client</span></span>

<span data-ttu-id="b9303-121">Todos los demás clientes no están disponibles en este escenario de inicio de sesión con el proveedor de identidades de SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="b9303-121">All other clients are not available in this sign-on scenario with your SAML 2.0 Identity Provider.</span></span> <span data-ttu-id="b9303-122">Por ejemplo, el cliente de escritorio Lync 2010 no es capaz de iniciar sesión en el servicio con el proveedor de identidades de SAML 2.0 configurado para el inicio de sesión único.</span><span class="sxs-lookup"><span data-stu-id="b9303-122">For example, the Lync 2010 desktop client is not able to login into the service with your SAML 2.0 Identity Provider configured for single sign-on.</span></span>

## <a name="azure-ad-saml-20-protocol-requirements"></a><span data-ttu-id="b9303-123">Requisitos del protocolo SAML 2.0 de Azure AD</span><span class="sxs-lookup"><span data-stu-id="b9303-123">Azure AD SAML 2.0 protocol requirements</span></span>
<span data-ttu-id="b9303-124">Este tema contiene los requisitos detallados sobre el protocolo y el formato de mensaje que debe implementar su proveedor de identidades de SAML 2.0 para la federación con Azure AD a fin de habilitar el inicio de sesión en uno o varios servicios en la nube de Microsoft (como Office 365).</span><span class="sxs-lookup"><span data-stu-id="b9303-124">This topic contains detailed requirements on the protocol and message formatting that your SAML 2.0 identity provider must implement to federate with Azure AD to enable sign-on to one or more Microsoft cloud services (such as Office 365).</span></span> <span data-ttu-id="b9303-125">El usuario de confianza de SAML 2.0 (SP-STS) que se usa en este escenario para un servicio en la nube de Microsoft es Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b9303-125">The SAML 2.0 relying party (SP-STS) for a Microsoft cloud service used in this scenario is Azure AD.</span></span>

<span data-ttu-id="b9303-126">Se recomienda que se asegure de que sus mensajes de salida del proveedor de identidades de SAML 2.0 sean lo más parecidos posibles a los seguimientos de ejemplo proporcionados.</span><span class="sxs-lookup"><span data-stu-id="b9303-126">It is recommended that you ensure your SAML 2.0 identity provider output messages be as similar to the provided sample traces as possible.</span></span> <span data-ttu-id="b9303-127">Además, cuando sea posible, use valores de atributo específicos de los metadatos de Azure AD suministrados.</span><span class="sxs-lookup"><span data-stu-id="b9303-127">Also, use specific attribute values from the supplied Azure AD metadata where possible.</span></span> <span data-ttu-id="b9303-128">Cuando esté satisfecho con los mensajes de salida, puede probar con el Analizador de conectividad de Microsoft, como se describe a continuación.</span><span class="sxs-lookup"><span data-stu-id="b9303-128">Once you are happy with your output messages, you can test with the Microsoft Connectivity Analyzer as described below.</span></span>

<span data-ttu-id="b9303-129">Los metadatos de Azure AD se pueden descargar de esta dirección URL: [https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml](http://https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml).</span><span class="sxs-lookup"><span data-stu-id="b9303-129">The Azure AD metadata can be downloaded from this URL: [https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml](http://https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml).</span></span>
<span data-ttu-id="b9303-130">Para los clientes de China que usan la instancia de Office 365 específica de China, se debe usar el siguiente punto de conexión de federación: [https://nexus.partner.microsoftonline-p.cn/federationmetadata/saml20/federationmetadata.xml](https://nexus.partner.microsoftonline-p.cn/federationmetadata/saml20/federationmetadata.xml).</span><span class="sxs-lookup"><span data-stu-id="b9303-130">For customers in China using the China-specific instance of Office 365, the following federation endpoint should be used: [https://nexus.partner.microsoftonline-p.cn/federationmetadata/saml20/federationmetadata.xml](https://nexus.partner.microsoftonline-p.cn/federationmetadata/saml20/federationmetadata.xml).</span></span>

## <a name="saml-protocol-requirements"></a><span data-ttu-id="b9303-131">Requisitos del protocolo SAML</span><span class="sxs-lookup"><span data-stu-id="b9303-131">SAML protocol requirements</span></span>
<span data-ttu-id="b9303-132">En esta sección se detalla como se unen los pares de mensajes de solicitud y respuesta para ayudarle a dar formato a los mensajes correctamente.</span><span class="sxs-lookup"><span data-stu-id="b9303-132">This section details how the request and response message pairs are put together in order to help you to format your messages correctly.</span></span>

<span data-ttu-id="b9303-133">Azure AD se puede configurar para funcionar con proveedores de identidades que usan el perfil SP-Lite de SAML 2.0 con algunos requisitos específicos, que se indican a continuación.</span><span class="sxs-lookup"><span data-stu-id="b9303-133">Azure AD can be configured to work with identity providers that use the SAML 2.0 SP Lite profile with some specific requirements as listed below.</span></span> <span data-ttu-id="b9303-134">Mediante el uso de los mensajes de solicitud y respuesta de SAML de ejemplo, junto con las pruebas manuales automatizadas, puede trabajar para conseguir la interoperabilidad con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b9303-134">Using the sample SAML request and response messages along with automated and manual testing, you can work to achieve interoperability with Azure AD.</span></span>

## <a name="signature-block-requirements"></a><span data-ttu-id="b9303-135">Requisitos del bloque de firma</span><span class="sxs-lookup"><span data-stu-id="b9303-135">Signature block requirements</span></span>
<span data-ttu-id="b9303-136">En el mensaje de respuesta de SAML, el nodo de firma contiene información sobre la firma digital del propio mensaje.</span><span class="sxs-lookup"><span data-stu-id="b9303-136">Within the SAML Response message the Signature node contains information about the digital signature for the message itself.</span></span> <span data-ttu-id="b9303-137">El bloque de firma tiene los siguientes requisitos:</span><span class="sxs-lookup"><span data-stu-id="b9303-137">The signature block has the following requirements:</span></span>

1. <span data-ttu-id="b9303-138">El propio nodo de aserción debe estar firmado.</span><span class="sxs-lookup"><span data-stu-id="b9303-138">The assertion node itself must be signed</span></span>
2.  <span data-ttu-id="b9303-139">El algoritmo RSA-sha1 debe usarse como DigestMethod.</span><span class="sxs-lookup"><span data-stu-id="b9303-139">The RSA-sha1 algorithm must be used as the DigestMethod.</span></span> <span data-ttu-id="b9303-140">No se aceptan otros algoritmos de firma digital.</span><span class="sxs-lookup"><span data-stu-id="b9303-140">Other digital signature algorithms are not accepted.</span></span>
   `<ds:DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/>`
3.  <span data-ttu-id="b9303-141">También puede firmar el documento XML.</span><span class="sxs-lookup"><span data-stu-id="b9303-141">You may also sign the XML document.</span></span> 
4.  <span data-ttu-id="b9303-142">El algoritmo Transform debe coincidir con los valores del ejemplo siguiente:    `<ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/>
       <ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/>`</span><span class="sxs-lookup"><span data-stu-id="b9303-142">The Transform Algorithm must match the values in the following sample:    `<ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/>
       <ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/>`</span></span>
9.  <span data-ttu-id="b9303-143">El algoritmo SignatureMethod debe coincidir con el ejemplo siguiente:    `<ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/>`</span><span class="sxs-lookup"><span data-stu-id="b9303-143">The SignatureMethod Algorithm must match the following sample:   `<ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/>`</span></span>

## <a name="supported-bindings"></a><span data-ttu-id="b9303-144">Enlaces admitidos</span><span class="sxs-lookup"><span data-stu-id="b9303-144">Supported bindings</span></span>
<span data-ttu-id="b9303-145">Los enlaces son los parámetros de comunicación relacionados con el transporte que son necesarios.</span><span class="sxs-lookup"><span data-stu-id="b9303-145">Bindings are the transport related communications parameters that are required.</span></span> <span data-ttu-id="b9303-146">Los siguientes requisitos se aplican a los enlaces:</span><span class="sxs-lookup"><span data-stu-id="b9303-146">The following requirements apply to the bindings</span></span>

1. <span data-ttu-id="b9303-147">HTTPS es el transporte requerido.</span><span class="sxs-lookup"><span data-stu-id="b9303-147">HTTPS is the required transport.</span></span>
2.  <span data-ttu-id="b9303-148">Azure AD necesitará HTTP POST para el envío del token durante el inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="b9303-148">Azure AD will require HTTP POST for token submission during logon</span></span>
3.  <span data-ttu-id="b9303-149">Azure AD usará HTTP POST en la solicitud de autenticación al proveedor de identidades y REDIRECT en el mensaje de cierre de sesión a este proveedor.</span><span class="sxs-lookup"><span data-stu-id="b9303-149">Azure AD will use HTTP POST for the authentication request to the identity provider and REDIRECT for the Logoff message to the identity provider.</span></span>

## <a name="required-attributes"></a><span data-ttu-id="b9303-150">Atributos necesarios</span><span class="sxs-lookup"><span data-stu-id="b9303-150">Required attributes</span></span>
<span data-ttu-id="b9303-151">En esta tabla se muestran los requisitos de atributos específicos en el mensaje de SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="b9303-151">This table shows requirements for specific attributes in the SAML 2.0 message.</span></span>
 
|<span data-ttu-id="b9303-152">Atributo</span><span class="sxs-lookup"><span data-stu-id="b9303-152">Attribute</span></span>|<span data-ttu-id="b9303-153">Descripción</span><span class="sxs-lookup"><span data-stu-id="b9303-153">Description</span></span>|
| ----- | ----- |
|<span data-ttu-id="b9303-154">NameID</span><span class="sxs-lookup"><span data-stu-id="b9303-154">NameID</span></span>|<span data-ttu-id="b9303-155">El valor de esta aserción debe ser el mismo que el valor de ImmutableID del usuario de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b9303-155">The value of this assertion must be the same as the Azure AD user’s ImmutableID.</span></span> <span data-ttu-id="b9303-156">Puede tener hasta 64 caracteres alfanuméricos.</span><span class="sxs-lookup"><span data-stu-id="b9303-156">It can be up to 64 alpha numeric characters.</span></span> <span data-ttu-id="b9303-157">Los caracteres seguros que no sean HTML deben estar codificados, por ejemplo, un carácter "+" se muestra como ".2B".</span><span class="sxs-lookup"><span data-stu-id="b9303-157">Any non HTML safe characters must be encoded, for example a “+” character is shown as “.2B”.</span></span>|
|<span data-ttu-id="b9303-158">IDPEmail</span><span class="sxs-lookup"><span data-stu-id="b9303-158">IDPEmail</span></span>|<span data-ttu-id="b9303-159">El nombre principal de usuario (UPN) aparece en la respuesta SAML como un elemento con el nombre IDPEmail. Este es el valor de UserPrincipalName (UPN) del usuario en Azure AD/Office 365.</span><span class="sxs-lookup"><span data-stu-id="b9303-159">The User Principal Name (UPN) is listed in the SAML response as an element with the name IDPEmail This is the user’s UserPrincipalName (UPN) in Azure AD/Office 365.</span></span> <span data-ttu-id="b9303-160">El UPN está en formato de dirección de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="b9303-160">The UPN is in email address format.</span></span> <span data-ttu-id="b9303-161">Valor UPN en Windows Office 365 (Azure Active Directory).</span><span class="sxs-lookup"><span data-stu-id="b9303-161">UPN value in Windows Office 365 (Azure Active Directory).</span></span>|
|<span data-ttu-id="b9303-162">Emisor</span><span class="sxs-lookup"><span data-stu-id="b9303-162">Issuer</span></span>|<span data-ttu-id="b9303-163">Es necesario que sea un URI del proveedor de identidades.</span><span class="sxs-lookup"><span data-stu-id="b9303-163">This is required to be a URI of the identity provider.</span></span> <span data-ttu-id="b9303-164">No debe volver a usar el emisor de los mensajes de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="b9303-164">You should not reuse the Issuer from the sample messages.</span></span> <span data-ttu-id="b9303-165">Si tiene varios dominios de nivel superior en sus inquilinos de Azure AD, el emisor debe coincidir con el valor de URI especificado configurado por dominio.</span><span class="sxs-lookup"><span data-stu-id="b9303-165">If you have multiple top-level domains in your Azure AD tenants the Issuer must match the specified URI setting configured per domain.</span></span>|

>[!IMPORTANT]
><span data-ttu-id="b9303-166">Actualmente, Azure AD admite el siguiente URI de formato NameID para SAML 2.0:urn:oasis:names:tc:SAML:2.0:nameid-format:persistent.</span><span class="sxs-lookup"><span data-stu-id="b9303-166">Azure AD currently supports the following NameID Format URI for SAML 2.0:urn:oasis:names:tc:SAML:2.0:nameid-format:persistent.</span></span>

## <a name="sample-saml-request-and-response-messages"></a><span data-ttu-id="b9303-167">Ejemplo de mensajes de solicitud y respuesta de SAML</span><span class="sxs-lookup"><span data-stu-id="b9303-167">Sample SAML request and response messages</span></span>
<span data-ttu-id="b9303-168">Se muestra un mensaje de solicitud y respuesta para el intercambio de mensajes de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="b9303-168">A request and response message pair is shown for the sign-on message exchange.</span></span>
<span data-ttu-id="b9303-169">Se trata de un mensaje de solicitud de ejemplo que se envía desde Azure AD a un proveedor de identidades de SAML 2.0 de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="b9303-169">This is a sample request message that is sent from Azure AD to a sample SAML 2.0 identity provider.</span></span> <span data-ttu-id="b9303-170">El proveedor de identidades de SAML 2.0 de ejemplo está configurado por los Servicios de federación de Active Directory (AD FS) para usar el protocolo SAML-P.</span><span class="sxs-lookup"><span data-stu-id="b9303-170">The sample SAML 2.0 identity provider is Active Directory Federation Services (AD FS) configured to use SAML-P protocol.</span></span> <span data-ttu-id="b9303-171">Las pruebas de interoperabilidad también se han realizado con otros proveedores de identidades de SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="b9303-171">Interoperability testing has also been completed with other SAML 2.0 identity providers.</span></span>

    `<samlp:AuthnRequest xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol" xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion" ID="_7171b0b2-19f2-4ba2-8f94-24b5e56b7f1e" IssueInstant="2014-01-30T16:18:35Z" Version="2.0" AssertionConsumerServiceIndex="0" >
    <saml:Issuer>urn:federation:MicrosoftOnline</saml:Issuer>
    <samlp:NameIDPolicy Format="urn:oasis:names:tc:SAML:2.0:nameid-format:persistent"/>
    </samlp:AuthnRequest>`

<span data-ttu-id="b9303-172">Se trata de un mensaje de respuesta de ejemplo que se envía desde el proveedor de identidades compatible con SAML 2.0 de ejemplo a Azure AD u Office 365.</span><span class="sxs-lookup"><span data-stu-id="b9303-172">This is a sample response message that is sent from the sample SAML 2.0 compliant identity provider to Azure AD / Office 365.</span></span>

    `<samlp:Response ID="_592c022f-e85e-4d23-b55b-9141c95cd2a5" Version="2.0" IssueInstant="2014-01-31T15:36:31.357Z" Destination="https://login.microsoftonline.com/login.srf" Consent="urn:oasis:names:tc:SAML:2.0:consent:unspecified" InResponseTo="_049917a6-1183-42fd-a190-1d2cbaf9b144" xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol">
    <Issuer xmlns="urn:oasis:names:tc:SAML:2.0:assertion">http://WS2012R2-0.contoso.com/adfs/services/trust</Issuer>
    <samlp:Status>
    <samlp:StatusCode Value="urn:oasis:names:tc:SAML:2.0:status:Success" />
    </samlp:Status>
    <Assertion ID="_7e3c1bcd-f180-4f78-83e1-7680920793aa" IssueInstant="2014-01-31T15:36:31.279Z" Version="2.0" xmlns="urn:oasis:names:tc:SAML:2.0:assertion">
    <Issuer>http://WS2012R2-0.contoso.com/adfs/services/trust</Issuer>
    <ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#">
      <ds:SignedInfo>
        <ds:CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#" />
        <ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1" />
        <ds:Reference URI="#_7e3c1bcd-f180-4f78-83e1-7680920793aa">
          <ds:Transforms>
            <ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature" />
            <ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#" />
          </ds:Transforms>
          <ds:DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1" />
          <ds:DigestValue>CBn/5YqbheaJP425c0pHva9PhNY=</ds:DigestValue>
        </ds:Reference>
      </ds:SignedInfo>
      <ds:SignatureValue>TciWMyHW2ZODrh/2xrvp5ggmcHBFEd9vrp6DYXp+hZWJzmXMmzwmwS8KNRJKy8H7XqBsdELA1Msqi8I3TmWdnoIRfM/ZAyUppo8suMu6Zw+boE32hoQRnX9EWN/f0vH6zA/YKTzrjca6JQ8gAV1ErwvRWDpyMcwdYCiWALv9ScbkAcebOE1s1JctZ5RBXggdZWrYi72X+I4i6WgyZcIGai/rZ4v2otoWAEHS0y1yh1qT7NDPpl/McDaTGkNU6C+8VfjD78DrUXEcAfKvPgKlKrOMZnD1lCGsViimGY+LSuIdY45MLmyaa5UT4KWph6dA==</ds:SignatureValue>
      <KeyInfo xmlns="http://www.w3.org/2000/09/xmldsig#">
        <ds:X509Data>
          <ds:X509Certificate>MIIC7jCCAdagAwIBAgIQRrjsbFPaXIlOG3GTv50fkjANBgkqhkiG9w0BAQsFADAzMTEwLwYDVQQDEyhBREZTIFNpZ25pbmcgLSBXUzIwMTJSMi0wLnN3aW5mb3JtZXIuY29tMB4XDTE0MDEyMDE1MTY0MFoXDTE1MDEyMDE1MTY0MFowMzExMC8GA1UEAxMoQURGUyBTaWduaW5nIC0gV1MyMDEyUjItMC5zd2luZm9ybWVyLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKe+rLVmXy1QwCwZwqgbbp1/+3ZWxd9T/jV0hpLIIWr+LCOHqq8n8beJvlivgLmDJo8f+EITnAxWcsJUvVai/35AhHCUq9tc9sqMp5PWtabAEMb2AU72/QlX/72D2/NbGQq1BWYbqUpgpCZ2nSgvlWDHlCiUo//UGsvfox01kjTFlmqQInsJVfRxF5AcCAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAi8c6C4zaTEc7aQiUgvnGQgCbMZbhUXXLGRpjvFLKaQzkwa9eq7WLJibcSNyGXBa/SfT5wJgsm3TPKgSehGAOTirhcqHheZyvBObAScY7GOT+u9pVYp6raFrc7ez3c+CGHeV/tNvy1hJNs12FYH4X+ZCNFIT9tprieR25NCdi5SWUbPZL0tVzJsHc1y92b2M2FxqRDohxQgJvyJOpcg2mSBzZZIkvDg7gfPSUXHVS1MQs0RHSbwq/XdQocUUhl9/e/YWCbNNxlM84BxFsBUok1dH/gzBySx+Fc8zYi7cOq9yaBT3RLT6cGmFGVYZJW4FyhPZOCLVNsLlnPQcX3dDg9A==</ds:X509Certificate>
        </ds:X509Data>
      </KeyInfo>
    </ds:Signature>
    <Subject>
      <NameID Format="urn:oasis:names:tc:SAML:2.0:nameid-format:persistent">ABCDEG1234567890</NameID>
      <SubjectConfirmation Method="urn:oasis:names:tc:SAML:2.0:cm:bearer">
        <SubjectConfirmationData InResponseTo="_049917a6-1183-42fd-a190-1d2cbaf9b144" NotOnOrAfter="2014-01-31T15:41:31.357Z" Recipient="https://login.microsoftonline.com/login.srf" />
      </SubjectConfirmation>
    </Subject>
    <Conditions NotBefore="2014-01-31T15:36:31.263Z" NotOnOrAfter="2014-01-31T16:36:31.263Z">
      <AudienceRestriction>
        <Audience>urn:federation:MicrosoftOnline</Audience>
      </AudienceRestriction>
    </Conditions>
    <AttributeStatement>
      <Attribute Name="IDPEmail">
        <AttributeValue>administrator@contoso.com</AttributeValue>
      </Attribute>
    </AttributeStatement>
    <AuthnStatement AuthnInstant="2014-01-31T15:36:30.200Z" SessionIndex="_7e3c1bcd-f180-4f78-83e1-7680920793aa">
      <AuthnContext>
        <AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport</AuthnContextClassRef>
      </AuthnContext>
    </AuthnStatement>
    </Assertion>
    </samlp:Response>`

## <a name="configure-your-saml-20-compliant-identity-provider"></a><span data-ttu-id="b9303-173">Configuración del proveedor de identidades compatible con SAML 2.0</span><span class="sxs-lookup"><span data-stu-id="b9303-173">Configure your SAML 2.0 compliant identity provider</span></span>
<span data-ttu-id="b9303-174">Este tema contiene instrucciones sobre cómo configurar el proveedor de identidades de SAML 2.0 para la federación con Azure AD con el fin de habilitar el acceso de inicio de sesión único a uno o varios servicios en la nube de Microsoft (como Office 365) mediante el protocolo SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="b9303-174">This topic contains guidelines on how to configure your SAML 2.0 identity provider to federate with Azure AD to enable single sign-on access to one or more Microsoft cloud services (such as Office 365) using the SAML 2.0 protocol.</span></span> <span data-ttu-id="b9303-175">El usuario de confianza de SAML 2.0 que se usa en este escenario para un servicio en la nube de Microsoft es Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b9303-175">The SAML 2.0 relying party for a Microsoft cloud service used in this scenario is Azure AD.</span></span>

## <a name="add-azure-ad-metadata"></a><span data-ttu-id="b9303-176">Adición de metadatos de Azure AD</span><span class="sxs-lookup"><span data-stu-id="b9303-176">Add Azure AD metadata</span></span>
<span data-ttu-id="b9303-177">El proveedor de identidades de SAML 2.0 debe adherirse a la información sobre el usuario de confianza de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b9303-177">Your SAML 2.0 identity provider needs to adhere to information about the Azure AD relying party.</span></span> <span data-ttu-id="b9303-178">Azure AD publica los metadatos en https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml.</span><span class="sxs-lookup"><span data-stu-id="b9303-178">Azure AD publishes metadata at https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml.</span></span>

<span data-ttu-id="b9303-179">Se recomienda importar siempre los metadatos más recientes de Azure AD al configurar el proveedor de identidades de SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="b9303-179">It is recommended that you always import the latest Azure AD metadata when configuring your SAML 2.0 identity provider.</span></span> <span data-ttu-id="b9303-180">Tenga en cuenta que Azure AD no lee los metadatos del proveedor de identidades.</span><span class="sxs-lookup"><span data-stu-id="b9303-180">Note that Azure AD does not read metadata from the identity provider.</span></span>

## <a name="add-azure-ad-as-a-relying-party"></a><span data-ttu-id="b9303-181">Adición de Azure AD como usuario de confianza</span><span class="sxs-lookup"><span data-stu-id="b9303-181">Add Azure AD as a relying party</span></span>
<span data-ttu-id="b9303-182">Deberá habilitar la comunicación entre el proveedor de identidades de SAML 2.0 y Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b9303-182">You have to enable communication between your SAML 2.0 identity provider and Azure AD.</span></span> <span data-ttu-id="b9303-183">Esta configuración dependerá de su proveedor de identidades específico, así que debería consultar la documentación correspondiente.</span><span class="sxs-lookup"><span data-stu-id="b9303-183">This configuration will be dependent on your specific identity provider and you should refer to documentation for it.</span></span> <span data-ttu-id="b9303-184">Normalmente el id. del usuario de confianza se establecerá en el mismo valor de entityID de los metadatos de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b9303-184">You would typically set the relying party ID to the same as the entityID from the Azure AD metadata.</span></span>

>[!NOTE]
><span data-ttu-id="b9303-185">Compruebe que el reloj del servidor del proveedor de identidades de SAML 2.0 esté sincronizado con una fuente horaria precisa.</span><span class="sxs-lookup"><span data-stu-id="b9303-185">Verify the clock on your SAML 2.0 identity provider server is synchronized to an accurate time source.</span></span> <span data-ttu-id="b9303-186">Una hora inexacta del reloj puede hacer que los inicios de sesión federados produzcan error.</span><span class="sxs-lookup"><span data-stu-id="b9303-186">An inaccurate clock time can cause federated logins to fail.</span></span>

## <a name="install-windows-powershell-for-sign-on-with-saml-20-identity-provider"></a><span data-ttu-id="b9303-187">Instalación de Windows PowerShell para el inicio de sesión con el proveedor de identidades de SAML 2.0</span><span class="sxs-lookup"><span data-stu-id="b9303-187">Install Windows PowerShell for sign-on with SAML 2.0 identity provider</span></span>
<span data-ttu-id="b9303-188">Después de que ha configurado el proveedor de identidades de SAML 2.0 para su uso con el inicio de sesión de Azure AD, el siguiente paso consiste en descargar e instalar el Módulo Azure Active Directory para Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b9303-188">After you have configured your SAML 2.0 identity provider for use with Azure AD sign-on, the next step is to download and install the Azure Active Directory Module for Windows PowerShell.</span></span> <span data-ttu-id="b9303-189">Una vez instalado, usará estos cmdlets para configurar los dominios de Azure AD como dominios federados.</span><span class="sxs-lookup"><span data-stu-id="b9303-189">Once installed, you will use these cmdlets to configure your Azure AD domains as federated domains.</span></span>

<span data-ttu-id="b9303-190">El Módulo Azure Active Directory para Windows PowerShell es una descarga para administrar los datos de la organización en Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b9303-190">The Azure Active Directory Module for Windows PowerShell is a download for managing your organizations data in Azure AD.</span></span> <span data-ttu-id="b9303-191">Este módulo instala un conjunto de cmdlets en Windows PowerShell; esos cmdlets se ejecutan para configurar el acceso de inicio de sesión único a Azure AD y, a su vez, a todos los servicios en la nube que están suscritos a él.</span><span class="sxs-lookup"><span data-stu-id="b9303-191">This module installs a set of cmdlets to Windows PowerShell; you run those cmdlets to set up single sign-on access to Azure AD and in turn to all of the cloud services you are subscribed to.</span></span> <span data-ttu-id="b9303-192">Para obtener instrucciones sobre cómo descargar e instalar los cmdlets, consulte [http://technet.microsoft.com/library/jj151815.aspx](http://technet.microsoft.com/library/jj151815.aspx).</span><span class="sxs-lookup"><span data-stu-id="b9303-192">For instructions about how to download and install the cmdlets, see [http://technet.microsoft.com/library/jj151815.aspx](http://technet.microsoft.com/library/jj151815.aspx)</span></span>

## <a name="set-up-a-trust-between-your-saml-identity-provider-and-azure-ad"></a><span data-ttu-id="b9303-193">Configuración de una relación de confianza entre el proveedor de identidades de SAML y Azure AD</span><span class="sxs-lookup"><span data-stu-id="b9303-193">Set up a trust between your SAML identity provider and Azure AD</span></span>
<span data-ttu-id="b9303-194">Antes de configurar la federación en un dominio de Azure AD, debe tener configurado un dominio personalizado.</span><span class="sxs-lookup"><span data-stu-id="b9303-194">Before configuring federation on an Azure AD domain, it must have a custom domain configured.</span></span> <span data-ttu-id="b9303-195">No se puede federar el dominio predeterminado proporcionado por Microsoft.</span><span class="sxs-lookup"><span data-stu-id="b9303-195">You cannot federate the default domain that is provided by Microsoft.</span></span> <span data-ttu-id="b9303-196">El dominio predeterminado de Microsoft finaliza con "onmicrosoft.com".</span><span class="sxs-lookup"><span data-stu-id="b9303-196">The default domain from Microsoft ends with “onmicrosoft.com”.</span></span>
<span data-ttu-id="b9303-197">Ejecutará una serie de cmdlets en la interfaz de la línea de comandos de Windows PowerShell para agregar o convertir dominios para el inicio de sesión único.</span><span class="sxs-lookup"><span data-stu-id="b9303-197">You will run a series of cmdlets in the Windows PowerShell command-line interface to add or convert domains for single sign-on.</span></span>

<span data-ttu-id="b9303-198">Todos los dominios de Azure Active Directory que quiera federar mediante su proveedor de identidades de SAML 2.0 se deben agregar como un dominio de inicio de sesión único o convertirse en uno de estos dominios a partir de un dominio estándar.</span><span class="sxs-lookup"><span data-stu-id="b9303-198">Each Azure Active Directory domain that you want to federate using your SAML 2.0 identity provider must either be added as a single sign-on domain or converted to be a single sign-on domain from a standard domain.</span></span> <span data-ttu-id="b9303-199">El hecho de agregar o convertir un dominio establece una relación de confianza entre el proveedor de identidades de SAML 2.0 y Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b9303-199">Adding or converting a domain sets up a trust between your SAML 2.0 identity provider and Azure AD.</span></span>

<span data-ttu-id="b9303-200">En el procedimiento siguiente se explica cómo convertir un dominio estándar existente en un dominio federado mediante SP-Lite de SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="b9303-200">The following procedure walks you through converting an existing standard domain to a federated domain using SAML 2.0 SP-Lite.</span></span> <span data-ttu-id="b9303-201">Tenga en cuenta que el dominio puede sufrir una interrupción del sistema que afecte a los usuarios durante un período de tiempo de hasta dos horas después de realizar este paso.</span><span class="sxs-lookup"><span data-stu-id="b9303-201">Note that your domain may experience an outage that impacts users up to 2 hours after you take this step.</span></span>

## <a name="configuring-a-domain-in-your-azure-ad-directory-for-federation"></a><span data-ttu-id="b9303-202">Configuración de un dominio en Azure AD Directory para federación</span><span class="sxs-lookup"><span data-stu-id="b9303-202">Configuring a domain in your Azure AD Directory for federation</span></span>


1. <span data-ttu-id="b9303-203">Conéctese a su instancia de Azure AD Directory como administrador de inquilinos: Connect-MsolService.</span><span class="sxs-lookup"><span data-stu-id="b9303-203">Connect to your Azure AD Directory as a tenant administrator: Connect-MsolService .</span></span>
2.  <span data-ttu-id="b9303-204">Configure el dominio de Office 365 deseado para usar la federación con SAML 2.0: `$dom = "contoso.com" $BrandName - "Sample SAML 2.0 IDP" $LogOnUrl = "https://WS2012R2-0.contoso.com/passiveLogon" $LogOffUrl = "https://WS2012R2-0.contoso.com/passiveLogOff" $ecpUrl = "https://WS2012R2-0.contoso.com/PAOS" $MyURI = "urn:uri:MySamlp2IDP" $MySigningCert = @" MIIC7jCCAdagAwIBAgIQRrjsbFPaXIlOG3GTv50fkjANBgkqhkiG9w0BAQsFADAzMTEwLwYDVQQDEyh BREZTIFNpZ25pbmcgLSBXUzIwMTJSMi0wLnN3aW5mb3JtZXIuY29tMB4XDTE0MDEyMDE1MTY0MFoXDT E1MDEyMDE1MTY0MFowMzExMC8GA1UEAxMoQURGUyBTaWduaW5nIC0gV1MyMDEyUjItMC5zd2luZm9yb WVyLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKe+rLVmXy1QwCwZwqgbbp1/kupQ VcjKuKLitVDbssFyqbDTjP7WRjlVMWAHBI3kgNT7oE362Gf2WMJFf1b0HcrsgLin7daRXpq4Qi6OA57 sW1YFMj3sqyuTP0eZV3S4+ZbDVob6amsZIdIwxaLP9Zfywg2bLsGnVldB0+XKedZwDbCLCVg+3ZWxd9 T/jV0hpLIIWr+LCOHqq8n8beJvlivgLmDJo8f+EITnAxWcsJUvVai/35AhHCUq9tc9sqMp5PWtabAEM b2AU72/QlX/72D2/NbGQq1BWYbqUpgpCZ2nSgvlWDHlCiUo//UGsvfox01kjTFlmqQInsJVfRxF5AcC AwEAATANBgkqhkiG9w0BAQsFAAOCAQEAi8c6C4zaTEc7aQiUgvnGQgCbMZbhUXXLGRpjvFLKaQzkwa9 eq7WLJibcSNyGXBa/SfT5wJgsm3TPKgSehGAOTirhcqHheZyvBObAScY7GOT+u9pVYp6raFrc7ez3c+ CGHeV/tNvy1hJNs12FYH4X+ZCNFIT9tprieR25NCdi5SWUbPZL0tVzJsHc1y92b2M2FxqRDohxQgJvy JOpcg2mSBzZZIkvDg7gfPSUXHVS1MQs0RHSbwq/XdQocUUhl9/e/YWCbNNxlM84BxFsBUok1dH/gzBy Sx+Fc8zYi7cOq9yaBT3RLT6cGmFGVYZJW4FyhPZOCLVNsLlnPQcX3dDg9A==" "@ $uri = "http://WS2012R2-0.contoso.com/adfs/services/trust" $Protocol = "SAMLP" Set-MsolDomainAuthentication -DomainName $dom -FederationBrandName $dom -Authentication Federated -PassiveLogOnUri $MyURI -ActiveLogOnUri $ecpUrl -SigningCertificate $MySigningCert -IssuerUri $uri -LogOffUri $url -PreferredAuthenticationProtocol $Protocol`</span><span class="sxs-lookup"><span data-stu-id="b9303-204">Configure your desired Office 365 domain to use federation with SAML 2.0: `$dom = "contoso.com" $BrandName - "Sample SAML 2.0 IDP" $LogOnUrl = "https://WS2012R2-0.contoso.com/passiveLogon" $LogOffUrl = "https://WS2012R2-0.contoso.com/passiveLogOff" $ecpUrl = "https://WS2012R2-0.contoso.com/PAOS" $MyURI = "urn:uri:MySamlp2IDP" $MySigningCert = @" MIIC7jCCAdagAwIBAgIQRrjsbFPaXIlOG3GTv50fkjANBgkqhkiG9w0BAQsFADAzMTEwLwYDVQQDEyh BREZTIFNpZ25pbmcgLSBXUzIwMTJSMi0wLnN3aW5mb3JtZXIuY29tMB4XDTE0MDEyMDE1MTY0MFoXDT E1MDEyMDE1MTY0MFowMzExMC8GA1UEAxMoQURGUyBTaWduaW5nIC0gV1MyMDEyUjItMC5zd2luZm9yb WVyLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKe+rLVmXy1QwCwZwqgbbp1/kupQ VcjKuKLitVDbssFyqbDTjP7WRjlVMWAHBI3kgNT7oE362Gf2WMJFf1b0HcrsgLin7daRXpq4Qi6OA57 sW1YFMj3sqyuTP0eZV3S4+ZbDVob6amsZIdIwxaLP9Zfywg2bLsGnVldB0+XKedZwDbCLCVg+3ZWxd9 T/jV0hpLIIWr+LCOHqq8n8beJvlivgLmDJo8f+EITnAxWcsJUvVai/35AhHCUq9tc9sqMp5PWtabAEM b2AU72/QlX/72D2/NbGQq1BWYbqUpgpCZ2nSgvlWDHlCiUo//UGsvfox01kjTFlmqQInsJVfRxF5AcC AwEAATANBgkqhkiG9w0BAQsFAAOCAQEAi8c6C4zaTEc7aQiUgvnGQgCbMZbhUXXLGRpjvFLKaQzkwa9 eq7WLJibcSNyGXBa/SfT5wJgsm3TPKgSehGAOTirhcqHheZyvBObAScY7GOT+u9pVYp6raFrc7ez3c+ CGHeV/tNvy1hJNs12FYH4X+ZCNFIT9tprieR25NCdi5SWUbPZL0tVzJsHc1y92b2M2FxqRDohxQgJvy JOpcg2mSBzZZIkvDg7gfPSUXHVS1MQs0RHSbwq/XdQocUUhl9/e/YWCbNNxlM84BxFsBUok1dH/gzBy Sx+Fc8zYi7cOq9yaBT3RLT6cGmFGVYZJW4FyhPZOCLVNsLlnPQcX3dDg9A==" "@ $uri = "http://WS2012R2-0.contoso.com/adfs/services/trust" $Protocol = "SAMLP" Set-MsolDomainAuthentication -DomainName $dom -FederationBrandName $dom -Authentication Federated -PassiveLogOnUri $MyURI -ActiveLogOnUri $ecpUrl -SigningCertificate $MySigningCert -IssuerUri $uri -LogOffUri $url -PreferredAuthenticationProtocol $Protocol`</span></span> 

3.  <span data-ttu-id="b9303-205">Puede obtener la cadena codificada en base64 del certificado de firma de su archivo de metadatos de IDP.</span><span class="sxs-lookup"><span data-stu-id="b9303-205">You can obtain the signing certificate base64 encoded string from your IDP metadata file.</span></span> <span data-ttu-id="b9303-206">Aunque se ha proporcionado un ejemplo de esta ubicación, puede ser algo diferente dependiendo de su implementación.</span><span class="sxs-lookup"><span data-stu-id="b9303-206">An example of this location has been provided but may differ slightly based on your implementation.</span></span>

    `<IDPSSODescriptor protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"> <KeyDescriptor use="signing"> <KeyInfo xmlns="http://www.w3.org/2000/09/xmldsig#"> <X509Data> <X509Certificate>MIIC5jCCAc6gAwIBAgIQLnaxUPzay6ZJsC8HVv/QfTANBgkqhkiG9w0BAQsFADAvMS0wKwYDVQQDEyRBREZTIFNpZ25pbmcgLSBmcy50ZWNobGFiY2VudHJhbC5vcmcwHhcNMTMxMTA0MTgxMzMyWhcNMTQxMTA0MTgxMzMyWjAvMS0wKwYDVQQDEyRBREZTIFNpZ25pbmcgLSBmcy50ZWNobGFiY2VudHJhbC5vcmcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCwMdVLTr5YTSRp+ccbSpuuFeXMfABD9mVCi2wtkRwC30TIyPdORz642MkurdxdPCWjwgJ0HW6TvXwcO9afH3OC5V//wEGDoNcI8PV4enCzTYFe/h//w51uqyv48Fbb3lEXs+aVl8155OAj2sO9IX64OJWKey82GQWK3g7LfhWWpp17j5bKpSd9DBH5pvrV+Q1ESU3mx71TEOvikHGCZYitEPywNeVMLRKrevdWI3FAhFjcCSO6nWDiMqCqiTDYOURXIcHVYTSof1YotkJ4tG6mP5Kpjzd4VQvnR7Pjb47nhIYG6iZ3mR1F85Ns9+hBWukQWNN2hcD/uGdPXhpdMVpBAgMBAAEwDQYJKoZIhvcNAQELBQADggEBAK7h7jF7wPzhZ1dPl4e+XMAr8I7TNbhgEU3+oxKyW/IioQbvZVw1mYVCbGq9Rsw4KE06eSMybqHln3w5EeBbLS0MEkApqHY+p68iRpguqa+W7UHKXXQVgPMCpqxMFKonX6VlSQOR64FgpBme2uG+LJ8reTgypEKspQIN0WvtPWmiq4zAwBp08hAacgv868c0MM4WbOYU0rzMIR6Q+ceGVRImlCwZ5b7XKp4mJZ9hlaRjeuyVrDuzBkzROSurX1OXoci08yJvhbtiBJLf3uPOJHrhjKRwIt2TnzS9ElgFZlJiDIA26Athe73n43CT0af2IG6yC7e6sK4L3NEXJrwwUZk=</X509Certificate> </X509Data> </KeyInfo> </KeyDescriptor>` 

<span data-ttu-id="b9303-207">Para más información sobre "Set-MsolDomainAuthentication", consulte: [http://technet.microsoft.com/library/dn194112.aspx](http://technet.microsoft.com/library/dn194112.aspx).</span><span class="sxs-lookup"><span data-stu-id="b9303-207">For more information about “Set-MsolDomainAuthentication”, see: [http://technet.microsoft.com/library/dn194112.aspx](http://technet.microsoft.com/library/dn194112.aspx).</span></span>

>[!NOTE]
><span data-ttu-id="b9303-208">Debe ejecutar "$ecpUrl = “https://WS2012R2-0.contoso.com/PAOS“” solo si ha configurado una extensión ECP para el proveedor de identidades.</span><span class="sxs-lookup"><span data-stu-id="b9303-208">You must run use “$ecpUrl = “https://WS2012R2-0.contoso.com/PAOS“” only if you set up an ECP extension for your identity provider.</span></span> <span data-ttu-id="b9303-209">Los clientes de Exchange Online, excepto Outlook Web Application (OWA), dependen de un punto de conexión activo basado en POST.</span><span class="sxs-lookup"><span data-stu-id="b9303-209">Exchange Online clients, excluding Outlook Web Application (OWA), rely on a POST based active end point.</span></span> <span data-ttu-id="b9303-210">Si el STS de SAML 2.0 implementa un punto de conexión activo de forma similar a ECP de Shibboleth, es posible que estos clientes enriquecidos puedan interactuar con el servicio Exchange Online.</span><span class="sxs-lookup"><span data-stu-id="b9303-210">If your SAML 2.0 STS implements an active end point similar to Shibboleth’s ECP implementation of an active end point it may be possible for these rich clients to interact with the Exchange Online service.</span></span>

<span data-ttu-id="b9303-211">Una vez configurada la federación, puede cambiar de nuevo a "no federado" (o "administrado"); sin embargo, este cambio tarda hasta dos horas en realizarse y requiere la asignación de nuevas contraseñas aleatorias para el inicio de sesión basado en la nube de cada usuario.</span><span class="sxs-lookup"><span data-stu-id="b9303-211">Once federation has been configured you can switch back to “non-federated” (or “managed”), however this change takes up to two hours to complete and it requires assigning new random passwords for cloud based sign-in to each user.</span></span> <span data-ttu-id="b9303-212">Volver a cambiar a "administrado" puede ser necesario en algunos escenarios para restablecer un error de la configuración.</span><span class="sxs-lookup"><span data-stu-id="b9303-212">Switching back to “managed” may be required in some scenarios to reset an error in your settings.</span></span> <span data-ttu-id="b9303-213">Para más información sobre la conversión de dominios, consulte: [http://msdn.microsoft.com/library/windowsazure/dn194122.aspx](http://msdn.microsoft.com/library/windowsazure/dn194122.aspx).</span><span class="sxs-lookup"><span data-stu-id="b9303-213">For more information on Domain conversion see: [http://msdn.microsoft.com/library/windowsazure/dn194122.aspx](http://msdn.microsoft.com/library/windowsazure/dn194122.aspx).</span></span>

## <a name="provision-user-principals-to-azure-ad--office-365"></a><span data-ttu-id="b9303-214">Aprovisionamiento de entidades de seguridad de usuario en Azure AD y Office 365</span><span class="sxs-lookup"><span data-stu-id="b9303-214">Provision user principals to Azure AD / Office 365</span></span>
<span data-ttu-id="b9303-215">Antes de poder autenticar a los usuarios en Office 365, debe aprovisionar Azure AD con entidades de seguridad de usuario que correspondan a la aserción en la notificación de SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="b9303-215">Before you can authenticate your users to Office 365 you must provision Azure AD with user principals that correspond to the assertion in the SAML 2.0 claim.</span></span> <span data-ttu-id="b9303-216">Si Azure AD no conoce estas entidades de seguridad de usuario de antemano, no se podrán usar para el inicio de sesión federado.</span><span class="sxs-lookup"><span data-stu-id="b9303-216">If these user principals are not known to Azure AD in advance then they cannot be used for federated sign-in.</span></span> <span data-ttu-id="b9303-217">Se puede usar Azure AD Connect o Windows PowerShell para aprovisionar a las entidades de seguridad de usuario.</span><span class="sxs-lookup"><span data-stu-id="b9303-217">Either Azure AD Connect or Windows PowerShell can be used to provision user principals.</span></span>

<span data-ttu-id="b9303-218">Azure AD Connect se puede usar para aprovisionar a las entidades de seguridad en los dominios en Azure Active Directory desde el entorno local de Active Directory.</span><span class="sxs-lookup"><span data-stu-id="b9303-218">Azure AD Connect can be used to provision principals to your domains in your Azure AD Directory from the on-premises Active Directory.</span></span> <span data-ttu-id="b9303-219">Para más información, consulte [Integrate your on-premises directories with Azure Active Directory](active-directory-aadconnect.md) (Integración de los directorios locales con Azure Active Directory).</span><span class="sxs-lookup"><span data-stu-id="b9303-219">For more detailed information, see [Integrate your on-premises directories with Azure Active Directory](active-directory-aadconnect.md).</span></span>

<span data-ttu-id="b9303-220">También se puede usar Windows PowerShell para automatizar la adición de nuevos usuarios a Azure AD y sincronizar los cambios desde el directorio local.</span><span class="sxs-lookup"><span data-stu-id="b9303-220">Windows PowerShell can also be used to automate adding new users to Azure AD and to synchronize changes from the on-premises directory.</span></span> <span data-ttu-id="b9303-221">Para usar los cmdlets de Windows PowerShell, debe descargar los [módulos de Azure Active Directory](https://docs.microsoft.com/powershell/azure/install-adv2?view=azureadps-2.0).</span><span class="sxs-lookup"><span data-stu-id="b9303-221">To use the Windows PowerShell cmdlets you must download the [Azure Active Directory Modules](https://docs.microsoft.com/powershell/azure/install-adv2?view=azureadps-2.0).</span></span>

<span data-ttu-id="b9303-222">Este procedimiento muestra cómo agregar un único usuario a Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b9303-222">This procedure shows how to add a single user to Azure AD.</span></span>


1. <span data-ttu-id="b9303-223">Conéctese a su instancia de Azure AD Directory como administrador de inquilinos: Connect-MsolService.</span><span class="sxs-lookup"><span data-stu-id="b9303-223">Connect to your Azure AD Directory as a tenant administrator: Connect-MsolService.</span></span>
2.  <span data-ttu-id="b9303-224">Cree una nueva entidad de seguridad de usuario: ` New-MsolUser
        -UserPrincipalName elwoodf1@contoso.com
        -ImmutableId ABCDEFG1234567890
        -DisplayName "Elwood Folk"
        -FirstName Elwood 
        -LastName Folk 
        -AlternateEmailAddresses "Elwood.Folk@contoso.com" 
        -LicenseAssignment "samlp2test:ENTERPRISEPACK" 
        -UsageLocation "US" `.</span><span class="sxs-lookup"><span data-stu-id="b9303-224">Create a new user principal: ` New-MsolUser
        -UserPrincipalName elwoodf1@contoso.com
    -ImmutableId ABCDEFG1234567890
    -DisplayName "Elwood Folk"
    -FirstName Elwood 
    -LastName Folk 
    -AlternateEmailAddresses "Elwood.Folk@contoso.com" 
    -LicenseAssignment "samlp2test:ENTERPRISEPACK" 
    -UsageLocation "US" `</span></span> 

<span data-ttu-id="b9303-225">Para más información sobre "New-MsolUser", consulte [http://technet.microsoft.com/library/dn194096.aspx](http://technet.microsoft.com/library/dn194096.aspx).</span><span class="sxs-lookup"><span data-stu-id="b9303-225">For more information about “New-MsolUser” check out, [http://technet.microsoft.com/library/dn194096.aspx](http://technet.microsoft.com/library/dn194096.aspx)</span></span>

>[!NOTE]
><span data-ttu-id="b9303-226">El valor "UserPrinciplName" debe coincidir con el valor que se enviará para "IDPEmail" en la notificación de SAML 2.0, y el valor "ImmutableID" debe coincidir con el valor enviado en la aserción "NameID".</span><span class="sxs-lookup"><span data-stu-id="b9303-226">The “UserPrinciplName” value must match the value that you will send for “IDPEmail” in your SAML 2.0 claim and the “ImmutableID” value must match the value sent in your “NameID” assertion.</span></span>

## <a name="verify-single-sign-on-with-your-saml-20-idp"></a><span data-ttu-id="b9303-227">Comprobación del inicio de sesión único con el IDP SAML 2.0</span><span class="sxs-lookup"><span data-stu-id="b9303-227">Verify single sign-on with your SAML 2.0 IDP</span></span>
<span data-ttu-id="b9303-228">Como administrador, antes de comprobar y administrar el inicio de sesión único (también llamado federación de identidades), revise la información y realice los pasos que se describen en los siguientes artículos para configurar el inicio de sesión único con su proveedor de identidades basado en SP-Lite de SAML 2.0:</span><span class="sxs-lookup"><span data-stu-id="b9303-228">As the administrator, before you verify and manage single sign-on (also called identity federation), review the information and perform the steps in the following articles to set up single sign-on with your SAML 2.0 SP-Lite based identity provider:</span></span>


1.  <span data-ttu-id="b9303-229">Ha revisado los requisitos del protocolo SAML 2.0 de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b9303-229">You have reviewed the Azure AD SAML 2.0 Protocol Requirements</span></span>
2.  <span data-ttu-id="b9303-230">Ha configurado el proveedor de identidades de SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="b9303-230">You have configured your SAML 2.0 identity provider</span></span>
3.  <span data-ttu-id="b9303-231">Instale Windows PowerShell para el inicio de sesión único con el proveedor de identidades de SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="b9303-231">Install Windows PowerShell for single sign-on with SAML 2.0 identity provider</span></span>
4.  <span data-ttu-id="b9303-232">Configure una relación de confianza entre el proveedor de identidades de SAML 2.0 y Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b9303-232">Set up a trust between SAML 2.0 identity provider and Azure AD</span></span>
5.  <span data-ttu-id="b9303-233">Ha aprovisionado una entidad de seguridad de usuario de prueba conocida en Azure Active Directory (Office 365) mediante Windows PowerShell o Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="b9303-233">Provisioned a known test user principal to Azure Active Directory (Office 365) either through Windows PowerShell or Azure AD Connect.</span></span>
6.  <span data-ttu-id="b9303-234">Configure la sincronización de directorios con [Azure AD Connect](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="b9303-234">Configure directory synchronization using [Azure AD Connect](active-directory-aadconnect.md).</span></span>

<span data-ttu-id="b9303-235">Después de configurar el inicio de sesión único con el proveedor de identidades basado en SP-Lite de SAML 2.0, debe comprobar que funciona correctamente.</span><span class="sxs-lookup"><span data-stu-id="b9303-235">After setting up single sign-on with your SAML 2.0 SP-Lite based identity Provider, you should verify that it is working correctly.</span></span>

>[!NOTE]
><span data-ttu-id="b9303-236">Si ha convertido un dominio, en lugar de agregar uno, puede tardar hasta 24 horas en configurar el inicio de sesión único.</span><span class="sxs-lookup"><span data-stu-id="b9303-236">If you converted a domain, rather than adding one, it may take up to 24 hours to set up single sign-on.</span></span>
<span data-ttu-id="b9303-237">Antes de comprobar el inicio de sesión único, debe finalizar la configuración de la sincronización de Active Directory, sincronizar los directorios y activar los usuarios sincronizados.</span><span class="sxs-lookup"><span data-stu-id="b9303-237">Before you verify single sign-on, you should finish setting up Active Directory synchronization, synchronize your directories, and activate your synced users.</span></span>

### <a name="use-the-tool-to-verify-that-single-sign-on-has-been-set-up-correctly"></a><span data-ttu-id="b9303-238">Use la herramienta para comprobar que el inicio de sesión único se ha configurado correctamente</span><span class="sxs-lookup"><span data-stu-id="b9303-238">Use the tool to verify that single sign-on has been set up correctly</span></span>
<span data-ttu-id="b9303-239">Para comprobar que el inicio de sesión único se ha configurado correctamente, puede realizar el procedimiento siguiente para confirmar que puede iniciar sesión en el servicio en la nube con sus credenciales corporativas.</span><span class="sxs-lookup"><span data-stu-id="b9303-239">To verify that single sign-on has been set up correctly, you can perform the following procedure to confirm that you are able to sign in to the cloud service with your corporate credentials.</span></span>

<span data-ttu-id="b9303-240">Microsoft ha proporcionado una herramienta que puede usar para comprobar el proveedor de identidades basado en SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="b9303-240">Microsoft has provided a tool that you can use to test your SAML 2.0 based identity provider.</span></span> <span data-ttu-id="b9303-241">Antes de ejecutar la herramienta de prueba, debe haber configurado un inquilino de Azure AD para federarlo con el proveedor de identidades.</span><span class="sxs-lookup"><span data-stu-id="b9303-241">Before running the test tool you must have configured an Azure AD tenant to federate with your identity provider.</span></span>

>[!NOTE]
><span data-ttu-id="b9303-242">El Analizador de conectividad requiere Internet Explorer 10 o una versión posterior.</span><span class="sxs-lookup"><span data-stu-id="b9303-242">The Connectivity Analyzer requires Internet Explorer 10 or later.</span></span>



1. <span data-ttu-id="b9303-243">Descargue el Analizador de conectividad de [https://testconnectivity.microsoft.com/?tabid=Client](https://testconnectivity.microsoft.com/?tabid=Client).</span><span class="sxs-lookup"><span data-stu-id="b9303-243">Download the Connectivity Analyzer from, [https://testconnectivity.microsoft.com/?tabid=Client](https://testconnectivity.microsoft.com/?tabid=Client).</span></span>
2.  <span data-ttu-id="b9303-244">Haga clic en Instalar ahora para empezar a descargar e instalar la herramienta.</span><span class="sxs-lookup"><span data-stu-id="b9303-244">Click Install Now to begin downloading and installing the tool.</span></span>
3.  <span data-ttu-id="b9303-245">Seleccione “I can’t set up federation with Office 365, Azure, or other services that use Azure Active Directory” (No se puede configurar la federación con Office 365, Azure u otros servicios que usan Azure Active Directory).</span><span class="sxs-lookup"><span data-stu-id="b9303-245">Select “I can’t set up federation with Office 365, Azure, or other services that use Azure Active Directory”.</span></span>
4.  <span data-ttu-id="b9303-246">Una vez que haya descargado la herramienta y esté en funcionamiento, verá la ventana de diagnóstico de conectividad.</span><span class="sxs-lookup"><span data-stu-id="b9303-246">Once the tool is downloaded and running, you will see the Connectivity Diagnostics window.</span></span> <span data-ttu-id="b9303-247">La herramienta le lleva por los pasos para probar la conexión de federación.</span><span class="sxs-lookup"><span data-stu-id="b9303-247">The tool will step you through testing your federation connection.</span></span>
5.  <span data-ttu-id="b9303-248">El Analizador de conectividad abre el IDP de SAML 2.0 para que inicie sesión; escriba las credenciales de la entidad de seguridad de usuario que va a probar: ![SAML](media/active-directory-aadconnect-federation-saml-idp/saml1.png).</span><span class="sxs-lookup"><span data-stu-id="b9303-248">The Connectivity Analyzer will open your SAML 2.0 IDP for you to logon, enter the credentials for the user principal you are testing: ![SAML](media/active-directory-aadconnect-federation-saml-idp/saml1.png)</span></span>
6.  <span data-ttu-id="b9303-249">En la ventana de inicio de sesión de la prueba de federación, debe escribir un nombre de cuenta y una contraseña para el inquilino de Azure AD que está configurado para federarse con el proveedor de identidades de SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="b9303-249">At the Federation test sign-in window you should enter an account name and password for the Azure AD tenant that is configured to be federated with your SAML 2.0 identity provider.</span></span> <span data-ttu-id="b9303-250">La herramienta intentará iniciar sesión con esas credenciales y se mostrará una salida con resultados detallados de las pruebas realizadas durante el intento de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="b9303-250">The tool will attempt to sign-in using those credentials and detailed results of tests performed during the sign-in attempt will be provided as output.</span></span>
<span data-ttu-id="b9303-251">![SAML](media/active-directory-aadconnect-federation-saml-idp/saml2.png)</span><span class="sxs-lookup"><span data-stu-id="b9303-251">![SAML](media/active-directory-aadconnect-federation-saml-idp/saml2.png)</span></span>
7. <span data-ttu-id="b9303-252">En esta ventana se muestra un resultado erróneo de las pruebas.</span><span class="sxs-lookup"><span data-stu-id="b9303-252">This window shows a failed result of testing.</span></span> <span data-ttu-id="b9303-253">Al hacer clic en Review detailed results (Revisar resultados detallados), se muestra información sobre los resultados de cada prueba que se ha realizado.</span><span class="sxs-lookup"><span data-stu-id="b9303-253">Clicking on Review detailed results will show information about the results for each test that was performed.</span></span> <span data-ttu-id="b9303-254">También puede guardar los resultados en el disco para compartirlos.</span><span class="sxs-lookup"><span data-stu-id="b9303-254">You can also save the results to disk in order to share them.</span></span>
 
>[!NOTE]
><span data-ttu-id="b9303-255">El Analizador de conectividad también prueba la federación activa mediante los protocolos ECP/PAOS y basados en WS*.</span><span class="sxs-lookup"><span data-stu-id="b9303-255">The Connectivity analyzer also tests Active Federation using the WS*-based and ECP/PAOS protocols.</span></span> <span data-ttu-id="b9303-256">Si no va a usar estos protocolos, puede hacer caso omiso del siguiente error: "Testing the Active sign-in flow using your identity provider’s Active federation endpoint (Probando el flujo de inicio de sesión activo mediante el punto de conexión de federación activa del proveedor de identidades).</span><span class="sxs-lookup"><span data-stu-id="b9303-256">If you are not using these you can disregard the following error: Testing the Active sign-in flow using your identity provider’s Active federation endpoint.</span></span>

### <a name="manually-verify-that-single-sign-on-has-been-set-up-correctly"></a><span data-ttu-id="b9303-257">Comprobación manual de que el inicio de sesión único se ha configurado correctamente</span><span class="sxs-lookup"><span data-stu-id="b9303-257">Manually verify that single sign-on has been set up correctly</span></span>
<span data-ttu-id="b9303-258">La comprobación manual proporciona pasos adicionales que puede realizar para asegurarse de que el proveedor de identidades de SAML 2.0 funciona correctamente en muchos escenarios.</span><span class="sxs-lookup"><span data-stu-id="b9303-258">Manual verification provides additional steps that you can take to ensure that your SAML 2.0 identity Provider is working properly in many scenarios.</span></span>
<span data-ttu-id="b9303-259">Para comprobar que ese inicio de sesión único se ha configurado correctamente, realice los pasos siguientes:</span><span class="sxs-lookup"><span data-stu-id="b9303-259">To verify that single sign-on has been set up correctly, complete the following steps:</span></span>


1. <span data-ttu-id="b9303-260">En un equipo unido a un dominio, inicie sesión en su servicio en la nube con el mismo nombre de inicio de sesión que usa en las credenciales corporativas.</span><span class="sxs-lookup"><span data-stu-id="b9303-260">On a domain-joined computer, sign in to your cloud service using the same logon name that you use for your corporate credentials.</span></span>
2.  <span data-ttu-id="b9303-261">Haga clic dentro del cuadro de contraseña.</span><span class="sxs-lookup"><span data-stu-id="b9303-261">Click inside the password box.</span></span> <span data-ttu-id="b9303-262">Si el inicio de sesión único está configurado, el cuadro de contraseña aparecerá sombreado y verá un mensaje que le indica que debe iniciar sesión en <your company>.</span><span class="sxs-lookup"><span data-stu-id="b9303-262">If single sign-on is set up, the password box will be shaded, and you will see the following message: “You are now required to sign in at <your company>.”</span></span>
3.  <span data-ttu-id="b9303-263">Haga clic en el vínculo para iniciar sesión en <your company>.</span><span class="sxs-lookup"><span data-stu-id="b9303-263">Click the Sign in at <your company> link.</span></span> <span data-ttu-id="b9303-264">Si puede iniciar sesión, significa que el inicio de sesión único está configurado.</span><span class="sxs-lookup"><span data-stu-id="b9303-264">If you are able to sign in, then single sign-on has been set up.</span></span>

## <a name="next-steps"></a><span data-ttu-id="b9303-265">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="b9303-265">Next Steps</span></span>


- [<span data-ttu-id="b9303-266">Servicios de federación de Active Directory y personalización con Azure AD Connect</span><span class="sxs-lookup"><span data-stu-id="b9303-266">Active Directory Federation Services management and customization with Azure AD Connect</span></span>](active-directory-aadconnect-federation-management.md)
- [<span data-ttu-id="b9303-267">Lista de compatibilidad de federación de AD Azure</span><span class="sxs-lookup"><span data-stu-id="b9303-267">Azure AD federation compatibility list</span></span>](active-directory-aadconnect-federation-compatibility.md)
- [<span data-ttu-id="b9303-268">Instalación personalizada de Azure AD Connect</span><span class="sxs-lookup"><span data-stu-id="b9303-268">Azure AD Connect Custom Installation</span></span>](active-directory-aadconnect-get-started-custom.md)

---
title: "Azure AD Connect: actualización desde una versión anterior | Microsoft Docs"
description: "Se explican los diferentes métodos para realizar la actualización a la versión más reciente de Azure Active Directory Connect, entre los que se incluyen una actualización local y una migración oscilante."
services: active-directory
documentationcenter: 
author: AndKjell
manager: femila
editor: 
ms.assetid: 31f084d8-2b89-478c-9079-76cf92e6618f
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: Identity
ms.date: 07/12/2017
ms.author: billmath
ms.openlocfilehash: 52fd9375c71c42feaf87f4a0f4220e1cb3889e63
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/03/2017
---
# <a name="azure-ad-connect-upgrade-from-a-previous-version-to-the-latest"></a><span data-ttu-id="4e5a6-103">Azure AD Connect: actualización de una versión anterior a la versión más reciente</span><span class="sxs-lookup"><span data-stu-id="4e5a6-103">Azure AD Connect: Upgrade from a previous version to the latest</span></span>
<span data-ttu-id="4e5a6-104">En este tema se describen los distintos métodos que se puede utilizar para actualizar la instalación de Azure Active Directory (Azure AD) Connect a la versión más reciente.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-104">This topic describes the different methods that you can use to upgrade your Azure Active Directory (Azure AD) Connect installation to the latest release.</span></span> <span data-ttu-id="4e5a6-105">Le recomendamos mantenerse al día con las versiones de Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-105">We recommend that you keep yourself current with the releases of Azure AD Connect.</span></span> <span data-ttu-id="4e5a6-106">Los pasos de la sección [Migración oscilante](#swing-migration) también se utilizan al realizar un cambio de configuración considerable.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-106">You also use the steps in the [Swing migration](#swing-migration) section when you make a substantial configuration change.</span></span>

<span data-ttu-id="4e5a6-107">Si quiere actualizar desde DirSync, consulte en su lugar [Azure AD Connect: actualización de Windows Azure Active Directory Sync (DirSync)](active-directory-aadconnect-dirsync-upgrade-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="4e5a6-107">If you want to upgrade from DirSync, see [Upgrade from Azure AD sync tool (DirSync)](active-directory-aadconnect-dirsync-upgrade-get-started.md) instead.</span></span>

<span data-ttu-id="4e5a6-108">Hay algunas estrategias distintas que se pueden usar para actualizar Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-108">There are a few different strategies that you can use to upgrade Azure AD Connect.</span></span>

| <span data-ttu-id="4e5a6-109">Método</span><span class="sxs-lookup"><span data-stu-id="4e5a6-109">Method</span></span> | <span data-ttu-id="4e5a6-110">Description</span><span class="sxs-lookup"><span data-stu-id="4e5a6-110">Description</span></span> |
| --- | --- |
| [<span data-ttu-id="4e5a6-111">Actualización automática</span><span class="sxs-lookup"><span data-stu-id="4e5a6-111">Automatic upgrade</span></span>](active-directory-aadconnect-feature-automatic-upgrade.md) |<span data-ttu-id="4e5a6-112">Este es el método más sencillo para los clientes con una instalación rápida.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-112">This is the easiest method for customers with an express installation.</span></span> |
| [<span data-ttu-id="4e5a6-113">Actualización local</span><span class="sxs-lookup"><span data-stu-id="4e5a6-113">In-place upgrade</span></span>](#in-place-upgrade) |<span data-ttu-id="4e5a6-114">Si tiene un solo servidor, puede actualizar la instalación local en el mismo servidor.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-114">If you have a single server, you can upgrade the installation in-place on the same server.</span></span> |
| [<span data-ttu-id="4e5a6-115">Migración oscilante</span><span class="sxs-lookup"><span data-stu-id="4e5a6-115">Swing migration</span></span>](#swing-migration) |<span data-ttu-id="4e5a6-116">Con dos servidores, puede preparar uno de los servidores con la nueva versión o configuración y cambiar el servidor activo cuando esté listo.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-116">With two servers, you can prepare one of the servers with the new release or configuration, and change the active server when you're ready.</span></span> |

<span data-ttu-id="4e5a6-117">Para obtener información acerca de los permisos, consulte los [permisos requeridos para realizar una actualización](active-directory-aadconnect-accounts-permissions.md#upgrade).</span><span class="sxs-lookup"><span data-stu-id="4e5a6-117">For permissions information, see the [permissions required for an upgrade](active-directory-aadconnect-accounts-permissions.md#upgrade).</span></span>

> [!NOTE]
> <span data-ttu-id="4e5a6-118">Después de que haya habilitado el nuevo servidor de Azure AD Connect para que empiece a sincronizar los cambios en Azure AD, no debe volver a usar DirSync o Sincronización de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-118">After you've enabled your new Azure AD Connect server to start synchronizing changes to Azure AD, you must not roll back to using DirSync or Azure AD Sync.</span></span> <span data-ttu-id="4e5a6-119">No se admite el cambio a una versión anterior de Azure AD Connect de los clientes heredados, entre los que se incluyen DirSync y Sincronización de Azure AD, y puede causar problemas, como la pérdida de datos en Azure AD.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-119">Downgrading from Azure AD Connect to legacy clients, including DirSync and Azure AD Sync, isn't supported and can lead to issues such as data loss in Azure AD.</span></span>

## <a name="in-place-upgrade"></a><span data-ttu-id="4e5a6-120">Actualización local</span><span class="sxs-lookup"><span data-stu-id="4e5a6-120">In-place upgrade</span></span>
<span data-ttu-id="4e5a6-121">Una actualización local sirve para migrar de Azure AD Sync o Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-121">An in-place upgrade works for moving from Azure AD Sync or Azure AD Connect.</span></span> <span data-ttu-id="4e5a6-122">No sirve para mover de DirSync ni para una solución con Forefront Identity Manager (FIM) + Azure AD Connector.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-122">It doesn't work for moving from DirSync or for a solution with Forefront Identity Manager (FIM) + Azure AD Connector.</span></span>

<span data-ttu-id="4e5a6-123">Este método es adecuado cuando tiene un único servidor y menos de unos 100 000 objetos.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-123">This method is preferred when you have a single server and less than about 100,000 objects.</span></span> <span data-ttu-id="4e5a6-124">Si hay cambios en las reglas de sincronización de fábrica, después de la actualización, se producen una importación y una sincronización completas.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-124">If there are any changes to the out-of-box sync rules, a full import and full synchronization occur after the upgrade.</span></span> <span data-ttu-id="4e5a6-125">Este método garantiza que la nueva configuración se aplica a todos los objetos existentes en el sistema.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-125">This method ensures that the new configuration is applied to all existing objects in the system.</span></span> <span data-ttu-id="4e5a6-126">Esta ejecución puede tardar varias horas, según el número de objetos que se encuentren en el ámbito del motor de sincronización.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-126">This run might take a few hours, depending on the number of objects that are in scope of the sync engine.</span></span> <span data-ttu-id="4e5a6-127">La sincronización delta normal programada (que se realiza cada 30 minutos de forma predeterminada) se suspende, pero continúa la sincronización de contraseñas.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-127">The normal delta synchronization scheduler (which synchronizes every 30 minutes by default) is suspended, but password synchronization continues.</span></span> <span data-ttu-id="4e5a6-128">La actualización local se podría realizar durante un fin de semana.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-128">You might consider doing the in-place upgrade during a weekend.</span></span> <span data-ttu-id="4e5a6-129">Si no hay ningún cambio en la configuración de fábrica con la nueva versión de Azure AD Connect, en su lugar se inicia una importación y sincronización delta normales.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-129">If there are no changes to the out-of-box configuration with the new Azure AD Connect release, then a normal delta import/sync starts instead.</span></span>  
![Actualización local](./media/active-directory-aadconnect-upgrade-previous-version/inplaceupgrade.png)

<span data-ttu-id="4e5a6-131">Si se realizaron cambios en las reglas de sincronización originales, estas volverán a su configuración predeterminada tras la actualización.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-131">If you've made changes to the out-of-box synchronization rules, then these rules are set back to the default configuration on upgrade.</span></span> <span data-ttu-id="4e5a6-132">Para asegurarse de que la configuración se mantiene entre una actualización y la siguiente, asegúrese de que los cambios se realizan como se describe en [Azure AD Connect Sync: procedimientos recomendados de cambio de la configuración predeterminada](active-directory-aadconnectsync-best-practices-changing-default-configuration.md).</span><span class="sxs-lookup"><span data-stu-id="4e5a6-132">To make sure that your configuration is kept between upgrades, make sure that you make changes as they're described in [Best practices for changing the default configuration](active-directory-aadconnectsync-best-practices-changing-default-configuration.md).</span></span>

<span data-ttu-id="4e5a6-133">Durante la actualización en contexto, puede que se hayan introducido cambios que requieran que se ejecuten actividades específicas de sincronización (incluidos los pasos de importación completa y sincronización completa) una vez completada la actualización.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-133">During in-place upgrade, there may be changes introduced that require specific synchronization activities (including Full Import step and Full Synchronization step) to be executed after upgrade completes.</span></span> <span data-ttu-id="4e5a6-134">Para aplazar estas actividades, consulte la sección [Aplazamiento de la sincronización completa después de la actualización](#how-to-defer-full-synchronization-after-upgrade).</span><span class="sxs-lookup"><span data-stu-id="4e5a6-134">To defer such activities, refer to section [How to defer full synchronization after upgrade](#how-to-defer-full-synchronization-after-upgrade).</span></span>

## <a name="swing-migration"></a><span data-ttu-id="4e5a6-135">Migración oscilante</span><span class="sxs-lookup"><span data-stu-id="4e5a6-135">Swing migration</span></span>
<span data-ttu-id="4e5a6-136">Si tiene una implementación compleja o muchos objetos, puede que no resulte práctico realizar una actualización local en el sistema activo.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-136">If you have a complex deployment or many objects, it might be impractical to do an in-place upgrade on the live system.</span></span> <span data-ttu-id="4e5a6-137">En el caso de algunos clientes, este proceso podría tardar varios días y durante este tiempo no se procesará ningún cambio delta.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-137">For some customers, this process might take multiple days--and during this time, no delta changes are processed.</span></span> <span data-ttu-id="4e5a6-138">Este método también se puede utilizar cuando se planea realizar cambios sustanciales en la configuración y se desea probarlos antes de insertarlos en la nube.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-138">You can also use this method when you plan to make substantial changes to your configuration and you want to try them out before they're pushed to the cloud.</span></span>

<span data-ttu-id="4e5a6-139">El método recomendado para estos escenarios es usar una migración oscilante.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-139">The recommended method for these scenarios is to use a swing migration.</span></span> <span data-ttu-id="4e5a6-140">Se necesitan (al menos) dos servidores, uno activo y otro provisional.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-140">You need (at least) two servers--one active server and one staging server.</span></span> <span data-ttu-id="4e5a6-141">El primero (que se muestra con líneas azules continuas en la siguiente imagen) es el responsable de la carga de producción activa.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-141">The active server (shown with solid blue lines in the following picture) is responsible for the active production load.</span></span> <span data-ttu-id="4e5a6-142">El segundo (que se muestra con líneas discontinuas de color púrpura) está preparado con la nueva versión o configuración.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-142">The staging server (shown with dashed purple lines) is prepared with the new release or configuration.</span></span> <span data-ttu-id="4e5a6-143">Cuando esté totalmente preparado, se activa el servidor.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-143">When it's fully ready, this server is made active.</span></span> <span data-ttu-id="4e5a6-144">El servidor activo anterior, que ahora tiene la versión o configuración anteriores instaladas, se convierte en el servidor provisional y se actualiza.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-144">The previous active server, which now has the old version or configuration installed, is made into the staging server and is upgraded.</span></span>

<span data-ttu-id="4e5a6-145">Los dos servidores pueden usar versiones diferentes.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-145">The two servers can use different versions.</span></span> <span data-ttu-id="4e5a6-146">Por ejemplo, el servidor activo que planea retirar puede utilizar Sincronización de Azure AD y el nuevo servidor de ensayo puede usar Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-146">For example, the active server that you plan to decommission can use Azure AD Sync, and the new staging server can use Azure AD Connect.</span></span> <span data-ttu-id="4e5a6-147">Si usa la migración oscilante para desarrollar una configuración nueva, es aconsejable tener las mismas versiones en ambos servidores.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-147">If you use swing migration to develop a new configuration, it's a good idea to have the same versions on the two servers.</span></span>  
![Servidor provisional](./media/active-directory-aadconnect-upgrade-previous-version/stagingserver1.png)

> [!NOTE]
> <span data-ttu-id="4e5a6-149">Algunos clientes prefieren tener tres o cuatro servidores para este escenario.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-149">Some customers prefer to have three or four servers for this scenario.</span></span> <span data-ttu-id="4e5a6-150">Cuando se actualiza el servidor de ensayo, deja de tenerse un servidor de copia de seguridad para la [recuperación ante desastres](active-directory-aadconnectsync-operations.md#disaster-recovery).</span><span class="sxs-lookup"><span data-stu-id="4e5a6-150">When the staging server is upgraded, you don't have a backup server for [disaster recovery](active-directory-aadconnectsync-operations.md#disaster-recovery).</span></span> <span data-ttu-id="4e5a6-151">Con tres o cuatro servidores, se puede preparar un conjunto de servidores principales o en espera con la nueva versión, lo que garantiza que siempre hay un servidor provisional listo para tomar el control.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-151">With three or four servers, you can prepare one set of primary/standby servers with the new version, which ensures that there is always a staging server that's ready to take over.</span></span>

<span data-ttu-id="4e5a6-152">Estos pasos también sirven para migrar de Azure AD Sync o de una solución con FIM + Azure AD Connector.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-152">These steps also work to move from Azure AD Sync or a solution with FIM + Azure AD Connector.</span></span> <span data-ttu-id="4e5a6-153">Estos pasos no sirven para DirSync, pero el mismo método de migración oscilante (también llamada implementación paralela) con los pasos para DirSync se encuentra en [Azure AD Connect: actualización de Azure Active Directory Sync (DirSync)](active-directory-aadconnect-dirsync-upgrade-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="4e5a6-153">These steps don't work for DirSync, but the same swing migration method (also called parallel deployment) with steps for DirSync is in [Upgrade Azure Active Directory sync (DirSync)](active-directory-aadconnect-dirsync-upgrade-get-started.md).</span></span>

### <a name="use-a-swing-migration-to-upgrade"></a><span data-ttu-id="4e5a6-154">Uso de una migración oscilante para realizar la actualización</span><span class="sxs-lookup"><span data-stu-id="4e5a6-154">Use a swing migration to upgrade</span></span>
1. <span data-ttu-id="4e5a6-155">Si usa Azure AD Connect en ambos servidores y planea realizar solo un cambio en la configuración, asegúrese de que tanto el servidor activo como el provisional utilizan la misma versión.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-155">If you use Azure AD Connect on both servers and plan to only make a configuration change, make sure that your active server and staging server are both using the same version.</span></span> <span data-ttu-id="4e5a6-156">Esto facilitará la posterior comparación para detectar diferencias.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-156">That makes it easier to compare differences later.</span></span> <span data-ttu-id="4e5a6-157">Si va a realizar la actualización desde Sincronización de Azure AD, los servidores tienen versiones diferentes.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-157">If you're upgrading from Azure AD Sync, then these servers have different versions.</span></span> <span data-ttu-id="4e5a6-158">Si va a realizar la actualización desde una versión anterior de Azure AD Connect, es aconsejable que comience por los dos servidores que tengan la misma versión, pero no es obligatorio.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-158">If you're upgrading from an older version of Azure AD Connect, it's a good idea to start with the two servers that are using the same version, but it's not required.</span></span>
2. <span data-ttu-id="4e5a6-159">Si ha realizado una configuración personalizada y el servidor provisional no la tiene, siga los pasos que se indican en [Movimiento de una configuración personalizada del servidor activo al servidor provisional](#move-custom-configuration-from-active-to-staging-server).</span><span class="sxs-lookup"><span data-stu-id="4e5a6-159">If you've made a custom configuration and your staging server doesn't have it, follow the steps under [Move a custom configuration from the active server to the staging server](#move-custom-configuration-from-active-to-staging-server).</span></span>
3. <span data-ttu-id="4e5a6-160">Si va a realizar la actualización desde una versión anterior de Azure AD Connect, actualice el servidor provisional a la versión más reciente.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-160">If you're upgrading from an earlier release of Azure AD Connect, upgrade the staging server to the latest version.</span></span> <span data-ttu-id="4e5a6-161">Si va a migrar desde Sincronización de Azure AD, instale Azure AD Connect en el servidor provisional.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-161">If you're moving from Azure AD Sync, then install Azure AD Connect on your staging server.</span></span>
4. <span data-ttu-id="4e5a6-162">Permita que el motor de sincronización ejecute la importación y la sincronización completas en el servidor provisional.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-162">Let the sync engine run full import and full synchronization on your staging server.</span></span>
5. <span data-ttu-id="4e5a6-163">Compruebe que la nueva configuración no ha provocado cambios inesperados, para lo que puede seguir los pasos de que se indican en "Verificar" en [Comprobación de la configuración de un servidor](active-directory-aadconnectsync-operations.md#verify-the-configuration-of-a-server).</span><span class="sxs-lookup"><span data-stu-id="4e5a6-163">Verify that the new configuration didn't cause any unexpected changes by using the steps under "Verify" in [Verify the configuration of a server](active-directory-aadconnectsync-operations.md#verify-the-configuration-of-a-server).</span></span> <span data-ttu-id="4e5a6-164">Si algo no funciona según lo esperado, corríjalo, ejecute la importación y la sincronización, y compruebe los datos hasta que estén a su gusto, siguiendo los pasos anteriores.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-164">If something isn't as expected, correct it, run the import and sync, and verify the data until it looks good, by following the steps.</span></span>
6. <span data-ttu-id="4e5a6-165">Cambie el servidor de ensayo para que sea el servidor activo.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-165">Switch the staging server to be the active server.</span></span> <span data-ttu-id="4e5a6-166">Este es el paso final: "Cambio de servidor activo" en [Comprobación de la configuración de un servidor](active-directory-aadconnectsync-operations.md#verify-the-configuration-of-a-server).</span><span class="sxs-lookup"><span data-stu-id="4e5a6-166">This is the final step "Switch active server" in [Verify the configuration of a server](active-directory-aadconnectsync-operations.md#verify-the-configuration-of-a-server).</span></span>
7. <span data-ttu-id="4e5a6-167">Si va a actualizar Azure AD Connect, actualice el servidor que está actualmente en modo provisional a la versión más reciente.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-167">If you're upgrading Azure AD Connect, upgrade the server that's now in staging mode to the latest release.</span></span> <span data-ttu-id="4e5a6-168">Siga los mismos pasos que antes para actualizar los datos y la configuración.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-168">Follow the same steps as before to get the data and configuration upgraded.</span></span> <span data-ttu-id="4e5a6-169">Si va a actualizar desde Azure AD Sync, puede desactivar y retirar el servidor anterior.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-169">If you upgraded from Azure AD Sync, you can now turn off and decommission your old server.</span></span>

### <a name="move-a-custom-configuration-from-the-active-server-to-the-staging-server"></a><span data-ttu-id="4e5a6-170">Movimiento de una configuración personalizada del servidor activo al servidor provisional</span><span class="sxs-lookup"><span data-stu-id="4e5a6-170">Move a custom configuration from the active server to the staging server</span></span>
<span data-ttu-id="4e5a6-171">Si ha realizado cambios en la configuración del servidor activo, debe asegurarse de que los mismos cambios se aplican en el servidor provisional.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-171">If you've made configuration changes to the active server, you need to make sure that the same changes are applied to the staging server.</span></span> <span data-ttu-id="4e5a6-172">Para ayudar a solucionar este cambio, puede usar el [documentador de configuración de Azure AD Connect](https://github.com/Microsoft/AADConnectConfigDocumenter).</span><span class="sxs-lookup"><span data-stu-id="4e5a6-172">To help with this move, you can use the [Azure AD Connect configuration documenter](https://github.com/Microsoft/AADConnectConfigDocumenter).</span></span>

<span data-ttu-id="4e5a6-173">Puede mover las reglas de la sincronización personalizada que ha creado mediante PowerShell.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-173">You can move the custom sync rules that you've created by using PowerShell.</span></span> <span data-ttu-id="4e5a6-174">Si realiza otros cambios, debe aplicarlos de la misma manera en ambos sistemas, y no puede migrarlos.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-174">You must apply other changes the same way on both systems, and you can't migrate the changes.</span></span> <span data-ttu-id="4e5a6-175">El [documentador de configuración](https://github.com/Microsoft/AADConnectConfigDocumenter) puede ayudar a comparar los dos sistemas para asegurarse de que son idénticos.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-175">The [configuration documenter](https://github.com/Microsoft/AADConnectConfigDocumenter) can help you comparing the two systems to make sure they are identical.</span></span> <span data-ttu-id="4e5a6-176">La herramienta también puede ayudar a automatizar los pasos descritos en esta sección.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-176">The tool can also help in automating the steps found in this section.</span></span>

<span data-ttu-id="4e5a6-177">Debe configurar los siguientes de la misma forma en ambos servidores:</span><span class="sxs-lookup"><span data-stu-id="4e5a6-177">You need to configure the following things the same way on both servers:</span></span>

* <span data-ttu-id="4e5a6-178">Conexión a los mismos bosques</span><span class="sxs-lookup"><span data-stu-id="4e5a6-178">Connection to the same forests</span></span>
* <span data-ttu-id="4e5a6-179">Filtrado por dominio y unidad organizativa</span><span class="sxs-lookup"><span data-stu-id="4e5a6-179">Any domain and OU filtering</span></span>
* <span data-ttu-id="4e5a6-180">Las mismas características opcionales, como la sincronización de contraseña y la escritura diferida de contraseñas</span><span class="sxs-lookup"><span data-stu-id="4e5a6-180">The same optional features, such as password sync and password writeback</span></span>

<span data-ttu-id="4e5a6-181">**Movimiento las reglas de sincronización personalizadas**</span><span class="sxs-lookup"><span data-stu-id="4e5a6-181">**Move custom synchronization rules**</span></span>  
<span data-ttu-id="4e5a6-182">Para mover reglas de sincronización personalizadas, siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="4e5a6-182">To move custom synchronization rules, do the following:</span></span>

1. <span data-ttu-id="4e5a6-183">Abra el **Editor de reglas de sincronización** en el servidor activo.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-183">Open **Synchronization Rules Editor** on your active server.</span></span>
2. <span data-ttu-id="4e5a6-184">Seleccione una regla personalizada.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-184">Select a custom rule.</span></span> <span data-ttu-id="4e5a6-185">Haga clic en **Exportar**.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-185">Click **Export**.</span></span> <span data-ttu-id="4e5a6-186">Se abre una ventana del Bloc de notas.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-186">This brings up a Notepad window.</span></span> <span data-ttu-id="4e5a6-187">Guarde el archivo temporal con una extensión PS1.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-187">Save the temporary file with a PS1 extension.</span></span> <span data-ttu-id="4e5a6-188">Lo convierte en un script de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-188">This makes it a PowerShell script.</span></span> <span data-ttu-id="4e5a6-189">Copie el archivo PS1 en el servidor provisional.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-189">Copy the PS1 file to the staging server.</span></span>  
   <span data-ttu-id="4e5a6-190">![Exportación de reglas de sincronización](./media/active-directory-aadconnect-upgrade-previous-version/exportrule.png)</span><span class="sxs-lookup"><span data-stu-id="4e5a6-190">![Sync rule export](./media/active-directory-aadconnect-upgrade-previous-version/exportrule.png)</span></span>
3. <span data-ttu-id="4e5a6-191">El GUID del Conector del servidor provisional es diferente, por lo que debe cambiarse.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-191">The Connector GUID is different on the staging server, and you must change it.</span></span> <span data-ttu-id="4e5a6-192">Para obtener el GUID, inicie el **Editor de reglas de sincronización**, seleccione una de las reglas originales que represente el mismo sistema conectado y haga clic en **Exportar**.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-192">To get the GUID, start **Synchronization Rules Editor**, select one of the out-of-box rules that represent the same connected system, and click **Export**.</span></span> <span data-ttu-id="4e5a6-193">Reemplace el GUID del archivo PS1 por el GUID del servidor de ensayo.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-193">Replace the GUID in your PS1 file with the GUID from the staging server.</span></span>
4. <span data-ttu-id="4e5a6-194">En un símbolo del sistema de PowerShell, ejecute el archivo PS1.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-194">In a PowerShell prompt, run the PS1 file.</span></span> <span data-ttu-id="4e5a6-195">Esta acción crea la regla de sincronización personalizada en el servidor provisional.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-195">This creates the custom synchronization rule on the staging server.</span></span>
5. <span data-ttu-id="4e5a6-196">Repita esta operación para todas las reglas personalizadas.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-196">Repeat this for all your custom rules.</span></span>

## <a name="how-to-defer-full-synchronization-after-upgrade"></a><span data-ttu-id="4e5a6-197">Aplazamiento de la sincronización completa después de la actualización</span><span class="sxs-lookup"><span data-stu-id="4e5a6-197">How to defer full synchronization after upgrade</span></span>
<span data-ttu-id="4e5a6-198">Durante la actualización en contexto, puede que se hayan introducido cambios que requieran que se ejecuten actividades específicas de sincronización (incluidos los pasos de importación completa y sincronización completa).</span><span class="sxs-lookup"><span data-stu-id="4e5a6-198">During in-place upgrade, there may be changes introduced that require specific synchronization activities (including Full Import step and Full Synchronization step) to be executed.</span></span> <span data-ttu-id="4e5a6-199">Por ejemplo, los cambios de esquema de conector requieren que se ejecute el paso de **importación completa** y los cambios de regla de sincronización de serie requieren que se ejecute el paso de **sincronización completa** en los conectores afectados.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-199">For example, connector schema changes require **full import** step and out-of-box synchronization rule changes require **full synchronization** step to be executed on affected connectors.</span></span> <span data-ttu-id="4e5a6-200">Durante la actualización, Azure AD Connect determina las actividades de sincronización que son necesarias y las registra como *invalidaciones*.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-200">During upgrade, Azure AD Connect determines what synchronization activities are required and records them as *overrides*.</span></span> <span data-ttu-id="4e5a6-201">En el siguiente ciclo de sincronización, el programador de sincronización selecciona estas invalidaciones y las ejecuta.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-201">In the following synchronization cycle, the synchronization scheduler picks up these overrides and executes them.</span></span> <span data-ttu-id="4e5a6-202">Una vez ejecutada correctamente una invalidación, se quita.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-202">Once an override is successfully executed, it is removed.</span></span>

<span data-ttu-id="4e5a6-203">Puede que haya situaciones en las no quiere que estas invalidaciones se produzcan inmediatamente después de actualizar.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-203">There may be situations where you do not want these overrides to take place immediately after upgrade.</span></span> <span data-ttu-id="4e5a6-204">Por ejemplo, tiene numerosos objetos sincronizados y quiere que estos pasos de sincronización se produzcan después del horario comercial.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-204">For example, you have numerous synchronized objects and you would like these synchronization steps to occur after business hours.</span></span> <span data-ttu-id="4e5a6-205">Para quitar estas invalidaciones:</span><span class="sxs-lookup"><span data-stu-id="4e5a6-205">To remove these overrides:</span></span>

1. <span data-ttu-id="4e5a6-206">Durante la actualización, **desactive** la opción **Inicie el proceso de sincronización cuando se complete la configuración**.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-206">During upgrade, **uncheck** the option **Start the synchronization process when configuration completes**.</span></span> <span data-ttu-id="4e5a6-207">Así, deshabilita el programador de sincronización e impide que el ciclo de sincronización se produzca automáticamente antes de quitar las invalidaciones.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-207">This disables the synchronization scheduler and prevents synchronization cycle from taking place automatically before the overrides are removed.</span></span>

   ![DisableFullSyncAfterUpgrade](./media/active-directory-aadconnect-upgrade-previous-version/disablefullsync01.png)

2. <span data-ttu-id="4e5a6-209">Una vez completada la actualización, ejecute el siguiente cmdlet para averiguar qué invalidaciones se han agregado: `Get-ADSyncSchedulerConnectorOverride | fl`</span><span class="sxs-lookup"><span data-stu-id="4e5a6-209">After upgrade completes, run the following cmdlet to find out what overrides have been added: `Get-ADSyncSchedulerConnectorOverride | fl`</span></span>

   >[!NOTE]
   > <span data-ttu-id="4e5a6-210">Las invalidaciones son específicas del conector.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-210">The overrides are connector-specific.</span></span> <span data-ttu-id="4e5a6-211">En el ejemplo siguiente, se han agregado los pasos de importación completa y sincronización completa al conector AD local y a Azure AD Connector.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-211">In the following example, Full Import step and Full Synchronization step have been added to both the on-premises AD Connector and Azure AD Connector.</span></span>

   ![DisableFullSyncAfterUpgrade](./media/active-directory-aadconnect-upgrade-previous-version/disablefullsync02.png)

3. <span data-ttu-id="4e5a6-213">Anote las invalidaciones existentes que se han agregado.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-213">Note down the existing overrides that have been added.</span></span>
   
4. <span data-ttu-id="4e5a6-214">Para quitar las invalidaciones de importación completa y sincronización completa de un conector arbitrario, ejecute el siguiente cmdlet: `Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier <Guid-of-ConnectorIdentifier> -FullImportRequired $false -FullSyncRequired $false`</span><span class="sxs-lookup"><span data-stu-id="4e5a6-214">To remove the overrides for both full import and full synchronization on an arbitrary connector, run the following cmdlet: `Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier <Guid-of-ConnectorIdentifier> -FullImportRequired $false -FullSyncRequired $false`</span></span>

   <span data-ttu-id="4e5a6-215">Para quitar las invalidaciones de todos los conectores, ejecute el siguiente script de PowerShell:</span><span class="sxs-lookup"><span data-stu-id="4e5a6-215">To remove the overrides on all connectors, execute the following PowerShell script:</span></span>

   ```
   foreach ($connectorOverride in Get-ADSyncSchedulerConnectorOverride)
   {
       Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier $connectorOverride.ConnectorIdentifier.Guid -FullSyncRequired $false -FullImportRequired $false
   }
   ```

5. <span data-ttu-id="4e5a6-216">Para reanudar el programador, ejecute el cmdlet siguiente: `Set-ADSyncScheduler -SyncCycleEnabled $true`</span><span class="sxs-lookup"><span data-stu-id="4e5a6-216">To resume the scheduler, run the following cmdlet: `Set-ADSyncScheduler -SyncCycleEnabled $true`</span></span>

   >[!IMPORTANT]
   > <span data-ttu-id="4e5a6-217">No olvide ejecutar lo antes posible los pasos de sincronización necesarios.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-217">Remember to execute the required synchronization steps at your earliest convenience.</span></span> <span data-ttu-id="4e5a6-218">Puede ejecutar estos pasos manualmente con el Synchronization Service Manager o volver a agregar las invalidaciones con el cmdlet Set-ADSyncSchedulerConnectorOverride.</span><span class="sxs-lookup"><span data-stu-id="4e5a6-218">You can either manually execute these steps using the Synchronization Service Manager or add the overrides back using the Set-ADSyncSchedulerConnectorOverride cmdlet.</span></span>

<span data-ttu-id="4e5a6-219">Para agregar las invalidaciones de importación completa y sincronización completa en un conector arbitrario, ejecute el siguiente cmdlet: `Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier <Guid> -FullImportRequired $true -FullSyncRequired $true`</span><span class="sxs-lookup"><span data-stu-id="4e5a6-219">To add the overrides for both full import and full synchronization on an arbitrary connector, run the following cmdlet:  `Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier <Guid> -FullImportRequired $true -FullSyncRequired $true`</span></span>

## <a name="next-steps"></a><span data-ttu-id="4e5a6-220">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="4e5a6-220">Next steps</span></span>
<span data-ttu-id="4e5a6-221">Más información acerca de la [integración de las identidades locales con Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="4e5a6-221">Learn more about [integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>

---
title: "Servicios de federación de Active Directory en Azure | Microsoft Docs"
description: "En este documento aprenderá cómo implementar AD FS en Azure para alta disponibilidad."
keywords: "implementar AD FS en azure, implementar azure adfs, azure ad fs, implementar adfs, implementar ad fs, adfs en azure, implementar adfs en azure, implementar AD FS en azure, adfs azure, introducción a AD FS, Azure, AD FS en Azure, iaas, ADFS, mover adfs a azure"
services: active-directory
documentationcenter: 
author: anandyadavmsft
manager: femila
editor: 
ms.assetid: 692a188c-badc-44aa-ba86-71c0e8074510
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 07/17/2017
ms.author: anandy; billmath
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: ddd29a1230286de8999175498ee793f3b3ea24e2
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/03/2017
---
# <a name="deploying-active-directory-federation-services-in-azure"></a><span data-ttu-id="77944-104">Implementación de Active Directory Federation Services en Azure</span><span class="sxs-lookup"><span data-stu-id="77944-104">Deploying Active Directory Federation Services in Azure</span></span>
<span data-ttu-id="77944-105">AD FS proporciona funcionalidades de una federación de identidades simplificada y protegida, así como de inicio de sesión único (SSO) web.</span><span class="sxs-lookup"><span data-stu-id="77944-105">AD FS provides simplified, secured identity federation and Web single sign-on (SSO) capabilities.</span></span> <span data-ttu-id="77944-106">La federación con Azure AD u Office 365 permite a los usuarios autenticarse con credenciales locales y acceder a todos los recursos en la nube.</span><span class="sxs-lookup"><span data-stu-id="77944-106">Federation with Azure AD or O365 enables users to authenticate using on-premises credentials and access all resources in cloud.</span></span> <span data-ttu-id="77944-107">Por tanto, es importante disponer de una infraestructura de AD FS de alta disponibilidad para garantizar el acceso a los recursos locales y en la nube.</span><span class="sxs-lookup"><span data-stu-id="77944-107">As a result, it becomes important to have a highly available AD FS infrastructure to ensure access to resources both on-premises and in the cloud.</span></span> <span data-ttu-id="77944-108">La implementación de AD FS en Azure puede ayudar a lograr la alta disponibilidad necesaria con el mínimo esfuerzo.</span><span class="sxs-lookup"><span data-stu-id="77944-108">Deploying AD FS in Azure can help achieve the high availability required with minimal efforts.</span></span>
<span data-ttu-id="77944-109">La implementación de AD FS en Azure tiene varias ventajas; a continuación se enumeran algunas:</span><span class="sxs-lookup"><span data-stu-id="77944-109">There are several advantages of deploying AD FS in Azure, a few of them are listed below:</span></span>

* <span data-ttu-id="77944-110">**Alta disponibilidad** : con la potencia de Conjuntos de disponibilidad de Azure, se asegura una infraestructura de alta disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="77944-110">**High Availability** - With the power of Azure Availability Sets, you ensure a highly available infrastructure.</span></span>
* <span data-ttu-id="77944-111">**Fácil de escalar** : ¿necesita más rendimiento?</span><span class="sxs-lookup"><span data-stu-id="77944-111">**Easy to Scale** – Need more performance?</span></span> <span data-ttu-id="77944-112">Migre fácilmente a máquinas más eficaces con solo unos clics en Azure.</span><span class="sxs-lookup"><span data-stu-id="77944-112">Easily migrate to more powerful machines by just a few clicks in Azure</span></span>
* <span data-ttu-id="77944-113">**Redundancia geográfica cruzada** : con la redundancia geográfica de Azure puede estar seguro de que su infraestructura tiene alta disponibilidad en todo el mundo.</span><span class="sxs-lookup"><span data-stu-id="77944-113">**Cross-Geo Redundancy** – With Azure Geo Redundancy you can be assured that your infrastructure is highly available across the globe</span></span>
* <span data-ttu-id="77944-114">**Fácil de administrar** : con opciones de administración muy simplificadas en Azure Portal, administrar su infraestructura es muy fácil y sin complicaciones.</span><span class="sxs-lookup"><span data-stu-id="77944-114">**Easy to Manage** – With highly simplified management options in Azure portal, managing your infrastructure is very easy and hassle-free</span></span> 

## <a name="design-principles"></a><span data-ttu-id="77944-115">Principios de diseño</span><span class="sxs-lookup"><span data-stu-id="77944-115">Design principles</span></span>
![Diseño de la implementación](./media/active-directory-aadconnect-azure-adfs/deployment.png)

<span data-ttu-id="77944-117">El diagrama anterior muestra la topología básica recomendada para empezar a implementar la infraestructura de AD FS en Azure.</span><span class="sxs-lookup"><span data-stu-id="77944-117">The diagram above shows the recommended basic topology to start deploying your AD FS infrastructure in Azure.</span></span> <span data-ttu-id="77944-118">Los principios de los distintos componentes de la topología son los siguientes:</span><span class="sxs-lookup"><span data-stu-id="77944-118">The principles behind the various components of the topology are listed below:</span></span>

* <span data-ttu-id="77944-119">**Servidores de ADFS/controlador de dominio**: si tiene menos de 1000 usuarios, simplemente puede instalar el rol de AD FS en los controladores de dominio.</span><span class="sxs-lookup"><span data-stu-id="77944-119">**DC / ADFS Servers**: If you have fewer than 1,000 users you can simply install AD FS role on your domain controllers.</span></span> <span data-ttu-id="77944-120">Si no desea que afecte al rendimiento de los controladores de dominio o si tiene más de 1000 usuarios, implemente AD FS en servidores independientes.</span><span class="sxs-lookup"><span data-stu-id="77944-120">If you do not want any performance impact on the domain controllers or if you have more than 1,000 users, then deploy AD FS on separate servers.</span></span>
* <span data-ttu-id="77944-121">**Servidor WAP** : es necesario implementar servidores proxy de aplicación web para que los usuarios también puedan acceder a AD FS cuando no están en la red de la empresa.</span><span class="sxs-lookup"><span data-stu-id="77944-121">**WAP Server** – it is necessary to deploy Web Application Proxy servers, so that users can reach the AD FS when they are not on the company network also.</span></span>
* <span data-ttu-id="77944-122">**DMZ**: los servidores proxy de aplicación web se colocarán en la red perimetral, y SOLO se permite el acceso a TCP/443 entre dicha red y la subred interna.</span><span class="sxs-lookup"><span data-stu-id="77944-122">**DMZ**: The Web Application Proxy servers will be placed in the DMZ and ONLY TCP/443 access is allowed between the DMZ and the internal subnet.</span></span>
* <span data-ttu-id="77944-123">**Equilibradores de carga**: para garantizar la alta disponibilidad de servidores proxy de aplicación web y AD FS se recomienda utilizar un equilibrador de carga interno para servidores AD FS y Azure Load Balancer para los servidores proxy de aplicación web.</span><span class="sxs-lookup"><span data-stu-id="77944-123">**Load Balancers**: To ensure high availability of AD FS and Web Application Proxy servers, we recommend using an internal load balancer for AD FS servers and Azure Load Balancer for Web Application Proxy servers.</span></span>
* <span data-ttu-id="77944-124">**Conjuntos de disponibilidad**: para proporcionar redundancia a la implementación de AD FS, se recomienda agrupar dos o más máquinas virtuales en un conjunto de disponibilidad para cargas de trabajo similares.</span><span class="sxs-lookup"><span data-stu-id="77944-124">**Availability Sets**: To provide redundancy to your AD FS deployment, it is recommended that you group two or more virtual machines in an Availability Set for similar workloads.</span></span> <span data-ttu-id="77944-125">Esta configuración garantiza que durante un evento de mantenimiento planeado o no planeado, al menos una máquina virtual estará disponible.</span><span class="sxs-lookup"><span data-stu-id="77944-125">This configuration ensures that during either a planned or unplanned maintenance event, at least one virtual machine will be available</span></span>
* <span data-ttu-id="77944-126">**Cuentas de almacenamiento**: se recomienda tener dos cuentas de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="77944-126">**Storage Accounts**: It is recommended to have two storage accounts.</span></span> <span data-ttu-id="77944-127">Tener una cuenta de almacenamiento única puede llevar a la creación de un único punto de error y puede provocar que la implementación no esté disponible en un escenario poco probable, en el que la cuenta de almacenamiento deje de funcionar.</span><span class="sxs-lookup"><span data-stu-id="77944-127">Having a single storage account can lead to creation of a single point of failure and can cause the deployment to become unavailable in an unlikely scenario where the storage account goes down.</span></span> <span data-ttu-id="77944-128">Dos cuentas de almacenamiento ayudarán a asociar una cuenta de almacenamiento para cada línea con errores.</span><span class="sxs-lookup"><span data-stu-id="77944-128">Two storage accounts will help associate one storage account for each fault line.</span></span>
* <span data-ttu-id="77944-129">**Segregación de la red**: los servidores proxy de aplicación web se deben implementar en una red perimetral independiente.</span><span class="sxs-lookup"><span data-stu-id="77944-129">**Network segregation**:  Web Application Proxy servers should be deployed in a separate DMZ network.</span></span> <span data-ttu-id="77944-130">Puede dividir una red virtual en dos subredes y, a continuación, implementar los servidores proxy de aplicación web en una subred aislada.</span><span class="sxs-lookup"><span data-stu-id="77944-130">You can divide one virtual network into two subnets and then deploy the Web Application Proxy server(s) in an isolated subnet.</span></span> <span data-ttu-id="77944-131">Simplemente, puede definir la configuración del grupo de seguridad de red para cada subred y permitir solo la comunicación necesaria entre las dos subredes.</span><span class="sxs-lookup"><span data-stu-id="77944-131">You can simply configure the network security group settings for each subnet and allow only required communication between the two subnets.</span></span> <span data-ttu-id="77944-132">A continuación se proporcionan más detalles para cada escenario de implementación</span><span class="sxs-lookup"><span data-stu-id="77944-132">More details are given per deployment scenario below</span></span>

## <a name="steps-to-deploy-ad-fs-in-azure"></a><span data-ttu-id="77944-133">Pasos para implementar AD FS en Azure</span><span class="sxs-lookup"><span data-stu-id="77944-133">Steps to deploy AD FS in Azure</span></span>
<span data-ttu-id="77944-134">Los pasos mencionados en esta sección describen las directrices para implementar la siguiente infraestructura de AD FS en Azure.</span><span class="sxs-lookup"><span data-stu-id="77944-134">The steps mentioned in this section outline the guide to deploy the below depicted AD FS infrastructure in Azure.</span></span>

### <a name="1-deploying-the-network"></a><span data-ttu-id="77944-135">1. Implementación de la red</span><span class="sxs-lookup"><span data-stu-id="77944-135">1. Deploying the network</span></span>
<span data-ttu-id="77944-136">Como se describió anteriormente, puede crear dos subredes en una única red virtual, o bien crear dos redes virtuales completamente diferentes.</span><span class="sxs-lookup"><span data-stu-id="77944-136">As outlined above, you can either create two subnets in a single virtual network or else create two completely different virtual networks (VNet).</span></span> <span data-ttu-id="77944-137">Este artículo se centrará en la implementación de una única red virtual y la dividirá en dos subredes.</span><span class="sxs-lookup"><span data-stu-id="77944-137">This article will focus on deploying a single virtual network and divide it into two subnets.</span></span> <span data-ttu-id="77944-138">Actualmente, este enfoque es más sencillo, ya que dos redes virtuales independientes requerirían una puerta de enlace de red virtual a red virtual para las comunicaciones.</span><span class="sxs-lookup"><span data-stu-id="77944-138">This is currently an easier approach as two separate VNets would require a VNet to VNet gateway for communications.</span></span>

<span data-ttu-id="77944-139">**1.1 Creación de una red virtual**</span><span class="sxs-lookup"><span data-stu-id="77944-139">**1.1 Create virtual network**</span></span>

![Creación de una red virtual](./media/active-directory-aadconnect-azure-adfs/deploynetwork1.png)

<span data-ttu-id="77944-141">Seleccione Red virtual en Azure Portal; a continuación, puede implementar la red virtual y una subred inmediatamente con un solo clic.</span><span class="sxs-lookup"><span data-stu-id="77944-141">In the Azure portal, select virtual network and you can deploy the virtual network and one subnet immediately with just one click.</span></span> <span data-ttu-id="77944-142">La subred INT también está definida y lista para las máquinas virtuales que se van a agregar.</span><span class="sxs-lookup"><span data-stu-id="77944-142">INT subnet is also defined and is ready now for VMs to be added.</span></span>
<span data-ttu-id="77944-143">El siguiente paso es agregar otra subred a la red: la subred DMZ.</span><span class="sxs-lookup"><span data-stu-id="77944-143">The next step is to add another subnet to the network, i.e. the DMZ subnet.</span></span> <span data-ttu-id="77944-144">Para crear la subred DMZ, simplemente:</span><span class="sxs-lookup"><span data-stu-id="77944-144">To create the DMZ subnet, simply</span></span>

* <span data-ttu-id="77944-145">Seleccione la red recién creada.</span><span class="sxs-lookup"><span data-stu-id="77944-145">Select the newly created network</span></span>
* <span data-ttu-id="77944-146">En las propiedades, seleccione Subredes.</span><span class="sxs-lookup"><span data-stu-id="77944-146">In the properties select subnet</span></span>
* <span data-ttu-id="77944-147">En el panel Subredes, haga clic en el botón Agregar.</span><span class="sxs-lookup"><span data-stu-id="77944-147">In the subnet panel click on the add button</span></span>
* <span data-ttu-id="77944-148">Proporcione el nombre y la información del espacio de direcciones de la subred para crear la subred.</span><span class="sxs-lookup"><span data-stu-id="77944-148">Provide the subnet name and address space information to create the subnet</span></span>

![Subred](./media/active-directory-aadconnect-azure-adfs/deploynetwork2.png)

![Subred DMZ](./media/active-directory-aadconnect-azure-adfs/deploynetwork3.png)

<span data-ttu-id="77944-151">**1.2. Creación de grupos de seguridad de red**</span><span class="sxs-lookup"><span data-stu-id="77944-151">**1.2. Creating the network security groups**</span></span>

<span data-ttu-id="77944-152">Un grupo de seguridad de red (NSG) contiene una enumeración de las reglas de la lista de control de acceso (ACL), que permiten o deniegan el tráfico de red a sus instancias de máquina virtual en una red virtual.</span><span class="sxs-lookup"><span data-stu-id="77944-152">A Network security group (NSG) contains a list of Access Control List (ACL) rules that allow or deny network traffic to your VM instances in a Virtual Network.</span></span> <span data-ttu-id="77944-153">Los NSG se pueden asociar con las subredes o las instancias individuales de máquina virtual dentro de esa subred.</span><span class="sxs-lookup"><span data-stu-id="77944-153">NSGs can be associated with either subnets or individual VM instances within that subnet.</span></span> <span data-ttu-id="77944-154">Cuando un NSG está asociado a una subred, las reglas de la ACL se aplican a todas las instancias de la máquina virtual de esa subred.</span><span class="sxs-lookup"><span data-stu-id="77944-154">When an NSG is associated with a subnet, the ACL rules apply to all the VM instances in that subnet.</span></span>
<span data-ttu-id="77944-155">Para esta guía, crearemos dos NSG: uno para una red interna y otro para una red perimetral.</span><span class="sxs-lookup"><span data-stu-id="77944-155">For the purpose of this guidance, we will create two NSGs: one each for an internal network and a DMZ.</span></span> <span data-ttu-id="77944-156">Se denominarán NSG_INT y NSG_DMZ respectivamente.</span><span class="sxs-lookup"><span data-stu-id="77944-156">They will be labeled NSG_INT and NSG_DMZ respectively.</span></span>

![Creación de NSG](./media/active-directory-aadconnect-azure-adfs/creatensg1.png)

<span data-ttu-id="77944-158">Después de crear el NSG, no habrá ninguna regla de entrada ni de salida.</span><span class="sxs-lookup"><span data-stu-id="77944-158">After the NSG is created, there will be 0 inbound and 0 outbound rules.</span></span> <span data-ttu-id="77944-159">Una vez que los roles de los servidores respectivos están instalados y funcionales, las reglas de entrada y de salida se pueden crear según el nivel de seguridad deseado.</span><span class="sxs-lookup"><span data-stu-id="77944-159">Once the roles on the respective servers are installed and functional, then the inbound and outbound rules can be made according to the desired level of security.</span></span>

![Inicialización de Git](./media/active-directory-aadconnect-azure-adfs/nsgint1.png)

<span data-ttu-id="77944-161">Después de crear los NSG, asocie NSG_INT a la subred INT y NSG_DMZ a la subred DMZ.</span><span class="sxs-lookup"><span data-stu-id="77944-161">After the NSGs are created, associate NSG_INT with subnet INT and NSG_DMZ with subnet DMZ.</span></span> <span data-ttu-id="77944-162">A continuación se proporciona una captura de pantalla de ejemplo:</span><span class="sxs-lookup"><span data-stu-id="77944-162">An example screenshot is given below:</span></span>

![Configuración de NSG](./media/active-directory-aadconnect-azure-adfs/nsgconfigure1.png)

* <span data-ttu-id="77944-164">Haga clic en Subredes para abrir el panel Subredes.</span><span class="sxs-lookup"><span data-stu-id="77944-164">Click on Subnets to open the panel for subnets</span></span>
* <span data-ttu-id="77944-165">Seleccione la subred que se asociará al NSG.</span><span class="sxs-lookup"><span data-stu-id="77944-165">Select the subnet to associate with the NSG</span></span> 

<span data-ttu-id="77944-166">Después de la configuración, el panel Subredes debe ser similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="77944-166">After configuration, the panel for Subnets should look like below:</span></span>

![Subredes después GSN](./media/active-directory-aadconnect-azure-adfs/nsgconfigure2.png)

<span data-ttu-id="77944-168">**1.3. Creación de una conexión a local**</span><span class="sxs-lookup"><span data-stu-id="77944-168">**1.3. Create Connection to on-premises**</span></span>

<span data-ttu-id="77944-169">Necesitamos una conexión local con el fin de implementar el controlador de dominio en Azure.</span><span class="sxs-lookup"><span data-stu-id="77944-169">We will need a connection to on-premises in order to deploy the domain controller (DC) in azure.</span></span> <span data-ttu-id="77944-170">Azure ofrece varias opciones de conectividad para conectar su infraestructura local a la infraestructura de Azure.</span><span class="sxs-lookup"><span data-stu-id="77944-170">Azure offers various connectivity options to connect your on-premises infrastructure to your Azure infrastructure.</span></span>

* <span data-ttu-id="77944-171">De punto a sitio</span><span class="sxs-lookup"><span data-stu-id="77944-171">Point-to-site</span></span>
* <span data-ttu-id="77944-172">De sitio a sitio de red virtual</span><span class="sxs-lookup"><span data-stu-id="77944-172">Virtual Network Site-to-site</span></span>
* <span data-ttu-id="77944-173">ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="77944-173">ExpressRoute</span></span>

<span data-ttu-id="77944-174">Se recomienda usar ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="77944-174">It is recommended to use ExpressRoute.</span></span> <span data-ttu-id="77944-175">ExpressRoute permite crear conexiones privadas entre los centros de datos de Azure y la infraestructura que está en su entorno local o en un entorno de colocalización.</span><span class="sxs-lookup"><span data-stu-id="77944-175">ExpressRoute lets you create private connections between Azure datacenters and infrastructure that’s on your premises or in a co-location environment.</span></span> <span data-ttu-id="77944-176">Las conexiones ExpressRoute no pasan por la red pública de Internet.</span><span class="sxs-lookup"><span data-stu-id="77944-176">ExpressRoute connections do not go over the public Internet.</span></span> <span data-ttu-id="77944-177">Ofrecen más confiabilidad, velocidades más altas, menores latencias y mayor seguridad que las conexiones habituales a través de Internet.</span><span class="sxs-lookup"><span data-stu-id="77944-177">They offer more reliability, faster speeds, lower latencies and higher security than typical connections over the Internet.</span></span>
<span data-ttu-id="77944-178">Aunque se recomienda utilizar ExpressRoute, puede elegir el método de conexión más adecuado para su organización.</span><span class="sxs-lookup"><span data-stu-id="77944-178">While it is recommended to use ExpressRoute, you may choose any connection method best suited for your organization.</span></span> <span data-ttu-id="77944-179">Para aprender más acerca de ExpressRoute y las distintas opciones de conectividad con ExpressRoute, lea [Información técnica de ExpressRoute](https://aka.ms/Azure/ExpressRoute).</span><span class="sxs-lookup"><span data-stu-id="77944-179">To learn more about ExpressRoute and the various connectivity options using ExpressRoute, read [ExpressRoute technical overview](https://aka.ms/Azure/ExpressRoute).</span></span>

### <a name="2-create-storage-accounts"></a><span data-ttu-id="77944-180">2. Creación de cuentas de almacenamiento</span><span class="sxs-lookup"><span data-stu-id="77944-180">2. Create storage accounts</span></span>
<span data-ttu-id="77944-181">Para mantener la alta disponibilidad y evitar la dependencia de una sola cuenta de almacenamiento, puede crear dos cuentas de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="77944-181">In order to maintain high availability and avoid dependence on a single storage account, you can create two storage accounts.</span></span> <span data-ttu-id="77944-182">Divida las máquinas de cada conjunto de disponibilidad en dos grupos y asigne una cuenta de almacenamiento independiente a cada grupo.</span><span class="sxs-lookup"><span data-stu-id="77944-182">Divide the machines in each availability set into two groups and then assign each group a separate storage account.</span></span>

![Creación de cuentas de almacenamiento](./media/active-directory-aadconnect-azure-adfs/storageaccount1.png)

### <a name="3-create-availability-sets"></a><span data-ttu-id="77944-184">3. Creación de conjuntos de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="77944-184">3. Create availability sets</span></span>
<span data-ttu-id="77944-185">Para cada rol (DC/AD FS y WAP), cree conjuntos de disponibilidad que contengan dos máquinas como mínimo.</span><span class="sxs-lookup"><span data-stu-id="77944-185">For each role (DC/AD FS and WAP), create availability sets that will contain 2 machines each at the minimum.</span></span> <span data-ttu-id="77944-186">Esto le ayudará a lograr una mayor disponibilidad para cada rol.</span><span class="sxs-lookup"><span data-stu-id="77944-186">This will help achieve higher availability for each role.</span></span> <span data-ttu-id="77944-187">Al crear los conjuntos de disponibilidad, es esencial decidir lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="77944-187">While creating the availability sets, it is essential to decide on the following:</span></span>

* <span data-ttu-id="77944-188">**Dominios de error**: máquinas virtuales en el mismo dominio de error comparten la misma fuente de alimentación y el conmutador de red física.</span><span class="sxs-lookup"><span data-stu-id="77944-188">**Fault Domains**: Virtual machines in the same fault domain share the same power source and physical network switch.</span></span> <span data-ttu-id="77944-189">Se recomienda un mínimo de dos dominios de error.</span><span class="sxs-lookup"><span data-stu-id="77944-189">A minimum of 2 fault domains are recommended.</span></span> <span data-ttu-id="77944-190">El valor predeterminado es tres, y puede dejarlo así para esta implementación.</span><span class="sxs-lookup"><span data-stu-id="77944-190">The default value is 3 and you can leave it as is for the purpose of this deployment</span></span>
* <span data-ttu-id="77944-191">**Dominios de actualización**: las máquinas que pertenecen al mismo dominio de actualización se reinician juntas durante una actualización.</span><span class="sxs-lookup"><span data-stu-id="77944-191">**Update domains**: Machines belonging to the same update domain are restarted together during an update.</span></span> <span data-ttu-id="77944-192">Conviene tener como mínimo dos dominios de actualización.</span><span class="sxs-lookup"><span data-stu-id="77944-192">You want to have minimum of 2 update domains.</span></span> <span data-ttu-id="77944-193">El valor predeterminado es cinco y puede dejarlo así para esta implementación.</span><span class="sxs-lookup"><span data-stu-id="77944-193">The default value is 5 and you can leave it as is for the purpose of this deployment</span></span>

![Conjuntos de disponibilidad](./media/active-directory-aadconnect-azure-adfs/availabilityset1.png)

<span data-ttu-id="77944-195">Creación de los siguientes conjuntos de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="77944-195">Create the following availability sets</span></span>

| <span data-ttu-id="77944-196">Conjunto de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="77944-196">Availability Set</span></span> | <span data-ttu-id="77944-197">Rol</span><span class="sxs-lookup"><span data-stu-id="77944-197">Role</span></span> | <span data-ttu-id="77944-198">Dominios de error</span><span class="sxs-lookup"><span data-stu-id="77944-198">Fault domains</span></span> | <span data-ttu-id="77944-199">Dominios de actualización</span><span class="sxs-lookup"><span data-stu-id="77944-199">Update domains</span></span> |
|:---:|:---:|:---:|:--- |
| <span data-ttu-id="77944-200">contosodcset</span><span class="sxs-lookup"><span data-stu-id="77944-200">contosodcset</span></span> |<span data-ttu-id="77944-201">DC/ADFS</span><span class="sxs-lookup"><span data-stu-id="77944-201">DC/ADFS</span></span> |<span data-ttu-id="77944-202">3</span><span class="sxs-lookup"><span data-stu-id="77944-202">3</span></span> |<span data-ttu-id="77944-203">5</span><span class="sxs-lookup"><span data-stu-id="77944-203">5</span></span> |
| <span data-ttu-id="77944-204">contosowapset</span><span class="sxs-lookup"><span data-stu-id="77944-204">contosowapset</span></span> |<span data-ttu-id="77944-205">WAP</span><span class="sxs-lookup"><span data-stu-id="77944-205">WAP</span></span> |<span data-ttu-id="77944-206">3</span><span class="sxs-lookup"><span data-stu-id="77944-206">3</span></span> |<span data-ttu-id="77944-207">5</span><span class="sxs-lookup"><span data-stu-id="77944-207">5</span></span> |

### <a name="4-deploy-virtual-machines"></a><span data-ttu-id="77944-208">4. Implementación de máquinas virtuales</span><span class="sxs-lookup"><span data-stu-id="77944-208">4. Deploy virtual machines</span></span>
<span data-ttu-id="77944-209">El siguiente paso es implementar las máquinas virtuales que hospedarán los distintos roles en su infraestructura.</span><span class="sxs-lookup"><span data-stu-id="77944-209">The next step is to deploy virtual machines that will host the different roles in your infrastructure.</span></span> <span data-ttu-id="77944-210">Se recomienda un mínimo de dos máquinas en cada conjunto de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="77944-210">A minimum of two machines are recommended in each availability set.</span></span> <span data-ttu-id="77944-211">Cree cuatro máquinas virtuales para la implementación básica.</span><span class="sxs-lookup"><span data-stu-id="77944-211">Create four virtual machines for the basic deployment.</span></span>

| <span data-ttu-id="77944-212">Máquina</span><span class="sxs-lookup"><span data-stu-id="77944-212">Machine</span></span> | <span data-ttu-id="77944-213">Rol</span><span class="sxs-lookup"><span data-stu-id="77944-213">Role</span></span> | <span data-ttu-id="77944-214">Subred</span><span class="sxs-lookup"><span data-stu-id="77944-214">Subnet</span></span> | <span data-ttu-id="77944-215">Conjunto de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="77944-215">Availability set</span></span> | <span data-ttu-id="77944-216">Cuenta de almacenamiento</span><span class="sxs-lookup"><span data-stu-id="77944-216">Storage account</span></span> | <span data-ttu-id="77944-217">Dirección IP</span><span class="sxs-lookup"><span data-stu-id="77944-217">IP Address</span></span> |
|:---:|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="77944-218">contosodc1</span><span class="sxs-lookup"><span data-stu-id="77944-218">contosodc1</span></span> |<span data-ttu-id="77944-219">DC/ADFS</span><span class="sxs-lookup"><span data-stu-id="77944-219">DC/ADFS</span></span> |<span data-ttu-id="77944-220">INT</span><span class="sxs-lookup"><span data-stu-id="77944-220">INT</span></span> |<span data-ttu-id="77944-221">contosodcset</span><span class="sxs-lookup"><span data-stu-id="77944-221">contosodcset</span></span> |<span data-ttu-id="77944-222">contososac1</span><span class="sxs-lookup"><span data-stu-id="77944-222">contososac1</span></span> |<span data-ttu-id="77944-223">Estática</span><span class="sxs-lookup"><span data-stu-id="77944-223">Static</span></span> |
| <span data-ttu-id="77944-224">contosodc2</span><span class="sxs-lookup"><span data-stu-id="77944-224">contosodc2</span></span> |<span data-ttu-id="77944-225">DC/ADFS</span><span class="sxs-lookup"><span data-stu-id="77944-225">DC/ADFS</span></span> |<span data-ttu-id="77944-226">INT</span><span class="sxs-lookup"><span data-stu-id="77944-226">INT</span></span> |<span data-ttu-id="77944-227">contosodcset</span><span class="sxs-lookup"><span data-stu-id="77944-227">contosodcset</span></span> |<span data-ttu-id="77944-228">contososac2</span><span class="sxs-lookup"><span data-stu-id="77944-228">contososac2</span></span> |<span data-ttu-id="77944-229">Estática</span><span class="sxs-lookup"><span data-stu-id="77944-229">Static</span></span> |
| <span data-ttu-id="77944-230">contosowap1</span><span class="sxs-lookup"><span data-stu-id="77944-230">contosowap1</span></span> |<span data-ttu-id="77944-231">WAP</span><span class="sxs-lookup"><span data-stu-id="77944-231">WAP</span></span> |<span data-ttu-id="77944-232">DMZ</span><span class="sxs-lookup"><span data-stu-id="77944-232">DMZ</span></span> |<span data-ttu-id="77944-233">contosowapset</span><span class="sxs-lookup"><span data-stu-id="77944-233">contosowapset</span></span> |<span data-ttu-id="77944-234">contososac1</span><span class="sxs-lookup"><span data-stu-id="77944-234">contososac1</span></span> |<span data-ttu-id="77944-235">Estática</span><span class="sxs-lookup"><span data-stu-id="77944-235">Static</span></span> |
| <span data-ttu-id="77944-236">contosowap2</span><span class="sxs-lookup"><span data-stu-id="77944-236">contosowap2</span></span> |<span data-ttu-id="77944-237">WAP</span><span class="sxs-lookup"><span data-stu-id="77944-237">WAP</span></span> |<span data-ttu-id="77944-238">DMZ</span><span class="sxs-lookup"><span data-stu-id="77944-238">DMZ</span></span> |<span data-ttu-id="77944-239">contosowapset</span><span class="sxs-lookup"><span data-stu-id="77944-239">contosowapset</span></span> |<span data-ttu-id="77944-240">contososac2</span><span class="sxs-lookup"><span data-stu-id="77944-240">contososac2</span></span> |<span data-ttu-id="77944-241">Estática</span><span class="sxs-lookup"><span data-stu-id="77944-241">Static</span></span> |

<span data-ttu-id="77944-242">Como habrá observado, no se ha especificado ningún NSG.</span><span class="sxs-lookup"><span data-stu-id="77944-242">As you might have noticed, no NSG has been specified.</span></span> <span data-ttu-id="77944-243">Esto es porque Azure permite usar NSG en el nivel de subred.</span><span class="sxs-lookup"><span data-stu-id="77944-243">This is because azure lets you use NSG at the subnet level.</span></span> <span data-ttu-id="77944-244">A continuación, puede controlar el tráfico de red de la máquina mediante el NSG individual asociado a la subred o mediante el objeto NIC.</span><span class="sxs-lookup"><span data-stu-id="77944-244">Then, you can control machine network traffic by using the individual NSG associated with either the subnet or else the NIC object.</span></span> <span data-ttu-id="77944-245">Para más información consulte [¿Qué es un grupo de seguridad de red?](https://aka.ms/Azure/NSG)</span><span class="sxs-lookup"><span data-stu-id="77944-245">Read more on [What is a Network Security Group (NSG)](https://aka.ms/Azure/NSG).</span></span>
<span data-ttu-id="77944-246">Se recomienda una dirección IP estática si está administrando el DNS.</span><span class="sxs-lookup"><span data-stu-id="77944-246">Static IP address is recommended if you are managing the DNS.</span></span> <span data-ttu-id="77944-247">Puede utilizar DNS de Azure en lugar de los registros de DNS para su dominio; haga referencia a las nuevas máquinas por su nombre de dominio completo de Azure.</span><span class="sxs-lookup"><span data-stu-id="77944-247">You can use Azure DNS and instead in the DNS records for your domain, refer to the new machines by their Azure FQDNs.</span></span>
<span data-ttu-id="77944-248">Una vez completada la implementación, el panel Máquinas virtuales debe ser similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="77944-248">Your virtual machine pane should look like below after the deployment is completed:</span></span>

![Máquinas virtuales implementadas](./media/active-directory-aadconnect-azure-adfs/virtualmachinesdeployed_noadfs.png)

### <a name="5-configuring-the-domain-controller--ad-fs-servers"></a><span data-ttu-id="77944-250">5. Configuración de los servidores del controlador de dominio o AD FS</span><span class="sxs-lookup"><span data-stu-id="77944-250">5. Configuring the domain controller / AD FS servers</span></span>
 <span data-ttu-id="77944-251">Para autenticar cualquier solicitud entrante, AD FS deberá ponerse en contacto con el controlador de dominio.</span><span class="sxs-lookup"><span data-stu-id="77944-251">In order to authenticate any incoming request, AD FS will need to contact the domain controller.</span></span> <span data-ttu-id="77944-252">Para evitar el costoso recorrido de Azure a controlador de dominio local para la autenticación, se recomienda implementar una réplica del controlador de dominio en Azure.</span><span class="sxs-lookup"><span data-stu-id="77944-252">To save the costly trip from Azure to on-premises DC for authentication, it is recommended to deploy a replica of the domain controller in Azure.</span></span> <span data-ttu-id="77944-253">Para lograr una alta disponibilidad, se recomienda crear un conjunto de disponibilidad con al menos dos de controladores de dominio.</span><span class="sxs-lookup"><span data-stu-id="77944-253">In order to attain high availability, it is recommended to create an availability set of at-least 2 domain controllers.</span></span>

| <span data-ttu-id="77944-254">Controlador de dominio</span><span class="sxs-lookup"><span data-stu-id="77944-254">Domain controller</span></span> | <span data-ttu-id="77944-255">Rol</span><span class="sxs-lookup"><span data-stu-id="77944-255">Role</span></span> | <span data-ttu-id="77944-256">Cuenta de almacenamiento</span><span class="sxs-lookup"><span data-stu-id="77944-256">Storage account</span></span> |
|:---:|:---:|:---:|
| <span data-ttu-id="77944-257">contosodc1</span><span class="sxs-lookup"><span data-stu-id="77944-257">contosodc1</span></span> |<span data-ttu-id="77944-258">Réplica</span><span class="sxs-lookup"><span data-stu-id="77944-258">Replica</span></span> |<span data-ttu-id="77944-259">contososac1</span><span class="sxs-lookup"><span data-stu-id="77944-259">contososac1</span></span> |
| <span data-ttu-id="77944-260">contosodc2</span><span class="sxs-lookup"><span data-stu-id="77944-260">contosodc2</span></span> |<span data-ttu-id="77944-261">Réplica</span><span class="sxs-lookup"><span data-stu-id="77944-261">Replica</span></span> |<span data-ttu-id="77944-262">contososac2</span><span class="sxs-lookup"><span data-stu-id="77944-262">contososac2</span></span> |

* <span data-ttu-id="77944-263">Promueva los dos servidores a controladores de dominio de réplica con DNS.</span><span class="sxs-lookup"><span data-stu-id="77944-263">Promote the two servers as replica domain controllers with DNS</span></span>
* <span data-ttu-id="77944-264">Instale el rol AD FS mediante el administrador del servidor para configurar los servidores AD FS.</span><span class="sxs-lookup"><span data-stu-id="77944-264">Configure the AD FS servers by installing the AD FS role using the server manager.</span></span>

### <a name="6-deploying-internal-load-balancer-ilb"></a><span data-ttu-id="77944-265">6. Implementación del Equilibrador de carga interno (ILB)</span><span class="sxs-lookup"><span data-stu-id="77944-265">6. Deploying Internal Load Balancer (ILB)</span></span>
<span data-ttu-id="77944-266">**6.1. Creación del ILB**</span><span class="sxs-lookup"><span data-stu-id="77944-266">**6.1. Create the ILB**</span></span>

<span data-ttu-id="77944-267">Para implementar un ILB, seleccione Equilibradores de carga en Azure Portal y haga clic en Agregar (+).</span><span class="sxs-lookup"><span data-stu-id="77944-267">To deploy an ILB, select Load Balancers in the Azure portal and click on add (+).</span></span>

> [!NOTE]
> <span data-ttu-id="77944-268">Si no ve **Equilibradores de carga** en el menú, haga clic en **Examinar** en la parte inferior izquierda del portal y desplácese hasta que vea **Equilibradores de carga**.</span><span class="sxs-lookup"><span data-stu-id="77944-268">if you do not see **Load Balancers** in your menu, click **Browse** in the lower left of the portal and scroll until you see **Load Balancers**.</span></span>  <span data-ttu-id="77944-269">A continuación, haga clic en la estrella amarilla para agregarlo al menú.</span><span class="sxs-lookup"><span data-stu-id="77944-269">Then click the yellow star to add it to your menu.</span></span> <span data-ttu-id="77944-270">Ahora, seleccione el nuevo icono del equilibrador de carga para abrir el panel y empezar a configurar el equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="77944-270">Now select the new load balancer icon to open the panel to begin configuration of the load balancer.</span></span>
> 
> 

![Examinar el equilibrador de carga](./media/active-directory-aadconnect-azure-adfs/browseloadbalancer.png)

* <span data-ttu-id="77944-272">**Nombre**: asigne un nombre adecuado al equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="77944-272">**Name**: Give any suitable name to the load balancer</span></span>
* <span data-ttu-id="77944-273">**Esquema**: puesto que este equilibrador de carga se colocará delante de los servidores AD FS y está pensado SOLO para las conexiones de red interna, seleccione "Interno".</span><span class="sxs-lookup"><span data-stu-id="77944-273">**Scheme**: Since this load balancer will be placed in front of the AD FS servers and is meant for internal network connections ONLY, select “Internal”</span></span>
* <span data-ttu-id="77944-274">**Red virtual**: elija la red virtual donde está implementando AD FS.</span><span class="sxs-lookup"><span data-stu-id="77944-274">**Virtual Network**: Choose the virtual network where you are deploying your AD FS</span></span>
* <span data-ttu-id="77944-275">**Subred**: elija aquí la subred interna.</span><span class="sxs-lookup"><span data-stu-id="77944-275">**Subnet**: Choose the internal subnet here</span></span>
* <span data-ttu-id="77944-276">**Asignación de dirección IP**: Estática</span><span class="sxs-lookup"><span data-stu-id="77944-276">**IP Address assignment**: Static</span></span>

![Equilibrador de carga interno](./media/active-directory-aadconnect-azure-adfs/ilbdeployment1.png)

<span data-ttu-id="77944-278">Tras hacer clic en crear y cuando el ILB se implementa, debería verlo en la lista de equilibradores de carga:</span><span class="sxs-lookup"><span data-stu-id="77944-278">After you click create and the ILB is deployed, you should see it in the list of load balancers:</span></span>

![Equilibradores de carga después del ILB](./media/active-directory-aadconnect-azure-adfs/ilbdeployment2.png)

<span data-ttu-id="77944-280">El siguiente paso es configurar el grupo back-end y el sondeo de back-end.</span><span class="sxs-lookup"><span data-stu-id="77944-280">Next step is to configure the backend pool and the backend probe.</span></span>

<span data-ttu-id="77944-281">**6.2. Configuración del grupo back-end del ILB**</span><span class="sxs-lookup"><span data-stu-id="77944-281">**6.2. Configure ILB backend pool**</span></span>

<span data-ttu-id="77944-282">Seleccione el ILB recién creado en el panel Equilibradores de carga.</span><span class="sxs-lookup"><span data-stu-id="77944-282">Select the newly created ILB in the Load Balancers panel.</span></span> <span data-ttu-id="77944-283">Se abrirá el panel de configuración.</span><span class="sxs-lookup"><span data-stu-id="77944-283">It will open the settings panel.</span></span> 

1. <span data-ttu-id="77944-284">Seleccione los grupos back-end en el panel de configuración.</span><span class="sxs-lookup"><span data-stu-id="77944-284">Select backend pools from the settings panel</span></span>
2. <span data-ttu-id="77944-285">En el panel Agregar grupo back-end, haga clic en Agregar máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="77944-285">In the add backend pool panel, click on add virtual machine</span></span>
3. <span data-ttu-id="77944-286">Aparecerá un panel donde puede elegir el conjunto de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="77944-286">You will be presented with a panel where you can choose availability set</span></span>
4. <span data-ttu-id="77944-287">Elija el conjunto de disponibilidad de AD FS.</span><span class="sxs-lookup"><span data-stu-id="77944-287">Choose the AD FS availability set</span></span>

![Configuración del grupo back-end del ILB](./media/active-directory-aadconnect-azure-adfs/ilbdeployment3.png)

<span data-ttu-id="77944-289">**6.3. Configuración del sondeo**</span><span class="sxs-lookup"><span data-stu-id="77944-289">**6.3. Configuring probe**</span></span>

<span data-ttu-id="77944-290">En el panel de configuración del ILB, seleccione Sondeos.</span><span class="sxs-lookup"><span data-stu-id="77944-290">In the ILB settings panel, select Probes.</span></span>

1. <span data-ttu-id="77944-291">Haga clic en Agregar.</span><span class="sxs-lookup"><span data-stu-id="77944-291">Click on add</span></span>
2. <span data-ttu-id="77944-292">Proporcione la información para el sondeo a.</span><span class="sxs-lookup"><span data-stu-id="77944-292">Provide details for probe a.</span></span> <span data-ttu-id="77944-293">**Nombre**: nombre del sondeo b.</span><span class="sxs-lookup"><span data-stu-id="77944-293">**Name**: Probe name b.</span></span> <span data-ttu-id="77944-294">**Protocolo**: TCP c.</span><span class="sxs-lookup"><span data-stu-id="77944-294">**Protocol**: TCP c.</span></span> <span data-ttu-id="77944-295">**Puerto**: 443 (HTTPS) d.</span><span class="sxs-lookup"><span data-stu-id="77944-295">**Port**: 443 (HTTPS) d.</span></span> <span data-ttu-id="77944-296">**Intervalo**: 5 (valor predeterminado). Este es el intervalo en el que el ILB comprobará las máquinas en el grupo back-end e.</span><span class="sxs-lookup"><span data-stu-id="77944-296">**Interval**: 5 (default value) – this is the interval at which ILB will probe the machines in the backend pool e.</span></span> <span data-ttu-id="77944-297">**Umbral incorrecto**: 2 (valor predeterminado): umbral de errores de sondeo consecutivos después del cual el ILB declara que una máquina del grupo back-end no responde y dejará de enviarle tráfico.</span><span class="sxs-lookup"><span data-stu-id="77944-297">**Unhealthy threshold limit**: 2 (default val ue) – this is the threshold of consecutive probe failures after which ILB will declare a machine in the backend pool non-responsive and stop sending traffic to it.</span></span>

![Configuración del sondeo del ILB](./media/active-directory-aadconnect-azure-adfs/ilbdeployment4.png)

<span data-ttu-id="77944-299">**6.4. Creación de reglas de equilibrio de carga**</span><span class="sxs-lookup"><span data-stu-id="77944-299">**6.4. Create load balancing rules**</span></span>

<span data-ttu-id="77944-300">Con el fin de equilibrar el tráfico de forma eficaz, el ILB debe configurarse con reglas de equilibrio de carga.</span><span class="sxs-lookup"><span data-stu-id="77944-300">In order to effectively balance the traffic, the ILB should be configured with load balancing rules.</span></span> <span data-ttu-id="77944-301">Para crear una regla de equilibrio de carga:</span><span class="sxs-lookup"><span data-stu-id="77944-301">In order to create a load balancing rule,</span></span> 

1. <span data-ttu-id="77944-302">Seleccione Reglas de equilibrio de carga en el panel de configuración del ILB</span><span class="sxs-lookup"><span data-stu-id="77944-302">Select Load balancing rule from the settings panel of the ILB</span></span>
2. <span data-ttu-id="77944-303">Haga clic en Agregar en el panel Reglas de equilibrio de carga.</span><span class="sxs-lookup"><span data-stu-id="77944-303">Click on Add in the Load balancing rule panel</span></span>
3. <span data-ttu-id="77944-304">En el panel Agregar regla de equilibrio de carga a.</span><span class="sxs-lookup"><span data-stu-id="77944-304">In the Add load balancing rule panel a.</span></span> <span data-ttu-id="77944-305">**Nombre**: escriba un nombre para la regla b.</span><span class="sxs-lookup"><span data-stu-id="77944-305">**Name**: Provide a name for the rule b.</span></span> <span data-ttu-id="77944-306">**Protocolo**: seleccione TCP c.</span><span class="sxs-lookup"><span data-stu-id="77944-306">**Protocol**: Select TCP c.</span></span> <span data-ttu-id="77944-307">**Puerto**: 443 d.</span><span class="sxs-lookup"><span data-stu-id="77944-307">**Port**: 443 d.</span></span> <span data-ttu-id="77944-308">**Puerto back-end**: 443 e.</span><span class="sxs-lookup"><span data-stu-id="77944-308">**Backend port**: 443 e.</span></span> <span data-ttu-id="77944-309">**Grupo back-end**: seleccione el grupo que creó antes para el clúster de AD FS f.</span><span class="sxs-lookup"><span data-stu-id="77944-309">**Backend pool**: Select the pool you created for the AD FS cluster earlier f.</span></span> <span data-ttu-id="77944-310">**Sondeo**: seleccione el sondeo que creó antes para los servidores AD FS.</span><span class="sxs-lookup"><span data-stu-id="77944-310">**Probe**: Select the probe created for AD FS servers earlier</span></span>

![Configuración de las reglas de equilibrio de carga](./media/active-directory-aadconnect-azure-adfs/ilbdeployment5.png)

<span data-ttu-id="77944-312">**6.5. Actualización de DNS con el ILB**</span><span class="sxs-lookup"><span data-stu-id="77944-312">**6.5. Update DNS with ILB**</span></span>

<span data-ttu-id="77944-313">Vaya a su servidor DNS y cree un registro CNAME para el ILB.</span><span class="sxs-lookup"><span data-stu-id="77944-313">Go to your DNS server and create a CNAME for the ILB.</span></span> <span data-ttu-id="77944-314">El registro CNAME debe ser para el servicio de federación con la dirección IP apuntando a la dirección IP del ILB.</span><span class="sxs-lookup"><span data-stu-id="77944-314">The CNAME should be for the federation service with the IP address pointing to the IP address of the ILB.</span></span> <span data-ttu-id="77944-315">Por ejemplo, si la dirección DIP de ILB es 10.3.0.8 y el servicio de federación instalado es fs.contoso.com, cree un registro CNAME para fs.contoso.com apuntando a 10.3.0.8.</span><span class="sxs-lookup"><span data-stu-id="77944-315">For example if the ILB DIP address is 10.3.0.8, and the federation service installed is fs.contoso.com, then create a CNAME for fs.contoso.com pointing to 10.3.0.8.</span></span>
<span data-ttu-id="77944-316">Esto garantizará que todas las comunicaciones relativas a fs.contoso.com terminen en el ILB y se enruten correctamente.</span><span class="sxs-lookup"><span data-stu-id="77944-316">This will ensure that all communication regarding fs.contoso.com end up at the ILB and are appropriately routed.</span></span>

### <a name="7-configuring-the-web-application-proxy-server"></a><span data-ttu-id="77944-317">7. Configuración del servidor proxy de aplicación web</span><span class="sxs-lookup"><span data-stu-id="77944-317">7. Configuring the Web Application Proxy server</span></span>
<span data-ttu-id="77944-318">**7.1. Configuración de los servidores proxy de aplicación web para acceder a servidores AD FS**</span><span class="sxs-lookup"><span data-stu-id="77944-318">**7.1. Configuring the Web Application Proxy servers to reach AD FS servers**</span></span>

<span data-ttu-id="77944-319">Con el fin de garantizar que los servidores proxy de aplicación web puedan llegar a los servidores AD FS detrás del ILB, cree un registro en %systemroot%\system32\drivers\etc\hosts para el ILB.</span><span class="sxs-lookup"><span data-stu-id="77944-319">In order to ensure that Web Application Proxy servers are able to reach the AD FS servers behind the ILB, create a record in the %systemroot%\system32\drivers\etc\hosts for the ILB.</span></span> <span data-ttu-id="77944-320">Tenga en cuenta que el nombre distintivo (DN) debe ser el nombre del servicio de federación; por ejemplo, fs.contoso.com.</span><span class="sxs-lookup"><span data-stu-id="77944-320">Note that the distinguished name (DN) should be the federation service name, for example fs.contoso.com.</span></span> <span data-ttu-id="77944-321">Y la entrada IP debe ser la de la dirección IP del ILB (en el ejemplo, 10.3.0.8).</span><span class="sxs-lookup"><span data-stu-id="77944-321">And the IP entry should be that of the ILB’s IP address (10.3.0.8 as in the example).</span></span>

<span data-ttu-id="77944-322">**7.2. Instalación del rol de proxy de aplicación web**</span><span class="sxs-lookup"><span data-stu-id="77944-322">**7.2. Installing the Web Application Proxy role**</span></span>

<span data-ttu-id="77944-323">Después de asegurarse de que los servidores proxy de aplicación web pueden acceder a los servidores AD FS detrás del ILB puede instalar los servidores proxy de aplicación web.</span><span class="sxs-lookup"><span data-stu-id="77944-323">After you ensure that Web Application Proxy servers are able to reach the AD FS servers behind ILB, you can next install the Web Application Proxy servers.</span></span> <span data-ttu-id="77944-324">Los servidores proxy de aplicación web no deben unirse al dominio.</span><span class="sxs-lookup"><span data-stu-id="77944-324">Web Application Proxy servers do not be joined to the domain.</span></span> <span data-ttu-id="77944-325">Instale los roles de proxy de aplicación web en los dos servidores proxy de aplicación web seleccionando el rol de acceso remoto.</span><span class="sxs-lookup"><span data-stu-id="77944-325">Install the Web Application Proxy roles on the two Web Application Proxy servers by selecting the Remote Access role.</span></span> <span data-ttu-id="77944-326">El administrador del servidor le guiará para completar la instalación de WAP.</span><span class="sxs-lookup"><span data-stu-id="77944-326">The server manager will guide you to complete the WAP installation.</span></span>
<span data-ttu-id="77944-327">Para más información sobre cómo implementar WAP, lea [Instalar y configurar el servidor de Proxy de aplicación web](https://technet.microsoft.com/library/dn383662.aspx).</span><span class="sxs-lookup"><span data-stu-id="77944-327">For more information on how to deploy WAP, read [Install and Configure the Web Application Proxy Server](https://technet.microsoft.com/library/dn383662.aspx).</span></span>

### <a name="8--deploying-the-internet-facing-public-load-balancer"></a><span data-ttu-id="77944-328">8.  Implementación del equilibrador de carga accesible desde Internet (público)</span><span class="sxs-lookup"><span data-stu-id="77944-328">8.  Deploying the Internet Facing (Public) Load Balancer</span></span>
<span data-ttu-id="77944-329">**8.1.  Creación del equilibrador de carga accesible desde Internet (público)**</span><span class="sxs-lookup"><span data-stu-id="77944-329">**8.1.  Create Internet Facing (Public) Load Balancer**</span></span>

<span data-ttu-id="77944-330">En Azure Portal, seleccione Equilibradores de carga y haga clic en Agregar.</span><span class="sxs-lookup"><span data-stu-id="77944-330">In the Azure portal, select Load balancers and then click on Add.</span></span> <span data-ttu-id="77944-331">En el panel Crear equilibrador de carga, escriba la siguiente información:</span><span class="sxs-lookup"><span data-stu-id="77944-331">In the Create load balancer panel, enter the following information</span></span>

1. <span data-ttu-id="77944-332">**Nombre**: nombre del equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="77944-332">**Name**: Name for the load balancer</span></span>
2. <span data-ttu-id="77944-333">**Esquema**: público; esta opción indica a Azure que este equilibrador de carga necesitará una dirección pública.</span><span class="sxs-lookup"><span data-stu-id="77944-333">**Scheme**: Public – this option tells Azure that this load balancer will need a public address.</span></span>
3. <span data-ttu-id="77944-334">**Dirección IP**: crea una dirección IP (dinámica).</span><span class="sxs-lookup"><span data-stu-id="77944-334">**IP Address**: Create a new IP address (dynamic)</span></span>

![Equilibrador de carga accesible desde Internet](./media/active-directory-aadconnect-azure-adfs/elbdeployment1.png)

<span data-ttu-id="77944-336">Después de la implementación, el equilibrador de carga aparecerá en la lista de equilibradores de carga.</span><span class="sxs-lookup"><span data-stu-id="77944-336">After deployment, the load balancer will appear in the Load balancers list.</span></span>

![Lista de equilibradores de carga](./media/active-directory-aadconnect-azure-adfs/elbdeployment2.png)

<span data-ttu-id="77944-338">**8.2. Asignación de una etiqueta DNS a la dirección IP pública**</span><span class="sxs-lookup"><span data-stu-id="77944-338">**8.2. Assign a DNS label to the public IP**</span></span>

<span data-ttu-id="77944-339">Haga clic en la entrada del equilibrador de carga recién creada en el panel Equilibradores de carga para que aparezca el panel de configuración.</span><span class="sxs-lookup"><span data-stu-id="77944-339">Click on the newly created load balancer entry in the Load balancers panel to bring up the panel for configuration.</span></span> <span data-ttu-id="77944-340">Siga estos pasos para configurar la etiqueta DNS para la dirección IP pública:</span><span class="sxs-lookup"><span data-stu-id="77944-340">Follow below steps to configure the DNS label for the public IP:</span></span>

1. <span data-ttu-id="77944-341">Haga clic en la dirección IP pública.</span><span class="sxs-lookup"><span data-stu-id="77944-341">Click on the public IP address.</span></span> <span data-ttu-id="77944-342">Se abrirá el panel de la dirección IP pública y su configuración.</span><span class="sxs-lookup"><span data-stu-id="77944-342">This will open the panel for the public IP and its settings</span></span>
2. <span data-ttu-id="77944-343">Haga clic en Configuración.</span><span class="sxs-lookup"><span data-stu-id="77944-343">Click on Configuration</span></span>
3. <span data-ttu-id="77944-344">Proporcione una etiqueta DNS.</span><span class="sxs-lookup"><span data-stu-id="77944-344">Provide a DNS label.</span></span> <span data-ttu-id="77944-345">Esta etiqueta se convertirá en la etiqueta DNS pública a la que puede acceder desde cualquier lugar; por ejemplo, contosofs.westus.cloudapp.azure.com.</span><span class="sxs-lookup"><span data-stu-id="77944-345">This will become the public DNS label that you can access from anywhere, for example contosofs.westus.cloudapp.azure.com.</span></span> <span data-ttu-id="77944-346">Puede agregar una entrada en el DNS externo para el servicio de federación (como fs.contoso.com) que se resuelve en la etiqueta DNS del equilibrador de carga externo (contosofs.westus.cloudapp.azure.com).</span><span class="sxs-lookup"><span data-stu-id="77944-346">You can add an entry in the external DNS for the federation service (like fs.contoso.com) that resolves to the DNS label of the external load balancer (contosofs.westus.cloudapp.azure.com).</span></span>

![Configuración del equilibrador de carga accesible desde Internet](./media/active-directory-aadconnect-azure-adfs/elbdeployment3.png) 

![Configuración del equilibrador de carga accesible desde Internet (DNS)](./media/active-directory-aadconnect-azure-adfs/elbdeployment4.png)

<span data-ttu-id="77944-349">**8.3. Configuración de un grupo back-end para el equilibrador de carga accesible desde Internet (público)**</span><span class="sxs-lookup"><span data-stu-id="77944-349">**8.3. Configure backend pool for Internet Facing (Public) Load Balancer**</span></span> 

<span data-ttu-id="77944-350">Siga los mismos pasos que al crear el equilibrador de carga interno para configurar el grupo back-end para el equilibrador de carga accesible desde Internet (público) como el conjunto de disponibilidad para los servidores WAP.</span><span class="sxs-lookup"><span data-stu-id="77944-350">Follow the same steps as in creating the internal load balancer, to configure the backend pool for Internet Facing (Public) Load Balancer as the availability set for the WAP servers.</span></span> <span data-ttu-id="77944-351">Por ejemplo, contosowapset.</span><span class="sxs-lookup"><span data-stu-id="77944-351">For example, contosowapset.</span></span>

![Configuración del grupo back-end del equilibrador de carga accesible desde Internet](./media/active-directory-aadconnect-azure-adfs/elbdeployment5.png)

<span data-ttu-id="77944-353">**8.4. Configuración del sondeo**</span><span class="sxs-lookup"><span data-stu-id="77944-353">**8.4. Configure probe**</span></span>

<span data-ttu-id="77944-354">Siga los mismos pasos que al configurar el equilibrador de carga interno para configurar el sondeo para el grupo back-end de los servidores WAP.</span><span class="sxs-lookup"><span data-stu-id="77944-354">Follow the same steps as in configuring the internal load balancer  to configure the probe for the backend pool of WAP servers.</span></span>

![Configuración del sondeo del equilibrador de carga accesible desde Internet](./media/active-directory-aadconnect-azure-adfs/elbdeployment6.png)

<span data-ttu-id="77944-356">**8.5. Creación de reglas de equilibrio de carga**</span><span class="sxs-lookup"><span data-stu-id="77944-356">**8.5. Create load balancing rule(s)**</span></span>

<span data-ttu-id="77944-357">Siga los mismos pasos que en el ILB para configurar la regla de equilibrio de carga para TCP 443.</span><span class="sxs-lookup"><span data-stu-id="77944-357">Follow the same steps as in ILB to configure the load balancing rule for TCP 443.</span></span>

![Configuración de reglas de equilibrio del equilibrador de carga accesible desde Internet](./media/active-directory-aadconnect-azure-adfs/elbdeployment7.png)

### <a name="9-securing-the-network"></a><span data-ttu-id="77944-359">9. Protección de la red</span><span class="sxs-lookup"><span data-stu-id="77944-359">9. Securing the network</span></span>
<span data-ttu-id="77944-360">**9.1. Protección de la subred interna**</span><span class="sxs-lookup"><span data-stu-id="77944-360">**9.1. Securing the internal subnet**</span></span>

<span data-ttu-id="77944-361">En general, necesita las siguientes reglas para proteger eficazmente la subred interna (en el orden en el que aparecen a continuación).</span><span class="sxs-lookup"><span data-stu-id="77944-361">Overall, you need the following rules to efficiently secure your internal subnet (in the order as listed below)</span></span>

| <span data-ttu-id="77944-362">Regla</span><span class="sxs-lookup"><span data-stu-id="77944-362">Rule</span></span> | <span data-ttu-id="77944-363">Descripción</span><span class="sxs-lookup"><span data-stu-id="77944-363">Description</span></span> | <span data-ttu-id="77944-364">Flujo</span><span class="sxs-lookup"><span data-stu-id="77944-364">Flow</span></span> |
|:--- |:--- |:---:|
| <span data-ttu-id="77944-365">AllowHTTPSFromDMZ</span><span class="sxs-lookup"><span data-stu-id="77944-365">AllowHTTPSFromDMZ</span></span> |<span data-ttu-id="77944-366">Permitir la comunicación HTTPS desde la red perimetral</span><span class="sxs-lookup"><span data-stu-id="77944-366">Allow the HTTPS communication from DMZ</span></span> |<span data-ttu-id="77944-367">Entrada</span><span class="sxs-lookup"><span data-stu-id="77944-367">Inbound</span></span> |
| <span data-ttu-id="77944-368">DenyInternetOutbound</span><span class="sxs-lookup"><span data-stu-id="77944-368">DenyInternetOutbound</span></span> |<span data-ttu-id="77944-369">Sin acceso a Internet</span><span class="sxs-lookup"><span data-stu-id="77944-369">No access to internet</span></span> |<span data-ttu-id="77944-370">Salida</span><span class="sxs-lookup"><span data-stu-id="77944-370">Outbound</span></span> |

![Reglas de acceso INT (entrantes)](./media/active-directory-aadconnect-azure-adfs/nsg_int.png)

<span data-ttu-id="77944-372">[comentario]: <> (![reglas de acceso INT (entrantes)](./media/active-directory-aadconnect-azure-adfs/nsgintinbound.png)) [comentario]: <> (![reglas de acceso INT (salientes)](./media/active-directory-aadconnect-azure-adfs/nsgintoutbound.png))</span><span class="sxs-lookup"><span data-stu-id="77944-372">[comment]: <> (![INT access rules (inbound)](./media/active-directory-aadconnect-azure-adfs/nsgintinbound.png)) [comment]: <> (![INT access rules (outbound)](./media/active-directory-aadconnect-azure-adfs/nsgintoutbound.png))</span></span>

<span data-ttu-id="77944-373">**9.2. Protección de la subred DMZ**</span><span class="sxs-lookup"><span data-stu-id="77944-373">**9.2. Securing the DMZ subnet**</span></span>

| <span data-ttu-id="77944-374">Regla</span><span class="sxs-lookup"><span data-stu-id="77944-374">Rule</span></span> | <span data-ttu-id="77944-375">Descripción</span><span class="sxs-lookup"><span data-stu-id="77944-375">Description</span></span> | <span data-ttu-id="77944-376">Flujo</span><span class="sxs-lookup"><span data-stu-id="77944-376">Flow</span></span> |
|:--- |:--- |:---:|
| <span data-ttu-id="77944-377">AllowHTTPSFromInternet</span><span class="sxs-lookup"><span data-stu-id="77944-377">AllowHTTPSFromInternet</span></span> |<span data-ttu-id="77944-378">Permite HTTPS de Internet a la red perimetral</span><span class="sxs-lookup"><span data-stu-id="77944-378">Allow HTTPS from internet to the DMZ</span></span> |<span data-ttu-id="77944-379">Entrada</span><span class="sxs-lookup"><span data-stu-id="77944-379">Inbound</span></span> |
| <span data-ttu-id="77944-380">DenyInternetOutbound</span><span class="sxs-lookup"><span data-stu-id="77944-380">DenyInternetOutbound</span></span> |<span data-ttu-id="77944-381">No se bloquea nada, excepto HTTPS a Internet</span><span class="sxs-lookup"><span data-stu-id="77944-381">Anything except HTTPS to internet is blocked</span></span> |<span data-ttu-id="77944-382">Salida</span><span class="sxs-lookup"><span data-stu-id="77944-382">Outbound</span></span> |

![Reglas de acceso EXT (entrantes)](./media/active-directory-aadconnect-azure-adfs/nsg_dmz.png)

<span data-ttu-id="77944-384">[comentario]: <> (![reglas de acceso EXT (entrantes)](./media/active-directory-aadconnect-azure-adfs/nsgdmzinbound.png)) [comentario]: <> (![reglas de acceso EXT (salientes)](./media/active-directory-aadconnect-azure-adfs/nsgdmzoutbound.png))</span><span class="sxs-lookup"><span data-stu-id="77944-384">[comment]: <> (![EXT access rules (inbound)](./media/active-directory-aadconnect-azure-adfs/nsgdmzinbound.png)) [comment]: <> (![EXT access rules (outbound)](./media/active-directory-aadconnect-azure-adfs/nsgdmzoutbound.png))</span></span>

> [!NOTE]
> <span data-ttu-id="77944-385">Si se requiere la autenticación del certificado de usuario del cliente (autenticación de clientTLS mediante certificados de usuario X509), AD FS necesitará que el puerto TCP 49443 esté habilitado para el acceso de entrada.</span><span class="sxs-lookup"><span data-stu-id="77944-385">If client user certificate authentication (clientTLS authentication using X509 user certificates) is required, then AD FS requires TCP port 49443 be enabled for inbound access.</span></span>
> 
> 

### <a name="10-test-the-ad-fs-sign-in"></a><span data-ttu-id="77944-386">10. Prueba del inicio de sesión de AD FS</span><span class="sxs-lookup"><span data-stu-id="77944-386">10. Test the AD FS sign-in</span></span>
<span data-ttu-id="77944-387">La forma más sencilla es probar AD FS mediante la página IdpInitiatedSignon.aspx.</span><span class="sxs-lookup"><span data-stu-id="77944-387">The easiest way is to test AD FS is by using the IdpInitiatedSignon.aspx page.</span></span> <span data-ttu-id="77944-388">Para poder hacerlo, es necesario habilitar IdpInitiatedSignOn en las propiedades de AD FS.</span><span class="sxs-lookup"><span data-stu-id="77944-388">In order to be able to do that, it is required to enable the IdpInitiatedSignOn on the AD FS properties.</span></span> <span data-ttu-id="77944-389">Siga estos pasos para comprobar la configuración de AD FS.</span><span class="sxs-lookup"><span data-stu-id="77944-389">Follow the steps below to verify your AD FS setup</span></span>

1. <span data-ttu-id="77944-390">Ejecute el siguiente cmdlet en el servidor AD FS, con PowerShell, para habilitarlo.</span><span class="sxs-lookup"><span data-stu-id="77944-390">Run the below cmdlet on the AD FS server, using PowerShell, to set it to enabled.</span></span>
   <span data-ttu-id="77944-391">Set-AdfsProperties -EnableIdPInitiatedSignonPage $true</span><span class="sxs-lookup"><span data-stu-id="77944-391">Set-AdfsProperties -EnableIdPInitiatedSignonPage $true</span></span> 
2. <span data-ttu-id="77944-392">Desde cualquier acceso de equipo externo https://adfs.thecloudadvocate.com/adfs/ls/IdpInitiatedSignon.aspx</span><span class="sxs-lookup"><span data-stu-id="77944-392">From any external machine access https://adfs.thecloudadvocate.com/adfs/ls/IdpInitiatedSignon.aspx</span></span>  
3. <span data-ttu-id="77944-393">Debería ver la página de AD FS como aparece a continuación:</span><span class="sxs-lookup"><span data-stu-id="77944-393">You should see the AD FS page like below:</span></span>

![Prueba de la página de inicio de sesión](./media/active-directory-aadconnect-azure-adfs/test1.png)

<span data-ttu-id="77944-395">Cuando se inicia sesión correctamente, aparecerá un mensaje de confirmación similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="77944-395">On successful sign-in, it will provide you with a success message as shown below:</span></span>

![Prueba correcta](./media/active-directory-aadconnect-azure-adfs/test2.png)

## <a name="template-for-deploying-ad-fs-in-azure"></a><span data-ttu-id="77944-397">Plantilla de implementación de AD FS en Azure</span><span class="sxs-lookup"><span data-stu-id="77944-397">Template for deploying AD FS in Azure</span></span>
<span data-ttu-id="77944-398">La plantilla implementa una instalación de 6 equipos para controladores de dominio, AD FS y WAP (2 para cada uno).</span><span class="sxs-lookup"><span data-stu-id="77944-398">The template deploys a 6 machine setup, 2 each for Domain Controllers, AD FS and WAP.</span></span>

[<span data-ttu-id="77944-399">Plantilla de implementación de AD FS en Azure</span><span class="sxs-lookup"><span data-stu-id="77944-399">AD FS in Azure Deployment Template</span></span>](https://github.com/paulomarquesc/adfs-6vms-regular-template-based)

<span data-ttu-id="77944-400">Puede usar una red virtual existente o crear una nueva red virtual durante la implementación de esta plantilla.</span><span class="sxs-lookup"><span data-stu-id="77944-400">You can use an existing virtual network or create a new VNET while deploying this template.</span></span> <span data-ttu-id="77944-401">A continuación se enumeran los distintos parámetros disponibles para personalizar la implementación con la descripción del uso del parámetro en el proceso de implementación.</span><span class="sxs-lookup"><span data-stu-id="77944-401">The various parameters available for customizing the deployment are listed below with the description of usage of the parameter in the deployment process.</span></span> 

| <span data-ttu-id="77944-402">Parámetro</span><span class="sxs-lookup"><span data-stu-id="77944-402">Parameter</span></span> | <span data-ttu-id="77944-403">Descripción</span><span class="sxs-lookup"><span data-stu-id="77944-403">Description</span></span> |
|:--- |:--- |
| <span data-ttu-id="77944-404">Ubicación</span><span class="sxs-lookup"><span data-stu-id="77944-404">Location</span></span> |<span data-ttu-id="77944-405">La región para implementar los recursos, por ejemplo, este de EE. UU.</span><span class="sxs-lookup"><span data-stu-id="77944-405">The region to deploy the resources into, e.g. East US.</span></span> |
| <span data-ttu-id="77944-406">StorageAccountType</span><span class="sxs-lookup"><span data-stu-id="77944-406">StorageAccountType</span></span> |<span data-ttu-id="77944-407">El tipo de la cuenta de almacenamiento creada</span><span class="sxs-lookup"><span data-stu-id="77944-407">The type of the Storage Account created</span></span> |
| <span data-ttu-id="77944-408">VirtualNetworkUsage</span><span class="sxs-lookup"><span data-stu-id="77944-408">VirtualNetworkUsage</span></span> |<span data-ttu-id="77944-409">Indica si se creará una nueva red virtual o se va a utilizar una existente</span><span class="sxs-lookup"><span data-stu-id="77944-409">Indicates if a new virtual network will be created or use an existing one</span></span> |
| <span data-ttu-id="77944-410">VirtualNetworkName</span><span class="sxs-lookup"><span data-stu-id="77944-410">VirtualNetworkName</span></span> |<span data-ttu-id="77944-411">El nombre de la red virtual a crear, esto es obligatorio tanto en el caso del uso de una nueva red virtual como de una existente</span><span class="sxs-lookup"><span data-stu-id="77944-411">The name of the Virtual Network to Create, mandatory on both existing or new virtual network usage</span></span> |
| <span data-ttu-id="77944-412">VirtualNetworkResourceGroupName</span><span class="sxs-lookup"><span data-stu-id="77944-412">VirtualNetworkResourceGroupName</span></span> |<span data-ttu-id="77944-413">Especifica el nombre del grupo de recursos donde reside la red virtual existente.</span><span class="sxs-lookup"><span data-stu-id="77944-413">Specifies the name of the resource group where the existing virtual network resides.</span></span> <span data-ttu-id="77944-414">Cuando se utiliza una red virtual existente, esto se convierte en un parámetro obligatorio para que la implementación pueda encontrar el identificador de dicha red virtual</span><span class="sxs-lookup"><span data-stu-id="77944-414">When using an existing virtual network, this becomes a mandatory parameter so the deployment can find the ID of the existing virtual network</span></span> |
| <span data-ttu-id="77944-415">VirtualNetworkAddressRange</span><span class="sxs-lookup"><span data-stu-id="77944-415">VirtualNetworkAddressRange</span></span> |<span data-ttu-id="77944-416">El intervalo de direcciones de la nueva red virtual, obligatorio si se crea una nueva red virtual</span><span class="sxs-lookup"><span data-stu-id="77944-416">The address range of the new VNET, mandatory if creating a new virtual network</span></span> |
| <span data-ttu-id="77944-417">InternalSubnetName</span><span class="sxs-lookup"><span data-stu-id="77944-417">InternalSubnetName</span></span> |<span data-ttu-id="77944-418">El nombre de la subred interna, obligatorio en ambas opciones de uso de red virtual (nueva o existente)</span><span class="sxs-lookup"><span data-stu-id="77944-418">The name of the internal subnet, mandatory on both virtual network usage options (new or existing)</span></span> |
| <span data-ttu-id="77944-419">InternalSubnetAddressRange</span><span class="sxs-lookup"><span data-stu-id="77944-419">InternalSubnetAddressRange</span></span> |<span data-ttu-id="77944-420">El intervalo de direcciones de la subred interna, que contiene los controladores de dominio y los servidores ADFS, obligatorio si se crea una nueva red virtual.</span><span class="sxs-lookup"><span data-stu-id="77944-420">The address range of the internal subnet, which contains the Domain Controllers and ADFS servers, mandatory if creating a new virtual network.</span></span> |
| <span data-ttu-id="77944-421">DMZSubnetAddressRange</span><span class="sxs-lookup"><span data-stu-id="77944-421">DMZSubnetAddressRange</span></span> |<span data-ttu-id="77944-422">El intervalo de direcciones de la subred perimetral, que contiene los servidores proxy de aplicación de Windows, obligatorio si se crea una nueva red virtual.</span><span class="sxs-lookup"><span data-stu-id="77944-422">The address range of the dmz subnet, which contains the Windows application proxy servers, mandatory if creating a new virtual network.</span></span> |
| <span data-ttu-id="77944-423">DMZSubnetName</span><span class="sxs-lookup"><span data-stu-id="77944-423">DMZSubnetName</span></span> |<span data-ttu-id="77944-424">El nombre de la subred interna, obligatorio en ambas opciones de uso de red virtual (nueva o existente).</span><span class="sxs-lookup"><span data-stu-id="77944-424">The name of the internal subnet, mandatory on both virtual network usage options (new or existing).</span></span> |
| <span data-ttu-id="77944-425">ADDC01NICIPAddress</span><span class="sxs-lookup"><span data-stu-id="77944-425">ADDC01NICIPAddress</span></span> |<span data-ttu-id="77944-426">La dirección IP interna del primer controlador de dominio, esta dirección IP se asignarán estáticamente al controlador de dominio y tiene que ser una dirección IP válida dentro de la subred interna</span><span class="sxs-lookup"><span data-stu-id="77944-426">The internal IP address of the first Domain Controller, this IP address will be statically assigned to the DC and must be a valid ip address within the Internal subnet</span></span> |
| <span data-ttu-id="77944-427">ADDC02NICIPAddress</span><span class="sxs-lookup"><span data-stu-id="77944-427">ADDC02NICIPAddress</span></span> |<span data-ttu-id="77944-428">La dirección IP interna del segundo controlador de dominio, esta dirección IP se asignarán estáticamente al controlador de dominio y tiene que ser una dirección IP válida dentro de la subred interna</span><span class="sxs-lookup"><span data-stu-id="77944-428">The internal IP address of the second Domain Controller, this IP address will be statically assigned to the DC and must be a valid ip address within the Internal subnet</span></span> |
| <span data-ttu-id="77944-429">ADFS01NICIPAddress</span><span class="sxs-lookup"><span data-stu-id="77944-429">ADFS01NICIPAddress</span></span> |<span data-ttu-id="77944-430">La dirección IP interna del primer servidor ADFS, esta dirección IP se asignarán estáticamente al servidor ADFS y tiene que ser una dirección IP válida dentro de la subred interna</span><span class="sxs-lookup"><span data-stu-id="77944-430">The internal IP address of the first ADFS server, this IP address will be statically assigned to the ADFS server and must be a valid ip address within the Internal subnet</span></span> |
| <span data-ttu-id="77944-431">ADFS02NICIPAddress</span><span class="sxs-lookup"><span data-stu-id="77944-431">ADFS02NICIPAddress</span></span> |<span data-ttu-id="77944-432">La dirección IP interna del segundo servidor ADFS, esta dirección IP se asignarán estáticamente al servidor ADFS y tiene que ser una dirección IP válida dentro de la subred interna</span><span class="sxs-lookup"><span data-stu-id="77944-432">The internal IP address of the second ADFS server, this IP address will be statically assigned to the ADFS server and must be a valid ip address within the Internal subnet</span></span> |
| <span data-ttu-id="77944-433">WAP01NICIPAddress</span><span class="sxs-lookup"><span data-stu-id="77944-433">WAP01NICIPAddress</span></span> |<span data-ttu-id="77944-434">La dirección IP interna del primer servidor WAP, esta dirección IP se asignarán estáticamente al servidor WAP y tiene que ser una dirección IP válida dentro de la subred perimetral</span><span class="sxs-lookup"><span data-stu-id="77944-434">The internal IP address of the first WAP server, this IP address will be statically assigned to the WAP server and must be a valid ip address within the DMZ subnet</span></span> |
| <span data-ttu-id="77944-435">WAP02NICIPAddress</span><span class="sxs-lookup"><span data-stu-id="77944-435">WAP02NICIPAddress</span></span> |<span data-ttu-id="77944-436">La dirección IP interna del segundo servidor WAP, esta dirección IP se asignarán estáticamente al servidor WAP y tiene que ser una dirección IP válida dentro de la subred perimetral</span><span class="sxs-lookup"><span data-stu-id="77944-436">The internal IP address of the second WAP server, this IP address will be statically assigned to the WAP server and must be a valid ip address within the DMZ subnet</span></span> |
| <span data-ttu-id="77944-437">ADFSLoadBalancerPrivateIPAddress</span><span class="sxs-lookup"><span data-stu-id="77944-437">ADFSLoadBalancerPrivateIPAddress</span></span> |<span data-ttu-id="77944-438">La dirección IP interna del equilibrador de carga ADFS, esta dirección IP se asignarán estáticamente al equilibrador de carga ADFS y tiene que ser una dirección IP válida dentro de la subred interna</span><span class="sxs-lookup"><span data-stu-id="77944-438">The internal IP address of the ADFS load balancer, this IP address will be statically assigned to the load balancer and must be a valid ip address within the Internal subnet</span></span> |
| <span data-ttu-id="77944-439">ADDCVMNamePrefix</span><span class="sxs-lookup"><span data-stu-id="77944-439">ADDCVMNamePrefix</span></span> |<span data-ttu-id="77944-440">Prefijo del nombre de máquina virtual para los controladores de dominio</span><span class="sxs-lookup"><span data-stu-id="77944-440">Virtual Machine name prefix for Domain Controllers</span></span> |
| <span data-ttu-id="77944-441">ADFSVMNamePrefix</span><span class="sxs-lookup"><span data-stu-id="77944-441">ADFSVMNamePrefix</span></span> |<span data-ttu-id="77944-442">Prefijo del nombre de máquina virtual para los servidores ADFS</span><span class="sxs-lookup"><span data-stu-id="77944-442">Virtual Machine name prefix for ADFS servers</span></span> |
| <span data-ttu-id="77944-443">WAPVMNamePrefix</span><span class="sxs-lookup"><span data-stu-id="77944-443">WAPVMNamePrefix</span></span> |<span data-ttu-id="77944-444">Prefijo del nombre de máquina virtual para los servidores WAP</span><span class="sxs-lookup"><span data-stu-id="77944-444">Virtual Machine name prefix for WAP servers</span></span> |
| <span data-ttu-id="77944-445">ADDCVMSize</span><span class="sxs-lookup"><span data-stu-id="77944-445">ADDCVMSize</span></span> |<span data-ttu-id="77944-446">El tamaño de máquina virtual de los controladores de dominio</span><span class="sxs-lookup"><span data-stu-id="77944-446">The vm size of the Domain Controllers</span></span> |
| <span data-ttu-id="77944-447">ADFSVMSize</span><span class="sxs-lookup"><span data-stu-id="77944-447">ADFSVMSize</span></span> |<span data-ttu-id="77944-448">El tamaño de máquina virtual de los servidores ADFS</span><span class="sxs-lookup"><span data-stu-id="77944-448">The vm size of the ADFS servers</span></span> |
| <span data-ttu-id="77944-449">WAPVMSize</span><span class="sxs-lookup"><span data-stu-id="77944-449">WAPVMSize</span></span> |<span data-ttu-id="77944-450">El tamaño de máquina virtual de los servidores WAP</span><span class="sxs-lookup"><span data-stu-id="77944-450">The vm size of the WAP servers</span></span> |
| <span data-ttu-id="77944-451">AdminUserName</span><span class="sxs-lookup"><span data-stu-id="77944-451">AdminUserName</span></span> |<span data-ttu-id="77944-452">El nombre del administrador local de las máquinas virtuales</span><span class="sxs-lookup"><span data-stu-id="77944-452">The name of the local Administrator of the virtual machines</span></span> |
| <span data-ttu-id="77944-453">AdminPassword</span><span class="sxs-lookup"><span data-stu-id="77944-453">AdminPassword</span></span> |<span data-ttu-id="77944-454">La contraseña de la cuenta del administrador local de las máquinas virtuales</span><span class="sxs-lookup"><span data-stu-id="77944-454">The password for the local Administrator account of the virtual machines</span></span> |

## <a name="additional-resources"></a><span data-ttu-id="77944-455">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="77944-455">Additional resources</span></span>
* [<span data-ttu-id="77944-456">Conjuntos de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="77944-456">Availability Sets</span></span>](https://aka.ms/Azure/Availability) 
* [<span data-ttu-id="77944-457">Equilibrador de carga de Azure</span><span class="sxs-lookup"><span data-stu-id="77944-457">Azure Load Balancer</span></span>](https://aka.ms/Azure/ILB)
* [<span data-ttu-id="77944-458">Equilibrador de carga interno</span><span class="sxs-lookup"><span data-stu-id="77944-458">Internal Load Balancer</span></span>](https://aka.ms/Azure/ILB/Internal)
* [<span data-ttu-id="77944-459">Equilibrador de carga accesible desde Internet</span><span class="sxs-lookup"><span data-stu-id="77944-459">Internet Facing Load Balancer</span></span>](https://aka.ms/Azure/ILB/Internet)
* [<span data-ttu-id="77944-460">Cuentas de almacenamiento</span><span class="sxs-lookup"><span data-stu-id="77944-460">Storage Accounts</span></span>](https://aka.ms/Azure/Storage)
* [<span data-ttu-id="77944-461">Redes virtuales de Azure</span><span class="sxs-lookup"><span data-stu-id="77944-461">Azure Virtual Networks</span></span>](https://aka.ms/Azure/VNet)
* [<span data-ttu-id="77944-462">AD FS y vínculos de proxy de aplicación web</span><span class="sxs-lookup"><span data-stu-id="77944-462">AD FS and Web Application Proxy Links</span></span>](http://aka.ms/ADFSLinks) 

## <a name="next-steps"></a><span data-ttu-id="77944-463">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="77944-463">Next steps</span></span>
* [<span data-ttu-id="77944-464">Integración de las identidades locales con Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="77944-464">Integrating your on-premises identities with Azure Active Directory</span></span>](active-directory-aadconnect.md)
* [<span data-ttu-id="77944-465">Configuración y administración de AD FS con Azure AD Connect</span><span class="sxs-lookup"><span data-stu-id="77944-465">Configuring and managing your AD FS using Azure AD Connect</span></span>](active-directory-aadconnectfed-whatis.md)
* [<span data-ttu-id="77944-466">Implementación de AD FS en Azure de alta disponibilidad entre regiones geográficas con Azure Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="77944-466">High availability cross-geographic AD FS deployment in Azure with Azure Traffic Manager</span></span>](../active-directory-adfs-in-azure-with-azure-traffic-manager.md)


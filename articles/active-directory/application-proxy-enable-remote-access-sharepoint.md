---
title: "Habilitar el acceso remoto a SharePoint con el Proxy de aplicación de Azure AD | Microsoft Docs"
description: "Explica los conceptos básicos sobre cómo integrar un servidor de SharePoint local con el proxy de aplicación de Azure AD."
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/21/2017
ms.author: kgremban
ms.reviewer: harshja
ms.custom: it-pro
ms.openlocfilehash: 97eeec3b3936bcbef6ac3966b890332901bcb153
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/03/2017
---
# <a name="enable-remote-access-to-sharepoint-with-azure-ad-application-proxy"></a><span data-ttu-id="4bc54-103">Habilitar el acceso remoto a SharePoint con el proxy de aplicación de Azure AD</span><span class="sxs-lookup"><span data-stu-id="4bc54-103">Enable remote access to SharePoint with Azure AD Application Proxy</span></span>

<span data-ttu-id="4bc54-104">En este artículo se describe cómo integrar un servidor de SharePoint local con el proxy de aplicación de Azure Active Directory (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="4bc54-104">This article discusses how to integrate an on-premises SharePoint server with Azure Active Directory (Azure AD) Application Proxy.</span></span>

<span data-ttu-id="4bc54-105">Para habilitar el acceso remoto a SharePoint con el proxy de aplicación de Azure AD, siga los pasos de las secciones de este artículo.</span><span class="sxs-lookup"><span data-stu-id="4bc54-105">To enable remote access to SharePoint with Azure AD Application Proxy, follow the sections in this article step by step.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="4bc54-106">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="4bc54-106">Prerequisites</span></span>

<span data-ttu-id="4bc54-107">En este artículo se da por supuesto que ya tiene SharePoint 2013 o una versión más reciente instalada en su entorno.</span><span class="sxs-lookup"><span data-stu-id="4bc54-107">This article assumes that you already have SharePoint 2013 or newer in your environment.</span></span> <span data-ttu-id="4bc54-108">Además, tenga en cuenta los siguientes requisitos previos:</span><span class="sxs-lookup"><span data-stu-id="4bc54-108">In addition, consider the following prerequisites:</span></span>

* <span data-ttu-id="4bc54-109">SharePoint incluye compatibilidad nativa con Kerberos.</span><span class="sxs-lookup"><span data-stu-id="4bc54-109">SharePoint includes native Kerberos support.</span></span> <span data-ttu-id="4bc54-110">Por tanto, los usuarios que tengan acceso a sitios internos de forma remota a través del proxy de aplicación de Azure AD pueden suponer que tienen a su disposición una experiencia de inicio de sesión único (SSO) sin interrupciones.</span><span class="sxs-lookup"><span data-stu-id="4bc54-110">Therefore, users who are accessing internal sites remotely through Azure AD Application Proxy can assume to have a single sign-on (SSO) experience.</span></span>

* <span data-ttu-id="4bc54-111">Tiene que realizar algunos cambios de configuración en el servidor de SharePoint.</span><span class="sxs-lookup"><span data-stu-id="4bc54-111">You need to make a few configuration changes to your SharePoint server.</span></span> <span data-ttu-id="4bc54-112">Se recomienda usar un entorno de ensayo.</span><span class="sxs-lookup"><span data-stu-id="4bc54-112">We recommend using a staging environment.</span></span> <span data-ttu-id="4bc54-113">Así, podrá realizar actualizaciones en el servidor de ensayo en primer lugar y, después, facilitar un ciclo de pruebas antes de pasar a producción.</span><span class="sxs-lookup"><span data-stu-id="4bc54-113">This way, you can make updates to your staging server first, and then facilitate a testing cycle before going into production.</span></span>

* <span data-ttu-id="4bc54-114">Se supone que ya configuró SSL para SharePoint, dado que se requiere SSL en la dirección URL publicada.</span><span class="sxs-lookup"><span data-stu-id="4bc54-114">We assume that you have already set up SSL for SharePoint, because we require SSL on the published URL.</span></span> <span data-ttu-id="4bc54-115">Debe tener habilitado SSL en el sitio interno para asegurarse de que los vínculos se envían o asignan correctamente.</span><span class="sxs-lookup"><span data-stu-id="4bc54-115">You need to have SSL enabled on your internal site, to ensure that links are sent/mapped correctly.</span></span> <span data-ttu-id="4bc54-116">Si no configuró SSL, vea [Configure SSL for SharePoint 2013 (Configurar SSL para SharePoint 2013)](https://blogs.msdn.microsoft.com/fabdulwahab/2013/01/20/configure-ssl-for-sharepoint-2013) para obtener instrucciones.</span><span class="sxs-lookup"><span data-stu-id="4bc54-116">If you haven't configured SSL, see [Configure SSL for SharePoint 2013](https://blogs.msdn.microsoft.com/fabdulwahab/2013/01/20/configure-ssl-for-sharepoint-2013) for instructions.</span></span> <span data-ttu-id="4bc54-117">Además, asegúrese de que la máquina de conector confía en el certificado que emite.</span><span class="sxs-lookup"><span data-stu-id="4bc54-117">Also, make sure that the connector machine trusts the certificate that you issue.</span></span> <span data-ttu-id="4bc54-118">(No es necesario que sea un certificado emitido públicamente).</span><span class="sxs-lookup"><span data-stu-id="4bc54-118">(The certificate does not need to be publicly issued.)</span></span>

## <a name="step-1-set-up-single-sign-on-to-sharepoint"></a><span data-ttu-id="4bc54-119">Parte 1: Configurar el inicio de sesión único en SharePoint</span><span class="sxs-lookup"><span data-stu-id="4bc54-119">Step 1: Set up single sign-on to SharePoint</span></span>

<span data-ttu-id="4bc54-120">Nuestros clientes quieren la mejor experiencia de SSO en sus aplicaciones de back-end, en este caso, el servidor de SharePoint.</span><span class="sxs-lookup"><span data-stu-id="4bc54-120">Our customers want the best SSO experience for their back-end applications, SharePoint server in this case.</span></span> <span data-ttu-id="4bc54-121">En este escenario habitual de Azure AD, el usuario se autentica solo una vez, ya que no se le pedirá que se autentique de nuevo.</span><span class="sxs-lookup"><span data-stu-id="4bc54-121">In this common Azure AD scenario, the user is authenticated only once, because they will not be prompted for authentication again.</span></span>

<span data-ttu-id="4bc54-122">Para las aplicaciones locales que requieren o usan la autenticación de Windows, el SSO puede lograrse mediante el protocolo de autenticación Kerberos y una característica denominada delegación limitada de Kerberos (KCD).</span><span class="sxs-lookup"><span data-stu-id="4bc54-122">For on-premises applications that require or use Windows authentication, you can achieve SSO by using the Kerberos authentication protocol and a feature called Kerberos constrained delegation (KCD).</span></span> <span data-ttu-id="4bc54-123">La KCD, cuando está configurada, permite que el conector del proxy de aplicación obtenga un vale o token de Windows para un usuario, incluso si el usuario no inició sesión en Windows directamente.</span><span class="sxs-lookup"><span data-stu-id="4bc54-123">KCD, when configured, allows the Application Proxy connector to obtain a windows ticket/token for a user, even if the user hasn’t signed in to Windows directly.</span></span> <span data-ttu-id="4bc54-124">Para obtener más información acerca de KCD, vea [Introducción a la delegación limitada de Kerberos](https://technet.microsoft.com/library/jj553400.aspx).</span><span class="sxs-lookup"><span data-stu-id="4bc54-124">To learn more about KCD, see [Kerberos Constrained Delegation Overview](https://technet.microsoft.com/library/jj553400.aspx).</span></span>

<span data-ttu-id="4bc54-125">Para configurar KCD para un servidor de SharePoint, use los procedimientos de las siguientes secciones secuenciales:</span><span class="sxs-lookup"><span data-stu-id="4bc54-125">To set up KCD for a SharePoint server, use the procedures in the following sequential sections:</span></span>

### <a name="ensure-that-sharepoint-is-running-under-a-service-account"></a><span data-ttu-id="4bc54-126">Asegurarse de que SharePoint se ejecuta como una cuenta de servicio</span><span class="sxs-lookup"><span data-stu-id="4bc54-126">Ensure that SharePoint is running under a service account</span></span>

<span data-ttu-id="4bc54-127">En primer lugar, asegúrese de que SharePoint se ejecuta bajo una cuenta de servicio definida, no de sistema local, servicio local o servicio de red.</span><span class="sxs-lookup"><span data-stu-id="4bc54-127">First, make sure that SharePoint is running under a defined service account--not local system, local service, or network service.</span></span> <span data-ttu-id="4bc54-128">Para ello, es necesario que pueda asociar nombres de entidad de servicio (SPN) a una cuenta válida.</span><span class="sxs-lookup"><span data-stu-id="4bc54-128">Do this so that you can attach service principal names (SPNs) to a valid account.</span></span> <span data-ttu-id="4bc54-129">Los SPN son la forma que utiliza el protocolo de Kerberos para distinguir los diferentes servicios.</span><span class="sxs-lookup"><span data-stu-id="4bc54-129">SPNs are how the Kerberos protocol identifies different services.</span></span> <span data-ttu-id="4bc54-130">Y necesitará la cuenta más adelante para configurar KCD.</span><span class="sxs-lookup"><span data-stu-id="4bc54-130">And you will need the account later to configure the KCD.</span></span>

<span data-ttu-id="4bc54-131">Para asegurarse de que los sitios se ejecutan en una cuenta de servicio definido, sita estos pasos:</span><span class="sxs-lookup"><span data-stu-id="4bc54-131">To ensure that your sites are running under a defined service account, perform the following steps:</span></span>

1. <span data-ttu-id="4bc54-132">Abra el sitio de **Administración central de SharePoint 2013**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-132">Open the **SharePoint 2013 Central Administration** site.</span></span>
2. <span data-ttu-id="4bc54-133">Vaya a **Seguridad** y seleccione **Configurar cuentas de servicio**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-133">Go to **Security** and select **Configure service accounts**.</span></span>
3. <span data-ttu-id="4bc54-134">Seleccione **Grupo de aplicaciones web - SharePoint - 80**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-134">Select **Web Application Pool - SharePoint - 80**.</span></span> <span data-ttu-id="4bc54-135">Las opciones pueden ser ligeramente diferentes según el nombre del grupo web o si el grupo web usa SSL de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="4bc54-135">The options may be slightly different based on the name of your web pool, or if the web pool uses SSL by default.</span></span>

  ![Opciones para configurar una cuenta de servicio](./media/application-proxy-remote-sharepoint/remote-sharepoint-service-web-application.png)

4. <span data-ttu-id="4bc54-137">Si **Seleccione una cuenta para este componente** está establecido en **Servicio Local** o **Servicio de red**, tendrá que crear una cuenta.</span><span class="sxs-lookup"><span data-stu-id="4bc54-137">If **Select an account for this component** is **Local Service** or **Network Service**, you need to create an account.</span></span> <span data-ttu-id="4bc54-138">Si no es así, ya habrá terminado y puede ir a la sección siguiente.</span><span class="sxs-lookup"><span data-stu-id="4bc54-138">If not, you're finished and can move to the next section.</span></span>
5. <span data-ttu-id="4bc54-139">Haga clic en **Registrar una nueva cuenta administrada**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-139">Select **Register new managed account**.</span></span> <span data-ttu-id="4bc54-140">Una vez creada la cuenta, debe configurar el **Grupo de aplicaciones web** antes de poder usar la cuenta.</span><span class="sxs-lookup"><span data-stu-id="4bc54-140">After your account is created, you must set **Web Application Pool** before you can use the account.</span></span>

> [!NOTE]
<span data-ttu-id="4bc54-141">Debe tener una cuenta de Azure AD previamente creada para el servicio.</span><span class="sxs-lookup"><span data-stu-id="4bc54-141">You need to have a previously created Azure AD account for the service.</span></span> <span data-ttu-id="4bc54-142">Se recomienda que permita un cambio de contraseña automático.</span><span class="sxs-lookup"><span data-stu-id="4bc54-142">We suggest that you allow for an automatic password change.</span></span> <span data-ttu-id="4bc54-143">Para más información sobre el conjunto completo de pasos y la solución de problemas, vea [Configurar el cambio de contraseña automático en SharePoint 2013](https://technet.microsoft.com/library/ff724280.aspx).</span><span class="sxs-lookup"><span data-stu-id="4bc54-143">For more information about the full set of steps and troubleshooting issues, see [Configure automatic password change in SharePoint 2013](https://technet.microsoft.com/library/ff724280.aspx).</span></span>

### <a name="configure-sharepoint-for-kerberos"></a><span data-ttu-id="4bc54-144">Configurar SharePoint para Kerberos</span><span class="sxs-lookup"><span data-stu-id="4bc54-144">Configure SharePoint for Kerberos</span></span>

<span data-ttu-id="4bc54-145">Se usa KCD para realizar el inicio de sesión único en el servidor de SharePoint, y esto solo funciona con Kerberos.</span><span class="sxs-lookup"><span data-stu-id="4bc54-145">You use KCD to perform single sign-on to the SharePoint server, and this works only with Kerberos.</span></span>

<span data-ttu-id="4bc54-146">Para configurar el sitio de SharePoint para la autenticación de Kerberos:</span><span class="sxs-lookup"><span data-stu-id="4bc54-146">To configure your SharePoint site for Kerberos authentication:</span></span>

1. <span data-ttu-id="4bc54-147">Abra el sitio de **Administración central de SharePoint 2013**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-147">Open the **SharePoint 2013 Central Administration** site.</span></span>
2. <span data-ttu-id="4bc54-148">Vaya a **Administración de aplicaciones**, haga clic en **Administrar aplicaciones web** y seleccione el sitio de SharePoint.</span><span class="sxs-lookup"><span data-stu-id="4bc54-148">Go to **Application Management**, select **Manage web applications**, and select your SharePoint site.</span></span> <span data-ttu-id="4bc54-149">En este ejemplo, es **SharePoint – 80**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-149">In this example, it is **SharePoint - 80**.</span></span>

  ![Selección del sitio de SharePoint](./media/application-proxy-remote-sharepoint/remote-sharepoint-manage-web-applications.png)

3. <span data-ttu-id="4bc54-151">Haga clic en **Proveedores de autenticación** en la barra de herramientas.</span><span class="sxs-lookup"><span data-stu-id="4bc54-151">Click **Authentication Providers** on the toolbar.</span></span>
4. <span data-ttu-id="4bc54-152">En el cuadro **Proveedores de autenticación**, haga clic en **Zona predeterminada** para ver la configuración.</span><span class="sxs-lookup"><span data-stu-id="4bc54-152">In the **Authentication Providers** box, click **Default Zone** to view the settings.</span></span>
5. <span data-ttu-id="4bc54-153">En el cuadro de diálogo **Editar autenticación**, desplácese hacia abajo hasta que vea **Tipos de autenticación de notificaciones** y asegúrese de que están activadas las opciones **Habilitar autenticación de Windows** y **Autenticación integrada de Windows**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-153">In the **Edit Authentication** dialog box, scroll down until you see **Claims Authentication Types** and ensure that both **Enable Windows Authentication** and **Integrated Windows Authentication** are selected.</span></span>
6. <span data-ttu-id="4bc54-154">En el cuadro desplegable, asegúrese de que está seleccionada la opción **Negociar (Kerberos)**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-154">In the drop-down box, make sure that **Negotiate (Kerberos)** is selected.</span></span>

  ![Cuadro de diálogo Editar autenticación](./media/application-proxy-remote-sharepoint/remote-sharepoint-service-edit-authentication.png)

7. <span data-ttu-id="4bc54-156">En la parte inferior del cuadro de diálogo **Editar autenticación**, haga clic en **Guardar**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-156">At the bottom of the **Edit Authentication** dialog box, click **Save**.</span></span>

### <a name="set-a-service-principal-name-for-the-sharepoint-service-account"></a><span data-ttu-id="4bc54-157">Establecer un nombre de entidad de servicio para la cuenta de servicio de SharePoint</span><span class="sxs-lookup"><span data-stu-id="4bc54-157">Set a service principal name for the SharePoint service account</span></span>

<span data-ttu-id="4bc54-158">Antes de configurar KCD, es necesario identificar el servicio de SharePoint que se ejecuta como la cuenta de servicio que configuró.</span><span class="sxs-lookup"><span data-stu-id="4bc54-158">Before you configure the KCD, you need to identify the SharePoint service running as the service account that you've configured.</span></span> <span data-ttu-id="4bc54-159">Para ello se establece un SPN.</span><span class="sxs-lookup"><span data-stu-id="4bc54-159">You do this by setting an SPN.</span></span> <span data-ttu-id="4bc54-160">Para obtener más información, consulte [Service Principal Names](https://technet.microsoft.com/library/cc961723.aspx) (Nombres de entidad de seguridad de servicio).</span><span class="sxs-lookup"><span data-stu-id="4bc54-160">For more information, see [Service Principal Names](https://technet.microsoft.com/library/cc961723.aspx).</span></span>

<span data-ttu-id="4bc54-161">El formato de SPN es:</span><span class="sxs-lookup"><span data-stu-id="4bc54-161">The SPN format is:</span></span>

```
<service class>/<host>:<port>
```

<span data-ttu-id="4bc54-162">En el formato de SPN:</span><span class="sxs-lookup"><span data-stu-id="4bc54-162">In the SPN format:</span></span>

* <span data-ttu-id="4bc54-163">_service class_ es un nombre único para el servicio.</span><span class="sxs-lookup"><span data-stu-id="4bc54-163">_service class_ is a unique name for the service.</span></span> <span data-ttu-id="4bc54-164">Para SharePoint, se usa **HTTP**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-164">For SharePoint, you use **HTTP**.</span></span>

* <span data-ttu-id="4bc54-165">_host_ es el nombre de dominio completo o el nombre de NetBIOS del host en el que se está ejecutando el servicio.</span><span class="sxs-lookup"><span data-stu-id="4bc54-165">_host_ is the fully qualified domain or NetBIOS name of the host that the service is running on.</span></span> <span data-ttu-id="4bc54-166">En un sitio de SharePoint, es posible que este texto tenga que ser la dirección URL del sitio, según la versión de IIS que esté usando.</span><span class="sxs-lookup"><span data-stu-id="4bc54-166">For a SharePoint site, this text might need to be the URL of the site, depending on the version of IIS that you're using.</span></span>

* <span data-ttu-id="4bc54-167">_port_ es opcional.</span><span class="sxs-lookup"><span data-stu-id="4bc54-167">_port_ is optional.</span></span>

<span data-ttu-id="4bc54-168">Si el FQDN del servidor de SharePoint es:</span><span class="sxs-lookup"><span data-stu-id="4bc54-168">If the FQDN of the SharePoint server is:</span></span>

```
sharepoint.demo.o365identity.us
```

<span data-ttu-id="4bc54-169">El SPN será:</span><span class="sxs-lookup"><span data-stu-id="4bc54-169">Then the SPN is:</span></span>

```
HTTP/ sharepoint.demo.o365identity.us demo
```

<span data-ttu-id="4bc54-170">Es posible que también tenga que establecer el SPN para sitios específicos en el servidor.</span><span class="sxs-lookup"><span data-stu-id="4bc54-170">You might also need to set SPNs for specific sites on your server.</span></span> <span data-ttu-id="4bc54-171">Para más información, vea [Configuración de la autenticación Kerberos](https://technet.microsoft.com/library/cc263449(v=office.12).aspx).</span><span class="sxs-lookup"><span data-stu-id="4bc54-171">For more information, see [Configure Kerberos authentication](https://technet.microsoft.com/library/cc263449(v=office.12).aspx).</span></span> <span data-ttu-id="4bc54-172">Preste especial atención a la sección "Creación de nombres de entidad de seguridad de servicio para las aplicaciones web con la autenticación Kerberos".</span><span class="sxs-lookup"><span data-stu-id="4bc54-172">Pay close attention to the section "Create Service Principal Names for your Web applications using Kerberos authentication."</span></span>

<span data-ttu-id="4bc54-173">La forma más fácil de establecer SPN es seguir los formatos de SPN que ya pueden estar presentes para los sitios.</span><span class="sxs-lookup"><span data-stu-id="4bc54-173">The easiest way for you to set SPNs is to follow the SPN formats that may already be present for your sites.</span></span> <span data-ttu-id="4bc54-174">Copie los SPN para registrar en la cuenta de servicio.</span><span class="sxs-lookup"><span data-stu-id="4bc54-174">Copy those SPNs to register against the service account.</span></span> <span data-ttu-id="4bc54-175">Para ello, siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="4bc54-175">To do this:</span></span>

1. <span data-ttu-id="4bc54-176">Vaya al sitio con el SPN desde otro equipo.</span><span class="sxs-lookup"><span data-stu-id="4bc54-176">Browse to the site with the SPN from another machine.</span></span>
 <span data-ttu-id="4bc54-177">Al hacerlo, el conjunto pertinente de vales Kerberos se almacenan en la caché del equipo.</span><span class="sxs-lookup"><span data-stu-id="4bc54-177">When you do, the relevant set of Kerberos tickets is cached on the machine.</span></span> <span data-ttu-id="4bc54-178">Estos vales contienen el SPN del sitio de destino al que ha navegado.</span><span class="sxs-lookup"><span data-stu-id="4bc54-178">These tickets contain the SPN of the target site that you browsed to.</span></span>

2. <span data-ttu-id="4bc54-179">Se puede extraer el SPN de ese sitio mediante una herramienta denominada [Klist](http://web.mit.edu/kerberos/krb5-devel/doc/user/user_commands/klist.html).</span><span class="sxs-lookup"><span data-stu-id="4bc54-179">You can pull the SPN for that site by using a tool called [Klist](http://web.mit.edu/kerberos/krb5-devel/doc/user/user_commands/klist.html).</span></span> <span data-ttu-id="4bc54-180">En una ventana de comandos que se ejecute en el mismo contexto que el usuario que tuvo acceso al sitio en el explorador, ejecute el siguiente comando:</span><span class="sxs-lookup"><span data-stu-id="4bc54-180">In a command window that's running in the same context as the user who accessed the site in the browser, run the following command:</span></span>
```
Klist
```
<span data-ttu-id="4bc54-181">Klist devuelve después el conjunto de SPN de destino.</span><span class="sxs-lookup"><span data-stu-id="4bc54-181">Klist then returns the set of target SPNs.</span></span> <span data-ttu-id="4bc54-182">En este ejemplo, el valor resaltado es el SPN que se necesitaba:</span><span class="sxs-lookup"><span data-stu-id="4bc54-182">In this example, the highlighted value is the SPN that's needed:</span></span>

  ![Resultados del ejemplo de Klist](./media/application-proxy-remote-sharepoint/remote-sharepoint-target-service.png)

4. <span data-ttu-id="4bc54-184">Ahora que tiene el SPN, debe asegurarse de que esté configurado correctamente en la cuenta de servicio establecida anteriormente para la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="4bc54-184">Now that you have the SPN, you need to make sure that it's configured correctly on the service account that you set up for the web application earlier.</span></span> <span data-ttu-id="4bc54-185">Ejecute el comando siguiente desde el símbolo del sistema como administrador del dominio:</span><span class="sxs-lookup"><span data-stu-id="4bc54-185">Run the following command from the command prompt as an administrator of the domain:</span></span>

 ```
 setspn -S http/sharepoint.demo.o365identity.us demo\sp_svc
 ```

 <span data-ttu-id="4bc54-186">Este comando establece el SPN para la cuenta de servicio de SharePoint que se ejecuta como _demo\sp_svc_.</span><span class="sxs-lookup"><span data-stu-id="4bc54-186">This command sets the SPN for the SharePoint service account running as _demo\sp_svc_.</span></span>

 <span data-ttu-id="4bc54-187">Reemplace _http/sharepoint.demo.o365identity.us_ por el SPN para el servidor y _demo\sp_svc_ por la cuenta de servicio del entorno.</span><span class="sxs-lookup"><span data-stu-id="4bc54-187">Replace _http/sharepoint.demo.o365identity.us_ with the SPN for your server and _demo\sp_svc_ with the service account in your environment.</span></span> <span data-ttu-id="4bc54-188">El comando Setspn busca el SPN antes de agregarlo.</span><span class="sxs-lookup"><span data-stu-id="4bc54-188">The Setspn command searches for the SPN before it adds it.</span></span> <span data-ttu-id="4bc54-189">En este caso, es posible que vea un error de **valor SPN duplicado**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-189">In this case, you might see a **Duplicate SPN Value** error.</span></span> <span data-ttu-id="4bc54-190">Si aparece este error, asegúrese de que el valor está asociado a la cuenta de servicio.</span><span class="sxs-lookup"><span data-stu-id="4bc54-190">If you see this error, make sure that the value is associated with the service account.</span></span>

<span data-ttu-id="4bc54-191">Puede comprobar que se agregó el SPN mediante la ejecución del comando Setspn con la opción -l.</span><span class="sxs-lookup"><span data-stu-id="4bc54-191">You can verify that the SPN was added by running the Setspn command with the -l option.</span></span> <span data-ttu-id="4bc54-192">Para más información sobre este comando, vea [Setspn](https://technet.microsoft.com/library/cc731241.aspx).</span><span class="sxs-lookup"><span data-stu-id="4bc54-192">To learn more about this command, see [Setspn](https://technet.microsoft.com/library/cc731241.aspx).</span></span>

### <a name="ensure-that-the-connector-is-set-as-a-trusted-delegate-to-sharepoint"></a><span data-ttu-id="4bc54-193">Asegurarse de que el conector está configurado como un delegado de confianza en SharePoint</span><span class="sxs-lookup"><span data-stu-id="4bc54-193">Ensure that the connector is set as a trusted delegate to SharePoint</span></span>

<span data-ttu-id="4bc54-194">Configure KCD para que el servicio de proxy de aplicación de Azure AD pueda delegar identidades de usuario en el servicio de SharePoint.</span><span class="sxs-lookup"><span data-stu-id="4bc54-194">Configure the KCD so that the Azure AD Application Proxy service can delegate user identities to the SharePoint service.</span></span> <span data-ttu-id="4bc54-195">Para ello se habilita el conector del proxy de aplicación para recuperar los vales Kerberos para los usuarios que autenticaron en Azure AD.</span><span class="sxs-lookup"><span data-stu-id="4bc54-195">You do this by enabling the Application Proxy connector to retrieve Kerberos tickets for your users who have been authenticated in Azure AD.</span></span> <span data-ttu-id="4bc54-196">A continuación, ese servidor pasa el contexto a la aplicación de destino, o a SharePoint en este caso.</span><span class="sxs-lookup"><span data-stu-id="4bc54-196">Then that server passes the context to the target application, or SharePoint in this case.</span></span>

<span data-ttu-id="4bc54-197">Para configurar KCD, repita los pasos siguientes para cada equipo de conexión:</span><span class="sxs-lookup"><span data-stu-id="4bc54-197">To configure the KCD, repeat the following steps for each connector machine:</span></span>

1. <span data-ttu-id="4bc54-198">Inicie sesión como administrador en un controlador de dominio y, después, abra **Usuarios y equipos de Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-198">Log in as a domain administrator to a DC, and then open **Active Directory Users and Computers**.</span></span>
2. <span data-ttu-id="4bc54-199">Busque el equipo en el que se ejecuta el conector.</span><span class="sxs-lookup"><span data-stu-id="4bc54-199">Find the computer that the connector is running on.</span></span> <span data-ttu-id="4bc54-200">En este ejemplo, se trata del mismo servidor de SharePoint.</span><span class="sxs-lookup"><span data-stu-id="4bc54-200">In this example, it's the same SharePoint server.</span></span>
3. <span data-ttu-id="4bc54-201">Haga doble clic en el equipo y, después, en la pestaña **Delegación**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-201">Double-click the computer, and then click the **Delegation** tab.</span></span>
4. <span data-ttu-id="4bc54-202">Asegúrese de que la configuración de delegación está establecida en **Confiar en este equipo para la delegación solo a los servicios especificados** y después seleccione **Usar cualquier protocolo de autenticación**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-202">Ensure that the delegation settings are set to **Trust this computer for delegation to the specified services only**, and then select **Use any authentication protocol**.</span></span>

  ![Configuración de delegación](./media/application-proxy-remote-sharepoint/remote-sharepoint-delegation-box.png)

5. <span data-ttu-id="4bc54-204">Haga clic en el botón **Agregar**, haga clic en **Usuarios o equipos** y busque la cuenta de servicio.</span><span class="sxs-lookup"><span data-stu-id="4bc54-204">Click the **Add** button, click **Users or Computers**, and locate the service account.</span></span>

  ![Agregar el SPN para la cuenta de servicio](./media/application-proxy-remote-sharepoint/remote-sharepoint-users-computers.png)

6. <span data-ttu-id="4bc54-206">En la lista de los SPN, seleccione el que creó anteriormente para la cuenta de servicio.</span><span class="sxs-lookup"><span data-stu-id="4bc54-206">In the list of SPNs, select the one that you created earlier for the service account.</span></span>
7. <span data-ttu-id="4bc54-207">Haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-207">Click **OK**.</span></span> <span data-ttu-id="4bc54-208">Haga clic en **Aceptar** de nuevo para guardar los cambios.</span><span class="sxs-lookup"><span data-stu-id="4bc54-208">Click **OK** again to save the changes.</span></span>

## <a name="step-2-enable-remote-access-to-sharepoint"></a><span data-ttu-id="4bc54-209">Parte 2: Habilitar el acceso remoto a SharePoint</span><span class="sxs-lookup"><span data-stu-id="4bc54-209">Step 2: Enable remote access to SharePoint</span></span>

<span data-ttu-id="4bc54-210">Después de habilitar SharePoint para Kerberos y configurar KCD, está listo para configurar el inicio de sesión único en SharePoint.</span><span class="sxs-lookup"><span data-stu-id="4bc54-210">Now that you’ve enabled SharePoint for Kerberos and configured KCD, you're ready to set up single sign-on to SharePoint.</span></span> <span data-ttu-id="4bc54-211">Después, desde el conector, puede publicar la granja de SharePoint para el acceso remoto a través del proxy de aplicación de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="4bc54-211">Then from the connector, you can publish the SharePoint farm for remote access through Azure AD Application Proxy.</span></span>

<span data-ttu-id="4bc54-212">Para realizar los pasos siguientes, debe ser un miembro del rol de administrador global dentro de la cuenta de Azure Active Directory de la organización.</span><span class="sxs-lookup"><span data-stu-id="4bc54-212">To perform the following steps, you need to be a member of the Global Administrator Role in your organization's Azure Active Directory account.</span></span>

1. <span data-ttu-id="4bc54-213">Inicie sesión en [Azure Portal](https://manage.windowsazure.com) y busque el inquilino de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="4bc54-213">Sign in to the [Azure portal](https://manage.windowsazure.com) and find your Azure AD tenant.</span></span>
2. <span data-ttu-id="4bc54-214">Haga clic en **Aplicaciones** y luego en **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-214">Click **Applications**, and then click **Add**.</span></span>
3. <span data-ttu-id="4bc54-215">Seleccione **Publicar una aplicación que estará accesible desde fuera de la red**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-215">Select **Publish an application that will be accessible from outside your network**.</span></span> <span data-ttu-id="4bc54-216">Si no ve esta opción, asegúrese de que tiene configurado Azure AD Básico o Premium en el inquilino.</span><span class="sxs-lookup"><span data-stu-id="4bc54-216">If you don’t see this option, make sure that you have Azure AD Basic or Premium set up in the tenant.</span></span>
4. <span data-ttu-id="4bc54-217">Realice cada una de las opciones como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="4bc54-217">Complete each of the options as follows:</span></span>
 * <span data-ttu-id="4bc54-218">**Nombre**: use el valor que quiera, por ejemplo **SharePoint**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-218">**Name**: Use any value that you want--for example, **SharePoint**.</span></span>
 * <span data-ttu-id="4bc54-219">**Dirección URL interna**: esta es la dirección URL del sitio de SharePoint a nivel interno, como **https://SharePoint/**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-219">**Internal URL**: This is the URL of the SharePoint site internally, such as **https://SharePoint/**.</span></span> <span data-ttu-id="4bc54-220">En este ejemplo, asegúrese de usar **https**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-220">In this example, make sure to use **https**.</span></span>
 * <span data-ttu-id="4bc54-221">**Método de autenticación previa**: seleccione **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-221">**Preauthentication Method**: Select **Azure Active Directory**.</span></span>

  ![Opciones para agregar una aplicación](./media/application-proxy-remote-sharepoint/remote-sharepoint-add-application.png)

5. <span data-ttu-id="4bc54-223">Después de publicar la aplicación, haga clic en la pestaña **Configurar**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-223">After the app is published, click the **Configure** tab.</span></span>
6. <span data-ttu-id="4bc54-224">Desplácese hasta la opción **Traducir URL en encabezados**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-224">Scroll down to the option **Translate URL in Headers**.</span></span> <span data-ttu-id="4bc54-225">El valor predeterminado es **SÍ**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-225">The default value is **YES**.</span></span> <span data-ttu-id="4bc54-226">Cámbielo a **NO**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-226">Change it to **NO**.</span></span>

 <span data-ttu-id="4bc54-227">SharePoint usa el valor _Encabezado de host_ para buscar el sitio.</span><span class="sxs-lookup"><span data-stu-id="4bc54-227">SharePoint uses the _Host Header_ value to look up the site.</span></span> <span data-ttu-id="4bc54-228">También genera vínculos basándose en este valor.</span><span class="sxs-lookup"><span data-stu-id="4bc54-228">It also generates links based on this value.</span></span> <span data-ttu-id="4bc54-229">El efecto es garantizar que cualquier vínculo que genere SharePoint sea una dirección URL publicada que está configurada correctamente para usar la dirección URL externa.</span><span class="sxs-lookup"><span data-stu-id="4bc54-229">The net effect is to make sure that any link that SharePoint generates is a published URL that is correctly set to use the external URL.</span></span> <span data-ttu-id="4bc54-230">Al establecer el valor en **SÍ** se permite también que el conector reenvíe la solicitud a la aplicación de back-end.</span><span class="sxs-lookup"><span data-stu-id="4bc54-230">Setting the value to **YES** also enables the connector to forward the request to the back-end application.</span></span> <span data-ttu-id="4bc54-231">Pero establecer el valor en **NO** significa que el conector no enviará el nombre de host interno.</span><span class="sxs-lookup"><span data-stu-id="4bc54-231">However, setting the value to **NO** means that the connector will not send the internal host name.</span></span> <span data-ttu-id="4bc54-232">En su lugar, el conector envía el encabezado de host como la dirección URL publicada a la aplicación de back-end.</span><span class="sxs-lookup"><span data-stu-id="4bc54-232">Instead, the connector sends the host header as the published URL to the back-end application.</span></span>

 <span data-ttu-id="4bc54-233">Además, para asegurarse de que SharePoint acepta esta dirección URL, debe completar una configuración más en el servidor de SharePoint.</span><span class="sxs-lookup"><span data-stu-id="4bc54-233">Also, to ensure that SharePoint accepts this URL, you need to complete one more configuration on the SharePoint server.</span></span> <span data-ttu-id="4bc54-234">Lo hará en la sección siguiente.</span><span class="sxs-lookup"><span data-stu-id="4bc54-234">You'll do that in the next section.</span></span>

7. <span data-ttu-id="4bc54-235">Cambie **Método de autenticación interno** por **Autenticación integrada de Windows**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-235">Change **Internal Authentication Method** to **Integrated Windows Authentication**.</span></span> <span data-ttu-id="4bc54-236">Si el inquilino de Azure AD usa un UPN en la nube diferente al local, no olvide actualizar también el valor de **Identidad de inicio de sesión delegada**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-236">If your Azure AD tenant uses a UPN in the cloud that's different from the UPN on-premises, remember to update **Delegated Login Identity** as well.</span></span>
8. <span data-ttu-id="4bc54-237">Establezca el **SPN de la aplicación interno** en el valor establecido anteriormente.</span><span class="sxs-lookup"><span data-stu-id="4bc54-237">Set **Internal Application SPN** to the value that you set earlier.</span></span> <span data-ttu-id="4bc54-238">Por ejemplo, use **http/sharepoint.demo.o365identity.us**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-238">For example, use **http/sharepoint.demo.o365identity.us**.</span></span>
9. <span data-ttu-id="4bc54-239">Asigne la aplicación a los usuarios de destino.</span><span class="sxs-lookup"><span data-stu-id="4bc54-239">Assign the application to your target users.</span></span>

<span data-ttu-id="4bc54-240">La aplicación debería tener una apariencia similar al ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="4bc54-240">Your application should look similar to the following example:</span></span>

  ![Aplicación terminada](./media/application-proxy-remote-sharepoint/remote-sharepoint-internal-application-spn.png)

## <a name="step-3-ensure-that-sharepoint-knows-about-the-external-url"></a><span data-ttu-id="4bc54-242">Paso 3: Asegurarse de que SharePoint conoce la dirección URL externa</span><span class="sxs-lookup"><span data-stu-id="4bc54-242">Step 3: Ensure that SharePoint knows about the external URL</span></span>

<span data-ttu-id="4bc54-243">El último paso es asegurarse de que SharePoint puede encontrar el sitio en función de la dirección URL externa, de manera que represente los vínculos basándose en esa dirección URL externa.</span><span class="sxs-lookup"><span data-stu-id="4bc54-243">Your last step to ensure that SharePoint can find the site based on the external URL, so that it will render links based on that external URL.</span></span> <span data-ttu-id="4bc54-244">Para ello, configure las asignaciones de acceso alternativas para el sitio de SharePoint.</span><span class="sxs-lookup"><span data-stu-id="4bc54-244">You do this by configuring alternate access mappings for the SharePoint site.</span></span>

1. <span data-ttu-id="4bc54-245">Abra el sitio de **Administración central de SharePoint 2013**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-245">Open the **SharePoint 2013 Central Administration** site.</span></span>
2. <span data-ttu-id="4bc54-246">En **Configuración del sistema**, seleccione **Configurar asignaciones de acceso alternativas**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-246">Under **System Settings**, select **Configure Alternate Access Mappings**.</span></span>

 <span data-ttu-id="4bc54-247">Se abrirá el cuadro **Asignaciones de acceso alternativas**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-247">This opens the **Alternate Access Mappings** box.</span></span>

  ![Cuadro Asignaciones de acceso alternativas](./media/application-proxy-remote-sharepoint/remote-sharepoint-alternate-access1.png)

3. <span data-ttu-id="4bc54-249">En la lista desplegable situada junto a **Colección de asignaciones de acceso alternativas**, seleccione **Change Alternative Access Mapping Collection** (Cambiar colección de asignaciones de acceso alternativas).</span><span class="sxs-lookup"><span data-stu-id="4bc54-249">In the drop-down list beside **Alternate Access Mapping Collection**, select **Change Alternate Access Mapping Collection**.</span></span>
4. <span data-ttu-id="4bc54-250">Seleccione el sitio, por ejemplo **SharePoint - 80**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-250">Select your site--for example, **SharePoint - 80**.</span></span>

  ![Selección de un sitio](./media/application-proxy-remote-sharepoint/remote-sharepoint-alternate-access2.png)

5. <span data-ttu-id="4bc54-252">Puede agregar la dirección URL publicada como una dirección URL interna o una dirección URL pública.</span><span class="sxs-lookup"><span data-stu-id="4bc54-252">You can choose to add the published URL as either an internal URL or a public URL.</span></span> <span data-ttu-id="4bc54-253">En este ejemplo se usa una dirección URL pública como extranet.</span><span class="sxs-lookup"><span data-stu-id="4bc54-253">This example uses a public URL as the extranet.</span></span>
6. <span data-ttu-id="4bc54-254">Haga clic en **Editar direcciones URL públicas** en la ruta de acceso de **Extranet** y, después, escriba la ruta de acceso para la aplicación publicada, como en el paso anterior.</span><span class="sxs-lookup"><span data-stu-id="4bc54-254">Click **Edit Public URLs** in the **Extranet** path, and then enter the path for the published application, as in the previous step.</span></span> <span data-ttu-id="4bc54-255">Por ejemplo, escriba **https://sharepoint-iddemo.msappproxy.net**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-255">For example, enter **https://sharepoint-iddemo.msappproxy.net**.</span></span>

  ![Escribir la ruta de acceso](./media/application-proxy-remote-sharepoint/remote-sharepoint-alternate-access3.png)

7. <span data-ttu-id="4bc54-257">Haga clic en **Guardar**.</span><span class="sxs-lookup"><span data-stu-id="4bc54-257">Click **Save**.</span></span>

 <span data-ttu-id="4bc54-258">Ahora puede tener acceso al sitio de SharePoint externamente mediante el proxy de aplicación de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="4bc54-258">You can now access the SharePoint site externally via Azure AD Application Proxy.</span></span>

## <a name="next-steps"></a><span data-ttu-id="4bc54-259">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="4bc54-259">Next steps</span></span>

- [<span data-ttu-id="4bc54-260">Provisión de acceso remoto seguro a aplicaciones locales</span><span class="sxs-lookup"><span data-stu-id="4bc54-260">How to provide secure remote access to on-premises applications</span></span>](active-directory-application-proxy-get-started.md)
- [<span data-ttu-id="4bc54-261">Descripción de los conectores del Proxy de aplicación de Azure AD</span><span class="sxs-lookup"><span data-stu-id="4bc54-261">Understand Azure AD Application Proxy connectors</span></span>](application-proxy-understand-connectors.md)
- <span data-ttu-id="4bc54-262">[Publishing SharePoint 2016 and Office Online Server with Azure AD Application Proxy](https://blogs.technet.microsoft.com/dawiese/2016/06/09/publishing-sharepoint-2016-and-office-online-server-with-azure-ad-application-proxy/) (Publicación de SharePoint 2016 y Office Online Server con el proxy de aplicación de Azure AD)</span><span class="sxs-lookup"><span data-stu-id="4bc54-262">[Publishing SharePoint 2016 and Office Online Server with Azure AD Application Proxy](https://blogs.technet.microsoft.com/dawiese/2016/06/09/publishing-sharepoint-2016-and-office-online-server-with-azure-ad-application-proxy/)</span></span>

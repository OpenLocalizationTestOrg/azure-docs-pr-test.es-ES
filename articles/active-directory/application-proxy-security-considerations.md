---
title: "Consideraciones de seguridad para el Proxy de aplicación de Azure AD | Microsoft Docs"
description: "Se tratan las consideraciones de seguridad al utilizar el Proxy de aplicación de Azure AD."
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/03/2017
ms.author: kgremban
ms.reviewer: harshja
ms.custom: it-pro
ms.openlocfilehash: c6ead651133eb17fd55f7567cdb14dc3bcd64245
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/18/2017
---
# <a name="security-considerations-for-accessing-apps-remotely-with-azure-ad-application-proxy"></a><span data-ttu-id="6faa0-103">Consideraciones de seguridad al obtener acceso a aplicaciones de forma remota con el Proxy de aplicación de Azure AD</span><span class="sxs-lookup"><span data-stu-id="6faa0-103">Security considerations for accessing apps remotely with Azure AD Application Proxy</span></span>

<span data-ttu-id="6faa0-104">En este artículo se explica el modo en que el proxy de aplicación de Azure Active Directory proporciona un servicio seguro para la publicación y el acceso a las aplicaciones de forma remota.</span><span class="sxs-lookup"><span data-stu-id="6faa0-104">This article explains how Azure Active Directory Application Proxy provides a secure service for publishing and accessing your applications remotely.</span></span>

<span data-ttu-id="6faa0-105">El diagrama siguiente muestra cómo Azure AD permite el acceso remoto seguro a sus aplicaciones locales.</span><span class="sxs-lookup"><span data-stu-id="6faa0-105">The following diagram shows how Azure AD enables secure remote access to your on-premises applications.</span></span>

 ![Diagrama de acceso remoto seguro a través del Proxy de aplicación de Azure AD](./media/application-proxy-security-considerations/secure-remote-access.png)

## <a name="security-benefits"></a><span data-ttu-id="6faa0-107">Ventajas de seguridad</span><span class="sxs-lookup"><span data-stu-id="6faa0-107">Security benefits</span></span>

<span data-ttu-id="6faa0-108">El Proxy de aplicación de Azure AD ofrece las siguientes ventajas en materia de seguridad:</span><span class="sxs-lookup"><span data-stu-id="6faa0-108">Azure AD Application Proxy offers the following security benefits:</span></span>

### <a name="authenticated-access"></a><span data-ttu-id="6faa0-109">Acceso autenticado</span><span class="sxs-lookup"><span data-stu-id="6faa0-109">Authenticated access</span></span> 

<span data-ttu-id="6faa0-110">Si decide usar Azure la autenticación previa de Azure Active Directory, solo las conexiones autenticadas pueden acceder a la red.</span><span class="sxs-lookup"><span data-stu-id="6faa0-110">If you choose to use Azure Active Directory preauthentication, then only authenticated connections can access your network.</span></span>

<span data-ttu-id="6faa0-111">El Proxy de aplicación de Azure AD se basa en el servicio de token de seguridad (STS) de Azure AD para toda la autenticación.</span><span class="sxs-lookup"><span data-stu-id="6faa0-111">Azure AD Application Proxy relies on the Azure AD security token service (STS) for all authentication.</span></span>  <span data-ttu-id="6faa0-112">La autenticación previa, por su propia naturaleza, bloquea un número significativo de ataques anónimos, ya que las identidades autenticadas son las únicas que pueden tener acceso a la aplicación de back-end.</span><span class="sxs-lookup"><span data-stu-id="6faa0-112">Preauthentication, by its very nature, blocks a significant number of anonymous attacks, because only authenticated identities can access the back-end application.</span></span>

<span data-ttu-id="6faa0-113">Si elige el acceso directo como método de autenticación previa, no disfruta de esta ventaja.</span><span class="sxs-lookup"><span data-stu-id="6faa0-113">If you choose Passthrough as your preauthentication method, you don't get this benefit.</span></span> 

### <a name="conditional-access"></a><span data-ttu-id="6faa0-114">Acceso condicional</span><span class="sxs-lookup"><span data-stu-id="6faa0-114">Conditional access</span></span>

<span data-ttu-id="6faa0-115">Aplique controles de directiva más completos antes de que se establezcan las conexiones a la red.</span><span class="sxs-lookup"><span data-stu-id="6faa0-115">Apply richer policy controls before connections to your network are established.</span></span>

<span data-ttu-id="6faa0-116">Con el [acceso condicional](active-directory-conditional-access-azuread-connected-apps.md), es posible definir aún más las restricciones sobre el tráfico que se permite que tenga acceso a las aplicaciones de back-end.</span><span class="sxs-lookup"><span data-stu-id="6faa0-116">With [conditional access](active-directory-conditional-access-azuread-connected-apps.md), you can define restrictions on what traffic is allowed to access your back-end applications.</span></span> <span data-ttu-id="6faa0-117">Puede crear directivas que restrinjan los inicios de sesión en función de la ubicación, el nivel de autenticación y el perfil de riesgo del usuario.</span><span class="sxs-lookup"><span data-stu-id="6faa0-117">You can create policies that restrict sign-ins based on location, strength of authentication, and user risk profile.</span></span>

<span data-ttu-id="6faa0-118">También puede usar el acceso condicional para configurar directivas de Multi-Factor Authentication, agregando otro nivel de seguridad para la autenticación de los usuarios.</span><span class="sxs-lookup"><span data-stu-id="6faa0-118">You can also use conditional access to configure Multi-Factor Authentication policies, adding another layer of security to your user authentications.</span></span> 

### <a name="traffic-termination"></a><span data-ttu-id="6faa0-119">Terminación del tráfico</span><span class="sxs-lookup"><span data-stu-id="6faa0-119">Traffic termination</span></span>

<span data-ttu-id="6faa0-120">Todo el tráfico se termina en la nube.</span><span class="sxs-lookup"><span data-stu-id="6faa0-120">All traffic is terminated in the cloud.</span></span>

<span data-ttu-id="6faa0-121">Como el Proxy de aplicación de Azure AD es un servidor proxy inverso, todo el tráfico que va a las aplicaciones de back-end se termina en el servicio.</span><span class="sxs-lookup"><span data-stu-id="6faa0-121">Because Azure AD Application Proxy is a reverse-proxy, all traffic to back-end applications is terminated at the service.</span></span> <span data-ttu-id="6faa0-122">Se puede restablecer la sesión solo con el servidor back-end, lo que significa que los servidores back-end no se exponen al tráfico HTTP directo.</span><span class="sxs-lookup"><span data-stu-id="6faa0-122">The session can get reestablished only with the back-end server, which means that your back-end servers are not exposed to direct HTTP traffic.</span></span> <span data-ttu-id="6faa0-123">Esta configuración implica que está mejor protegido frente a ataques dirigidos.</span><span class="sxs-lookup"><span data-stu-id="6faa0-123">This configuration means that you are better protected from targeted attacks.</span></span>

### <a name="all-access-is-outbound"></a><span data-ttu-id="6faa0-124">Todo el acceso es de salida.</span><span class="sxs-lookup"><span data-stu-id="6faa0-124">All access is outbound</span></span> 

<span data-ttu-id="6faa0-125">No es necesario abrir conexiones de entrada a la red corporativa.</span><span class="sxs-lookup"><span data-stu-id="6faa0-125">You don't need to open inbound connections to the corporate network.</span></span>

<span data-ttu-id="6faa0-126">Los conectores de Proxy de aplicación solo usan conexiones salientes al servicio Azure AD Application Proxy, lo que significa que no es necesario abrir los puertos de firewall para las conexiones entrantes.</span><span class="sxs-lookup"><span data-stu-id="6faa0-126">Application Proxy connectors only use outbound connections to the Azure AD Application Proxy service, which means that there is no need to open firewall ports for incoming connections.</span></span> <span data-ttu-id="6faa0-127">Los servidores proxy tradicionales requerían una red perimetral (también conocida como *DMZ*, *zona desmilitarizada* o *subred filtrada*) y permitían el acceso a las conexiones no autenticadas en el perímetro de la red.</span><span class="sxs-lookup"><span data-stu-id="6faa0-127">Traditional proxies required a perimeter network (also known as *DMZ*, *demilitarized zone*, or *screened subnet*) and allowed access to unauthenticated connections at the network edge.</span></span> <span data-ttu-id="6faa0-128">Este escenario hacía necesaria una gran inversión adicional en productos de firewall de aplicaciones web para analizar el tráfico y ofrecer una mayor protección al entorno.</span><span class="sxs-lookup"><span data-stu-id="6faa0-128">This scenario required many additional investments in web application firewall products to analyze traffic and offer addition protections to the environment.</span></span> <span data-ttu-id="6faa0-129">Con Proxy de aplicación no se necesita una red perimetral, ya que todas las conexiones son de salida y tienen lugar a través de un canal seguro.</span><span class="sxs-lookup"><span data-stu-id="6faa0-129">With Application Proxy, you don't need a perimeter network because all connections are outbound and take place over a secure channel.</span></span>

<span data-ttu-id="6faa0-130">Para más información sobre los conectores, consulte [Descripción de los conectores del Proxy de aplicación de Azure AD](application-proxy-understand-connectors.md).</span><span class="sxs-lookup"><span data-stu-id="6faa0-130">For more information about connectors, see [Understand Azure AD Application Proxy connectors](application-proxy-understand-connectors.md).</span></span>

### <a name="cloud-scale-analytics-and-machine-learning"></a><span data-ttu-id="6faa0-131">Análisis de escala en la nube y aprendizaje automático</span><span class="sxs-lookup"><span data-stu-id="6faa0-131">Cloud-scale analytics and machine learning</span></span> 

<span data-ttu-id="6faa0-132">Obtenga una protección de seguridad avanzada.</span><span class="sxs-lookup"><span data-stu-id="6faa0-132">Get cutting-edge security protection.</span></span>

<span data-ttu-id="6faa0-133">Dado que forma parte de Azure Active Directory, el Proxy de aplicación puede sacar provecho de [Azure AD Identity Protection](active-directory-identityprotection.md), con inteligencia controlada por Machine Learning y datos de Microsoft Security Response Center y Digital Crimes Unit.</span><span class="sxs-lookup"><span data-stu-id="6faa0-133">Because it's part of Azure Active Directory, Application Proxy can leverage [Azure AD Identity Protection](active-directory-identityprotection.md), with machine learning-driven intelligence and data from the Microsoft Security Response Center and Digital Crimes Unit.</span></span> <span data-ttu-id="6faa0-134">Juntos identificamos de manera proactiva las cuentas en peligro y ofrecemos protección en tiempo real frente a inicios de sesión de alto riesgo. Tomamos en consideración diversos factores, como el acceso desde dispositivos infectados y a través de redes anónimas, y desde ubicaciones atípicas y poco probables.</span><span class="sxs-lookup"><span data-stu-id="6faa0-134">Together we proactively identify compromised accounts and offer real-time protection from high-risk sign-ins. We take into account numerous factors, such as access from infected devices, through anonymizing networks, and from atypical and unlikely locations.</span></span>

<span data-ttu-id="6faa0-135">Muchos de estos informes y eventos ya están disponibles a través de una API para la integración con los sistemas de información de seguridad y administración de eventos (SIEM).</span><span class="sxs-lookup"><span data-stu-id="6faa0-135">Many of these reports and events are already available through an API for integration with your security information and event management (SIEM) systems.</span></span>

### <a name="remote-access-as-a-service"></a><span data-ttu-id="6faa0-136">Acceso remoto en forma de servicio</span><span class="sxs-lookup"><span data-stu-id="6faa0-136">Remote access as a service</span></span>

<span data-ttu-id="6faa0-137">No tiene que preocuparse sobre cómo mantener y aplicar revisiones a los servidores locales.</span><span class="sxs-lookup"><span data-stu-id="6faa0-137">You don’t have to worry about maintaining and patching on-premises servers.</span></span>

<span data-ttu-id="6faa0-138">El software al que no se aplican revisiones sigue siendo objeto de un gran número de ataques.</span><span class="sxs-lookup"><span data-stu-id="6faa0-138">Unpatched software still accounts for a large number of attacks.</span></span> <span data-ttu-id="6faa0-139">El proxy de aplicación de Azure AD es un servicio de escala de Internet que es propiedad de Microsoft, por lo que siempre obtendrá las actualizaciones y revisiones de seguridad más recientes.</span><span class="sxs-lookup"><span data-stu-id="6faa0-139">Azure AD Application Proxy is an Internet-scale service that Microsoft owns, so you always get the latest security patches and upgrades.</span></span>

<span data-ttu-id="6faa0-140">Para mejorar la seguridad de las aplicaciones publicadas por el Proxy de aplicación de Azure AD, se impide que los robots de agentes de búsqueda indexen y archiven sus aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="6faa0-140">To improve the security of applications published by Azure AD Application Proxy, we block web crawler robots from indexing and archiving your applications.</span></span> <span data-ttu-id="6faa0-141">Cada vez que un robot de agente de búsqueda intenta recuperar la configuración del robot de una aplicación publicada, el Proxy de aplicación responde con un archivo robots.txt que incluye `User-agent: * Disallow: /`.</span><span class="sxs-lookup"><span data-stu-id="6faa0-141">Each time a web crawler robot tries to retrieve the robot's settings for a published app, Application Proxy replies with a robots.txt file that includes `User-agent: * Disallow: /`.</span></span>

## <a name="under-the-hood"></a><span data-ttu-id="6faa0-142">En segundo plano</span><span class="sxs-lookup"><span data-stu-id="6faa0-142">Under the hood</span></span>

<span data-ttu-id="6faa0-143">El Proxy de aplicación de Azure AD consta de dos partes:</span><span class="sxs-lookup"><span data-stu-id="6faa0-143">Azure AD Application Proxy consists of two parts:</span></span>

* <span data-ttu-id="6faa0-144">El servicio basado en la nube: este servicio se ejecuta en Azure y es donde se realizan las conexiones de usuario o cliente externos.</span><span class="sxs-lookup"><span data-stu-id="6faa0-144">The cloud-based service: This service runs in Azure, and is where the external client/user connections are made.</span></span>
* <span data-ttu-id="6faa0-145">[El conector local](application-proxy-understand-connectors.md): en un componente local, el conector atiende las solicitudes del servicio Azure AD Application Proxy y controla las conexiones con las aplicaciones internas.</span><span class="sxs-lookup"><span data-stu-id="6faa0-145">[The on-premises connector](application-proxy-understand-connectors.md): An on-premises component, the connector listens for requests from the Azure AD Application Proxy service and handles connections to the internal applications.</span></span> 

<span data-ttu-id="6faa0-146">Se establece un flujo entre el conector y el servicio de Proxy de aplicación cuando:</span><span class="sxs-lookup"><span data-stu-id="6faa0-146">A flow between the connector and the Application Proxy service is established when:</span></span>

* <span data-ttu-id="6faa0-147">El conector se configura en primer lugar.</span><span class="sxs-lookup"><span data-stu-id="6faa0-147">The connector is first set up.</span></span>
* <span data-ttu-id="6faa0-148">El conector extrae información de configuración desde el servicio Application Proxy.</span><span class="sxs-lookup"><span data-stu-id="6faa0-148">The connector pulls configuration information from the Application Proxy service.</span></span>
* <span data-ttu-id="6faa0-149">Un usuario tiene acceso a una aplicación publicada.</span><span class="sxs-lookup"><span data-stu-id="6faa0-149">A user accesses a published application.</span></span>

>[!NOTE]
><span data-ttu-id="6faa0-150">Todas las comunicaciones se producen a través de SSL, y siempre se originan en el conector del servicio de Proxy de aplicación.</span><span class="sxs-lookup"><span data-stu-id="6faa0-150">All communications occur over SSL, and they always originate at the connector to the Application Proxy service.</span></span> <span data-ttu-id="6faa0-151">Este servicio solo es de salida.</span><span class="sxs-lookup"><span data-stu-id="6faa0-151">The service is outbound only.</span></span>

<span data-ttu-id="6faa0-152">El conector usa un certificado de cliente para autenticarse en el servicio de Proxy de aplicación para casi todas las llamadas.</span><span class="sxs-lookup"><span data-stu-id="6faa0-152">The connector uses a client certificate to authenticate to the Application Proxy service for nearly all calls.</span></span> <span data-ttu-id="6faa0-153">La única excepción para este proceso es el momento de la instalación inicial, donde se establece el certificado de cliente.</span><span class="sxs-lookup"><span data-stu-id="6faa0-153">The only exception to this process is the initial setup step, where the client certificate is established.</span></span>

### <a name="installing-the-connector"></a><span data-ttu-id="6faa0-154">Instalación del conector</span><span class="sxs-lookup"><span data-stu-id="6faa0-154">Installing the connector</span></span>

<span data-ttu-id="6faa0-155">Los siguientes eventos de flujo ocurren cuando el conector se configura en primer lugar:</span><span class="sxs-lookup"><span data-stu-id="6faa0-155">When the connector is first set up, the following flow events take place:</span></span>

1. <span data-ttu-id="6faa0-156">El registro del conector en el servicio se produce en el marco de la instalación del conector.</span><span class="sxs-lookup"><span data-stu-id="6faa0-156">The connector registration to the service happens as part of the installation of the connector.</span></span> <span data-ttu-id="6faa0-157">Se solicita a los usuarios que escriban sus credenciales de administrador de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6faa0-157">Users are prompted to enter their Azure AD admin credentials.</span></span> <span data-ttu-id="6faa0-158">A continuación, el token obtenido con esta autenticación se presenta al servicio Azure AD Application Proxy.</span><span class="sxs-lookup"><span data-stu-id="6faa0-158">The token acquired from this authentication is then presented to the Azure AD Application Proxy service.</span></span>
2. <span data-ttu-id="6faa0-159">El servicio Application Proxy evalúa el token.</span><span class="sxs-lookup"><span data-stu-id="6faa0-159">The Application Proxy service evaluates the token.</span></span> <span data-ttu-id="6faa0-160">Garantiza que el usuario sea un administrador de la compañía en el inquilino para el que se emitió el token.</span><span class="sxs-lookup"><span data-stu-id="6faa0-160">It ensures that the user is a company administrator within the tenant that the token was issued for.</span></span> <span data-ttu-id="6faa0-161">Si el usuario no es un administrador, el proceso se termina.</span><span class="sxs-lookup"><span data-stu-id="6faa0-161">If the user is not an administrator, the process is terminated.</span></span>
3. <span data-ttu-id="6faa0-162">El conector genera una solicitud de certificado de cliente y la pasa, junto con el token, al servicio Application Proxy.</span><span class="sxs-lookup"><span data-stu-id="6faa0-162">The connector generates a client certificate request and passes it, along with the token, to the Application Proxy service.</span></span> <span data-ttu-id="6faa0-163">A su vez, el servicio comprueba el token y firma la solicitud de certificado de cliente.</span><span class="sxs-lookup"><span data-stu-id="6faa0-163">The service in turn verifies the token and signs the client certificate request.</span></span>
4. <span data-ttu-id="6faa0-164">El conector usa el certificado de cliente para la comunicación posterior con el servicio de Proxy de aplicación.</span><span class="sxs-lookup"><span data-stu-id="6faa0-164">The connector uses the client certificate for future communication with the Application Proxy service.</span></span>
5. <span data-ttu-id="6faa0-165">El conector realiza una extracción inicial de los datos de configuración del sistema desde el servicio usando su certificado de cliente y ya está listo para aceptar solicitudes.</span><span class="sxs-lookup"><span data-stu-id="6faa0-165">The connector performs an initial pull of the system configuration data from the service using its client certificate, and it is now ready to take requests.</span></span>

### <a name="updating-the-configuration-settings"></a><span data-ttu-id="6faa0-166">Actualización de los valores de configuración</span><span class="sxs-lookup"><span data-stu-id="6faa0-166">Updating the configuration settings</span></span>

<span data-ttu-id="6faa0-167">Cada vez que el servicio de Proxy de aplicación actualiza los valores de configuración, tienen lugar los siguientes eventos de flujo:</span><span class="sxs-lookup"><span data-stu-id="6faa0-167">Whenever the Application Proxy service updates the configuration settings, the following flow events take place:</span></span>

1. <span data-ttu-id="6faa0-168">El conector se conecta al punto de conexión de configuración en el servicio de Proxy de aplicación mediante su certificado de cliente.</span><span class="sxs-lookup"><span data-stu-id="6faa0-168">The connector connects to the configuration endpoint within the Application Proxy service by using its client certificate.</span></span>
2. <span data-ttu-id="6faa0-169">Una vez que se valida el certificado de cliente, el servicio de Proxy de aplicación devuelve datos de configuración al conector; por ejemplo, el grupo de conectores al que debe pertenecer el conector.</span><span class="sxs-lookup"><span data-stu-id="6faa0-169">After the client certificate has been validated, the Application Proxy service returns configuration data to the connector (for example, the connector group that the connector should be part of).</span></span>
3. <span data-ttu-id="6faa0-170">El conector genera una nueva solicitud de certificado si el certificado actual tiene más de 180 días de antigüedad, lo cual permite actualizar de manera efectiva el certificado de cliente cada 180 días.</span><span class="sxs-lookup"><span data-stu-id="6faa0-170">If the current certificate is more than 180 days old, the connector generates a new certificate request, which effectively updates the client certificate every 180 days.</span></span>

### <a name="accessing-published-applications"></a><span data-ttu-id="6faa0-171">Acceso a aplicaciones publicadas</span><span class="sxs-lookup"><span data-stu-id="6faa0-171">Accessing published applications</span></span>

<span data-ttu-id="6faa0-172">Cuando los usuarios tienen acceso a una aplicación publicada, los siguientes eventos tienen lugar entre el servicio Application Proxy y el conector del proxy de aplicación:</span><span class="sxs-lookup"><span data-stu-id="6faa0-172">When users access a published application, the following events take place between the Application Proxy service and the Application Proxy connector:</span></span>

1. [<span data-ttu-id="6faa0-173">El servicio autentica al usuario de la aplicación</span><span class="sxs-lookup"><span data-stu-id="6faa0-173">The service authenticates the user for the app</span></span>](#the-service-checks-the-configuration-settings-for-the-app)
2. [<span data-ttu-id="6faa0-174">El servicio realiza una solicitud en la cola del conector</span><span class="sxs-lookup"><span data-stu-id="6faa0-174">The service places a request in the connector queue</span></span>](#The-service-places-a-request-in-the-connector-queue)
3. [<span data-ttu-id="6faa0-175">El conector procesa la solicitud de la cola</span><span class="sxs-lookup"><span data-stu-id="6faa0-175">A connector processes the request from the queue</span></span>](#the-connector-receives-the-request-from-the-queue)
4. [<span data-ttu-id="6faa0-176">El conector espera una respuesta</span><span class="sxs-lookup"><span data-stu-id="6faa0-176">The connector waits for a response</span></span>](#the-connector-waits-for-a-response)
5. [<span data-ttu-id="6faa0-177">El servicio transmite por secuencias los datos al usuario</span><span class="sxs-lookup"><span data-stu-id="6faa0-177">The service streams data to the user</span></span>](#the-service-streams-data-to-the-user)

<span data-ttu-id="6faa0-178">Para más información sobre lo que ocurre en cada uno de estos pasos, continúe leyendo.</span><span class="sxs-lookup"><span data-stu-id="6faa0-178">To learn more about what takes place in each of these steps, keep reading.</span></span>


#### <a name="1-the-service-authenticates-the-user-for-the-app"></a><span data-ttu-id="6faa0-179">1. El servicio autentica al usuario de la aplicación</span><span class="sxs-lookup"><span data-stu-id="6faa0-179">1. The service authenticates the user for the app</span></span>

<span data-ttu-id="6faa0-180">Si ha configurado la aplicación para que use el acceso directo como método de autenticación previa, se omiten los pasos descritos en esta sección.</span><span class="sxs-lookup"><span data-stu-id="6faa0-180">If you configured the app to use Passthrough as its preauthentication method, the steps in this section are skipped.</span></span>

<span data-ttu-id="6faa0-181">Si la aplicación está configurada para usar la autenticación previa con Azure AD, se redirige a los usuarios a STS de Azure AD para que se autentiquen y se siguen los pasos a continuación:</span><span class="sxs-lookup"><span data-stu-id="6faa0-181">If you configured the app to preauthenticate with Azure AD, users are redirected to the Azure AD STS to authenticate, and the following steps take place:</span></span>

1. <span data-ttu-id="6faa0-182">El Proxy de aplicación comprueba los requisitos de directiva de acceso condicional para la aplicación específica.</span><span class="sxs-lookup"><span data-stu-id="6faa0-182">Application Proxy checks for any conditional access policy requirements for the specific application.</span></span> <span data-ttu-id="6faa0-183">Este paso garantiza que el usuario se ha asignado a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6faa0-183">This step ensures that the user has been assigned to the application.</span></span> <span data-ttu-id="6faa0-184">Si se requiere la verificación en dos pasos, la secuencia de autenticación solicita al usuario un segundo método de autenticación.</span><span class="sxs-lookup"><span data-stu-id="6faa0-184">If two-step verification is required, the authentication sequence prompts the user for a second authentication method.</span></span>

2. <span data-ttu-id="6faa0-185">Una vez que hayan pasado todas las comprobaciones, el STS de Azure AD emite un token firmado para la aplicación y redirige al usuario al servicio de Proxy de aplicación.</span><span class="sxs-lookup"><span data-stu-id="6faa0-185">After all checks have passed, the Azure AD STS issues a signed token for the application and redirects the user back to the Application Proxy service.</span></span>

3. <span data-ttu-id="6faa0-186">El Proxy de aplicación comprueba que el token se haya emitido para corregir la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6faa0-186">Application Proxy verifies that the token was issued to correct the application.</span></span> <span data-ttu-id="6faa0-187">También realiza otras comprobaciones como verificar que el token se firmó con Azure AD y que sigue dentro de la ventana válida.</span><span class="sxs-lookup"><span data-stu-id="6faa0-187">It performs other checks also, such as ensuring that the token was signed by Azure AD, and that it is still within the valid window.</span></span>

4. <span data-ttu-id="6faa0-188">El Proxy de aplicación establece una cookie de autenticación cifrada para indicar que se ha producido la autenticación para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6faa0-188">Application Proxy sets an encrypted authentication cookie to indicate that authentication to the application has occurred.</span></span> <span data-ttu-id="6faa0-189">Esta cookie incluye una marca de tiempo de expiración basada en el token de Azure AD y otros datos, como el nombre de usuario en que se basa la autenticación.</span><span class="sxs-lookup"><span data-stu-id="6faa0-189">The cookie includes an expiration timestamp that's based on the token from Azure AD and other data, such as the user name that the authentication is based on.</span></span> <span data-ttu-id="6faa0-190">Esta cookie se cifra con una clave privada conocida solo por el servicio de Proxy de aplicación.</span><span class="sxs-lookup"><span data-stu-id="6faa0-190">The cookie is encrypted with a private key known only to the Application Proxy service.</span></span>

5. <span data-ttu-id="6faa0-191">El Proxy de aplicación redirige al usuario a la dirección URL solicitada originalmente.</span><span class="sxs-lookup"><span data-stu-id="6faa0-191">Application Proxy redirects the user back to the originally requested URL.</span></span>

<span data-ttu-id="6faa0-192">Si se produce un error en cualquier parte de los pasos de la autenticación previa, se deniega la solicitud del usuario y este ve un mensaje que indica el origen del problema.</span><span class="sxs-lookup"><span data-stu-id="6faa0-192">If any part of the preauthentication steps fails, the user’s request is denied, and the user is shown a message indicating the source of the problem.</span></span>


#### <a name="2-the-service-places-a-request-in-the-connector-queue"></a><span data-ttu-id="6faa0-193">2. El servicio realiza una solicitud en la cola del conector</span><span class="sxs-lookup"><span data-stu-id="6faa0-193">2. The service places a request in the connector queue</span></span>

<span data-ttu-id="6faa0-194">Los conectores mantienen abierta una conexión de salida hacia el servicio Application Proxy.</span><span class="sxs-lookup"><span data-stu-id="6faa0-194">Connectors keep an outbound connection open to the Application Proxy service.</span></span> <span data-ttu-id="6faa0-195">Cuando llega una solicitud, el servicio la pone en cola en una de las conexiones abiertas para que el conector la recoja.</span><span class="sxs-lookup"><span data-stu-id="6faa0-195">When a request comes in, the service queues up the request on one of the open connections for the connector to pick up.</span></span>

<span data-ttu-id="6faa0-196">La solicitud incluye elementos de la aplicación, como los encabezados de la solicitud y los datos de la cookie cifrada, el usuario que realiza la solicitud y el identificador de solicitud.</span><span class="sxs-lookup"><span data-stu-id="6faa0-196">The request includes items from the application, such as the request headers, data from the encrypted cookie, the user making the request, and the request ID.</span></span> <span data-ttu-id="6faa0-197">Aunque los datos de la cookie cifrada se envían con la solicitud, no es la propia cookie de autenticación.</span><span class="sxs-lookup"><span data-stu-id="6faa0-197">Although data from the encrypted cookie is sent with the request, the authentication cookie itself is not.</span></span>

#### <a name="3-the-connector-processes-the-request-from-the-queue"></a><span data-ttu-id="6faa0-198">3. El conector procesa la solicitud de la cola.</span><span class="sxs-lookup"><span data-stu-id="6faa0-198">3. The connector processes the request from the queue.</span></span> 

<span data-ttu-id="6faa0-199">En función de la solicitud, el Proxy de aplicación realizará una de las siguientes acciones:</span><span class="sxs-lookup"><span data-stu-id="6faa0-199">Based on the request, Application Proxy performs one of the following actions:</span></span>

* <span data-ttu-id="6faa0-200">Si la solicitud es una operación sencilla, como cuando no hay ningún dato dentro del cuerpo (por ejemplo, una solicitud *GET* de RESTful), el conector establece una conexión con el recurso interno de destino y espera una respuesta.</span><span class="sxs-lookup"><span data-stu-id="6faa0-200">If the request is a simple operation (for example, there is no data within the body as is with a RESTful *GET* request), the connector makes a connection to the target internal resource and then waits for a response.</span></span>

* <span data-ttu-id="6faa0-201">Si la solicitud tiene datos asociados en el cuerpo, como en una operación de *POST* de RESTful, el conector establece una conexión saliente mediante el certificado de cliente con la instancia del Proxy de aplicación.</span><span class="sxs-lookup"><span data-stu-id="6faa0-201">If the request has data associated with it in the body (for example, a RESTful *POST* operation), the connector makes an outbound connection by using the client certificate to the Application Proxy instance.</span></span> <span data-ttu-id="6faa0-202">Esta conexión se establece para solicitar los datos y abrir una conexión a los recursos internos.</span><span class="sxs-lookup"><span data-stu-id="6faa0-202">It makes this connection to request the data and open a connection to the internal resource.</span></span> <span data-ttu-id="6faa0-203">Tras la recepción de la solicitud del conector, el servicio de Proxy de aplicación comienza a aceptar el contenido del usuario y reenvía los datos al conector.</span><span class="sxs-lookup"><span data-stu-id="6faa0-203">After it receives the request from the connector, the Application Proxy service begins accepting content from the user and forwards data to the connector.</span></span> <span data-ttu-id="6faa0-204">El conector, a su vez, reenvía los datos a los recursos internos.</span><span class="sxs-lookup"><span data-stu-id="6faa0-204">The connector, in turn, forwards the data to the internal resource.</span></span>

#### <a name="4-the-connector-waits-for-a-response"></a><span data-ttu-id="6faa0-205">4. El conector espera una respuesta.</span><span class="sxs-lookup"><span data-stu-id="6faa0-205">4. The connector waits for a response.</span></span>

<span data-ttu-id="6faa0-206">Una vez completada la operación de solicitud y transmisión de todo el contenido al back-end, el conector espera una respuesta.</span><span class="sxs-lookup"><span data-stu-id="6faa0-206">After the request and transmission of all content to the back end is complete, the connector waits for a response.</span></span>

<span data-ttu-id="6faa0-207">Después de recibir una respuesta, el conector establece una conexión saliente con el servicio de Proxy de aplicación para devolver los detalles del encabezado y empezar a transmitir los datos de devolución.</span><span class="sxs-lookup"><span data-stu-id="6faa0-207">After it receives a response, the connector makes an outbound connection to the Application Proxy service, to return the header details and begin streaming the return data.</span></span>

#### <a name="5-the-service-streams-data-to-the-user"></a><span data-ttu-id="6faa0-208">5. El servicio transmite por secuencias los datos al usuario.</span><span class="sxs-lookup"><span data-stu-id="6faa0-208">5. The service streams data to the user.</span></span> 

<span data-ttu-id="6faa0-209">Aquí puede tener lugar cierto procesamiento de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6faa0-209">Some processing of the application may occur here.</span></span> <span data-ttu-id="6faa0-210">Si configura el proxy de aplicación para traducir los encabezados o las direcciones URL en la aplicación, ese procesamiento se produce según sea necesario durante este paso.</span><span class="sxs-lookup"><span data-stu-id="6faa0-210">If you configured Application Proxy to translate headers or URLs in your application, that processing happens as needed during this step.</span></span>


## <a name="next-steps"></a><span data-ttu-id="6faa0-211">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="6faa0-211">Next steps</span></span>

[<span data-ttu-id="6faa0-212">Consideraciones sobre la topología de red al usar el Proxy de aplicación de Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="6faa0-212">Network topology considerations when using Azure AD Application Proxy</span></span>](application-proxy-network-topology-considerations.md)

[<span data-ttu-id="6faa0-213">Descripción de los conectores del Proxy de aplicación de Azure AD</span><span class="sxs-lookup"><span data-stu-id="6faa0-213">Understand Azure AD Application Proxy connectors</span></span>](application-proxy-understand-connectors.md)

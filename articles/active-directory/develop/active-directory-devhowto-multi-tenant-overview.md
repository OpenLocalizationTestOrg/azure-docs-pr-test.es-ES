---
title: "Procedimiento para crear una aplicación que pueda iniciar sesión cualquier usuario de Azure AD | Microsoft Docs"
description: "Instrucciones paso a paso para crear una aplicación que pueda iniciar la sesión de un usuario desde cualquier inquilino de Azure Active Directory, lo que se conoce también como aplicación multiempresa."
services: active-directory
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 35af95cb-ced3-46ad-b01d-5d2f6fd064a3
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 04/26/2017
ms.author: dastrock
ms.custom: aaddev
ms.openlocfilehash: f1c79fa7e3b0e160487b5941741f6a6c677c6b81
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="how-to-sign-in-any-azure-active-directory-ad-user-using-the-multi-tenant-application-pattern"></a><span data-ttu-id="2b234-103">Inicio de sesión de cualquier usuario de Azure Active Directory (AD) mediante el patrón de aplicación multiempresa</span><span class="sxs-lookup"><span data-stu-id="2b234-103">How to sign in any Azure Active Directory (AD) user using the multi-tenant application pattern</span></span>
<span data-ttu-id="2b234-104">Si ofrece una aplicación de software como servicio a muchas organizaciones, puede configurar la aplicación para que acepte inicios de sesión de cualquier inquilino de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2b234-104">If you offer a Software as a Service application to many organizations, you can configure your application to accept sign-ins from any Azure AD tenant.</span></span>  <span data-ttu-id="2b234-105">En Azure AD, esto se conoce como convertir su aplicación en una aplicación multiempresa.</span><span class="sxs-lookup"><span data-stu-id="2b234-105">In Azure AD this is called making your application multi-tenant.</span></span>  <span data-ttu-id="2b234-106">Los usuarios de cualquier inquilino de Azure AD podrán iniciar sesión en su aplicación después de dar su consentimiento al uso de su cuenta con ella.</span><span class="sxs-lookup"><span data-stu-id="2b234-106">Users in any Azure AD tenant will be able to sign in to your application after consenting to use their account with your application.</span></span>  

<span data-ttu-id="2b234-107">Si tiene una aplicación existente que tiene su propio sistema de cuenta o es compatible con otros tipos de inicio de sesión de otros proveedores de nube, es sencillo agregar el inicio de sesión de Azure AD desde cualquier inquilino.</span><span class="sxs-lookup"><span data-stu-id="2b234-107">If you have an existing application that has its own account system, or supports other kinds of sign-in from other cloud providers, adding Azure AD sign-in from any tenant is simple.</span></span> <span data-ttu-id="2b234-108">Solo tiene que registrar la aplicación, agregar el código de inicio de sesión a través de OAuth2, OpenID Connect o SAML e incluir el botón "Iniciar sesión con Microsoft" en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="2b234-108">Just register your app, add sign-in code via OAuth2, OpenID Connect, or SAML, and put a "Sign In with Microsoft" button on your application.</span></span> <span data-ttu-id="2b234-109">Haga clic en el botón siguiente para más información sobre la personalización de marca de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="2b234-109">Click the following button to learn more about branding your application.</span></span>

<span data-ttu-id="2b234-110">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="2b234-110">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span></span>

<span data-ttu-id="2b234-111">En este artículo se da por supuesto que ya está familiarizado con la creación de una aplicación de un solo inquilino para Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2b234-111">This article assumes you’re already familiar with building a single tenant application for Azure AD.</span></span>  <span data-ttu-id="2b234-112">Si no lo está, vuelva a la [página principal de la guía del desarrollador][AAD-Dev-Guide] y pruebe una de nuestras guías de inicio rápido.</span><span class="sxs-lookup"><span data-stu-id="2b234-112">If you’re not, head back up to the [developer guide homepage][AAD-Dev-Guide] and try one of our quick starts!</span></span>

<span data-ttu-id="2b234-113">Para convertir la aplicación en una aplicación multiempresa de Azure AD, siga estos cuatro sencillos pasos:</span><span class="sxs-lookup"><span data-stu-id="2b234-113">There are four simple steps to convert your application into an Azure AD multi-tenant app:</span></span>

1. <span data-ttu-id="2b234-114">Actualice el registro de aplicación para que sea multiempresa</span><span class="sxs-lookup"><span data-stu-id="2b234-114">Update your application registration to be multi-tenant</span></span>
2. <span data-ttu-id="2b234-115">Actualice el código para enviar solicitudes al punto de conexión /common</span><span class="sxs-lookup"><span data-stu-id="2b234-115">Update your code to send requests to the /common endpoint</span></span> 
3. <span data-ttu-id="2b234-116">Actualice el código para administrar varios valores issuer</span><span class="sxs-lookup"><span data-stu-id="2b234-116">Update your code to handle multiple issuer values</span></span>
4. <span data-ttu-id="2b234-117">Comprenda el consentimiento de administrador y usuario y realice los cambios apropiados en el código</span><span class="sxs-lookup"><span data-stu-id="2b234-117">Understand user and admin consent and make appropriate code changes</span></span>

<span data-ttu-id="2b234-118">Vamos a examinar cada paso con detalle.</span><span class="sxs-lookup"><span data-stu-id="2b234-118">Let’s look at each step in detail.</span></span> <span data-ttu-id="2b234-119">También puede ir directamente a [esta lista de ejemplos de multiinquilino][AAD-Samples-MT].</span><span class="sxs-lookup"><span data-stu-id="2b234-119">You can also jump straight to [this list of multi-tenant samples][AAD-Samples-MT].</span></span>

## <a name="update-registration-to-be-multi-tenant"></a><span data-ttu-id="2b234-120">Actualización del registro para que sea multiempresa</span><span class="sxs-lookup"><span data-stu-id="2b234-120">Update registration to be multi-tenant</span></span>
<span data-ttu-id="2b234-121">De forma predeterminada, los registros de API y de aplicación web en Azure son de un solo inquilino.</span><span class="sxs-lookup"><span data-stu-id="2b234-121">By default, web app/API registrations in Azure AD are single tenant.</span></span>  <span data-ttu-id="2b234-122">Para convertir su registro en multiinquilino, busque el conmutador "Multiinquilino" en la página de propiedades del registro de la aplicación en [Azure Portal][AZURE-portal] y establézcalo en "Sí".</span><span class="sxs-lookup"><span data-stu-id="2b234-122">You can make your registration multi-tenant by finding the “Multi-Tenanted” switch on the properties page of your application registration in the [Azure portal][AZURE-portal] and setting it to “Yes”.</span></span>

<span data-ttu-id="2b234-123">Tenga en cuenta que, para que la aplicación pueda convertirse en multiempresa, Azure AD requiere que el URI de id. de aplicación sea único a nivel global.</span><span class="sxs-lookup"><span data-stu-id="2b234-123">Also note, before an application can be made multi-tenant, Azure AD requires the App ID URI of the application to be globally unique.</span></span> <span data-ttu-id="2b234-124">El URI de id. de aplicación es una de las maneras en que una aplicación se identifica en los mensajes de protocolo.</span><span class="sxs-lookup"><span data-stu-id="2b234-124">The App ID URI is one of the ways an application is identified in protocol messages.</span></span>  <span data-ttu-id="2b234-125">Cuando la aplicación es de un solo inquilino, es suficiente con que el URI de id. de aplicación sea único en dicho inquilino.</span><span class="sxs-lookup"><span data-stu-id="2b234-125">For a single tenant application, it is sufficient for the App ID URI to be unique within that tenant.</span></span>  <span data-ttu-id="2b234-126">En el caso de una aplicación multiempresa, debe ser único a nivel global de forma que Azure AD pueda encontrar la aplicación entre todos los inquilinos.</span><span class="sxs-lookup"><span data-stu-id="2b234-126">For a multi-tenant application, it must be globally unique so Azure AD can find the application across all tenants.</span></span>  <span data-ttu-id="2b234-127">El carácter globalmente único viene impuesto por la necesidad de que el URI de id. de aplicación tenga un nombre de host que coincida con un dominio comprobado del inquilino de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2b234-127">Global uniqueness is enforced by requiring the App ID URI to have a host name that matches a verified domain of the Azure AD tenant.</span></span>  <span data-ttu-id="2b234-128">Por ejemplo, si el nombre del inquilino era contoso.onmicrosoft.com, un identificador 
URI de id. de aplicación válido sería `https://contoso.onmicrosoft.com/myapp`.</span><span class="sxs-lookup"><span data-stu-id="2b234-128">For example, if the name of your tenant was contoso.onmicrosoft.com then a valid App ID URI would be `https://contoso.onmicrosoft.com/myapp`.</span></span>  <span data-ttu-id="2b234-129">Si el inquilino tenía el dominio comprobado `contoso.com`, también sería un URI de id. de aplicación válido `https://contoso.com/myapp`.</span><span class="sxs-lookup"><span data-stu-id="2b234-129">If your tenant had a verified domain of `contoso.com`, then a valid App ID URI would also be `https://contoso.com/myapp`.</span></span>  <span data-ttu-id="2b234-130">La configuración de una aplicación como multiempresa dará error si el URI de id. de aplicación no sigue este patrón.</span><span class="sxs-lookup"><span data-stu-id="2b234-130">Setting an application as multi-tenant will fail if the App ID URI doesn’t follow this pattern.</span></span>

<span data-ttu-id="2b234-131">Los registros de cliente nativo son multiempresa de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="2b234-131">Native client registrations are multi-tenant by default.</span></span>  <span data-ttu-id="2b234-132">No es necesario realizar ninguna acción para convertir un registro de aplicación cliente nativa en multiempresa.</span><span class="sxs-lookup"><span data-stu-id="2b234-132">You don’t need to take any action to make a native client application registration multi-tenant.</span></span>

## <a name="update-your-code-to-send-requests-to-common"></a><span data-ttu-id="2b234-133">Actualización del código para enviar solicitudes a /common</span><span class="sxs-lookup"><span data-stu-id="2b234-133">Update your code to send requests to /common</span></span>
<span data-ttu-id="2b234-134">En una aplicación de un solo inquilino, las solicitudes de inicio de sesión se envían al punto de conexión de inicio de sesión del inquilino.</span><span class="sxs-lookup"><span data-stu-id="2b234-134">In a single tenant application, sign-in requests are sent to the tenant’s sign-in endpoint.</span></span> <span data-ttu-id="2b234-135">Por ejemplo, para contoso.onmicrosoft.com, el punto de conexión sería:</span><span class="sxs-lookup"><span data-stu-id="2b234-135">For example, for contoso.onmicrosoft.com the endpoint would be:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com

<span data-ttu-id="2b234-136">Las solicitudes enviadas al punto de conexión de un inquilino pueden iniciar la sesión de los usuarios (o invitados) de ese inquilino en las aplicaciones de dicho inquilino.</span><span class="sxs-lookup"><span data-stu-id="2b234-136">Requests sent to a tenant’s endpoint can sign in users (or guests) in that tenant to applications in that tenant.</span></span>  <span data-ttu-id="2b234-137">Con una aplicación multiempresa, la aplicación no sabe de antemano de qué inquilino procede el usuario, así que no puede enviar solicitudes al punto de conexión de uno de los inquilinos.</span><span class="sxs-lookup"><span data-stu-id="2b234-137">With a multi-tenant application, the application doesn’t know up front what tenant the user is from, so you can’t send requests to a tenant’s endpoint.</span></span>  <span data-ttu-id="2b234-138">En su lugar, las solicitudes se envían a un punto de conexión que las multiplexa en todos los inquilinos de Azure AD:</span><span class="sxs-lookup"><span data-stu-id="2b234-138">Instead, requests are sent to an endpoint that multiplexes across all Azure AD tenants:</span></span>

    https://login.microsoftonline.com/common

<span data-ttu-id="2b234-139">Cuando Azure AD recibe una solicitud en el punto de conexión /common, inicia la sesión del usuario y, como consecuencia, detecta cuál es el inquilino del que procede.</span><span class="sxs-lookup"><span data-stu-id="2b234-139">When Azure AD receives a request on the /common endpoint, it signs the user in and as a consequence discovers which tenant the user is from.</span></span>  <span data-ttu-id="2b234-140">El punto de conexión /common funciona con todos los protocolos de autenticación compatibles con Azure AD: OpenID Connect, OAuth 2.0, SAML 2.0 y WS-Federation.</span><span class="sxs-lookup"><span data-stu-id="2b234-140">The /common endpoint works with all of the authentication protocols supported by Azure AD:  OpenID Connect, OAuth 2.0, SAML 2.0, and WS-Federation.</span></span>

<span data-ttu-id="2b234-141">La respuesta de inicio de sesión a la aplicación contiene un token que representa al usuario.</span><span class="sxs-lookup"><span data-stu-id="2b234-141">The sign-in response to the application then contains a token representing the user.</span></span>  <span data-ttu-id="2b234-142">El valor issuer del token indica a una aplicación el inquilino del que procede el usuario.</span><span class="sxs-lookup"><span data-stu-id="2b234-142">The issuer value in the token tells an application what tenant the user is from.</span></span>  <span data-ttu-id="2b234-143">Cuando el punto de conexión /common devuelva una respuesta, el valor issuer del token corresponderá al inquilino del usuario.</span><span class="sxs-lookup"><span data-stu-id="2b234-143">When a response returns from the /common endpoint, the issuer value in the token will correspond to the user’s tenant.</span></span>  <span data-ttu-id="2b234-144">Es importante advertir que el punto de conexión /common no es un inquilino ni un emisor, sino un multiplexador.</span><span class="sxs-lookup"><span data-stu-id="2b234-144">It’s important to note the /common endpoint is not a tenant and is not an issuer, it’s just a multiplexer.</span></span>  <span data-ttu-id="2b234-145">Para tener esto en cuenta, la lógica de la aplicación para validar los tokens debe estar actualizada al utilizar /common.</span><span class="sxs-lookup"><span data-stu-id="2b234-145">When using /common, the logic in your application to validate tokens needs to be updated to take this into account.</span></span> 

<span data-ttu-id="2b234-146">Como se mencionó anteriormente, las aplicaciones multiinquilino también deben proporcionar una experiencia coherente de inicio de sesión para los usuarios, que se ajuste a las directrices de personalización de marca de la aplicación de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2b234-146">As mentioned earlier, multi-tenant applications should also provide a consistent sign-in experience for users, following the Azure AD application branding guidelines.</span></span> <span data-ttu-id="2b234-147">Haga clic en el botón siguiente para más información sobre la personalización de marca de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="2b234-147">Click the following button to learn more about branding your application.</span></span>

<span data-ttu-id="2b234-148">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="2b234-148">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span></span>

<span data-ttu-id="2b234-149">Echemos un vistazo detenidamente a la utilización del punto de conexión más común y a la implementación de código.</span><span class="sxs-lookup"><span data-stu-id="2b234-149">Let’s take a look at the use of the /common endpoint and your code implementation in more detail.</span></span>

## <a name="update-your-code-to-handle-multiple-issuer-values"></a><span data-ttu-id="2b234-150">Actualice el código para administrar varios valores issuer</span><span class="sxs-lookup"><span data-stu-id="2b234-150">Update your code to handle multiple issuer values</span></span>
<span data-ttu-id="2b234-151">Las aplicaciones web y las API web reciben y validan los tokens desde Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2b234-151">Web applications and web APIs receive and validate tokens from Azure AD.</span></span>  

> [!NOTE]
> <span data-ttu-id="2b234-152">Si bien las aplicaciones cliente nativas solicitan y reciben tokens de Azure AD, lo hacen para enviarlos a las API, donde se validan.</span><span class="sxs-lookup"><span data-stu-id="2b234-152">While native client applications request and receive tokens from Azure AD, they do so to send them to APIs, where they are validated.</span></span>  <span data-ttu-id="2b234-153">Las aplicaciones nativas no validan los tokens y deben tratarlos como opacos.</span><span class="sxs-lookup"><span data-stu-id="2b234-153">Native applications do not validate tokens and must treat them as opaque.</span></span>
> 
> 

<span data-ttu-id="2b234-154">Veamos cómo una aplicación valida los tokens que recibe de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2b234-154">Let’s look at how an application validates tokens it receives from Azure AD.</span></span>  <span data-ttu-id="2b234-155">Una aplicación de un solo inquilino tomará normalmente un valor de punto de conexión como:</span><span class="sxs-lookup"><span data-stu-id="2b234-155">A single tenant application will normally take an endpoint value like:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com

<span data-ttu-id="2b234-156">y lo usará para crear una URL de metadatos (en este caso, OpenID Connect) como:</span><span class="sxs-lookup"><span data-stu-id="2b234-156">and use it to construct a metadata URL (in this case, OpenID Connect) like:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com/.well-known/openid-configuration

<span data-ttu-id="2b234-157">para descargar dos tipos de información esenciales que se usan para validar los tokens: las claves de firma del inquilino y el valor issuer.</span><span class="sxs-lookup"><span data-stu-id="2b234-157">to download two critical pieces of information that are used to validate tokens:  the tenant’s signing keys and issuer value.</span></span>  <span data-ttu-id="2b234-158">Cada inquilino de Azure AD tiene un valor issuer único con la forma:</span><span class="sxs-lookup"><span data-stu-id="2b234-158">Each Azure AD tenant has a unique issuer value of the form:</span></span>

    https://sts.windows.net/31537af4-6d77-4bb9-a681-d2394888ea26/

<span data-ttu-id="2b234-159">donde el valor de GUID es la versión segura de cambio de nombre del id. del inquilino.</span><span class="sxs-lookup"><span data-stu-id="2b234-159">where the GUID value is the rename-safe version of the tenant ID of the tenant.</span></span>  <span data-ttu-id="2b234-160">Si hace clic en el vínculo de metadatos anterior en `contoso.onmicrosoft.com`, puede ver este valor issuer en el documento.</span><span class="sxs-lookup"><span data-stu-id="2b234-160">If you click on the preceding metadata link for `contoso.onmicrosoft.com`, you can see this issuer value in the document.</span></span>

<span data-ttu-id="2b234-161">Cuando una aplicación de un solo inquilino valida un token, comprueba la firma del token con las claves de firma del documento de metadatos.</span><span class="sxs-lookup"><span data-stu-id="2b234-161">When a single tenant application validates a token, it checks the signature of the token against the signing keys from the metadata document.</span></span> <span data-ttu-id="2b234-162">Esto le permite asegurarse de que el valor issuer del token coincide con el que se encuentran en el documento de metadatos.</span><span class="sxs-lookup"><span data-stu-id="2b234-162">This allows it to make sure the issuer value in the token matches the one that was found in the metadata document.</span></span>

<span data-ttu-id="2b234-163">Como el punto de conexión /common no corresponde a un inquilino y no es un emisor, cuando examine el valor issuer en los metadatos de /common tendrá una URL con plantilla en lugar de un valor real:</span><span class="sxs-lookup"><span data-stu-id="2b234-163">Since the /common endpoint doesn’t correspond to a tenant and isn’t an issuer, when you examine the issuer value in the metadata for /common it has a templated URL instead of an actual value:</span></span>

    https://sts.windows.net/{tenantid}/

<span data-ttu-id="2b234-164">Por lo tanto, una aplicación multiempresa no puede validar los tokens simplemente haciendo coincidir el valor issuer de los metadatos con el valor `issuer` del token.</span><span class="sxs-lookup"><span data-stu-id="2b234-164">Therefore, a multi-tenant application can’t validate tokens just by matching the issuer value in the metadata with the `issuer` value in the token.</span></span>  <span data-ttu-id="2b234-165">Una aplicación multiempresa necesita una lógica para decidir qué valores issuer son válidos y cuáles no, según la parte del id. de inquilino del valor issuer.</span><span class="sxs-lookup"><span data-stu-id="2b234-165">A multi-tenant application needs logic to decide which issuer values are valid and which are not, based on the tenant ID portion of the issuer value.</span></span>  

<span data-ttu-id="2b234-166">Por ejemplo, si una aplicación multiinquilino solo permite el inicio de sesión desde inquilinos específicos que se han registrado para su servicio, debe comprobar el valor issuer o el valor de notificación `tid` en el token para asegurarse de que el inquilino se encuentra en su lista de suscriptores.</span><span class="sxs-lookup"><span data-stu-id="2b234-166">For example, if a multi-tenant application only allows sign-in from specific tenants who have signed up for their service, then it must check either the issuer value or the `tid` claim value in the token to make sure that tenant is in their list of subscribers.</span></span>  <span data-ttu-id="2b234-167">Si una aplicación multiempresa solo trata con individuos y no toma ninguna decisión de acceso basada en los inquilinos, puede omitir completamente el valor issuer.</span><span class="sxs-lookup"><span data-stu-id="2b234-167">If a multi-tenant application only deals with individuals and doesn’t make any access decisions based on tenants, then it can ignore the issuer value altogether.</span></span>

<span data-ttu-id="2b234-168">En los ejemplos de multiinquilino de la sección [Contenido relacionado](#related-content) al final de este artículo, la validación del emisor está deshabilitada para permitir que cualquier inquilino de Azure AD inicie sesión.</span><span class="sxs-lookup"><span data-stu-id="2b234-168">In the multi-tenant samples in the [Related Content](#related-content) section at the end of this article, issuer validation is disabled to enable any Azure AD tenant to sign in.</span></span>

<span data-ttu-id="2b234-169">Ahora veamos la experiencia para los usuarios que inician sesión en aplicaciones multiempresa.</span><span class="sxs-lookup"><span data-stu-id="2b234-169">Now let’s look at the user experience for users that are signing in to multi-tenant applications.</span></span>

## <a name="understanding-user-and-admin-consent"></a><span data-ttu-id="2b234-170">Comprensión del consentimiento de usuario y administrador</span><span class="sxs-lookup"><span data-stu-id="2b234-170">Understanding user and admin consent</span></span>
<span data-ttu-id="2b234-171">Para que un usuario inicie sesión en una aplicación en Azure AD, la aplicación debe estar representada en el inquilino del usuario.</span><span class="sxs-lookup"><span data-stu-id="2b234-171">For a user to sign in to an application in Azure AD, the application must be represented in the user’s tenant.</span></span>  <span data-ttu-id="2b234-172">Esto permite que la organización realice cosas como aplicar directivas únicas cuando los usuarios de su inquilino inician sesión en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="2b234-172">This allows the organization to do things like apply unique policies when users from their tenant sign in to the application.</span></span>  <span data-ttu-id="2b234-173">Para una aplicación de un solo inquilino, este registro es sencillo; es lo que sucede cuando registra la aplicación en [Azure Portal][AZURE-portal].</span><span class="sxs-lookup"><span data-stu-id="2b234-173">For a single tenant application, this registration is simple; it’s the one that happens when you register the application in the [Azure portal][AZURE-portal].</span></span>

<span data-ttu-id="2b234-174">Para una aplicación multiempresa, el registro inicial de la aplicación reside en el inquilino de Azure AD utilizado por el desarrollador.</span><span class="sxs-lookup"><span data-stu-id="2b234-174">For a multi-tenant application, the initial registration for the application lives in the Azure AD tenant used by the developer.</span></span>  <span data-ttu-id="2b234-175">Cuando usuarios de otro inquilino inician sesión en la aplicación por primera vez, Azure AD les pide que den su consentimiento a los permisos solicitados por ella.</span><span class="sxs-lookup"><span data-stu-id="2b234-175">When a user from a different tenant signs in to the application for the first time, Azure AD asks them to consent to the permissions requested by the application.</span></span>  <span data-ttu-id="2b234-176">Si aceptan, se crea una representación de la aplicación llamada *entidad de servicio* en el inquilino del usuario, y el inicio de sesión puede continuar.</span><span class="sxs-lookup"><span data-stu-id="2b234-176">If they consent, then a representation of the application called a *service principal* is created in the user’s tenant, and sign-in can continue.</span></span> <span data-ttu-id="2b234-177">También se crea una delegación en el directorio que registra el consentimiento del usuario a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="2b234-177">A delegation is also created in the directory that records the user’s consent to the application.</span></span> <span data-ttu-id="2b234-178">Para más información sobre los objetos Application y ServicePrincipal y cómo se relacionan entre sí, consulte [Objetos Application y objetos ServicePrincipal][AAD-App-SP-Objects].</span><span class="sxs-lookup"><span data-stu-id="2b234-178">See [Application Objects and Service Principal Objects][AAD-App-SP-Objects] for details on the application's Application and ServicePrincipal objects, and how they relate to each other.</span></span>

![Consentimiento para aplicaciones de nivel sencillo][Consent-Single-Tier] 

<span data-ttu-id="2b234-180">Esta experiencia de consentimiento depende de los permisos solicitados por la aplicación.</span><span class="sxs-lookup"><span data-stu-id="2b234-180">This consent experience is affected by the permissions requested by the application.</span></span>  <span data-ttu-id="2b234-181">Azure AD admite dos clases de permisos, solo de aplicación o delegado:</span><span class="sxs-lookup"><span data-stu-id="2b234-181">Azure AD supports two kinds of permissions, app-only and delegated:</span></span>

* <span data-ttu-id="2b234-182">Un permiso delegado concede a una aplicación la posibilidad de actuar como un usuario que inicia sesión para un subconjunto de las cosas que el usuario puede hacer.</span><span class="sxs-lookup"><span data-stu-id="2b234-182">A delegated permission grants an application the ability to act as a signed in user for a subset of the things the user can do.</span></span>  <span data-ttu-id="2b234-183">Por ejemplo, puede conceder a una aplicación el permiso delegado para leer el calendario del usuario que ha iniciado la sesión.</span><span class="sxs-lookup"><span data-stu-id="2b234-183">For example, you can grant an application the delegated permission to read the signed in user’s calendar.</span></span>
* <span data-ttu-id="2b234-184">Un permiso de aplicación se concede directamente a la identidad de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="2b234-184">An app-only permission is granted directly to the identity of the application.</span></span>  <span data-ttu-id="2b234-185">Por ejemplo, puede conceder a una aplicación el permiso de solo aplicación para leer la lista de usuarios de un inquilino, con independencia de quién haya iniciado sesión en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="2b234-185">For example, you can grant an application the app-only permission to read the list of users in a tenant, regardless of who is signed in to the application.</span></span>

<span data-ttu-id="2b234-186">Algunos permisos pueden tener el consentimiento de un usuario normal, mientras que otros necesitan el del administrador del inquilino.</span><span class="sxs-lookup"><span data-stu-id="2b234-186">Some permissions can be consented to by a regular user, while others require a tenant administrator’s consent.</span></span> 

### <a name="admin-consent"></a><span data-ttu-id="2b234-187">Consentimiento de administrador</span><span class="sxs-lookup"><span data-stu-id="2b234-187">Admin consent</span></span>
<span data-ttu-id="2b234-188">Los permisos de solo aplicación siempre requieren el consentimiento del administrador de inquilinos.</span><span class="sxs-lookup"><span data-stu-id="2b234-188">App-only permissions always require a tenant administrator’s consent.</span></span>  <span data-ttu-id="2b234-189">Si la aplicación solicita un permiso de solo aplicación y un usuario intenta iniciar sesión en la aplicación, aparecerá un mensaje de error que indica que el usuario no puede dar su consentimiento.</span><span class="sxs-lookup"><span data-stu-id="2b234-189">If your application requests an app-only permission and a user tries to sign in to the application, an error message will be displayed saying the user isn’t able to consent.</span></span>

<span data-ttu-id="2b234-190">Algunos permisos delegados también requieren el consentimiento del administrador de inquilinos.</span><span class="sxs-lookup"><span data-stu-id="2b234-190">Certain delegated permissions also require a tenant administrator’s consent.</span></span>  <span data-ttu-id="2b234-191">Por ejemplo, la posibilidad de reescribir en Azure AD como el usuario que ha iniciado la sesión requiere el consentimiento del administrador de inquilinos.</span><span class="sxs-lookup"><span data-stu-id="2b234-191">For example, the ability to write back to Azure AD as the signed in user requires a tenant administrator’s consent.</span></span>  <span data-ttu-id="2b234-192">Al igual que los permisos de solo aplicación, si un usuario ordinario intenta iniciar sesión en una aplicación que solicita un permiso delegado que requiere el consentimiento del administrador, la aplicación recibirá un error.</span><span class="sxs-lookup"><span data-stu-id="2b234-192">Like app-only permissions, if an ordinary user tries to sign in to an application that requests a delegated permission that requires administrator consent, your application will receive an error.</span></span>  <span data-ttu-id="2b234-193">Que un permiso requiera o no el consentimiento del administrador viene determinado por el desarrollador que publica el recurso, y se puede encontrar en la documentación del recurso.</span><span class="sxs-lookup"><span data-stu-id="2b234-193">Whether or not a permission requires admin consent is determined by the developer that published the resource, and can be found in the documentation for the resource.</span></span>  <span data-ttu-id="2b234-194">En la sección [Contenido relacionado](#related-content) de este artículo se pueden encontrar vínculos que describen los permisos disponibles para la API de Azure AD Graph.</span><span class="sxs-lookup"><span data-stu-id="2b234-194">Links to topics describing the available permissions for the Azure AD Graph API and Microsoft Graph API are in the [Related Content](#related-content) section of this article.</span></span>

<span data-ttu-id="2b234-195">Si la aplicación usa permisos que requieren el consentimiento del administrador, necesita tener un gesto, como un botón o un vínculo donde el administrador pueda iniciar la acción.</span><span class="sxs-lookup"><span data-stu-id="2b234-195">If your application uses permissions that require admin consent, you need to have a gesture such as a button or link where the admin can initiate the action.</span></span>  <span data-ttu-id="2b234-196">La solicitud que la aplicación envía para esta acción es una solicitud de autorización habitual de OAuth2 o OpenID Connect, pero también incluye el parámetro de cadena de consulta `prompt=admin_consent` .</span><span class="sxs-lookup"><span data-stu-id="2b234-196">The request your application sends for this action is a usual OAuth2/OpenID Connect authorization request, but that also includes the `prompt=admin_consent` query string parameter.</span></span>  <span data-ttu-id="2b234-197">Una vez que el administrador ha dado su consentimiento y la entidad de servicio se crea en el inquilino del cliente, las posteriores solicitudes de inicio de sesión no necesitan el parámetro `prompt=admin_consent`.</span><span class="sxs-lookup"><span data-stu-id="2b234-197">Once the admin has consented and the service principal is created in the customer’s tenant, subsequent sign-in requests do not need the `prompt=admin_consent` parameter.</span></span> <span data-ttu-id="2b234-198">Dado que el administrador ha decido que los permisos solicitados son aceptables, en adelante no se solicitará consentimiento a ningún otro usuario.</span><span class="sxs-lookup"><span data-stu-id="2b234-198">Since the administrator has decided the requested permissions are acceptable, no other users in the tenant will be prompted for consent from that point forward.</span></span>

<span data-ttu-id="2b234-199">El parámetro `prompt=admin_consent` también se puede utilizar en las aplicaciones que solicitan permisos que no requieren el consentimiento del administrador.</span><span class="sxs-lookup"><span data-stu-id="2b234-199">The `prompt=admin_consent` parameter can also be used by applications that request permissions that do not require admin consent.</span></span> <span data-ttu-id="2b234-200">Esto se hace cuando la aplicación requiere una experiencia en la que el administrador del inquilino se "registra" una vez, y no se solicita a otros usuarios que den su consentimiento a partir de entonces.</span><span class="sxs-lookup"><span data-stu-id="2b234-200">This is done when the applicaton requires an experience where the tenant admin “signs up” one time, and no other users are prompted for consent from that point on.</span></span>

<span data-ttu-id="2b234-201">Si una aplicación requiere el consentimiento del administrador y un administrador inicia sesión, pero no se envía el parámetro `prompt=admin_consent`, el administrador da su consentimiento correctamente a la aplicación **solo para su cuenta de usuario**.</span><span class="sxs-lookup"><span data-stu-id="2b234-201">If an application requires admin consent, and an admin signs in but the `prompt=admin_consent` parameter is not sent, the admin will successfully consent to the application **only for their user account**.</span></span>  <span data-ttu-id="2b234-202">Los usuarios normales seguirán sin poder iniciar sesión y dar su consentimiento a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="2b234-202">Regular users will still not be able to sign in and consent to the application.</span></span>  <span data-ttu-id="2b234-203">Esto resulta útil si quiere dar al administrador de inquilinos la posibilidad de explorar la aplicación antes de permitir el acceso a otros usuarios.</span><span class="sxs-lookup"><span data-stu-id="2b234-203">This is useful if you want to give the tenant administrator the ability to explore your application before allowing other users access.</span></span>

<span data-ttu-id="2b234-204">Un administrador de inquilinos puede deshabilitar la posibilidad de que los usuarios normales den su consentimiento a las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="2b234-204">A tenant administrator can disable the ability for regular users to consent to applications.</span></span>  <span data-ttu-id="2b234-205">En este caso, para que la aplicación se instale en el inquilino siempre se solicitará el consentimiento del administrador.</span><span class="sxs-lookup"><span data-stu-id="2b234-205">If this capability is disabled, admin consent is always required for the application to be set up in the tenant.</span></span>  <span data-ttu-id="2b234-206">Si quiere probar la aplicación con el consentimiento de usuarios normales deshabilitado, puede encontrar el conmutador de configuración en la sección de configuración de inquilinos de Azure AD de [Azure Portal][AZURE-portal].</span><span class="sxs-lookup"><span data-stu-id="2b234-206">If you want to test your application with regular user consent disabled, you can find the configuration switch in the Azure AD tenant configuration section of the [Azure portal][AZURE-portal].</span></span>

> [!NOTE]
> <span data-ttu-id="2b234-207">En algunas aplicaciones se busca una experiencia en la que los usuarios normales puedan dar su consentimiento inicialmente; más tarde, se puede hacer partícipe al administrador y solicitar permisos que requieran su consentimiento.</span><span class="sxs-lookup"><span data-stu-id="2b234-207">Some applications want an experience where regular users are able to consent initially, and later the application can involve the administrator and request permissions that require admin consent.</span></span>  <span data-ttu-id="2b234-208">Esto no hay forma de hacerlo actualmente con un solo registro de aplicación en Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2b234-208">There is no way to do this with a single application registration in Azure AD today.</span></span>  <span data-ttu-id="2b234-209">El punto de conexión de Azure AD v2 que se lanzará próximamente permitirá que las aplicaciones soliciten permisos en tiempo de ejecución, en lugar de en el momento del registro, lo que permitirá este escenario.</span><span class="sxs-lookup"><span data-stu-id="2b234-209">The upcoming Azure AD v2 endpoint will allow applications to request permissions at runtime, instead of at registration time, which will enable this scenario.</span></span>  <span data-ttu-id="2b234-210">Para más información, consulte la [Guía del desarrollador para el modelo de aplicaciones v2 de Azure AD][AAD-V2-Dev-Guide].</span><span class="sxs-lookup"><span data-stu-id="2b234-210">For more information, see the [Azure AD App Model v2 Developer Guide][AAD-V2-Dev-Guide].</span></span>
> 
> 

### <a name="consent-and-multi-tier-applications"></a><span data-ttu-id="2b234-211">Consentimiento y aplicaciones de niveles múltiples</span><span class="sxs-lookup"><span data-stu-id="2b234-211">Consent and multi-tier applications</span></span>
<span data-ttu-id="2b234-212">La aplicación puede tener varios niveles, cada uno representado por su propio registro en Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2b234-212">Your application may have multiple tiers, each represented by its own registration in Azure AD.</span></span>  <span data-ttu-id="2b234-213">Por ejemplo, una aplicación nativa que llama a una API web o una aplicación web que llama a una API web.</span><span class="sxs-lookup"><span data-stu-id="2b234-213">For example, a native application that calls a web API, or a web application that calls a web API.</span></span>  <span data-ttu-id="2b234-214">En ambos casos, el cliente (aplicación nativa o aplicación web) solicita permisos para llamar al recurso (API web).</span><span class="sxs-lookup"><span data-stu-id="2b234-214">In both of these cases, the client (native app or web app) requests permissions to call the resource (web API).</span></span>  <span data-ttu-id="2b234-215">Para que la aplicación nativa o la aplicación web se acepten correctamente como inquilinos del cliente, todos los recursos a los que solicitan permisos deben ya existir en el inquilino del cliente.</span><span class="sxs-lookup"><span data-stu-id="2b234-215">For the client to be successfully consented into a customer’s tenant, all resources to which it requests permissions must already exist in the customer’s tenant.</span></span>  <span data-ttu-id="2b234-216">Si no se cumple esta condición, Azure AD devolverá un error indicando que primero se debe agregar el recurso.</span><span class="sxs-lookup"><span data-stu-id="2b234-216">If this condition isn’t met, Azure AD will return an error that the resource must be added first.</span></span>

<span data-ttu-id="2b234-217">**Múltiples niveles en un solo inquilino**</span><span class="sxs-lookup"><span data-stu-id="2b234-217">**Multiple tiers in a single tenant**</span></span>

<span data-ttu-id="2b234-218">Esto puede ser un problema si la aplicación lógica consta de dos o más registros de aplicación, por ejemplo, un cliente y un recurso independientes.</span><span class="sxs-lookup"><span data-stu-id="2b234-218">This can be a problem if your logical application consists of two or more application registrations, for example a separate client and resource.</span></span>  <span data-ttu-id="2b234-219">¿Cómo se convierte primero el recurso en el inquilino del cliente?</span><span class="sxs-lookup"><span data-stu-id="2b234-219">How do you get the resource into the customer tenant first?</span></span>  <span data-ttu-id="2b234-220">Azure AD aborda este caso al habilitar el consentimiento del cliente y del recurso en un solo paso.</span><span class="sxs-lookup"><span data-stu-id="2b234-220">Azure AD covers this case by enabling client and resource to be consented in a single step.</span></span> <span data-ttu-id="2b234-221">El usuario ve la suma total de los permisos solicitados por el cliente y el recurso en la página de consentimiento.</span><span class="sxs-lookup"><span data-stu-id="2b234-221">The user sees the sum total of the permissions requested by both the client and resource on the consent page.</span></span>  <span data-ttu-id="2b234-222">Para permitir este comportamiento, el registro de la aplicación del recurso debe incluir el id. de aplicación del cliente como un elemento `knownClientApplications` en su manifiesto de aplicación.</span><span class="sxs-lookup"><span data-stu-id="2b234-222">To enable this behavior, the resource’s application registration must include the client’s App ID as a `knownClientApplications` in its application manifest.</span></span>  <span data-ttu-id="2b234-223">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="2b234-223">For example:</span></span>

    knownClientApplications": ["94da0930-763f-45c7-8d26-04d5938baab2"]

<span data-ttu-id="2b234-224">Esta propiedad se puede actualizar a través del [manifiesto de la aplicación][AAD-App-Manifest] del recurso.</span><span class="sxs-lookup"><span data-stu-id="2b234-224">This property can be updated via the resource [application’s manifest][AAD-App-Manifest].</span></span> <span data-ttu-id="2b234-225">Esto se demuestra en un ejemplo de llamada a la API web de un cliente nativo de niveles múltiples en la sección [Contenido relacionado](#related-content) al final de este artículo.</span><span class="sxs-lookup"><span data-stu-id="2b234-225">This is demonstrated in a multi-tier native client calling web API sample in the [Related Content](#related-content) section at the end of this article.</span></span> <span data-ttu-id="2b234-226">En el diagrama siguiente se ofrece información general sobre el consentimiento de una aplicación de niveles múltiples registrada en un solo inquilino:</span><span class="sxs-lookup"><span data-stu-id="2b234-226">The following diagram provides an overview of consent for a multi-tier app registered in a single tenant :</span></span>

![Consentimiento para aplicaciones cliente conocidas con niveles múltiples][Consent-Multi-Tier-Known-Client] 

<span data-ttu-id="2b234-228">**Múltiples niveles en varios inquilinos**</span><span class="sxs-lookup"><span data-stu-id="2b234-228">**Multiple tiers in multiple tenants**</span></span>

<span data-ttu-id="2b234-229">Un caso parecido tiene lugar si los diferentes niveles de una aplicación se registran en distintos inquilinos.</span><span class="sxs-lookup"><span data-stu-id="2b234-229">A similar case happens if the different tiers of an application are registered in different tenants.</span></span>  <span data-ttu-id="2b234-230">Por ejemplo, considere el caso de la creación de una aplicación cliente nativa que llama a la API de Office 365 Exchange Online.</span><span class="sxs-lookup"><span data-stu-id="2b234-230">For example, consider the case of building a native client application that calls the Office 365 Exchange Online API.</span></span>  <span data-ttu-id="2b234-231">Para desarrollar la aplicación nativa y, más tarde, para que se ejecute en el inquilino de un cliente, la entidad de servicio de Exchange Online debe existir.</span><span class="sxs-lookup"><span data-stu-id="2b234-231">To develop the native application, and later for the native application to run in a customer’s tenant, the Exchange Online service principal must be present.</span></span>  <span data-ttu-id="2b234-232">En este caso, el desarrollador y el cliente tienen que comprar Exchange Online para que la entidad de servicio se cree en sus inquilinos.</span><span class="sxs-lookup"><span data-stu-id="2b234-232">In this case, the developer and customer must purchase Exchange Online for the service principal to be created in their tenants.</span></span>  

<span data-ttu-id="2b234-233">En el caso de una API creada por una organización que no sea Microsoft, el desarrollador de la API debe proporcionar una forma de que sus clientes acepten dar su consentimiento a la aplicación en los inquilinos del cliente.</span><span class="sxs-lookup"><span data-stu-id="2b234-233">In the case of an API built by an organization other than Microsoft, the developer of the API needs to provide a way for their customers to consent the application into their customers' tenants.</span></span> <span data-ttu-id="2b234-234">El diseño recomendado tiene la finalidad de que el desarrollador de terceros cree la API de tal forma que también pueda funcionar como un cliente web para implementar el registro:</span><span class="sxs-lookup"><span data-stu-id="2b234-234">The recommended design is for the 3rd party developer to build the API such that it can also function as a web client to implement sign-up :</span></span>

1. <span data-ttu-id="2b234-235">Consulte las secciones anteriores para asegurarse de que la API implementa los requisitos de código y el registro de aplicaciones multiinquilino.</span><span class="sxs-lookup"><span data-stu-id="2b234-235">Follow the earlier sections to ensure the API implements the multi-tenant application registration/code requirements</span></span>
2. <span data-ttu-id="2b234-236">Además de exponer los roles y ámbitos de la API, asegúrese de que el registro incluye el permiso predeterminado de Azure AD "Iniciar sesión y leer el perfil del usuario".</span><span class="sxs-lookup"><span data-stu-id="2b234-236">In addition to exposing the API's scopes/roles, ensure the registration includes the "Sign in and read user profile" Azure AD permission (provided by default)</span></span>
3. <span data-ttu-id="2b234-237">Implemente una página de inicio de sesión o registro en el cliente web, según las instrucciones para el [consentimiento del administrador](#admin-consent) expuestas anteriormente.</span><span class="sxs-lookup"><span data-stu-id="2b234-237">Implement a sign-in/sign-up page in the web client, following the [admin consent](#admin-consent) guidance discussed earlier</span></span> 
4. <span data-ttu-id="2b234-238">Una vez que el usuario da su consentimiento a la aplicación, se crean los vínculos a la delegación de consentimiento y a la entidad de servicio en el inquilino, y la aplicación nativa puede obtener tokens para la API.</span><span class="sxs-lookup"><span data-stu-id="2b234-238">Once the user consents to the application, the service principal and consent delegation links are created in their tenant, and the native application can get tokens for the API</span></span>

<span data-ttu-id="2b234-239">En el diagrama siguiente se ofrece información general sobre el consentimiento de una aplicación de múltiples niveles registrada en diferentes inquilinos:</span><span class="sxs-lookup"><span data-stu-id="2b234-239">The following diagram provides an overview of consent for a multi-tier app registered in different tenants:</span></span>

![Consentimiento para aplicaciones de terceros con niveles múltiples][Consent-Multi-Tier-Multi-Party] 

### <a name="revoking-consent"></a><span data-ttu-id="2b234-241">Revocación del consentimiento</span><span class="sxs-lookup"><span data-stu-id="2b234-241">Revoking Consent</span></span>
<span data-ttu-id="2b234-242">Los usuarios y administradores pueden revocar el consentimiento a la aplicación en cualquier momento:</span><span class="sxs-lookup"><span data-stu-id="2b234-242">Users and administrators can revoke consent to your application at any time:</span></span>

* <span data-ttu-id="2b234-243">Los usuarios revocan el acceso a aplicaciones individuales quitándolas de su lista [Aplicaciones del panel de acceso][AAD-Access-Panel].</span><span class="sxs-lookup"><span data-stu-id="2b234-243">Users revoke access to individual applications by removing them from their [Access Panel Applications][AAD-Access-Panel] list.</span></span>
* <span data-ttu-id="2b234-244">Los administradores revocan el acceso a las aplicaciones quitándolas de Azure AD mediante la sección de administración de Azure AD de [Azure Portal][AZURE-portal].</span><span class="sxs-lookup"><span data-stu-id="2b234-244">Administrators revoke access to applications by removing them from Azure AD using the Azure AD management section of the [Azure portal][AZURE-portal].</span></span>

<span data-ttu-id="2b234-245">Si un administrador da su consentimiento a una aplicación que incluye a todos los usuarios de un inquilino, los usuarios no pueden revocar el acceso de forma individual.</span><span class="sxs-lookup"><span data-stu-id="2b234-245">If an administrator consents to an application for all users in a tenant, users cannot revoke access individually.</span></span>  <span data-ttu-id="2b234-246">Solo el administrador puede revocar el acceso y solo para la aplicación entera.</span><span class="sxs-lookup"><span data-stu-id="2b234-246">Only the administrator can revoke access, and only for the whole application.</span></span>

### <a name="consent-and-protocol-support"></a><span data-ttu-id="2b234-247">Compatibilidad con el consentimiento y los protocolos</span><span class="sxs-lookup"><span data-stu-id="2b234-247">Consent and Protocol Support</span></span>
<span data-ttu-id="2b234-248">El consentimiento se admite en Azure AD mediante los protocolos OAuth, OpenID Connect, WS-Federation y SAML.</span><span class="sxs-lookup"><span data-stu-id="2b234-248">Consent is supported in Azure AD via the OAuth, OpenID Connect, WS-Federation, and SAML protocols.</span></span>  <span data-ttu-id="2b234-249">Los protocolos SAML y WS-Federation no admiten el parámetro `prompt=admin_consent` , de modo que el consentimiento solo es posible mediante OAuth y OpenID Connect.</span><span class="sxs-lookup"><span data-stu-id="2b234-249">The SAML and WS-Federation protocols do not support the `prompt=admin_consent` parameter, so admin consent is only possible via OAuth and OpenID Connect.</span></span>

## <a name="multi-tenant-applications-and-caching-access-tokens"></a><span data-ttu-id="2b234-250">Aplicaciones multiempresa y almacenamiento en caché de los tokens de acceso</span><span class="sxs-lookup"><span data-stu-id="2b234-250">Multi-Tenant Applications and Caching Access Tokens</span></span>
<span data-ttu-id="2b234-251">Las aplicaciones multiempresa también pueden obtener tokens de acceso para llamar a las API que están protegidas por Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2b234-251">Multi-tenant applications can also get access tokens to call APIs that are protected by Azure AD.</span></span>  <span data-ttu-id="2b234-252">Un error común al usar la biblioteca de autenticación de Active Directory (ADAL) con una aplicación multiempresa es solicitar inicialmente un token para un usuario que utiliza /common, recibir una respuesta y, luego, solicitar posteriormente un token para ese mismo usuario también mediante /common.</span><span class="sxs-lookup"><span data-stu-id="2b234-252">A common error when using the Active Directory Authentication Library (ADAL) with a multi-tenant application, is to initially request a token for a user using /common, receive a response, then request a subsequent token for that same user also using /common.</span></span>  <span data-ttu-id="2b234-253">Dado que la respuesta de Azure AD proviene de un inquilino, y no de /common, ADAL almacena en caché el token como si fuera el inquilino.</span><span class="sxs-lookup"><span data-stu-id="2b234-253">Since the response from Azure AD comes from a tenant, not /common, ADAL caches the token as being from the tenant.</span></span> <span data-ttu-id="2b234-254">La posterior llamada a /common para obtener un token de acceso para el usuario carece de la entrada de caché, y se pide al usuario que inicie la sesión de nuevo.</span><span class="sxs-lookup"><span data-stu-id="2b234-254">The subsequent call to /common to get an access token for the user misses the cache entry, and the user is prompted to sign in again.</span></span>  <span data-ttu-id="2b234-255">Para evitar la pérdida de la caché, asegúrese de que las posteriores llamadas para un usuario que ya ha iniciado sesión se realizan al punto de conexión del inquilino.</span><span class="sxs-lookup"><span data-stu-id="2b234-255">To avoid missing the cache, make sure subsequent calls for an already signed in user are made to the tenant’s endpoint.</span></span>

## <a name="next-steps"></a><span data-ttu-id="2b234-256">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="2b234-256">Next steps</span></span>
<span data-ttu-id="2b234-257">En este artículo ha aprendido a crear una aplicación que puede hacer que un usuario inicie sesión desde cualquier inquilino de Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="2b234-257">In this article, you learned how to build an application that can sign in a user from any Azure Active Directory tenant.</span></span> <span data-ttu-id="2b234-258">Después de habilitar el inicio de sesión único entre la aplicación y Azure Active Directory, también puede actualizar la aplicación para acceder a las API expuestas por recursos de Microsoft como Office 365.</span><span class="sxs-lookup"><span data-stu-id="2b234-258">After enabling Single Sign-On between your app and Azure Active Directory, you can also update your application to access APIs exposed by Microsoft resources, like Office 365.</span></span> <span data-ttu-id="2b234-259">Por tanto, puede ofrecer una experiencia personalizada en su aplicación, por ejemplo, que muestre información contextual a los usuarios, como su imagen de perfil o su próxima cita de calendario.</span><span class="sxs-lookup"><span data-stu-id="2b234-259">So you can offer a personalized experience in your application, for example showing contextual information to the users, like their profile picture or their next calendar appointment.</span></span> <span data-ttu-id="2b234-260">Para obtener más información sobre cómo realizar llamadas de API a Azure Active Directory y servicios de Office 365 como Exchange, SharePoint, OneDrive, OneNote, Planner, Excel y muchos más, visite: [Microsoft Graph API][MSFT-Graph-overview].</span><span class="sxs-lookup"><span data-stu-id="2b234-260">To learn more about making API calls to Azure Active Directory and Office 365 services like Exchange, SharePoint, OneDrive, OneNote, Planner, Excel and more, visit: [Microsoft Graph API][MSFT-Graph-overview].</span></span>


## <a name="related-content"></a><span data-ttu-id="2b234-261">Contenido relacionado</span><span class="sxs-lookup"><span data-stu-id="2b234-261">Related content</span></span>
* <span data-ttu-id="2b234-262">[Ejemplos de aplicación multiinquilino][AAD-Samples-MT]</span><span class="sxs-lookup"><span data-stu-id="2b234-262">[Multi-tenant application samples][AAD-Samples-MT]</span></span>
* <span data-ttu-id="2b234-263">[Directrices de personalización de marca para aplicaciones][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="2b234-263">[Branding Guidelines for Applications][AAD-App-Branding]</span></span>
* <span data-ttu-id="2b234-264">[Guía del desarrollador de Azure AD][AAD-Dev-Guide]</span><span class="sxs-lookup"><span data-stu-id="2b234-264">[Azure AD Developer's Guide][AAD-Dev-Guide]</span></span>
* <span data-ttu-id="2b234-265">[Objetos Application y objetos ServicePrincipal][AAD-App-SP-Objects]</span><span class="sxs-lookup"><span data-stu-id="2b234-265">[Application Objects and Service Principal Objects][AAD-App-SP-Objects]</span></span>
* <span data-ttu-id="2b234-266">[Integración de aplicaciones con Azure Active Directory][AAD-Integrating-Apps]</span><span class="sxs-lookup"><span data-stu-id="2b234-266">[Integrating Applications with Azure Active Directory][AAD-Integrating-Apps]</span></span>
* <span data-ttu-id="2b234-267">[Información general sobre el marco de consentimiento][AAD-Consent-Overview]</span><span class="sxs-lookup"><span data-stu-id="2b234-267">[Overview of the Consent Framework][AAD-Consent-Overview]</span></span>
* <span data-ttu-id="2b234-268">[Ámbitos de permiso de la API Graph de Microsoft][MSFT-Graph-permision-scopes]</span><span class="sxs-lookup"><span data-stu-id="2b234-268">[Microsoft Graph API Permission Scopes][MSFT-Graph-permision-scopes]</span></span>
* <span data-ttu-id="2b234-269">[Ámbitos de permiso de la API Graph de Azure AD][AAD-Graph-Perm-Scopes]</span><span class="sxs-lookup"><span data-stu-id="2b234-269">[Azure AD Graph API Permission Scopes][AAD-Graph-Perm-Scopes]</span></span>

<span data-ttu-id="2b234-270">Use la siguiente sección de comentarios para proporcionar sus opiniones y ayudarnos a afinar y remodelar el contenido.</span><span class="sxs-lookup"><span data-stu-id="2b234-270">Please use the following comments section to provide feedback and help us refine and shape our content.</span></span>

<!--Reference style links IN USE -->
[AAD-Access-Panel]:  https://myapps.microsoft.com
[AAD-App-Branding]: ./active-directory-branding-guidelines.md
[AAD-App-Manifest]: ./active-directory-application-manifest.md
[AAD-App-SP-Objects]: ./active-directory-application-objects.md
[AAD-Auth-Scenarios]: ./active-directory-authentication-scenarios.md
[AAD-Consent-Overview]: ./active-directory-integrating-applications.md#overview-of-the-consent-framework
[AAD-Dev-Guide]: ./active-directory-developers-guide.md
[AAD-Graph-Overview]: https://azure.microsoft.com/en-us/documentation/articles/active-directory-graph-api/
[AAD-Graph-Perm-Scopes]: https://msdn.microsoft.com/library/azure/ad/graph/howto/azure-ad-graph-api-permission-scopes
[AAD-Integrating-Apps]: ./active-directory-integrating-applications.md
[AAD-Samples-MT]: https://azure.microsoft.com/documentation/samples/?service=active-directory&term=multitenant
[AAD-Why-To-Integrate]: ./active-directory-how-to-integrate.md
[AZURE-portal]: https://portal.azure.com
[MSFT-Graph-overview]: https://graph.microsoft.io/en-us/docs/overview/overview
[MSFT-Graph-permision-scopes]: https://graph.microsoft.io/en-us/docs/authorization/permission_scopes

<!--Image references-->
[AAD-Sign-In]: ./media/active-directory-devhowto-multi-tenant-overview/sign-in-with-microsoft-light.png
[Consent-Single-Tier]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-single-tier.png
[Consent-Multi-Tier-Known-Client]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-multi-tier-known-clients.png
[Consent-Multi-Tier-Multi-Party]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-multi-tier-multi-party.png

<!--Reference style links -->
[AAD-App-Manifest]: ./active-directory-application-manifest.md
[AAD-App-SP-Objects]: ./active-directory-application-objects.md
[AAD-Auth-Scenarios]: ./active-directory-authentication-scenarios.md
[AAD-Integrating-Apps]: ./active-directory-integrating-applications.md
[AAD-Dev-Guide]: ./active-directory-developers-guide.md
[AAD-Graph-Perm-Scopes]: https://msdn.microsoft.com/library/azure/ad/graph/howto/azure-ad-graph-api-permission-scopes
[AAD-Graph-App-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#application-entity
[AAD-Graph-Sp-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity
[AAD-Graph-User-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#user-entity
[AAD-How-To-Integrate]: ./active-directory-how-to-integrate.md
[AAD-Security-Token-Claims]: ./active-directory-authentication-scenarios/#claims-in-azure-ad-security-tokens
[AAD-Tokens-Claims]: ./active-directory-token-and-claims.md
[AAD-V2-Dev-Guide]: ../active-directory-appmodel-v2-overview.md
[AZURE-portal]: https://portal.azure.com
[Duyshant-Role-Blog]: http://www.dushyantgill.com/blog/2014/12/10/roles-based-access-control-in-cloud-applications-using-azure-ad/
[JWT]: https://tools.ietf.org/html/draft-ietf-oauth-json-web-token-32
[O365-Perm-Ref]: https://msdn.microsoft.com/en-us/office/office365/howto/application-manifest
[OAuth2-Access-Token-Scopes]: https://tools.ietf.org/html/rfc6749#section-3.3
[OAuth2-AuthZ-Code-Grant-Flow]: https://msdn.microsoft.com/library/azure/dn645542.aspx
[OAuth2-AuthZ-Grant-Types]: https://tools.ietf.org/html/rfc6749#section-1.3 
[OAuth2-Client-Types]: https://tools.ietf.org/html/rfc6749#section-2.1
[OAuth2-Role-Def]: https://tools.ietf.org/html/rfc6749#page-6
[OpenIDConnect]: http://openid.net/specs/openid-connect-core-1_0.html
[OpenIDConnect-ID-Token]: http://openid.net/specs/openid-connect-core-1_0.html#IDToken















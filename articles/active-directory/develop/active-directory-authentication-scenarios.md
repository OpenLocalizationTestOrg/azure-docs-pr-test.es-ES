---
title: "Escenarios de autenticación de Azure AD | Microsoft Docs"
description: "Información general de los cinco escenarios de autenticación más comunes para Azure Active Directory (AAD)."
services: active-directory
documentationcenter: dev-center-name
author: skwan
manager: mbaldwin
editor: 
ms.assetid: 0c84e7d0-16aa-4897-82f2-f53c6c990fd9
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 04/27/2017
ms.author: skwan
ms.custom: aaddev
ms.openlocfilehash: 2f9410bdaa037f1839cf7c12c3532b51be669ed5
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/18/2017
---
# <a name="authentication-scenarios-for-azure-ad"></a><span data-ttu-id="6c806-103">Escenarios de autenticación para Azure AD</span><span class="sxs-lookup"><span data-stu-id="6c806-103">Authentication Scenarios for Azure AD</span></span>
<span data-ttu-id="6c806-104">Azure Active Directory (Azure AD) simplifica la autenticación para los desarrolladores, ya que ofrece la identificación como un servicio, con compatibilidad con protocolos genéricos del sector como OAuth 2.0 y OpenID Connect, además de bibliotecas de código abierto para distintas plataformas, para poder empezar a codificar rápidamente.</span><span class="sxs-lookup"><span data-stu-id="6c806-104">Azure Active Directory (Azure AD) simplifies authentication for developers by providing identity as a service, with support for industry-standard protocols such as OAuth 2.0 and OpenID Connect, as well as open source libraries for different platforms to help you start coding quickly.</span></span> <span data-ttu-id="6c806-105">Este documento le ayudará a comprender los diversos escenarios admitidos por Azure AD y le mostrará las tareas iniciales.</span><span class="sxs-lookup"><span data-stu-id="6c806-105">This document will help you understand the various scenarios Azure AD supports and will show you how to get started.</span></span> <span data-ttu-id="6c806-106">Se divide en las secciones siguientes:</span><span class="sxs-lookup"><span data-stu-id="6c806-106">It’s divided into the following sections:</span></span>

* [<span data-ttu-id="6c806-107">Conceptos básicos sobre autenticación en Azure AD</span><span class="sxs-lookup"><span data-stu-id="6c806-107">Basics of Authentication in Azure AD</span></span>](#basics-of-authentication-in-azure-ad)
* [<span data-ttu-id="6c806-108">Notificaciones de tokens de seguridad de Azure AD</span><span class="sxs-lookup"><span data-stu-id="6c806-108">Claims in Azure AD Security Tokens</span></span>](#claims-in-azure-ad-security-tokens)
* [<span data-ttu-id="6c806-109">Conceptos básicos sobre el registro de una aplicación en Azure AD</span><span class="sxs-lookup"><span data-stu-id="6c806-109">Basics of Registering an Application in Azure AD</span></span>](#basics-of-registering-an-application-in-azure-ad)
* [<span data-ttu-id="6c806-110">Tipos de aplicaciones y escenarios</span><span class="sxs-lookup"><span data-stu-id="6c806-110">Application Types and Scenarios</span></span>](#application-types-and-scenarios)
  
  * [<span data-ttu-id="6c806-111">Explorador web a aplicación web</span><span class="sxs-lookup"><span data-stu-id="6c806-111">Web Browser to Web Application</span></span>](#web-browser-to-web-application)
  * [<span data-ttu-id="6c806-112">Aplicación de una sola página (SPA)</span><span class="sxs-lookup"><span data-stu-id="6c806-112">Single Page Application (SPA)</span></span>](#single-page-application-spa)
  * [<span data-ttu-id="6c806-113">Aplicación nativa a API web</span><span class="sxs-lookup"><span data-stu-id="6c806-113">Native Application to Web API</span></span>](#native-application-to-web-api)
  * [<span data-ttu-id="6c806-114">Aplicación web a API web</span><span class="sxs-lookup"><span data-stu-id="6c806-114">Web Application to Web API</span></span>](#web-application-to-web-api)
  * [<span data-ttu-id="6c806-115">Aplicación de servidor o de demonio en API web</span><span class="sxs-lookup"><span data-stu-id="6c806-115">Daemon or Server Application to Web API</span></span>](#daemon-or-server-application-to-web-api)

## <a name="basics-of-authentication-in-azure-ad"></a><span data-ttu-id="6c806-116">Conceptos básicos sobre autenticación en Azure AD</span><span class="sxs-lookup"><span data-stu-id="6c806-116">Basics of Authentication in Azure AD</span></span>
<span data-ttu-id="6c806-117">Si no está familiarizado con los conceptos básicos de la autenticación en Azure AD, lea esta sección.</span><span class="sxs-lookup"><span data-stu-id="6c806-117">If you are unfamiliar with basic concepts of authentication in Azure AD, read this section.</span></span> <span data-ttu-id="6c806-118">De lo contrario, puede pasar a [Tipos de aplicaciones y escenarios](#application-types-and-scenarios).</span><span class="sxs-lookup"><span data-stu-id="6c806-118">Otherwise, you may want to skip down to [Application Types and Scenarios](#application-types-and-scenarios).</span></span>

<span data-ttu-id="6c806-119">Veamos el escenario más básico en el que es necesario identificarse: un usuario de un explorador web debe autenticarse en una aplicación web.</span><span class="sxs-lookup"><span data-stu-id="6c806-119">Let’s consider the most basic scenario where identity is required: a user in a web browser needs to authenticate to a web application.</span></span> <span data-ttu-id="6c806-120">Este escenario se describe más detalladamente en la sección [Explorador web a aplicación web](#web-browser-to-web-application) , pero es un punto de partida útil para ilustrar las capacidades de Azure AD y conceptualizar el funcionamiento del escenario.</span><span class="sxs-lookup"><span data-stu-id="6c806-120">This scenario is described in greater detail in the [Web Browser to Web Application](#web-browser-to-web-application) section, but it’s a useful starting point to illustrate the capabilities of Azure AD and conceptualize how the scenario works.</span></span> <span data-ttu-id="6c806-121">Tenga en cuenta el diagrama siguiente para este escenario:</span><span class="sxs-lookup"><span data-stu-id="6c806-121">Consider the following diagram for this scenario:</span></span>

![Información general de inicio de sesión en la aplicación web](./media/active-directory-authentication-scenarios/basics_of_auth_in_aad.png)

<span data-ttu-id="6c806-123">Teniendo en cuenta el diagrama anterior, a continuación se indica qué debe saber sobre los distintos componentes:</span><span class="sxs-lookup"><span data-stu-id="6c806-123">With the diagram above in mind, here’s what you need to know about its various components:</span></span>

* <span data-ttu-id="6c806-124">Azure AD es el proveedor de identidades, responsable de comprobar la identidad de los usuarios y las aplicaciones que existen en el directorio de una organización y, en última instancia, de emitir tokens de seguridad tras la autenticación correcta de dichos usuarios y aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="6c806-124">Azure AD is the identity provider, responsible for verifying the identity of users and applications that exist in an organization’s directory, and ultimately issuing security tokens upon successful authentication of those users and applications.</span></span>
* <span data-ttu-id="6c806-125">Una aplicación que desee externalizar la autenticación a Azure AD debe estar registrada en Azure AD, que registra e identifica de modo único la aplicación en el directorio.</span><span class="sxs-lookup"><span data-stu-id="6c806-125">An application that wants to outsource authentication to Azure AD must be registered in Azure AD, which registers and uniquely identifies the app in the directory.</span></span>
* <span data-ttu-id="6c806-126">Los desarrolladores pueden usar las bibliotecas de autenticación de código abierto de Azure AD para facilitar la autenticación, ya que administran los detalles de los protocolos para el usuario.</span><span class="sxs-lookup"><span data-stu-id="6c806-126">Developers can use the open source Azure AD authentication libraries to make authentication easy by handling the protocol details for you.</span></span> <span data-ttu-id="6c806-127">Consulte [Bibliotecas de autenticación de Azure Active Directory](active-directory-authentication-libraries.md) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="6c806-127">See [Azure Active Directory Authentication Libraries](active-directory-authentication-libraries.md) for more information.</span></span>

<span data-ttu-id="6c806-128">• Una vez autenticado el usuario, la aplicación debe validar el token de seguridad de este para garantizar que la autenticación se realizó correctamente para las partes implicadas.</span><span class="sxs-lookup"><span data-stu-id="6c806-128">• Once a user has been authenticated, the application must validate the user’s security token to ensure that authentication was successful for the intended parties.</span></span> <span data-ttu-id="6c806-129">Los desarrolladores pueden usar las bibliotecas de autenticación proporcionadas para administrar la validación de cualquier token de Azure AD, incluidos los tokens web JSON (JWT) o de SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="6c806-129">Developers can use the provided authentication libraries to handle validation of any token from Azure AD, including JSON Web Tokens (JWT) or SAML 2.0.</span></span> <span data-ttu-id="6c806-130">Si desea realizar la validación manualmente, vea la documentación del [Controlador de tokens JWT](https://msdn.microsoft.com/library/dn205065.aspx) .</span><span class="sxs-lookup"><span data-stu-id="6c806-130">If you want to perform validation manually, see the [JWT Token Handler](https://msdn.microsoft.com/library/dn205065.aspx) documentation.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6c806-131">Azure AD usa criptografía de clave pública para firmar los tokens y verificar que son válidos.</span><span class="sxs-lookup"><span data-stu-id="6c806-131">Azure AD uses public key cryptography to sign tokens and verify that they are valid.</span></span> <span data-ttu-id="6c806-132">Consulte [Información importante acerca de la cadencia de sustitución de clave en Azure AD](active-directory-signing-key-rollover.md) para obtener más información sobre la lógica necesaria que debe tener en la aplicación para garantizar que siempre está actualizada con las claves más recientes.</span><span class="sxs-lookup"><span data-stu-id="6c806-132">See [Important Information About Signing Key Rollover in Azure AD](active-directory-signing-key-rollover.md) for more information on the necessary logic you must have in your application to ensure it’s always updated with the latest keys.</span></span>
> 
> 

<span data-ttu-id="6c806-133">• El flujo de solicitudes y respuestas del proceso de autenticación lo determina el protocolo de autenticación que se use, como OAuth 2.0, OpenID Connect, WS-Federation o SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="6c806-133">• The flow of requests and responses for the authentication process is determined by the authentication protocol that was used, such as OAuth 2.0, OpenID Connect, WS-Federation, or SAML 2.0.</span></span> <span data-ttu-id="6c806-134">Estos protocolos se analizan con más detalle en el tema [Protocolos de autenticación de Azure Active Directory](active-directory-authentication-protocols.md) y en las secciones siguientes.</span><span class="sxs-lookup"><span data-stu-id="6c806-134">These protocols are discussed in more detail in the [Azure Active Directory Authentication Protocols](active-directory-authentication-protocols.md) topic and in the sections below.</span></span>

> [!NOTE]
> <span data-ttu-id="6c806-135">Azure AD admite los estándares OAuth 2.0 y OpenID Connect, que hacen un uso generalizado de tokens portadores, incluidos los representados como JWT.</span><span class="sxs-lookup"><span data-stu-id="6c806-135">Azure AD supports the OAuth 2.0 and OpenID Connect standards that make extensive use of bearer tokens, including bearer tokens represented as JWTs.</span></span> <span data-ttu-id="6c806-136">Un token portador es un token de seguridad ligero que concede al "portador" acceso a un recurso protegido.</span><span class="sxs-lookup"><span data-stu-id="6c806-136">A bearer token is a lightweight security token that grants the “bearer” access to a protected resource.</span></span> <span data-ttu-id="6c806-137">En este sentido, el "portador" es cualquier parte que pueda presentar el token.</span><span class="sxs-lookup"><span data-stu-id="6c806-137">In this sense, the “bearer” is any party that can present the token.</span></span> <span data-ttu-id="6c806-138">Aunque una parte debe autenticarse primero con Azure AD para recibir el token portador, si no se realizan los pasos necesarios para asegurar el token en la transmisión y el almacenamiento, este puede interceptarse y ser utilizado por un usuario no deseado.</span><span class="sxs-lookup"><span data-stu-id="6c806-138">Though a party must first authenticate with Azure AD to receive the bearer token, if the required steps are not taken to secure the token in transmission and storage, it can be intercepted and used by an unintended party.</span></span> <span data-ttu-id="6c806-139">Mientras que algunos tokens de seguridad disponen de un mecanismo integrado para evitar ser usados por partes no autorizadas, los tokens portadores no tienen este mecanismo y deben transportarse en un canal seguro como, por ejemplo, la seguridad de la capa de transporte (HTTPS).</span><span class="sxs-lookup"><span data-stu-id="6c806-139">While some security tokens have a built-in mechanism for preventing unauthorized parties from using them, bearer tokens do not have this mechanism and must be transported in a secure channel such as transport layer security (HTTPS).</span></span> <span data-ttu-id="6c806-140">Si un token portador se transmite sin cifrar, un usuario malintencionado puede utilizar un ataque de tipo "Man in the middle" para adquirir el token y usarlo para obtener acceso sin autorización a un recurso protegido.</span><span class="sxs-lookup"><span data-stu-id="6c806-140">If a bearer token is transmitted in the clear, a man-in the middle attack can be used by a malicious party to acquire the token and use it for an unauthorized access to a protected resource.</span></span> <span data-ttu-id="6c806-141">Los mismos principios de seguridad se aplican al almacenamiento o almacenamiento en caché de tokens portadores para su uso posterior.</span><span class="sxs-lookup"><span data-stu-id="6c806-141">The same security principles apply when storing or caching bearer tokens for later use.</span></span> <span data-ttu-id="6c806-142">Asegúrese siempre de que la aplicación transmite y almacena los tokens portadores de manera segura.</span><span class="sxs-lookup"><span data-stu-id="6c806-142">Always ensure that your application transmits and stores bearer tokens in a secure manner.</span></span> <span data-ttu-id="6c806-143">Para otras consideraciones sobre la seguridad de los tokens portadores, consulte la [Sección 5 de RFC 6750](http://tools.ietf.org/html/rfc6750).</span><span class="sxs-lookup"><span data-stu-id="6c806-143">For more security considerations on bearer tokens, see [RFC 6750 Section 5](http://tools.ietf.org/html/rfc6750).</span></span>
> 
> 

<span data-ttu-id="6c806-144">Ahora que ya tiene información general sobre los conceptos básicos, lea las secciones siguientes para comprender cómo funciona el aprovisionamiento en Azure AD, así como los escenarios comunes admitidos por Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-144">Now that you have an overview of the basics, read the sections below to understand how provisioning works in Azure AD and the common scenarios Azure AD supports.</span></span>

## <a name="claims-in-azure-ad-security-tokens"></a><span data-ttu-id="6c806-145">Notificaciones de tokens de seguridad de Azure AD</span><span class="sxs-lookup"><span data-stu-id="6c806-145">Claims in Azure AD Security Tokens</span></span>
<span data-ttu-id="6c806-146">Los tokens de seguridad que emite Azure AD contienen notificaciones o aserciones de información sobre el usuario que se ha autenticado.</span><span class="sxs-lookup"><span data-stu-id="6c806-146">Security tokens issued by Azure AD contain claims, or assertions of information about the subject that has been authenticated.</span></span> <span data-ttu-id="6c806-147">La aplicación puede usar estas notificaciones para varias tareas.</span><span class="sxs-lookup"><span data-stu-id="6c806-147">These claims can be used by the application for various tasks.</span></span> <span data-ttu-id="6c806-148">Por ejemplo, pueden usarse para validar el token, identificar el inquilino de directorio del usuario, mostrar información del usuario o determinar la autorización del usuario, entre otros.</span><span class="sxs-lookup"><span data-stu-id="6c806-148">For example, they can be used to validate the token, identify the subject's directory tenant, display user information, determine the subject's authorization, and so on.</span></span> <span data-ttu-id="6c806-149">Las notificaciones presentes en cualquier token de seguridad dependen del tipo de token, el tipo de credencial que se usa para autenticar al usuario y la configuración de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6c806-149">The claims present in any given security token are dependent upon the type of token, the type of credential used to authenticate the user, and the application configuration.</span></span> <span data-ttu-id="6c806-150">En la tabla siguiente se proporciona una breve descripción de cada tipo de notificación que Azure AD emite.</span><span class="sxs-lookup"><span data-stu-id="6c806-150">A brief description of each type of claim emitted by Azure AD is provided in the table below.</span></span> <span data-ttu-id="6c806-151">Para obtener más información, consulte [Tipos de token y notificación compatibles](active-directory-token-and-claims.md).</span><span class="sxs-lookup"><span data-stu-id="6c806-151">For more information, refer to [Supported Token and Claim Types](active-directory-token-and-claims.md).</span></span>

| <span data-ttu-id="6c806-152">Notificación</span><span class="sxs-lookup"><span data-stu-id="6c806-152">Claim</span></span> | <span data-ttu-id="6c806-153">Description</span><span class="sxs-lookup"><span data-stu-id="6c806-153">Description</span></span> |
| --- | --- |
| <span data-ttu-id="6c806-154">Identificador de aplicación</span><span class="sxs-lookup"><span data-stu-id="6c806-154">Application ID</span></span> |<span data-ttu-id="6c806-155">Identifica la aplicación que está usando el token.</span><span class="sxs-lookup"><span data-stu-id="6c806-155">Identifies the application that is using the token.</span></span> |
| <span data-ttu-id="6c806-156">Público</span><span class="sxs-lookup"><span data-stu-id="6c806-156">Audience</span></span> |<span data-ttu-id="6c806-157">Identifica el recurso de destinatario al que está destinado el token.</span><span class="sxs-lookup"><span data-stu-id="6c806-157">Identifies the recipient resource the token is intended for.</span></span> |
| <span data-ttu-id="6c806-158">Referencia de clase de contexto de autenticación de aplicación</span><span class="sxs-lookup"><span data-stu-id="6c806-158">Application Authentication Context Class Reference</span></span> |<span data-ttu-id="6c806-159">Indica cómo se autenticó el cliente (cliente público frente a cliente confidencial).</span><span class="sxs-lookup"><span data-stu-id="6c806-159">Indicates how the client was authenticated (public client vs. confidential client).</span></span> |
| <span data-ttu-id="6c806-160">Instante de autenticación</span><span class="sxs-lookup"><span data-stu-id="6c806-160">Authentication Instant</span></span> |<span data-ttu-id="6c806-161">Registra la fecha y la hora de la autenticación.</span><span class="sxs-lookup"><span data-stu-id="6c806-161">Records the date and time when the authentication occurred.</span></span> |
| <span data-ttu-id="6c806-162">Método de autenticación</span><span class="sxs-lookup"><span data-stu-id="6c806-162">Authentication Method</span></span> |<span data-ttu-id="6c806-163">Indica cómo se autenticó el firmante del token (contraseña, certificado, etc.).</span><span class="sxs-lookup"><span data-stu-id="6c806-163">Indicates how the subject of the token was authenticated (password, certificate, etc.).</span></span> |
| <span data-ttu-id="6c806-164">Nombre de usuario</span><span class="sxs-lookup"><span data-stu-id="6c806-164">First Name</span></span> |<span data-ttu-id="6c806-165">Proporciona el nombre de usuario, tal como se estableció en Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-165">Provides the given name of the user as set in Azure AD.</span></span> |
| <span data-ttu-id="6c806-166">Grupos</span><span class="sxs-lookup"><span data-stu-id="6c806-166">Groups</span></span> |<span data-ttu-id="6c806-167">Contiene identificadores de objeto de los grupos de Azure AD de los que es miembro el usuario.</span><span class="sxs-lookup"><span data-stu-id="6c806-167">Contains object Ids of Azure AD groups the user is a member of.</span></span> |
| <span data-ttu-id="6c806-168">Proveedor de identidades</span><span class="sxs-lookup"><span data-stu-id="6c806-168">Identity Provider</span></span> |<span data-ttu-id="6c806-169">Registra el proveedor de identidades que autenticó al firmante del token.</span><span class="sxs-lookup"><span data-stu-id="6c806-169">Records the identity provider that authenticated the subject of the token.</span></span> |
| <span data-ttu-id="6c806-170">Emitido a las</span><span class="sxs-lookup"><span data-stu-id="6c806-170">Issued At</span></span> |<span data-ttu-id="6c806-171">Registra la hora a la que se emitió el token; suele utilizarse para la actualización del token.</span><span class="sxs-lookup"><span data-stu-id="6c806-171">Records the time at which the token was issued, often used for token freshness.</span></span> |
| <span data-ttu-id="6c806-172">Emisor</span><span class="sxs-lookup"><span data-stu-id="6c806-172">Issuer</span></span> |<span data-ttu-id="6c806-173">Identifica al STS que emitió el token, así como el inquilino de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-173">Identifies the STS that emitted the token as well as the Azure AD tenant.</span></span> |
| <span data-ttu-id="6c806-174">Apellidos</span><span class="sxs-lookup"><span data-stu-id="6c806-174">Last Name</span></span> |<span data-ttu-id="6c806-175">Proporciona los apellidos del usuario, tal como se establecieron en Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-175">Provides the surname of the user as set in Azure AD.</span></span> |
| <span data-ttu-id="6c806-176">Nombre</span><span class="sxs-lookup"><span data-stu-id="6c806-176">Name</span></span> |<span data-ttu-id="6c806-177">Proporciona un valor en lenguaje natural que identifica al firmante del token.</span><span class="sxs-lookup"><span data-stu-id="6c806-177">Provides a human readable value that identifies the subject of the token.</span></span> |
| <span data-ttu-id="6c806-178">Identificador de objeto</span><span class="sxs-lookup"><span data-stu-id="6c806-178">Object Id</span></span> |<span data-ttu-id="6c806-179">Contiene un identificador único e inmutable del firmante en Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-179">Contains an immutable, unique identifier of the subject in Azure AD.</span></span> |
| <span data-ttu-id="6c806-180">Roles</span><span class="sxs-lookup"><span data-stu-id="6c806-180">Roles</span></span> |<span data-ttu-id="6c806-181">Contiene los nombres descriptivos de los roles de aplicación de Azure AD que se han concedido al usuario.</span><span class="sxs-lookup"><span data-stu-id="6c806-181">Contains friendly names of Azure AD Application Roles that the user has been granted.</span></span> |
| <span data-ttu-id="6c806-182">Scope</span><span class="sxs-lookup"><span data-stu-id="6c806-182">Scope</span></span> |<span data-ttu-id="6c806-183">Indica los permisos concedidos a la aplicación cliente.</span><span class="sxs-lookup"><span data-stu-id="6c806-183">Indicates the permissions granted to the client application.</span></span> |
| <span data-ttu-id="6c806-184">Asunto</span><span class="sxs-lookup"><span data-stu-id="6c806-184">Subject</span></span> |<span data-ttu-id="6c806-185">Indica la entidad de seguridad sobre la que el token valida información.</span><span class="sxs-lookup"><span data-stu-id="6c806-185">Indicates the principal about which the token asserts information.</span></span> |
| <span data-ttu-id="6c806-186">Identificador de inquilino</span><span class="sxs-lookup"><span data-stu-id="6c806-186">Tenant Id</span></span> |<span data-ttu-id="6c806-187">Contiene un identificador único e inmutable del inquilino de directorio que emitió el token.</span><span class="sxs-lookup"><span data-stu-id="6c806-187">Contains an immutable, unique identifier of the directory tenant that issued the token.</span></span> |
| <span data-ttu-id="6c806-188">Duración del token</span><span class="sxs-lookup"><span data-stu-id="6c806-188">Token Lifetime</span></span> |<span data-ttu-id="6c806-189">Define el intervalo de tiempo dentro del cual es válido un token.</span><span class="sxs-lookup"><span data-stu-id="6c806-189">Defines the time interval within which a token is valid.</span></span> |
| <span data-ttu-id="6c806-190">Nombre principal de usuario</span><span class="sxs-lookup"><span data-stu-id="6c806-190">User Principal Name</span></span> |<span data-ttu-id="6c806-191">Contiene el nombre principal de usuario del firmante.</span><span class="sxs-lookup"><span data-stu-id="6c806-191">Contains the user principal name of the subject.</span></span> |
| <span data-ttu-id="6c806-192">Versión</span><span class="sxs-lookup"><span data-stu-id="6c806-192">Version</span></span> |<span data-ttu-id="6c806-193">Contiene el número de versión del token.</span><span class="sxs-lookup"><span data-stu-id="6c806-193">Contains the version number of the token.</span></span> |

## <a name="basics-of-registering-an-application-in-azure-ad"></a><span data-ttu-id="6c806-194">Conceptos básicos sobre el registro de una aplicación en Azure AD</span><span class="sxs-lookup"><span data-stu-id="6c806-194">Basics of Registering an Application in Azure AD</span></span>
<span data-ttu-id="6c806-195">Cualquier aplicación que externalice la autenticación a Azure AD debe registrarse en un directorio.</span><span class="sxs-lookup"><span data-stu-id="6c806-195">Any application that outsources authentication to Azure AD must be registered in a directory.</span></span> <span data-ttu-id="6c806-196">Este paso implica informar a Azure AD de la aplicación, incluidos, entre otros, la dirección URL donde se encuentra, la dirección URL a la que se envían las respuestas tras la autenticación y el URI que identifica la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6c806-196">This step involves telling Azure AD about your application, including the URL where it’s located, the URL to send replies after authentication, the URI to identify your application, and more.</span></span> <span data-ttu-id="6c806-197">Esta información es necesaria por algunos motivos importantes:</span><span class="sxs-lookup"><span data-stu-id="6c806-197">This information is required for a few key reasons:</span></span>

* <span data-ttu-id="6c806-198">Azure AD necesita coordenadas para comunicarse con la aplicación cuando administra el inicio de sesión o intercambia tokens.</span><span class="sxs-lookup"><span data-stu-id="6c806-198">Azure AD needs coordinates to communicate with the application when handling sign-on or exchanging tokens.</span></span> <span data-ttu-id="6c806-199">Entre ellas se incluyen las siguientes:</span><span class="sxs-lookup"><span data-stu-id="6c806-199">These include the following:</span></span>
  
  * <span data-ttu-id="6c806-200">URI del identificador de la aplicación: identificador de una aplicación.</span><span class="sxs-lookup"><span data-stu-id="6c806-200">Application ID URI: The identifier for an application.</span></span> <span data-ttu-id="6c806-201">Este valor se envía a Azure AD durante la autenticación para indicar para qué aplicación el llamador quiere un token.</span><span class="sxs-lookup"><span data-stu-id="6c806-201">This value is sent to Azure AD during authentication to indicate which application the caller wants a token for.</span></span> <span data-ttu-id="6c806-202">Además, este valor se incluye en el token de manera que la aplicación sepa que se trata del objetivo.</span><span class="sxs-lookup"><span data-stu-id="6c806-202">Additionally, this value is included in the token so that the application knows it was the intended target.</span></span>
  * <span data-ttu-id="6c806-203">URL de respuesta y URI de redirección: en el caso de una API web o aplicación web, la dirección URL de respuesta es la ubicación a la que Azure AD enviará la respuesta de autenticación, incluido un token si la autenticación fue correcta.</span><span class="sxs-lookup"><span data-stu-id="6c806-203">Reply URL and Redirect URI: In the case of a web API or web application, the Reply URL is the location to which Azure AD will send the authentication response, including a token if authentication was successful.</span></span> <span data-ttu-id="6c806-204">En el caso de una aplicación nativa, el URI de redirección es un identificador único al que Azure AD redirigirá el agente de usuario de una solicitud de OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="6c806-204">In the case of a native application, the Redirect URI is a unique identifier to which Azure AD will redirect the user-agent in an OAuth 2.0 request.</span></span>
  * <span data-ttu-id="6c806-205">Id. de la aplicación: identificador de una aplicación que Azure AD genera cuando se registra la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6c806-205">Application ID: The ID for an application, which is generated by Azure AD when the application is registered.</span></span> <span data-ttu-id="6c806-206">Al solicitar un token o código de autorización, se envían la clave y el identificador de la aplicación a Azure AD durante la autenticación.</span><span class="sxs-lookup"><span data-stu-id="6c806-206">When requesting an authorization code or token, the Application ID and key are sent to Azure AD during authentication.</span></span>
  * <span data-ttu-id="6c806-207">Clave: clave que se envía junto con un identificador de la aplicación al autenticarse en Azure AD para llamar a una API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-207">Key: The key that is sent along with a Application ID when authenticating to Azure AD to call a web API.</span></span>
* <span data-ttu-id="6c806-208">Azure AD debe asegurarse de que la aplicación tiene los permisos necesarios para obtener acceso a los datos del directorio, a otras aplicaciones de la organización, etc.</span><span class="sxs-lookup"><span data-stu-id="6c806-208">Azure AD needs to ensure the application has the required permissions to access your directory data, other applications in your organization, and so on</span></span>

<span data-ttu-id="6c806-209">El aprovisionamiento se entiende mejor cuando se comprende que existen dos categorías de aplicaciones que se pueden desarrollar e integrarse con Azure AD:</span><span class="sxs-lookup"><span data-stu-id="6c806-209">Provisioning becomes clearer when you understand that there are two categories of applications that can be developed and integrated with Azure AD:</span></span>

* <span data-ttu-id="6c806-210">Aplicación de un solo inquilino: el uso de una aplicación de un solo inquilino se destina a una sola organización.</span><span class="sxs-lookup"><span data-stu-id="6c806-210">Single tenant application: A single tenant application is intended for use in one organization.</span></span> <span data-ttu-id="6c806-211">Suele tratarse de aplicaciones de línea de negocio (LOB) escritas por un desarrollador de la empresa.</span><span class="sxs-lookup"><span data-stu-id="6c806-211">These are typically line-of-business (LoB) applications written by an enterprise developer.</span></span> <span data-ttu-id="6c806-212">A una aplicación de un solo inquilino solo obtienen acceso usuarios de un solo directorio y, por tanto, solo es necesario aprovisionarla en un directorio.</span><span class="sxs-lookup"><span data-stu-id="6c806-212">A single tenant application only needs to be accessed by users in one directory, and as a result, it only needs to be provisioned in one directory.</span></span> <span data-ttu-id="6c806-213">Suele tratarse de aplicaciones registradas por un desarrollador de la organización.</span><span class="sxs-lookup"><span data-stu-id="6c806-213">These applications are typically registered by a developer in the organization.</span></span>
* <span data-ttu-id="6c806-214">Aplicación multiempresa (de varios inquilinos): el uso de una aplicación multiempresa se destina a varias organizaciones, no solo a una.</span><span class="sxs-lookup"><span data-stu-id="6c806-214">Multi-tenant application: A multi-tenant application is intended for use in many organizations, not just one organization.</span></span> <span data-ttu-id="6c806-215">Suele tratarse de aplicaciones de software como servicio (SaaS) escritas por un proveedor de software independiente (ISV).</span><span class="sxs-lookup"><span data-stu-id="6c806-215">These are typically software-as-a-service (SaaS) applications written by an independent software vendor (ISV).</span></span> <span data-ttu-id="6c806-216">Las aplicaciones multiempresa se deben aprovisionar en cada uno de los directorios en los que se usarán, lo que requiere el consentimiento del usuario o del administrador para registrarlas.</span><span class="sxs-lookup"><span data-stu-id="6c806-216">Multi-tenant applications need to be provisioned in each directory where they will be used, which requires user or administrator consent to register them.</span></span> <span data-ttu-id="6c806-217">El proceso de consentimiento se inicia cuando una aplicación se ha registrado en el directorio y se le proporciona acceso a la API de gráficos o quizás a otra API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-217">This consent process starts when an application has been registered in the directory and is given access to the Graph API or perhaps another web API.</span></span> <span data-ttu-id="6c806-218">Cuando un usuario o un administrador de otra organización inicia sesión para usar la aplicación, se muestra un cuadro de diálogo que indica los permisos requeridos por la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6c806-218">When a user or administrator from a different organization signs up to use the application, they are presented with a dialog that displays the permissions the application requires.</span></span> <span data-ttu-id="6c806-219">A continuación, el usuario o el administrador pueden dar su consentimiento a la aplicación, lo que proporciona a la aplicación acceso a los datos establecidos y, por último, registra la aplicación en el directorio.</span><span class="sxs-lookup"><span data-stu-id="6c806-219">The user or administrator can then consent to the application, which gives the application access to the stated data, and finally registers the application in their directory.</span></span> <span data-ttu-id="6c806-220">Para obtener más información, consulte [Información general del marco de consentimiento](active-directory-integrating-applications.md#overview-of-the-consent-framework).</span><span class="sxs-lookup"><span data-stu-id="6c806-220">For more information, see [Overview of the Consent Framework](active-directory-integrating-applications.md#overview-of-the-consent-framework).</span></span>

<span data-ttu-id="6c806-221">Cuando se desarrolla una aplicación multiempresa en lugar de una aplicación de un solo inquilino hay que tener en cuenta otros aspectos.</span><span class="sxs-lookup"><span data-stu-id="6c806-221">Some additional considerations arise when developing a multi-tenant application instead of a single tenant application.</span></span> <span data-ttu-id="6c806-222">Por ejemplo, si pone la aplicación a disposición de usuarios de varios directorios, necesitará un mecanismo para determinar en qué inquilino se encuentran.</span><span class="sxs-lookup"><span data-stu-id="6c806-222">For example, if you are making your application available to users in multiple directories, you need a mechanism to determine which tenant they’re in.</span></span> <span data-ttu-id="6c806-223">Una aplicación de un solo inquilino únicamente necesita buscar un usuario en su propio directorio, mientras que una aplicación multiempresa debe identificar un usuario específico en todos los directorios de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-223">A single tenant application only needs to look in its own directory for a user, while a multi-tenant application needs to identify a specific user from all the directories in Azure AD.</span></span> <span data-ttu-id="6c806-224">Para realizar esta tarea, Azure AD proporciona un extremo de autenticación común donde cualquier aplicación multiempresa puede dirigir solicitudes de inicio de sesión, en lugar de un extremo específico del inquilino.</span><span class="sxs-lookup"><span data-stu-id="6c806-224">To accomplish this task, Azure AD provides a common authentication endpoint where any multi-tenant application can direct sign-in requests, instead of a tenant-specific endpoint.</span></span> <span data-ttu-id="6c806-225">Este punto de conexión es https://login.microsoftonline.com/common para todos los directorios en Azure AD, mientras que un punto de conexión específico del inquilino podría ser https://login.microsoftonline.com/contoso.onmicrosoft.com. Es especialmente importante tener en cuenta el extremo común al desarrollar la aplicación porque necesitará toda la lógica necesaria para administrar varios inquilinos durante el inicio y el cierre de sesión y la validación de tokens.</span><span class="sxs-lookup"><span data-stu-id="6c806-225">This endpoint is https://login.microsoftonline.com/common for all directories in Azure AD, whereas a tenant-specific endpoint might be https://login.microsoftonline.com/contoso.onmicrosoft.com. The common endpoint is especially important to consider when developing your application because you’ll need the necessary logic to handle multiple tenants during sign-in, sign-out, and token validation.</span></span>

<span data-ttu-id="6c806-226">Si actualmente desarrolla una aplicación de un solo inquilino pero quiere ponerla a disposición de varias organizaciones, puede realizar cambios fácilmente en la aplicación y en su configuración en Azure AD para que pueda aceptar varios inquilinos.</span><span class="sxs-lookup"><span data-stu-id="6c806-226">If you are currently developing a single tenant application but want to make it available to many organizations, you can easily make changes to the application and its configuration in Azure AD to make it multi-tenant capable.</span></span> <span data-ttu-id="6c806-227">Además, Azure AD usa la misma clave de firma para todos los tokens en todos los directorios, tanto si se proporciona autenticación para una aplicación de un solo inquilino como para una aplicación multiempresa de varios inquilinos.</span><span class="sxs-lookup"><span data-stu-id="6c806-227">In addition, Azure AD uses the same signing key for all tokens in all directories, whether you are providing authentication in a single tenant or multi-tenant application.</span></span>

<span data-ttu-id="6c806-228">Cada uno de los escenarios incluidos en este documento incluye una subsección en donde se describen sus requisitos de aprovisionamiento.</span><span class="sxs-lookup"><span data-stu-id="6c806-228">Each scenario listed in this document includes a sub-section that describes its provisioning requirements.</span></span> <span data-ttu-id="6c806-229">Si desea obtener información más detallada sobre el aprovisionamiento de aplicaciones en Azure AD y las diferencias entre aplicaciones de un solo inquilino y multiempresa, vea [Integración de aplicaciones con Azure Active Directory](active-directory-integrating-applications.md) .</span><span class="sxs-lookup"><span data-stu-id="6c806-229">For more in-depth information about provisioning an application in Azure AD and the differences between single and multi-tenant applications, see [Integrating Applications with Azure Active Directory](active-directory-integrating-applications.md) for more information.</span></span> <span data-ttu-id="6c806-230">Siga leyendo para comprender los escenarios de aplicación comunes de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-230">Continue reading to understand the common application scenarios in Azure AD.</span></span>

## <a name="application-types-and-scenarios"></a><span data-ttu-id="6c806-231">Tipos de aplicaciones y escenarios</span><span class="sxs-lookup"><span data-stu-id="6c806-231">Application Types and Scenarios</span></span>
<span data-ttu-id="6c806-232">Cada uno de los escenarios que se describen en este documento puede desarrollarse con varios lenguajes y plataformas.</span><span class="sxs-lookup"><span data-stu-id="6c806-232">Each of the scenarios described in this document can be developed using various languages and platforms.</span></span> <span data-ttu-id="6c806-233">Todos van acompañados de ejemplos de código completos, disponibles en nuestra [guía de ejemplos de código](active-directory-code-samples.md) o directamente en los [repositorios de ejemplos de GitHub](https://github.com/Azure-Samples?utf8=%E2%9C%93&query=active-directory) correspondientes.</span><span class="sxs-lookup"><span data-stu-id="6c806-233">They are all backed by complete code samples which are available in our [Code Samples guide](active-directory-code-samples.md), or directly from the corresponding [GitHub sample repositories](https://github.com/Azure-Samples?utf8=%E2%9C%93&query=active-directory).</span></span> <span data-ttu-id="6c806-234">Además, si la aplicación necesita un determinado fragmento o segmento de un escenario de un extremo a otro, dicha funcionalidad se podrá agregar de manera independiente en la mayoría de los casos.</span><span class="sxs-lookup"><span data-stu-id="6c806-234">In addition, if your application needs a specific piece or segment of an end-to-end scenario, in most cases that functionality can be added independently.</span></span> <span data-ttu-id="6c806-235">Por ejemplo, si tiene una aplicación nativa que llama a una API web, puede agregar fácilmente una aplicación web que también llame a la API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-235">For example, if you have a native application that calls a web API, you can easily add a web application that also calls the web API.</span></span> <span data-ttu-id="6c806-236">En el diagrama siguiente se ilustran estos escenarios y tipos de aplicación, además de cómo pueden agregarse distintos componentes:</span><span class="sxs-lookup"><span data-stu-id="6c806-236">The following diagram illustrates these scenarios and application types, and how different components can be added:</span></span>

![Tipos de aplicaciones y escenarios](./media/active-directory-authentication-scenarios/application_types_and_scenarios.png)

<span data-ttu-id="6c806-238">Estos son los cinco escenarios principales de aplicación que admite Azure AD:</span><span class="sxs-lookup"><span data-stu-id="6c806-238">These are the five primary application scenarios supported by Azure AD:</span></span>

* <span data-ttu-id="6c806-239">[Explorador web a aplicación web](#web-browser-to-web-application): un usuario tiene que iniciar sesión en una aplicación web protegida por Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-239">[Web Browser to Web Application](#web-browser-to-web-application): A user needs to sign in to a web application that is secured by Azure AD.</span></span>
* <span data-ttu-id="6c806-240">[Aplicación de una sola página (SPA)](#single-page-application-spa): un usuario tiene que iniciar sesión en una aplicación de una sola página protegida por Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-240">[Single Page Application (SPA)](#single-page-application-spa): A user needs to sign in to a single page application that is secured by Azure AD.</span></span>
* <span data-ttu-id="6c806-241">[Aplicación nativa a API web](#native-application-to-web-api): una aplicación nativa que se ejecuta en teléfonos, tabletas o equipos tiene que autenticar un usuario para obtener recursos de una API web protegida por Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-241">[Native Application to Web API](#native-application-to-web-api): A native application that runs on a phone, tablet, or PC needs to authenticate a user to get resources from a web API that is secured by Azure AD.</span></span>
* <span data-ttu-id="6c806-242">[Aplicación web a API web](#web-application-to-web-api): una aplicación web tiene que obtener recursos de una API web protegida por Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-242">[Web Application to Web API](#web-application-to-web-api): A web application needs to get resources from a web API secured by Azure AD.</span></span>
* <span data-ttu-id="6c806-243">[Aplicación de servidor o de demonio en API web](#daemon-or-server-application-to-web-api): una aplicación de demonio o de servidor sin interfaz de usuario web tiene que obtener recursos de una API web protegida por Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-243">[Daemon or Server Application to Web API](#daemon-or-server-application-to-web-api): A daemon application or a server application with no web user interface needs to get resources from a web API secured by Azure AD.</span></span>

### <a name="web-browser-to-web-application"></a><span data-ttu-id="6c806-244">Explorador web a aplicación web</span><span class="sxs-lookup"><span data-stu-id="6c806-244">Web Browser to Web Application</span></span>
<span data-ttu-id="6c806-245">En esta sección se describe una aplicación que autentica a un usuario de un explorador web en una aplicación web.</span><span class="sxs-lookup"><span data-stu-id="6c806-245">This section describes an application that authenticates a user in a web browser to a web application.</span></span> <span data-ttu-id="6c806-246">En este escenario, la aplicación web dirige el explorador del usuario para que inicie sesión en Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-246">In this scenario, the web application directs the user’s browser to sign them in to Azure AD.</span></span> <span data-ttu-id="6c806-247">Azure AD devuelve una respuesta de inicio de sesión a través el explorador del usuario, que contiene notificaciones sobre el usuario en un token de seguridad.</span><span class="sxs-lookup"><span data-stu-id="6c806-247">Azure AD returns a sign-in response through the user’s browser, which contains claims about the user in a security token.</span></span> <span data-ttu-id="6c806-248">Este escenario admite el inicio de sesión mediante los protocolos WS-Federation, SAML 2.0 y OpenID Connect.</span><span class="sxs-lookup"><span data-stu-id="6c806-248">This scenario supports sign-on using the WS-Federation, SAML 2.0, and OpenID Connect protocols.</span></span>

#### <a name="diagram"></a><span data-ttu-id="6c806-249">Diagrama</span><span class="sxs-lookup"><span data-stu-id="6c806-249">Diagram</span></span>
![Flujo de autenticación de explorador a aplicación web](./media/active-directory-authentication-scenarios/web_browser_to_web_api.png)

#### <a name="description-of-protocol-flow"></a><span data-ttu-id="6c806-251">Descripción del flujo de protocolo</span><span class="sxs-lookup"><span data-stu-id="6c806-251">Description of Protocol Flow</span></span>
1. <span data-ttu-id="6c806-252">Cuando un usuario visita la aplicación y debe iniciar sesión, se le redirige mediante una solicitud de inicio de sesión al extremo de autenticación de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-252">When a user visits the application and needs to sign in, they are redirected via a sign-in request to the authentication endpoint in Azure AD.</span></span>
2. <span data-ttu-id="6c806-253">El usuario inicia sesión en la página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="6c806-253">The user signs in on the sign-in page.</span></span>
3. <span data-ttu-id="6c806-254">Si la autenticación es correcta, Azure AD crea un token de autenticación y devuelve una respuesta de inicio de sesión a la dirección URL de respuesta de la aplicación que se configuró en Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="6c806-254">If authentication is successful, Azure AD creates an authentication token and returns a sign-in response to the application’s Reply URL that was configured in the Azure Portal.</span></span> <span data-ttu-id="6c806-255">En el caso de una aplicación de producción, esta URL de respuesta debe ser HTTPS.</span><span class="sxs-lookup"><span data-stu-id="6c806-255">For a production application, this Reply URL should be HTTPS.</span></span> <span data-ttu-id="6c806-256">El token devuelto incluye notificaciones sobre el usuario y Azure AD, necesarias para que la aplicación valide el token.</span><span class="sxs-lookup"><span data-stu-id="6c806-256">The returned token includes claims about the user and Azure AD that are required by the application to validate the token.</span></span>
4. <span data-ttu-id="6c806-257">La aplicación valida el token mediante una clave de firma pública y la información del emisor disponible en el documento de metadatos de federación para Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-257">The application validates the token by using a public signing key and issuer information available at the federation metadata document for Azure AD.</span></span> <span data-ttu-id="6c806-258">Cuando la aplicación haya validado el token, Azure AD inicia una nueva sesión con el usuario.</span><span class="sxs-lookup"><span data-stu-id="6c806-258">After the application validates the token, Azure AD starts a new session with the user.</span></span> <span data-ttu-id="6c806-259">Hasta que expire, esta sesión permitirá al usuario tener acceso a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6c806-259">This session allows the user to access the application until it expires.</span></span>

#### <a name="code-samples"></a><span data-ttu-id="6c806-260">Ejemplos de código</span><span class="sxs-lookup"><span data-stu-id="6c806-260">Code Samples</span></span>
<span data-ttu-id="6c806-261">Vea los ejemplos de código para escenarios de explorador web a aplicación web.</span><span class="sxs-lookup"><span data-stu-id="6c806-261">See the code samples for Web Browser to Web Application scenarios.</span></span> <span data-ttu-id="6c806-262">Agregamos nuevos ejemplos continuamente, así que no olvide consultarlos con frecuencia.</span><span class="sxs-lookup"><span data-stu-id="6c806-262">And, check back frequently -- we add new samples all the time.</span></span> <span data-ttu-id="6c806-263">[Explorador web a aplicación web](active-directory-code-samples.md#web-browser-to-web-application).</span><span class="sxs-lookup"><span data-stu-id="6c806-263">[Web Browser to Web Application](active-directory-code-samples.md#web-browser-to-web-application).</span></span>

#### <a name="registering"></a><span data-ttu-id="6c806-264">Registro</span><span class="sxs-lookup"><span data-stu-id="6c806-264">Registering</span></span>
* <span data-ttu-id="6c806-265">Inquilino único: si compila una aplicación únicamente para la organización, esta debe registrarse en el directorio de la empresa mediante Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="6c806-265">Single Tenant: If you are building an application just for your organization, it must be registered in your company’s directory by using the Azure Portal.</span></span>
* <span data-ttu-id="6c806-266">Multiempresa (varios inquilinos): si compila una aplicación que puede ser utilizada por usuarios ajenos a la organización, esta debe registrarse en el directorio de la compañía, pero también en el directorio de cada organización que vaya a usar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6c806-266">Multi-Tenant: If you are building an application that can be used by users outside your organization, it must be registered in your company’s directory, but also must be registered in each organization’s directory that will be using the application.</span></span> <span data-ttu-id="6c806-267">Para que la aplicación esté disponible en su directorio, puede incluir un proceso de inicio de sesión para que los clientes puedan dar su consentimiento a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6c806-267">To make your application available in their directory, you can include a sign-up process for your customers that enables them to consent to your application.</span></span> <span data-ttu-id="6c806-268">Cuando inicien sesión en la aplicación, se les presentará un cuadro de diálogo que muestra los permisos que la aplicación requiere y la opción de consentimiento.</span><span class="sxs-lookup"><span data-stu-id="6c806-268">When they sign up for your application, they will be presented with a dialog that shows the permissions the application requires, and then the option to consent.</span></span> <span data-ttu-id="6c806-269">Según los permisos necesarios, es posible que se requiera que un administrador de la otra organización dé su consentimiento.</span><span class="sxs-lookup"><span data-stu-id="6c806-269">Depending on the required permissions, an administrator in the other organization may be required to give consent.</span></span> <span data-ttu-id="6c806-270">Cuando el usuario o el administrador dan su consentimiento, la aplicación queda registrada en el directorio.</span><span class="sxs-lookup"><span data-stu-id="6c806-270">When the user or administrator consents, the application is registered in their directory.</span></span> <span data-ttu-id="6c806-271">Para obtener más información, vea [Integración de aplicaciones con Azure Active Directory](active-directory-integrating-applications.md).</span><span class="sxs-lookup"><span data-stu-id="6c806-271">For more information, see [Integrating Applications with Azure Active Directory](active-directory-integrating-applications.md).</span></span>

#### <a name="token-expiration"></a><span data-ttu-id="6c806-272">Expiración del token</span><span class="sxs-lookup"><span data-stu-id="6c806-272">Token Expiration</span></span>
<span data-ttu-id="6c806-273">La sesión del usuario expira cuando expira la duración del token emitido por Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-273">The user’s session expires when the lifetime of the token issued by Azure AD expires.</span></span> <span data-ttu-id="6c806-274">Si lo desea, la aplicación puede reducir este período de tiempo; por ejemplo, cerrar sesiones de usuario en función de un período de inactividad.</span><span class="sxs-lookup"><span data-stu-id="6c806-274">Your application can shorten this time period if desired, such as signing out users based on a period of inactivity.</span></span> <span data-ttu-id="6c806-275">Cuando la sesión expire, se le pedirá al usuario que vuelva a iniciar sesión.</span><span class="sxs-lookup"><span data-stu-id="6c806-275">When the session expires, the user will be prompted to sign in again.</span></span>

### <a name="single-page-application-spa"></a><span data-ttu-id="6c806-276">Aplicación de una sola página (SPA)</span><span class="sxs-lookup"><span data-stu-id="6c806-276">Single Page Application (SPA)</span></span>
<span data-ttu-id="6c806-277">En esta sección se describe la autenticación de una aplicación de una sola página, donde se usa Azure AD y la concesión de autorización implícita OAuth 2.0 para proteger su back-end de API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-277">This section describes authentication for a Single Page Application, that uses Azure AD and the OAuth 2.0 implicit authorization grant to secure its web API back end.</span></span> <span data-ttu-id="6c806-278">Las aplicaciones de una sola página normalmente están estructuradas como una capa de presentación (front-end) de JavaScript que se ejecuta en el explorador y un back-end de API web que se ejecuta en un servidor e implementa la lógica de negocios de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6c806-278">Single Page Applications are typically structured as a JavaScript presentation layer (front end) that runs in the browser and a Web API back end that runs on a server and implements the application’s business logic.</span></span> <span data-ttu-id="6c806-279">Para conocer más sobre la concesión de autorización implícita y ayudarle a decidir si es adecuada para el escenario de su aplicación, consulte [Descripción del flujo de concesión implícita de OAuth2 de Azure Active Directory (AD)](active-directory-dev-understanding-oauth2-implicit-grant.md).</span><span class="sxs-lookup"><span data-stu-id="6c806-279">To learn more about the implicit authorization grant, and help you decide whether it's right for your application scenario, see [Understanding the OAuth2 implicit grant flow in Azure Active Directory](active-directory-dev-understanding-oauth2-implicit-grant.md).</span></span>

<span data-ttu-id="6c806-280">En este escenario, cuando el usuario inicia sesión, el front-end de JavaScript usa la [biblioteca de autenticación de Active Directory para JavaScript (ADAL.JS)](https://github.com/AzureAD/azure-activedirectory-library-for-js/tree/dev) y la concesión de autorización implícita para obtener un token de identificación (id_token) de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-280">In this scenario, when the user signs in, the JavaScript front end uses [Active Directory Authentication Library for JavaScript (ADAL.JS)](https://github.com/AzureAD/azure-activedirectory-library-for-js/tree/dev) and the implicit authorization grant to obtain an ID token (id_token) from Azure AD.</span></span> <span data-ttu-id="6c806-281">El token se almacena en caché y el cliente lo adjunta a la solicitud como token de portador al realizar llamadas al back-end de la API web, que está protegido con el middleware de OWIN.</span><span class="sxs-lookup"><span data-stu-id="6c806-281">The token is cached and the client attaches it to the request as the bearer token when making calls to its Web API back end, which is secured using the OWIN middleware.</span></span> 

#### <a name="diagram"></a><span data-ttu-id="6c806-282">Diagrama</span><span class="sxs-lookup"><span data-stu-id="6c806-282">Diagram</span></span>
![Diagrama de aplicación de una sola página](./media/active-directory-authentication-scenarios/single_page_app.png)

#### <a name="description-of-protocol-flow"></a><span data-ttu-id="6c806-284">Descripción del flujo de protocolo</span><span class="sxs-lookup"><span data-stu-id="6c806-284">Description of Protocol Flow</span></span>
1. <span data-ttu-id="6c806-285">El usuario navega a la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="6c806-285">The user navigates to the web application.</span></span>
2. <span data-ttu-id="6c806-286">La aplicación devuelve el front-end de JavaScript (capa de presentación) en el explorador.</span><span class="sxs-lookup"><span data-stu-id="6c806-286">The application returns the JavaScript front end (presentation layer) to the browser.</span></span>
3. <span data-ttu-id="6c806-287">El usuario inicia sesión, por ejemplo, haciendo clic en un vínculo de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="6c806-287">The user initiates sign in, for example by clicking a sign in link.</span></span> <span data-ttu-id="6c806-288">El explorador envía un comando GET al extremo de autorización de Azure AD para solicitar un identificador de token.</span><span class="sxs-lookup"><span data-stu-id="6c806-288">The browser sends a GET to the Azure AD authorization endpoint to request an ID token.</span></span> <span data-ttu-id="6c806-289">Esta solicitud incluye el identificador de la aplicación y la dirección URL de respuesta en los parámetros de consulta.</span><span class="sxs-lookup"><span data-stu-id="6c806-289">This request includes the application ID and reply URL in the query parameters.</span></span>
4. <span data-ttu-id="6c806-290">Azure AD valida la dirección URL de respuesta contrastándola con la dirección URL de respuesta registrada que se configuró en Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="6c806-290">Azure AD validates the Reply URL against the registered Reply URL that was configured in the Azure Portal.</span></span>
5. <span data-ttu-id="6c806-291">El usuario inicia sesión en la página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="6c806-291">The user signs in on the sign-in page.</span></span>
6. <span data-ttu-id="6c806-292">Si la autenticación es correcta, Azure AD crea un token de identificador y lo devuelve como un fragmento de URL (#) a la URL de respuesta de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6c806-292">If authentication is successful, Azure AD creates an ID token and returns it as a URL fragment (#) to the application’s Reply URL.</span></span> <span data-ttu-id="6c806-293">En el caso de una aplicación de producción, esta URL de respuesta debe ser HTTPS.</span><span class="sxs-lookup"><span data-stu-id="6c806-293">For a production application, this Reply URL should be HTTPS.</span></span> <span data-ttu-id="6c806-294">El token devuelto incluye notificaciones sobre el usuario y Azure AD, necesarias para que la aplicación valide el token.</span><span class="sxs-lookup"><span data-stu-id="6c806-294">The returned token includes claims about the user and Azure AD that are required by the application to validate the token.</span></span>
7. <span data-ttu-id="6c806-295">El código de cliente de JavaScript que se ejecuta en el explorador extrae el token de la respuesta para usarlo para proteger las llamadas al back-end de la API web de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6c806-295">The JavaScript client code running in the browser extracts the token from the response to use in securing calls to the application’s web API back end.</span></span>
8. <span data-ttu-id="6c806-296">El explorador llama al back-end de la API web de la aplicación con el token de acceso en el encabezado de autorización.</span><span class="sxs-lookup"><span data-stu-id="6c806-296">The browser calls the application’s web API back end with the access token in the authorization header.</span></span>

#### <a name="code-samples"></a><span data-ttu-id="6c806-297">Ejemplos de código</span><span class="sxs-lookup"><span data-stu-id="6c806-297">Code Samples</span></span>
<span data-ttu-id="6c806-298">Consulte los ejemplos de código para escenarios de aplicación de una sola página (SPA).</span><span class="sxs-lookup"><span data-stu-id="6c806-298">See the code samples for Single Page Application (SPA) scenarios.</span></span> <span data-ttu-id="6c806-299">Asegúrese de consultarlos con frecuencia; agregamos nuevos ejemplos continuamente.</span><span class="sxs-lookup"><span data-stu-id="6c806-299">Be sure to check back frequently -- we add new samples all the time.</span></span> <span data-ttu-id="6c806-300">[Aplicación de una sola página (SPA)](active-directory-code-samples.md#single-page-application-spa).</span><span class="sxs-lookup"><span data-stu-id="6c806-300">[Single Page Application (SPA)](active-directory-code-samples.md#single-page-application-spa).</span></span>

#### <a name="registering"></a><span data-ttu-id="6c806-301">Registro</span><span class="sxs-lookup"><span data-stu-id="6c806-301">Registering</span></span>
* <span data-ttu-id="6c806-302">Inquilino único: si compila una aplicación únicamente para la organización, esta debe registrarse en el directorio de la empresa mediante Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="6c806-302">Single Tenant: If you are building an application just for your organization, it must be registered in your company’s directory by using the Azure Portal.</span></span>
* <span data-ttu-id="6c806-303">Multiempresa (varios inquilinos): si compila una aplicación que puede ser utilizada por usuarios ajenos a la organización, esta debe registrarse en el directorio de la compañía, pero también en el directorio de cada organización que vaya a usar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6c806-303">Multi-Tenant: If you are building an application that can be used by users outside your organization, it must be registered in your company’s directory, but also must be registered in each organization’s directory that will be using the application.</span></span> <span data-ttu-id="6c806-304">Para que la aplicación esté disponible en su directorio, puede incluir un proceso de inicio de sesión para que los clientes puedan dar su consentimiento a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6c806-304">To make your application available in their directory, you can include a sign-up process for your customers that enables them to consent to your application.</span></span> <span data-ttu-id="6c806-305">Cuando inicien sesión en la aplicación, se les presentará un cuadro de diálogo que muestra los permisos que la aplicación requiere y la opción de consentimiento.</span><span class="sxs-lookup"><span data-stu-id="6c806-305">When they sign up for your application, they will be presented with a dialog that shows the permissions the application requires, and then the option to consent.</span></span> <span data-ttu-id="6c806-306">Según los permisos necesarios, es posible que se requiera que un administrador de la otra organización dé su consentimiento.</span><span class="sxs-lookup"><span data-stu-id="6c806-306">Depending on the required permissions, an administrator in the other organization may be required to give consent.</span></span> <span data-ttu-id="6c806-307">Cuando el usuario o el administrador dan su consentimiento, la aplicación queda registrada en el directorio.</span><span class="sxs-lookup"><span data-stu-id="6c806-307">When the user or administrator consents, the application is registered in their directory.</span></span> <span data-ttu-id="6c806-308">Para obtener más información, vea [Integración de aplicaciones con Azure Active Directory](active-directory-integrating-applications.md).</span><span class="sxs-lookup"><span data-stu-id="6c806-308">For more information, see [Integrating Applications with Azure Active Directory](active-directory-integrating-applications.md).</span></span>

<span data-ttu-id="6c806-309">Después de registrar la aplicación, esta debe configurarse para usar el protocolo de concesión implícita OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="6c806-309">After registering the application, it must be configured to use OAuth 2.0 Implicit Grant protocol.</span></span> <span data-ttu-id="6c806-310">De forma predeterminada, este protocolo está deshabilitado para las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="6c806-310">By default, this protocol is disabled for applications.</span></span> <span data-ttu-id="6c806-311">Para habilitar el protocolo de concesión implícita OAuth2 para su aplicación, edite el manifiesto de aplicación en Azure Portal y establezca el valor de "oauth2AllowImplicitFlow" en true.</span><span class="sxs-lookup"><span data-stu-id="6c806-311">To enable the OAuth2 Implicit Grant protocol for your application, edit its application manifest from the Azure Portal and set the “oauth2AllowImplicitFlow” value to true.</span></span> <span data-ttu-id="6c806-312">Para obtener instrucciones detalladas, consulte [Habilitar la concesión implícita de OAuth 2.0 para aplicaciones de una sola página](active-directory-integrating-applications.md).</span><span class="sxs-lookup"><span data-stu-id="6c806-312">For detailed instructions, see [Enabling OAuth 2.0 Implicit Grant for Single Page Applications](active-directory-integrating-applications.md).</span></span>

#### <a name="token-expiration"></a><span data-ttu-id="6c806-313">Expiración del token</span><span class="sxs-lookup"><span data-stu-id="6c806-313">Token Expiration</span></span>
<span data-ttu-id="6c806-314">Al usar ADAL.js para administrar la autenticación con Azure AD, se beneficia de varias características que facilitan la actualización de un token caducado, así como la obtención de tokens para recursos de la API web adicionales a los que puede llamar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6c806-314">When you use ADAL.js to manage authentication with Azure AD, you benefit from several features that facilitate refreshing an expired token as well as getting tokens for additional web API resources that may be called by the application.</span></span> <span data-ttu-id="6c806-315">Cuando el usuario se autentica correctamente con Azure AD, se establece una sesión protegida por una cookie entre el explorador y Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-315">When the user successfully authenticates with Azure AD, a session secured by a cookie is established for the user between the browser and Azure AD.</span></span> <span data-ttu-id="6c806-316">Es importante tener en cuenta que la sesión tiene lugar entre el usuario y Azure AD, no entre el usuario y la aplicación web que se ejecuta en el servidor.</span><span class="sxs-lookup"><span data-stu-id="6c806-316">It’s important to note that the session exists between the user and Azure AD and not between the user and the web application running on the server.</span></span> <span data-ttu-id="6c806-317">Cuando un token expira, ADAL.js usa esta sesión para obtener otro token automáticamente.</span><span class="sxs-lookup"><span data-stu-id="6c806-317">When a token expires, ADAL.js uses this session to silently obtain another token.</span></span> <span data-ttu-id="6c806-318">Esto se hace mediante el uso de un iFrame oculto para enviar y recibir la solicitud con el protocolo de concesión implícita OAuth.</span><span class="sxs-lookup"><span data-stu-id="6c806-318">It does this by using a hidden iFrame to send and receive the request using the OAuth Implicit Grant protocol.</span></span> <span data-ttu-id="6c806-319">ADAL.js también puede usar el mismo mecanismo para obtener acceso automático a tokens de Azure AD para otros recursos de la API web a los que la aplicación llame, siempre que dichos recursos admitan el uso compartido de recursos entre orígenes (CORS), estén registrados en el directorio del usuario y este haya dado el consentimiento requerido durante el inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="6c806-319">ADAL.js can also use this same mechanism to silently obtain access tokens from Azure AD for other web API resources that the application calls as long as these resources support cross-origin resource sharing (CORS), are registered in the user’s directory, and any required consent was given by the user during sign-in.</span></span>

### <a name="native-application-to-web-api"></a><span data-ttu-id="6c806-320">Aplicación nativa a API web</span><span class="sxs-lookup"><span data-stu-id="6c806-320">Native Application to Web API</span></span>
<span data-ttu-id="6c806-321">En esta sección se describe una aplicación nativa que llama a una API web en nombre de un usuario.</span><span class="sxs-lookup"><span data-stu-id="6c806-321">This section describes a native application that calls a web API on behalf of a user.</span></span> <span data-ttu-id="6c806-322">Este escenario se basa en el tipo de concesión de código de autorización OAuth 2.0 con un cliente público, tal como se describe en la sección 4.1 de la [especificación de OAuth 2.0](http://tools.ietf.org/html/rfc6749).</span><span class="sxs-lookup"><span data-stu-id="6c806-322">This scenario is built on the OAuth 2.0 authorization code grant type with a public client, as described in section 4.1 of the [OAuth 2.0 specification](http://tools.ietf.org/html/rfc6749).</span></span> <span data-ttu-id="6c806-323">La aplicación nativa obtiene un token de acceso para el usuario mediante el protocolo OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="6c806-323">The native application obtains an access token for the user by using the OAuth 2.0 protocol.</span></span> <span data-ttu-id="6c806-324">Este token de acceso se envía después en la respuesta a la API web, que autoriza al usuario y devuelve el recurso deseado.</span><span class="sxs-lookup"><span data-stu-id="6c806-324">This access token is then sent in the request to the web API, which authorizes the user and returns the desired resource.</span></span>

#### <a name="diagram"></a><span data-ttu-id="6c806-325">Diagrama</span><span class="sxs-lookup"><span data-stu-id="6c806-325">Diagram</span></span>
![Diagrama de aplicación nativa a API web](./media/active-directory-authentication-scenarios/native_app_to_web_api.png)

#### <a name="authentication-flow-for-native-application-to-api"></a><span data-ttu-id="6c806-327">Flujo de autenticación para aplicación nativa a API</span><span class="sxs-lookup"><span data-stu-id="6c806-327">Authentication flow for native application to API</span></span>
#### <a name="description-of-protocol-flow"></a><span data-ttu-id="6c806-328">Descripción del flujo de protocolo</span><span class="sxs-lookup"><span data-stu-id="6c806-328">Description of Protocol Flow</span></span>
<span data-ttu-id="6c806-329">Si usa las bibliotecas de autenticación de AD, la mayoría de los detalles del protocolo que se describen a continuación se administran automáticamente, por ejemplo, la ventana emergente del explorador, el almacenamiento en caché de los tokens y la administración de los tokens de actualización.</span><span class="sxs-lookup"><span data-stu-id="6c806-329">If you are using the AD Authentication Libraries, most of the protocol details described below are handled for you, such as the browser pop-up, token caching, and handling of refresh tokens.</span></span>

1. <span data-ttu-id="6c806-330">Mediante una ventana emergente del explorador, la aplicación nativa realiza una solicitud al extremo de autorización de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-330">Using a browser pop-up, the native application makes a request to the authorization endpoint in Azure AD.</span></span> <span data-ttu-id="6c806-331">Esta solicitud incluye el identificador de la aplicación y el identificador URI de redirección de la aplicación nativa, tal como se muestra en Azure Portal, así como el identificador URI del identificador de la aplicación para la API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-331">This request includes the Application ID and the redirect URI of the native application as shown in the Azure Portal, and the application ID URI for the web API.</span></span> <span data-ttu-id="6c806-332">Si el usuario todavía no ha iniciado sesión, se le pide que lo haga.</span><span class="sxs-lookup"><span data-stu-id="6c806-332">If the user hasn’t already signed in, they are prompted to sign in again</span></span>
2. <span data-ttu-id="6c806-333">Azure AD autentica al usuario.</span><span class="sxs-lookup"><span data-stu-id="6c806-333">Azure AD authenticates the user.</span></span> <span data-ttu-id="6c806-334">Si se trata de una aplicación de varios inquilinos y se requiere consentimiento para usarla, se pedirá el consentimiento del usuario si todavía no lo ha dado.</span><span class="sxs-lookup"><span data-stu-id="6c806-334">If it is a multi-tenant application and consent is required to use the application, the user will be required to consent if they haven’t already done so.</span></span> <span data-ttu-id="6c806-335">Después de conceder consentimiento y tras la correcta autenticación, Azure AD emite una respuesta de código de autorización al URI de redirección de la aplicación cliente.</span><span class="sxs-lookup"><span data-stu-id="6c806-335">After granting consent and upon successful authentication, Azure AD issues an authorization code response back to the client application’s redirect URI.</span></span>
3. <span data-ttu-id="6c806-336">Cuando Azure AD devuelve una respuesta de código de autorización al URI de redirección, la aplicación cliente detiene la interacción con el explorador y extrae el código de autorización de la respuesta.</span><span class="sxs-lookup"><span data-stu-id="6c806-336">When Azure AD issues an authorization code response back to the redirect URI, the client application stops browser interaction and extracts the authorization code from the response.</span></span> <span data-ttu-id="6c806-337">Con este código de autorización, la aplicación cliente envía una solicitud al punto de conexión de token de Azure AD que incluye el código de autorización, detalles sobre la aplicación cliente (URI de redirección e identificador de la aplicación), además del recurso deseado (URI del identificador de la aplicación para la API web).</span><span class="sxs-lookup"><span data-stu-id="6c806-337">Using this authorization code, the client application sends a request to Azure AD’s token endpoint that includes the authorization code, details about the client application (Application ID and redirect URI), and the desired resource (application ID URI for the web API).</span></span>
4. <span data-ttu-id="6c806-338">Azure AD valida el código de autorización e información sobre la aplicación cliente y la API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-338">The authorization code and information about the client application and web API are validated by Azure AD.</span></span> <span data-ttu-id="6c806-339">Tras la correcta validación, Azure AD devuelve dos tokens: un token de acceso de JWT y un token de actualización de JWT.</span><span class="sxs-lookup"><span data-stu-id="6c806-339">Upon successful validation, Azure AD returns two tokens: a JWT access token and a JWT refresh token.</span></span> <span data-ttu-id="6c806-340">Además, Azure AD devuelve información básica sobre el usuario como, por ejemplo, el nombre para mostrar y el identificador de inquilino.</span><span class="sxs-lookup"><span data-stu-id="6c806-340">In addition, Azure AD returns basic information about the user, such as their display name and tenant ID.</span></span>
5. <span data-ttu-id="6c806-341">A través de HTTPS, la aplicación cliente usa el token de acceso de JWT devuelto para agregar la cadena JWT con una designación “Bearer” en el encabezado Authorization de la solicitud a la API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-341">Over HTTPS, the client application uses the returned JWT access token to add the JWT string with a “Bearer” designation in the Authorization header of the request to the web API.</span></span> <span data-ttu-id="6c806-342">A continuación, la API web valida el token de JWT y, si la validación es correcta, devuelve el recurso deseado.</span><span class="sxs-lookup"><span data-stu-id="6c806-342">The web API then validates the JWT token, and if validation is successful, returns the desired resource.</span></span>
6. <span data-ttu-id="6c806-343">Cuando el token de acceso expire, la aplicación cliente recibirá un mensaje de error que indica que el usuario debe volver a autenticarse.</span><span class="sxs-lookup"><span data-stu-id="6c806-343">When the access token expires, the client application will receive an error that indicates the user needs to authenticate again.</span></span> <span data-ttu-id="6c806-344">Si la aplicación tiene un token de actualización válido, puede usarse para adquirir un nuevo token de acceso sin pedir al usuario que vuelva a iniciar sesión.</span><span class="sxs-lookup"><span data-stu-id="6c806-344">If the application has a valid refresh token, it can be used to acquire a new access token without prompting the user to sign in again.</span></span> <span data-ttu-id="6c806-345">Si el token de actualización expira, será necesario que la aplicación vuelva a autenticar interactivamente al usuario.</span><span class="sxs-lookup"><span data-stu-id="6c806-345">If the refresh token expires, the application will need to interactively authenticate the user once again.</span></span>

> [!NOTE]
> <span data-ttu-id="6c806-346">El token de actualización que emite Azure AD se puede usar para obtener acceso a varios recursos.</span><span class="sxs-lookup"><span data-stu-id="6c806-346">The refresh token issued by Azure AD can be used to access multiple resources.</span></span> <span data-ttu-id="6c806-347">Por ejemplo, si tiene una aplicación cliente con permiso para llamar a dos API web, el token de actualización puede usarse para obtener también un token de acceso a la otra API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-347">For example, if you have a client application that has permission to call two web APIs, the refresh token can be used to get an access token to the other web API as well.</span></span>
> 
> 

#### <a name="code-samples"></a><span data-ttu-id="6c806-348">Ejemplos de código</span><span class="sxs-lookup"><span data-stu-id="6c806-348">Code Samples</span></span>
<span data-ttu-id="6c806-349">Vea los ejemplos de código en escenarios de aplicación nativa a API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-349">See the code samples for Native Application to Web API scenarios.</span></span> <span data-ttu-id="6c806-350">Agregamos nuevos ejemplos continuamente, así que no olvide consultarlos con frecuencia.</span><span class="sxs-lookup"><span data-stu-id="6c806-350">And, check back frequently -- we add new samples all the time.</span></span> <span data-ttu-id="6c806-351">[Aplicación nativa a API web](active-directory-code-samples.md#native-application-to-web-api).</span><span class="sxs-lookup"><span data-stu-id="6c806-351">[Native Application to Web API](active-directory-code-samples.md#native-application-to-web-api).</span></span>

#### <a name="registering"></a><span data-ttu-id="6c806-352">Registro</span><span class="sxs-lookup"><span data-stu-id="6c806-352">Registering</span></span>
* <span data-ttu-id="6c806-353">Un solo inquilino: tanto la aplicación nativa como la API web deben estar registradas en el mismo directorio de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-353">Single Tenant: Both the native application and the web API must be registered in the same directory in Azure AD.</span></span> <span data-ttu-id="6c806-354">La API web se puede configurar para que exponga un conjunto de permisos, que se usan para limitar el acceso de la aplicación nativa a sus recursos.</span><span class="sxs-lookup"><span data-stu-id="6c806-354">The web API can be configured to expose a set of permissions, which are used to limit the native application’s access to its resources.</span></span> <span data-ttu-id="6c806-355">A continuación, la aplicación cliente selecciona los permisos deseados en el menú desplegable “Permisos para otras aplicaciones” de Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="6c806-355">The client application then selects the desired permissions from the “Permissions to Other Applications” drop-down menu in the Azure Portal.</span></span>
* <span data-ttu-id="6c806-356">Multiempresa (varios inquilinos): en primer lugar, la aplicación nativa siempre se registra en el directorio del desarrollador o del editor.</span><span class="sxs-lookup"><span data-stu-id="6c806-356">Multi-Tenant: First, the native application only ever registered in the developer or publisher’s directory.</span></span> <span data-ttu-id="6c806-357">En segundo lugar, la aplicación nativa está configurada para indicar los permisos que requiere para ser funcional.</span><span class="sxs-lookup"><span data-stu-id="6c806-357">Second, the native application is configured to indicate the permissions it requires to be functional.</span></span> <span data-ttu-id="6c806-358">La lista de permisos necesarios se muestra en un cuadro de diálogo cuando un usuario o administrador del directorio de destino da su consentimiento a la aplicación, lo que la pone a disposición de la organización.</span><span class="sxs-lookup"><span data-stu-id="6c806-358">This list of required permissions is shown in a dialog when a user or administrator in the destination directory gives consent to the application, which makes it available to their organization.</span></span> <span data-ttu-id="6c806-359">Algunas aplicaciones solo requieren permisos de nivel de usuario, para los que cualquier usuario de la organización puede dar el consentimiento.</span><span class="sxs-lookup"><span data-stu-id="6c806-359">Some applications require just user-level permissions, which any user in the organization can consent to.</span></span> <span data-ttu-id="6c806-360">Otras aplicaciones requieren permisos de nivel de administrador, para los que un usuario de la organización no puede dar su consentimiento.</span><span class="sxs-lookup"><span data-stu-id="6c806-360">Other applications require administrator-level permissions, which a user in the organization cannot consent to.</span></span> <span data-ttu-id="6c806-361">Solo un administrador de directorio puede dar su consentimiento a las aplicaciones que requieran este nivel de permisos.</span><span class="sxs-lookup"><span data-stu-id="6c806-361">Only a directory administrator can give consent to applications that require this level of permissions.</span></span> <span data-ttu-id="6c806-362">Cuando el usuario o el administrador dan su consentimiento, solo la API web queda registrada en el directorio.</span><span class="sxs-lookup"><span data-stu-id="6c806-362">When the user or administrator consents, only the web API is registered in their directory.</span></span> <span data-ttu-id="6c806-363">Para obtener más información, vea [Integración de aplicaciones con Azure Active Directory](active-directory-integrating-applications.md).</span><span class="sxs-lookup"><span data-stu-id="6c806-363">For more information, see [Integrating Applications with Azure Active Directory](active-directory-integrating-applications.md).</span></span>

#### <a name="token-expiration"></a><span data-ttu-id="6c806-364">Expiración del token</span><span class="sxs-lookup"><span data-stu-id="6c806-364">Token Expiration</span></span>
<span data-ttu-id="6c806-365">Cuando la aplicación nativa usa su código de autorización para obtener un token de acceso de JWT, también recibe un token de actualización de JWT.</span><span class="sxs-lookup"><span data-stu-id="6c806-365">When the native application uses its authorization code to get a JWT access token, it also receives a JWT refresh token.</span></span> <span data-ttu-id="6c806-366">Cuando el token de acceso expira, se puede usar el token de actualización para volver a autenticar al usuario sin solicitarle que inicie sesión de nuevo.</span><span class="sxs-lookup"><span data-stu-id="6c806-366">When the access token expires, the refresh token can be used to re-authenticate the user without requiring them to sign in again.</span></span> <span data-ttu-id="6c806-367">Este token de actualización se usa a continuación para autenticar al usuario, lo que se traduce en un token de acceso y un token de actualización nuevos.</span><span class="sxs-lookup"><span data-stu-id="6c806-367">This refresh token is then used to authenticate the user, which results in a new access token and refresh token.</span></span>

### <a name="web-application-to-web-api"></a><span data-ttu-id="6c806-368">Aplicación web a API web</span><span class="sxs-lookup"><span data-stu-id="6c806-368">Web Application to Web API</span></span>
<span data-ttu-id="6c806-369">En esta sección se describe una aplicación web que necesita obtener recursos de una API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-369">This section describes a web application that needs to get resources from a web API.</span></span> <span data-ttu-id="6c806-370">En este escenario, existen dos tipos de identidad que la aplicación web puede usar para autenticar y llamar a la API web: una identidad de aplicación o una identidad de usuario delegado.</span><span class="sxs-lookup"><span data-stu-id="6c806-370">In this scenario, there are two identity types that the web application can use to authenticate and call the web API: an application identity, or a delegated user identity.</span></span>

<span data-ttu-id="6c806-371">*Identidad de aplicación:* en este escenario se usa la concesión de credenciales de cliente de OAuth 2.0 para autenticarse como aplicación y obtener acceso a la API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-371">*Application identity:* This scenario uses OAuth 2.0 client credentials grant to authenticate as the application and access the web API.</span></span> <span data-ttu-id="6c806-372">Cuando se usa una identidad de aplicación, la API web solo puede detectar que la aplicación web la llama, ya que la API web no recibe ninguna información sobre el usuario.</span><span class="sxs-lookup"><span data-stu-id="6c806-372">When using an application identity, the web API can only detect that the web application is calling it, as the web API does not receive any information about the user.</span></span> <span data-ttu-id="6c806-373">Si la aplicación recibe información sobre el usuario, se enviará mediante el protocolo de aplicación, sin la firma de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-373">If the application receives information about the user, it will be sent via the application protocol, and it is not signed by Azure AD.</span></span> <span data-ttu-id="6c806-374">La API web confía en que la aplicación web autenticó al usuario.</span><span class="sxs-lookup"><span data-stu-id="6c806-374">The web API trusts that the web application authenticated the user.</span></span> <span data-ttu-id="6c806-375">Por ello, este patrón se conoce como subsistema de confianza.</span><span class="sxs-lookup"><span data-stu-id="6c806-375">For this reason, this pattern is called a trusted subsystem.</span></span>

<span data-ttu-id="6c806-376">*Identidad de usuario delegado:* este escenario se puede conseguir de dos maneras: OpenID Connect y concesión de código de autorización OAuth 2.0 con un cliente confidencial.</span><span class="sxs-lookup"><span data-stu-id="6c806-376">*Delegated user identity:* This scenario can be accomplished in two ways: OpenID Connect, and OAuth 2.0 authorization code grant with a confidential client.</span></span> <span data-ttu-id="6c806-377">La aplicación web obtiene un token de acceso para el usuario, que demuestra a la API web que el usuario se autenticó correctamente ante la aplicación web y que la aplicación web pudo obtener una identidad de usuario delegado para llamar a la API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-377">The web application obtains an access token for the user, which proves to the web API that the user successfully authenticated to the web application and that the web application was able to obtain a delegated user identity to call the web API.</span></span> <span data-ttu-id="6c806-378">Este token de acceso se envía en la respuesta a la API web, que autoriza al usuario y devuelve el recurso deseado.</span><span class="sxs-lookup"><span data-stu-id="6c806-378">This access token is sent in the request to the web API, which authorizes the user and returns the desired resource.</span></span>

#### <a name="diagram"></a><span data-ttu-id="6c806-379">Diagrama</span><span class="sxs-lookup"><span data-stu-id="6c806-379">Diagram</span></span>
![Diagrama de aplicación web a API web](./media/active-directory-authentication-scenarios/web_app_to_web_api.png)

#### <a name="description-of-protocol-flow"></a><span data-ttu-id="6c806-381">Descripción del flujo de protocolo</span><span class="sxs-lookup"><span data-stu-id="6c806-381">Description of Protocol Flow</span></span>
<span data-ttu-id="6c806-382">Los tipos de identidad de aplicación y de identidad de usuario delegado se tratan en el flujo siguiente.</span><span class="sxs-lookup"><span data-stu-id="6c806-382">Both the application identity and delegated user identity types are discussed in the flow below.</span></span> <span data-ttu-id="6c806-383">La diferencia clave entre ambos es que la identidad de usuario delegado debe adquirir primero un código de autorización para que el usuario pueda iniciar sesión y obtener acceso a la API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-383">The key difference between them is that the delegated user identity must first acquire an authorization code before the user can sign-in and gain access to the web API.</span></span>

##### <a name="application-identity-with-oauth-20-client-credentials-grant"></a><span data-ttu-id="6c806-384">Identidad de aplicación con concesión de credenciales de cliente OAuth 2.0 </span><span class="sxs-lookup"><span data-stu-id="6c806-384">Application Identity with OAuth 2.0 Client Credentials Grant</span></span>
1. <span data-ttu-id="6c806-385">Un usuario inicia sesión en una aplicación web mediante Azure AD (vea la sección anterior [Explorador web a aplicación web](#web-browser-to-web-application) ).</span><span class="sxs-lookup"><span data-stu-id="6c806-385">A user is signed in to Azure AD in the web application (see the [Web Browser to Web Application](#web-browser-to-web-application) above).</span></span>
2. <span data-ttu-id="6c806-386">La aplicación web necesita adquirir un token de acceso para poder autenticarse ante la API web y recuperar el recurso deseado.</span><span class="sxs-lookup"><span data-stu-id="6c806-386">The web application needs to acquire an access token so that it can authenticate to the web API and retrieve the desired resource.</span></span> <span data-ttu-id="6c806-387">Realiza una solicitud al punto de conexión de token de Azure AD y proporciona las credenciales, el identificador de la aplicación y el identificador URI del identificador de aplicación de la API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-387">It makes a request to Azure AD’s token endpoint, providing the credential, Application ID, and web API’s application ID URI.</span></span>
3. <span data-ttu-id="6c806-388">Azure AD autentica la aplicación y devuelve un token de acceso de JWT que se usa para llamar a la API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-388">Azure AD authenticates the application and returns a JWT access token that is used to call the web API.</span></span>
4. <span data-ttu-id="6c806-389">A través de HTTPS, la aplicación web usa el token de acceso de JWT devuelto para agregar la cadena JWT con una designación “Bearer” en el encabezado Authorization de la solicitud a la API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-389">Over HTTPS, the web application uses the returned JWT access token to add the JWT string with a “Bearer” designation in the Authorization header of the request to the web API.</span></span> <span data-ttu-id="6c806-390">A continuación, la API web valida el token de JWT y, si la validación es correcta, devuelve el recurso deseado.</span><span class="sxs-lookup"><span data-stu-id="6c806-390">The web API then validates the JWT token, and if validation is successful, returns the desired resource.</span></span>

##### <a name="delegated-user-identity-with-openid-connect"></a><span data-ttu-id="6c806-391">Identidad de usuario delegado con OpenID Connect</span><span class="sxs-lookup"><span data-stu-id="6c806-391">Delegated User Identity with OpenID Connect</span></span>
1. <span data-ttu-id="6c806-392">Un usuario inicia sesión en una aplicación web mediante Azure AD (vea la sección anterior [Explorador web a aplicación web](#web-browser-to-web-application) ).</span><span class="sxs-lookup"><span data-stu-id="6c806-392">A user is signed in to a web application using Azure AD (see the [Web Browser to Web Application](#web-browser-to-web-application) section above).</span></span> <span data-ttu-id="6c806-393">Si el usuario de la aplicación web todavía no ha dado su consentimiento para permitir que la aplicación web llame a la API web en su nombre, el usuario tendrá que dar su consentimiento.</span><span class="sxs-lookup"><span data-stu-id="6c806-393">If the user of the web application has not yet consented to allowing the web application to call the web API on its behalf, the user will need to consent.</span></span> <span data-ttu-id="6c806-394">La aplicación mostrará los permisos que requiere y, si alguno de estos permisos es de nivel de administrador, un usuario normal del directorio no podrá dar su consentimiento.</span><span class="sxs-lookup"><span data-stu-id="6c806-394">The application will display the permissions it requires, and if any of these are administrator-level permissions, a normal user in the directory will not be able to consent.</span></span> <span data-ttu-id="6c806-395">Este proceso de consentimiento solo se aplica a las aplicaciones multiempresa (de varios inquilinos), no a las aplicaciones de un solo inquilino, puesto que la aplicación ya tendrá los permisos necesarios.</span><span class="sxs-lookup"><span data-stu-id="6c806-395">This consent process only applies to multi-tenant applications, not single tenant applications, as the application will already have the necessary permissions.</span></span> <span data-ttu-id="6c806-396">Cuando el usuario inicia sesión, la aplicación web recibe un token de identificador con información sobre el usuario, así como un código de autorización.</span><span class="sxs-lookup"><span data-stu-id="6c806-396">When the user signed in, the web application received an ID token with information about the user, as well as an authorization code.</span></span>
2. <span data-ttu-id="6c806-397">Con el código de autorización emitido por Azure AD, la aplicación web envía una solicitud al punto de conexión de token de Azure AD que incluye el código de autorización, detalles sobre la aplicación cliente (URI de redirección e identificador de la aplicación), además del recurso deseado (URI del identificador de la aplicación para la API web).</span><span class="sxs-lookup"><span data-stu-id="6c806-397">Using the authorization code issued by Azure AD, the web application sends a request to Azure AD’s token endpoint that includes the authorization code, details about the client application (Application ID and redirect URI), and the desired resource (application ID URI for the web API).</span></span>
3. <span data-ttu-id="6c806-398">Azure AD valida el código de autorización e información sobre la aplicación web y la API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-398">The authorization code and information about the web application and web API are validated by Azure AD.</span></span> <span data-ttu-id="6c806-399">Tras la correcta validación, Azure AD devuelve dos tokens: un token de acceso de JWT y un token de actualización de JWT.</span><span class="sxs-lookup"><span data-stu-id="6c806-399">Upon successful validation, Azure AD returns two tokens: a JWT access token and a JWT refresh token.</span></span>
4. <span data-ttu-id="6c806-400">A través de HTTPS, la aplicación web usa el token de acceso de JWT devuelto para agregar la cadena JWT con una designación “Bearer” en el encabezado Authorization de la solicitud a la API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-400">Over HTTPS, the web application uses the returned JWT access token to add the JWT string with a “Bearer” designation in the Authorization header of the request to the web API.</span></span> <span data-ttu-id="6c806-401">A continuación, la API web valida el token de JWT y, si la validación es correcta, devuelve el recurso deseado.</span><span class="sxs-lookup"><span data-stu-id="6c806-401">The web API then validates the JWT token, and if validation is successful, returns the desired resource.</span></span>

##### <a name="delegated-user-identity-with-oauth-20-authorization-code-grant"></a><span data-ttu-id="6c806-402">Identidad de usuario delegado con concesión de código de autorización OAuth 2.0</span><span class="sxs-lookup"><span data-stu-id="6c806-402">Delegated User Identity with OAuth 2.0 Authorization Code Grant</span></span>
1. <span data-ttu-id="6c806-403">Un usuario ya ha iniciado sesión en una aplicación web, cuyo mecanismo de autenticación es independiente de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-403">A user is already signed in to a web application, whose authentication mechanism is independent of Azure AD.</span></span>
2. <span data-ttu-id="6c806-404">La aplicación web requiere un código de autorización para adquirir un token de acceso, por lo que emite una solicitud a través del explorador al punto de conexión de autorización de Azure AD y proporciona el identificador de la aplicación y el identificador URI de redirección de la aplicación web después de la correcta autenticación.</span><span class="sxs-lookup"><span data-stu-id="6c806-404">The web application requires an authorization code to acquire an access token, so it issues a request through the browser to Azure AD’s authorization endpoint, providing the Application ID and redirect URI for the web application after successful authentication.</span></span> <span data-ttu-id="6c806-405">El usuario inicia sesión en Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-405">The user signs in to Azure AD.</span></span>
3. <span data-ttu-id="6c806-406">Si el usuario de la aplicación web todavía no ha dado su consentimiento para permitir que la aplicación web llame a la API web en su nombre, el usuario tendrá que dar su consentimiento.</span><span class="sxs-lookup"><span data-stu-id="6c806-406">If the user of the web application has not yet consented to allowing the web application to call the web API on its behalf, the user will need to consent.</span></span> <span data-ttu-id="6c806-407">La aplicación mostrará los permisos que requiere y, si alguno de estos permisos es de nivel de administrador, un usuario normal del directorio no podrá dar su consentimiento.</span><span class="sxs-lookup"><span data-stu-id="6c806-407">The application will display the permissions it requires, and if any of these are administrator-level permissions, a normal user in the directory will not be able to consent.</span></span> <span data-ttu-id="6c806-408">Este consentimiento se aplica tanto a aplicaciones de un solo inquilino como a aplicaciones multiempresa.</span><span class="sxs-lookup"><span data-stu-id="6c806-408">This consent applies to both single and multi-tenant application.</span></span>  <span data-ttu-id="6c806-409">En el caso de las aplicaciones de un solo inquilino, un administrador puede realizar una operación de consentimiento de administrador en nombre de sus usuarios.</span><span class="sxs-lookup"><span data-stu-id="6c806-409">In the single tenant case, an admin can perform admin consent to consent on behalf of their users.</span></span>  <span data-ttu-id="6c806-410">Esto puede hacerse mediante el botón `Grant Permissions` en [Azure Portal](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="6c806-410">This can be done using the `Grant Permissions` button in the [Azure Portal](https://portal.azure.com).</span></span> 
4. <span data-ttu-id="6c806-411">Una vez que el usuario haya dado su consentimiento, la aplicación web recibe el código de autorización que necesita para adquirir un token de acceso.</span><span class="sxs-lookup"><span data-stu-id="6c806-411">After the user has consented, the web application receives the authorization code that it needs to acquire an access token.</span></span>
5. <span data-ttu-id="6c806-412">Con el código de autorización emitido por Azure AD, la aplicación web envía una solicitud al punto de conexión de token de Azure AD que incluye el código de autorización, detalles sobre la aplicación cliente (URI de redirección e identificador de la aplicación), además del recurso deseado (URI del identificador de la aplicación para la API web).</span><span class="sxs-lookup"><span data-stu-id="6c806-412">Using the authorization code issued by Azure AD, the web application sends a request to Azure AD’s token endpoint that includes the authorization code, details about the client application (Application ID and redirect URI), and the desired resource (application ID URI for the web API).</span></span>
6. <span data-ttu-id="6c806-413">Azure AD valida el código de autorización e información sobre la aplicación web y la API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-413">The authorization code and information about the web application and web API are validated by Azure AD.</span></span> <span data-ttu-id="6c806-414">Tras la correcta validación, Azure AD devuelve dos tokens: un token de acceso de JWT y un token de actualización de JWT.</span><span class="sxs-lookup"><span data-stu-id="6c806-414">Upon successful validation, Azure AD returns two tokens: a JWT access token and a JWT refresh token.</span></span>
7. <span data-ttu-id="6c806-415">A través de HTTPS, la aplicación web usa el token de acceso de JWT devuelto para agregar la cadena JWT con una designación “Bearer” en el encabezado Authorization de la solicitud a la API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-415">Over HTTPS, the web application uses the returned JWT access token to add the JWT string with a “Bearer” designation in the Authorization header of the request to the web API.</span></span> <span data-ttu-id="6c806-416">A continuación, la API web valida el token de JWT y, si la validación es correcta, devuelve el recurso deseado.</span><span class="sxs-lookup"><span data-stu-id="6c806-416">The web API then validates the JWT token, and if validation is successful, returns the desired resource.</span></span>

#### <a name="code-samples"></a><span data-ttu-id="6c806-417">Ejemplos de código</span><span class="sxs-lookup"><span data-stu-id="6c806-417">Code Samples</span></span>
<span data-ttu-id="6c806-418">Vea los ejemplos de código para escenarios de aplicación web a API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-418">See the code samples for Web Application to Web API scenarios.</span></span> <span data-ttu-id="6c806-419">Agregamos nuevos ejemplos continuamente, así que no olvide consultarlos con frecuencia.</span><span class="sxs-lookup"><span data-stu-id="6c806-419">And, check back frequently -- we add new samples all the time.</span></span> <span data-ttu-id="6c806-420">[Aplicación web a API web](active-directory-code-samples.md#web-application-to-web-api).</span><span class="sxs-lookup"><span data-stu-id="6c806-420">Web [Application to Web API](active-directory-code-samples.md#web-application-to-web-api).</span></span>

#### <a name="registering"></a><span data-ttu-id="6c806-421">Registro</span><span class="sxs-lookup"><span data-stu-id="6c806-421">Registering</span></span>
* <span data-ttu-id="6c806-422">Un solo inquilino: tanto en el caso de la identidad de aplicación como en el de la identidad de usuario delegado, la aplicación web y la API web deben estar registradas en el mismo directorio de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-422">Single Tenant: For both the application identity and delegated user identity cases, the web application and the web API must be registered in the same directory in Azure AD.</span></span> <span data-ttu-id="6c806-423">La API web puede configurarse para exponer un conjunto de permisos, que se usan para limitar el acceso de la aplicación web a sus recursos.</span><span class="sxs-lookup"><span data-stu-id="6c806-423">The web API can be configured to expose a set of permissions, which are used to limit the web application’s access to its resources.</span></span> <span data-ttu-id="6c806-424">Si se usa una identidad de usuario delegado, es necesario que la aplicación web seleccione los permisos deseados en el menú desplegable “Permisos para otras aplicaciones” de Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="6c806-424">If a delegated user identity type is being used, the web application needs to select the desired permissions from the “Permissions to Other Applications” drop-down menu in the Azure Portal.</span></span> <span data-ttu-id="6c806-425">Este paso no es necesario si se usa el tipo de identidad de aplicación.</span><span class="sxs-lookup"><span data-stu-id="6c806-425">This step is not required if the application identity type is being used.</span></span>
* <span data-ttu-id="6c806-426">Multiempresa (varios inquilinos): en primer lugar, la aplicación web se configura para indicar los permisos que requiere para ser funcional.</span><span class="sxs-lookup"><span data-stu-id="6c806-426">Multi-Tenant: First, the web application is configured to indicate the permissions it requires to be functional.</span></span> <span data-ttu-id="6c806-427">La lista de permisos necesarios se muestra en un cuadro de diálogo cuando un usuario o administrador del directorio de destino da su consentimiento a la aplicación, lo que la pone a disposición de la organización.</span><span class="sxs-lookup"><span data-stu-id="6c806-427">This list of required permissions is shown in a dialog when a user or administrator in the destination directory gives consent to the application, which makes it available to their organization.</span></span> <span data-ttu-id="6c806-428">Algunas aplicaciones solo requieren permisos de nivel de usuario, para los que cualquier usuario de la organización puede dar el consentimiento.</span><span class="sxs-lookup"><span data-stu-id="6c806-428">Some applications require just user-level permissions, which any user in the organization can consent to.</span></span> <span data-ttu-id="6c806-429">Otras aplicaciones requieren permisos de nivel de administrador, para los que un usuario de la organización no puede dar su consentimiento.</span><span class="sxs-lookup"><span data-stu-id="6c806-429">Other applications require administrator-level permissions, which a user in the organization cannot consent to.</span></span> <span data-ttu-id="6c806-430">Solo un administrador de directorio puede dar su consentimiento a las aplicaciones que requieran este nivel de permisos.</span><span class="sxs-lookup"><span data-stu-id="6c806-430">Only a directory administrator can give consent to applications that require this level of permissions.</span></span> <span data-ttu-id="6c806-431">Cuando el usuario o el administrador dan su consentimiento, la aplicación web y la API web quedan registradas en el directorio.</span><span class="sxs-lookup"><span data-stu-id="6c806-431">When the user or administrator consents, the web application and the web API are both registered in their directory.</span></span>

#### <a name="token-expiration"></a><span data-ttu-id="6c806-432">Expiración del token</span><span class="sxs-lookup"><span data-stu-id="6c806-432">Token Expiration</span></span>
<span data-ttu-id="6c806-433">Cuando la aplicación web usa su código de autorización para obtener un token de acceso de JWT, también recibe un token de actualización de JWT.</span><span class="sxs-lookup"><span data-stu-id="6c806-433">When the web application uses its authorization code to get a JWT access token, it also receives a JWT refresh token.</span></span> <span data-ttu-id="6c806-434">Cuando el token de acceso expira, se puede usar el token de actualización para volver a autenticar al usuario sin solicitarle que inicie sesión de nuevo.</span><span class="sxs-lookup"><span data-stu-id="6c806-434">When the access token expires, the refresh token can be used to re-authenticate the user without requiring them to sign in again.</span></span> <span data-ttu-id="6c806-435">Este token de actualización se usa a continuación para autenticar al usuario, lo que se traduce en un token de acceso y un token de actualización nuevos.</span><span class="sxs-lookup"><span data-stu-id="6c806-435">This refresh token is then used to authenticate the user, which results in a new access token and refresh token.</span></span>

### <a name="daemon-or-server-application-to-web-api"></a><span data-ttu-id="6c806-436">Aplicación de servidor o de demonio en API web</span><span class="sxs-lookup"><span data-stu-id="6c806-436">Daemon or Server Application to Web API</span></span>
<span data-ttu-id="6c806-437">En esta sección se describe una aplicación de demonio o de servidor que necesita obtener recursos de una API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-437">This section describes a daemon or server application that needs to get resources from a web API.</span></span> <span data-ttu-id="6c806-438">Hay dos subescenarios aplicables a esta sección: un demonio que necesita llamar a una API web, basada en el tipo de concesión de credenciales de cliente OAuth 2.0, y una aplicación de servidor (como, por ejemplo, una API web) que necesita llamar a una API web, basada en la especificación provisional "On-Behalf-Of" de OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="6c806-438">There are two sub-scenarios that apply to this section: A daemon that needs to call a web API, built on OAuth 2.0 client credentials grant type; and a server application (such as a web API) that needs to call a web API, built on OAuth 2.0 On-Behalf-Of draft specification.</span></span>

<span data-ttu-id="6c806-439">Es importante entender algunos aspectos para el escenario en el que una aplicación de demonio necesita llamar a una API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-439">For the scenario when a daemon application needs to call a web API, it’s important to understand a few things.</span></span> <span data-ttu-id="6c806-440">En primer lugar, la interacción con el usuario no es posible con una aplicación de demonio, que requiere que la aplicación tenga su propia identidad.</span><span class="sxs-lookup"><span data-stu-id="6c806-440">First, user interaction is not possible with a daemon application, which requires the application to have its own identity.</span></span> <span data-ttu-id="6c806-441">Un ejemplo de aplicación de demonio es un trabajo por lotes o un servicio de sistema operativo que se ejecuta en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="6c806-441">An example of a daemon application is a batch job, or an operating system service running in the background.</span></span> <span data-ttu-id="6c806-442">Este tipo de aplicación solicita un token de acceso con su identidad de aplicación y presenta el identificador de la aplicación, las credenciales (contraseña o certificado) y el identificador URI del identificador de la aplicación a Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-442">This type of application requests an access token by using its application identity and presenting its Application ID, credential (password or certificate), and application ID URI to Azure AD.</span></span> <span data-ttu-id="6c806-443">Tras la correcta autenticación, el demonio recibe un token de acceso de Azure AD, que se usa posteriormente para llamar a la API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-443">After successful authentication, the daemon receives an access token from Azure AD, which is then used to call the web API.</span></span>

<span data-ttu-id="6c806-444">Para el escenario en el que una aplicación de servidor necesita llamar a una API web resulta útil usar un ejemplo.</span><span class="sxs-lookup"><span data-stu-id="6c806-444">For the scenario when a server application needs to call a web API, it’s helpful to use an example.</span></span> <span data-ttu-id="6c806-445">Imagine que un usuario se ha autenticado en una aplicación nativa y que la aplicación nativa necesita llamar a una API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-445">Imagine that a user has authenticated on a native application, and this native application needs to call a web API.</span></span> <span data-ttu-id="6c806-446">Azure AD emite un token de acceso de JWT para llamar a la API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-446">Azure AD issues a JWT access token to call the web API.</span></span> <span data-ttu-id="6c806-447">Si la API web necesita llamar a otra API web de nivel inferior, puede usar el flujo "On-Behalf-Of" para delegar la identidad del usuario y autenticarlo en la API web de segundo nivel.</span><span class="sxs-lookup"><span data-stu-id="6c806-447">If the web API needs to call another downstream web API, it can use the on-behalf-of flow to delegate the user’s identity and authenticate to the second-tier web API.</span></span>

#### <a name="diagram"></a><span data-ttu-id="6c806-448">Diagrama</span><span class="sxs-lookup"><span data-stu-id="6c806-448">Diagram</span></span>
![Diagrama de aplicación de servidor o de demonio en API web](./media/active-directory-authentication-scenarios/daemon_server_app_to_web_api.png)

#### <a name="description-of-protocol-flow"></a><span data-ttu-id="6c806-450">Descripción del flujo de protocolo</span><span class="sxs-lookup"><span data-stu-id="6c806-450">Description of Protocol Flow</span></span>
##### <a name="application-identity-with-oauth-20-client-credentials-grant"></a><span data-ttu-id="6c806-451">Identidad de aplicación con concesión de credenciales de cliente OAuth 2.0 </span><span class="sxs-lookup"><span data-stu-id="6c806-451">Application Identity with OAuth 2.0 Client Credentials Grant</span></span>
1. <span data-ttu-id="6c806-452">En primer lugar, la aplicación de servidor necesita autenticarse con Azure AD por sí misma, sin ninguna interacción como, por ejemplo, un cuadro de diálogo de inicio de sesión interactivo.</span><span class="sxs-lookup"><span data-stu-id="6c806-452">First, the server application needs to authenticate with Azure AD as itself, without any human interaction such as an interactive sign-on dialog.</span></span> <span data-ttu-id="6c806-453">Esta realiza una solicitud al punto de conexión de token de Azure AD y proporciona las credenciales, el identificador de la aplicación y el identificador URI del identificador de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6c806-453">It makes a request to Azure AD’s token endpoint, providing the credential, Application ID, and application ID URI.</span></span>
2. <span data-ttu-id="6c806-454">Azure AD autentica la aplicación y devuelve un token de acceso de JWT que se usa para llamar a la API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-454">Azure AD authenticates the application and returns a JWT access token that is used to call the web API.</span></span>
3. <span data-ttu-id="6c806-455">A través de HTTPS, la aplicación web usa el token de acceso de JWT devuelto para agregar la cadena JWT con una designación “Bearer” en el encabezado Authorization de la solicitud a la API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-455">Over HTTPS, the web application uses the returned JWT access token to add the JWT string with a “Bearer” designation in the Authorization header of the request to the web API.</span></span> <span data-ttu-id="6c806-456">A continuación, la API web valida el token de JWT y, si la validación es correcta, devuelve el recurso deseado.</span><span class="sxs-lookup"><span data-stu-id="6c806-456">The web API then validates the JWT token, and if validation is successful, returns the desired resource.</span></span>

##### <a name="delegated-user-identity-with-oauth-20-on-behalf-of-draft-specification"></a><span data-ttu-id="6c806-457">Identidad de usuario delegado con la especificación provisional "On-Behalf-Of" de OAuth 2.0</span><span class="sxs-lookup"><span data-stu-id="6c806-457">Delegated User Identity with OAuth 2.0 On-Behalf-Of Draft Specification</span></span>
<span data-ttu-id="6c806-458">En el flujo descrito a continuación se asume que un usuario se ha autenticado en otra aplicación (por ejemplo, una aplicación nativa) y se ha usado su identidad de usuario para adquirir un token de acceso para la API web de primer nivel.</span><span class="sxs-lookup"><span data-stu-id="6c806-458">The flow discussed below assumes that a user has been authenticated on another application (such as a native application), and their user identity has been used to acquire an access token to the first-tier web API.</span></span>

1. <span data-ttu-id="6c806-459">La aplicación nativa envía el token de acceso a la API web de primer nivel.</span><span class="sxs-lookup"><span data-stu-id="6c806-459">The native application sends the access token to the first-tier web API.</span></span>
2. <span data-ttu-id="6c806-460">La API web de primer nivel envía una solicitud al punto de conexión de token de Azure AD y proporciona el identificador de la aplicación y las credenciales, así como el token de acceso del usuario.</span><span class="sxs-lookup"><span data-stu-id="6c806-460">The first-tier web API sends a request to Azure AD’s token endpoint, providing its Application ID and credentials, as well as the user’s access token.</span></span> <span data-ttu-id="6c806-461">Además, la solicitud se envía con un parámetro on_behalf_of que indica que la API web solicita nuevos tokens para llamar a una API web de nivel inferior en nombre del usuario original.</span><span class="sxs-lookup"><span data-stu-id="6c806-461">In addition, the request is sent with an on_behalf_of parameter that indicates the web API is requesting new tokens to call a downstream web API on behalf of the original user.</span></span>
3. <span data-ttu-id="6c806-462">Azure AD comprueba que la API web de primer nivel tiene permisos de acceso a la API web de segundo nivel, valida la solicitud y devuelve un token de acceso de JWT y un token de actualización de JWT a la API web de primer nivel.</span><span class="sxs-lookup"><span data-stu-id="6c806-462">Azure AD verifies that the first-tier web API has permissions to access the second-tier web API and validates the request, returning a JWT access token and a JWT refresh token to the first-tier web API.</span></span>
4. <span data-ttu-id="6c806-463">La API web de primer nivel llama después a la API web de segundo nivel a través de HTTPS. Para ello, anexa la cadena de token en el encabezado Authorization de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="6c806-463">Over HTTPS, the first-tier web API then calls the second-tier web API by appending the token string in the Authorization header in the request.</span></span> <span data-ttu-id="6c806-464">La API web de primer nivel puede seguir llamando a la API web de segundo nivel siempre que el token de acceso y los tokens de actualización sean válidos.</span><span class="sxs-lookup"><span data-stu-id="6c806-464">The first-tier web API can continue to call the second-tier web API as long as the access token and refresh tokens are valid.</span></span>

#### <a name="code-samples"></a><span data-ttu-id="6c806-465">Ejemplos de código</span><span class="sxs-lookup"><span data-stu-id="6c806-465">Code Samples</span></span>
<span data-ttu-id="6c806-466">Vea los ejemplos de código para escenarios de aplicación de servidor o de demonio en API web.</span><span class="sxs-lookup"><span data-stu-id="6c806-466">See the code samples for Daemon or Server Application to Web API scenarios.</span></span> <span data-ttu-id="6c806-467">Agregamos nuevos ejemplos continuamente, así que no olvide consultarlos con frecuencia.</span><span class="sxs-lookup"><span data-stu-id="6c806-467">And, check back frequently -- we add new samples all the time.</span></span> [<span data-ttu-id="6c806-468">Aplicación de servidor o de demonio en API web</span><span class="sxs-lookup"><span data-stu-id="6c806-468">Server or Daemon Application to Web API</span></span>](active-directory-code-samples.md#server-or-daemon-application-to-web-api)

#### <a name="registering"></a><span data-ttu-id="6c806-469">Registro</span><span class="sxs-lookup"><span data-stu-id="6c806-469">Registering</span></span>
* <span data-ttu-id="6c806-470">Un solo inquilino: tanto en el caso de la identidad de aplicación como en el de la identidad de usuario delegado, la aplicación de demonio o de servidor debe estar registrada en el mismo directorio de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6c806-470">Single Tenant: For both the application identity and delegated user identity cases, the daemon or server application must be registered in the same directory in Azure AD.</span></span> <span data-ttu-id="6c806-471">La API web puede configurarse para exponer un conjunto de permisos, que se usan para limitar el acceso de la aplicación de demonio o de servidor a sus recursos.</span><span class="sxs-lookup"><span data-stu-id="6c806-471">The web API can be configured to expose a set of permissions, which are used to limit the daemon or server’s access to its resources.</span></span> <span data-ttu-id="6c806-472">Si se usa un tipo de identidad de usuario delegado, es necesario que la aplicación de servidor seleccione los permisos deseados en el menú desplegable “Permisos para otras aplicaciones” de Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="6c806-472">If a delegated user identity type is being used, the server application needs to select the desired permissions from the “Permissions to Other Applications” drop-down menu in the Azure Portal.</span></span> <span data-ttu-id="6c806-473">Este paso no es necesario si se usa el tipo de identidad de aplicación.</span><span class="sxs-lookup"><span data-stu-id="6c806-473">This step is not required if the application identity type is being used.</span></span>
* <span data-ttu-id="6c806-474">Multiempresa (varios inquilinos): en primer lugar, la aplicación de demonio o de servidor se configura para indicar los permisos que requiere para ser funcional.</span><span class="sxs-lookup"><span data-stu-id="6c806-474">Multi-Tenant: First, the daemon or server application is configured to indicate the permissions it requires to be functional.</span></span> <span data-ttu-id="6c806-475">La lista de permisos necesarios se muestra en un cuadro de diálogo cuando un usuario o administrador del directorio de destino da su consentimiento a la aplicación, lo que la pone a disposición de la organización.</span><span class="sxs-lookup"><span data-stu-id="6c806-475">This list of required permissions is shown in a dialog when a user or administrator in the destination directory gives consent to the application, which makes it available to their organization.</span></span> <span data-ttu-id="6c806-476">Algunas aplicaciones solo requieren permisos de nivel de usuario, para los que cualquier usuario de la organización puede dar el consentimiento.</span><span class="sxs-lookup"><span data-stu-id="6c806-476">Some applications require just user-level permissions, which any user in the organization can consent to.</span></span> <span data-ttu-id="6c806-477">Otras aplicaciones requieren permisos de nivel de administrador, para los que un usuario de la organización no puede dar su consentimiento.</span><span class="sxs-lookup"><span data-stu-id="6c806-477">Other applications require administrator-level permissions, which a user in the organization cannot consent to.</span></span> <span data-ttu-id="6c806-478">Solo un administrador de directorio puede dar su consentimiento a las aplicaciones que requieran este nivel de permisos.</span><span class="sxs-lookup"><span data-stu-id="6c806-478">Only a directory administrator can give consent to applications that require this level of permissions.</span></span> <span data-ttu-id="6c806-479">Cuando el usuario o el administrador dan su consentimiento, las dos API web se registran en el directorio.</span><span class="sxs-lookup"><span data-stu-id="6c806-479">When the user or administrator consents, both of the web APIs are registered in their directory.</span></span>

#### <a name="token-expiration"></a><span data-ttu-id="6c806-480">Expiración del token</span><span class="sxs-lookup"><span data-stu-id="6c806-480">Token Expiration</span></span>
<span data-ttu-id="6c806-481">Cuando la primera aplicación usa su código de autorización para obtener un token de acceso de JWT, también recibe un token de actualización de JWT.</span><span class="sxs-lookup"><span data-stu-id="6c806-481">When the first application uses its authorization code to get a JWT access token, it also receives a JWT refresh token.</span></span> <span data-ttu-id="6c806-482">Cuando el token de acceso expira, el token de actualización se puede usar para autenticar al usuario sin pedir credenciales.</span><span class="sxs-lookup"><span data-stu-id="6c806-482">When the access token expires, the refresh token can be used to re-authenticate the user without prompting for credentials.</span></span> <span data-ttu-id="6c806-483">Este token de actualización se usa a continuación para autenticar al usuario, lo que se traduce en un token de acceso y un token de actualización nuevos.</span><span class="sxs-lookup"><span data-stu-id="6c806-483">This refresh token is then used to authenticate the user, which results in a new access token and refresh token.</span></span>

## <a name="see-also"></a><span data-ttu-id="6c806-484">Otras referencias</span><span class="sxs-lookup"><span data-stu-id="6c806-484">See Also</span></span>
[<span data-ttu-id="6c806-485">Guía del desarrollador de Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="6c806-485">Azure Active Directory Developer's Guide</span></span>](active-directory-developers-guide.md)

[<span data-ttu-id="6c806-486">Ejemplos de código de Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="6c806-486">Azure Active Directory Code Samples</span></span>](active-directory-code-samples.md)

[<span data-ttu-id="6c806-487">Información importante acerca de la cadencia de sustitución de clave en Azure AD</span><span class="sxs-lookup"><span data-stu-id="6c806-487">Important Information About Signing Key Rollover in Azure AD</span></span>](active-directory-signing-key-rollover.md)

[<span data-ttu-id="6c806-488">OAuth 2.0 en Azure AD</span><span class="sxs-lookup"><span data-stu-id="6c806-488">OAuth 2.0 in Azure AD</span></span>](https://msdn.microsoft.com/library/azure/dn645545.aspx)


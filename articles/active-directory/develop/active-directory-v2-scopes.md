---
title: "Ámbitos, permisos y consentimiento de Azure Active Directory v2.0 | Microsoft Docs"
description: "Descripción de la autorización del punto de conexión v2.0 de Azure AD, que incluye los ámbitos, los permisos y el consentimiento."
services: active-directory
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 8f98cbf0-a71d-4e34-babf-e644ad9ff423
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/07/2017
ms.author: dastrock
ms.custom: aaddev
ms.openlocfilehash: 04869a7627ecb3e6a0d11733fae7da2ecb04ed51
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="scopes-permissions-and-consent-in-the-azure-active-directory-v20-endpoint"></a><span data-ttu-id="244f2-103">Ámbitos, permisos y consentimiento en el punto de conexión v2.0 de Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="244f2-103">Scopes, permissions, and consent in the Azure Active Directory v2.0 endpoint</span></span>
<span data-ttu-id="244f2-104">Las aplicaciones que se integran con Azure Active Directory (Azure AD) siguen un modelo de autorización que ofrece a los usuarios control sobre el modo en que una aplicación puede acceder a sus datos.</span><span class="sxs-lookup"><span data-stu-id="244f2-104">Apps that integrate with Azure Active Directory (Azure AD) follow an authorization model that gives users control over how an app can access their data.</span></span> <span data-ttu-id="244f2-105">La implementación v2.0 del modelo de implementación se ha actualizado, y cambia el modo en que una aplicación debe interactuar con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="244f2-105">The v2.0 implementation of the authorization model has been updated, and it changes how an app must interact with Azure AD.</span></span> <span data-ttu-id="244f2-106">En este artículo se tratan los conceptos básicos de este modelo de autorización, incluidos los ámbitos, los permisos y el consentimiento.</span><span class="sxs-lookup"><span data-stu-id="244f2-106">This article covers the basic concepts of this authorization model, including scopes, permissions, and consent.</span></span>

> [!NOTE]
> <span data-ttu-id="244f2-107">No todas las características y escenarios de Azure Active Directory son compatibles con la versión 2.0 del punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="244f2-107">The v2.0 endpoint does not support all Azure Active Directory scenarios and features.</span></span> <span data-ttu-id="244f2-108">Para determinar si debe usar el punto de conexión v2.0, lea acerca de las [limitaciones de esta versión](active-directory-v2-limitations.md).</span><span class="sxs-lookup"><span data-stu-id="244f2-108">To determine whether you should use the v2.0 endpoint, read about [v2.0 limitations](active-directory-v2-limitations.md).</span></span>
>
>

## <a name="scopes-and-permissions"></a><span data-ttu-id="244f2-109">Permisos y ámbitos</span><span class="sxs-lookup"><span data-stu-id="244f2-109">Scopes and permissions</span></span>
<span data-ttu-id="244f2-110">Azure AD implementa el protocolo de autorización [OAuth 2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="244f2-110">Azure AD implements the [OAuth 2.0](active-directory-v2-protocols.md) authorization protocol.</span></span> <span data-ttu-id="244f2-111">OAuth 2.0 es un método a través del cual una aplicación de terceros puede acceder a recursos hospedados en Web en nombre de un usuario.</span><span class="sxs-lookup"><span data-stu-id="244f2-111">OAuth 2.0 is a method through which a third-party app can access web-hosted resources on behalf of a user.</span></span> <span data-ttu-id="244f2-112">Cualquier recurso hospedado en Web que se integre con Azure AD tiene un identificador de recursos o *URI de id. de aplicación*.</span><span class="sxs-lookup"><span data-stu-id="244f2-112">Any web-hosted resource that integrates with Azure AD has a resource identifier, or *Application ID URI*.</span></span> <span data-ttu-id="244f2-113">Por ejemplo, algunos de los recursos de Microsoft hospedados en la web incluyen:</span><span class="sxs-lookup"><span data-stu-id="244f2-113">For example, some of Microsoft's web-hosted resources include:</span></span>

* <span data-ttu-id="244f2-114">La API de Correo unificado de Office 365: `https://outlook.office.com`</span><span class="sxs-lookup"><span data-stu-id="244f2-114">The Office 365 Unified Mail API: `https://outlook.office.com`</span></span>
* <span data-ttu-id="244f2-115">La API Graph de Azure AD: `https://graph.windows.net`</span><span class="sxs-lookup"><span data-stu-id="244f2-115">The Azure AD Graph API: `https://graph.windows.net`</span></span>
* <span data-ttu-id="244f2-116">Microsoft Graph: `https://graph.microsoft.com`</span><span class="sxs-lookup"><span data-stu-id="244f2-116">Microsoft Graph: `https://graph.microsoft.com`</span></span>

<span data-ttu-id="244f2-117">Ocurre lo mismo con cualquier recurso de terceros integrado con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="244f2-117">The same is true for any third-party resources that have integrated with Azure AD.</span></span> <span data-ttu-id="244f2-118">Cualquiera de estos recursos también puede definir un conjunto de permisos que se puede usar para dividir la funcionalidad de ese recurso en fragmentos menores.</span><span class="sxs-lookup"><span data-stu-id="244f2-118">Any of these resources also can define a set of permissions that can be used to divide the functionality of that resource into smaller chunks.</span></span> <span data-ttu-id="244f2-119">Por ejemplo, [Microsoft Graph](https://graph.microsoft.io) tiene permisos definidos para realizar, entre otras, las tareas siguientes:</span><span class="sxs-lookup"><span data-stu-id="244f2-119">As an example, [Microsoft Graph](https://graph.microsoft.io) has defined permissions to do the following tasks, among others:</span></span>

* <span data-ttu-id="244f2-120">Leer el calendario de un usuario</span><span class="sxs-lookup"><span data-stu-id="244f2-120">Read a user's calendar</span></span>
* <span data-ttu-id="244f2-121">Escribir en el calendario de un usuario</span><span class="sxs-lookup"><span data-stu-id="244f2-121">Write to a user's calendar</span></span>
* <span data-ttu-id="244f2-122">Enviar correo como un usuario</span><span class="sxs-lookup"><span data-stu-id="244f2-122">Send mail as a user</span></span>

<span data-ttu-id="244f2-123">Mediante la definición de estos tipos de permisos, el recurso tiene control específico sobre sus datos y el modo en que se exponen.</span><span class="sxs-lookup"><span data-stu-id="244f2-123">By defining these types of permissions, the resource has fine-grained control over its data and how the data is exposed.</span></span> <span data-ttu-id="244f2-124">Una aplicación de terceros puede solicitar estos permisos a un usuario de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="244f2-124">A third-party app can request these permissions from an app user.</span></span> <span data-ttu-id="244f2-125">El usuario de la aplicación debe aprobar los permisos para que la aplicación pueda actuar en su nombre.</span><span class="sxs-lookup"><span data-stu-id="244f2-125">The app user must approve the permissions before the app can act on the user's behalf.</span></span> <span data-ttu-id="244f2-126">Al fragmentar la funcionalidad del recurso en conjuntos de permisos más pequeños, se pueden crear aplicaciones de terceros para solicitar solo los permisos concretos que necesitan para realizar sus tareas.</span><span class="sxs-lookup"><span data-stu-id="244f2-126">By chunking the resource's functionality into smaller permission sets, third-party apps can be built to request only the specific permissions that they need to perform their function.</span></span> <span data-ttu-id="244f2-127">Los usuarios de la aplicación pueden saber exactamente cómo una aplicación usará sus datos, así pueden estar más seguros de que la aplicación no se comporta de forma malintencionada.</span><span class="sxs-lookup"><span data-stu-id="244f2-127">App users can know exactly how an app will use their data, and they can be more confident that the app is not behaving with malicious intent.</span></span>

<span data-ttu-id="244f2-128">En Azure AD y OAuth, estos tipos de permisos se denominan *ámbitos*.</span><span class="sxs-lookup"><span data-stu-id="244f2-128">In Azure AD and OAuth, these types of permissions are called *scopes*.</span></span> <span data-ttu-id="244f2-129">En ocasiones también se conocen como *oAuth2Permissions*.</span><span class="sxs-lookup"><span data-stu-id="244f2-129">They also sometimes are referred to as *oAuth2Permissions*.</span></span> <span data-ttu-id="244f2-130">Un ámbito se representa en Azure AD como un valor de cadena.</span><span class="sxs-lookup"><span data-stu-id="244f2-130">A scope is represented in Azure AD as a string value.</span></span> <span data-ttu-id="244f2-131">Al igual que en el ejemplo de Microsoft Graph, el valor de ámbito para cada permiso es:</span><span class="sxs-lookup"><span data-stu-id="244f2-131">Continuing with the Microsoft Graph example, the scope value for each permission is:</span></span>

* <span data-ttu-id="244f2-132">Leer el calendario de un usuario mediante `Calendar.Read`</span><span class="sxs-lookup"><span data-stu-id="244f2-132">Read a user's calendar by using `Calendar.Read`</span></span>
* <span data-ttu-id="244f2-133">Escribir en el calendario de un usuario mediante `Mail.ReadWrite`</span><span class="sxs-lookup"><span data-stu-id="244f2-133">Write to a user's calendar by using `Mail.ReadWrite`</span></span>
* <span data-ttu-id="244f2-134">Enviar correo electrónico con un usuario mediante `Mail.Send`</span><span class="sxs-lookup"><span data-stu-id="244f2-134">Send mail as a user using by `Mail.Send`</span></span>

<span data-ttu-id="244f2-135">Una aplicación puede solicitar estos permisos mediante la especificación de los ámbitos en las solicitudes al punto de conexión v2.0.</span><span class="sxs-lookup"><span data-stu-id="244f2-135">An app can request these permissions by specifying the scopes in requests to the v2.0 endpoint.</span></span>

## <a name="openid-connect-scopes"></a><span data-ttu-id="244f2-136">Ámbitos de OpenID Connect</span><span class="sxs-lookup"><span data-stu-id="244f2-136">OpenID Connect scopes</span></span>
<span data-ttu-id="244f2-137">La implementación v2.0 de OpenID Connect tiene unos cuantos ámbitos bien definidos que no se aplican a ningún recurso determinado: `openid`, `email`, `profile` y `offline_access`.</span><span class="sxs-lookup"><span data-stu-id="244f2-137">The v2.0 implementation of OpenID Connect has a few well-defined scopes that do not apply to a specific resource: `openid`, `email`, `profile`, and `offline_access`.</span></span>

### <a name="openid"></a><span data-ttu-id="244f2-138">openid</span><span class="sxs-lookup"><span data-stu-id="244f2-138">openid</span></span>
<span data-ttu-id="244f2-139">Si una aplicación realiza el inicio de sesión mediante [OpenID Connect](active-directory-v2-protocols.md), debe solicitar el ámbito `openid`.</span><span class="sxs-lookup"><span data-stu-id="244f2-139">If an app performs sign-in by using [OpenID Connect](active-directory-v2-protocols.md), it must request the `openid` scope.</span></span> <span data-ttu-id="244f2-140">El ámbito `openid` aparece en la pantalla de consentimiento de la cuenta profesional como el permiso "Sign you in" (Iniciar sesión) y en la pantalla de consentimiento de la cuenta personal de Microsoft como el permiso "View your profile and connect to apps and services using your Microsoft account" (Ver el perfil y conectarse a las aplicaciones y servicios con la cuenta de Microsoft).</span><span class="sxs-lookup"><span data-stu-id="244f2-140">The `openid` scope shows on the work account consent page as the "Sign you in" permission, and on the personal Microsoft account consent page as the "View your profile and connect to apps and services using your Microsoft account" permission.</span></span> <span data-ttu-id="244f2-141">Este permiso permite que una aplicación reciba un identificador único para el usuario en forma de la notificación `sub` .</span><span class="sxs-lookup"><span data-stu-id="244f2-141">With this permission, an app can receive a unique identifier for the user in the form of the `sub` claim.</span></span> <span data-ttu-id="244f2-142">También ofrece acceso de la aplicación al punto de conexión UserInfo.</span><span class="sxs-lookup"><span data-stu-id="244f2-142">It also gives the app access to the UserInfo endpoint.</span></span> <span data-ttu-id="244f2-143">El ámbito `openid` se puede usar en el punto de conexión del token v.2.0 para adquirir tokens de identificador que se pueden emplear para proteger las llamadas HTTP entre distintos componentes de una aplicación.</span><span class="sxs-lookup"><span data-stu-id="244f2-143">The `openid` scope can be used at the v2.0 token endpoint to acquire ID tokens, which can be used to secure HTTP calls between different components of an app.</span></span>

### <a name="email"></a><span data-ttu-id="244f2-144">email</span><span class="sxs-lookup"><span data-stu-id="244f2-144">email</span></span>
<span data-ttu-id="244f2-145">El ámbito `email` puede usarse con el ámbito `openid` y cualquier otro.</span><span class="sxs-lookup"><span data-stu-id="244f2-145">The `email` scope can be used with the `openid` scope and any others.</span></span> <span data-ttu-id="244f2-146">Proporciona acceso de la aplicación a la dirección de correo electrónico principal del usuario en forma de la notificación `email`.</span><span class="sxs-lookup"><span data-stu-id="244f2-146">It gives the app access to the user's primary email address in the form of the `email` claim.</span></span> <span data-ttu-id="244f2-147">La notificación `email` solo se incluye en los tokens si hay una dirección de correo electrónico asociada a la cuenta de usuario, que no siempre es el caso.</span><span class="sxs-lookup"><span data-stu-id="244f2-147">The `email` claim is included in a token only if an email address is associated with the user account, which is not always the case.</span></span> <span data-ttu-id="244f2-148">Si usa el ámbito `email`, la aplicación debe estar preparada para controlar los casos en los que la notificación `email` no exista en el token.</span><span class="sxs-lookup"><span data-stu-id="244f2-148">If it uses the `email` scope, your app should be prepared to handle a case in which the `email` claim does not exist in the token.</span></span>

### <a name="profile"></a><span data-ttu-id="244f2-149">Perfil</span><span class="sxs-lookup"><span data-stu-id="244f2-149">profile</span></span>
<span data-ttu-id="244f2-150">El ámbito `profile` puede usarse con el ámbito `openid` y cualquier otro.</span><span class="sxs-lookup"><span data-stu-id="244f2-150">The `profile` scope can be used with the `openid` scope and any others.</span></span> <span data-ttu-id="244f2-151">Proporciona acceso de la aplicación a una cantidad considerable de información sobre el usuario.</span><span class="sxs-lookup"><span data-stu-id="244f2-151">It gives the app access to a substantial amount of information about the user.</span></span> <span data-ttu-id="244f2-152">Por ejemplo, el nombre propio del usuario, el apellido, el nombre de usuario preferido o el id. de objeto, entre otros datos.</span><span class="sxs-lookup"><span data-stu-id="244f2-152">The information it can access includes, but is not limited to, the user's given name, surname, preferred username, and object ID.</span></span> <span data-ttu-id="244f2-153">Para ver una lista completa de las notificaciones de perfil disponibles en el parámetro id_tokens para un usuario específico, consulte la [referencia de los tokens de v2.0](active-directory-v2-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="244f2-153">For a complete list of the profile claims available in the id_tokens parameter for a specific user, see the [v2.0 tokens reference](active-directory-v2-tokens.md).</span></span>

### <a name="offlineaccess"></a><span data-ttu-id="244f2-154">offline_access</span><span class="sxs-lookup"><span data-stu-id="244f2-154">offline_access</span></span>
<span data-ttu-id="244f2-155">El ámbito [`offline_access` ](http://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess) proporciona acceso de la aplicación a recursos en nombre del usuario durante un periodo de tiempo prolongado.</span><span class="sxs-lookup"><span data-stu-id="244f2-155">The [`offline_access` scope](http://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess) gives your app access to resources on behalf of the user for an extended time.</span></span> <span data-ttu-id="244f2-156">En la página de consentimiento de la cuenta profesional, este ámbito aparecerá como el permiso "Acceder a sus datos en cualquier momento".</span><span class="sxs-lookup"><span data-stu-id="244f2-156">On the work account consent page, this scope appears as the "Access your data anytime" permission.</span></span> <span data-ttu-id="244f2-157">En la página de consentimiento de la cuenta personal de Microsoft, aparece como el permiso "Obtener acceso a tu información en cualquier momento".</span><span class="sxs-lookup"><span data-stu-id="244f2-157">On the personal Microsoft account consent page, it appears as the "Access your info anytime" permission.</span></span> <span data-ttu-id="244f2-158">Cuando un usuario aprueba el ámbito `offline_access`, la aplicación puede recibir tokens de actualización del punto de conexión del token v2.0.</span><span class="sxs-lookup"><span data-stu-id="244f2-158">When a user approves the `offline_access` scope, your app can receive refresh tokens from the v2.0 token endpoint.</span></span> <span data-ttu-id="244f2-159">Los tokens de actualización tienen una duración larga.</span><span class="sxs-lookup"><span data-stu-id="244f2-159">Refresh tokens are long-lived.</span></span> <span data-ttu-id="244f2-160">La aplicación puede obtener nuevos tokens de acceso cuando expiren los antiguos.</span><span class="sxs-lookup"><span data-stu-id="244f2-160">Your app can get new access tokens as older ones expire.</span></span>

<span data-ttu-id="244f2-161">Si la aplicación no solicita el ámbito `offline_access`, no recibirá tokens de actualización.</span><span class="sxs-lookup"><span data-stu-id="244f2-161">If your app does not request the `offline_access` scope, it won't receive refresh tokens.</span></span> <span data-ttu-id="244f2-162">Esto significa que cuando se canjea un código de autorización del [flujo del código de autorización de OAuth 2.0](active-directory-v2-protocols.md), solo se recibirá un token de acceso del punto de conexión `/token`.</span><span class="sxs-lookup"><span data-stu-id="244f2-162">This means that when you redeem an authorization code in the [OAuth 2.0 authorization code flow](active-directory-v2-protocols.md), you'll receive only an access token from the `/token` endpoint.</span></span> <span data-ttu-id="244f2-163">El token de acceso es válido durante un breve período de tiempo.</span><span class="sxs-lookup"><span data-stu-id="244f2-163">The access token is valid for a short time.</span></span> <span data-ttu-id="244f2-164">Normalmente, expira al cabo de una hora.</span><span class="sxs-lookup"><span data-stu-id="244f2-164">The access token usually expires in one hour.</span></span> <span data-ttu-id="244f2-165">En ese momento, la aplicación tiene que redirigir al usuario de vuelta al punto de conexión `/authorize` para que obtenga un nuevo código de autorización.</span><span class="sxs-lookup"><span data-stu-id="244f2-165">At that point, your app needs to redirect the user back to the `/authorize` endpoint to get a new authorization code.</span></span> <span data-ttu-id="244f2-166">Durante esta redirección y, en función del tipo de aplicación, puede que el usuario tenga que volver a escribir sus credenciales o dar de nuevo el consentimiento a permisos.</span><span class="sxs-lookup"><span data-stu-id="244f2-166">During this redirect, depending on the type of app, the user might need to enter their credentials again or consent again to permissions.</span></span>

<span data-ttu-id="244f2-167">Para más información sobre cómo obtener y usar tokens de actualización, consulte la [referencia del protocolo v2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="244f2-167">For more information about how to get and use refresh tokens, see the [v2.0 protocol reference](active-directory-v2-protocols.md).</span></span>

## <a name="requesting-individual-user-consent"></a><span data-ttu-id="244f2-168">Solicitud de consentimiento de usuario individual</span><span class="sxs-lookup"><span data-stu-id="244f2-168">Requesting individual user consent</span></span>
<span data-ttu-id="244f2-169">En una solicitud de autorización de [OpenID Connect o OAuth 2.0](active-directory-v2-protocols.md), una aplicación puede solicitar los permisos que necesita mediante el parámetro de consulta `scope`.</span><span class="sxs-lookup"><span data-stu-id="244f2-169">In an [OpenID Connect or OAuth 2.0](active-directory-v2-protocols.md) authorization request, an app can request the permissions it needs by using the `scope` query parameter.</span></span> <span data-ttu-id="244f2-170">Por ejemplo, cuando un usuario inicia sesión en una aplicación, la aplicación envía una solicitud como la del ejemplo siguiente (se han agregado saltos de línea para una mayor legibilidad):</span><span class="sxs-lookup"><span data-stu-id="244f2-170">For example, when a user signs in to an app, the app sends a request like the following example (with line breaks added for legibility):</span></span>

```
GET https://login.microsoftonline.com/common/oauth2/v2.0/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&response_type=code
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&response_mode=query
&scope=
https%3A%2F%2Fgraph.microsoft.com%2Fcalendar.read%20
https%3A%2F%2Fgraph.microsoft.com%2Fmail.send
&state=12345
```

<span data-ttu-id="244f2-171">El parámetro `scope` es una lista separada por espacios que incluye los ámbitos que solicita la aplicación.</span><span class="sxs-lookup"><span data-stu-id="244f2-171">The `scope` parameter is a space-separated list of scopes that the app is requesting.</span></span> <span data-ttu-id="244f2-172">Cada ámbito individual se indica anexando el valor del ámbito al identificador del recurso (URI del id. de aplicación).</span><span class="sxs-lookup"><span data-stu-id="244f2-172">Each scope is indicated by appending the scope value to the resource's identifier (the Application ID URI).</span></span> <span data-ttu-id="244f2-173">En la solicitud de ejemplo, la aplicación necesita permiso para leer el calendario del usuario y enviar correo electrónico en nombre del usuario.</span><span class="sxs-lookup"><span data-stu-id="244f2-173">In the request example, the app needs permission to read the user's calendar and send mail as the user.</span></span>

<span data-ttu-id="244f2-174">Después de que el usuario escribe sus credenciales, el punto de conexión v2.0 busca un registro que coincida con el *consentimiento del usuario*.</span><span class="sxs-lookup"><span data-stu-id="244f2-174">After the user enters their credentials, the v2.0 endpoint checks for a matching record of *user consent*.</span></span> <span data-ttu-id="244f2-175">Si el usuario no ha dado su consentimiento a ninguno de los permisos solicitados en el pasado, el punto de conexión v2.0 le pide al usuario que conceda los permisos solicitados.</span><span class="sxs-lookup"><span data-stu-id="244f2-175">If the user has not consented to any of the requested permissions in the past, the v2.0 endpoint asks the user to grant the requested permissions.</span></span>

![Consentimiento de la cuenta de trabajo](../../media/active-directory-v2-flows/work_account_consent.png)

<span data-ttu-id="244f2-177">Cuando el usuario aprueba el permiso, el consentimiento se registra, así el usuario no tiene que volver a dar su consentimiento en los sucesivos inicios de sesión.</span><span class="sxs-lookup"><span data-stu-id="244f2-177">When the user approves the permission, the consent is recorded so that the user doesn't have to consent again on subsequent account sign-ins.</span></span>

## <a name="requesting-consent-for-an-entire-tenant"></a><span data-ttu-id="244f2-178">Solicitud de consentimiento para un inquilino al completo</span><span class="sxs-lookup"><span data-stu-id="244f2-178">Requesting consent for an entire tenant</span></span>
<span data-ttu-id="244f2-179">A menudo, cuando una organización adquiere una licencia o una suscripción de una aplicación, quiere aprovisionar totalmente la aplicación para sus empleados.</span><span class="sxs-lookup"><span data-stu-id="244f2-179">Often, when an organization purchases a license or subscription for an application, the organization wants to fully provision the application for its employees.</span></span> <span data-ttu-id="244f2-180">Como parte de este proceso, el administrador puede conceder consentimiento a la aplicación para que actúe en nombre de cualquier empleado.</span><span class="sxs-lookup"><span data-stu-id="244f2-180">As part of this process, an administrator can grant consent for the application to act on behalf of any employee.</span></span> <span data-ttu-id="244f2-181">Si el administrador concede el consentimiento del inquilino entero, los empleados de la organización no verán una página de consentimiento para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="244f2-181">If the admin grants consent for the entire tenant, the organization's employees won't see a consent page for the application.</span></span>

<span data-ttu-id="244f2-182">Para solicitar el consentimiento de todos los usuarios de un inquilino, la aplicación puede usar el punto de conexión de consentimiento del administrador.</span><span class="sxs-lookup"><span data-stu-id="244f2-182">To request consent for all users in a tenant, your app can use the admin consent endpoint.</span></span>

## <a name="admin-restricted-scopes"></a><span data-ttu-id="244f2-183">Ámbitos restringidos para los administradores</span><span class="sxs-lookup"><span data-stu-id="244f2-183">Admin-restricted scopes</span></span>
<span data-ttu-id="244f2-184">Algunos permisos de privilegios elevados del ecosistema de Microsoft se pueden establecer en *restringido para los administradores*.</span><span class="sxs-lookup"><span data-stu-id="244f2-184">Some high-privilege permissions in the Microsoft ecosystem can be set to *admin-restricted*.</span></span> <span data-ttu-id="244f2-185">Algunos ejemplos de estos tipos de ámbitos son los siguientes permisos:</span><span class="sxs-lookup"><span data-stu-id="244f2-185">Examples of these kinds of scopes include the following permissions:</span></span>

* <span data-ttu-id="244f2-186">Leer datos del directorio de una organización mediante `Directory.Read`</span><span class="sxs-lookup"><span data-stu-id="244f2-186">Read an organization's directory data by using `Directory.Read`</span></span>
* <span data-ttu-id="244f2-187">Escribir datos en el directorio de una organización mediante `Directory.ReadWrite`</span><span class="sxs-lookup"><span data-stu-id="244f2-187">Write data to an organization's directory by using `Directory.ReadWrite`</span></span>
* <span data-ttu-id="244f2-188">Leer grupos de seguridad del directorio de una organización mediante: `Groups.Read.All`</span><span class="sxs-lookup"><span data-stu-id="244f2-188">Read security groups in an organization's directory by using `Groups.Read.All`</span></span>

<span data-ttu-id="244f2-189">Aunque un usuario consumidor podría conceder acceso de la aplicación a este tipo de datos, los usuarios de la organización tienen la restricción de no conceder acceso al mismo conjunto de datos confidenciales de la empresa.</span><span class="sxs-lookup"><span data-stu-id="244f2-189">Although a consumer user might grant an application access to this kind of data, organizational users are restricted from granting access to the same set of sensitive company data.</span></span> <span data-ttu-id="244f2-190">Si la aplicación solicita acceso a uno de estos permisos desde un usuario de la organización, el usuario recibe un mensaje de error que indica que no está autorizado para dar el consentimiento a los permisos de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="244f2-190">If your application requests access to one of these permissions from an organizational user, the user receives an error message that says they are not authorized to consent to your app's permissions.</span></span>

<span data-ttu-id="244f2-191">Si la aplicación necesita acceso a los ámbitos restringidos para los administradores en una organización, debe solicitarlos directamente a un administrador de la empresa, también mediante el punto de conexión de consentimiento del administrador, que se describe a continuación.</span><span class="sxs-lookup"><span data-stu-id="244f2-191">If your app requires access to admin-restricted scopes for organizations, you should request them directly from a company administrator, also by using the admin consent endpoint, described next.</span></span>

<span data-ttu-id="244f2-192">Cuando un administrador concede estos permisos mediante el punto de conexión de consentimiento del administrador, el consentimiento se concede a todos los usuarios del inquilino.</span><span class="sxs-lookup"><span data-stu-id="244f2-192">When an administrator grants these permissions via the admin consent endpoint, consent is granted for all users in the tenant.</span></span>

## <a name="using-the-admin-consent-endpoint"></a><span data-ttu-id="244f2-193">Uso del punto de conexión de consentimiento del administrador</span><span class="sxs-lookup"><span data-stu-id="244f2-193">Using the admin consent endpoint</span></span>
<span data-ttu-id="244f2-194">Si sigue estos pasos, la aplicación puede recopilar permisos para todos los usuarios de un inquilino, incluidos los ámbitos restringido para los administradores.</span><span class="sxs-lookup"><span data-stu-id="244f2-194">If you follow these steps, your app can gather permissions for all users in a tenant, including admin-restricted scopes.</span></span> <span data-ttu-id="244f2-195">Para ver un ejemplo de código que implementa lo pasos, consulte el [ejemplo de ámbitos restringidos para los administradores](https://github.com/Azure-Samples/active-directory-dotnet-admin-restricted-scopes-v2).</span><span class="sxs-lookup"><span data-stu-id="244f2-195">To see a code sample that implements the steps, see the [admin-restricted scopes sample](https://github.com/Azure-Samples/active-directory-dotnet-admin-restricted-scopes-v2).</span></span>

### <a name="request-the-permissions-in-the-app-registration-portal"></a><span data-ttu-id="244f2-196">Solicitud de los permisos en el portal de registro de aplicaciones</span><span class="sxs-lookup"><span data-stu-id="244f2-196">Request the permissions in the app registration portal</span></span>
1. <span data-ttu-id="244f2-197">Vaya a la aplicación en el [Portal de registro de aplicaciones](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) o [cree una aplicación](active-directory-v2-app-registration.md), si todavía no tiene una.</span><span class="sxs-lookup"><span data-stu-id="244f2-197">Go to your application in the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList), or [create an app](active-directory-v2-app-registration.md) if you haven't already.</span></span>
2. <span data-ttu-id="244f2-198">Busque la sección de **permisos de Microsoft Graph** y agregue los permisos que necesite la aplicación.</span><span class="sxs-lookup"><span data-stu-id="244f2-198">Locate the **Microsoft Graph Permissions** section, and then add the permissions that your app requires.</span></span>
3. <span data-ttu-id="244f2-199">No olvide **guardar** el registro de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="244f2-199">Make sure you **Save** the app registration.</span></span>

### <a name="recommended-sign-the-user-in-to-your-app"></a><span data-ttu-id="244f2-200">Recomendación: inicie la sesión del usuario en la aplicación</span><span class="sxs-lookup"><span data-stu-id="244f2-200">Recommended: Sign the user in to your app</span></span>
<span data-ttu-id="244f2-201">Normalmente, cuando se compila una aplicación que usa el punto de conexión de consentimiento del administrador, la aplicación necesita una página o una vista en la que el administrador pueda aprobar los permisos de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="244f2-201">Typically, when you build an application that uses the admin consent endpoint, the app needs a page or view in which the admin can approve the app's permissions.</span></span> <span data-ttu-id="244f2-202">Esta página puede ser parte del flujo de inicio de sesión de la aplicación o de la configuración de la aplicación, o bien puede ser un flujo de "conexión" dedicado.</span><span class="sxs-lookup"><span data-stu-id="244f2-202">This page can be part of the app's sign-up flow, part of the app's settings, or it can be a dedicated "connect" flow.</span></span> <span data-ttu-id="244f2-203">En muchos casos, tiene sentido que la aplicación muestre esta vista de conexión solo después de que un usuario haya iniciado sesión con una cuenta Microsoft profesional o educativa.</span><span class="sxs-lookup"><span data-stu-id="244f2-203">In many cases, it makes sense for the app to show this "connect" view only after a user has signed in with a work or school Microsoft account.</span></span>

<span data-ttu-id="244f2-204">Cuando inicia la sesión del usuario en la aplicación, puede identificar la organización a la que pertenece el administrador antes de pedirle que apruebe los permisos necesarios.</span><span class="sxs-lookup"><span data-stu-id="244f2-204">When you sign the user in to your app, you can identify the organization to which the admin belongs before asking them to approve the necessary permissions.</span></span> <span data-ttu-id="244f2-205">Aunque no es estrictamente necesario, puede ayudarle a crear una experiencia más intuitiva para los usuarios de la organización.</span><span class="sxs-lookup"><span data-stu-id="244f2-205">Although not strictly necessary, it can help you create a more intuitive experience for your organizational users.</span></span> <span data-ttu-id="244f2-206">Para iniciar la sesión del usuario, siga nuestros [tutoriales del protocolo de la versión 2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="244f2-206">To sign the user in, follow our [v2.0 protocol tutorials](active-directory-v2-protocols.md).</span></span>

### <a name="request-the-permissions-from-a-directory-admin"></a><span data-ttu-id="244f2-207">Solicitud de los permisos de un administrador de directorios</span><span class="sxs-lookup"><span data-stu-id="244f2-207">Request the permissions from a directory admin</span></span>
<span data-ttu-id="244f2-208">Cuando esté listo para solicitar permisos al administrador de la organización, puede redirigir al usuario al *punto de conexión de consentimiento del administrador* v2.0.</span><span class="sxs-lookup"><span data-stu-id="244f2-208">When you're ready to request permissions from your organization's admin, you can redirect the user to the v2.0 *admin consent endpoint*.</span></span>

```
// Line breaks are for legibility only.

GET https://login.microsoftonline.com/{tenant}/adminconsent?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&state=12345
&redirect_uri=http://localhost/myapp/permissions
```

```
// Pro tip: Try pasting the below request in a browser!
```

```
https://login.microsoftonline.com/common/adminconsent?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&state=12345&redirect_uri=http://localhost/myapp/permissions
```

| <span data-ttu-id="244f2-209">Parámetro</span><span class="sxs-lookup"><span data-stu-id="244f2-209">Parameter</span></span> | <span data-ttu-id="244f2-210">Condición</span><span class="sxs-lookup"><span data-stu-id="244f2-210">Condition</span></span> | <span data-ttu-id="244f2-211">Descripción</span><span class="sxs-lookup"><span data-stu-id="244f2-211">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="244f2-212">tenant</span><span class="sxs-lookup"><span data-stu-id="244f2-212">tenant</span></span> |<span data-ttu-id="244f2-213">Obligatorio</span><span class="sxs-lookup"><span data-stu-id="244f2-213">Required</span></span> |<span data-ttu-id="244f2-214">El inquilino de directorio al que quiere solicitar permiso.</span><span class="sxs-lookup"><span data-stu-id="244f2-214">The directory tenant that you want to request permission from.</span></span> <span data-ttu-id="244f2-215">Se puede proporcionar en formato de nombre descriptivo o GUID.</span><span class="sxs-lookup"><span data-stu-id="244f2-215">Can be provided in GUID or friendly name format.</span></span> |
| <span data-ttu-id="244f2-216">client_id</span><span class="sxs-lookup"><span data-stu-id="244f2-216">client_id</span></span> |<span data-ttu-id="244f2-217">Obligatorio</span><span class="sxs-lookup"><span data-stu-id="244f2-217">Required</span></span> |<span data-ttu-id="244f2-218">El identificador de aplicación que el [portal de registro de aplicaciones](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) asignó a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="244f2-218">The Application ID that the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) assigned to your app.</span></span> |
| <span data-ttu-id="244f2-219">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="244f2-219">redirect_uri</span></span> |<span data-ttu-id="244f2-220">Obligatorio</span><span class="sxs-lookup"><span data-stu-id="244f2-220">Required</span></span> |<span data-ttu-id="244f2-221">El URI de redirección adonde desea que se envíe la respuesta para que la controle la aplicación.</span><span class="sxs-lookup"><span data-stu-id="244f2-221">The redirect URI where you want the response to be sent for your app to handle.</span></span> <span data-ttu-id="244f2-222">Debe coincidir exactamente con uno de los identificadores URI de redirección que registró el Portal de registro de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="244f2-222">It must exactly match one of the redirect URIs that you registered in the app registration portal.</span></span> |
| <span data-ttu-id="244f2-223">state</span><span class="sxs-lookup"><span data-stu-id="244f2-223">state</span></span> |<span data-ttu-id="244f2-224">Recomendado</span><span class="sxs-lookup"><span data-stu-id="244f2-224">Recommended</span></span> |<span data-ttu-id="244f2-225">Un valor incluido en la solicitud que se devolverá también en la respuesta del token.</span><span class="sxs-lookup"><span data-stu-id="244f2-225">A value included in the request that will also be returned in the token response.</span></span> <span data-ttu-id="244f2-226">Puede ser una cadena de cualquier contenido que desee.</span><span class="sxs-lookup"><span data-stu-id="244f2-226">It can be a string of any content you want.</span></span> <span data-ttu-id="244f2-227">Use el estado para codificar información sobre el estado del usuario en la aplicación antes de que se produzca la solicitud de autenticación, por ejemplo, la página o vista en la que estaba.</span><span class="sxs-lookup"><span data-stu-id="244f2-227">Use the state to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span></span> |

<span data-ttu-id="244f2-228">En este momento, Azure AD requiere que un administrador de inquilinos inicie sesión para completar la solicitud.</span><span class="sxs-lookup"><span data-stu-id="244f2-228">At this point, Azure AD requires a tenant administrator to sign in to complete the request.</span></span> <span data-ttu-id="244f2-229">Se pedirá al administrador que apruebe todos los permisos que ha solicitado para la aplicación en el Portal de registro de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="244f2-229">The administrator is asked to approve all the permissions that you have requested for your app in the app registration portal.</span></span>

#### <a name="successful-response"></a><span data-ttu-id="244f2-230">Respuesta correcta</span><span class="sxs-lookup"><span data-stu-id="244f2-230">Successful response</span></span>
<span data-ttu-id="244f2-231">Si el administrador aprueba los permisos para la aplicación, la respuesta correcta tendrá un aspecto similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="244f2-231">If the admin approves the permissions for your app, the successful response looks like this:</span></span>

```
GET http://localhost/myapp/permissions?tenant=a8990e1f-ff32-408a-9f8e-78d3b9139b95&state=state=12345&admin_consent=True
```

| <span data-ttu-id="244f2-232">Parámetro</span><span class="sxs-lookup"><span data-stu-id="244f2-232">Parameter</span></span> | <span data-ttu-id="244f2-233">Description</span><span class="sxs-lookup"><span data-stu-id="244f2-233">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="244f2-234">tenant</span><span class="sxs-lookup"><span data-stu-id="244f2-234">tenant</span></span> |<span data-ttu-id="244f2-235">El inquilino del directorio que concedió los permisos solicitados, en formato GUID.</span><span class="sxs-lookup"><span data-stu-id="244f2-235">The directory tenant that granted your application the permissions it requested, in GUID format.</span></span> |
| <span data-ttu-id="244f2-236">state</span><span class="sxs-lookup"><span data-stu-id="244f2-236">state</span></span> |<span data-ttu-id="244f2-237">Un valor incluido en la solicitud que también se devolverá en la respuesta del token.</span><span class="sxs-lookup"><span data-stu-id="244f2-237">A value included in the request that also will be returned in the token response.</span></span> <span data-ttu-id="244f2-238">Puede ser una cadena de cualquier contenido que desee.</span><span class="sxs-lookup"><span data-stu-id="244f2-238">It can be a string of any content you want.</span></span> <span data-ttu-id="244f2-239">El estado se usa para codificar información sobre el estado del usuario en la aplicación antes de que se haya producido la solicitud de autenticación, por ejemplo, la página o vista en la que estaban.</span><span class="sxs-lookup"><span data-stu-id="244f2-239">The state is used to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span></span> |
| <span data-ttu-id="244f2-240">admin_consent</span><span class="sxs-lookup"><span data-stu-id="244f2-240">admin_consent</span></span> |<span data-ttu-id="244f2-241">Se establecerá en **true**.</span><span class="sxs-lookup"><span data-stu-id="244f2-241">Will be set to **true**.</span></span> |

#### <a name="error-response"></a><span data-ttu-id="244f2-242">Respuesta de error</span><span class="sxs-lookup"><span data-stu-id="244f2-242">Error response</span></span>
<span data-ttu-id="244f2-243">Si el administrador no aprueba los permisos de la aplicación, la respuesta de error tendrá el aspecto siguiente:</span><span class="sxs-lookup"><span data-stu-id="244f2-243">If the admin does not approve the permissions for your app, the failed response looks like this:</span></span>

```
GET http://localhost/myapp/permissions?error=permission_denied&error_description=The+admin+canceled+the+request
```

| <span data-ttu-id="244f2-244">Parámetro</span><span class="sxs-lookup"><span data-stu-id="244f2-244">Parameter</span></span> | <span data-ttu-id="244f2-245">Description</span><span class="sxs-lookup"><span data-stu-id="244f2-245">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="244f2-246">error</span><span class="sxs-lookup"><span data-stu-id="244f2-246">error</span></span> |<span data-ttu-id="244f2-247">Una cadena de código de error que puede utilizarse para clasificar los tipos de errores que se producen y para reaccionar ante ellos.</span><span class="sxs-lookup"><span data-stu-id="244f2-247">An error code string that can be used to classify types of errors that occur, and can be used to react to errors.</span></span> |
| <span data-ttu-id="244f2-248">error_description</span><span class="sxs-lookup"><span data-stu-id="244f2-248">error_description</span></span> |<span data-ttu-id="244f2-249">Un mensaje de error específico que puede ayudar a un desarrollador a identificar la causa de un error.</span><span class="sxs-lookup"><span data-stu-id="244f2-249">A specific error message that can help a developer identify the root cause of an error.</span></span> |

<span data-ttu-id="244f2-250">Cuando haya recibido una respuesta correcta del punto de conexión de consentimiento del administrador, la aplicación habrá obtenido los permisos solicitados.</span><span class="sxs-lookup"><span data-stu-id="244f2-250">After you've received a successful response from the admin consent endpoint, your app has gained the permissions it requested.</span></span> <span data-ttu-id="244f2-251">Ahora puede solicitar un token para el recurso que desee.</span><span class="sxs-lookup"><span data-stu-id="244f2-251">Next, you can request a token for the resource you want.</span></span>

## <a name="using-permissions"></a><span data-ttu-id="244f2-252">Uso de permisos</span><span class="sxs-lookup"><span data-stu-id="244f2-252">Using permissions</span></span>
<span data-ttu-id="244f2-253">Después de que el usuario da su consentimiento para los permisos de la aplicación, la aplicación puede obtener tokens de acceso que representan los permisos de la aplicación para acceder a un recurso de alguna manera.</span><span class="sxs-lookup"><span data-stu-id="244f2-253">After the user consents to permissions for your app, your app can acquire access tokens that represent your app's permission to access a resource in some capacity.</span></span> <span data-ttu-id="244f2-254">Un token de acceso solo se puede usar para un recurso, pero dentro del token de acceso están todos los permisos codificados que se han concedido a la aplicación para ese recurso.</span><span class="sxs-lookup"><span data-stu-id="244f2-254">An access token can be used only for a single resource, but encoded inside the access token is every permission that your app has been granted for that resource.</span></span> <span data-ttu-id="244f2-255">Para adquirir un token de acceso, la aplicación puede realizar una solicitud al punto de conexión del token v2.0, como esta:</span><span class="sxs-lookup"><span data-stu-id="244f2-255">To acquire an access token, your app can make a request to the v2.0 token endpoint, like this:</span></span>

```
POST common/oauth2/v2.0/token HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/json

{
    "grant_type": "authorization_code",
    "client_id": "6731de76-14a6-49ae-97bc-6eba6914391e",
    "scope": "https://outlook.office.com/mail.read https://outlook.office.com/mail.send",
    "code": "AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq..."
    "redirect_uri": "https://localhost/myapp",
    "client_secret": "zc53fwe80980293klaj9823"  // NOTE: Only required for web apps
}
```

<span data-ttu-id="244f2-256">Puede usar el token de acceso resultante en las solicitudes HTTP al recurso.</span><span class="sxs-lookup"><span data-stu-id="244f2-256">You can use the resulting access token in HTTP requests to the resource.</span></span> <span data-ttu-id="244f2-257">Dicho token indica al recurso de forma confiable que la aplicación tiene el permiso apropiado para realizar una tarea específica.</span><span class="sxs-lookup"><span data-stu-id="244f2-257">It reliably indicates to the resource that your app has the proper permission to perform a specific task.</span></span>  

<span data-ttu-id="244f2-258">Para más información sobre el protocolo OAuth 2.0 y cómo obtener tokens de acceso, consulte la [referencia de protocolo del punto de conexión v2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="244f2-258">For more information about the OAuth 2.0 protocol and how to get access tokens, see the [v2.0 endpoint protocol reference](active-directory-v2-protocols.md).</span></span>

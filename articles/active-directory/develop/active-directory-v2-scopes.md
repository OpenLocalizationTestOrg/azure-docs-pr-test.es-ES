---
title: "aaaAzure Active Directory v2.0 ámbitos, los permisos y consentimiento | Documentos de Microsoft"
description: "Una descripción de la autorización en el punto de conexión de v2.0 de hello Azure AD, incluidos los ámbitos, los permisos y consentimiento."
services: active-directory
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 8f98cbf0-a71d-4e34-babf-e644ad9ff423
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/07/2017
ms.author: dastrock
ms.custom: aaddev
ms.openlocfilehash: 5721d368c435868bfb4ae91cff7fbb9bc4a79b66
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="scopes-permissions-and-consent-in-hello-azure-active-directory-v20-endpoint"></a><span data-ttu-id="c3898-103">Ámbitos, permisos y consentimiento en el punto de conexión de hello Azure Active Directory v2.0</span><span class="sxs-lookup"><span data-stu-id="c3898-103">Scopes, permissions, and consent in hello Azure Active Directory v2.0 endpoint</span></span>
<span data-ttu-id="c3898-104">Las aplicaciones que se integran con Azure Active Directory (Azure AD) siguen un modelo de autorización que ofrece a los usuarios control sobre el modo en que una aplicación puede acceder a sus datos.</span><span class="sxs-lookup"><span data-stu-id="c3898-104">Apps that integrate with Azure Active Directory (Azure AD) follow an authorization model that gives users control over how an app can access their data.</span></span> <span data-ttu-id="c3898-105">se ha actualizado la implementación de Hello v2.0 de modelo de autorización de hello, y se cambia cómo una aplicación debe interactuar con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c3898-105">hello v2.0 implementation of hello authorization model has been updated, and it changes how an app must interact with Azure AD.</span></span> <span data-ttu-id="c3898-106">Este artículo tratan los conceptos básicos de este modelo de autorización, incluidos los ámbitos, los permisos y consentimiento Hola.</span><span class="sxs-lookup"><span data-stu-id="c3898-106">This article covers hello basic concepts of this authorization model, including scopes, permissions, and consent.</span></span>

> [!NOTE]
> <span data-ttu-id="c3898-107">el punto de conexión de Hello v2.0 no admite todas las características y escenarios de Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c3898-107">hello v2.0 endpoint does not support all Azure Active Directory scenarios and features.</span></span> <span data-ttu-id="c3898-108">toodetermine si debe utilizar Hola v2.0 extremo, que conozca [v2.0 limitaciones](active-directory-v2-limitations.md).</span><span class="sxs-lookup"><span data-stu-id="c3898-108">toodetermine whether you should use hello v2.0 endpoint, read about [v2.0 limitations](active-directory-v2-limitations.md).</span></span>
>
>

## <a name="scopes-and-permissions"></a><span data-ttu-id="c3898-109">Permisos y ámbitos</span><span class="sxs-lookup"><span data-stu-id="c3898-109">Scopes and permissions</span></span>
<span data-ttu-id="c3898-110">Azure AD implementa hello [OAuth 2.0](active-directory-v2-protocols.md) protocolo de autorización.</span><span class="sxs-lookup"><span data-stu-id="c3898-110">Azure AD implements hello [OAuth 2.0](active-directory-v2-protocols.md) authorization protocol.</span></span> <span data-ttu-id="c3898-111">OAuth 2.0 es un método a través del cual una aplicación de terceros puede acceder a recursos hospedados en Web en nombre de un usuario.</span><span class="sxs-lookup"><span data-stu-id="c3898-111">OAuth 2.0 is a method through which a third-party app can access web-hosted resources on behalf of a user.</span></span> <span data-ttu-id="c3898-112">Cualquier recurso hospedado en Web que se integre con Azure AD tiene un identificador de recursos o *URI de id. de aplicación*.</span><span class="sxs-lookup"><span data-stu-id="c3898-112">Any web-hosted resource that integrates with Azure AD has a resource identifier, or *Application ID URI*.</span></span> <span data-ttu-id="c3898-113">Por ejemplo, algunos de los recursos de Microsoft hospedados en la web incluyen:</span><span class="sxs-lookup"><span data-stu-id="c3898-113">For example, some of Microsoft's web-hosted resources include:</span></span>

* <span data-ttu-id="c3898-114">Hola API de correo electrónico unificado de Office 365:`https://outlook.office.com`</span><span class="sxs-lookup"><span data-stu-id="c3898-114">hello Office 365 Unified Mail API: `https://outlook.office.com`</span></span>
* <span data-ttu-id="c3898-115">Hola API de Azure AD Graph:`https://graph.windows.net`</span><span class="sxs-lookup"><span data-stu-id="c3898-115">hello Azure AD Graph API: `https://graph.windows.net`</span></span>
* <span data-ttu-id="c3898-116">Microsoft Graph: `https://graph.microsoft.com`</span><span class="sxs-lookup"><span data-stu-id="c3898-116">Microsoft Graph: `https://graph.microsoft.com`</span></span>

<span data-ttu-id="c3898-117">Hola que mismo puede decirse de los recursos de terceros que se han integrado con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c3898-117">hello same is true for any third-party resources that have integrated with Azure AD.</span></span> <span data-ttu-id="c3898-118">Cualquiera de estos recursos también puede definir un conjunto de permisos que pueden ser utilizados toodivide Hola funcionalidad de ese recurso en fragmentos menores.</span><span class="sxs-lookup"><span data-stu-id="c3898-118">Any of these resources also can define a set of permissions that can be used toodivide hello functionality of that resource into smaller chunks.</span></span> <span data-ttu-id="c3898-119">Por ejemplo, [Microsoft Graph](https://graph.microsoft.io) definió Hola de toodo permisos después de tareas, entre otros:</span><span class="sxs-lookup"><span data-stu-id="c3898-119">As an example, [Microsoft Graph](https://graph.microsoft.io) has defined permissions toodo hello following tasks, among others:</span></span>

* <span data-ttu-id="c3898-120">Leer el calendario de un usuario</span><span class="sxs-lookup"><span data-stu-id="c3898-120">Read a user's calendar</span></span>
* <span data-ttu-id="c3898-121">Calendario del usuario de escritura tooa</span><span class="sxs-lookup"><span data-stu-id="c3898-121">Write tooa user's calendar</span></span>
* <span data-ttu-id="c3898-122">Enviar correo como un usuario</span><span class="sxs-lookup"><span data-stu-id="c3898-122">Send mail as a user</span></span>

<span data-ttu-id="c3898-123">Mediante la definición de estos tipos de permisos, el recurso de hello tiene control específico sobre sus datos y cómo se exponen los datos de Hola.</span><span class="sxs-lookup"><span data-stu-id="c3898-123">By defining these types of permissions, hello resource has fine-grained control over its data and how hello data is exposed.</span></span> <span data-ttu-id="c3898-124">Una aplicación de terceros puede solicitar estos permisos a un usuario de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c3898-124">A third-party app can request these permissions from an app user.</span></span> <span data-ttu-id="c3898-125">usuario de aplicación Hola debe aprobar permisos Hola para que aplicación hello puede actuar en nombre de usuario de Hola.</span><span class="sxs-lookup"><span data-stu-id="c3898-125">hello app user must approve hello permissions before hello app can act on hello user's behalf.</span></span> <span data-ttu-id="c3898-126">Por fragmentación funcionalidad del recurso de hello en conjuntos de permisos más pequeños, aplicaciones de terceros pueden ser toorequest integrado solo Hola específicos los permisos que necesitan tooperform su función.</span><span class="sxs-lookup"><span data-stu-id="c3898-126">By chunking hello resource's functionality into smaller permission sets, third-party apps can be built toorequest only hello specific permissions that they need tooperform their function.</span></span> <span data-ttu-id="c3898-127">Los usuarios de la aplicación pueden sabe exactamente cómo una aplicación va a utilizar sus datos y pueden ser más seguros de que la aplicación hello no se comporta con malas intenciones.</span><span class="sxs-lookup"><span data-stu-id="c3898-127">App users can know exactly how an app will use their data, and they can be more confident that hello app is not behaving with malicious intent.</span></span>

<span data-ttu-id="c3898-128">En Azure AD y OAuth, estos tipos de permisos se denominan *ámbitos*.</span><span class="sxs-lookup"><span data-stu-id="c3898-128">In Azure AD and OAuth, these types of permissions are called *scopes*.</span></span> <span data-ttu-id="c3898-129">A veces también son tooas que se hace referencia *oAuth2Permissions*.</span><span class="sxs-lookup"><span data-stu-id="c3898-129">They also sometimes are referred tooas *oAuth2Permissions*.</span></span> <span data-ttu-id="c3898-130">Un ámbito se representa en Azure AD como un valor de cadena.</span><span class="sxs-lookup"><span data-stu-id="c3898-130">A scope is represented in Azure AD as a string value.</span></span> <span data-ttu-id="c3898-131">Continuando con el ejemplo de Hola a Microsoft Graph, valor de ámbito de Hola para cada permiso es:</span><span class="sxs-lookup"><span data-stu-id="c3898-131">Continuing with hello Microsoft Graph example, hello scope value for each permission is:</span></span>

* <span data-ttu-id="c3898-132">Leer el calendario de un usuario mediante `Calendar.Read`</span><span class="sxs-lookup"><span data-stu-id="c3898-132">Read a user's calendar by using `Calendar.Read`</span></span>
* <span data-ttu-id="c3898-133">Escribir calendario del usuario tooa mediante`Mail.ReadWrite`</span><span class="sxs-lookup"><span data-stu-id="c3898-133">Write tooa user's calendar by using `Mail.ReadWrite`</span></span>
* <span data-ttu-id="c3898-134">Enviar correo electrónico con un usuario mediante `Mail.Send`</span><span class="sxs-lookup"><span data-stu-id="c3898-134">Send mail as a user using by `Mail.Send`</span></span>

<span data-ttu-id="c3898-135">Una aplicación puede solicitar estos permisos mediante la especificación de ámbitos de hello en el punto de conexión de solicitudes toohello v2.0.</span><span class="sxs-lookup"><span data-stu-id="c3898-135">An app can request these permissions by specifying hello scopes in requests toohello v2.0 endpoint.</span></span>

## <a name="openid-connect-scopes"></a><span data-ttu-id="c3898-136">Ámbitos de OpenID Connect</span><span class="sxs-lookup"><span data-stu-id="c3898-136">OpenID Connect scopes</span></span>
<span data-ttu-id="c3898-137">implementación de la versión 2.0 de Hola de OpenID Connect tiene unos ámbitos bien definidos que no son aplicables a recursos específicos de tooa: `openid`, `email`, `profile`, y `offline_access`.</span><span class="sxs-lookup"><span data-stu-id="c3898-137">hello v2.0 implementation of OpenID Connect has a few well-defined scopes that do not apply tooa specific resource: `openid`, `email`, `profile`, and `offline_access`.</span></span>

### <a name="openid"></a><span data-ttu-id="c3898-138">openid</span><span class="sxs-lookup"><span data-stu-id="c3898-138">openid</span></span>
<span data-ttu-id="c3898-139">Si una aplicación realiza inicio de sesión mediante el uso de [OpenID Connect](active-directory-v2-protocols.md), debe solicitar hello `openid` ámbito.</span><span class="sxs-lookup"><span data-stu-id="c3898-139">If an app performs sign-in by using [OpenID Connect](active-directory-v2-protocols.md), it must request hello `openid` scope.</span></span> <span data-ttu-id="c3898-140">Hola `openid` ámbito se muestra en la cuenta de trabajo de hello página de consentimiento Hola permiso "Iniciar sesión en" y en la cuenta de Microsoft personal Hola página de consentimiento como Hola permiso "Ver su perfil y conectar tooapps y los servicios con su cuenta de Microsoft".</span><span class="sxs-lookup"><span data-stu-id="c3898-140">hello `openid` scope shows on hello work account consent page as hello "Sign you in" permission, and on hello personal Microsoft account consent page as hello "View your profile and connect tooapps and services using your Microsoft account" permission.</span></span> <span data-ttu-id="c3898-141">Con este permiso, una aplicación puede recibir un identificador único para el usuario de hello en forma de Hola de hello `sub` de notificación.</span><span class="sxs-lookup"><span data-stu-id="c3898-141">With this permission, an app can receive a unique identifier for hello user in hello form of hello `sub` claim.</span></span> <span data-ttu-id="c3898-142">También proporciona el punto de conexión de hello aplicación acceso toohello información de usuario.</span><span class="sxs-lookup"><span data-stu-id="c3898-142">It also gives hello app access toohello UserInfo endpoint.</span></span> <span data-ttu-id="c3898-143">Hola `openid` ámbito puede usarse en hello v2.0 extremo de token tooacquire identificador tokens, que pueden ser utilizados toosecure HTTP llamadas entre distintos componentes de una aplicación.</span><span class="sxs-lookup"><span data-stu-id="c3898-143">hello `openid` scope can be used at hello v2.0 token endpoint tooacquire ID tokens, which can be used toosecure HTTP calls between different components of an app.</span></span>

### <a name="email"></a><span data-ttu-id="c3898-144">email</span><span class="sxs-lookup"><span data-stu-id="c3898-144">email</span></span>
<span data-ttu-id="c3898-145">Hola `email` ámbito puede usarse con hello `openid` ámbito y cualquier otra.</span><span class="sxs-lookup"><span data-stu-id="c3898-145">hello `email` scope can be used with hello `openid` scope and any others.</span></span> <span data-ttu-id="c3898-146">Proporciona la dirección de correo electrónico principal del usuario de hello aplicación acceso toohello en forma Hola Hola `email` de notificación.</span><span class="sxs-lookup"><span data-stu-id="c3898-146">It gives hello app access toohello user's primary email address in hello form of hello `email` claim.</span></span> <span data-ttu-id="c3898-147">Hola `email` notificación se incluye en un token solo si una dirección de correo electrónico está asociada a la cuenta de usuario de hello, que no siempre es el caso de hello.</span><span class="sxs-lookup"><span data-stu-id="c3898-147">hello `email` claim is included in a token only if an email address is associated with hello user account, which is not always hello case.</span></span> <span data-ttu-id="c3898-148">Si utiliza hello `email` ámbito, la aplicación debe ser preparado toohandle un caso en que hello `email` notificación no existe en el símbolo (token) de Hola.</span><span class="sxs-lookup"><span data-stu-id="c3898-148">If it uses hello `email` scope, your app should be prepared toohandle a case in which hello `email` claim does not exist in hello token.</span></span>

### <a name="profile"></a><span data-ttu-id="c3898-149">Perfil</span><span class="sxs-lookup"><span data-stu-id="c3898-149">profile</span></span>
<span data-ttu-id="c3898-150">Hola `profile` ámbito puede usarse con hello `openid` ámbito y cualquier otra.</span><span class="sxs-lookup"><span data-stu-id="c3898-150">hello `profile` scope can be used with hello `openid` scope and any others.</span></span> <span data-ttu-id="c3898-151">Proporciona Hola aplicación acceso tooa considerable cantidad de información acerca del usuario de Hola.</span><span class="sxs-lookup"><span data-stu-id="c3898-151">It gives hello app access tooa substantial amount of information about hello user.</span></span> <span data-ttu-id="c3898-152">incluye información de Hola que pueda tener acceso, pero no está limitado para Hola nombre dado del usuario, apellido, nombre de usuario preferido e identificador de objeto</span><span class="sxs-lookup"><span data-stu-id="c3898-152">hello information it can access includes, but is not limited to, hello user's given name, surname, preferred username, and object ID.</span></span> <span data-ttu-id="c3898-153">Para obtener una lista completa de hello perfil notificaciones disponibles en el parámetro de hello id_tokens para un usuario específico, vea hello [v2.0 tokens referencia](active-directory-v2-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="c3898-153">For a complete list of hello profile claims available in hello id_tokens parameter for a specific user, see hello [v2.0 tokens reference](active-directory-v2-tokens.md).</span></span>

### <a name="offlineaccess"></a><span data-ttu-id="c3898-154">offline_access</span><span class="sxs-lookup"><span data-stu-id="c3898-154">offline_access</span></span>
<span data-ttu-id="c3898-155">Hola [ `offline_access` ámbito](http://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess) da su tooresources de acceso de la aplicación en nombre de usuario de Hola durante un período prolongado.</span><span class="sxs-lookup"><span data-stu-id="c3898-155">hello [`offline_access` scope](http://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess) gives your app access tooresources on behalf of hello user for an extended time.</span></span> <span data-ttu-id="c3898-156">En la página de consentimiento de cuenta de trabajo hello, este ámbito aparece como "Obtener acceso a los datos en cualquier momento" permiso de Hola.</span><span class="sxs-lookup"><span data-stu-id="c3898-156">On hello work account consent page, this scope appears as hello "Access your data anytime" permission.</span></span> <span data-ttu-id="c3898-157">En hello personal consentimiento página la cuenta Microsoft, aparece como "Obtener acceso a la información en cualquier momento" permiso de Hola.</span><span class="sxs-lookup"><span data-stu-id="c3898-157">On hello personal Microsoft account consent page, it appears as hello "Access your info anytime" permission.</span></span> <span data-ttu-id="c3898-158">Cuando un usuario aprueba hello `offline_access` ámbito, la aplicación puede recibir tokens de actualización de extremo de token de hello v2.0.</span><span class="sxs-lookup"><span data-stu-id="c3898-158">When a user approves hello `offline_access` scope, your app can receive refresh tokens from hello v2.0 token endpoint.</span></span> <span data-ttu-id="c3898-159">Los tokens de actualización tienen una duración larga.</span><span class="sxs-lookup"><span data-stu-id="c3898-159">Refresh tokens are long-lived.</span></span> <span data-ttu-id="c3898-160">La aplicación puede obtener nuevos tokens de acceso cuando expiren los antiguos.</span><span class="sxs-lookup"><span data-stu-id="c3898-160">Your app can get new access tokens as older ones expire.</span></span>

<span data-ttu-id="c3898-161">Si la aplicación no solicita hello `offline_access` ámbito, que no recibir tokens de actualización.</span><span class="sxs-lookup"><span data-stu-id="c3898-161">If your app does not request hello `offline_access` scope, it won't receive refresh tokens.</span></span> <span data-ttu-id="c3898-162">Esto significa que cuando canjear un código de autorización en hello [flujo de código de autorización de OAuth 2.0](active-directory-v2-protocols.md), recibirá solo un token de acceso de hello `/token` punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="c3898-162">This means that when you redeem an authorization code in hello [OAuth 2.0 authorization code flow](active-directory-v2-protocols.md), you'll receive only an access token from hello `/token` endpoint.</span></span> <span data-ttu-id="c3898-163">token de acceso de Hello es válida durante un breve período.</span><span class="sxs-lookup"><span data-stu-id="c3898-163">hello access token is valid for a short time.</span></span> <span data-ttu-id="c3898-164">token de acceso de Hello normalmente expira en una hora.</span><span class="sxs-lookup"><span data-stu-id="c3898-164">hello access token usually expires in one hour.</span></span> <span data-ttu-id="c3898-165">En ese momento, la aplicación necesita tooredirect Hola usuario espera toohello `/authorize` tooget un nuevo código de autorización de punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="c3898-165">At that point, your app needs tooredirect hello user back toohello `/authorize` endpoint tooget a new authorization code.</span></span> <span data-ttu-id="c3898-166">Durante esta redirección, según el tipo de saludo de aplicación, usuario Hola podría necesitará tooenter sus credenciales de nuevo o nuevo consentimiento toopermissions.</span><span class="sxs-lookup"><span data-stu-id="c3898-166">During this redirect, depending on hello type of app, hello user might need tooenter their credentials again or consent again toopermissions.</span></span>

<span data-ttu-id="c3898-167">Para obtener más información acerca de cómo tooget y use tokens de actualización, vea hello [referencia del protocolo v2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="c3898-167">For more information about how tooget and use refresh tokens, see hello [v2.0 protocol reference](active-directory-v2-protocols.md).</span></span>

## <a name="requesting-individual-user-consent"></a><span data-ttu-id="c3898-168">Solicitud de consentimiento de usuario individual</span><span class="sxs-lookup"><span data-stu-id="c3898-168">Requesting individual user consent</span></span>
<span data-ttu-id="c3898-169">En un [OpenID Connect o OAuth 2.0](active-directory-v2-protocols.md) solicitar autorización, una aplicación puede solicitar permisos de Hola que necesita mediante el uso de hello `scope` parámetro de consulta.</span><span class="sxs-lookup"><span data-stu-id="c3898-169">In an [OpenID Connect or OAuth 2.0](active-directory-v2-protocols.md) authorization request, an app can request hello permissions it needs by using hello `scope` query parameter.</span></span> <span data-ttu-id="c3898-170">Por ejemplo, cuando un usuario inicia sesión en la aplicación tooan, aplicación hello envía una solicitud como Hola siguiente ejemplo (con saltos de línea agregados por legibilidad):</span><span class="sxs-lookup"><span data-stu-id="c3898-170">For example, when a user signs in tooan app, hello app sends a request like hello following example (with line breaks added for legibility):</span></span>

```
GET https://login.microsoftonline.com/common/oauth2/v2.0/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&response_type=code
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&response_mode=query
&scope=
https%3A%2F%2Fgraph.microsoft.com%2Fcalendar.read%20
https%3A%2F%2Fgraph.microsoft.com%2Fmail.send
&state=12345
```

<span data-ttu-id="c3898-171">Hola `scope` parámetro es una lista separada por espacios de ámbitos que Hola aplicación está solicitando.</span><span class="sxs-lookup"><span data-stu-id="c3898-171">hello `scope` parameter is a space-separated list of scopes that hello app is requesting.</span></span> <span data-ttu-id="c3898-172">Cada ámbito se indica mediante la anexión de identificador del recurso de hello ámbito valor toohello (Hola URI de Id. de la aplicación).</span><span class="sxs-lookup"><span data-stu-id="c3898-172">Each scope is indicated by appending hello scope value toohello resource's identifier (hello Application ID URI).</span></span> <span data-ttu-id="c3898-173">En el ejemplo de solicitud de hello, aplicación hello necesita calendario del usuario de permiso tooread hello y enviar correo electrónico como usuario de Hola.</span><span class="sxs-lookup"><span data-stu-id="c3898-173">In hello request example, hello app needs permission tooread hello user's calendar and send mail as hello user.</span></span>

<span data-ttu-id="c3898-174">Después de hello usuario escribe sus credenciales, el punto de conexión de hello v2.0 busca un registro coincidente de *consentimiento del usuario*.</span><span class="sxs-lookup"><span data-stu-id="c3898-174">After hello user enters their credentials, hello v2.0 endpoint checks for a matching record of *user consent*.</span></span> <span data-ttu-id="c3898-175">Si no ha dado su consentimiento del usuario de hello tooany de hello permisos solicitados en hello anterior, el punto de conexión de hello v2.0 pide toogrant de usuario de Hola Hola permisos solicitados.</span><span class="sxs-lookup"><span data-stu-id="c3898-175">If hello user has not consented tooany of hello requested permissions in hello past, hello v2.0 endpoint asks hello user toogrant hello requested permissions.</span></span>

![Consentimiento de la cuenta de trabajo](../../media/active-directory-v2-flows/work_account_consent.png)

<span data-ttu-id="c3898-177">Cuando el usuario de hello aprueba permiso hello, consentimiento Hola se registra para que hello el usuario no tiene tooconsent nuevo en inicios de sesión de cuentas subsiguientes.</span><span class="sxs-lookup"><span data-stu-id="c3898-177">When hello user approves hello permission, hello consent is recorded so that hello user doesn't have tooconsent again on subsequent account sign-ins.</span></span>

## <a name="requesting-consent-for-an-entire-tenant"></a><span data-ttu-id="c3898-178">Solicitud de consentimiento para un inquilino al completo</span><span class="sxs-lookup"><span data-stu-id="c3898-178">Requesting consent for an entire tenant</span></span>
<span data-ttu-id="c3898-179">A menudo, cuando una organización adquiere una licencia o una suscripción para una aplicación, la organización de hello quiere toofully aplicación de hello aprovisionar para sus empleados.</span><span class="sxs-lookup"><span data-stu-id="c3898-179">Often, when an organization purchases a license or subscription for an application, hello organization wants toofully provision hello application for its employees.</span></span> <span data-ttu-id="c3898-180">Como parte de este proceso, un administrador puede conceder consentimiento para tooact de aplicación hello en nombre de cualquier empleado.</span><span class="sxs-lookup"><span data-stu-id="c3898-180">As part of this process, an administrator can grant consent for hello application tooact on behalf of any employee.</span></span> <span data-ttu-id="c3898-181">Si Hola, administrador concede el consentimiento para el inquilino todo hello, los empleados de la organización de hello no verán una página de consentimiento para la aplicación hello.</span><span class="sxs-lookup"><span data-stu-id="c3898-181">If hello admin grants consent for hello entire tenant, hello organization's employees won't see a consent page for hello application.</span></span>

<span data-ttu-id="c3898-182">toorequest consentimiento para todos los usuarios en un inquilino, la aplicación puede utilizar el extremo de consentimiento de administración de Hola.</span><span class="sxs-lookup"><span data-stu-id="c3898-182">toorequest consent for all users in a tenant, your app can use hello admin consent endpoint.</span></span>

## <a name="admin-restricted-scopes"></a><span data-ttu-id="c3898-183">Ámbitos restringidos para los administradores</span><span class="sxs-lookup"><span data-stu-id="c3898-183">Admin-restricted scopes</span></span>
<span data-ttu-id="c3898-184">Se pueden establecer algunos permisos con privilegios elevados en el ecosistema de Microsoft hello demasiado*restringido a administradores*.</span><span class="sxs-lookup"><span data-stu-id="c3898-184">Some high-privilege permissions in hello Microsoft ecosystem can be set too*admin-restricted*.</span></span> <span data-ttu-id="c3898-185">Algunos ejemplos de estos tipos de ámbitos son Hola los siguientes permisos:</span><span class="sxs-lookup"><span data-stu-id="c3898-185">Examples of these kinds of scopes include hello following permissions:</span></span>

* <span data-ttu-id="c3898-186">Leer datos del directorio de una organización mediante `Directory.Read`</span><span class="sxs-lookup"><span data-stu-id="c3898-186">Read an organization's directory data by using `Directory.Read`</span></span>
* <span data-ttu-id="c3898-187">Escribir el directorio de la organización de datos tooan mediante`Directory.ReadWrite`</span><span class="sxs-lookup"><span data-stu-id="c3898-187">Write data tooan organization's directory by using `Directory.ReadWrite`</span></span>
* <span data-ttu-id="c3898-188">Leer grupos de seguridad del directorio de una organización mediante: `Groups.Read.All`</span><span class="sxs-lookup"><span data-stu-id="c3898-188">Read security groups in an organization's directory by using `Groups.Read.All`</span></span>

<span data-ttu-id="c3898-189">Aunque un usuario de consumidor puede conceder un toothis de acceso de la aplicación de tipo de datos, los usuarios de la organización están restringidos conceder toohello acceso mismo conjunto de datos confidenciales de la empresa.</span><span class="sxs-lookup"><span data-stu-id="c3898-189">Although a consumer user might grant an application access toothis kind of data, organizational users are restricted from granting access toohello same set of sensitive company data.</span></span> <span data-ttu-id="c3898-190">Si la aplicación solicita acceso tooone de estos permisos de un usuario de la organización, usuario de hello recibe un mensaje de error que indica que no son los permisos de la aplicación de tooconsent autorizados tooyour.</span><span class="sxs-lookup"><span data-stu-id="c3898-190">If your application requests access tooone of these permissions from an organizational user, hello user receives an error message that says they are not authorized tooconsent tooyour app's permissions.</span></span>

<span data-ttu-id="c3898-191">Si la aplicación necesita acceso restringido tooadmin ámbitos para las organizaciones, se debe solicitan directamente desde un administrador de empresa, también mediante el uso de extremo de consentimiento de administración de hello, que se describe a continuación.</span><span class="sxs-lookup"><span data-stu-id="c3898-191">If your app requires access tooadmin-restricted scopes for organizations, you should request them directly from a company administrator, also by using hello admin consent endpoint, described next.</span></span>

<span data-ttu-id="c3898-192">Cuando un administrador le conceda que estos permisos a través de Hola, Administrador de consentimiento punto de conexión, se ha dado consentimiento para todos los usuarios de inquilinos de Hola.</span><span class="sxs-lookup"><span data-stu-id="c3898-192">When an administrator grants these permissions via hello admin consent endpoint, consent is granted for all users in hello tenant.</span></span>

## <a name="using-hello-admin-consent-endpoint"></a><span data-ttu-id="c3898-193">Uso de extremo de consentimiento de administración de Hola</span><span class="sxs-lookup"><span data-stu-id="c3898-193">Using hello admin consent endpoint</span></span>
<span data-ttu-id="c3898-194">Si sigue estos pasos, la aplicación puede recopilar permisos para todos los usuarios de un inquilino, incluidos los ámbitos restringido para los administradores.</span><span class="sxs-lookup"><span data-stu-id="c3898-194">If you follow these steps, your app can gather permissions for all users in a tenant, including admin-restricted scopes.</span></span> <span data-ttu-id="c3898-195">toosee un ejemplo de código que implementa los pasos de hello, vea hello [ejemplo restringido por el Administrador de ámbitos](https://github.com/Azure-Samples/active-directory-dotnet-admin-restricted-scopes-v2).</span><span class="sxs-lookup"><span data-stu-id="c3898-195">toosee a code sample that implements hello steps, see hello [admin-restricted scopes sample](https://github.com/Azure-Samples/active-directory-dotnet-admin-restricted-scopes-v2).</span></span>

### <a name="request-hello-permissions-in-hello-app-registration-portal"></a><span data-ttu-id="c3898-196">Solicitar permisos de hello en el portal de registro de aplicación Hola</span><span class="sxs-lookup"><span data-stu-id="c3898-196">Request hello permissions in hello app registration portal</span></span>
1. <span data-ttu-id="c3898-197">Vaya tooyour aplicación Hola [Portal de registro de aplicación](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList), o [crear una aplicación](active-directory-v2-app-registration.md) si no lo ha hecho ya.</span><span class="sxs-lookup"><span data-stu-id="c3898-197">Go tooyour application in hello [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList), or [create an app](active-directory-v2-app-registration.md) if you haven't already.</span></span>
2. <span data-ttu-id="c3898-198">Busque hello **Microsoft Graph permisos** sección y, a continuación, agregue permisos de Hola que requiere la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c3898-198">Locate hello **Microsoft Graph Permissions** section, and then add hello permissions that your app requires.</span></span>
3. <span data-ttu-id="c3898-199">Asegúrese de que **guardar** Hola de registro de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c3898-199">Make sure you **Save** hello app registration.</span></span>

### <a name="recommended-sign-hello-user-in-tooyour-app"></a><span data-ttu-id="c3898-200">Recomendado: Usuario de inicio de sesión hello en tooyour aplicación</span><span class="sxs-lookup"><span data-stu-id="c3898-200">Recommended: Sign hello user in tooyour app</span></span>
<span data-ttu-id="c3898-201">Normalmente, cuando se compila una aplicación que utiliza el punto de conexión de consentimiento de administración de hello, aplicación hello necesita una página o una vista en qué Hola administrador puede aprobar los permisos de la aplicación hello.</span><span class="sxs-lookup"><span data-stu-id="c3898-201">Typically, when you build an application that uses hello admin consent endpoint, hello app needs a page or view in which hello admin can approve hello app's permissions.</span></span> <span data-ttu-id="c3898-202">Esta página puede formar parte del flujo de registro de la aplicación hello, parte de la configuración de la aplicación hello, o bien puede ser dedicado "conectar" flujo.</span><span class="sxs-lookup"><span data-stu-id="c3898-202">This page can be part of hello app's sign-up flow, part of hello app's settings, or it can be a dedicated "connect" flow.</span></span> <span data-ttu-id="c3898-203">En muchos casos, tiene sentido para hello aplicación tooshow esto "conectar" vista sólo después de que un usuario haya iniciado sesión con un trabajo o escuela cuenta Microsoft.</span><span class="sxs-lookup"><span data-stu-id="c3898-203">In many cases, it makes sense for hello app tooshow this "connect" view only after a user has signed in with a work or school Microsoft account.</span></span>

<span data-ttu-id="c3898-204">Al iniciar la sesión de usuario de hello en tooyour aplicación, puede identificar la organización de hello toowhich Hola, Administrador pertenece antes de que se les solicita permisos necesarios de tooapprove Hola.</span><span class="sxs-lookup"><span data-stu-id="c3898-204">When you sign hello user in tooyour app, you can identify hello organization toowhich hello admin belongs before asking them tooapprove hello necessary permissions.</span></span> <span data-ttu-id="c3898-205">Aunque no es estrictamente necesario, puede ayudarle a crear una experiencia más intuitiva para los usuarios de la organización.</span><span class="sxs-lookup"><span data-stu-id="c3898-205">Although not strictly necessary, it can help you create a more intuitive experience for your organizational users.</span></span> <span data-ttu-id="c3898-206">usuario de hello toosign en siguen nuestro [tutoriales de protocolo v2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="c3898-206">toosign hello user in, follow our [v2.0 protocol tutorials](active-directory-v2-protocols.md).</span></span>

### <a name="request-hello-permissions-from-a-directory-admin"></a><span data-ttu-id="c3898-207">Hola solicitar los permisos de un administrador de directorio</span><span class="sxs-lookup"><span data-stu-id="c3898-207">Request hello permissions from a directory admin</span></span>
<span data-ttu-id="c3898-208">Cuando esté listo toorequest permisos de administrador de su organización, puede redirigir Hola usuario toohello v2.0 *extremo de consentimiento de administración*.</span><span class="sxs-lookup"><span data-stu-id="c3898-208">When you're ready toorequest permissions from your organization's admin, you can redirect hello user toohello v2.0 *admin consent endpoint*.</span></span>

```
// Line breaks are for legibility only.

GET https://login.microsoftonline.com/{tenant}/adminconsent?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&state=12345
&redirect_uri=http://localhost/myapp/permissions
```

```
// Pro tip: Try pasting hello below request in a browser!
```

```
https://login.microsoftonline.com/common/adminconsent?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&state=12345&redirect_uri=http://localhost/myapp/permissions
```

| <span data-ttu-id="c3898-209">Parámetro</span><span class="sxs-lookup"><span data-stu-id="c3898-209">Parameter</span></span> | <span data-ttu-id="c3898-210">Condición</span><span class="sxs-lookup"><span data-stu-id="c3898-210">Condition</span></span> | <span data-ttu-id="c3898-211">Descripción</span><span class="sxs-lookup"><span data-stu-id="c3898-211">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="c3898-212">tenant</span><span class="sxs-lookup"><span data-stu-id="c3898-212">tenant</span></span> |<span data-ttu-id="c3898-213">Obligatorio</span><span class="sxs-lookup"><span data-stu-id="c3898-213">Required</span></span> |<span data-ttu-id="c3898-214">inquilino de directorio de Hola que desee toorequest permiso de.</span><span class="sxs-lookup"><span data-stu-id="c3898-214">hello directory tenant that you want toorequest permission from.</span></span> <span data-ttu-id="c3898-215">Se puede proporcionar en formato de nombre descriptivo o GUID.</span><span class="sxs-lookup"><span data-stu-id="c3898-215">Can be provided in GUID or friendly name format.</span></span> |
| <span data-ttu-id="c3898-216">client_id</span><span class="sxs-lookup"><span data-stu-id="c3898-216">client_id</span></span> |<span data-ttu-id="c3898-217">Obligatorio</span><span class="sxs-lookup"><span data-stu-id="c3898-217">Required</span></span> |<span data-ttu-id="c3898-218">Hola aplicación Id. que hello [Portal de registro de aplicación](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) asignado tooyour aplicación.</span><span class="sxs-lookup"><span data-stu-id="c3898-218">hello Application ID that hello [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) assigned tooyour app.</span></span> |
| <span data-ttu-id="c3898-219">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="c3898-219">redirect_uri</span></span> |<span data-ttu-id="c3898-220">Obligatorio</span><span class="sxs-lookup"><span data-stu-id="c3898-220">Required</span></span> |<span data-ttu-id="c3898-221">Hola redirigir URI donde desee hello toobe de respuesta enviado para su toohandle de aplicación.</span><span class="sxs-lookup"><span data-stu-id="c3898-221">hello redirect URI where you want hello response toobe sent for your app toohandle.</span></span> <span data-ttu-id="c3898-222">Debe coincidir exactamente con uno de redirección de hello URI que se ha registrado en el portal de registro de aplicación Hola.</span><span class="sxs-lookup"><span data-stu-id="c3898-222">It must exactly match one of hello redirect URIs that you registered in hello app registration portal.</span></span> |
| <span data-ttu-id="c3898-223">state</span><span class="sxs-lookup"><span data-stu-id="c3898-223">state</span></span> |<span data-ttu-id="c3898-224">Recomendado</span><span class="sxs-lookup"><span data-stu-id="c3898-224">Recommended</span></span> |<span data-ttu-id="c3898-225">Un valor incluido en la solicitud de Hola que también se devolverán en respuesta de token de Hola.</span><span class="sxs-lookup"><span data-stu-id="c3898-225">A value included in hello request that will also be returned in hello token response.</span></span> <span data-ttu-id="c3898-226">Puede ser una cadena de cualquier contenido que desee.</span><span class="sxs-lookup"><span data-stu-id="c3898-226">It can be a string of any content you want.</span></span> <span data-ttu-id="c3898-227">Utilice tooencode información de estado de hello acerca del estado del usuario de hello en la aplicación hello antes de que se ha producido en solicitud de autenticación de hello, como página de Hola o vista que estaban en.</span><span class="sxs-lookup"><span data-stu-id="c3898-227">Use hello state tooencode information about hello user's state in hello app before hello authentication request occurred, such as hello page or view they were on.</span></span> |

<span data-ttu-id="c3898-228">En este momento, Azure AD necesita un toosign del Administrador de inquilinos en solicitud de hello toocomplete.</span><span class="sxs-lookup"><span data-stu-id="c3898-228">At this point, Azure AD requires a tenant administrator toosign in toocomplete hello request.</span></span> <span data-ttu-id="c3898-229">Administrador de Hola se solicita tooapprove que todos Hola permisos que han solicitado para la aplicación de portal de registro de aplicación Hola.</span><span class="sxs-lookup"><span data-stu-id="c3898-229">hello administrator is asked tooapprove all hello permissions that you have requested for your app in hello app registration portal.</span></span>

#### <a name="successful-response"></a><span data-ttu-id="c3898-230">Respuesta correcta</span><span class="sxs-lookup"><span data-stu-id="c3898-230">Successful response</span></span>
<span data-ttu-id="c3898-231">Si Hola, administrador aprueba permisos hello para la aplicación, la respuesta es correcta Hola se ve así:</span><span class="sxs-lookup"><span data-stu-id="c3898-231">If hello admin approves hello permissions for your app, hello successful response looks like this:</span></span>

```
GET http://localhost/myapp/permissions?tenant=a8990e1f-ff32-408a-9f8e-78d3b9139b95&state=state=12345&admin_consent=True
```

| <span data-ttu-id="c3898-232">Parámetro</span><span class="sxs-lookup"><span data-stu-id="c3898-232">Parameter</span></span> | <span data-ttu-id="c3898-233">Description</span><span class="sxs-lookup"><span data-stu-id="c3898-233">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="c3898-234">tenant</span><span class="sxs-lookup"><span data-stu-id="c3898-234">tenant</span></span> |<span data-ttu-id="c3898-235">inquilino de directorio de Hola que conceden los permisos de aplicación Hola solicita, en formato GUID.</span><span class="sxs-lookup"><span data-stu-id="c3898-235">hello directory tenant that granted your application hello permissions it requested, in GUID format.</span></span> |
| <span data-ttu-id="c3898-236">state</span><span class="sxs-lookup"><span data-stu-id="c3898-236">state</span></span> |<span data-ttu-id="c3898-237">Un valor incluido en la solicitud de Hola que también se devolverá como respuesta de token de Hola.</span><span class="sxs-lookup"><span data-stu-id="c3898-237">A value included in hello request that also will be returned in hello token response.</span></span> <span data-ttu-id="c3898-238">Puede ser una cadena de cualquier contenido que desee.</span><span class="sxs-lookup"><span data-stu-id="c3898-238">It can be a string of any content you want.</span></span> <span data-ttu-id="c3898-239">estado de Hello es tooencode usa información acerca del estado del usuario de hello en la aplicación hello antes de que se ha producido en solicitud de autenticación de hello, como página de Hola o que estaban en la vista.</span><span class="sxs-lookup"><span data-stu-id="c3898-239">hello state is used tooencode information about hello user's state in hello app before hello authentication request occurred, such as hello page or view they were on.</span></span> |
| <span data-ttu-id="c3898-240">admin_consent</span><span class="sxs-lookup"><span data-stu-id="c3898-240">admin_consent</span></span> |<span data-ttu-id="c3898-241">Se establece demasiado**true**.</span><span class="sxs-lookup"><span data-stu-id="c3898-241">Will be set too**true**.</span></span> |

#### <a name="error-response"></a><span data-ttu-id="c3898-242">Respuesta de error</span><span class="sxs-lookup"><span data-stu-id="c3898-242">Error response</span></span>
<span data-ttu-id="c3898-243">Si Hola, administrador no puede aprobar los permisos de hello para la aplicación, Hola error respuesta es similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="c3898-243">If hello admin does not approve hello permissions for your app, hello failed response looks like this:</span></span>

```
GET http://localhost/myapp/permissions?error=permission_denied&error_description=The+admin+canceled+the+request
```

| <span data-ttu-id="c3898-244">Parámetro</span><span class="sxs-lookup"><span data-stu-id="c3898-244">Parameter</span></span> | <span data-ttu-id="c3898-245">Description</span><span class="sxs-lookup"><span data-stu-id="c3898-245">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="c3898-246">error</span><span class="sxs-lookup"><span data-stu-id="c3898-246">error</span></span> |<span data-ttu-id="c3898-247">Una cadena de código de error que puede ser utilizados tooclassify tipos de errores que se producen y puede ser usado tooreact tooerrors.</span><span class="sxs-lookup"><span data-stu-id="c3898-247">An error code string that can be used tooclassify types of errors that occur, and can be used tooreact tooerrors.</span></span> |
| <span data-ttu-id="c3898-248">error_description</span><span class="sxs-lookup"><span data-stu-id="c3898-248">error_description</span></span> |<span data-ttu-id="c3898-249">Un mensaje de error específico que puede ayudar a un desarrollador para identificar la causa de Hola de un error.</span><span class="sxs-lookup"><span data-stu-id="c3898-249">A specific error message that can help a developer identify hello root cause of an error.</span></span> |

<span data-ttu-id="c3898-250">Una vez que ha recibido una respuesta correcta desde el punto de conexión de hello administrador consentimiento, la aplicación ha obtenido permisos de Hola que solicita.</span><span class="sxs-lookup"><span data-stu-id="c3898-250">After you've received a successful response from hello admin consent endpoint, your app has gained hello permissions it requested.</span></span> <span data-ttu-id="c3898-251">A continuación, puede solicitar un token de recurso de Hola que desee.</span><span class="sxs-lookup"><span data-stu-id="c3898-251">Next, you can request a token for hello resource you want.</span></span>

## <a name="using-permissions"></a><span data-ttu-id="c3898-252">Uso de permisos</span><span class="sxs-lookup"><span data-stu-id="c3898-252">Using permissions</span></span>
<span data-ttu-id="c3898-253">Después de consentimiento del usuario de hello toopermissions para la aplicación, la aplicación puede adquirir tokens de acceso que representan tooaccess de permiso de la aplicación un recurso cierta capacidad.</span><span class="sxs-lookup"><span data-stu-id="c3898-253">After hello user consents toopermissions for your app, your app can acquire access tokens that represent your app's permission tooaccess a resource in some capacity.</span></span> <span data-ttu-id="c3898-254">Un token de acceso puede utilizarse solo para un único recurso, pero se codifica dentro del token de acceso de hello es cada permiso que se ha concedido a la aplicación para ese recurso.</span><span class="sxs-lookup"><span data-stu-id="c3898-254">An access token can be used only for a single resource, but encoded inside hello access token is every permission that your app has been granted for that resource.</span></span> <span data-ttu-id="c3898-255">tooacquire un token de acceso, la aplicación puede realizar un solicitud toohello v2.0 extremo de token, similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="c3898-255">tooacquire an access token, your app can make a request toohello v2.0 token endpoint, like this:</span></span>

```
POST common/oauth2/v2.0/token HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/json

{
    "grant_type": "authorization_code",
    "client_id": "6731de76-14a6-49ae-97bc-6eba6914391e",
    "scope": "https://outlook.office.com/mail.read https://outlook.office.com/mail.send",
    "code": "AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq..."
    "redirect_uri": "https://localhost/myapp",
    "client_secret": "zc53fwe80980293klaj9823"  // NOTE: Only required for web apps
}
```

<span data-ttu-id="c3898-256">Puede usar el token de acceso resultante de hello en recursos de toohello de las solicitudes HTTP.</span><span class="sxs-lookup"><span data-stu-id="c3898-256">You can use hello resulting access token in HTTP requests toohello resource.</span></span> <span data-ttu-id="c3898-257">Forma confiable indica recursos toohello que tu aplicación tiene Hola el permiso adecuado tooperform una tarea específica.</span><span class="sxs-lookup"><span data-stu-id="c3898-257">It reliably indicates toohello resource that your app has hello proper permission tooperform a specific task.</span></span>  

<span data-ttu-id="c3898-258">Para obtener más información acerca de hello OAuth 2.0 del protocolo y tokens de acceso de tooget, vea hello [referencia del protocolo de extremo v2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="c3898-258">For more information about hello OAuth 2.0 protocol and how tooget access tokens, see hello [v2.0 endpoint protocol reference](active-directory-v2-protocols.md).</span></span>

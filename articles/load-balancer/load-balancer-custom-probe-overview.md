---
title: "sondeos del equilibrador de aaaLoad personalizados y supervisión de estado de mantenimiento | Documentos de Microsoft"
description: "Obtenga información acerca de cómo toouse personalizado sondea instancias de equilibrador de carga Azure toomonitor detrás de equilibrador de carga"
services: load-balancer
documentationcenter: na
author: kumudd
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 46b152c5-6a27-4bfc-bea3-05de9ce06a57
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/24/2016
ms.author: kumud
ms.openlocfilehash: 3dfcfcd2d5cffa58b160cb38d63acffbd997d452
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="understand-load-balancer-probes"></a><span data-ttu-id="b45e8-103">Descripción de los sondeos del equilibrador de carga</span><span class="sxs-lookup"><span data-stu-id="b45e8-103">Understand load balancer probes</span></span>

<span data-ttu-id="b45e8-104">Equilibrador de carga de Azure ofrece mantenimiento de hello capacidad toomonitor Hola de instancias de servidor mediante el uso de sondeos.</span><span class="sxs-lookup"><span data-stu-id="b45e8-104">Azure Load Balancer offers hello capability toomonitor hello health of server instances by using probes.</span></span> <span data-ttu-id="b45e8-105">Cuando un sondeo se produce un error toorespond, equilibrador de carga deja de enviar nueva instancia de mal estado toohello de conexiones.</span><span class="sxs-lookup"><span data-stu-id="b45e8-105">When a probe fails toorespond, Load Balancer stops sending new connections toohello unhealthy instance.</span></span> <span data-ttu-id="b45e8-106">no se ven afectadas las conexiones existentes de Hola y las conexiones nuevas se envían toohealthy instancias.</span><span class="sxs-lookup"><span data-stu-id="b45e8-106">hello existing connections are not affected, and new connections are sent toohealthy instances.</span></span>

<span data-ttu-id="b45e8-107">Los roles del servicio en la nube (los roles de trabajo y los roles web) usan un agente invitado con supervisión del sondeo del agente invitado.</span><span class="sxs-lookup"><span data-stu-id="b45e8-107">Cloud service roles (worker roles and web roles) use a guest agent for probe monitoring.</span></span> <span data-ttu-id="b45e8-108">Deben configurarse sondeos TCP o HTTP personalizados al usar máquinas virtuales detrás del Equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="b45e8-108">TCP or HTTP custom probes must be configured when you use virtual machines behind Load Balancer.</span></span>

## <a name="understand-probe-count-and-timeout"></a><span data-ttu-id="b45e8-109">Descripción del número y el tiempo de espera de los sondeos</span><span class="sxs-lookup"><span data-stu-id="b45e8-109">Understand probe count and timeout</span></span>

<span data-ttu-id="b45e8-110">El comportamiento de los sondeos depende de:</span><span class="sxs-lookup"><span data-stu-id="b45e8-110">Probe behavior depends on:</span></span>

* <span data-ttu-id="b45e8-111">número de Hola de sondeos correcta que permiten una toobe de instancia con la etiqueta como activo.</span><span class="sxs-lookup"><span data-stu-id="b45e8-111">hello number of successful probes that allow an instance toobe labeled as up.</span></span>
* <span data-ttu-id="b45e8-112">número de Hola de comprobaciones de errores que provocan un toobe de instancia con la etiqueta como inactivo.</span><span class="sxs-lookup"><span data-stu-id="b45e8-112">hello number of failed probes that cause an instance toobe labeled as down.</span></span>

<span data-ttu-id="b45e8-113">valor de tiempo de espera y la frecuencia de Hello establecido en SuccessFailCount determinar si una instancia está confirmada toobe ejecutando o no se está ejecutando.</span><span class="sxs-lookup"><span data-stu-id="b45e8-113">hello timeout and frequency value set in  SuccessFailCount determine whether an instance is confirmed toobe running or not running.</span></span> <span data-ttu-id="b45e8-114">Hola portal de Azure, el tiempo de espera de Hola se establece tootwo veces Hola valor de frecuencia de Hola.</span><span class="sxs-lookup"><span data-stu-id="b45e8-114">In hello Azure portal, hello timeout is set tootwo times hello value of hello frequency.</span></span>

<span data-ttu-id="b45e8-115">configuración de sondeo de Hola de todas las instancias de equilibrio de carga debe ser un punto de conexión (es decir, un conjunto con equilibrio de carga) Hola igual.</span><span class="sxs-lookup"><span data-stu-id="b45e8-115">hello probe configuration of all load-balanced instances for an endpoint (that is, a load-balanced set) must be hello same.</span></span> <span data-ttu-id="b45e8-116">Esto significa que no puede tener una configuración de sondeo distinto para cada instancia de rol o máquina virtual en hello mismo servicio hospedado en una combinación de punto de conexión determinado.</span><span class="sxs-lookup"><span data-stu-id="b45e8-116">This means you cannot have a different probe configuration for each role instance or virtual machine in hello same hosted service for a particular endpoint combination.</span></span> <span data-ttu-id="b45e8-117">Por ejemplo, cada instancia debe tener puertos locales y tiempos de espera idénticos.</span><span class="sxs-lookup"><span data-stu-id="b45e8-117">For example, each instance must have identical local ports and timeouts.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b45e8-118">Un sondeo del equilibrador de carga utiliza la dirección IP 168.63.129.16 del saludo.</span><span class="sxs-lookup"><span data-stu-id="b45e8-118">A Load Balancer probe uses hello IP address 168.63.129.16.</span></span> <span data-ttu-id="b45e8-119">Esta dirección IP pública facilita los recursos de la plataforma de comunicación toointernal para hello bring-your-posee-IP escenario de red Virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="b45e8-119">This public IP address facilitates communication toointernal platform resources for hello bring-your-own-IP Azure Virtual Network scenario.</span></span> <span data-ttu-id="b45e8-120">Hola virtual la dirección IP 168.63.129.16 se utiliza en todas las regiones y no cambiará.</span><span class="sxs-lookup"><span data-stu-id="b45e8-120">hello virtual public IP address 168.63.129.16 is used in all regions and will not change.</span></span> <span data-ttu-id="b45e8-121">Le recomendamos que permita esta dirección IP en cualquiera de las directivas de firewall local.</span><span class="sxs-lookup"><span data-stu-id="b45e8-121">We recommend that you allow this IP address in any local firewall policies.</span></span> <span data-ttu-id="b45e8-122">No debería se considera un riesgo de seguridad porque solo Hola interno de la plataforma Azure puede obtener un mensaje procedente de esa dirección.</span><span class="sxs-lookup"><span data-stu-id="b45e8-122">It should not be considered a security risk because only hello internal Azure platform can source a message from that address.</span></span> <span data-ttu-id="b45e8-123">Si no lo hace, habrá un comportamiento inesperado en una variedad de escenarios como la configuración Hola mismo intervalo de direcciones IP de 168.63.129.16 y tener duplicar las direcciones IP.</span><span class="sxs-lookup"><span data-stu-id="b45e8-123">If you do not do this, there will be unexpected behavior in a variety of scenarios like configuring hello same IP address range of 168.63.129.16 and having duplicated IP addresses.</span></span>

## <a name="learn-about-hello-types-of-probes"></a><span data-ttu-id="b45e8-124">Obtenga información acerca de los tipos de Hola de sondeos</span><span class="sxs-lookup"><span data-stu-id="b45e8-124">Learn about hello types of probes</span></span>

### <a name="guest-agent-probe"></a><span data-ttu-id="b45e8-125">Sondeo de agente invitado</span><span class="sxs-lookup"><span data-stu-id="b45e8-125">Guest agent probe</span></span>

<span data-ttu-id="b45e8-126">Este sondeo solo está disponible para Servicios en la nube de Azure.</span><span class="sxs-lookup"><span data-stu-id="b45e8-126">This probe is available for Azure Cloud Services only.</span></span> <span data-ttu-id="b45e8-127">Equilibrador de carga utiliza el agente de invitado de hello dentro de la máquina virtual de hello y, a continuación, escucha y responde con una respuesta HTTP 200 OK solo cuando hello instancia está en estado listo hello (es decir, no en otro estado como ocupado, reciclaje o detener).</span><span class="sxs-lookup"><span data-stu-id="b45e8-127">Load Balancer utilizes hello guest agent inside hello virtual machine, and then listens and responds with an HTTP 200 OK response only when hello instance is in hello Ready state (that is, not in another state such as Busy, Recycling, or Stopping).</span></span>

<span data-ttu-id="b45e8-128">Para obtener más información, consulte [configuración Hola servicio archivo de definición (csdef) para los sondeos de mantenimiento](https://msdn.microsoft.com/library/azure/ee758710.aspx) o [empezar a crear un equilibrador de carga a través de Internet para los servicios de nube](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).</span><span class="sxs-lookup"><span data-stu-id="b45e8-128">For more information, see [Configuring hello service definition file (csdef) for health probes](https://msdn.microsoft.com/library/azure/ee758710.aspx) or [Get started creating an Internet-facing load balancer for cloud services](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).</span></span>

### <a name="what-makes-a-guest-agent-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="b45e8-129">¿Qué hace que un sondeo de agente invitado marque una instancia como en mal estado?</span><span class="sxs-lookup"><span data-stu-id="b45e8-129">What makes a guest agent probe mark an instance as unhealthy?</span></span>

<span data-ttu-id="b45e8-130">Si el agente de invitado hello no toorespond con HTTP 200 OK, marcas de equilibrador de carga de Hola Hola instancia no responde y deja de enviar la instancia de toothat de tráfico.</span><span class="sxs-lookup"><span data-stu-id="b45e8-130">If hello guest agent fails toorespond with HTTP 200 OK, hello load balancer marks hello instance as unresponsive and stops sending traffic toothat instance.</span></span> <span data-ttu-id="b45e8-131">equilibrador de carga de Hello continúa la instancia de hello tooping.</span><span class="sxs-lookup"><span data-stu-id="b45e8-131">hello load balancer continues tooping hello instance.</span></span> <span data-ttu-id="b45e8-132">Si el agente de invitado Hola responde con un HTTP 200, equilibrador de carga de hello envía instancia toothat de tráfico de nuevo.</span><span class="sxs-lookup"><span data-stu-id="b45e8-132">If hello guest agent responds with an HTTP 200, hello load balancer sends traffic toothat instance again.</span></span>

<span data-ttu-id="b45e8-133">Cuando se usa un rol web, el código del sitio Web de hello normalmente se ejecuta en w3wp.exe, que no está supervisado por hello tejido de Azure o el agente de invitado.</span><span class="sxs-lookup"><span data-stu-id="b45e8-133">When you use a web role, hello website code typically runs in w3wp.exe, which is not monitored by hello Azure fabric or guest agent.</span></span> <span data-ttu-id="b45e8-134">Esto significa que los errores en w3wp.exe (por ejemplo, las respuestas de error HTTP 500) no estará incluido toohello agente de invitado, y no tomará el equilibrador de carga de hello esa instancia fuera de la rotación.</span><span class="sxs-lookup"><span data-stu-id="b45e8-134">This means that failures in w3wp.exe (for example, HTTP 500 responses) will not be reported toohello guest agent, and hello load balancer will not take that instance out of rotation.</span></span>

### <a name="http-custom-probe"></a><span data-ttu-id="b45e8-135">Sondeo HTTP personalizado</span><span class="sxs-lookup"><span data-stu-id="b45e8-135">HTTP custom probe</span></span>

<span data-ttu-id="b45e8-136">sondeo de equilibrador de carga de HTTP personalizado Hola invalida sondeo agente de hello predeterminado invitados, lo que significa que puede crear su propio estado de hello toodetermine lógica personalizada de instancia de rol de Hola.</span><span class="sxs-lookup"><span data-stu-id="b45e8-136">hello custom HTTP Load Balancer probe overrides hello default guest agent probe, which means that you can create your own custom logic toodetermine hello health of hello role instance.</span></span> <span data-ttu-id="b45e8-137">equilibrador de carga de Hello sondea el punto de conexión cada 15 segundos, de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="b45e8-137">hello load balancer probes your endpoint every 15 seconds, by default.</span></span> <span data-ttu-id="b45e8-138">instancia de Hola se considera toobe de rotación del equilibrador de carga de hello si responde con un HTTP 200 dentro del período de tiempo de espera de hello (31 segundos de forma predeterminada).</span><span class="sxs-lookup"><span data-stu-id="b45e8-138">hello instance is considered toobe in hello load balancer rotation if it responds with an HTTP 200 within hello timeout period (31 seconds by default).</span></span>

<span data-ttu-id="b45e8-139">Esto puede ser útil si desea tooimplement sus propias instancias de tooremove de lógica de rotación del equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="b45e8-139">This can be useful if you want tooimplement your own logic tooremove instances from load balancer rotation.</span></span> <span data-ttu-id="b45e8-140">Por ejemplo, podría decidir tooremove una instancia si está por encima del 90% de la CPU y devuelve un estado no es 200.</span><span class="sxs-lookup"><span data-stu-id="b45e8-140">For example, you could decide tooremove an instance if it is above 90% CPU and returns a non-200 status.</span></span> <span data-ttu-id="b45e8-141">Si tiene roles de web que utilizan w3wp.exe, esto también significa que tu automática de supervisión del sitio Web, ya que los errores en el código de sitio Web devolverá un sondeo del equilibrador de carga de estado no es 200 toohello.</span><span class="sxs-lookup"><span data-stu-id="b45e8-141">If you have web roles that use w3wp.exe, this also means you get automatic monitoring of your website, because failures in your website code will return a non-200 status toohello load balancer probe.</span></span>

> [!NOTE]
> <span data-ttu-id="b45e8-142">sondeo de Hello HTTP personalizado es compatible con rutas de acceso relativas y sólo en el protocolo HTTP.</span><span class="sxs-lookup"><span data-stu-id="b45e8-142">hello HTTP custom probe supports relative paths and HTTP protocol only.</span></span> <span data-ttu-id="b45e8-143">HTTPS no es compatible.</span><span class="sxs-lookup"><span data-stu-id="b45e8-143">HTTPS is not supported.</span></span>

### <a name="what-makes-an-http-custom-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="b45e8-144">¿Qué hace que un sondeo HTTP personalizado marque una instancia como en mal estado?</span><span class="sxs-lookup"><span data-stu-id="b45e8-144">What makes an HTTP custom probe mark an instance as unhealthy?</span></span>

* <span data-ttu-id="b45e8-145">Hola aplicación HTTP devuelve un código de respuesta HTTP distintos de 200 (por ejemplo, 403, 404 o 500).</span><span class="sxs-lookup"><span data-stu-id="b45e8-145">hello HTTP application returns an HTTP response code other than 200 (for example, 403, 404, or 500).</span></span> <span data-ttu-id="b45e8-146">Se trata de una confirmación positiva que Hola aplicación instancia debe realizarse fuera de servicio inmediatamente.</span><span class="sxs-lookup"><span data-stu-id="b45e8-146">This is a positive acknowledgment that hello application instance should be taken out of service right away.</span></span>
* <span data-ttu-id="b45e8-147">servidor HTTP de Hello no responde en absoluto después del período de tiempo de espera de Hola.</span><span class="sxs-lookup"><span data-stu-id="b45e8-147">hello HTTP server does not respond at all after hello timeout period.</span></span> <span data-ttu-id="b45e8-148">Dependiendo del valor de tiempo de espera de Hola que está establecido, esto podría significar que sondeo varias solicitudes go sin responder antes de sondeo de hello obtiene marcado como no se está ejecutando (es decir, antes de SuccessFailCount sondeos se envían).</span><span class="sxs-lookup"><span data-stu-id="b45e8-148">Depending on hello timeout value that is set, this might mean that multiple probe requests go unanswered before hello probe gets marked as not running (that is, before SuccessFailCount probes are sent).</span></span>
* <span data-ttu-id="b45e8-149">servidor de Hello cierra la conexión de Hola a través de un restablecimiento TCP.</span><span class="sxs-lookup"><span data-stu-id="b45e8-149">hello server closes hello connection via a TCP reset.</span></span>

### <a name="tcp-custom-probe"></a><span data-ttu-id="b45e8-150">Sondeo TCP personalizado</span><span class="sxs-lookup"><span data-stu-id="b45e8-150">TCP custom probe</span></span>

<span data-ttu-id="b45e8-151">TCP sondeos inician una conexión mediante la realización de un protocolo de enlace de tres vías con el puerto de hello definido.</span><span class="sxs-lookup"><span data-stu-id="b45e8-151">TCP probes initiate a connection by performing a three-way handshake with hello defined port.</span></span>

### <a name="what-makes-a-tcp-custom-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="b45e8-152">¿Qué hace que un sondeo TCP personalizado marque una instancia como en mal estado?</span><span class="sxs-lookup"><span data-stu-id="b45e8-152">What makes a TCP custom probe mark an instance as unhealthy?</span></span>

* <span data-ttu-id="b45e8-153">servidor TCP de Hello no responde en absoluto después del período de tiempo de espera de Hola.</span><span class="sxs-lookup"><span data-stu-id="b45e8-153">hello TCP server does not respond at all after hello timeout period.</span></span> <span data-ttu-id="b45e8-154">Cuando se marca el sondeo de hello ya no se está ejecutando depende de número de Hola de sondeo con error solicita que estaban configurado toogo sin responder antes de marcar el sondeo de hello como no se está ejecutando.</span><span class="sxs-lookup"><span data-stu-id="b45e8-154">When hello probe is marked as not running depends on hello number of failed probe requests that were configured toogo unanswered before marking hello probe as not running.</span></span>
* <span data-ttu-id="b45e8-155">sondeo de Hello recibe un TCP de restablecimiento de la instancia de rol de Hola.</span><span class="sxs-lookup"><span data-stu-id="b45e8-155">hello probe receives a TCP reset from hello role instance.</span></span>

<span data-ttu-id="b45e8-156">Para más información sobre cómo configurar un sondeo de estado HTTP o un sondeo TCP, consulte [Introducción a la creación de un equilibrador de carga orientado a Internet en el Administrador de recursos con PowerShell](load-balancer-get-started-internet-arm-ps.md).</span><span class="sxs-lookup"><span data-stu-id="b45e8-156">For more information about configuring an HTTP health probe or a TCP probe, see [Get started creating an Internet-facing load balancer in Resource Manager using PowerShell](load-balancer-get-started-internet-arm-ps.md).</span></span>

## <a name="add-healthy-instances-back-into-load-balancer-rotation"></a><span data-ttu-id="b45e8-157">Incorporación de instancias en estado correcto de nuevo en la rotación del equilibrador de carga</span><span class="sxs-lookup"><span data-stu-id="b45e8-157">Add healthy instances back into load balancer rotation</span></span>

<span data-ttu-id="b45e8-158">Los sondeos de TCP y HTTP se consideran correcto y marcar la instancia de rol de hello como correcto cuando:</span><span class="sxs-lookup"><span data-stu-id="b45e8-158">TCP and HTTP probes are considered healthy and mark hello role instance as healthy when:</span></span>

* <span data-ttu-id="b45e8-159">equilibrador de carga de Hello Obtiene un sondeo positivo Hola primera hora Hola que arranca la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="b45e8-159">hello load balancer gets a positive probe hello first time hello VM boots.</span></span>
* <span data-ttu-id="b45e8-160">número de Hello SuccessFailCount (descrito anteriormente) define valor Hola de sondeos correcta que las instancias de rol de hello toomark necesarios como correcto.</span><span class="sxs-lookup"><span data-stu-id="b45e8-160">hello number SuccessFailCount (described earlier) defines hello value of successful probes that are required toomark hello role instance as healthy.</span></span> <span data-ttu-id="b45e8-161">Si se ha quitado una instancia de rol, número de Hola de sondeos correcta, sucesivas igual o superior a valor Hola de instancia de rol de hello SuccessFailCount toomark como en ejecución.</span><span class="sxs-lookup"><span data-stu-id="b45e8-161">If a role instance was removed, hello number of successful, successive probes must equal or exceed hello value of SuccessFailCount toomark hello role instance as running.</span></span>

> [!NOTE]
> <span data-ttu-id="b45e8-162">Si el estado de saludo de una instancia de rol está fluctuando, equilibrador de carga de hello espera más tiempo antes de poner la instancia de rol de hello en el estado correcto de Hola.</span><span class="sxs-lookup"><span data-stu-id="b45e8-162">If hello health of a role instance is fluctuating, hello load balancer waits longer before putting hello role instance back in hello healthy state.</span></span> <span data-ttu-id="b45e8-163">Esto se realiza mediante la infraestructura de Hola y usuarios de Hola de tooprotect de directiva.</span><span class="sxs-lookup"><span data-stu-id="b45e8-163">This is done via policy tooprotect hello user and hello infrastructure.</span></span>

## <a name="use-log-analytics-for-load-balancer"></a><span data-ttu-id="b45e8-164">Uso del análisis de registros para el Equilibrador de carga</span><span class="sxs-lookup"><span data-stu-id="b45e8-164">Use log analytics for Load Balancer</span></span>

<span data-ttu-id="b45e8-165">Puede usar [análisis de registros para el equilibrador de carga](load-balancer-monitor-log.md) toocheck Hola mantenimiento estado y sondeo recuento de sondeo.</span><span class="sxs-lookup"><span data-stu-id="b45e8-165">You can use [log analytics for Load Balancer](load-balancer-monitor-log.md) toocheck on hello probe health status and probe count.</span></span> <span data-ttu-id="b45e8-166">El registro puede usarse con tooprovide de Power BI o visión operativa de Azure, las estadísticas sobre el estado de mantenimiento de equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="b45e8-166">Logging can be used with Power BI or Azure Operational Insights tooprovide statistics about Load Balancer health status.</span></span>

---
title: "Resolución de máquinas virtuales e instancias de rol"
description: "Escenarios de resolución de nombres para IaaS de Azure, soluciones híbridas, entre servicios en la nube diferentes, Active Directory y con su propio servidor DNS  "
services: virtual-network
documentationcenter: na
author: GarethBradshawMSFT
manager: carmonm
editor: tysonn
ms.assetid: 5d73edde-979a-470a-b28c-e103fcf07e3e
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 12/06/2016
ms.author: telmos
ms.openlocfilehash: 479cf8cf358d0b242d8ce030d8639b493e4767d8
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="name-resolution-for-vms-and-role-instances"></a><span data-ttu-id="52344-103">Resolución de nombres para las máquinas virtuales e instancias de rol</span><span class="sxs-lookup"><span data-stu-id="52344-103">Name Resolution for VMs and Role Instances</span></span>
<span data-ttu-id="52344-104">Dependiendo de cómo utilice Azure para hospedar la IaaS, la PaaS y las soluciones híbridas, puede que necesite permitir que las máquinas virtuales y las instancias de rol creadas se comuniquen entre sí.</span><span class="sxs-lookup"><span data-stu-id="52344-104">Depending on how you use Azure to host IaaS, PaaS, and hybrid solutions, you may need to allow the VMs and role instances that you create to communicate with each other.</span></span> <span data-ttu-id="52344-105">Aunque este tipo de comunicación puede realizarse mediante las direcciones IP, es mucho más sencillo usar nombres ya que podrá recordarlos con más facilidad y no cambiarlos.</span><span class="sxs-lookup"><span data-stu-id="52344-105">Although this communication can be done by using IP addresses, it is much simpler to use names that can be easily remembered and do not change.</span></span> 

<span data-ttu-id="52344-106">Cuando las instancias de rol y las máquinas virtuales hospedadas en Azure necesitan resolver nombres de dominio en direcciones IP internas, pueden usar uno de dos métodos:</span><span class="sxs-lookup"><span data-stu-id="52344-106">When role instances and VMs hosted in Azure need to resolve domain names to internal IP addresses, they can use one of two methods:</span></span>

* [<span data-ttu-id="52344-107">Resolución de nombres de Azure</span><span class="sxs-lookup"><span data-stu-id="52344-107">Azure-provided name resolution</span></span>](#azure-provided-name-resolution)
* <span data-ttu-id="52344-108">[Resolución de nombres mediante su propio servidor DNS](#name-resolution-using-your-own-dns-server) (que puede reenviar consultas a los servidores DNS proporcionados por Azure)</span><span class="sxs-lookup"><span data-stu-id="52344-108">[Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server) (which may forward queries to the Azure-provided DNS servers)</span></span> 

<span data-ttu-id="52344-109">El tipo de resolución de nombres que tenga que usar dependerá de cómo se comuniquen las máquinas virtuales y las instancias de rol entre sí.</span><span class="sxs-lookup"><span data-stu-id="52344-109">The type of name resolution you use depends on how your VMs and role instances need to communicate with each other.</span></span>

<span data-ttu-id="52344-110">**La siguiente tabla muestra los escenarios y las soluciones de resolución de nombre correspondientes:**</span><span class="sxs-lookup"><span data-stu-id="52344-110">**The following table illustrates scenarios and corresponding name resolution solutions:**</span></span>

| <span data-ttu-id="52344-111">**Escenario**</span><span class="sxs-lookup"><span data-stu-id="52344-111">**Scenario**</span></span> | <span data-ttu-id="52344-112">**Solución**</span><span class="sxs-lookup"><span data-stu-id="52344-112">**Solution**</span></span> | <span data-ttu-id="52344-113">**Sufijo**</span><span class="sxs-lookup"><span data-stu-id="52344-113">**Suffix**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="52344-114">Resolución de nombres entre instancias de rol o máquinas virtuales ubicadas en el mismo servicio en la nube o red virtual.</span><span class="sxs-lookup"><span data-stu-id="52344-114">Name resolution between role instances or VMs located in the same cloud service or virtual network</span></span> |[<span data-ttu-id="52344-115">Resolución de nombres de Azure</span><span class="sxs-lookup"><span data-stu-id="52344-115">Azure-provided name resolution</span></span>](#azure-provided-name-resolution) |<span data-ttu-id="52344-116">Nombre de host o FQDN</span><span class="sxs-lookup"><span data-stu-id="52344-116">hostname or FQDN</span></span> |
| <span data-ttu-id="52344-117">Resolución de nombres entre instancias de rol o máquinas virtuales ubicadas en diferentes redes virtuales</span><span class="sxs-lookup"><span data-stu-id="52344-117">Name resolution between role instances or VMs located in different virtual networks</span></span> |<span data-ttu-id="52344-118">Servidores DNS administrados por el cliente que reenvían consultas entre redes virtuales para la resolución mediante Azure (proxy DNS).</span><span class="sxs-lookup"><span data-stu-id="52344-118">Customer-managed DNS servers forwarding queries between vnets for resolution by Azure (DNS proxy).</span></span>  <span data-ttu-id="52344-119">Consulte [Resolución de nombres mediante su propio servidor DNS](#name-resolution-using-your-own-dns-server)</span><span class="sxs-lookup"><span data-stu-id="52344-119">see [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server)</span></span> |<span data-ttu-id="52344-120">Solo FQDN</span><span class="sxs-lookup"><span data-stu-id="52344-120">FQDN only</span></span> |
| <span data-ttu-id="52344-121">Resolución de nombres de servicios y de equipos locales desde instancias de rol o máquinas virtuales en Azure</span><span class="sxs-lookup"><span data-stu-id="52344-121">Resolution of on-premises computer and service names from role instances or VMs in Azure</span></span> |<span data-ttu-id="52344-122">Servidores DNS administrados por el cliente (por ejemplo, controlador de dominio local, controlador de dominio de solo lectura local o un DNS secundario sincronizado usando transferencias de zona).</span><span class="sxs-lookup"><span data-stu-id="52344-122">Customer-managed DNS servers (e.g. on-premises domain controller, local read-only domain controller or a DNS secondary synced using zone transfers).</span></span>  <span data-ttu-id="52344-123">See [Resolución de nombres mediante su propio servidor DNS](#name-resolution-using-your-own-dns-server)</span><span class="sxs-lookup"><span data-stu-id="52344-123">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server)</span></span> |<span data-ttu-id="52344-124">Solo FQDN</span><span class="sxs-lookup"><span data-stu-id="52344-124">FQDN only</span></span> |
| <span data-ttu-id="52344-125">Resolución de nombres de host de Azure desde equipos locales</span><span class="sxs-lookup"><span data-stu-id="52344-125">Resolution of Azure hostnames from on-premises computers</span></span> |<span data-ttu-id="52344-126">Reenvío de consultas a un servidor proxy DNS administrado por el cliente en la red virtual correspondiente: el servidor proxy reenvía consultas a Azure para su resolución.</span><span class="sxs-lookup"><span data-stu-id="52344-126">Forward queries to a customer-managed DNS proxy server in the corresponding vnet, the proxy server forwards queries to Azure for resolution.</span></span> <span data-ttu-id="52344-127">See [Resolución de nombres mediante su propio servidor DNS](#name-resolution-using-your-own-dns-server)</span><span class="sxs-lookup"><span data-stu-id="52344-127">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server)</span></span> |<span data-ttu-id="52344-128">Solo FQDN</span><span class="sxs-lookup"><span data-stu-id="52344-128">FQDN only</span></span> |
| <span data-ttu-id="52344-129">DNS inverso para direcciones IP internas</span><span class="sxs-lookup"><span data-stu-id="52344-129">Reverse DNS for internal IPs</span></span> |[<span data-ttu-id="52344-130">Resolución de nombres mediante su propio servidor DNS</span><span class="sxs-lookup"><span data-stu-id="52344-130">Name resolution using your own DNS server</span></span>](#name-resolution-using-your-own-dns-server) |<span data-ttu-id="52344-131">N/D</span><span class="sxs-lookup"><span data-stu-id="52344-131">n/a</span></span> |
| <span data-ttu-id="52344-132">Resolución de nombres entre máquinas virtuales o instancias de rol ubicadas en diferentes servicios en la nube y no en una red virtual</span><span class="sxs-lookup"><span data-stu-id="52344-132">Name resolution between VMs or role instances located in different cloud services, not in a virtual network</span></span> |<span data-ttu-id="52344-133">No aplicable.</span><span class="sxs-lookup"><span data-stu-id="52344-133">Not applicable.</span></span> <span data-ttu-id="52344-134">La conectividad entre máquinas virtuales e instancias de rol de servicios en la nube diferentes no es compatible fuera de una red virtual.</span><span class="sxs-lookup"><span data-stu-id="52344-134">Connectivity between VMs and role instances in different cloud services is not supported outside a virtual network.</span></span> |<span data-ttu-id="52344-135">N/D</span><span class="sxs-lookup"><span data-stu-id="52344-135">n/a</span></span> |

## <a name="azure-provided-name-resolution"></a><span data-ttu-id="52344-136">Resolución de nombres de Azure</span><span class="sxs-lookup"><span data-stu-id="52344-136">Azure-provided name resolution</span></span>
<span data-ttu-id="52344-137">Junto con la resolución de nombres DNS públicos, Azure proporciona una resolución de nombres interna para máquinas virtuales e instancias de rol que residen dentro de la misma red virtual o servicio en la nube.</span><span class="sxs-lookup"><span data-stu-id="52344-137">Along with resolution of public DNS names, Azure provides internal name resolution for VMs and role instances that reside within the same virtual network or cloud service.</span></span>  <span data-ttu-id="52344-138">Las máquinas virtuales y las instancias de un servicio en la nube comparten el mismo sufijo DNS (por lo que es suficiente con el nombre de host solo) pero, en las redes virtuales clásicas, los distintos servicios en la nube tienen sufijos DNS diferentes, por lo que se necesita el FQDN para resolver nombres entre diferentes servicios en la nube.</span><span class="sxs-lookup"><span data-stu-id="52344-138">VMs/instances in a cloud service share the same DNS suffix (so the hostname alone is sufficient) but in classic virtual networks different cloud services have different DNS suffixes so the FQDN is needed to resolve names between different cloud services.</span></span>  <span data-ttu-id="52344-139">En las redes virtuales basadas en el modelo de implementación de Resource Manager, el sufijo DNS es coherente en toda la red virtual (por lo que no es necesario el FQDN), y los nombres DNS pueden asignarse tanto a las NIC como a las máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="52344-139">In virtual networks in the Resource Manager deployment model, the DNS suffix is consistent across the virtual network (so the FQDN is not needed) and DNS names can be assigned to both NICs and VMs.</span></span> <span data-ttu-id="52344-140">Aunque la resolución de nombres que proporciona Azure no necesita ningún tipo de configuración, no es la opción más adecuada para todos los escenarios de implementación, tal y como se mostró en la tabla anterior.</span><span class="sxs-lookup"><span data-stu-id="52344-140">Although Azure-provided name resolution does not require any configuration, it is not the appropriate choice for all deployment scenarios, as seen on the table above.</span></span>

> [!NOTE]
> <span data-ttu-id="52344-141">En el caso de los roles web y de trabajo, puede acceder a las direcciones IP internas de las instancias de rol que estén basadas en el nombre de rol y el número de instancia, mediante la API de REST de la Administración de servicios de Azure.</span><span class="sxs-lookup"><span data-stu-id="52344-141">In the case of web and worker roles, you can also access the internal IP addresses of role instances based on the role name and instance number using the Azure Service Management REST API.</span></span> <span data-ttu-id="52344-142">Para obtener más información, consulte la [Referencia de la API de REST de la administración de servicios](https://msdn.microsoft.com/library/azure/ee460799.aspx).</span><span class="sxs-lookup"><span data-stu-id="52344-142">For more information, see [Service Management REST API Reference](https://msdn.microsoft.com/library/azure/ee460799.aspx).</span></span>
> 
> 

### <a name="features-and-considerations"></a><span data-ttu-id="52344-143">Características y consideraciones</span><span class="sxs-lookup"><span data-stu-id="52344-143">Features and Considerations</span></span>
<span data-ttu-id="52344-144">**Características**</span><span class="sxs-lookup"><span data-stu-id="52344-144">**Features:**</span></span>

* <span data-ttu-id="52344-145">Facilidad de uso: no es necesario realizar configuración alguna para usar la resolución de nombres proporcionada por Azure.</span><span class="sxs-lookup"><span data-stu-id="52344-145">Ease of use: No configuration is required in order to use Azure-provided name resolution.</span></span>
* <span data-ttu-id="52344-146">El servicio de resolución de nombres de Azure es altamente disponible y evita la creación y administración de clústeres de sus propios servidores DNS.</span><span class="sxs-lookup"><span data-stu-id="52344-146">The Azure-provided name resolution service is highly available, saving you the need to create and manage clusters of your own DNS servers.</span></span>
* <span data-ttu-id="52344-147">Se puede utilizar junto con sus propios servidores DNS para resolver nombres de host de Azure y locales.</span><span class="sxs-lookup"><span data-stu-id="52344-147">Can be used in conjunction with your own DNS servers to resolve both on-premises and Azure hostnames.</span></span>
* <span data-ttu-id="52344-148">Las instancias de rol o las máquinas virtuales que están dentro del mismo servicio en la nube son las que proporcionan la resolución de nombres sin necesidad de un nombre de dominio completo.</span><span class="sxs-lookup"><span data-stu-id="52344-148">Name resolution is provided between role instances/VMs within the same cloud service without need for a FQDN.</span></span>
* <span data-ttu-id="52344-149">Se proporciona resolución de nombres entre las máquinas virtuales en redes virtuales que usan el modelo de implementación de Resource Manager, sin necesidad de FQDN.</span><span class="sxs-lookup"><span data-stu-id="52344-149">Name resolution is provided between VMs in virtual networks that use the Resource Manager deployment model, without need for the FQDN.</span></span> <span data-ttu-id="52344-150">En el modelo de implementación clásico, las redes virtuales requieren el FQDN para resolver nombres en diferentes servicios en la nube.</span><span class="sxs-lookup"><span data-stu-id="52344-150">Virtual networks in the classic deployment model require the FQDN when resolving names in different cloud services.</span></span> 
* <span data-ttu-id="52344-151">Puede usar los nombres de host que describan mejor las implementaciones, en lugar de trabajar con nombres generados automáticamente.</span><span class="sxs-lookup"><span data-stu-id="52344-151">You can use hostnames that best describe your deployments, rather than working with auto-generated names.</span></span>

<span data-ttu-id="52344-152">**Consideraciones:**</span><span class="sxs-lookup"><span data-stu-id="52344-152">**Considerations:**</span></span>

* <span data-ttu-id="52344-153">No se puede modificar el sufijo DNS creado por Azure.</span><span class="sxs-lookup"><span data-stu-id="52344-153">The Azure-created DNS suffix cannot be modified.</span></span>
* <span data-ttu-id="52344-154">No se pueden registrar manualmente los registros propios.</span><span class="sxs-lookup"><span data-stu-id="52344-154">You cannot manually register your own records.</span></span>
* <span data-ttu-id="52344-155">No se admiten ni WINS ni NetBIOS.</span><span class="sxs-lookup"><span data-stu-id="52344-155">WINS and NetBIOS are not supported.</span></span> <span data-ttu-id="52344-156">(Las máquinas virtuales no se pueden ver en el Explorador de Windows).</span><span class="sxs-lookup"><span data-stu-id="52344-156">(You cannot see your VMs in Windows Explorer.)</span></span>
* <span data-ttu-id="52344-157">Los nombres de host deben ser compatibles con el DNS (solamente pueden usar los caracteres 0-9, a-z y “-” y no pueden comenzar ni terminar con un “-”.</span><span class="sxs-lookup"><span data-stu-id="52344-157">Hostnames must be DNS-compatible (They must use only 0-9, a-z and '-', and cannot start or end with a '-'.</span></span> <span data-ttu-id="52344-158">Consulte la sección 2 de RFC 3696).</span><span class="sxs-lookup"><span data-stu-id="52344-158">See RFC 3696 section 2.)</span></span>
* <span data-ttu-id="52344-159">El tráfico de consultas de DNS está limitado por cada máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="52344-159">DNS query traffic is throttled for each VM.</span></span> <span data-ttu-id="52344-160">Esto no debería afectar a la mayoría de las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="52344-160">This shouldn't impact most applications.</span></span>  <span data-ttu-id="52344-161">Si se observa una limitación de solicitudes, asegúrese de que está habilitado el almacenamiento en caché del lado cliente.</span><span class="sxs-lookup"><span data-stu-id="52344-161">If request throttling is observed, ensure that client-side caching is enabled.</span></span>  <span data-ttu-id="52344-162">Para obtener más información, consulte [Obtención del máximo partido de la resolución de nombres de Azure](#Getting-the-most-from-Azure-provided-name-resolution).</span><span class="sxs-lookup"><span data-stu-id="52344-162">For more details, see [Getting the most from Azure-provided name resolution](#Getting-the-most-from-Azure-provided-name-resolution).</span></span>
* <span data-ttu-id="52344-163">En un modelo de implementación clásico, solo se registran las máquinas virtuales de los 180 primeros servicios en la nube para cada red virtual clásica.</span><span class="sxs-lookup"><span data-stu-id="52344-163">Only VMs in the first 180 cloud services are registered for each virtual network in a classic deployment model.</span></span> <span data-ttu-id="52344-164">Esto no se aplica a las redes virtuales en los modelos de implementación de Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="52344-164">This does not apply to virtual networks in Resource Manager deployment models.</span></span>

### <a name="getting-the-most-from-azure-provided-name-resolution"></a><span data-ttu-id="52344-165">Obtención del máximo partido de la resolución de nombres de Azure</span><span class="sxs-lookup"><span data-stu-id="52344-165">Getting the most from Azure-provided name resolution</span></span>
<span data-ttu-id="52344-166">**Almacenamiento en caché del lado cliente:**</span><span class="sxs-lookup"><span data-stu-id="52344-166">**Client-side Caching:**</span></span>

<span data-ttu-id="52344-167">No todas las consultas DNS deben enviarse a través de la red.</span><span class="sxs-lookup"><span data-stu-id="52344-167">Not every DNS query needs to be sent across the network.</span></span>  <span data-ttu-id="52344-168">El almacenamiento en caché del lado cliente ayuda a reducir la latencia y mejorar la resistencia a la señalización visual de la red mediante la resolución de las consultas DNS periódicas desde una caché local.</span><span class="sxs-lookup"><span data-stu-id="52344-168">Client-side caching helps reduce latency and improve resilience to network blips by resolving recurring DNS queries from a local cache.</span></span>  <span data-ttu-id="52344-169">Los registros DNS contienen un período de vida (TTL) que permite a la memoria caché almacenar el registro tanto como sea posible sin afectar a la actualización de registros, por lo que el almacenamiento en caché de cliente es adecuado para la mayoría de las situaciones.</span><span class="sxs-lookup"><span data-stu-id="52344-169">DNS records contain a Time-To-Live (TTL) which allows the cache to store the record for as long as possible without impacting record freshness, so client-side caching is suitable for most situations.</span></span>

<span data-ttu-id="52344-170">El cliente DNS de Windows predeterminado tiene una memoria caché DNS integrada.</span><span class="sxs-lookup"><span data-stu-id="52344-170">The default Windows DNS Client has a DNS cache built-in.</span></span>  <span data-ttu-id="52344-171">Algunas distribuciones Linux no incluyen el almacenamiento en caché de forma predeterminada; se recomienda que se agregue una a cada máquina virtual Linux (después de comprobar que aún no hay una memoria caché local).</span><span class="sxs-lookup"><span data-stu-id="52344-171">Some Linux distros do not include caching by default, it is recommended that one be added to each Linux VM (after checking that there isn't a local cache already).</span></span>

<span data-ttu-id="52344-172">Hay una serie de distintos paquetes de almacenamiento en caché DNS disponibles, p. ej., dnsmasq; estos son los pasos para instalar dnsmasq en las distribuciones más comunes:</span><span class="sxs-lookup"><span data-stu-id="52344-172">There are a number of different DNS caching packages available, e.g. dnsmasq, here are the steps to install dnsmasq on the most common distros:</span></span>

* <span data-ttu-id="52344-173">**Ubuntu (usa resolvconf)**:</span><span class="sxs-lookup"><span data-stu-id="52344-173">**Ubuntu (uses resolvconf)**:</span></span>
  * <span data-ttu-id="52344-174">instalar únicamente el paquete dnsmasq ("sudo apt-get install dnsmasq")</span><span class="sxs-lookup"><span data-stu-id="52344-174">just install the dnsmasq package (“sudo apt-get install dnsmasq”).</span></span>
* <span data-ttu-id="52344-175">**SUSE (usa netconf)**:</span><span class="sxs-lookup"><span data-stu-id="52344-175">**SUSE (uses netconf)**:</span></span>
  * <span data-ttu-id="52344-176">instalar el paquete dnsmasq ("sudo apt-get install dnsmasq")</span><span class="sxs-lookup"><span data-stu-id="52344-176">install the dnsmasq package (“sudo zypper install dnsmasq”)</span></span> 
  * <span data-ttu-id="52344-177">habilitar el servicio de dnsmasq ("systemctl enable dnsmasq.service")</span><span class="sxs-lookup"><span data-stu-id="52344-177">enable the dnsmasq service (“systemctl enable dnsmasq.service”)</span></span> 
  * <span data-ttu-id="52344-178">iniciar el servicio de dnsmasq ("systemctl start dnsmasq.service")</span><span class="sxs-lookup"><span data-stu-id="52344-178">start the dnsmasq service (“systemctl start dnsmasq.service”)</span></span> 
  * <span data-ttu-id="52344-179">editar “/etc/sysconfig/network/config” y cambie NETCONFIG_DNS_FORWARDER="" por ”dnsmasq”</span><span class="sxs-lookup"><span data-stu-id="52344-179">edit “/etc/sysconfig/network/config” and change NETCONFIG_DNS_FORWARDER="" to ”dnsmasq”</span></span>
  * <span data-ttu-id="52344-180">actualizar resolv.conf ("netconfig update") para establecer la memoria caché como el solucionador DNS local</span><span class="sxs-lookup"><span data-stu-id="52344-180">update resolv.conf ("netconfig update") to set the cache as the local DNS resolver</span></span>
* <span data-ttu-id="52344-181">**OpenLogic (usa NetworkManager)**:</span><span class="sxs-lookup"><span data-stu-id="52344-181">**OpenLogic (uses NetworkManager)**:</span></span>
  * <span data-ttu-id="52344-182">instalar el paquete dnsmasq ("sudo yum install dnsmasq")</span><span class="sxs-lookup"><span data-stu-id="52344-182">install the dnsmasq package (“sudo yum install dnsmasq”)</span></span>
  * <span data-ttu-id="52344-183">habilitar el servicio de dnsmasq ("systemctl enable dnsmasq.service")</span><span class="sxs-lookup"><span data-stu-id="52344-183">enable the dnsmasq service (“systemctl enable dnsmasq.service”)</span></span>
  * <span data-ttu-id="52344-184">iniciar el servicio de dnsmasq ("systemctl start dnsmasq.service")</span><span class="sxs-lookup"><span data-stu-id="52344-184">start the dnsmasq service (“systemctl start dnsmasq.service”)</span></span>
  * <span data-ttu-id="52344-185">agregar “prepend domain-name-servers 127.0.0.1;” en “/etc/dhclient-eth0.conf”</span><span class="sxs-lookup"><span data-stu-id="52344-185">add “prepend domain-name-servers 127.0.0.1;” to “/etc/dhclient-eth0.conf”</span></span>
  * <span data-ttu-id="52344-186">reiniciar el servicio de red ("service network restart") para establecer la memoria caché como el solucionador DNS local</span><span class="sxs-lookup"><span data-stu-id="52344-186">restart the network service (“service network restart”) to set the cache as the local DNS resolver</span></span>

> [!NOTE]
> <span data-ttu-id="52344-187">El paquete 'dnsmasq' es solo una de las muchas cachés DNS disponibles para Linux.</span><span class="sxs-lookup"><span data-stu-id="52344-187">The 'dnsmasq' package is only one of the many DNS caches available for Linux.</span></span>  <span data-ttu-id="52344-188">Antes de usarlo, compruebe su idoneidad para sus necesidades concretas y que no se instale ninguna otra memoria caché.</span><span class="sxs-lookup"><span data-stu-id="52344-188">Before using it, please check its suitability for your particular needs and that no other cache is installed.</span></span>
> 
> 

<span data-ttu-id="52344-189">**Reintentos de cliente:**</span><span class="sxs-lookup"><span data-stu-id="52344-189">**Client-side Retries:**</span></span>

<span data-ttu-id="52344-190">DNS es principalmente un protocolo UDP.</span><span class="sxs-lookup"><span data-stu-id="52344-190">DNS is primarily a UDP protocol.</span></span>  <span data-ttu-id="52344-191">Como el protocolo UDP no garantiza la entrega de mensajes, la lógica de reintento se controla en el mismo protocolo DNS.</span><span class="sxs-lookup"><span data-stu-id="52344-191">As the UDP protocol doesn't guarantee message delivery, retry logic is handled in the DNS protocol itself.</span></span>  <span data-ttu-id="52344-192">Cada cliente DNS (sistema operativo) puede presentar una lógica de reintento diferente, dependiendo de la preferencia de los creadores:</span><span class="sxs-lookup"><span data-stu-id="52344-192">Each DNS client (operating system) can exhibit different retry logic depending on the creators preference:</span></span>

* <span data-ttu-id="52344-193">Los sistemas operativos Windows realizan un intento tras un segundo y después tras otros 2, 4 y otros 4 segundos.</span><span class="sxs-lookup"><span data-stu-id="52344-193">Windows operating systems retry after 1 second and then again after another 2, 4 and another 4 seconds.</span></span> 
* <span data-ttu-id="52344-194">El programa de instalación predeterminado de Linux lo intenta después de 5 segundos.</span><span class="sxs-lookup"><span data-stu-id="52344-194">The default Linux setup retries after 5 seconds.</span></span>  <span data-ttu-id="52344-195">Se recomienda cambiar esta opción para reintentarlo 5 veces a intervalos de 1 segundo.</span><span class="sxs-lookup"><span data-stu-id="52344-195">It is recommended to change this to retry 5 times at 1 second intervals.</span></span>  

<span data-ttu-id="52344-196">Para comprobar la configuración actual en una máquina virtual Linux, 'cat /etc/resolv.conf' y busque la línea 'options', p. ej.:</span><span class="sxs-lookup"><span data-stu-id="52344-196">To check the current settings on a Linux VM, 'cat /etc/resolv.conf' and look at the 'options' line, e.g.:</span></span>

    options timeout:1 attempts:5

<span data-ttu-id="52344-197">El archivo resolv.conf suele ser autogenerado y no se debe editar.</span><span class="sxs-lookup"><span data-stu-id="52344-197">The resolv.conf file is usually auto-generated and should not be edited.</span></span>  <span data-ttu-id="52344-198">Los pasos específicos para agregar la línea 'options' varían según la distribución:</span><span class="sxs-lookup"><span data-stu-id="52344-198">The specific steps for adding the 'options' line vary by distro:</span></span>

* <span data-ttu-id="52344-199">**Ubuntu** (usa resolvconf):</span><span class="sxs-lookup"><span data-stu-id="52344-199">**Ubuntu** (uses resolvconf):</span></span>
  * <span data-ttu-id="52344-200">agregar la línea de opciones a '/ etc/resolveconf/resolv.conf.d/head'</span><span class="sxs-lookup"><span data-stu-id="52344-200">add the options line to '/etc/resolveconf/resolv.conf.d/head'</span></span> 
  * <span data-ttu-id="52344-201">ejecutar 'resolvconf -u' para actualizar</span><span class="sxs-lookup"><span data-stu-id="52344-201">run 'resolvconf -u' to update</span></span>
* <span data-ttu-id="52344-202">**SUSE** (usa netconf):</span><span class="sxs-lookup"><span data-stu-id="52344-202">**SUSE** (uses netconf):</span></span>
  * <span data-ttu-id="52344-203">agregar 'timeout:1 attempts:5' al parámetro NETCONFIG_DNS_RESOLVER_OPTIONS="" en '/etc/sysconfig/network/config'</span><span class="sxs-lookup"><span data-stu-id="52344-203">add 'timeout:1 attempts:5' to the NETCONFIG_DNS_RESOLVER_OPTIONS="" parameter in '/etc/sysconfig/network/config'</span></span> 
  * <span data-ttu-id="52344-204">ejecutar 'netconfig update' para actualizar</span><span class="sxs-lookup"><span data-stu-id="52344-204">run 'netconfig update' to update</span></span>
* <span data-ttu-id="52344-205">**OpenLogic** (usa NetworkManager):</span><span class="sxs-lookup"><span data-stu-id="52344-205">**OpenLogic** (uses NetworkManager):</span></span>
  * <span data-ttu-id="52344-206">agregar 'echo "options timeout:1 attempts:5"' a '/etc/NetworkManager/dispatcher.d/11-dhclient'</span><span class="sxs-lookup"><span data-stu-id="52344-206">add 'echo "options timeout:1 attempts:5"' to '/etc/NetworkManager/dispatcher.d/11-dhclient'</span></span> 
  * <span data-ttu-id="52344-207">ejecutar 'service network restart' para actualizar</span><span class="sxs-lookup"><span data-stu-id="52344-207">run 'service network restart' to update</span></span>

## <a name="name-resolution-using-your-own-dns-server"></a><span data-ttu-id="52344-208">Resolución de nombres mediante su propio servidor DNS</span><span class="sxs-lookup"><span data-stu-id="52344-208">Name resolution using your own DNS server</span></span>
<span data-ttu-id="52344-209">Hay una serie de situaciones donde sus necesidades de resolución de nombres pueden ir más allá de las características proporcionadas por Azure, por ejemplo, cuando se usan dominios de Active Directory o cuando se requiere la resolución de DNS entre redes virtuales.</span><span class="sxs-lookup"><span data-stu-id="52344-209">There are a number of situations where your name resolution needs may go beyond the features provided by Azure, for example when using Active Directory domains or when you require DNS resolution between virtual networks (vnets).</span></span>  <span data-ttu-id="52344-210">Para abarcar estos escenarios, Azure le ofrece la posibilidad de que use sus propios servidores DNS.</span><span class="sxs-lookup"><span data-stu-id="52344-210">To cover these scenarios, Azure provides the ability for you to use your own DNS servers.</span></span>  

<span data-ttu-id="52344-211">Los servidores DNS de una red virtual pueden reenviar consultas DNS a resoluciones recursivas de Azure para resolver los nombres de host en la red virtual.</span><span class="sxs-lookup"><span data-stu-id="52344-211">DNS servers within a virtual network can forward DNS queries to Azure's recursive resolvers to resolve hostnames within that virtual network.</span></span>  <span data-ttu-id="52344-212">Por ejemplo, un controlador de dominio (DC) que se ejecute en Azure puede responder a las consultas DNS referidas a sus dominios y reenviar todas las demás consultas a Azure.</span><span class="sxs-lookup"><span data-stu-id="52344-212">For example, a Domain Controller (DC) running in Azure can respond to DNS queries for its domains and forward all other queries to Azure.</span></span>  <span data-ttu-id="52344-213">Esto permite que las máquinas virtuales vean sus recursos locales (mediante el controlador de dominio) y los nombres de host proporcionados por Azure (mediante el reenviador).</span><span class="sxs-lookup"><span data-stu-id="52344-213">This allows VMs to see both your on-premises resources (via the DC) and Azure-provided hostnames (via the forwarder).</span></span>  <span data-ttu-id="52344-214">El acceso a las resoluciones recursivas de Azure se proporciona a través de la IP virtual 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="52344-214">Access to Azure's recursive resolvers is provided via the virtual IP 168.63.129.16.</span></span>

<span data-ttu-id="52344-215">El reenvío de DNS también habilita la resolución de DNS entre redes virtuales y permite que los equipos locales resuelvan nombres de host proporcionados por Azure.</span><span class="sxs-lookup"><span data-stu-id="52344-215">DNS forwarding also enables inter-vnet DNS resolution and allows your on-premises machines to resolve Azure-provided hostnames.</span></span>  <span data-ttu-id="52344-216">Para resolver el nombre de host de una máquina virtual, la máquina virtual del servidor DNS debe residir en la misma red virtual y debe configurarse para reenviar consultas de nombre de host a Azure.</span><span class="sxs-lookup"><span data-stu-id="52344-216">In order to resolve a VM's hostname, the DNS server VM must reside in the same virtual network and be configured to forward hostname queries to Azure.</span></span>  <span data-ttu-id="52344-217">Como el sufijo DNS es diferente en cada red virtual, puede usar las reglas de reenvío condicional para enviar consultas DNS a la red virtual correcta para su resolución.</span><span class="sxs-lookup"><span data-stu-id="52344-217">As the DNS suffix is different in each vnet, you can use conditional forwarding rules to send DNS queries to the correct vnet for resolution.</span></span>  <span data-ttu-id="52344-218">En la imagen siguiente se muestran dos redes virtuales y una red local que está realizando la resolución DNS entre redes virtuales con este método.</span><span class="sxs-lookup"><span data-stu-id="52344-218">The following image shows two vnets and an on-premises network doing inter-vnet DNS resolution using this method.</span></span>  <span data-ttu-id="52344-219">Puede encontrar un reenviador DNS de ejemplo disponible en la [galería de plantillas de inicio rápido de Azure](https://azure.microsoft.com/documentation/templates/301-dns-forwarder/) y en [GitHub](https://github.com/Azure/azure-quickstart-templates/tree/master/301-dns-forwarder).</span><span class="sxs-lookup"><span data-stu-id="52344-219">An example DNS forwarder is available in the [Azure Quickstart Templates gallery](https://azure.microsoft.com/documentation/templates/301-dns-forwarder/) and [GitHub](https://github.com/Azure/azure-quickstart-templates/tree/master/301-dns-forwarder).</span></span>

![DNS entre redes virtuales](./media/virtual-networks-name-resolution-for-vms-and-role-instances/inter-vnet-dns.png)

<span data-ttu-id="52344-221">Cuando se utiliza la resolución de nombres proporcionada por Azure, se proporciona un sufijo DNS interno (*.internal.cloudapp.net) a cada máquina virtual mediante DHCP.</span><span class="sxs-lookup"><span data-stu-id="52344-221">When using Azure-provided name resolution, an Internal DNS suffix (*.internal.cloudapp.net) is provided to each VM using DHCP.</span></span>  <span data-ttu-id="52344-222">Esto permite la resolución de nombre de host, dado que los registros de nombre de host están en la zona internal.cloudapp.net.</span><span class="sxs-lookup"><span data-stu-id="52344-222">This enables hostname resolution as the hostname records are in the internal.cloudapp.net zone.</span></span>  <span data-ttu-id="52344-223">Cuando se utiliza su propia solución de resolución de nombres, no se proporciona este sufijo a las máquinas virtuales puesto que interfiere con otras arquitecturas DNS (como es el caso de los escenarios de unión a un dominio).</span><span class="sxs-lookup"><span data-stu-id="52344-223">When using your own name resolution solution, the IDNS suffix is not supplied to VMs because it interferes with other DNS architectures (like domain-joined scenarios).</span></span>  <span data-ttu-id="52344-224">En su lugar, proporcionamos un marcador de posición no funcional (reddog.microsoft.com).</span><span class="sxs-lookup"><span data-stu-id="52344-224">Instead we provide a non-functioning placeholder (reddog.microsoft.com).</span></span>  

<span data-ttu-id="52344-225">Si es necesario, el sufijo DNS interno se puede determinar con PowerShell o la API:</span><span class="sxs-lookup"><span data-stu-id="52344-225">If needed, the Internal DNS suffix can be determined using PowerShell or the API:</span></span>

* <span data-ttu-id="52344-226">En el caso de redes virtuales en modelos de implementación de Resource Manager, el sufijo está disponible con el recurso de [tarjeta de interfaz de red](https://msdn.microsoft.com/library/azure/mt163668.aspx) o del cmdlet [Get-AzureRmNetworkInterface](https://msdn.microsoft.com/library/mt619434.aspx).</span><span class="sxs-lookup"><span data-stu-id="52344-226">For virtual networks in Resource Manager deployment models, the suffix is available via the [network interface card](https://msdn.microsoft.com/library/azure/mt163668.aspx) resource or via the [Get-AzureRmNetworkInterface](https://msdn.microsoft.com/library/mt619434.aspx) cmdlet.</span></span>    
* <span data-ttu-id="52344-227">En los modelos de implementación clásico, el sufijo está disponible mediante la llamada a la [API de Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) o por medio del cmdlet [Get-AzureVM -Debug](https://msdn.microsoft.com/library/azure/dn495236.aspx).</span><span class="sxs-lookup"><span data-stu-id="52344-227">In classic deployment models, the suffix is available via the [Get Deployment API](https://msdn.microsoft.com/library/azure/ee460804.aspx) call or via the [Get-AzureVM -Debug](https://msdn.microsoft.com/library/azure/dn495236.aspx) cmdlet.</span></span>

<span data-ttu-id="52344-228">Si el reenvío de consultas a Azure no satisface sus necesidades, debe proporcionar su propia solución de DNS.</span><span class="sxs-lookup"><span data-stu-id="52344-228">If forwarding queries to Azure doesn't suit your needs, you will need to provide your own DNS solution.</span></span>  <span data-ttu-id="52344-229">La solución de DNS deberá cumplir estos requisitos:</span><span class="sxs-lookup"><span data-stu-id="52344-229">Your DNS solution will need to:</span></span>

* <span data-ttu-id="52344-230">Proporcionar la resolución adecuada de nombres de host, por ejemplo, mediante [DDNS](virtual-networks-name-resolution-ddns.md).</span><span class="sxs-lookup"><span data-stu-id="52344-230">Provide appropriate hostname resolution, e.g. via [DDNS](virtual-networks-name-resolution-ddns.md).</span></span>  <span data-ttu-id="52344-231">Tenga en cuenta que si usa DDNS debe deshabilitar la limpieza de registros DNS, ya que las concesiones DHCP de Azure son muy largas y, al efectuar la limpieza, se pueden eliminar los registros DNS prematuramente.</span><span class="sxs-lookup"><span data-stu-id="52344-231">Note, if using DDNS you may need to disable DNS record scavenging as Azure's DHCP leases are very long and scavenging may remove DNS records prematurely.</span></span> 
* <span data-ttu-id="52344-232">Proporcionar la resolución recursiva adecuada para permitir la resolución de nombres de dominio externos.</span><span class="sxs-lookup"><span data-stu-id="52344-232">Provide appropriate recursive resolution to allow resolution of external domain names.</span></span>
* <span data-ttu-id="52344-233">Estar accesible (TCP y UDP en el puerto 53) desde los clientes a los que sirve y poder acceder a Internet.</span><span class="sxs-lookup"><span data-stu-id="52344-233">Be accessible (TCP and UDP on port 53) from the clients it serves and be able to access the internet.</span></span>
* <span data-ttu-id="52344-234">Tener protección contra el acceso desde Internet para mitigar las amenazas que suponen los agentes externos.</span><span class="sxs-lookup"><span data-stu-id="52344-234">Be secured against access from the internet, to mitigate threats posed by external agents.</span></span>

> [!NOTE]
> <span data-ttu-id="52344-235">Para obtener un mejor rendimiento, cuando se usan máquinas virtuales de Azure como servidores DNS, se debe deshabilitar IPv6 y debe asignarse una [IP pública de nivel de instancia](virtual-networks-instance-level-public-ip.md) a cada máquina virtual del servidor DNS.</span><span class="sxs-lookup"><span data-stu-id="52344-235">For best performance, when using Azure VMs as DNS servers, IPv6 should be disabled and an [Instance-Level Public IP](virtual-networks-instance-level-public-ip.md) should be assigned to each DNS server VM.</span></span>  <span data-ttu-id="52344-236">Si opta por usar Windows Server como servidor DNS, en [este artículo](http://blogs.technet.com/b/networking/archive/2015/08/19/name-resolution-performance-of-a-recursive-windows-dns-server-2012-r2.aspx) se proporcionan optimizaciones y análisis de rendimiento adicionales.</span><span class="sxs-lookup"><span data-stu-id="52344-236">If you choose to use Windows Server as your DNS server, [this article](http://blogs.technet.com/b/networking/archive/2015/08/19/name-resolution-performance-of-a-recursive-windows-dns-server-2012-r2.aspx) provides additional performance analysis and optimizations.</span></span>
> 
> 

### <a name="specifying-dns-servers"></a><span data-ttu-id="52344-237">Especificar los servidores DNS</span><span class="sxs-lookup"><span data-stu-id="52344-237">Specifying DNS servers</span></span>
<span data-ttu-id="52344-238">Si usa sus propios servidores DNS, Azure permite especificar varios servidores DNS por red virtual o por interfaz de red (Resource Manager), o por servicio en la nube (clásico).</span><span class="sxs-lookup"><span data-stu-id="52344-238">When using your own DNS servers, Azure provides the ability to specify multiple DNS servers per virtual network or per network interface (Resource Manager) / cloud service (classic).</span></span>  <span data-ttu-id="52344-239">Los servidores DNS especificados para una interfaz de red o un servicio en la nube tienen prioridad sobre las especificadas para la red virtual.</span><span class="sxs-lookup"><span data-stu-id="52344-239">DNS servers specified for a cloud service/network interface get precedence over those specified for the virtual network.</span></span>

> [!NOTE]
> <span data-ttu-id="52344-240">Las propiedades de conexión de red, como las direcciones IP de los servidores DNS, no se deben editar directamente en las máquinas virtuales de Windows, porque podrían borrarse al reemplazar el adaptador de red virtual durante el trabajo de mantenimiento.</span><span class="sxs-lookup"><span data-stu-id="52344-240">Network connection properties, such as DNS server IPs, should not be edited directly within Windows VMs as they may get erased during service heal when the virtual network adaptor gets replaced.</span></span> 
> 
> 

<span data-ttu-id="52344-241">Cuando se usa el modelo de implementación de Resource Manager, se pueden especificar servidores DNS en el Portal, en la API y en las plantillas ([vnet](https://msdn.microsoft.com/library/azure/mt163661.aspx), [nic](https://msdn.microsoft.com/library/azure/mt163668.aspx)), o en PowerShell ([vnet](https://msdn.microsoft.com/library/mt603657.aspx), [nic](https://msdn.microsoft.com/library/mt619370.aspx)).</span><span class="sxs-lookup"><span data-stu-id="52344-241">When using the Resource Manager deployment model, DNS servers can be specified in the Portal, API/Templates ([vnet](https://msdn.microsoft.com/library/azure/mt163661.aspx), [nic](https://msdn.microsoft.com/library/azure/mt163668.aspx)) or PowerShell ([vnet](https://msdn.microsoft.com/library/mt603657.aspx), [nic](https://msdn.microsoft.com/library/mt619370.aspx)).</span></span>

<span data-ttu-id="52344-242">Cuando se usa el modelo de implementación clásico, los servidores DNS de la red virtual pueden especificarse en el Portal o en el [archivo de *configuración de red*](https://msdn.microsoft.com/library/azure/jj157100).</span><span class="sxs-lookup"><span data-stu-id="52344-242">When using the classic deployment model, DNS servers for the virtual network can be specified in the Portal or [the *Network Configuration* file](https://msdn.microsoft.com/library/azure/jj157100).</span></span>  <span data-ttu-id="52344-243">En el caso de los servicios en la nube, los servidores DNS se especifican mediante [el archivo de *configuración de servicio*](https://msdn.microsoft.com/library/azure/ee758710) o en PowerShell ([New-AzureVM](https://msdn.microsoft.com/library/azure/dn495254.aspx)).</span><span class="sxs-lookup"><span data-stu-id="52344-243">For cloud services, the DNS servers are specified via [the *Service Configuration* file](https://msdn.microsoft.com/library/azure/ee758710) or in PowerShell ([New-AzureVM](https://msdn.microsoft.com/library/azure/dn495254.aspx)).</span></span>

> [!NOTE]
> <span data-ttu-id="52344-244">Si cambia la configuración de DNS para una red virtual o una máquina virtual que ya están implementadas, deberá reiniciar cada máquina virtual afectada para que los cambios surtan efecto.</span><span class="sxs-lookup"><span data-stu-id="52344-244">If you change the DNS settings for a virtual network/virtual machine that is already deployed, you need to restart each affected VM for the changes to take effect.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="52344-245">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="52344-245">Next steps</span></span>
<span data-ttu-id="52344-246">Modelo de implementación de Resource Manager:</span><span class="sxs-lookup"><span data-stu-id="52344-246">Resource Manager deployment model:</span></span>

* [<span data-ttu-id="52344-247">Creación o actualización de una red virtual</span><span class="sxs-lookup"><span data-stu-id="52344-247">Create or update a virtual network</span></span>](https://msdn.microsoft.com/library/azure/mt163661.aspx)
* [<span data-ttu-id="52344-248">Creación o actualización de una tarjeta de interfaz de red</span><span class="sxs-lookup"><span data-stu-id="52344-248">Create or update a network interface card</span></span>](https://msdn.microsoft.com/library/azure/mt163668.aspx)
* [<span data-ttu-id="52344-249">New-AzureRmVirtualNetwork</span><span class="sxs-lookup"><span data-stu-id="52344-249">New-AzureRmVirtualNetwork</span></span>](https://msdn.microsoft.com/library/mt603657.aspx)
* [<span data-ttu-id="52344-250">New-AzureRmNetworkInterface</span><span class="sxs-lookup"><span data-stu-id="52344-250">New-AzureRmNetworkInterface</span></span>](https://msdn.microsoft.com/library/mt619370.aspx)

<span data-ttu-id="52344-251">Modelo de implementación clásico:</span><span class="sxs-lookup"><span data-stu-id="52344-251">Classic deployment model:</span></span>

* [<span data-ttu-id="52344-252">Esquema de configuración del servicio de Azure</span><span class="sxs-lookup"><span data-stu-id="52344-252">Azure Service Configuration Schema</span></span>](https://msdn.microsoft.com/library/azure/ee758710)
* [<span data-ttu-id="52344-253">Esquema de configuración de Red virtual</span><span class="sxs-lookup"><span data-stu-id="52344-253">Virtual Network Configuration Schema</span></span>](https://msdn.microsoft.com/library/azure/jj157100)
* [<span data-ttu-id="52344-254">Configuración de una red virtual con un archivo de configuración de red</span><span class="sxs-lookup"><span data-stu-id="52344-254">Configure a Virtual Network by Using a Network Configuration File</span></span>](virtual-networks-using-network-configuration-file.md) 


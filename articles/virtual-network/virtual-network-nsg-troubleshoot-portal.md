---
title: "Solución de problemas de los grupos de seguridad de red - Portal | Microsoft Docs"
description: "Obtenga información acerca de cómo solucionar problemas de los grupos de seguridad de red en el modelo de implementación de Azure Resource Manager utilizando Azure Portal."
services: virtual-network
documentationcenter: na
author: AnithaAdusumilli
manager: narayan
editor: 
tags: azure-resource-manager
ms.assetid: a54feccf-0123-4e49-a743-eb8d0bdd1ebc
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/23/2016
ms.author: anithaa
ms.openlocfilehash: f01d3b43a7953697a6b03e176dace33448d95cd9
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="troubleshoot-network-security-groups-using-the-azure-portal"></a><span data-ttu-id="a5858-103">Solución de problemas de los grupos de seguridad de red utilizando Azure Portal</span><span class="sxs-lookup"><span data-stu-id="a5858-103">Troubleshoot Network Security Groups using the Azure Portal</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="a5858-104">Portal de Azure</span><span class="sxs-lookup"><span data-stu-id="a5858-104">Azure Portal</span></span>](virtual-network-nsg-troubleshoot-portal.md)
> * [<span data-ttu-id="a5858-105">PowerShell</span><span class="sxs-lookup"><span data-stu-id="a5858-105">PowerShell</span></span>](virtual-network-nsg-troubleshoot-powershell.md)
> 
> 

<span data-ttu-id="a5858-106">Si ha configurado grupos de seguridad de red (NSG) en la máquina virtual (VM) y está experimentando problemas de conectividad en la misma, este artículo proporciona información general sobre las funcionalidades de diagnóstico para los NSG que puede ayudarle solucionar el problema.</span><span class="sxs-lookup"><span data-stu-id="a5858-106">If you configured Network Security Groups (NSGs) on your virtual machine (VM) and are experiencing VM connectivity issues, this article provides an overview of diagnostics capabilities for NSGs to help troubleshoot further.</span></span>

<span data-ttu-id="a5858-107">Los NSG le permiten controlar los tipos de tráfico de flujo de entrada y salida de las máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="a5858-107">NSGs enable you to control the types of traffic that flow in and out of your virtual machines (VMs).</span></span> <span data-ttu-id="a5858-108">Los NSG pueden aplicarse a subredes en Azure Virtual Network (VNet), interfaces de red (NIC) o a ambas.</span><span class="sxs-lookup"><span data-stu-id="a5858-108">NSGs can be applied to subnets in an Azure Virtual Network (VNet), network interfaces (NIC), or both.</span></span> <span data-ttu-id="a5858-109">Las reglas vigentes aplicadas a una interfaz de red son una agregación de las reglas que existen en los NSG que se aplican a una NIC y a la subred a la que está conectada.</span><span class="sxs-lookup"><span data-stu-id="a5858-109">The effective rules applied to a NIC are an aggregation of the rules that exist in the NSGs applied to a NIC and the subnet it is connected to.</span></span> <span data-ttu-id="a5858-110">Las reglas en estos NSG a veces pueden entrar en conflicto entre sí y afectar la conectividad de red de la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="a5858-110">Rules across these NSGs can sometimes conflict with each other and impact a VM's network connectivity.</span></span>  

<span data-ttu-id="a5858-111">Puede ver todas las reglas de seguridad vigentes de sus NSG, tal y como se aplican a las NIC de la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="a5858-111">You can view all the effective security rules from your NSGs, as applied on your VM's NICs.</span></span> <span data-ttu-id="a5858-112">Este artículo muestra cómo solucionar problemas de conectividad de máquina virtual utilizando estas reglas en el modelo de implementación de Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="a5858-112">This article shows how to troubleshoot VM connectivity issues using these rules in the Azure Resource Manager deployment model.</span></span> <span data-ttu-id="a5858-113">Si no está familiarizado con conceptos de VNet y NSG, lea los artículos de información general sobre [redes virtuales](virtual-networks-overview.md) y [grupos de seguridad de red](virtual-networks-nsg.md).</span><span class="sxs-lookup"><span data-stu-id="a5858-113">If you're not familiar with VNet and NSG concepts, read the [Virtual network](virtual-networks-overview.md) and [Network security groups](virtual-networks-nsg.md) overview articles.</span></span>

## <a name="using-effective-security-rules-to-troubleshoot-vm-traffic-flow"></a><span data-ttu-id="a5858-114">Uso de las reglas de seguridad vigentes para solucionar problemas de flujo de tráfico de máquinas virtuales</span><span class="sxs-lookup"><span data-stu-id="a5858-114">Using Effective Security Rules to troubleshoot VM traffic flow</span></span>
<span data-ttu-id="a5858-115">El siguiente escenario es un ejemplo de un problema de conexión común:</span><span class="sxs-lookup"><span data-stu-id="a5858-115">The scenario that follows is an example of a common connection problem:</span></span>

<span data-ttu-id="a5858-116">Una máquina virtual denominada *VM1* forma parte de una subred *Subnet1* dentro de una red virtual denominada *WestUS VNet1*.</span><span class="sxs-lookup"><span data-stu-id="a5858-116">A VM named *VM1* is part of a subnet named *Subnet1* within a VNet named *WestUS-VNet1*.</span></span> <span data-ttu-id="a5858-117">Se produce un error al intentar conectar la máquina virtual mediante RDP a través del puerto TCP 3389.</span><span class="sxs-lookup"><span data-stu-id="a5858-117">An attempt to connect to the VM using RDP over TCP port 3389 fails.</span></span> <span data-ttu-id="a5858-118">Los NSG se aplican en ambas la NIC *VM1 NIC1* y la subred *subred1*.</span><span class="sxs-lookup"><span data-stu-id="a5858-118">NSGs are applied at both the NIC *VM1-NIC1* and the subnet *Subnet1*.</span></span> <span data-ttu-id="a5858-119">Se permite el tráfico al puerto TCP 3389 en el NSG asociado con la interfaz de red *VM1-NIC1*; sin embargo, el ping TCP al puerto 3389 de VM1 produce un error.</span><span class="sxs-lookup"><span data-stu-id="a5858-119">Traffic to TCP port 3389 is allowed in the NSG associated with the network interface *VM1-NIC1*, however TCP ping to VM1's port 3389 fails.</span></span>

<span data-ttu-id="a5858-120">Aunque este ejemplo utiliza el puerto TCP 3389, los pasos siguientes pueden utilizarse para determinar errores de conexión entrante y saliente a través de cualquier puerto.</span><span class="sxs-lookup"><span data-stu-id="a5858-120">While this example uses TCP port 3389, the following steps can be used to determine inbound and outbound connection failures over any port.</span></span>

### <span data-ttu-id="a5858-121"><a name="vm"></a>Visualización de las reglas de seguridad vigentes para una máquina virtual</span><span class="sxs-lookup"><span data-stu-id="a5858-121"><a name="vm"></a>View effective security rules for a virtual machine</span></span>
<span data-ttu-id="a5858-122">Complete los pasos siguientes para solucionar problemas de los NSG para una máquina virtual:</span><span class="sxs-lookup"><span data-stu-id="a5858-122">Complete the following steps to troubleshoot NSGs for a VM:</span></span>

<span data-ttu-id="a5858-123">Puede ver una lista completa de las reglas de seguridad vigentes en una NIC, desde la propia máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="a5858-123">You can view full list of the effective security rules on a NIC, from the VM itself.</span></span> <span data-ttu-id="a5858-124">También puede agregar, modificar y eliminar reglas de NIC y de subred de NSG en la hoja reglas vigentes, si dispone de permisos para realizar estas operaciones.</span><span class="sxs-lookup"><span data-stu-id="a5858-124">You can also add, modify, and delete both NIC and subnet NSG rules from the effective rules blade, if you have permissions to perform these operations.</span></span>

1. <span data-ttu-id="a5858-125">Inicie sesión en Azure Portal en https://portal.azure.com.</span><span class="sxs-lookup"><span data-stu-id="a5858-125">Login to the Azure portal at https://portal.azure.com.</span></span>
2. <span data-ttu-id="a5858-126">Haga clic en **Más servicios** y, luego, haga clic en **Máquinas virtuales** en la lista que aparece.</span><span class="sxs-lookup"><span data-stu-id="a5858-126">Click **More services**, then click **Virtual machines** in the list that appears.</span></span>
3. <span data-ttu-id="a5858-127">En la lista seleccione una máquina virtual para solucionar problemas, después de hacerlo se abrirá una hoja de máquina virtual con opciones.</span><span class="sxs-lookup"><span data-stu-id="a5858-127">Select a VM to troubleshoot from the list that appears and a VM blade with options appears.</span></span>
4. <span data-ttu-id="a5858-128">Haga clic en **Diagnosticar y solucionar problemas** y, a continuación, seleccione un problema común.</span><span class="sxs-lookup"><span data-stu-id="a5858-128">Click **Diagnose & solve problems** and then select a common problem.</span></span> <span data-ttu-id="a5858-129">En este ejemplo está seleccionado **No puedo conectar con mi VM Windows** .</span><span class="sxs-lookup"><span data-stu-id="a5858-129">For this example, **I can’t connect to my Windows VM** is selected.</span></span> 
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image1.png)
5. <span data-ttu-id="a5858-130">Bajo el problema aparecen una serie de pasos, tal como se muestra en la siguiente imagen:</span><span class="sxs-lookup"><span data-stu-id="a5858-130">Steps appear under the problem, as shown in the following picture:</span></span> 
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image2.png)
   
    <span data-ttu-id="a5858-131">Haga clic en *effective security group rules* (reglas de grupo de seguridad vigentes) en la lista de pasos recomendados.</span><span class="sxs-lookup"><span data-stu-id="a5858-131">Click *effective security group rules* in the list of recommended steps.</span></span>
6. <span data-ttu-id="a5858-132">Aparece la hoja **Get effective security rules** (Obtener reglas de seguridad vigentes), como se muestra en la siguiente imagen:</span><span class="sxs-lookup"><span data-stu-id="a5858-132">The **Get effective security rules** blade appears, as shown in the following picture:</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image3.png)
   
    <span data-ttu-id="a5858-133">Tenga en cuenta las siguientes secciones que puede observar en la imagen:</span><span class="sxs-lookup"><span data-stu-id="a5858-133">Notice the following sections of the picture:</span></span>
   
   * <span data-ttu-id="a5858-134">**Ámbito:** establecido en *VM1*, la máquina virtual que seleccionó en el paso 3.</span><span class="sxs-lookup"><span data-stu-id="a5858-134">**Scope:** Set to *VM1*, the VM selected in step 3.</span></span>
   * <span data-ttu-id="a5858-135">**Interfaz de red:** *VM1- NIC1* está seleccionada.</span><span class="sxs-lookup"><span data-stu-id="a5858-135">**Network interface:** *VM1-NIC1* is selected.</span></span> <span data-ttu-id="a5858-136">Una máquina virtual puede tener varias interfaces de red (NIC).</span><span class="sxs-lookup"><span data-stu-id="a5858-136">A VM can have multiple network interfaces (NIC).</span></span> <span data-ttu-id="a5858-137">Cada NIC puede tener sus propias reglas de seguridad vigentes.</span><span class="sxs-lookup"><span data-stu-id="a5858-137">Each NIC can have unique effective security rules.</span></span> <span data-ttu-id="a5858-138">Para solucionar un problema, puede que necesite ver las reglas de seguridad vigentes para cada NIC.</span><span class="sxs-lookup"><span data-stu-id="a5858-138">When troubleshooting, you may need to view the effective security rules for each NIC.</span></span>
   * <span data-ttu-id="a5858-139">**Associated NSGs** (NSG asociados): los NSG se pueden aplicar a la NIC y la subred a la que la NIC está conectada.</span><span class="sxs-lookup"><span data-stu-id="a5858-139">**Associated NSGs:** NSGs can be applied to both the NIC and the subnet the NIC is connected to.</span></span> <span data-ttu-id="a5858-140">En la imagen, se ha aplicado un NSG tanto a la NIC como a la subred a la que está conectada.</span><span class="sxs-lookup"><span data-stu-id="a5858-140">In the picture, an NSG has been applied to both the NIC and the subnet it's connected to.</span></span> <span data-ttu-id="a5858-141">Puede hacer clic en los nombres de los NSG para modificar directamente las reglas de los mismos.</span><span class="sxs-lookup"><span data-stu-id="a5858-141">You can click on the NSG names to directly modify rules in the NSGs.</span></span>
   * <span data-ttu-id="a5858-142">**Pestaña VM1-nsg:** la lista de reglas que se muestran en la imagen es para el NSG aplicado a la NIC.</span><span class="sxs-lookup"><span data-stu-id="a5858-142">**VM1-nsg tab:** The list of rules displayed in the picture is for the NSG applied to the NIC.</span></span> <span data-ttu-id="a5858-143">Azure crea varias reglas predeterminadas cuando se crea un NSG.</span><span class="sxs-lookup"><span data-stu-id="a5858-143">Several default rules are created by Azure whenever an NSG is created.</span></span> <span data-ttu-id="a5858-144">Las reglas predeterminadas no se pueden quitar, pero puede reemplazarlas con reglas de prioridad más alta.</span><span class="sxs-lookup"><span data-stu-id="a5858-144">You can't remove the default rules, but you can override them with rules of higher priority.</span></span> <span data-ttu-id="a5858-145">Para más información acerca de las reglas predeterminadas, consulte el artículo de [información general sobre los grupos de seguridad de red](virtual-networks-nsg.md#default-rules) .</span><span class="sxs-lookup"><span data-stu-id="a5858-145">To learn more about default rules, read the [NSG overview](virtual-networks-nsg.md#default-rules) article.</span></span>
   * <span data-ttu-id="a5858-146">**Columna Destino:** algunas de las reglas tienen texto en la columna, mientras que otras tienen prefijos de direcciones.</span><span class="sxs-lookup"><span data-stu-id="a5858-146">**DESTINATION column:** Some of the rules have text in the column, while others have address prefixes.</span></span> <span data-ttu-id="a5858-147">El texto es el nombre de las etiquetas predeterminadas que se aplicaron a la regla de seguridad cuando se creó.</span><span class="sxs-lookup"><span data-stu-id="a5858-147">The text is the name of default tags applied to the security rule when it was created.</span></span> <span data-ttu-id="a5858-148">Las etiquetas son identificadores proporcionados por el sistema que representan varios prefijos.</span><span class="sxs-lookup"><span data-stu-id="a5858-148">The tags are system-provided identifiers that represent multiple prefixes.</span></span> <span data-ttu-id="a5858-149">Seleccionar una regla con una etiqueta, como *AllowInternetOutBound*, coloca los prefijos en la hoja **Address prefixes** (Prefijos de dirección).</span><span class="sxs-lookup"><span data-stu-id="a5858-149">Selecting a rule with a tag, such as *AllowInternetOutBound*, lists the prefixes in the **Address prefixes** blade.</span></span>
   * <span data-ttu-id="a5858-150">**Descargar:** la lista de reglas puede ser larga.</span><span class="sxs-lookup"><span data-stu-id="a5858-150">**Download:** The list of rules can be long.</span></span> <span data-ttu-id="a5858-151">Puede descargar un archivo .csv con las reglas para analizarlo sin conexión haciendo clic en **Descargar** y guardando el archivo.</span><span class="sxs-lookup"><span data-stu-id="a5858-151">You can download a .csv file of the rules for offline analysis by clicking **Download** and saving the file.</span></span>
   * <span data-ttu-id="a5858-152">**AllowRDP** : esta regla permite las conexiones RDP con la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="a5858-152">**AllowRDP** Inbound rule: This rule allows RDP connections to the VM.</span></span>
7. <span data-ttu-id="a5858-153">Haga clic en la pestaña **Subnet1-NSG** para ver las reglas vigentes desde el NSG aplicado a la subred, tal como se muestra en la siguiente imagen:</span><span class="sxs-lookup"><span data-stu-id="a5858-153">Click the **Subnet1-NSG** tab to view the effective rules from the NSG applied to the subnet, as shown in the following picture:</span></span> 
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image4.png)
   
    <span data-ttu-id="a5858-154">Observe la regla de *entrada* **denyRDP** .</span><span class="sxs-lookup"><span data-stu-id="a5858-154">Notice the *denyRDP* **Inbound** rule.</span></span> <span data-ttu-id="a5858-155">Las reglas de entrada aplicadas a la subred se evalúan antes que las reglas que se aplican a la interfaz de red.</span><span class="sxs-lookup"><span data-stu-id="a5858-155">Inbound rules applied at the subnet are evaluated before rules applied at the network interface.</span></span> <span data-ttu-id="a5858-156">Debido a que la regla de denegación se aplica a la subred, la solicitud de conexión a TCP 3389 produce un error, porque la regla de permiso en la NIC no se evalúa.</span><span class="sxs-lookup"><span data-stu-id="a5858-156">Since the deny rule is applied at the subnet, the request to connect to TCP 3389 fails, because the allow rule at the NIC is never evaluated.</span></span> 
   
    <span data-ttu-id="a5858-157">La regla *denyRDP* es la razón por la qué falla la conexión RDP.</span><span class="sxs-lookup"><span data-stu-id="a5858-157">The *denyRDP* rule is the reason why the RDP connection is failing.</span></span> <span data-ttu-id="a5858-158">Quitándola se debería resolver el problema.</span><span class="sxs-lookup"><span data-stu-id="a5858-158">Removing it should resolve the problem.</span></span>
   
   > [!NOTE]
   > <span data-ttu-id="a5858-159">Si la máquina virtual asociada a la NIC no está en estado de ejecución, o no se ha aplicado ningún NSG a la NIC o la subred, no se muestra ninguna regla.</span><span class="sxs-lookup"><span data-stu-id="a5858-159">If the VM associated with the NIC is not in a running state, or NSGs haven't been applied to the NIC or subnet, no rules are shown.</span></span>
   > 
   > 
8. <span data-ttu-id="a5858-160">Para editar las reglas NSG, haga clic en *Subnet1-NSG* en la sección **Associated NSGs** (NSG asociados).</span><span class="sxs-lookup"><span data-stu-id="a5858-160">To edit NSG rules, click *Subnet1-NSG* in the **Associated NSGs** section.</span></span>
   <span data-ttu-id="a5858-161">Se abrirá la hoja **Subnet1-NSG** .</span><span class="sxs-lookup"><span data-stu-id="a5858-161">This opens the **Subnet1-NSG** blade.</span></span> <span data-ttu-id="a5858-162">Puede editar directamente las reglas, haciendo clic en **Reglas de seguridad de entrada**.</span><span class="sxs-lookup"><span data-stu-id="a5858-162">You can directly edit the rules by clicking on **Inbound security rules**.</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image7.png)
9. <span data-ttu-id="a5858-163">Después de quitar la regla de entrada *denyRDP* en **Subnet1-NSG** y de agregar la regla *allowRDP*, la lista de reglas vigentes presenta un aspecto como el de la siguiente imagen:</span><span class="sxs-lookup"><span data-stu-id="a5858-163">After removing the *denyRDP* inbound rule in the **Subnet1-NSG** and adding an *allowRDP* rule, the effective rules list looks like the following picture:</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image8.png)
   
    <span data-ttu-id="a5858-164">Compruebe que el puerto TCP 3389 está abierto abriendo una conexión RDP con la máquina virtual o usando la herramienta PsPing.</span><span class="sxs-lookup"><span data-stu-id="a5858-164">Confirm that TCP port 3389 is open by opening an RDP connection to the VM or using the PsPing tool.</span></span> <span data-ttu-id="a5858-165">Puede obtener más información sobre PsPing consultando la [página de descarga de PsPing](https://technet.microsoft.com/sysinternals/psping.aspx).</span><span class="sxs-lookup"><span data-stu-id="a5858-165">You can learn more about PsPing by reading the [PsPing download page](https://technet.microsoft.com/sysinternals/psping.aspx).</span></span>

### <span data-ttu-id="a5858-166"><a name="nic"></a>Visualización de las reglas de seguridad vigentes para una interfaz de red</span><span class="sxs-lookup"><span data-stu-id="a5858-166"><a name="nic"></a>View effective security rules for a network interface</span></span>
<span data-ttu-id="a5858-167">Si el flujo de tráfico de la máquina virtual se ve afectado por una NIC específica, puede ver una lista completa de las reglas vigentes para la NIC desde el contexto de interfaces de red mediante los pasos siguientes:</span><span class="sxs-lookup"><span data-stu-id="a5858-167">If your VM traffic flow is impacted for a specific NIC, you can view a full list of the effective rules for the NIC from the network interfaces context by completing the following steps:</span></span>

1. <span data-ttu-id="a5858-168">Inicie sesión en Azure Portal en https://portal.azure.com.</span><span class="sxs-lookup"><span data-stu-id="a5858-168">Login to the Azure portal at https://portal.azure.com.</span></span>
2. <span data-ttu-id="a5858-169">Haga clic en **Más servicios** y, luego, en **Interfaces de red** en la lista que aparece.</span><span class="sxs-lookup"><span data-stu-id="a5858-169">Click **More services**, then click **Network interfaces** in the list that appears.</span></span>
3. <span data-ttu-id="a5858-170">Seleccione una interfaz de red.</span><span class="sxs-lookup"><span data-stu-id="a5858-170">Select a network interface.</span></span> <span data-ttu-id="a5858-171">En la siguiente imagen, se selecciona una NIC llamada *VM1-NIC1* .</span><span class="sxs-lookup"><span data-stu-id="a5858-171">In the following picture, a NIC named *VM1-NIC1* is selected.</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image5.png)
   
    <span data-ttu-id="a5858-172">Observe que el **Ámbito** se establece en la interfaz de red seleccionada.</span><span class="sxs-lookup"><span data-stu-id="a5858-172">Notice that the **Scope** is set to the network interface selected.</span></span> <span data-ttu-id="a5858-173">Para leer más acerca la información adicional que se muestra, consulte el paso 6 de la sección sobre **solucionar problemas de los NSG para una máquina virtual** en este artículo.</span><span class="sxs-lookup"><span data-stu-id="a5858-173">To learn more about the additional information shown, read step 6 of the **Troubleshoot NSGs for a VM** section of this article.</span></span>
   
   > [!NOTE]
   > <span data-ttu-id="a5858-174">Si se quita un NSG de una interfaz de red, la subred NSG todavía continúa vigente en dicha NIC.</span><span class="sxs-lookup"><span data-stu-id="a5858-174">If an NSG is removed from a network interface, the subnet NSG is still effective on the given NIC.</span></span> <span data-ttu-id="a5858-175">En este caso, el resultado mostraría solo las reglas del NSG de la subred.</span><span class="sxs-lookup"><span data-stu-id="a5858-175">In this case, the output would only show rules from the subnet NSG.</span></span> <span data-ttu-id="a5858-176">Las reglas solo aparecen si la NIC está conectada a una máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="a5858-176">Rules only appear if the NIC is attached to a VM.</span></span>
   > 
   > 
4. <span data-ttu-id="a5858-177">Puede editar directamente las reglas para los NSG asociados con una subred y una NIC.</span><span class="sxs-lookup"><span data-stu-id="a5858-177">You can directly edit rules for NSGs associated with a NIC and a subnet.</span></span> <span data-ttu-id="a5858-178">Para obtener información sobre cómo hacerlo, vea el paso 8 de la sección **Visualización de las reglas de seguridad vigentes para una máquina virtual** de este artículo.</span><span class="sxs-lookup"><span data-stu-id="a5858-178">To learn how, read step 8 of the **View effective security rules for a virtual machine** section of this article.</span></span>

## <span data-ttu-id="a5858-179"><a name="nsg"></a>Visualización de las reglas de seguridad vigentes para un grupo de seguridad de red (NSG)</span><span class="sxs-lookup"><span data-stu-id="a5858-179"><a name="nsg"></a>View effective security rules for a network security group (NSG)</span></span>
<span data-ttu-id="a5858-180">Al modificar las reglas de NSG, puede revisar el impacto de las reglas que se agregan en una máquina virtual específica.</span><span class="sxs-lookup"><span data-stu-id="a5858-180">When modifying NSG rules, you may want to review the impact of the rules being added on a particular VM.</span></span> <span data-ttu-id="a5858-181">Puede ver una lista completa de las reglas de seguridad vigentes para todas las NIC a las que se aplica un NSG determinado, sin tener que cambiar el contexto de la hoja de NSG determinada.</span><span class="sxs-lookup"><span data-stu-id="a5858-181">You can view a full list of the effective security rules for all the NICs that a given NSG is applied to, without having to switch context from the given NSG blade.</span></span> <span data-ttu-id="a5858-182">Para solucionar problemas de las reglas vigentes dentro de un NSG, realice los pasos siguientes:</span><span class="sxs-lookup"><span data-stu-id="a5858-182">To troubleshoot effective rules within an NSG, complete the following steps:</span></span>

1. <span data-ttu-id="a5858-183">Inicie sesión en Azure Portal en https://portal.azure.com.</span><span class="sxs-lookup"><span data-stu-id="a5858-183">Login to the Azure portal at https://portal.azure.com.</span></span>
2. <span data-ttu-id="a5858-184">Haga clic en **Más servicios** y, luego, haga clic en **Grupos de seguridad de red** en la lista que aparece.</span><span class="sxs-lookup"><span data-stu-id="a5858-184">Click **More services**, then click **Network security groups** in the list that appears.</span></span>
3. <span data-ttu-id="a5858-185">Seleccione un NSG.</span><span class="sxs-lookup"><span data-stu-id="a5858-185">Select an NSG.</span></span> <span data-ttu-id="a5858-186">En la siguiente imagen, se ha seleccionado un NSG llamado VM1-nsg.</span><span class="sxs-lookup"><span data-stu-id="a5858-186">In the following picture, an NSG named VM1-nsg was selected.</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image6.png)
   
    <span data-ttu-id="a5858-187">Tenga en cuenta las siguientes secciones en la imagen anterior:</span><span class="sxs-lookup"><span data-stu-id="a5858-187">Notice the following sections of the previous picture:</span></span>
   
   * <span data-ttu-id="a5858-188">**Ámbito:** establecido en el NSG seleccionado.</span><span class="sxs-lookup"><span data-stu-id="a5858-188">**Scope:** Set to the NSG selected.</span></span>
   * <span data-ttu-id="a5858-189">**Máquina Virtual:** cuando un NSG se aplica a una subred, se aplica a todas las interfaces de red conectadas a todas las máquinas virtuales conectadas a la subred.</span><span class="sxs-lookup"><span data-stu-id="a5858-189">**Virtual machine:** When an NSG is applied to a subnet, it's applied to all network interfaces attached to all VMs connected to the subnet.</span></span> <span data-ttu-id="a5858-190">Esta lista muestra todas las máquinas virtuales a las que se aplica este NSG.</span><span class="sxs-lookup"><span data-stu-id="a5858-190">This list shows all VMs this NSG is applied to.</span></span> <span data-ttu-id="a5858-191">Puede seleccionar cualquier máquina virtual en la lista.</span><span class="sxs-lookup"><span data-stu-id="a5858-191">You can select any VM from the list.</span></span>
     
     > [!NOTE]
     > <span data-ttu-id="a5858-192">Si un NSG se aplica a solo una subred vacía, no se mostrará ninguna máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="a5858-192">If an NSG is applied to only an empty subnet, VMs will not be listed.</span></span> <span data-ttu-id="a5858-193">Si se aplica un NSG a una NIC que no está asociada a una máquina virtual, las NIC tampoco aparecerán.</span><span class="sxs-lookup"><span data-stu-id="a5858-193">If an NSG is applied to a NIC which is not associated with a VM, those NICs will also not be listed.</span></span> 
     > 
     > 
   * <span data-ttu-id="a5858-194">**Interfaz de red:** una VM puede tener varias interfaces de red.</span><span class="sxs-lookup"><span data-stu-id="a5858-194">**Network Interface:** A VM can have multiple network interfaces.</span></span> <span data-ttu-id="a5858-195">Puede seleccionar una interfaz de red conectada a la máquina virtual seleccionada.</span><span class="sxs-lookup"><span data-stu-id="a5858-195">You can select a network interface attached to the selected VM.</span></span>
   * <span data-ttu-id="a5858-196">**Grupos de seguridad de red asociados:** en cualquier momento, una NIC puede tener hasta dos grupos de seguridad de red vigentes, uno aplicado a la NIC y el otro a la subred.</span><span class="sxs-lookup"><span data-stu-id="a5858-196">**AssociatedNSGs:** At any time, a NIC can have up to two effective NSGs, one applied to the NIC and the other to the subnet.</span></span> <span data-ttu-id="a5858-197">Aunque el ámbito está seleccionado como VM1-nsg, si la NIC tiene un NSG de subred vigente, la salida mostrará ambos NSG.</span><span class="sxs-lookup"><span data-stu-id="a5858-197">Although the scope is selected as VM1-nsg, if the NIC has an effective subnet NSG, the output will show both NSGs.</span></span>
4. <span data-ttu-id="a5858-198">Puede editar directamente las reglas para los NSG asociados con una subred o una NIC.</span><span class="sxs-lookup"><span data-stu-id="a5858-198">You can directly edit rules for NSGs associated with a NIC or subnet.</span></span> <span data-ttu-id="a5858-199">Para obtener información sobre cómo hacerlo, vea el paso 8 de la sección **Visualización de las reglas de seguridad vigentes para una máquina virtual** de este artículo.</span><span class="sxs-lookup"><span data-stu-id="a5858-199">To learn how, read step 8 of the **View effective security rules for a virtual machine** section of this article.</span></span>

<span data-ttu-id="a5858-200">Para leer más acerca de la información que se muestra, vea el paso 6 de la sección **Visualización de las reglas de seguridad vigentes para una máquina virtual** de este artículo.</span><span class="sxs-lookup"><span data-stu-id="a5858-200">To learn more about the additional information shown, read step 6 of the **View effective security rules for a virtual machine** section of this article.</span></span>

> [!NOTE]
> <span data-ttu-id="a5858-201">Aunque una subred y una NIC cada una solo puede tener un NSG aplicado, un NSG puede estar asociado a varias NIC y varias subredes.</span><span class="sxs-lookup"><span data-stu-id="a5858-201">Though a subnet and NIC can each have only one NSG applied to them, an NSG can be associated to multiple NICs and multiple subnets.</span></span>
> 
> 

## <a name="considerations"></a><span data-ttu-id="a5858-202">Consideraciones</span><span class="sxs-lookup"><span data-stu-id="a5858-202">Considerations</span></span>
<span data-ttu-id="a5858-203">Tenga en cuenta los puntos siguientes cuando tenga que solucionar problemas de conectividad:</span><span class="sxs-lookup"><span data-stu-id="a5858-203">Consider the following points when troubleshooting connectivity problems:</span></span>

* <span data-ttu-id="a5858-204">Las reglas predeterminadas de NSG bloquean el acceso de entrada desde Internet y solo permiten el tráfico entrante de la red virtual.</span><span class="sxs-lookup"><span data-stu-id="a5858-204">Default NSG rules will block inbound access from the internet and only permit VNet inbound traffic.</span></span> <span data-ttu-id="a5858-205">Las reglas deben agregarse explícitamente para permitir el acceso de entrada desde Internet, según sea necesario.</span><span class="sxs-lookup"><span data-stu-id="a5858-205">Rules should be explicitly added to allow inbound access from Internet, as required.</span></span>
* <span data-ttu-id="a5858-206">Si no hay ninguna regla de seguridad de NSG que sea la causa de un error de conectividad de una red de máquina virtual, el problema puede ser debido a:</span><span class="sxs-lookup"><span data-stu-id="a5858-206">If there are no NSG security rules causing a VM’s network connectivity to fail, the problem may be due to:</span></span>
  * <span data-ttu-id="a5858-207">Software de firewall que se esté ejecutando en el sistema operativo de la máquina virtual</span><span class="sxs-lookup"><span data-stu-id="a5858-207">Firewall software running within the VM's operating system</span></span>
  * <span data-ttu-id="a5858-208">Rutas configuradas para dispositivos virtuales o para el tráfico local.</span><span class="sxs-lookup"><span data-stu-id="a5858-208">Routes configured for virtual appliances or on-premises traffic.</span></span> <span data-ttu-id="a5858-209">El tráfico de Internet puede redirigirse a la red local a través de tunelización forzada.</span><span class="sxs-lookup"><span data-stu-id="a5858-209">Internet traffic can be redirected to on-premises via forced-tunneling.</span></span> <span data-ttu-id="a5858-210">Una conexión RDP o SSH desde Internet a su máquina virtual puede no funcionar con esta configuración, dependiendo de cómo el hardware de red local controle este tráfico.</span><span class="sxs-lookup"><span data-stu-id="a5858-210">An RDP/SSH connection from the Internet to your VM may not work with this setting, depending on how the on-premises network hardware handles this traffic.</span></span> <span data-ttu-id="a5858-211">Consulte el artículo sobre [solución de problemas de rutas](virtual-network-routes-troubleshoot-powershell.md) para obtener información sobre cómo diagnosticar los problemas de enrutamiento que pueden estar impidiendo el flujo de tráfico de entrada y salida de la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="a5858-211">Read the [Troubleshooting Routes](virtual-network-routes-troubleshoot-powershell.md) article to learn how to diagnose route problems that may be impeding the flow of traffic in and out of the VM.</span></span> 
* <span data-ttu-id="a5858-212">Si ha emparejado redes virtuales, de forma predeterminada, la etiqueta VIRTUAL_NETWORK se expandirá automáticamente para incluir prefijos para redes virtuales emparejadas.</span><span class="sxs-lookup"><span data-stu-id="a5858-212">If you have peered VNets, by default, the VIRTUAL_NETWORK tag will automatically expand to include prefixes for peered VNets.</span></span> <span data-ttu-id="a5858-213">Puede ver estos prefijos en la lista **ExpandedAddressPrefix** para solucionar los problemas relacionados con la conectividad de emparejamiento de rede virtuales.</span><span class="sxs-lookup"><span data-stu-id="a5858-213">You can view these prefixes in the **ExpandedAddressPrefix** list, to troubleshoot any issues related to VNet peering connectivity.</span></span> 
* <span data-ttu-id="a5858-214">Las reglas de seguridad vigentes solo se muestran si hay un NSG asociado con la NIC o subred de máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="a5858-214">Effective security rules are only shown if there is an NSG associated with the VM’s NIC and or subnet.</span></span> 
* <span data-ttu-id="a5858-215">Si no hay ningún NSG asociado a la NIC o subred y tiene una dirección IP pública asignada a la máquina virtual, todos los puertos estarán abiertos para el acceso entrante y saliente.</span><span class="sxs-lookup"><span data-stu-id="a5858-215">If there are no NSGs associated with the NIC or subnet and you have a public IP address assigned to your VM, all ports will be open for inbound and outbound access.</span></span> <span data-ttu-id="a5858-216">Si la máquina virtual tiene una dirección IP pública, es muy recomendable aplicar los NSG a la subred o NIC.</span><span class="sxs-lookup"><span data-stu-id="a5858-216">If the VM has a public IP address, applying NSGs to the NIC or subnet is strongly recommended.</span></span>


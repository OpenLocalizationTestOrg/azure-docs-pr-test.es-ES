---
title: "rutas definidas por el aaaUser y el reenvío IP en Azure | Documentos de Microsoft"
description: "Obtenga información acerca de cómo las rutas definidas por el usuario de tooconfigure (UDR) y el reenvío IP tooforward tráfico toonetwork aparatos virtuales en Azure."
services: virtual-network
documentationcenter: na
author: jimdial
manager: timlt
editor: tysonn
ms.assetid: c39076c4-11b7-4b46-a904-817503c4b486
ms.service: virtual-network
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/15/2016
ms.author: jdial
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: f1f1d46166d5a7c776f472b7ade1354d943ece10
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="user-defined-routes-and-ip-forwarding"></a><span data-ttu-id="b4657-103">Rutas definidas por el usuario y reenvío IP</span><span class="sxs-lookup"><span data-stu-id="b4657-103">User-defined routes and IP forwarding</span></span>

<span data-ttu-id="b4657-104">Cuando se agrega la red virtual de máquinas virtuales (VM) tooa (VNet) en Azure, observará que hello las máquinas virtuales son capaz de toocommunicate entre sí a través de la red hello, automáticamente.</span><span class="sxs-lookup"><span data-stu-id="b4657-104">When you add virtual machines (VMs) tooa virtual network (VNet) in Azure, you will notice that hello VMs are able toocommunicate with each other over hello network, automatically.</span></span> <span data-ttu-id="b4657-105">No es necesario toospecify una puerta de enlace, incluso aunque hello las máquinas virtuales están en subredes diferentes.</span><span class="sxs-lookup"><span data-stu-id="b4657-105">You do not need toospecify a gateway, even though hello VMs are in different subnets.</span></span> <span data-ttu-id="b4657-106">Hello mismo sirve para la comunicación de hello las máquinas virtuales toohello Internet pública y la red local de tooyour incluso cuando el propietario de una conexión híbrida de Azure tooyour centro de datos está presente.</span><span class="sxs-lookup"><span data-stu-id="b4657-106">hello same is true for communication from hello VMs toohello public Internet, and even tooyour on-premises network when a hybrid connection from Azure tooyour own datacenter is present.</span></span>

<span data-ttu-id="b4657-107">Este flujo de comunicación es posible porque Azure utiliza una serie de sistema rutas toodefine cómo fluye el tráfico IP.</span><span class="sxs-lookup"><span data-stu-id="b4657-107">This flow of communication is possible because Azure uses a series of system routes toodefine how IP traffic flows.</span></span> <span data-ttu-id="b4657-108">Las rutas del sistema controlan el flujo de Hola de comunicación en hello los escenarios siguientes:</span><span class="sxs-lookup"><span data-stu-id="b4657-108">System routes control hello flow of communication in hello following scenarios:</span></span>

* <span data-ttu-id="b4657-109">Desde Hola misma subred.</span><span class="sxs-lookup"><span data-stu-id="b4657-109">From within hello same subnet.</span></span>
* <span data-ttu-id="b4657-110">Desde un tooanother de subred dentro de una red virtual.</span><span class="sxs-lookup"><span data-stu-id="b4657-110">From a subnet tooanother within a VNet.</span></span>
* <span data-ttu-id="b4657-111">Desde máquinas virtuales toohello Internet.</span><span class="sxs-lookup"><span data-stu-id="b4657-111">From VMs toohello Internet.</span></span>
* <span data-ttu-id="b4657-112">Desde una red virtual tooanother red virtual a través de una puerta de enlace VPN.</span><span class="sxs-lookup"><span data-stu-id="b4657-112">From a VNet tooanother VNet through a VPN gateway.</span></span>
* <span data-ttu-id="b4657-113">Desde una red virtual a través de intercambio de tráfico de red virtual (encadenamiento de servicio) de red virtual tooanother.</span><span class="sxs-lookup"><span data-stu-id="b4657-113">From a VNet tooanother VNet through VNet Peering (Service Chaining).</span></span>
* <span data-ttu-id="b4657-114">Desde una red de en entornos de red virtual tooyour a través de una puerta de enlace VPN.</span><span class="sxs-lookup"><span data-stu-id="b4657-114">From a VNet tooyour on-premises network through a VPN gateway.</span></span>

<span data-ttu-id="b4657-115">Hola siguiente ilustración muestra una configuración simple con una red virtual y dos subredes, algunas máquinas virtuales, junto con hello las rutas de sistema que permiten tooflow de tráfico IP.</span><span class="sxs-lookup"><span data-stu-id="b4657-115">hello figure below shows a simple setup with a VNet, two subnets, and a few VMs, along with hello system routes that allow IP traffic tooflow.</span></span>

![Rutas del sistema de Azure](./media/virtual-networks-udr-overview/Figure1.png)

<span data-ttu-id="b4657-117">Aunque el uso de Hola de rutas del sistema facilita tráfico automáticamente para su implementación, hay casos en que desea toocontrol Hola enrutamiento de paquetes a través de un dispositivo virtual.</span><span class="sxs-lookup"><span data-stu-id="b4657-117">Although hello use of system routes facilitates traffic automatically for your deployment, there are cases in which you want toocontrol hello routing of packets through a virtual appliance.</span></span> <span data-ttu-id="b4657-118">Puede por lo tanto mediante la creación de rutas definidas por el usuario especificar próximo salto Hola para los paquetes que fluyen tooa dispositivo virtual de subred específica toogo tooyour en su lugar, y habilitar IP Hola el reenvío de máquina virtual que ejecuta como dispositivo virtual Hola.</span><span class="sxs-lookup"><span data-stu-id="b4657-118">You can do so by creating user defined routes that specify hello next hop for packets flowing tooa specific subnet toogo tooyour virtual appliance instead, and enabling IP forwarding for hello VM running as hello virtual appliance.</span></span>

<span data-ttu-id="b4657-119">Hola figura siguiente muestra un ejemplo de rutas definidas por el usuario y reenvío tooforce paquetes IP enviados tooone subred desde otro toogo a través de un dispositivo virtual en una subred terceros.</span><span class="sxs-lookup"><span data-stu-id="b4657-119">hello figure below shows an example of user defined routes and IP forwarding tooforce packets sent tooone subnet from another toogo through a virtual appliance on a third subnet.</span></span>

![Rutas del sistema de Azure](./media/virtual-networks-udr-overview/Figure2.png)

> [!IMPORTANT]
> <span data-ttu-id="b4657-121">Las rutas definidas por el usuario son aplicado tootraffic salir de una subred de cualquier recurso (como interfaces de red conexión tooVMs) en la subred de Hola.</span><span class="sxs-lookup"><span data-stu-id="b4657-121">User-defined routes are applied tootraffic leaving a subnet from any resource (such as network interfaces attached tooVMs) in hello subnet.</span></span> <span data-ttu-id="b4657-122">No se puede crear rutas toospecify cómo el tráfico entra en una subred de hello Internet, por ejemplo.</span><span class="sxs-lookup"><span data-stu-id="b4657-122">You cannot create routes toospecify how traffic enters a subnet from hello Internet, for instance.</span></span> <span data-ttu-id="b4657-123">dispositivo de Hola que va a reenviar tráfico toocannot estar Hola misma subred donde se origina el tráfico de Hola.</span><span class="sxs-lookup"><span data-stu-id="b4657-123">hello appliance you are forwarding traffic toocannot be in hello same subnet where hello traffic originates.</span></span> <span data-ttu-id="b4657-124">Recuerde siempre crear una subred independiente para sus aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="b4657-124">Always create a separate subnet for your appliances.</span></span> 
> 
> 

## <a name="route-resource"></a><span data-ttu-id="b4657-125">Recurso de ruta</span><span class="sxs-lookup"><span data-stu-id="b4657-125">Route resource</span></span>
<span data-ttu-id="b4657-126">Los paquetes se enrutan a través de una red TCP/IP basada en una tabla de ruta definida en cada nodo de red física de Hola.</span><span class="sxs-lookup"><span data-stu-id="b4657-126">Packets are routed over a TCP/IP network based on a route table defined at each node on hello physical network.</span></span> <span data-ttu-id="b4657-127">Una tabla de ruta es que una colección de rutas individuales utilizados toodecide donde tooforward paquetes basan en el destino de hello dirección IP.</span><span class="sxs-lookup"><span data-stu-id="b4657-127">A route table is a collection of individual routes used toodecide where tooforward packets based on hello destination IP address.</span></span> <span data-ttu-id="b4657-128">Una ruta consta de siguientes hello:</span><span class="sxs-lookup"><span data-stu-id="b4657-128">A route consists of hello following:</span></span>

| <span data-ttu-id="b4657-129">Propiedad</span><span class="sxs-lookup"><span data-stu-id="b4657-129">Property</span></span> | <span data-ttu-id="b4657-130">Description</span><span class="sxs-lookup"><span data-stu-id="b4657-130">Description</span></span> | <span data-ttu-id="b4657-131">Restricciones</span><span class="sxs-lookup"><span data-stu-id="b4657-131">Constraints</span></span> | <span data-ttu-id="b4657-132">Consideraciones</span><span class="sxs-lookup"><span data-stu-id="b4657-132">Considerations</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="b4657-133">Prefijo de dirección</span><span class="sxs-lookup"><span data-stu-id="b4657-133">Address Prefix</span></span> |<span data-ttu-id="b4657-134">ruta de Hello destino CIDR toowhich Hola se aplica, como 10.1.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="b4657-134">hello destination CIDR toowhich hello route applies, such as 10.1.0.0/16.</span></span> |<span data-ttu-id="b4657-135">Debe ser un intervalo válido de CIDR que representa las direcciones en hello red pública de Internet, red virtual de Azure o centro de datos local.</span><span class="sxs-lookup"><span data-stu-id="b4657-135">Must be a valid CIDR range representing addresses on hello public Internet, Azure virtual network, or on-premises datacenter.</span></span> |<span data-ttu-id="b4657-136">Asegúrese de hello seguro **prefijo de dirección** no contiene la dirección de Hola para hello **de próximo salto**, en caso contrario, deberá especificar los paquetes en un bucle que se va de próximo salto de hello origen toohello sin que se alcance nunca destino de Hola.</span><span class="sxs-lookup"><span data-stu-id="b4657-136">Make sure hello **Address prefix** does not contain hello address for hello **Next hop address**, otherwise your packets will enter in a loop going from hello source toohello next hop without ever reaching hello destination.</span></span> |
| <span data-ttu-id="b4657-137">Tipo de próximo salto</span><span class="sxs-lookup"><span data-stu-id="b4657-137">Next hop type</span></span> |<span data-ttu-id="b4657-138">tipo Hello de paquete de saludo de salto de Azure se enviarán a.</span><span class="sxs-lookup"><span data-stu-id="b4657-138">hello type of Azure hop hello packet should be sent to.</span></span> |<span data-ttu-id="b4657-139">Debe ser uno de hello siguientes valores:</span><span class="sxs-lookup"><span data-stu-id="b4657-139">Must be one of hello following values:</span></span> <br/> <span data-ttu-id="b4657-140">**Red virtual**.</span><span class="sxs-lookup"><span data-stu-id="b4657-140">**Virtual Network**.</span></span> <span data-ttu-id="b4657-141">Representa la red virtual local de Hola.</span><span class="sxs-lookup"><span data-stu-id="b4657-141">Represents hello local virtual network.</span></span> <span data-ttu-id="b4657-142">Por ejemplo, si tiene dos subredes, 10.1.0.0/16 y 10.2.0.0/16 en Hola misma red virtual, ruta de Hola para cada subred de la tabla de rutas de hello tendrá un valor de salto siguiente de *red Virtual*.</span><span class="sxs-lookup"><span data-stu-id="b4657-142">For instance, if you have two subnets, 10.1.0.0/16 and 10.2.0.0/16 in hello same virtual network, hello route for each subnet in hello route table will have a next hop value of *Virtual Network*.</span></span> <br/> <span data-ttu-id="b4657-143">**Puerta de enlace de red virtual**.</span><span class="sxs-lookup"><span data-stu-id="b4657-143">**Virtual Network Gateway**.</span></span> <span data-ttu-id="b4657-144">Representa una puerta de enlace de VPN S2S de Azure.</span><span class="sxs-lookup"><span data-stu-id="b4657-144">Represents an Azure S2S VPN Gateway.</span></span> <br/> <span data-ttu-id="b4657-145">**Internet**.</span><span class="sxs-lookup"><span data-stu-id="b4657-145">**Internet**.</span></span> <span data-ttu-id="b4657-146">Representa Hola Internet puerta de enlace proporcionado por hello infraestructura de Azure.</span><span class="sxs-lookup"><span data-stu-id="b4657-146">Represents hello default Internet gateway provided by hello Azure Infrastructure.</span></span> <br/> <span data-ttu-id="b4657-147">**Dispositivo virtual**.</span><span class="sxs-lookup"><span data-stu-id="b4657-147">**Virtual Appliance**.</span></span> <span data-ttu-id="b4657-148">Representa un dispositivo virtual que se ha agregado tooyour red virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="b4657-148">Represents a virtual appliance you added tooyour Azure virtual network.</span></span> <br/> <span data-ttu-id="b4657-149">**Ninguna**.</span><span class="sxs-lookup"><span data-stu-id="b4657-149">**None**.</span></span> <span data-ttu-id="b4657-150">Representa un agujero negro.</span><span class="sxs-lookup"><span data-stu-id="b4657-150">Represents a black hole.</span></span> <span data-ttu-id="b4657-151">Paquetes reenviados tooa negras no se reenviarán en absoluto.</span><span class="sxs-lookup"><span data-stu-id="b4657-151">Packets forwarded tooa black hole will not be forwarded at all.</span></span> |<span data-ttu-id="b4657-152">Considere el uso de **dispositivo Virtual** toodirect tráfico tooa máquina virtual o equilibrador de carga Azure dirección IP interna.</span><span class="sxs-lookup"><span data-stu-id="b4657-152">Consider using **Virtual Appliance** toodirect traffic tooa VM or Azure Load Balancer internal IP address.</span></span>  <span data-ttu-id="b4657-153">Este tipo permite la especificación de Hola de una dirección IP, tal y como se describe a continuación.</span><span class="sxs-lookup"><span data-stu-id="b4657-153">This type allows hello specification of an IP address as described below.</span></span> <span data-ttu-id="b4657-154">Considere el uso de un **ninguno** escriba toostop paquetes de flujo tooa dado de destino.</span><span class="sxs-lookup"><span data-stu-id="b4657-154">Consider using a **None** type toostop packets from flowing tooa given destination.</span></span> |
| <span data-ttu-id="b4657-155">Siguiente dirección de salto</span><span class="sxs-lookup"><span data-stu-id="b4657-155">Next hop address</span></span> |<span data-ttu-id="b4657-156">dirección del próximo salto Hello contiene la dirección IP de Hola se deberían reenviar paquetes.</span><span class="sxs-lookup"><span data-stu-id="b4657-156">hello next hop address contains hello IP address packets should be forwarded to.</span></span> <span data-ttu-id="b4657-157">Los valores de salto siguientes solo se permiten en rutas donde es el tipo de próximo salto hello *dispositivo Virtual*.</span><span class="sxs-lookup"><span data-stu-id="b4657-157">Next hop values are only allowed in routes where hello next hop type is *Virtual Appliance*.</span></span> |<span data-ttu-id="b4657-158">Debe ser una dirección IP que sea accesible dentro de hello red Virtual que se aplica Hola ruta definida por el usuario, sin tener que pasar a través de un **puerta de enlace de red Virtual**.</span><span class="sxs-lookup"><span data-stu-id="b4657-158">Must be an IP address that is reachable within hello Virtual Network where hello User Defined Route is applied, without going through a **Virtual Network Gateway**.</span></span> <span data-ttu-id="b4657-159">dirección IP de Hello tiene toobe en hello mismo Virtual de red donde se aplica, o en una red Virtual peered.</span><span class="sxs-lookup"><span data-stu-id="b4657-159">hello IP address has toobe on hello same Virtual Network where it is applied, or on a peered Virtual Network.</span></span> |<span data-ttu-id="b4657-160">Si la dirección IP de hello representa una máquina virtual, asegúrese de habilitar [reenvío IP](#IP-forwarding) en Azure para hello máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="b4657-160">If hello IP address represents a VM, make sure you enable [IP forwarding](#IP-forwarding) in Azure for hello VM.</span></span> <span data-ttu-id="b4657-161">Si hello representa Hola interno dirección IP del equilibrador de carga de Azure, asegúrese de que tiene una regla para cada puerto de equilibrio de carga correspondiente que se va a equilibrar tooload.</span><span class="sxs-lookup"><span data-stu-id="b4657-161">If hello IP address represents hello internal IP address of Azure Load Balancer, make sure you have a matching load balancing rule for each port you wish tooload balance.</span></span>|

<span data-ttu-id="b4657-162">En Azure PowerShell algunos de los valores de "NextHopType" hello tienen nombres diferentes:</span><span class="sxs-lookup"><span data-stu-id="b4657-162">In Azure PowerShell some of hello "NextHopType" values have different names:</span></span>

* <span data-ttu-id="b4657-163">Red virtual es VnetLocal</span><span class="sxs-lookup"><span data-stu-id="b4657-163">Virtual Network is VnetLocal</span></span>
* <span data-ttu-id="b4657-164">Puerta de enlace de red virtual es VirtualNetworkGateway</span><span class="sxs-lookup"><span data-stu-id="b4657-164">Virtual Network Gateway is VirtualNetworkGateway</span></span>
* <span data-ttu-id="b4657-165">Aplicación virtual es VirtualAppliance</span><span class="sxs-lookup"><span data-stu-id="b4657-165">Virtual Appliance is VirtualAppliance</span></span>
* <span data-ttu-id="b4657-166">Internet es Internet</span><span class="sxs-lookup"><span data-stu-id="b4657-166">Internet is Internet</span></span>
* <span data-ttu-id="b4657-167">No es None</span><span class="sxs-lookup"><span data-stu-id="b4657-167">None is None</span></span>

### <a name="system-routes"></a><span data-ttu-id="b4657-168">Rutas del sistema</span><span class="sxs-lookup"><span data-stu-id="b4657-168">System routes</span></span>
<span data-ttu-id="b4657-169">Cada subred que se crea en una red virtual se asocia automáticamente con una tabla de ruta que contiene Hola siguiendo las reglas de ruta del sistema:</span><span class="sxs-lookup"><span data-stu-id="b4657-169">Every subnet created in a virtual network is automatically associated with a route table that contains hello following system route rules:</span></span>

* <span data-ttu-id="b4657-170">**Regla de red virtual local**: esta regla se crea automáticamente para cada subred de una red virtual.</span><span class="sxs-lookup"><span data-stu-id="b4657-170">**Local Vnet Rule**: This rule is automatically created for every subnet in a virtual network.</span></span> <span data-ttu-id="b4657-171">Especifica que no hay un vínculo directo entre máquinas virtuales de Hola Hola red virtual y no hay ningún salto siguiente intermedio.</span><span class="sxs-lookup"><span data-stu-id="b4657-171">It specifies that there is a direct link between hello VMs in hello VNet and there is no intermediate next hop.</span></span>
* <span data-ttu-id="b4657-172">**Regla local**: esta regla se aplica el intervalo de direcciones de tooall tráfico destinado toohello local y utiliza la puerta de enlace VPN como destino de salto siguiente Hola.</span><span class="sxs-lookup"><span data-stu-id="b4657-172">**On-premises Rule**: This rule applies tooall traffic destined toohello on-premises address range and uses VPN gateway as hello next hop destination.</span></span>
* <span data-ttu-id="b4657-173">**Regla de Internet**: esta regla controla todos los toohello de tráfico destinado a Internet pública (prefijo de dirección 0.0.0.0/0) y usos de puerta de enlace de internet de infraestructura hello como Hola del próximo salto para todo el tráfico destinado toohello Internet.</span><span class="sxs-lookup"><span data-stu-id="b4657-173">**Internet Rule**: This rule handles all traffic destined toohello public Internet (address prefix 0.0.0.0/0) and uses hello infrastructure internet gateway as hello next hop for all traffic destined toohello Internet.</span></span>

### <a name="user-defined-routes"></a><span data-ttu-id="b4657-174">Rutas definidas por el usuario</span><span class="sxs-lookup"><span data-stu-id="b4657-174">User-defined routes</span></span>
<span data-ttu-id="b4657-175">Para la mayoría de los entornos solo tendrá que las rutas de sistema de hello ya están definidas por Azure.</span><span class="sxs-lookup"><span data-stu-id="b4657-175">For most environments you will only need hello system routes already defined by Azure.</span></span> <span data-ttu-id="b4657-176">Sin embargo, puede necesita toocreate una tabla de rutas y agregar una o más rutas en casos concretos, como:</span><span class="sxs-lookup"><span data-stu-id="b4657-176">However, you may need toocreate a route table and add one or more routes in specific cases, such as:</span></span>

* <span data-ttu-id="b4657-177">Forzar túnel toohello Internet a través de la red local.</span><span class="sxs-lookup"><span data-stu-id="b4657-177">Force tunneling toohello Internet via your on-premises network.</span></span>
* <span data-ttu-id="b4657-178">Uso de dispositivos virtuales en el entorno de Azure.</span><span class="sxs-lookup"><span data-stu-id="b4657-178">Use of virtual appliances in your Azure environment.</span></span>

<span data-ttu-id="b4657-179">En escenarios de hello anteriores, tendrá toocreate una tabla de rutas y agregar tooit de rutas definidas por el usuario.</span><span class="sxs-lookup"><span data-stu-id="b4657-179">In hello scenarios above, you will have toocreate a route table and add user defined routes tooit.</span></span> <span data-ttu-id="b4657-180">Puede tener varias tablas de rutas y hello misma tabla de ruta puede ser tooone asociado o más subredes.</span><span class="sxs-lookup"><span data-stu-id="b4657-180">You can have multiple route tables, and hello same route table can be associated tooone or more subnets.</span></span> <span data-ttu-id="b4657-181">Y cada subred sólo puede ser una tabla de rutas solo tooa asociado.</span><span class="sxs-lookup"><span data-stu-id="b4657-181">And each subnet can only be associated tooa single route table.</span></span> <span data-ttu-id="b4657-182">Todas las máquinas virtuales y servicios en la nube en una subred usan Hola ruta las tablas asociadas toothat subred.</span><span class="sxs-lookup"><span data-stu-id="b4657-182">All VMs and cloud services in a subnet use hello route table associated toothat subnet.</span></span>

<span data-ttu-id="b4657-183">Subredes se basan en las rutas del sistema hasta que una tabla de rutas se subred toohello asociado.</span><span class="sxs-lookup"><span data-stu-id="b4657-183">Subnets rely on system routes until a route table is associated toohello subnet.</span></span> <span data-ttu-id="b4657-184">Una vez creada una asociación, el enrutamiento se realiza según la coincidencia de prefijo más larga (LPM) entre las rutas definidas por el usuario y las rutas predeterminadas.</span><span class="sxs-lookup"><span data-stu-id="b4657-184">Once an association exists, routing is done based on Longest Prefix Match (LPM) among both user defined routes and system routes.</span></span> <span data-ttu-id="b4657-185">Si hay más de una ruta con hello coincide con el mismo LPM, a continuación, se selecciona una ruta se basa en su origen en hello siguiente orden:</span><span class="sxs-lookup"><span data-stu-id="b4657-185">If there is more than one route with hello same LPM match then a route is selected based on its origin in hello following order:</span></span>

1. <span data-ttu-id="b4657-186">Ruta definida por el usuario</span><span class="sxs-lookup"><span data-stu-id="b4657-186">User defined route</span></span>
2. <span data-ttu-id="b4657-187">Ruta BGP (cuando se utiliza ExpressRoute)</span><span class="sxs-lookup"><span data-stu-id="b4657-187">BGP route (when ExpressRoute is used)</span></span>
3. <span data-ttu-id="b4657-188">Ruta del sistema</span><span class="sxs-lookup"><span data-stu-id="b4657-188">System route</span></span>

<span data-ttu-id="b4657-189">toolearn toocreate usuario definición de rutas, vea [cómo tooCreate enruta y habilitar el reenvío IP en Azure](virtual-network-create-udr-arm-template.md).</span><span class="sxs-lookup"><span data-stu-id="b4657-189">toolearn how toocreate user defined routes, see [How tooCreate Routes and Enable IP Forwarding in Azure](virtual-network-create-udr-arm-template.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b4657-190">Las rutas definidas por el usuario son solo aplicada tooAzure máquinas virtuales y servicios en la nube.</span><span class="sxs-lookup"><span data-stu-id="b4657-190">User defined routes are only applied tooAzure VMs and cloud services.</span></span> <span data-ttu-id="b4657-191">Por ejemplo, si desea que tooadd un dispositivo virtual de firewall entre la red local y Azure, tendrá toocreate una ruta definida por el usuario para las tablas de enrutamiento de Azure que reenvía todo el tráfico encaminado toohello de espacio de direcciones de toohello local virtual dispositivo.</span><span class="sxs-lookup"><span data-stu-id="b4657-191">For instance, if you want tooadd a firewall virtual appliance between your on-premises network and Azure, you will have toocreate a user defined route for your Azure route tables that forwards all traffic going toohello on-premises address space toohello virtual appliance.</span></span> <span data-ttu-id="b4657-192">También puede agregar definida por el usuario ruta (UDR) toohello GatewaySubnet tooforward todo el tráfico de tooAzure de local a través del dispositivo virtual Hola.</span><span class="sxs-lookup"><span data-stu-id="b4657-192">You can also add a user defined route (UDR) toohello GatewaySubnet tooforward all traffic from on-premises tooAzure through hello virtual appliance.</span></span> <span data-ttu-id="b4657-193">Esta es una incorporación reciente.</span><span class="sxs-lookup"><span data-stu-id="b4657-193">This is a recent addition.</span></span>
> 
> 

### <a name="bgp-routes"></a><span data-ttu-id="b4657-194">Rutas BGP</span><span class="sxs-lookup"><span data-stu-id="b4657-194">BGP routes</span></span>
<span data-ttu-id="b4657-195">Si tiene una conexión de ExpressRoute entre la red local y Azure, puede habilitar las rutas BGP toopropagate desde su tooAzure de red local.</span><span class="sxs-lookup"><span data-stu-id="b4657-195">If you have an ExpressRoute connection between your on-premises network and Azure, you can enable BGP toopropagate routes from your on-premises network tooAzure.</span></span> <span data-ttu-id="b4657-196">Estas rutas BGP se usan en hello igual que las rutas del sistema y el usuario define las rutas en cada subred de Azure.</span><span class="sxs-lookup"><span data-stu-id="b4657-196">These BGP routes are used in hello same way as system routes and user defined routes in each Azure subnet.</span></span> <span data-ttu-id="b4657-197">Para obtener más información, consulte [Introducción a ExpressRoute](../expressroute/expressroute-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="b4657-197">For more information see [ExpressRoute Introduction](../expressroute/expressroute-introduction.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b4657-198">Puede configurar su entorno de Azure toouse aplicar el túnel forzado a través de la red local mediante la creación de una ruta definida por el usuario para 0.0.0.0/0 de subred que utiliza la puerta de enlace VPN de hello como próximo salto de Hola.</span><span class="sxs-lookup"><span data-stu-id="b4657-198">You can configure your Azure environment toouse force tunneling through your on-premises network by creating a user defined route for subnet 0.0.0.0/0 that uses hello VPN gateway as hello next hop.</span></span> <span data-ttu-id="b4657-199">Sin embargo, esto solo funciona si se utiliza una puerta de enlace de VPN, no ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="b4657-199">However, this only works if you are using a VPN gateway, not ExpressRoute.</span></span> <span data-ttu-id="b4657-200">Para ExpressRoute, la tunelización forzada se configura a través de BGP.</span><span class="sxs-lookup"><span data-stu-id="b4657-200">For ExpressRoute, forced tunneling is configured through BGP.</span></span>
> 
> 

## <a name="ip-forwarding"></a><span data-ttu-id="b4657-201">Reenvío IP</span><span class="sxs-lookup"><span data-stu-id="b4657-201">IP forwarding</span></span>
<span data-ttu-id="b4657-202">Como se describió anteriormente, uno de hello razones principales toocreate una ruta definida por el usuario es dispositivo virtual de tooforward tráfico tooa.</span><span class="sxs-lookup"><span data-stu-id="b4657-202">As described above, one of hello main reasons toocreate a user defined route is tooforward traffic tooa virtual appliance.</span></span> <span data-ttu-id="b4657-203">Un dispositivo virtual es nada más que una máquina virtual que se ejecuta un aplicación que se usa el tráfico de red toohandle de alguna manera, como un firewall o un dispositivo NAT.</span><span class="sxs-lookup"><span data-stu-id="b4657-203">A virtual appliance is nothing more than a VM that runs an application used toohandle network traffic in some way, such as a firewall or a NAT device.</span></span>

<span data-ttu-id="b4657-204">Este dispositivo virtual de que VM debe ser capaz de tooreceive el tráfico entrante que está dirigido no tooitself.</span><span class="sxs-lookup"><span data-stu-id="b4657-204">This virtual appliance VM must be able tooreceive incoming traffic that is not addressed tooitself.</span></span> <span data-ttu-id="b4657-205">tooallow un tráfico de tooreceive VM direccionado tooother destinos, debe habilitar el reenvío IP para hello máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="b4657-205">tooallow a VM tooreceive traffic addressed tooother destinations, you must enable IP Forwarding for hello VM.</span></span> <span data-ttu-id="b4657-206">Se trata de una configuración, no es una configuración de sistema operativo de Hola de Azure.</span><span class="sxs-lookup"><span data-stu-id="b4657-206">This is an Azure setting, not a setting in hello guest operating system.</span></span>

## <a name="next-steps"></a><span data-ttu-id="b4657-207">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="b4657-207">Next steps</span></span>
* <span data-ttu-id="b4657-208">Obtenga información acerca de cómo demasiado[crear rutas en el modelo de implementación del Administrador de recursos de hello](virtual-network-create-udr-arm-template.md) y asociarlos toosubnets.</span><span class="sxs-lookup"><span data-stu-id="b4657-208">Learn how too[create routes in hello Resource Manager deployment model](virtual-network-create-udr-arm-template.md) and associate them toosubnets.</span></span> 
* <span data-ttu-id="b4657-209">Obtenga información acerca de cómo demasiado[crear rutas en el modelo de implementación clásica de hello](virtual-network-create-udr-classic-ps.md) y asociarlos toosubnets.</span><span class="sxs-lookup"><span data-stu-id="b4657-209">Learn how too[create routes in hello classic deployment model](virtual-network-create-udr-classic-ps.md) and associate them toosubnets.</span></span>


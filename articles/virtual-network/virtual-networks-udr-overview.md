---
title: "Rutas definidas por el usuario y reenvío IP en Azure | Microsoft Docs"
description: "Aprenda a configurar rutas definidas por el usuario (UDR) y el reenvío IP para reenviar el tráfico a las aplicaciones de red virtual de Azure."
services: virtual-network
documentationcenter: na
author: jimdial
manager: timlt
editor: tysonn
ms.assetid: c39076c4-11b7-4b46-a904-817503c4b486
ms.service: virtual-network
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/15/2016
ms.author: jdial
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 6274e0101f6fb0864c8d1efaef7fcde78b8760c3
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="user-defined-routes-and-ip-forwarding"></a><span data-ttu-id="d864a-103">Rutas definidas por el usuario y reenvío IP</span><span class="sxs-lookup"><span data-stu-id="d864a-103">User-defined routes and IP forwarding</span></span>

<span data-ttu-id="d864a-104">Al agregar máquinas virtuales (VM) a una red virtual (VNet) en Azure, observará que las máquinas virtuales son capaces de comunicarse automáticamente con otras máquinas por toda la red.</span><span class="sxs-lookup"><span data-stu-id="d864a-104">When you add virtual machines (VMs) to a virtual network (VNet) in Azure, you will notice that the VMs are able to communicate with each other over the network, automatically.</span></span> <span data-ttu-id="d864a-105">No es necesario que especifique una puerta de enlace, incluso si las máquinas virtuales están en subredes diferentes.</span><span class="sxs-lookup"><span data-stu-id="d864a-105">You do not need to specify a gateway, even though the VMs are in different subnets.</span></span> <span data-ttu-id="d864a-106">Cuando existe una conexión híbrida de Azure a su centro de datos, puede aplicar esto a la comunicación de las máquinas virtuales en la red pública e incluso a su red local.</span><span class="sxs-lookup"><span data-stu-id="d864a-106">The same is true for communication from the VMs to the public Internet, and even to your on-premises network when a hybrid connection from Azure to your own datacenter is present.</span></span>

<span data-ttu-id="d864a-107">Este flujo de comunicación es posible porque Azure usa varias rutas del sistema que definen cómo fluye el tráfico IP.</span><span class="sxs-lookup"><span data-stu-id="d864a-107">This flow of communication is possible because Azure uses a series of system routes to define how IP traffic flows.</span></span> <span data-ttu-id="d864a-108">Las rutas del sistema controlan el flujo de comunicación de los escenarios siguientes:</span><span class="sxs-lookup"><span data-stu-id="d864a-108">System routes control the flow of communication in the following scenarios:</span></span>

* <span data-ttu-id="d864a-109">Desde dentro de la misma subred.</span><span class="sxs-lookup"><span data-stu-id="d864a-109">From within the same subnet.</span></span>
* <span data-ttu-id="d864a-110">Desde una subred a otra dentro de una red virtual.</span><span class="sxs-lookup"><span data-stu-id="d864a-110">From a subnet to another within a VNet.</span></span>
* <span data-ttu-id="d864a-111">Desde máquinas virtuales a Internet.</span><span class="sxs-lookup"><span data-stu-id="d864a-111">From VMs to the Internet.</span></span>
* <span data-ttu-id="d864a-112">Desde una red virtual a otra red virtual a través de una puerta de enlace de VPN.</span><span class="sxs-lookup"><span data-stu-id="d864a-112">From a VNet to another VNet through a VPN gateway.</span></span>
* <span data-ttu-id="d864a-113">Desde una red virtual a otra red virtual mediante emparejamiento de redes virtuales (encadenamiento de servicios).</span><span class="sxs-lookup"><span data-stu-id="d864a-113">From a VNet to another VNet through VNet Peering (Service Chaining).</span></span>
* <span data-ttu-id="d864a-114">Desde una red virtual a su red local a través de una puerta de enlace de VPN.</span><span class="sxs-lookup"><span data-stu-id="d864a-114">From a VNet to your on-premises network through a VPN gateway.</span></span>

<span data-ttu-id="d864a-115">La siguiente ilustración muestra una configuración simple con una red virtual, dos subredes y algunas máquinas virtuales, junto con las rutas del sistema que permiten el flujo del tráfico IP.</span><span class="sxs-lookup"><span data-stu-id="d864a-115">The figure below shows a simple setup with a VNet, two subnets, and a few VMs, along with the system routes that allow IP traffic to flow.</span></span>

![Rutas del sistema de Azure](./media/virtual-networks-udr-overview/Figure1.png)

<span data-ttu-id="d864a-117">Aunque el uso de rutas del sistema facilita el tráfico automáticamente para su implementación, hay casos en los que seguramente quiera controlar el enrutamiento de paquetes a través de una aplicación virtual.</span><span class="sxs-lookup"><span data-stu-id="d864a-117">Although the use of system routes facilitates traffic automatically for your deployment, there are cases in which you want to control the routing of packets through a virtual appliance.</span></span> <span data-ttu-id="d864a-118">Puede hacerlo mediante la creación de rutas definidas por el usuario que especifiquen el próximo salto de los paquetes que fluyen a una subred específica para que así vayan a su dispositivo virtual y se habilite el reenvío IP de la máquina virtual que funciona como aplicación virtual.</span><span class="sxs-lookup"><span data-stu-id="d864a-118">You can do so by creating user defined routes that specify the next hop for packets flowing to a specific subnet to go to your virtual appliance instead, and enabling IP forwarding for the VM running as the virtual appliance.</span></span>

<span data-ttu-id="d864a-119">La siguiente ilustración muestra un ejemplo de las rutas definidas por el usuario y el reenvío IP para forzar el echo de que los paquetes enviados de una subred a otra vayan a través de una aplicación virtual en una subred de terceros.</span><span class="sxs-lookup"><span data-stu-id="d864a-119">The figure below shows an example of user defined routes and IP forwarding to force packets sent to one subnet from another to go through a virtual appliance on a third subnet.</span></span>

![Rutas del sistema de Azure](./media/virtual-networks-udr-overview/Figure2.png)

> [!IMPORTANT]
> <span data-ttu-id="d864a-121">Las rutas definidas por el usuario se aplican al tráfico que sale de una subred de cualquier recurso (por ejemplo, interfaces de red conectadas a máquinas virtuales) en la subred.</span><span class="sxs-lookup"><span data-stu-id="d864a-121">User-defined routes are applied to traffic leaving a subnet from any resource (such as network interfaces attached to VMs) in the subnet.</span></span> <span data-ttu-id="d864a-122">Por ejemplo, no puede crear rutas para especificar el modo de entrada del tráfico en una subred desde Internet.</span><span class="sxs-lookup"><span data-stu-id="d864a-122">You cannot create routes to specify how traffic enters a subnet from the Internet, for instance.</span></span> <span data-ttu-id="d864a-123">El dispositivo al que se va a reenviar el tráfico no puede estar en la misma subred donde se origina el tráfico.</span><span class="sxs-lookup"><span data-stu-id="d864a-123">The appliance you are forwarding traffic to cannot be in the same subnet where the traffic originates.</span></span> <span data-ttu-id="d864a-124">Recuerde siempre crear una subred independiente para sus aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="d864a-124">Always create a separate subnet for your appliances.</span></span> 
> 
> 

## <a name="route-resource"></a><span data-ttu-id="d864a-125">Recurso de ruta</span><span class="sxs-lookup"><span data-stu-id="d864a-125">Route resource</span></span>
<span data-ttu-id="d864a-126">Los paquetes se enrutan sobre una red TCP/IP basada en una tabla de enrutamiento definida en cada nodo de la red física.</span><span class="sxs-lookup"><span data-stu-id="d864a-126">Packets are routed over a TCP/IP network based on a route table defined at each node on the physical network.</span></span> <span data-ttu-id="d864a-127">Una tabla de enrutamiento es una colección de rutas individuales que se utiliza para decidir dónde reenviar los paquetes según la dirección IP de destino.</span><span class="sxs-lookup"><span data-stu-id="d864a-127">A route table is a collection of individual routes used to decide where to forward packets based on the destination IP address.</span></span> <span data-ttu-id="d864a-128">Una ruta consta de lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="d864a-128">A route consists of the following:</span></span>

| <span data-ttu-id="d864a-129">Propiedad</span><span class="sxs-lookup"><span data-stu-id="d864a-129">Property</span></span> | <span data-ttu-id="d864a-130">Description</span><span class="sxs-lookup"><span data-stu-id="d864a-130">Description</span></span> | <span data-ttu-id="d864a-131">Restricciones</span><span class="sxs-lookup"><span data-stu-id="d864a-131">Constraints</span></span> | <span data-ttu-id="d864a-132">Consideraciones</span><span class="sxs-lookup"><span data-stu-id="d864a-132">Considerations</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="d864a-133">Prefijo de dirección</span><span class="sxs-lookup"><span data-stu-id="d864a-133">Address Prefix</span></span> |<span data-ttu-id="d864a-134">El CIDR de destino al que se aplica la ruta, por ejemplo, 10.1.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="d864a-134">The destination CIDR to which the route applies, such as 10.1.0.0/16.</span></span> |<span data-ttu-id="d864a-135">Debe ser un intervalo de CIDR válidos que representan direcciones en la red Internet pública, la red virtual o el centro de datos local.</span><span class="sxs-lookup"><span data-stu-id="d864a-135">Must be a valid CIDR range representing addresses on the public Internet, Azure virtual network, or on-premises datacenter.</span></span> |<span data-ttu-id="d864a-136">Asegúrese de que **Prefijo de dirección** no contiene la dirección de **Siguiente dirección de salto**; de lo contrario, los paquetes entrarán en un bucle que va desde el origen al próximo salto sin llegar nunca al destino.</span><span class="sxs-lookup"><span data-stu-id="d864a-136">Make sure the **Address prefix** does not contain the address for the **Next hop address**, otherwise your packets will enter in a loop going from the source to the next hop without ever reaching the destination.</span></span> |
| <span data-ttu-id="d864a-137">Tipo de próximo salto</span><span class="sxs-lookup"><span data-stu-id="d864a-137">Next hop type</span></span> |<span data-ttu-id="d864a-138">El tipo de salto de Azure al que debe enviarse el paquete.</span><span class="sxs-lookup"><span data-stu-id="d864a-138">The type of Azure hop the packet should be sent to.</span></span> |<span data-ttu-id="d864a-139">Debe ser uno de los siguientes valores: </span><span class="sxs-lookup"><span data-stu-id="d864a-139">Must be one of the following values:</span></span> <br/> <span data-ttu-id="d864a-140">**Red virtual**.</span><span class="sxs-lookup"><span data-stu-id="d864a-140">**Virtual Network**.</span></span> <span data-ttu-id="d864a-141">Representa la red virtual local.</span><span class="sxs-lookup"><span data-stu-id="d864a-141">Represents the local virtual network.</span></span> <span data-ttu-id="d864a-142">Por ejemplo, si tiene dos subredes, 10.1.0.0/16 y 10.2.0.0/16, en la misma red virtual, la ruta de cada una de ellas en la tabla de rutas tendrá un valor de próximo salto de *Red virtual*.</span><span class="sxs-lookup"><span data-stu-id="d864a-142">For instance, if you have two subnets, 10.1.0.0/16 and 10.2.0.0/16 in the same virtual network, the route for each subnet in the route table will have a next hop value of *Virtual Network*.</span></span> <br/> <span data-ttu-id="d864a-143">**Puerta de enlace de red virtual**.</span><span class="sxs-lookup"><span data-stu-id="d864a-143">**Virtual Network Gateway**.</span></span> <span data-ttu-id="d864a-144">Representa una puerta de enlace de VPN S2S de Azure.</span><span class="sxs-lookup"><span data-stu-id="d864a-144">Represents an Azure S2S VPN Gateway.</span></span> <br/> <span data-ttu-id="d864a-145">**Internet**.</span><span class="sxs-lookup"><span data-stu-id="d864a-145">**Internet**.</span></span> <span data-ttu-id="d864a-146">Representa la puerta de enlace de Internet predeterminada proporcionada por la infraestructura de Azure.</span><span class="sxs-lookup"><span data-stu-id="d864a-146">Represents the default Internet gateway provided by the Azure Infrastructure.</span></span> <br/> <span data-ttu-id="d864a-147">**Dispositivo virtual**.</span><span class="sxs-lookup"><span data-stu-id="d864a-147">**Virtual Appliance**.</span></span> <span data-ttu-id="d864a-148">Representa un dispositivo virtual agregado a la red virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="d864a-148">Represents a virtual appliance you added to your Azure virtual network.</span></span> <br/> <span data-ttu-id="d864a-149">**No**.</span><span class="sxs-lookup"><span data-stu-id="d864a-149">**None**.</span></span> <span data-ttu-id="d864a-150">Representa un agujero negro.</span><span class="sxs-lookup"><span data-stu-id="d864a-150">Represents a black hole.</span></span> <span data-ttu-id="d864a-151">Los paquetes enviados a un agujero negro no se reenviarán de ninguna manera.</span><span class="sxs-lookup"><span data-stu-id="d864a-151">Packets forwarded to a black hole will not be forwarded at all.</span></span> |<span data-ttu-id="d864a-152">Considere la posibilidad de usar **Aplicación virtual** para dirigir el tráfico a una máquina virtual o a una dirección IP interna de Azure Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="d864a-152">Consider using **Virtual Appliance** to direct traffic to a VM or Azure Load Balancer internal IP address.</span></span>  <span data-ttu-id="d864a-153">Este tipo permite la especificación de una dirección IP, tal y como se describe a continuación.</span><span class="sxs-lookup"><span data-stu-id="d864a-153">This type allows the specification of an IP address as described below.</span></span> <span data-ttu-id="d864a-154">Considere la posibilidad de usar el tipo **No** para evitar que los paquetes vayan a un destino dado.</span><span class="sxs-lookup"><span data-stu-id="d864a-154">Consider using a **None** type to stop packets from flowing to a given destination.</span></span> |
| <span data-ttu-id="d864a-155">Siguiente dirección de salto</span><span class="sxs-lookup"><span data-stu-id="d864a-155">Next hop address</span></span> |<span data-ttu-id="d864a-156">La siguiente dirección de salto contiene la dirección IP a la que se deben reenviar los paquetes.</span><span class="sxs-lookup"><span data-stu-id="d864a-156">The next hop address contains the IP address packets should be forwarded to.</span></span> <span data-ttu-id="d864a-157">Solo se permiten valores de próximo salto en las rutas donde el tipo de próximo salto es *Dispositivo virtual*.</span><span class="sxs-lookup"><span data-stu-id="d864a-157">Next hop values are only allowed in routes where the next hop type is *Virtual Appliance*.</span></span> |<span data-ttu-id="d864a-158">Debe ser una dirección IP accesible dentro de la red virtual donde se aplica la ruta definida por el usuario, sin atravesar una **puerta de enlace de red virtual**.</span><span class="sxs-lookup"><span data-stu-id="d864a-158">Must be an IP address that is reachable within the Virtual Network where the User Defined Route is applied, without going through a **Virtual Network Gateway**.</span></span> <span data-ttu-id="d864a-159">La dirección IP debe estar en la misma red virtual en la que se aplica, o en una red virtual emparejada.</span><span class="sxs-lookup"><span data-stu-id="d864a-159">The IP address has to be on the same Virtual Network where it is applied, or on a peered Virtual Network.</span></span> |<span data-ttu-id="d864a-160">Si la dirección IP representa una máquina virtual, asegúrese de habilitar el [reenvío de IP](#IP-forwarding) en Azure para la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="d864a-160">If the IP address represents a VM, make sure you enable [IP forwarding](#IP-forwarding) in Azure for the VM.</span></span> <span data-ttu-id="d864a-161">Si la dirección IP representa la dirección IP interna de Azure Load Balancer, asegúrese de que tenga una regla de equilibrio de carga coincidente para cada puerto en el que quiera equilibrar la carga.</span><span class="sxs-lookup"><span data-stu-id="d864a-161">If the IP address represents the internal IP address of Azure Load Balancer, make sure you have a matching load balancing rule for each port you wish to load balance.</span></span>|

<span data-ttu-id="d864a-162">En Azure PowerShell, algunos de los valores de "NextHopType" tienen otros nombres:</span><span class="sxs-lookup"><span data-stu-id="d864a-162">In Azure PowerShell some of the "NextHopType" values have different names:</span></span>

* <span data-ttu-id="d864a-163">Red virtual es VnetLocal</span><span class="sxs-lookup"><span data-stu-id="d864a-163">Virtual Network is VnetLocal</span></span>
* <span data-ttu-id="d864a-164">Puerta de enlace de red virtual es VirtualNetworkGateway</span><span class="sxs-lookup"><span data-stu-id="d864a-164">Virtual Network Gateway is VirtualNetworkGateway</span></span>
* <span data-ttu-id="d864a-165">Aplicación virtual es VirtualAppliance</span><span class="sxs-lookup"><span data-stu-id="d864a-165">Virtual Appliance is VirtualAppliance</span></span>
* <span data-ttu-id="d864a-166">Internet es Internet</span><span class="sxs-lookup"><span data-stu-id="d864a-166">Internet is Internet</span></span>
* <span data-ttu-id="d864a-167">No es None</span><span class="sxs-lookup"><span data-stu-id="d864a-167">None is None</span></span>

### <a name="system-routes"></a><span data-ttu-id="d864a-168">Rutas del sistema</span><span class="sxs-lookup"><span data-stu-id="d864a-168">System routes</span></span>
<span data-ttu-id="d864a-169">Cada subred que se creó en una red virtual se asocia automáticamente a una tabla de enrutamiento que contiene las siguientes reglas de ruta de sistema:</span><span class="sxs-lookup"><span data-stu-id="d864a-169">Every subnet created in a virtual network is automatically associated with a route table that contains the following system route rules:</span></span>

* <span data-ttu-id="d864a-170">**Regla de red virtual local**: esta regla se crea automáticamente para cada subred de una red virtual.</span><span class="sxs-lookup"><span data-stu-id="d864a-170">**Local Vnet Rule**: This rule is automatically created for every subnet in a virtual network.</span></span> <span data-ttu-id="d864a-171">Especifica que hay un vínculo directo entre las máquinas virtuales en la red virtual y que no hay ningún salto intermedio.</span><span class="sxs-lookup"><span data-stu-id="d864a-171">It specifies that there is a direct link between the VMs in the VNet and there is no intermediate next hop.</span></span>
* <span data-ttu-id="d864a-172">**Regla local**: esta regla se aplica a todo el tráfico destinado al intervalo de direcciones locales y usa la puerta de enlace de VPN como el próximo destino del salto.</span><span class="sxs-lookup"><span data-stu-id="d864a-172">**On-premises Rule**: This rule applies to all traffic destined to the on-premises address range and uses VPN gateway as the next hop destination.</span></span>
* <span data-ttu-id="d864a-173">**Regla de Internet**: esta regla controla todo el tráfico destinado a la red pública (prefijo de dirección 0.0.0.0/0) y usa la puerta de enlace de Internet de infraestructura como el próximo salto para todo el tráfico destinado a Internet.</span><span class="sxs-lookup"><span data-stu-id="d864a-173">**Internet Rule**: This rule handles all traffic destined to the public Internet (address prefix 0.0.0.0/0) and uses the infrastructure internet gateway as the next hop for all traffic destined to the Internet.</span></span>

### <a name="user-defined-routes"></a><span data-ttu-id="d864a-174">Rutas definidas por el usuario</span><span class="sxs-lookup"><span data-stu-id="d864a-174">User-defined routes</span></span>
<span data-ttu-id="d864a-175">Para la mayoría de los entornos, sólo necesitará usar las rutas del sistema ya definidas por Azure.</span><span class="sxs-lookup"><span data-stu-id="d864a-175">For most environments you will only need the system routes already defined by Azure.</span></span> <span data-ttu-id="d864a-176">Sin embargo, puede que necesite crear una tabla de enrutamiento y agregar una o varias rutas en casos concretos, como:</span><span class="sxs-lookup"><span data-stu-id="d864a-176">However, you may need to create a route table and add one or more routes in specific cases, such as:</span></span>

* <span data-ttu-id="d864a-177">Tunelización forzada a Internet a través de la red local.</span><span class="sxs-lookup"><span data-stu-id="d864a-177">Force tunneling to the Internet via your on-premises network.</span></span>
* <span data-ttu-id="d864a-178">Uso de dispositivos virtuales en el entorno de Azure.</span><span class="sxs-lookup"><span data-stu-id="d864a-178">Use of virtual appliances in your Azure environment.</span></span>

<span data-ttu-id="d864a-179">En los escenarios anteriores, tendrá que crear una tabla de enrutamiento y agregarle las rutas definidas por el usuario.</span><span class="sxs-lookup"><span data-stu-id="d864a-179">In the scenarios above, you will have to create a route table and add user defined routes to it.</span></span> <span data-ttu-id="d864a-180">Puede tener varias tablas de enrutamiento y la misma tabla de enrutamiento puede asociarse a una o varias subredes.</span><span class="sxs-lookup"><span data-stu-id="d864a-180">You can have multiple route tables, and the same route table can be associated to one or more subnets.</span></span> <span data-ttu-id="d864a-181">Y cada subred solo puede estar asociada a una tabla de enrutamiento única.</span><span class="sxs-lookup"><span data-stu-id="d864a-181">And each subnet can only be associated to a single route table.</span></span> <span data-ttu-id="d864a-182">Todas las máquinas virtuales y servicios de nube de una subred utilizan la tabla de enrutamiento asociada a esa subred.</span><span class="sxs-lookup"><span data-stu-id="d864a-182">All VMs and cloud services in a subnet use the route table associated to that subnet.</span></span>

<span data-ttu-id="d864a-183">Las subredes dependen de las rutas del sistema hasta que una tabla de enrutamiento se asocia a la subred.</span><span class="sxs-lookup"><span data-stu-id="d864a-183">Subnets rely on system routes until a route table is associated to the subnet.</span></span> <span data-ttu-id="d864a-184">Una vez creada una asociación, el enrutamiento se realiza según la coincidencia de prefijo más larga (LPM) entre las rutas definidas por el usuario y las rutas predeterminadas.</span><span class="sxs-lookup"><span data-stu-id="d864a-184">Once an association exists, routing is done based on Longest Prefix Match (LPM) among both user defined routes and system routes.</span></span> <span data-ttu-id="d864a-185">Si hay más de una ruta con la misma coincidencia LPM, se selecciona una ruta en función de su origen en el orden siguiente:</span><span class="sxs-lookup"><span data-stu-id="d864a-185">If there is more than one route with the same LPM match then a route is selected based on its origin in the following order:</span></span>

1. <span data-ttu-id="d864a-186">Ruta definida por el usuario</span><span class="sxs-lookup"><span data-stu-id="d864a-186">User defined route</span></span>
2. <span data-ttu-id="d864a-187">Ruta BGP (cuando se utiliza ExpressRoute)</span><span class="sxs-lookup"><span data-stu-id="d864a-187">BGP route (when ExpressRoute is used)</span></span>
3. <span data-ttu-id="d864a-188">Ruta del sistema</span><span class="sxs-lookup"><span data-stu-id="d864a-188">System route</span></span>

<span data-ttu-id="d864a-189">Para obtener información sobre cómo crear rutas definidas por el usuario, consulte [Cómo crear rutas y habilitar el reenvío IP en Azure](virtual-network-create-udr-arm-template.md).</span><span class="sxs-lookup"><span data-stu-id="d864a-189">To learn how to create user defined routes, see [How to Create Routes and Enable IP Forwarding in Azure](virtual-network-create-udr-arm-template.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d864a-190">Las rutas definidas por el usuario solo se aplican a las máquinas virtuales de Azure y servicios de nube.</span><span class="sxs-lookup"><span data-stu-id="d864a-190">User defined routes are only applied to Azure VMs and cloud services.</span></span> <span data-ttu-id="d864a-191">Por ejemplo, si quiere agregar un dispositivo virtual de firewall entre la red local y Azure, tendrá que crear una ruta definida por el usuario para las tablas de rutas de Azure que reenvíe todo el tráfico que va al espacio de direcciones local al dispositivo virtual.</span><span class="sxs-lookup"><span data-stu-id="d864a-191">For instance, if you want to add a firewall virtual appliance between your on-premises network and Azure, you will have to create a user defined route for your Azure route tables that forwards all traffic going to the on-premises address space to the virtual appliance.</span></span> <span data-ttu-id="d864a-192">También puede agregar una ruta definida por el usuario (UDR) a GatewaySubnet para reenviar todo el tráfico local a Azure a través de la aplicación virtual.</span><span class="sxs-lookup"><span data-stu-id="d864a-192">You can also add a user defined route (UDR) to the GatewaySubnet to forward all traffic from on-premises to Azure through the virtual appliance.</span></span> <span data-ttu-id="d864a-193">Esta es una incorporación reciente.</span><span class="sxs-lookup"><span data-stu-id="d864a-193">This is a recent addition.</span></span>
> 
> 

### <a name="bgp-routes"></a><span data-ttu-id="d864a-194">Rutas BGP</span><span class="sxs-lookup"><span data-stu-id="d864a-194">BGP routes</span></span>
<span data-ttu-id="d864a-195">Si tiene una conexión de ExpressRoute entre la red local y Azure, puede habilitar BGP propagar las rutas de la red local a Azure.</span><span class="sxs-lookup"><span data-stu-id="d864a-195">If you have an ExpressRoute connection between your on-premises network and Azure, you can enable BGP to propagate routes from your on-premises network to Azure.</span></span> <span data-ttu-id="d864a-196">Estas rutas BGP se usan de la misma forma que las rutas del sistema y las rutas definidas por el usuario en cada subred de Azure.</span><span class="sxs-lookup"><span data-stu-id="d864a-196">These BGP routes are used in the same way as system routes and user defined routes in each Azure subnet.</span></span> <span data-ttu-id="d864a-197">Para obtener más información, consulte [Introducción a ExpressRoute](../expressroute/expressroute-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="d864a-197">For more information see [ExpressRoute Introduction](../expressroute/expressroute-introduction.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d864a-198">Puede configurar el entorno de Azure para forzar la tunelización a través de la red local mediante la creación de una ruta definida por el usuario para la subred 0.0.0.0/0 que utiliza la puerta de enlace de VPN como el próximo salto.</span><span class="sxs-lookup"><span data-stu-id="d864a-198">You can configure your Azure environment to use force tunneling through your on-premises network by creating a user defined route for subnet 0.0.0.0/0 that uses the VPN gateway as the next hop.</span></span> <span data-ttu-id="d864a-199">Sin embargo, esto solo funciona si se utiliza una puerta de enlace de VPN, no ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="d864a-199">However, this only works if you are using a VPN gateway, not ExpressRoute.</span></span> <span data-ttu-id="d864a-200">Para ExpressRoute, la tunelización forzada se configura a través de BGP.</span><span class="sxs-lookup"><span data-stu-id="d864a-200">For ExpressRoute, forced tunneling is configured through BGP.</span></span>
> 
> 

## <a name="ip-forwarding"></a><span data-ttu-id="d864a-201">Reenvío IP</span><span class="sxs-lookup"><span data-stu-id="d864a-201">IP forwarding</span></span>
<span data-ttu-id="d864a-202">Como se describió anteriormente, una de las razones principales para crear una ruta definida por el usuario es reenviar el tráfico a un dispositivo virtual.</span><span class="sxs-lookup"><span data-stu-id="d864a-202">As described above, one of the main reasons to create a user defined route is to forward traffic to a virtual appliance.</span></span> <span data-ttu-id="d864a-203">Un dispositivo virtual no es más que una máquina virtual que ejecuta una aplicación utilizada para controlar el tráfico de red de alguna manera, como un firewall o un dispositivo NAT.</span><span class="sxs-lookup"><span data-stu-id="d864a-203">A virtual appliance is nothing more than a VM that runs an application used to handle network traffic in some way, such as a firewall or a NAT device.</span></span>

<span data-ttu-id="d864a-204">La máquina virtual de este dispositivo virtual debe ser capaz de recibir el tráfico entrante que no se dirige a sí mismo.</span><span class="sxs-lookup"><span data-stu-id="d864a-204">This virtual appliance VM must be able to receive incoming traffic that is not addressed to itself.</span></span> <span data-ttu-id="d864a-205">Para permitir que una máquina virtual reciba el tráfico dirigido a otros destinos, debe habilitar el reenvío IP de la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="d864a-205">To allow a VM to receive traffic addressed to other destinations, you must enable IP Forwarding for the VM.</span></span> <span data-ttu-id="d864a-206">Esta es una opción de configuración de Azure, no de la configuración del sistema operativo invitado.</span><span class="sxs-lookup"><span data-stu-id="d864a-206">This is an Azure setting, not a setting in the guest operating system.</span></span>

## <a name="next-steps"></a><span data-ttu-id="d864a-207">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="d864a-207">Next steps</span></span>
* <span data-ttu-id="d864a-208">Obtenga información sobre cómo [crear rutas en el modelo de implementación del Administrador de recursos](virtual-network-create-udr-arm-template.md) y asociarlos a subredes.</span><span class="sxs-lookup"><span data-stu-id="d864a-208">Learn how to [create routes in the Resource Manager deployment model](virtual-network-create-udr-arm-template.md) and associate them to subnets.</span></span> 
* <span data-ttu-id="d864a-209">Obtenga información sobre cómo [crear rutas en el modelo de implementación clásico](virtual-network-create-udr-classic-ps.md) y asociarlos a subredes.</span><span class="sxs-lookup"><span data-stu-id="d864a-209">Learn how to [create routes in the classic deployment model](virtual-network-create-udr-classic-ps.md) and associate them to subnets.</span></span>


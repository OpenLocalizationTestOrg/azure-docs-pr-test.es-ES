---
title: "Uso de instantáneas incrementales para realizar operaciones de copia de seguridad y recuperación de discos de máquinas virtuales de Azure no administrados | Microsoft Docs"
description: "Cree una solución personalizada para realizar operaciones de copia de seguridad y recuperación de los discos de máquina virtual de Azure mediante instantáneas incrementales."
services: storage
documentationcenter: na
author: aungoo-msft
manager: tadb
editor: tysonn
ms.assetid: 3524b987-bd65-4e35-83e7-fbc2136643e5
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/23/2017
ms.author: aungoo
ms.openlocfilehash: 7b08ce207b2a3cc2dd3d3559765def6af42a844a
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="back-up-azure-unmanaged-vm-disks-with-incremental-snapshots"></a><span data-ttu-id="bfd58-103">Copias de seguridad de discos de máquinas virtuales de Azure no administrados con instantáneas incrementales</span><span class="sxs-lookup"><span data-stu-id="bfd58-103">Back up Azure unmanaged VM disks with incremental snapshots</span></span>
## <a name="overview"></a><span data-ttu-id="bfd58-104">Información general</span><span class="sxs-lookup"><span data-stu-id="bfd58-104">Overview</span></span>
<span data-ttu-id="bfd58-105">Almacenamiento de Azure permite realizar instantáneas de blobs.</span><span class="sxs-lookup"><span data-stu-id="bfd58-105">Azure Storage provides the capability to take snapshots of blobs.</span></span> <span data-ttu-id="bfd58-106">Dichas instantáneas capturan el estado del blob en el preciso momento en el que se realicen.</span><span class="sxs-lookup"><span data-stu-id="bfd58-106">Snapshots capture the blob state at that point in time.</span></span> <span data-ttu-id="bfd58-107">En este artículo, se describirá cómo mantener copias de seguridad de discos de máquinas virtuales por medio de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="bfd58-107">In this article, we will describe a scenario of how you can maintain backups of virtual machine disks using snapshots.</span></span> <span data-ttu-id="bfd58-108">Podrá utilizar esta metodología cuando opte por no usar el servicio de recuperación y copia de seguridad de Azure y quiera crear una estrategia de copias de seguridad personalizada para los discos de sus máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="bfd58-108">You can use this methodology when you choose not to use Azure Backup and Recovery Service, and wish to create a custom backup strategy for your virtual machine disks.</span></span>

<span data-ttu-id="bfd58-109">Los discos de las máquinas virtuales de Azure se almacenan como blobs en páginas en Almacenamiento de Azure.</span><span class="sxs-lookup"><span data-stu-id="bfd58-109">Azure virtual machine disks are stored as page blobs in Azure Storage.</span></span> <span data-ttu-id="bfd58-110">Como en este artículo estamos viendo una estrategia de copias de seguridad para discos de máquinas virtuales, cuando hablemos de instantáneas, lo haremos en el contexto de blobs de páginas.</span><span class="sxs-lookup"><span data-stu-id="bfd58-110">Since we are talking about backup strategy for virtual machine disks in this article, we will be referring to snapshots in the context of page blobs.</span></span> <span data-ttu-id="bfd58-111">Para obtener más información sobre las instantáneas, consulte [Creación de una instantánea a partir de un blob](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span><span class="sxs-lookup"><span data-stu-id="bfd58-111">To learn more about snapshots, refer to [Creating a Snapshot of a Blob](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span></span>

## <a name="what-is-a-snapshot"></a><span data-ttu-id="bfd58-112">¿Qué es una instantánea?</span><span class="sxs-lookup"><span data-stu-id="bfd58-112">What is a snapshot?</span></span>
<span data-ttu-id="bfd58-113">Una instantánea de blob es una versión de solo lectura de un blob que se ha capturado en un momento dado.</span><span class="sxs-lookup"><span data-stu-id="bfd58-113">A blob snapshot is a read-only version of a blob that is captured at a point in time.</span></span> <span data-ttu-id="bfd58-114">Una vez se crea la instantánea, puede leerla, copiarla o eliminarla, pero no modificarla.</span><span class="sxs-lookup"><span data-stu-id="bfd58-114">Once a snapshot has been created, it can be read, copied, or deleted, but not modified.</span></span> <span data-ttu-id="bfd58-115">Las instantáneas le ofrecen una oportunidad de realizar una copia de seguridad de un blob en el momento en que éste aparezca.</span><span class="sxs-lookup"><span data-stu-id="bfd58-115">Snapshots provide a way to back up a blob as it appears at a moment in time.</span></span> <span data-ttu-id="bfd58-116">Hasta la versión 2015-04-05 de REST, podía copiar instantáneas completas.</span><span class="sxs-lookup"><span data-stu-id="bfd58-116">Until REST version 2015-04-05 you had the ability to copy full snapshots.</span></span> <span data-ttu-id="bfd58-117">Con la versión 2015-07-08 de REST y posteriores, también puede copiar instantáneas incrementales.</span><span class="sxs-lookup"><span data-stu-id="bfd58-117">With the REST version 2015-07-08 and above, you can also copy incremental snapshots.</span></span>

## <a name="full-snapshot-copy"></a><span data-ttu-id="bfd58-118">Copia de instantáneas completas</span><span class="sxs-lookup"><span data-stu-id="bfd58-118">Full snapshot copy</span></span>
<span data-ttu-id="bfd58-119">Es posible copiar las instantáneas en otra cuenta de almacenamiento como un blob para guardar copias de seguridad del blob de base.</span><span class="sxs-lookup"><span data-stu-id="bfd58-119">Snapshots can be copied to another storage account as a blob to keep backups of the base blob.</span></span> <span data-ttu-id="bfd58-120">También puede sobrescribir el blob de base con una instantánea suya, lo que equivale a restaurar el blob a una versión previa.</span><span class="sxs-lookup"><span data-stu-id="bfd58-120">You can also copy a snapshot over its base blob, which is like restoring the blob to an earlier version.</span></span> <span data-ttu-id="bfd58-121">Cuando una instantánea se copia de una cuenta de almacenamiento en otra, ocupa el mismo espacio que el blob en páginas de base.</span><span class="sxs-lookup"><span data-stu-id="bfd58-121">When a snapshot is copied from one storage account to another, it will occupy the same space as the base page blob.</span></span> <span data-ttu-id="bfd58-122">Por lo tanto, la copia de instantáneas completas de una cuenta de almacenamiento a otra será un proceso lento y también consumirá mucho espacio en la de destino.</span><span class="sxs-lookup"><span data-stu-id="bfd58-122">Therefore, copying whole snapshots from one storage account to another will be slow and will also consume lot of space in the target storage account.</span></span>

> [!NOTE]
> <span data-ttu-id="bfd58-123">Si copia el blob de base en otro destino, sus instantáneas no se copian junto con él.</span><span class="sxs-lookup"><span data-stu-id="bfd58-123">If you copy the base blob to another destination, the snapshots of the blob are not copied along with it.</span></span> <span data-ttu-id="bfd58-124">Igualmente, si sobrescribe un blob de base con una copia, las instantáneas asociadas a él no se ven afectadas, sino que permanecen intactas con el nombre del blob de base.</span><span class="sxs-lookup"><span data-stu-id="bfd58-124">Similarly, if you overwrite a base blob with a copy, snapshots associated with the base blob are not affected and stay intact under base blob name.</span></span>
> 
> 

### <a name="back-up-disks-using-snapshots"></a><span data-ttu-id="bfd58-125">Copia de seguridad de discos mediante instantáneas</span><span class="sxs-lookup"><span data-stu-id="bfd58-125">Back up disks using snapshots</span></span>
<span data-ttu-id="bfd58-126">Como una estrategia de copias de seguridad para los discos de sus máquinas virtuales, puede realizar instantáneas periódicas del disco o el blob en páginas y copiarlas en otra cuenta de almacenamiento mediante herramientas como la operación [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) o [AzCopy](storage-use-azcopy.md).</span><span class="sxs-lookup"><span data-stu-id="bfd58-126">As a backup strategy for your virtual machine disks, you can take periodic snapshots of the disk or page blob, and copy them to another storage account using tools like [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) operation or [AzCopy](storage-use-azcopy.md).</span></span> <span data-ttu-id="bfd58-127">Puede copiar una instantánea en un blob en páginas de destino con un nombre diferente.</span><span class="sxs-lookup"><span data-stu-id="bfd58-127">You can copy a snapshot to a destination page blob with a different name.</span></span> <span data-ttu-id="bfd58-128">El blob en páginas de destino resultante es un blob en páginas en el que se puede escribir y no una instantánea.</span><span class="sxs-lookup"><span data-stu-id="bfd58-128">The resulting destination page blob is a writeable page blob and not a snapshot.</span></span> <span data-ttu-id="bfd58-129">Más adelante en este artículo, se describirán los pasos para realizar copias de seguridad de discos de máquinas virtuales mediante instantáneas.</span><span class="sxs-lookup"><span data-stu-id="bfd58-129">Later in this article we will describe steps to take backups of virtual machine disks using snapshots.</span></span>

### <a name="restore-disks-using-snapshots"></a><span data-ttu-id="bfd58-130">Restauración de discos mediante instantáneas</span><span class="sxs-lookup"><span data-stu-id="bfd58-130">Restore disks using snapshots</span></span>
<span data-ttu-id="bfd58-131">Cuando llegue el momento de restaurar el disco a una versión estable anterior capturada en una de las instantáneas de copia de seguridad, podrá sobrescribir el blob en páginas de base con ella.</span><span class="sxs-lookup"><span data-stu-id="bfd58-131">When it is time to restore your disk to a previous stable version captured in one of the backup snapshots, you can copy a snapshot over the base page blob.</span></span> <span data-ttu-id="bfd58-132">Una vez que se convierta la instantánea en el blob en páginas de base, esta se conservará, pero el origen se sobrescribe con una copia de lectura y escritura.</span><span class="sxs-lookup"><span data-stu-id="bfd58-132">After the snapshot is promoted to the base page blob, the snapshot remains, but its source is overwritten with a copy that can be both read and written.</span></span> <span data-ttu-id="bfd58-133">Más adelante en este artículo, se describirán los pasos para restaurar una versión anterior de su disco a partir de su instantánea.</span><span class="sxs-lookup"><span data-stu-id="bfd58-133">Later in this article we will describe steps to restore a previous version of your disk from its snapshot.</span></span>

### <a name="implementing-full-snapshot-copy"></a><span data-ttu-id="bfd58-134">Implementación de una copia una instantánea completa</span><span class="sxs-lookup"><span data-stu-id="bfd58-134">Implementing full snapshot copy</span></span>
<span data-ttu-id="bfd58-135">Puede implementar una copia de una instantánea completa siguiendo estos pasos:</span><span class="sxs-lookup"><span data-stu-id="bfd58-135">You can implement a full snapshot copy by doing the following,</span></span>

* <span data-ttu-id="bfd58-136">Primero, realice una instantánea del blob de base con la operación [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx) .</span><span class="sxs-lookup"><span data-stu-id="bfd58-136">First, take a snapshot of the base blob using the [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx) operation.</span></span>
* <span data-ttu-id="bfd58-137">Después, copie la instantánea en una cuenta de almacenamiento de destino mediante [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span><span class="sxs-lookup"><span data-stu-id="bfd58-137">Then, copy the snapshot to a target storage account using [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span></span>
* <span data-ttu-id="bfd58-138">Repita este proceso para mantener copias de seguridad de su blob de base.</span><span class="sxs-lookup"><span data-stu-id="bfd58-138">Repeat this process to maintain backup copies of your base blob.</span></span>

## <a name="incremental-snapshot-copy"></a><span data-ttu-id="bfd58-139">Copia de instantáneas incrementales</span><span class="sxs-lookup"><span data-stu-id="bfd58-139">Incremental snapshot copy</span></span>
<span data-ttu-id="bfd58-140">La nueva característica de la API [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) ofrece un modo mucho mejor de realizar copias de seguridad de las instantáneas de los discos o blobs en páginas.</span><span class="sxs-lookup"><span data-stu-id="bfd58-140">The new feature in [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) API provides a much better way to back up the snapshots of your page blobs or disks.</span></span> <span data-ttu-id="bfd58-141">La API devuelve la lista de cambios entre el blob de base y las instantáneas.</span><span class="sxs-lookup"><span data-stu-id="bfd58-141">The API returns the list of changes between the base blob and the snapshots.</span></span> <span data-ttu-id="bfd58-142">Así se reduce la cantidad de espacio de almacenamiento empleado en la cuenta de la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bfd58-142">This reduces the amount of storage space used on the backup account.</span></span> <span data-ttu-id="bfd58-143">La API es compatible con blobs en páginas en Almacenamiento premium, así como en su vertiente estándar.</span><span class="sxs-lookup"><span data-stu-id="bfd58-143">The API supports page blobs on Premium Storage as well as Standard Storage.</span></span> <span data-ttu-id="bfd58-144">Gracias a esta API, ya puede crear soluciones de copia de seguridad más rápidas y eficaces para las VM de Azure.</span><span class="sxs-lookup"><span data-stu-id="bfd58-144">Using this API, you can now build faster and efficient backup solutions for Azure VMs.</span></span> <span data-ttu-id="bfd58-145">Estará disponible con la versión 2015-07-08 de REST y posteriores.</span><span class="sxs-lookup"><span data-stu-id="bfd58-145">This will be available with the REST version 2015-07-08 and higher.</span></span>

<span data-ttu-id="bfd58-146">La copia de instantáneas incrementales permite realizar copiar de una cuenta de almacenamiento a otra la diferencia entre:</span><span class="sxs-lookup"><span data-stu-id="bfd58-146">Incremental Snapshot Copy allows you to copy from one storage account to another the difference between,</span></span>

* <span data-ttu-id="bfd58-147">Un blob de base y su instantánea, o bien</span><span class="sxs-lookup"><span data-stu-id="bfd58-147">Base blob and its Snapshot OR</span></span>
* <span data-ttu-id="bfd58-148">Dos instantáneas cualesquiera del blob de base</span><span class="sxs-lookup"><span data-stu-id="bfd58-148">Any two snapshots of the base blob</span></span>

<span data-ttu-id="bfd58-149">Siempre que se cumplan las condiciones siguientes:</span><span class="sxs-lookup"><span data-stu-id="bfd58-149">Provided the following conditions are met,</span></span>

* <span data-ttu-id="bfd58-150">El blob se creó a partir del 1 de enero de 2016.</span><span class="sxs-lookup"><span data-stu-id="bfd58-150">The blob was created on Jan-1-2016 or later.</span></span>
* <span data-ttu-id="bfd58-151">El blob no se sobrescribió con [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) o [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) entre dos instantáneas.</span><span class="sxs-lookup"><span data-stu-id="bfd58-151">The blob was not overwritten with [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) or [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) between two snapshots.</span></span>

<span data-ttu-id="bfd58-152">**Nota**: Esta característica está disponible para los blobs en páginas de Azure premium y estándar.</span><span class="sxs-lookup"><span data-stu-id="bfd58-152">**Note**: This feature is available for Premium and Standard Azure Page Blobs.</span></span>

<span data-ttu-id="bfd58-153">Cuando se emplea una estrategia de copia de seguridad personalizada en la que se utilicen instantáneas, la copia de estas últimas de una cuenta de almacenamiento a otra puede ser muy lenta y consumir mucho espacio.</span><span class="sxs-lookup"><span data-stu-id="bfd58-153">When you have a custom backup strategy that uses snapshots, copying the snapshots from one storage account to another can be very slow and consumes a lot of storage space.</span></span> <span data-ttu-id="bfd58-154">En lugar de copiar toda la instantánea en una cuenta de almacenamiento de copia de seguridad, puede escribir la diferencia entre instantáneas consecutivas en un blob en páginas de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bfd58-154">Instead of copying the entire snapshot to a backup storage account, you can write the difference between consecutive snapshots to a backup page blob.</span></span> <span data-ttu-id="bfd58-155">De este modo, se reduce considerablemente el tiempo de copia y espacio necesario para almacenar las copias de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bfd58-155">This way, the time to copy and space to store backups is substantially reduced.</span></span>

### <a name="implementing-incremental-snapshot-copy"></a><span data-ttu-id="bfd58-156">Implementación de la copia de instantáneas incrementales</span><span class="sxs-lookup"><span data-stu-id="bfd58-156">Implementing Incremental Snapshot Copy</span></span>
<span data-ttu-id="bfd58-157">Puede implementar la copia de instantáneas incrementales siguiendo estos pasos:</span><span class="sxs-lookup"><span data-stu-id="bfd58-157">You can implement incremental snapshot copy by doing the following,</span></span>

* <span data-ttu-id="bfd58-158">Realice una instantánea del blob de base mediante [Instantánea de blob](https://msdn.microsoft.com/library/azure/ee691971.aspx).</span><span class="sxs-lookup"><span data-stu-id="bfd58-158">Take a snapshot of the base blob using [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx).</span></span>
* <span data-ttu-id="bfd58-159">Copie la instantánea en una cuenta de almacenamiento de copia de seguridad de destino mediante [Copiar blob](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span><span class="sxs-lookup"><span data-stu-id="bfd58-159">Copy the snapshot to the target backup storage account using [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span></span> <span data-ttu-id="bfd58-160">Este será el blob en páginas de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bfd58-160">This will be the backup page blob.</span></span> <span data-ttu-id="bfd58-161">Realice una instantánea de este blob en páginas de copia de seguridad y almacénela en la cuenta de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bfd58-161">Take a snapshot of this backup page blob and store in backup account.</span></span>
* <span data-ttu-id="bfd58-162">Realice otra instantánea del blob de base mediante Instantánea de blob.</span><span class="sxs-lookup"><span data-stu-id="bfd58-162">Take another snapshot of the base blob using Snapshot Blob.</span></span>
* <span data-ttu-id="bfd58-163">Obtenga la diferencia entre la primera y la segunda instantánea del blob de base mediante [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx).</span><span class="sxs-lookup"><span data-stu-id="bfd58-163">Get the difference between first and second snapshots of base blob using  [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx).</span></span> <span data-ttu-id="bfd58-164">Use el nuevo parámetro **prevsnapshot** para especificar el valor DateTime de la instantánea que quiere usar para obtener la diferencia.</span><span class="sxs-lookup"><span data-stu-id="bfd58-164">Use the new parameter **prevsnapshot** to specify the DateTime value of the snapshot you want to get the difference with.</span></span> <span data-ttu-id="bfd58-165">Cuando este parámetro esté presente, la respuesta de REST solo incorporará las páginas que se cambiaron entre la instantánea de destino y la anterior, incluidas las borradas.</span><span class="sxs-lookup"><span data-stu-id="bfd58-165">When this parameter is present, the REST response will include only the pages that were changed between target snapshot and previous snapshot including clear pages.</span></span>
* <span data-ttu-id="bfd58-166">Use [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) para aplicar estos cambios al blob en páginas de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bfd58-166">Use [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) to apply these changes to the backup page blob.</span></span>
* <span data-ttu-id="bfd58-167">Por último, realice una instantánea del blob en páginas de copia de seguridad y almacénela en la cuenta de almacenamiento de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bfd58-167">Finally, take a snapshot of the backup page blob and store it in the backup storage account.</span></span>

<span data-ttu-id="bfd58-168">En la siguiente sección, se describirá en mayor profundidad cómo puede mantener copias de seguridad de discos mediante la copia de instantáneas incrementales.</span><span class="sxs-lookup"><span data-stu-id="bfd58-168">In the next section, we will describe in more detail how you can maintain backups of disks using Incremental Snapshot Copy</span></span>

## <a name="scenario"></a><span data-ttu-id="bfd58-169">Escenario</span><span class="sxs-lookup"><span data-stu-id="bfd58-169">Scenario</span></span>
<span data-ttu-id="bfd58-170">En esta sección vamos a describir un escenario en el que se utiliza una estrategia de copia de seguridad personalizada para discos de máquinas virtuales que usan instantáneas.</span><span class="sxs-lookup"><span data-stu-id="bfd58-170">In this section we will describe a scenario that involves a custom backup strategy for virtual machine disks using snapshots.</span></span>

<span data-ttu-id="bfd58-171">Considere la posibilidad de usar una VM de Azure de serie DS con un disco P30 de almacenamiento premium conectado.</span><span class="sxs-lookup"><span data-stu-id="bfd58-171">Consider a DS-series Azure VM with a premium storage P30 disk attached.</span></span> <span data-ttu-id="bfd58-172">El disco P30 denominado *mypremiumdisk* se almacena en una cuenta de almacenamiento premium denominada *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="bfd58-172">The P30 disk called *mypremiumdisk* is stored in a premium storage account called *mypremiumaccount*.</span></span> <span data-ttu-id="bfd58-173">Se usará una cuenta de almacenamiento estándar denominada *mybackupstdaccount* para almacenar la copia de seguridad de *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="bfd58-173">A standard storage account called *mybackupstdaccount* will be used for storing the backup of *mypremiumdisk*.</span></span> <span data-ttu-id="bfd58-174">Nos gustaría mantener una instantánea de *mypremiumdisk* cada 12 horas.</span><span class="sxs-lookup"><span data-stu-id="bfd58-174">We would like to keep a snapshot of *mypremiumdisk* every 12 hours.</span></span>

<span data-ttu-id="bfd58-175">Para obtener información sobre cómo crear discos y cuentas de almacenamiento, consulte [About Azure storage accounts](storage-create-storage-account.md)(Acerca de las cuentas de almacenamiento de Azure).</span><span class="sxs-lookup"><span data-stu-id="bfd58-175">To learn about creating storage account and disks, refer to [About Azure storage accounts](storage-create-storage-account.md).</span></span>

<span data-ttu-id="bfd58-176">Para obtener información sobre la realización de copias de seguridad de máquinas virtuales de Azure, consulte [Plan Azure VM backups](../backup/backup-azure-vms-introduction.md)(Planeación de copias de seguridad de máquinas virtuales de Azure).</span><span class="sxs-lookup"><span data-stu-id="bfd58-176">To learn about backing up Azure VMs, refer to [Plan Azure VM backups](../backup/backup-azure-vms-introduction.md).</span></span>

## <a name="steps-to-maintain-backups-of-a-disk-using-incremental-snapshots"></a><span data-ttu-id="bfd58-177">Pasos para mantener copias de seguridad de un disco con instantáneas incrementales</span><span class="sxs-lookup"><span data-stu-id="bfd58-177">Steps to maintain backups of a disk using incremental snapshots</span></span>
<span data-ttu-id="bfd58-178">En los pasos que se describen a continuación se realizarán instantáneas de *mypremiumdisk* y las copias de seguridad se mantendrán en *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="bfd58-178">The steps described below will take snapshots of *mypremiumdisk* and maintain the backups in *mybackupstdaccount*.</span></span> <span data-ttu-id="bfd58-179">La copia de seguridad será un blob en páginas estándar denominado *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="bfd58-179">The backup will be a standard page blob called *mybackupstdpageblob*.</span></span> <span data-ttu-id="bfd58-180">El blob en páginas de copia de seguridad siempre reflejará el mismo estado que la última instantánea de *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="bfd58-180">The backup page blob will always reflect the same state as the last snapshot of *mypremiumdisk*.</span></span>

1. <span data-ttu-id="bfd58-181">En primer lugar, cree el blob en páginas de copia de seguridad del disco de almacenamiento premium.</span><span class="sxs-lookup"><span data-stu-id="bfd58-181">First, create the backup page blob for your premium storage disk.</span></span> <span data-ttu-id="bfd58-182">Para ello, realice una instantánea de *mypremiumdisk* denominada *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="bfd58-182">To do this, take a snapshot of *mypremiumdisk* called *mypremiumdisk_ss1*.</span></span>
2. <span data-ttu-id="bfd58-183">Copie esta instantánea en mybackupstdaccount como un blob en páginas denominado *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="bfd58-183">Copy this snapshot to mybackupstdaccount as a page blob called *mybackupstdpageblob*.</span></span>
3. <span data-ttu-id="bfd58-184">Realice una instantánea de *mybackupstdpageblob* denominada *mybackupstdpageblob_ss1* con [Instantánea de blob](https://msdn.microsoft.com/library/azure/ee691971.aspx) y almacénela en *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="bfd58-184">Take a snapshot of *mybackupstdpageblob* called *mybackupstdpageblob_ss1*, using [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx) and store it in *mybackupstdaccount*.</span></span>
4. <span data-ttu-id="bfd58-185">En la ventana de copia de seguridad, cree otra instantánea de *mypremiumdisk*, por ejemplo, *mypremiumdisk_ss2*, y almacénela en *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="bfd58-185">During the backup window, create another snapshot of *mypremiumdisk*, say *mypremiumdisk_ss2*, and store it in *mypremiumaccount*.</span></span>
5. <span data-ttu-id="bfd58-186">Obtenga los cambios incrementales entre las dos instantáneas, *mypremiumdisk_ss2* y *mypremiumdisk_ss1*, con [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) en *mypremiumdisk_ss2* con el parámetro **prevsnapshot** establecido en la marca de tiempo de *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="bfd58-186">Get the incremental changes between the two snapshots, *mypremiumdisk_ss2* and *mypremiumdisk_ss1*, using [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) on *mypremiumdisk_ss2* with **prevsnapshot** parameter set to the timestamp of *mypremiumdisk_ss1*.</span></span> <span data-ttu-id="bfd58-187">Escriba estos cambios incrementales en el blob en páginas de copia de seguridad *mybackupstdpageblob* de *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="bfd58-187">Write these incremental changes to the backup page blob *mybackupstdpageblob* in *mybackupstdaccount*.</span></span> <span data-ttu-id="bfd58-188">Si hay intervalos eliminados en los cambios incrementales, deben borrarse desde el blob en páginas de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bfd58-188">If there are deleted ranges in the incremental changes, they must be cleared from the backup page blob.</span></span> <span data-ttu-id="bfd58-189">Use [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) para escribir los cambios incrementales en el blob en páginas de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bfd58-189">Use [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) to write incremental changes to the backup page blob.</span></span>
6. <span data-ttu-id="bfd58-190">Realice una instantánea del blob en páginas de copia de seguridad *mybackupstdpageblob* denominada *mybackupstdpageblob_ss2*.</span><span class="sxs-lookup"><span data-stu-id="bfd58-190">Take a snapshot of the backup page blob *mybackupstdpageblob*, called *mybackupstdpageblob_ss2*.</span></span> <span data-ttu-id="bfd58-191">Elimine la instantánea anterior *mypremiumdisk_ss1* de la cuenta de almacenamiento premium.</span><span class="sxs-lookup"><span data-stu-id="bfd58-191">Delete the previous snapshot *mypremiumdisk_ss1* from premium storage account.</span></span>
7. <span data-ttu-id="bfd58-192">Repita los pasos del 4 al 6 en cada ventana de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bfd58-192">Repeat steps 4-6 every backup window.</span></span> <span data-ttu-id="bfd58-193">De esta forma, puede mantener copias de seguridad de *mypremiumdisk* en una cuenta de almacenamiento estándar.</span><span class="sxs-lookup"><span data-stu-id="bfd58-193">In this way, you can maintain backups of *mypremiumdisk* in a standard storage account.</span></span>

![Realización de copias de seguridad de discos usando instantáneas incrementales](./media/storage-incremental-snapshots/storage-incremental-snapshots-1.png)

## <a name="steps-to-restore-a-disk-from-snapshots"></a><span data-ttu-id="bfd58-195">Pasos para restaurar un disco de las instantáneas</span><span class="sxs-lookup"><span data-stu-id="bfd58-195">Steps to restore a disk from snapshots</span></span>
<span data-ttu-id="bfd58-196">En los pasos descritos a continuación se restaurará el disco premium, *mypremiumdisk*, a una instantánea anterior desde la cuenta de almacenamiento de copia de seguridad *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="bfd58-196">The steps described below will restore premium disk, *mypremiumdisk* to an earlier snapshot from the backup storage account *mybackupstdaccount*.</span></span>

1. <span data-ttu-id="bfd58-197">Identifique el momento al que desea restaurar el disco premium.</span><span class="sxs-lookup"><span data-stu-id="bfd58-197">Identify the point in time you wish to restore the premium disk to.</span></span> <span data-ttu-id="bfd58-198">Supongamos que es la instantánea *mybackupstdpageblob_ss2*, que se almacena en la cuenta de almacenamiento de copia de seguridad *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="bfd58-198">Let's say that is snapshot *mybackupstdpageblob_ss2*, which is stored in the backup storage account *mybackupstdaccount*.</span></span>
2. <span data-ttu-id="bfd58-199">En mybackupstdaccount, promueva la instantánea *mybackupstdpageblob_ss2* como el nuevo blob en páginas de base de copia de seguridad *mybackupstdpageblobrestored*.</span><span class="sxs-lookup"><span data-stu-id="bfd58-199">In mybackupstdaccount, promote the snapshot *mybackupstdpageblob_ss2* as the new backup base page blob *mybackupstdpageblobrestored*.</span></span>
3. <span data-ttu-id="bfd58-200">Realice una instantánea de este blob en páginas de copia de seguridad restaurado denominada *mybackupstdpageblobrestored_ss1*.</span><span class="sxs-lookup"><span data-stu-id="bfd58-200">Take a snapshot of this restored backup page blob, called *mybackupstdpageblobrestored_ss1*.</span></span>
4. <span data-ttu-id="bfd58-201">Copie el blob en páginas restaurado *mybackupstdpageblobrestored* desde *mybackupstdaccount* en *mypremiumaccount* como el nuevo disco premium *mypremiumdiskrestored*.</span><span class="sxs-lookup"><span data-stu-id="bfd58-201">Copy the restored page blob *mybackupstdpageblobrestored* from *mybackupstdaccount* to *mypremiumaccount* as the new premium disk *mypremiumdiskrestored*.</span></span>
5. <span data-ttu-id="bfd58-202">Realice una instantánea de *mypremiumdiskrestored* denominada *mypremiumdiskrestored_ss1* para realizar futuras copias de seguridad incrementales.</span><span class="sxs-lookup"><span data-stu-id="bfd58-202">Take a snapshot of *mypremiumdiskrestored*, called *mypremiumdiskrestored_ss1* for making future incremental backups.</span></span>
6. <span data-ttu-id="bfd58-203">Seleccione la máquina virtual de serie DS en el disco restaurado *mypremiumdiskrestored* y desasocie el *mypremiumdisk* anterior de la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="bfd58-203">Point the DS series VM to the restored disk *mypremiumdiskrestored* and detach the old *mypremiumdisk* from the VM.</span></span>
7. <span data-ttu-id="bfd58-204">Inicie el proceso de copia de seguridad que se describe en la sección anterior para el disco restaurado *mypremiumdiskrestored* con *mybackupstdpageblobrestored* como el blob en páginas de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bfd58-204">Begin the Backup process described in previous section for the restored disk *mypremiumdiskrestored*, using the *mybackupstdpageblobrestored* as the backup page blob.</span></span>

![Restauración de discos usando instantáneas](./media/storage-incremental-snapshots/storage-incremental-snapshots-2.png)

## <a name="next-steps"></a><span data-ttu-id="bfd58-206">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="bfd58-206">Next Steps</span></span>
<span data-ttu-id="bfd58-207">Obtenga más información sobre cómo crear instantáneas de un blob y planear la infraestructura de copia de seguridad de máquinas virtuales mediante los vínculos siguientes.</span><span class="sxs-lookup"><span data-stu-id="bfd58-207">Learn more about creating snapshots of a blob and planning your VM backup infrastructure using the links below.</span></span>

* [<span data-ttu-id="bfd58-208">Crear una instantánea de un blob</span><span class="sxs-lookup"><span data-stu-id="bfd58-208">Creating a Snapshot of a Blob</span></span>](https://msdn.microsoft.com/library/azure/hh488361.aspx)
* [<span data-ttu-id="bfd58-209">Planeación de la infraestructura de copia de seguridad de máquinas virtuales</span><span class="sxs-lookup"><span data-stu-id="bfd58-209">Plan your VM Backup Infrastructure</span></span>](../backup/backup-azure-vms-introduction.md)


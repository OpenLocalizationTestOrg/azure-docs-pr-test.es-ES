---
title: "Administración de la simultaneidad en Almacenamiento de Microsoft Azure"
description: "Administración de la simultaneidad para los servicios BLOB, Cola, Tabla y Archivo"
services: storage
documentationcenter: 
author: jasontang501
manager: tadb
editor: tysonn
ms.assetid: cc6429c4-23ee-46e3-b22d-50dd68bd4680
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 05/11/2017
ms.author: jasontang501
ms.openlocfilehash: 937cca66a0af0674b868e6a87681adbea330e91c
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/29/2017
---
# <a name="managing-concurrency-in-microsoft-azure-storage"></a><span data-ttu-id="4b7d9-103">Administración de la simultaneidad en Almacenamiento de Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="4b7d9-103">Managing Concurrency in Microsoft Azure Storage</span></span>
## <a name="overview"></a><span data-ttu-id="4b7d9-104">Información general</span><span class="sxs-lookup"><span data-stu-id="4b7d9-104">Overview</span></span>
<span data-ttu-id="4b7d9-105">Las aplicaciones modernas basadas en Internet, normalmente tienen varios usuarios que ven y actualizan datos simultáneamente.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-105">Modern Internet based applications usually have multiple users viewing and updating data simultaneously.</span></span> <span data-ttu-id="4b7d9-106">Esto requiere que los desarrolladores de las aplicaciones piensen detenidamente cómo proporcionar una experiencia predecible a sus usuarios finales, especialmente para escenarios donde varios usuarios pueden actualizar los mismos datos.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-106">This requires application developers to think carefully about how to provide a predictable experience to their end users, particularly for scenarios where multiple users can update the same data.</span></span> <span data-ttu-id="4b7d9-107">Hay tres estrategias principales de simultaneidad de datos que normalmente tienen en cuenta los desarrolladores:</span><span class="sxs-lookup"><span data-stu-id="4b7d9-107">There are three main data concurrency strategies that developers typically consider:</span></span>  

1. <span data-ttu-id="4b7d9-108">Simultaneidad optimista: una aplicación que realiza una actualización comprobará, como parte de dicha actualización, si los datos han cambiado desde que la aplicación leyera por última vez esos datos.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-108">Optimistic concurrency – An application performing an update will as part of its update verify if the data has changed since the application last read that data.</span></span> <span data-ttu-id="4b7d9-109">Por ejemplo, si dos usuarios que ven una página wiki realizan una actualización en la misma página, entonces la plataforma wiki debe asegurarse de que la segunda actualización no sobrescribe la primera y que ambos usuarios comprenden si sus actualizaciones se realizaron correctamente o no.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-109">For example, if two users viewing a wiki page make an update to the same page then the wiki platform must ensure that the second update does not overwrite the first update – and that both users understand whether their update was successful or not.</span></span> <span data-ttu-id="4b7d9-110">Esta estrategia se usa con más frecuencia en aplicaciones web.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-110">This strategy is most often used in web applications.</span></span>
2. <span data-ttu-id="4b7d9-111">Simultaneidad pesimista: una aplicación que pretende realizar una actualización realizará un bloqueo en un objeto evitando que otros usuarios actualicen los datos hasta que el bloqueo se libere.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-111">Pessimistic concurrency – An application looking to perform an update will take a lock on an object preventing other users from updating the data until the lock is released.</span></span> <span data-ttu-id="4b7d9-112">Por ejemplo, en un escenario de replicación de datos maestro/esclavo, donde solamente el maestro realiza actualizaciones, el maestro normalmente mantendrá un bloqueo exclusivo durante un período de tiempo extendido en los datos para garantizar que ninguna otra persona puede actualizarlos.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-112">For example, in a master/slave data replication scenario where only the master will perform updates the master will typically hold an exclusive lock for an extended period of time on the data to ensure no one else can update it.</span></span>
3. <span data-ttu-id="4b7d9-113">El último en escribir gana: enfoque que permite que cualquier operación de actualización se lleve a cabo sin comprobar si ninguna otra aplicación ha actualizado los datos desde la primera vez que la aplicación leyó los datos.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-113">Last writer wins – An approach that allows any update operations to proceed without verifying if any other application has updated the data since the application first read the data.</span></span> <span data-ttu-id="4b7d9-114">Esta estrategia (o ausencia de una estrategia formal) normalmente se usa donde los datos están particionados de tal forma que no existe probabilidad de que varios usuarios obtengan acceso a los mismos datos.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-114">This strategy (or lack of a formal strategy) is usually used where data is partitioned in such a way that there is no likelihood that multiple users will access the same data.</span></span> <span data-ttu-id="4b7d9-115">También puede resultar útil donde se procesen transmisiones de datos de corta duración.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-115">It can also be useful where short-lived data streams are being processed.</span></span>  

<span data-ttu-id="4b7d9-116">Este artículo proporciona información general de cómo la plataforma Almacenamiento de Azure simplifica el desarrollo proporcionando soporte de primera clase para estas tres estrategias de simultaneidad.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-116">This article provides an overview of how the Azure Storage platform simplifies development by providing first class support for all three of these concurrency strategies.</span></span>  

## <a name="azure-storage--simplifies-cloud-development"></a><span data-ttu-id="4b7d9-117">Almacenamiento de Azure: simplificación del desarrollo en la nube</span><span class="sxs-lookup"><span data-stu-id="4b7d9-117">Azure Storage – Simplifies Cloud Development</span></span>
<span data-ttu-id="4b7d9-118">El servicio Almacenamiento de Azure, admite las tres estrategias, aunque es diferente en su capacidad de proporcionar soporte completo para simultaneidad optimista y pesimista porque se diseñó para adoptar un modelo de coherencia fuerte que garantice que cuando el servicio Almacenamiento confirme una operación de inserción o actualización de datos, todos los demás accesos a esos datos vean la última actualización.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-118">The Azure storage service supports all three strategies, although it is distinctive in its ability to provide full support for optimistic and pessimistic concurrency because it was designed to embrace a strong consistency model which guarantees that when the Storage service commits a data insert or update operation all further accesses to that data will see the latest update.</span></span> <span data-ttu-id="4b7d9-119">Las plataformas de almacenamiento que usan un modelo de coherencia eventual tienen un retardo entre el momento en el que un usuario lleva a cabo una escritura y el momento en el que los datos actualizados pueden ser vistos por otros usuarios, lo que complica el desarrollo de aplicaciones cliente para evitar que las incoherencias afecten a los usuarios finales.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-119">Storage platforms that use an eventual consistency model have a lag between when a write is performed by one user and when the updated data can be seen by other users thus complicating development of client applications in order to prevent inconsistencies from affecting end users.</span></span>  

<span data-ttu-id="4b7d9-120">Además de seleccionar una estrategia de simultaneidad apropiada, los desarrolladores también deben saber cómo una plataforma de almacenamiento aísla los cambios, especialmente los cambios en el mismo objeto a través de transacciones.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-120">In addition to selecting an appropriate concurrency strategy developers should also be aware of how a storage platform isolates changes – particularly changes to the same object across transactions.</span></span> <span data-ttu-id="4b7d9-121">El servicio de almacenamiento de Azure usa aislamiento de instantáneas para permitir que las operaciones de lectura tengan lugar simultáneamente con operaciones de escritura dentro de una sola partición.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-121">The Azure storage service uses snapshot isolation to allow read operations to happen concurrently with write operations within a single partition.</span></span> <span data-ttu-id="4b7d9-122">A diferencia de otros niveles de aislamiento, el aislamiento de instantánea garantiza que todas las lecturas ven una instantánea coherente de datos incluso mientras tienen lugar las actualizaciones, básicamente devolviendo los últimos valores confirmados mientras una transacción de actualización se procesa.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-122">Unlike other isolation levels, snapshot isolation guarantees that all reads see a consistent snapshot of the data even while updates are occurring – essentially by returning the last committed values while an update transaction is being processed.</span></span>  

## <a name="managing-concurrency-in-blob-storage"></a><span data-ttu-id="4b7d9-123">Administrar la simultaneidad en almacenamiento de blobs</span><span class="sxs-lookup"><span data-stu-id="4b7d9-123">Managing Concurrency in Blob storage</span></span>
<span data-ttu-id="4b7d9-124">Puede optar por usar modelos de simultaneidad optimista o pesimista para administrar el acceso a blobs y contenedores del servicio BLOB.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-124">You can opt to use either optimistic or pessimistic concurrency models to manage access to blobs and containers in the blob service.</span></span> <span data-ttu-id="4b7d9-125">Si no especifica explícitamente una estrategia, la estrategia El último que escribe gana será la predeterminada.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-125">If you do not explicitly specify a strategy last writes wins is the default.</span></span>  

### <a name="optimistic-concurrency-for-blobs-and-containers"></a><span data-ttu-id="4b7d9-126">Simultaneidad optimista para blobs y contenedores</span><span class="sxs-lookup"><span data-stu-id="4b7d9-126">Optimistic concurrency for blobs and containers</span></span>
<span data-ttu-id="4b7d9-127">El servicio Almacenamiento asigna un identificador a cada objeto almacenado.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-127">The Storage service assigns an identifier to every object stored.</span></span> <span data-ttu-id="4b7d9-128">Este identificador se actualiza cada vez que se realiza una operación de actualización en un objeto.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-128">This identifier is updated every time an update operation is performed on an object.</span></span> <span data-ttu-id="4b7d9-129">El identificador se devuelve al cliente como parte de una respuesta HTTP GET usando el encabezado ETag (etiqueta de entidad) que se define dentro del protocolo HTTP.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-129">The identifier is returned to the client as part of an HTTP GET response using the ETag (entity tag) header that is defined within the HTTP protocol.</span></span> <span data-ttu-id="4b7d9-130">Un usuario que realiza una actualización en tal objeto puede enviar la etiqueta ETag original junto con un encabezado condicional para garantizar que una actualización solamente tendrá lugar si se ha cumplido una determinada condición; en este caso, la condición es un encabezado "If-Match", que requiere Storage Service para garantizar que el valor de ETag especificado en la solicitud de actualización sea el mismo que el almacenado en dicho servicio.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-130">A user performing an update on such an object can send in the original ETag along with a conditional header to ensure that an update will only occur if a certain condition has been met – in this case the condition is an "If-Match" header, which requires the Storage Service to ensure the value of the ETag specified in the update request is the same as that stored in the Storage Service.</span></span>  

<span data-ttu-id="4b7d9-131">El esquema de este proceso es el siguiente:</span><span class="sxs-lookup"><span data-stu-id="4b7d9-131">The outline of this process is as follows:</span></span>  

1. <span data-ttu-id="4b7d9-132">Recuperar un blob del servicio Almacenamiento. La respuesta incluye un valor de encabezado ETag HTTP que identifica la versión actual del objeto en el servicio Almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-132">Retrieve a blob from the storage service, the response includes an HTTP ETag Header value that identifies the current version of the object in the storage service.</span></span>
2. <span data-ttu-id="4b7d9-133">Cuando actualice el blob, incluya el valor ETag recibido en el paso 1 en el encabezado condicional **If-Match** de la solicitud que envía al servicio.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-133">When you update the blob, include the ETag value you received in step 1 in the **If-Match** conditional header of the request you send to the service.</span></span>
3. <span data-ttu-id="4b7d9-134">El servicio compara el valor ETag de la solicitud con el valor ETag actual del blob.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-134">The service compares the ETag value in the request with the current ETag value of the blob.</span></span>
4. <span data-ttu-id="4b7d9-135">Si el valor ETag actual del blob es una versión diferente de ETag del encabezado condicional **If-Match** de la solicitud, el servicio devuelve un error 412 al cliente.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-135">If the current ETag value of the blob is a different version than the ETag in the **If-Match** conditional header in the request, the service returns a 412 error to the client.</span></span> <span data-ttu-id="4b7d9-136">Esto indica al cliente que otro proceso ha actualizado el blob desde que el cliente lo recuperó.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-136">This indicates to the client that another process has updated the blob since the client retrieved it.</span></span>
5. <span data-ttu-id="4b7d9-137">Si el valor ETag actual del blob es la misma versión que el valor ETag del encabezado condicional **If-Match** de la solicitud, el servicio realiza la operación solicitada y actualiza el valor ETag actual del blob para mostrar que ha creado una nueva versión.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-137">If the current ETag value of the blob is the same version as the ETag in the **If-Match** conditional header in the request, the service performs the requested operation and updates the current ETag value of the blob to show that it has created a new version.</span></span>  

<span data-ttu-id="4b7d9-138">El siguiente fragmento de código de C# (usando Biblioteca de almacenamiento de cliente 4.2.0) muestra un ejemplo sencillo de cómo construir una **If-Match AccessCondition** basándose en el valor ETag al que se tiene acceso desde las propiedades de un blob que se recuperó o insertó previamente.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-138">The following C# snippet (using the Client Storage Library 4.2.0) shows a simple example of how to construct an **If-Match AccessCondition** based on the ETag value that is accessed from the properties of a blob that was previously either retrieved or inserted.</span></span> <span data-ttu-id="4b7d9-139">Luego usa el objeto **AccessCondition** cuando actualiza el blob: el objeto **AccessCondition** agrega el encabezado **If-Match** a la solicitud.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-139">It then uses the **AccessCondition** object when it updates the blob: the **AccessCondition** object adds the **If-Match** header to the request.</span></span> <span data-ttu-id="4b7d9-140">Si otro proceso ha actualizado el blob, el servicio BLOB devuelve un mensaje de estado HTTP 412 (Error en la condición previa).</span><span class="sxs-lookup"><span data-stu-id="4b7d9-140">If another process has updated the blob, the blob service returns an HTTP 412 (Precondition Failed) status message.</span></span> <span data-ttu-id="4b7d9-141">Puede descargar aquí el ejemplo completo: [Administración de simultaneidad con Almacenamiento de Azure](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span><span class="sxs-lookup"><span data-stu-id="4b7d9-141">You can download the full sample here: [Managing Concurrency using Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span></span>  

```csharp
// Retrieve the ETag from the newly created blob
// Etag is already populated as UploadText should cause a PUT Blob call
// to storage blob service which returns the etag in response.
string orignalETag = blockBlob.Properties.ETag;

// This code simulates an update by a third party.
string helloText = "Blob updated by a third party.";

// No etag, provided so orignal blob is overwritten (thus generating a new etag)
blockBlob.UploadText(helloText);
Console.WriteLine("Blob updated. Updated ETag = {0}",
blockBlob.Properties.ETag);

// Now try to update the blob using the orignal ETag provided when the blob was created
try
{
    Console.WriteLine("Trying to update blob using orignal etag to generate if-match access condition");
    blockBlob.UploadText(helloText,accessCondition:
    AccessCondition.GenerateIfMatchCondition(orignalETag));
}
catch (StorageException ex)
{
    if (ex.RequestInformation.HttpStatusCode == (int)HttpStatusCode.PreconditionFailed)
    {
        Console.WriteLine("Precondition failure as expected. Blob's orignal etag no longer matches");
        // TODO: client can decide on how it wants to handle the 3rd party updated content.
    }
    else
        throw;
}  
```

<span data-ttu-id="4b7d9-142">El servicio Storage también incluye soporte para encabezados condicionales adicionales como **If-Modified-Since**, **If-Unmodified-Since** y **If-None-Match**, además de combinaciones de los mismos.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-142">The Storage Service also includes support for additional conditional headers such as **If-Modified-Since**, **If-Unmodified-Since** and **If-None-Match** as well as combinations thereof.</span></span> <span data-ttu-id="4b7d9-143">Para obtener más información, consulte [Especificación de encabezados condicionales para las operaciones de Blob Service](http://msdn.microsoft.com/library/azure/dd179371.aspx) en MSDN.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-143">For more information, see [Specifying Conditional Headers for Blob Service Operations](http://msdn.microsoft.com/library/azure/dd179371.aspx) on MSDN.</span></span>  

<span data-ttu-id="4b7d9-144">En la siguiente tabla se resumen las operaciones de contenedor que aceptan encabezados condicionales como **If-Match** en la solicitud y que devuelven un valor ETag en la respuesta.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-144">The following table summarizes the container operations that accept conditional headers such as **If-Match** in the request and that return an ETag value in the response.</span></span>  

| <span data-ttu-id="4b7d9-145">Operación</span><span class="sxs-lookup"><span data-stu-id="4b7d9-145">Operation</span></span> | <span data-ttu-id="4b7d9-146">Devuelve el valor ETag del contenedor</span><span class="sxs-lookup"><span data-stu-id="4b7d9-146">Returns Container ETag value</span></span> | <span data-ttu-id="4b7d9-147">Acepta encabezados condicionales</span><span class="sxs-lookup"><span data-stu-id="4b7d9-147">Accepts conditional headers</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="4b7d9-148">Create Container</span><span class="sxs-lookup"><span data-stu-id="4b7d9-148">Create Container</span></span> |<span data-ttu-id="4b7d9-149">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-149">Yes</span></span> |<span data-ttu-id="4b7d9-150">No</span><span class="sxs-lookup"><span data-stu-id="4b7d9-150">No</span></span> |
| <span data-ttu-id="4b7d9-151">Get Container Properties</span><span class="sxs-lookup"><span data-stu-id="4b7d9-151">Get Container Properties</span></span> |<span data-ttu-id="4b7d9-152">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-152">Yes</span></span> |<span data-ttu-id="4b7d9-153">No</span><span class="sxs-lookup"><span data-stu-id="4b7d9-153">No</span></span> |
| <span data-ttu-id="4b7d9-154">Get Container Metadata</span><span class="sxs-lookup"><span data-stu-id="4b7d9-154">Get Container Metadata</span></span> |<span data-ttu-id="4b7d9-155">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-155">Yes</span></span> |<span data-ttu-id="4b7d9-156">No</span><span class="sxs-lookup"><span data-stu-id="4b7d9-156">No</span></span> |
| <span data-ttu-id="4b7d9-157">Set Container Metadata</span><span class="sxs-lookup"><span data-stu-id="4b7d9-157">Set Container Metadata</span></span> |<span data-ttu-id="4b7d9-158">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-158">Yes</span></span> |<span data-ttu-id="4b7d9-159">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-159">Yes</span></span> |
| <span data-ttu-id="4b7d9-160">Get Container ACL</span><span class="sxs-lookup"><span data-stu-id="4b7d9-160">Get Container ACL</span></span> |<span data-ttu-id="4b7d9-161">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-161">Yes</span></span> |<span data-ttu-id="4b7d9-162">No</span><span class="sxs-lookup"><span data-stu-id="4b7d9-162">No</span></span> |
| <span data-ttu-id="4b7d9-163">Set Container ACL</span><span class="sxs-lookup"><span data-stu-id="4b7d9-163">Set Container ACL</span></span> |<span data-ttu-id="4b7d9-164">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-164">Yes</span></span> |<span data-ttu-id="4b7d9-165">Sí (*)</span><span class="sxs-lookup"><span data-stu-id="4b7d9-165">Yes (*)</span></span> |
| <span data-ttu-id="4b7d9-166">Delete Container</span><span class="sxs-lookup"><span data-stu-id="4b7d9-166">Delete Container</span></span> |<span data-ttu-id="4b7d9-167">No</span><span class="sxs-lookup"><span data-stu-id="4b7d9-167">No</span></span> |<span data-ttu-id="4b7d9-168">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-168">Yes</span></span> |
| <span data-ttu-id="4b7d9-169">Lease Container</span><span class="sxs-lookup"><span data-stu-id="4b7d9-169">Lease Container</span></span> |<span data-ttu-id="4b7d9-170">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-170">Yes</span></span> |<span data-ttu-id="4b7d9-171">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-171">Yes</span></span> |
| <span data-ttu-id="4b7d9-172">List Blobs</span><span class="sxs-lookup"><span data-stu-id="4b7d9-172">List Blobs</span></span> |<span data-ttu-id="4b7d9-173">No</span><span class="sxs-lookup"><span data-stu-id="4b7d9-173">No</span></span> |<span data-ttu-id="4b7d9-174">No</span><span class="sxs-lookup"><span data-stu-id="4b7d9-174">No</span></span> |

<span data-ttu-id="4b7d9-175">(*) Los permisos definidos por SetContainerACL se almacenan en caché y las actualizaciones a estos permisos tardan 30 segundos en propagarse durante los cuales no se garantiza la coherencia de las actualizaciones.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-175">(*) The permissions defined by SetContainerACL are cached and updates to these permissions take 30 seconds to propagate during which period updates are not guaranteed to be consistent.</span></span>  

<span data-ttu-id="4b7d9-176">En la siguiente tabla, se resumen las operaciones de blob que aceptan encabezados condicionales como **If-Match** en la solicitud y que devuelven un valor ETag en la respuesta.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-176">The following table summarizes the blob operations that accept conditional headers such as **If-Match** in the request and that return an ETag value in the response.</span></span>

| <span data-ttu-id="4b7d9-177">Operación</span><span class="sxs-lookup"><span data-stu-id="4b7d9-177">Operation</span></span> | <span data-ttu-id="4b7d9-178">Devuelve el valor ETag</span><span class="sxs-lookup"><span data-stu-id="4b7d9-178">Returns ETag value</span></span> | <span data-ttu-id="4b7d9-179">Acepta encabezados condicionales</span><span class="sxs-lookup"><span data-stu-id="4b7d9-179">Accepts conditional headers</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="4b7d9-180">Put Blob</span><span class="sxs-lookup"><span data-stu-id="4b7d9-180">Put Blob</span></span> |<span data-ttu-id="4b7d9-181">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-181">Yes</span></span> |<span data-ttu-id="4b7d9-182">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-182">Yes</span></span> |
| <span data-ttu-id="4b7d9-183">Get Blob</span><span class="sxs-lookup"><span data-stu-id="4b7d9-183">Get Blob</span></span> |<span data-ttu-id="4b7d9-184">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-184">Yes</span></span> |<span data-ttu-id="4b7d9-185">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-185">Yes</span></span> |
| <span data-ttu-id="4b7d9-186">Get Blob Properties</span><span class="sxs-lookup"><span data-stu-id="4b7d9-186">Get Blob Properties</span></span> |<span data-ttu-id="4b7d9-187">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-187">Yes</span></span> |<span data-ttu-id="4b7d9-188">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-188">Yes</span></span> |
| <span data-ttu-id="4b7d9-189">Set Blob Properties</span><span class="sxs-lookup"><span data-stu-id="4b7d9-189">Set Blob Properties</span></span> |<span data-ttu-id="4b7d9-190">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-190">Yes</span></span> |<span data-ttu-id="4b7d9-191">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-191">Yes</span></span> |
| <span data-ttu-id="4b7d9-192">Get Blob Metadata</span><span class="sxs-lookup"><span data-stu-id="4b7d9-192">Get Blob Metadata</span></span> |<span data-ttu-id="4b7d9-193">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-193">Yes</span></span> |<span data-ttu-id="4b7d9-194">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-194">Yes</span></span> |
| <span data-ttu-id="4b7d9-195">Set Blob Metadata</span><span class="sxs-lookup"><span data-stu-id="4b7d9-195">Set Blob Metadata</span></span> |<span data-ttu-id="4b7d9-196">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-196">Yes</span></span> |<span data-ttu-id="4b7d9-197">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-197">Yes</span></span> |
| <span data-ttu-id="4b7d9-198">Lease Blob (*)</span><span class="sxs-lookup"><span data-stu-id="4b7d9-198">Lease Blob (*)</span></span> |<span data-ttu-id="4b7d9-199">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-199">Yes</span></span> |<span data-ttu-id="4b7d9-200">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-200">Yes</span></span> |
| <span data-ttu-id="4b7d9-201">Instantánea de blob</span><span class="sxs-lookup"><span data-stu-id="4b7d9-201">Snapshot Blob</span></span> |<span data-ttu-id="4b7d9-202">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-202">Yes</span></span> |<span data-ttu-id="4b7d9-203">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-203">Yes</span></span> |
| <span data-ttu-id="4b7d9-204">Copia de blobs</span><span class="sxs-lookup"><span data-stu-id="4b7d9-204">Copy Blob</span></span> |<span data-ttu-id="4b7d9-205">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-205">Yes</span></span> |<span data-ttu-id="4b7d9-206">Sí (para blob de origen y destino)</span><span class="sxs-lookup"><span data-stu-id="4b7d9-206">Yes (for source and destination blob)</span></span> |
| <span data-ttu-id="4b7d9-207">Abort Copy Blob</span><span class="sxs-lookup"><span data-stu-id="4b7d9-207">Abort Copy Blob</span></span> |<span data-ttu-id="4b7d9-208">No</span><span class="sxs-lookup"><span data-stu-id="4b7d9-208">No</span></span> |<span data-ttu-id="4b7d9-209">No</span><span class="sxs-lookup"><span data-stu-id="4b7d9-209">No</span></span> |
| <span data-ttu-id="4b7d9-210">Delete Blob</span><span class="sxs-lookup"><span data-stu-id="4b7d9-210">Delete Blob</span></span> |<span data-ttu-id="4b7d9-211">No</span><span class="sxs-lookup"><span data-stu-id="4b7d9-211">No</span></span> |<span data-ttu-id="4b7d9-212">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-212">Yes</span></span> |
| <span data-ttu-id="4b7d9-213">Put Block</span><span class="sxs-lookup"><span data-stu-id="4b7d9-213">Put Block</span></span> |<span data-ttu-id="4b7d9-214">No</span><span class="sxs-lookup"><span data-stu-id="4b7d9-214">No</span></span> |<span data-ttu-id="4b7d9-215">No</span><span class="sxs-lookup"><span data-stu-id="4b7d9-215">No</span></span> |
| <span data-ttu-id="4b7d9-216">Put Block List</span><span class="sxs-lookup"><span data-stu-id="4b7d9-216">Put Block List</span></span> |<span data-ttu-id="4b7d9-217">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-217">Yes</span></span> |<span data-ttu-id="4b7d9-218">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-218">Yes</span></span> |
| <span data-ttu-id="4b7d9-219">Get Block List</span><span class="sxs-lookup"><span data-stu-id="4b7d9-219">Get Block List</span></span> |<span data-ttu-id="4b7d9-220">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-220">Yes</span></span> |<span data-ttu-id="4b7d9-221">No</span><span class="sxs-lookup"><span data-stu-id="4b7d9-221">No</span></span> |
| <span data-ttu-id="4b7d9-222">Put Page</span><span class="sxs-lookup"><span data-stu-id="4b7d9-222">Put Page</span></span> |<span data-ttu-id="4b7d9-223">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-223">Yes</span></span> |<span data-ttu-id="4b7d9-224">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-224">Yes</span></span> |
| <span data-ttu-id="4b7d9-225">Get Page Ranges</span><span class="sxs-lookup"><span data-stu-id="4b7d9-225">Get Page Ranges</span></span> |<span data-ttu-id="4b7d9-226">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-226">Yes</span></span> |<span data-ttu-id="4b7d9-227">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-227">Yes</span></span> |

<span data-ttu-id="4b7d9-228">(*) Lease Blob no cambia ETag en un blob.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-228">(*) Lease Blob does not change the ETag on a blob.</span></span>  

### <a name="pessimistic-concurrency-for-blobs"></a><span data-ttu-id="4b7d9-229">Simultaneidad pesimista para blobs</span><span class="sxs-lookup"><span data-stu-id="4b7d9-229">Pessimistic concurrency for blobs</span></span>
<span data-ttu-id="4b7d9-230">Para bloquear un blob para uso exclusivo, puede adquirir una [concesión](http://msdn.microsoft.com/library/azure/ee691972.aspx) en él.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-230">To lock a blob for exclusive use, you can acquire a [lease](http://msdn.microsoft.com/library/azure/ee691972.aspx) on it.</span></span> <span data-ttu-id="4b7d9-231">Cuando adquiera una concesión, especifique durante cuánto tiempo necesita la concesión: puede ser entre 15 y 60 segundos o de manera infinita, lo que corresponde a un bloqueo exclusivo.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-231">When you acquire a lease, you specify for how long you need the lease: this can be for between 15 to 60 seconds or infinite, which amounts to an exclusive lock.</span></span> <span data-ttu-id="4b7d9-232">Puede renovar una concesión finita para extenderla y puede liberar cualquier concesión cuando haya terminado con ella.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-232">You can renew a finite lease to extend it, and you can release any lease when you are finished with it.</span></span> <span data-ttu-id="4b7d9-233">El servicio de blob libera automáticamente concesiones finitas cuando expiran.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-233">The blob service automatically releases finite leases when they expire.</span></span>  

<span data-ttu-id="4b7d9-234">Las concesiones permiten diferentes estrategias de sincronización, como por ejemplo las siguientes: escritura exclusiva / lectura compartida, escritura exclusiva / lectura exclusiva y escritura compartida / lectura exclusiva.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-234">Leases enable different synchronization strategies to be supported, including exclusive write / shared read, exclusive write / exclusive read and shared write / exclusive read.</span></span> <span data-ttu-id="4b7d9-235">Donde existe una concesión, el servicio Almacenamiento impone escrituras exclusivas (operaciones poner, establecer y eliminar) garantizando, sin embargo, que la exclusividad para operaciones de lectura requiere que el desarrollador garantice que todas las aplicaciones cliente usan un identificador de concesión y que solamente un cliente tiene un identificador de concesión válido en cada momento.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-235">Where a lease exists the storage service enforces exclusive writes (put, set and delete operations) however ensuring exclusivity for read operations requires the developer to ensure that all client applications use a lease ID and that only one client at a time has a valid lease ID.</span></span> <span data-ttu-id="4b7d9-236">Las operaciones de lectura que no incluyen un identificador de concesión, dan lugar a lecturas compartidas.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-236">Read operations that do not include a lease ID result in shared reads.</span></span>  

<span data-ttu-id="4b7d9-237">En el siguiente fragmento de código de C# se muestra un ejemplo de adquisición de una concesión exclusiva durante 30 segundos en un blob, actualizando el contenido de dicho blob y, a continuación, liberando la concesión.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-237">The following C# snippet shows an example of acquiring an exclusive lease for 30 seconds on a blob, updating the content of the blob, and then releasing the lease.</span></span> <span data-ttu-id="4b7d9-238">Si ya hay una concesión válida en el blob cuando intenta adquirir una nueva concesión, la instancia de Blob service devuelve un resultado de estado "HTTP (409) Conflicto".</span><span class="sxs-lookup"><span data-stu-id="4b7d9-238">If there is already a valid lease on the blob when you try to acquire a new lease, the blob service returns an "HTTP (409) Conflict" status result.</span></span> <span data-ttu-id="4b7d9-239">El fragmento de código siguiente usa un objeto **AccessCondition** para encapsular la información de concesión cuando crea una solicitud para actualizar el blob en el servicio de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-239">The following snippet uses an **AccessCondition** object to encapsulate the lease information when it makes a request to update the blob in the storage service.</span></span>  <span data-ttu-id="4b7d9-240">Puede descargar aquí el ejemplo completo: [Administración de simultaneidad con Almacenamiento de Azure](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span><span class="sxs-lookup"><span data-stu-id="4b7d9-240">You can download the full sample here: [Managing Concurrency using Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span></span>

```csharp
// Acquire lease for 15 seconds
string lease = blockBlob.AcquireLease(TimeSpan.FromSeconds(15), null);
Console.WriteLine("Blob lease acquired. Lease = {0}", lease);

// Update blob using lease. This operation will succeed
const string helloText = "Blob updated";
var accessCondition = AccessCondition.GenerateLeaseCondition(lease);
blockBlob.UploadText(helloText, accessCondition: accessCondition);
Console.WriteLine("Blob updated using an exclusive lease");

//Simulate third party update to blob without lease
try
{
    // Below operation will fail as no valid lease provided
    Console.WriteLine("Trying to update blob without valid lease");
    blockBlob.UploadText("Update without lease, will fail");
}
catch (StorageException ex)
{
    if (ex.RequestInformation.HttpStatusCode == (int)HttpStatusCode.PreconditionFailed)
        Console.WriteLine("Precondition failure as expected. Blob's lease does not match");
    else
        throw;
}  
```

<span data-ttu-id="4b7d9-241">Si intenta una operación de escritura en un blob concedido sin pasar el identificador de concesión, la solicitud no se puede realizar y muestra el error 412.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-241">If you attempt a write operation on a leased blob without passing the lease ID, the request fails with a 412 error.</span></span> <span data-ttu-id="4b7d9-242">Tenga en cuenta que si la concesión espira antes de llamar al método **UploadText**, pero sigue pasando el identificador de concesión, la solicitud tampoco se podrá realizar y mostrará el error **412**.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-242">Note that if the lease expires before calling the **UploadText** method but you still pass the lease ID, the request also fails with a **412** error.</span></span> <span data-ttu-id="4b7d9-243">Para más información acerca de la administración de tiempos de expiración de la concesión y de identificadores de concesión, vea la documentación de REST de [Lease Blob](http://msdn.microsoft.com/library/azure/ee691972.aspx) .</span><span class="sxs-lookup"><span data-stu-id="4b7d9-243">For more information about managing lease expiry times and lease IDs, see the [Lease Blob](http://msdn.microsoft.com/library/azure/ee691972.aspx) REST documentation.</span></span>  

<span data-ttu-id="4b7d9-244">Las siguientes operaciones de blob pueden usar concesiones para administrar simultaneidad pesimista:</span><span class="sxs-lookup"><span data-stu-id="4b7d9-244">The following blob operations can use leases to manage pessimistic concurrency:</span></span>  

* <span data-ttu-id="4b7d9-245">Put Blob</span><span class="sxs-lookup"><span data-stu-id="4b7d9-245">Put Blob</span></span>
* <span data-ttu-id="4b7d9-246">Get Blob</span><span class="sxs-lookup"><span data-stu-id="4b7d9-246">Get Blob</span></span>
* <span data-ttu-id="4b7d9-247">Get Blob Properties</span><span class="sxs-lookup"><span data-stu-id="4b7d9-247">Get Blob Properties</span></span>
* <span data-ttu-id="4b7d9-248">Set Blob Properties</span><span class="sxs-lookup"><span data-stu-id="4b7d9-248">Set Blob Properties</span></span>
* <span data-ttu-id="4b7d9-249">Get Blob Metadata</span><span class="sxs-lookup"><span data-stu-id="4b7d9-249">Get Blob Metadata</span></span>
* <span data-ttu-id="4b7d9-250">Set Blob Metadata</span><span class="sxs-lookup"><span data-stu-id="4b7d9-250">Set Blob Metadata</span></span>
* <span data-ttu-id="4b7d9-251">Delete Blob</span><span class="sxs-lookup"><span data-stu-id="4b7d9-251">Delete Blob</span></span>
* <span data-ttu-id="4b7d9-252">Put Block</span><span class="sxs-lookup"><span data-stu-id="4b7d9-252">Put Block</span></span>
* <span data-ttu-id="4b7d9-253">Put Block List</span><span class="sxs-lookup"><span data-stu-id="4b7d9-253">Put Block List</span></span>
* <span data-ttu-id="4b7d9-254">Get Block List</span><span class="sxs-lookup"><span data-stu-id="4b7d9-254">Get Block List</span></span>
* <span data-ttu-id="4b7d9-255">Put Page</span><span class="sxs-lookup"><span data-stu-id="4b7d9-255">Put Page</span></span>
* <span data-ttu-id="4b7d9-256">Get Page Ranges</span><span class="sxs-lookup"><span data-stu-id="4b7d9-256">Get Page Ranges</span></span>
* <span data-ttu-id="4b7d9-257">Snapshot Blob (identificador de concesión opcional si existe una concesión)</span><span class="sxs-lookup"><span data-stu-id="4b7d9-257">Snapshot Blob - lease ID optional if a lease exists</span></span>
* <span data-ttu-id="4b7d9-258">Copy Blob (identificador de concesión necesario si existe una concesión en el blob de destino)</span><span class="sxs-lookup"><span data-stu-id="4b7d9-258">Copy Blob - lease ID required if a lease exists on the destination blob</span></span>
* <span data-ttu-id="4b7d9-259">Abort Copy Blob (identificador de concesión necesario si existe una concesión infinita en el blob de destino)</span><span class="sxs-lookup"><span data-stu-id="4b7d9-259">Abort Copy Blob - lease ID required if an infinite lease exists on the destination blob</span></span>
* <span data-ttu-id="4b7d9-260">Lease Blob</span><span class="sxs-lookup"><span data-stu-id="4b7d9-260">Lease Blob</span></span>  

### <a name="pessimistic-concurrency-for-containers"></a><span data-ttu-id="4b7d9-261">Simultaneidad pesimista para contenedores</span><span class="sxs-lookup"><span data-stu-id="4b7d9-261">Pessimistic concurrency for containers</span></span>
<span data-ttu-id="4b7d9-262">Las concesiones en contenedores permiten las mismas estrategias de sincronización que en blob (escritura exclusiva / lectura compartida, escritura exclusiva / lectura exclusiva y escritura compartida / lectura exclusiva). Sin embargo, a diferencia de los blobs, el servicio Almacenamiento solamente impone exclusividad en operaciones de eliminación.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-262">Leases on containers enable the same synchronization strategies to be supported as on blobs (exclusive write / shared read, exclusive write / exclusive read and shared write / exclusive read) however unlike blobs the storage service only enforces exclusivity on delete operations.</span></span> <span data-ttu-id="4b7d9-263">Para eliminar un contenedor con una concesión activa, un cliente debe incluir el identificador de concesión activo con la solicitud de eliminación.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-263">To delete a container with an active lease, a client must include the active lease ID with the delete request.</span></span> <span data-ttu-id="4b7d9-264">El resto de operaciones de contenedor se realizan correctamente en un contenedor concedido sin incluir el identificador de concesión, en cuyo caso son operaciones compartidas.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-264">All other container operations succeed on a leased container without including the lease ID in which case they are shared operations.</span></span> <span data-ttu-id="4b7d9-265">Si la exclusividad de la actualización (poner o establecer) o las operaciones de lectura son obligatorias, entonces los desarrolladores deben garantizar que todos los clientes usan un identificador de concesión y que solamente un cliente tiene un identificador de concesión válido en cada momento.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-265">If exclusivity of update (put or set) or read operations is required then developers should ensure all clients use a lease ID and that only one client at a time has a valid lease ID.</span></span>  

<span data-ttu-id="4b7d9-266">Las siguientes operaciones de contenedor pueden usar concesiones para administrar simultaneidad pesimista:</span><span class="sxs-lookup"><span data-stu-id="4b7d9-266">The following container operations can use leases to manage pessimistic concurrency:</span></span>  

* <span data-ttu-id="4b7d9-267">Delete Container</span><span class="sxs-lookup"><span data-stu-id="4b7d9-267">Delete Container</span></span>
* <span data-ttu-id="4b7d9-268">Get Container Properties</span><span class="sxs-lookup"><span data-stu-id="4b7d9-268">Get Container Properties</span></span>
* <span data-ttu-id="4b7d9-269">Get Container Metadata</span><span class="sxs-lookup"><span data-stu-id="4b7d9-269">Get Container Metadata</span></span>
* <span data-ttu-id="4b7d9-270">Set Container Metadata</span><span class="sxs-lookup"><span data-stu-id="4b7d9-270">Set Container Metadata</span></span>
* <span data-ttu-id="4b7d9-271">Get Container ACL</span><span class="sxs-lookup"><span data-stu-id="4b7d9-271">Get Container ACL</span></span>
* <span data-ttu-id="4b7d9-272">Set Container ACL</span><span class="sxs-lookup"><span data-stu-id="4b7d9-272">Set Container ACL</span></span>
* <span data-ttu-id="4b7d9-273">Lease Container</span><span class="sxs-lookup"><span data-stu-id="4b7d9-273">Lease Container</span></span>  

<span data-ttu-id="4b7d9-274">Para más información, consulte:</span><span class="sxs-lookup"><span data-stu-id="4b7d9-274">For more information, see:</span></span>  

* [<span data-ttu-id="4b7d9-275">Especificar encabezados condicionales para las operaciones del servicio BLOB</span><span class="sxs-lookup"><span data-stu-id="4b7d9-275">Specifying Conditional Headers for Blob Service Operations</span></span>](http://msdn.microsoft.com/library/azure/dd179371.aspx)
* [<span data-ttu-id="4b7d9-276">Lease Container</span><span class="sxs-lookup"><span data-stu-id="4b7d9-276">Lease Container</span></span>](http://msdn.microsoft.com/library/azure/jj159103.aspx)
* [<span data-ttu-id="4b7d9-277">Concesiones de blob </span><span class="sxs-lookup"><span data-stu-id="4b7d9-277">Lease Blob </span></span>](http://msdn.microsoft.com/library/azure/ee691972.aspx)

## <a name="managing-concurrency-in-the-table-service"></a><span data-ttu-id="4b7d9-278">Administración de simultaneidad en el servicio Tabla</span><span class="sxs-lookup"><span data-stu-id="4b7d9-278">Managing Concurrency in the Table Service</span></span>
<span data-ttu-id="4b7d9-279">El servicio tabla usa comprobaciones de simultaneidad optimista como el comportamiento predeterminado cuando trabaja con entidades, a diferencia del servicio BLOB donde debe elegir explícitamente la realización de comprobaciones de simultaneidad optimista.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-279">The table service uses optimistic concurrency checks as the default behavior when you are working with entities, unlike the blob service where you must explicitly choose to perform optimistic concurrency checks.</span></span> <span data-ttu-id="4b7d9-280">La otra diferencia entre los servicios Tabla y BLOB es que solamente puede administrar el comportamiento de simultaneidad de entidades mientras que con el servicio BLOB puede administrar la simultaneidad tanto de contenedores como de blobs.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-280">The other difference between the table and blob services is that you can only manage the concurrency behavior of entities whereas with the blob service you can manage the concurrency of both containers and blobs.</span></span>  

<span data-ttu-id="4b7d9-281">Para usar simultaneidad optimista y comprobar si otro proceso modificó una entidad desde que la recuperó del servicio de almacenamiento Tabla, puede usar el valor ETag que recibe cuando el servicio Tabla devuelve una entidad.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-281">To use optimistic concurrency and to check if another process modified an entity since you retrieved it from the table storage service, you can use the ETag value you receive when the table service returns an entity.</span></span> <span data-ttu-id="4b7d9-282">El esquema de este proceso es el siguiente:</span><span class="sxs-lookup"><span data-stu-id="4b7d9-282">The outline of this process is as follows:</span></span>  

1. <span data-ttu-id="4b7d9-283">Recuperar una entidad del servicio de almacenamiento Tabla. La respuesta incluye un valor ETag que muestra el identificador actual asociado con esa entidad en el servicio de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-283">Retrieve an entity from the table storage service, the response includes an ETag value that identifies the current identifier associated with that entity in the storage service.</span></span>
2. <span data-ttu-id="4b7d9-284">Cuando actualice la entidad, incluya el valor ETag recibido en el paso 1 en el encabezado **If-Match** obligatorio de la solicitud que envía al servicio.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-284">When you update the entity, include the ETag value you received in step 1 in the mandatory **If-Match** header of the request you send to the service.</span></span>
3. <span data-ttu-id="4b7d9-285">El servicio compara el valor ETag de la solicitud con el valor ETag actual de la entidad.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-285">The service compares the ETag value in the request with the current ETag value of the entity.</span></span>
4. <span data-ttu-id="4b7d9-286">Si el valor ETag actual de la entidad es diferente al valor ETag del encabezado **If-Match** obligatorio de la solicitud, el servicio devuelve un error 412 al cliente.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-286">If the current ETag value of the entity is different than the ETag in the mandatory **If-Match** header in the request, the service returns a 412 error to the client.</span></span> <span data-ttu-id="4b7d9-287">Esto indica al cliente que otro proceso ha actualizado la entidad desde que el cliente la recuperó.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-287">This indicates to the client that another process has updated the entity since the client retrieved it.</span></span>
5. <span data-ttu-id="4b7d9-288">Si el valor ETag actual de la entidad es el mismo que el valor ETag del encabezado **If-Match** obligatorio de la solicitud o el encabezado **If-Match** contiene el carácter comodín (*), el servicio realiza la operación solicitada y actualiza el valor ETAg actual de la entidad para mostrar que se ha actualizado.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-288">If the current ETag value of the entity is the same as the ETag in the mandatory **If-Match** header in the request or the **If-Match** header contains the wildcard character (*), the service performs the requested operation and updates the current ETag value of the entity to show that it has been updated.</span></span>  

<span data-ttu-id="4b7d9-289">Tenga en cuenta que, a diferencia del servicio BLOB, el servicio Tabla requiere que el cliente incluya un encabezado **If-Match** en las solicitudes de actualización.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-289">Note that unlike the blob service, the table service requires the client to include an **If-Match** header in update requests.</span></span> <span data-ttu-id="4b7d9-290">Sin embargo, es posible imponer una actualización no condicional (estrategia de tipo "El último en escribir gana") y omitir comprobaciones de simultaneidad si el cliente establece el encabezado **If-Match** en el carácter comodín (*) en la solicitud.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-290">However, it is possible to force an unconditional update (last writer wins strategy) and bypass concurrency checks if the client sets the **If-Match** header to the wildcard character (*) in the request.</span></span>  

<span data-ttu-id="4b7d9-291">El siguiente fragmento de código C# muestra una entidad customer que se creó o recuperó previamente teniendo su dirección de correo electrónico actualizada.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-291">The following C# snippet shows a customer entity that was previously either created or retrieved having their email address updated.</span></span> <span data-ttu-id="4b7d9-292">La operación de inserción o recuperación inicial almacena el valor ETag en el objeto customer y, dado que el ejemplo usa la misma instancia de objeto cuando ejecuta la operación de reemplazo, automáticamente vuelve a enviar el valor ETag al servicio Tabla, permitiendo al servicio comprobar las infracciones de simultaneidad.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-292">The initial insert or retrieve operation stores the ETag value in the customer object, and because the sample uses the same object instance when it executes the replace operation, it automatically sends the ETag value back to the table service, enabling the service to check for concurrency violations.</span></span> <span data-ttu-id="4b7d9-293">Si otro proceso ha actualizado la entidad en el almacenamiento de tabla, el servicio devuelve un mensaje de estado HTTP 412 (Error en la condición previa).</span><span class="sxs-lookup"><span data-stu-id="4b7d9-293">If another process has updated the entity in table storage, the service returns an HTTP 412 (Precondition Failed) status message.</span></span>  <span data-ttu-id="4b7d9-294">Puede descargar aquí el ejemplo completo: [Administración de simultaneidad con Almacenamiento de Azure](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span><span class="sxs-lookup"><span data-stu-id="4b7d9-294">You can download the full sample here: [Managing Concurrency using Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span></span>

```csharp
try
{
    customer.Email = "updatedEmail@contoso.org";
    TableOperation replaceCustomer = TableOperation.Replace(customer);
    customerTable.Execute(replaceCustomer);
    Console.WriteLine("Replace operation succeeded.");
}
catch (StorageException ex)
{
    if (ex.RequestInformation.HttpStatusCode == 412)
        Console.WriteLine("Optimistic concurrency violation – entity has changed since it was retrieved.");
    else
        throw;
}  
```

<span data-ttu-id="4b7d9-295">Para deshabilitar explícitamente la comprobación de simultaneidad, debe establecer la propiedad **ETag** del objeto **employee** en "*" antes de ejecutar la operación de reemplazo.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-295">To explicitly disable the concurrency check, you should set the **ETag** property of the **employee** object to "*" before you execute the replace operation.</span></span>  

```csharp
customer.ETag = "*";  
```

<span data-ttu-id="4b7d9-296">En la siguiente tabla se resume cómo las operaciones de entidad de tabla usan valores ETag:</span><span class="sxs-lookup"><span data-stu-id="4b7d9-296">The following table summarizes how the table entity operations use ETag values:</span></span>

| <span data-ttu-id="4b7d9-297">Operación</span><span class="sxs-lookup"><span data-stu-id="4b7d9-297">Operation</span></span> | <span data-ttu-id="4b7d9-298">Devuelve el valor ETag</span><span class="sxs-lookup"><span data-stu-id="4b7d9-298">Returns ETag value</span></span> | <span data-ttu-id="4b7d9-299">Requiere encabezado de solicitud If-Match</span><span class="sxs-lookup"><span data-stu-id="4b7d9-299">Requires If-Match request header</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="4b7d9-300">Query Entities</span><span class="sxs-lookup"><span data-stu-id="4b7d9-300">Query Entities</span></span> |<span data-ttu-id="4b7d9-301">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-301">Yes</span></span> |<span data-ttu-id="4b7d9-302">No</span><span class="sxs-lookup"><span data-stu-id="4b7d9-302">No</span></span> |
| <span data-ttu-id="4b7d9-303">Insert Entity</span><span class="sxs-lookup"><span data-stu-id="4b7d9-303">Insert Entity</span></span> |<span data-ttu-id="4b7d9-304">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-304">Yes</span></span> |<span data-ttu-id="4b7d9-305">No</span><span class="sxs-lookup"><span data-stu-id="4b7d9-305">No</span></span> |
| <span data-ttu-id="4b7d9-306">Update Entity</span><span class="sxs-lookup"><span data-stu-id="4b7d9-306">Update Entity</span></span> |<span data-ttu-id="4b7d9-307">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-307">Yes</span></span> |<span data-ttu-id="4b7d9-308">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-308">Yes</span></span> |
| <span data-ttu-id="4b7d9-309">Merge Entity</span><span class="sxs-lookup"><span data-stu-id="4b7d9-309">Merge Entity</span></span> |<span data-ttu-id="4b7d9-310">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-310">Yes</span></span> |<span data-ttu-id="4b7d9-311">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-311">Yes</span></span> |
| <span data-ttu-id="4b7d9-312">Delete Entity</span><span class="sxs-lookup"><span data-stu-id="4b7d9-312">Delete Entity</span></span> |<span data-ttu-id="4b7d9-313">No</span><span class="sxs-lookup"><span data-stu-id="4b7d9-313">No</span></span> |<span data-ttu-id="4b7d9-314">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-314">Yes</span></span> |
| <span data-ttu-id="4b7d9-315">Insert or Replace Entity</span><span class="sxs-lookup"><span data-stu-id="4b7d9-315">Insert or Replace Entity</span></span> |<span data-ttu-id="4b7d9-316">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-316">Yes</span></span> |<span data-ttu-id="4b7d9-317">No</span><span class="sxs-lookup"><span data-stu-id="4b7d9-317">No</span></span> |
| <span data-ttu-id="4b7d9-318">Insert or Merge Entity</span><span class="sxs-lookup"><span data-stu-id="4b7d9-318">Insert or Merge Entity</span></span> |<span data-ttu-id="4b7d9-319">Sí</span><span class="sxs-lookup"><span data-stu-id="4b7d9-319">Yes</span></span> |<span data-ttu-id="4b7d9-320">No</span><span class="sxs-lookup"><span data-stu-id="4b7d9-320">No</span></span> |

<span data-ttu-id="4b7d9-321">Tenga en cuenta que las operaciones **Insert or Replace Entity** e **Insert or Merge Entity** *no* realizan ninguna comprobación de simultaneidad porque no envían un valor ETag a Table service.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-321">Note that the **Insert or Replace Entity** and **Insert or Merge Entity** operations do *not* perform any concurrency checks because they do not send an ETag value to the table service.</span></span>  

<span data-ttu-id="4b7d9-322">En general, los desarrolladores que usan tablas deben basarse en simultaneidad optimista cuando desarrollan aplicaciones escalables.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-322">In general developers using tables should rely on optimistic concurrency when developing scalable applications.</span></span> <span data-ttu-id="4b7d9-323">Si se necesita el bloqueo pesimista, un enfoque que los desarrolladores pueden usar cuando obtienen acceso a tablas es asignar un blob designado para cada tabla e intentar llevar a cabo una concesión en el blob antes de realizar operaciones en la tabla.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-323">If pessimistic locking is needed, one approach developers can take when accessing Tables is to assign a designated blob for each table and try to take a lease on the blob before operating on the table.</span></span> <span data-ttu-id="4b7d9-324">Este enfoque no requiere que la aplicación garantice que todas las rutas de acceso a los datos obtienen la concesión antes de realizar operaciones en la tabla.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-324">This approach does require the application to ensure all data access paths obtain the lease prior to operating on the table.</span></span> <span data-ttu-id="4b7d9-325">También debe tener en cuenta que el tiempo mínimo de concesión es 15 segundos, lo que requiere una consideración cuidadosa para escalabilidad.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-325">You should also note that the minimum lease time is 15 seconds which requires careful consideration for scalability.</span></span>  

<span data-ttu-id="4b7d9-326">Para más información, consulte:</span><span class="sxs-lookup"><span data-stu-id="4b7d9-326">For more information, see:</span></span>  

* [<span data-ttu-id="4b7d9-327">Operaciones en entidades</span><span class="sxs-lookup"><span data-stu-id="4b7d9-327">Operations on Entities</span></span>](http://msdn.microsoft.com/library/azure/dd179375.aspx)  

## <a name="managing-concurrency-in-the-queue-service"></a><span data-ttu-id="4b7d9-328">Administración de simultaneidad en el servicio Cola</span><span class="sxs-lookup"><span data-stu-id="4b7d9-328">Managing Concurrency in the Queue Service</span></span>
<span data-ttu-id="4b7d9-329">Un escenario en el que la simultaneidad es una preocupación en el servicio de colas es donde varios clientes recuperan mensajes de una cola.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-329">One scenario in which concurrency is a concern in the queueing service is where multiple clients are retrieving messages from a queue.</span></span> <span data-ttu-id="4b7d9-330">Cuando un mensaje se recupera de la cola, la respuesta incluye el mensaje y un valor de recepción de confirmación, que es necesario para eliminar dicho mensaje.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-330">When a message is retrieved from the queue, the response includes the message and a pop receipt value, which is required to delete the message.</span></span> <span data-ttu-id="4b7d9-331">El mensaje no se elimina automáticamente de la cola, pero después de haberse recuperado, no se muestra a otros clientes durante el intervalo de tiempo especificado por el parámetro visibilitytimeout.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-331">The message is not automatically deleted from the queue, but after it has been retrieved, it is not visible to other clients for the time interval specified by the visibilitytimeout parameter.</span></span> <span data-ttu-id="4b7d9-332">Se espera que el cliente que recupera el mensaje lo elimine una vez procesado y antes de que se cumpla el tiempo especificado por el elemento TimeNextVisible de la respuesta, que se calcula en función del valor del parámetro visibilitytimeout.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-332">The client that retrieves the message is expected to delete the message after it has been processed, and before the time specified by the TimeNextVisible element of the response, which is calculated based on the value of the visibilitytimeout parameter.</span></span> <span data-ttu-id="4b7d9-333">El valor de visibilitytimeout se agrega al tiempo en el que el mensaje se recupera para determinar el valor de TimeNextVisible.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-333">The value of visibilitytimeout is added to the time at which the message is retrieved to determine the value of TimeNextVisible.</span></span>  

<span data-ttu-id="4b7d9-334">El servicio Cola no admite simultaneidad optimista o pesimista y, por esta razón, los clientes que procesan mensajes recuperados de una cola deben garantizar que los mensajes se procesan de una manera idempotente.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-334">The queue service does not have support for either optimistic or pessimistic concurrency and for this reason clients processing messages retrieved from a queue should ensure messages are processed in an idempotent manner.</span></span> <span data-ttu-id="4b7d9-335">Una estrategia El último que escribe gana se usa para actualizar operaciones como SetQueueServiceProperties, SetQueueMetaData, SetQueueACL y UpdateMessage.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-335">A last writer wins strategy is used for update operations such as SetQueueServiceProperties, SetQueueMetaData, SetQueueACL and UpdateMessage.</span></span>  

<span data-ttu-id="4b7d9-336">Para más información, consulte:</span><span class="sxs-lookup"><span data-stu-id="4b7d9-336">For more information, see:</span></span>  

* [<span data-ttu-id="4b7d9-337">API de REST del servicio Cola</span><span class="sxs-lookup"><span data-stu-id="4b7d9-337">Queue Service REST API</span></span>](http://msdn.microsoft.com/library/azure/dd179363.aspx)
* [<span data-ttu-id="4b7d9-338">Get Messages</span><span class="sxs-lookup"><span data-stu-id="4b7d9-338">Get Messages</span></span>](http://msdn.microsoft.com/library/azure/dd179474.aspx)  

## <a name="managing-concurrency-in-the-file-service"></a><span data-ttu-id="4b7d9-339">Administración de simultaneidad en el servicio Archivo</span><span class="sxs-lookup"><span data-stu-id="4b7d9-339">Managing Concurrency in the File Service</span></span>
<span data-ttu-id="4b7d9-340">Se puede acceder al servicio Archivo utilizando dos extremos de protocolo diferentes: SMB y REST.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-340">The file service can be accessed using two different protocol endpoints – SMB and REST.</span></span> <span data-ttu-id="4b7d9-341">El servicio REST no admite bloqueo optimista o bloqueo pesimista y todas las actualizaciones seguirán una estrategia de tipo El último en escribir gana.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-341">The REST service does not have support for either optimistic locking or pessimistic locking and all updates will follow a last writer wins strategy.</span></span> <span data-ttu-id="4b7d9-342">Los clientes SMB que montan recursos compartidos de archivo pueden aprovechar mecanismos de bloqueo del sistema de archivos para administrar el acceso a archivos compartidos, incluida la capacidad de realizar bloqueo pesimista.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-342">SMB clients that mount file shares can leverage file system locking mechanisms to manage access to shared files – including the ability to perform pessimistic locking.</span></span> <span data-ttu-id="4b7d9-343">Cuando un cliente SMB abre un archivo, especifica tanto el acceso al archivo como el modo de uso compartido.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-343">When an SMB client opens a file, it specifies both the file access and share mode.</span></span> <span data-ttu-id="4b7d9-344">El establecimiento de una opción Acceso de archivo en "Escritura" o "Lectura/Escritura" junto con un modo Uso compartido de archivos de "Ninguno" provocará el bloqueo del archivo por parte de un cliente hasta que el archivo se cierre.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-344">Setting a File Access option of "Write" or "Read/Write" along with a File Share mode of "None" will result in the file being locked by an SMB client until the file is closed.</span></span> <span data-ttu-id="4b7d9-345">Si se intenta realizar la operación REST en un archivo donde un cliente SMB tiene el archivo bloqueado, el servicio REST devolverá el código de estado 409 (Conflicto) con el código de error SharingViolation.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-345">If REST operation is attempted on a file where an SMB client has the file locked the REST service will return status code 409 (Conflict) with error code SharingViolation.</span></span>  

<span data-ttu-id="4b7d9-346">Cuando un cliente SMB abre un archivo para eliminarlo, lo marca como eliminación pendiente hasta que el resto de identificadores de apertura del cliente SMB en ese archivo están cerrados.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-346">When an SMB client opens a file for delete, it marks the file as pending delete until all other SMB client open handles on that file are closed.</span></span> <span data-ttu-id="4b7d9-347">Mientras un archivo se marca como eliminación pendiente, cualquier operación REST en ese archivo devolverá el código de estado 409 (Conflicto) con el código de error SMBDeletePending.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-347">While a file is marked as pending delete, any REST operation on that file will return status code 409 (Conflict) with error code SMBDeletePending.</span></span> <span data-ttu-id="4b7d9-348">El código de estado 404 (No encontrado) no se devuelve porque es posible que el cliente SMB elimine la marca de eliminación pendiente antes de cerrar el archivo.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-348">Status code 404 (Not Found) is not returned since it is possible for the SMB client to remove the pending deletion flag prior to closing the file.</span></span> <span data-ttu-id="4b7d9-349">En otras palabras, el código de estado 404 (No encontrado) solamente se espera cuando el archivo se ha quitado.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-349">In other words, status code 404 (Not Found) is only expected when the file has been removed.</span></span> <span data-ttu-id="4b7d9-350">Tenga en cuenta que mientras un archivo está en un estado pendiente de eliminación de SMB, no se incluirá en los resultados de los archivos de lista.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-350">Note that while a file is in an SMB pending delete state, it will not be included in the List Files results.</span></span> <span data-ttu-id="4b7d9-351">Además, tenga en cuenta que las operaciones de REST para eliminar archivo y eliminar directorio se confirman de forma automática y no dan lugar a un estado de eliminación pendiente.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-351">Also, note that the REST Delete File and REST Delete Directory operations are committed atomically and do not result in a pending delete state.</span></span>  

<span data-ttu-id="4b7d9-352">Para más información, consulte:</span><span class="sxs-lookup"><span data-stu-id="4b7d9-352">For more information, see:</span></span>  

* [<span data-ttu-id="4b7d9-353">Administración de bloqueos de archivo</span><span class="sxs-lookup"><span data-stu-id="4b7d9-353">Managing File Locks</span></span>](http://msdn.microsoft.com/library/azure/dn194265.aspx)  

## <a name="summary-and-next-steps"></a><span data-ttu-id="4b7d9-354">Resumen y pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="4b7d9-354">Summary and Next Steps</span></span>
<span data-ttu-id="4b7d9-355">El servicio Almacenamiento de Microsoft Azure se ha diseñado para satisfacer las necesidades de las aplicaciones en línea más complejas sin necesidad de que los desarrolladores comprometan o se replanteen sus asunciones de diseño clave, como simultaneidad y coherencia de datos, que han llegado a dar por sentado.</span><span class="sxs-lookup"><span data-stu-id="4b7d9-355">The Microsoft Azure Storage service has been designed to meet the needs of the most complex online applications without forcing developers to compromise or rethink key design assumptions such as concurrency and data consistency that they have come to take for granted.</span></span>  

<span data-ttu-id="4b7d9-356">Aquí podrá obtener la aplicación de ejemplo completa a la que se hace referencia en este blog:</span><span class="sxs-lookup"><span data-stu-id="4b7d9-356">For the complete sample application referenced in this blog:</span></span>  

* [<span data-ttu-id="4b7d9-357">Administración de simultaneidad con Almacenamiento de Azure: aplicación de ejemplo</span><span class="sxs-lookup"><span data-stu-id="4b7d9-357">Managing Concurrency using Azure Storage - Sample Application</span></span>](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114)  

<span data-ttu-id="4b7d9-358">Para obtener más información acerca de Almacenamiento de Azure, consulte:</span><span class="sxs-lookup"><span data-stu-id="4b7d9-358">For more information on Azure Storage see:</span></span>  

* [<span data-ttu-id="4b7d9-359">Página principal de Almacenamiento de Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="4b7d9-359">Microsoft Azure Storage Home Page</span></span>](https://azure.microsoft.com/services/storage/)
* [<span data-ttu-id="4b7d9-360">Introducción a Almacenamiento de Azure</span><span class="sxs-lookup"><span data-stu-id="4b7d9-360">Introduction to Azure Storage</span></span>](storage-introduction.md)
* <span data-ttu-id="4b7d9-361">Introducción al almacenamiento para [Blob](../blobs/storage-dotnet-how-to-use-blobs.md), [Table](../../cosmos-db/table-storage-how-to-use-dotnet.md), [Queues](../storage-dotnet-how-to-use-queues.md) y [Files](../storage-dotnet-how-to-use-files.md)</span><span class="sxs-lookup"><span data-stu-id="4b7d9-361">Storage Getting Started for [Blob](../blobs/storage-dotnet-how-to-use-blobs.md), [Table](../../cosmos-db/table-storage-how-to-use-dotnet.md),  [Queues](../storage-dotnet-how-to-use-queues.md), and [Files](../storage-dotnet-how-to-use-files.md)</span></span>
* <span data-ttu-id="4b7d9-362">Arquitectura de almacenamiento. [Azure Storage: un servicio de almacenamiento en nube altamente disponible con coherencia fuerte](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/11/20/windows-azure-storage-a-highly-available-cloud-storage-service-with-strong-consistency.aspx)</span><span class="sxs-lookup"><span data-stu-id="4b7d9-362">Storage Architecture – [Azure Storage: A Highly Available Cloud Storage Service with Strong Consistency](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/11/20/windows-azure-storage-a-highly-available-cloud-storage-service-with-strong-consistency.aspx)</span></span>


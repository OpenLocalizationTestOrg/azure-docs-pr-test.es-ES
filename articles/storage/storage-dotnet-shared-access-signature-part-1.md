---
title: Uso de firmas de acceso compartido (SAS) en Azure Storage | Microsoft Docs
description: "Obtenga información acerca de cómo usar firmas de acceso compartido (SAS) para delegar recursos de Azure Storage, incluidos blobs, colas, tablas y archivos."
services: storage
documentationcenter: 
author: mmacy
manager: timlt
editor: tysonn
ms.assetid: 46fd99d7-36b3-4283-81e3-f214b29f1152
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 04/18/2017
ms.author: marsma
ms.openlocfilehash: ae944eae4e62132e47bf9069d83817a1a6779ff7
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2017
---
# <a name="using-shared-access-signatures-sas"></a><span data-ttu-id="c0f7f-103">Uso de firmas de acceso compartido (SAS)</span><span class="sxs-lookup"><span data-stu-id="c0f7f-103">Using shared access signatures (SAS)</span></span>

<span data-ttu-id="c0f7f-104">Una firma de acceso compartido (SAS) ofrece una manera de conceder acceso limitado a los objetos de la cuenta de almacenamiento a otros clientes exponer la clave de cuenta.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-104">A shared access signature (SAS) provides you with a way to grant limited access to objects in your storage account to other clients, without exposing your account key.</span></span> <span data-ttu-id="c0f7f-105">En este artículo, se proporciona una introducción del modelo SAS, se analizan las prácticas recomendadas de SAS y se revisan algunos ejemplos.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-105">In this article, we provide an overview of the SAS model, review SAS best practices, and look at some examples.</span></span>

<span data-ttu-id="c0f7f-106">Para obtener ejemplos de código adicionales mediante SAS, aparte de los aquí presentados, consulte [Introducción a Azure Blob Storage en .NET](https://azure.microsoft.com/documentation/samples/storage-blob-dotnet-getting-started/) y otros ejemplos disponibles en la biblioteca [Ejemplos de código de Azure](https://azure.microsoft.com/documentation/samples/?service=storage).</span><span class="sxs-lookup"><span data-stu-id="c0f7f-106">For additional code examples using SAS beyond those presented here, see [Getting Started with Azure Blob Storage in .NET](https://azure.microsoft.com/documentation/samples/storage-blob-dotnet-getting-started/) and other samples available in the [Azure Code Samples](https://azure.microsoft.com/documentation/samples/?service=storage) library.</span></span> <span data-ttu-id="c0f7f-107">Puede descargar las aplicaciones de ejemplo y ejecutarlas, así como ver el código en GitHub.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-107">You can download the sample applications and run them, or browse the code on GitHub.</span></span>

## <a name="what-is-a-shared-access-signature"></a><span data-ttu-id="c0f7f-108">¿Qué es una firma de acceso compartido?</span><span class="sxs-lookup"><span data-stu-id="c0f7f-108">What is a shared access signature?</span></span>
<span data-ttu-id="c0f7f-109">Una firma de acceso compartido ofrece acceso delegado a recursos en la cuenta de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-109">A shared access signature provides delegated access to resources in your storage account.</span></span> <span data-ttu-id="c0f7f-110">Con una SAS, puede conceder a los clientes acceso a los recursos de su cuenta de almacenamiento sin compartir las claves de la cuenta.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-110">With a SAS, you can grant clients access to resources in your storage account, without sharing your account keys.</span></span> <span data-ttu-id="c0f7f-111">Este es el aspecto clave de usar las firmas de acceso compartido en las aplicaciones: una SAS es una forma segura de compartir los recursos de almacenamiento sin poner en peligro las claves de cuenta.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-111">This is the key point of using shared access signatures in your applications--a SAS is a secure way to share your storage resources without compromising your account keys.</span></span>

[!INCLUDE [storage-account-key-note-include](../../includes/storage-account-key-note-include.md)]

<span data-ttu-id="c0f7f-112">Una SAS le ofrece control granular el tipo de acceso que se concede a los clientes que tienen la SAS, como por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="c0f7f-112">A SAS gives you granular control over the type of access you grant to clients who have the SAS, including:</span></span>

* <span data-ttu-id="c0f7f-113">El intervalo durante el que la SAS es válida, incluida la hora de inicio y la hora de caducidad.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-113">The interval over which the SAS is valid, including the start time and the expiry time.</span></span>
* <span data-ttu-id="c0f7f-114">Los permisos concedidos por la SAS.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-114">The permissions granted by the SAS.</span></span> <span data-ttu-id="c0f7f-115">Por ejemplo, una SAS para un blob podría conceder permisos de lectura y escritura para el blob, pero no permisos de eliminación.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-115">For example, a SAS for a blob might grant read and write permissions to that blob, but not delete permissions.</span></span>
* <span data-ttu-id="c0f7f-116">Una dirección IP opcional o un intervalo de direcciones IP de las que Azure Storage aceptará la SAS.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-116">An optional IP address or range of IP addresses from which Azure Storage will accept the SAS.</span></span> <span data-ttu-id="c0f7f-117">Por ejemplo, podría especificar un intervalo de direcciones IP que pertenezcan a su organización.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-117">For example, you might specify a range of IP addresses belonging to your organization.</span></span>
* <span data-ttu-id="c0f7f-118">El protocolo a través del cual Azure Storage aceptará la SAS.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-118">The protocol over which Azure Storage will accept the SAS.</span></span> <span data-ttu-id="c0f7f-119">Puede usar este parámetro opcional para restringir el acceso a los clientes mediante HTTPS.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-119">You can use this optional parameter to restrict access to clients using HTTPS.</span></span>

## <a name="when-should-you-use-a-shared-access-signature"></a><span data-ttu-id="c0f7f-120">¿Cuándo debe usar una firma de acceso compartido?</span><span class="sxs-lookup"><span data-stu-id="c0f7f-120">When should you use a shared access signature?</span></span>
<span data-ttu-id="c0f7f-121">Puede usar una SAS cuando desee proporcionar acceso a los recursos de la cuenta de almacenamiento a cualquier cliente que no posea sus claves de acceso a la cuenta de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-121">You can use a SAS when you want to provide access to resources in your storage account to any client not possessing your storage account's access keys.</span></span> <span data-ttu-id="c0f7f-122">La cuenta de almacenamiento incluye tanto una clave de acceso primaria y como una secundaria, que conceden acceso administrativo a la cuenta y a todos los recursos contenidos en ella.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-122">Your storage account includes both a primary and secondary access key, both of which grant administrative access to your account, and all resources within it.</span></span> <span data-ttu-id="c0f7f-123">La exposición de alguna de estas claves posibilita que se haga un uso negligente o malintencionado de la cuenta.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-123">Exposing either of these keys opens your account to the possibility of malicious or negligent use.</span></span> <span data-ttu-id="c0f7f-124">Las firmas de acceso compartido ofrecen una alternativa segura que permite a los clientes leer, escribir y eliminar datos en la cuenta de almacenamiento según los permisos que se le hayan concedido explícitamente y sin que sea necesaria una clave de cuenta.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-124">Shared access signatures provide a safe alternative that allows clients to read, write, and delete data in your storage account according to the permissions you've explicitly granted, and without need for an account key.</span></span>

<span data-ttu-id="c0f7f-125">Un escenario común en el que es útil una SAS es un servicio en el que los usuarios leen y escriben sus propios datos en la cuenta de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-125">A common scenario where a SAS is useful is a service where users read and write their own data to your storage account.</span></span> <span data-ttu-id="c0f7f-126">Existen dos patrones de diseño típicos en los escenarios en los que una cuenta de almacenamiento guarda datos de usuario:</span><span class="sxs-lookup"><span data-stu-id="c0f7f-126">In a scenario where a storage account stores user data, there are two typical design patterns:</span></span>

1. <span data-ttu-id="c0f7f-127">Los clientes cargan y descargan datos mediante un servicio de proxy front-end que realiza la autenticación.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-127">Clients upload and download data via a front-end proxy service, which performs authentication.</span></span> <span data-ttu-id="c0f7f-128">Este servicio de proxy front-end cuenta con la ventaja de permitir la validación de reglas de negocio, pero para grandes cantidades de datos o transacciones de gran volumen, la creación de un servicio que pueda escalarse para satisfacer la demanda puede ser complicada o costosa.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-128">This front-end proxy service has the advantage of allowing validation of business rules, but for large amounts of data or high-volume transactions, creating a service that can scale to match demand may be expensive or difficult.</span></span>

  ![Diagrama del escenario: servicio de proxy de front-end][sas-storage-fe-proxy-service]

1. <span data-ttu-id="c0f7f-130">Un servicio ligero realiza la autenticación del cliente según sea necesario y, luego, genera una SAS.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-130">A lightweight service authenticates the client as needed and then generates a SAS.</span></span> <span data-ttu-id="c0f7f-131">Una vez que el cliente recibe la SAS, puede obtener acceso a los recursos de la cuenta de almacenamiento directamente con los permisos definidos por la SAS y para el intervalo permitido por ella.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-131">Once the client receives the SAS, they can access storage account resources directly with the permissions defined by the SAS and for the interval allowed by the SAS.</span></span> <span data-ttu-id="c0f7f-132">La SAS mitiga la necesidad de enrutar todos los datos a través del servicio de proxy front-end.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-132">The SAS mitigates the need for routing all data through the front-end proxy service.</span></span>

  ![Diagrama del escenario: servicio de proveedor de SAS][sas-storage-provider-service]

<span data-ttu-id="c0f7f-134">Muchos servicios reales pueden usar una combinación de estos dos enfoques.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-134">Many real-world services may use a hybrid of these two approaches.</span></span> <span data-ttu-id="c0f7f-135">Por ejemplo, se pueden procesar y validar algunos datos mediante el proxy de front-end, mientras que otros datos se guardan o leen directamente mediante SAS.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-135">For example, some data might be processed and validated via the front-end proxy, while other data is saved and/or read directly using SAS.</span></span>

<span data-ttu-id="c0f7f-136">Además, deberá usar una SAS para autenticar el objeto de origen en una operación de copia en ciertos escenarios:</span><span class="sxs-lookup"><span data-stu-id="c0f7f-136">Additionally, you will need to use a SAS to authenticate the source object in a copy operation in certain scenarios:</span></span>

* <span data-ttu-id="c0f7f-137">Cuando copia un blob en otro blob que reside en otra cuenta de almacenamiento, debe usar una SAS para autenticar el blob de origen.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-137">When you copy a blob to another blob that resides in a different storage account, you must use a SAS to authenticate the source blob.</span></span> <span data-ttu-id="c0f7f-138">También puede usar una SAS para autenticar el blob de destino.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-138">You can optionally use a SAS to authenticate the destination blob as well.</span></span>
* <span data-ttu-id="c0f7f-139">Cuando copia un archivo en otro archivo que reside en otra cuenta de almacenamiento, debe usar una SAS para autenticar el archivo de origen.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-139">When you copy a file to another file that resides in a different storage account, you must use a SAS to authenticate the source file.</span></span> <span data-ttu-id="c0f7f-140">También puede usar una SAS para autenticar el archivo de destino.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-140">You can optionally use a SAS to authenticate the destination file as well.</span></span>
* <span data-ttu-id="c0f7f-141">Si va a copiar un blob en un archivo, o un archivo en un blob, tiene que usar una firma de acceso compartido (SAS) para autenticar el objeto de origen, incluso si los objetos de origen y destino residen dentro la misma cuenta de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-141">When you copy a blob to a file, or a file to a blob, you must use a SAS to authenticate the source object, even if the source and destination objects reside within the same storage account.</span></span>

## <a name="types-of-shared-access-signatures"></a><span data-ttu-id="c0f7f-142">Tipos de firmas de acceso compartido</span><span class="sxs-lookup"><span data-stu-id="c0f7f-142">Types of shared access signatures</span></span>
<span data-ttu-id="c0f7f-143">Puede crear dos tipos de firmas de acceso compartido:</span><span class="sxs-lookup"><span data-stu-id="c0f7f-143">You can create two types of shared access signatures:</span></span>

* <span data-ttu-id="c0f7f-144">**SAS de servicio.**</span><span class="sxs-lookup"><span data-stu-id="c0f7f-144">**Service SAS.**</span></span> <span data-ttu-id="c0f7f-145">SAS de servicio delega el acceso a un recurso en solo uno de los servicios de almacenamiento: el servicio Blob, Cola, Tabla o Archivo.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-145">The service SAS delegates access to a resource in just one of the storage services: the Blob, Queue, Table, or File service.</span></span> <span data-ttu-id="c0f7f-146">Consulte [Creación de una SAS de servicio](https://msdn.microsoft.com/library/dn140255.aspx) y [Ejemplos de SAS de servicio](https://msdn.microsoft.com/library/dn140256.aspx), para obtener información detallada acerca de cómo construir el token de SAS de servicio.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-146">See [Constructing a Service SAS](https://msdn.microsoft.com/library/dn140255.aspx) and [Service SAS Examples](https://msdn.microsoft.com/library/dn140256.aspx) for in-depth information about constructing the service SAS token.</span></span>
* <span data-ttu-id="c0f7f-147">**SAS de cuenta.**</span><span class="sxs-lookup"><span data-stu-id="c0f7f-147">**Account SAS.**</span></span> <span data-ttu-id="c0f7f-148">SAS de cuenta delega el acceso a los recursos en uno o varios de los servicios de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-148">The account SAS delegates access to resources in one or more of the storage services.</span></span> <span data-ttu-id="c0f7f-149">Todas las operaciones disponibles con una SAS de servicio están también disponibles con una SAS de cuenta.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-149">All of the operations available via a service SAS are also available via an account SAS.</span></span> <span data-ttu-id="c0f7f-150">Además, con la SAS de cuenta, puede delegar el acceso a las operaciones que se aplican a un servicio determinado como **Get/Set Service Properties** y **Get Service Stats**.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-150">Additionally, with the account SAS, you can delegate access to operations that apply to a given service, such as **Get/Set Service Properties** and **Get Service Stats**.</span></span> <span data-ttu-id="c0f7f-151">También puede delegar el acceso para leer, escribir y eliminar operaciones en contenedores de blobs, tablas, colas y recursos compartidos de archivos que no están permitidos con SAS de servicio.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-151">You can also delegate access to read, write, and delete operations on blob containers, tables, queues, and file shares that are not permitted with a service SAS.</span></span> <span data-ttu-id="c0f7f-152">Consulte [Creación de una SAS de cuenta](https://msdn.microsoft.com/library/mt584140.aspx) para obtener información detallada sobre cómo crear el token de SAS de cuenta.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-152">See [Constructing an Account SAS](https://msdn.microsoft.com/library/mt584140.aspx) for in-depth information about constructing the account SAS token.</span></span>

## <a name="how-a-shared-access-signature-works"></a><span data-ttu-id="c0f7f-153">Funcionamiento de una firma de acceso compartido</span><span class="sxs-lookup"><span data-stu-id="c0f7f-153">How a shared access signature works</span></span>
<span data-ttu-id="c0f7f-154">Una firma de acceso compartido es un URI firmado que señala a uno o más recursos de almacenamiento e incluye un token que contiene un conjunto especial de parámetros de consulta.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-154">A shared access signature is a signed URI that points to one or more storage resources and includes a token that contains a special set of query parameters.</span></span> <span data-ttu-id="c0f7f-155">El token indica cómo puede el cliente tener acceso a los recursos.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-155">The token indicates how the resources may be accessed by the client.</span></span> <span data-ttu-id="c0f7f-156">Uno de los parámetros de consulta, la firma, se construye a partir de parámetros SAS y se firma con la clave de cuenta.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-156">One of the query parameters, the signature, is constructed from the SAS parameters and signed with the account key.</span></span> <span data-ttu-id="c0f7f-157">Almacenamiento de Azure usa esa firma para autenticar la SAS.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-157">This signature is used by Azure Storage to authenticate the SAS.</span></span>

<span data-ttu-id="c0f7f-158">Este es un ejemplo de un URI de SAS, que muestra el URI de recurso y el token de SAS:</span><span class="sxs-lookup"><span data-stu-id="c0f7f-158">Here's an example of a SAS URI, showing the resource URI and the SAS token:</span></span>

![Componentes de un identificador URI de SAS][sas-storage-uri]

<span data-ttu-id="c0f7f-160">El token de SAS es una cadena que genera en el *cliente* (consulte la sección de [Ejemplos de SAS](#sas-examples) para ver ejemplos de código).</span><span class="sxs-lookup"><span data-stu-id="c0f7f-160">The SAS token is a string you generate on the *client* side (see the [SAS examples](#sas-examples) section for code examples).</span></span> <span data-ttu-id="c0f7f-161">Por ejemplo, Azure Storage no realiza el seguimiento de un token de SAS que haya generado con la biblioteca de cliente de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-161">A SAS token you generate with the storage client library, for example, is not tracked by Azure Storage in any way.</span></span> <span data-ttu-id="c0f7f-162">Puede crear un número ilimitado de tokens de SAS en el cliente.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-162">You can create an unlimited number of SAS tokens on the client side.</span></span>

<span data-ttu-id="c0f7f-163">Cuando un cliente proporciona un URI de SAS para Azure Storage como parte de una solicitud, el servicio comprueba los parámetros de SAS y la firma para comprobar que es válido para autenticar la solicitud.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-163">When a client provides a SAS URI to Azure Storage as part of a request, the service checks the SAS parameters and signature to verify that it is valid for authenticating the request.</span></span> <span data-ttu-id="c0f7f-164">Si el servicio confirma la firma es válida, la solicitud se autentica.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-164">If the service verifies that the signature is valid, then the request is authenticated.</span></span> <span data-ttu-id="c0f7f-165">De lo contrario, la solicitud se rechaza con el código de error 403 (prohibido).</span><span class="sxs-lookup"><span data-stu-id="c0f7f-165">Otherwise, the request is declined with error code 403 (Forbidden).</span></span>

## <a name="shared-access-signature-parameters"></a><span data-ttu-id="c0f7f-166">Parámetros de la firma de acceso compartido</span><span class="sxs-lookup"><span data-stu-id="c0f7f-166">Shared access signature parameters</span></span>
<span data-ttu-id="c0f7f-167">Los tokens de SAS de cuenta y de SAS de servicio incluyen algunos parámetros comunes y también algunos parámetros que son diferentes.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-167">The account SAS and service SAS tokens include some common parameters, and also take a few parameters that that are different.</span></span>

### <a name="parameters-common-to-account-sas-and-service-sas-tokens"></a><span data-ttu-id="c0f7f-168">Parámetros comunes para tokens de SAS de cuenta y de SAS de servicio</span><span class="sxs-lookup"><span data-stu-id="c0f7f-168">Parameters common to account SAS and service SAS tokens</span></span>
* <span data-ttu-id="c0f7f-169">**Versión de API.** Un parámetro opcional que especifica la versión del servicio de almacenamiento que se usa para ejecutar la solicitud.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-169">**Api version** An optional parameter that specifies the storage service version to use to execute the request.</span></span>
* <span data-ttu-id="c0f7f-170">**Versión del servicio.** Es un parámetro necesario que especifica la versión del servicio de almacenamiento que se usa para autenticar la solicitud.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-170">**Service version** A required parameter that specifies the storage service version to use to authenticate the request.</span></span>
* <span data-ttu-id="c0f7f-171">**Hora de inicio.**</span><span class="sxs-lookup"><span data-stu-id="c0f7f-171">**Start time.**</span></span> <span data-ttu-id="c0f7f-172">Es la hora en la que la SAS comienza a ser válida.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-172">This is the time at which the SAS becomes valid.</span></span> <span data-ttu-id="c0f7f-173">La hora de inicio de una firma de acceso compartido es opcional.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-173">The start time for a shared access signature is optional.</span></span> <span data-ttu-id="c0f7f-174">Si se omite una hora de inicio, la SAS entra en vigor de inmediato.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-174">If a start time is omitted, the SAS is effective immediately.</span></span> <span data-ttu-id="c0f7f-175">La hora de inicio se debe expresar en UTC (Hora universal coordinada) con un designador de hora UTC especial ("Z"), por ejemplo `1994-11-05T13:15:30Z`.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-175">The start time must be expressed in UTC (Coordinated Universal Time), with a special UTC designator ("Z"), for example `1994-11-05T13:15:30Z`.</span></span>
* <span data-ttu-id="c0f7f-176">**Hora de expiración.**</span><span class="sxs-lookup"><span data-stu-id="c0f7f-176">**Expiry time.**</span></span> <span data-ttu-id="c0f7f-177">Es la hora a partir de la que la SAS deja de ser válida.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-177">This is the time after which the SAS is no longer valid.</span></span> <span data-ttu-id="c0f7f-178">En las prácticas recomendadas se aconseja especificar una hora de expiración para una SAS o asociarla a una directiva de acceso almacenada.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-178">Best practices recommend that you either specify an expiry time for a SAS, or associate it with a stored access policy.</span></span> <span data-ttu-id="c0f7f-179">La hora de expiración se debe expresar en UTC (Hora universal coordinada) con un designador de hora UTC especial ("Z"), por ejemplo `1994-11-05T13:15:30Z` (vea más información a continuación).</span><span class="sxs-lookup"><span data-stu-id="c0f7f-179">The expiry time must be expressed in UTC (Coordinated Universal Time), with a special UTC designator ("Z"), for example `1994-11-05T13:15:30Z` (see more below).</span></span>
* <span data-ttu-id="c0f7f-180">**Permisos.**</span><span class="sxs-lookup"><span data-stu-id="c0f7f-180">**Permissions.**</span></span> <span data-ttu-id="c0f7f-181">Los permisos especificados en una SAS indican qué operaciones puede realizar el cliente en el recurso de almacenamiento con la SAS.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-181">The permissions specified on the SAS indicate what operations the client can perform against the storage resource using the SAS.</span></span> <span data-ttu-id="c0f7f-182">Los permisos disponibles son diferentes para SAS de cuenta y SAS de servicio.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-182">Available permissions differ for an account SAS and a service SAS.</span></span>
* <span data-ttu-id="c0f7f-183">**Dirección Dirección IP.**</span><span class="sxs-lookup"><span data-stu-id="c0f7f-183">**IP.**</span></span> <span data-ttu-id="c0f7f-184">Es un parámetro opcional que especifica una dirección IP o un intervalo de direcciones IP fuera de Azure (consulte la sección [Estado de la configuración de la sesión de enrutamiento](../expressroute/expressroute-workflows.md#routing-session-configuration-state) de Express Route), desde el cual puede aceptar solicitudes.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-184">An optional parameter that specifies an IP address or a range of IP addresses outside of Azure (see the section [Routing session configuration state](../expressroute/expressroute-workflows.md#routing-session-configuration-state) for Express Route) from which to accept requests.</span></span>
* <span data-ttu-id="c0f7f-185">**Protocolo.**</span><span class="sxs-lookup"><span data-stu-id="c0f7f-185">**Protocol.**</span></span> <span data-ttu-id="c0f7f-186">Un parámetro opcional que especifica el protocolo permitido para una solicitud.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-186">An optional parameter that specifies the protocol permitted for a request.</span></span> <span data-ttu-id="c0f7f-187">Los valores posibles son HTTPS y HTTP (`https,http`), que es el valor predeterminado, o solo HTTPS solo (`https`).</span><span class="sxs-lookup"><span data-stu-id="c0f7f-187">Possible values are both HTTPS and HTTP (`https,http`), which is the default value, or HTTPS only (`https`).</span></span> <span data-ttu-id="c0f7f-188">Tenga en cuenta que HTTP solo no es un valor permitido.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-188">Note that HTTP only is not a permitted value.</span></span>
* <span data-ttu-id="c0f7f-189">**Firma.**</span><span class="sxs-lookup"><span data-stu-id="c0f7f-189">**Signature.**</span></span> <span data-ttu-id="c0f7f-190">La firma se construye a partir de los parámetros especificados como parte del token y, a continuación, se cifra.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-190">The signature is constructed from the other parameters specified as part token and then encrypted.</span></span> <span data-ttu-id="c0f7f-191">Se usa para autenticar la SAS.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-191">It's used to authenticate the SAS.</span></span>

### <a name="parameters-for-a-service-sas-token"></a><span data-ttu-id="c0f7f-192">Parámetros para un token de SAS de servicio</span><span class="sxs-lookup"><span data-stu-id="c0f7f-192">Parameters for a service SAS token</span></span>
* <span data-ttu-id="c0f7f-193">**Recurso de almacenamiento.**</span><span class="sxs-lookup"><span data-stu-id="c0f7f-193">**Storage resource.**</span></span> <span data-ttu-id="c0f7f-194">Los recursos de almacenamiento para los que puede delegar el acceso con una SAS de servicio incluyen:</span><span class="sxs-lookup"><span data-stu-id="c0f7f-194">Storage resources for which you can delegate access with a service SAS include:</span></span>
  * <span data-ttu-id="c0f7f-195">Contenedores y blobs</span><span class="sxs-lookup"><span data-stu-id="c0f7f-195">Containers and blobs</span></span>
  * <span data-ttu-id="c0f7f-196">Archivos y recursos compartidos de archivo</span><span class="sxs-lookup"><span data-stu-id="c0f7f-196">File shares and files</span></span>
  * <span data-ttu-id="c0f7f-197">Colas</span><span class="sxs-lookup"><span data-stu-id="c0f7f-197">Queues</span></span>
  * <span data-ttu-id="c0f7f-198">Las tablas y los intervalos de las entidades de tabla.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-198">Tables and ranges of table entities.</span></span>

### <a name="parameters-for-an-account-sas-token"></a><span data-ttu-id="c0f7f-199">Parámetros para un token de SAS de cuenta</span><span class="sxs-lookup"><span data-stu-id="c0f7f-199">Parameters for an account SAS token</span></span>
* <span data-ttu-id="c0f7f-200">**Servicio o servicios.**</span><span class="sxs-lookup"><span data-stu-id="c0f7f-200">**Service or services.**</span></span> <span data-ttu-id="c0f7f-201">SAS de cuenta puede delegar el acceso a uno o varios de los servicios de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-201">An account SAS can delegate access to one or more of the storage services.</span></span> <span data-ttu-id="c0f7f-202">Por ejemplo, puede crear una SAS de cuenta que delega el acceso al servicio Blob y Archivo.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-202">For example, you can create an account SAS that delegates access to the Blob and File service.</span></span> <span data-ttu-id="c0f7f-203">O bien, puede crear una SAS que delega el acceso a los cuatro servicios (Blob, Cola, Tabla y Archivo).</span><span class="sxs-lookup"><span data-stu-id="c0f7f-203">Or you can create a SAS that delegates access to all four services (Blob, Queue, Table, and File).</span></span>
* <span data-ttu-id="c0f7f-204">**Tipos de recursos de almacenamiento.**</span><span class="sxs-lookup"><span data-stu-id="c0f7f-204">**Storage resource types.**</span></span> <span data-ttu-id="c0f7f-205">SAS de cuenta se aplica a una o más clases de recursos de almacenamiento, más que a un recurso específico.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-205">An account SAS applies to one or more classes of storage resources, rather than a specific resource.</span></span> <span data-ttu-id="c0f7f-206">Puede crear una SAS de cuenta que delega el acceso a:</span><span class="sxs-lookup"><span data-stu-id="c0f7f-206">You can create an account SAS to delegate access to:</span></span>
  * <span data-ttu-id="c0f7f-207">Las API de nivel de servicio, a las que se llaman en el recurso de la cuenta de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-207">Service-level APIs, which are called against the storage account resource.</span></span> <span data-ttu-id="c0f7f-208">Algunos ejemplos incluyen **Get/Set Service Properties**, **Get Service Stats**, and **List Containers/Queues/Tables/Shares**.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-208">Examples include **Get/Set Service Properties**, **Get Service Stats**, and **List Containers/Queues/Tables/Shares**.</span></span>
  * <span data-ttu-id="c0f7f-209">Las API de nivel de contenedor, a las que se llaman en los objetos de contenedor para cada servicio: contenedores de blobs, colas, tablas y recursos compartidos de archivos.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-209">Container-level APIs, which are called against the container objects for each service: blob containers, queues, tables, and file shares.</span></span> <span data-ttu-id="c0f7f-210">Algunos ejemplos incluyen **Create/Delete Container**, **Create/Delete Queue**, **Create/Delete Table**, **Create/Delete Share** y **List Blobs/Files y Directories**.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-210">Examples include **Create/Delete Container**, **Create/Delete Queue**, **Create/Delete Table**, **Create/Delete Share**, and **List Blobs/Files and Directories**.</span></span>
  * <span data-ttu-id="c0f7f-211">Las API de nivel de objeto, a las que se llaman en blobs, mensajes de colas, entidades de tablas y archivos.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-211">Object-level APIs, which are called against blobs, queue messages, table entities, and files.</span></span> <span data-ttu-id="c0f7f-212">Por ejemplo, **Put Blob**, **Query Entity**, **Get Messages** y **Create File**.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-212">For example, **Put Blob**, **Query Entity**, **Get Messages**, and **Create File**.</span></span>

## <a name="examples-of-sas-uris"></a><span data-ttu-id="c0f7f-213">Ejemplos de URI de SAS</span><span class="sxs-lookup"><span data-stu-id="c0f7f-213">Examples of SAS URIs</span></span>

### <a name="service-sas-uri-example"></a><span data-ttu-id="c0f7f-214">Ejemplo de identificador URI de SAS de servicio</span><span class="sxs-lookup"><span data-stu-id="c0f7f-214">Service SAS URI example</span></span>

<span data-ttu-id="c0f7f-215">A continuación se muestra un ejemplo de un URI de SAS de servicio que ofrece permisos de lectura y escritura en un blob.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-215">Here is an example of a service SAS URI that provides read and write permissions to a blob.</span></span> <span data-ttu-id="c0f7f-216">En la tabla siguiente se divide cada parte del URI para saber cómo contribuye a la SAS:</span><span class="sxs-lookup"><span data-stu-id="c0f7f-216">The table breaks down each part of the URI to understand how it contributes to the SAS:</span></span>

```
https://myaccount.blob.core.windows.net/sascontainer/sasblob.txt?sv=2015-04-05&st=2015-04-29T22%3A18%3A26Z&se=2015-04-30T02%3A23%3A26Z&sr=b&sp=rw&sip=168.1.5.60-168.1.5.70&spr=https&sig=Z%2FRHIX5Xcg0Mq2rqI3OlWTjEg2tYkboXr1P9ZUXDtkk%3D
```

| <span data-ttu-id="c0f7f-217">Nombre</span><span class="sxs-lookup"><span data-stu-id="c0f7f-217">Name</span></span> | <span data-ttu-id="c0f7f-218">Parte de SAS</span><span class="sxs-lookup"><span data-stu-id="c0f7f-218">SAS portion</span></span> | <span data-ttu-id="c0f7f-219">Description</span><span class="sxs-lookup"><span data-stu-id="c0f7f-219">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="c0f7f-220">URI de blobs</span><span class="sxs-lookup"><span data-stu-id="c0f7f-220">Blob URI</span></span> |`https://myaccount.blob.core.windows.net/sascontainer/sasblob.txt` |<span data-ttu-id="c0f7f-221">La dirección del blob.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-221">The address of the blob.</span></span> <span data-ttu-id="c0f7f-222">Tenga en cuenta que se recomienda fehacientemente el uso de HTTPS.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-222">Note that using HTTPS is highly recommended.</span></span> |
| <span data-ttu-id="c0f7f-223">Versión de servicios de almacenamiento</span><span class="sxs-lookup"><span data-stu-id="c0f7f-223">Storage services version</span></span> |`sv=2015-04-05` |<span data-ttu-id="c0f7f-224">En la versión de servicios de almacenamiento 2012-02-12 y superiores, este parámetro indica qué versión usar.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-224">For storage services version 2012-02-12 and later, this parameter indicates the version to use.</span></span> |
| <span data-ttu-id="c0f7f-225">Hora de inicio</span><span class="sxs-lookup"><span data-stu-id="c0f7f-225">Start time</span></span> |`st=2015-04-29T22%3A18%3A26Z` |<span data-ttu-id="c0f7f-226">Se especifica en hora UTC.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-226">Specified in UTC time.</span></span> <span data-ttu-id="c0f7f-227">Si desea que la SAS sea válida de inmediato, omita la hora de inicio.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-227">If you want the SAS to be valid immediately, omit the start time.</span></span> |
| <span data-ttu-id="c0f7f-228">Hora de expiración</span><span class="sxs-lookup"><span data-stu-id="c0f7f-228">Expiry time</span></span> |`se=2015-04-30T02%3A23%3A26Z` |<span data-ttu-id="c0f7f-229">Se especifica en hora UTC.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-229">Specified in UTC time.</span></span> |
| <span data-ttu-id="c0f7f-230">Recurso</span><span class="sxs-lookup"><span data-stu-id="c0f7f-230">Resource</span></span> |`sr=b` |<span data-ttu-id="c0f7f-231">El recurso es un blob.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-231">The resource is a blob.</span></span> |
| <span data-ttu-id="c0f7f-232">Permisos</span><span class="sxs-lookup"><span data-stu-id="c0f7f-232">Permissions</span></span> |`sp=rw` |<span data-ttu-id="c0f7f-233">Los permisos que concede la SAS son de lectura y escritura.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-233">The permissions granted by the SAS include Read (r) and Write (w).</span></span> |
| <span data-ttu-id="c0f7f-234">Intervalo de IP</span><span class="sxs-lookup"><span data-stu-id="c0f7f-234">IP range</span></span> |`sip=168.1.5.60-168.1.5.70` |<span data-ttu-id="c0f7f-235">El intervalo de direcciones IP desde el que se aceptará una solicitud.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-235">The range of IP addresses from which a request will be accepted.</span></span> |
| <span data-ttu-id="c0f7f-236">Protocolo</span><span class="sxs-lookup"><span data-stu-id="c0f7f-236">Protocol</span></span> |`spr=https` |<span data-ttu-id="c0f7f-237">Solo se permiten solicitudes con HTTPS.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-237">Only requests using HTTPS are permitted.</span></span> |
| <span data-ttu-id="c0f7f-238">Firma</span><span class="sxs-lookup"><span data-stu-id="c0f7f-238">Signature</span></span> |`sig=Z%2FRHIX5Xcg0Mq2rqI3OlWTjEg2tYkboXr1P9ZUXDtkk%3D` |<span data-ttu-id="c0f7f-239">Se usa para autenticar el acceso al blob.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-239">Used to authenticate access to the blob.</span></span> <span data-ttu-id="c0f7f-240">La firma es un HMAC que se procesa mediante una cadena para firmar y una clave con el algoritmo SHA256, y que se codifica mediante Base64.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-240">The signature is an HMAC computed over a string-to-sign and key using the SHA256 algorithm, and then encoded using Base64 encoding.</span></span> |

### <a name="account-sas-uri-example"></a><span data-ttu-id="c0f7f-241">Ejemplo de identificador URI de SAS de cuenta</span><span class="sxs-lookup"><span data-stu-id="c0f7f-241">Account SAS URI example</span></span>

<span data-ttu-id="c0f7f-242">Este es un ejemplo de una SAS de cuenta que usa los mismos parámetros comunes en el token.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-242">Here is an example of an account SAS that uses the same common parameters on the token.</span></span> <span data-ttu-id="c0f7f-243">Como estos parámetros aparecen descritos anteriormente, no los vamos a describir aquí.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-243">Since these parameters are described above, they are not described here.</span></span> <span data-ttu-id="c0f7f-244">Solo los parámetros que son específicos de la SAS de cuenta se describen en la tabla siguiente.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-244">Only the parameters that are specific to account SAS are described in the table below.</span></span>

```
https://myaccount.blob.core.windows.net/?restype=service&comp=properties&sv=2015-04-05&ss=bf&srt=s&st=2015-04-29T22%3A18%3A26Z&se=2015-04-30T02%3A23%3A26Z&sr=b&sp=rw&sip=168.1.5.60-168.1.5.70&spr=https&sig=F%6GRVAZ5Cdj2Pw4tgU7IlSTkWgn7bUkkAg8P6HESXwmf%4B
```

| <span data-ttu-id="c0f7f-245">Nombre</span><span class="sxs-lookup"><span data-stu-id="c0f7f-245">Name</span></span> | <span data-ttu-id="c0f7f-246">Parte de SAS</span><span class="sxs-lookup"><span data-stu-id="c0f7f-246">SAS portion</span></span> | <span data-ttu-id="c0f7f-247">Description</span><span class="sxs-lookup"><span data-stu-id="c0f7f-247">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="c0f7f-248">URI de recurso</span><span class="sxs-lookup"><span data-stu-id="c0f7f-248">Resource URI</span></span> |`https://myaccount.blob.core.windows.net/?restype=service&comp=properties` |<span data-ttu-id="c0f7f-249">Extremo de servicio BLOB, con parámetros para obtener propiedades de servicio (cuando se llama con GET) o para establecer propiedades de servicio (cuando se llama con SET).</span><span class="sxs-lookup"><span data-stu-id="c0f7f-249">The Blob service endpoint, with parameters for getting service properties (when called with GET) or setting service properties (when called with SET).</span></span> |
| <span data-ttu-id="c0f7f-250">Services</span><span class="sxs-lookup"><span data-stu-id="c0f7f-250">Services</span></span> |`ss=bf` |<span data-ttu-id="c0f7f-251">La SAS se aplica a los servicios Blob y Archivo</span><span class="sxs-lookup"><span data-stu-id="c0f7f-251">The SAS applies to the Blob and File services</span></span> |
| <span data-ttu-id="c0f7f-252">Tipos de recursos</span><span class="sxs-lookup"><span data-stu-id="c0f7f-252">Resource types</span></span> |`srt=s` |<span data-ttu-id="c0f7f-253">La SAS se aplica a las operaciones de nivel de servicio.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-253">The SAS applies to service-level operations.</span></span> |
| <span data-ttu-id="c0f7f-254">Permisos</span><span class="sxs-lookup"><span data-stu-id="c0f7f-254">Permissions</span></span> |`sp=rw` |<span data-ttu-id="c0f7f-255">Los permisos conceden acceso para operaciones de lectura y escritura.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-255">The permissions grant access to read and write operations.</span></span> |

<span data-ttu-id="c0f7f-256">Dado que los permisos están restringidos al nivel de servicio, las operaciones accesibles con esta SAS son **Get Blob Service Properties** (lectura) y **Set Blob Service Properties** (escritura).</span><span class="sxs-lookup"><span data-stu-id="c0f7f-256">Given that permissions are restricted to the service level, accessible operations with this SAS are **Get Blob Service Properties** (read) and **Set Blob Service Properties** (write).</span></span> <span data-ttu-id="c0f7f-257">Sin embargo, con un URI de recurso diferente, el mismo token de SAS también se puede usar para delegar el acceso a **Get Blob Service Stats** (lectura).</span><span class="sxs-lookup"><span data-stu-id="c0f7f-257">However, with a different resource URI, the same SAS token could also be used to delegate access to **Get Blob Service Stats** (read).</span></span>

## <a name="controlling-a-sas-with-a-stored-access-policy"></a><span data-ttu-id="c0f7f-258">Control de una SAS con una directiva de acceso almacenada</span><span class="sxs-lookup"><span data-stu-id="c0f7f-258">Controlling a SAS with a stored access policy</span></span>
<span data-ttu-id="c0f7f-259">Una firma de acceso compartido puede presentar una de estas dos formas:</span><span class="sxs-lookup"><span data-stu-id="c0f7f-259">A shared access signature can take one of two forms:</span></span>

* <span data-ttu-id="c0f7f-260">**SAS ad-hoc**: cuando cree una SAS ad-hoc, la hora de inicio, la hora de expiración y los permisos para la SAS se especifican en el URI de SAS (o se encuentran implícitos en el caso de que se omita la hora de inicio).</span><span class="sxs-lookup"><span data-stu-id="c0f7f-260">**Ad hoc SAS:** When you create an ad hoc SAS, the start time, expiry time, and permissions for the SAS are all specified in the SAS URI (or implied, in the case where start time is omitted).</span></span> <span data-ttu-id="c0f7f-261">Este tipo de SAS puede crearse como SAS de cuenta o como SAS de servicio.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-261">This type of SAS can be created as an account SAS or a service SAS.</span></span>
* <span data-ttu-id="c0f7f-262">**SAS con directiva de acceso almacenada**: se define una directiva de acceso almacenada en un contenedor de recursos (un contenedor de blobs, un archivo compartido, un archivo, una tabla o una cola) y se puede usar para administrar las restricciones de una o varias firmas de acceso compartido.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-262">**SAS with stored access policy:** A stored access policy is defined on a resource container--a blob container, table, queue, or file share--and can be used to manage constraints for one or more shared access signatures.</span></span> <span data-ttu-id="c0f7f-263">Cuando asocia una SAS a una directiva de acceso almacenada, la SAS hereda las restricciones (hora de inicio, hora de expiración y permisos) definidas para la directiva de acceso almacenada.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-263">When you associate a SAS with a stored access policy, the SAS inherits the constraints--the start time, expiry time, and permissions--defined for the stored access policy.</span></span>

> [!NOTE]
> <span data-ttu-id="c0f7f-264">Actualmente, una SAS de cuenta debe ser una SAS ad hoc.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-264">Currently, an account SAS must be an ad hoc SAS.</span></span> <span data-ttu-id="c0f7f-265">Las directivas de acceso almacenadas ya no son compatibles para SAS de cuenta.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-265">Stored access policies are not yet supported for account SAS.</span></span>

<span data-ttu-id="c0f7f-266">La diferencia entre las dos formas es importante para un escenario principal: revocación.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-266">The difference between the two forms is important for one key scenario: revocation.</span></span> <span data-ttu-id="c0f7f-267">Dado que un URI de SAS es una dirección URL, cualquier persona que obtenga la SAS puede utilizarla, independientemente de quién la creó originalmente.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-267">Because a SAS URI is a URL, anyone that obtains the SAS can use it, regardless of who originally created it.</span></span> <span data-ttu-id="c0f7f-268">Si una SAS se encuentra disponible públicamente, cualquier persona del mundo puede usarla.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-268">If a SAS is published publicly, it can be used by anyone in the world.</span></span> <span data-ttu-id="c0f7f-269">Una SAS concede acceso a los recursos a cualquier persona que cuente con ella hasta que se sucede uno de las siguientes situaciones:</span><span class="sxs-lookup"><span data-stu-id="c0f7f-269">A SAS grants access to resources to anyone possessing it until one of four things happens:</span></span>

1. <span data-ttu-id="c0f7f-270">Se alcanza el tiempo de expiración especificado en la SAS.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-270">The expiry time specified on the SAS is reached.</span></span>
2. <span data-ttu-id="c0f7f-271">Se alcanza el tiempo de expiración especificado en la directiva de acceso almacenada al que hace referencia la SAS (si se hace referencia a una directiva de acceso almacenada y si especifica una hora de expiración).</span><span class="sxs-lookup"><span data-stu-id="c0f7f-271">The expiry time specified on the stored access policy referenced by the SAS is reached (if a stored access policy is referenced, and if it specifies an expiry time).</span></span> <span data-ttu-id="c0f7f-272">Esto puede producirse ya sea porque transcurra el intervalo o porque haya modificado la directiva de acceso almacenada para tener una hora de expiración pasada, que es una forma de revocar la SAS.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-272">This can occur either because the interval elapses, or because you've modified the stored access policy with an expiry time in the past, which is one way to revoke the SAS.</span></span>
3. <span data-ttu-id="c0f7f-273">Se elimina la directiva de acceso almacenada a la que hace referencia la SAS, que es otra forma de revocar la SAS.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-273">The stored access policy referenced by the SAS is deleted, which is another way to revoke the SAS.</span></span> <span data-ttu-id="c0f7f-274">Tenga en cuenta que si vuelve a crear la directiva de acceso almacenada exactamente con el mismo nombre, todos los tokens de la SAS volverán a ser válidos según los permisos asociados a la directiva de acceso almacenada (si se presupone que la hora de expiración en la SAS no ha pasado).</span><span class="sxs-lookup"><span data-stu-id="c0f7f-274">Note that if you recreate the stored access policy with exactly the same name, all existing SAS tokens will again be valid according to the permissions associated with that stored access policy (assuming that the expiry time on the SAS has not passed).</span></span> <span data-ttu-id="c0f7f-275">Si prevé revocar la SAS, asegúrese de usar un nombre distinto si vuelve a crear la directiva de acceso con una hora de expiración futura.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-275">If you are intending to revoke the SAS, be sure to use a different name if you recreate the access policy with an expiry time in the future.</span></span>
4. <span data-ttu-id="c0f7f-276">Se vuelve a generar la clave de cuenta que se usó para crear la SAS.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-276">The account key that was used to create the SAS is regenerated.</span></span> <span data-ttu-id="c0f7f-277">La regeneración de una clave de cuenta provocará que todos los componentes de la aplicación que usen esa clave no puedan autenticarse hasta que se actualicen para usar la otra clave de cuenta válida o la clave de cuenta que se acaba de regenerar.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-277">Regenerating an account key will cause all application components using that key to fail to authenticate until they're updated to use either the other valid account key or the newly regenerated account key.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c0f7f-278">Los URI de firma de acceso compartido están asociados a la clave de la cuenta que se utiliza para crear la firma y a la directiva de acceso almacenada correspondiente (en su caso).</span><span class="sxs-lookup"><span data-stu-id="c0f7f-278">A shared access signature URI is associated with the account key used to create the signature, and the associated stored access policy (if any).</span></span> <span data-ttu-id="c0f7f-279">Si no se especifica una directiva de acceso almacenada, la única forma de revocar una firma de acceso compartido es cambiar la clave de la cuenta.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-279">If no stored access policy is specified, the only way to revoke a shared access signature is to change the account key.</span></span>

## <a name="authenticating-from-a-client-application-with-a-sas"></a><span data-ttu-id="c0f7f-280">Autenticación desde una aplicación cliente con una SAS</span><span class="sxs-lookup"><span data-stu-id="c0f7f-280">Authenticating from a client application with a SAS</span></span>
<span data-ttu-id="c0f7f-281">Un cliente que esté en posesión de una SAS puede usarla para autenticar una solicitud en una cuenta de almacenamiento para la que no posee las claves de cuenta.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-281">A client who is in possession of a SAS can use the SAS to authenticate a request against a storage account for which they do not possess the account keys.</span></span> <span data-ttu-id="c0f7f-282">Una SAS se puede incluir en una cadena de conexión, o usar directamente desde el método o constructor adecuados.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-282">A SAS can be included in a connection string, or used directly from the appropriate constructor or method.</span></span>

### <a name="using-a-sas-in-a-connection-string"></a><span data-ttu-id="c0f7f-283">Uso de SAS en una cadena de conexión</span><span class="sxs-lookup"><span data-stu-id="c0f7f-283">Using a SAS in a connection string</span></span>
[!INCLUDE [storage-use-sas-in-connection-string-include](../../includes/storage-use-sas-in-connection-string-include.md)]

### <a name="using-a-sas-in-a-constructor-or-method"></a><span data-ttu-id="c0f7f-284">Uso de una SAS en un constructor o método</span><span class="sxs-lookup"><span data-stu-id="c0f7f-284">Using a SAS in a constructor or method</span></span>
<span data-ttu-id="c0f7f-285">Varios sobrecargas de métodos y constructores de biblioteca de cliente de Azure Storage ofrecen un parámetro SAS, para que pueda autenticar una solicitud al servicio con una SAS.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-285">Several Azure Storage client library constructors and method overloads offer a SAS parameter, so that you can authenticate a request to the service with a SAS.</span></span>

<span data-ttu-id="c0f7f-286">Por ejemplo, aquí se usa un URI de SAS para crear una referencia a un blob en bloques.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-286">For example, here a SAS URI is used to create a reference to a block blob.</span></span> <span data-ttu-id="c0f7f-287">La SAS proporciona las únicas credenciales necesarias para la solicitud.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-287">The SAS provides the only credentials needed for the request.</span></span> <span data-ttu-id="c0f7f-288">La referencia de blob en bloques se usa luego para una operación de escritura:</span><span class="sxs-lookup"><span data-stu-id="c0f7f-288">The block blob reference is then used for a write operation:</span></span>

```csharp
string sasUri = "https://storagesample.blob.core.windows.net/sample-container/" +
    "sampleBlob.txt?sv=2015-07-08&sr=b&sig=39Up9JzHkxhUIhFEjEH9594DJxe7w6cIRCg0V6lCGSo%3D" +
    "&se=2016-10-18T21%3A51%3A37Z&sp=rcw";

CloudBlockBlob blob = new CloudBlockBlob(new Uri(sasUri));

// Create operation: Upload a blob with the specified name to the container.
// If the blob does not exist, it will be created. If it does exist, it will be overwritten.
try
{
    MemoryStream msWrite = new MemoryStream(Encoding.UTF8.GetBytes(blobContent));
    msWrite.Position = 0;
    using (msWrite)
    {
        await blob.UploadFromStreamAsync(msWrite);
    }

    Console.WriteLine("Create operation succeeded for SAS {0}", sasUri);
    Console.WriteLine();
}
catch (StorageException e)
{
    if (e.RequestInformation.HttpStatusCode == 403)
    {
        Console.WriteLine("Create operation failed for SAS {0}", sasUri);
        Console.WriteLine("Additional error information: " + e.Message);
        Console.WriteLine();
    }
    else
    {
        Console.WriteLine(e.Message);
        Console.ReadLine();
        throw;
    }
}

```

## <a name="best-practices-when-using-sas"></a><span data-ttu-id="c0f7f-289">Procedimientos recomendados al usar SAS</span><span class="sxs-lookup"><span data-stu-id="c0f7f-289">Best practices when using SAS</span></span>
<span data-ttu-id="c0f7f-290">Cuando use firmas de acceso compartido en sus aplicaciones, debe tener en cuenta dos posibles riesgos:</span><span class="sxs-lookup"><span data-stu-id="c0f7f-290">When you use shared access signatures in your applications, you need to be aware of two potential risks:</span></span>

* <span data-ttu-id="c0f7f-291">Si se perdió una SAS, cualquier persona que la consiga puede usarla, lo que puede poner en riesgo su cuenta de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-291">If a SAS is leaked, it can be used by anyone who obtains it, which can potentially compromise your storage account.</span></span>
* <span data-ttu-id="c0f7f-292">Si una SAS proporcionada para una aplicación cliente expira y la aplicación no puede recuperar una nueva SAS del servicio, la funcionalidad de la aplicación puede verse afectada.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-292">If a SAS provided to a client application expires and the application is unable to retrieve a new SAS from your service, then the application's functionality may be hindered.</span></span>

<span data-ttu-id="c0f7f-293">Las siguientes recomendaciones para el uso de firmas de acceso compartido pueden ayudar a mitigar estos riesgos:</span><span class="sxs-lookup"><span data-stu-id="c0f7f-293">The following recommendations for using shared access signatures can help mitigate these risks:</span></span>

1. <span data-ttu-id="c0f7f-294">**Siempre use HTTPS** para crear una SAS o distribuirla.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-294">**Always use HTTPS** to create or distribute a SAS.</span></span> <span data-ttu-id="c0f7f-295">Si se pasa una SAS a través de HTTP y se intercepta, un atacante que realice un ataque de tipo "Man in the middle" puede leer la SAS y, luego, usarla como lo podría hacer el usuario previsto. Esto puede poner en riesgo la información confidencial o permitir que un usuario malintencionado provoque daños en los datos.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-295">If a SAS is passed over HTTP and intercepted, an attacker performing a man-in-the-middle attack is able to read the SAS and then use it just as the intended user could have, potentially compromising sensitive data or allowing for data corruption by the malicious user.</span></span>
2. <span data-ttu-id="c0f7f-296">**Haga referencia a las directivas de acceso almacenadas cuando sea posible.**</span><span class="sxs-lookup"><span data-stu-id="c0f7f-296">**Reference stored access policies where possible.**</span></span> <span data-ttu-id="c0f7f-297">Las directivas de acceso almacenadas le ofrecen la posibilidad de revocar permisos sin tener que volver a generar las claves de cuenta de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-297">Stored access policies give you the option to revoke permissions without having to regenerate the storage account keys.</span></span> <span data-ttu-id="c0f7f-298">Establezca su expiración en un futuro muy lejano (o infinito) y asegúrese de que se actualiza regularmente para trasladarla a un punto posterior en el tiempo.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-298">Set the expiration on these very far in the future (or infinite) and make sure it's regularly updated to move it farther into the future.</span></span>
3. <span data-ttu-id="c0f7f-299">**Use horas de expiración a corto plazo en una SAS ad-hoc.**</span><span class="sxs-lookup"><span data-stu-id="c0f7f-299">**Use near-term expiration times on an ad hoc SAS.**</span></span> <span data-ttu-id="c0f7f-300">De esta manera, incluso si una SAS está en peligro, es válida solo durante un breve período.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-300">In this way, even if a SAS is compromised, it's valid only for a short time.</span></span> <span data-ttu-id="c0f7f-301">Esta práctica es especialmente importante si no puede hacer referencia a una directiva de acceso almacenada.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-301">This practice is especially important if you cannot reference a stored access policy.</span></span> <span data-ttu-id="c0f7f-302">Las expiraciones a corto plazo también limitan la cantidad de datos que puede escribirse en un blob mediante la limitación del tiempo disponible para cargarlos.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-302">Near-term expiration times also limit the amount of data that can be written to a blob by limiting the time available to upload to it.</span></span>
4. <span data-ttu-id="c0f7f-303">**Haga que los clientes renueven automáticamente la SAS si fuese necesario.**</span><span class="sxs-lookup"><span data-stu-id="c0f7f-303">**Have clients automatically renew the SAS if necessary.**</span></span> <span data-ttu-id="c0f7f-304">Los clientes deben renovar la SAS correctamente antes de la expiración para que exista tiempo para los reintentos si el servicio que ofrece la SAS no está disponible.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-304">Clients should renew the SAS well before the expiration, in order to allow time for retries if the service providing the SAS is unavailable.</span></span> <span data-ttu-id="c0f7f-305">Si la SAS se ha creado para usarse en un número reducido de operaciones de corta duración e inmediatas, que se espera que se va a completar dentro del tiempo de expiración determinado, es posible que no sea necesario ese procedimiento, ya que no se espera que la SAS se renueve.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-305">If your SAS is meant to be used for a small number of immediate, short-lived operations that are expected to be completed within the expiration period, then this may be unnecessary as the SAS is not expected to be renewed.</span></span> <span data-ttu-id="c0f7f-306">Sin embargo, si dispone de un cliente que realice solicitudes de forma rutinaria a través de la SAS, existe la posibilidad de la expiración.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-306">However, if you have client that is routinely making requests via SAS, then the possibility of expiration comes into play.</span></span> <span data-ttu-id="c0f7f-307">La consideración clave es equilibrar la necesidad de que la SAS sea de corta duración (como se indicó anteriormente) con el requisito de garantizar que el cliente solicitan la renovación con la suficiente antelación como para evitar la interrupción debida a la expiración de SAS antes de una renovación correcta.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-307">The key consideration is to balance the need for the SAS to be short-lived (as previously stated) with the need to ensure that the client is requesting renewal early enough (to avoid disruption due to the SAS expiring prior to successful renewal).</span></span>
5. <span data-ttu-id="c0f7f-308">**Tenga cuidado con la hora de inicio de la SAS.**</span><span class="sxs-lookup"><span data-stu-id="c0f7f-308">**Be careful with SAS start time.**</span></span> <span data-ttu-id="c0f7f-309">Si establece la hora de inicio de la SAS en **now**, pueden producirse errores intermitentes durante los primeros minutos debido al desplazamiento del reloj (diferencias en la hora actual según las distintas máquinas).</span><span class="sxs-lookup"><span data-stu-id="c0f7f-309">If you set the start time for a SAS to **now**, then due to clock skew (differences in current time according to different machines), failures may be observed intermittently for the first few minutes.</span></span> <span data-ttu-id="c0f7f-310">En general, establezca la hora de inicio sea al menos 15 minutos en el pasado.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-310">In general, set the start time to be at least 15 minutes in the past.</span></span> <span data-ttu-id="c0f7f-311">O, no establezca esta opción en absoluto, lo que hará que sea válido inmediatamente en todos los casos.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-311">Or, don't set it at all, which will make it valid immediately in all cases.</span></span> <span data-ttu-id="c0f7f-312">Normalmente se aplica lo mismo a la hora de expiración. Recuerde que debe tener en cuenta hasta 15 minutos de desplazamiento del reloj en cualquier dirección en una solicitud.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-312">The same generally applies to expiry time as well--remember that you may observe up to 15 minutes of clock skew in either direction on any request.</span></span> <span data-ttu-id="c0f7f-313">Para los clientes con una versión REST anterior a 2012-02-12: la duración máxima de una SAS que no hace referencia a una directiva de acceso almacenada es de 1 hora y se producirá un error en las directivas que especifican un período más largo.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-313">For clients using a REST version prior to 2012-02-12, the maximum duration for a SAS that does not reference a stored access policy is 1 hour, and any policies specifying longer term than that will fail.</span></span>
6. <span data-ttu-id="c0f7f-314">**Sea específico con el recurso al que se va a tener acceso.**</span><span class="sxs-lookup"><span data-stu-id="c0f7f-314">**Be specific with the resource to be accessed.**</span></span> <span data-ttu-id="c0f7f-315">Un procedimiento recomendado de seguridad es proporcionar al usuario los privilegios mínimos necesarios.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-315">A security best practice is to provide a user with the minimum required privileges.</span></span> <span data-ttu-id="c0f7f-316">Si un usuario solo necesita acceso de lectura en una única entidad, concédale acceso de lectura a esa única entidad y no acceso de lectura, escritura o eliminación a todas las entidades.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-316">If a user only needs read access to a single entity, then grant them read access to that single entity, and not read/write/delete access to all entities.</span></span> <span data-ttu-id="c0f7f-317">Esto también ayuda a reducir los daños si se pone en peligro una SAS porque la SAS tiene menor menos poder en manos de un atacante.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-317">This also helps lessen the damage if a SAS is compromised because the SAS has less power in the hands of an attacker.</span></span>
7. <span data-ttu-id="c0f7f-318">**Comprenda que se le hará un cargo en la cuenta por cualquier uso, incluido el realizado con la SAS.**</span><span class="sxs-lookup"><span data-stu-id="c0f7f-318">**Understand that your account will be billed for any usage, including that done with SAS.**</span></span> <span data-ttu-id="c0f7f-319">Si proporciona acceso de escritura a un blob, el usuario puede seleccionar cargar un blob de 200 GB.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-319">If you provide write access to a blob, a user may choose to upload a 200GB blob.</span></span> <span data-ttu-id="c0f7f-320">Si le proporciona también acceso de lectura, puede seleccionar descargarlo 10 veces, lo que le supone 2 TB de costos de salida.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-320">If you've given them read access as well, they may choose to download it 10 times, incurring 2 TB in egress costs for you.</span></span> <span data-ttu-id="c0f7f-321">Proporcione de nuevo permisos limitados para ayudar a mitigar acciones potenciales de usuarios malintencionados.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-321">Again, provide limited permissions to help mitigate the potential actions of malicious users.</span></span> <span data-ttu-id="c0f7f-322">Use una SAS de corta duración para reducir esa amenaza (pero tenga en cuenta el desplazamiento del reloj y la hora final).</span><span class="sxs-lookup"><span data-stu-id="c0f7f-322">Use short-lived SAS to reduce this threat (but be mindful of clock skew on the end time).</span></span>
8. <span data-ttu-id="c0f7f-323">**Valide los datos escritos mediante la SAS.**</span><span class="sxs-lookup"><span data-stu-id="c0f7f-323">**Validate data written using SAS.**</span></span> <span data-ttu-id="c0f7f-324">Cuando una aplicación cliente escribe datos en la cuenta de almacenamiento, tenga en cuenta que pueden existir problemas con esos datos.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-324">When a client application writes data to your storage account, keep in mind that there can be problems with that data.</span></span> <span data-ttu-id="c0f7f-325">Si la aplicación requiere que se validen o autoricen los datos antes de que estén listos para usar, debe realizar la validación después de que se escriban los datos y antes de que la aplicación los use.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-325">If your application requires that that data be validated or authorized before it is ready to use, you should perform this validation after the data is written and before it is used by your application.</span></span> <span data-ttu-id="c0f7f-326">Esta práctica también le protege frente a los datos erróneos o malintencionados que se escriben en la cuenta, ya sea mediante un usuario que adquirió correctamente la SAS o un usuario que aproveche una SAS errónea.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-326">This practice also protects against corrupt or malicious data being written to your account, either by a user who properly acquired the SAS, or by a user exploiting a leaked SAS.</span></span>
9. <span data-ttu-id="c0f7f-327">**No use siempre la SAS.**</span><span class="sxs-lookup"><span data-stu-id="c0f7f-327">**Don't always use SAS.**</span></span> <span data-ttu-id="c0f7f-328">En ocasiones, los riesgos asociados a una operación determinada en la cuenta de almacenamiento superan a las ventajas del uso de la SAS.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-328">Sometimes the risks associated with a particular operation against your storage account outweigh the benefits of SAS.</span></span> <span data-ttu-id="c0f7f-329">Para esas operaciones, cree un servicio de nivel medio que escriba en la cuenta de almacenamiento después de llevar a cabo una auditoría, autenticación o validación de la regla de negocio.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-329">For such operations, create a middle-tier service that writes to your storage account after performing business rule validation, authentication, and auditing.</span></span> <span data-ttu-id="c0f7f-330">A veces también es más sencillo administrar el acceso de otras formas.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-330">Also, sometimes it's simpler to manage access in other ways.</span></span> <span data-ttu-id="c0f7f-331">Por ejemplo, si desea que todos los blobs de un contenedor puedan leerse públicamente, puede hacer que el contenedor sea público en lugar de proporcionar un SAS a cada cliente para obtener acceso.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-331">For example, if you want to make all blobs in a container publically readable, you can make the container Public, rather than providing a SAS to every client for access.</span></span>
10. <span data-ttu-id="c0f7f-332">**Use el análisis de almacenamiento para supervisar la aplicación.**</span><span class="sxs-lookup"><span data-stu-id="c0f7f-332">**Use Storage Analytics to monitor your application.**</span></span> <span data-ttu-id="c0f7f-333">Puede hacer uso de registros y métricas para observar cualquier pico en los errores de autenticación producidos por la interrupción del servicio del proveedor de SAS o la eliminación involuntaria de una directiva de acceso almacenada.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-333">You can use logging and metrics to observe any spike in authentication failures due to an outage in your SAS provider service or to the inadvertent removal of a stored access policy.</span></span> <span data-ttu-id="c0f7f-334">Consulte el [blog del equipo de almacenamiento de Azure](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/08/03/windows-azure-storage-logging-using-logs-to-track-storage-requests.aspx) (en inglés) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-334">See the [Azure Storage Team Blog](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/08/03/windows-azure-storage-logging-using-logs-to-track-storage-requests.aspx) for additional information.</span></span>

## <a name="sas-examples"></a><span data-ttu-id="c0f7f-335">Ejemplos de SAS</span><span class="sxs-lookup"><span data-stu-id="c0f7f-335">SAS examples</span></span>
<span data-ttu-id="c0f7f-336">A continuación figuran algunos ejemplos de ambos tipos de firmas de acceso compartido, SAS de cuenta y SAS de servicio.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-336">Below are some examples of both types of shared access signatures, account SAS and service SAS.</span></span>

<span data-ttu-id="c0f7f-337">Para ejecutar estos ejemplos de C#, debe hacer referencia a los siguientes paquetes de NuGet en el proyecto:</span><span class="sxs-lookup"><span data-stu-id="c0f7f-337">To run these C# examples, you need to reference the following NuGet packages in your project:</span></span>

* <span data-ttu-id="c0f7f-338">Versión 6.x o posterior de la [Biblioteca de cliente de Almacenamiento de azure para .NET](http://www.nuget.org/packages/WindowsAzure.Storage) (para usar la cuenta SAS).</span><span class="sxs-lookup"><span data-stu-id="c0f7f-338">[Azure Storage Client Library for .NET](http://www.nuget.org/packages/WindowsAzure.Storage), version 6.x or later (to use account SAS).</span></span>
* [<span data-ttu-id="c0f7f-339">Administrador de configuración Azure</span><span class="sxs-lookup"><span data-stu-id="c0f7f-339">Azure Configuration Manager</span></span>](http://www.nuget.org/packages/Microsoft.WindowsAzure.ConfigurationManager)

<span data-ttu-id="c0f7f-340">Para obtener ejemplos adicionales que muestran cómo crear y probar SAS, vea [Ejemplos de código de Azure para Storage](https://azure.microsoft.com/documentation/samples/?service=storage).</span><span class="sxs-lookup"><span data-stu-id="c0f7f-340">For additional examples that show how to create and test a SAS, see [Azure Code Samples for Storage](https://azure.microsoft.com/documentation/samples/?service=storage).</span></span>

### <a name="example-create-and-use-an-account-sas"></a><span data-ttu-id="c0f7f-341">Ejemplo: Crear y utilizar una SAS de cuenta</span><span class="sxs-lookup"><span data-stu-id="c0f7f-341">Example: Create and use an account SAS</span></span>
<span data-ttu-id="c0f7f-342">En el ejemplo de código siguiente se crea una SAS de cuenta que es válida para los servicios Blob y Archivo y da al cliente permisos de lectura, escritura y lista para acceder a las API de nivel de servicio.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-342">The following code example creates an account SAS that is valid for the Blob and File services, and gives the client permissions read, write, and list permissions to access service-level APIs.</span></span> <span data-ttu-id="c0f7f-343">La SAS de cuenta restringe el protocolo a HTTPS, por lo que la solicitud se debe realizar con HTTPS.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-343">The account SAS restricts the protocol to HTTPS, so the request must be made with HTTPS.</span></span>

```csharp
static string GetAccountSASToken()
{
    // To create the account SAS, you need to use your shared key credentials. Modify for your account.
    const string ConnectionString = "DefaultEndpointsProtocol=https;AccountName=account-name;AccountKey=account-key";
    CloudStorageAccount storageAccount = CloudStorageAccount.Parse(ConnectionString);

    // Create a new access policy for the account.
    SharedAccessAccountPolicy policy = new SharedAccessAccountPolicy()
        {
            Permissions = SharedAccessAccountPermissions.Read | SharedAccessAccountPermissions.Write | SharedAccessAccountPermissions.List,
            Services = SharedAccessAccountServices.Blob | SharedAccessAccountServices.File,
            ResourceTypes = SharedAccessAccountResourceTypes.Service,
            SharedAccessExpiryTime = DateTime.UtcNow.AddHours(24),
            Protocols = SharedAccessProtocol.HttpsOnly
        };

    // Return the SAS token.
    return storageAccount.GetSharedAccessSignature(policy);
}
```

<span data-ttu-id="c0f7f-344">Para usar la SAS de cuenta a fin de acceder a las API de nivel de servicio para el servicio Blob, construya un objeto de cliente Blob con la SAS y el extremo de almacenamiento de Blob para la cuenta de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-344">To use the account SAS to access service-level APIs for the Blob service, construct a Blob client object using the SAS and the Blob storage endpoint for your storage account.</span></span>

```csharp
static void UseAccountSAS(string sasToken)
{
    // Create new storage credentials using the SAS token.
    StorageCredentials accountSAS = new StorageCredentials(sasToken);
    // Use these credentials and the account name to create a Blob service client.
    CloudStorageAccount accountWithSAS = new CloudStorageAccount(accountSAS, "account-name", endpointSuffix: null, useHttps: true);
    CloudBlobClient blobClientWithSAS = accountWithSAS.CreateCloudBlobClient();

    // Now set the service properties for the Blob client created with the SAS.
    blobClientWithSAS.SetServiceProperties(new ServiceProperties()
    {
        HourMetrics = new MetricsProperties()
        {
            MetricsLevel = MetricsLevel.ServiceAndApi,
            RetentionDays = 7,
            Version = "1.0"
        },
        MinuteMetrics = new MetricsProperties()
        {
            MetricsLevel = MetricsLevel.ServiceAndApi,
            RetentionDays = 7,
            Version = "1.0"
        },
        Logging = new LoggingProperties()
        {
            LoggingOperations = LoggingOperations.All,
            RetentionDays = 14,
            Version = "1.0"
        }
    });

    // The permissions granted by the account SAS also permit you to retrieve service properties.
    ServiceProperties serviceProperties = blobClientWithSAS.GetServiceProperties();
    Console.WriteLine(serviceProperties.HourMetrics.MetricsLevel);
    Console.WriteLine(serviceProperties.HourMetrics.RetentionDays);
    Console.WriteLine(serviceProperties.HourMetrics.Version);
}
```

### <a name="example-create-a-stored-access-policy"></a><span data-ttu-id="c0f7f-345">Ejemplo: Crear una directiva de acceso almacenada</span><span class="sxs-lookup"><span data-stu-id="c0f7f-345">Example: Create a stored access policy</span></span>
<span data-ttu-id="c0f7f-346">El código siguiente crea una directiva de acceso almacenada en un contenedor.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-346">The following code creates a stored access policy on a container.</span></span> <span data-ttu-id="c0f7f-347">Puede usar la directiva de acceso para especificar restricciones para una SAS de servicio en el contenedor o sus blobs.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-347">You can use the access policy to specify constraints for a service SAS on the container or its blobs.</span></span>

```csharp
private static async Task CreateSharedAccessPolicyAsync(CloudBlobContainer container, string policyName)
{
    // Create a new shared access policy and define its constraints.
    // The access policy provides create, write, read, list, and delete permissions.
    SharedAccessBlobPolicy sharedPolicy = new SharedAccessBlobPolicy()
    {
        // When the start time for the SAS is omitted, the start time is assumed to be the time when the storage service receives the request.
        // Omitting the start time for a SAS that is effective immediately helps to avoid clock skew.
        SharedAccessExpiryTime = DateTime.UtcNow.AddHours(24),
        Permissions = SharedAccessBlobPermissions.Read | SharedAccessBlobPermissions.List |
            SharedAccessBlobPermissions.Write | SharedAccessBlobPermissions.Create | SharedAccessBlobPermissions.Delete
    };

    // Get the container's existing permissions.
    BlobContainerPermissions permissions = await container.GetPermissionsAsync();

    // Add the new policy to the container's permissions, and set the container's permissions.
    permissions.SharedAccessPolicies.Add(policyName, sharedPolicy);
    await container.SetPermissionsAsync(permissions);
}
```

### <a name="example-create-a-service-sas-on-a-container"></a><span data-ttu-id="c0f7f-348">Ejemplo: Crear una SAS de servicio en un contenedor</span><span class="sxs-lookup"><span data-stu-id="c0f7f-348">Example: Create a service SAS on a container</span></span>
<span data-ttu-id="c0f7f-349">El código siguiente crea una SAS en un contenedor.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-349">The following code creates a SAS on a container.</span></span> <span data-ttu-id="c0f7f-350">Si se proporciona el nombre de una directiva de acceso almacenada existente, esa directiva se asocia con la SAS.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-350">If the name of an existing stored access policy is provided, that policy is associated with the SAS.</span></span> <span data-ttu-id="c0f7f-351">Si no se proporciona ninguna directiva de acceso almacenada, el código crea una SAS ad-hoc en el contenedor.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-351">If no stored access policy is provided, then the code creates an ad-hoc SAS on the container.</span></span>

```csharp
private static string GetContainerSasUri(CloudBlobContainer container, string storedPolicyName = null)
{
    string sasContainerToken;

    // If no stored policy is specified, create a new access policy and define its constraints.
    if (storedPolicyName == null)
    {
        // Note that the SharedAccessBlobPolicy class is used both to define the parameters of an ad-hoc SAS, and
        // to construct a shared access policy that is saved to the container's shared access policies.
        SharedAccessBlobPolicy adHocPolicy = new SharedAccessBlobPolicy()
        {
            // When the start time for the SAS is omitted, the start time is assumed to be the time when the storage service receives the request.
            // Omitting the start time for a SAS that is effective immediately helps to avoid clock skew.
            SharedAccessExpiryTime = DateTime.UtcNow.AddHours(24),
            Permissions = SharedAccessBlobPermissions.Write | SharedAccessBlobPermissions.List
        };

        // Generate the shared access signature on the container, setting the constraints directly on the signature.
        sasContainerToken = container.GetSharedAccessSignature(adHocPolicy, null);

        Console.WriteLine("SAS for blob container (ad hoc): {0}", sasContainerToken);
        Console.WriteLine();
    }
    else
    {
        // Generate the shared access signature on the container. In this case, all of the constraints for the
        // shared access signature are specified on the stored access policy, which is provided by name.
        // It is also possible to specify some constraints on an ad-hoc SAS and others on the stored access policy.
        sasContainerToken = container.GetSharedAccessSignature(null, storedPolicyName);

        Console.WriteLine("SAS for blob container (stored access policy): {0}", sasContainerToken);
        Console.WriteLine();
    }

    // Return the URI string for the container, including the SAS token.
    return container.Uri + sasContainerToken;
}
```

### <a name="example-create-a-service-sas-on-a-blob"></a><span data-ttu-id="c0f7f-352">Ejemplo: Crear una SAS de servicio en un blob</span><span class="sxs-lookup"><span data-stu-id="c0f7f-352">Example: Create a service SAS on a blob</span></span>
<span data-ttu-id="c0f7f-353">El código siguiente crea una SAS en un blob.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-353">The following code creates a SAS on a blob.</span></span> <span data-ttu-id="c0f7f-354">Si se proporciona el nombre de una directiva de acceso almacenada existente, esa directiva se asocia con la SAS.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-354">If the name of an existing stored access policy is provided, that policy is associated with the SAS.</span></span> <span data-ttu-id="c0f7f-355">Si no se proporciona ninguna directiva de acceso almacenada, el código crea una SAS ad-hoc en el blob.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-355">If no stored access policy is provided, then the code creates an ad-hoc SAS on the blob.</span></span>

```csharp
private static string GetBlobSasUri(CloudBlobContainer container, string blobName, string policyName = null)
{
    string sasBlobToken;

    // Get a reference to a blob within the container.
    // Note that the blob may not exist yet, but a SAS can still be created for it.
    CloudBlockBlob blob = container.GetBlockBlobReference(blobName);

    if (policyName == null)
    {
        // Create a new access policy and define its constraints.
        // Note that the SharedAccessBlobPolicy class is used both to define the parameters of an ad-hoc SAS, and
        // to construct a shared access policy that is saved to the container's shared access policies.
        SharedAccessBlobPolicy adHocSAS = new SharedAccessBlobPolicy()
        {
            // When the start time for the SAS is omitted, the start time is assumed to be the time when the storage service receives the request.
            // Omitting the start time for a SAS that is effective immediately helps to avoid clock skew.
            SharedAccessExpiryTime = DateTime.UtcNow.AddHours(24),
            Permissions = SharedAccessBlobPermissions.Read | SharedAccessBlobPermissions.Write | SharedAccessBlobPermissions.Create
        };

        // Generate the shared access signature on the blob, setting the constraints directly on the signature.
        sasBlobToken = blob.GetSharedAccessSignature(adHocSAS);

        Console.WriteLine("SAS for blob (ad hoc): {0}", sasBlobToken);
        Console.WriteLine();
    }
    else
    {
        // Generate the shared access signature on the blob. In this case, all of the constraints for the
        // shared access signature are specified on the container's stored access policy.
        sasBlobToken = blob.GetSharedAccessSignature(null, policyName);

        Console.WriteLine("SAS for blob (stored access policy): {0}", sasBlobToken);
        Console.WriteLine();
    }

    // Return the URI string for the container, including the SAS token.
    return blob.Uri + sasBlobToken;
}
```

## <a name="conclusion"></a><span data-ttu-id="c0f7f-356">Conclusión</span><span class="sxs-lookup"><span data-stu-id="c0f7f-356">Conclusion</span></span>
<span data-ttu-id="c0f7f-357">Las firmas de acceso compartido son útiles para ofrecer permisos limitados a su cuenta de almacenamiento a clientes que no deben tener la clave de cuenta.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-357">Shared access signatures are useful for providing limited permissions to your storage account to clients that should not have the account key.</span></span> <span data-ttu-id="c0f7f-358">Por ese motivo, son una parte fundamental del modelo de seguridad para cualquier aplicación que use Almacenamiento de Azure.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-358">As such, they are a vital part of the security model for any application using Azure Storage.</span></span> <span data-ttu-id="c0f7f-359">Si sigue las prácticas recomendadas descritas aquí, puede usar la SAS para ofrecer una mayor flexibilidad de acceso a los recursos en la cuenta de almacenamiento sin que se ponga en riesgo la seguridad de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c0f7f-359">If you follow the best practices listed here, you can use SAS to provide greater flexibility of access to resources in your storage account, without compromising the security of your application.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c0f7f-360">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="c0f7f-360">Next Steps</span></span>
* [<span data-ttu-id="c0f7f-361">Administración del acceso de lectura anónimo a contenedores y blobs</span><span class="sxs-lookup"><span data-stu-id="c0f7f-361">Manage anonymous read access to containers and blobs</span></span>](storage-manage-access-to-resources.md)
* [<span data-ttu-id="c0f7f-362">Delegación de acceso con una firma de acceso compartido</span><span class="sxs-lookup"><span data-stu-id="c0f7f-362">Delegating Access with a Shared Access Signature</span></span>](http://msdn.microsoft.com/library/azure/ee395415.aspx)
* [<span data-ttu-id="c0f7f-363">Introducción a las firmas de acceso compartido de tabla y cola</span><span class="sxs-lookup"><span data-stu-id="c0f7f-363">Introducing Table and Queue SAS</span></span>](http://blogs.msdn.com/b/windowsazurestorage/archive/2012/06/12/introducing-table-sas-shared-access-signature-queue-sas-and-update-to-blob-sas.aspx)

[sas-storage-fe-proxy-service]: ./media/storage-dotnet-shared-access-signature-part-1/sas-storage-fe-proxy-service.png
[sas-storage-provider-service]: ./media/storage-dotnet-shared-access-signature-part-1/sas-storage-provider-service.png
[sas-storage-uri]: ./media/storage-dotnet-shared-access-signature-part-1/sas-storage-uri.png

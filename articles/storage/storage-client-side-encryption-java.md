---
title: Cifrado del lado de aaaClient con Java para almacenamiento de Microsoft Azure | Documentos de Microsoft
description: "Hola biblioteca de cliente de almacenamiento de Azure para Java admite cifrado en el cliente y la integración con el almacén de claves de Azure para lograr la máxima seguridad para las aplicaciones de almacenamiento de Azure."
services: storage
documentationcenter: java
author: lakasa
manager: jahogg
editor: tysonn
ms.assetid: 3df49907-554c-404a-9b0c-b3e3269ad04f
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: java
ms.topic: article
ms.date: 05/11/2017
ms.author: lakasa
ms.openlocfilehash: 60a928e8737e64a8bec97dbc9f423537bd9afe88
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="client-side-encryption-and-azure-key-vault-with-java-for-microsoft-azure-storage"></a><span data-ttu-id="c94a7-103">Cifrado del lado de cliente y Azure Key Vault para Microsoft Azure Storage</span><span class="sxs-lookup"><span data-stu-id="c94a7-103">Client-Side Encryption and Azure Key Vault with Java for Microsoft Azure Storage</span></span>
[!INCLUDE [storage-selector-client-side-encryption-include](../../includes/storage-selector-client-side-encryption-include.md)]

## <a name="overview"></a><span data-ttu-id="c94a7-104">Información general</span><span class="sxs-lookup"><span data-stu-id="c94a7-104">Overview</span></span>
<span data-ttu-id="c94a7-105">Hola [biblioteca de cliente de almacenamiento de Azure para Java](http://mvnrepository.com/artifact/com.microsoft.azure/azure-storage) admite el cifrado de datos dentro de las aplicaciones cliente antes de cargar tooAzure almacenamiento y descifrar los datos mientras se descargaba toohello cliente.</span><span class="sxs-lookup"><span data-stu-id="c94a7-105">hello [Azure Storage Client Library for Java](http://mvnrepository.com/artifact/com.microsoft.azure/azure-storage) supports encrypting data within client applications before uploading tooAzure Storage, and decrypting data while downloading toohello client.</span></span> <span data-ttu-id="c94a7-106">biblioteca de Hello también admite la integración con [el almacén de claves de Azure](https://azure.microsoft.com/services/key-vault/) para administración de claves de cuenta de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="c94a7-106">hello library also supports integration with [Azure Key Vault](https://azure.microsoft.com/services/key-vault/) for storage account key management.</span></span>

## <a name="encryption-and-decryption-via-hello-envelope-technique"></a><span data-ttu-id="c94a7-107">Cifrado y descifrado mediante la técnica de sobres de Hola</span><span class="sxs-lookup"><span data-stu-id="c94a7-107">Encryption and decryption via hello envelope technique</span></span>
<span data-ttu-id="c94a7-108">Hola de los procesos de cifrado y descifrado sigue técnica de sobres de Hola.</span><span class="sxs-lookup"><span data-stu-id="c94a7-108">hello processes of encryption and decryption follow hello envelope technique.</span></span>  

### <a name="encryption-via-hello-envelope-technique"></a><span data-ttu-id="c94a7-109">Cifrado a través de la técnica de sobres de Hola</span><span class="sxs-lookup"><span data-stu-id="c94a7-109">Encryption via hello envelope technique</span></span>
<span data-ttu-id="c94a7-110">Cifrado a través de la técnica de sobres de hello funciona en hello siguiente forma:</span><span class="sxs-lookup"><span data-stu-id="c94a7-110">Encryption via hello envelope technique works in hello following way:</span></span>  

1. <span data-ttu-id="c94a7-111">biblioteca de cliente de almacenamiento de Azure de Hello genera una clave de cifrado de contenido (CEK), que es una clave simétrica de un solo uso.</span><span class="sxs-lookup"><span data-stu-id="c94a7-111">hello Azure storage client library generates a content encryption key (CEK), which is a one-time-use symmetric key.</span></span>  
2. <span data-ttu-id="c94a7-112">Los datos de usuario se cifran mediante esta CEK.</span><span class="sxs-lookup"><span data-stu-id="c94a7-112">User data is encrypted using this CEK.</span></span>   
3. <span data-ttu-id="c94a7-113">Hello CEK se incluye después (cifrada) con clave de cifrado de claves de Hola (de claves KEK).</span><span class="sxs-lookup"><span data-stu-id="c94a7-113">hello CEK is then wrapped (encrypted) using hello key encryption key (KEK).</span></span> <span data-ttu-id="c94a7-114">Hola KEK se identifica mediante un identificador de clave y puede ser un par de claves asimétricas o una clave simétrica y se puede administrar de forma local o almacenado en los almacenes de claves de Azure.</span><span class="sxs-lookup"><span data-stu-id="c94a7-114">hello KEK is identified by a key identifier and can be an asymmetric key pair or a symmetric key and can be managed locally or stored in Azure Key Vaults.</span></span>  
   <span data-ttu-id="c94a7-115">biblioteca de cliente de almacenamiento de Hello propio nunca tiene acceso tooKEK.</span><span class="sxs-lookup"><span data-stu-id="c94a7-115">hello storage client library itself never has access tooKEK.</span></span> <span data-ttu-id="c94a7-116">biblioteca de Hello invoca el algoritmo de encapsulado de clave de hello proporcionada por el almacén de claves.</span><span class="sxs-lookup"><span data-stu-id="c94a7-116">hello library invokes hello key wrapping algorithm that is provided by Key Vault.</span></span> <span data-ttu-id="c94a7-117">Los usuarios pueden elegir toouse proveedores personalizados para clave ajuste/desencapsulación si lo desea.</span><span class="sxs-lookup"><span data-stu-id="c94a7-117">Users can choose toouse custom providers for key wrapping/unwrapping if desired.</span></span>  
4. <span data-ttu-id="c94a7-118">Hola datos cifrados están, a continuación, cargar el servicio de almacenamiento de Azure toohello.</span><span class="sxs-lookup"><span data-stu-id="c94a7-118">hello encrypted data is then uploaded toohello Azure Storage service.</span></span> <span data-ttu-id="c94a7-119">Hola clave ajustada junto con algunos metadatos de cifrado adicional se almacenan como metadatos (en un blob) o se interpolan con datos de hello cifrada (cola de mensajes y entidades de tabla).</span><span class="sxs-lookup"><span data-stu-id="c94a7-119">hello wrapped key along with some additional encryption metadata is either stored as metadata (on a blob) or interpolated with hello encrypted data (queue messages and table entities).</span></span>

### <a name="decryption-via-hello-envelope-technique"></a><span data-ttu-id="c94a7-120">Descifrado mediante la técnica de sobres de Hola</span><span class="sxs-lookup"><span data-stu-id="c94a7-120">Decryption via hello envelope technique</span></span>
<span data-ttu-id="c94a7-121">Descifrado mediante la técnica de sobres de hello funciona en hello siguiente forma:</span><span class="sxs-lookup"><span data-stu-id="c94a7-121">Decryption via hello envelope technique works in hello following way:</span></span>  

1. <span data-ttu-id="c94a7-122">biblioteca de cliente de Hola se da por supuesto que el usuario Hola administra Hola clave cifrado de claves (KEK) ya sea localmente o en los almacenes de claves de Azure.</span><span class="sxs-lookup"><span data-stu-id="c94a7-122">hello client library assumes that hello user is managing hello key encryption key (KEK) either locally or in Azure Key Vaults.</span></span> <span data-ttu-id="c94a7-123">Hola usuario no necesita clave específica de tooknow Hola que se usó para el cifrado.</span><span class="sxs-lookup"><span data-stu-id="c94a7-123">hello user does not need tooknow hello specific key that was used for encryption.</span></span> <span data-ttu-id="c94a7-124">En su lugar, una resolución de clave que se resuelve tookeys diferentes identificadores de clave se puede configurar y usar.</span><span class="sxs-lookup"><span data-stu-id="c94a7-124">Instead, a key resolver which resolves different key identifiers tookeys can be set up and used.</span></span>  
2. <span data-ttu-id="c94a7-125">biblioteca de cliente de Hello descarga los datos de hello cifrado junto con cualquier material de cifrado que se almacena en el servicio de Hola.</span><span class="sxs-lookup"><span data-stu-id="c94a7-125">hello client library downloads hello encrypted data along with any encryption material that is stored on hello service.</span></span>  
3. <span data-ttu-id="c94a7-126">clave de cifrado de contenido ajustada Hello (CEK) es (descifran) con desempaquetarse Hola claves de cifrado de claves (KEK).</span><span class="sxs-lookup"><span data-stu-id="c94a7-126">hello wrapped content encryption key (CEK) is then unwrapped (decrypted) using hello key encryption key (KEK).</span></span> <span data-ttu-id="c94a7-127">Aquí una vez más, biblioteca de cliente de hello no tiene acceso tooKEK.</span><span class="sxs-lookup"><span data-stu-id="c94a7-127">Here again, hello client library does not have access tooKEK.</span></span> <span data-ttu-id="c94a7-128">Simplemente invoca Hola personalizado o algoritmo desencapsulación del proveedor de almacén de claves.</span><span class="sxs-lookup"><span data-stu-id="c94a7-128">It simply invokes hello custom or Key Vault provider's unwrapping algorithm.</span></span>  
4. <span data-ttu-id="c94a7-129">Hola contenido clave de cifrado (CEK) es, a continuación, utiliza datos de usuario de toodecrypt Hola cifrado.</span><span class="sxs-lookup"><span data-stu-id="c94a7-129">hello content encryption key (CEK) is then used toodecrypt hello encrypted user data.</span></span>

## <a name="encryption-mechanism"></a><span data-ttu-id="c94a7-130">Mecanismo de cifrado</span><span class="sxs-lookup"><span data-stu-id="c94a7-130">Encryption Mechanism</span></span>
<span data-ttu-id="c94a7-131">usa la biblioteca de cliente de almacenamiento de Hello [AES](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) en los datos de usuario de tooencrypt de orden.</span><span class="sxs-lookup"><span data-stu-id="c94a7-131">hello storage client library uses [AES](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) in order tooencrypt user data.</span></span> <span data-ttu-id="c94a7-132">En concreto, emplea el modo [Cipher Block Chaining (CBC)](http://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Cipher-block_chaining_.28CBC.29) con AES.</span><span class="sxs-lookup"><span data-stu-id="c94a7-132">Specifically, [Cipher Block Chaining (CBC)](http://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Cipher-block_chaining_.28CBC.29) mode with AES.</span></span> <span data-ttu-id="c94a7-133">Cada servicio funciona de forma ligeramente diferente, por lo que describiremos aquí cada uno de ellos.</span><span class="sxs-lookup"><span data-stu-id="c94a7-133">Each service works somewhat differently, so we will discuss each of them here.</span></span>

### <a name="blobs"></a><span data-ttu-id="c94a7-134">Blobs</span><span class="sxs-lookup"><span data-stu-id="c94a7-134">Blobs</span></span>
<span data-ttu-id="c94a7-135">biblioteca de cliente de Hello actualmente admite el cifrado de todo blobs solo.</span><span class="sxs-lookup"><span data-stu-id="c94a7-135">hello client library currently supports encryption of whole blobs only.</span></span> <span data-ttu-id="c94a7-136">En concreto, se admite el cifrado cuando los usuarios usen hello **cargar*** métodos o hello **openOutputStream** método.</span><span class="sxs-lookup"><span data-stu-id="c94a7-136">Specifically, encryption is supported when users use hello **upload*** methods or hello **openOutputStream** method.</span></span> <span data-ttu-id="c94a7-137">En el caso de las descargas, se admiten tanto las descargas de intervalo como las completas.</span><span class="sxs-lookup"><span data-stu-id="c94a7-137">For downloads, both complete and range downloads are supported.</span></span>  

<span data-ttu-id="c94a7-138">Durante el cifrado, la biblioteca de cliente de hello generará un Vector de inicialización aleatorio (IV) de 16 bytes, junto con una clave de cifrado aleatoria de contenido (CEK) de 32 bytes y realizar el cifrado de sellado de datos de blob de hello con esta información.</span><span class="sxs-lookup"><span data-stu-id="c94a7-138">During encryption, hello client library will generate a random Initialization Vector (IV) of 16 bytes, together with a random content encryption key (CEK) of 32 bytes, and perform envelope encryption of hello blob data using this information.</span></span> <span data-ttu-id="c94a7-139">Hola ajustó CEK y algunos metadatos de cifrado adicional, a continuación, se almacenan como metadatos junto con el blob cifrado de hello en el servicio de hello del blob.</span><span class="sxs-lookup"><span data-stu-id="c94a7-139">hello wrapped CEK and some additional encryption metadata are then stored as blob metadata along with hello encrypted blob on hello service.</span></span>

> [!WARNING]
> <span data-ttu-id="c94a7-140">Si está modificando o cargar sus propios metadatos del blob de hello, deberá tooensure que estos metadatos se conservan.</span><span class="sxs-lookup"><span data-stu-id="c94a7-140">If you are editing or uploading your own metadata for hello blob, you need tooensure that this metadata is preserved.</span></span> <span data-ttu-id="c94a7-141">Si va a cargar nuevos metadatos sin estos metadatos, Hola CEK ajustada, se perderán IV y otros metadatos y contenido de blob de hello nunca pueda recuperarse nuevo.</span><span class="sxs-lookup"><span data-stu-id="c94a7-141">If you upload new metadata without this metadata, hello wrapped CEK, IV and other metadata will be lost and hello blob content will never be retrievable again.</span></span>
> 
> 

<span data-ttu-id="c94a7-142">Descargar un blob cifrado implica recuperando Hola contenido de blob completo hello mediante hello  **descargar*/openInputStream** métodos útiles.</span><span class="sxs-lookup"><span data-stu-id="c94a7-142">Downloading an encrypted blob involves retrieving hello content of hello entire blob using hello **download*/openInputStream** convenience methods.</span></span> <span data-ttu-id="c94a7-143">Hola CEK ajustada se desempaqueta y se utiliza junto con hello IV (almacenados como metadatos del blob en este caso) tooreturn Hola descifrado datos toohello a los usuarios.</span><span class="sxs-lookup"><span data-stu-id="c94a7-143">hello wrapped CEK is unwrapped and used together with hello IV (stored as blob metadata in this case) tooreturn hello decrypted data toohello users.</span></span>

<span data-ttu-id="c94a7-144">Descargar un intervalo arbitrario (**downloadRange*** métodos) en hello blob cifrado implica el ajuste del rango de hello proporcionados por los usuarios en orden tooget una pequeña cantidad de datos adicionales que pueden ser utilizado toosuccessfully descifrar Hola intervalo solicitado.</span><span class="sxs-lookup"><span data-stu-id="c94a7-144">Downloading an arbitrary range (**downloadRange*** methods) in hello encrypted blob involves adjusting hello range provided by users in order tooget a small amount of additional data that can be used toosuccessfully decrypt hello requested range.</span></span>  

<span data-ttu-id="c94a7-145">Todos los tipos de blobs (blobs en bloques, blobs de anexión) se pueden cifrar y descifrar usando este esquema.</span><span class="sxs-lookup"><span data-stu-id="c94a7-145">All blob types (block blobs, page blobs, and append blobs) can be encrypted/decrypted using this scheme.</span></span>

### <a name="queues"></a><span data-ttu-id="c94a7-146">Colas</span><span class="sxs-lookup"><span data-stu-id="c94a7-146">Queues</span></span>
<span data-ttu-id="c94a7-147">Puesto que la cola de mensajes puede ser de cualquier formato, biblioteca de cliente de hello define un formato personalizado que incluye Hola Vector de inicialización (IV) y la clave de cifrado de contenido cifrada de hello (CEK) en el texto del mensaje de Hola.</span><span class="sxs-lookup"><span data-stu-id="c94a7-147">Since queue messages can be of any format, hello client library defines a custom format that includes hello Initialization Vector (IV) and hello encrypted content encryption key (CEK) in hello message text.</span></span>  

<span data-ttu-id="c94a7-148">Durante el cifrado, la biblioteca de cliente de hello genera un vector de inicialización aleatorio de 16 bytes junto con una CEK aleatoria de 32 bytes y realiza el cifrado de sellado de texto del mensaje de cola de hello con esta información.</span><span class="sxs-lookup"><span data-stu-id="c94a7-148">During encryption, hello client library generates a random IV of 16 bytes along with a random CEK of 32 bytes and performs envelope encryption of hello queue message text using this information.</span></span> <span data-ttu-id="c94a7-149">Hola ajustó CEK y algunos metadatos de cifrado adicional, a continuación, se agregan toohello la cola cifrado de mensajes.</span><span class="sxs-lookup"><span data-stu-id="c94a7-149">hello wrapped CEK and some additional encryption metadata are then added toohello encrypted queue message.</span></span> <span data-ttu-id="c94a7-150">Este mensaje modificado (se muestra a continuación) se almacena en el servicio de Hola.</span><span class="sxs-lookup"><span data-stu-id="c94a7-150">This modified message (shown below) is stored on hello service.</span></span>

```
<MessageText>{"EncryptedMessageContents":"6kOu8Rq1C3+M1QO4alKLmWthWXSmHV3mEfxBAgP9QGTU++MKn2uPq3t2UjF1DO6w","EncryptionData":{…}}</MessageText>
```

<span data-ttu-id="c94a7-151">Durante el descifrado, clave ajustada Hola se extrae del mensaje de la cola de Hola y desempaqueta.</span><span class="sxs-lookup"><span data-stu-id="c94a7-151">During decryption, hello wrapped key is extracted from hello queue message and unwrapped.</span></span> <span data-ttu-id="c94a7-152">Hola IV también está extraído del mensaje de la cola de Hola y utilizar junto con datos del mensaje de Hola desempaqueta toodecrypt clave Hola cola.</span><span class="sxs-lookup"><span data-stu-id="c94a7-152">hello IV is also extracted from hello queue message and used along with hello unwrapped key toodecrypt hello queue message data.</span></span> <span data-ttu-id="c94a7-153">Tenga en cuenta que metadatos de cifrado de hello están pequeño (en bytes) 500, por lo que mientras cuentan para el límite de 64KB de Hola para un mensaje de la cola, el impacto de hello debería ser fácil de administrar.</span><span class="sxs-lookup"><span data-stu-id="c94a7-153">Note that hello encryption metadata is small (under 500 bytes), so while it does count toward hello 64KB limit for a queue message, hello impact should be manageable.</span></span>

### <a name="tables"></a><span data-ttu-id="c94a7-154">Tablas</span><span class="sxs-lookup"><span data-stu-id="c94a7-154">Tables</span></span>
<span data-ttu-id="c94a7-155">Hola cliente biblioteca admite el cifrado de propiedades de entidad para la inserción de operaciones y reemplazo.</span><span class="sxs-lookup"><span data-stu-id="c94a7-155">hello client library supports encryption of entity properties for insert and replace operations.</span></span>

> [!NOTE]
> <span data-ttu-id="c94a7-156">Las operaciones de combinación no se admiten actualmente.</span><span class="sxs-lookup"><span data-stu-id="c94a7-156">Merge is not currently supported.</span></span> <span data-ttu-id="c94a7-157">Puesto que un subconjunto de propiedades se puede haber cifrado previamente mediante una clave diferente, simplemente combinar nuevas propiedades de Hola y actualizar metadatos de hello producirá pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="c94a7-157">Since a subset of properties may have been encrypted previously using a different key, simply merging hello new properties and updating hello metadata will result in data loss.</span></span> <span data-ttu-id="c94a7-158">Combinar cualquiera requiere servicio adicional de realizar llamadas entidad preexistente de hello tooread del servicio de hello, o mediante una clave nueva por cada propiedad, los cuales no son adecuados por motivos de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="c94a7-158">Merging either requires making extra service calls tooread hello pre-existing entity from hello service, or using a new key per property, both of which are not suitable for performance reasons.</span></span>
> 
> 

<span data-ttu-id="c94a7-159">El cifrado de datos de tabla funciona de la siguiente forma:</span><span class="sxs-lookup"><span data-stu-id="c94a7-159">Table data encryption works as follows:</span></span>  

1. <span data-ttu-id="c94a7-160">Los usuarios especificar Hola propiedades toobe cifrado.</span><span class="sxs-lookup"><span data-stu-id="c94a7-160">Users specify hello properties toobe encrypted.</span></span>  
2. <span data-ttu-id="c94a7-161">biblioteca de cliente de Hello genera un Vector de inicialización aleatorio (IV) de 16 bytes junto con una clave de cifrado aleatoria de contenido (CEK) de 32 bytes para cada entidad y realiza el cifrado de sellado en toobe de las propiedades individuales de hello cifrada al derivar un nuevo vector de inicialización por propiedad.</span><span class="sxs-lookup"><span data-stu-id="c94a7-161">hello client library generates a random Initialization Vector (IV) of 16 bytes along with a random content encryption key (CEK) of 32 bytes for every entity, and performs envelope encryption on hello individual properties toobe encrypted by deriving a new IV per property.</span></span> <span data-ttu-id="c94a7-162">propiedad Hola cifrada se almacena como datos binarios.</span><span class="sxs-lookup"><span data-stu-id="c94a7-162">hello encrypted property is stored as binary data.</span></span>  
3. <span data-ttu-id="c94a7-163">Hola ajustó CEK y algunos metadatos de cifrado adicional, a continuación, se almacenan como dos propiedades reservadas adicionales.</span><span class="sxs-lookup"><span data-stu-id="c94a7-163">hello wrapped CEK and some additional encryption metadata are then stored as two additional reserved properties.</span></span> <span data-ttu-id="c94a7-164">Hola primera propiedad reservada (_ClientEncryptionMetadata1) es una propiedad de cadena que contiene información de hello sobre IV, la versión y la clave ajustada.</span><span class="sxs-lookup"><span data-stu-id="c94a7-164">hello first reserved property (_ClientEncryptionMetadata1) is a string property that holds hello information about IV, version, and wrapped key.</span></span> <span data-ttu-id="c94a7-165">Hola segunda propiedad reservada (_ClientEncryptionMetadata2) es una propiedad binaria que contiene información de hello sobre propiedades de Hola que estén cifrados.</span><span class="sxs-lookup"><span data-stu-id="c94a7-165">hello second reserved property (_ClientEncryptionMetadata2) is a binary property that holds hello information about hello properties that are encrypted.</span></span> <span data-ttu-id="c94a7-166">información de Hello en esta segunda propiedad (_ClientEncryptionMetadata2) está cifrada.</span><span class="sxs-lookup"><span data-stu-id="c94a7-166">hello information in this second property (_ClientEncryptionMetadata2) is itself encrypted.</span></span>  
4. <span data-ttu-id="c94a7-167">Pagar toothese reservadas propiedades adicionales necesarias para el cifrado, los usuarios ahora pueden tener sólo 250 propiedades personalizadas en lugar de 252.</span><span class="sxs-lookup"><span data-stu-id="c94a7-167">Due toothese additional reserved properties required for encryption, users may now have only 250 custom properties instead of 252.</span></span> <span data-ttu-id="c94a7-168">tamaño total de Hola de entidad de hello debe ser inferior a 1MB.</span><span class="sxs-lookup"><span data-stu-id="c94a7-168">hello total size of hello entity must be less than 1MB.</span></span>  
   
   <span data-ttu-id="c94a7-169">Tenga en cuenta que solo se pueden cifrar las propiedades de cadena.</span><span class="sxs-lookup"><span data-stu-id="c94a7-169">Note that only string properties can be encrypted.</span></span> <span data-ttu-id="c94a7-170">Si hay otros tipos de propiedades toobe cifrado, deben ser toostrings convertido.</span><span class="sxs-lookup"><span data-stu-id="c94a7-170">If other types of properties are toobe encrypted, they must be converted toostrings.</span></span> <span data-ttu-id="c94a7-171">cadenas de Hello cifrado se almacenan en el servicio de hello como propiedades binarias y se convierten toostrings atrás tras la descodificación.</span><span class="sxs-lookup"><span data-stu-id="c94a7-171">hello encrypted strings are stored on hello service as binary properties, and they are converted back toostrings after decryption.</span></span>
   
   <span data-ttu-id="c94a7-172">Para las tablas, además toohello directiva de cifrado, los usuarios deben especificar Hola propiedades toobe cifrado.</span><span class="sxs-lookup"><span data-stu-id="c94a7-172">For tables, in addition toohello encryption policy, users must specify hello properties toobe encrypted.</span></span> <span data-ttu-id="c94a7-173">Para ello, pueden especificar un atributo [Encrypt] \(para las entidades POCO que se derivan de TableEntity) o una resolución de cifrado en las opciones de solicitud.</span><span class="sxs-lookup"><span data-stu-id="c94a7-173">This can be done by either specifying an [Encrypt] attribute (for POCO entities that derive from TableEntity) or an encryption resolver in request options.</span></span> <span data-ttu-id="c94a7-174">Una resolución de cifrado es un delegado que toma una clave de partición, una clave de fila y un nombre de propiedad y devuelve un valor booleano que indica si se debe cifrar dicha propiedad.</span><span class="sxs-lookup"><span data-stu-id="c94a7-174">An encryption resolver is a delegate that takes a partition key, row key, and property name and returns a boolean that indicates whether that property should be encrypted.</span></span> <span data-ttu-id="c94a7-175">Durante el cifrado, biblioteca de cliente de hello utilizará esta toodecide información si se debe cifrar una propiedad al escribir el cable toohello.</span><span class="sxs-lookup"><span data-stu-id="c94a7-175">During encryption, hello client library will use this information toodecide whether a property should be encrypted while writing toohello wire.</span></span> <span data-ttu-id="c94a7-176">delegado de Hello también proporciona posibilidad de Hola de lógica de alrededor de cómo se cifran las propiedades.</span><span class="sxs-lookup"><span data-stu-id="c94a7-176">hello delegate also provides for hello possibility of logic around how properties are encrypted.</span></span> <span data-ttu-id="c94a7-177">(Por ejemplo, si el valor es X, hay que cifrar la propiedad A; en caso contrario, hay que cifrar las propiedades A y B). Tenga en cuenta que TI es tooprovide no es necesario que esta información al leer o consultar entidades.</span><span class="sxs-lookup"><span data-stu-id="c94a7-177">(For example, if X, then encrypt property A; otherwise encrypt properties A and B.) Note that it is not necessary tooprovide this information while reading or querying entities.</span></span>

### <a name="batch-operations"></a><span data-ttu-id="c94a7-178">Operaciones por lotes</span><span class="sxs-lookup"><span data-stu-id="c94a7-178">Batch Operations</span></span>
<span data-ttu-id="c94a7-179">En operaciones por lotes, hello KEK mismo se usará en todas las filas de hello en esa operación por lotes porque la biblioteca de cliente de hello sólo permite un objeto de opciones (y por lo tanto, una directiva/KEK) por operación por lotes.</span><span class="sxs-lookup"><span data-stu-id="c94a7-179">In batch operations, hello same KEK will be used across all hello rows in that batch operation because hello client library only allows one options object (and hence one policy/KEK) per batch operation.</span></span> <span data-ttu-id="c94a7-180">Sin embargo, la biblioteca de cliente de Hola generará internamente un nuevo vector de inicialización aleatorio y una CEK aleatorio por cada fila en lote Hola.</span><span class="sxs-lookup"><span data-stu-id="c94a7-180">However, hello client library will internally generate a new random IV and random CEK per row in hello batch.</span></span> <span data-ttu-id="c94a7-181">Los usuarios también pueden elegir tooencrypt diferentes propiedades para cada operación de lote de hello mediante la definición de este comportamiento de resolución de cifrado de Hola.</span><span class="sxs-lookup"><span data-stu-id="c94a7-181">Users can also choose tooencrypt different properties for every operation in hello batch by defining this behavior in hello encryption resolver.</span></span>

### <a name="queries"></a><span data-ttu-id="c94a7-182">Consultas</span><span class="sxs-lookup"><span data-stu-id="c94a7-182">Queries</span></span>
<span data-ttu-id="c94a7-183">operaciones de consulta de tooperform, debe especificar un solucionador de clave que es capaz de tooresolve todos Hola claves Hola conjunto de resultados.</span><span class="sxs-lookup"><span data-stu-id="c94a7-183">tooperform query operations, you must specify a key resolver that is able tooresolve all hello keys in hello result set.</span></span> <span data-ttu-id="c94a7-184">Si una entidad incluida en el resultado de la consulta de hello no se puede resolver tooa proveedor, biblioteca de cliente de Hola producirá un error.</span><span class="sxs-lookup"><span data-stu-id="c94a7-184">If an entity contained in hello query result cannot be resolved tooa provider, hello client library will throw an error.</span></span> <span data-ttu-id="c94a7-185">Para cualquier consulta que lleva a cabo proyecciones del lado servidor, la biblioteca de cliente de hello agregará propiedades de metadatos de cifrado especial de hello (_ClientEncryptionMetadata1 y _ClientEncryptionMetadata2) por columnas de toohello seleccionado de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="c94a7-185">For any query that performs server side projections, hello client library will add hello special encryption metadata properties (_ClientEncryptionMetadata1 and _ClientEncryptionMetadata2) by default toohello selected columns.</span></span>

## <a name="azure-key-vault"></a><span data-ttu-id="c94a7-186">Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="c94a7-186">Azure Key Vault</span></span>
<span data-ttu-id="c94a7-187">El Almacén de claves de Azure ayuda a proteger claves criptográficas y secretos usados por servicios y aplicaciones en la nube.</span><span class="sxs-lookup"><span data-stu-id="c94a7-187">Azure Key Vault helps safeguard cryptographic keys and secrets used by cloud applications and services.</span></span> <span data-ttu-id="c94a7-188">Mediante el uso del Almacén de claves de Azure, los usuarios pueden cifrar claves y secretos (por ejemplo claves de autenticación, claves de cuenta de almacenamiento, claves de cifrado de datos, archivos .PFX y contraseñas) usando claves que están protegidas por módulos de seguridad de hardware (HSM).</span><span class="sxs-lookup"><span data-stu-id="c94a7-188">By using Azure Key Vault, users can encrypt keys and secrets (such as authentication keys, storage account keys, data encryption keys, .PFX files, and passwords) by using keys that are protected by hardware security modules (HSMs).</span></span> <span data-ttu-id="c94a7-189">Para obtener más información, consulte [¿Qué es el Almacén de claves de Azure?](../key-vault/key-vault-whatis.md)</span><span class="sxs-lookup"><span data-stu-id="c94a7-189">For more information, see [What is Azure Key Vault?](../key-vault/key-vault-whatis.md).</span></span>

<span data-ttu-id="c94a7-190">biblioteca de cliente de almacenamiento de Hello utiliza la biblioteca de núcleo de almacén de claves de hello en orden tooprovide un marco común a través de Azure para administrar las claves.</span><span class="sxs-lookup"><span data-stu-id="c94a7-190">hello storage client library uses hello Key Vault core library in order tooprovide a common framework across Azure for managing keys.</span></span> <span data-ttu-id="c94a7-191">Los usuarios también obtendrán la ventaja adicional de hello del uso de la biblioteca de extensiones del almacén de claves de Hola.</span><span class="sxs-lookup"><span data-stu-id="c94a7-191">Users also get hello additional benefit of using hello Key Vault extensions library.</span></span> <span data-ttu-id="c94a7-192">biblioteca de extensiones de Hello proporciona funcionalidad útil alrededor de sencilla y sin problemas Symmetric/RSA local y proveedores de clave en la nube, así como con la agregación y almacenamiento en caché.</span><span class="sxs-lookup"><span data-stu-id="c94a7-192">hello extensions library provides useful functionality around simple and seamless Symmetric/RSA local and cloud key providers as well as with aggregation and caching.</span></span>

### <a name="interface-and-dependencies"></a><span data-ttu-id="c94a7-193">Interfaz y dependencias</span><span class="sxs-lookup"><span data-stu-id="c94a7-193">Interface and dependencies</span></span>
<span data-ttu-id="c94a7-194">Hay tres paquetes del Almacén de claves:</span><span class="sxs-lookup"><span data-stu-id="c94a7-194">There are three Key Vault packages:</span></span>  

* <span data-ttu-id="c94a7-195">núcleo de keyvault de Azure contiene Hola IKey y IKeyResolver.</span><span class="sxs-lookup"><span data-stu-id="c94a7-195">azure-keyvault-core contains hello IKey and IKeyResolver.</span></span> <span data-ttu-id="c94a7-196">Es un paquete pequeño sin dependencias.</span><span class="sxs-lookup"><span data-stu-id="c94a7-196">It is a small package with no dependencies.</span></span> <span data-ttu-id="c94a7-197">biblioteca de cliente de almacenamiento de Hola para Java define como una dependencia.</span><span class="sxs-lookup"><span data-stu-id="c94a7-197">hello storage client library for Java defines it as a dependency.</span></span>
* <span data-ttu-id="c94a7-198">Azure keyvault contiene Hola de cliente de REST del almacén de claves.</span><span class="sxs-lookup"><span data-stu-id="c94a7-198">azure-keyvault contains hello Key Vault REST client.</span></span>  
* <span data-ttu-id="c94a7-199">azure-keyvault-extensions contiene el código de extensión que incluye implementaciones de algoritmos criptográficos, además de una RSAKey y una SymmetricKey.</span><span class="sxs-lookup"><span data-stu-id="c94a7-199">azure-keyvault-extensions contains extension code that includes implementations of cryptographic algorithms and an RSAKey and a SymmetricKey.</span></span> <span data-ttu-id="c94a7-200">Depende de los espacios de nombres de KeyVault y los núcleos de Hola y proporciona funcionalidad toodefine un solucionador de agregado (cuando los usuarios desean toouse varios proveedores de claves) y una resolución de clave de almacenamiento en caché.</span><span class="sxs-lookup"><span data-stu-id="c94a7-200">It depends on hello Core and KeyVault namespaces and provides functionality toodefine an aggregate resolver (when users want toouse multiple key providers) and a caching key resolver.</span></span> <span data-ttu-id="c94a7-201">Aunque biblioteca de cliente de almacenamiento de hello no directamente dependen de este paquete, si los usuarios desea toostore de almacén de claves de Azure toouse sus claves o toouse Hola Hola de tooconsume de extensiones de almacén de claves local y proveedores de servicios criptográficos en la nube, necesitará este paquete.</span><span class="sxs-lookup"><span data-stu-id="c94a7-201">Although hello storage client library does not directly depend on this package, if users wish toouse Azure Key Vault toostore their keys or toouse hello Key Vault extensions tooconsume hello local and cloud cryptographic providers, they will need this package.</span></span>  
  
  <span data-ttu-id="c94a7-202">El Almacén de claves está diseñado para claves maestras de gran valor. Por su parte, los valores de limitación por cada Almacén de claves se diseñan teniendo en cuenta este aspecto.</span><span class="sxs-lookup"><span data-stu-id="c94a7-202">Key Vault is designed for high-value master keys, and throttling limits per Key Vault are designed with this in mind.</span></span> <span data-ttu-id="c94a7-203">Al realizar el cifrado en el cliente con el almacén de claves, modelo preferido de hello es toouse master las claves simétricas almacenadas como secretos en el almacén de claves y almacenado en caché localmente.</span><span class="sxs-lookup"><span data-stu-id="c94a7-203">When performing client-side encryption with Key Vault, hello preferred model is toouse symmetric master keys stored as secrets in Key Vault and cached locally.</span></span> <span data-ttu-id="c94a7-204">Los usuarios deben hacer siguiente hello:</span><span class="sxs-lookup"><span data-stu-id="c94a7-204">Users must do hello following:</span></span>  

1. <span data-ttu-id="c94a7-205">Crear un secreto sin conexión y cargarlo tooKey almacén.</span><span class="sxs-lookup"><span data-stu-id="c94a7-205">Create a secret offline and upload it tooKey Vault.</span></span>  
2. <span data-ttu-id="c94a7-206">Usar identificador de base del secreto de Hola como un parámetro tooresolve Hola versión actual de secreto de hello para el cifrado y almacenar en caché localmente esta información.</span><span class="sxs-lookup"><span data-stu-id="c94a7-206">Use hello secret's base identifier as a parameter tooresolve hello current version of hello secret for encryption and cache this information locally.</span></span> <span data-ttu-id="c94a7-207">Use CachingKeyResolver para almacenar en caché; los usuarios es tooimplement no esperado en lógica de su propio almacenamiento en caché.</span><span class="sxs-lookup"><span data-stu-id="c94a7-207">Use CachingKeyResolver for caching; users are not expected tooimplement their own caching logic.</span></span>  
3. <span data-ttu-id="c94a7-208">Utilizar a la resolución de caché hello como una entrada al crear la directiva de cifrado de Hola.</span><span class="sxs-lookup"><span data-stu-id="c94a7-208">Use hello caching resolver as an input while creating hello encryption policy.</span></span>
   <span data-ttu-id="c94a7-209">Obtener más información sobre el uso del almacén de claves se puede encontrar en los ejemplos de código de hello cifrado.</span><span class="sxs-lookup"><span data-stu-id="c94a7-209">More information regarding Key Vault usage can be found in hello encryption code samples.</span></span> <fix URL>  

## <a name="best-practices"></a><span data-ttu-id="c94a7-210">Prácticas recomendadas</span><span class="sxs-lookup"><span data-stu-id="c94a7-210">Best practices</span></span>
<span data-ttu-id="c94a7-211">Compatibilidad con el cifrado está disponible solo en la biblioteca de cliente de almacenamiento de Hola para Java.</span><span class="sxs-lookup"><span data-stu-id="c94a7-211">Encryption support is available only in hello storage client library for Java.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c94a7-212">Tenga en cuenta estos puntos importantes al usar el cifrado del lado del cliente:</span><span class="sxs-lookup"><span data-stu-id="c94a7-212">Be aware of these important points when using client-side encryption:</span></span>
> 
> * <span data-ttu-id="c94a7-213">Cuando tooan leer o escribir los cifra blob, usar comandos de carga de blob completo y comandos de descarga de blobs de intervalo/todo.</span><span class="sxs-lookup"><span data-stu-id="c94a7-213">When reading from or writing tooan encrypted blob, use whole blob upload commands and range/whole blob download commands.</span></span> <span data-ttu-id="c94a7-214">Evite escribir tooan blob cifrado mediante operaciones de protocolo como bloque Put, coloque la lista de bloqueados, escribir páginas, borrar páginas o anexión de bloques; en caso contrario, puede dañar blob cifrado de Hola y que no sea legible.</span><span class="sxs-lookup"><span data-stu-id="c94a7-214">Avoid writing tooan encrypted blob using protocol operations such as Put Block, Put Block List, Write Pages, Clear Pages, or Append Block; otherwise you may corrupt hello encrypted blob and make it unreadable.</span></span>
> * <span data-ttu-id="c94a7-215">Para las tablas, existe una restricción similar.</span><span class="sxs-lookup"><span data-stu-id="c94a7-215">For tables, a similar constraint exists.</span></span> <span data-ttu-id="c94a7-216">Ser toonot cuidado actualización cifrado propiedades sin actualizar los metadatos de cifrado de Hola.</span><span class="sxs-lookup"><span data-stu-id="c94a7-216">Be careful toonot update encrypted properties without updating hello encryption metadata.</span></span>  
> * <span data-ttu-id="c94a7-217">Si establece metadatos en blob cifrado de hello, pueden sobrescribir metadatos relacionados con el cifrado de hello necesarios para el descifrado, puesto que no se suma al establecer metadatos.</span><span class="sxs-lookup"><span data-stu-id="c94a7-217">If you set metadata on hello encrypted blob, you may overwrite hello encryption-related metadata required for decryption, since setting metadata is not additive.</span></span> <span data-ttu-id="c94a7-218">Esto también se aplica a las instantáneas: evite la especificación de metadatos durante la creación de una instantánea de un blob cifrado.</span><span class="sxs-lookup"><span data-stu-id="c94a7-218">This is also true for snapshots; avoid specifying metadata while creating a snapshot of an encrypted blob.</span></span> <span data-ttu-id="c94a7-219">Si se deben establecer los metadatos, que seguro hello toocall **downloadAttributes** tooget primer método Hola metadatos de cifrado actual y evitar operaciones de escritura simultáneas metadatos mientras está habilitada.</span><span class="sxs-lookup"><span data-stu-id="c94a7-219">If metadata must be set, be sure toocall hello **downloadAttributes** method first tooget hello current encryption metadata, and avoid concurrent writes while metadata is being set.</span></span>  
> * <span data-ttu-id="c94a7-220">Habilitar hello **requireEncryption** marca en Opciones de solicitud de hello predeterminadas para los usuarios que deben trabajar solo con los datos cifrados.</span><span class="sxs-lookup"><span data-stu-id="c94a7-220">Enable hello **requireEncryption** flag in hello default request options for users that should work only with encrypted data.</span></span> <span data-ttu-id="c94a7-221">Vea a continuación para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="c94a7-221">See below for more info.</span></span>  
> 
> 

## <a name="client-api--interface"></a><span data-ttu-id="c94a7-222">Interfaz/API de cliente</span><span class="sxs-lookup"><span data-stu-id="c94a7-222">Client API / Interface</span></span>
<span data-ttu-id="c94a7-223">Al crear un objeto de EncryptionPolicy, los usuarios pueden proporcionar solo una clave (implementación de IKey), solo una resolución (implementación de IKeyResolver) o ambas.</span><span class="sxs-lookup"><span data-stu-id="c94a7-223">While creating an EncryptionPolicy object, users can provide only a Key (implementing IKey), only a resolver (implementing IKeyResolver), or both.</span></span> <span data-ttu-id="c94a7-224">IKey es hello básico tipo de clave que se identifica mediante un identificador de clave y que proporciona la lógica de Hola para ajuste/desencapsulación.</span><span class="sxs-lookup"><span data-stu-id="c94a7-224">IKey is hello basic key type that is identified using a key identifier and that provides hello logic for wrapping/unwrapping.</span></span> <span data-ttu-id="c94a7-225">IKeyResolver es tooresolve usa una clave durante el proceso de descifrado de Hola.</span><span class="sxs-lookup"><span data-stu-id="c94a7-225">IKeyResolver is used tooresolve a key during hello decryption process.</span></span> <span data-ttu-id="c94a7-226">Define un método ResolveKey que devuelve un IKey concreto (identificador de clave).</span><span class="sxs-lookup"><span data-stu-id="c94a7-226">It defines a ResolveKey method that returns an IKey given a key identifier.</span></span> <span data-ttu-id="c94a7-227">Esto proporciona a los usuarios Hola capacidad toochoose entre varias claves que se administran en varias ubicaciones.</span><span class="sxs-lookup"><span data-stu-id="c94a7-227">This provides users hello ability toochoose between multiple keys that are managed in multiple locations.</span></span>

* <span data-ttu-id="c94a7-228">Para el cifrado, se utiliza siempre la clave de Hola y ausencia de Hola de una clave se producirá un error.</span><span class="sxs-lookup"><span data-stu-id="c94a7-228">For encryption, hello key is used always and hello absence of a key will result in an error.</span></span>  
* <span data-ttu-id="c94a7-229">Para el descifrado:</span><span class="sxs-lookup"><span data-stu-id="c94a7-229">For decryption:</span></span>  
  
  * <span data-ttu-id="c94a7-230">resolución de clave de Hola se invoca si se especifica la clave de hello tooget.</span><span class="sxs-lookup"><span data-stu-id="c94a7-230">hello key resolver is invoked if specified tooget hello key.</span></span> <span data-ttu-id="c94a7-231">Si la resolución de Hola se especifica, pero no tiene una asignación para el identificador de clave de hello, se produce un error.</span><span class="sxs-lookup"><span data-stu-id="c94a7-231">If hello resolver is specified but does not have a mapping for hello key identifier, an error is thrown.</span></span>  
  * <span data-ttu-id="c94a7-232">Si no se especifica la resolución, pero se especifica una clave, clave de Hola se usa si su identificador coincide con el identificador de clave de hello necesario.</span><span class="sxs-lookup"><span data-stu-id="c94a7-232">If resolver is not specified but a key is specified, hello key is used if its identifier matches hello required key identifier.</span></span> <span data-ttu-id="c94a7-233">Si no coincide con el identificador de hello, se produce un error.</span><span class="sxs-lookup"><span data-stu-id="c94a7-233">If hello identifier does not match, an error is thrown.</span></span>  
    
    <span data-ttu-id="c94a7-234">Hola [ejemplos de cifrado](https://github.com/Azure/azure-storage-net/tree/master/Samples/GettingStarted/EncryptionSamples) <fix URL>muestra un escenario de extremo a extremo más detallado para blobs, colas y tablas, junto con la integración del almacén de claves.</span><span class="sxs-lookup"><span data-stu-id="c94a7-234">hello [encryption samples](https://github.com/Azure/azure-storage-net/tree/master/Samples/GettingStarted/EncryptionSamples) <fix URL>demonstrate a more detailed end-to-end scenario for blobs, queues and tables, along with Key Vault integration.</span></span>

### <a name="requireencryption-mode"></a><span data-ttu-id="c94a7-235">Modo RequireEncryption</span><span class="sxs-lookup"><span data-stu-id="c94a7-235">RequireEncryption mode</span></span>
<span data-ttu-id="c94a7-236">Los usuarios pueden habilitar opcionalmente un modo de operación en el que se deben cifrar todas las cargas y descargas.</span><span class="sxs-lookup"><span data-stu-id="c94a7-236">Users can optionally enable a mode of operation where all uploads and downloads must be encrypted.</span></span> <span data-ttu-id="c94a7-237">En este modo, se producirá un error de los intentos de tooupload datos sin un cifrado directiva o descarga los datos que no se cifran en el servicio de hello en cliente hello.</span><span class="sxs-lookup"><span data-stu-id="c94a7-237">In this mode, attempts tooupload data without an encryption policy or download data that is not encrypted on hello service will fail on hello client.</span></span> <span data-ttu-id="c94a7-238">Hola **requireEncryption** indicador de objeto de opciones de solicitud de hello controla este comportamiento.</span><span class="sxs-lookup"><span data-stu-id="c94a7-238">hello **requireEncryption** flag of hello request options object controls this behavior.</span></span> <span data-ttu-id="c94a7-239">Si la aplicación, se cifrarán todos los objetos almacenados en el almacenamiento de Azure, puede establecer hello **requireEncryption** propiedad opciones de solicitud de hello predeterminadas para el objeto de cliente de servicio de Hola.</span><span class="sxs-lookup"><span data-stu-id="c94a7-239">If your application will encrypt all objects stored in Azure Storage, then you can set hello **requireEncryption** property on hello default request options for hello service client object.</span></span>   

<span data-ttu-id="c94a7-240">Por ejemplo, utilice **CloudBlobClient.getDefaultRequestOptions().setRequireEncryption(true)** toorequire el cifrado para todas las operaciones de blob que se realiza a través de ese objeto de cliente.</span><span class="sxs-lookup"><span data-stu-id="c94a7-240">For example, use **CloudBlobClient.getDefaultRequestOptions().setRequireEncryption(true)** toorequire encryption for all blob operations performed through that client object.</span></span>

### <a name="blob-service-encryption"></a><span data-ttu-id="c94a7-241">Cifrado del servicio de blobs</span><span class="sxs-lookup"><span data-stu-id="c94a7-241">Blob service encryption</span></span>
<span data-ttu-id="c94a7-242">Crear un **BlobEncryptionPolicy** de objeto y establecer en Opciones de solicitud de hello (por API o en un nivel de cliente mediante el uso de **DefaultRequestOptions**).</span><span class="sxs-lookup"><span data-stu-id="c94a7-242">Create a **BlobEncryptionPolicy** object and set it in hello request options (per API or at a client level by using **DefaultRequestOptions**).</span></span> <span data-ttu-id="c94a7-243">Todo lo demás se controlarán mediante la biblioteca de cliente de hello internamente.</span><span class="sxs-lookup"><span data-stu-id="c94a7-243">Everything else will be handled by hello client library internally.</span></span>

```java
// Create hello IKey used for encryption.
RsaKey key = new RsaKey("private:key1" /* key identifier */);

// Create hello encryption policy toobe used for upload and download.
BlobEncryptionPolicy policy = new BlobEncryptionPolicy(key, null);

// Set hello encryption policy on hello request options.
BlobRequestOptions options = new BlobRequestOptions();
options.setEncryptionPolicy(policy);

// Upload hello encrypted contents toohello blob.
blob.upload(stream, size, null, options, null);

// Download and decrypt hello encrypted contents from hello blob.
ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
blob.download(outputStream, null, options, null);
```

### <a name="queue-service-encryption"></a><span data-ttu-id="c94a7-244">Cifrado del servicio Cola</span><span class="sxs-lookup"><span data-stu-id="c94a7-244">Queue service encryption</span></span>
<span data-ttu-id="c94a7-245">Crear un **QueueEncryptionPolicy** de objeto y establecer en Opciones de solicitud de hello (por API o en un nivel de cliente mediante el uso de **DefaultRequestOptions**).</span><span class="sxs-lookup"><span data-stu-id="c94a7-245">Create a **QueueEncryptionPolicy** object and set it in hello request options (per API or at a client level by using **DefaultRequestOptions**).</span></span> <span data-ttu-id="c94a7-246">Todo lo demás se controlarán mediante la biblioteca de cliente de hello internamente.</span><span class="sxs-lookup"><span data-stu-id="c94a7-246">Everything else will be handled by hello client library internally.</span></span>

```java
// Create hello IKey used for encryption.
RsaKey key = new RsaKey("private:key1" /* key identifier */);

// Create hello encryption policy toobe used for upload and download.
QueueEncryptionPolicy policy = new QueueEncryptionPolicy(key, null);

// Add message
QueueRequestOptions options = new QueueRequestOptions();
options.setEncryptionPolicy(policy);

queue.addMessage(message, 0, 0, options, null);

// Retrieve message
CloudQueueMessage retrMessage = queue.retrieveMessage(30, options, null);
```

### <a name="table-service-encryption"></a><span data-ttu-id="c94a7-247">Cifrado del servicio Tabla</span><span class="sxs-lookup"><span data-stu-id="c94a7-247">Table service encryption</span></span>
<span data-ttu-id="c94a7-248">Además toocreating una directiva de cifrado y la configuración de opciones de solicitud, se debe especificar un **EncryptionResolver** en **TableRequestOptions**, o establezca el atributo en Hola Hola [Encrypt] captador y establecedor de la entidad.</span><span class="sxs-lookup"><span data-stu-id="c94a7-248">In addition toocreating an encryption policy and setting it on request options, you must either specify an **EncryptionResolver** in **TableRequestOptions**, or set hello [Encrypt] attribute on hello entity's getter and setter.</span></span>

### <a name="using-hello-resolver"></a><span data-ttu-id="c94a7-249">Utilizar al Solucionador de Hola</span><span class="sxs-lookup"><span data-stu-id="c94a7-249">Using hello resolver</span></span>

```java
// Create hello IKey used for encryption.
RsaKey key = new RsaKey("private:key1" /* key identifier */);

// Create hello encryption policy toobe used for upload and download.
TableEncryptionPolicy policy = new TableEncryptionPolicy(key, null);

TableRequestOptions options = new TableRequestOptions()
options.setEncryptionPolicy(policy);
options.setEncryptionResolver(new EncryptionResolver() {
    public boolean encryptionResolver(String pk, String rk, String key) {
        if (key == "foo")
        {
            return true;
        }
        return false;
    }
});

// Insert Entity
currentTable.execute(TableOperation.insert(ent), options, null);

// Retrieve Entity
// No need toospecify an encryption resolver for retrieve
TableRequestOptions retrieveOptions = new TableRequestOptions()
retrieveOptions.setEncryptionPolicy(policy);

TableOperation operation = TableOperation.retrieve(ent.PartitionKey, ent.RowKey, DynamicTableEntity.class);
TableResult result = currentTable.execute(operation, retrieveOptions, null);
```

### <a name="using-attributes"></a><span data-ttu-id="c94a7-250">Uso de los atributos</span><span class="sxs-lookup"><span data-stu-id="c94a7-250">Using attributes</span></span>
<span data-ttu-id="c94a7-251">Como se mencionó anteriormente, si la entidad de hello implementa TableEntity, a continuación, Hola captador de propiedades y el establecedor se puede decorar con atributos de hello [Encrypt] en lugar de especificar hello **EncryptionResolver**.</span><span class="sxs-lookup"><span data-stu-id="c94a7-251">As mentioned above, if hello entity implements TableEntity, then hello properties getter and setter can be decorated with hello [Encrypt] attribute instead of specifying hello **EncryptionResolver**.</span></span>

```java
private string encryptedProperty1;

@Encrypt
public String getEncryptedProperty1 () {
    return this.encryptedProperty1;
}

@Encrypt
public void setEncryptedProperty1(final String encryptedProperty1) {
    this.encryptedProperty1 = encryptedProperty1;
}
```

## <a name="encryption-and-performance"></a><span data-ttu-id="c94a7-252">Cifrado y rendimiento</span><span class="sxs-lookup"><span data-stu-id="c94a7-252">Encryption and performance</span></span>
<span data-ttu-id="c94a7-253">Tenga en cuenta que el cifrado de sus resultados de datos de almacenamiento da lugar a la sobrecarga de rendimiento adicional.</span><span class="sxs-lookup"><span data-stu-id="c94a7-253">Note that encrypting your storage data results in additional performance overhead.</span></span> <span data-ttu-id="c94a7-254">Hola contenido deben generarse clave y un IV, se debe cifrar el propio contenido hello y metadatos adicionales deben con formato y cargarse.</span><span class="sxs-lookup"><span data-stu-id="c94a7-254">hello content key and IV must be generated, hello content itself must be encrypted, and additional meta-data must be formatted and uploaded.</span></span> <span data-ttu-id="c94a7-255">Esta sobrecarga variará según la cantidad de Hola de datos está cifrados.</span><span class="sxs-lookup"><span data-stu-id="c94a7-255">This overhead will vary depending on hello quantity of data being encrypted.</span></span> <span data-ttu-id="c94a7-256">Se recomienda que los clientes prueben siempre sus aplicaciones para obtener un rendimiento durante el desarrollo.</span><span class="sxs-lookup"><span data-stu-id="c94a7-256">We recommend that customers always test their applications for performance during development.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c94a7-257">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="c94a7-257">Next steps</span></span>
* <span data-ttu-id="c94a7-258">Descargar hello [biblioteca de cliente de almacenamiento de Azure para el paquete de Maven de Java](http://mvnrepository.com/artifact/com.microsoft.azure/azure-storage)</span><span class="sxs-lookup"><span data-stu-id="c94a7-258">Download hello [Azure Storage Client Library for Java Maven package](http://mvnrepository.com/artifact/com.microsoft.azure/azure-storage)</span></span>  
* <span data-ttu-id="c94a7-259">Descargar hello [biblioteca de cliente de almacenamiento de Azure para el código fuente Java desde GitHub](https://github.com/Azure/azure-storage-java)</span><span class="sxs-lookup"><span data-stu-id="c94a7-259">Download hello [Azure Storage Client Library for Java Source Code from GitHub](https://github.com/Azure/azure-storage-java)</span></span>   
* <span data-ttu-id="c94a7-260">Descargar hello Azure clave de almacén de Maven Library para paquetes de Maven de Java:</span><span class="sxs-lookup"><span data-stu-id="c94a7-260">Download hello Azure Key Vault Maven Library for Java Maven packages:</span></span>
  * <span data-ttu-id="c94a7-261">[principal](http://mvnrepository.com/artifact/com.microsoft.azure/azure-keyvault-core)</span><span class="sxs-lookup"><span data-stu-id="c94a7-261">[Core](http://mvnrepository.com/artifact/com.microsoft.azure/azure-keyvault-core) package</span></span>
  * <span data-ttu-id="c94a7-262">[cliente](http://mvnrepository.com/artifact/com.microsoft.azure/azure-keyvault)</span><span class="sxs-lookup"><span data-stu-id="c94a7-262">[Client](http://mvnrepository.com/artifact/com.microsoft.azure/azure-keyvault) package</span></span>
* <span data-ttu-id="c94a7-263">Visite hello [documentación del almacén de claves de Azure](../key-vault/key-vault-whatis.md)</span><span class="sxs-lookup"><span data-stu-id="c94a7-263">Visit hello [Azure Key Vault Documentation](../key-vault/key-vault-whatis.md)</span></span>

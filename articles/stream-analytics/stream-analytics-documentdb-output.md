---
title: Salida de JSON para Stream Analytics | Microsoft Docs
description: "Obtenga información sobre cómo Stream Analytics puede tener como destino Azure Cosmos DB para la salida de JSON, para el archivado de datos y las consultas de latencia baja en datos de JSON no estructurados."
keywords: Salida de JSON
documentationcenter: 
services: stream-analytics,documentdb
author: samacha
manager: jhubbard
editor: cgronlun
ms.assetid: 5d2a61a6-0dbf-4f1b-80af-60a80eb25dd1
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: samacha
ms.openlocfilehash: cc80b0080c806541362a1ef2d71b95862bd51ca2
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/29/2017
---
# <a name="target-azure-cosmos-db-for-json-output-from-stream-analytics"></a><span data-ttu-id="546f2-104">Tener como destino Azure Cosmos DB para la salida de JSON de Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="546f2-104">Target Azure Cosmos DB for JSON output from Stream Analytics</span></span>
<span data-ttu-id="546f2-105">Stream Analytics puede tener como destino [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) para la salida de JSON, habilitando el archivado de datos y las consultas de latencia baja en datos de JSON no estructurados.</span><span class="sxs-lookup"><span data-stu-id="546f2-105">Stream Analytics can target [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) for JSON output, enabling data archiving and low-latency queries on unstructured JSON data.</span></span> <span data-ttu-id="546f2-106">En este documento tratan algunas prácticas recomendadas para implementar esta configuración.</span><span class="sxs-lookup"><span data-stu-id="546f2-106">This document covers some best practices for implementing this configuration.</span></span>

<span data-ttu-id="546f2-107">Aquellos que no estén familiarizados con Cosmos DB pueden comenzar por la [ruta de aprendizaje de Azure Cosmos DB](https://azure.microsoft.com/documentation/learning-paths/documentdb/).</span><span class="sxs-lookup"><span data-stu-id="546f2-107">For those who are unfamiliar with Cosmos DB, take a look at [Azure Cosmos DB’s learning path](https://azure.microsoft.com/documentation/learning-paths/documentdb/) to get started.</span></span> 

<span data-ttu-id="546f2-108">Nota: las colecciones de Cosmos DB basadas en Mongo DB API no se admiten actualmente.</span><span class="sxs-lookup"><span data-stu-id="546f2-108">Note: Mongo DB API based Cosmos DB collections is currently not supported.</span></span> 

## <a name="basics-of-cosmos-db-as-an-output-target"></a><span data-ttu-id="546f2-109">Aspectos básicos de Cosmos DB como destino de salida</span><span class="sxs-lookup"><span data-stu-id="546f2-109">Basics of Cosmos DB as an output target</span></span>
<span data-ttu-id="546f2-110">La salida de Azure Cosmos DB de Stream Analytics de permite escribir los resultados del procesamiento de secuencias como salida de JSON en sus colecciones de Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="546f2-110">The Azure Cosmos DB output in Stream Analytics enables writing your stream processing results as JSON output into your Cosmos DB collection(s).</span></span> <span data-ttu-id="546f2-111">Análisis de transmisiones no crea colecciones en la base de datos, ya no requiere que las cree por adelantado.</span><span class="sxs-lookup"><span data-stu-id="546f2-111">Stream Analytics does not create collections in your database, instead requiring you to create them upfront.</span></span> <span data-ttu-id="546f2-112">Esto es para que los costes de facturación de las colecciones de Cosmos DB sean transparentes para usted y para que pueda optimizar el rendimiento, la coherencia y la capacidad de las colecciones directamente mediante las [API de Cosmos DB](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span><span class="sxs-lookup"><span data-stu-id="546f2-112">This is so that the billing costs of Cosmos DB collections are transparent to you, and so that you can tune the performance, consistency and capacity of your collections directly using the [Cosmos DB APIs](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span></span> <span data-ttu-id="546f2-113">Se recomienda utilizar una base de datos de Cosmos DB por trabajo de streaming para separar lógicamente las colecciones de un trabajo de streaming.</span><span class="sxs-lookup"><span data-stu-id="546f2-113">We recommend using one Cosmos DB Database per streaming job to logically separate your collections for a streaming job.</span></span>

<span data-ttu-id="546f2-114">A continuación se detallan algunas de las opciones de la colección de Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="546f2-114">Some of the Cosmos DB collection options are detailed below.</span></span>

## <a name="tune-consistency-availability-and-latency"></a><span data-ttu-id="546f2-115">Ajustar la coherencia, la disponibilidad y la latencia</span><span class="sxs-lookup"><span data-stu-id="546f2-115">Tune consistency, availability, and latency</span></span>
<span data-ttu-id="546f2-116">Para satisfacer las necesidades de su aplicación, Cosmos DB permite optimizar la base de datos y las colecciones y buscar el equilibrio entre coherencia, disponibilidad y latencia.</span><span class="sxs-lookup"><span data-stu-id="546f2-116">To match your application requirements, Cosmos DB allows you to fine tune the database and collections and make trade-offs between consistency, availability and latency.</span></span> <span data-ttu-id="546f2-117">En función de los niveles de coherencia de lectura que requiera su situación en comparación con la latencia de lectura y escritura, puede elegir un nivel de coherencia u otro en la cuenta de base de datos.</span><span class="sxs-lookup"><span data-stu-id="546f2-117">Depending on what levels of read consistency your scenario needs against read and write latency, you can choose a consistency level on your database account.</span></span> <span data-ttu-id="546f2-118">También de forma predeterminada, Cosmos DB permite la indexación sincrónica en cada operación CRUD de la colección.</span><span class="sxs-lookup"><span data-stu-id="546f2-118">Also by default, Cosmos DB enables synchronous indexing on each CRUD operation to your collection.</span></span> <span data-ttu-id="546f2-119">Esta es otra opción útil para controlar el rendimiento de escritura o lectura en Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="546f2-119">This is another useful option to control the write/read performance in Cosmos DB.</span></span> <span data-ttu-id="546f2-120">Para obtener más información sobre este tema, revise el artículo [Cambio de los niveles de coherencia de la base de datos y las consultas](../documentdb/documentdb-consistency-levels.md) .</span><span class="sxs-lookup"><span data-stu-id="546f2-120">For further information on this topic, review the [change your database and query consistency levels](../documentdb/documentdb-consistency-levels.md) article.</span></span>

## <a name="upserts-from-stream-analytics"></a><span data-ttu-id="546f2-121">Upserts de Análisis de transmisiones</span><span class="sxs-lookup"><span data-stu-id="546f2-121">Upserts from Stream Analytics</span></span>
<span data-ttu-id="546f2-122">La integración de Stream Analytics con Cosmos DB permite insertar o actualizar registros en su colección de Cosmos DB en función de una columna de identificador de documento determinada.</span><span class="sxs-lookup"><span data-stu-id="546f2-122">Stream Analytics integration with Cosmos DB allows you to insert or update records in your Cosmos DB collection based on a given Document ID column.</span></span> <span data-ttu-id="546f2-123">Esto se conoce también como *Upsert*.</span><span class="sxs-lookup"><span data-stu-id="546f2-123">This is also referred to as an *Upsert*.</span></span>

<span data-ttu-id="546f2-124">El Análisis de transmisiones utiliza un enfoque Upsert optimista, donde las actualizaciones solo se realizan cuando se produce un error en la inserción debido a un conflicto de identificador de documento.</span><span class="sxs-lookup"><span data-stu-id="546f2-124">Stream Analytics utilizes an optimistic Upsert approach, where updates are only done when insert fails due to a Document ID conflict.</span></span> <span data-ttu-id="546f2-125">Esta actualización se realiza por el Análisis de transmisiones como una operación PATCH, por lo que permite actualizaciones parciales en el documento; es decir, la adición de nuevas propiedades o la sustitución de una propiedad existente se realiza de forma incremental.</span><span class="sxs-lookup"><span data-stu-id="546f2-125">This update is performed by Stream Analytics as a PATCH, so it enables partial updates to the document, i.e. addition of new properties or replacing an existing property is performed incrementally.</span></span> <span data-ttu-id="546f2-126">Tenga en cuenta que los cambios en los valores de las propiedades de la matriz en el resultado del documento JSON de toda la matriz se sobrescriben; es decir, la matriz no se combina.</span><span class="sxs-lookup"><span data-stu-id="546f2-126">Note that changes in the values of array properties in your JSON document result in the entire array getting overwritten, i.e. the array is not merged.</span></span>

## <a name="data-partitioning-in-cosmos-db"></a><span data-ttu-id="546f2-127">Creación de particiones de datos en Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="546f2-127">Data partitioning in Cosmos DB</span></span>
<span data-ttu-id="546f2-128">Ahora se admiten las [colecciones de documentos con particiones](../cosmos-db/partition-data.md) de Cosmos DB y es el enfoque recomendado para crear particiones de los datos.</span><span class="sxs-lookup"><span data-stu-id="546f2-128">Cosmos DB [partitioned collections](../cosmos-db/partition-data.md) are the recommended approach for partitioning your data.</span></span> 

<span data-ttu-id="546f2-129">Para las colecciones únicas de Cosmos DB, Stream Analytics permite particionar los datos según los patrones de consulta y los requisitos de rendimiento de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="546f2-129">For single Cosmos DB collections, Stream Analytics still allows you to partition your data based on both the query patterns and performance needs of your application.</span></span> <span data-ttu-id="546f2-130">Cada colección puede contener hasta 10 GB de datos (máximo) y actualmente no hay ninguna manera de escalar verticalmente (o desbordar) una colección.</span><span class="sxs-lookup"><span data-stu-id="546f2-130">Each collection may contain up to 10GB of data (maximum) and currently there is no way to scale up (or overflow) a collection.</span></span> <span data-ttu-id="546f2-131">Para escalar horizontalmente, Análisis de transmisiones permite escribir a varias colecciones con un prefijo determinado (consulte los detalles de uso a continuación).</span><span class="sxs-lookup"><span data-stu-id="546f2-131">For scaling out, Stream Analytics allows you to write to multiple collections with a given prefix (see usage details below).</span></span> <span data-ttu-id="546f2-132">Análisis de transmisiones utiliza la estrategia coherente de [resolución de la partición de hash](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) basada en la columna PartitionKey ofrecida por el usuario para crear particiones en sus registros de salida.</span><span class="sxs-lookup"><span data-stu-id="546f2-132">Stream Analytics uses the consistent [Hash Partition Resolver](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) strategy based on the user provided PartitionKey column to partition its output records.</span></span> <span data-ttu-id="546f2-133">El número de colecciones con el prefijo especificado en el inicio del trabajo de streaming se utiliza como el recuento de las particiones de salida en las que el trabajo escribe en paralelo (colecciones de Cosmos DB = particiones de salida).</span><span class="sxs-lookup"><span data-stu-id="546f2-133">The number of collections with the given prefix at the streaming job’s start time is used as the output partition count, to which the job writes to in parallel (Cosmos DB Collections = Output Partitions).</span></span> <span data-ttu-id="546f2-134">En el caso de una sola colección con una indexación diferida que realiza solo operaciones de inserción, se puede esperar en torno a 0,4 MB/s de rendimiento de escritura.</span><span class="sxs-lookup"><span data-stu-id="546f2-134">For a single collection with lazy indexing doing only inserts, about 0.4 MB/s write throughput can be expected.</span></span> <span data-ttu-id="546f2-135">El uso de varias colecciones puede permitirle lograr mayor rendimiento y capacidad.</span><span class="sxs-lookup"><span data-stu-id="546f2-135">Using multiple collections can allow you to achieve higher throughput and increased capacity.</span></span>

<span data-ttu-id="546f2-136">Si desea aumentar el número de particiones en el futuro, puede que necesite detener su trabajo, volver a crear particiones de los datos de las colecciones existentes para crear nuevas colecciones y, a continuación, reiniciar el trabajo de Análisis de transmisiones.</span><span class="sxs-lookup"><span data-stu-id="546f2-136">If you intend to increase the partition count in the future, you may need to stop your job, repartition the data from your existing collections into new collections and then restart the Stream Analytics job.</span></span> <span data-ttu-id="546f2-137">Se incluirá más información sobre el uso de PartitionResolver y la nueva creación de particiones junto con código de ejemplo en una publicación posterior.</span><span class="sxs-lookup"><span data-stu-id="546f2-137">More details on using PartitionResolver and re-partitioning along with sample code, will be included in a follow-up post.</span></span> <span data-ttu-id="546f2-138">En el artículo [Partición y escalado en Cosmos DB](../documentdb/documentdb-partition-data.md), también se ofrecen detalles sobre esto.</span><span class="sxs-lookup"><span data-stu-id="546f2-138">The article [Partitioning and scaling in Cosmos DB](../documentdb/documentdb-partition-data.md) also provides details on this.</span></span>

## <a name="cosmos-db-settings-for-json-output"></a><span data-ttu-id="546f2-139">Configuración de Cosmos DB para salida de JSON</span><span class="sxs-lookup"><span data-stu-id="546f2-139">Cosmos DB settings for JSON output</span></span>
<span data-ttu-id="546f2-140">La creación de Cosmos DB como una salida en Stream Analytics genera una solicitud de información, tal como se muestra a continuación.</span><span class="sxs-lookup"><span data-stu-id="546f2-140">Creating Cosmos DB as an output in Stream Analytics generates a prompt for information as seen below.</span></span> <span data-ttu-id="546f2-141">En esta sección se proporciona una explicación de la definición de propiedades.</span><span class="sxs-lookup"><span data-stu-id="546f2-141">This section provides an explanation of the properties definition.</span></span>

<span data-ttu-id="546f2-142">Colección particionada</span><span class="sxs-lookup"><span data-stu-id="546f2-142">Partitioned Collection</span></span> | <span data-ttu-id="546f2-143">Varias colecciones de partición única</span><span class="sxs-lookup"><span data-stu-id="546f2-143">Multiple “Single Partition” collections</span></span>
---|---
![pantalla de salida de análisis de transmisiones de documentdb](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-1.png) |  ![pantalla de salida de análisis de transmisiones de documentdb](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-2.png)


  
> [!NOTE]
> <span data-ttu-id="546f2-146">El escenario **Varias colecciones de partición única** requiere una clave de partición y es una configuración compatible.</span><span class="sxs-lookup"><span data-stu-id="546f2-146">The **Multiple “Single Partition” collections** scenario requires a partition key and is a supported configuration.</span></span> 

* <span data-ttu-id="546f2-147">**Alias de salida** : un alias para hacer referencia a esta salida en la consulta ASA.</span><span class="sxs-lookup"><span data-stu-id="546f2-147">**Output Alias** – An alias to refer this output in your ASA query</span></span>  
* <span data-ttu-id="546f2-148">**Nombre de cuenta**: el nombre o el identificador URI del punto de conexión de la cuenta de Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="546f2-148">**Account Name** – The name or endpoint URI of the Cosmos DB account.</span></span>  
* <span data-ttu-id="546f2-149">**Clave de cuenta**: la clave de acceso compartido para la cuenta de Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="546f2-149">**Account Key** – The shared access key for the Cosmos DB account.</span></span>  
* <span data-ttu-id="546f2-150">**Base de datos**: nombre de la base de datos de Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="546f2-150">**Database** – The Cosmos DB database name.</span></span>  
* <span data-ttu-id="546f2-151">**Patrón de nombre de colección**: el patrón de nombre de colección para las colecciones que se usarán.</span><span class="sxs-lookup"><span data-stu-id="546f2-151">**Collection Name Pattern** – The collection name or their pattern for the collections to be used.</span></span> <span data-ttu-id="546f2-152">El formato de nombre de la colección se pueden construir con el token opcional {partition}, donde las particiones comienzan desde 0.</span><span class="sxs-lookup"><span data-stu-id="546f2-152">The collection name format can be constructed using the optional {partition} token, where partitions start from 0.</span></span> <span data-ttu-id="546f2-153">Las siguientes entradas de ejemplo son válidas:</span><span class="sxs-lookup"><span data-stu-id="546f2-153">Following are sample valid inputs:</span></span>  
  <span data-ttu-id="546f2-154">1\) MyCollection: debe existir una colección denominada "MyCollection".</span><span class="sxs-lookup"><span data-stu-id="546f2-154">1\) MyCollection – One collection named “MyCollection” must exist.</span></span>  
  <span data-ttu-id="546f2-155">2\) MyCollection{partición}: deben existir esas colecciones: "MyCollection0", "MyCollection1", "MyCollection2", etc.</span><span class="sxs-lookup"><span data-stu-id="546f2-155">2\) MyCollection{partition} – Such collections must exist– "MyCollection0”, “MyCollection1”, “MyCollection2” and so on.</span></span>  
* <span data-ttu-id="546f2-156">**Clave de partición**: opcional.</span><span class="sxs-lookup"><span data-stu-id="546f2-156">**Partition Key** – Optional.</span></span> <span data-ttu-id="546f2-157">Solo es necesario si usa un token {partition} en el patrón de nombre de la colección.</span><span class="sxs-lookup"><span data-stu-id="546f2-157">This is only needed if you are using a {parition} token in your collection name pattern.</span></span> <span data-ttu-id="546f2-158">Nombre del campo en los eventos de salida que se utiliza para especificar la clave de partición de salida entre colecciones.</span><span class="sxs-lookup"><span data-stu-id="546f2-158">The name of the field in output events used to specify the key for partitioning output across collections.</span></span> <span data-ttu-id="546f2-159">Para una salida de colección sencilla, se puede utilizar cualquier columna de salida arbitraria (por ejemplo, PartitionId).</span><span class="sxs-lookup"><span data-stu-id="546f2-159">For single collection output, any arbitrary output column can be used e.g. PartitionId.</span></span>  
* <span data-ttu-id="546f2-160">**Identificador de documento** : opcional.</span><span class="sxs-lookup"><span data-stu-id="546f2-160">**Document ID** – Optional.</span></span> <span data-ttu-id="546f2-161">Nombre del campo de los eventos de salida utilizado para especificar la clave principal en la que se basan las operaciones de inserción o actualización.</span><span class="sxs-lookup"><span data-stu-id="546f2-161">The name of the field in output events used to specify the primary key on which insert or update operations are based.</span></span>  

---
title: "salida de aaaJSON para análisis de transmisiones | Documentos de Microsoft"
description: "Obtenga información sobre cómo Stream Analytics puede tener como destino Azure Cosmos DB para la salida de JSON, para el archivado de datos y las consultas de latencia baja en datos de JSON no estructurados."
keywords: Salida de JSON
documentationcenter: 
services: stream-analytics,documentdb
author: samacha
manager: jhubbard
editor: cgronlun
ms.assetid: 5d2a61a6-0dbf-4f1b-80af-60a80eb25dd1
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: samacha
ms.openlocfilehash: fa717818c839ecd7a60fcee33d22011990fd5878
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/06/2017
---
# <a name="target-azure-cosmos-db-for-json-output-from-stream-analytics"></a><span data-ttu-id="2976f-104">Tener como destino Azure Cosmos DB para la salida de JSON de Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="2976f-104">Target Azure Cosmos DB for JSON output from Stream Analytics</span></span>
<span data-ttu-id="2976f-105">Stream Analytics puede tener como destino [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) para la salida de JSON, habilitando el archivado de datos y las consultas de latencia baja en datos de JSON no estructurados.</span><span class="sxs-lookup"><span data-stu-id="2976f-105">Stream Analytics can target [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) for JSON output, enabling data archiving and low-latency queries on unstructured JSON data.</span></span> <span data-ttu-id="2976f-106">En este documento tratan algunas prácticas recomendadas para implementar esta configuración.</span><span class="sxs-lookup"><span data-stu-id="2976f-106">This document covers some best practices for implementing this configuration.</span></span>

<span data-ttu-id="2976f-107">Para aquellos que no estén familiarizados con la base de datos de Cosmos, eche un vistazo a [ruta de acceso de aprendizaje de Azure Cosmos DB](https://azure.microsoft.com/documentation/learning-paths/documentdb/) tooget iniciado.</span><span class="sxs-lookup"><span data-stu-id="2976f-107">For those who are unfamiliar with Cosmos DB, take a look at [Azure Cosmos DB’s learning path](https://azure.microsoft.com/documentation/learning-paths/documentdb/) tooget started.</span></span> 

<span data-ttu-id="2976f-108">Nota: las colecciones de Cosmos DB basadas en Mongo DB API no se admiten actualmente.</span><span class="sxs-lookup"><span data-stu-id="2976f-108">Note: Mongo DB API based Cosmos DB collections is currently not supported.</span></span> 

## <a name="basics-of-cosmos-db-as-an-output-target"></a><span data-ttu-id="2976f-109">Aspectos básicos de Cosmos DB como destino de salida</span><span class="sxs-lookup"><span data-stu-id="2976f-109">Basics of Cosmos DB as an output target</span></span>
<span data-ttu-id="2976f-110">Hola salida de la base de datos de Azure Cosmos en análisis de transmisiones permite escribir la secuencia de resultados se procesan como salida JSON en sus colecciones de base de datos de Cosmos.</span><span class="sxs-lookup"><span data-stu-id="2976f-110">hello Azure Cosmos DB output in Stream Analytics enables writing your stream processing results as JSON output into your Cosmos DB collection(s).</span></span> <span data-ttu-id="2976f-111">Análisis de transmisiones no crear colecciones en la base de datos en su lugar, lo que requiere toocreate ellos por adelantado.</span><span class="sxs-lookup"><span data-stu-id="2976f-111">Stream Analytics does not create collections in your database, instead requiring you toocreate them upfront.</span></span> <span data-ttu-id="2976f-112">Esto es para que los costes de facturación de Hola de colecciones de base de datos de Cosmos están tooyou transparente y, por lo que puede optimizar el rendimiento de hello, Hola coherencia y la capacidad de las colecciones directamente mediante [API de base de datos de Cosmos](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span><span class="sxs-lookup"><span data-stu-id="2976f-112">This is so that hello billing costs of Cosmos DB collections are transparent tooyou, and so that you can tune hello performance, consistency and capacity of your collections directly using hello [Cosmos DB APIs](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span></span> <span data-ttu-id="2976f-113">Se recomienda utilizar una base de datos de base de datos de Cosmos por streaming trabajo toologically independiente las colecciones para un trabajo de streaming.</span><span class="sxs-lookup"><span data-stu-id="2976f-113">We recommend using one Cosmos DB Database per streaming job toologically separate your collections for a streaming job.</span></span>

<span data-ttu-id="2976f-114">A continuación se detallan algunas de las opciones de recopilación de Cosmos DB Hola.</span><span class="sxs-lookup"><span data-stu-id="2976f-114">Some of hello Cosmos DB collection options are detailed below.</span></span>

## <a name="tune-consistency-availability-and-latency"></a><span data-ttu-id="2976f-115">Ajustar la coherencia, la disponibilidad y la latencia</span><span class="sxs-lookup"><span data-stu-id="2976f-115">Tune consistency, availability, and latency</span></span>
<span data-ttu-id="2976f-116">toomatch los requisitos de aplicación, base de datos de Cosmos permite base de datos de toofine ajustar hello y colecciones y asegúrese de ventajas y desventajas de coherencia, la disponibilidad y la latencia.</span><span class="sxs-lookup"><span data-stu-id="2976f-116">toomatch your application requirements, Cosmos DB allows you toofine tune hello database and collections and make trade-offs between consistency, availability and latency.</span></span> <span data-ttu-id="2976f-117">En función de los niveles de coherencia de lectura que requiera su situación en comparación con la latencia de lectura y escritura, puede elegir un nivel de coherencia u otro en la cuenta de base de datos.</span><span class="sxs-lookup"><span data-stu-id="2976f-117">Depending on what levels of read consistency your scenario needs against read and write latency, you can choose a consistency level on your database account.</span></span> <span data-ttu-id="2976f-118">También de forma predeterminada, Cosmos DB permite la indización sincrónico en cada colección de tooyour la operación CRUD.</span><span class="sxs-lookup"><span data-stu-id="2976f-118">Also by default, Cosmos DB enables synchronous indexing on each CRUD operation tooyour collection.</span></span> <span data-ttu-id="2976f-119">Se trata de Hola de toocontrol de otra opción útil rendimiento en la base de datos de Cosmos de lectura/escritura.</span><span class="sxs-lookup"><span data-stu-id="2976f-119">This is another useful option toocontrol hello write/read performance in Cosmos DB.</span></span> <span data-ttu-id="2976f-120">Para obtener más información acerca de este tema, revise hello [cambiar los niveles de coherencia de base de datos y consultas](../documentdb/documentdb-consistency-levels.md) artículo.</span><span class="sxs-lookup"><span data-stu-id="2976f-120">For further information on this topic, review hello [change your database and query consistency levels](../documentdb/documentdb-consistency-levels.md) article.</span></span>

## <a name="upserts-from-stream-analytics"></a><span data-ttu-id="2976f-121">Upserts de Análisis de transmisiones</span><span class="sxs-lookup"><span data-stu-id="2976f-121">Upserts from Stream Analytics</span></span>
<span data-ttu-id="2976f-122">Integración del análisis de transmisiones con DB Cosmos permite tooinsert o actualizar registros en la colección de base de datos de Cosmos tomando como base una columna de identificador de documento determinada.</span><span class="sxs-lookup"><span data-stu-id="2976f-122">Stream Analytics integration with Cosmos DB allows you tooinsert or update records in your Cosmos DB collection based on a given Document ID column.</span></span> <span data-ttu-id="2976f-123">Esto también es tooas que se hace referencia una *Upsert*.</span><span class="sxs-lookup"><span data-stu-id="2976f-123">This is also referred tooas an *Upsert*.</span></span>

<span data-ttu-id="2976f-124">Análisis de transmisiones usa un enfoque Upsert optimista, donde las actualizaciones solo se realizan cuando se produce un error en la inserción debido a conflictos de identificador de documento tooa.</span><span class="sxs-lookup"><span data-stu-id="2976f-124">Stream Analytics utilizes an optimistic Upsert approach, where updates are only done when insert fails due tooa Document ID conflict.</span></span> <span data-ttu-id="2976f-125">Esta actualización se realiza mediante el análisis de transmisiones como una revisión, por lo que hace que el documento de toohello actualizaciones parciales, es decir, la adición de nuevas propiedades o reemplazar que una propiedad existente se realiza de forma incremental.</span><span class="sxs-lookup"><span data-stu-id="2976f-125">This update is performed by Stream Analytics as a PATCH, so it enables partial updates toohello document, i.e. addition of new properties or replacing an existing property is performed incrementally.</span></span> <span data-ttu-id="2976f-126">Tenga en cuenta que debido a cambios en valores de hello de propiedades de la matriz en el documento JSON en obtener sobrescribe toda matriz de hello, es decir, no se combina la matriz de Hola.</span><span class="sxs-lookup"><span data-stu-id="2976f-126">Note that changes in hello values of array properties in your JSON document result in hello entire array getting overwritten, i.e. hello array is not merged.</span></span>

## <a name="data-partitioning-in-cosmos-db"></a><span data-ttu-id="2976f-127">Creación de particiones de datos en Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="2976f-127">Data partitioning in Cosmos DB</span></span>
<span data-ttu-id="2976f-128">COSMOS DB [particiones colecciones](../cosmos-db/partition-data.md) son Hola recomendada enfoque para crear particiones de los datos.</span><span class="sxs-lookup"><span data-stu-id="2976f-128">Cosmos DB [partitioned collections](../cosmos-db/partition-data.md) are hello recommended approach for partitioning your data.</span></span> 

<span data-ttu-id="2976f-129">Para las colecciones de base de datos de Cosmos únicas, análisis de transmisiones aún permite toopartition los datos se basan en patrones de consulta de Hola y necesidades de rendimiento de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="2976f-129">For single Cosmos DB collections, Stream Analytics still allows you toopartition your data based on both hello query patterns and performance needs of your application.</span></span> <span data-ttu-id="2976f-130">Cada colección puede contener una too10GB de datos (máximo) y actualmente que no hay ningún tooscale forma una (o desbordamiento) una colección.</span><span class="sxs-lookup"><span data-stu-id="2976f-130">Each collection may contain up too10GB of data (maximum) and currently there is no way tooscale up (or overflow) a collection.</span></span> <span data-ttu-id="2976f-131">Para escalar horizontalmente, análisis de transmisiones permite toowrite toomultiple colecciones con un prefijo determinado (consulte los detalles de uso siguiente).</span><span class="sxs-lookup"><span data-stu-id="2976f-131">For scaling out, Stream Analytics allows you toowrite toomultiple collections with a given prefix (see usage details below).</span></span> <span data-ttu-id="2976f-132">Análisis de transmisiones usa Hola coherente [resolución de la partición de Hash](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) estrategia basada en usuario Hola proporciona PartitionKey columna toopartition sus registros de salida.</span><span class="sxs-lookup"><span data-stu-id="2976f-132">Stream Analytics uses hello consistent [Hash Partition Resolver](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) strategy based on hello user provided PartitionKey column toopartition its output records.</span></span> <span data-ttu-id="2976f-133">Hello número de colecciones con hello al Hola hora de inicio del trabajo de transmisión por secuencias proporcionadas prefijo se utiliza como recuento de particiones de salida de hello, trabajo de hello toowhich escribe tooin paralelo (colecciones de base de datos de Cosmos = particiones de salida).</span><span class="sxs-lookup"><span data-stu-id="2976f-133">hello number of collections with hello given prefix at hello streaming job’s start time is used as hello output partition count, toowhich hello job writes tooin parallel (Cosmos DB Collections = Output Partitions).</span></span> <span data-ttu-id="2976f-134">En el caso de una sola colección con una indexación diferida que realiza solo operaciones de inserción, se puede esperar en torno a 0,4 MB/s de rendimiento de escritura.</span><span class="sxs-lookup"><span data-stu-id="2976f-134">For a single collection with lazy indexing doing only inserts, about 0.4 MB/s write throughput can be expected.</span></span> <span data-ttu-id="2976f-135">El uso de varias colecciones permite tooachieve un mayor rendimiento y una mayor capacidad.</span><span class="sxs-lookup"><span data-stu-id="2976f-135">Using multiple collections can allow you tooachieve higher throughput and increased capacity.</span></span>

<span data-ttu-id="2976f-136">Si piensa recuento de particiones de tooincrease Hola Hola futuras, deberá toostop su trabajo, volver a particionar Hola datos de las colecciones existentes con nuevas recopilaciones y, a continuación, trabajo de análisis de transmisiones de Hola de reinicio.</span><span class="sxs-lookup"><span data-stu-id="2976f-136">If you intend tooincrease hello partition count in hello future, you may need toostop your job, repartition hello data from your existing collections into new collections and then restart hello Stream Analytics job.</span></span> <span data-ttu-id="2976f-137">Se incluirá más información sobre el uso de PartitionResolver y la nueva creación de particiones junto con código de ejemplo en una publicación posterior.</span><span class="sxs-lookup"><span data-stu-id="2976f-137">More details on using PartitionResolver and re-partitioning along with sample code, will be included in a follow-up post.</span></span> <span data-ttu-id="2976f-138">artículo de Hello [particiones y ajuste de escala en la base de datos de Cosmos](../documentdb/documentdb-partition-data.md) también proporciona detalles sobre esto.</span><span class="sxs-lookup"><span data-stu-id="2976f-138">hello article [Partitioning and scaling in Cosmos DB](../documentdb/documentdb-partition-data.md) also provides details on this.</span></span>

## <a name="cosmos-db-settings-for-json-output"></a><span data-ttu-id="2976f-139">Configuración de Cosmos DB para salida de JSON</span><span class="sxs-lookup"><span data-stu-id="2976f-139">Cosmos DB settings for JSON output</span></span>
<span data-ttu-id="2976f-140">La creación de Cosmos DB como una salida en Stream Analytics genera una solicitud de información, tal como se muestra a continuación.</span><span class="sxs-lookup"><span data-stu-id="2976f-140">Creating Cosmos DB as an output in Stream Analytics generates a prompt for information as seen below.</span></span> <span data-ttu-id="2976f-141">En esta sección se ofrece una explicación de la definición de propiedades de Hola.</span><span class="sxs-lookup"><span data-stu-id="2976f-141">This section provides an explanation of hello properties definition.</span></span>

<span data-ttu-id="2976f-142">Colección particionada</span><span class="sxs-lookup"><span data-stu-id="2976f-142">Partitioned Collection</span></span> | <span data-ttu-id="2976f-143">Varias colecciones de partición única</span><span class="sxs-lookup"><span data-stu-id="2976f-143">Multiple “Single Partition” collections</span></span>
---|---
![pantalla de salida de análisis de transmisiones de documentdb](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-1.png) |  ![pantalla de salida de análisis de transmisiones de documentdb](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-2.png)


  
> [!NOTE]
> <span data-ttu-id="2976f-146">Hola **varias colecciones de "Única partición"** escenario requiere una clave de partición y es una configuración admitida.</span><span class="sxs-lookup"><span data-stu-id="2976f-146">hello **Multiple “Single Partition” collections** scenario requires a partition key and is a supported configuration.</span></span> 

* <span data-ttu-id="2976f-147">**Alias de salida** – un toorefer alias este resultado de la consulta ASA</span><span class="sxs-lookup"><span data-stu-id="2976f-147">**Output Alias** – An alias toorefer this output in your ASA query</span></span>  
* <span data-ttu-id="2976f-148">**Nombre de cuenta** : nombre de Hola o extremo URI de hello cuenta de base de datos de Cosmos.</span><span class="sxs-lookup"><span data-stu-id="2976f-148">**Account Name** – hello name or endpoint URI of hello Cosmos DB account.</span></span>  
* <span data-ttu-id="2976f-149">**Clave de cuenta** : clave de acceso compartido de Hola para hello cuenta de base de datos de Cosmos.</span><span class="sxs-lookup"><span data-stu-id="2976f-149">**Account Key** – hello shared access key for hello Cosmos DB account.</span></span>  
* <span data-ttu-id="2976f-150">**Base de datos** : nombre de base de datos de base de datos de Cosmos Hola.</span><span class="sxs-lookup"><span data-stu-id="2976f-150">**Database** – hello Cosmos DB database name.</span></span>  
* <span data-ttu-id="2976f-151">**Patrón de nombre de colección** : nombre de la colección de Hola o su patrón de hello colecciones toobe usa.</span><span class="sxs-lookup"><span data-stu-id="2976f-151">**Collection Name Pattern** – hello collection name or their pattern for hello collections toobe used.</span></span> <span data-ttu-id="2976f-152">formato de nombre de colección de Hello puede crearse mediante token {partition} opcional de hello, donde se inician las particiones desde 0.</span><span class="sxs-lookup"><span data-stu-id="2976f-152">hello collection name format can be constructed using hello optional {partition} token, where partitions start from 0.</span></span> <span data-ttu-id="2976f-153">Las siguientes entradas de ejemplo son válidas:</span><span class="sxs-lookup"><span data-stu-id="2976f-153">Following are sample valid inputs:</span></span>  
  <span data-ttu-id="2976f-154">1\) MyCollection: debe existir una colección denominada "MyCollection".</span><span class="sxs-lookup"><span data-stu-id="2976f-154">1\) MyCollection – One collection named “MyCollection” must exist.</span></span>  
  <span data-ttu-id="2976f-155">2\) MyCollection{partición}: deben existir esas colecciones: "MyCollection0", "MyCollection1", "MyCollection2", etc.</span><span class="sxs-lookup"><span data-stu-id="2976f-155">2\) MyCollection{partition} – Such collections must exist– "MyCollection0”, “MyCollection1”, “MyCollection2” and so on.</span></span>  
* <span data-ttu-id="2976f-156">**Clave de partición**: opcional.</span><span class="sxs-lookup"><span data-stu-id="2976f-156">**Partition Key** – Optional.</span></span> <span data-ttu-id="2976f-157">Solo es necesario si usa un token {partition} en el patrón de nombre de la colección.</span><span class="sxs-lookup"><span data-stu-id="2976f-157">This is only needed if you are using a {parition} token in your collection name pattern.</span></span> <span data-ttu-id="2976f-158">nombre de Hello del campo de hello en toospecify Hola clave de salida eventos que se usa para crear particiones de salida de todas las colecciones.</span><span class="sxs-lookup"><span data-stu-id="2976f-158">hello name of hello field in output events used toospecify hello key for partitioning output across collections.</span></span> <span data-ttu-id="2976f-159">Para una salida de colección sencilla, se puede utilizar cualquier columna de salida arbitraria (por ejemplo, PartitionId).</span><span class="sxs-lookup"><span data-stu-id="2976f-159">For single collection output, any arbitrary output column can be used e.g. PartitionId.</span></span>  
* <span data-ttu-id="2976f-160">**Identificador de documento** : opcional.</span><span class="sxs-lookup"><span data-stu-id="2976f-160">**Document ID** – Optional.</span></span> <span data-ttu-id="2976f-161">nombre de Hola de campo de hello en los eventos de salida utiliza la clave principal de toospecify hello en las instrucciones insert o update se basan las operaciones.</span><span class="sxs-lookup"><span data-stu-id="2976f-161">hello name of hello field in output events used toospecify hello primary key on which insert or update operations are based.</span></span>  

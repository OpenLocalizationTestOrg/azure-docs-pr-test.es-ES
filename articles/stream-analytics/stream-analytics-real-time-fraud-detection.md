# <a name="get-started-using-azure-stream-analytics-real-time-fraud-detection"></a><span data-ttu-id="886b7-101">Introducción al uso de Análisis de transmisiones de Azure: detección de fraudes en tiempo real</span><span class="sxs-lookup"><span data-stu-id="886b7-101">Get started using Azure Stream Analytics: Real-time fraud detection</span></span>

<span data-ttu-id="886b7-102">Este tutorial muestra de principio a fin cómo usar Azure Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="886b7-102">This tutorial provides an end-to-end illustration of how to use Azure Stream Analytics.</span></span> <span data-ttu-id="886b7-103">Aprenderá a:</span><span class="sxs-lookup"><span data-stu-id="886b7-103">You learn how to:</span></span> 

* <span data-ttu-id="886b7-104">Incorporar eventos de streaming a una instancia de Azure Event Hubs.</span><span class="sxs-lookup"><span data-stu-id="886b7-104">Bring streaming events into an instance of Azure Event Hubs.</span></span> <span data-ttu-id="886b7-105">En este tutorial, usará una aplicación que le ofrecemos que simula un flujo de registros de metadatos de teléfono móvil.</span><span class="sxs-lookup"><span data-stu-id="886b7-105">In this tutorial, you'll use an app that we provide that simulates a stream of mobile-phone metadata records.</span></span>

* <span data-ttu-id="886b7-106">Escribir consultas de Stream Analytics de tipo SQL para transformar datos, agregar información o buscar patrones.</span><span class="sxs-lookup"><span data-stu-id="886b7-106">Write SQL-like Stream Analytics queries to transform data, aggregating information or looking for patterns.</span></span> <span data-ttu-id="886b7-107">Verá cómo usar una consulta para examinar el flujo entrante y buscar llamadas que puedan ser fraudulentas.</span><span class="sxs-lookup"><span data-stu-id="886b7-107">You will see how to use a query to examine the incoming stream and look for calls that might be fraudulent.</span></span>

* <span data-ttu-id="886b7-108">Enviar los resultados a un receptor de salida (almacenamiento) que pueda analizar para obtener información adicional.</span><span class="sxs-lookup"><span data-stu-id="886b7-108">Send the results to an output sink (storage) that you can analyze for additional insights.</span></span> <span data-ttu-id="886b7-109">En este caso, enviará los datos de llamadas sospechosas a Azure Blob Storage.</span><span class="sxs-lookup"><span data-stu-id="886b7-109">In this case, you'll send the suspicious call data to Azure Blob storage.</span></span>

<span data-ttu-id="886b7-110">En este tutorial, se usa el ejemplo de detección de fraudes en tiempo real basado en datos de llamadas telefónicas.</span><span class="sxs-lookup"><span data-stu-id="886b7-110">In  this tutorial, we use the example of real-time fraud detection based on phone-call data.</span></span> <span data-ttu-id="886b7-111">Paro la técnica que se muestra es también adecuada para la detección de otros tipos de fraudes, tales como el fraude con tarjetas de crédito y el robo de identidad.</span><span class="sxs-lookup"><span data-stu-id="886b7-111">But the technique we illustrate is also suited for other types of fraud detection, such as credit card fraud or identity theft.</span></span> 

## <a name="scenario-telecommunications-and-sim-fraud-detection-in-real-time"></a><span data-ttu-id="886b7-112">Escenario: telecomunicaciones y detección de fraudes de SIM en tiempo real</span><span class="sxs-lookup"><span data-stu-id="886b7-112">Scenario: Telecommunications and SIM fraud detection in real time</span></span>

<span data-ttu-id="886b7-113">Una empresa de telecomunicaciones tiene un gran volumen de datos en llamadas entrantes.</span><span class="sxs-lookup"><span data-stu-id="886b7-113">A telecommunications company has a large volume of data for incoming calls.</span></span> <span data-ttu-id="886b7-114">La compañía quiere detectar llamadas fraudulentas en tiempo real para poder notificarlo a los clientes o cancelar el servicio para un número concreto.</span><span class="sxs-lookup"><span data-stu-id="886b7-114">The company wants to detect fraudulent calls in real time so that they can notify customers or shut down service for a specific number.</span></span> <span data-ttu-id="886b7-115">Un tipo de fraude de SIM implica varias llamadas desde la misma identidad aproximadamente a la misma hora, pero en distintas ubicaciones geográficas.</span><span class="sxs-lookup"><span data-stu-id="886b7-115">One type of SIM fraud involves multiple calls from the same identity around the same time but in geographically different locations.</span></span> <span data-ttu-id="886b7-116">Para detectar este tipo de fraude, la compañía ha de examinar los registros de teléfono entrantes y buscar patrones concretos, en este caso, llamadas realizadas aproximadamente a la misma hora en distintos países.</span><span class="sxs-lookup"><span data-stu-id="886b7-116">To detect this type of fraud, the company needs to examine incoming phone records and look for specific patterns—in this case, for calls made around the same time in different countries.</span></span> <span data-ttu-id="886b7-117">Los registros de teléfono que entren en esta categoría se escriben en el almacenamiento para su análisis posterior.</span><span class="sxs-lookup"><span data-stu-id="886b7-117">Any phone records that fall into this category are written to storage for subsequent analysis.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="886b7-118">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="886b7-118">Prerequisites</span></span>

<span data-ttu-id="886b7-119">En este tutorial, simulará datos de llamadas telefónicas mediante una aplicación cliente que genera metadatos de llamada telefónica de muestra.</span><span class="sxs-lookup"><span data-stu-id="886b7-119">In this tutorial, you'll simulate phone-call data by using a client app that generates sample phone call metadata.</span></span> <span data-ttu-id="886b7-120">Algunos de los registros que genera la aplicación parecen llamadas fraudulentas.</span><span class="sxs-lookup"><span data-stu-id="886b7-120">Some of the records that the app produces look like fraudulent calls.</span></span> 

<span data-ttu-id="886b7-121">Antes de empezar, asegúrese de que dispone de lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="886b7-121">Before you start, make sure you have the following:</span></span>

* <span data-ttu-id="886b7-122">Una cuenta de Azure.</span><span class="sxs-lookup"><span data-stu-id="886b7-122">An Azure account.</span></span>
* <span data-ttu-id="886b7-123">La aplicación del generador de eventos de llamada.</span><span class="sxs-lookup"><span data-stu-id="886b7-123">The call-event generator app.</span></span> <span data-ttu-id="886b7-124">Para obtenerla, descargue el [archivo TelcoGenerator.zip](http://download.microsoft.com/download/8/B/D/8BD50991-8D54-4F59-AB83-3354B69C8A7E/TelcoGenerator.zip) del Centro de descarga de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="886b7-124">You can get this by downloading the [TelcoGenerator.zip file](http://download.microsoft.com/download/8/B/D/8BD50991-8D54-4F59-AB83-3354B69C8A7E/TelcoGenerator.zip) from the Microsoft Download Center.</span></span> <span data-ttu-id="886b7-125">Descomprima este paquete un una carpeta en el equipo.</span><span class="sxs-lookup"><span data-stu-id="886b7-125">Unzip this package into a folder on your computer.</span></span> <span data-ttu-id="886b7-126">Si quiere ver el código fuente y ejecutar la aplicación en un depurador, puede obtener el código fuente de la aplicación en [GitHub](https://aka.ms/azure-stream-analytics-telcogenerator).</span><span class="sxs-lookup"><span data-stu-id="886b7-126">If you want to see the source code and run the app in a debugger, you can get the app source code from [GitHub](https://aka.ms/azure-stream-analytics-telcogenerator).</span></span> 

    >[!NOTE]
    ><span data-ttu-id="886b7-127">Windows puede bloquear el archivo zip descargado.</span><span class="sxs-lookup"><span data-stu-id="886b7-127">Windows might block the downloaded .zip file.</span></span> <span data-ttu-id="886b7-128">Si no puede descomprimirlo, haga clic con el botón derecho en el archivo y seleccione **Propiedades**.</span><span class="sxs-lookup"><span data-stu-id="886b7-128">If you can't unzip it, right-click the file and select **Properties**.</span></span> <span data-ttu-id="886b7-129">Si ve el mensaje "Este archivo proviene de otro equipo y podría bloquearse para ayudar a proteger este equipo", seleccione la opción **Desbloquear** y luego haga clic en **Aplicar**.</span><span class="sxs-lookup"><span data-stu-id="886b7-129">If you see the "This file came from another computer and might be blocked to help protect this computer" message, select the **Unblock** option and then click **Apply**.</span></span>

<span data-ttu-id="886b7-130">Si quiere examinar los resultados del trabajo de análisis de Stream Analytics, necesita además una herramienta para ver el contenido de un contenedor de Azure Blob Storage.</span><span class="sxs-lookup"><span data-stu-id="886b7-130">If you want to examine the results of the Streaming Analytics job, you also need a tool for viewing the contents of a Azure Blob Storage container.</span></span> <span data-ttu-id="886b7-131">Si utiliza Visual Studio, puede usar [Azure Tools para Visual Studio](https://docs.microsoft.com/en-us/azure/vs-azure-tools-storage-resources-server-explorer-browse-manage) o [Visual Studio Cloud Explorer](https://docs.microsoft.com/en-us/azure/vs-azure-tools-resources-managing-with-cloud-explorer).</span><span class="sxs-lookup"><span data-stu-id="886b7-131">If you use Visual Studio, you can use [Azure Tools for Visual Studio](https://docs.microsoft.com/en-us/azure/vs-azure-tools-storage-resources-server-explorer-browse-manage) or [Visual Studio Cloud Explorer](https://docs.microsoft.com/en-us/azure/vs-azure-tools-resources-managing-with-cloud-explorer).</span></span> <span data-ttu-id="886b7-132">También puede instalar herramientas independientes, tales como [Explorador de Azure Storage](http://storageexplorer.com/) y [Azure Explorer](http://www.cerebrata.com/products/azure-explorer/introduction).</span><span class="sxs-lookup"><span data-stu-id="886b7-132">Alternatively, you can install standalone tools like [Azure Storage Explorer](http://storageexplorer.com/) or [Azure Explorer](http://www.cerebrata.com/products/azure-explorer/introduction).</span></span> 

## <a name="create-an-azure-event-hubs-to-ingest-events"></a><span data-ttu-id="886b7-133">Creación de una instancia de Azure Event Hubs para la ingesta de eventos</span><span class="sxs-lookup"><span data-stu-id="886b7-133">Create an Azure event hubs to ingest events</span></span>

<span data-ttu-id="886b7-134">Para analizar un flujo de datos, debe *introducirlo* en Azure.</span><span class="sxs-lookup"><span data-stu-id="886b7-134">To analyze a data stream, you *ingest* it into Azure.</span></span> <span data-ttu-id="886b7-135">Una forma habitual de ingesta de datos consiste en usar [Azure Event Hubs](../event-hubs/event-hubs-what-is-event-hubs.md), que permite la ingesta de millones de eventos por segundo y el procesamiento y almacenamiento de la información de los eventos.</span><span class="sxs-lookup"><span data-stu-id="886b7-135">A typical way to ingest data is to use [Azure Event Hubs](../event-hubs/event-hubs-what-is-event-hubs.md), which lets you ingest millions of events per second and then process and store the event information.</span></span> <span data-ttu-id="886b7-136">En este tutorial, se crea un centro de eventos y luego se indica a la aplicación del generador de eventos de llamada que envíe los datos de llamada a dicho centro.</span><span class="sxs-lookup"><span data-stu-id="886b7-136">For this tutorial, you create an event hub and then have the call-event generator app send call data to that event hub.</span></span> <span data-ttu-id="886b7-137">Para más información sobre Event Hubs, vea la [documentación de Azure Service Bus](https://docs.microsoft.com/en-us/azure/service-bus/).</span><span class="sxs-lookup"><span data-stu-id="886b7-137">For more about event hubs, see the [Azure Service Bus documentation](https://docs.microsoft.com/en-us/azure/service-bus/).</span></span>

>[!NOTE]
><span data-ttu-id="886b7-138">Para obtener una versión más detallada de este procedimiento, vea [Creación de un espacio de nombres de Event Hubs y un centro de eventos con Azure Portal](../event-hubs/event-hubs-create.md).</span><span class="sxs-lookup"><span data-stu-id="886b7-138">For a more detailed version of this procedure, see [Create an Event Hubs namespace and an event hub using the Azure portal](../event-hubs/event-hubs-create.md).</span></span> 

### <a name="create-a-namespace-and-event-hub"></a><span data-ttu-id="886b7-139">Creación de un espacio de nombres y un centro de eventos</span><span class="sxs-lookup"><span data-stu-id="886b7-139">Create a namespace and event hub</span></span>
<span data-ttu-id="886b7-140">En este procedimiento, cree primero un espacio de nombres del centro de eventos y agregue luego un centro de eventos al espacio de nombres.</span><span class="sxs-lookup"><span data-stu-id="886b7-140">In this procedure, you first create an event hub namespace, and then you add an event hub to that namepsace.</span></span> <span data-ttu-id="886b7-141">Los espacios de nombres del centro de eventos se usan para agrupar lógicamente instancias de bus de eventos relacionados.</span><span class="sxs-lookup"><span data-stu-id="886b7-141">Event hub namespaces are used to logically group related event bus instances.</span></span> 

1. <span data-ttu-id="886b7-142">Inicie sesión en Azure Portal y haga clic en **Nuevo** > **Internet de las cosas** > **Centro de eventos**.</span><span class="sxs-lookup"><span data-stu-id="886b7-142">Log  into the Azure portal and click **New** > **Internet of Things** > **Event Hub**.</span></span> 

2. <span data-ttu-id="886b7-143">En la hoja **Crear espacio de nombres**, especifique un nombre de espacio de nombres, como `<yourname>-eh-ns-demo`.</span><span class="sxs-lookup"><span data-stu-id="886b7-143">In the **Create namespace** blade, enter a namespace name such as `<yourname>-eh-ns-demo`.</span></span> <span data-ttu-id="886b7-144">Puede utilizar cualquier nombre para el espacio de nombres, pero debe ser válido para una dirección URL y ser único en Azure.</span><span class="sxs-lookup"><span data-stu-id="886b7-144">You can use any name for the namespace, but the name must be valid for a URL and it must be unique across Azure.</span></span> 
    
3. <span data-ttu-id="886b7-145">Seleccione una suscripción y cree o elija un grupo de recursos. Luego haga clic en **Crear**.</span><span class="sxs-lookup"><span data-stu-id="886b7-145">Select a subscription and create or choose a resource group , then click **Create**.</span></span> 

    ![Creación de un espacio de nombres del centro de eventos](./media/stream-analytics-real-time-fraud-detection/stream-analytics-create-eventhub-namespace-new-portal.png)
 
4. <span data-ttu-id="886b7-147">Cuando el espacio de nombres termine de implementarse, busque el espacio de nombres del centro de eventos en la lista de recursos de Azure.</span><span class="sxs-lookup"><span data-stu-id="886b7-147">When the namespace has finished deploying, find the event hub namespace in your list of Azure resources.</span></span> 

5. <span data-ttu-id="886b7-148">Haga clic en el nuevo espacio de nombres y, en la hoja del espacio de nombres, haga clic en **+&nbsp;Centro de eventos**.</span><span class="sxs-lookup"><span data-stu-id="886b7-148">Click the new namespace, and in the namespace blade, click **+&nbsp;Event Hub**.</span></span> 

    ![<span data-ttu-id="886b7-149">Botón Agregar centro de eventos para crear un centro de eventos</span><span class="sxs-lookup"><span data-stu-id="886b7-149">The Add Event Hub button for creating a new event hub</span></span> ](./media/stream-analytics-real-time-fraud-detection/stream-analytics-create-eventhub-button-new-portal.png)    
 
6. <span data-ttu-id="886b7-150">Asigne al nuevo centro de eventos el nombre `sa-eh-frauddetection-demo`.</span><span class="sxs-lookup"><span data-stu-id="886b7-150">Name the new event hub `sa-eh-frauddetection-demo`.</span></span> <span data-ttu-id="886b7-151">Puede usar otro nombre.</span><span class="sxs-lookup"><span data-stu-id="886b7-151">You can use a different name.</span></span> <span data-ttu-id="886b7-152">Si lo hace, tome nota del mismo, porque más adelante se necesita el nombre.</span><span class="sxs-lookup"><span data-stu-id="886b7-152">If you do, make a note of it, because you need the name later.</span></span> <span data-ttu-id="886b7-153">No es preciso establecer otras opciones del centro de eventos ahora mismo.</span><span class="sxs-lookup"><span data-stu-id="886b7-153">You don't need to set any other options for the event hub right now.</span></span>

    ![Hoja para la creación de un centro de eventos](./media/stream-analytics-real-time-fraud-detection/stream-analytics-create-eventhub-new-portal.png)
    
 
7. <span data-ttu-id="886b7-155">Haga clic en **Crear**.</span><span class="sxs-lookup"><span data-stu-id="886b7-155">Click **Create**.</span></span>
### <a name="grant-access-to-the-event-hub-and-get-a-connection-string"></a><span data-ttu-id="886b7-156">Concesión de acceso al centro de eventos y obtención de una cadena de conexión</span><span class="sxs-lookup"><span data-stu-id="886b7-156">Grant access to the event hub and get a connection string</span></span>

<span data-ttu-id="886b7-157">Para que un proceso pueda enviar datos a un centro de eventos, este debe tener una directiva que permita el acceso adecuado.</span><span class="sxs-lookup"><span data-stu-id="886b7-157">Before a process can send data to an event hub, the event hub must have a policy that allows appropriate access.</span></span> <span data-ttu-id="886b7-158">La directiva de acceso genera una cadena de conexión que incluye la información de autorización.</span><span class="sxs-lookup"><span data-stu-id="886b7-158">The access policy produces a connection string that includes authorization information.</span></span>

1.  <span data-ttu-id="886b7-159">En la hoja del espacio de nombres, haga clic en **Event Hubs** y luego en el nombre del nuevo centro de eventos.</span><span class="sxs-lookup"><span data-stu-id="886b7-159">In the event namespace blade, click **Event Hubs** and then click the name of your new event hub.</span></span>

2.  <span data-ttu-id="886b7-160">En la hoja del centro de eventos, haga clic en **Directivas de acceso compartido** y luego en **+&nbsp;Agregar**.</span><span class="sxs-lookup"><span data-stu-id="886b7-160">In the event hub blade, click **Shared access policies** and then click **+&nbsp;Add**.</span></span>

    >[!NOTE]
    ><span data-ttu-id="886b7-161">Asegúrese de que trabaja en el centro de eventos, no en el espacio de nombres del centro de eventos.</span><span class="sxs-lookup"><span data-stu-id="886b7-161">Make sure you're working with the event hub, not the event hub namespace.</span></span>

3.  <span data-ttu-id="886b7-162">Agregue una directiva denominada `sa-policy-manage-demo` y, en **Notificación**, seleccione **Administrar**.</span><span class="sxs-lookup"><span data-stu-id="886b7-162">Add a policy named `sa-policy-manage-demo` and for **Claim**, select **Manage**.</span></span>

    ![Hoja para la creación de una directiva de acceso al centro de eventos](./media/stream-analytics-real-time-fraud-detection/stream-analytics-create-shared-access-policy-manage-new-portal.png)
 
4.  <span data-ttu-id="886b7-164">Haga clic en **Crear**.</span><span class="sxs-lookup"><span data-stu-id="886b7-164">Click **Create**.</span></span>

5.  <span data-ttu-id="886b7-165">Una vez implementada la directiva, haga clic en ella en la lista de directivas de acceso compartido.</span><span class="sxs-lookup"><span data-stu-id="886b7-165">After the policy has been deployed, click it in the list of shared access policies.</span></span>

6.  <span data-ttu-id="886b7-166">Busque el cuadro **CADENA DE CONEXIÓN: CLAVE PRINCIPAL** y haga clic en el botón Copiar que se encuentra junto a la cadena de conexión.</span><span class="sxs-lookup"><span data-stu-id="886b7-166">Find the box labeled **CONNECTION STRING-PRIMARY KEY** and click the copy button next to the connection string.</span></span> 
    
    ![Copia de la clave principal de la cadena de conexión de la directiva de acceso](./media/stream-analytics-real-time-fraud-detection/stream-analytics-shared-access-policy-copy-connection-string-new-portal.png)
 
7.  <span data-ttu-id="886b7-168">Pegue la cadena de conexión en un editor de texto.</span><span class="sxs-lookup"><span data-stu-id="886b7-168">Paste the connection string into a text editor.</span></span> <span data-ttu-id="886b7-169">Necesita esta cadena de conexión en la siguiente sección, después de hacerle pequeñas algunas modificaciones.</span><span class="sxs-lookup"><span data-stu-id="886b7-169">You need this connection string for the next section, after you make some small edits to it.</span></span>

    <span data-ttu-id="886b7-170">La cadena de conexión tiene el siguiente aspecto:</span><span class="sxs-lookup"><span data-stu-id="886b7-170">The connection string looks like this:</span></span>

        Endpoint=sb://YOURNAME-eh-ns-demo.servicebus.windows.net/;SharedAccessKeyName=sa-policy-manage-demo;SharedAccessKey=Gw2NFZwU1Di+rxA2T+6hJYAtFExKRXaC2oSQa0ZsPkI=;EntityPath=sa-eh-frauddetection-demo

    <span data-ttu-id="886b7-171">Observe que la cadena de conexión contiene varios pares clave-valor, separados por punto y coma: `Endpoint`, `SharedAccessKeyName`, `SharedAccessKey` y `EntityPath`.</span><span class="sxs-lookup"><span data-stu-id="886b7-171">Notice that the connection string contains multiple key-value pairs, separated with semicolons: `Endpoint`, `SharedAccessKeyName`, `SharedAccessKey`, and `EntityPath`.</span></span>  

## <a name="configure-and-start-the-event-generator-application"></a><span data-ttu-id="886b7-172">Configuración e inicio de la aplicación del generador de eventos</span><span class="sxs-lookup"><span data-stu-id="886b7-172">Configure and start the event generator application</span></span>

<span data-ttu-id="886b7-173">Antes de iniciar la aplicación TelcoGenerator, debe configurarla para que envíe los registros de llamada al centro de eventos que acaba de crear.</span><span class="sxs-lookup"><span data-stu-id="886b7-173">Before you start the TelcoGenerator app, you configure it so that it will send call records to the event hub you just created.</span></span>

### <a name="configure-the-telcogeneratorapp"></a><span data-ttu-id="886b7-174">Configuración de TelcoGeneratorapp</span><span class="sxs-lookup"><span data-stu-id="886b7-174">Configure the TelcoGeneratorapp</span></span>

1.  <span data-ttu-id="886b7-175">En el editor en el que copió la cadena de conexión, apunte el valor `EntityPath` y luego quite el par `EntityPath` (no olvide quitar el punto y coma que lo precede).</span><span class="sxs-lookup"><span data-stu-id="886b7-175">In the editor where you copied the connection string, make a note of the `EntityPath` value, and then remove the `EntityPath` pair (don't forget to remove the semicolon that precedes it).</span></span> 

2.  <span data-ttu-id="886b7-176">En la carpeta donde descomprimió el archivo TelcoGenerator.zip, abra el archivo telcodatagen.exe.config en un editor.</span><span class="sxs-lookup"><span data-stu-id="886b7-176">In the folder where you unzipped the TelcoGenerator.zip file, open the telcodatagen.exe.config file in an editor.</span></span> <span data-ttu-id="886b7-177">(Hay más de un archivo .config, así que asegúrese de abrir el correcto).</span><span class="sxs-lookup"><span data-stu-id="886b7-177">(There is more than one .config file, so be sure that you open the right one.)</span></span>

3.  <span data-ttu-id="886b7-178">En el elemento `<appSettings>`, siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="886b7-178">In the `<appSettings>` element, do this:</span></span>

    * <span data-ttu-id="886b7-179">Establezca el valor de la clave `EventHubName` en el nombre del centro de eventos (es decir, en el valor de la ruta de acceso de la entidad).</span><span class="sxs-lookup"><span data-stu-id="886b7-179">Set the value of the `EventHubName` key to the event hub name (that is, to the value of the entity path).</span></span>
    * <span data-ttu-id="886b7-180">Establezca el valor de la clave `Microsoft.ServiceBus.ConnectionString` en la cadena de conexión.</span><span class="sxs-lookup"><span data-stu-id="886b7-180">Set the value of the `Microsoft.ServiceBus.ConnectionString` key to the connection string.</span></span> 

    <span data-ttu-id="886b7-181">La sección `<appSettings>` tendrá un aspecto similar al del ejemplo siguiente.</span><span class="sxs-lookup"><span data-stu-id="886b7-181">The `<appSettings>` section will look like the following example.</span></span> <span data-ttu-id="886b7-182">(Para mayor claridad, se ajustan las líneas y se quitan algunos caracteres del token de autorización).</span><span class="sxs-lookup"><span data-stu-id="886b7-182">(For clarity, we wrapped the lines and removed some characters from the authorization token.)</span></span>

    ![Archivo de configuración de la aplicación TelcoGenerator que muestra el nombre del centro de eventos y la cadena de conexión](./media/stream-analytics-real-time-fraud-detection/stream-analytics-telcogenerator-config-file-app-settings.png)
 
4.  <span data-ttu-id="886b7-184">Guarde el archivo .</span><span class="sxs-lookup"><span data-stu-id="886b7-184">Save the file.</span></span> 

### <a name="start-the-app"></a><span data-ttu-id="886b7-185">Inicio de la aplicación</span><span class="sxs-lookup"><span data-stu-id="886b7-185">Start the app</span></span>
1.  <span data-ttu-id="886b7-186">Abra una ventana de comandos y cambie a la carpeta en la que se ha descomprimido la aplicación TelcoGenerator.</span><span class="sxs-lookup"><span data-stu-id="886b7-186">Open a command window and change to the folder where the TelcoGenerator app is unzipped.</span></span>
2.  <span data-ttu-id="886b7-187">Escriba el comando siguiente:</span><span class="sxs-lookup"><span data-stu-id="886b7-187">Enter the following command:</span></span>

        telcodatagen.exe 1000 .2 2

    <span data-ttu-id="886b7-188">Los parámetros son los siguientes:</span><span class="sxs-lookup"><span data-stu-id="886b7-188">The parameters are:</span></span> 

    * <span data-ttu-id="886b7-189">Número de registros CDR por hora.</span><span class="sxs-lookup"><span data-stu-id="886b7-189">Number of CDRs per hour.</span></span> 
    * <span data-ttu-id="886b7-190">Probabilidad de fraude de tarjeta SIM: frecuencia, como porcentaje de todas las llamadas, con que la aplicación debe simular una llamada fraudulenta.</span><span class="sxs-lookup"><span data-stu-id="886b7-190">SIM Card Fraud Probability: How often, as a percentage of all calls, that the app should simulate a fraudulent call.</span></span> <span data-ttu-id="886b7-191">El valor .2 indica que aproximadamente el 20 % de los registros de llamada tendrán un aspecto fraudulento.</span><span class="sxs-lookup"><span data-stu-id="886b7-191">The value .2 means that about 20% of the call records will look fraudulent.</span></span>
    * <span data-ttu-id="886b7-192">Duración en horas.</span><span class="sxs-lookup"><span data-stu-id="886b7-192">Duration in hours.</span></span> <span data-ttu-id="886b7-193">Número de horas que debe ejecutarse la aplicación.</span><span class="sxs-lookup"><span data-stu-id="886b7-193">The number of hours that the app should run.</span></span> <span data-ttu-id="886b7-194">También puede detener la aplicación en cualquier momento presionando Ctrl+C en la línea de comandos.</span><span class="sxs-lookup"><span data-stu-id="886b7-194">You can also stop the app any time by pressing Ctrl+C at the command line.</span></span>

    <span data-ttu-id="886b7-195">Después de unos segundos, la aplicación comienza a mostrar los registros de llamada telefónica en la pantalla tal y como los envía al centro de eventos.</span><span class="sxs-lookup"><span data-stu-id="886b7-195">After a few seconds, the app starts displaying phone call records on the screen as it sends them to the event hub.</span></span>

<span data-ttu-id="886b7-196">Estos son algunos de los principales campos que se van a usar en esta aplicación de detección de fraudes en tiempo real:</span><span class="sxs-lookup"><span data-stu-id="886b7-196">Some of the key fields that you will be using in this real-time fraud detection application are the following:</span></span>

|<span data-ttu-id="886b7-197">**Registro**</span><span class="sxs-lookup"><span data-stu-id="886b7-197">**Record**</span></span>|<span data-ttu-id="886b7-198">**Definición**</span><span class="sxs-lookup"><span data-stu-id="886b7-198">**Definition**</span></span>|
|----------|--------------|
|`CallrecTime`|<span data-ttu-id="886b7-199">Marca de tiempo para la hora de inicio de la llamada.</span><span class="sxs-lookup"><span data-stu-id="886b7-199">The timestamp for the call start time.</span></span> |
|`SwitchNum`|<span data-ttu-id="886b7-200">Conmutador de teléfono que se usa para conectar la llamada.</span><span class="sxs-lookup"><span data-stu-id="886b7-200">The telephone switch used to connect the call.</span></span> <span data-ttu-id="886b7-201">En este ejemplo, los conmutadores son cadenas que representan el país de origen (Estados Unidos, China, Reino Unido, Alemania o Australia).</span><span class="sxs-lookup"><span data-stu-id="886b7-201">For this example, the switches are strings that represent the country of origin (US, China, UK, Germany, or Australia).</span></span> |
|`CallingNum`|<span data-ttu-id="886b7-202">Número de teléfono del autor de la llamada.</span><span class="sxs-lookup"><span data-stu-id="886b7-202">The phone number of the caller.</span></span> |
|`CallingIMSI`|<span data-ttu-id="886b7-203">Identidad del suscriptor móvil internacional (IMSI).</span><span class="sxs-lookup"><span data-stu-id="886b7-203">The International Mobile Subscriber Identity (IMSI).</span></span> <span data-ttu-id="886b7-204">Se trata del identificador único del autor de la llamada.</span><span class="sxs-lookup"><span data-stu-id="886b7-204">This is the Unique identifier of the caller.</span></span> |
|`CalledNum`|<span data-ttu-id="886b7-205">Número de teléfono del destinatario de la llamada.</span><span class="sxs-lookup"><span data-stu-id="886b7-205">The phone number of the call recipient.</span></span> |
|`CalledIMSI`|<span data-ttu-id="886b7-206">Identidad del suscriptor móvil internacional (IMSI).</span><span class="sxs-lookup"><span data-stu-id="886b7-206">International Mobile Subscriber Identity (IMSI).</span></span> <span data-ttu-id="886b7-207">Se trata del identificador único del destinatario de la llamada.</span><span class="sxs-lookup"><span data-stu-id="886b7-207">This is the unique identifier of the call recipient.</span></span> |


## <a name="create-a-stream-analytics-job-to-manage-streaming-data"></a><span data-ttu-id="886b7-208">Creación de un trabajo de Stream Analytics para administrar los datos de streaming</span><span class="sxs-lookup"><span data-stu-id="886b7-208">Create a Stream Analytics job to manage streaming data</span></span>

<span data-ttu-id="886b7-209">Ahora que tiene un flujo de eventos de llamada, puede configurar un trabajo de Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="886b7-209">Now that you have a stream of call events, you can set up a Stream Analytics job.</span></span> <span data-ttu-id="886b7-210">El trabajo leerá los datos del centro de eventos que configuró.</span><span class="sxs-lookup"><span data-stu-id="886b7-210">The job will read data from the event hub that you set up.</span></span> 

### <a name="create-the-job"></a><span data-ttu-id="886b7-211">Creación del trabajo</span><span class="sxs-lookup"><span data-stu-id="886b7-211">Create the job</span></span> 

1. <span data-ttu-id="886b7-212">En Azure Portal, haga clic en **Nuevo** > **Internet de las cosas** > **Trabajo de Stream Analytics**.</span><span class="sxs-lookup"><span data-stu-id="886b7-212">In the Azure portal, click **New** > **Internet of Things** > **Stream Analytics job**.</span></span>

2. <span data-ttu-id="886b7-213">Asigne al trabajo el nombre `sa_frauddetection_job_demo` y especifique una suscripción, un grupo de recursos y una ubicación.</span><span class="sxs-lookup"><span data-stu-id="886b7-213">Name the job `sa_frauddetection_job_demo`, specify a subscription, resource group, and location.</span></span>

    <span data-ttu-id="886b7-214">Es conveniente colocar el trabajo y el centro de eventos en la misma región para obtener el mejor rendimiento y no pagar por transferir datos de una región a otra.</span><span class="sxs-lookup"><span data-stu-id="886b7-214">It's a good idea to place the job and the event hub in the same region for best performance and so that you don't pay to transfer data between regions.</span></span>

    ![Creación de un trabajo de Stream Analytics](./media/stream-analytics-real-time-fraud-detection/stream-analytics-create-sa-job-new-portal.png)

3. <span data-ttu-id="886b7-216">Haga clic en **Crear**.</span><span class="sxs-lookup"><span data-stu-id="886b7-216">Click **Create**.</span></span>

    <span data-ttu-id="886b7-217">El trabajo se crea y el portal muestra los detalles del trabajo.</span><span class="sxs-lookup"><span data-stu-id="886b7-217">The job is created and the portal displays job details.</span></span> <span data-ttu-id="886b7-218">Pero todavía no se ejecuta nada, hay que configurar el trabajo para poder iniciarlo.</span><span class="sxs-lookup"><span data-stu-id="886b7-218">Nothing is running yet, though—you have to configure the job before it can be started.</span></span>

### <a name="configure-job-input"></a><span data-ttu-id="886b7-219">Configuración de la entrada del trabajo</span><span class="sxs-lookup"><span data-stu-id="886b7-219">Configure job input</span></span>

1. <span data-ttu-id="886b7-220">En el panel o la hoja **Todos los recursos**, busque el trabajo de Stream Analytics `sa_frauddetection_job_demo` y selecciónelo.</span><span class="sxs-lookup"><span data-stu-id="886b7-220">In the dashboard or the **All resources** blade, find and select the `sa_frauddetection_job_demo` Stream Analytics job.</span></span> 
2. <span data-ttu-id="886b7-221">En la sección **Topología de trabajo** de la hoja del trabajo de Stream Analytics, haga clic en el cuadro **Entradas**.</span><span class="sxs-lookup"><span data-stu-id="886b7-221">In the **Job Topology** section of the Stream Analytics job blade, click the **Input** box.</span></span>

    ![Cuadro Entradas en Topología en la hoja del trabajo de Stream Analytics](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-input-box-new-portal.png)
 
3. <span data-ttu-id="886b7-223">Haga clic en **+&nbsp;Agregar** y rellene la hoja con estos valores:</span><span class="sxs-lookup"><span data-stu-id="886b7-223">Click **+&nbsp;Add** and then fill out the blade with these values:</span></span>

    * <span data-ttu-id="886b7-224">**Alias de entrada**: use el nombre `CallStream`.</span><span class="sxs-lookup"><span data-stu-id="886b7-224">**Input alias**: Use the name `CallStream`.</span></span> <span data-ttu-id="886b7-225">Si usa otro nombre, anótelo porque lo necesitará más adelante.</span><span class="sxs-lookup"><span data-stu-id="886b7-225">If you use a different name, make a note of it because you'll need it later.</span></span>
    * <span data-ttu-id="886b7-226">**Tipo de origen**: seleccione **Flujo de datos**.</span><span class="sxs-lookup"><span data-stu-id="886b7-226">**Source type**: Select **Data stream**.</span></span> <span data-ttu-id="886b7-227">(**Datos de referencia** se refiere a datos de búsqueda estáticos, que no se van a usar en este tutorial).</span><span class="sxs-lookup"><span data-stu-id="886b7-227">(**Reference data** refers to static lookup data, which you won't use in this tutorial.)</span></span>
    * <span data-ttu-id="886b7-228">**Origen**: seleccione **Centro de eventos**.</span><span class="sxs-lookup"><span data-stu-id="886b7-228">**Source**: Select **Event hub**.</span></span>
    * <span data-ttu-id="886b7-229">**Opción de importación**: seleccione **Usar centro de eventos de la suscripción actual**.</span><span class="sxs-lookup"><span data-stu-id="886b7-229">**Import option**: Select **Use event hub from current subscription**.</span></span> 
    * <span data-ttu-id="886b7-230">**Espacio de nombres de Service Bus**: seleccione el espacio de nombres del centro de eventos que creó antes (`<yourname>-eh-ns-demo`).</span><span class="sxs-lookup"><span data-stu-id="886b7-230">**Service bus namespace**: Select the event hub namespace that you created earlier (`<yourname>-eh-ns-demo`).</span></span>
    * <span data-ttu-id="886b7-231">**Centro de eventos**: seleccione el centro de eventos que creó antes (`sa-eh-frauddetection-demo`).</span><span class="sxs-lookup"><span data-stu-id="886b7-231">**Event hub**: Select the event hub that you created earlier (`sa-eh-frauddetection-demo`).</span></span>
    * <span data-ttu-id="886b7-232">**Nombre de la directiva del centro de eventos**: seleccione la directiva de acceso que creó antes (`sa-policy-manage-demo`).</span><span class="sxs-lookup"><span data-stu-id="886b7-232">**Event hub policy name**: Select the access policy that you created earlier (`sa-policy-manage-demo`).</span></span>

    ![Creación de una entrada del trabajo de Stream Analytics](./media/stream-analytics-real-time-fraud-detection/stream-analytics-create-sa-input-new-portal.png)

4. <span data-ttu-id="886b7-234">Haga clic en **Crear**.</span><span class="sxs-lookup"><span data-stu-id="886b7-234">Click **Create**.</span></span>

## <a name="create-queries-to-transform-real-time-data"></a><span data-ttu-id="886b7-235">Creación de consultas para transformar datos en tiempo real</span><span class="sxs-lookup"><span data-stu-id="886b7-235">Create queries to transform real-time data</span></span>

<span data-ttu-id="886b7-236">En este momento, tiene un trabajo de Stream Analytics configurado para leer un flujo de datos entrantes.</span><span class="sxs-lookup"><span data-stu-id="886b7-236">At this point, you have a Stream Analytics job set up to read an incoming data stream.</span></span> <span data-ttu-id="886b7-237">El siguiente paso consiste en crear una transformación que analice los datos en tiempo real.</span><span class="sxs-lookup"><span data-stu-id="886b7-237">The next step is to create a transformation that analyzes the data in real time.</span></span> <span data-ttu-id="886b7-238">Para ello, cree una consulta.</span><span class="sxs-lookup"><span data-stu-id="886b7-238">You do this by creating a query.</span></span> <span data-ttu-id="886b7-239">Stream Analytics admite un modelo de consulta declarativo sencillo que describe las transformaciones para el procesamiento en tiempo real.</span><span class="sxs-lookup"><span data-stu-id="886b7-239">Stream Analytics supports a simple, declarative query model that describes transformations for real-time processing.</span></span> <span data-ttu-id="886b7-240">Las consultas usan un lenguaje de tipo SQL que tiene algunas extensiones específicas de Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="886b7-240">The queries use a SQL-like language that has some extensions specific to stream analytics.</span></span> 

<span data-ttu-id="886b7-241">Una consulta muy sencilla bastaría para leer todos los datos entrantes.</span><span class="sxs-lookup"><span data-stu-id="886b7-241">A very simple query might simply read all the incoming data.</span></span> <span data-ttu-id="886b7-242">Pero, a menudo se crean consultas que buscan datos concretos o relaciones en los datos.</span><span class="sxs-lookup"><span data-stu-id="886b7-242">However, you often create queries that look for specific data or for relationships in the data.</span></span> <span data-ttu-id="886b7-243">En esta sección del tutorial, creará y probará varias consultas para aprender algunas formas en las que puede transformar un flujo de entrada para su análisis.</span><span class="sxs-lookup"><span data-stu-id="886b7-243">In this section of the tutorial, you will create and test several queries to learn a few ways in which you can transform an input stream for analysis.</span></span> 

<span data-ttu-id="886b7-244">Las consultas que se creen aquí solo mostrarán los datos transformados en la pantalla.</span><span class="sxs-lookup"><span data-stu-id="886b7-244">The queries you create here will just display the transformed data to the screen.</span></span> <span data-ttu-id="886b7-245">En una sección posterior, configurará un receptor de salida y una consulta que escriba los datos transformados en ese receptor.</span><span class="sxs-lookup"><span data-stu-id="886b7-245">In a later section, you'll configure an output sink and a query that writes the transformed data to that sink.</span></span>

<span data-ttu-id="886b7-246">Para obtener más información sobre el lenguaje, consulte la [Referencia de lenguaje de consulta de Azure Stream Analytics](https://msdn.microsoft.com/library/dn834998.aspx).</span><span class="sxs-lookup"><span data-stu-id="886b7-246">To learn more about the language, see the [Azure Stream Analytics Query Language Reference](https://msdn.microsoft.com/library/dn834998.aspx).</span></span>

### <a name="get-sample-data-for-testing-queries"></a><span data-ttu-id="886b7-247">Obtención de datos de muestra para probar las consultas</span><span class="sxs-lookup"><span data-stu-id="886b7-247">Get sample data for testing queries</span></span>

<span data-ttu-id="886b7-248">La aplicación TelcoGenerator envía registros de llamada al centro de eventos y el trabajo de Stream Analytics se configura para leer los datos del centro de eventos.</span><span class="sxs-lookup"><span data-stu-id="886b7-248">The TelcoGenerator app is sending call records to the event hub, and your Stream Analytics job is configured to read from the event hub.</span></span> <span data-ttu-id="886b7-249">Puede unas una consulta para probar el trabajo y asegurarse de que lee correctamente.</span><span class="sxs-lookup"><span data-stu-id="886b7-249">You can use a query to test the job to make sure that it's reading correctly.</span></span> <span data-ttu-id="886b7-250">Para probar una consulta en la consola de Azure, necesita datos de muestra.</span><span class="sxs-lookup"><span data-stu-id="886b7-250">To  test a query in the Azure console, you need sample data.</span></span> <span data-ttu-id="886b7-251">En este tutorial, podrá extraer datos de muestra del flujo que entra en el centro de eventos.</span><span class="sxs-lookup"><span data-stu-id="886b7-251">For this walkthrough, you'll extract sample data from the stream that's coming into the event hub.</span></span>

1. <span data-ttu-id="886b7-252">Asegúrese de que la aplicación TelcoGenerator se ejecuta y genera registros de llamada.</span><span class="sxs-lookup"><span data-stu-id="886b7-252">Make sure that the TelcoGenerator app is running and producing call records.</span></span>
2. <span data-ttu-id="886b7-253">En el portal, vuelva a la hoja del trabajo de Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="886b7-253">In the portal, return to the Streaming Analytics job blade.</span></span> <span data-ttu-id="886b7-254">(Si ha cerrado la hoja, busque `sa_frauddetection_job_demo` en la hoja **Todos los recursos**).</span><span class="sxs-lookup"><span data-stu-id="886b7-254">(If you closed the blade, search for `sa_frauddetection_job_demo` in the **All resources** blade.)</span></span>
3. <span data-ttu-id="886b7-255">Haga clic en el cuadro **Consulta**.</span><span class="sxs-lookup"><span data-stu-id="886b7-255">Click the **Query** box.</span></span> <span data-ttu-id="886b7-256">Azure muestra las entradas y salidas que están configuradas para el trabajo y le permite crear una consulta que permite transformar el flujo de entrada a medida que se envía a la salida.</span><span class="sxs-lookup"><span data-stu-id="886b7-256">Azure lists the inputs and outputs that are configured for the job, and lets you create a query that lets you transform the input stream as it is sent to the output.</span></span>
4. <span data-ttu-id="886b7-257">En la hoja **Consulta**, haga clic en los puntos que aparecen junto a la entrada `CallStream` y seleccione **Datos de ejemplo de la entrada**.</span><span class="sxs-lookup"><span data-stu-id="886b7-257">In the **Query** blade, click the dots next to the `CallStream` input and then select **Sample data from input**.</span></span>

    ![Opciones de menú para usar datos de muestra en la entrada del trabajo de Stream Analytics, con la opción "Datos de ejemplo de la entrada" seleccionada](./media/stream-analytics-real-time-fraud-detection/stream-analytics-create-sample-data-from-input.png)

    <span data-ttu-id="886b7-259">Se abrirá una hoja que permite especificar cuántos datos de muestra quiere obtener, para lo que se define el tiempo durante el que se lee el flujo de entrada.</span><span class="sxs-lookup"><span data-stu-id="886b7-259">This opens a blade that lets you specify how much sample data to get, defined in terms of how long to read the input stream.</span></span>

5. <span data-ttu-id="886b7-260">Establezca **Minutos** en 3 y haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="886b7-260">Set **Minutes** to 3 and then click **OK**.</span></span> 
    
    ![Opciones de muestreo del flujo de entrada, con "3 minutos" seleccionada.](./media/stream-analytics-real-time-fraud-detection/stream-analytics-input-create-sample-data.png)

    <span data-ttu-id="886b7-262">Azure muestrea los datos del flujo de entrada correspondientes a tres minutos y le avisa cuando los datos de muestra están listos.</span><span class="sxs-lookup"><span data-stu-id="886b7-262">Azure samples 3 minutes' worth of data from the input stream and notifies you when the sample data is ready.</span></span> <span data-ttu-id="886b7-263">(Tardará unos minutos).</span><span class="sxs-lookup"><span data-stu-id="886b7-263">(This takes a short while.)</span></span> 

<span data-ttu-id="886b7-264">Los datos de muestra se almacenan temporalmente y están disponibles mientras tenga abierta la ventana de consulta.</span><span class="sxs-lookup"><span data-stu-id="886b7-264">The sample data is stored temporarily and is available while you have the query window open.</span></span> <span data-ttu-id="886b7-265">Si cierra la ventana de consulta, los datos de muestra se descartan y tendrá que crear un nuevo conjunto de datos de muestra.</span><span class="sxs-lookup"><span data-stu-id="886b7-265">If you close the query window, the sample data is discarded, and you'll have to create a new set of sample data.</span></span> 

<span data-ttu-id="886b7-266">También puede obtener un archivo .json que contiene datos de ejemplo [en GitHub](https://github.com/Azure/azure-stream-analytics/blob/master/Sample%20Data/telco.json) y luego cargar ese archivo .json para usarlo como datos de muestra para la entrada de `CallStream`.</span><span class="sxs-lookup"><span data-stu-id="886b7-266">As an alternative, you can get a .json file that has sample data in it [from GitHub](https://github.com/Azure/azure-stream-analytics/blob/master/Sample%20Data/telco.json), and then upload that .json file to use as sample data for the `CallStream` input .</span></span> 

### <a name="test-using-a-pass-through-query"></a><span data-ttu-id="886b7-267">Prueba con una consulta de paso a través</span><span class="sxs-lookup"><span data-stu-id="886b7-267">Test using a pass-through query</span></span>

<span data-ttu-id="886b7-268">Si quiere archivar todos los eventos, puede usar una consulta de paso a través para leer todos los campos de la carga útil del evento.</span><span class="sxs-lookup"><span data-stu-id="886b7-268">If you want to archive every event, you can use a pass-through query to read all the fields in the payload of the event.</span></span>

1. <span data-ttu-id="886b7-269">En la ventana Consulta, escriba la consulta siguiente:</span><span class="sxs-lookup"><span data-stu-id="886b7-269">In the query window, enter this query:</span></span>

        SELECT 
            *
        FROM 
            CallStream

    >[!NOTE]
    ><span data-ttu-id="886b7-270">Al igual que con SQL, las palabras clave no distinguen entre mayúsculas y minúsculas y un espacio en blanco no es significativo.</span><span class="sxs-lookup"><span data-stu-id="886b7-270">As with SQL, keywords are not case sensitive, and whitespace is not significant.</span></span>

    <span data-ttu-id="886b7-271">En esta consulta, `CallStream` es el alias que especificó al crear la entrada.</span><span class="sxs-lookup"><span data-stu-id="886b7-271">In this query, `CallStream` is the alias that you specified when you created the input.</span></span> <span data-ttu-id="886b7-272">Si ha usado otro alias, use ese nombre en su lugar.</span><span class="sxs-lookup"><span data-stu-id="886b7-272">If you used a different alias, use that name instead.</span></span>

2. <span data-ttu-id="886b7-273">Haga clic en **Probar**.</span><span class="sxs-lookup"><span data-stu-id="886b7-273">Click **Test**.</span></span>

    <span data-ttu-id="886b7-274">El trabajo de Stream Analytics ejecuta la consulta en los datos de muestra y presenta la salida en la parte inferior de la ventana.</span><span class="sxs-lookup"><span data-stu-id="886b7-274">The Stream Analytics job runs the query against the sample data and displays the output at the bottom of the window.</span></span> <span data-ttu-id="886b7-275">Esto indica que el centro de eventos y el trabajo de Stream Analytics están configurados correctamente.</span><span class="sxs-lookup"><span data-stu-id="886b7-275">This tells you that the event hub and the Streaming Analytics job are configured correctly.</span></span> <span data-ttu-id="886b7-276">(Como ya se ha señalado, más adelante creará un receptor de salida en el que la consulta pueda escribir los datos).</span><span class="sxs-lookup"><span data-stu-id="886b7-276">(As noted, later you'll create an output sink that the query can write data to.)</span></span>

    ![Salida del trabajo de Stream Analytics que muestra 73 registros generados](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-sample-output.png)

    <span data-ttu-id="886b7-278">El número exacto de registros que aparecen variará en función de los registros que se hayan capturado durante el muestreo de tres minutos.</span><span class="sxs-lookup"><span data-stu-id="886b7-278">The exact number of records you see will depend on how many records were captured in your 3-minute sample.</span></span>
 
### <a name="reduce-the-number-of-fields-using-a-column-projection"></a><span data-ttu-id="886b7-279">Reducción del número de campos mediante una proyección de columna</span><span class="sxs-lookup"><span data-stu-id="886b7-279">Reduce the number of fields using a column projection</span></span>

<span data-ttu-id="886b7-280">En muchos casos, el análisis no necesita todas las columnas del flujo de entrada.</span><span class="sxs-lookup"><span data-stu-id="886b7-280">In many cases, your analysis doesn't need all the columns from the input stream.</span></span> <span data-ttu-id="886b7-281">Puede usar una consulta que proyecte un conjunto de campos devueltos más pequeño que la consulta de paso a través.</span><span class="sxs-lookup"><span data-stu-id="886b7-281">You can use a query to project a smaller set of returned fields than in the pass-through query.</span></span>

1. <span data-ttu-id="886b7-282">Cambie la consulta en el editor de código a:</span><span class="sxs-lookup"><span data-stu-id="886b7-282">Change the query in the code editor to the following:</span></span>

        SELECT CallRecTime, SwitchNum, CallingIMSI, CallingNum, CalledNum 
        FROM 
            CallStream

2. <span data-ttu-id="886b7-283">Haga clic de nuevo en **Probar**.</span><span class="sxs-lookup"><span data-stu-id="886b7-283">Click **Test** again.</span></span> 

    ![Salida del trabajo de Stream Analytics correspondiente a la proyección que muestra 25 registros generados](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-sample-output-projection.png)
 
### <a name="count-incoming-calls-by-region-tumbling-window-with-aggregation"></a><span data-ttu-id="886b7-285">Recuento de llamadas entrantes por región: ventana de saltos de tamaño constante con agregación</span><span class="sxs-lookup"><span data-stu-id="886b7-285">Count incoming calls by region: Tumbling window with aggregation</span></span>

<span data-ttu-id="886b7-286">Suponga que quiere saber el número de llamadas entrantes por región.</span><span class="sxs-lookup"><span data-stu-id="886b7-286">Suppose you want to count the number of incoming calls per region.</span></span> <span data-ttu-id="886b7-287">En los datos de streaming, si se quiere ejecutar funciones de agregado como el recuento, hay que segmentar el flujo en unidades temporales (ya que el flujo en sí es de hecho ilimitado).</span><span class="sxs-lookup"><span data-stu-id="886b7-287">In streaming data, when you want to perform aggregate functions like counting, you need to segment the stream into temporal units (since the data stream itself is effectively endless).</span></span> <span data-ttu-id="886b7-288">Para ello, use una [función de ventana](stream-analytics-window-functions.md) de Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="886b7-288">You do this using a Streaming Analytics [window function](stream-analytics-window-functions.md).</span></span> <span data-ttu-id="886b7-289">Luego puede trabajar con los datos contenidos en esa ventana como unidad.</span><span class="sxs-lookup"><span data-stu-id="886b7-289">You can then work with the data inside that window as a unit.</span></span>

<span data-ttu-id="886b7-290">Para esta transformación, se busca una secuencia de ventanas temporales que no se superpongan; cada ventana tendrá un conjunto discreto de datos que se pueden agrupar y agregar.</span><span class="sxs-lookup"><span data-stu-id="886b7-290">For this transformation, you want a sequence of temporal windows that don't overlap—each window will have a discrete set of data that you can group and aggregate.</span></span> <span data-ttu-id="886b7-291">Este tipo de ventana se denomina *ventana de saltos de tamaño constante*.</span><span class="sxs-lookup"><span data-stu-id="886b7-291">This type of window is referred to as a *Tumbling window* .</span></span> <span data-ttu-id="886b7-292">En la ventana de saltos de tamaño constante, puede obtener el recuento de las llamadas entrantes agrupadas por `SwitchNum`, que representa el país donde se ha originado la llamada.</span><span class="sxs-lookup"><span data-stu-id="886b7-292">Within the Tumbling window, you can get a count of the incoming calls grouped by `SwitchNum`, which represents the country where the call originated.</span></span> 

1. <span data-ttu-id="886b7-293">Cambie la consulta en el editor de código a:</span><span class="sxs-lookup"><span data-stu-id="886b7-293">Change the query in the code editor to the following:</span></span>

        SELECT 
            System.Timestamp as WindowEnd, SwitchNum, COUNT(*) as CallCount 
        FROM
            CallStream TIMESTAMP BY CallRecTime 
        GROUP BY TUMBLINGWINDOW(s, 5), SwitchNum

    <span data-ttu-id="886b7-294">En esta consulta se usa la palabra clave `Timestamp By` en la cláusula `FROM` para especificar el campo de marca de tiempo del flujo de entrada que se usa para definir la ventana de saltos de tamaño constante.</span><span class="sxs-lookup"><span data-stu-id="886b7-294">This query uses the `Timestamp By` keyword in the `FROM` clause to specify which timestamp field in the input stream to use to define the Tumbling window.</span></span> <span data-ttu-id="886b7-295">En este caso, la ventana divide los datos en segmentos por el campo `CallRecTime` de cada registro.</span><span class="sxs-lookup"><span data-stu-id="886b7-295">In this case, the window divides the data into segments by the `CallRecTime` field in each record.</span></span> <span data-ttu-id="886b7-296">Si no se ha especificado este campo, la operación de ventana usa la hora en la que cada evento llega al centro de eventos.</span><span class="sxs-lookup"><span data-stu-id="886b7-296">(If no field is specified, the windowing operation uses the time that each event arrives at the event hub.</span></span> <span data-ttu-id="886b7-297">Vea "Tiempo de llegada frente a tiempo de aplicación" en [Referencia de lenguaje de consulta de Stream Analytics](https://msdn.microsoft.com/library/azure/dn834998.aspx).</span><span class="sxs-lookup"><span data-stu-id="886b7-297">See "Arrival Time Vs Application Time" in [Stream Analytics Query Language Reference](https://msdn.microsoft.com/library/azure/dn834998.aspx).</span></span> 

    <span data-ttu-id="886b7-298">La proyección incluye `System.Timestamp`, que devuelve una marca de tiempo para el final de cada ventana.</span><span class="sxs-lookup"><span data-stu-id="886b7-298">The projection includes `System.Timestamp`, which returns a timestamp for the end of each window.</span></span> 

    <span data-ttu-id="886b7-299">Para especificar que desea usar una ventana de saltos de tamaño constante, use la función [TUMBLINGWINDOW](https://msdn.microsoft.com/library/dn835055.aspx) en la cláusula `GROUP BY `.</span><span class="sxs-lookup"><span data-stu-id="886b7-299">To specify that you want to use a Tumbling window, you use the [TUMBLINGWINDOW](https://msdn.microsoft.com/library/dn835055.aspx) function in the `GROUP BY `clause.</span></span> <span data-ttu-id="886b7-300">En la función, especifique una unidad de tiempo (entre un microsegundo y un día) y un tamaño de ventana (el número de unidades).</span><span class="sxs-lookup"><span data-stu-id="886b7-300">In the function, you specify a time unit (anywhere from a microsecond to a day) and a window size (how many units).</span></span> <span data-ttu-id="886b7-301">En este ejemplo, la ventana de saltos de tamaño constante se compone de intervalos de cinco segundos, por lo que se obtendrá un recuento por país de las llamadas correspondientes a cada cinco segundos.</span><span class="sxs-lookup"><span data-stu-id="886b7-301">In this example, the Tumbling window consists of 5-second intervals, so you will get a count by country for every 5 seconds' worth of calls.</span></span>

2. <span data-ttu-id="886b7-302">Haga clic de nuevo en **Probar**.</span><span class="sxs-lookup"><span data-stu-id="886b7-302">Click **Test** again.</span></span> <span data-ttu-id="886b7-303">En los resultados, observe que las marcas de tiempo que aparecen en **WindowEnd** reflejan incrementos de cinco segundos.</span><span class="sxs-lookup"><span data-stu-id="886b7-303">In the results, notice that the timestamps under **WindowEnd** are in 5-second increments.</span></span>

    ![Salida del trabajo de Stream Analytics correspondiente a la agregación que muestra 13 registros generados](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-sample-output-aggregation.png)
 
### <a name="detect-sim-fraud-using-a-self-join"></a><span data-ttu-id="886b7-305">Detección de fraudes de SIM mediante una autocombinación</span><span class="sxs-lookup"><span data-stu-id="886b7-305">Detect SIM fraud using a self-join</span></span>

<span data-ttu-id="886b7-306">Para este ejemplo, podemos considerar que el uso fraudulento sean llamadas que se originan desde el mismo usuario, pero en diferentes ubicaciones en intervalos inferiores a cinco segundos entre una y otra.</span><span class="sxs-lookup"><span data-stu-id="886b7-306">For this example, we can consider fraudulent usage to be calls that originate from the same user but in different locations within 5 seconds of one another.</span></span> <span data-ttu-id="886b7-307">Por ejemplo, el mismo usuario no puede legítimamente realizar una llamada desde Estados Unidos y Australia al mismo tiempo.</span><span class="sxs-lookup"><span data-stu-id="886b7-307">For example, the same user can't legitimately make a call from the US and Australia at the same time.</span></span> 

<span data-ttu-id="886b7-308">Para comprobar estos casos, puede usar una autocombinación de los datos de streaming que combine el flujo consigo mismo en función del valor `CallRecTime`.</span><span class="sxs-lookup"><span data-stu-id="886b7-308">To check for these cases, you can use a self-join of the streaming data to join the stream to itself based on the `CallRecTime` value.</span></span> <span data-ttu-id="886b7-309">Luego puede buscar los registros de llamada en los que el valor `CallingIMSI` (el número donde se origina) sea el mismo, pero el valor `SwitchNum` (país de origen) no lo sea.</span><span class="sxs-lookup"><span data-stu-id="886b7-309">You can then look for call records where the `CallingIMSI` value (the originating number) is the same, but the `SwitchNum` value (country of origin) is not the same.</span></span>

<span data-ttu-id="886b7-310">Cuando use una combinación con datos de streaming, la combinación debe especificar algunos límites en la diferencia de tiempo que puede haber entre filas coincidentes.</span><span class="sxs-lookup"><span data-stu-id="886b7-310">When you use a join with streaming data, the join must provide some limits on how far the matching rows can be separated in time.</span></span> <span data-ttu-id="886b7-311">(Como ya se ha señalado, los datos de streaming son de hecho ilimitados). Los límites de tiempo para la relación se especifican en la cláusula `ON` de la combinación, con la función `DATEDIFF`.</span><span class="sxs-lookup"><span data-stu-id="886b7-311">(As noted earlier, the streaming data is effectively endless.) The time bounds for the relationship are specified inside the `ON` clause of the join, using the `DATEDIFF` function .</span></span> <span data-ttu-id="886b7-312">En este caso, la combinación se basa en un intervalo de cinco segundos entre datos de llamada.</span><span class="sxs-lookup"><span data-stu-id="886b7-312">In this case, the join is based on a 5-second interval of call data .</span></span>

1. <span data-ttu-id="886b7-313">Cambie la consulta en el editor de código a:</span><span class="sxs-lookup"><span data-stu-id="886b7-313">Change the query in the code editor to the following:</span></span> 

        SELECT  System.Timestamp as Time, 
            CS1.CallingIMSI, 
            CS1.CallingNum as CallingNum1, 
            CS2.CallingNum as CallingNum2, 
            CS1.SwitchNum as Switch1, 
            CS2.SwitchNum as Switch2 
        FROM CallStream CS1 TIMESTAMP BY CallRecTime 
            JOIN CallStream CS2 TIMESTAMP BY CallRecTime 
            ON CS1.CallingIMSI = CS2.CallingIMSI 
            AND DATEDIFF(ss, CS1, CS2) BETWEEN 1 AND 5 
        WHERE CS1.SwitchNum != CS2.SwitchNum

    <span data-ttu-id="886b7-314">Esta consulta es similar a cualquier instrucción SQL JOIN, salvo por la función `DATEDIFF` en la combinación.</span><span class="sxs-lookup"><span data-stu-id="886b7-314">This query is like any SQL join except for the `DATEDIFF` function in the join.</span></span> <span data-ttu-id="886b7-315">Se trata de una versión de `DATEDIFF` que es específica de Stream Analytics y debe aparecer en la cláusula `ON...BETWEEN`.</span><span class="sxs-lookup"><span data-stu-id="886b7-315">This is a version of `DATEDIFF` that's specific to Streaming Analytics, and it must appear in the `ON...BETWEEN` clause.</span></span> <span data-ttu-id="886b7-316">Los parámetros son una unidad de tiempo (segundos en este ejemplo) y los alias de los dos orígenes de la combinación.</span><span class="sxs-lookup"><span data-stu-id="886b7-316">The parameters are a time unit (seconds in this example) and the aliases of the two sources for the join.</span></span> <span data-ttu-id="886b7-317">(Es distinta de la función `DATEDIFF` SQL estándar).</span><span class="sxs-lookup"><span data-stu-id="886b7-317">(This is different from the standard SQL `DATEDIFF` function.)</span></span> 

    <span data-ttu-id="886b7-318">La cláusula `WHERE` incluye la condición que marca la llamada fraudulenta: los conmutadores de origen no son iguales.</span><span class="sxs-lookup"><span data-stu-id="886b7-318">The `WHERE` clause includes the condition that flags the fraudulent call: the originating switches are not the same.</span></span> 

2. <span data-ttu-id="886b7-319">Haga clic de nuevo en **Probar**.</span><span class="sxs-lookup"><span data-stu-id="886b7-319">Click **Test** again.</span></span> 

    ![Salida del trabajo de Stream Analytics correspondiente a la autocombinación que muestra seis registros generados](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-sample-output-self-join.png)

3. <span data-ttu-id="886b7-321">Haga clic en **Guardar**.</span><span class="sxs-lookup"><span data-stu-id="886b7-321">Click **Save**.</span></span> <span data-ttu-id="886b7-322">Con esto guarda la consulta de autocombinación como parte del trabajo de Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="886b7-322">This saves the self-join query as part of the Streaming Analytics job.</span></span> <span data-ttu-id="886b7-323">(No guarda los datos de muestra).</span><span class="sxs-lookup"><span data-stu-id="886b7-323">(It doesn't save the sample data.)</span></span>

    ![Almacenamiento del trabajo de Stream Analytics](./media/stream-analytics-real-time-fraud-detection/stream-analytics-query-editor-save-button-new-portal.png)

## <a name="create-an-output-sink-to-store-transformed-data"></a><span data-ttu-id="886b7-325">Creación de un receptor de salida para almacenar los datos transformados</span><span class="sxs-lookup"><span data-stu-id="886b7-325">Create an output sink to store transformed data</span></span>

<span data-ttu-id="886b7-326">Se ha definido un flujo de eventos, una entrada de centro de eventos para la ingesta de eventos y una consulta para realizar una transformación en el flujo de datos.</span><span class="sxs-lookup"><span data-stu-id="886b7-326">You've defined an event stream, an event hub input to ingest events, and a query to perform a transformation over the stream.</span></span> <span data-ttu-id="886b7-327">El último paso es definir un receptor de salida para el trabajo (es decir, un lugar en el que escribir el flujo transformado).</span><span class="sxs-lookup"><span data-stu-id="886b7-327">The last step is to define an output sink for the job—that is, a place to write the transformed stream to.</span></span> 

<span data-ttu-id="886b7-328">Puede usar muchos recursos como receptores de salida: una base de datos de SQL Server, Table Storage, Data Lake Store, Power BI e incluso otro centro de eventos.</span><span class="sxs-lookup"><span data-stu-id="886b7-328">You can use many resources as output sinks—a SQL Server database, table storage, Data Lake storage, Power BI, and even another event hub.</span></span> <span data-ttu-id="886b7-329">En este tutorial, escribirá un flujo de datos en Azure Blob Storage, que es una opción habitual para recopilar información de eventos para su posterior análisis, ya que acepta datos no estructurados.</span><span class="sxs-lookup"><span data-stu-id="886b7-329">For this tutorial, you'll write the stream to Azure Blob Storage, which is a typical choice for collecting event information for later analysis, since it accommodates unstructured data .</span></span>

<span data-ttu-id="886b7-330">Si ya tiene una cuenta de Blob Storage, puede utilizarla.</span><span class="sxs-lookup"><span data-stu-id="886b7-330">If you have an existing blob storage account, you can use that.</span></span> <span data-ttu-id="886b7-331">Aquí le mostraremos cómo crear una cuenta de Storage solo para este tutorial.</span><span class="sxs-lookup"><span data-stu-id="886b7-331">For this tutorial, we'll show you how to create a new storage account just for this tutorial.</span></span>

### <a name="create-an-azure-blob-storage-account"></a><span data-ttu-id="886b7-332">Creación de una cuenta de Azure Blob Storage</span><span class="sxs-lookup"><span data-stu-id="886b7-332">Create an Azure Blob Storage account</span></span>

1. <span data-ttu-id="886b7-333">En Azure Portal, vuelva a la hoja del trabajo de Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="886b7-333">In the Azure portal, return to the Streaming Analytics job blade.</span></span> <span data-ttu-id="886b7-334">(Si ha cerrado la hoja, busque `sa_frauddetection_job_demo` en la hoja **Todos los recursos**).</span><span class="sxs-lookup"><span data-stu-id="886b7-334">(If you closed the blade, search for `sa_frauddetection_job_demo` in the **All resources** blade.)</span></span>
2. <span data-ttu-id="886b7-335">En la sección **Topología de trabajo**, haga clic en el cuadro **Salida**.</span><span class="sxs-lookup"><span data-stu-id="886b7-335">In the **Job Topology** section, click the **Output** box.</span></span> 
3. <span data-ttu-id="886b7-336">En la hoja **Salidas**, haga clic en **+&nbsp;Agregar** y rellene la hoja con estos valores:</span><span class="sxs-lookup"><span data-stu-id="886b7-336">In the **Outputs** blade, click **+&nbsp;Add** and then fill out the blade with these values:</span></span>

    * <span data-ttu-id="886b7-337">**Alias de salida**: use el nombre `CallStream-FraudulentCalls`.</span><span class="sxs-lookup"><span data-stu-id="886b7-337">**Output alias**: Use the name `CallStream-FraudulentCalls`.</span></span> 
    * <span data-ttu-id="886b7-338">**Receptor**: seleccione **Blob Storage**.</span><span class="sxs-lookup"><span data-stu-id="886b7-338">**Sink**: Select **Blob storage**.</span></span>
    * <span data-ttu-id="886b7-339">**Opciones de importación**: seleccione **Usar almacenamiento de blobs de la suscripción actual**.</span><span class="sxs-lookup"><span data-stu-id="886b7-339">**Import options**: Select **Use blob storage from current subscription**.</span></span>
    * <span data-ttu-id="886b7-340">**Cuenta de Storage**.</span><span class="sxs-lookup"><span data-stu-id="886b7-340">**Storage account**.</span></span> <span data-ttu-id="886b7-341">Seleccione **Crear nueva cuenta de almacenamiento**.</span><span class="sxs-lookup"><span data-stu-id="886b7-341">Select **Create new storage account.**</span></span>
    * <span data-ttu-id="886b7-342">**Cuenta de Storage** (segundo cuadro).</span><span class="sxs-lookup"><span data-stu-id="886b7-342">**Storage account** (second box).</span></span> <span data-ttu-id="886b7-343">Escriba `YOURNAMEsademo`, donde `YOURNAME` sea su nombre u otra cadena única.</span><span class="sxs-lookup"><span data-stu-id="886b7-343">Enter `YOURNAMEsademo`, where `YOURNAME` is your name or another unique string.</span></span> <span data-ttu-id="886b7-344">El nombre solo puede incluir letras minúsculas y números y ser único en Azure.</span><span class="sxs-lookup"><span data-stu-id="886b7-344">The name can use only lowercase letters and numbers, and it must be unique across Azure.</span></span> 
    * <span data-ttu-id="886b7-345">**Contenedor**.</span><span class="sxs-lookup"><span data-stu-id="886b7-345">**Container**.</span></span> <span data-ttu-id="886b7-346">Escriba `sa-fraudulentcalls-demo`.</span><span class="sxs-lookup"><span data-stu-id="886b7-346">Enter `sa-fraudulentcalls-demo`.</span></span>
    <span data-ttu-id="886b7-347">El nombre de la cuenta de almacenamiento y el nombre del contenedor se usan conjuntamente para especificar un URI para la instancia de Blob Storage, similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="886b7-347">The storage account name and container name are used together to provide a URI for the blob storage, like this:</span></span> 

    `http://yournamesademo.blob.core.windows.net/sa-fraudulentcalls-demo/...`
    
    ![Hoja "Nueva salida" del trabajo de Stream Analytics](./media/stream-analytics-real-time-fraud-detection/stream-analytics-create-output-blob-storage-new-console.png)
    
4. <span data-ttu-id="886b7-349">Haga clic en **Crear**.</span><span class="sxs-lookup"><span data-stu-id="886b7-349">Click **Create**.</span></span> 

    <span data-ttu-id="886b7-350">Azure crea la cuenta de almacenamiento y genera una clave automáticamente.</span><span class="sxs-lookup"><span data-stu-id="886b7-350">Azure creates the storage account and generates a key automatically.</span></span> 

5. <span data-ttu-id="886b7-351">Cierre la hoja **Salidas**.</span><span class="sxs-lookup"><span data-stu-id="886b7-351">Close the **Outputs** blade.</span></span> 

## <a name="start-the-streaming-analytics-job"></a><span data-ttu-id="886b7-352">Inicio del trabajo de Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="886b7-352">Start the Streaming Analytics job</span></span>

<span data-ttu-id="886b7-353">El trabajo ya está configurado.</span><span class="sxs-lookup"><span data-stu-id="886b7-353">The job is now configured.</span></span> <span data-ttu-id="886b7-354">Ha especificado una entrada (el centro de eventos), una transformación (la consulta que busca llamadas fraudulentas) y una salida (Blob Storage).</span><span class="sxs-lookup"><span data-stu-id="886b7-354">You've specified an input (the event hub), a transformation (the query to look for fraudulent calls), and an output (blob storage).</span></span> <span data-ttu-id="886b7-355">Ahora puede iniciar el trabajo.</span><span class="sxs-lookup"><span data-stu-id="886b7-355">You can now start the job.</span></span> 

1. <span data-ttu-id="886b7-356">Asegúrese de que la aplicación TelcoGenerator se ejecuta.</span><span class="sxs-lookup"><span data-stu-id="886b7-356">Make sure the TelcoGenerator app is running.</span></span>

2. <span data-ttu-id="886b7-357">En la hoja del trabajo, haga clic en **Iniciar**.</span><span class="sxs-lookup"><span data-stu-id="886b7-357">In the job blade, click **Start**.</span></span>

    ![Inicio del trabajo de Análisis de transmisiones](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-start-output.png)

3. <span data-ttu-id="886b7-359">En la hoja **Iniciar trabajo**, en Hora de inicio de salida del trabajo, seleccione **Ahora**.</span><span class="sxs-lookup"><span data-stu-id="886b7-359">In the **Start job** blade, for Job output start time, select **Now**.</span></span> 

4. <span data-ttu-id="886b7-360">Haga clic en **Iniciar**.</span><span class="sxs-lookup"><span data-stu-id="886b7-360">Click **Start**.</span></span> 

    ![Hoja "Iniciar trabajo" del trabajo de Stream Analytics](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-start-job-blade.png)

    <span data-ttu-id="886b7-362">Azure le avisa cuando se ha iniciado el trabajo y, en la hoja del trabajo, el estado aparece como **En ejecución**.</span><span class="sxs-lookup"><span data-stu-id="886b7-362">Azure notifies you when the job has started, and in the job blade, the status is displayed as **Running**.</span></span>

    ![Estado del trabajo de Stream Analytics que muestra "En ejecución"](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-running-status.png)
    

## <a name="examine-the-transformed-data"></a><span data-ttu-id="886b7-364">Examen de los datos transformados</span><span class="sxs-lookup"><span data-stu-id="886b7-364">Examine the transformed data</span></span>

<span data-ttu-id="886b7-365">Ya dispone de un trabajo de Stream Analytics completo.</span><span class="sxs-lookup"><span data-stu-id="886b7-365">You now have a complete Streaming Analytics job.</span></span> <span data-ttu-id="886b7-366">El trabajo examina un flujo de metadatos de llamada telefónica, busca llamadas telefónicas fraudulentas en tiempo real y escribe información sobre esas llamadas fraudulentas en Storage.</span><span class="sxs-lookup"><span data-stu-id="886b7-366">The job is examining a stream of phone call metadata, looking for fraudulent phone calls in real time, and writing information about those fraudulent calls to storage.</span></span> 

<span data-ttu-id="886b7-367">Para finalizar este tutorial, es posible que quiera ver los datos que captura el trabajo de Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="886b7-367">To complete this tutorial, you might want to look at the data being captured by the Streaming Analytics job.</span></span> <span data-ttu-id="886b7-368">Los datos se escriben en Azure Blog Storage in fragmentos (archivos).</span><span class="sxs-lookup"><span data-stu-id="886b7-368">The data is being written to Azure Blog Storage in chunks (files).</span></span> <span data-ttu-id="886b7-369">Puede usar cualquier herramienta que lea Azure Blob Storage.</span><span class="sxs-lookup"><span data-stu-id="886b7-369">You can use any tool that reads Azure Blob Storage.</span></span> <span data-ttu-id="886b7-370">Como ya se ha señalado en la sección Requisitos previos, puede usar extensiones de Azure en Visual Studio o utilizar una herramienta como [Explorador de Azure Storage](http://storageexplorer.com/) y [Azure Explorer](http://www.cerebrata.com/products/azure-explorer/introduction).</span><span class="sxs-lookup"><span data-stu-id="886b7-370">As noted in the Prerequisites section, you can use Azure extensions in Visual Studio, or you can use a tool like [Azure Storage Explorer](http://storageexplorer.com/) or [Azure Explorer](http://www.cerebrata.com/products/azure-explorer/introduction).</span></span> 

<span data-ttu-id="886b7-371">Al examinar el contenido de un archivo en Blob Storage, se ve algo similar a esto:</span><span class="sxs-lookup"><span data-stu-id="886b7-371">When you examine the contents of a file in blob storage, you see something like the following :</span></span>

![Azure Blob Storage con salida de Streaming Analytics](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-blob-storage-view.png)
 

## <a name="clean-up-resources"></a><span data-ttu-id="886b7-373">Limpieza de recursos</span><span class="sxs-lookup"><span data-stu-id="886b7-373">Clean up resources</span></span>

<span data-ttu-id="886b7-374">Existen otros artículos que continúan con el escenario de detección de fraudes y usan los recursos creados en este tutorial.</span><span class="sxs-lookup"><span data-stu-id="886b7-374">We have additional articles that continue with the fraud-detection scenario and that use the resources that you've created in this tutorial.</span></span> <span data-ttu-id="886b7-375">Si quiere seguir, vea las sugerencias que se ofrecen más adelante en **Pasos siguientes**.</span><span class="sxs-lookup"><span data-stu-id="886b7-375">If you want to continue, see the suggestions under **Next steps** later.</span></span>

<span data-ttu-id="886b7-376">Pero, si ha terminado y no necesita los recursos que ha creado, puede eliminarlos para no incurrir en cargos de Azure innecesarios.</span><span class="sxs-lookup"><span data-stu-id="886b7-376">However, if you're done and you don't need the resources you've created, you can delete them so that you don't incur unnecessary Azure charges.</span></span> <span data-ttu-id="886b7-377">En ese caso, se recomienda hacer lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="886b7-377">In that case, we suggest that you do the following:</span></span>

1. <span data-ttu-id="886b7-378">Detenga el trabajo de Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="886b7-378">Stop the Streaming Analytics job.</span></span> <span data-ttu-id="886b7-379">En la parte superior de la hoja **Trabajos**, haga clic en **Detener**.</span><span class="sxs-lookup"><span data-stu-id="886b7-379">In the **Jobs** blade, click **Stop** at the top.</span></span>
2. <span data-ttu-id="886b7-380">Detenga la aplicación Telco Generator.</span><span class="sxs-lookup"><span data-stu-id="886b7-380">Stop the Telco Generator app.</span></span> <span data-ttu-id="886b7-381">En la ventana de comandos donde inició la aplicación, presione Ctrl+C.</span><span class="sxs-lookup"><span data-stu-id="886b7-381">In the command window where you started the app, press Ctrl+C.</span></span>
3. <span data-ttu-id="886b7-382">Si ha creado una cuenta de Blob Storage exclusivamente para este tutorial, elimínela.</span><span class="sxs-lookup"><span data-stu-id="886b7-382">If you created a new blob storage account just for this tutorial, delete it.</span></span> 
4. <span data-ttu-id="886b7-383">Elimine el trabajo de Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="886b7-383">Delete the Streaming Analytics job.</span></span>
5. <span data-ttu-id="886b7-384">Elimine el centro de eventos.</span><span class="sxs-lookup"><span data-stu-id="886b7-384">Delete the event hub.</span></span>
6. <span data-ttu-id="886b7-385">Elimine el espacio de nombres del centro de eventos.</span><span class="sxs-lookup"><span data-stu-id="886b7-385">Delete the event hub namespace.</span></span>

## <a name="get-support"></a><span data-ttu-id="886b7-386">Obtención de soporte técnico</span><span class="sxs-lookup"><span data-stu-id="886b7-386">Get support</span></span>

<span data-ttu-id="886b7-387">Para obtener más ayuda, pruebe nuestro [foro de Análisis de transmisiones de Azure](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics).</span><span class="sxs-lookup"><span data-stu-id="886b7-387">For further assistance, try our [Azure Stream Analytics forum](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics).</span></span>

## <a name="next-steps"></a><span data-ttu-id="886b7-388">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="886b7-388">Next steps</span></span>

<span data-ttu-id="886b7-389">Puede seguir este tutorial con los siguientes artículos:</span><span class="sxs-lookup"><span data-stu-id="886b7-389">You can continue this tutorial with the following articles:</span></span>

* <span data-ttu-id="886b7-390">[Stream Analytics y Power BI: panel de análisis en tiempo real de flujo de datos](stream-analytics-power-bi-dashboard.md).</span><span class="sxs-lookup"><span data-stu-id="886b7-390">[Stream Analytics and Power BI: A real-time analytics dashboard for streaming data](stream-analytics-power-bi-dashboard.md).</span></span> <span data-ttu-id="886b7-391">En este artículo se muestra cómo enviar la salida de TelCo del trabajo de Stream Analytics a Power BI para su análisis y visualización en tiempo real.</span><span class="sxs-lookup"><span data-stu-id="886b7-391">This article shows you how to send the TelCo output of the Stream Analytics job to Power BI for real-time visualization and analysis.</span></span>
* <span data-ttu-id="886b7-392">[Almacenamiento de datos desde Azure Stream Analytics Azure Functions con Azure Functions](stream-analytics-functions-redis.md).</span><span class="sxs-lookup"><span data-stu-id="886b7-392">[How to store data from Azure Stream Analytics in an Azure Redis Cache using Azure Functions](stream-analytics-functions-redis.md).</span></span> <span data-ttu-id="886b7-393">En este artículo se muestra cómo utilizar Azure Functions para escribir llamadas fraudulentas en Azure Redis Cache mediante una cola de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="886b7-393">This article shows how to use Azure Functions to write fraudulent calls to an Azure Redis cache via a Service Bus queue.</span></span>

<span data-ttu-id="886b7-394">Para más información sobre Stream Analytics en general, examine los siguientes artículos:</span><span class="sxs-lookup"><span data-stu-id="886b7-394">For more information about Stream Analytics in general, try these articles:</span></span>

* [<span data-ttu-id="886b7-395">Introducción al Análisis de transmisiones de Azure</span><span class="sxs-lookup"><span data-stu-id="886b7-395">Introduction to Azure Stream Analytics</span></span>](stream-analytics-introduction.md)
* [<span data-ttu-id="886b7-396">Escalación de trabajos de Análisis de transmisiones de Azure</span><span class="sxs-lookup"><span data-stu-id="886b7-396">Scale Azure Stream Analytics jobs</span></span>](stream-analytics-scale-jobs.md)
* [<span data-ttu-id="886b7-397">Referencia del lenguaje de consulta de Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="886b7-397">Azure Stream Analytics Query Language Reference</span></span>](https://msdn.microsoft.com/library/azure/dn834998.aspx)
* [<span data-ttu-id="886b7-398">Referencia de API de REST de administración de Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="886b7-398">Azure Stream Analytics Management REST API Reference</span></span>](https://msdn.microsoft.com/library/azure/dn835031.aspx)

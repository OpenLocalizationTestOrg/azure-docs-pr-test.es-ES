---
title: "Compilación de una solución de IoT con Stream Analytics | Microsoft Docs"
description: "Tutorial de introducción a la solución de IoT de Stream Analytics de un escenario de cabinas de peaje."
keywords: "solución de IOT, funciones de ventana"
documentationcenter: 
services: stream-analytics
author: samacha
manager: jhubbard
editor: cgronlun
ms.assetid: a473ea0a-3eaa-4e5b-aaa1-fec7e9069f20
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: samacha
ms.openlocfilehash: a93693ef7d40025fa96846594a8eb525a50b6885
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/18/2017
---
# <a name="build-an-iot-solution-by-using-stream-analytics"></a><span data-ttu-id="6cd28-104">Compilación de una solución de IoT con Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="6cd28-104">Build an IoT solution by using Stream Analytics</span></span>
## <a name="introduction"></a><span data-ttu-id="6cd28-105">Introducción</span><span class="sxs-lookup"><span data-stu-id="6cd28-105">Introduction</span></span>
<span data-ttu-id="6cd28-106">En este tutorial aprenderá a usar Azure Stream Analytics para obtener información de sus datos en tiempo real.</span><span class="sxs-lookup"><span data-stu-id="6cd28-106">In this tutorial, you will learn how to use Azure Stream Analytics to get real-time insights from your data.</span></span> <span data-ttu-id="6cd28-107">Los desarrolladores pueden combinar fácilmente secuencias de datos, como secuencias de clic, registros y eventos generados por el dispositivo, con registros históricos o datos de referencia para obtener información empresarial.</span><span class="sxs-lookup"><span data-stu-id="6cd28-107">Developers can easily combine streams of data, such as click-streams, logs, and device-generated events, with historical records or reference data to derive business insights.</span></span> <span data-ttu-id="6cd28-108">Azure Stream Analytics es un servicio de cálculo de transmisiones en tiempo real totalmente administrado y hospedado en Microsoft Azure que ofrece gran resistencia, baja latencia y escalabilidad, para permitirle ponerse a trabajar en cuestión de minutos.</span><span class="sxs-lookup"><span data-stu-id="6cd28-108">As a fully managed, real-time stream computation service that's hosted in Microsoft Azure, Azure Stream Analytics provides built-in resiliency, low latency, and scalability to get you up and running in minutes.</span></span>

<span data-ttu-id="6cd28-109">Después de completar este tutorial, estará capacitado para lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="6cd28-109">After completing this tutorial, you will be able to:</span></span>

* <span data-ttu-id="6cd28-110">Familiarizarse con el portal de Azure Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="6cd28-110">Familiarize yourself with the Azure Stream Analytics portal.</span></span>
* <span data-ttu-id="6cd28-111">Configurar e implementar un trabajo de streaming.</span><span class="sxs-lookup"><span data-stu-id="6cd28-111">Configure and deploy a streaming job.</span></span>
* <span data-ttu-id="6cd28-112">Señalar los problemas reales y solucionarlos usando el lenguaje de consulta de Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="6cd28-112">Articulate real-world problems and solve them by using the Stream Analytics query language.</span></span>
* <span data-ttu-id="6cd28-113">Desarrollar soluciones de streaming para los clientes usando el lenguaje de consulta de Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="6cd28-113">Develop streaming solutions for your customers by using Stream Analytics with confidence.</span></span>
* <span data-ttu-id="6cd28-114">Usar la experiencia de supervisión y registro para solucionar problemas.</span><span class="sxs-lookup"><span data-stu-id="6cd28-114">Use the monitoring and logging experience to troubleshoot issues.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="6cd28-115">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="6cd28-115">Prerequisites</span></span>
<span data-ttu-id="6cd28-116">Para realizar este tutorial, deberá cumplir los siguientes requisitos previos:</span><span class="sxs-lookup"><span data-stu-id="6cd28-116">You will need the following prerequisites to complete this tutorial:</span></span>

* <span data-ttu-id="6cd28-117">La versión más reciente de [Azure PowerShell](/powershell/azure/overview)</span><span class="sxs-lookup"><span data-stu-id="6cd28-117">The latest version of [Azure PowerShell](/powershell/azure/overview)</span></span>
* <span data-ttu-id="6cd28-118">Visual Studio 2017, 2015 o la versión gratuita de [Visual Studio Community](https://www.visualstudio.com/products/visual-studio-community-vs.aspx)</span><span class="sxs-lookup"><span data-stu-id="6cd28-118">Visual Studio 2017, 2015, or the free [Visual Studio Community](https://www.visualstudio.com/products/visual-studio-community-vs.aspx)</span></span>
* <span data-ttu-id="6cd28-119">[Una suscripción de Azure](https://azure.microsoft.com/pricing/free-trial/)</span><span class="sxs-lookup"><span data-stu-id="6cd28-119">An [Azure subscription](https://azure.microsoft.com/pricing/free-trial/)</span></span>
* <span data-ttu-id="6cd28-120">Privilegios administrativos en el equipo</span><span class="sxs-lookup"><span data-stu-id="6cd28-120">Administrative privileges on the computer</span></span>
* <span data-ttu-id="6cd28-121">Descarga de [TollApp.zip](https://github.com/Azure/azure-stream-analytics/blob/master/Samples/TollApp/TollApp.zip) del Centro de descarga de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="6cd28-121">Download of [TollApp.zip](https://github.com/Azure/azure-stream-analytics/blob/master/Samples/TollApp/TollApp.zip) from the Microsoft Download Center</span></span>
* <span data-ttu-id="6cd28-122">Opcional: código fuente del generador de eventos TollApp de [GitHub](https://aka.ms/azure-stream-analytics-toll-source)</span><span class="sxs-lookup"><span data-stu-id="6cd28-122">Optional: Source code for the TollApp event generator in [GitHub](https://aka.ms/azure-stream-analytics-toll-source)</span></span>

## <a name="scenario-introduction-hello-toll"></a><span data-ttu-id="6cd28-123">Introducción al escenario: peajes</span><span class="sxs-lookup"><span data-stu-id="6cd28-123">Scenario introduction: “Hello, Toll!”</span></span>
<span data-ttu-id="6cd28-124">Una estación de peaje es un fenómeno común.</span><span class="sxs-lookup"><span data-stu-id="6cd28-124">A toll station is a common phenomenon.</span></span> <span data-ttu-id="6cd28-125">Se encuentra en muchas autopistas, puentes y túneles de todo el mundo.</span><span class="sxs-lookup"><span data-stu-id="6cd28-125">You encounter them on many expressways, bridges, and tunnels across the world.</span></span> <span data-ttu-id="6cd28-126">Cada estación de peaje tiene varias cabinas.</span><span class="sxs-lookup"><span data-stu-id="6cd28-126">Each toll station has multiple toll booths.</span></span> <span data-ttu-id="6cd28-127">En cabinas manuales, se detiene y paga el peaje a un operador.</span><span class="sxs-lookup"><span data-stu-id="6cd28-127">At manual booths, you stop to pay the toll to an attendant.</span></span> <span data-ttu-id="6cd28-128">En cabinas automatizadas, un sensor situado en la parte superior de cada cabina escanea una tarjeta RFID que está ubicada en el parabrisas del vehículo al pasar la cabina de peaje.</span><span class="sxs-lookup"><span data-stu-id="6cd28-128">At automated booths, a sensor on top of each booth scans an RFID card that's affixed to the windshield of your vehicle as you pass the toll booth.</span></span> <span data-ttu-id="6cd28-129">Es fácil imaginar el paso de los vehículos a través de estos peajes como si fuera un flujo de eventos sobre los que se pueden realizar operaciones interesantes.</span><span class="sxs-lookup"><span data-stu-id="6cd28-129">It is easy to visualize the passage of vehicles through these toll stations as an event stream over which interesting operations can be performed.</span></span>

![Imagen de automóviles en cabinas de peaje](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image1.jpg)

## <a name="incoming-data"></a><span data-ttu-id="6cd28-131">Datos de entrada</span><span class="sxs-lookup"><span data-stu-id="6cd28-131">Incoming data</span></span>
<span data-ttu-id="6cd28-132">Este tutorial funciona con dos secuencias de datos.</span><span class="sxs-lookup"><span data-stu-id="6cd28-132">This tutorial works with two streams of data.</span></span> <span data-ttu-id="6cd28-133">Los sensores instalados a la entrada y la salida de las estaciones de peaje producen la primera secuencia.</span><span class="sxs-lookup"><span data-stu-id="6cd28-133">Sensors installed in the entrance and exit of the toll stations produce the first stream.</span></span> <span data-ttu-id="6cd28-134">La segunda secuencia es un conjunto de datos de búsqueda estática que tiene datos de registro del vehículo.</span><span class="sxs-lookup"><span data-stu-id="6cd28-134">The second stream is a static lookup dataset that has vehicle registration data.</span></span>

### <a name="entry-data-stream"></a><span data-ttu-id="6cd28-135">Flujo de datos de entrada</span><span class="sxs-lookup"><span data-stu-id="6cd28-135">Entry data stream</span></span>
<span data-ttu-id="6cd28-136">El flujo de datos de entrada contiene información sobre los vehículos que entran en las estaciones de peaje.</span><span class="sxs-lookup"><span data-stu-id="6cd28-136">The entry data stream contains information about cars as they enter toll stations.</span></span>

| <span data-ttu-id="6cd28-137">TollId</span><span class="sxs-lookup"><span data-stu-id="6cd28-137">TollID</span></span> | <span data-ttu-id="6cd28-138">EntryTime</span><span class="sxs-lookup"><span data-stu-id="6cd28-138">EntryTime</span></span> | <span data-ttu-id="6cd28-139">LicensePlate</span><span class="sxs-lookup"><span data-stu-id="6cd28-139">LicensePlate</span></span> | <span data-ttu-id="6cd28-140">Estado</span><span class="sxs-lookup"><span data-stu-id="6cd28-140">State</span></span> | <span data-ttu-id="6cd28-141">Asegúrese</span><span class="sxs-lookup"><span data-stu-id="6cd28-141">Make</span></span> | <span data-ttu-id="6cd28-142">Modelo</span><span class="sxs-lookup"><span data-stu-id="6cd28-142">Model</span></span> | <span data-ttu-id="6cd28-143">VehicleType</span><span class="sxs-lookup"><span data-stu-id="6cd28-143">VehicleType</span></span> | <span data-ttu-id="6cd28-144">VehicleWeight</span><span class="sxs-lookup"><span data-stu-id="6cd28-144">VehicleWeight</span></span> | <span data-ttu-id="6cd28-145">Toll</span><span class="sxs-lookup"><span data-stu-id="6cd28-145">Toll</span></span> | <span data-ttu-id="6cd28-146">Etiqueta</span><span class="sxs-lookup"><span data-stu-id="6cd28-146">Tag</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="6cd28-147">1</span><span class="sxs-lookup"><span data-stu-id="6cd28-147">1</span></span> |<span data-ttu-id="6cd28-148">10-09-2014 12:01:00.000</span><span class="sxs-lookup"><span data-stu-id="6cd28-148">2014-09-10 12:01:00.000</span></span> |<span data-ttu-id="6cd28-149">JNB 7001</span><span class="sxs-lookup"><span data-stu-id="6cd28-149">JNB 7001</span></span> |<span data-ttu-id="6cd28-150">NY</span><span class="sxs-lookup"><span data-stu-id="6cd28-150">NY</span></span> |<span data-ttu-id="6cd28-151">Honda</span><span class="sxs-lookup"><span data-stu-id="6cd28-151">Honda</span></span> |<span data-ttu-id="6cd28-152">CRV</span><span class="sxs-lookup"><span data-stu-id="6cd28-152">CRV</span></span> |<span data-ttu-id="6cd28-153">1</span><span class="sxs-lookup"><span data-stu-id="6cd28-153">1</span></span> |<span data-ttu-id="6cd28-154">0</span><span class="sxs-lookup"><span data-stu-id="6cd28-154">0</span></span> |<span data-ttu-id="6cd28-155">7</span><span class="sxs-lookup"><span data-stu-id="6cd28-155">7</span></span> | |
| <span data-ttu-id="6cd28-156">1</span><span class="sxs-lookup"><span data-stu-id="6cd28-156">1</span></span> |<span data-ttu-id="6cd28-157">10-09-2014 12:02:00.000</span><span class="sxs-lookup"><span data-stu-id="6cd28-157">2014-09-10 12:02:00.000</span></span> |<span data-ttu-id="6cd28-158">YXZ 1001</span><span class="sxs-lookup"><span data-stu-id="6cd28-158">YXZ 1001</span></span> |<span data-ttu-id="6cd28-159">NY</span><span class="sxs-lookup"><span data-stu-id="6cd28-159">NY</span></span> |<span data-ttu-id="6cd28-160">Toyota</span><span class="sxs-lookup"><span data-stu-id="6cd28-160">Toyota</span></span> |<span data-ttu-id="6cd28-161">Camry</span><span class="sxs-lookup"><span data-stu-id="6cd28-161">Camry</span></span> |<span data-ttu-id="6cd28-162">1</span><span class="sxs-lookup"><span data-stu-id="6cd28-162">1</span></span> |<span data-ttu-id="6cd28-163">0</span><span class="sxs-lookup"><span data-stu-id="6cd28-163">0</span></span> |<span data-ttu-id="6cd28-164">4</span><span class="sxs-lookup"><span data-stu-id="6cd28-164">4</span></span> |<span data-ttu-id="6cd28-165">123456789</span><span class="sxs-lookup"><span data-stu-id="6cd28-165">123456789</span></span> |
| <span data-ttu-id="6cd28-166">3</span><span class="sxs-lookup"><span data-stu-id="6cd28-166">3</span></span> |<span data-ttu-id="6cd28-167">10-09-2014 12:02:00.000</span><span class="sxs-lookup"><span data-stu-id="6cd28-167">2014-09-10 12:02:00.000</span></span> |<span data-ttu-id="6cd28-168">ABC 1004</span><span class="sxs-lookup"><span data-stu-id="6cd28-168">ABC 1004</span></span> |<span data-ttu-id="6cd28-169">CT</span><span class="sxs-lookup"><span data-stu-id="6cd28-169">CT</span></span> |<span data-ttu-id="6cd28-170">Ford</span><span class="sxs-lookup"><span data-stu-id="6cd28-170">Ford</span></span> |<span data-ttu-id="6cd28-171">Taurus</span><span class="sxs-lookup"><span data-stu-id="6cd28-171">Taurus</span></span> |<span data-ttu-id="6cd28-172">1</span><span class="sxs-lookup"><span data-stu-id="6cd28-172">1</span></span> |<span data-ttu-id="6cd28-173">0</span><span class="sxs-lookup"><span data-stu-id="6cd28-173">0</span></span> |<span data-ttu-id="6cd28-174">5</span><span class="sxs-lookup"><span data-stu-id="6cd28-174">5</span></span> |<span data-ttu-id="6cd28-175">456789123</span><span class="sxs-lookup"><span data-stu-id="6cd28-175">456789123</span></span> |
| <span data-ttu-id="6cd28-176">2</span><span class="sxs-lookup"><span data-stu-id="6cd28-176">2</span></span> |<span data-ttu-id="6cd28-177">10-09-2014 12:03:00.000</span><span class="sxs-lookup"><span data-stu-id="6cd28-177">2014-09-10 12:03:00.000</span></span> |<span data-ttu-id="6cd28-178">XYZ 1003</span><span class="sxs-lookup"><span data-stu-id="6cd28-178">XYZ 1003</span></span> |<span data-ttu-id="6cd28-179">CT</span><span class="sxs-lookup"><span data-stu-id="6cd28-179">CT</span></span> |<span data-ttu-id="6cd28-180">Toyota</span><span class="sxs-lookup"><span data-stu-id="6cd28-180">Toyota</span></span> |<span data-ttu-id="6cd28-181">Corolla</span><span class="sxs-lookup"><span data-stu-id="6cd28-181">Corolla</span></span> |<span data-ttu-id="6cd28-182">1</span><span class="sxs-lookup"><span data-stu-id="6cd28-182">1</span></span> |<span data-ttu-id="6cd28-183">0</span><span class="sxs-lookup"><span data-stu-id="6cd28-183">0</span></span> |<span data-ttu-id="6cd28-184">4</span><span class="sxs-lookup"><span data-stu-id="6cd28-184">4</span></span> | |
| <span data-ttu-id="6cd28-185">1</span><span class="sxs-lookup"><span data-stu-id="6cd28-185">1</span></span> |<span data-ttu-id="6cd28-186">10-09-2014 12:03:00.000</span><span class="sxs-lookup"><span data-stu-id="6cd28-186">2014-09-10 12:03:00.000</span></span> |<span data-ttu-id="6cd28-187">BNJ 1007</span><span class="sxs-lookup"><span data-stu-id="6cd28-187">BNJ 1007</span></span> |<span data-ttu-id="6cd28-188">NY</span><span class="sxs-lookup"><span data-stu-id="6cd28-188">NY</span></span> |<span data-ttu-id="6cd28-189">Honda</span><span class="sxs-lookup"><span data-stu-id="6cd28-189">Honda</span></span> |<span data-ttu-id="6cd28-190">CRV</span><span class="sxs-lookup"><span data-stu-id="6cd28-190">CRV</span></span> |<span data-ttu-id="6cd28-191">1</span><span class="sxs-lookup"><span data-stu-id="6cd28-191">1</span></span> |<span data-ttu-id="6cd28-192">0</span><span class="sxs-lookup"><span data-stu-id="6cd28-192">0</span></span> |<span data-ttu-id="6cd28-193">5</span><span class="sxs-lookup"><span data-stu-id="6cd28-193">5</span></span> |<span data-ttu-id="6cd28-194">789123456</span><span class="sxs-lookup"><span data-stu-id="6cd28-194">789123456</span></span> |
| <span data-ttu-id="6cd28-195">2</span><span class="sxs-lookup"><span data-stu-id="6cd28-195">2</span></span> |<span data-ttu-id="6cd28-196">10-09-2014 12:05:00.000</span><span class="sxs-lookup"><span data-stu-id="6cd28-196">2014-09-10 12:05:00.000</span></span> |<span data-ttu-id="6cd28-197">CDE 1007</span><span class="sxs-lookup"><span data-stu-id="6cd28-197">CDE 1007</span></span> |<span data-ttu-id="6cd28-198">NJ</span><span class="sxs-lookup"><span data-stu-id="6cd28-198">NJ</span></span> |<span data-ttu-id="6cd28-199">Toyota</span><span class="sxs-lookup"><span data-stu-id="6cd28-199">Toyota</span></span> |<span data-ttu-id="6cd28-200">4 x 4</span><span class="sxs-lookup"><span data-stu-id="6cd28-200">4x4</span></span> |<span data-ttu-id="6cd28-201">1</span><span class="sxs-lookup"><span data-stu-id="6cd28-201">1</span></span> |<span data-ttu-id="6cd28-202">0</span><span class="sxs-lookup"><span data-stu-id="6cd28-202">0</span></span> |<span data-ttu-id="6cd28-203">6</span><span class="sxs-lookup"><span data-stu-id="6cd28-203">6</span></span> |<span data-ttu-id="6cd28-204">321987654</span><span class="sxs-lookup"><span data-stu-id="6cd28-204">321987654</span></span> |

<span data-ttu-id="6cd28-205">Breve descripción de las columnas:</span><span class="sxs-lookup"><span data-stu-id="6cd28-205">Here is a short description of the columns:</span></span>

| <span data-ttu-id="6cd28-206">Columna</span><span class="sxs-lookup"><span data-stu-id="6cd28-206">Column</span></span> | <span data-ttu-id="6cd28-207">Description</span><span class="sxs-lookup"><span data-stu-id="6cd28-207">Description</span></span> |
| --- | --- |
| <span data-ttu-id="6cd28-208">TollId</span><span class="sxs-lookup"><span data-stu-id="6cd28-208">TollID</span></span> |<span data-ttu-id="6cd28-209">El identificador de la cabina de peaje que identifica de forma única una cabina de peaje.</span><span class="sxs-lookup"><span data-stu-id="6cd28-209">The toll booth ID that uniquely identifies a toll booth</span></span> |
| <span data-ttu-id="6cd28-210">EntryTime</span><span class="sxs-lookup"><span data-stu-id="6cd28-210">EntryTime</span></span> |<span data-ttu-id="6cd28-211">Fecha y hora de entrada del vehículo en la cabina de peaje en UTC.</span><span class="sxs-lookup"><span data-stu-id="6cd28-211">The date and time of entry of the vehicle to the toll booth in UTC</span></span> |
| <span data-ttu-id="6cd28-212">LicensePlate</span><span class="sxs-lookup"><span data-stu-id="6cd28-212">LicensePlate</span></span> |<span data-ttu-id="6cd28-213">Número de matrícula del vehículo.</span><span class="sxs-lookup"><span data-stu-id="6cd28-213">The license plate number of the vehicle</span></span> |
| <span data-ttu-id="6cd28-214">Estado</span><span class="sxs-lookup"><span data-stu-id="6cd28-214">State</span></span> |<span data-ttu-id="6cd28-215">Estado de los Estados Unidos.</span><span class="sxs-lookup"><span data-stu-id="6cd28-215">A state in United States</span></span> |
| <span data-ttu-id="6cd28-216">Asegúrese</span><span class="sxs-lookup"><span data-stu-id="6cd28-216">Make</span></span> |<span data-ttu-id="6cd28-217">Fabricante del automóvil.</span><span class="sxs-lookup"><span data-stu-id="6cd28-217">The manufacturer of the automobile</span></span> |
| <span data-ttu-id="6cd28-218">Modelo</span><span class="sxs-lookup"><span data-stu-id="6cd28-218">Model</span></span> |<span data-ttu-id="6cd28-219">Número de modelo de vehículo.</span><span class="sxs-lookup"><span data-stu-id="6cd28-219">The model number of the automobile</span></span> |
| <span data-ttu-id="6cd28-220">VehicleType</span><span class="sxs-lookup"><span data-stu-id="6cd28-220">VehicleType</span></span> |<span data-ttu-id="6cd28-221">1 para los vehículos de pasajeros o 2 para vehículos comerciales.</span><span class="sxs-lookup"><span data-stu-id="6cd28-221">Either 1 for passenger vehicles or 2 for commercial vehicles</span></span> |
| <span data-ttu-id="6cd28-222">WeightType</span><span class="sxs-lookup"><span data-stu-id="6cd28-222">WeightType</span></span> |<span data-ttu-id="6cd28-223">Peso del vehículo en toneladas; es 0 para vehículos de pasajeros.</span><span class="sxs-lookup"><span data-stu-id="6cd28-223">Vehicle weight in tons; 0 for passenger vehicles</span></span> |
| <span data-ttu-id="6cd28-224">Toll</span><span class="sxs-lookup"><span data-stu-id="6cd28-224">Toll</span></span> |<span data-ttu-id="6cd28-225">Costo del peaje en USD.</span><span class="sxs-lookup"><span data-stu-id="6cd28-225">The toll value in USD</span></span> |
| <span data-ttu-id="6cd28-226">Etiqueta</span><span class="sxs-lookup"><span data-stu-id="6cd28-226">Tag</span></span> |<span data-ttu-id="6cd28-227">Etiqueta electrónica del vehículo que automatiza el pago; en blanco cuando el pago se realiza manualmente.</span><span class="sxs-lookup"><span data-stu-id="6cd28-227">The e-Tag on the automobile that automates payment; blank where the payment was done manually</span></span> |

### <a name="exit-data-stream"></a><span data-ttu-id="6cd28-228">Flujo de datos de salida</span><span class="sxs-lookup"><span data-stu-id="6cd28-228">Exit data stream</span></span>
<span data-ttu-id="6cd28-229">El flujo de datos de salida contiene información sobre los vehículos que salen de la estación de peaje.</span><span class="sxs-lookup"><span data-stu-id="6cd28-229">The exit data stream contains information about cars leaving the toll station.</span></span>

| <span data-ttu-id="6cd28-230">**TollId**</span><span class="sxs-lookup"><span data-stu-id="6cd28-230">**TollId**</span></span> | <span data-ttu-id="6cd28-231">**ExitTime**</span><span class="sxs-lookup"><span data-stu-id="6cd28-231">**ExitTime**</span></span> | <span data-ttu-id="6cd28-232">**LicensePlate**</span><span class="sxs-lookup"><span data-stu-id="6cd28-232">**LicensePlate**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="6cd28-233">1</span><span class="sxs-lookup"><span data-stu-id="6cd28-233">1</span></span> |<span data-ttu-id="6cd28-234">10-09-2014 T12:03:00.0000000Z</span><span class="sxs-lookup"><span data-stu-id="6cd28-234">2014-09-10T12:03:00.0000000Z</span></span> |<span data-ttu-id="6cd28-235">JNB 7001</span><span class="sxs-lookup"><span data-stu-id="6cd28-235">JNB 7001</span></span> |
| <span data-ttu-id="6cd28-236">1</span><span class="sxs-lookup"><span data-stu-id="6cd28-236">1</span></span> |<span data-ttu-id="6cd28-237">10-09-2014 T12:03:00.0000000Z</span><span class="sxs-lookup"><span data-stu-id="6cd28-237">2014-09-10T12:03:00.0000000Z</span></span> |<span data-ttu-id="6cd28-238">YXZ 1001</span><span class="sxs-lookup"><span data-stu-id="6cd28-238">YXZ 1001</span></span> |
| <span data-ttu-id="6cd28-239">3</span><span class="sxs-lookup"><span data-stu-id="6cd28-239">3</span></span> |<span data-ttu-id="6cd28-240">10-09-2014 T12:04:00.0000000Z</span><span class="sxs-lookup"><span data-stu-id="6cd28-240">2014-09-10T12:04:00.0000000Z</span></span> |<span data-ttu-id="6cd28-241">ABC 1004</span><span class="sxs-lookup"><span data-stu-id="6cd28-241">ABC 1004</span></span> |
| <span data-ttu-id="6cd28-242">2</span><span class="sxs-lookup"><span data-stu-id="6cd28-242">2</span></span> |<span data-ttu-id="6cd28-243">10-09-2014 T12:07:00.0000000Z</span><span class="sxs-lookup"><span data-stu-id="6cd28-243">2014-09-10T12:07:00.0000000Z</span></span> |<span data-ttu-id="6cd28-244">XYZ 1003</span><span class="sxs-lookup"><span data-stu-id="6cd28-244">XYZ 1003</span></span> |
| <span data-ttu-id="6cd28-245">1</span><span class="sxs-lookup"><span data-stu-id="6cd28-245">1</span></span> |<span data-ttu-id="6cd28-246">10-09-2014 T12:08:00.0000000Z</span><span class="sxs-lookup"><span data-stu-id="6cd28-246">2014-09-10T12:08:00.0000000Z</span></span> |<span data-ttu-id="6cd28-247">BNJ 1007</span><span class="sxs-lookup"><span data-stu-id="6cd28-247">BNJ 1007</span></span> |
| <span data-ttu-id="6cd28-248">2</span><span class="sxs-lookup"><span data-stu-id="6cd28-248">2</span></span> |<span data-ttu-id="6cd28-249">10-09-2014 T12:07:00.0000000Z</span><span class="sxs-lookup"><span data-stu-id="6cd28-249">2014-09-10T12:07:00.0000000Z</span></span> |<span data-ttu-id="6cd28-250">CDE 1007</span><span class="sxs-lookup"><span data-stu-id="6cd28-250">CDE 1007</span></span> |

<span data-ttu-id="6cd28-251">Breve descripción de las columnas:</span><span class="sxs-lookup"><span data-stu-id="6cd28-251">Here is a short description of the columns:</span></span>

| <span data-ttu-id="6cd28-252">Columna</span><span class="sxs-lookup"><span data-stu-id="6cd28-252">Column</span></span> | <span data-ttu-id="6cd28-253">Description</span><span class="sxs-lookup"><span data-stu-id="6cd28-253">Description</span></span> |
| --- | --- |
| <span data-ttu-id="6cd28-254">TollId</span><span class="sxs-lookup"><span data-stu-id="6cd28-254">TollID</span></span> |<span data-ttu-id="6cd28-255">El identificador de la cabina de peaje que identifica de forma única una cabina de peaje.</span><span class="sxs-lookup"><span data-stu-id="6cd28-255">The toll booth ID that uniquely identifies a toll booth</span></span> |
| <span data-ttu-id="6cd28-256">ExitTime</span><span class="sxs-lookup"><span data-stu-id="6cd28-256">ExitTime</span></span> |<span data-ttu-id="6cd28-257">La fecha y hora de salida del vehículo de la cabina de peaje en UTC.</span><span class="sxs-lookup"><span data-stu-id="6cd28-257">The date and time of exit of the vehicle from toll booth in UTC</span></span> |
| <span data-ttu-id="6cd28-258">LicensePlate</span><span class="sxs-lookup"><span data-stu-id="6cd28-258">LicensePlate</span></span> |<span data-ttu-id="6cd28-259">Número de matrícula del vehículo.</span><span class="sxs-lookup"><span data-stu-id="6cd28-259">The license plate number of the vehicle</span></span> |

### <a name="commercial-vehicle-registration-data"></a><span data-ttu-id="6cd28-260">Datos de registro de vehículos comerciales</span><span class="sxs-lookup"><span data-stu-id="6cd28-260">Commercial vehicle registration data</span></span>
<span data-ttu-id="6cd28-261">En el tutorial se usa una instantánea estática de una base de datos de registro de vehículos comerciales.</span><span class="sxs-lookup"><span data-stu-id="6cd28-261">The tutorial uses a static snapshot of a commercial vehicle registration database.</span></span>

| <span data-ttu-id="6cd28-262">LicensePlate</span><span class="sxs-lookup"><span data-stu-id="6cd28-262">LicensePlate</span></span> | <span data-ttu-id="6cd28-263">RegistrationId</span><span class="sxs-lookup"><span data-stu-id="6cd28-263">RegistrationId</span></span> | <span data-ttu-id="6cd28-264">Expirada</span><span class="sxs-lookup"><span data-stu-id="6cd28-264">Expired</span></span> |
| --- | --- | --- |
| <span data-ttu-id="6cd28-265">SVT 6023</span><span class="sxs-lookup"><span data-stu-id="6cd28-265">SVT 6023</span></span> |<span data-ttu-id="6cd28-266">285429838</span><span class="sxs-lookup"><span data-stu-id="6cd28-266">285429838</span></span> |<span data-ttu-id="6cd28-267">1</span><span class="sxs-lookup"><span data-stu-id="6cd28-267">1</span></span> |
| <span data-ttu-id="6cd28-268">XLZ 3463</span><span class="sxs-lookup"><span data-stu-id="6cd28-268">XLZ 3463</span></span> |<span data-ttu-id="6cd28-269">362715656</span><span class="sxs-lookup"><span data-stu-id="6cd28-269">362715656</span></span> |<span data-ttu-id="6cd28-270">0</span><span class="sxs-lookup"><span data-stu-id="6cd28-270">0</span></span> |
| <span data-ttu-id="6cd28-271">BAC 1005</span><span class="sxs-lookup"><span data-stu-id="6cd28-271">BAC 1005</span></span> |<span data-ttu-id="6cd28-272">876133137</span><span class="sxs-lookup"><span data-stu-id="6cd28-272">876133137</span></span> |<span data-ttu-id="6cd28-273">1</span><span class="sxs-lookup"><span data-stu-id="6cd28-273">1</span></span> |
| <span data-ttu-id="6cd28-274">RIV 8632</span><span class="sxs-lookup"><span data-stu-id="6cd28-274">RIV 8632</span></span> |<span data-ttu-id="6cd28-275">992711956</span><span class="sxs-lookup"><span data-stu-id="6cd28-275">992711956</span></span> |<span data-ttu-id="6cd28-276">0</span><span class="sxs-lookup"><span data-stu-id="6cd28-276">0</span></span> |
| <span data-ttu-id="6cd28-277">SNY 7188</span><span class="sxs-lookup"><span data-stu-id="6cd28-277">SNY 7188</span></span> |<span data-ttu-id="6cd28-278">592133890</span><span class="sxs-lookup"><span data-stu-id="6cd28-278">592133890</span></span> |<span data-ttu-id="6cd28-279">0</span><span class="sxs-lookup"><span data-stu-id="6cd28-279">0</span></span> |
| <span data-ttu-id="6cd28-280">ELH 9896</span><span class="sxs-lookup"><span data-stu-id="6cd28-280">ELH 9896</span></span> |<span data-ttu-id="6cd28-281">678427724</span><span class="sxs-lookup"><span data-stu-id="6cd28-281">678427724</span></span> |<span data-ttu-id="6cd28-282">1</span><span class="sxs-lookup"><span data-stu-id="6cd28-282">1</span></span> |

<span data-ttu-id="6cd28-283">Breve descripción de las columnas:</span><span class="sxs-lookup"><span data-stu-id="6cd28-283">Here is a short description of the columns:</span></span>

| <span data-ttu-id="6cd28-284">Columna</span><span class="sxs-lookup"><span data-stu-id="6cd28-284">Column</span></span> | <span data-ttu-id="6cd28-285">Description</span><span class="sxs-lookup"><span data-stu-id="6cd28-285">Description</span></span> |
| --- | --- |
| <span data-ttu-id="6cd28-286">LicensePlate</span><span class="sxs-lookup"><span data-stu-id="6cd28-286">LicensePlate</span></span> |<span data-ttu-id="6cd28-287">Número de matrícula del vehículo.</span><span class="sxs-lookup"><span data-stu-id="6cd28-287">The license plate number of the vehicle</span></span> |
| <span data-ttu-id="6cd28-288">RegistrationId</span><span class="sxs-lookup"><span data-stu-id="6cd28-288">RegistrationId</span></span> |<span data-ttu-id="6cd28-289">Identificador de registro del vehículo.</span><span class="sxs-lookup"><span data-stu-id="6cd28-289">The vehicle's registration ID</span></span> |
| <span data-ttu-id="6cd28-290">Expirada</span><span class="sxs-lookup"><span data-stu-id="6cd28-290">Expired</span></span> |<span data-ttu-id="6cd28-291">El estado de registro del vehículo: 0 si el registro de vehículo está activo, 1 si el registro ha caducado.</span><span class="sxs-lookup"><span data-stu-id="6cd28-291">The registration status of the vehicle: 0 if vehicle registration is active, 1 if registration is expired</span></span> |

## <a name="set-up-the-environment-for-azure-stream-analytics"></a><span data-ttu-id="6cd28-292">Configuración del entorno para Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="6cd28-292">Set up the environment for Azure Stream Analytics</span></span>
<span data-ttu-id="6cd28-293">Para realizar este tutorial, necesita una suscripción de Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="6cd28-293">To complete this tutorial, you need a Microsoft Azure subscription.</span></span> <span data-ttu-id="6cd28-294">Microsoft ofrece una evaluación gratuita de los servicios de Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="6cd28-294">Microsoft offers free trial for Microsoft Azure services.</span></span>

<span data-ttu-id="6cd28-295">Si no tiene una cuenta de Azure, puede [solicitar una versión de evaluación gratuita](http://azure.microsoft.com/pricing/free-trial/).</span><span class="sxs-lookup"><span data-stu-id="6cd28-295">If you do not have an Azure account, you can [request a free trial version](http://azure.microsoft.com/pricing/free-trial/).</span></span>

> [!NOTE]
> <span data-ttu-id="6cd28-296">Para suscribirse a una evaluación gratuita, necesita un dispositivo móvil que pueda recibir mensajes de texto y una tarjeta de crédito válida.</span><span class="sxs-lookup"><span data-stu-id="6cd28-296">To sign up for a free trial, you need a mobile device that can receive text messages and a valid credit card.</span></span>
> 
> 

<span data-ttu-id="6cd28-297">Asegúrese de seguir los pasos de la sección "Limpieza de la cuenta de Azure" al final de este ejercicio para que pueda aprovechar al máximo su crédito de Azure.</span><span class="sxs-lookup"><span data-stu-id="6cd28-297">Be sure to follow the steps in the “Clean up your Azure account” section at the end of this article so that you can make the best use of your Azure credit.</span></span>

## <a name="provision-azure-resources-required-for-the-tutorial"></a><span data-ttu-id="6cd28-298">Aprovisionamiento de los recursos de Azure necesarios para el tutorial</span><span class="sxs-lookup"><span data-stu-id="6cd28-298">Provision Azure resources required for the tutorial</span></span>
<span data-ttu-id="6cd28-299">Este tutorial requiere dos Centros de eventos para recibir los flujos de datos *entry* y *exit*.</span><span class="sxs-lookup"><span data-stu-id="6cd28-299">This tutorial requires two event hubs to receive *entry* and *exit* data streams.</span></span> <span data-ttu-id="6cd28-300">Azure SQL Database genera los resultados de los trabajos de Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="6cd28-300">Azure SQL Database outputs the results of the Stream Analytics jobs.</span></span> <span data-ttu-id="6cd28-301">Azure Storage almacena los datos de referencia sobre los registros de vehículos.</span><span class="sxs-lookup"><span data-stu-id="6cd28-301">Azure Storage stores reference data about vehicle registrations.</span></span>

<span data-ttu-id="6cd28-302">Se puede usar el script Setup.ps1 de la carpeta TollApp en GitHub para crear todos los recursos necesarios.</span><span class="sxs-lookup"><span data-stu-id="6cd28-302">You can use the Setup.ps1 script in the TollApp folder on GitHub to create all required resources.</span></span> <span data-ttu-id="6cd28-303">Se recomienda su uso para ahorrar tiempo.</span><span class="sxs-lookup"><span data-stu-id="6cd28-303">In the interest of time, we recommend that you run it.</span></span> <span data-ttu-id="6cd28-304">Para más información sobre la configuración de estos recursos en Azure Portal, consulte el apéndice "Configuración de recursos del tutorial en Azure Portal".</span><span class="sxs-lookup"><span data-stu-id="6cd28-304">If you would like to learn more about how to configure these resources in the Azure portal, refer to the “Configuring tutorial resources in Azure portal” appendix.</span></span>

<span data-ttu-id="6cd28-305">Descargue y guarde el soporte los archivos y carpetas de [TollApp](https://github.com/Azure/azure-stream-analytics/blob/master/Samples/TollApp/TollApp.zip) compatibles.</span><span class="sxs-lookup"><span data-stu-id="6cd28-305">Download and save the supporting [TollApp](https://github.com/Azure/azure-stream-analytics/blob/master/Samples/TollApp/TollApp.zip) folder and files.</span></span>

<span data-ttu-id="6cd28-306">Abra una ventana de **Microsoft Azure PowerShell***como administrador*.</span><span class="sxs-lookup"><span data-stu-id="6cd28-306">Open a **Microsoft Azure PowerShell** window *as an administrator*.</span></span> <span data-ttu-id="6cd28-307">Si aún no tiene Azure PowerShell, siga estas instrucciones que se indican en [Cómo instalar y configurar Azure PowerShell](/powershell/azure/overview) .</span><span class="sxs-lookup"><span data-stu-id="6cd28-307">If you do not yet have Azure PowerShell, follow the instructions in [Install and configure Azure PowerShell](/powershell/azure/overview) to install it.</span></span>

<span data-ttu-id="6cd28-308">Puesto que Windows bloquea automáticamente archivos .ps1, .dll y .exe, debe establecer la directiva de ejecución antes de ejecutar el script.</span><span class="sxs-lookup"><span data-stu-id="6cd28-308">Because Windows automatically blocks .ps1, .dll, and .exe files, you need to set the execution policy before you run the script.</span></span> <span data-ttu-id="6cd28-309">Asegúrese de ejecutar la ventana de Azure PowerShell *como administrador*.</span><span class="sxs-lookup"><span data-stu-id="6cd28-309">Make sure the Azure PowerShell window is running *as an administrator*.</span></span> <span data-ttu-id="6cd28-310">Ejecute **Set-ExecutionPolicy unrestricted**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-310">Run **Set-ExecutionPolicy unrestricted**.</span></span> <span data-ttu-id="6cd28-311">Cuando se le solicite, escriba **Y**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-311">When prompted, type **Y**.</span></span>

![Captura de pantalla de "Set-ExecutionPolicy unrestricted" ejecutándose en la ventana de Azure PowerShell](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image2.png)

<span data-ttu-id="6cd28-313">Ejecute **Get-ExecutionPolicy** para asegurarse de que el comando funcionó.</span><span class="sxs-lookup"><span data-stu-id="6cd28-313">Run **Get-ExecutionPolicy** to make sure that the command worked.</span></span>

![Captura de pantalla de "Get-ExecutionPolicy" ejecutándose en la ventana de Azure PowerShell](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image3.png)

<span data-ttu-id="6cd28-315">Vaya al directorio que contiene los scripts y la aplicación del generador.</span><span class="sxs-lookup"><span data-stu-id="6cd28-315">Go to the directory that has the scripts and generator application.</span></span>

![Captura de pantalla de "cd .\TollApp\TollApp" ejecutándose en la ventana de Azure PowerShell](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image4.png)

<span data-ttu-id="6cd28-317">Escriba **.\\Setup.ps1** para configurar la cuenta de Azure, crear y configurar todos los recursos necesarios y empezar a generar eventos.</span><span class="sxs-lookup"><span data-stu-id="6cd28-317">Type **.\\Setup.ps1** to set up your Azure account, create and configure all required resources, and start to generate events.</span></span> <span data-ttu-id="6cd28-318">El script selecciona aleatoriamente una región para crear los recursos.</span><span class="sxs-lookup"><span data-stu-id="6cd28-318">The script randomly picks up a region to create your resources.</span></span> <span data-ttu-id="6cd28-319">Para especificar explícitamente una región, puede pasar el parámetro **-location** como en el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="6cd28-319">To explicitly specify a region, you can pass the **-location** parameter as in the following example:</span></span>

<span data-ttu-id="6cd28-320">**.\\Setup.ps1 -ubicación “centro de EE. UU.”**</span><span class="sxs-lookup"><span data-stu-id="6cd28-320">**.\\Setup.ps1 -location “Central US”**</span></span>

![Captura de pantalla de la página de inicio de sesión en Azure](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image5.png)

<span data-ttu-id="6cd28-322">El script abre la página de **inicio de sesión** de Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="6cd28-322">The script opens the **Sign In** page for Microsoft Azure.</span></span> <span data-ttu-id="6cd28-323">Escriba los credenciales de la cuenta.</span><span class="sxs-lookup"><span data-stu-id="6cd28-323">Enter your account credentials.</span></span>

> [!NOTE]
> <span data-ttu-id="6cd28-324">Si la cuenta tiene acceso a varias suscripciones, se le pedirá que escriba el nombre de la suscripción que quiere usar para el tutorial.</span><span class="sxs-lookup"><span data-stu-id="6cd28-324">If your account has access to multiple subscriptions, you will be asked to enter the subscription name that you want to use for the tutorial.</span></span>
> 
> 

<span data-ttu-id="6cd28-325">El script puede tardar varios minutos en ejecutarse.</span><span class="sxs-lookup"><span data-stu-id="6cd28-325">The script can take several minutes to run.</span></span> <span data-ttu-id="6cd28-326">Cuando finaliza, el resultado será semejante al de la captura de pantalla siguiente.</span><span class="sxs-lookup"><span data-stu-id="6cd28-326">After it finishes, the output should look like the following screenshot.</span></span>

![Captura de pantalla de salida del script en la ventana de Azure PowerShell](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image6.PNG)

<span data-ttu-id="6cd28-328">También verá otra ventana similar a la de la captura de pantalla siguiente.</span><span class="sxs-lookup"><span data-stu-id="6cd28-328">You will also see another window that's similar to the following screenshot.</span></span> <span data-ttu-id="6cd28-329">Esta aplicación envía eventos a Azure Events Hubs que son necesarios para ejecutar el tutorial.</span><span class="sxs-lookup"><span data-stu-id="6cd28-329">This application is sending events to Azure Event Hubs, which is required to run the tutorial.</span></span> <span data-ttu-id="6cd28-330">Por lo tanto, no detenga la aplicación ni cierre esta ventana hasta que finalice el tutorial.</span><span class="sxs-lookup"><span data-stu-id="6cd28-330">So, do not stop the application or close this window until you finish the tutorial.</span></span>

![Captura de pantalla "Enviando datos de centro de eventos"](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image7.png)

<span data-ttu-id="6cd28-332">Ahora podrá ver los recursos en Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="6cd28-332">You should be able to see your resources in Azure portal now.</span></span> <span data-ttu-id="6cd28-333">Vaya a <https://portal.azure.com> e inicie sesión con las credenciales de su cuenta.</span><span class="sxs-lookup"><span data-stu-id="6cd28-333">Go to <https://portal.azure.com>, and sign in with your account credentials.</span></span> <span data-ttu-id="6cd28-334">Tenga en cuenta que, actualmente, algunas funciones utilizan el portal clásico.</span><span class="sxs-lookup"><span data-stu-id="6cd28-334">Note that currently some functionality utilizes the classic portal.</span></span> <span data-ttu-id="6cd28-335">Estos pasos se indicarán con claridad.</span><span class="sxs-lookup"><span data-stu-id="6cd28-335">These steps will be clearly indicated.</span></span>

### <a name="azure-event-hubs"></a><span data-ttu-id="6cd28-336">Centros de eventos de Azure</span><span class="sxs-lookup"><span data-stu-id="6cd28-336">Azure Event Hubs</span></span>
<span data-ttu-id="6cd28-337">En Azure Portal, haga clic en **Más servicios** en la parte inferior izquierda del panel de administración.</span><span class="sxs-lookup"><span data-stu-id="6cd28-337">In the Azure portal, click **More services** on the bottom of the left management pane.</span></span> <span data-ttu-id="6cd28-338">Escriba **Centros de eventos** en el campo proporcionado y haga clic en **Centros de eventos**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-338">Type **Event hubs** in the field provided and click **Event hubs**.</span></span> <span data-ttu-id="6cd28-339">Esto iniciará una nueva ventana del explorador que muestra el área **SERVICE BUS** del **portal clásico**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-339">This launches a new browser window to display the **SERVICE BUS** area in the **classic portal**.</span></span> <span data-ttu-id="6cd28-340">Aquí podrá ver el centro de eventos que ha creado el script Setup.ps1.</span><span class="sxs-lookup"><span data-stu-id="6cd28-340">Here you can see the Event Hub created by the Setup.ps1 script.</span></span>

![Bus de servicio](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image8.png)

<span data-ttu-id="6cd28-342">Haga clic en el que comienza por *tolldata*.</span><span class="sxs-lookup"><span data-stu-id="6cd28-342">Click the one that starts with *tolldata*.</span></span> <span data-ttu-id="6cd28-343">Haga clic en la pestaña **EVENT HUBS** . Verá dos Centros de eventos denominados *entry* y *exit* creados en este espacio de nombres.</span><span class="sxs-lookup"><span data-stu-id="6cd28-343">Click the **EVENT HUBS** tab. You will see two event hubs named *entry* and *exit* created in this namespace.</span></span>

![Pestaña Event Hubs en el portal clásico](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image9.png)

### <a name="azure-storage-container"></a><span data-ttu-id="6cd28-345">Contenedor de Almacenamiento de Azure</span><span class="sxs-lookup"><span data-stu-id="6cd28-345">Azure Storage container</span></span>
1. <span data-ttu-id="6cd28-346">Vuelva a la pestaña del explorador abierta en Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="6cd28-346">Go back to the tab in your browser open to Azure portal.</span></span> <span data-ttu-id="6cd28-347">Haga clic en **STORAGE** en el lado izquierdo de Azure Portal para ver el contenedor de Azure Storage que se usa en el tutorial.</span><span class="sxs-lookup"><span data-stu-id="6cd28-347">Click **STORAGE** on the left side of the Azure portal to see the Azure Storage container that's used in the tutorial.</span></span>
   
    ![Elemento de menú de almacenamiento](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image11.png)
2. <span data-ttu-id="6cd28-349">Haga clic en el que comienza por *tolldata*.</span><span class="sxs-lookup"><span data-stu-id="6cd28-349">Click the one that start with *tolldata*.</span></span> <span data-ttu-id="6cd28-350">Haga clic en la pestaña **CONTENEDORES** para ver el contenedor creado.</span><span class="sxs-lookup"><span data-stu-id="6cd28-350">Click the **CONTAINERS** tab to see the created container.</span></span>
   
    ![Pestaña Contenedores de Azure Portal](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image10.png)
3. <span data-ttu-id="6cd28-352">Haga clic en el contenedor **tolldata** para ver el archivo JSON cargado que tiene los datos de registro de vehículos.</span><span class="sxs-lookup"><span data-stu-id="6cd28-352">Click the **tolldata** container to see the uploaded JSON file that has vehicle registration data.</span></span>
   
    ![Captura de pantalla del archivo registration.json en el contenedor](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image12.png)

### <a name="azure-sql-database"></a><span data-ttu-id="6cd28-354">Base de datos SQL de Azure</span><span class="sxs-lookup"><span data-stu-id="6cd28-354">Azure SQL Database</span></span>
1. <span data-ttu-id="6cd28-355">Vuelva a Azure Portal en la primera pestaña que se abrió en el explorador.</span><span class="sxs-lookup"><span data-stu-id="6cd28-355">Go back to the Azure portal on the first tab that was opened in the browser.</span></span> <span data-ttu-id="6cd28-356">Haga clic en **BASES DE DATOS SQL** en el lado izquierdo de Azure Portal para ver la base de datos SQL que se usará en este tutorial y haga clic en **tolldatadb**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-356">Click **SQL DATABASES** on the left side of the Azure portal to see the SQL database that will be used in the tutorial and click **tolldatadb**.</span></span>
   
    ![Captura de pantalla de la base de datos SQL creada](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image15.png)
2. <span data-ttu-id="6cd28-358">Copie el nombre del servidor sin el número de puerto (*nombredeservidor*.database.windows.net, por ejemplo).</span><span class="sxs-lookup"><span data-stu-id="6cd28-358">Copy the server name without the port number (*servername*.database.windows.net, for example).</span></span>
    <span data-ttu-id="6cd28-359">![Captura de pantalla de la base de datos SQL creada](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image15a.png)</span><span class="sxs-lookup"><span data-stu-id="6cd28-359">![Screenshot of the created SQL database db](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image15a.png)</span></span>

## <a name="connect-to-the-database-from-visual-studio"></a><span data-ttu-id="6cd28-360">Conexión a la base de datos desde Visual Studio</span><span class="sxs-lookup"><span data-stu-id="6cd28-360">Connect to the database from Visual Studio</span></span>
<span data-ttu-id="6cd28-361">Usaremos Visual Studio para acceder a los resultados de consulta de la base de datos de salida.</span><span class="sxs-lookup"><span data-stu-id="6cd28-361">Use Visual Studio to access query results in the output database.</span></span>

<span data-ttu-id="6cd28-362">Conéctese a la base de datos de SQL (el destino) desde Visual Studio:</span><span class="sxs-lookup"><span data-stu-id="6cd28-362">Connect to the SQL database (the destination) from Visual Studio:</span></span>

1. <span data-ttu-id="6cd28-363">Abra Visual Studio y, a continuación, haga clic en **Herramientas** > **Conectar a base de datos**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-363">Open Visual Studio, and then click **Tools** > **Connect to Database**.</span></span>
2. <span data-ttu-id="6cd28-364">Si se le solicita, haga clic en **Microsoft SQL Server** como origen de datos.</span><span class="sxs-lookup"><span data-stu-id="6cd28-364">If asked, click **Microsoft SQL Server** as a data source.</span></span>
   
    ![Cuadro de diálogo Cambiar origen de datos](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image16.png)
3. <span data-ttu-id="6cd28-366">En el campo **Nombre del servidor** , pegue el nombre que copió en la sección anterior de Azure Portal (es decir, *nombredeservidor*.database.windows.net).</span><span class="sxs-lookup"><span data-stu-id="6cd28-366">In the **Server name** field, paste the name that you copied in the previous section from the Azure portal (that is, *servername*.database.windows.net).</span></span>
4. <span data-ttu-id="6cd28-367">Haga clic en **Usar autenticación de SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-367">Click **Use SQL Server Authentication**.</span></span>
5. <span data-ttu-id="6cd28-368">Escriba **tolladmin** en el campo **Nombre de usuario** y **123toll!**</span><span class="sxs-lookup"><span data-stu-id="6cd28-368">Enter **tolladmin** in the **User name** field and **123toll!**</span></span> <span data-ttu-id="6cd28-369">in the **Contraseña** .</span><span class="sxs-lookup"><span data-stu-id="6cd28-369">in the **Password** field.</span></span>
6. <span data-ttu-id="6cd28-370">Haga clic en **Seleccione o escriba el nombre de la base de datos** y seleccione **TollDataDB** como la base de datos.</span><span class="sxs-lookup"><span data-stu-id="6cd28-370">Click **Select or enter a database name**, and select **TollDataDB** as the database.</span></span>
   
    ![Cuadro de diálogo Agregar conexión](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image17.jpg)
7. <span data-ttu-id="6cd28-372">Haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-372">Click **OK**.</span></span>
8. <span data-ttu-id="6cd28-373">Abra el Explorador de servidores.</span><span class="sxs-lookup"><span data-stu-id="6cd28-373">Open Server Explorer.</span></span>
   
    ![Explorador de servidores](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image18.png)
9. <span data-ttu-id="6cd28-375">Vea las cuatro tablas de la base de datos de TollDataDB.</span><span class="sxs-lookup"><span data-stu-id="6cd28-375">See four tables in the TollDataDB database.</span></span>
   
    ![Tablas de la base de datos TollDataDB](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image19.jpg)

## <a name="event-generator-tollapp-sample-project"></a><span data-ttu-id="6cd28-377">Generador de eventos: proyecto de ejemplo TollApp</span><span class="sxs-lookup"><span data-stu-id="6cd28-377">Event generator: TollApp sample project</span></span>
<span data-ttu-id="6cd28-378">El script de PowerShell comienza a enviar eventos automáticamente mediante el programa de aplicación de ejemplo TollApp.</span><span class="sxs-lookup"><span data-stu-id="6cd28-378">The PowerShell script automatically starts to send events by using the TollApp sample application program.</span></span> <span data-ttu-id="6cd28-379">No es necesario realizar pasos adicionales.</span><span class="sxs-lookup"><span data-stu-id="6cd28-379">You don’t need to perform any additional steps.</span></span>

<span data-ttu-id="6cd28-380">Sin embargo, si está interesado en los detalles de implementación, puede encontrar el código fuente de la aplicación TollApp en GitHub [samples/TollApp](https://aka.ms/azure-stream-analytics-toll-source).</span><span class="sxs-lookup"><span data-stu-id="6cd28-380">However, if you are interested in implementation details, you can find the source code of the TollApp application in GitHub [samples/TollApp](https://aka.ms/azure-stream-analytics-toll-source).</span></span>

![Captura de pantalla del código de ejemplo que se muestra en Visual Studio](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image20.png)

## <a name="create-a-stream-analytics-job"></a><span data-ttu-id="6cd28-382">Creación de un trabajo de Análisis de transmisiones</span><span class="sxs-lookup"><span data-stu-id="6cd28-382">Create a Stream Analytics job</span></span>
1. <span data-ttu-id="6cd28-383">En Azure Portal, haga clic en el signo más de color verde situado en la esquina superior izquierda de la página para crear un nuevo trabajo de Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="6cd28-383">In the Azure portal, click the green plus sign in the top-left corner of the page to create a new Stream Analytics job.</span></span> <span data-ttu-id="6cd28-384">Seleccione **Inteligencia y análisis** y, a continuación, haga clic en **Trabajo de Stream Analytics**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-384">Select **Intelligence + Analytics** and then click **Stream Analytics job**.</span></span>
   
    ![New button](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image21.png)
2. <span data-ttu-id="6cd28-386">Proporcione un nombre de trabajo, compruebe que la suscripción es correcta y, a continuación, cree un nuevo grupo de recursos en la misma región que el almacenamiento del centro de eventos (el valor predeterminado es centro-sur de EE. UU. para el script).</span><span class="sxs-lookup"><span data-stu-id="6cd28-386">Provide a job name, validate the subscription is correct and then create a new Resource group in the same region as the Event hub storage (default is South Central US for the script).</span></span>
3. <span data-ttu-id="6cd28-387">Haga clic en **Anclar al panel** y, a continuación, en **CREAR** en la parte inferior de la página.</span><span class="sxs-lookup"><span data-stu-id="6cd28-387">Click **Pin to dashboard** and then **CREATE** at the bottom of the page.</span></span>
   
    ![Opción Crear el trabajo de Análisis de transmisiones](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image22.png)

## <a name="define-input-sources"></a><span data-ttu-id="6cd28-389">Definición de orígenes de entrada</span><span class="sxs-lookup"><span data-stu-id="6cd28-389">Define input sources</span></span>
1. <span data-ttu-id="6cd28-390">El trabajo se creará y se abrirá la página de este.</span><span class="sxs-lookup"><span data-stu-id="6cd28-390">The job will create and open the job page.</span></span> <span data-ttu-id="6cd28-391">O bien, puede hacer clic en el trabajo de análisis creado en el panel del portal.</span><span class="sxs-lookup"><span data-stu-id="6cd28-391">Or you can click the created analytics job on the portal dashboard.</span></span>

2. <span data-ttu-id="6cd28-392">Abra la pestaña **ENTRADAS** para definir el origen de datos.</span><span class="sxs-lookup"><span data-stu-id="6cd28-392">Click the **INPUTS** tab to define the source data.</span></span>
   
    ![La pestaña Entradas](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image24.png)
3. <span data-ttu-id="6cd28-394">Haga clic en **AGREGAR ENTRADA**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-394">Click **ADD AN INPUT**.</span></span>
   
    ![La opción Agregar una entrada](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image25.png)
4. <span data-ttu-id="6cd28-396">Escriba **EntryStream** como **ALIAS DE ENTRADA**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-396">Enter **EntryStream** as **INPUT ALIAS**.</span></span>
5. <span data-ttu-id="6cd28-397">El tipo de origen es **Flujo de datos**</span><span class="sxs-lookup"><span data-stu-id="6cd28-397">Source Type is **Data Stream**</span></span>
6. <span data-ttu-id="6cd28-398">El origen es **Centro de eventos**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-398">Source is **Event hub**.</span></span>
7. <span data-ttu-id="6cd28-399">**Service bus namespace** debe ser el primer TollData que aparece en la lista desplegable.</span><span class="sxs-lookup"><span data-stu-id="6cd28-399">**Service bus namespace** should be the TollData one in the drop down.</span></span>
8. <span data-ttu-id="6cd28-400">El **nombre del centro de eventos** se debe establecer en **entrada**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-400">**Event hub name** should be set to **entry**.</span></span>
9. <span data-ttu-id="6cd28-401">El **nombre de la directiva del centro de eventos* es **RootManageSharedAccessKey** (el valor predeterminado).</span><span class="sxs-lookup"><span data-stu-id="6cd28-401">**Event hub policy name*is **RootManageSharedAccessKey**  (the default value).</span></span>
10. <span data-ttu-id="6cd28-402">Seleccione **JSON** para **FORMATO DE SERIALIZACIÓN DE EVENTOS** y **UTF8** para **CODIFICACIÓN**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-402">Select **JSON** for **EVENT SERIALIZATION FORMAT** and **UTF8** for **ENCODING**.</span></span>
   
    <span data-ttu-id="6cd28-403">La configuración se verá así:</span><span class="sxs-lookup"><span data-stu-id="6cd28-403">Your settings will look like:</span></span>
   
    ![Configuración del centro de eventos](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image28.png)

10. <span data-ttu-id="6cd28-405">Haga clic en **Crear** en la parte inferior de la página para finalizar el asistente.</span><span class="sxs-lookup"><span data-stu-id="6cd28-405">Click **Create** at the bottom of the page to finish the wizard.</span></span>
    
    <span data-ttu-id="6cd28-406">Ahora que ha creado la secuencia de entrada, se siguen los mismos pasos para crear la secuencia de salida.</span><span class="sxs-lookup"><span data-stu-id="6cd28-406">Now that you've created the entry stream, you will follow the same steps to create the exit stream.</span></span> <span data-ttu-id="6cd28-407">Asegúrese de especificar valores como en la siguiente captura de pantalla.</span><span class="sxs-lookup"><span data-stu-id="6cd28-407">Be sure to enter values as on the following screenshot.</span></span>
    
    ![Configuración para el flujo de salida](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image31.png)
    
    <span data-ttu-id="6cd28-409">Ha definido dos flujos de entrada:</span><span class="sxs-lookup"><span data-stu-id="6cd28-409">You have defined two input streams:</span></span>
    
    ![Flujos de entrada definidos en Azure Portal](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image32.png)
    
    <span data-ttu-id="6cd28-411">A continuación, agregaremos la entrada de datos de referencia para el archivo de blob que contiene los datos de registro de los vehículos.</span><span class="sxs-lookup"><span data-stu-id="6cd28-411">Next, you will add reference data input for the blob file that contains car registration data.</span></span>
11. <span data-ttu-id="6cd28-412">Haga clic en **AGREGAR** y, a continuación, siga el mismo procedimiento para las entradas del flujo, pero seleccione **DATOS DE REFERENCIA** en lugar de **Flujo de datos** y el **alias de entrada** debe ser **Registro**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-412">Click **ADD**, and then follow the same process for the stream inputs but select **REFERENCE DATA** instead of **Data Stream** and the **Input Alias** is **Registration**.</span></span>

12. <span data-ttu-id="6cd28-413">cuenta de almacenamiento que comienza por **tolldata**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-413">storage account that starts with **tolldata**.</span></span> <span data-ttu-id="6cd28-414">El nombre del contenedor debe ser **tolldata** y el **PATRÓN DE RUTA DE ACCESO** debe ser **registration.json**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-414">The container name should be **tolldata**, and the **PATH PATTERN** should be **registration.json**.</span></span> <span data-ttu-id="6cd28-415">Este nombre de archivo distingue mayúsculas de minúsculas, por lo que asegúrese de escribirlo en **minúsculas**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-415">This file name is case sensitive and should be **lowercase**.</span></span>
    
    ![Configuración de almacenamiento de blobs](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image34.png)
13. <span data-ttu-id="6cd28-417">Haga clic en **Crear** para finalizar el asistente.</span><span class="sxs-lookup"><span data-stu-id="6cd28-417">Click **Create** to finish the wizard.</span></span>

<span data-ttu-id="6cd28-418">Ahora todas las entradas están definidas.</span><span class="sxs-lookup"><span data-stu-id="6cd28-418">Now all inputs are defined.</span></span>

## <a name="define-output"></a><span data-ttu-id="6cd28-419">Defininición de salida</span><span class="sxs-lookup"><span data-stu-id="6cd28-419">Define output</span></span>
1. <span data-ttu-id="6cd28-420">En el panel de información general del trabajo de Stream Analytics, seleccione **SALIDAS**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-420">On the Stream Analytics job overview pane, select **OUTPUTS**.</span></span>
   
    ![La pestaña Salida y la opción "Agregar una salida"](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image37.png)
2. <span data-ttu-id="6cd28-422">Haga clic en **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-422">Click **Add**.</span></span>
3. <span data-ttu-id="6cd28-423">Establezca el **alias de salida** en 'salida' y, a continuación, **Receptor** en **SQL Database**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-423">Set the **Output alias** to 'output' and then **Sink** to **SQL database**.</span></span>
3. <span data-ttu-id="6cd28-424">Seleccione el nombre de servidor que se usó en la sección "Conexión a la base de datos desde Visual Studio" de este artículo.</span><span class="sxs-lookup"><span data-stu-id="6cd28-424">Select the server name that was used in the “Connect to Database from Visual Studio” section of the article.</span></span> <span data-ttu-id="6cd28-425">El nombre de la base de datos es **TollDataDB**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-425">The database name is **TollDataDB**.</span></span>
4. <span data-ttu-id="6cd28-426">Escriba **tolladmin** en el campo **NOMBRE DE USUARIO**, **123toll!**</span><span class="sxs-lookup"><span data-stu-id="6cd28-426">Enter **tolladmin** in the **USERNAME** field, **123toll!**</span></span> <span data-ttu-id="6cd28-427">en el campo **CONTRASEÑA** y **TollDataRefJoin** en el campo **TABLA**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-427">in the **PASSWORD** field, and **TollDataRefJoin** in the **TABLE** field.</span></span>
   
    ![Configuración de SQL Database](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image38.png)
5. <span data-ttu-id="6cd28-429">Haga clic en **Crear**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-429">Click **Create**.</span></span>

## <a name="azure-stream-analytics-query"></a><span data-ttu-id="6cd28-430">Consulta de Análisis de transmisiones de Azure</span><span class="sxs-lookup"><span data-stu-id="6cd28-430">Azure Stream analytics query</span></span>
<span data-ttu-id="6cd28-431">La pestaña **CONSULTA** contiene una consulta SQL que transforma los datos de entrada.</span><span class="sxs-lookup"><span data-stu-id="6cd28-431">The **QUERY** tab contains a SQL query that transforms the incoming data.</span></span>

![Una consulta agregada a la pestaña Consulta](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image39.png)

<span data-ttu-id="6cd28-433">En este tutorial intentaremos responder a varias cuestiones empresariales relacionadas con datos de peaje y construiremos consultas de Stream Analytics que puedan usarse en Azure Stream Analytics para dar una respuesta adecuada.</span><span class="sxs-lookup"><span data-stu-id="6cd28-433">This tutorial attempts to answer several business questions that are related to toll data and constructs Stream Analytics queries that can be used in Azure Stream Analytics to provide a relevant answer.</span></span>

<span data-ttu-id="6cd28-434">Antes de iniciar el primer trabajo de Stream Analytics, veamos algunos escenarios y la sintaxis de consulta.</span><span class="sxs-lookup"><span data-stu-id="6cd28-434">Before you start your first Stream Analytics job, let’s explore a few scenarios and the query syntax.</span></span>

## <a name="introduction-to-azure-stream-analytics-query-language"></a><span data-ttu-id="6cd28-435">Introducción al lenguaje de consulta de Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="6cd28-435">Introduction to Azure Stream Analytics query language</span></span>
- - -
<span data-ttu-id="6cd28-436">Supongamos que necesita contar el número de vehículos que entran en una cabina de peaje.</span><span class="sxs-lookup"><span data-stu-id="6cd28-436">Let’s say that you need to count the number of vehicles that enter a toll booth.</span></span> <span data-ttu-id="6cd28-437">Como se trata de una secuencia continua de eventos, tendrá que definir un "período de tiempo".</span><span class="sxs-lookup"><span data-stu-id="6cd28-437">Because this is a continuous stream of events, you have to define a “period of time.”</span></span> <span data-ttu-id="6cd28-438">Vamos a cambiar la pregunta a "¿Cuántos vehículos entran en una cabina de peaje cada tres minutos?".</span><span class="sxs-lookup"><span data-stu-id="6cd28-438">Let's modify the question to be “How many vehicles enter a toll booth every three minutes?”.</span></span> <span data-ttu-id="6cd28-439">Esto se conoce comúnmente como "tumbling count".</span><span class="sxs-lookup"><span data-stu-id="6cd28-439">This is commonly referred to as the tumbling count.</span></span>

<span data-ttu-id="6cd28-440">Veamos la consulta de Azure Stream Analytics que responde a esta pregunta:</span><span class="sxs-lookup"><span data-stu-id="6cd28-440">Let’s look at the Azure Stream Analytics query that answers this question:</span></span>

    SELECT TollId, System.Timestamp AS WindowEnd, COUNT(*) AS Count
    FROM EntryStream TIMESTAMP BY EntryTime
    GROUP BY TUMBLINGWINDOW(minute, 3), TollId

<span data-ttu-id="6cd28-441">Como puede ver, Azure Stream Analytics usa un lenguaje de consulta que es similar a SQL y agrega algunas extensiones para especificar aspectos de la consulta relacionados con el tiempo.</span><span class="sxs-lookup"><span data-stu-id="6cd28-441">As you can see, Azure Stream Analytics uses a query language that's like SQL and adds a few extensions to specify time-related aspects of the query.</span></span>

<span data-ttu-id="6cd28-442">Para más información, puede leer sobre las construcciones de [Administración del tiempo](https://msdn.microsoft.com/library/azure/mt582045.aspx) y [Ventanas](https://msdn.microsoft.com/library/azure/dn835019.aspx) que se usan en una consulta en MSDN.</span><span class="sxs-lookup"><span data-stu-id="6cd28-442">For more details, read about [Time Management](https://msdn.microsoft.com/library/azure/mt582045.aspx) and [Windowing](https://msdn.microsoft.com/library/azure/dn835019.aspx) constructs used in the query from MSDN.</span></span>

## <a name="testing-azure-stream-analytics-queries"></a><span data-ttu-id="6cd28-443">Pruebas de consultas de Análisis de transmisiones de Azure</span><span class="sxs-lookup"><span data-stu-id="6cd28-443">Testing Azure Stream Analytics queries</span></span>
<span data-ttu-id="6cd28-444">Ahora que hemos escrito nuestra primera consulta de Azure Stream Analytics, es momento de probarla usando los archivos de datos de ejemplo ubicados en la carpeta TollApp en la siguiente ruta:</span><span class="sxs-lookup"><span data-stu-id="6cd28-444">Now that you have written your first Azure Stream Analytics query, it is time to test it by using sample data files located in your TollApp folder in the following path:</span></span>

<span data-ttu-id="6cd28-445"><seg>
  **..\\TollApp\\TollApp\\Datos**</seg></span><span class="sxs-lookup"><span data-stu-id="6cd28-445">**..\\TollApp\\TollApp\\Data**</span></span>

<span data-ttu-id="6cd28-446">Esta carpeta contiene los archivos siguientes:</span><span class="sxs-lookup"><span data-stu-id="6cd28-446">This folder contains the following files:</span></span>

* <span data-ttu-id="6cd28-447">Entry.json</span><span class="sxs-lookup"><span data-stu-id="6cd28-447">Entry.json</span></span>
* <span data-ttu-id="6cd28-448">Exit.json</span><span class="sxs-lookup"><span data-stu-id="6cd28-448">Exit.json</span></span>
* <span data-ttu-id="6cd28-449">registration.json</span><span class="sxs-lookup"><span data-stu-id="6cd28-449">Registration.json</span></span>

## <a name="question-1-number-of-vehicles-entering-a-toll-booth"></a><span data-ttu-id="6cd28-450">Pregunta 1: Número de vehículos que entran en una cabina de peaje</span><span class="sxs-lookup"><span data-stu-id="6cd28-450">Question 1: Number of vehicles entering a toll booth</span></span>
1. <span data-ttu-id="6cd28-451">Abra Azure Portal y vaya a su trabajo creado de Azure Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="6cd28-451">Open the Azure portal and go to your created Azure Stream Analytics job.</span></span> <span data-ttu-id="6cd28-452">Abra la pestaña **CONSULTA** y pegue la consulta de la sección anterior.</span><span class="sxs-lookup"><span data-stu-id="6cd28-452">Click the **QUERY** tab and paste query from the previous section.</span></span>

2. <span data-ttu-id="6cd28-453">Para validar esta consulta con los datos de ejemplo, cargue los datos en la entrada EntryStream haciendo clic en el símbolo "..." y seleccione **Cargar datos de ejemplo desde un archivo**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-453">To validate this query against sample data, upload the data into the EntryStream input by clicking the ... symbol and selecting **Upload sample data from file**.</span></span>

    ![Captura de pantalla del archivo Entry.json](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image41.png)
3. <span data-ttu-id="6cd28-455">En el panel que aparece, seleccione el archivo (Entry.json) en el equipo local y haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-455">In the pane that appears select the file (Entry.json) on your local machine and click **OK**.</span></span> <span data-ttu-id="6cd28-456">El icono **Probar** se iluminará ahora y será seleccionable.</span><span class="sxs-lookup"><span data-stu-id="6cd28-456">The **Test** icon will now illuminate and be clickable.</span></span>
   
    ![Captura de pantalla del archivo Entry.json](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image42.png)
3. <span data-ttu-id="6cd28-458">Compruebe que el resultado de la consulta es el esperado:</span><span class="sxs-lookup"><span data-stu-id="6cd28-458">Validate that the output of the query is as expected:</span></span>
   
    ![Resultados de la prueba](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image43.png)

## <a name="question-2-report-total-time-for-each-car-to-pass-through-the-toll-booth"></a><span data-ttu-id="6cd28-460">Pregunta 2: Notificar el tiempo total que necesita cada vehículo para atravesar la cabina de peaje</span><span class="sxs-lookup"><span data-stu-id="6cd28-460">Question 2: Report total time for each car to pass through the toll booth</span></span>
<span data-ttu-id="6cd28-461">El tiempo medio que necesita un vehículo para pasar el peaje ayuda a evaluar la eficacia del proceso y la experiencia del cliente.</span><span class="sxs-lookup"><span data-stu-id="6cd28-461">The average time that's required for a car to pass through the toll helps to assess the efficiency of the process and the customer experience.</span></span>

<span data-ttu-id="6cd28-462">Para encontrar el tiempo total, debe unir la secuencia EntryTime con la secuencia ExitTime.</span><span class="sxs-lookup"><span data-stu-id="6cd28-462">To find the total time, you need to join the EntryTime stream with the ExitTime stream.</span></span> <span data-ttu-id="6cd28-463">Las secuencias se unirán en las columnas TollId y LicencePlate.</span><span class="sxs-lookup"><span data-stu-id="6cd28-463">You will join the streams on TollId and LicencePlate columns.</span></span> <span data-ttu-id="6cd28-464">El operador **JOIN** requiere que especifique un margen temporal que describa la diferencia de tiempo aceptable entre los eventos combinados.</span><span class="sxs-lookup"><span data-stu-id="6cd28-464">The **JOIN** operator requires you to specify temporal leeway that describes the acceptable time difference between the joined events.</span></span> <span data-ttu-id="6cd28-465">Usaremos la función **DATEDIFF** para especificar que los eventos no deben durar más de 15 minutos entre sí.</span><span class="sxs-lookup"><span data-stu-id="6cd28-465">You will use **DATEDIFF** function to specify that events should be no more than 15 minutes from each other.</span></span> <span data-ttu-id="6cd28-466">También se aplicará la función **DATEDIFF** a las horas de entrada y salida para calcular el tiempo real que pasa un vehículo en la estación de peaje.</span><span class="sxs-lookup"><span data-stu-id="6cd28-466">You will also apply the **DATEDIFF** function to exit and entry times to compute the actual time that a car spends in the toll station.</span></span> <span data-ttu-id="6cd28-467">Tenga en cuenta la diferencia del uso de **DATEDIFF** en una instrucción **SELECT** en comparación con su uso en una condición **JOIN**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-467">Note the difference of the use of **DATEDIFF** when it's used in a **SELECT** statement rather than a **JOIN** condition.</span></span>

    SELECT EntryStream.TollId, EntryStream.EntryTime, ExitStream.ExitTime, EntryStream.LicensePlate, DATEDIFF (minute , EntryStream.EntryTime, ExitStream.ExitTime) AS DurationInMinutes
    FROM EntryStream TIMESTAMP BY EntryTime
    JOIN ExitStream TIMESTAMP BY ExitTime
    ON (EntryStream.TollId= ExitStream.TollId AND EntryStream.LicensePlate = ExitStream.LicensePlate)
    AND DATEDIFF (minute, EntryStream, ExitStream ) BETWEEN 0 AND 15

1. <span data-ttu-id="6cd28-468">Para probar esta consulta, actualícela en la pestaña **CONSULTA** del trabajo.</span><span class="sxs-lookup"><span data-stu-id="6cd28-468">To test this query, update the query on the **QUERY** for the job.</span></span> <span data-ttu-id="6cd28-469">Agregue el archivo de prueba de **ExitStream** igual que especificó **EntryStream** anteriormente.</span><span class="sxs-lookup"><span data-stu-id="6cd28-469">Add the test file for **ExitStream** just like **EntryStream** was entered above.</span></span>
   
2. <span data-ttu-id="6cd28-470">Haga clic en **Probar**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-470">Click **Test**.</span></span>

3. <span data-ttu-id="6cd28-471">Active la casilla para probar la consulta y ver la salida:</span><span class="sxs-lookup"><span data-stu-id="6cd28-471">Select the check box to test the query and view the output:</span></span>
   
    ![Resultado de la prueba](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image45.png)

## <a name="question-3-report-all-commercial-vehicles-with-expired-registration"></a><span data-ttu-id="6cd28-473">Pregunta 3: Notificar todos los vehículos comerciales con registro caducado</span><span class="sxs-lookup"><span data-stu-id="6cd28-473">Question 3: Report all commercial vehicles with expired registration</span></span>
<span data-ttu-id="6cd28-474">Análisis de transmisiones de Azure puede usar instantáneas estáticas de datos para combinar con flujos de datos temporales.</span><span class="sxs-lookup"><span data-stu-id="6cd28-474">Azure Stream Analytics can use static snapshots of data to join with temporal data streams.</span></span> <span data-ttu-id="6cd28-475">Para demostrar esta funcionalidad se usará la siguiente pregunta de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="6cd28-475">To demonstrate this capability, use the following sample question.</span></span>

<span data-ttu-id="6cd28-476">Si un vehículo comercial está registrado en la empresa de peaje, puede atravesar la cabina sin detenerse para inspección.</span><span class="sxs-lookup"><span data-stu-id="6cd28-476">If a commercial vehicle is registered with the toll company, it can pass through the toll booth without being stopped for inspection.</span></span> <span data-ttu-id="6cd28-477">Se usará la tabla de búsqueda de registro de vehículos comerciales para identificar todos los vehículos comerciales con registros caducados.</span><span class="sxs-lookup"><span data-stu-id="6cd28-477">You will use Commercial Vehicle Registration lookup table to identify all commercial vehicles that have expired registrations.</span></span>

```
SELECT EntryStream.EntryTime, EntryStream.LicensePlate, EntryStream.TollId, Registration.RegistrationId
FROM EntryStream TIMESTAMP BY EntryTime
JOIN Registration
ON EntryStream.LicensePlate = Registration.LicensePlate
WHERE Registration.Expired = '1'
```

<span data-ttu-id="6cd28-478">Para probar una consulta mediante datos de referencia, debe definir un origen de entrada para los datos de referencia, lo cual ya ha hecho.</span><span class="sxs-lookup"><span data-stu-id="6cd28-478">To test a query by using reference data, you need to define an input source for the reference data, which you have done already.</span></span>

<span data-ttu-id="6cd28-479">Para probar esta consulta, pegue la consulta en la pestaña **CONSULTA**, haga clic en **Probar** y especifique los dos orígenes de entrada y los datos de ejemplo de registro, y haga clic en **Probar**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-479">To test this query, paste the query into the **QUERY** tab, click **Test**, and specify the two input sources and the registration sample data and click **Test**.</span></span>  
   
![Resultado de la prueba](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image46.png)

## <a name="start-the-stream-analytics-job"></a><span data-ttu-id="6cd28-481">Inicio del trabajo de Análisis de transmisiones</span><span class="sxs-lookup"><span data-stu-id="6cd28-481">Start the Stream Analytics job</span></span>
<span data-ttu-id="6cd28-482">Ahora es el momento de finalizar la configuración e iniciar el trabajo.</span><span class="sxs-lookup"><span data-stu-id="6cd28-482">Now it's time to finish the configuration and start the job.</span></span> <span data-ttu-id="6cd28-483">Guarde la consulta de la pregunta 3, que generará un resultado que coincidirá con el esquema de la tabla de salida **TollDataRefJoin** .</span><span class="sxs-lookup"><span data-stu-id="6cd28-483">Save the query from Question 3, which will produce output that matches the schema of the **TollDataRefJoin** output table.</span></span>

<span data-ttu-id="6cd28-484">Vaya al **PANEL** del trabajo y haga clic en **INICIAR**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-484">Go to the job **DASHBOARD**, and click **START**.</span></span>

![Captura de pantalla del botón de inicio en el panel de trabajo](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image48.png)

<span data-ttu-id="6cd28-486">En el cuadro de diálogo que se abre, cambie la hora de **INICIAR SALIDA** por **HORA PERSONALIZADA**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-486">In the dialog box that opens, change the **START OUTPUT** time to **CUSTOM TIME**.</span></span> <span data-ttu-id="6cd28-487">Cambie la hora por una hora anterior a la hora actual.</span><span class="sxs-lookup"><span data-stu-id="6cd28-487">Change the hour to one hour before the current time.</span></span> <span data-ttu-id="6cd28-488">Como los eventos se han comenzado a generar al empezar este tutorial, este cambio garantiza que se procesan todos los eventos del centro de eventos.</span><span class="sxs-lookup"><span data-stu-id="6cd28-488">This change ensures that all events from the event hub are processed since you started to generate the events at the beginning of the tutorial.</span></span> <span data-ttu-id="6cd28-489">A continuación, haga clic en el botón **Iniciar** para iniciar el trabajo.</span><span class="sxs-lookup"><span data-stu-id="6cd28-489">Now click the **Start** button to start the job.</span></span>

![Selección de tiempo personalizado](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image49.png)

<span data-ttu-id="6cd28-491">El trabajo puede tardar unos minutos en iniciarse.</span><span class="sxs-lookup"><span data-stu-id="6cd28-491">Starting the job can take a few minutes.</span></span> <span data-ttu-id="6cd28-492">Puede ver el estado en la página de nivel superior de Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="6cd28-492">You can see the status on the top-level page for Stream Analytics.</span></span>

![Captura de pantalla del estado del trabajo](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image50.png)

## <a name="check-results-in-visual-studio"></a><span data-ttu-id="6cd28-494">Comprobación de resultados en Visual Studio</span><span class="sxs-lookup"><span data-stu-id="6cd28-494">Check results in Visual Studio</span></span>
1. <span data-ttu-id="6cd28-495">Abra el Explorador de servidores de Visual Studio y haga clic con el botón derecho en la tabla **TollDataRefJoin** .</span><span class="sxs-lookup"><span data-stu-id="6cd28-495">Open Visual Studio Server Explorer, and right-click the **TollDataRefJoin** table.</span></span>
2. <span data-ttu-id="6cd28-496">Seleccione **Mostrar datos de tabla** para ver el resultado del trabajo.</span><span class="sxs-lookup"><span data-stu-id="6cd28-496">Click **Show Table Data** to see the output of your job.</span></span>
   
    ![Selección de "Mostrar datos de tabla" en el Explorador de servidores](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image51.jpg)

## <a name="scale-out-azure-stream-analytics-jobs"></a><span data-ttu-id="6cd28-498">Escalado horizontal de trabajos de Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="6cd28-498">Scale out Azure Stream Analytics jobs</span></span>
<span data-ttu-id="6cd28-499">Azure Stream Analytics está diseñado para escalarse elásticamente de forma que pueda gestionar gran cantidad de datos.</span><span class="sxs-lookup"><span data-stu-id="6cd28-499">Azure Stream Analytics is designed to elastically scale so that it can handle a lot of data.</span></span> <span data-ttu-id="6cd28-500">Las consultas de Análisis de transmisiones puede usar una cláusula **PARTITION BY** para indicar al sistema que este paso se escalará horizontalmente. **PartitionId** es una columna especial que agrega el sistema para que coincida con el identificador de partición de la entrada (centro de eventos).</span><span class="sxs-lookup"><span data-stu-id="6cd28-500">The Azure Stream Analytics query can use a **PARTITION BY** clause to tell the system that this step will scale out. **PartitionId** is a special column that the system adds to match the partition ID of the input (event hub).</span></span>

    SELECT TollId, System.Timestamp AS WindowEnd, COUNT(*)AS Count
    FROM EntryStream TIMESTAMP BY EntryTime PARTITION BY PartitionId
    GROUP BY TUMBLINGWINDOW(minute,3), TollId, PartitionId

1. <span data-ttu-id="6cd28-501">Detenga el trabajo actual, actualice la consulta en la pestaña **CONSULTA** y abra el menú de engranaje **Configuración** en el panel del trabajo.</span><span class="sxs-lookup"><span data-stu-id="6cd28-501">Stop the current job, update the query in the **QUERY** tab, and open the **Settings** gear in the job dashboard.</span></span> <span data-ttu-id="6cd28-502">Haga clic en **Escalar**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-502">Click **Scale**.</span></span>
   
    <span data-ttu-id="6cd28-503">**UNIDADES DE STREAMING** definen la cantidad de capacidad de proceso que el trabajo puede recibir.</span><span class="sxs-lookup"><span data-stu-id="6cd28-503">**STREAMING UNITS** define the amount of compute power that the job can receive.</span></span>
2. <span data-ttu-id="6cd28-504">En la lista desplegable cambie del valor 1 al 6.</span><span class="sxs-lookup"><span data-stu-id="6cd28-504">Change the drop down from 1 from 6.</span></span>
   
    ![Captura de pantalla de selección de 6 unidades de streaming](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image52.png)
3. <span data-ttu-id="6cd28-506">Vaya a la pestaña **SALIDAS** y cambie el nombre de la tabla SQL por **TollDataTumblingCountPartitioned**.</span><span class="sxs-lookup"><span data-stu-id="6cd28-506">Go to the **OUTPUTS** tab and change the name of the SQL table to **TollDataTumblingCountPartitioned**.</span></span>

<span data-ttu-id="6cd28-507">Ahora, si inicia el trabajo, Azure Stream Analytics puede distribuir el trabajo entre más recursos de proceso y lograr un rendimiento mejor.</span><span class="sxs-lookup"><span data-stu-id="6cd28-507">If you start the job now, Azure Stream Analytics can distribute work across more compute resources and achieve better throughput.</span></span> <span data-ttu-id="6cd28-508">Tenga en cuenta que la aplicación TollApp también envía eventos que particiona TollId.</span><span class="sxs-lookup"><span data-stu-id="6cd28-508">Please note that the TollApp application is also sending events partitioned by TollId.</span></span>

## <a name="monitor"></a><span data-ttu-id="6cd28-509">Supervisión</span><span class="sxs-lookup"><span data-stu-id="6cd28-509">Monitor</span></span>
<span data-ttu-id="6cd28-510">El área **SUPERVISIÓN** contiene estadísticas sobre el trabajo en ejecución.</span><span class="sxs-lookup"><span data-stu-id="6cd28-510">The **MONITOR** area contains statistics about the running job.</span></span> <span data-ttu-id="6cd28-511">La primera vez, se necesita configuración para usar la cuenta de almacenamiento en la misma región (llamada toll como en el resto de este documento).</span><span class="sxs-lookup"><span data-stu-id="6cd28-511">First time configuration is needed to use the storage account in the same region (name toll like the rest of this document).</span></span>   

![Captura de pantalla de Supervisión](media/stream-analytics-build-an-iot-solution-using-stream-analytics/monitoring.png)

<span data-ttu-id="6cd28-513">También, puede acceder a **Registros de actividad** desde el área de **Configuración** del panel del trabajo.</span><span class="sxs-lookup"><span data-stu-id="6cd28-513">You can access **Activity Logs** from the job dashboard **Settings** area as well.</span></span>


## <a name="conclusion"></a><span data-ttu-id="6cd28-514">Conclusión</span><span class="sxs-lookup"><span data-stu-id="6cd28-514">Conclusion</span></span>
<span data-ttu-id="6cd28-515">Este tutorial ha introducido el servicio Azure Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="6cd28-515">This tutorial introduced you to the Azure Stream Analytics service.</span></span> <span data-ttu-id="6cd28-516">Se ha demostrado cómo configurar entradas y salidas de un trabajo de Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="6cd28-516">It demonstrated how to configure inputs and outputs for the Stream Analytics job.</span></span> <span data-ttu-id="6cd28-517">Mediante el escenario de datos de peaje, se han explicado los tipos más comunes de problemas que surgen en el espacio de datos en movimiento y cómo pueden resolverse con simples consultas de tipo SQL en Azure Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="6cd28-517">Using the Toll Data scenario, the tutorial explained common types of problems that arise in the space of data in motion and how they can be solved with simple SQL-like queries in Azure Stream Analytics.</span></span> <span data-ttu-id="6cd28-518">Asimismo, se han descrito las construcciones de extensión SQL para trabajar con datos temporales.</span><span class="sxs-lookup"><span data-stu-id="6cd28-518">The tutorial described SQL extension constructs for working with temporal data.</span></span> <span data-ttu-id="6cd28-519">Se ha mostrado cómo combinar secuencias de datos, cómo enriquecer la secuencia de datos con datos de referencia estáticos y cómo escalar una consulta horizontalmente para lograr un mayor rendimiento.</span><span class="sxs-lookup"><span data-stu-id="6cd28-519">It showed how to join data streams, how to enrich the data stream with static reference data, and how to scale out a query to achieve higher throughput.</span></span>

<span data-ttu-id="6cd28-520">Aunque este tutorial proporciona una buena introducción, no está completo de en modo alguno.</span><span class="sxs-lookup"><span data-stu-id="6cd28-520">Although this tutorial provides a good introduction, it is not complete by any means.</span></span> <span data-ttu-id="6cd28-521">Puede encontrar más patrones de consulta que usan el lenguaje SAQL en [Ejemplos de consulta para patrones de uso comunes de Stream Analytics](stream-analytics-stream-analytics-query-patterns.md).</span><span class="sxs-lookup"><span data-stu-id="6cd28-521">You can find more query patterns using the SAQL language at [Query examples for common Stream Analytics usage patterns](stream-analytics-stream-analytics-query-patterns.md).</span></span>
<span data-ttu-id="6cd28-522">Para más información sobre Azure Stream Analytics, consulte la [documentación en línea](https://azure.microsoft.com/documentation/services/stream-analytics/) .</span><span class="sxs-lookup"><span data-stu-id="6cd28-522">Refer to the [online documentation](https://azure.microsoft.com/documentation/services/stream-analytics/) to learn more about Azure Stream Analytics.</span></span>

## <a name="clean-up-your-azure-account"></a><span data-ttu-id="6cd28-523">Limpieza de la cuenta de Azure</span><span class="sxs-lookup"><span data-stu-id="6cd28-523">Clean up your Azure account</span></span>
1. <span data-ttu-id="6cd28-524">Detenga el trabajo de Stream Analytics desde Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="6cd28-524">Stop the Stream Analytics job in the Azure portal.</span></span>
   
    <span data-ttu-id="6cd28-525">El script Setup.ps1 crea dos centros de eventos y una base de datos SQL.</span><span class="sxs-lookup"><span data-stu-id="6cd28-525">The Setup.ps1 script creates two event hubs and a SQL database.</span></span> <span data-ttu-id="6cd28-526">Las siguientes instrucciones le ayudarán a limpiar los recursos al final del tutorial.</span><span class="sxs-lookup"><span data-stu-id="6cd28-526">The following instructions help you clean up resources at the end of the tutorial.</span></span>
2. <span data-ttu-id="6cd28-527">En la ventana de PowerShell, escriba **.\\Cleanup.ps1** para iniciar el script que elimina los recursos usados en el tutorial.</span><span class="sxs-lookup"><span data-stu-id="6cd28-527">In a PowerShell window, type **.\\Cleanup.ps1** to start the script that deletes resources used in the tutorial.</span></span>
   
   > [!NOTE]
   > <span data-ttu-id="6cd28-528">Los recursos se identifican por el nombre.</span><span class="sxs-lookup"><span data-stu-id="6cd28-528">Resources are identified by the name.</span></span> <span data-ttu-id="6cd28-529">Asegúrese de revisar cuidadosamente cada elemento antes de confirmar la eliminación.</span><span class="sxs-lookup"><span data-stu-id="6cd28-529">Make sure you carefully review each item before confirming removal.</span></span>
   > 
   > 


